var DG=Object.defineProperty;var LG=n=>{throw TypeError(n)};var UG=(n,e,t)=>e in n?DG(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var FG=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Dn=(n,e,t)=>UG(n,typeof e!="symbol"?e+"":e,t);var Qy=(n,e,t)=>e.has(n)?LG("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);var Cxe=FG((yu,Su)=>{function BG(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Ng=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function zG(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var PF={exports:{}},kw={},DF={exports:{}},Jr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EE=Symbol.for("react.element"),VG=Symbol.for("react.portal"),jG=Symbol.for("react.fragment"),HG=Symbol.for("react.strict_mode"),GG=Symbol.for("react.profiler"),WG=Symbol.for("react.provider"),$G=Symbol.for("react.context"),qG=Symbol.for("react.forward_ref"),XG=Symbol.for("react.suspense"),KG=Symbol.for("react.memo"),YG=Symbol.for("react.lazy"),hP=Symbol.iterator;function JG(n){return n===null||typeof n!="object"?null:(n=hP&&n[hP]||n["@@iterator"],typeof n=="function"?n:null)}var LF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},UF=Object.assign,FF={};function Oy(n,e,t){this.props=n,this.context=e,this.refs=FF,this.updater=t||LF}Oy.prototype.isReactComponent={};Oy.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Oy.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function BF(){}BF.prototype=Oy.prototype;function jI(n,e,t){this.props=n,this.context=e,this.refs=FF,this.updater=t||LF}var HI=jI.prototype=new BF;HI.constructor=jI;UF(HI,Oy.prototype);HI.isPureReactComponent=!0;var dP=Array.isArray,zF=Object.prototype.hasOwnProperty,GI={current:null},VF={key:!0,ref:!0,__self:!0,__source:!0};function jF(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)zF.call(e,r)&&!VF.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:EE,type:n,key:s,ref:o,props:i,_owner:GI.current}}function QG(n,e){return{$$typeof:EE,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function WI(n){return typeof n=="object"&&n!==null&&n.$$typeof===EE}function ZG(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var fP=/\/+/g;function g1(n,e){return typeof n=="object"&&n!==null&&n.key!=null?ZG(""+n.key):e.toString(36)}function IT(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case EE:case VG:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+g1(o,0):r,dP(i)?(t="",n!=null&&(t=n.replace(fP,"$&/")+"/"),IT(i,e,t,"",function(l){return l})):i!=null&&(WI(i)&&(i=QG(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(fP,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",dP(n))for(var a=0;a<n.length;a++){s=n[a];var c=r+g1(s,a);o+=IT(s,e,t,c,i)}else if(c=JG(n),typeof c=="function")for(n=c.call(n),a=0;!(s=n.next()).done;)s=s.value,c=r+g1(s,a++),o+=IT(s,e,t,c,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Cb(n,e,t){if(n==null)return n;var r=[],i=0;return IT(n,r,"","",function(s){return e.call(t,s,i++)}),r}function eW(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var sl={current:null},kT={transition:null},tW={ReactCurrentDispatcher:sl,ReactCurrentBatchConfig:kT,ReactCurrentOwner:GI};function HF(){throw Error("act(...) is not supported in production builds of React.")}Jr.Children={map:Cb,forEach:function(n,e,t){Cb(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Cb(n,function(){e++}),e},toArray:function(n){return Cb(n,function(e){return e})||[]},only:function(n){if(!WI(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Jr.Component=Oy;Jr.Fragment=jG;Jr.Profiler=GG;Jr.PureComponent=jI;Jr.StrictMode=HG;Jr.Suspense=XG;Jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tW;Jr.act=HF;Jr.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=UF({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=GI.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(c in e)zF.call(e,c)&&!VF.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:EE,type:n.type,key:i,ref:s,props:r,_owner:o}};Jr.createContext=function(n){return n={$$typeof:$G,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:WG,_context:n},n.Consumer=n};Jr.createElement=jF;Jr.createFactory=function(n){var e=jF.bind(null,n);return e.type=n,e};Jr.createRef=function(){return{current:null}};Jr.forwardRef=function(n){return{$$typeof:qG,render:n}};Jr.isValidElement=WI;Jr.lazy=function(n){return{$$typeof:YG,_payload:{_status:-1,_result:n},_init:eW}};Jr.memo=function(n,e){return{$$typeof:KG,type:n,compare:e===void 0?null:e}};Jr.startTransition=function(n){var e=kT.transition;kT.transition={};try{n()}finally{kT.transition=e}};Jr.unstable_act=HF;Jr.useCallback=function(n,e){return sl.current.useCallback(n,e)};Jr.useContext=function(n){return sl.current.useContext(n)};Jr.useDebugValue=function(){};Jr.useDeferredValue=function(n){return sl.current.useDeferredValue(n)};Jr.useEffect=function(n,e){return sl.current.useEffect(n,e)};Jr.useId=function(){return sl.current.useId()};Jr.useImperativeHandle=function(n,e,t){return sl.current.useImperativeHandle(n,e,t)};Jr.useInsertionEffect=function(n,e){return sl.current.useInsertionEffect(n,e)};Jr.useLayoutEffect=function(n,e){return sl.current.useLayoutEffect(n,e)};Jr.useMemo=function(n,e){return sl.current.useMemo(n,e)};Jr.useReducer=function(n,e,t){return sl.current.useReducer(n,e,t)};Jr.useRef=function(n){return sl.current.useRef(n)};Jr.useState=function(n){return sl.current.useState(n)};Jr.useSyncExternalStore=function(n,e,t){return sl.current.useSyncExternalStore(n,e,t)};Jr.useTransition=function(){return sl.current.useTransition()};Jr.version="18.3.1";DF.exports=Jr;var at=DF.exports;const Xh=Wl(at);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nW=at,rW=Symbol.for("react.element"),iW=Symbol.for("react.fragment"),sW=Object.prototype.hasOwnProperty,oW=nW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aW={key:!0,ref:!0,__self:!0,__source:!0};function GF(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)sW.call(e,r)&&!aW.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:rW,type:n,key:s,ref:o,props:i,_owner:oW.current}}kw.Fragment=iW;kw.jsx=GF;kw.jsxs=GF;PF.exports=kw;var Fe=PF.exports;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ow="170",cW=0,pP=1,lW=2,uW=0,$I=1,OT=2,Zd=3,am=0,Da=1,gu=2,Kh=0,Vv=1,mP=2,gP=3,_P=4,hW=5,j0=100,dW=101,fW=102,pW=103,mW=104,gW=200,_W=201,vW=202,yW=203,JR=204,QR=205,SW=206,EW=207,bW=208,TW=209,xW=210,wW=211,CW=212,RW=213,AW=214,ZR=0,eA=1,tA=2,sy=3,nA=4,rA=5,iA=6,sA=7,WF=0,MW=1,IW=2,mf=0,kW=1,OW=2,NW=3,$F=4,PW=5,DW=6,LW=7,qF=300,oy=301,ay=302,oA=303,aA=304,Nw=306,cA=1e3,q0=1001,lA=1002,bo=1003,UW=1004,Rb=1005,kl=1006,_1=1007,X0=1008,Ec=1009,XF=1010,KF=1011,VS=1012,qI=1013,Pg=1014,hf=1015,Ny=1016,XI=1017,KI=1018,s_=1020,YF=35902,JF=1021,QF=1022,Zu=1023,ZF=1024,eB=1025,jv=1026,o_=1027,tB=1028,YI=1029,nB=1030,JI=1031,Pw=1033,NT=33776,PT=33777,DT=33778,LT=33779,uA=35840,hA=35841,dA=35842,fA=35843,pA=36196,mA=37492,gA=37496,_A=37808,vA=37809,yA=37810,SA=37811,EA=37812,bA=37813,TA=37814,xA=37815,wA=37816,CA=37817,RA=37818,AA=37819,MA=37820,IA=37821,UT=36492,kA=36494,OA=36495,rB=36283,NA=36284,PA=36285,DA=36286,E_=3200,FW=3201,iB=0,BW=1,of="",yo="srgb",Xg="srgb-linear",Dw="linear",ji="srgb",ev=7680,vP=519,zW=512,VW=513,jW=514,sB=515,HW=516,GW=517,WW=518,$W=519,yP=35044,SP="300 es",Jp=2e3,xx=2001;class pm{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const pc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let EP=1234567;const AS=Math.PI/180,jS=180/Math.PI;function Py(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(pc[n&255]+pc[n>>8&255]+pc[n>>16&255]+pc[n>>24&255]+"-"+pc[e&255]+pc[e>>8&255]+"-"+pc[e>>16&15|64]+pc[e>>24&255]+"-"+pc[t&63|128]+pc[t>>8&255]+"-"+pc[t>>16&255]+pc[t>>24&255]+pc[r&255]+pc[r>>8&255]+pc[r>>16&255]+pc[r>>24&255]).toLowerCase()}function Jc(n,e,t){return Math.max(e,Math.min(t,n))}function QI(n,e){return(n%e+e)%e}function qW(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function XW(n,e,t){return n!==e?(t-n)/(e-n):0}function MS(n,e,t){return(1-t)*n+t*e}function KW(n,e,t,r){return MS(n,e,1-Math.exp(-t*r))}function YW(n,e=1){return e-Math.abs(QI(n,e*2)-e)}function JW(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function QW(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function ZW(n,e){return n+Math.floor(Math.random()*(e-n+1))}function e$(n,e){return n+Math.random()*(e-n)}function t$(n){return n*(.5-Math.random())}function n$(n){n!==void 0&&(EP=n);let e=EP+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function r$(n){return n*AS}function i$(n){return n*jS}function s$(n){return(n&n-1)===0&&n!==0}function o$(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function a$(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function c$(n,e,t,r,i){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),l=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),_=o((r-e)/2);switch(i){case"XYX":n.set(a*u,c*h,c*d,a*l);break;case"YZY":n.set(c*d,a*u,c*h,a*l);break;case"ZXZ":n.set(c*h,c*d,a*u,a*l);break;case"XZX":n.set(a*u,c*_,c*p,a*l);break;case"YXY":n.set(c*p,a*u,c*_,a*l);break;case"ZYZ":n.set(c*_,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function bv(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Hc(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const l$={DEG2RAD:AS,RAD2DEG:jS,generateUUID:Py,clamp:Jc,euclideanModulo:QI,mapLinear:qW,inverseLerp:XW,lerp:MS,damp:KW,pingpong:YW,smoothstep:JW,smootherstep:QW,randInt:ZW,randFloat:e$,randFloatSpread:t$,seededRandom:n$,degToRad:r$,radToDeg:i$,isPowerOfTwo:s$,ceilPowerOfTwo:o$,floorPowerOfTwo:a$,setQuaternionFromProperEuler:c$,normalize:Hc,denormalize:bv};class Ln{constructor(e=0,t=0){Ln.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Jc(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr{constructor(e,t,r,i,s,o,a,c,l){Dr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l)}set(e,t,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],p=r[5],_=r[8],y=i[0],S=i[3],T=i[6],A=i[1],R=i[4],I=i[7],U=i[2],D=i[5],L=i[8];return s[0]=o*y+a*A+c*U,s[3]=o*S+a*R+c*D,s[6]=o*T+a*I+c*L,s[1]=l*y+u*A+h*U,s[4]=l*S+u*R+h*D,s[7]=l*T+u*I+h*L,s[2]=d*y+p*A+_*U,s[5]=d*S+p*R+_*D,s[8]=d*T+p*I+_*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,p=l*s-o*c,_=t*h+r*d+i*p;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/_;return e[0]=h*y,e[1]=(i*l-u*r)*y,e[2]=(a*r-i*o)*y,e[3]=d*y,e[4]=(u*t-i*c)*y,e[5]=(i*s-a*t)*y,e[6]=p*y,e[7]=(r*c-l*t)*y,e[8]=(o*t-r*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(v1.makeScale(e,t)),this}rotate(e){return this.premultiply(v1.makeRotation(-e)),this}translate(e,t){return this.premultiply(v1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const v1=new Dr;function oB(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function HS(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function u$(){const n=HS("canvas");return n.style.display="block",n}const bP={};function gS(n){n in bP||(bP[n]=!0,console.warn(n))}function h$(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}function d$(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function f$(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Si={enabled:!0,workingColorSpace:Xg,spaces:{},convert:function(n,e,t){return this.enabled===!1||e===t||!e||!t||(this.spaces[e].transfer===ji&&(n.r=nm(n.r),n.g=nm(n.g),n.b=nm(n.b)),this.spaces[e].primaries!==this.spaces[t].primaries&&(n.applyMatrix3(this.spaces[e].toXYZ),n.applyMatrix3(this.spaces[t].fromXYZ)),this.spaces[t].transfer===ji&&(n.r=Hv(n.r),n.g=Hv(n.g),n.b=Hv(n.b))),n},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===of?Dw:this.spaces[n].transfer},getLuminanceCoefficients:function(n,e=this.workingColorSpace){return n.fromArray(this.spaces[e].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,e,t){return n.copy(this.spaces[e].toXYZ).multiply(this.spaces[t].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function nm(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Hv(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const TP=[.64,.33,.3,.6,.15,.06],xP=[.2126,.7152,.0722],wP=[.3127,.329],CP=new Dr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),RP=new Dr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Si.define({[Xg]:{primaries:TP,whitePoint:wP,transfer:Dw,toXYZ:CP,fromXYZ:RP,luminanceCoefficients:xP,workingColorSpaceConfig:{unpackColorSpace:yo},outputColorSpaceConfig:{drawingBufferColorSpace:yo}},[yo]:{primaries:TP,whitePoint:wP,transfer:ji,toXYZ:CP,fromXYZ:RP,luminanceCoefficients:xP,outputColorSpaceConfig:{drawingBufferColorSpace:yo}}});let tv;class p${static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{tv===void 0&&(tv=HS("canvas")),tv.width=e.width,tv.height=e.height;const r=tv.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=tv}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=HS("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=nm(s[o]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(nm(t[r]/255)*255):t[r]=nm(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let m$=0,aB=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:m$++}),this.uuid=Py(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(y1(i[o].image)):s.push(y1(i[o]))}else s=y1(i);r.url=s}return t||(e.images[this.uuid]=r),r}};function y1(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?p$.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let g$=0;class so extends pm{constructor(e=so.DEFAULT_IMAGE,t=so.DEFAULT_MAPPING,r=q0,i=q0,s=kl,o=X0,a=Zu,c=Ec,l=so.DEFAULT_ANISOTROPY,u=of){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:g$++}),this.uuid=Py(),this.name="",this.source=new aB(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Ln(0,0),this.repeat=new Ln(1,1),this.center=new Ln(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==qF)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case cA:e.x=e.x-Math.floor(e.x);break;case q0:e.x=e.x<0?0:1;break;case lA:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case cA:e.y=e.y-Math.floor(e.y);break;case q0:e.y=e.y<0?0:1;break;case lA:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}so.DEFAULT_IMAGE=null;so.DEFAULT_MAPPING=qF;so.DEFAULT_ANISOTROPY=1;class Eo{constructor(e=0,t=0,r=0,i=1){Eo.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],p=c[5],_=c[9],y=c[2],S=c[6],T=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-y)<.01&&Math.abs(_-S)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+y)<.1&&Math.abs(_+S)<.1&&Math.abs(l+p+T-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(l+1)/2,I=(p+1)/2,U=(T+1)/2,D=(u+d)/4,L=(h+y)/4,z=(_+S)/4;return R>I&&R>U?R<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(R),i=D/r,s=L/r):I>U?I<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(I),r=D/i,s=z/i):U<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(U),r=L/s,i=z/s),this.set(r,i,s,t),this}let A=Math.sqrt((S-_)*(S-_)+(h-y)*(h-y)+(d-u)*(d-u));return Math.abs(A)<.001&&(A=1),this.x=(S-_)/A,this.y=(h-y)/A,this.z=(d-u)/A,this.w=Math.acos((l+p+T-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _$ extends pm{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Eo(0,0,e,t),this.scissorTest=!1,this.viewport=new Eo(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:kl,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new so(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new aB(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Tu extends _${constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class cB extends so{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=bo,this.minFilter=bo,this.wrapR=q0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class v$ extends so{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=bo,this.minFilter=bo,this.wrapR=q0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bE{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const d=s[o+0],p=s[o+1],_=s[o+2],y=s[o+3];if(a===0){e[t+0]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=p,e[t+2]=_,e[t+3]=y;return}if(h!==y||c!==d||l!==p||u!==_){let S=1-a;const T=c*d+l*p+u*_+h*y,A=T>=0?1:-1,R=1-T*T;if(R>Number.EPSILON){const U=Math.sqrt(R),D=Math.atan2(U,T*A);S=Math.sin(S*D)/U,a=Math.sin(a*D)/U}const I=a*A;if(c=c*S+d*I,l=l*S+p*I,u=u*S+_*I,h=h*S+y*I,S===1-a){const U=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=U,l*=U,u*=U,h*=U}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],d=s[o+1],p=s[o+2],_=s[o+3];return e[t]=a*_+u*h+c*p-l*d,e[t+1]=c*_+u*d+l*h-a*p,e[t+2]=l*_+u*p+a*d-c*h,e[t+3]=u*_-a*h-c*d-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),d=c(r/2),p=c(i/2),_=c(s/2);switch(o){case"XYZ":this._x=d*u*h+l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h-d*p*_;break;case"YXZ":this._x=d*u*h+l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h+d*p*_;break;case"ZXY":this._x=d*u*h-l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h-d*p*_;break;case"ZYX":this._x=d*u*h-l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h+d*p*_;break;case"YZX":this._x=d*u*h+l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h-d*p*_;break;case"XZY":this._x=d*u*h-l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h+d*p*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],h=t[10],d=r+a+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-c)*p,this._y=(s-l)*p,this._z=(o-i)*p}else if(r>a&&r>h){const p=2*Math.sqrt(1+r-a-h);this._w=(u-c)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(s+l)/p}else if(a>h){const p=2*Math.sqrt(1+a-r-h);this._w=(s-l)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(c+u)/p}else{const p=2*Math.sqrt(1+h-r-a);this._w=(o-i)/p,this._x=(s+l)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Jc(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*r+t*this._x,this._y=p*i+t*this._y,this._z=p*s+t*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=o*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class qe{constructor(e=0,t=0,r=0){qe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(AP.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(AP.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*t-s*i),h=2*(s*r-o*t);return this.x=t+c*l+o*h-a*u,this.y=r+c*u+a*l-s*h,this.z=i+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return S1.copy(this).projectOnVector(e),this.sub(S1)}reflect(e){return this.sub(S1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Jc(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const S1=new qe,AP=new bE;class TE{constructor(e=new qe(1/0,1/0,1/0),t=new qe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Fh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Fh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Fh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Fh):Fh.fromBufferAttribute(s,o),Fh.applyMatrix4(e.matrixWorld),this.expandByPoint(Fh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ab.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Ab.copy(r.boundingBox)),Ab.applyMatrix4(e.matrixWorld),this.union(Ab)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Fh),Fh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Zy),Mb.subVectors(this.max,Zy),nv.subVectors(e.a,Zy),rv.subVectors(e.b,Zy),iv.subVectors(e.c,Zy),cg.subVectors(rv,nv),lg.subVectors(iv,rv),w0.subVectors(nv,iv);let t=[0,-cg.z,cg.y,0,-lg.z,lg.y,0,-w0.z,w0.y,cg.z,0,-cg.x,lg.z,0,-lg.x,w0.z,0,-w0.x,-cg.y,cg.x,0,-lg.y,lg.x,0,-w0.y,w0.x,0];return!E1(t,nv,rv,iv,Mb)||(t=[1,0,0,0,1,0,0,0,1],!E1(t,nv,rv,iv,Mb))?!1:(Ib.crossVectors(cg,lg),t=[Ib.x,Ib.y,Ib.z],E1(t,nv,rv,iv,Mb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Fh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Op[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Op[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Op[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Op[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Op[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Op[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Op[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Op[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Op),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Op=[new qe,new qe,new qe,new qe,new qe,new qe,new qe,new qe],Fh=new qe,Ab=new TE,nv=new qe,rv=new qe,iv=new qe,cg=new qe,lg=new qe,w0=new qe,Zy=new qe,Mb=new qe,Ib=new qe,C0=new qe;function E1(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){C0.fromArray(n,s);const a=i.x*Math.abs(C0.x)+i.y*Math.abs(C0.y)+i.z*Math.abs(C0.z),c=e.dot(C0),l=t.dot(C0),u=r.dot(C0);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const y$=new TE,eS=new qe,b1=new qe;class Lw{constructor(e=new qe,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):y$.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;eS.subVectors(e,this.center);const t=eS.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(eS,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(b1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(eS.copy(e.center).add(b1)),this.expandByPoint(eS.copy(e.center).sub(b1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Np=new qe,T1=new qe,kb=new qe,ug=new qe,x1=new qe,Ob=new qe,w1=new qe;class ZI{constructor(e=new qe,t=new qe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Np)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Np.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Np.copy(this.origin).addScaledVector(this.direction,t),Np.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){T1.copy(e).add(t).multiplyScalar(.5),kb.copy(t).sub(e).normalize(),ug.copy(this.origin).sub(T1);const s=e.distanceTo(t)*.5,o=-this.direction.dot(kb),a=ug.dot(this.direction),c=-ug.dot(kb),l=ug.lengthSq(),u=Math.abs(1-o*o);let h,d,p,_;if(u>0)if(h=o*c-a,d=o*a-c,_=s*u,h>=0)if(d>=-_)if(d<=_){const y=1/u;h*=y,d*=y,p=h*(h+o*d+2*a)+d*(o*h+d+2*c)+l}else d=s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d=-s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d<=-_?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-c),s),p=-h*h+d*(d+2*c)+l):d<=_?(h=0,d=Math.min(Math.max(-s,-c),s),p=d*(d+2*c)+l):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-c),s),p=-h*h+d*(d+2*c)+l);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(T1).addScaledVector(kb,d),p}intersectSphere(e,t){Np.subVectors(e.center,this.origin);const r=Np.dot(this.direction),i=Np.dot(Np)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(r=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Np)!==null}intersectTriangle(e,t,r,i,s){x1.subVectors(t,e),Ob.subVectors(r,e),w1.crossVectors(x1,Ob);let o=this.direction.dot(w1),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ug.subVectors(this.origin,e);const c=a*this.direction.dot(Ob.crossVectors(ug,Ob));if(c<0)return null;const l=a*this.direction.dot(x1.cross(ug));if(l<0||c+l>o)return null;const u=-a*ug.dot(w1);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class oo{constructor(e,t,r,i,s,o,a,c,l,u,h,d,p,_,y,S){oo.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l,u,h,d,p,_,y,S)}set(e,t,r,i,s,o,a,c,l,u,h,d,p,_,y,S){const T=this.elements;return T[0]=e,T[4]=t,T[8]=r,T[12]=i,T[1]=s,T[5]=o,T[9]=a,T[13]=c,T[2]=l,T[6]=u,T[10]=h,T[14]=d,T[3]=p,T[7]=_,T[11]=y,T[15]=S,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new oo().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/sv.setFromMatrixColumn(e,0).length(),s=1/sv.setFromMatrixColumn(e,1).length(),o=1/sv.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,p=o*h,_=a*u,y=a*h;t[0]=c*u,t[4]=-c*h,t[8]=l,t[1]=p+_*l,t[5]=d-y*l,t[9]=-a*c,t[2]=y-d*l,t[6]=_+p*l,t[10]=o*c}else if(e.order==="YXZ"){const d=c*u,p=c*h,_=l*u,y=l*h;t[0]=d+y*a,t[4]=_*a-p,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=p*a-_,t[6]=y+d*a,t[10]=o*c}else if(e.order==="ZXY"){const d=c*u,p=c*h,_=l*u,y=l*h;t[0]=d-y*a,t[4]=-o*h,t[8]=_+p*a,t[1]=p+_*a,t[5]=o*u,t[9]=y-d*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const d=o*u,p=o*h,_=a*u,y=a*h;t[0]=c*u,t[4]=_*l-p,t[8]=d*l+y,t[1]=c*h,t[5]=y*l+d,t[9]=p*l-_,t[2]=-l,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const d=o*c,p=o*l,_=a*c,y=a*l;t[0]=c*u,t[4]=y-d*h,t[8]=_*h+p,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=p*h+_,t[10]=d-y*h}else if(e.order==="XZY"){const d=o*c,p=o*l,_=a*c,y=a*l;t[0]=c*u,t[4]=-h,t[8]=l*u,t[1]=d*h+y,t[5]=o*u,t[9]=p*h-_,t[2]=_*h-p,t[6]=a*u,t[10]=y*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(S$,e,E$)}lookAt(e,t,r){const i=this.elements;return lu.subVectors(e,t),lu.lengthSq()===0&&(lu.z=1),lu.normalize(),hg.crossVectors(r,lu),hg.lengthSq()===0&&(Math.abs(r.z)===1?lu.x+=1e-4:lu.z+=1e-4,lu.normalize(),hg.crossVectors(r,lu)),hg.normalize(),Nb.crossVectors(lu,hg),i[0]=hg.x,i[4]=Nb.x,i[8]=lu.x,i[1]=hg.y,i[5]=Nb.y,i[9]=lu.y,i[2]=hg.z,i[6]=Nb.z,i[10]=lu.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],d=r[9],p=r[13],_=r[2],y=r[6],S=r[10],T=r[14],A=r[3],R=r[7],I=r[11],U=r[15],D=i[0],L=i[4],z=i[8],F=i[12],V=i[1],W=i[5],X=i[9],$=i[13],K=i[2],te=i[6],Q=i[10],ne=i[14],G=i[3],J=i[7],re=i[11],ue=i[15];return s[0]=o*D+a*V+c*K+l*G,s[4]=o*L+a*W+c*te+l*J,s[8]=o*z+a*X+c*Q+l*re,s[12]=o*F+a*$+c*ne+l*ue,s[1]=u*D+h*V+d*K+p*G,s[5]=u*L+h*W+d*te+p*J,s[9]=u*z+h*X+d*Q+p*re,s[13]=u*F+h*$+d*ne+p*ue,s[2]=_*D+y*V+S*K+T*G,s[6]=_*L+y*W+S*te+T*J,s[10]=_*z+y*X+S*Q+T*re,s[14]=_*F+y*$+S*ne+T*ue,s[3]=A*D+R*V+I*K+U*G,s[7]=A*L+R*W+I*te+U*J,s[11]=A*z+R*X+I*Q+U*re,s[15]=A*F+R*$+I*ne+U*ue,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],p=e[14],_=e[3],y=e[7],S=e[11],T=e[15];return _*(+s*c*h-i*l*h-s*a*d+r*l*d+i*a*p-r*c*p)+y*(+t*c*p-t*l*d+s*o*d-i*o*p+i*l*u-s*c*u)+S*(+t*l*h-t*a*p-s*o*h+r*o*p+s*a*u-r*l*u)+T*(-i*a*u-t*c*h+t*a*d+i*o*h-r*o*d+r*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],_=e[12],y=e[13],S=e[14],T=e[15],A=h*S*l-y*d*l+y*c*p-a*S*p-h*c*T+a*d*T,R=_*d*l-u*S*l-_*c*p+o*S*p+u*c*T-o*d*T,I=u*y*l-_*h*l+_*a*p-o*y*p-u*a*T+o*h*T,U=_*h*c-u*y*c-_*a*d+o*y*d+u*a*S-o*h*S,D=t*A+r*R+i*I+s*U;if(D===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/D;return e[0]=A*L,e[1]=(y*d*s-h*S*s-y*i*p+r*S*p+h*i*T-r*d*T)*L,e[2]=(a*S*s-y*c*s+y*i*l-r*S*l-a*i*T+r*c*T)*L,e[3]=(h*c*s-a*d*s-h*i*l+r*d*l+a*i*p-r*c*p)*L,e[4]=R*L,e[5]=(u*S*s-_*d*s+_*i*p-t*S*p-u*i*T+t*d*T)*L,e[6]=(_*c*s-o*S*s-_*i*l+t*S*l+o*i*T-t*c*T)*L,e[7]=(o*d*s-u*c*s+u*i*l-t*d*l-o*i*p+t*c*p)*L,e[8]=I*L,e[9]=(_*h*s-u*y*s-_*r*p+t*y*p+u*r*T-t*h*T)*L,e[10]=(o*y*s-_*a*s+_*r*l-t*y*l-o*r*T+t*a*T)*L,e[11]=(u*a*s-o*h*s-u*r*l+t*h*l+o*r*p-t*a*p)*L,e[12]=U*L,e[13]=(u*y*i-_*h*i+_*r*d-t*y*d-u*r*S+t*h*S)*L,e[14]=(_*a*i-o*y*i-_*r*c+t*y*c+o*r*S-t*a*S)*L,e[15]=(o*h*i-u*a*i+u*r*c-t*h*c-o*r*d+t*a*d)*L,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,h=a+a,d=s*l,p=s*u,_=s*h,y=o*u,S=o*h,T=a*h,A=c*l,R=c*u,I=c*h,U=r.x,D=r.y,L=r.z;return i[0]=(1-(y+T))*U,i[1]=(p+I)*U,i[2]=(_-R)*U,i[3]=0,i[4]=(p-I)*D,i[5]=(1-(d+T))*D,i[6]=(S+A)*D,i[7]=0,i[8]=(_+R)*L,i[9]=(S-A)*L,i[10]=(1-(d+y))*L,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=sv.set(i[0],i[1],i[2]).length();const o=sv.set(i[4],i[5],i[6]).length(),a=sv.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Bh.copy(this);const l=1/s,u=1/o,h=1/a;return Bh.elements[0]*=l,Bh.elements[1]*=l,Bh.elements[2]*=l,Bh.elements[4]*=u,Bh.elements[5]*=u,Bh.elements[6]*=u,Bh.elements[8]*=h,Bh.elements[9]*=h,Bh.elements[10]*=h,t.setFromRotationMatrix(Bh),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=Jp){const c=this.elements,l=2*s/(t-e),u=2*s/(r-i),h=(t+e)/(t-e),d=(r+i)/(r-i);let p,_;if(a===Jp)p=-(o+s)/(o-s),_=-2*o*s/(o-s);else if(a===xx)p=-o/(o-s),_=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=_,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=Jp){const c=this.elements,l=1/(t-e),u=1/(r-i),h=1/(o-s),d=(t+e)*l,p=(r+i)*u;let _,y;if(a===Jp)_=(o+s)*h,y=-2*h;else if(a===xx)_=s*h,y=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=y,c[14]=-_,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const sv=new qe,Bh=new oo,S$=new qe(0,0,0),E$=new qe(1,1,1),hg=new qe,Nb=new qe,lu=new qe,MP=new oo,IP=new bE;class cm{constructor(e=0,t=0,r=0,i=cm.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(Jc(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Jc(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Jc(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Jc(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Jc(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Jc(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return MP.makeRotationFromQuaternion(e),this.setFromRotationMatrix(MP,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return IP.setFromEuler(this),this.setFromQuaternion(IP,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}cm.DEFAULT_ORDER="XYZ";class Gv{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let b$=0;const kP=new qe,ov=new bE,Pp=new oo,Pb=new qe,tS=new qe,T$=new qe,x$=new bE,OP=new qe(1,0,0),NP=new qe(0,1,0),PP=new qe(0,0,1),DP={type:"added"},w$={type:"removed"},av={type:"childadded",child:null},C1={type:"childremoved",child:null};class Nl extends pm{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:b$++}),this.uuid=Py(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Nl.DEFAULT_UP.clone();const e=new qe,t=new cm,r=new bE,i=new qe(1,1,1);function s(){r.setFromEuler(t,!1)}function o(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new oo},normalMatrix:{value:new Dr}}),this.matrix=new oo,this.matrixWorld=new oo,this.matrixAutoUpdate=Nl.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Nl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Gv,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ov.setFromAxisAngle(e,t),this.quaternion.multiply(ov),this}rotateOnWorldAxis(e,t){return ov.setFromAxisAngle(e,t),this.quaternion.premultiply(ov),this}rotateX(e){return this.rotateOnAxis(OP,e)}rotateY(e){return this.rotateOnAxis(NP,e)}rotateZ(e){return this.rotateOnAxis(PP,e)}translateOnAxis(e,t){return kP.copy(e).applyQuaternion(this.quaternion),this.position.add(kP.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(OP,e)}translateY(e){return this.translateOnAxis(NP,e)}translateZ(e){return this.translateOnAxis(PP,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pp.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Pb.copy(e):Pb.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),tS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pp.lookAt(tS,Pb,this.up):Pp.lookAt(Pb,tS,this.up),this.quaternion.setFromRotationMatrix(Pp),i&&(Pp.extractRotation(i.matrixWorld),ov.setFromRotationMatrix(Pp),this.quaternion.premultiply(ov.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(DP),av.child=e,this.dispatchEvent(av),av.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(w$),C1.child=e,this.dispatchEvent(C1),C1.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Pp.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Pp.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pp),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(DP),av.child=e,this.dispatchEvent(av),av.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tS,e,T$),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tS,x$,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),p=o(e.animations),_=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),_.length>0&&(r.nodes=_)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Nl.DEFAULT_UP=new qe(0,1,0);Nl.DEFAULT_MATRIX_AUTO_UPDATE=!0;Nl.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const zh=new qe,Dp=new qe,R1=new qe,Lp=new qe,cv=new qe,lv=new qe,LP=new qe,A1=new qe,M1=new qe,I1=new qe,k1=new Eo,O1=new Eo,N1=new Eo;class Wh{constructor(e=new qe,t=new qe,r=new qe){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),zh.subVectors(e,t),i.cross(zh);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){zh.subVectors(i,t),Dp.subVectors(r,t),R1.subVectors(e,t);const o=zh.dot(zh),a=zh.dot(Dp),c=zh.dot(R1),l=Dp.dot(Dp),u=Dp.dot(R1),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(l*c-a*u)*d,_=(o*u-a*c)*d;return s.set(1-p-_,_,p)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Lp)===null?!1:Lp.x>=0&&Lp.y>=0&&Lp.x+Lp.y<=1}static getInterpolation(e,t,r,i,s,o,a,c){return this.getBarycoord(e,t,r,i,Lp)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Lp.x),c.addScaledVector(o,Lp.y),c.addScaledVector(a,Lp.z),c)}static getInterpolatedAttribute(e,t,r,i,s,o){return k1.setScalar(0),O1.setScalar(0),N1.setScalar(0),k1.fromBufferAttribute(e,t),O1.fromBufferAttribute(e,r),N1.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(k1,s.x),o.addScaledVector(O1,s.y),o.addScaledVector(N1,s.z),o}static isFrontFacing(e,t,r,i){return zh.subVectors(r,t),Dp.subVectors(e,t),zh.cross(Dp).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return zh.subVectors(this.c,this.b),Dp.subVectors(this.a,this.b),zh.cross(Dp).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Wh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Wh.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return Wh.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return Wh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Wh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;cv.subVectors(i,r),lv.subVectors(s,r),A1.subVectors(e,r);const c=cv.dot(A1),l=lv.dot(A1);if(c<=0&&l<=0)return t.copy(r);M1.subVectors(e,i);const u=cv.dot(M1),h=lv.dot(M1);if(u>=0&&h<=u)return t.copy(i);const d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(r).addScaledVector(cv,o);I1.subVectors(e,s);const p=cv.dot(I1),_=lv.dot(I1);if(_>=0&&p<=_)return t.copy(s);const y=p*l-c*_;if(y<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(r).addScaledVector(lv,a);const S=u*_-p*h;if(S<=0&&h-u>=0&&p-_>=0)return LP.subVectors(s,i),a=(h-u)/(h-u+(p-_)),t.copy(i).addScaledVector(LP,a);const T=1/(S+y+d);return o=y*T,a=d*T,t.copy(r).addScaledVector(cv,o).addScaledVector(lv,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const lB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},dg={h:0,s:0,l:0},Db={h:0,s:0,l:0};function P1(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class pi{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=yo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Si.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=Si.workingColorSpace){return this.r=e,this.g=t,this.b=r,Si.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=Si.workingColorSpace){if(e=QI(e,1),t=Jc(t,0,1),r=Jc(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=P1(o,s,e+1/3),this.g=P1(o,s,e),this.b=P1(o,s,e-1/3)}return Si.toWorkingColorSpace(this,i),this}setStyle(e,t=yo){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=yo){const r=lB[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nm(e.r),this.g=nm(e.g),this.b=nm(e.b),this}copyLinearToSRGB(e){return this.r=Hv(e.r),this.g=Hv(e.g),this.b=Hv(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=yo){return Si.fromWorkingColorSpace(mc.copy(this),e),Math.round(Jc(mc.r*255,0,255))*65536+Math.round(Jc(mc.g*255,0,255))*256+Math.round(Jc(mc.b*255,0,255))}getHexString(e=yo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Si.workingColorSpace){Si.fromWorkingColorSpace(mc.copy(this),t);const r=mc.r,i=mc.g,s=mc.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=Si.workingColorSpace){return Si.fromWorkingColorSpace(mc.copy(this),t),e.r=mc.r,e.g=mc.g,e.b=mc.b,e}getStyle(e=yo){Si.fromWorkingColorSpace(mc.copy(this),e);const t=mc.r,r=mc.g,i=mc.b;return e!==yo?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(dg),this.setHSL(dg.h+e,dg.s+t,dg.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(dg),e.getHSL(Db);const r=MS(dg.h,Db.h,t),i=MS(dg.s,Db.s,t),s=MS(dg.l,Db.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const mc=new pi;pi.NAMES=lB;let C$=0;class mm extends pm{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:C$++}),this.uuid=Py(),this.name="",this.blending=Vv,this.side=am,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=JR,this.blendDst=QR,this.blendEquation=j0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pi(0,0,0),this.blendAlpha=0,this.depthFunc=sy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vP,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ev,this.stencilZFail=ev,this.stencilZPass=ev,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Vv&&(r.blending=this.blending),this.side!==am&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==JR&&(r.blendSrc=this.blendSrc),this.blendDst!==QR&&(r.blendDst=this.blendDst),this.blendEquation!==j0&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==sy&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==vP&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ev&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ev&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ev&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class ek extends mm{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new pi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cm,this.combine=WF,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Uo=new qe,Lb=new Ln;class Gs{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=yP,this.updateRanges=[],this.gpuType=hf,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Lb.fromBufferAttribute(this,t),Lb.applyMatrix3(e),this.setXY(t,Lb.x,Lb.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Uo.fromBufferAttribute(this,t),Uo.applyMatrix3(e),this.setXYZ(t,Uo.x,Uo.y,Uo.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Uo.fromBufferAttribute(this,t),Uo.applyMatrix4(e),this.setXYZ(t,Uo.x,Uo.y,Uo.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Uo.fromBufferAttribute(this,t),Uo.applyNormalMatrix(e),this.setXYZ(t,Uo.x,Uo.y,Uo.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Uo.fromBufferAttribute(this,t),Uo.transformDirection(e),this.setXYZ(t,Uo.x,Uo.y,Uo.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=bv(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Hc(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=bv(t,this.array)),t}setX(e,t){return this.normalized&&(t=Hc(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=bv(t,this.array)),t}setY(e,t){return this.normalized&&(t=Hc(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=bv(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Hc(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=bv(t,this.array)),t}setW(e,t){return this.normalized&&(t=Hc(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Hc(t,this.array),r=Hc(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Hc(t,this.array),r=Hc(r,this.array),i=Hc(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=Hc(t,this.array),r=Hc(r,this.array),i=Hc(i,this.array),s=Hc(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==yP&&(e.usage=this.usage),e}}class uB extends Gs{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class hB extends Gs{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Z0 extends Gs{constructor(e,t,r){super(new Float32Array(e),t,r)}}let R$=0;const Wu=new oo,D1=new Nl,uv=new qe,uu=new TE,nS=new TE,Ra=new qe;class sd extends pm{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:R$++}),this.uuid=Py(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(oB(e)?hB:uB)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Dr().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Wu.makeRotationFromQuaternion(e),this.applyMatrix4(Wu),this}rotateX(e){return Wu.makeRotationX(e),this.applyMatrix4(Wu),this}rotateY(e){return Wu.makeRotationY(e),this.applyMatrix4(Wu),this}rotateZ(e){return Wu.makeRotationZ(e),this.applyMatrix4(Wu),this}translate(e,t,r){return Wu.makeTranslation(e,t,r),this.applyMatrix4(Wu),this}scale(e,t,r){return Wu.makeScale(e,t,r),this.applyMatrix4(Wu),this}lookAt(e){return D1.lookAt(e),D1.updateMatrix(),this.applyMatrix4(D1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(uv).negate(),this.translate(uv.x,uv.y,uv.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Z0(r,3))}else{for(let r=0,i=t.count;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new TE);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new qe(-1/0,-1/0,-1/0),new qe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];uu.setFromBufferAttribute(s),this.morphTargetsRelative?(Ra.addVectors(this.boundingBox.min,uu.min),this.boundingBox.expandByPoint(Ra),Ra.addVectors(this.boundingBox.max,uu.max),this.boundingBox.expandByPoint(Ra)):(this.boundingBox.expandByPoint(uu.min),this.boundingBox.expandByPoint(uu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Lw);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new qe,1/0);return}if(e){const r=this.boundingSphere.center;if(uu.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];nS.setFromBufferAttribute(a),this.morphTargetsRelative?(Ra.addVectors(uu.min,nS.min),uu.expandByPoint(Ra),Ra.addVectors(uu.max,nS.max),uu.expandByPoint(Ra)):(uu.expandByPoint(nS.min),uu.expandByPoint(nS.max))}uu.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Ra.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Ra));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ra.fromBufferAttribute(a,l),c&&(uv.fromBufferAttribute(e,l),Ra.add(uv)),i=Math.max(i,r.distanceToSquared(Ra))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Gs(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let z=0;z<r.count;z++)a[z]=new qe,c[z]=new qe;const l=new qe,u=new qe,h=new qe,d=new Ln,p=new Ln,_=new Ln,y=new qe,S=new qe;function T(z,F,V){l.fromBufferAttribute(r,z),u.fromBufferAttribute(r,F),h.fromBufferAttribute(r,V),d.fromBufferAttribute(s,z),p.fromBufferAttribute(s,F),_.fromBufferAttribute(s,V),u.sub(l),h.sub(l),p.sub(d),_.sub(d);const W=1/(p.x*_.y-_.x*p.y);isFinite(W)&&(y.copy(u).multiplyScalar(_.y).addScaledVector(h,-p.y).multiplyScalar(W),S.copy(h).multiplyScalar(p.x).addScaledVector(u,-_.x).multiplyScalar(W),a[z].add(y),a[F].add(y),a[V].add(y),c[z].add(S),c[F].add(S),c[V].add(S))}let A=this.groups;A.length===0&&(A=[{start:0,count:e.count}]);for(let z=0,F=A.length;z<F;++z){const V=A[z],W=V.start,X=V.count;for(let $=W,K=W+X;$<K;$+=3)T(e.getX($+0),e.getX($+1),e.getX($+2))}const R=new qe,I=new qe,U=new qe,D=new qe;function L(z){U.fromBufferAttribute(i,z),D.copy(U);const F=a[z];R.copy(F),R.sub(U.multiplyScalar(U.dot(F))).normalize(),I.crossVectors(D,F);const W=I.dot(c[z])<0?-1:1;o.setXYZW(z,R.x,R.y,R.z,W)}for(let z=0,F=A.length;z<F;++z){const V=A[z],W=V.start,X=V.count;for(let $=W,K=W+X;$<K;$+=3)L(e.getX($+0)),L(e.getX($+1)),L(e.getX($+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Gs(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const i=new qe,s=new qe,o=new qe,a=new qe,c=new qe,l=new qe,u=new qe,h=new qe;if(e)for(let d=0,p=e.count;d<p;d+=3){const _=e.getX(d+0),y=e.getX(d+1),S=e.getX(d+2);i.fromBufferAttribute(t,_),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,S),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,_),c.fromBufferAttribute(r,y),l.fromBufferAttribute(r,S),a.add(u),c.add(u),l.add(u),r.setXYZ(_,a.x,a.y,a.z),r.setXYZ(y,c.x,c.y,c.z),r.setXYZ(S,l.x,l.y,l.z)}else for(let d=0,p=t.count;d<p;d+=3)i.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Ra.fromBufferAttribute(e,t),Ra.normalize(),e.setXYZ(t,Ra.x,Ra.y,Ra.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,d=new l.constructor(c.length*u);let p=0,_=0;for(let y=0,S=c.length;y<S;y++){a.isInterleavedBufferAttribute?p=c[y]*a.data.stride+a.offset:p=c[y]*u;for(let T=0;T<u;T++)d[_++]=l[p++]}return new Gs(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new sd,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const d=l[u],p=e(d,r);c.push(p)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++){const p=l[h];u.push(p.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(t))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const UP=new oo,R0=new ZI,Ub=new Lw,FP=new qe,Fb=new qe,Bb=new qe,zb=new qe,L1=new qe,Vb=new qe,BP=new qe,jb=new qe;class $h extends Nl{constructor(e=new sd,t=new ek){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){Vb.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(L1.fromBufferAttribute(h,e),o?Vb.addScaledVector(L1,u):Vb.addScaledVector(L1.sub(t),u))}t.add(Vb)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Ub.copy(r.boundingSphere),Ub.applyMatrix4(s),R0.copy(e.ray).recast(e.near),!(Ub.containsPoint(R0.origin)===!1&&(R0.intersectSphere(Ub,FP)===null||R0.origin.distanceToSquared(FP)>(e.far-e.near)**2))&&(UP.copy(s).invert(),R0.copy(e.ray).applyMatrix4(UP),!(r.boundingBox!==null&&R0.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,R0)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let _=0,y=d.length;_<y;_++){const S=d[_],T=o[S.materialIndex],A=Math.max(S.start,p.start),R=Math.min(a.count,Math.min(S.start+S.count,p.start+p.count));for(let I=A,U=R;I<U;I+=3){const D=a.getX(I),L=a.getX(I+1),z=a.getX(I+2);i=Hb(this,T,e,r,l,u,h,D,L,z),i&&(i.faceIndex=Math.floor(I/3),i.face.materialIndex=S.materialIndex,t.push(i))}}else{const _=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let S=_,T=y;S<T;S+=3){const A=a.getX(S),R=a.getX(S+1),I=a.getX(S+2);i=Hb(this,o,e,r,l,u,h,A,R,I),i&&(i.faceIndex=Math.floor(S/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let _=0,y=d.length;_<y;_++){const S=d[_],T=o[S.materialIndex],A=Math.max(S.start,p.start),R=Math.min(c.count,Math.min(S.start+S.count,p.start+p.count));for(let I=A,U=R;I<U;I+=3){const D=I,L=I+1,z=I+2;i=Hb(this,T,e,r,l,u,h,D,L,z),i&&(i.faceIndex=Math.floor(I/3),i.face.materialIndex=S.materialIndex,t.push(i))}}else{const _=Math.max(0,p.start),y=Math.min(c.count,p.start+p.count);for(let S=_,T=y;S<T;S+=3){const A=S,R=S+1,I=S+2;i=Hb(this,o,e,r,l,u,h,A,R,I),i&&(i.faceIndex=Math.floor(S/3),t.push(i))}}}}function A$(n,e,t,r,i,s,o,a){let c;if(e.side===Da?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===am,a),c===null)return null;jb.copy(a),jb.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(jb);return l<t.near||l>t.far?null:{distance:l,point:jb.clone(),object:n}}function Hb(n,e,t,r,i,s,o,a,c,l){n.getVertexPosition(a,Fb),n.getVertexPosition(c,Bb),n.getVertexPosition(l,zb);const u=A$(n,e,t,r,Fb,Bb,zb,BP);if(u){const h=new qe;Wh.getBarycoord(BP,Fb,Bb,zb,h),i&&(u.uv=Wh.getInterpolatedAttribute(i,a,c,l,h,new Ln)),s&&(u.uv1=Wh.getInterpolatedAttribute(s,a,c,l,h,new Ln)),o&&(u.normal=Wh.getInterpolatedAttribute(o,a,c,l,h,new qe),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new qe,materialIndex:0};Wh.getNormal(Fb,Bb,zb,d.normal),u.face=d,u.barycoord=h}return u}class xE extends sd{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let d=0,p=0;_("z","y","x",-1,-1,r,t,e,o,s,0),_("z","y","x",1,-1,r,t,-e,o,s,1),_("x","z","y",1,1,e,r,t,i,o,2),_("x","z","y",1,-1,e,r,-t,i,o,3),_("x","y","z",1,-1,e,t,r,i,s,4),_("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new Z0(l,3)),this.setAttribute("normal",new Z0(u,3)),this.setAttribute("uv",new Z0(h,2));function _(y,S,T,A,R,I,U,D,L,z,F){const V=I/L,W=U/z,X=I/2,$=U/2,K=D/2,te=L+1,Q=z+1;let ne=0,G=0;const J=new qe;for(let re=0;re<Q;re++){const ue=re*W-$;for(let ye=0;ye<te;ye++){const Ne=ye*V-X;J[y]=Ne*A,J[S]=ue*R,J[T]=K,l.push(J.x,J.y,J.z),J[y]=0,J[S]=0,J[T]=D>0?1:-1,u.push(J.x,J.y,J.z),h.push(ye/L),h.push(1-re/z),ne+=1}}for(let re=0;re<z;re++)for(let ue=0;ue<L;ue++){const ye=d+ue+te*re,Ne=d+ue+te*(re+1),_e=d+(ue+1)+te*(re+1),Ae=d+(ue+1)+te*re;c.push(ye,Ne,Ae),c.push(Ne,_e,Ae),G+=6}a.addGroup(p,G,F),p+=G,d+=ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xE(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cy(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Gc(n){const e={};for(let t=0;t<n.length;t++){const r=cy(n[t]);for(const i in r)e[i]=r[i]}return e}function M$(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function dB(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Si.workingColorSpace}const I$={clone:cy,merge:Gc};var k$=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,O$=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class tl extends mm{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=k$,this.fragmentShader=O$,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cy(e.uniforms),this.uniformsGroups=M$(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class Uw extends Nl{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new oo,this.projectionMatrix=new oo,this.projectionMatrixInverse=new oo,this.coordinateSystem=Jp}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fg=new qe,zP=new Ln,VP=new Ln;class fu extends Uw{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=jS*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(AS*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return jS*2*Math.atan(Math.tan(AS*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){fg.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(fg.x,fg.y).multiplyScalar(-e/fg.z),fg.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(fg.x,fg.y).multiplyScalar(-e/fg.z)}getViewSize(e,t){return this.getViewBounds(e,zP,VP),t.subVectors(VP,zP)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(AS*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const hv=-90,dv=1;class N$ extends Nl{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new fu(hv,dv,e,t);i.layers=this.layers,this.add(i);const s=new fu(hv,dv,e,t);s.layers=this.layers,this.add(s);const o=new fu(hv,dv,e,t);o.layers=this.layers,this.add(o);const a=new fu(hv,dv,e,t);a.layers=this.layers,this.add(a);const c=new fu(hv,dv,e,t);c.layers=this.layers,this.add(c);const l=new fu(hv,dv,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===Jp)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===xx)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const y=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,c),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=y,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,d,p),e.xr.enabled=_,r.texture.needsPMREMUpdate=!0}}class fB extends so{constructor(e,t,r,i,s,o,a,c,l,u){e=e!==void 0?e:[],t=t!==void 0?t:oy,super(e,t,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class P$ extends Tu{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new fB(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:kl}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new xE(5,5,5),s=new tl({name:"CubemapFromEquirect",uniforms:cy(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Da,blending:Kh});s.uniforms.tEquirect.value=t;const o=new $h(i,s),a=t.minFilter;return t.minFilter===X0&&(t.minFilter=kl),new N$(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}const U1=new qe,D$=new qe,L$=new Dr;class Hh{constructor(e=new qe(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=U1.subVectors(r,t).cross(D$.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(U1),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||L$.getNormalMatrix(e),i=this.coplanarPoint(U1).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const A0=new Lw,Gb=new qe;class pB{constructor(e=new Hh,t=new Hh,r=new Hh,i=new Hh,s=new Hh,o=new Hh){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Jp){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],d=i[7],p=i[8],_=i[9],y=i[10],S=i[11],T=i[12],A=i[13],R=i[14],I=i[15];if(r[0].setComponents(c-s,d-l,S-p,I-T).normalize(),r[1].setComponents(c+s,d+l,S+p,I+T).normalize(),r[2].setComponents(c+o,d+u,S+_,I+A).normalize(),r[3].setComponents(c-o,d-u,S-_,I-A).normalize(),r[4].setComponents(c-a,d-h,S-y,I-R).normalize(),t===Jp)r[5].setComponents(c+a,d+h,S+y,I+R).normalize();else if(t===xx)r[5].setComponents(a,h,y,R).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),A0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),A0.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(A0)}intersectsSprite(e){return A0.center.set(0,0,0),A0.radius=.7071067811865476,A0.applyMatrix4(e.matrixWorld),this.intersectsSphere(A0)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Gb.x=i.normal.x>0?e.max.x:e.min.x,Gb.y=i.normal.y>0?e.max.y:e.min.y,Gb.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Gb)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function mB(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function U$(n){const e=new WeakMap;function t(a,c){const l=a.array,u=a.usage,h=l.byteLength,d=n.createBuffer();n.bindBuffer(c,d),n.bufferData(c,l,u),a.onUploadCallback();let p;if(l instanceof Float32Array)p=n.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?p=n.HALF_FLOAT:p=n.UNSIGNED_SHORT;else if(l instanceof Int16Array)p=n.SHORT;else if(l instanceof Uint32Array)p=n.UNSIGNED_INT;else if(l instanceof Int32Array)p=n.INT;else if(l instanceof Int8Array)p=n.BYTE;else if(l instanceof Uint8Array)p=n.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)p=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:p,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,c,l){const u=c.array,h=c.updateRanges;if(n.bindBuffer(l,a),h.length===0)n.bufferSubData(l,0,u);else{h.sort((p,_)=>p.start-_.start);let d=0;for(let p=1;p<h.length;p++){const _=h[d],y=h[p];y.start<=_.start+_.count+1?_.count=Math.max(_.count,y.start+y.count-_.start):(++d,h[d]=y)}h.length=d+1;for(let p=0,_=h.length;p<_;p++){const y=h[p];n.bufferSubData(l,y.start*u.BYTES_PER_ELEMENT,u,y.start,y.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(n.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,t(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}class wE extends sd{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,d=t/c,p=[],_=[],y=[],S=[];for(let T=0;T<u;T++){const A=T*d-o;for(let R=0;R<l;R++){const I=R*h-s;_.push(I,-A,0),y.push(0,0,1),S.push(R/a),S.push(1-T/c)}}for(let T=0;T<c;T++)for(let A=0;A<a;A++){const R=A+l*T,I=A+l*(T+1),U=A+1+l*(T+1),D=A+1+l*T;p.push(R,I,D),p.push(I,U,D)}this.setIndex(p),this.setAttribute("position",new Z0(_,3)),this.setAttribute("normal",new Z0(y,3)),this.setAttribute("uv",new Z0(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wE(e.width,e.height,e.widthSegments,e.heightSegments)}}var F$=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,B$=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,z$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,V$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,j$=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,H$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,G$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,W$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$$=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,q$=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,X$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,K$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Y$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,J$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Q$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Z$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,e9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,t9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,n9=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,r9=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,i9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,s9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,o9=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,a9=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,c9=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,l9=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,u9=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,h9=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,d9=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,f9=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,p9="gl_FragColor = linearToOutputTexel( gl_FragColor );",m9=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,g9=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_9=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,v9=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,y9=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,S9=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,E9=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,b9=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,T9=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,x9=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,w9=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,C9=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,R9=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,A9=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,M9=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,I9=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,k9=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,O9=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,N9=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,P9=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,D9=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,L9=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,U9=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,F9=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,B9=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,z9=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,V9=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,j9=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,H9=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,G9=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,W9=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$9=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,q9=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,X9=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,K9=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Y9=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,J9=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Q9=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Z9=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,e7=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,t7=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,n7=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,r7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,i7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,s7=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,o7=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,a7=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,c7=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,l7=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,u7=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,h7=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,d7=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,f7=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,p7=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,m7=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,g7=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_7=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,v7=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,y7=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,S7=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,E7=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,b7=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,T7=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,x7=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,w7=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,C7=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,R7=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,A7=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,M7=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,I7=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,k7=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,O7=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,N7=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,P7=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,D7=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,L7=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const U7=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,F7=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,B7=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,z7=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,V7=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,j7=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,H7=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,G7=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,W7=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,$7=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,q7=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,X7=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,K7=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Y7=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,J7=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Q7=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Z7=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,eq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tq=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,nq=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rq=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,iq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,sq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,oq=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,cq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,dq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fq=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pq=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,mq=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Fr={alphahash_fragment:F$,alphahash_pars_fragment:B$,alphamap_fragment:z$,alphamap_pars_fragment:V$,alphatest_fragment:j$,alphatest_pars_fragment:H$,aomap_fragment:G$,aomap_pars_fragment:W$,batching_pars_vertex:$$,batching_vertex:q$,begin_vertex:X$,beginnormal_vertex:K$,bsdfs:Y$,iridescence_fragment:J$,bumpmap_pars_fragment:Q$,clipping_planes_fragment:Z$,clipping_planes_pars_fragment:e9,clipping_planes_pars_vertex:t9,clipping_planes_vertex:n9,color_fragment:r9,color_pars_fragment:i9,color_pars_vertex:s9,color_vertex:o9,common:a9,cube_uv_reflection_fragment:c9,defaultnormal_vertex:l9,displacementmap_pars_vertex:u9,displacementmap_vertex:h9,emissivemap_fragment:d9,emissivemap_pars_fragment:f9,colorspace_fragment:p9,colorspace_pars_fragment:m9,envmap_fragment:g9,envmap_common_pars_fragment:_9,envmap_pars_fragment:v9,envmap_pars_vertex:y9,envmap_physical_pars_fragment:I9,envmap_vertex:S9,fog_vertex:E9,fog_pars_vertex:b9,fog_fragment:T9,fog_pars_fragment:x9,gradientmap_pars_fragment:w9,lightmap_pars_fragment:C9,lights_lambert_fragment:R9,lights_lambert_pars_fragment:A9,lights_pars_begin:M9,lights_toon_fragment:k9,lights_toon_pars_fragment:O9,lights_phong_fragment:N9,lights_phong_pars_fragment:P9,lights_physical_fragment:D9,lights_physical_pars_fragment:L9,lights_fragment_begin:U9,lights_fragment_maps:F9,lights_fragment_end:B9,logdepthbuf_fragment:z9,logdepthbuf_pars_fragment:V9,logdepthbuf_pars_vertex:j9,logdepthbuf_vertex:H9,map_fragment:G9,map_pars_fragment:W9,map_particle_fragment:$9,map_particle_pars_fragment:q9,metalnessmap_fragment:X9,metalnessmap_pars_fragment:K9,morphinstance_vertex:Y9,morphcolor_vertex:J9,morphnormal_vertex:Q9,morphtarget_pars_vertex:Z9,morphtarget_vertex:e7,normal_fragment_begin:t7,normal_fragment_maps:n7,normal_pars_fragment:r7,normal_pars_vertex:i7,normal_vertex:s7,normalmap_pars_fragment:o7,clearcoat_normal_fragment_begin:a7,clearcoat_normal_fragment_maps:c7,clearcoat_pars_fragment:l7,iridescence_pars_fragment:u7,opaque_fragment:h7,packing:d7,premultiplied_alpha_fragment:f7,project_vertex:p7,dithering_fragment:m7,dithering_pars_fragment:g7,roughnessmap_fragment:_7,roughnessmap_pars_fragment:v7,shadowmap_pars_fragment:y7,shadowmap_pars_vertex:S7,shadowmap_vertex:E7,shadowmask_pars_fragment:b7,skinbase_vertex:T7,skinning_pars_vertex:x7,skinning_vertex:w7,skinnormal_vertex:C7,specularmap_fragment:R7,specularmap_pars_fragment:A7,tonemapping_fragment:M7,tonemapping_pars_fragment:I7,transmission_fragment:k7,transmission_pars_fragment:O7,uv_pars_fragment:N7,uv_pars_vertex:P7,uv_vertex:D7,worldpos_vertex:L7,background_vert:U7,background_frag:F7,backgroundCube_vert:B7,backgroundCube_frag:z7,cube_vert:V7,cube_frag:j7,depth_vert:H7,depth_frag:G7,distanceRGBA_vert:W7,distanceRGBA_frag:$7,equirect_vert:q7,equirect_frag:X7,linedashed_vert:K7,linedashed_frag:Y7,meshbasic_vert:J7,meshbasic_frag:Q7,meshlambert_vert:Z7,meshlambert_frag:eq,meshmatcap_vert:tq,meshmatcap_frag:nq,meshnormal_vert:rq,meshnormal_frag:iq,meshphong_vert:sq,meshphong_frag:oq,meshphysical_vert:aq,meshphysical_frag:cq,meshtoon_vert:lq,meshtoon_frag:uq,points_vert:hq,points_frag:dq,shadow_vert:fq,shadow_frag:pq,sprite_vert:mq,sprite_frag:gq},Yt={common:{diffuse:{value:new pi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Dr},alphaMap:{value:null},alphaMapTransform:{value:new Dr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Dr}},envmap:{envMap:{value:null},envMapRotation:{value:new Dr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Dr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Dr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Dr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Dr},normalScale:{value:new Ln(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Dr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Dr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Dr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Dr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Dr},alphaTest:{value:0},uvTransform:{value:new Dr}},sprite:{diffuse:{value:new pi(16777215)},opacity:{value:1},center:{value:new Ln(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Dr},alphaMap:{value:null},alphaMapTransform:{value:new Dr},alphaTest:{value:0}}},tf={basic:{uniforms:Gc([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.fog]),vertexShader:Fr.meshbasic_vert,fragmentShader:Fr.meshbasic_frag},lambert:{uniforms:Gc([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,Yt.lights,{emissive:{value:new pi(0)}}]),vertexShader:Fr.meshlambert_vert,fragmentShader:Fr.meshlambert_frag},phong:{uniforms:Gc([Yt.common,Yt.specularmap,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,Yt.lights,{emissive:{value:new pi(0)},specular:{value:new pi(1118481)},shininess:{value:30}}]),vertexShader:Fr.meshphong_vert,fragmentShader:Fr.meshphong_frag},standard:{uniforms:Gc([Yt.common,Yt.envmap,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.roughnessmap,Yt.metalnessmap,Yt.fog,Yt.lights,{emissive:{value:new pi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Fr.meshphysical_vert,fragmentShader:Fr.meshphysical_frag},toon:{uniforms:Gc([Yt.common,Yt.aomap,Yt.lightmap,Yt.emissivemap,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.gradientmap,Yt.fog,Yt.lights,{emissive:{value:new pi(0)}}]),vertexShader:Fr.meshtoon_vert,fragmentShader:Fr.meshtoon_frag},matcap:{uniforms:Gc([Yt.common,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,Yt.fog,{matcap:{value:null}}]),vertexShader:Fr.meshmatcap_vert,fragmentShader:Fr.meshmatcap_frag},points:{uniforms:Gc([Yt.points,Yt.fog]),vertexShader:Fr.points_vert,fragmentShader:Fr.points_frag},dashed:{uniforms:Gc([Yt.common,Yt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Fr.linedashed_vert,fragmentShader:Fr.linedashed_frag},depth:{uniforms:Gc([Yt.common,Yt.displacementmap]),vertexShader:Fr.depth_vert,fragmentShader:Fr.depth_frag},normal:{uniforms:Gc([Yt.common,Yt.bumpmap,Yt.normalmap,Yt.displacementmap,{opacity:{value:1}}]),vertexShader:Fr.meshnormal_vert,fragmentShader:Fr.meshnormal_frag},sprite:{uniforms:Gc([Yt.sprite,Yt.fog]),vertexShader:Fr.sprite_vert,fragmentShader:Fr.sprite_frag},background:{uniforms:{uvTransform:{value:new Dr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Fr.background_vert,fragmentShader:Fr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Dr}},vertexShader:Fr.backgroundCube_vert,fragmentShader:Fr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Fr.cube_vert,fragmentShader:Fr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Fr.equirect_vert,fragmentShader:Fr.equirect_frag},distanceRGBA:{uniforms:Gc([Yt.common,Yt.displacementmap,{referencePosition:{value:new qe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Fr.distanceRGBA_vert,fragmentShader:Fr.distanceRGBA_frag},shadow:{uniforms:Gc([Yt.lights,Yt.fog,{color:{value:new pi(0)},opacity:{value:1}}]),vertexShader:Fr.shadow_vert,fragmentShader:Fr.shadow_frag}};tf.physical={uniforms:Gc([tf.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Dr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Dr},clearcoatNormalScale:{value:new Ln(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Dr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Dr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Dr},sheen:{value:0},sheenColor:{value:new pi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Dr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Dr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Dr},transmissionSamplerSize:{value:new Ln},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Dr},attenuationDistance:{value:0},attenuationColor:{value:new pi(0)},specularColor:{value:new pi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Dr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Dr},anisotropyVector:{value:new Ln},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Dr}}]),vertexShader:Fr.meshphysical_vert,fragmentShader:Fr.meshphysical_frag};const Wb={r:0,b:0,g:0},M0=new cm,_q=new oo;function vq(n,e,t,r,i,s,o){const a=new pi(0);let c=s===!0?0:1,l,u,h=null,d=0,p=null;function _(A){let R=A.isScene===!0?A.background:null;return R&&R.isTexture&&(R=(A.backgroundBlurriness>0?t:e).get(R)),R}function y(A){let R=!1;const I=_(A);I===null?T(a,c):I&&I.isColor&&(T(I,1),R=!0);const U=n.xr.getEnvironmentBlendMode();U==="additive"?r.buffers.color.setClear(0,0,0,1,o):U==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||R)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function S(A,R){const I=_(R);I&&(I.isCubeTexture||I.mapping===Nw)?(u===void 0&&(u=new $h(new xE(1,1,1),new tl({name:"BackgroundCubeMaterial",uniforms:cy(tf.backgroundCube.uniforms),vertexShader:tf.backgroundCube.vertexShader,fragmentShader:tf.backgroundCube.fragmentShader,side:Da,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(U,D,L){this.matrixWorld.copyPosition(L.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),M0.copy(R.backgroundRotation),M0.x*=-1,M0.y*=-1,M0.z*=-1,I.isCubeTexture&&I.isRenderTargetTexture===!1&&(M0.y*=-1,M0.z*=-1),u.material.uniforms.envMap.value=I,u.material.uniforms.flipEnvMap.value=I.isCubeTexture&&I.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=R.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(_q.makeRotationFromEuler(M0)),u.material.toneMapped=Si.getTransfer(I.colorSpace)!==ji,(h!==I||d!==I.version||p!==n.toneMapping)&&(u.material.needsUpdate=!0,h=I,d=I.version,p=n.toneMapping),u.layers.enableAll(),A.unshift(u,u.geometry,u.material,0,0,null)):I&&I.isTexture&&(l===void 0&&(l=new $h(new wE(2,2),new tl({name:"BackgroundMaterial",uniforms:cy(tf.background.uniforms),vertexShader:tf.background.vertexShader,fragmentShader:tf.background.fragmentShader,side:am,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=I,l.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,l.material.toneMapped=Si.getTransfer(I.colorSpace)!==ji,I.matrixAutoUpdate===!0&&I.updateMatrix(),l.material.uniforms.uvTransform.value.copy(I.matrix),(h!==I||d!==I.version||p!==n.toneMapping)&&(l.material.needsUpdate=!0,h=I,d=I.version,p=n.toneMapping),l.layers.enableAll(),A.unshift(l,l.geometry,l.material,0,0,null))}function T(A,R){A.getRGB(Wb,dB(n)),r.buffers.color.setClear(Wb.r,Wb.g,Wb.b,R,o)}return{getClearColor:function(){return a},setClearColor:function(A,R=1){a.set(A),c=R,T(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(A){c=A,T(a,c)},render:y,addToRenderList:S}}function yq(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=d(null);let s=i,o=!1;function a(V,W,X,$,K){let te=!1;const Q=h($,X,W);s!==Q&&(s=Q,l(s.object)),te=p(V,$,X,K),te&&_(V,$,X,K),K!==null&&e.update(K,n.ELEMENT_ARRAY_BUFFER),(te||o)&&(o=!1,I(V,W,X,$),K!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(K).buffer))}function c(){return n.createVertexArray()}function l(V){return n.bindVertexArray(V)}function u(V){return n.deleteVertexArray(V)}function h(V,W,X){const $=X.wireframe===!0;let K=r[V.id];K===void 0&&(K={},r[V.id]=K);let te=K[W.id];te===void 0&&(te={},K[W.id]=te);let Q=te[$];return Q===void 0&&(Q=d(c()),te[$]=Q),Q}function d(V){const W=[],X=[],$=[];for(let K=0;K<t;K++)W[K]=0,X[K]=0,$[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:X,attributeDivisors:$,object:V,attributes:{},index:null}}function p(V,W,X,$){const K=s.attributes,te=W.attributes;let Q=0;const ne=X.getAttributes();for(const G in ne)if(ne[G].location>=0){const re=K[G];let ue=te[G];if(ue===void 0&&(G==="instanceMatrix"&&V.instanceMatrix&&(ue=V.instanceMatrix),G==="instanceColor"&&V.instanceColor&&(ue=V.instanceColor)),re===void 0||re.attribute!==ue||ue&&re.data!==ue.data)return!0;Q++}return s.attributesNum!==Q||s.index!==$}function _(V,W,X,$){const K={},te=W.attributes;let Q=0;const ne=X.getAttributes();for(const G in ne)if(ne[G].location>=0){let re=te[G];re===void 0&&(G==="instanceMatrix"&&V.instanceMatrix&&(re=V.instanceMatrix),G==="instanceColor"&&V.instanceColor&&(re=V.instanceColor));const ue={};ue.attribute=re,re&&re.data&&(ue.data=re.data),K[G]=ue,Q++}s.attributes=K,s.attributesNum=Q,s.index=$}function y(){const V=s.newAttributes;for(let W=0,X=V.length;W<X;W++)V[W]=0}function S(V){T(V,0)}function T(V,W){const X=s.newAttributes,$=s.enabledAttributes,K=s.attributeDivisors;X[V]=1,$[V]===0&&(n.enableVertexAttribArray(V),$[V]=1),K[V]!==W&&(n.vertexAttribDivisor(V,W),K[V]=W)}function A(){const V=s.newAttributes,W=s.enabledAttributes;for(let X=0,$=W.length;X<$;X++)W[X]!==V[X]&&(n.disableVertexAttribArray(X),W[X]=0)}function R(V,W,X,$,K,te,Q){Q===!0?n.vertexAttribIPointer(V,W,X,K,te):n.vertexAttribPointer(V,W,X,$,K,te)}function I(V,W,X,$){y();const K=$.attributes,te=X.getAttributes(),Q=W.defaultAttributeValues;for(const ne in te){const G=te[ne];if(G.location>=0){let J=K[ne];if(J===void 0&&(ne==="instanceMatrix"&&V.instanceMatrix&&(J=V.instanceMatrix),ne==="instanceColor"&&V.instanceColor&&(J=V.instanceColor)),J!==void 0){const re=J.normalized,ue=J.itemSize,ye=e.get(J);if(ye===void 0)continue;const Ne=ye.buffer,_e=ye.type,Ae=ye.bytesPerElement,Ye=_e===n.INT||_e===n.UNSIGNED_INT||J.gpuType===qI;if(J.isInterleavedBufferAttribute){const Ze=J.data,Ke=Ze.stride,It=J.offset;if(Ze.isInstancedInterleavedBuffer){for(let Xt=0;Xt<G.locationSize;Xt++)T(G.location+Xt,Ze.meshPerAttribute);V.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=Ze.meshPerAttribute*Ze.count)}else for(let Xt=0;Xt<G.locationSize;Xt++)S(G.location+Xt);n.bindBuffer(n.ARRAY_BUFFER,Ne);for(let Xt=0;Xt<G.locationSize;Xt++)R(G.location+Xt,ue/G.locationSize,_e,re,Ke*Ae,(It+ue/G.locationSize*Xt)*Ae,Ye)}else{if(J.isInstancedBufferAttribute){for(let Ze=0;Ze<G.locationSize;Ze++)T(G.location+Ze,J.meshPerAttribute);V.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let Ze=0;Ze<G.locationSize;Ze++)S(G.location+Ze);n.bindBuffer(n.ARRAY_BUFFER,Ne);for(let Ze=0;Ze<G.locationSize;Ze++)R(G.location+Ze,ue/G.locationSize,_e,re,ue*Ae,ue/G.locationSize*Ze*Ae,Ye)}}else if(Q!==void 0){const re=Q[ne];if(re!==void 0)switch(re.length){case 2:n.vertexAttrib2fv(G.location,re);break;case 3:n.vertexAttrib3fv(G.location,re);break;case 4:n.vertexAttrib4fv(G.location,re);break;default:n.vertexAttrib1fv(G.location,re)}}}}A()}function U(){z();for(const V in r){const W=r[V];for(const X in W){const $=W[X];for(const K in $)u($[K].object),delete $[K];delete W[X]}delete r[V]}}function D(V){if(r[V.id]===void 0)return;const W=r[V.id];for(const X in W){const $=W[X];for(const K in $)u($[K].object),delete $[K];delete W[X]}delete r[V.id]}function L(V){for(const W in r){const X=r[W];if(X[V.id]===void 0)continue;const $=X[V.id];for(const K in $)u($[K].object),delete $[K];delete X[V.id]}}function z(){F(),o=!0,s!==i&&(s=i,l(s.object))}function F(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:z,resetDefaultState:F,dispose:U,releaseStatesOfGeometry:D,releaseStatesOfProgram:L,initAttributes:y,enableAttribute:S,disableUnusedAttributes:A}}function Sq(n,e,t){let r;function i(l){r=l}function s(l,u){n.drawArrays(r,l,u),t.update(u,r,1)}function o(l,u,h){h!==0&&(n.drawArraysInstanced(r,l,u,h),t.update(u,r,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let p=0;for(let _=0;_<h;_++)p+=u[_];t.update(p,r,1)}function c(l,u,h,d){if(h===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let _=0;_<l.length;_++)o(l[_],u[_],d[_]);else{p.multiDrawArraysInstancedWEBGL(r,l,0,u,0,d,0,h);let _=0;for(let y=0;y<h;y++)_+=u[y]*d[y];t.update(_,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Eq(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const L=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(L){return!(L!==Zu&&r.convert(L)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(L){const z=L===Ny&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(L!==Ec&&r.convert(L)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&L!==hf&&!z)}function c(L){if(L==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";L="mediump"}return L==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=t.precision!==void 0?t.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=n.getParameter(n.MAX_TEXTURE_SIZE),S=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),T=n.getParameter(n.MAX_VERTEX_ATTRIBS),A=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),R=n.getParameter(n.MAX_VARYING_VECTORS),I=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),U=_>0,D=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:_,maxTextureSize:y,maxCubemapSize:S,maxAttributes:T,maxVertexUniforms:A,maxVaryings:R,maxFragmentUniforms:I,vertexTextures:U,maxSamples:D}}function bq(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new Hh,a=new Dr,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||i;return i=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,p){const _=h.clippingPlanes,y=h.clipIntersection,S=h.clipShadows,T=n.get(h);if(!i||_===null||_.length===0||s&&!S)s?u(null):l();else{const A=s?0:r,R=A*4;let I=T.clippingState||null;c.value=I,I=u(_,d,R,p);for(let U=0;U!==R;++U)I[U]=t[U];T.clippingState=I,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=A}};function l(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,p,_){const y=h!==null?h.length:0;let S=null;if(y!==0){if(S=c.value,_!==!0||S===null){const T=p+y*4,A=d.matrixWorldInverse;a.getNormalMatrix(A),(S===null||S.length<T)&&(S=new Float32Array(T));for(let R=0,I=p;R!==y;++R,I+=4)o.copy(h[R]).applyMatrix4(A,a),o.normal.toArray(S,I),S[I+3]=o.constant}c.value=S,c.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,S}}function Tq(n){let e=new WeakMap;function t(o,a){return a===oA?o.mapping=oy:a===aA&&(o.mapping=ay),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===oA||a===aA)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new P$(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",i),t(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class Fw extends Uw{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ov=4,jP=[.125,.215,.35,.446,.526,.582],H0=20,F1=new Fw,HP=new pi;let B1=null,z1=0,V1=0,j1=!1;const B0=(1+Math.sqrt(5))/2,fv=1/B0,GP=[new qe(-B0,fv,0),new qe(B0,fv,0),new qe(-fv,0,B0),new qe(fv,0,B0),new qe(0,B0,-fv),new qe(0,B0,fv),new qe(-1,1,-1),new qe(1,1,-1),new qe(-1,1,1),new qe(1,1,1)];class WP{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){B1=this._renderer.getRenderTarget(),z1=this._renderer.getActiveCubeFace(),V1=this._renderer.getActiveMipmapLevel(),j1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=XP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=qP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(B1,z1,V1),this._renderer.xr.enabled=j1,e.scissorTest=!1,$b(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===oy||e.mapping===ay?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),B1=this._renderer.getRenderTarget(),z1=this._renderer.getActiveCubeFace(),V1=this._renderer.getActiveMipmapLevel(),j1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:kl,minFilter:kl,generateMipmaps:!1,type:Ny,format:Zu,colorSpace:Xg,depthBuffer:!1},i=$P(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$P(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=xq(s)),this._blurMaterial=wq(s,e,t)}return i}_compileMaterial(e){const t=new $h(this._lodPlanes[0],e);this._renderer.compile(t,F1)}_sceneToCubeUV(e,t,r,i){const a=new fu(90,1,t,r),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(HP),u.toneMapping=mf,u.autoClear=!1;const p=new ek({name:"PMREM.Background",side:Da,depthWrite:!1,depthTest:!1}),_=new $h(new xE,p);let y=!1;const S=e.background;S?S.isColor&&(p.color.copy(S),e.background=null,y=!0):(p.color.copy(HP),y=!0);for(let T=0;T<6;T++){const A=T%3;A===0?(a.up.set(0,c[T],0),a.lookAt(l[T],0,0)):A===1?(a.up.set(0,0,c[T]),a.lookAt(0,l[T],0)):(a.up.set(0,c[T],0),a.lookAt(0,0,l[T]));const R=this._cubeSize;$b(i,A*R,T>2?R:0,R,R),u.setRenderTarget(i),y&&u.render(_,a),u.render(e,a)}_.geometry.dispose(),_.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=S}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===oy||e.mapping===ay;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=XP()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=qP());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new $h(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;$b(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(o,F1)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=GP[(i-s-1)%GP.length];this._blur(e,s-1,s,o,a)}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new $h(this._lodPlanes[i],l),d=l.uniforms,p=this._sizeLods[r]-1,_=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*H0-1),y=s/_,S=isFinite(s)?1+Math.floor(u*y):H0;S>H0&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${S} samples when the maximum is set to ${H0}`);const T=[];let A=0;for(let L=0;L<H0;++L){const z=L/y,F=Math.exp(-z*z/2);T.push(F),L===0?A+=F:L<S&&(A+=2*F)}for(let L=0;L<T.length;L++)T[L]=T[L]/A;d.envMap.value=e.texture,d.samples.value=S,d.weights.value=T,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:R}=this;d.dTheta.value=_,d.mipInt.value=R-r;const I=this._sizeLods[i],U=3*I*(i>R-Ov?i-R+Ov:0),D=4*(this._cubeSize-I);$b(t,U,D,3*I,2*I),c.setRenderTarget(t),c.render(h,F1)}}function xq(n){const e=[],t=[],r=[];let i=n;const s=n-Ov+1+jP.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let c=1/a;o>n-Ov?c=jP[o-n+Ov-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,_=6,y=3,S=2,T=1,A=new Float32Array(y*_*p),R=new Float32Array(S*_*p),I=new Float32Array(T*_*p);for(let D=0;D<p;D++){const L=D%3*2/3-1,z=D>2?0:-1,F=[L,z,0,L+2/3,z,0,L+2/3,z+1,0,L,z,0,L+2/3,z+1,0,L,z+1,0];A.set(F,y*_*D),R.set(d,S*_*D);const V=[D,D,D,D,D,D];I.set(V,T*_*D)}const U=new sd;U.setAttribute("position",new Gs(A,y)),U.setAttribute("uv",new Gs(R,S)),U.setAttribute("faceIndex",new Gs(I,T)),e.push(U),i>Ov&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function $P(n,e,t){const r=new Tu(n,e,t);return r.texture.mapping=Nw,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function $b(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function wq(n,e,t){const r=new Float32Array(H0),i=new qe(0,1,0);return new tl({name:"SphericalGaussianBlur",defines:{n:H0,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:tk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Kh,depthTest:!1,depthWrite:!1})}function qP(){return new tl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:tk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Kh,depthTest:!1,depthWrite:!1})}function XP(){return new tl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:tk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Kh,depthTest:!1,depthWrite:!1})}function tk(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Cq(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===oA||c===aA,u=c===oy||c===ay;if(l||u){let h=e.get(a);const d=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new WP(n)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const p=a.image;return l&&p&&p.height>0||u&&p&&i(p)?(t===null&&(t=new WP(n)),h=l?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:o}}function Rq(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&gS("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Aq(n,e,t,r){const i={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const _ in d.attributes)e.remove(d.attributes[_]);for(const _ in d.morphAttributes){const y=d.morphAttributes[_];for(let S=0,T=y.length;S<T;S++)e.remove(y[S])}d.removeEventListener("dispose",o),delete i[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return i[d.id]===!0||(d.addEventListener("dispose",o),i[d.id]=!0,t.memory.geometries++),d}function c(h){const d=h.attributes;for(const _ in d)e.update(d[_],n.ARRAY_BUFFER);const p=h.morphAttributes;for(const _ in p){const y=p[_];for(let S=0,T=y.length;S<T;S++)e.update(y[S],n.ARRAY_BUFFER)}}function l(h){const d=[],p=h.index,_=h.attributes.position;let y=0;if(p!==null){const A=p.array;y=p.version;for(let R=0,I=A.length;R<I;R+=3){const U=A[R+0],D=A[R+1],L=A[R+2];d.push(U,D,D,L,L,U)}}else if(_!==void 0){const A=_.array;y=_.version;for(let R=0,I=A.length/3-1;R<I;R+=3){const U=R+0,D=R+1,L=R+2;d.push(U,D,D,L,L,U)}}else return;const S=new(oB(d)?hB:uB)(d,1);S.version=y;const T=s.get(h);T&&e.remove(T),s.set(h,S)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function Mq(n,e,t){let r;function i(d){r=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function c(d,p){n.drawElements(r,p,s,d*o),t.update(p,r,1)}function l(d,p,_){_!==0&&(n.drawElementsInstanced(r,p,s,d*o,_),t.update(p,r,_))}function u(d,p,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,p,0,s,d,0,_);let S=0;for(let T=0;T<_;T++)S+=p[T];t.update(S,r,1)}function h(d,p,_,y){if(_===0)return;const S=e.get("WEBGL_multi_draw");if(S===null)for(let T=0;T<d.length;T++)l(d[T]/o,p[T],y[T]);else{S.multiDrawElementsInstancedWEBGL(r,p,0,s,d,0,y,0,_);let T=0;for(let A=0;A<_;A++)T+=p[A]*y[A];t.update(T,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function Iq(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function kq(n,e,t){const r=new WeakMap,i=new Eo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(a);if(d===void 0||d.count!==h){let V=function(){z.dispose(),r.delete(a),a.removeEventListener("dispose",V)};var p=V;d!==void 0&&d.texture.dispose();const _=a.morphAttributes.position!==void 0,y=a.morphAttributes.normal!==void 0,S=a.morphAttributes.color!==void 0,T=a.morphAttributes.position||[],A=a.morphAttributes.normal||[],R=a.morphAttributes.color||[];let I=0;_===!0&&(I=1),y===!0&&(I=2),S===!0&&(I=3);let U=a.attributes.position.count*I,D=1;U>e.maxTextureSize&&(D=Math.ceil(U/e.maxTextureSize),U=e.maxTextureSize);const L=new Float32Array(U*D*4*h),z=new cB(L,U,D,h);z.type=hf,z.needsUpdate=!0;const F=I*4;for(let W=0;W<h;W++){const X=T[W],$=A[W],K=R[W],te=U*D*4*W;for(let Q=0;Q<X.count;Q++){const ne=Q*F;_===!0&&(i.fromBufferAttribute(X,Q),L[te+ne+0]=i.x,L[te+ne+1]=i.y,L[te+ne+2]=i.z,L[te+ne+3]=0),y===!0&&(i.fromBufferAttribute($,Q),L[te+ne+4]=i.x,L[te+ne+5]=i.y,L[te+ne+6]=i.z,L[te+ne+7]=0),S===!0&&(i.fromBufferAttribute(K,Q),L[te+ne+8]=i.x,L[te+ne+9]=i.y,L[te+ne+10]=i.z,L[te+ne+11]=K.itemSize===4?i.w:1)}}d={count:h,texture:z,size:new Ln(U,D)},r.set(a,d),a.addEventListener("dispose",V)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let _=0;for(let S=0;S<l.length;S++)_+=l[S];const y=a.morphTargetsRelative?1:1-_;c.getUniforms().setValue(n,"morphTargetBaseInfluence",y),c.getUniforms().setValue(n,"morphTargetInfluences",l)}c.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function Oq(n,e,t,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,n.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return h}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:s,dispose:o}}class nk extends so{constructor(e,t,r,i,s,o,a,c,l,u=jv){if(u!==jv&&u!==o_)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===jv&&(r=Pg),r===void 0&&u===o_&&(r=s_),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:bo,this.minFilter=c!==void 0?c:bo,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const gB=new so,KP=new nk(1,1),_B=new cB,vB=new v$,yB=new fB,YP=[],JP=[],QP=new Float32Array(16),ZP=new Float32Array(9),eD=new Float32Array(4);function Dy(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=YP[i];if(s===void 0&&(s=new Float32Array(i),YP[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function ma(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function ga(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function Bw(n,e){let t=JP[e];t===void 0&&(t=new Int32Array(e),JP[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Nq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Pq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ma(t,e))return;n.uniform2fv(this.addr,e),ga(t,e)}}function Dq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ma(t,e))return;n.uniform3fv(this.addr,e),ga(t,e)}}function Lq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ma(t,e))return;n.uniform4fv(this.addr,e),ga(t,e)}}function Uq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(ma(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ga(t,e)}else{if(ma(t,r))return;eD.set(r),n.uniformMatrix2fv(this.addr,!1,eD),ga(t,r)}}function Fq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(ma(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ga(t,e)}else{if(ma(t,r))return;ZP.set(r),n.uniformMatrix3fv(this.addr,!1,ZP),ga(t,r)}}function Bq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(ma(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ga(t,e)}else{if(ma(t,r))return;QP.set(r),n.uniformMatrix4fv(this.addr,!1,QP),ga(t,r)}}function zq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Vq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ma(t,e))return;n.uniform2iv(this.addr,e),ga(t,e)}}function jq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ma(t,e))return;n.uniform3iv(this.addr,e),ga(t,e)}}function Hq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ma(t,e))return;n.uniform4iv(this.addr,e),ga(t,e)}}function Gq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function Wq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ma(t,e))return;n.uniform2uiv(this.addr,e),ga(t,e)}}function $q(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ma(t,e))return;n.uniform3uiv(this.addr,e),ga(t,e)}}function qq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ma(t,e))return;n.uniform4uiv(this.addr,e),ga(t,e)}}function Xq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(KP.compareFunction=sB,s=KP):s=gB,t.setTexture2D(e||s,i)}function Kq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||vB,i)}function Yq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||yB,i)}function Jq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||_B,i)}function Qq(n){switch(n){case 5126:return Nq;case 35664:return Pq;case 35665:return Dq;case 35666:return Lq;case 35674:return Uq;case 35675:return Fq;case 35676:return Bq;case 5124:case 35670:return zq;case 35667:case 35671:return Vq;case 35668:case 35672:return jq;case 35669:case 35673:return Hq;case 5125:return Gq;case 36294:return Wq;case 36295:return $q;case 36296:return qq;case 35678:case 36198:case 36298:case 36306:case 35682:return Xq;case 35679:case 36299:case 36307:return Kq;case 35680:case 36300:case 36308:case 36293:return Yq;case 36289:case 36303:case 36311:case 36292:return Jq}}function Zq(n,e){n.uniform1fv(this.addr,e)}function eX(n,e){const t=Dy(e,this.size,2);n.uniform2fv(this.addr,t)}function tX(n,e){const t=Dy(e,this.size,3);n.uniform3fv(this.addr,t)}function nX(n,e){const t=Dy(e,this.size,4);n.uniform4fv(this.addr,t)}function rX(n,e){const t=Dy(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function iX(n,e){const t=Dy(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function sX(n,e){const t=Dy(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function oX(n,e){n.uniform1iv(this.addr,e)}function aX(n,e){n.uniform2iv(this.addr,e)}function cX(n,e){n.uniform3iv(this.addr,e)}function lX(n,e){n.uniform4iv(this.addr,e)}function uX(n,e){n.uniform1uiv(this.addr,e)}function hX(n,e){n.uniform2uiv(this.addr,e)}function dX(n,e){n.uniform3uiv(this.addr,e)}function fX(n,e){n.uniform4uiv(this.addr,e)}function pX(n,e,t){const r=this.cache,i=e.length,s=Bw(t,i);ma(r,s)||(n.uniform1iv(this.addr,s),ga(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||gB,s[o])}function mX(n,e,t){const r=this.cache,i=e.length,s=Bw(t,i);ma(r,s)||(n.uniform1iv(this.addr,s),ga(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||vB,s[o])}function gX(n,e,t){const r=this.cache,i=e.length,s=Bw(t,i);ma(r,s)||(n.uniform1iv(this.addr,s),ga(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||yB,s[o])}function _X(n,e,t){const r=this.cache,i=e.length,s=Bw(t,i);ma(r,s)||(n.uniform1iv(this.addr,s),ga(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||_B,s[o])}function vX(n){switch(n){case 5126:return Zq;case 35664:return eX;case 35665:return tX;case 35666:return nX;case 35674:return rX;case 35675:return iX;case 35676:return sX;case 5124:case 35670:return oX;case 35667:case 35671:return aX;case 35668:case 35672:return cX;case 35669:case 35673:return lX;case 5125:return uX;case 36294:return hX;case 36295:return dX;case 36296:return fX;case 35678:case 36198:case 36298:case 36306:case 35682:return pX;case 35679:case 36299:case 36307:return mX;case 35680:case 36300:case 36308:case 36293:return gX;case 36289:case 36303:case 36311:case 36292:return _X}}class yX{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=Qq(t.type)}}class SX{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=vX(t.type)}}class EX{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const H1=/(\w+)(\])?(\[|\.)?/g;function tD(n,e){n.seq.push(e),n.map[e.id]=e}function bX(n,e,t){const r=n.name,i=r.length;for(H1.lastIndex=0;;){const s=H1.exec(r),o=H1.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){tD(t,l===void 0?new yX(a,n,e):new SX(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new EX(a),tD(t,h)),t=h}}}class FT{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);bX(s,o,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function nD(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const TX=37297;let xX=0;function wX(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join(`
`)}const rD=new Dr;function CX(n){Si._getMatrix(rD,Si.workingColorSpace,n);const e=`mat3( ${rD.elements.map(t=>t.toFixed(4))} )`;switch(Si.getTransfer(n)){case Dw:return[e,"LinearTransferOETF"];case ji:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function iD(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+wX(n.getShaderSource(e),o)}else return i}function RX(n,e){const t=CX(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function AX(n,e){let t;switch(e){case kW:t="Linear";break;case OW:t="Reinhard";break;case NW:t="Cineon";break;case $F:t="ACESFilmic";break;case DW:t="AgX";break;case LW:t="Neutral";break;case PW:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const qb=new qe;function MX(){Si.getLuminanceCoefficients(qb);const n=qb.x.toFixed(4),e=qb.y.toFixed(4),t=qb.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function IX(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(_S).join(`
`)}function kX(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function OX(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function _S(n){return n!==""}function sD(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function oD(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const NX=/^[ \t]*#include +<([\w\d./]+)>/gm;function LA(n){return n.replace(NX,DX)}const PX=new Map;function DX(n,e){let t=Fr[e];if(t===void 0){const r=PX.get(e);if(r!==void 0)t=Fr[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return LA(t)}const LX=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function aD(n){return n.replace(LX,UX)}function UX(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function cD(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function FX(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===$I?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===OT?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Zd&&(e="SHADOWMAP_TYPE_VSM"),e}function BX(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case oy:case ay:e="ENVMAP_TYPE_CUBE";break;case Nw:e="ENVMAP_TYPE_CUBE_UV";break}return e}function zX(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ay:e="ENVMAP_MODE_REFRACTION";break}return e}function VX(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case WF:e="ENVMAP_BLENDING_MULTIPLY";break;case MW:e="ENVMAP_BLENDING_MIX";break;case IW:e="ENVMAP_BLENDING_ADD";break}return e}function jX(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function HX(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=FX(t),l=BX(t),u=zX(t),h=VX(t),d=jX(t),p=IX(t),_=kX(s),y=i.createProgram();let S,T,A=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(_S).join(`
`),S.length>0&&(S+=`
`),T=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(_S).join(`
`),T.length>0&&(T+=`
`)):(S=[cD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(_S).join(`
`),T=[cD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==mf?"#define TONE_MAPPING":"",t.toneMapping!==mf?Fr.tonemapping_pars_fragment:"",t.toneMapping!==mf?AX("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Fr.colorspace_pars_fragment,RX("linearToOutputTexel",t.outputColorSpace),MX(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(_S).join(`
`)),o=LA(o),o=sD(o,t),o=oD(o,t),a=LA(a),a=sD(a,t),a=oD(a,t),o=aD(o),a=aD(a),t.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,S=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+S,T=["#define varying in",t.glslVersion===SP?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===SP?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+T);const R=A+S+o,I=A+T+a,U=nD(i,i.VERTEX_SHADER,R),D=nD(i,i.FRAGMENT_SHADER,I);i.attachShader(y,U),i.attachShader(y,D),t.index0AttributeName!==void 0?i.bindAttribLocation(y,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y);function L(W){if(n.debug.checkShaderErrors){const X=i.getProgramInfoLog(y).trim(),$=i.getShaderInfoLog(U).trim(),K=i.getShaderInfoLog(D).trim();let te=!0,Q=!0;if(i.getProgramParameter(y,i.LINK_STATUS)===!1)if(te=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,y,U,D);else{const ne=iD(i,U,"vertex"),G=iD(i,D,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,i.VALIDATE_STATUS)+`

Material Name: `+W.name+`
Material Type: `+W.type+`

Program Info Log: `+X+`
`+ne+`
`+G)}else X!==""?console.warn("THREE.WebGLProgram: Program Info Log:",X):($===""||K==="")&&(Q=!1);Q&&(W.diagnostics={runnable:te,programLog:X,vertexShader:{log:$,prefix:S},fragmentShader:{log:K,prefix:T}})}i.deleteShader(U),i.deleteShader(D),z=new FT(i,y),F=OX(i,y)}let z;this.getUniforms=function(){return z===void 0&&L(this),z};let F;this.getAttributes=function(){return F===void 0&&L(this),F};let V=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return V===!1&&(V=i.getProgramParameter(y,TX)),V},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=xX++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=U,this.fragmentShader=D,this}let GX=0;class WX{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new $X(e),t.set(e,r)),r}}class $X{constructor(e){this.id=GX++,this.code=e,this.usedTimes=0}}function qX(n,e,t,r,i,s,o){const a=new Gv,c=new WX,l=new Set,u=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(F){return l.add(F),F===0?"uv":`uv${F}`}function S(F,V,W,X,$){const K=X.fog,te=$.geometry,Q=F.isMeshStandardMaterial?X.environment:null,ne=(F.isMeshStandardMaterial?t:e).get(F.envMap||Q),G=ne&&ne.mapping===Nw?ne.image.height:null,J=_[F.type];F.precision!==null&&(p=i.getMaxPrecision(F.precision),p!==F.precision&&console.warn("THREE.WebGLProgram.getParameters:",F.precision,"not supported, using",p,"instead."));const re=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,ue=re!==void 0?re.length:0;let ye=0;te.morphAttributes.position!==void 0&&(ye=1),te.morphAttributes.normal!==void 0&&(ye=2),te.morphAttributes.color!==void 0&&(ye=3);let Ne,_e,Ae,Ye;if(J){const ct=tf[J];Ne=ct.vertexShader,_e=ct.fragmentShader}else Ne=F.vertexShader,_e=F.fragmentShader,c.update(F),Ae=c.getVertexShaderID(F),Ye=c.getFragmentShaderID(F);const Ze=n.getRenderTarget(),Ke=n.state.buffers.depth.getReversed(),It=$.isInstancedMesh===!0,Xt=$.isBatchedMesh===!0,Qt=!!F.map,Kt=!!F.matcap,xn=!!ne,Re=!!F.aoMap,St=!!F.lightMap,Qe=!!F.bumpMap,nn=!!F.normalMap,Ot=!!F.displacementMap,rt=!!F.emissiveMap,nt=!!F.metalnessMap,pe=!!F.roughnessMap,oe=F.anisotropy>0,ke=F.clearcoat>0,Je=F.dispersion>0,ut=F.iridescence>0,ot=F.sheen>0,cn=F.transmission>0,Dt=oe&&!!F.anisotropyMap,Wt=ke&&!!F.clearcoatMap,or=ke&&!!F.clearcoatNormalMap,xt=ke&&!!F.clearcoatRoughnessMap,bt=ut&&!!F.iridescenceMap,Ft=ut&&!!F.iridescenceThicknessMap,Un=ot&&!!F.sheenColorMap,Zt=ot&&!!F.sheenRoughnessMap,Ir=!!F.specularMap,Et=!!F.specularColorMap,ii=!!F.specularIntensityMap,Me=cn&&!!F.transmissionMap,Nt=cn&&!!F.thicknessMap,et=!!F.gradientMap,ht=!!F.alphaMap,Ht=F.alphaTest>0,Lt=!!F.alphaHash,Ee=!!F.extensions;let ze=mf;F.toneMapped&&(Ze===null||Ze.isXRRenderTarget===!0)&&(ze=n.toneMapping);const st={shaderID:J,shaderType:F.type,shaderName:F.name,vertexShader:Ne,fragmentShader:_e,defines:F.defines,customVertexShaderID:Ae,customFragmentShaderID:Ye,isRawShaderMaterial:F.isRawShaderMaterial===!0,glslVersion:F.glslVersion,precision:p,batching:Xt,batchingColor:Xt&&$._colorsTexture!==null,instancing:It,instancingColor:It&&$.instanceColor!==null,instancingMorph:It&&$.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:Ze===null?n.outputColorSpace:Ze.isXRRenderTarget===!0?Ze.texture.colorSpace:Xg,alphaToCoverage:!!F.alphaToCoverage,map:Qt,matcap:Kt,envMap:xn,envMapMode:xn&&ne.mapping,envMapCubeUVHeight:G,aoMap:Re,lightMap:St,bumpMap:Qe,normalMap:nn,displacementMap:d&&Ot,emissiveMap:rt,normalMapObjectSpace:nn&&F.normalMapType===BW,normalMapTangentSpace:nn&&F.normalMapType===iB,metalnessMap:nt,roughnessMap:pe,anisotropy:oe,anisotropyMap:Dt,clearcoat:ke,clearcoatMap:Wt,clearcoatNormalMap:or,clearcoatRoughnessMap:xt,dispersion:Je,iridescence:ut,iridescenceMap:bt,iridescenceThicknessMap:Ft,sheen:ot,sheenColorMap:Un,sheenRoughnessMap:Zt,specularMap:Ir,specularColorMap:Et,specularIntensityMap:ii,transmission:cn,transmissionMap:Me,thicknessMap:Nt,gradientMap:et,opaque:F.transparent===!1&&F.blending===Vv&&F.alphaToCoverage===!1,alphaMap:ht,alphaTest:Ht,alphaHash:Lt,combine:F.combine,mapUv:Qt&&y(F.map.channel),aoMapUv:Re&&y(F.aoMap.channel),lightMapUv:St&&y(F.lightMap.channel),bumpMapUv:Qe&&y(F.bumpMap.channel),normalMapUv:nn&&y(F.normalMap.channel),displacementMapUv:Ot&&y(F.displacementMap.channel),emissiveMapUv:rt&&y(F.emissiveMap.channel),metalnessMapUv:nt&&y(F.metalnessMap.channel),roughnessMapUv:pe&&y(F.roughnessMap.channel),anisotropyMapUv:Dt&&y(F.anisotropyMap.channel),clearcoatMapUv:Wt&&y(F.clearcoatMap.channel),clearcoatNormalMapUv:or&&y(F.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:xt&&y(F.clearcoatRoughnessMap.channel),iridescenceMapUv:bt&&y(F.iridescenceMap.channel),iridescenceThicknessMapUv:Ft&&y(F.iridescenceThicknessMap.channel),sheenColorMapUv:Un&&y(F.sheenColorMap.channel),sheenRoughnessMapUv:Zt&&y(F.sheenRoughnessMap.channel),specularMapUv:Ir&&y(F.specularMap.channel),specularColorMapUv:Et&&y(F.specularColorMap.channel),specularIntensityMapUv:ii&&y(F.specularIntensityMap.channel),transmissionMapUv:Me&&y(F.transmissionMap.channel),thicknessMapUv:Nt&&y(F.thicknessMap.channel),alphaMapUv:ht&&y(F.alphaMap.channel),vertexTangents:!!te.attributes.tangent&&(nn||oe),vertexColors:F.vertexColors,vertexAlphas:F.vertexColors===!0&&!!te.attributes.color&&te.attributes.color.itemSize===4,pointsUvs:$.isPoints===!0&&!!te.attributes.uv&&(Qt||ht),fog:!!K,useFog:F.fog===!0,fogExp2:!!K&&K.isFogExp2,flatShading:F.flatShading===!0,sizeAttenuation:F.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Ke,skinning:$.isSkinnedMesh===!0,morphTargets:te.morphAttributes.position!==void 0,morphNormals:te.morphAttributes.normal!==void 0,morphColors:te.morphAttributes.color!==void 0,morphTargetsCount:ue,morphTextureStride:ye,numDirLights:V.directional.length,numPointLights:V.point.length,numSpotLights:V.spot.length,numSpotLightMaps:V.spotLightMap.length,numRectAreaLights:V.rectArea.length,numHemiLights:V.hemi.length,numDirLightShadows:V.directionalShadowMap.length,numPointLightShadows:V.pointShadowMap.length,numSpotLightShadows:V.spotShadowMap.length,numSpotLightShadowsWithMaps:V.numSpotLightShadowsWithMaps,numLightProbes:V.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:F.dithering,shadowMapEnabled:n.shadowMap.enabled&&W.length>0,shadowMapType:n.shadowMap.type,toneMapping:ze,decodeVideoTexture:Qt&&F.map.isVideoTexture===!0&&Si.getTransfer(F.map.colorSpace)===ji,decodeVideoTextureEmissive:rt&&F.emissiveMap.isVideoTexture===!0&&Si.getTransfer(F.emissiveMap.colorSpace)===ji,premultipliedAlpha:F.premultipliedAlpha,doubleSided:F.side===gu,flipSided:F.side===Da,useDepthPacking:F.depthPacking>=0,depthPacking:F.depthPacking||0,index0AttributeName:F.index0AttributeName,extensionClipCullDistance:Ee&&F.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Ee&&F.extensions.multiDraw===!0||Xt)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:F.customProgramCacheKey()};return st.vertexUv1s=l.has(1),st.vertexUv2s=l.has(2),st.vertexUv3s=l.has(3),l.clear(),st}function T(F){const V=[];if(F.shaderID?V.push(F.shaderID):(V.push(F.customVertexShaderID),V.push(F.customFragmentShaderID)),F.defines!==void 0)for(const W in F.defines)V.push(W),V.push(F.defines[W]);return F.isRawShaderMaterial===!1&&(A(V,F),R(V,F),V.push(n.outputColorSpace)),V.push(F.customProgramCacheKey),V.join()}function A(F,V){F.push(V.precision),F.push(V.outputColorSpace),F.push(V.envMapMode),F.push(V.envMapCubeUVHeight),F.push(V.mapUv),F.push(V.alphaMapUv),F.push(V.lightMapUv),F.push(V.aoMapUv),F.push(V.bumpMapUv),F.push(V.normalMapUv),F.push(V.displacementMapUv),F.push(V.emissiveMapUv),F.push(V.metalnessMapUv),F.push(V.roughnessMapUv),F.push(V.anisotropyMapUv),F.push(V.clearcoatMapUv),F.push(V.clearcoatNormalMapUv),F.push(V.clearcoatRoughnessMapUv),F.push(V.iridescenceMapUv),F.push(V.iridescenceThicknessMapUv),F.push(V.sheenColorMapUv),F.push(V.sheenRoughnessMapUv),F.push(V.specularMapUv),F.push(V.specularColorMapUv),F.push(V.specularIntensityMapUv),F.push(V.transmissionMapUv),F.push(V.thicknessMapUv),F.push(V.combine),F.push(V.fogExp2),F.push(V.sizeAttenuation),F.push(V.morphTargetsCount),F.push(V.morphAttributeCount),F.push(V.numDirLights),F.push(V.numPointLights),F.push(V.numSpotLights),F.push(V.numSpotLightMaps),F.push(V.numHemiLights),F.push(V.numRectAreaLights),F.push(V.numDirLightShadows),F.push(V.numPointLightShadows),F.push(V.numSpotLightShadows),F.push(V.numSpotLightShadowsWithMaps),F.push(V.numLightProbes),F.push(V.shadowMapType),F.push(V.toneMapping),F.push(V.numClippingPlanes),F.push(V.numClipIntersection),F.push(V.depthPacking)}function R(F,V){a.disableAll(),V.supportsVertexTextures&&a.enable(0),V.instancing&&a.enable(1),V.instancingColor&&a.enable(2),V.instancingMorph&&a.enable(3),V.matcap&&a.enable(4),V.envMap&&a.enable(5),V.normalMapObjectSpace&&a.enable(6),V.normalMapTangentSpace&&a.enable(7),V.clearcoat&&a.enable(8),V.iridescence&&a.enable(9),V.alphaTest&&a.enable(10),V.vertexColors&&a.enable(11),V.vertexAlphas&&a.enable(12),V.vertexUv1s&&a.enable(13),V.vertexUv2s&&a.enable(14),V.vertexUv3s&&a.enable(15),V.vertexTangents&&a.enable(16),V.anisotropy&&a.enable(17),V.alphaHash&&a.enable(18),V.batching&&a.enable(19),V.dispersion&&a.enable(20),V.batchingColor&&a.enable(21),F.push(a.mask),a.disableAll(),V.fog&&a.enable(0),V.useFog&&a.enable(1),V.flatShading&&a.enable(2),V.logarithmicDepthBuffer&&a.enable(3),V.reverseDepthBuffer&&a.enable(4),V.skinning&&a.enable(5),V.morphTargets&&a.enable(6),V.morphNormals&&a.enable(7),V.morphColors&&a.enable(8),V.premultipliedAlpha&&a.enable(9),V.shadowMapEnabled&&a.enable(10),V.doubleSided&&a.enable(11),V.flipSided&&a.enable(12),V.useDepthPacking&&a.enable(13),V.dithering&&a.enable(14),V.transmission&&a.enable(15),V.sheen&&a.enable(16),V.opaque&&a.enable(17),V.pointsUvs&&a.enable(18),V.decodeVideoTexture&&a.enable(19),V.decodeVideoTextureEmissive&&a.enable(20),V.alphaToCoverage&&a.enable(21),F.push(a.mask)}function I(F){const V=_[F.type];let W;if(V){const X=tf[V];W=I$.clone(X.uniforms)}else W=F.uniforms;return W}function U(F,V){let W;for(let X=0,$=u.length;X<$;X++){const K=u[X];if(K.cacheKey===V){W=K,++W.usedTimes;break}}return W===void 0&&(W=new HX(n,V,F,s),u.push(W)),W}function D(F){if(--F.usedTimes===0){const V=u.indexOf(F);u[V]=u[u.length-1],u.pop(),F.destroy()}}function L(F){c.remove(F)}function z(){c.dispose()}return{getParameters:S,getProgramCacheKey:T,getUniforms:I,acquireProgram:U,releaseProgram:D,releaseShaderCache:L,programs:u,dispose:z}}function XX(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function r(o){n.delete(o)}function i(o,a,c){n.get(o)[a]=c}function s(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:s}}function KX(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function lD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function uD(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function o(h,d,p,_,y,S){let T=n[e];return T===void 0?(T={id:h.id,object:h,geometry:d,material:p,groupOrder:_,renderOrder:h.renderOrder,z:y,group:S},n[e]=T):(T.id=h.id,T.object=h,T.geometry=d,T.material=p,T.groupOrder=_,T.renderOrder=h.renderOrder,T.z=y,T.group=S),e++,T}function a(h,d,p,_,y,S){const T=o(h,d,p,_,y,S);p.transmission>0?r.push(T):p.transparent===!0?i.push(T):t.push(T)}function c(h,d,p,_,y,S){const T=o(h,d,p,_,y,S);p.transmission>0?r.unshift(T):p.transparent===!0?i.unshift(T):t.unshift(T)}function l(h,d){t.length>1&&t.sort(h||KX),r.length>1&&r.sort(d||lD),i.length>1&&i.sort(d||lD)}function u(){for(let h=e,d=n.length;h<d;h++){const p=n[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function YX(){let n=new WeakMap;function e(r,i){const s=n.get(r);let o;return s===void 0?(o=new uD,n.set(r,[o])):i>=s.length?(o=new uD,s.push(o)):o=s[i],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function JX(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new qe,color:new pi};break;case"SpotLight":t={position:new qe,direction:new qe,color:new pi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new qe,color:new pi,distance:0,decay:0};break;case"HemisphereLight":t={direction:new qe,skyColor:new pi,groundColor:new pi};break;case"RectAreaLight":t={color:new pi,position:new qe,halfWidth:new qe,halfHeight:new qe};break}return n[e.id]=t,t}}}function QX(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ln,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let ZX=0;function eK(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function tK(n){const e=new JX,t=QX(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new qe);const i=new qe,s=new oo,o=new oo;function a(l){let u=0,h=0,d=0;for(let F=0;F<9;F++)r.probe[F].set(0,0,0);let p=0,_=0,y=0,S=0,T=0,A=0,R=0,I=0,U=0,D=0,L=0;l.sort(eK);for(let F=0,V=l.length;F<V;F++){const W=l[F],X=W.color,$=W.intensity,K=W.distance,te=W.shadow&&W.shadow.map?W.shadow.map.texture:null;if(W.isAmbientLight)u+=X.r*$,h+=X.g*$,d+=X.b*$;else if(W.isLightProbe){for(let Q=0;Q<9;Q++)r.probe[Q].addScaledVector(W.sh.coefficients[Q],$);L++}else if(W.isDirectionalLight){const Q=e.get(W);if(Q.color.copy(W.color).multiplyScalar(W.intensity),W.castShadow){const ne=W.shadow,G=t.get(W);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,r.directionalShadow[p]=G,r.directionalShadowMap[p]=te,r.directionalShadowMatrix[p]=W.shadow.matrix,A++}r.directional[p]=Q,p++}else if(W.isSpotLight){const Q=e.get(W);Q.position.setFromMatrixPosition(W.matrixWorld),Q.color.copy(X).multiplyScalar($),Q.distance=K,Q.coneCos=Math.cos(W.angle),Q.penumbraCos=Math.cos(W.angle*(1-W.penumbra)),Q.decay=W.decay,r.spot[y]=Q;const ne=W.shadow;if(W.map&&(r.spotLightMap[U]=W.map,U++,ne.updateMatrices(W),W.castShadow&&D++),r.spotLightMatrix[y]=ne.matrix,W.castShadow){const G=t.get(W);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,r.spotShadow[y]=G,r.spotShadowMap[y]=te,I++}y++}else if(W.isRectAreaLight){const Q=e.get(W);Q.color.copy(X).multiplyScalar($),Q.halfWidth.set(W.width*.5,0,0),Q.halfHeight.set(0,W.height*.5,0),r.rectArea[S]=Q,S++}else if(W.isPointLight){const Q=e.get(W);if(Q.color.copy(W.color).multiplyScalar(W.intensity),Q.distance=W.distance,Q.decay=W.decay,W.castShadow){const ne=W.shadow,G=t.get(W);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,G.shadowCameraNear=ne.camera.near,G.shadowCameraFar=ne.camera.far,r.pointShadow[_]=G,r.pointShadowMap[_]=te,r.pointShadowMatrix[_]=W.shadow.matrix,R++}r.point[_]=Q,_++}else if(W.isHemisphereLight){const Q=e.get(W);Q.skyColor.copy(W.color).multiplyScalar($),Q.groundColor.copy(W.groundColor).multiplyScalar($),r.hemi[T]=Q,T++}}S>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Yt.LTC_FLOAT_1,r.rectAreaLTC2=Yt.LTC_FLOAT_2):(r.rectAreaLTC1=Yt.LTC_HALF_1,r.rectAreaLTC2=Yt.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const z=r.hash;(z.directionalLength!==p||z.pointLength!==_||z.spotLength!==y||z.rectAreaLength!==S||z.hemiLength!==T||z.numDirectionalShadows!==A||z.numPointShadows!==R||z.numSpotShadows!==I||z.numSpotMaps!==U||z.numLightProbes!==L)&&(r.directional.length=p,r.spot.length=y,r.rectArea.length=S,r.point.length=_,r.hemi.length=T,r.directionalShadow.length=A,r.directionalShadowMap.length=A,r.pointShadow.length=R,r.pointShadowMap.length=R,r.spotShadow.length=I,r.spotShadowMap.length=I,r.directionalShadowMatrix.length=A,r.pointShadowMatrix.length=R,r.spotLightMatrix.length=I+U-D,r.spotLightMap.length=U,r.numSpotLightShadowsWithMaps=D,r.numLightProbes=L,z.directionalLength=p,z.pointLength=_,z.spotLength=y,z.rectAreaLength=S,z.hemiLength=T,z.numDirectionalShadows=A,z.numPointShadows=R,z.numSpotShadows=I,z.numSpotMaps=U,z.numLightProbes=L,r.version=ZX++)}function c(l,u){let h=0,d=0,p=0,_=0,y=0;const S=u.matrixWorldInverse;for(let T=0,A=l.length;T<A;T++){const R=l[T];if(R.isDirectionalLight){const I=r.directional[h];I.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(S),h++}else if(R.isSpotLight){const I=r.spot[p];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),I.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(S),p++}else if(R.isRectAreaLight){const I=r.rectArea[_];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),o.identity(),s.copy(R.matrixWorld),s.premultiply(S),o.extractRotation(s),I.halfWidth.set(R.width*.5,0,0),I.halfHeight.set(0,R.height*.5,0),I.halfWidth.applyMatrix4(o),I.halfHeight.applyMatrix4(o),_++}else if(R.isPointLight){const I=r.point[d];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),d++}else if(R.isHemisphereLight){const I=r.hemi[y];I.direction.setFromMatrixPosition(R.matrixWorld),I.direction.transformDirection(S),y++}}}return{setup:a,setupView:c,state:r}}function hD(n){const e=new tK(n),t=[],r=[];function i(u){l.camera=u,t.length=0,r.length=0}function s(u){t.push(u)}function o(u){r.push(u)}function a(){e.setup(t)}function c(u){e.setupView(t,u)}const l={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function nK(n){let e=new WeakMap;function t(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new hD(n),e.set(i,[a])):s>=o.length?(a=new hD(n),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:t,dispose:r}}class rK extends mm{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=E_,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iK extends mm{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const sK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,oK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function aK(n,e,t){let r=new pB;const i=new Ln,s=new Ln,o=new Eo,a=new rK({depthPacking:FW}),c=new iK,l={},u=t.maxTextureSize,h={[am]:Da,[Da]:am,[gu]:gu},d=new tl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ln},radius:{value:4}},vertexShader:sK,fragmentShader:oK}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const _=new sd;_.setAttribute("position",new Gs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new $h(_,d),S=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=$I;let T=this.type;this.render=function(D,L,z){if(S.enabled===!1||S.autoUpdate===!1&&S.needsUpdate===!1||D.length===0)return;const F=n.getRenderTarget(),V=n.getActiveCubeFace(),W=n.getActiveMipmapLevel(),X=n.state;X.setBlending(Kh),X.buffers.color.setClear(1,1,1,1),X.buffers.depth.setTest(!0),X.setScissorTest(!1);const $=T!==Zd&&this.type===Zd,K=T===Zd&&this.type!==Zd;for(let te=0,Q=D.length;te<Q;te++){const ne=D[te],G=ne.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",ne,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;i.copy(G.mapSize);const J=G.getFrameExtents();if(i.multiply(J),s.copy(G.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/J.x),i.x=s.x*J.x,G.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/J.y),i.y=s.y*J.y,G.mapSize.y=s.y)),G.map===null||$===!0||K===!0){const ue=this.type!==Zd?{minFilter:bo,magFilter:bo}:{};G.map!==null&&G.map.dispose(),G.map=new Tu(i.x,i.y,ue),G.map.texture.name=ne.name+".shadowMap",G.camera.updateProjectionMatrix()}n.setRenderTarget(G.map),n.clear();const re=G.getViewportCount();for(let ue=0;ue<re;ue++){const ye=G.getViewport(ue);o.set(s.x*ye.x,s.y*ye.y,s.x*ye.z,s.y*ye.w),X.viewport(o),G.updateMatrices(ne,ue),r=G.getFrustum(),I(L,z,G.camera,ne,this.type)}G.isPointLightShadow!==!0&&this.type===Zd&&A(G,z),G.needsUpdate=!1}T=this.type,S.needsUpdate=!1,n.setRenderTarget(F,V,W)};function A(D,L){const z=e.update(y);d.defines.VSM_SAMPLES!==D.blurSamples&&(d.defines.VSM_SAMPLES=D.blurSamples,p.defines.VSM_SAMPLES=D.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),D.mapPass===null&&(D.mapPass=new Tu(i.x,i.y)),d.uniforms.shadow_pass.value=D.map.texture,d.uniforms.resolution.value=D.mapSize,d.uniforms.radius.value=D.radius,n.setRenderTarget(D.mapPass),n.clear(),n.renderBufferDirect(L,null,z,d,y,null),p.uniforms.shadow_pass.value=D.mapPass.texture,p.uniforms.resolution.value=D.mapSize,p.uniforms.radius.value=D.radius,n.setRenderTarget(D.map),n.clear(),n.renderBufferDirect(L,null,z,p,y,null)}function R(D,L,z,F){let V=null;const W=z.isPointLight===!0?D.customDistanceMaterial:D.customDepthMaterial;if(W!==void 0)V=W;else if(V=z.isPointLight===!0?c:a,n.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const X=V.uuid,$=L.uuid;let K=l[X];K===void 0&&(K={},l[X]=K);let te=K[$];te===void 0&&(te=V.clone(),K[$]=te,L.addEventListener("dispose",U)),V=te}if(V.visible=L.visible,V.wireframe=L.wireframe,F===Zd?V.side=L.shadowSide!==null?L.shadowSide:L.side:V.side=L.shadowSide!==null?L.shadowSide:h[L.side],V.alphaMap=L.alphaMap,V.alphaTest=L.alphaTest,V.map=L.map,V.clipShadows=L.clipShadows,V.clippingPlanes=L.clippingPlanes,V.clipIntersection=L.clipIntersection,V.displacementMap=L.displacementMap,V.displacementScale=L.displacementScale,V.displacementBias=L.displacementBias,V.wireframeLinewidth=L.wireframeLinewidth,V.linewidth=L.linewidth,z.isPointLight===!0&&V.isMeshDistanceMaterial===!0){const X=n.properties.get(V);X.light=z}return V}function I(D,L,z,F,V){if(D.visible===!1)return;if(D.layers.test(L.layers)&&(D.isMesh||D.isLine||D.isPoints)&&(D.castShadow||D.receiveShadow&&V===Zd)&&(!D.frustumCulled||r.intersectsObject(D))){D.modelViewMatrix.multiplyMatrices(z.matrixWorldInverse,D.matrixWorld);const $=e.update(D),K=D.material;if(Array.isArray(K)){const te=$.groups;for(let Q=0,ne=te.length;Q<ne;Q++){const G=te[Q],J=K[G.materialIndex];if(J&&J.visible){const re=R(D,J,F,V);D.onBeforeShadow(n,D,L,z,$,re,G),n.renderBufferDirect(z,null,$,re,D,G),D.onAfterShadow(n,D,L,z,$,re,G)}}}else if(K.visible){const te=R(D,K,F,V);D.onBeforeShadow(n,D,L,z,$,te,null),n.renderBufferDirect(z,null,$,te,D,null),D.onAfterShadow(n,D,L,z,$,te,null)}}const X=D.children;for(let $=0,K=X.length;$<K;$++)I(X[$],L,z,F,V)}function U(D){D.target.removeEventListener("dispose",U);for(const z in l){const F=l[z],V=D.target.uuid;V in F&&(F[V].dispose(),delete F[V])}}}const cK={[ZR]:eA,[tA]:iA,[nA]:sA,[sy]:rA,[eA]:ZR,[iA]:tA,[sA]:nA,[rA]:sy};function lK(n,e){function t(){let Me=!1;const Nt=new Eo;let et=null;const ht=new Eo(0,0,0,0);return{setMask:function(Ht){et!==Ht&&!Me&&(n.colorMask(Ht,Ht,Ht,Ht),et=Ht)},setLocked:function(Ht){Me=Ht},setClear:function(Ht,Lt,Ee,ze,st){st===!0&&(Ht*=ze,Lt*=ze,Ee*=ze),Nt.set(Ht,Lt,Ee,ze),ht.equals(Nt)===!1&&(n.clearColor(Ht,Lt,Ee,ze),ht.copy(Nt))},reset:function(){Me=!1,et=null,ht.set(-1,0,0,0)}}}function r(){let Me=!1,Nt=!1,et=null,ht=null,Ht=null;return{setReversed:function(Lt){if(Nt!==Lt){const Ee=e.get("EXT_clip_control");Nt?Ee.clipControlEXT(Ee.LOWER_LEFT_EXT,Ee.ZERO_TO_ONE_EXT):Ee.clipControlEXT(Ee.LOWER_LEFT_EXT,Ee.NEGATIVE_ONE_TO_ONE_EXT);const ze=Ht;Ht=null,this.setClear(ze)}Nt=Lt},getReversed:function(){return Nt},setTest:function(Lt){Lt?Ze(n.DEPTH_TEST):Ke(n.DEPTH_TEST)},setMask:function(Lt){et!==Lt&&!Me&&(n.depthMask(Lt),et=Lt)},setFunc:function(Lt){if(Nt&&(Lt=cK[Lt]),ht!==Lt){switch(Lt){case ZR:n.depthFunc(n.NEVER);break;case eA:n.depthFunc(n.ALWAYS);break;case tA:n.depthFunc(n.LESS);break;case sy:n.depthFunc(n.LEQUAL);break;case nA:n.depthFunc(n.EQUAL);break;case rA:n.depthFunc(n.GEQUAL);break;case iA:n.depthFunc(n.GREATER);break;case sA:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ht=Lt}},setLocked:function(Lt){Me=Lt},setClear:function(Lt){Ht!==Lt&&(Nt&&(Lt=1-Lt),n.clearDepth(Lt),Ht=Lt)},reset:function(){Me=!1,et=null,ht=null,Ht=null,Nt=!1}}}function i(){let Me=!1,Nt=null,et=null,ht=null,Ht=null,Lt=null,Ee=null,ze=null,st=null;return{setTest:function(ct){Me||(ct?Ze(n.STENCIL_TEST):Ke(n.STENCIL_TEST))},setMask:function(ct){Nt!==ct&&!Me&&(n.stencilMask(ct),Nt=ct)},setFunc:function(ct,Rn,Br){(et!==ct||ht!==Rn||Ht!==Br)&&(n.stencilFunc(ct,Rn,Br),et=ct,ht=Rn,Ht=Br)},setOp:function(ct,Rn,Br){(Lt!==ct||Ee!==Rn||ze!==Br)&&(n.stencilOp(ct,Rn,Br),Lt=ct,Ee=Rn,ze=Br)},setLocked:function(ct){Me=ct},setClear:function(ct){st!==ct&&(n.clearStencil(ct),st=ct)},reset:function(){Me=!1,Nt=null,et=null,ht=null,Ht=null,Lt=null,Ee=null,ze=null,st=null}}}const s=new t,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},h={},d=new WeakMap,p=[],_=null,y=!1,S=null,T=null,A=null,R=null,I=null,U=null,D=null,L=new pi(0,0,0),z=0,F=!1,V=null,W=null,X=null,$=null,K=null;const te=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Q=!1,ne=0;const G=n.getParameter(n.VERSION);G.indexOf("WebGL")!==-1?(ne=parseFloat(/^WebGL (\d)/.exec(G)[1]),Q=ne>=1):G.indexOf("OpenGL ES")!==-1&&(ne=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),Q=ne>=2);let J=null,re={};const ue=n.getParameter(n.SCISSOR_BOX),ye=n.getParameter(n.VIEWPORT),Ne=new Eo().fromArray(ue),_e=new Eo().fromArray(ye);function Ae(Me,Nt,et,ht){const Ht=new Uint8Array(4),Lt=n.createTexture();n.bindTexture(Me,Lt),n.texParameteri(Me,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Me,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Ee=0;Ee<et;Ee++)Me===n.TEXTURE_3D||Me===n.TEXTURE_2D_ARRAY?n.texImage3D(Nt,0,n.RGBA,1,1,ht,0,n.RGBA,n.UNSIGNED_BYTE,Ht):n.texImage2D(Nt+Ee,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Ht);return Lt}const Ye={};Ye[n.TEXTURE_2D]=Ae(n.TEXTURE_2D,n.TEXTURE_2D,1),Ye[n.TEXTURE_CUBE_MAP]=Ae(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ye[n.TEXTURE_2D_ARRAY]=Ae(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ye[n.TEXTURE_3D]=Ae(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Ze(n.DEPTH_TEST),o.setFunc(sy),Qe(!1),nn(pP),Ze(n.CULL_FACE),Re(Kh);function Ze(Me){u[Me]!==!0&&(n.enable(Me),u[Me]=!0)}function Ke(Me){u[Me]!==!1&&(n.disable(Me),u[Me]=!1)}function It(Me,Nt){return h[Me]!==Nt?(n.bindFramebuffer(Me,Nt),h[Me]=Nt,Me===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Nt),Me===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Nt),!0):!1}function Xt(Me,Nt){let et=p,ht=!1;if(Me){et=d.get(Nt),et===void 0&&(et=[],d.set(Nt,et));const Ht=Me.textures;if(et.length!==Ht.length||et[0]!==n.COLOR_ATTACHMENT0){for(let Lt=0,Ee=Ht.length;Lt<Ee;Lt++)et[Lt]=n.COLOR_ATTACHMENT0+Lt;et.length=Ht.length,ht=!0}}else et[0]!==n.BACK&&(et[0]=n.BACK,ht=!0);ht&&n.drawBuffers(et)}function Qt(Me){return _!==Me?(n.useProgram(Me),_=Me,!0):!1}const Kt={[j0]:n.FUNC_ADD,[dW]:n.FUNC_SUBTRACT,[fW]:n.FUNC_REVERSE_SUBTRACT};Kt[pW]=n.MIN,Kt[mW]=n.MAX;const xn={[gW]:n.ZERO,[_W]:n.ONE,[vW]:n.SRC_COLOR,[JR]:n.SRC_ALPHA,[xW]:n.SRC_ALPHA_SATURATE,[bW]:n.DST_COLOR,[SW]:n.DST_ALPHA,[yW]:n.ONE_MINUS_SRC_COLOR,[QR]:n.ONE_MINUS_SRC_ALPHA,[TW]:n.ONE_MINUS_DST_COLOR,[EW]:n.ONE_MINUS_DST_ALPHA,[wW]:n.CONSTANT_COLOR,[CW]:n.ONE_MINUS_CONSTANT_COLOR,[RW]:n.CONSTANT_ALPHA,[AW]:n.ONE_MINUS_CONSTANT_ALPHA};function Re(Me,Nt,et,ht,Ht,Lt,Ee,ze,st,ct){if(Me===Kh){y===!0&&(Ke(n.BLEND),y=!1);return}if(y===!1&&(Ze(n.BLEND),y=!0),Me!==hW){if(Me!==S||ct!==F){if((T!==j0||I!==j0)&&(n.blendEquation(n.FUNC_ADD),T=j0,I=j0),ct)switch(Me){case Vv:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case mP:n.blendFunc(n.ONE,n.ONE);break;case gP:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case _P:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}else switch(Me){case Vv:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case mP:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case gP:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case _P:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Me);break}A=null,R=null,U=null,D=null,L.set(0,0,0),z=0,S=Me,F=ct}return}Ht=Ht||Nt,Lt=Lt||et,Ee=Ee||ht,(Nt!==T||Ht!==I)&&(n.blendEquationSeparate(Kt[Nt],Kt[Ht]),T=Nt,I=Ht),(et!==A||ht!==R||Lt!==U||Ee!==D)&&(n.blendFuncSeparate(xn[et],xn[ht],xn[Lt],xn[Ee]),A=et,R=ht,U=Lt,D=Ee),(ze.equals(L)===!1||st!==z)&&(n.blendColor(ze.r,ze.g,ze.b,st),L.copy(ze),z=st),S=Me,F=!1}function St(Me,Nt){Me.side===gu?Ke(n.CULL_FACE):Ze(n.CULL_FACE);let et=Me.side===Da;Nt&&(et=!et),Qe(et),Me.blending===Vv&&Me.transparent===!1?Re(Kh):Re(Me.blending,Me.blendEquation,Me.blendSrc,Me.blendDst,Me.blendEquationAlpha,Me.blendSrcAlpha,Me.blendDstAlpha,Me.blendColor,Me.blendAlpha,Me.premultipliedAlpha),o.setFunc(Me.depthFunc),o.setTest(Me.depthTest),o.setMask(Me.depthWrite),s.setMask(Me.colorWrite);const ht=Me.stencilWrite;a.setTest(ht),ht&&(a.setMask(Me.stencilWriteMask),a.setFunc(Me.stencilFunc,Me.stencilRef,Me.stencilFuncMask),a.setOp(Me.stencilFail,Me.stencilZFail,Me.stencilZPass)),rt(Me.polygonOffset,Me.polygonOffsetFactor,Me.polygonOffsetUnits),Me.alphaToCoverage===!0?Ze(n.SAMPLE_ALPHA_TO_COVERAGE):Ke(n.SAMPLE_ALPHA_TO_COVERAGE)}function Qe(Me){V!==Me&&(Me?n.frontFace(n.CW):n.frontFace(n.CCW),V=Me)}function nn(Me){Me!==cW?(Ze(n.CULL_FACE),Me!==W&&(Me===pP?n.cullFace(n.BACK):Me===lW?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ke(n.CULL_FACE),W=Me}function Ot(Me){Me!==X&&(Q&&n.lineWidth(Me),X=Me)}function rt(Me,Nt,et){Me?(Ze(n.POLYGON_OFFSET_FILL),($!==Nt||K!==et)&&(n.polygonOffset(Nt,et),$=Nt,K=et)):Ke(n.POLYGON_OFFSET_FILL)}function nt(Me){Me?Ze(n.SCISSOR_TEST):Ke(n.SCISSOR_TEST)}function pe(Me){Me===void 0&&(Me=n.TEXTURE0+te-1),J!==Me&&(n.activeTexture(Me),J=Me)}function oe(Me,Nt,et){et===void 0&&(J===null?et=n.TEXTURE0+te-1:et=J);let ht=re[et];ht===void 0&&(ht={type:void 0,texture:void 0},re[et]=ht),(ht.type!==Me||ht.texture!==Nt)&&(J!==et&&(n.activeTexture(et),J=et),n.bindTexture(Me,Nt||Ye[Me]),ht.type=Me,ht.texture=Nt)}function ke(){const Me=re[J];Me!==void 0&&Me.type!==void 0&&(n.bindTexture(Me.type,null),Me.type=void 0,Me.texture=void 0)}function Je(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ut(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function ot(){try{n.texSubImage2D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function cn(){try{n.texSubImage3D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Dt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Wt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function or(){try{n.texStorage2D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function xt(){try{n.texStorage3D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function bt(){try{n.texImage2D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Ft(){try{n.texImage3D.apply(n,arguments)}catch(Me){console.error("THREE.WebGLState:",Me)}}function Un(Me){Ne.equals(Me)===!1&&(n.scissor(Me.x,Me.y,Me.z,Me.w),Ne.copy(Me))}function Zt(Me){_e.equals(Me)===!1&&(n.viewport(Me.x,Me.y,Me.z,Me.w),_e.copy(Me))}function Ir(Me,Nt){let et=l.get(Nt);et===void 0&&(et=new WeakMap,l.set(Nt,et));let ht=et.get(Me);ht===void 0&&(ht=n.getUniformBlockIndex(Nt,Me.name),et.set(Me,ht))}function Et(Me,Nt){const ht=l.get(Nt).get(Me);c.get(Nt)!==ht&&(n.uniformBlockBinding(Nt,ht,Me.__bindingPointIndex),c.set(Nt,ht))}function ii(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},J=null,re={},h={},d=new WeakMap,p=[],_=null,y=!1,S=null,T=null,A=null,R=null,I=null,U=null,D=null,L=new pi(0,0,0),z=0,F=!1,V=null,W=null,X=null,$=null,K=null,Ne.set(0,0,n.canvas.width,n.canvas.height),_e.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Ze,disable:Ke,bindFramebuffer:It,drawBuffers:Xt,useProgram:Qt,setBlending:Re,setMaterial:St,setFlipSided:Qe,setCullFace:nn,setLineWidth:Ot,setPolygonOffset:rt,setScissorTest:nt,activeTexture:pe,bindTexture:oe,unbindTexture:ke,compressedTexImage2D:Je,compressedTexImage3D:ut,texImage2D:bt,texImage3D:Ft,updateUBOMapping:Ir,uniformBlockBinding:Et,texStorage2D:or,texStorage3D:xt,texSubImage2D:ot,texSubImage3D:cn,compressedTexSubImage2D:Dt,compressedTexSubImage3D:Wt,scissor:Un,viewport:Zt,reset:ii}}function dD(n,e,t,r){const i=uK(r);switch(t){case JF:return n*e;case ZF:return n*e;case eB:return n*e*2;case tB:return n*e/i.components*i.byteLength;case YI:return n*e/i.components*i.byteLength;case nB:return n*e*2/i.components*i.byteLength;case JI:return n*e*2/i.components*i.byteLength;case QF:return n*e*3/i.components*i.byteLength;case Zu:return n*e*4/i.components*i.byteLength;case Pw:return n*e*4/i.components*i.byteLength;case NT:case PT:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case DT:case LT:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case hA:case fA:return Math.max(n,16)*Math.max(e,8)/4;case uA:case dA:return Math.max(n,8)*Math.max(e,8)/2;case pA:case mA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case gA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case _A:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case vA:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case yA:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case SA:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case EA:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case bA:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case TA:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case xA:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case wA:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case CA:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case RA:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case AA:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case MA:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case IA:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case UT:case kA:case OA:return Math.ceil(n/4)*Math.ceil(e/4)*16;case rB:case NA:return Math.ceil(n/4)*Math.ceil(e/4)*8;case PA:case DA:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function uK(n){switch(n){case Ec:case XF:return{byteLength:1,components:1};case VS:case KF:case Ny:return{byteLength:2,components:1};case XI:case KI:return{byteLength:2,components:4};case Pg:case qI:case hf:return{byteLength:4,components:1};case YF:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function hK(n,e,t,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Ln,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(pe,oe){return p?new OffscreenCanvas(pe,oe):HS("canvas")}function y(pe,oe,ke){let Je=1;const ut=nt(pe);if((ut.width>ke||ut.height>ke)&&(Je=ke/Math.max(ut.width,ut.height)),Je<1)if(typeof HTMLImageElement<"u"&&pe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&pe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&pe instanceof ImageBitmap||typeof VideoFrame<"u"&&pe instanceof VideoFrame){const ot=Math.floor(Je*ut.width),cn=Math.floor(Je*ut.height);h===void 0&&(h=_(ot,cn));const Dt=oe?_(ot,cn):h;return Dt.width=ot,Dt.height=cn,Dt.getContext("2d").drawImage(pe,0,0,ot,cn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ut.width+"x"+ut.height+") to ("+ot+"x"+cn+")."),Dt}else return"data"in pe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ut.width+"x"+ut.height+")."),pe;return pe}function S(pe){return pe.generateMipmaps}function T(pe){n.generateMipmap(pe)}function A(pe){return pe.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:pe.isWebGL3DRenderTarget?n.TEXTURE_3D:pe.isWebGLArrayRenderTarget||pe.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function R(pe,oe,ke,Je,ut=!1){if(pe!==null){if(n[pe]!==void 0)return n[pe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+pe+"'")}let ot=oe;if(oe===n.RED&&(ke===n.FLOAT&&(ot=n.R32F),ke===n.HALF_FLOAT&&(ot=n.R16F),ke===n.UNSIGNED_BYTE&&(ot=n.R8)),oe===n.RED_INTEGER&&(ke===n.UNSIGNED_BYTE&&(ot=n.R8UI),ke===n.UNSIGNED_SHORT&&(ot=n.R16UI),ke===n.UNSIGNED_INT&&(ot=n.R32UI),ke===n.BYTE&&(ot=n.R8I),ke===n.SHORT&&(ot=n.R16I),ke===n.INT&&(ot=n.R32I)),oe===n.RG&&(ke===n.FLOAT&&(ot=n.RG32F),ke===n.HALF_FLOAT&&(ot=n.RG16F),ke===n.UNSIGNED_BYTE&&(ot=n.RG8)),oe===n.RG_INTEGER&&(ke===n.UNSIGNED_BYTE&&(ot=n.RG8UI),ke===n.UNSIGNED_SHORT&&(ot=n.RG16UI),ke===n.UNSIGNED_INT&&(ot=n.RG32UI),ke===n.BYTE&&(ot=n.RG8I),ke===n.SHORT&&(ot=n.RG16I),ke===n.INT&&(ot=n.RG32I)),oe===n.RGB_INTEGER&&(ke===n.UNSIGNED_BYTE&&(ot=n.RGB8UI),ke===n.UNSIGNED_SHORT&&(ot=n.RGB16UI),ke===n.UNSIGNED_INT&&(ot=n.RGB32UI),ke===n.BYTE&&(ot=n.RGB8I),ke===n.SHORT&&(ot=n.RGB16I),ke===n.INT&&(ot=n.RGB32I)),oe===n.RGBA_INTEGER&&(ke===n.UNSIGNED_BYTE&&(ot=n.RGBA8UI),ke===n.UNSIGNED_SHORT&&(ot=n.RGBA16UI),ke===n.UNSIGNED_INT&&(ot=n.RGBA32UI),ke===n.BYTE&&(ot=n.RGBA8I),ke===n.SHORT&&(ot=n.RGBA16I),ke===n.INT&&(ot=n.RGBA32I)),oe===n.RGB&&ke===n.UNSIGNED_INT_5_9_9_9_REV&&(ot=n.RGB9_E5),oe===n.RGBA){const cn=ut?Dw:Si.getTransfer(Je);ke===n.FLOAT&&(ot=n.RGBA32F),ke===n.HALF_FLOAT&&(ot=n.RGBA16F),ke===n.UNSIGNED_BYTE&&(ot=cn===ji?n.SRGB8_ALPHA8:n.RGBA8),ke===n.UNSIGNED_SHORT_4_4_4_4&&(ot=n.RGBA4),ke===n.UNSIGNED_SHORT_5_5_5_1&&(ot=n.RGB5_A1)}return(ot===n.R16F||ot===n.R32F||ot===n.RG16F||ot===n.RG32F||ot===n.RGBA16F||ot===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ot}function I(pe,oe){let ke;return pe?oe===null||oe===Pg||oe===s_?ke=n.DEPTH24_STENCIL8:oe===hf?ke=n.DEPTH32F_STENCIL8:oe===VS&&(ke=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):oe===null||oe===Pg||oe===s_?ke=n.DEPTH_COMPONENT24:oe===hf?ke=n.DEPTH_COMPONENT32F:oe===VS&&(ke=n.DEPTH_COMPONENT16),ke}function U(pe,oe){return S(pe)===!0||pe.isFramebufferTexture&&pe.minFilter!==bo&&pe.minFilter!==kl?Math.log2(Math.max(oe.width,oe.height))+1:pe.mipmaps!==void 0&&pe.mipmaps.length>0?pe.mipmaps.length:pe.isCompressedTexture&&Array.isArray(pe.image)?oe.mipmaps.length:1}function D(pe){const oe=pe.target;oe.removeEventListener("dispose",D),z(oe),oe.isVideoTexture&&u.delete(oe)}function L(pe){const oe=pe.target;oe.removeEventListener("dispose",L),V(oe)}function z(pe){const oe=r.get(pe);if(oe.__webglInit===void 0)return;const ke=pe.source,Je=d.get(ke);if(Je){const ut=Je[oe.__cacheKey];ut.usedTimes--,ut.usedTimes===0&&F(pe),Object.keys(Je).length===0&&d.delete(ke)}r.remove(pe)}function F(pe){const oe=r.get(pe);n.deleteTexture(oe.__webglTexture);const ke=pe.source,Je=d.get(ke);delete Je[oe.__cacheKey],o.memory.textures--}function V(pe){const oe=r.get(pe);if(pe.depthTexture&&(pe.depthTexture.dispose(),r.remove(pe.depthTexture)),pe.isWebGLCubeRenderTarget)for(let Je=0;Je<6;Je++){if(Array.isArray(oe.__webglFramebuffer[Je]))for(let ut=0;ut<oe.__webglFramebuffer[Je].length;ut++)n.deleteFramebuffer(oe.__webglFramebuffer[Je][ut]);else n.deleteFramebuffer(oe.__webglFramebuffer[Je]);oe.__webglDepthbuffer&&n.deleteRenderbuffer(oe.__webglDepthbuffer[Je])}else{if(Array.isArray(oe.__webglFramebuffer))for(let Je=0;Je<oe.__webglFramebuffer.length;Je++)n.deleteFramebuffer(oe.__webglFramebuffer[Je]);else n.deleteFramebuffer(oe.__webglFramebuffer);if(oe.__webglDepthbuffer&&n.deleteRenderbuffer(oe.__webglDepthbuffer),oe.__webglMultisampledFramebuffer&&n.deleteFramebuffer(oe.__webglMultisampledFramebuffer),oe.__webglColorRenderbuffer)for(let Je=0;Je<oe.__webglColorRenderbuffer.length;Je++)oe.__webglColorRenderbuffer[Je]&&n.deleteRenderbuffer(oe.__webglColorRenderbuffer[Je]);oe.__webglDepthRenderbuffer&&n.deleteRenderbuffer(oe.__webglDepthRenderbuffer)}const ke=pe.textures;for(let Je=0,ut=ke.length;Je<ut;Je++){const ot=r.get(ke[Je]);ot.__webglTexture&&(n.deleteTexture(ot.__webglTexture),o.memory.textures--),r.remove(ke[Je])}r.remove(pe)}let W=0;function X(){W=0}function $(){const pe=W;return pe>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+pe+" texture units while this GPU supports only "+i.maxTextures),W+=1,pe}function K(pe){const oe=[];return oe.push(pe.wrapS),oe.push(pe.wrapT),oe.push(pe.wrapR||0),oe.push(pe.magFilter),oe.push(pe.minFilter),oe.push(pe.anisotropy),oe.push(pe.internalFormat),oe.push(pe.format),oe.push(pe.type),oe.push(pe.generateMipmaps),oe.push(pe.premultiplyAlpha),oe.push(pe.flipY),oe.push(pe.unpackAlignment),oe.push(pe.colorSpace),oe.join()}function te(pe,oe){const ke=r.get(pe);if(pe.isVideoTexture&&Ot(pe),pe.isRenderTargetTexture===!1&&pe.version>0&&ke.__version!==pe.version){const Je=pe.image;if(Je===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Je.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{_e(ke,pe,oe);return}}t.bindTexture(n.TEXTURE_2D,ke.__webglTexture,n.TEXTURE0+oe)}function Q(pe,oe){const ke=r.get(pe);if(pe.version>0&&ke.__version!==pe.version){_e(ke,pe,oe);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ke.__webglTexture,n.TEXTURE0+oe)}function ne(pe,oe){const ke=r.get(pe);if(pe.version>0&&ke.__version!==pe.version){_e(ke,pe,oe);return}t.bindTexture(n.TEXTURE_3D,ke.__webglTexture,n.TEXTURE0+oe)}function G(pe,oe){const ke=r.get(pe);if(pe.version>0&&ke.__version!==pe.version){Ae(ke,pe,oe);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ke.__webglTexture,n.TEXTURE0+oe)}const J={[cA]:n.REPEAT,[q0]:n.CLAMP_TO_EDGE,[lA]:n.MIRRORED_REPEAT},re={[bo]:n.NEAREST,[UW]:n.NEAREST_MIPMAP_NEAREST,[Rb]:n.NEAREST_MIPMAP_LINEAR,[kl]:n.LINEAR,[_1]:n.LINEAR_MIPMAP_NEAREST,[X0]:n.LINEAR_MIPMAP_LINEAR},ue={[zW]:n.NEVER,[$W]:n.ALWAYS,[VW]:n.LESS,[sB]:n.LEQUAL,[jW]:n.EQUAL,[WW]:n.GEQUAL,[HW]:n.GREATER,[GW]:n.NOTEQUAL};function ye(pe,oe){if(oe.type===hf&&e.has("OES_texture_float_linear")===!1&&(oe.magFilter===kl||oe.magFilter===_1||oe.magFilter===Rb||oe.magFilter===X0||oe.minFilter===kl||oe.minFilter===_1||oe.minFilter===Rb||oe.minFilter===X0)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(pe,n.TEXTURE_WRAP_S,J[oe.wrapS]),n.texParameteri(pe,n.TEXTURE_WRAP_T,J[oe.wrapT]),(pe===n.TEXTURE_3D||pe===n.TEXTURE_2D_ARRAY)&&n.texParameteri(pe,n.TEXTURE_WRAP_R,J[oe.wrapR]),n.texParameteri(pe,n.TEXTURE_MAG_FILTER,re[oe.magFilter]),n.texParameteri(pe,n.TEXTURE_MIN_FILTER,re[oe.minFilter]),oe.compareFunction&&(n.texParameteri(pe,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(pe,n.TEXTURE_COMPARE_FUNC,ue[oe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(oe.magFilter===bo||oe.minFilter!==Rb&&oe.minFilter!==X0||oe.type===hf&&e.has("OES_texture_float_linear")===!1)return;if(oe.anisotropy>1||r.get(oe).__currentAnisotropy){const ke=e.get("EXT_texture_filter_anisotropic");n.texParameterf(pe,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(oe.anisotropy,i.getMaxAnisotropy())),r.get(oe).__currentAnisotropy=oe.anisotropy}}}function Ne(pe,oe){let ke=!1;pe.__webglInit===void 0&&(pe.__webglInit=!0,oe.addEventListener("dispose",D));const Je=oe.source;let ut=d.get(Je);ut===void 0&&(ut={},d.set(Je,ut));const ot=K(oe);if(ot!==pe.__cacheKey){ut[ot]===void 0&&(ut[ot]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ke=!0),ut[ot].usedTimes++;const cn=ut[pe.__cacheKey];cn!==void 0&&(ut[pe.__cacheKey].usedTimes--,cn.usedTimes===0&&F(oe)),pe.__cacheKey=ot,pe.__webglTexture=ut[ot].texture}return ke}function _e(pe,oe,ke){let Je=n.TEXTURE_2D;(oe.isDataArrayTexture||oe.isCompressedArrayTexture)&&(Je=n.TEXTURE_2D_ARRAY),oe.isData3DTexture&&(Je=n.TEXTURE_3D);const ut=Ne(pe,oe),ot=oe.source;t.bindTexture(Je,pe.__webglTexture,n.TEXTURE0+ke);const cn=r.get(ot);if(ot.version!==cn.__version||ut===!0){t.activeTexture(n.TEXTURE0+ke);const Dt=Si.getPrimaries(Si.workingColorSpace),Wt=oe.colorSpace===of?null:Si.getPrimaries(oe.colorSpace),or=oe.colorSpace===of||Dt===Wt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,oe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,oe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,or);let xt=y(oe.image,!1,i.maxTextureSize);xt=rt(oe,xt);const bt=s.convert(oe.format,oe.colorSpace),Ft=s.convert(oe.type);let Un=R(oe.internalFormat,bt,Ft,oe.colorSpace,oe.isVideoTexture);ye(Je,oe);let Zt;const Ir=oe.mipmaps,Et=oe.isVideoTexture!==!0,ii=cn.__version===void 0||ut===!0,Me=ot.dataReady,Nt=U(oe,xt);if(oe.isDepthTexture)Un=I(oe.format===o_,oe.type),ii&&(Et?t.texStorage2D(n.TEXTURE_2D,1,Un,xt.width,xt.height):t.texImage2D(n.TEXTURE_2D,0,Un,xt.width,xt.height,0,bt,Ft,null));else if(oe.isDataTexture)if(Ir.length>0){Et&&ii&&t.texStorage2D(n.TEXTURE_2D,Nt,Un,Ir[0].width,Ir[0].height);for(let et=0,ht=Ir.length;et<ht;et++)Zt=Ir[et],Et?Me&&t.texSubImage2D(n.TEXTURE_2D,et,0,0,Zt.width,Zt.height,bt,Ft,Zt.data):t.texImage2D(n.TEXTURE_2D,et,Un,Zt.width,Zt.height,0,bt,Ft,Zt.data);oe.generateMipmaps=!1}else Et?(ii&&t.texStorage2D(n.TEXTURE_2D,Nt,Un,xt.width,xt.height),Me&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,xt.width,xt.height,bt,Ft,xt.data)):t.texImage2D(n.TEXTURE_2D,0,Un,xt.width,xt.height,0,bt,Ft,xt.data);else if(oe.isCompressedTexture)if(oe.isCompressedArrayTexture){Et&&ii&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Nt,Un,Ir[0].width,Ir[0].height,xt.depth);for(let et=0,ht=Ir.length;et<ht;et++)if(Zt=Ir[et],oe.format!==Zu)if(bt!==null)if(Et){if(Me)if(oe.layerUpdates.size>0){const Ht=dD(Zt.width,Zt.height,oe.format,oe.type);for(const Lt of oe.layerUpdates){const Ee=Zt.data.subarray(Lt*Ht/Zt.data.BYTES_PER_ELEMENT,(Lt+1)*Ht/Zt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,Lt,Zt.width,Zt.height,1,bt,Ee)}oe.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,0,Zt.width,Zt.height,xt.depth,bt,Zt.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,et,Un,Zt.width,Zt.height,xt.depth,0,Zt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Et?Me&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,et,0,0,0,Zt.width,Zt.height,xt.depth,bt,Ft,Zt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,et,Un,Zt.width,Zt.height,xt.depth,0,bt,Ft,Zt.data)}else{Et&&ii&&t.texStorage2D(n.TEXTURE_2D,Nt,Un,Ir[0].width,Ir[0].height);for(let et=0,ht=Ir.length;et<ht;et++)Zt=Ir[et],oe.format!==Zu?bt!==null?Et?Me&&t.compressedTexSubImage2D(n.TEXTURE_2D,et,0,0,Zt.width,Zt.height,bt,Zt.data):t.compressedTexImage2D(n.TEXTURE_2D,et,Un,Zt.width,Zt.height,0,Zt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Et?Me&&t.texSubImage2D(n.TEXTURE_2D,et,0,0,Zt.width,Zt.height,bt,Ft,Zt.data):t.texImage2D(n.TEXTURE_2D,et,Un,Zt.width,Zt.height,0,bt,Ft,Zt.data)}else if(oe.isDataArrayTexture)if(Et){if(ii&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Nt,Un,xt.width,xt.height,xt.depth),Me)if(oe.layerUpdates.size>0){const et=dD(xt.width,xt.height,oe.format,oe.type);for(const ht of oe.layerUpdates){const Ht=xt.data.subarray(ht*et/xt.data.BYTES_PER_ELEMENT,(ht+1)*et/xt.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ht,xt.width,xt.height,1,bt,Ft,Ht)}oe.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,xt.width,xt.height,xt.depth,bt,Ft,xt.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Un,xt.width,xt.height,xt.depth,0,bt,Ft,xt.data);else if(oe.isData3DTexture)Et?(ii&&t.texStorage3D(n.TEXTURE_3D,Nt,Un,xt.width,xt.height,xt.depth),Me&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,xt.width,xt.height,xt.depth,bt,Ft,xt.data)):t.texImage3D(n.TEXTURE_3D,0,Un,xt.width,xt.height,xt.depth,0,bt,Ft,xt.data);else if(oe.isFramebufferTexture){if(ii)if(Et)t.texStorage2D(n.TEXTURE_2D,Nt,Un,xt.width,xt.height);else{let et=xt.width,ht=xt.height;for(let Ht=0;Ht<Nt;Ht++)t.texImage2D(n.TEXTURE_2D,Ht,Un,et,ht,0,bt,Ft,null),et>>=1,ht>>=1}}else if(Ir.length>0){if(Et&&ii){const et=nt(Ir[0]);t.texStorage2D(n.TEXTURE_2D,Nt,Un,et.width,et.height)}for(let et=0,ht=Ir.length;et<ht;et++)Zt=Ir[et],Et?Me&&t.texSubImage2D(n.TEXTURE_2D,et,0,0,bt,Ft,Zt):t.texImage2D(n.TEXTURE_2D,et,Un,bt,Ft,Zt);oe.generateMipmaps=!1}else if(Et){if(ii){const et=nt(xt);t.texStorage2D(n.TEXTURE_2D,Nt,Un,et.width,et.height)}Me&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,bt,Ft,xt)}else t.texImage2D(n.TEXTURE_2D,0,Un,bt,Ft,xt);S(oe)&&T(Je),cn.__version=ot.version,oe.onUpdate&&oe.onUpdate(oe)}pe.__version=oe.version}function Ae(pe,oe,ke){if(oe.image.length!==6)return;const Je=Ne(pe,oe),ut=oe.source;t.bindTexture(n.TEXTURE_CUBE_MAP,pe.__webglTexture,n.TEXTURE0+ke);const ot=r.get(ut);if(ut.version!==ot.__version||Je===!0){t.activeTexture(n.TEXTURE0+ke);const cn=Si.getPrimaries(Si.workingColorSpace),Dt=oe.colorSpace===of?null:Si.getPrimaries(oe.colorSpace),Wt=oe.colorSpace===of||cn===Dt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,oe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,oe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Wt);const or=oe.isCompressedTexture||oe.image[0].isCompressedTexture,xt=oe.image[0]&&oe.image[0].isDataTexture,bt=[];for(let ht=0;ht<6;ht++)!or&&!xt?bt[ht]=y(oe.image[ht],!0,i.maxCubemapSize):bt[ht]=xt?oe.image[ht].image:oe.image[ht],bt[ht]=rt(oe,bt[ht]);const Ft=bt[0],Un=s.convert(oe.format,oe.colorSpace),Zt=s.convert(oe.type),Ir=R(oe.internalFormat,Un,Zt,oe.colorSpace),Et=oe.isVideoTexture!==!0,ii=ot.__version===void 0||Je===!0,Me=ut.dataReady;let Nt=U(oe,Ft);ye(n.TEXTURE_CUBE_MAP,oe);let et;if(or){Et&&ii&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Nt,Ir,Ft.width,Ft.height);for(let ht=0;ht<6;ht++){et=bt[ht].mipmaps;for(let Ht=0;Ht<et.length;Ht++){const Lt=et[Ht];oe.format!==Zu?Un!==null?Et?Me&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht,0,0,Lt.width,Lt.height,Un,Lt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht,Ir,Lt.width,Lt.height,0,Lt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Et?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht,0,0,Lt.width,Lt.height,Un,Zt,Lt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht,Ir,Lt.width,Lt.height,0,Un,Zt,Lt.data)}}}else{if(et=oe.mipmaps,Et&&ii){et.length>0&&Nt++;const ht=nt(bt[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Nt,Ir,ht.width,ht.height)}for(let ht=0;ht<6;ht++)if(xt){Et?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,bt[ht].width,bt[ht].height,Un,Zt,bt[ht].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,Ir,bt[ht].width,bt[ht].height,0,Un,Zt,bt[ht].data);for(let Ht=0;Ht<et.length;Ht++){const Ee=et[Ht].image[ht].image;Et?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht+1,0,0,Ee.width,Ee.height,Un,Zt,Ee.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht+1,Ir,Ee.width,Ee.height,0,Un,Zt,Ee.data)}}else{Et?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,Un,Zt,bt[ht]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,Ir,Un,Zt,bt[ht]);for(let Ht=0;Ht<et.length;Ht++){const Lt=et[Ht];Et?Me&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht+1,0,0,Un,Zt,Lt.image[ht]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,Ht+1,Ir,Un,Zt,Lt.image[ht])}}}S(oe)&&T(n.TEXTURE_CUBE_MAP),ot.__version=ut.version,oe.onUpdate&&oe.onUpdate(oe)}pe.__version=oe.version}function Ye(pe,oe,ke,Je,ut,ot){const cn=s.convert(ke.format,ke.colorSpace),Dt=s.convert(ke.type),Wt=R(ke.internalFormat,cn,Dt,ke.colorSpace),or=r.get(oe),xt=r.get(ke);if(xt.__renderTarget=oe,!or.__hasExternalTextures){const bt=Math.max(1,oe.width>>ot),Ft=Math.max(1,oe.height>>ot);ut===n.TEXTURE_3D||ut===n.TEXTURE_2D_ARRAY?t.texImage3D(ut,ot,Wt,bt,Ft,oe.depth,0,cn,Dt,null):t.texImage2D(ut,ot,Wt,bt,Ft,0,cn,Dt,null)}t.bindFramebuffer(n.FRAMEBUFFER,pe),nn(oe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Je,ut,xt.__webglTexture,0,Qe(oe)):(ut===n.TEXTURE_2D||ut>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ut<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Je,ut,xt.__webglTexture,ot),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ze(pe,oe,ke){if(n.bindRenderbuffer(n.RENDERBUFFER,pe),oe.depthBuffer){const Je=oe.depthTexture,ut=Je&&Je.isDepthTexture?Je.type:null,ot=I(oe.stencilBuffer,ut),cn=oe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Dt=Qe(oe);nn(oe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Dt,ot,oe.width,oe.height):ke?n.renderbufferStorageMultisample(n.RENDERBUFFER,Dt,ot,oe.width,oe.height):n.renderbufferStorage(n.RENDERBUFFER,ot,oe.width,oe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,cn,n.RENDERBUFFER,pe)}else{const Je=oe.textures;for(let ut=0;ut<Je.length;ut++){const ot=Je[ut],cn=s.convert(ot.format,ot.colorSpace),Dt=s.convert(ot.type),Wt=R(ot.internalFormat,cn,Dt,ot.colorSpace),or=Qe(oe);ke&&nn(oe)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,or,Wt,oe.width,oe.height):nn(oe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,or,Wt,oe.width,oe.height):n.renderbufferStorage(n.RENDERBUFFER,Wt,oe.width,oe.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ke(pe,oe){if(oe&&oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,pe),!(oe.depthTexture&&oe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Je=r.get(oe.depthTexture);Je.__renderTarget=oe,(!Je.__webglTexture||oe.depthTexture.image.width!==oe.width||oe.depthTexture.image.height!==oe.height)&&(oe.depthTexture.image.width=oe.width,oe.depthTexture.image.height=oe.height,oe.depthTexture.needsUpdate=!0),te(oe.depthTexture,0);const ut=Je.__webglTexture,ot=Qe(oe);if(oe.depthTexture.format===jv)nn(oe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ut,0,ot):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ut,0);else if(oe.depthTexture.format===o_)nn(oe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ut,0,ot):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ut,0);else throw new Error("Unknown depthTexture format")}function It(pe){const oe=r.get(pe),ke=pe.isWebGLCubeRenderTarget===!0;if(oe.__boundDepthTexture!==pe.depthTexture){const Je=pe.depthTexture;if(oe.__depthDisposeCallback&&oe.__depthDisposeCallback(),Je){const ut=()=>{delete oe.__boundDepthTexture,delete oe.__depthDisposeCallback,Je.removeEventListener("dispose",ut)};Je.addEventListener("dispose",ut),oe.__depthDisposeCallback=ut}oe.__boundDepthTexture=Je}if(pe.depthTexture&&!oe.__autoAllocateDepthBuffer){if(ke)throw new Error("target.depthTexture not supported in Cube render targets");Ke(oe.__webglFramebuffer,pe)}else if(ke){oe.__webglDepthbuffer=[];for(let Je=0;Je<6;Je++)if(t.bindFramebuffer(n.FRAMEBUFFER,oe.__webglFramebuffer[Je]),oe.__webglDepthbuffer[Je]===void 0)oe.__webglDepthbuffer[Je]=n.createRenderbuffer(),Ze(oe.__webglDepthbuffer[Je],pe,!1);else{const ut=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ot=oe.__webglDepthbuffer[Je];n.bindRenderbuffer(n.RENDERBUFFER,ot),n.framebufferRenderbuffer(n.FRAMEBUFFER,ut,n.RENDERBUFFER,ot)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,oe.__webglFramebuffer),oe.__webglDepthbuffer===void 0)oe.__webglDepthbuffer=n.createRenderbuffer(),Ze(oe.__webglDepthbuffer,pe,!1);else{const Je=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ut=oe.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ut),n.framebufferRenderbuffer(n.FRAMEBUFFER,Je,n.RENDERBUFFER,ut)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Xt(pe,oe,ke){const Je=r.get(pe);oe!==void 0&&Ye(Je.__webglFramebuffer,pe,pe.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ke!==void 0&&It(pe)}function Qt(pe){const oe=pe.texture,ke=r.get(pe),Je=r.get(oe);pe.addEventListener("dispose",L);const ut=pe.textures,ot=pe.isWebGLCubeRenderTarget===!0,cn=ut.length>1;if(cn||(Je.__webglTexture===void 0&&(Je.__webglTexture=n.createTexture()),Je.__version=oe.version,o.memory.textures++),ot){ke.__webglFramebuffer=[];for(let Dt=0;Dt<6;Dt++)if(oe.mipmaps&&oe.mipmaps.length>0){ke.__webglFramebuffer[Dt]=[];for(let Wt=0;Wt<oe.mipmaps.length;Wt++)ke.__webglFramebuffer[Dt][Wt]=n.createFramebuffer()}else ke.__webglFramebuffer[Dt]=n.createFramebuffer()}else{if(oe.mipmaps&&oe.mipmaps.length>0){ke.__webglFramebuffer=[];for(let Dt=0;Dt<oe.mipmaps.length;Dt++)ke.__webglFramebuffer[Dt]=n.createFramebuffer()}else ke.__webglFramebuffer=n.createFramebuffer();if(cn)for(let Dt=0,Wt=ut.length;Dt<Wt;Dt++){const or=r.get(ut[Dt]);or.__webglTexture===void 0&&(or.__webglTexture=n.createTexture(),o.memory.textures++)}if(pe.samples>0&&nn(pe)===!1){ke.__webglMultisampledFramebuffer=n.createFramebuffer(),ke.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer);for(let Dt=0;Dt<ut.length;Dt++){const Wt=ut[Dt];ke.__webglColorRenderbuffer[Dt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ke.__webglColorRenderbuffer[Dt]);const or=s.convert(Wt.format,Wt.colorSpace),xt=s.convert(Wt.type),bt=R(Wt.internalFormat,or,xt,Wt.colorSpace,pe.isXRRenderTarget===!0),Ft=Qe(pe);n.renderbufferStorageMultisample(n.RENDERBUFFER,Ft,bt,pe.width,pe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Dt,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Dt])}n.bindRenderbuffer(n.RENDERBUFFER,null),pe.depthBuffer&&(ke.__webglDepthRenderbuffer=n.createRenderbuffer(),Ze(ke.__webglDepthRenderbuffer,pe,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ot){t.bindTexture(n.TEXTURE_CUBE_MAP,Je.__webglTexture),ye(n.TEXTURE_CUBE_MAP,oe);for(let Dt=0;Dt<6;Dt++)if(oe.mipmaps&&oe.mipmaps.length>0)for(let Wt=0;Wt<oe.mipmaps.length;Wt++)Ye(ke.__webglFramebuffer[Dt][Wt],pe,oe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Dt,Wt);else Ye(ke.__webglFramebuffer[Dt],pe,oe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Dt,0);S(oe)&&T(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(cn){for(let Dt=0,Wt=ut.length;Dt<Wt;Dt++){const or=ut[Dt],xt=r.get(or);t.bindTexture(n.TEXTURE_2D,xt.__webglTexture),ye(n.TEXTURE_2D,or),Ye(ke.__webglFramebuffer,pe,or,n.COLOR_ATTACHMENT0+Dt,n.TEXTURE_2D,0),S(or)&&T(n.TEXTURE_2D)}t.unbindTexture()}else{let Dt=n.TEXTURE_2D;if((pe.isWebGL3DRenderTarget||pe.isWebGLArrayRenderTarget)&&(Dt=pe.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Dt,Je.__webglTexture),ye(Dt,oe),oe.mipmaps&&oe.mipmaps.length>0)for(let Wt=0;Wt<oe.mipmaps.length;Wt++)Ye(ke.__webglFramebuffer[Wt],pe,oe,n.COLOR_ATTACHMENT0,Dt,Wt);else Ye(ke.__webglFramebuffer,pe,oe,n.COLOR_ATTACHMENT0,Dt,0);S(oe)&&T(Dt),t.unbindTexture()}pe.depthBuffer&&It(pe)}function Kt(pe){const oe=pe.textures;for(let ke=0,Je=oe.length;ke<Je;ke++){const ut=oe[ke];if(S(ut)){const ot=A(pe),cn=r.get(ut).__webglTexture;t.bindTexture(ot,cn),T(ot),t.unbindTexture()}}}const xn=[],Re=[];function St(pe){if(pe.samples>0){if(nn(pe)===!1){const oe=pe.textures,ke=pe.width,Je=pe.height;let ut=n.COLOR_BUFFER_BIT;const ot=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,cn=r.get(pe),Dt=oe.length>1;if(Dt)for(let Wt=0;Wt<oe.length;Wt++)t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Wt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Wt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,cn.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,cn.__webglFramebuffer);for(let Wt=0;Wt<oe.length;Wt++){if(pe.resolveDepthBuffer&&(pe.depthBuffer&&(ut|=n.DEPTH_BUFFER_BIT),pe.stencilBuffer&&pe.resolveStencilBuffer&&(ut|=n.STENCIL_BUFFER_BIT)),Dt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,cn.__webglColorRenderbuffer[Wt]);const or=r.get(oe[Wt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,or,0)}n.blitFramebuffer(0,0,ke,Je,0,0,ke,Je,ut,n.NEAREST),c===!0&&(xn.length=0,Re.length=0,xn.push(n.COLOR_ATTACHMENT0+Wt),pe.depthBuffer&&pe.resolveDepthBuffer===!1&&(xn.push(ot),Re.push(ot),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Re)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,xn))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Dt)for(let Wt=0;Wt<oe.length;Wt++){t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Wt,n.RENDERBUFFER,cn.__webglColorRenderbuffer[Wt]);const or=r.get(oe[Wt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Wt,n.TEXTURE_2D,or,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,cn.__webglMultisampledFramebuffer)}else if(pe.depthBuffer&&pe.resolveDepthBuffer===!1&&c){const oe=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[oe])}}}function Qe(pe){return Math.min(i.maxSamples,pe.samples)}function nn(pe){const oe=r.get(pe);return pe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&oe.__useRenderToTexture!==!1}function Ot(pe){const oe=o.render.frame;u.get(pe)!==oe&&(u.set(pe,oe),pe.update())}function rt(pe,oe){const ke=pe.colorSpace,Je=pe.format,ut=pe.type;return pe.isCompressedTexture===!0||pe.isVideoTexture===!0||ke!==Xg&&ke!==of&&(Si.getTransfer(ke)===ji?(Je!==Zu||ut!==Ec)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ke)),oe}function nt(pe){return typeof HTMLImageElement<"u"&&pe instanceof HTMLImageElement?(l.width=pe.naturalWidth||pe.width,l.height=pe.naturalHeight||pe.height):typeof VideoFrame<"u"&&pe instanceof VideoFrame?(l.width=pe.displayWidth,l.height=pe.displayHeight):(l.width=pe.width,l.height=pe.height),l}this.allocateTextureUnit=$,this.resetTextureUnits=X,this.setTexture2D=te,this.setTexture2DArray=Q,this.setTexture3D=ne,this.setTextureCube=G,this.rebindTextures=Xt,this.setupRenderTarget=Qt,this.updateRenderTargetMipmap=Kt,this.updateMultisampleRenderTarget=St,this.setupDepthRenderbuffer=It,this.setupFrameBufferTexture=Ye,this.useMultisampledRTT=nn}function dK(n,e){function t(r,i=of){let s;const o=Si.getTransfer(i);if(r===Ec)return n.UNSIGNED_BYTE;if(r===XI)return n.UNSIGNED_SHORT_4_4_4_4;if(r===KI)return n.UNSIGNED_SHORT_5_5_5_1;if(r===YF)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===XF)return n.BYTE;if(r===KF)return n.SHORT;if(r===VS)return n.UNSIGNED_SHORT;if(r===qI)return n.INT;if(r===Pg)return n.UNSIGNED_INT;if(r===hf)return n.FLOAT;if(r===Ny)return n.HALF_FLOAT;if(r===JF)return n.ALPHA;if(r===QF)return n.RGB;if(r===Zu)return n.RGBA;if(r===ZF)return n.LUMINANCE;if(r===eB)return n.LUMINANCE_ALPHA;if(r===jv)return n.DEPTH_COMPONENT;if(r===o_)return n.DEPTH_STENCIL;if(r===tB)return n.RED;if(r===YI)return n.RED_INTEGER;if(r===nB)return n.RG;if(r===JI)return n.RG_INTEGER;if(r===Pw)return n.RGBA_INTEGER;if(r===NT||r===PT||r===DT||r===LT)if(o===ji)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===NT)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===PT)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===DT)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===LT)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===NT)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===PT)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===DT)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===LT)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===uA||r===hA||r===dA||r===fA)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===uA)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===hA)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===dA)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===fA)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===pA||r===mA||r===gA)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===pA||r===mA)return o===ji?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===gA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===_A||r===vA||r===yA||r===SA||r===EA||r===bA||r===TA||r===xA||r===wA||r===CA||r===RA||r===AA||r===MA||r===IA)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===_A)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===vA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===yA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===SA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===EA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===bA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===TA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===xA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===wA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===CA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===RA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===AA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===MA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===IA)return o===ji?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===UT||r===kA||r===OA)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===UT)return o===ji?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===kA)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===OA)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===rB||r===NA||r===PA||r===DA)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===UT)return s.COMPRESSED_RED_RGTC1_EXT;if(r===NA)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===PA)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===DA)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===s_?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}class fK extends fu{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class vS extends Nl{constructor(){super(),this.isGroup=!0,this.type="Group"}}const pK={type:"move"};class G1{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new vS,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new vS,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new qe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new qe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new vS,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new qe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new qe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const y of e.hand.values()){const S=t.getJointPose(y,r),T=this._getHandJoint(l,y);S!==null&&(T.matrix.fromArray(S.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),T.matrixWorldNeedsUpdate=!0,T.jointRadius=S.radius),T.visible=S!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,_=.005;l.inputState.pinching&&d>p+_?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=p-_&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(pK)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new vS;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const mK=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,gK=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class _K{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new so,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!=r.depthNear||t.depthFar!=r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new tl({vertexShader:mK,fragmentShader:gK,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new $h(new wE(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class vK extends pm{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,d=null,p=null,_=null;const y=new _K,S=t.getContextAttributes();let T=null,A=null;const R=[],I=[],U=new Ln;let D=null;const L=new fu;L.viewport=new Eo;const z=new fu;z.viewport=new Eo;const F=[L,z],V=new fK;let W=null,X=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(_e){let Ae=R[_e];return Ae===void 0&&(Ae=new G1,R[_e]=Ae),Ae.getTargetRaySpace()},this.getControllerGrip=function(_e){let Ae=R[_e];return Ae===void 0&&(Ae=new G1,R[_e]=Ae),Ae.getGripSpace()},this.getHand=function(_e){let Ae=R[_e];return Ae===void 0&&(Ae=new G1,R[_e]=Ae),Ae.getHandSpace()};function $(_e){const Ae=I.indexOf(_e.inputSource);if(Ae===-1)return;const Ye=R[Ae];Ye!==void 0&&(Ye.update(_e.inputSource,_e.frame,l||o),Ye.dispatchEvent({type:_e.type,data:_e.inputSource}))}function K(){i.removeEventListener("select",$),i.removeEventListener("selectstart",$),i.removeEventListener("selectend",$),i.removeEventListener("squeeze",$),i.removeEventListener("squeezestart",$),i.removeEventListener("squeezeend",$),i.removeEventListener("end",K),i.removeEventListener("inputsourceschange",te);for(let _e=0;_e<R.length;_e++){const Ae=I[_e];Ae!==null&&(I[_e]=null,R[_e].disconnect(Ae))}W=null,X=null,y.reset(),e.setRenderTarget(T),p=null,d=null,h=null,i=null,A=null,Ne.stop(),r.isPresenting=!1,e.setPixelRatio(D),e.setSize(U.width,U.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(_e){s=_e,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(_e){a=_e,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(_e){l=_e},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return _},this.getSession=function(){return i},this.setSession=async function(_e){if(i=_e,i!==null){if(T=e.getRenderTarget(),i.addEventListener("select",$),i.addEventListener("selectstart",$),i.addEventListener("selectend",$),i.addEventListener("squeeze",$),i.addEventListener("squeezestart",$),i.addEventListener("squeezeend",$),i.addEventListener("end",K),i.addEventListener("inputsourceschange",te),S.xrCompatible!==!0&&await t.makeXRCompatible(),D=e.getPixelRatio(),e.getSize(U),i.renderState.layers===void 0){const Ae={antialias:S.antialias,alpha:!0,depth:S.depth,stencil:S.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,t,Ae),i.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),A=new Tu(p.framebufferWidth,p.framebufferHeight,{format:Zu,type:Ec,colorSpace:e.outputColorSpace,stencilBuffer:S.stencil})}else{let Ae=null,Ye=null,Ze=null;S.depth&&(Ze=S.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ae=S.stencil?o_:jv,Ye=S.stencil?s_:Pg);const Ke={colorFormat:t.RGBA8,depthFormat:Ze,scaleFactor:s};h=new XRWebGLBinding(i,t),d=h.createProjectionLayer(Ke),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),A=new Tu(d.textureWidth,d.textureHeight,{format:Zu,type:Ec,depthTexture:new nk(d.textureWidth,d.textureHeight,Ye,void 0,void 0,void 0,void 0,void 0,void 0,Ae),stencilBuffer:S.stencil,colorSpace:e.outputColorSpace,samples:S.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}A.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),Ne.setContext(i),Ne.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return y.getDepthTexture()};function te(_e){for(let Ae=0;Ae<_e.removed.length;Ae++){const Ye=_e.removed[Ae],Ze=I.indexOf(Ye);Ze>=0&&(I[Ze]=null,R[Ze].disconnect(Ye))}for(let Ae=0;Ae<_e.added.length;Ae++){const Ye=_e.added[Ae];let Ze=I.indexOf(Ye);if(Ze===-1){for(let It=0;It<R.length;It++)if(It>=I.length){I.push(Ye),Ze=It;break}else if(I[It]===null){I[It]=Ye,Ze=It;break}if(Ze===-1)break}const Ke=R[Ze];Ke&&Ke.connect(Ye)}}const Q=new qe,ne=new qe;function G(_e,Ae,Ye){Q.setFromMatrixPosition(Ae.matrixWorld),ne.setFromMatrixPosition(Ye.matrixWorld);const Ze=Q.distanceTo(ne),Ke=Ae.projectionMatrix.elements,It=Ye.projectionMatrix.elements,Xt=Ke[14]/(Ke[10]-1),Qt=Ke[14]/(Ke[10]+1),Kt=(Ke[9]+1)/Ke[5],xn=(Ke[9]-1)/Ke[5],Re=(Ke[8]-1)/Ke[0],St=(It[8]+1)/It[0],Qe=Xt*Re,nn=Xt*St,Ot=Ze/(-Re+St),rt=Ot*-Re;if(Ae.matrixWorld.decompose(_e.position,_e.quaternion,_e.scale),_e.translateX(rt),_e.translateZ(Ot),_e.matrixWorld.compose(_e.position,_e.quaternion,_e.scale),_e.matrixWorldInverse.copy(_e.matrixWorld).invert(),Ke[10]===-1)_e.projectionMatrix.copy(Ae.projectionMatrix),_e.projectionMatrixInverse.copy(Ae.projectionMatrixInverse);else{const nt=Xt+Ot,pe=Qt+Ot,oe=Qe-rt,ke=nn+(Ze-rt),Je=Kt*Qt/pe*nt,ut=xn*Qt/pe*nt;_e.projectionMatrix.makePerspective(oe,ke,Je,ut,nt,pe),_e.projectionMatrixInverse.copy(_e.projectionMatrix).invert()}}function J(_e,Ae){Ae===null?_e.matrixWorld.copy(_e.matrix):_e.matrixWorld.multiplyMatrices(Ae.matrixWorld,_e.matrix),_e.matrixWorldInverse.copy(_e.matrixWorld).invert()}this.updateCamera=function(_e){if(i===null)return;let Ae=_e.near,Ye=_e.far;y.texture!==null&&(y.depthNear>0&&(Ae=y.depthNear),y.depthFar>0&&(Ye=y.depthFar)),V.near=z.near=L.near=Ae,V.far=z.far=L.far=Ye,(W!==V.near||X!==V.far)&&(i.updateRenderState({depthNear:V.near,depthFar:V.far}),W=V.near,X=V.far),L.layers.mask=_e.layers.mask|2,z.layers.mask=_e.layers.mask|4,V.layers.mask=L.layers.mask|z.layers.mask;const Ze=_e.parent,Ke=V.cameras;J(V,Ze);for(let It=0;It<Ke.length;It++)J(Ke[It],Ze);Ke.length===2?G(V,L,z):V.projectionMatrix.copy(L.projectionMatrix),re(_e,V,Ze)};function re(_e,Ae,Ye){Ye===null?_e.matrix.copy(Ae.matrixWorld):(_e.matrix.copy(Ye.matrixWorld),_e.matrix.invert(),_e.matrix.multiply(Ae.matrixWorld)),_e.matrix.decompose(_e.position,_e.quaternion,_e.scale),_e.updateMatrixWorld(!0),_e.projectionMatrix.copy(Ae.projectionMatrix),_e.projectionMatrixInverse.copy(Ae.projectionMatrixInverse),_e.isPerspectiveCamera&&(_e.fov=jS*2*Math.atan(1/_e.projectionMatrix.elements[5]),_e.zoom=1)}this.getCamera=function(){return V},this.getFoveation=function(){if(!(d===null&&p===null))return c},this.setFoveation=function(_e){c=_e,d!==null&&(d.fixedFoveation=_e),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=_e)},this.hasDepthSensing=function(){return y.texture!==null},this.getDepthSensingMesh=function(){return y.getMesh(V)};let ue=null;function ye(_e,Ae){if(u=Ae.getViewerPose(l||o),_=Ae,u!==null){const Ye=u.views;p!==null&&(e.setRenderTargetFramebuffer(A,p.framebuffer),e.setRenderTarget(A));let Ze=!1;Ye.length!==V.cameras.length&&(V.cameras.length=0,Ze=!0);for(let It=0;It<Ye.length;It++){const Xt=Ye[It];let Qt=null;if(p!==null)Qt=p.getViewport(Xt);else{const xn=h.getViewSubImage(d,Xt);Qt=xn.viewport,It===0&&(e.setRenderTargetTextures(A,xn.colorTexture,d.ignoreDepthValues?void 0:xn.depthStencilTexture),e.setRenderTarget(A))}let Kt=F[It];Kt===void 0&&(Kt=new fu,Kt.layers.enable(It),Kt.viewport=new Eo,F[It]=Kt),Kt.matrix.fromArray(Xt.transform.matrix),Kt.matrix.decompose(Kt.position,Kt.quaternion,Kt.scale),Kt.projectionMatrix.fromArray(Xt.projectionMatrix),Kt.projectionMatrixInverse.copy(Kt.projectionMatrix).invert(),Kt.viewport.set(Qt.x,Qt.y,Qt.width,Qt.height),It===0&&(V.matrix.copy(Kt.matrix),V.matrix.decompose(V.position,V.quaternion,V.scale)),Ze===!0&&V.cameras.push(Kt)}const Ke=i.enabledFeatures;if(Ke&&Ke.includes("depth-sensing")){const It=h.getDepthInformation(Ye[0]);It&&It.isValid&&It.texture&&y.init(e,It,i.renderState)}}for(let Ye=0;Ye<R.length;Ye++){const Ze=I[Ye],Ke=R[Ye];Ze!==null&&Ke!==void 0&&Ke.update(Ze,Ae,l||o)}ue&&ue(_e,Ae),Ae.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Ae}),_=null}const Ne=new mB;Ne.setAnimationLoop(ye),this.setAnimationLoop=function(_e){ue=_e},this.dispose=function(){}}}const I0=new cm,yK=new oo;function SK(n,e){function t(S,T){S.matrixAutoUpdate===!0&&S.updateMatrix(),T.value.copy(S.matrix)}function r(S,T){T.color.getRGB(S.fogColor.value,dB(n)),T.isFog?(S.fogNear.value=T.near,S.fogFar.value=T.far):T.isFogExp2&&(S.fogDensity.value=T.density)}function i(S,T,A,R,I){T.isMeshBasicMaterial||T.isMeshLambertMaterial?s(S,T):T.isMeshToonMaterial?(s(S,T),h(S,T)):T.isMeshPhongMaterial?(s(S,T),u(S,T)):T.isMeshStandardMaterial?(s(S,T),d(S,T),T.isMeshPhysicalMaterial&&p(S,T,I)):T.isMeshMatcapMaterial?(s(S,T),_(S,T)):T.isMeshDepthMaterial?s(S,T):T.isMeshDistanceMaterial?(s(S,T),y(S,T)):T.isMeshNormalMaterial?s(S,T):T.isLineBasicMaterial?(o(S,T),T.isLineDashedMaterial&&a(S,T)):T.isPointsMaterial?c(S,T,A,R):T.isSpriteMaterial?l(S,T):T.isShadowMaterial?(S.color.value.copy(T.color),S.opacity.value=T.opacity):T.isShaderMaterial&&(T.uniformsNeedUpdate=!1)}function s(S,T){S.opacity.value=T.opacity,T.color&&S.diffuse.value.copy(T.color),T.emissive&&S.emissive.value.copy(T.emissive).multiplyScalar(T.emissiveIntensity),T.map&&(S.map.value=T.map,t(T.map,S.mapTransform)),T.alphaMap&&(S.alphaMap.value=T.alphaMap,t(T.alphaMap,S.alphaMapTransform)),T.bumpMap&&(S.bumpMap.value=T.bumpMap,t(T.bumpMap,S.bumpMapTransform),S.bumpScale.value=T.bumpScale,T.side===Da&&(S.bumpScale.value*=-1)),T.normalMap&&(S.normalMap.value=T.normalMap,t(T.normalMap,S.normalMapTransform),S.normalScale.value.copy(T.normalScale),T.side===Da&&S.normalScale.value.negate()),T.displacementMap&&(S.displacementMap.value=T.displacementMap,t(T.displacementMap,S.displacementMapTransform),S.displacementScale.value=T.displacementScale,S.displacementBias.value=T.displacementBias),T.emissiveMap&&(S.emissiveMap.value=T.emissiveMap,t(T.emissiveMap,S.emissiveMapTransform)),T.specularMap&&(S.specularMap.value=T.specularMap,t(T.specularMap,S.specularMapTransform)),T.alphaTest>0&&(S.alphaTest.value=T.alphaTest);const A=e.get(T),R=A.envMap,I=A.envMapRotation;R&&(S.envMap.value=R,I0.copy(I),I0.x*=-1,I0.y*=-1,I0.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(I0.y*=-1,I0.z*=-1),S.envMapRotation.value.setFromMatrix4(yK.makeRotationFromEuler(I0)),S.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,S.reflectivity.value=T.reflectivity,S.ior.value=T.ior,S.refractionRatio.value=T.refractionRatio),T.lightMap&&(S.lightMap.value=T.lightMap,S.lightMapIntensity.value=T.lightMapIntensity,t(T.lightMap,S.lightMapTransform)),T.aoMap&&(S.aoMap.value=T.aoMap,S.aoMapIntensity.value=T.aoMapIntensity,t(T.aoMap,S.aoMapTransform))}function o(S,T){S.diffuse.value.copy(T.color),S.opacity.value=T.opacity,T.map&&(S.map.value=T.map,t(T.map,S.mapTransform))}function a(S,T){S.dashSize.value=T.dashSize,S.totalSize.value=T.dashSize+T.gapSize,S.scale.value=T.scale}function c(S,T,A,R){S.diffuse.value.copy(T.color),S.opacity.value=T.opacity,S.size.value=T.size*A,S.scale.value=R*.5,T.map&&(S.map.value=T.map,t(T.map,S.uvTransform)),T.alphaMap&&(S.alphaMap.value=T.alphaMap,t(T.alphaMap,S.alphaMapTransform)),T.alphaTest>0&&(S.alphaTest.value=T.alphaTest)}function l(S,T){S.diffuse.value.copy(T.color),S.opacity.value=T.opacity,S.rotation.value=T.rotation,T.map&&(S.map.value=T.map,t(T.map,S.mapTransform)),T.alphaMap&&(S.alphaMap.value=T.alphaMap,t(T.alphaMap,S.alphaMapTransform)),T.alphaTest>0&&(S.alphaTest.value=T.alphaTest)}function u(S,T){S.specular.value.copy(T.specular),S.shininess.value=Math.max(T.shininess,1e-4)}function h(S,T){T.gradientMap&&(S.gradientMap.value=T.gradientMap)}function d(S,T){S.metalness.value=T.metalness,T.metalnessMap&&(S.metalnessMap.value=T.metalnessMap,t(T.metalnessMap,S.metalnessMapTransform)),S.roughness.value=T.roughness,T.roughnessMap&&(S.roughnessMap.value=T.roughnessMap,t(T.roughnessMap,S.roughnessMapTransform)),T.envMap&&(S.envMapIntensity.value=T.envMapIntensity)}function p(S,T,A){S.ior.value=T.ior,T.sheen>0&&(S.sheenColor.value.copy(T.sheenColor).multiplyScalar(T.sheen),S.sheenRoughness.value=T.sheenRoughness,T.sheenColorMap&&(S.sheenColorMap.value=T.sheenColorMap,t(T.sheenColorMap,S.sheenColorMapTransform)),T.sheenRoughnessMap&&(S.sheenRoughnessMap.value=T.sheenRoughnessMap,t(T.sheenRoughnessMap,S.sheenRoughnessMapTransform))),T.clearcoat>0&&(S.clearcoat.value=T.clearcoat,S.clearcoatRoughness.value=T.clearcoatRoughness,T.clearcoatMap&&(S.clearcoatMap.value=T.clearcoatMap,t(T.clearcoatMap,S.clearcoatMapTransform)),T.clearcoatRoughnessMap&&(S.clearcoatRoughnessMap.value=T.clearcoatRoughnessMap,t(T.clearcoatRoughnessMap,S.clearcoatRoughnessMapTransform)),T.clearcoatNormalMap&&(S.clearcoatNormalMap.value=T.clearcoatNormalMap,t(T.clearcoatNormalMap,S.clearcoatNormalMapTransform),S.clearcoatNormalScale.value.copy(T.clearcoatNormalScale),T.side===Da&&S.clearcoatNormalScale.value.negate())),T.dispersion>0&&(S.dispersion.value=T.dispersion),T.iridescence>0&&(S.iridescence.value=T.iridescence,S.iridescenceIOR.value=T.iridescenceIOR,S.iridescenceThicknessMinimum.value=T.iridescenceThicknessRange[0],S.iridescenceThicknessMaximum.value=T.iridescenceThicknessRange[1],T.iridescenceMap&&(S.iridescenceMap.value=T.iridescenceMap,t(T.iridescenceMap,S.iridescenceMapTransform)),T.iridescenceThicknessMap&&(S.iridescenceThicknessMap.value=T.iridescenceThicknessMap,t(T.iridescenceThicknessMap,S.iridescenceThicknessMapTransform))),T.transmission>0&&(S.transmission.value=T.transmission,S.transmissionSamplerMap.value=A.texture,S.transmissionSamplerSize.value.set(A.width,A.height),T.transmissionMap&&(S.transmissionMap.value=T.transmissionMap,t(T.transmissionMap,S.transmissionMapTransform)),S.thickness.value=T.thickness,T.thicknessMap&&(S.thicknessMap.value=T.thicknessMap,t(T.thicknessMap,S.thicknessMapTransform)),S.attenuationDistance.value=T.attenuationDistance,S.attenuationColor.value.copy(T.attenuationColor)),T.anisotropy>0&&(S.anisotropyVector.value.set(T.anisotropy*Math.cos(T.anisotropyRotation),T.anisotropy*Math.sin(T.anisotropyRotation)),T.anisotropyMap&&(S.anisotropyMap.value=T.anisotropyMap,t(T.anisotropyMap,S.anisotropyMapTransform))),S.specularIntensity.value=T.specularIntensity,S.specularColor.value.copy(T.specularColor),T.specularColorMap&&(S.specularColorMap.value=T.specularColorMap,t(T.specularColorMap,S.specularColorMapTransform)),T.specularIntensityMap&&(S.specularIntensityMap.value=T.specularIntensityMap,t(T.specularIntensityMap,S.specularIntensityMapTransform))}function _(S,T){T.matcap&&(S.matcap.value=T.matcap)}function y(S,T){const A=e.get(T).light;S.referencePosition.value.setFromMatrixPosition(A.matrixWorld),S.nearDistance.value=A.shadow.camera.near,S.farDistance.value=A.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function EK(n,e,t,r){let i={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function c(A,R){const I=R.program;r.uniformBlockBinding(A,I)}function l(A,R){let I=i[A.id];I===void 0&&(_(A),I=u(A),i[A.id]=I,A.addEventListener("dispose",S));const U=R.program;r.updateUBOMapping(A,U);const D=e.render.frame;s[A.id]!==D&&(d(A),s[A.id]=D)}function u(A){const R=h();A.__bindingPointIndex=R;const I=n.createBuffer(),U=A.__size,D=A.usage;return n.bindBuffer(n.UNIFORM_BUFFER,I),n.bufferData(n.UNIFORM_BUFFER,U,D),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,R,I),I}function h(){for(let A=0;A<a;A++)if(o.indexOf(A)===-1)return o.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(A){const R=i[A.id],I=A.uniforms,U=A.__cache;n.bindBuffer(n.UNIFORM_BUFFER,R);for(let D=0,L=I.length;D<L;D++){const z=Array.isArray(I[D])?I[D]:[I[D]];for(let F=0,V=z.length;F<V;F++){const W=z[F];if(p(W,D,F,U)===!0){const X=W.__offset,$=Array.isArray(W.value)?W.value:[W.value];let K=0;for(let te=0;te<$.length;te++){const Q=$[te],ne=y(Q);typeof Q=="number"||typeof Q=="boolean"?(W.__data[0]=Q,n.bufferSubData(n.UNIFORM_BUFFER,X+K,W.__data)):Q.isMatrix3?(W.__data[0]=Q.elements[0],W.__data[1]=Q.elements[1],W.__data[2]=Q.elements[2],W.__data[3]=0,W.__data[4]=Q.elements[3],W.__data[5]=Q.elements[4],W.__data[6]=Q.elements[5],W.__data[7]=0,W.__data[8]=Q.elements[6],W.__data[9]=Q.elements[7],W.__data[10]=Q.elements[8],W.__data[11]=0):(Q.toArray(W.__data,K),K+=ne.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,X,W.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(A,R,I,U){const D=A.value,L=R+"_"+I;if(U[L]===void 0)return typeof D=="number"||typeof D=="boolean"?U[L]=D:U[L]=D.clone(),!0;{const z=U[L];if(typeof D=="number"||typeof D=="boolean"){if(z!==D)return U[L]=D,!0}else if(z.equals(D)===!1)return z.copy(D),!0}return!1}function _(A){const R=A.uniforms;let I=0;const U=16;for(let L=0,z=R.length;L<z;L++){const F=Array.isArray(R[L])?R[L]:[R[L]];for(let V=0,W=F.length;V<W;V++){const X=F[V],$=Array.isArray(X.value)?X.value:[X.value];for(let K=0,te=$.length;K<te;K++){const Q=$[K],ne=y(Q),G=I%U,J=G%ne.boundary,re=G+J;I+=J,re!==0&&U-re<ne.storage&&(I+=U-re),X.__data=new Float32Array(ne.storage/Float32Array.BYTES_PER_ELEMENT),X.__offset=I,I+=ne.storage}}}const D=I%U;return D>0&&(I+=U-D),A.__size=I,A.__cache={},this}function y(A){const R={boundary:0,storage:0};return typeof A=="number"||typeof A=="boolean"?(R.boundary=4,R.storage=4):A.isVector2?(R.boundary=8,R.storage=8):A.isVector3||A.isColor?(R.boundary=16,R.storage=12):A.isVector4?(R.boundary=16,R.storage=16):A.isMatrix3?(R.boundary=48,R.storage=48):A.isMatrix4?(R.boundary=64,R.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),R}function S(A){const R=A.target;R.removeEventListener("dispose",S);const I=o.indexOf(R.__bindingPointIndex);o.splice(I,1),n.deleteBuffer(i[R.id]),delete i[R.id],delete s[R.id]}function T(){for(const A in i)n.deleteBuffer(i[A]);o=[],i={},s={}}return{bind:c,update:l,dispose:T}}class bK{constructor(e={}){const{canvas:t=u$(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let p;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=r.getContextAttributes().alpha}else p=o;const _=new Uint32Array(4),y=new Int32Array(4);let S=null,T=null;const A=[],R=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=yo,this.toneMapping=mf,this.toneMappingExposure=1;const I=this;let U=!1,D=0,L=0,z=null,F=-1,V=null;const W=new Eo,X=new Eo;let $=null;const K=new pi(0);let te=0,Q=t.width,ne=t.height,G=1,J=null,re=null;const ue=new Eo(0,0,Q,ne),ye=new Eo(0,0,Q,ne);let Ne=!1;const _e=new pB;let Ae=!1,Ye=!1;const Ze=new oo,Ke=new oo,It=new qe,Xt=new Eo,Qt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Kt=!1;function xn(){return z===null?G:1}let Re=r;function St(le,Ie){return t.getContext(le,Ie)}try{const le={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ow}`),t.addEventListener("webglcontextlost",ht,!1),t.addEventListener("webglcontextrestored",Ht,!1),t.addEventListener("webglcontextcreationerror",Lt,!1),Re===null){const Ie="webgl2";if(Re=St(Ie,le),Re===null)throw St(Ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(le){throw console.error("THREE.WebGLRenderer: "+le.message),le}let Qe,nn,Ot,rt,nt,pe,oe,ke,Je,ut,ot,cn,Dt,Wt,or,xt,bt,Ft,Un,Zt,Ir,Et,ii,Me;function Nt(){Qe=new Rq(Re),Qe.init(),Et=new dK(Re,Qe),nn=new Eq(Re,Qe,e,Et),Ot=new lK(Re,Qe),nn.reverseDepthBuffer&&d&&Ot.buffers.depth.setReversed(!0),rt=new Iq(Re),nt=new XX,pe=new hK(Re,Qe,Ot,nt,nn,Et,rt),oe=new Tq(I),ke=new Cq(I),Je=new U$(Re),ii=new yq(Re,Je),ut=new Aq(Re,Je,rt,ii),ot=new Oq(Re,ut,Je,rt),Un=new kq(Re,nn,pe),xt=new bq(nt),cn=new qX(I,oe,ke,Qe,nn,ii,xt),Dt=new SK(I,nt),Wt=new YX,or=new nK(Qe),Ft=new vq(I,oe,ke,Ot,ot,p,c),bt=new aK(I,ot,nn),Me=new EK(Re,rt,nn,Ot),Zt=new Sq(Re,Qe,rt),Ir=new Mq(Re,Qe,rt),rt.programs=cn.programs,I.capabilities=nn,I.extensions=Qe,I.properties=nt,I.renderLists=Wt,I.shadowMap=bt,I.state=Ot,I.info=rt}Nt();const et=new vK(I,Re);this.xr=et,this.getContext=function(){return Re},this.getContextAttributes=function(){return Re.getContextAttributes()},this.forceContextLoss=function(){const le=Qe.get("WEBGL_lose_context");le&&le.loseContext()},this.forceContextRestore=function(){const le=Qe.get("WEBGL_lose_context");le&&le.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(le){le!==void 0&&(G=le,this.setSize(Q,ne,!1))},this.getSize=function(le){return le.set(Q,ne)},this.setSize=function(le,Ie,Ge=!0){if(et.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=le,ne=Ie,t.width=Math.floor(le*G),t.height=Math.floor(Ie*G),Ge===!0&&(t.style.width=le+"px",t.style.height=Ie+"px"),this.setViewport(0,0,le,Ie)},this.getDrawingBufferSize=function(le){return le.set(Q*G,ne*G).floor()},this.setDrawingBufferSize=function(le,Ie,Ge){Q=le,ne=Ie,G=Ge,t.width=Math.floor(le*Ge),t.height=Math.floor(Ie*Ge),this.setViewport(0,0,le,Ie)},this.getCurrentViewport=function(le){return le.copy(W)},this.getViewport=function(le){return le.copy(ue)},this.setViewport=function(le,Ie,Ge,Xe){le.isVector4?ue.set(le.x,le.y,le.z,le.w):ue.set(le,Ie,Ge,Xe),Ot.viewport(W.copy(ue).multiplyScalar(G).round())},this.getScissor=function(le){return le.copy(ye)},this.setScissor=function(le,Ie,Ge,Xe){le.isVector4?ye.set(le.x,le.y,le.z,le.w):ye.set(le,Ie,Ge,Xe),Ot.scissor(X.copy(ye).multiplyScalar(G).round())},this.getScissorTest=function(){return Ne},this.setScissorTest=function(le){Ot.setScissorTest(Ne=le)},this.setOpaqueSort=function(le){J=le},this.setTransparentSort=function(le){re=le},this.getClearColor=function(le){return le.copy(Ft.getClearColor())},this.setClearColor=function(){Ft.setClearColor.apply(Ft,arguments)},this.getClearAlpha=function(){return Ft.getClearAlpha()},this.setClearAlpha=function(){Ft.setClearAlpha.apply(Ft,arguments)},this.clear=function(le=!0,Ie=!0,Ge=!0){let Xe=0;if(le){let Pe=!1;if(z!==null){const wt=z.texture.format;Pe=wt===Pw||wt===JI||wt===YI}if(Pe){const wt=z.texture.type,Ut=wt===Ec||wt===Pg||wt===VS||wt===s_||wt===XI||wt===KI,tn=Ft.getClearColor(),sn=Ft.getClearAlpha(),In=tn.r,Hn=tn.g,ln=tn.b;Ut?(_[0]=In,_[1]=Hn,_[2]=ln,_[3]=sn,Re.clearBufferuiv(Re.COLOR,0,_)):(y[0]=In,y[1]=Hn,y[2]=ln,y[3]=sn,Re.clearBufferiv(Re.COLOR,0,y))}else Xe|=Re.COLOR_BUFFER_BIT}Ie&&(Xe|=Re.DEPTH_BUFFER_BIT),Ge&&(Xe|=Re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Re.clear(Xe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ht,!1),t.removeEventListener("webglcontextrestored",Ht,!1),t.removeEventListener("webglcontextcreationerror",Lt,!1),Wt.dispose(),or.dispose(),nt.dispose(),oe.dispose(),ke.dispose(),ot.dispose(),ii.dispose(),Me.dispose(),cn.dispose(),et.dispose(),et.removeEventListener("sessionstart",Qn),et.removeEventListener("sessionend",Fn),en.stop()};function ht(le){le.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),U=!0}function Ht(){console.log("THREE.WebGLRenderer: Context Restored."),U=!1;const le=rt.autoReset,Ie=bt.enabled,Ge=bt.autoUpdate,Xe=bt.needsUpdate,Pe=bt.type;Nt(),rt.autoReset=le,bt.enabled=Ie,bt.autoUpdate=Ge,bt.needsUpdate=Xe,bt.type=Pe}function Lt(le){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",le.statusMessage)}function Ee(le){const Ie=le.target;Ie.removeEventListener("dispose",Ee),ze(Ie)}function ze(le){st(le),nt.remove(le)}function st(le){const Ie=nt.get(le).programs;Ie!==void 0&&(Ie.forEach(function(Ge){cn.releaseProgram(Ge)}),le.isShaderMaterial&&cn.releaseShaderCache(le))}this.renderBufferDirect=function(le,Ie,Ge,Xe,Pe,wt){Ie===null&&(Ie=Qt);const Ut=Pe.isMesh&&Pe.matrixWorld.determinant()<0,tn=dh(le,Ie,Ge,Xe,Pe);Ot.setMaterial(Xe,Ut);let sn=Ge.index,In=1;if(Xe.wireframe===!0){if(sn=ut.getWireframeAttribute(Ge),sn===void 0)return;In=2}const Hn=Ge.drawRange,ln=Ge.attributes.position;let ur=Hn.start*In,Or=(Hn.start+Hn.count)*In;wt!==null&&(ur=Math.max(ur,wt.start*In),Or=Math.min(Or,(wt.start+wt.count)*In)),sn!==null?(ur=Math.max(ur,0),Or=Math.min(Or,sn.count)):ln!=null&&(ur=Math.max(ur,0),Or=Math.min(Or,ln.count));const fn=Or-ur;if(fn<0||fn===1/0)return;ii.setup(Pe,Xe,tn,Ge,sn);let On,hr=Zt;if(sn!==null&&(On=Je.get(sn),hr=Ir,hr.setIndex(On)),Pe.isMesh)Xe.wireframe===!0?(Ot.setLineWidth(Xe.wireframeLinewidth*xn()),hr.setMode(Re.LINES)):hr.setMode(Re.TRIANGLES);else if(Pe.isLine){let Gt=Xe.linewidth;Gt===void 0&&(Gt=1),Ot.setLineWidth(Gt*xn()),Pe.isLineSegments?hr.setMode(Re.LINES):Pe.isLineLoop?hr.setMode(Re.LINE_LOOP):hr.setMode(Re.LINE_STRIP)}else Pe.isPoints?hr.setMode(Re.POINTS):Pe.isSprite&&hr.setMode(Re.TRIANGLES);if(Pe.isBatchedMesh)if(Pe._multiDrawInstances!==null)hr.renderMultiDrawInstances(Pe._multiDrawStarts,Pe._multiDrawCounts,Pe._multiDrawCount,Pe._multiDrawInstances);else if(Qe.get("WEBGL_multi_draw"))hr.renderMultiDraw(Pe._multiDrawStarts,Pe._multiDrawCounts,Pe._multiDrawCount);else{const Gt=Pe._multiDrawStarts,Pi=Pe._multiDrawCounts,dr=Pe._multiDrawCount,ws=sn?Je.get(sn).bytesPerElement:1,Gn=nt.get(Xe).currentProgram.getUniforms();for(let Zn=0;Zn<dr;Zn++)Gn.setValue(Re,"_gl_DrawID",Zn),hr.render(Gt[Zn]/ws,Pi[Zn])}else if(Pe.isInstancedMesh)hr.renderInstances(ur,fn,Pe.count);else if(Ge.isInstancedBufferGeometry){const Gt=Ge._maxInstanceCount!==void 0?Ge._maxInstanceCount:1/0,Pi=Math.min(Ge.instanceCount,Gt);hr.renderInstances(ur,fn,Pi)}else hr.render(ur,fn)};function ct(le,Ie,Ge){le.transparent===!0&&le.side===gu&&le.forceSinglePass===!1?(le.side=Da,le.needsUpdate=!0,$r(le,Ie,Ge),le.side=am,le.needsUpdate=!0,$r(le,Ie,Ge),le.side=gu):$r(le,Ie,Ge)}this.compile=function(le,Ie,Ge=null){Ge===null&&(Ge=le),T=or.get(Ge),T.init(Ie),R.push(T),Ge.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(Ie.layers)&&(T.pushLight(Pe),Pe.castShadow&&T.pushShadow(Pe))}),le!==Ge&&le.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(Ie.layers)&&(T.pushLight(Pe),Pe.castShadow&&T.pushShadow(Pe))}),T.setupLights();const Xe=new Set;return le.traverse(function(Pe){if(!(Pe.isMesh||Pe.isPoints||Pe.isLine||Pe.isSprite))return;const wt=Pe.material;if(wt)if(Array.isArray(wt))for(let Ut=0;Ut<wt.length;Ut++){const tn=wt[Ut];ct(tn,Ge,Pe),Xe.add(tn)}else ct(wt,Ge,Pe),Xe.add(wt)}),R.pop(),T=null,Xe},this.compileAsync=function(le,Ie,Ge=null){const Xe=this.compile(le,Ie,Ge);return new Promise(Pe=>{function wt(){if(Xe.forEach(function(Ut){nt.get(Ut).currentProgram.isReady()&&Xe.delete(Ut)}),Xe.size===0){Pe(le);return}setTimeout(wt,10)}Qe.get("KHR_parallel_shader_compile")!==null?wt():setTimeout(wt,10)})};let Rn=null;function Br(le){Rn&&Rn(le)}function Qn(){en.stop()}function Fn(){en.start()}const en=new mB;en.setAnimationLoop(Br),typeof self<"u"&&en.setContext(self),this.setAnimationLoop=function(le){Rn=le,et.setAnimationLoop(le),le===null?en.stop():en.start()},et.addEventListener("sessionstart",Qn),et.addEventListener("sessionend",Fn),this.render=function(le,Ie){if(Ie!==void 0&&Ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(U===!0)return;if(le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Ie.parent===null&&Ie.matrixWorldAutoUpdate===!0&&Ie.updateMatrixWorld(),et.enabled===!0&&et.isPresenting===!0&&(et.cameraAutoUpdate===!0&&et.updateCamera(Ie),Ie=et.getCamera()),le.isScene===!0&&le.onBeforeRender(I,le,Ie,z),T=or.get(le,R.length),T.init(Ie),R.push(T),Ke.multiplyMatrices(Ie.projectionMatrix,Ie.matrixWorldInverse),_e.setFromProjectionMatrix(Ke),Ye=this.localClippingEnabled,Ae=xt.init(this.clippingPlanes,Ye),S=Wt.get(le,A.length),S.init(),A.push(S),et.enabled===!0&&et.isPresenting===!0){const wt=I.xr.getDepthSensingMesh();wt!==null&&zt(wt,Ie,-1/0,I.sortObjects)}zt(le,Ie,0,I.sortObjects),S.finish(),I.sortObjects===!0&&S.sort(J,re),Kt=et.enabled===!1||et.isPresenting===!1||et.hasDepthSensing()===!1,Kt&&Ft.addToRenderList(S,le),this.info.render.frame++,Ae===!0&&xt.beginShadows();const Ge=T.state.shadowsArray;bt.render(Ge,le,Ie),Ae===!0&&xt.endShadows(),this.info.autoReset===!0&&this.info.reset();const Xe=S.opaque,Pe=S.transmissive;if(T.setupLights(),Ie.isArrayCamera){const wt=Ie.cameras;if(Pe.length>0)for(let Ut=0,tn=wt.length;Ut<tn;Ut++){const sn=wt[Ut];vn(Xe,Pe,le,sn)}Kt&&Ft.render(le);for(let Ut=0,tn=wt.length;Ut<tn;Ut++){const sn=wt[Ut];_n(S,le,sn,sn.viewport)}}else Pe.length>0&&vn(Xe,Pe,le,Ie),Kt&&Ft.render(le),_n(S,le,Ie);z!==null&&(pe.updateMultisampleRenderTarget(z),pe.updateRenderTargetMipmap(z)),le.isScene===!0&&le.onAfterRender(I,le,Ie),ii.resetDefaultState(),F=-1,V=null,R.pop(),R.length>0?(T=R[R.length-1],Ae===!0&&xt.setGlobalState(I.clippingPlanes,T.state.camera)):T=null,A.pop(),A.length>0?S=A[A.length-1]:S=null};function zt(le,Ie,Ge,Xe){if(le.visible===!1)return;if(le.layers.test(Ie.layers)){if(le.isGroup)Ge=le.renderOrder;else if(le.isLOD)le.autoUpdate===!0&&le.update(Ie);else if(le.isLight)T.pushLight(le),le.castShadow&&T.pushShadow(le);else if(le.isSprite){if(!le.frustumCulled||_e.intersectsSprite(le)){Xe&&Xt.setFromMatrixPosition(le.matrixWorld).applyMatrix4(Ke);const Ut=ot.update(le),tn=le.material;tn.visible&&S.push(le,Ut,tn,Ge,Xt.z,null)}}else if((le.isMesh||le.isLine||le.isPoints)&&(!le.frustumCulled||_e.intersectsObject(le))){const Ut=ot.update(le),tn=le.material;if(Xe&&(le.boundingSphere!==void 0?(le.boundingSphere===null&&le.computeBoundingSphere(),Xt.copy(le.boundingSphere.center)):(Ut.boundingSphere===null&&Ut.computeBoundingSphere(),Xt.copy(Ut.boundingSphere.center)),Xt.applyMatrix4(le.matrixWorld).applyMatrix4(Ke)),Array.isArray(tn)){const sn=Ut.groups;for(let In=0,Hn=sn.length;In<Hn;In++){const ln=sn[In],ur=tn[ln.materialIndex];ur&&ur.visible&&S.push(le,Ut,ur,Ge,Xt.z,ln)}}else tn.visible&&S.push(le,Ut,tn,Ge,Xt.z,null)}}const wt=le.children;for(let Ut=0,tn=wt.length;Ut<tn;Ut++)zt(wt[Ut],Ie,Ge,Xe)}function _n(le,Ie,Ge,Xe){const Pe=le.opaque,wt=le.transmissive,Ut=le.transparent;T.setupLightsView(Ge),Ae===!0&&xt.setGlobalState(I.clippingPlanes,Ge),Xe&&Ot.viewport(W.copy(Xe)),Pe.length>0&&lr(Pe,Ie,Ge),wt.length>0&&lr(wt,Ie,Ge),Ut.length>0&&lr(Ut,Ie,Ge),Ot.buffers.depth.setTest(!0),Ot.buffers.depth.setMask(!0),Ot.buffers.color.setMask(!0),Ot.setPolygonOffset(!1)}function vn(le,Ie,Ge,Xe){if((Ge.isScene===!0?Ge.overrideMaterial:null)!==null)return;T.state.transmissionRenderTarget[Xe.id]===void 0&&(T.state.transmissionRenderTarget[Xe.id]=new Tu(1,1,{generateMipmaps:!0,type:Qe.has("EXT_color_buffer_half_float")||Qe.has("EXT_color_buffer_float")?Ny:Ec,minFilter:X0,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Si.workingColorSpace}));const wt=T.state.transmissionRenderTarget[Xe.id],Ut=Xe.viewport||W;wt.setSize(Ut.z,Ut.w);const tn=I.getRenderTarget();I.setRenderTarget(wt),I.getClearColor(K),te=I.getClearAlpha(),te<1&&I.setClearColor(16777215,.5),I.clear(),Kt&&Ft.render(Ge);const sn=I.toneMapping;I.toneMapping=mf;const In=Xe.viewport;if(Xe.viewport!==void 0&&(Xe.viewport=void 0),T.setupLightsView(Xe),Ae===!0&&xt.setGlobalState(I.clippingPlanes,Xe),lr(le,Ge,Xe),pe.updateMultisampleRenderTarget(wt),pe.updateRenderTargetMipmap(wt),Qe.has("WEBGL_multisampled_render_to_texture")===!1){let Hn=!1;for(let ln=0,ur=Ie.length;ln<ur;ln++){const Or=Ie[ln],fn=Or.object,On=Or.geometry,hr=Or.material,Gt=Or.group;if(hr.side===gu&&fn.layers.test(Xe.layers)){const Pi=hr.side;hr.side=Da,hr.needsUpdate=!0,Qr(fn,Ge,Xe,On,hr,Gt),hr.side=Pi,hr.needsUpdate=!0,Hn=!0}}Hn===!0&&(pe.updateMultisampleRenderTarget(wt),pe.updateRenderTargetMipmap(wt))}I.setRenderTarget(tn),I.setClearColor(K,te),In!==void 0&&(Xe.viewport=In),I.toneMapping=sn}function lr(le,Ie,Ge){const Xe=Ie.isScene===!0?Ie.overrideMaterial:null;for(let Pe=0,wt=le.length;Pe<wt;Pe++){const Ut=le[Pe],tn=Ut.object,sn=Ut.geometry,In=Xe===null?Ut.material:Xe,Hn=Ut.group;tn.layers.test(Ge.layers)&&Qr(tn,Ie,Ge,sn,In,Hn)}}function Qr(le,Ie,Ge,Xe,Pe,wt){le.onBeforeRender(I,Ie,Ge,Xe,Pe,wt),le.modelViewMatrix.multiplyMatrices(Ge.matrixWorldInverse,le.matrixWorld),le.normalMatrix.getNormalMatrix(le.modelViewMatrix),Pe.onBeforeRender(I,Ie,Ge,Xe,le,wt),Pe.transparent===!0&&Pe.side===gu&&Pe.forceSinglePass===!1?(Pe.side=Da,Pe.needsUpdate=!0,I.renderBufferDirect(Ge,Ie,Xe,Pe,le,wt),Pe.side=am,Pe.needsUpdate=!0,I.renderBufferDirect(Ge,Ie,Xe,Pe,le,wt),Pe.side=gu):I.renderBufferDirect(Ge,Ie,Xe,Pe,le,wt),le.onAfterRender(I,Ie,Ge,Xe,Pe,wt)}function $r(le,Ie,Ge){Ie.isScene!==!0&&(Ie=Qt);const Xe=nt.get(le),Pe=T.state.lights,wt=T.state.shadowsArray,Ut=Pe.state.version,tn=cn.getParameters(le,Pe.state,wt,Ie,Ge),sn=cn.getProgramCacheKey(tn);let In=Xe.programs;Xe.environment=le.isMeshStandardMaterial?Ie.environment:null,Xe.fog=Ie.fog,Xe.envMap=(le.isMeshStandardMaterial?ke:oe).get(le.envMap||Xe.environment),Xe.envMapRotation=Xe.environment!==null&&le.envMap===null?Ie.environmentRotation:le.envMapRotation,In===void 0&&(le.addEventListener("dispose",Ee),In=new Map,Xe.programs=In);let Hn=In.get(sn);if(Hn!==void 0){if(Xe.currentProgram===Hn&&Xe.lightsStateVersion===Ut)return $l(le,tn),Hn}else tn.uniforms=cn.getUniforms(le),le.onBeforeCompile(tn,I),Hn=cn.acquireProgram(tn,sn),In.set(sn,Hn),Xe.uniforms=tn.uniforms;const ln=Xe.uniforms;return(!le.isShaderMaterial&&!le.isRawShaderMaterial||le.clipping===!0)&&(ln.clippingPlanes=xt.uniform),$l(le,tn),Xe.needsLights=pd(le),Xe.lightsStateVersion=Ut,Xe.needsLights&&(ln.ambientLightColor.value=Pe.state.ambient,ln.lightProbe.value=Pe.state.probe,ln.directionalLights.value=Pe.state.directional,ln.directionalLightShadows.value=Pe.state.directionalShadow,ln.spotLights.value=Pe.state.spot,ln.spotLightShadows.value=Pe.state.spotShadow,ln.rectAreaLights.value=Pe.state.rectArea,ln.ltc_1.value=Pe.state.rectAreaLTC1,ln.ltc_2.value=Pe.state.rectAreaLTC2,ln.pointLights.value=Pe.state.point,ln.pointLightShadows.value=Pe.state.pointShadow,ln.hemisphereLights.value=Pe.state.hemi,ln.directionalShadowMap.value=Pe.state.directionalShadowMap,ln.directionalShadowMatrix.value=Pe.state.directionalShadowMatrix,ln.spotShadowMap.value=Pe.state.spotShadowMap,ln.spotLightMatrix.value=Pe.state.spotLightMatrix,ln.spotLightMap.value=Pe.state.spotLightMap,ln.pointShadowMap.value=Pe.state.pointShadowMap,ln.pointShadowMatrix.value=Pe.state.pointShadowMatrix),Xe.currentProgram=Hn,Xe.uniformsList=null,Hn}function co(le){if(le.uniformsList===null){const Ie=le.currentProgram.getUniforms();le.uniformsList=FT.seqWithValue(Ie.seq,le.uniforms)}return le.uniformsList}function $l(le,Ie){const Ge=nt.get(le);Ge.outputColorSpace=Ie.outputColorSpace,Ge.batching=Ie.batching,Ge.batchingColor=Ie.batchingColor,Ge.instancing=Ie.instancing,Ge.instancingColor=Ie.instancingColor,Ge.instancingMorph=Ie.instancingMorph,Ge.skinning=Ie.skinning,Ge.morphTargets=Ie.morphTargets,Ge.morphNormals=Ie.morphNormals,Ge.morphColors=Ie.morphColors,Ge.morphTargetsCount=Ie.morphTargetsCount,Ge.numClippingPlanes=Ie.numClippingPlanes,Ge.numIntersection=Ie.numClipIntersection,Ge.vertexAlphas=Ie.vertexAlphas,Ge.vertexTangents=Ie.vertexTangents,Ge.toneMapping=Ie.toneMapping}function dh(le,Ie,Ge,Xe,Pe){Ie.isScene!==!0&&(Ie=Qt),pe.resetTextureUnits();const wt=Ie.fog,Ut=Xe.isMeshStandardMaterial?Ie.environment:null,tn=z===null?I.outputColorSpace:z.isXRRenderTarget===!0?z.texture.colorSpace:Xg,sn=(Xe.isMeshStandardMaterial?ke:oe).get(Xe.envMap||Ut),In=Xe.vertexColors===!0&&!!Ge.attributes.color&&Ge.attributes.color.itemSize===4,Hn=!!Ge.attributes.tangent&&(!!Xe.normalMap||Xe.anisotropy>0),ln=!!Ge.morphAttributes.position,ur=!!Ge.morphAttributes.normal,Or=!!Ge.morphAttributes.color;let fn=mf;Xe.toneMapped&&(z===null||z.isXRRenderTarget===!0)&&(fn=I.toneMapping);const On=Ge.morphAttributes.position||Ge.morphAttributes.normal||Ge.morphAttributes.color,hr=On!==void 0?On.length:0,Gt=nt.get(Xe),Pi=T.state.lights;if(Ae===!0&&(Ye===!0||le!==V)){const Di=le===V&&Xe.id===F;xt.setState(Xe,le,Di)}let dr=!1;Xe.version===Gt.__version?(Gt.needsLights&&Gt.lightsStateVersion!==Pi.state.version||Gt.outputColorSpace!==tn||Pe.isBatchedMesh&&Gt.batching===!1||!Pe.isBatchedMesh&&Gt.batching===!0||Pe.isBatchedMesh&&Gt.batchingColor===!0&&Pe.colorTexture===null||Pe.isBatchedMesh&&Gt.batchingColor===!1&&Pe.colorTexture!==null||Pe.isInstancedMesh&&Gt.instancing===!1||!Pe.isInstancedMesh&&Gt.instancing===!0||Pe.isSkinnedMesh&&Gt.skinning===!1||!Pe.isSkinnedMesh&&Gt.skinning===!0||Pe.isInstancedMesh&&Gt.instancingColor===!0&&Pe.instanceColor===null||Pe.isInstancedMesh&&Gt.instancingColor===!1&&Pe.instanceColor!==null||Pe.isInstancedMesh&&Gt.instancingMorph===!0&&Pe.morphTexture===null||Pe.isInstancedMesh&&Gt.instancingMorph===!1&&Pe.morphTexture!==null||Gt.envMap!==sn||Xe.fog===!0&&Gt.fog!==wt||Gt.numClippingPlanes!==void 0&&(Gt.numClippingPlanes!==xt.numPlanes||Gt.numIntersection!==xt.numIntersection)||Gt.vertexAlphas!==In||Gt.vertexTangents!==Hn||Gt.morphTargets!==ln||Gt.morphNormals!==ur||Gt.morphColors!==Or||Gt.toneMapping!==fn||Gt.morphTargetsCount!==hr)&&(dr=!0):(dr=!0,Gt.__version=Xe.version);let ws=Gt.currentProgram;dr===!0&&(ws=$r(Xe,Ie,Pe));let Gn=!1,Zn=!1,cl=!1;const hi=ws.getUniforms(),lo=Gt.uniforms;if(Ot.useProgram(ws.program)&&(Gn=!0,Zn=!0,cl=!0),Xe.id!==F&&(F=Xe.id,Zn=!0),Gn||V!==le){Ot.buffers.depth.getReversed()?(Ze.copy(le.projectionMatrix),d$(Ze),f$(Ze),hi.setValue(Re,"projectionMatrix",Ze)):hi.setValue(Re,"projectionMatrix",le.projectionMatrix),hi.setValue(Re,"viewMatrix",le.matrixWorldInverse);const an=hi.map.cameraPosition;an!==void 0&&an.setValue(Re,It.setFromMatrixPosition(le.matrixWorld)),nn.logarithmicDepthBuffer&&hi.setValue(Re,"logDepthBufFC",2/(Math.log(le.far+1)/Math.LN2)),(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial)&&hi.setValue(Re,"isOrthographic",le.isOrthographicCamera===!0),V!==le&&(V=le,Zn=!0,cl=!0)}if(Pe.isSkinnedMesh){hi.setOptional(Re,Pe,"bindMatrix"),hi.setOptional(Re,Pe,"bindMatrixInverse");const Di=Pe.skeleton;Di&&(Di.boneTexture===null&&Di.computeBoneTexture(),hi.setValue(Re,"boneTexture",Di.boneTexture,pe))}Pe.isBatchedMesh&&(hi.setOptional(Re,Pe,"batchingTexture"),hi.setValue(Re,"batchingTexture",Pe._matricesTexture,pe),hi.setOptional(Re,Pe,"batchingIdTexture"),hi.setValue(Re,"batchingIdTexture",Pe._indirectTexture,pe),hi.setOptional(Re,Pe,"batchingColorTexture"),Pe._colorsTexture!==null&&hi.setValue(Re,"batchingColorTexture",Pe._colorsTexture,pe));const ll=Ge.morphAttributes;if((ll.position!==void 0||ll.normal!==void 0||ll.color!==void 0)&&Un.update(Pe,Ge,ws),(Zn||Gt.receiveShadow!==Pe.receiveShadow)&&(Gt.receiveShadow=Pe.receiveShadow,hi.setValue(Re,"receiveShadow",Pe.receiveShadow)),Xe.isMeshGouraudMaterial&&Xe.envMap!==null&&(lo.envMap.value=sn,lo.flipEnvMap.value=sn.isCubeTexture&&sn.isRenderTargetTexture===!1?-1:1),Xe.isMeshStandardMaterial&&Xe.envMap===null&&Ie.environment!==null&&(lo.envMapIntensity.value=Ie.environmentIntensity),Zn&&(hi.setValue(Re,"toneMappingExposure",I.toneMappingExposure),Gt.needsLights&&fd(lo,cl),wt&&Xe.fog===!0&&Dt.refreshFogUniforms(lo,wt),Dt.refreshMaterialUniforms(lo,Xe,G,ne,T.state.transmissionRenderTarget[le.id]),FT.upload(Re,co(Gt),lo,pe)),Xe.isShaderMaterial&&Xe.uniformsNeedUpdate===!0&&(FT.upload(Re,co(Gt),lo,pe),Xe.uniformsNeedUpdate=!1),Xe.isSpriteMaterial&&hi.setValue(Re,"center",Pe.center),hi.setValue(Re,"modelViewMatrix",Pe.modelViewMatrix),hi.setValue(Re,"normalMatrix",Pe.normalMatrix),hi.setValue(Re,"modelMatrix",Pe.matrixWorld),Xe.isShaderMaterial||Xe.isRawShaderMaterial){const Di=Xe.uniformsGroups;for(let an=0,Ba=Di.length;an<Ba;an++){const ul=Di[an];Me.update(ul,ws),Me.bind(ul,ws)}}return ws}function fd(le,Ie){le.ambientLightColor.needsUpdate=Ie,le.lightProbe.needsUpdate=Ie,le.directionalLights.needsUpdate=Ie,le.directionalLightShadows.needsUpdate=Ie,le.pointLights.needsUpdate=Ie,le.pointLightShadows.needsUpdate=Ie,le.spotLights.needsUpdate=Ie,le.spotLightShadows.needsUpdate=Ie,le.rectAreaLights.needsUpdate=Ie,le.hemisphereLights.needsUpdate=Ie}function pd(le){return le.isMeshLambertMaterial||le.isMeshToonMaterial||le.isMeshPhongMaterial||le.isMeshStandardMaterial||le.isShadowMaterial||le.isShaderMaterial&&le.lights===!0}this.getActiveCubeFace=function(){return D},this.getActiveMipmapLevel=function(){return L},this.getRenderTarget=function(){return z},this.setRenderTargetTextures=function(le,Ie,Ge){nt.get(le.texture).__webglTexture=Ie,nt.get(le.depthTexture).__webglTexture=Ge;const Xe=nt.get(le);Xe.__hasExternalTextures=!0,Xe.__autoAllocateDepthBuffer=Ge===void 0,Xe.__autoAllocateDepthBuffer||Qe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xe.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(le,Ie){const Ge=nt.get(le);Ge.__webglFramebuffer=Ie,Ge.__useDefaultFramebuffer=Ie===void 0},this.setRenderTarget=function(le,Ie=0,Ge=0){z=le,D=Ie,L=Ge;let Xe=!0,Pe=null,wt=!1,Ut=!1;if(le){const sn=nt.get(le);if(sn.__useDefaultFramebuffer!==void 0)Ot.bindFramebuffer(Re.FRAMEBUFFER,null),Xe=!1;else if(sn.__webglFramebuffer===void 0)pe.setupRenderTarget(le);else if(sn.__hasExternalTextures)pe.rebindTextures(le,nt.get(le.texture).__webglTexture,nt.get(le.depthTexture).__webglTexture);else if(le.depthBuffer){const ln=le.depthTexture;if(sn.__boundDepthTexture!==ln){if(ln!==null&&nt.has(ln)&&(le.width!==ln.image.width||le.height!==ln.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");pe.setupDepthRenderbuffer(le)}}const In=le.texture;(In.isData3DTexture||In.isDataArrayTexture||In.isCompressedArrayTexture)&&(Ut=!0);const Hn=nt.get(le).__webglFramebuffer;le.isWebGLCubeRenderTarget?(Array.isArray(Hn[Ie])?Pe=Hn[Ie][Ge]:Pe=Hn[Ie],wt=!0):le.samples>0&&pe.useMultisampledRTT(le)===!1?Pe=nt.get(le).__webglMultisampledFramebuffer:Array.isArray(Hn)?Pe=Hn[Ge]:Pe=Hn,W.copy(le.viewport),X.copy(le.scissor),$=le.scissorTest}else W.copy(ue).multiplyScalar(G).floor(),X.copy(ye).multiplyScalar(G).floor(),$=Ne;if(Ot.bindFramebuffer(Re.FRAMEBUFFER,Pe)&&Xe&&Ot.drawBuffers(le,Pe),Ot.viewport(W),Ot.scissor(X),Ot.setScissorTest($),wt){const sn=nt.get(le.texture);Re.framebufferTexture2D(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,sn.__webglTexture,Ge)}else if(Ut){const sn=nt.get(le.texture),In=Ie||0;Re.framebufferTextureLayer(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,sn.__webglTexture,Ge||0,In)}F=-1},this.readRenderTargetPixels=function(le,Ie,Ge,Xe,Pe,wt,Ut){if(!(le&&le.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let tn=nt.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&Ut!==void 0&&(tn=tn[Ut]),tn){Ot.bindFramebuffer(Re.FRAMEBUFFER,tn);try{const sn=le.texture,In=sn.format,Hn=sn.type;if(!nn.textureFormatReadable(In)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!nn.textureTypeReadable(Hn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ie>=0&&Ie<=le.width-Xe&&Ge>=0&&Ge<=le.height-Pe&&Re.readPixels(Ie,Ge,Xe,Pe,Et.convert(In),Et.convert(Hn),wt)}finally{const sn=z!==null?nt.get(z).__webglFramebuffer:null;Ot.bindFramebuffer(Re.FRAMEBUFFER,sn)}}},this.readRenderTargetPixelsAsync=async function(le,Ie,Ge,Xe,Pe,wt,Ut){if(!(le&&le.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let tn=nt.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&Ut!==void 0&&(tn=tn[Ut]),tn){const sn=le.texture,In=sn.format,Hn=sn.type;if(!nn.textureFormatReadable(In))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!nn.textureTypeReadable(Hn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ie>=0&&Ie<=le.width-Xe&&Ge>=0&&Ge<=le.height-Pe){Ot.bindFramebuffer(Re.FRAMEBUFFER,tn);const ln=Re.createBuffer();Re.bindBuffer(Re.PIXEL_PACK_BUFFER,ln),Re.bufferData(Re.PIXEL_PACK_BUFFER,wt.byteLength,Re.STREAM_READ),Re.readPixels(Ie,Ge,Xe,Pe,Et.convert(In),Et.convert(Hn),0);const ur=z!==null?nt.get(z).__webglFramebuffer:null;Ot.bindFramebuffer(Re.FRAMEBUFFER,ur);const Or=Re.fenceSync(Re.SYNC_GPU_COMMANDS_COMPLETE,0);return Re.flush(),await h$(Re,Or,4),Re.bindBuffer(Re.PIXEL_PACK_BUFFER,ln),Re.getBufferSubData(Re.PIXEL_PACK_BUFFER,0,wt),Re.deleteBuffer(ln),Re.deleteSync(Or),wt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(le,Ie=null,Ge=0){le.isTexture!==!0&&(gS("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ie=arguments[0]||null,le=arguments[1]);const Xe=Math.pow(2,-Ge),Pe=Math.floor(le.image.width*Xe),wt=Math.floor(le.image.height*Xe),Ut=Ie!==null?Ie.x:0,tn=Ie!==null?Ie.y:0;pe.setTexture2D(le,0),Re.copyTexSubImage2D(Re.TEXTURE_2D,Ge,0,0,Ut,tn,Pe,wt),Ot.unbindTexture()},this.copyTextureToTexture=function(le,Ie,Ge=null,Xe=null,Pe=0){le.isTexture!==!0&&(gS("WebGLRenderer: copyTextureToTexture function signature has changed."),Xe=arguments[0]||null,le=arguments[1],Ie=arguments[2],Pe=arguments[3]||0,Ge=null);let wt,Ut,tn,sn,In,Hn,ln,ur,Or;const fn=le.isCompressedTexture?le.mipmaps[Pe]:le.image;Ge!==null?(wt=Ge.max.x-Ge.min.x,Ut=Ge.max.y-Ge.min.y,tn=Ge.isBox3?Ge.max.z-Ge.min.z:1,sn=Ge.min.x,In=Ge.min.y,Hn=Ge.isBox3?Ge.min.z:0):(wt=fn.width,Ut=fn.height,tn=fn.depth||1,sn=0,In=0,Hn=0),Xe!==null?(ln=Xe.x,ur=Xe.y,Or=Xe.z):(ln=0,ur=0,Or=0);const On=Et.convert(Ie.format),hr=Et.convert(Ie.type);let Gt;Ie.isData3DTexture?(pe.setTexture3D(Ie,0),Gt=Re.TEXTURE_3D):Ie.isDataArrayTexture||Ie.isCompressedArrayTexture?(pe.setTexture2DArray(Ie,0),Gt=Re.TEXTURE_2D_ARRAY):(pe.setTexture2D(Ie,0),Gt=Re.TEXTURE_2D),Re.pixelStorei(Re.UNPACK_FLIP_Y_WEBGL,Ie.flipY),Re.pixelStorei(Re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ie.premultiplyAlpha),Re.pixelStorei(Re.UNPACK_ALIGNMENT,Ie.unpackAlignment);const Pi=Re.getParameter(Re.UNPACK_ROW_LENGTH),dr=Re.getParameter(Re.UNPACK_IMAGE_HEIGHT),ws=Re.getParameter(Re.UNPACK_SKIP_PIXELS),Gn=Re.getParameter(Re.UNPACK_SKIP_ROWS),Zn=Re.getParameter(Re.UNPACK_SKIP_IMAGES);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,fn.width),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,fn.height),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,sn),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,In),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,Hn);const cl=le.isDataArrayTexture||le.isData3DTexture,hi=Ie.isDataArrayTexture||Ie.isData3DTexture;if(le.isRenderTargetTexture||le.isDepthTexture){const lo=nt.get(le),ll=nt.get(Ie),Di=nt.get(lo.__renderTarget),an=nt.get(ll.__renderTarget);Ot.bindFramebuffer(Re.READ_FRAMEBUFFER,Di.__webglFramebuffer),Ot.bindFramebuffer(Re.DRAW_FRAMEBUFFER,an.__webglFramebuffer);for(let Ba=0;Ba<tn;Ba++)cl&&Re.framebufferTextureLayer(Re.READ_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,nt.get(le).__webglTexture,Pe,Hn+Ba),le.isDepthTexture?(hi&&Re.framebufferTextureLayer(Re.DRAW_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,nt.get(Ie).__webglTexture,Pe,Or+Ba),Re.blitFramebuffer(sn,In,wt,Ut,ln,ur,wt,Ut,Re.DEPTH_BUFFER_BIT,Re.NEAREST)):hi?Re.copyTexSubImage3D(Gt,Pe,ln,ur,Or+Ba,sn,In,wt,Ut):Re.copyTexSubImage2D(Gt,Pe,ln,ur,Or+Ba,sn,In,wt,Ut);Ot.bindFramebuffer(Re.READ_FRAMEBUFFER,null),Ot.bindFramebuffer(Re.DRAW_FRAMEBUFFER,null)}else hi?le.isDataTexture||le.isData3DTexture?Re.texSubImage3D(Gt,Pe,ln,ur,Or,wt,Ut,tn,On,hr,fn.data):Ie.isCompressedArrayTexture?Re.compressedTexSubImage3D(Gt,Pe,ln,ur,Or,wt,Ut,tn,On,fn.data):Re.texSubImage3D(Gt,Pe,ln,ur,Or,wt,Ut,tn,On,hr,fn):le.isDataTexture?Re.texSubImage2D(Re.TEXTURE_2D,Pe,ln,ur,wt,Ut,On,hr,fn.data):le.isCompressedTexture?Re.compressedTexSubImage2D(Re.TEXTURE_2D,Pe,ln,ur,fn.width,fn.height,On,fn.data):Re.texSubImage2D(Re.TEXTURE_2D,Pe,ln,ur,wt,Ut,On,hr,fn);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,Pi),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,dr),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,ws),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,Gn),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,Zn),Pe===0&&Ie.generateMipmaps&&Re.generateMipmap(Gt),Ot.unbindTexture()},this.copyTextureToTexture3D=function(le,Ie,Ge=null,Xe=null,Pe=0){return le.isTexture!==!0&&(gS("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Ge=arguments[0]||null,Xe=arguments[1]||null,le=arguments[2],Ie=arguments[3],Pe=arguments[4]||0),gS('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(le,Ie,Ge,Xe,Pe)},this.initRenderTarget=function(le){nt.get(le).__webglFramebuffer===void 0&&pe.setupRenderTarget(le)},this.initTexture=function(le){le.isCubeTexture?pe.setTextureCube(le,0):le.isData3DTexture?pe.setTexture3D(le,0):le.isDataArrayTexture||le.isCompressedArrayTexture?pe.setTexture2DArray(le,0):pe.setTexture2D(le,0),Ot.unbindTexture()},this.resetState=function(){D=0,L=0,z=null,Ot.reset(),ii.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Jp}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Si._getDrawingBufferColorSpace(e),t.unpackColorSpace=Si._getUnpackColorSpace()}}class wx extends Nl{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new cm,this.environmentIntensity=1,this.environmentRotation=new cm,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class SB extends so{constructor(e=null,t=1,r=1,i,s,o,a,c,l=bo,u=bo,h,d){super(null,o,a,c,l,u,i,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class TK extends mm{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new pi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const fD=new oo,UA=new ZI,Xb=new Lw,Kb=new qe;class xK extends Nl{constructor(e=new sd,t=new TK){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Xb.copy(r.boundingSphere),Xb.applyMatrix4(i),Xb.radius+=s,e.ray.intersectsSphere(Xb)===!1)return;fD.copy(i).invert(),UA.copy(e.ray).applyMatrix4(fD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(l!==null){const d=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let _=d,y=p;_<y;_++){const S=l.getX(_);Kb.fromBufferAttribute(h,S),pD(Kb,S,c,i,e,t,this)}}else{const d=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let _=d,y=p;_<y;_++)Kb.fromBufferAttribute(h,_),pD(Kb,_,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function pD(n,e,t,r,i,s,o){const a=UA.distanceSqToPoint(n);if(a<t){const c=new qe;UA.closestPointToPoint(n,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class wK extends so{constructor(e,t,r,i,s,o,a,c,l){super(e,t,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class CK extends mm{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=iB,this.normalScale=new Ln(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}const mD={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class RK{constructor(e,t,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){const p=l[h],_=l[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return _}return null}}}const AK=new RK;class rk{constructor(e){this.manager=e!==void 0?e:AK,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}rk.DEFAULT_MATERIAL_NAME="__DEFAULT";class MK extends rk{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=mD.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=HS("img");function c(){u(),mD.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class ik extends rk{constructor(e){super(e)}load(e,t,r,i){const s=new so,o=new MK(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}let IK=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=gD(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=gD();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function gD(){return performance.now()}class Gi{constructor(e){this.value=e}clone(){return new Gi(this.value.clone===void 0?this.value:this.value.clone())}}const _D=new oo;class kK{constructor(e,t,r=0,i=1/0){this.ray=new ZI(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Gv,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return _D.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_D),this}intersectObject(e,t=!0,r=[]){return FA(e,this,r,t),r.sort(vD),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)FA(e[i],this,r,t);return r.sort(vD),r}}function vD(n,e){return n.distance-e.distance}function FA(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)FA(s[o],e,t,!0)}}const yD=new Ln;class OK{constructor(e=new Ln(1/0,1/0),t=new Ln(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=yD.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,yD).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ow}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ow);var EB={exports:{}},b_={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */b_.ConcurrentRoot=1;b_.ContinuousEventPriority=4;b_.DefaultEventPriority=16;b_.DiscreteEventPriority=1;b_.IdleEventPriority=536870912;b_.LegacyRoot=0;EB.exports=b_;var Nv=EB.exports;function NK(n){let e;const t=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(p=>p(e,d))}},i=()=>e,s=(l,u=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function p(){const _=u(e);if(!h(d,_)){const y=d;l(d=_,y)}}return t.add(p),()=>t.delete(p)},c={setState:r,getState:i,subscribe:(l,u,h)=>u||h?s(l,u,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(r,i,c),c}const PK=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),SD=PK?at.useEffect:at.useLayoutEffect;function DK(n){const e=typeof n=="function"?NK(n):n,t=(r=e.getState,i=Object.is)=>{const[,s]=at.useReducer(S=>S+1,0),o=e.getState(),a=at.useRef(o),c=at.useRef(r),l=at.useRef(i),u=at.useRef(!1),h=at.useRef();h.current===void 0&&(h.current=r(o));let d,p=!1;(a.current!==o||c.current!==r||l.current!==i||u.current)&&(d=r(o),p=!i(h.current,d)),SD(()=>{p&&(h.current=d),a.current=o,c.current=r,l.current=i,u.current=!1});const _=at.useRef(o);SD(()=>{const S=()=>{try{const A=e.getState(),R=c.current(A);l.current(h.current,R)||(a.current=A,h.current=R,s())}catch{u.current=!0,s()}},T=e.subscribe(S);return e.getState()!==_.current&&S(),T},[]);const y=p?d:h.current;return at.useDebugValue(y),y};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[t,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},t}const LK=n=>typeof n=="object"&&typeof n.then=="function",K0=[];function bB(n,e,t=(r,i)=>r===i){if(n===e)return!0;if(!n||!e)return!1;const r=n.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!t(n[i],e[i]))return!1;return!0}function TB(n,e=null,t=!1,r={}){e===null&&(e=[n]);for(const s of K0)if(bB(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=K0.indexOf(i);s!==-1&&K0.splice(s,1)},promise:(LK(n)?n:n(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(K0.push(i),!t)throw i.promise}const UK=(n,e,t)=>TB(n,e,!1,t),FK=(n,e,t)=>void TB(n,e,!0,t),BK=n=>{if(n===void 0||n.length===0)K0.splice(0,K0.length);else{const e=K0.find(t=>bB(n,t.keys,t.equal));e&&e.remove()}};var xB={exports:{}},wB={exports:{}},CB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(G,J){var re=G.length;G.push(J);e:for(;0<re;){var ue=re-1>>>1,ye=G[ue];if(0<i(ye,J))G[ue]=J,G[re]=ye,re=ue;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var J=G[0],re=G.pop();if(re!==J){G[0]=re;e:for(var ue=0,ye=G.length,Ne=ye>>>1;ue<Ne;){var _e=2*(ue+1)-1,Ae=G[_e],Ye=_e+1,Ze=G[Ye];if(0>i(Ae,re))Ye<ye&&0>i(Ze,Ae)?(G[ue]=Ze,G[Ye]=re,ue=Ye):(G[ue]=Ae,G[_e]=re,ue=_e);else if(Ye<ye&&0>i(Ze,re))G[ue]=Ze,G[Ye]=re,ue=Ye;else break e}}return J}function i(G,J){var re=G.sortIndex-J.sortIndex;return re!==0?re:G.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,d=3,p=!1,_=!1,y=!1,S=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(G){for(var J=t(l);J!==null;){if(J.callback===null)r(l);else if(J.startTime<=G)r(l),J.sortIndex=J.expirationTime,e(c,J);else break;J=t(l)}}function I(G){if(y=!1,R(G),!_)if(t(c)!==null)_=!0,Q(U);else{var J=t(l);J!==null&&ne(I,J.startTime-G)}}function U(G,J){_=!1,y&&(y=!1,T(z),z=-1),p=!0;var re=d;try{for(R(J),h=t(c);h!==null&&(!(h.expirationTime>J)||G&&!W());){var ue=h.callback;if(typeof ue=="function"){h.callback=null,d=h.priorityLevel;var ye=ue(h.expirationTime<=J);J=n.unstable_now(),typeof ye=="function"?h.callback=ye:h===t(c)&&r(c),R(J)}else r(c);h=t(c)}if(h!==null)var Ne=!0;else{var _e=t(l);_e!==null&&ne(I,_e.startTime-J),Ne=!1}return Ne}finally{h=null,d=re,p=!1}}var D=!1,L=null,z=-1,F=5,V=-1;function W(){return!(n.unstable_now()-V<F)}function X(){if(L!==null){var G=n.unstable_now();V=G;var J=!0;try{J=L(!0,G)}finally{J?$():(D=!1,L=null)}}else D=!1}var $;if(typeof A=="function")$=function(){A(X)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,te=K.port2;K.port1.onmessage=X,$=function(){te.postMessage(null)}}else $=function(){S(X,0)};function Q(G){L=G,D||(D=!0,$())}function ne(G,J){z=S(function(){G(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){_||p||(_=!0,Q(U))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return d},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(G){switch(d){case 1:case 2:case 3:var J=3;break;default:J=d}var re=d;d=J;try{return G()}finally{d=re}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,J){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var re=d;d=G;try{return J()}finally{d=re}},n.unstable_scheduleCallback=function(G,J,re){var ue=n.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?ue+re:ue):re=ue,G){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=re+ye,G={id:u++,callback:J,priorityLevel:G,startTime:re,expirationTime:ye,sortIndex:-1},re>ue?(G.sortIndex=re,e(l,G),t(c)===null&&G===t(l)&&(y?(T(z),z=-1):y=!0,ne(I,re-ue))):(G.sortIndex=ye,e(c,G),_||p||(_=!0,Q(U))),G},n.unstable_shouldYield=W,n.unstable_wrapCallback=function(G){var J=d;return function(){var re=d;d=J;try{return G.apply(this,arguments)}finally{d=re}}}})(CB);wB.exports=CB;var BA=wB.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zK=function(e){var t={},r=at,i=BA,s=Object.assign;function o(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),_=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),I=Symbol.for("react.offscreen"),U=Symbol.iterator;function D(f){return f===null||typeof f!="object"?null:(f=U&&f[U]||f["@@iterator"],typeof f=="function"?f:null)}function L(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case u:return"Fragment";case l:return"Portal";case d:return"Profiler";case h:return"StrictMode";case S:return"Suspense";case T:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case _:return(f.displayName||"Context")+".Consumer";case p:return(f._context.displayName||"Context")+".Provider";case y:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case A:return g=f.displayName||null,g!==null?g:L(f.type)||"Memo";case R:g=f._payload,f=f._init;try{return L(f(g))}catch{}}return null}function z(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return L(g);case 8:return g===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function F(f){var g=f,C=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,g.flags&4098&&(C=g.return),f=g.return;while(f)}return g.tag===3?C:null}function V(f){if(F(f)!==f)throw Error(o(188))}function W(f){var g=f.alternate;if(!g){if(g=F(f),g===null)throw Error(o(188));return g!==f?null:f}for(var C=f,N=g;;){var B=C.return;if(B===null)break;var Y=B.alternate;if(Y===null){if(N=B.return,N!==null){C=N;continue}break}if(B.child===Y.child){for(Y=B.child;Y;){if(Y===C)return V(B),f;if(Y===N)return V(B),g;Y=Y.sibling}throw Error(o(188))}if(C.return!==N.return)C=B,N=Y;else{for(var me=!1,xe=B.child;xe;){if(xe===C){me=!0,C=B,N=Y;break}if(xe===N){me=!0,N=B,C=Y;break}xe=xe.sibling}if(!me){for(xe=Y.child;xe;){if(xe===C){me=!0,C=Y,N=B;break}if(xe===N){me=!0,N=Y,C=B;break}xe=xe.sibling}if(!me)throw Error(o(189))}}if(C.alternate!==N)throw Error(o(190))}if(C.tag!==3)throw Error(o(188));return C.stateNode.current===C?f:g}function X(f){return f=W(f),f!==null?$(f):null}function $(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=$(f);if(g!==null)return g;f=f.sibling}return null}function K(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){if(f.tag!==4){var g=K(f);if(g!==null)return g}f=f.sibling}return null}var te=Array.isArray,Q=e.getPublicInstance,ne=e.getRootHostContext,G=e.getChildHostContext,J=e.prepareForCommit,re=e.resetAfterCommit,ue=e.createInstance,ye=e.appendInitialChild,Ne=e.finalizeInitialChildren,_e=e.prepareUpdate,Ae=e.shouldSetTextContent,Ye=e.createTextInstance,Ze=e.scheduleTimeout,Ke=e.cancelTimeout,It=e.noTimeout,Xt=e.isPrimaryRenderer,Qt=e.supportsMutation,Kt=e.supportsPersistence,xn=e.supportsHydration,Re=e.getInstanceFromNode,St=e.preparePortalMount,Qe=e.getCurrentEventPriority,nn=e.detachDeletedInstance,Ot=e.supportsMicrotasks,rt=e.scheduleMicrotask,nt=e.supportsTestSelectors,pe=e.findFiberRoot,oe=e.getBoundingRect,ke=e.getTextContent,Je=e.isHiddenSubtree,ut=e.matchAccessibilityRole,ot=e.setFocusIfFocusable,cn=e.setupIntersectionObserver,Dt=e.appendChild,Wt=e.appendChildToContainer,or=e.commitTextUpdate,xt=e.commitMount,bt=e.commitUpdate,Ft=e.insertBefore,Un=e.insertInContainerBefore,Zt=e.removeChild,Ir=e.removeChildFromContainer,Et=e.resetTextContent,ii=e.hideInstance,Me=e.hideTextInstance,Nt=e.unhideInstance,et=e.unhideTextInstance,ht=e.clearContainer,Ht=e.cloneInstance,Lt=e.createContainerChildSet,Ee=e.appendChildToContainerChildSet,ze=e.finalizeContainerChildren,st=e.replaceContainerChildren,ct=e.cloneHiddenInstance,Rn=e.cloneHiddenTextInstance,Br=e.canHydrateInstance,Qn=e.canHydrateTextInstance,Fn=e.canHydrateSuspenseInstance,en=e.isSuspenseInstancePending,zt=e.isSuspenseInstanceFallback,_n=e.registerSuspenseInstanceRetry,vn=e.getNextHydratableSibling,lr=e.getFirstHydratableChild,Qr=e.getFirstHydratableChildWithinContainer,$r=e.getFirstHydratableChildWithinSuspenseInstance,co=e.hydrateInstance,$l=e.hydrateTextInstance,dh=e.hydrateSuspenseInstance,fd=e.getNextHydratableInstanceAfterSuspenseInstance,pd=e.commitHydratedContainer,le=e.commitHydratedSuspenseInstance,Ie=e.clearSuspenseBoundary,Ge=e.clearSuspenseBoundaryFromContainer,Xe=e.shouldDeleteUnhydratedTailInstances,Pe=e.didNotMatchHydratedContainerTextInstance,wt=e.didNotMatchHydratedTextInstance,Ut;function tn(f){if(Ut===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);Ut=g&&g[1]||""}return`
`+Ut+f}var sn=!1;function In(f,g){if(!f||sn)return"";sn=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Mt){var N=Mt}Reflect.construct(f,[],g)}else{try{g.call()}catch(Mt){N=Mt}f.call(g.prototype)}else{try{throw Error()}catch(Mt){N=Mt}f()}}catch(Mt){if(Mt&&N&&typeof Mt.stack=="string"){for(var B=Mt.stack.split(`
`),Y=N.stack.split(`
`),me=B.length-1,xe=Y.length-1;1<=me&&0<=xe&&B[me]!==Y[xe];)xe--;for(;1<=me&&0<=xe;me--,xe--)if(B[me]!==Y[xe]){if(me!==1||xe!==1)do if(me--,xe--,0>xe||B[me]!==Y[xe]){var tt=`
`+B[me].replace(" at new "," at ");return f.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",f.displayName)),tt}while(1<=me&&0<=xe);break}}}finally{sn=!1,Error.prepareStackTrace=C}return(f=f?f.displayName||f.name:"")?tn(f):""}var Hn=Object.prototype.hasOwnProperty,ln=[],ur=-1;function Or(f){return{current:f}}function fn(f){0>ur||(f.current=ln[ur],ln[ur]=null,ur--)}function On(f,g){ur++,ln[ur]=f.current,f.current=g}var hr={},Gt=Or(hr),Pi=Or(!1),dr=hr;function ws(f,g){var C=f.type.contextTypes;if(!C)return hr;var N=f.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===g)return N.__reactInternalMemoizedMaskedChildContext;var B={},Y;for(Y in C)B[Y]=g[Y];return N&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=B),B}function Gn(f){return f=f.childContextTypes,f!=null}function Zn(){fn(Pi),fn(Gt)}function cl(f,g,C){if(Gt.current!==hr)throw Error(o(168));On(Gt,g),On(Pi,C)}function hi(f,g,C){var N=f.stateNode;if(g=g.childContextTypes,typeof N.getChildContext!="function")return C;N=N.getChildContext();for(var B in N)if(!(B in g))throw Error(o(108,z(f)||"Unknown",B));return s({},C,N)}function lo(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||hr,dr=Gt.current,On(Gt,f),On(Pi,Pi.current),!0}function ll(f,g,C){var N=f.stateNode;if(!N)throw Error(o(169));C?(f=hi(f,g,dr),N.__reactInternalMemoizedMergedChildContext=f,fn(Pi),fn(Gt),On(Gt,f)):fn(Pi),On(Pi,C)}var Di=Math.clz32?Math.clz32:ul,an=Math.log,Ba=Math.LN2;function ul(f){return f>>>=0,f===0?32:31-(an(f)/Ba|0)|0}var ar=64,fh=4194304;function xo(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function ph(f,g){var C=f.pendingLanes;if(C===0)return 0;var N=0,B=f.suspendedLanes,Y=f.pingedLanes,me=C&268435455;if(me!==0){var xe=me&~B;xe!==0?N=xo(xe):(Y&=me,Y!==0&&(N=xo(Y)))}else me=C&~B,me!==0?N=xo(me):Y!==0&&(N=xo(Y));if(N===0)return 0;if(g!==0&&g!==N&&!(g&B)&&(B=N&-N,Y=g&-g,B>=Y||B===16&&(Y&4194240)!==0))return g;if(N&4&&(N|=C&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=N;0<g;)C=31-Di(g),B=1<<C,N|=f[C],g&=~B;return N}function md(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ql(f,g){for(var C=f.suspendedLanes,N=f.pingedLanes,B=f.expirationTimes,Y=f.pendingLanes;0<Y;){var me=31-Di(Y),xe=1<<me,tt=B[me];tt===-1?(!(xe&C)||xe&N)&&(B[me]=md(xe,g)):tt<=g&&(f.expiredLanes|=xe),Y&=~xe}}function Wf(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function $f(f){for(var g=[],C=0;31>C;C++)g.push(f);return g}function wu(f,g,C){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Di(g),f[g]=C}function qo(f,g){var C=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var N=f.eventTimes;for(f=f.expirationTimes;0<C;){var B=31-Di(C),Y=1<<B;g[B]=0,N[B]=-1,f[B]=-1,C&=~Y}}function gd(f,g){var C=f.entangledLanes|=g;for(f=f.entanglements;C;){var N=31-Di(C),B=1<<N;B&g|f[N]&g&&(f[N]|=g),C&=~B}}var er=0;function B_(f){return f&=-f,1<f?4<f?f&268435455?16:536870912:4:1}var Mm=i.unstable_scheduleCallback,hl=i.unstable_cancelCallback,qf=i.unstable_shouldYield,Cu=i.unstable_requestPaint,pr=i.unstable_now,dl=i.unstable_ImmediatePriority,r0=i.unstable_UserBlockingPriority,Im=i.unstable_NormalPriority,km=i.unstable_IdlePriority,Xf=null,wc=null;function Om(f){if(wc&&typeof wc.onCommitFiberRoot=="function")try{wc.onCommitFiberRoot(Xf,f,void 0,(f.current.flags&128)===128)}catch{}}function _d(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var fl=typeof Object.is=="function"?Object.is:_d,pl=null,Kf=!1,Yf=!1;function Nm(f){pl===null?pl=[f]:pl.push(f)}function z_(f){Kf=!0,Nm(f)}function za(){if(!Yf&&pl!==null){Yf=!0;var f=0,g=er;try{var C=pl;for(er=1;f<C.length;f++){var N=C[f];do N=N(!0);while(N!==null)}pl=null,Kf=!1}catch(B){throw pl!==null&&(pl=pl.slice(f+1)),Mm(dl,za),B}finally{er=g,Yf=!1}}return null}var i0=a.ReactCurrentBatchConfig;function Jf(f,g){if(fl(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var C=Object.keys(f),N=Object.keys(g);if(C.length!==N.length)return!1;for(N=0;N<C.length;N++){var B=C[N];if(!Hn.call(g,B)||!fl(f[B],g[B]))return!1}return!0}function Va(f){switch(f.tag){case 5:return tn(f.type);case 16:return tn("Lazy");case 13:return tn("Suspense");case 19:return tn("SuspenseList");case 0:case 2:case 15:return f=In(f.type,!1),f;case 11:return f=In(f.type.render,!1),f;case 1:return f=In(f.type,!0),f;default:return""}}function qr(f,g){if(f&&f.defaultProps){g=s({},g),f=f.defaultProps;for(var C in f)g[C]===void 0&&(g[C]=f[C]);return g}return g}var Cc=Or(null),Qf=null,ml=null,s0=null;function vd(){s0=ml=Qf=null}function V_(f,g,C){Xt?(On(Cc,g._currentValue),g._currentValue=C):(On(Cc,g._currentValue2),g._currentValue2=C)}function Xl(f){var g=Cc.current;fn(Cc),Xt?f._currentValue=g:f._currentValue2=g}function mh(f,g,C){for(;f!==null;){var N=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,N!==null&&(N.childLanes|=g)):N!==null&&(N.childLanes&g)!==g&&(N.childLanes|=g),f===C)break;f=f.return}}function Ns(f,g){Qf=f,s0=ml=null,f=f.dependencies,f!==null&&f.firstContext!==null&&(f.lanes&g&&(ba=!0),f.firstContext=null)}function Li(f){var g=Xt?f._currentValue:f._currentValue2;if(s0!==f)if(f={context:f,memoizedValue:g,next:null},ml===null){if(Qf===null)throw Error(o(308));ml=f,Qf.dependencies={lanes:0,firstContext:f}}else ml=ml.next=f;return g}var ya=null,Ru=!1;function ms(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gs(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Rc(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Xo(f,g){var C=f.updateQueue;C!==null&&(C=C.shared,ts!==null&&f.mode&1&&!(gr&2)?(f=C.interleaved,f===null?(g.next=g,ya===null?ya=[C]:ya.push(C)):(g.next=f.next,f.next=g),C.interleaved=g):(f=C.pending,f===null?g.next=g:(g.next=f.next,f.next=g),C.pending=g))}function Au(f,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var N=g.lanes;N&=f.pendingLanes,C|=N,g.lanes=C,gd(f,C)}}function Ve(f,g){var C=f.updateQueue,N=f.alternate;if(N!==null&&(N=N.updateQueue,C===N)){var B=null,Y=null;if(C=C.firstBaseUpdate,C!==null){do{var me={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};Y===null?B=Y=me:Y=Y.next=me,C=C.next}while(C!==null);Y===null?B=Y=g:Y=Y.next=g}else B=Y=g;C={baseState:N.baseState,firstBaseUpdate:B,lastBaseUpdate:Y,shared:N.shared,effects:N.effects},f.updateQueue=C;return}f=C.lastBaseUpdate,f===null?C.firstBaseUpdate=g:f.next=g,C.lastBaseUpdate=g}function Be(f,g,C,N){var B=f.updateQueue;Ru=!1;var Y=B.firstBaseUpdate,me=B.lastBaseUpdate,xe=B.shared.pending;if(xe!==null){B.shared.pending=null;var tt=xe,Mt=tt.next;tt.next=null,me===null?Y=Mt:me.next=Mt,me=tt;var rn=f.alternate;rn!==null&&(rn=rn.updateQueue,xe=rn.lastBaseUpdate,xe!==me&&(xe===null?rn.firstBaseUpdate=Mt:xe.next=Mt,rn.lastBaseUpdate=tt))}if(Y!==null){var ir=B.baseState;me=0,rn=Mt=tt=null,xe=Y;do{var on=xe.lane,$n=xe.eventTime;if((N&on)===on){rn!==null&&(rn=rn.next={eventTime:$n,lane:0,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null});e:{var hn=f,Do=xe;switch(on=g,$n=C,Do.tag){case 1:if(hn=Do.payload,typeof hn=="function"){ir=hn.call($n,ir,on);break e}ir=hn;break e;case 3:hn.flags=hn.flags&-65537|128;case 0:if(hn=Do.payload,on=typeof hn=="function"?hn.call($n,ir,on):hn,on==null)break e;ir=s({},ir,on);break e;case 2:Ru=!0}}xe.callback!==null&&xe.lane!==0&&(f.flags|=64,on=B.effects,on===null?B.effects=[xe]:on.push(xe))}else $n={eventTime:$n,lane:on,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},rn===null?(Mt=rn=$n,tt=ir):rn=rn.next=$n,me|=on;if(xe=xe.next,xe===null){if(xe=B.shared.pending,xe===null)break;on=xe,xe=on.next,on.next=null,B.lastBaseUpdate=on,B.shared.pending=null}}while(!0);if(rn===null&&(tt=ir),B.baseState=tt,B.firstBaseUpdate=Mt,B.lastBaseUpdate=rn,g=B.shared.interleaved,g!==null){B=g;do me|=B.lane,B=B.next;while(B!==g)}else Y===null&&(B.shared.lanes=0);Ta|=me,f.lanes=me,f.memoizedState=ir}}function ft(f,g,C){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var N=f[g],B=N.callback;if(B!==null){if(N.callback=null,N=C,typeof B!="function")throw Error(o(191,B));B.call(N)}}}var Vt=new r.Component().refs;function Ct(f,g,C,N){g=f.memoizedState,C=C(N,g),C=C==null?g:s({},g,C),f.memoizedState=C,f.lanes===0&&(f.updateQueue.baseState=C)}var Nr={isMounted:function(f){return(f=f._reactInternals)?F(f)===f:!1},enqueueSetState:function(f,g,C){f=f._reactInternals;var N=bi(),B=Ya(f),Y=Rc(N,B);Y.payload=g,C!=null&&(Y.callback=C),Xo(f,Y),g=Qo(f,B,N),g!==null&&Au(g,f,B)},enqueueReplaceState:function(f,g,C){f=f._reactInternals;var N=bi(),B=Ya(f),Y=Rc(N,B);Y.tag=1,Y.payload=g,C!=null&&(Y.callback=C),Xo(f,Y),g=Qo(f,B,N),g!==null&&Au(g,f,B)},enqueueForceUpdate:function(f,g){f=f._reactInternals;var C=bi(),N=Ya(f),B=Rc(C,N);B.tag=2,g!=null&&(B.callback=g),Xo(f,B),g=Qo(f,N,C),g!==null&&Au(g,f,N)}};function Cs(f,g,C,N,B,Y,me){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(N,Y,me):g.prototype&&g.prototype.isPureReactComponent?!Jf(C,N)||!Jf(B,Y):!0}function Ac(f,g,C){var N=!1,B=hr,Y=g.contextType;return typeof Y=="object"&&Y!==null?Y=Li(Y):(B=Gn(g)?dr:Gt.current,N=g.contextTypes,Y=(N=N!=null)?ws(f,B):hr),g=new g(C,Y),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Nr,f.stateNode=g,g._reactInternals=f,N&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=B,f.__reactInternalMemoizedMaskedChildContext=Y),g}function wr(f,g,C,N){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,N),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,N),g.state!==f&&Nr.enqueueReplaceState(g,g.state,null)}function gh(f,g,C,N){var B=f.stateNode;B.props=C,B.state=f.memoizedState,B.refs=Vt,ms(f);var Y=g.contextType;typeof Y=="object"&&Y!==null?B.context=Li(Y):(Y=Gn(g)?dr:Gt.current,B.context=ws(f,Y)),B.state=f.memoizedState,Y=g.getDerivedStateFromProps,typeof Y=="function"&&(Ct(f,g,Y,C),B.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(g=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),g!==B.state&&Nr.enqueueReplaceState(B,B.state,null),Be(f,C,B,N),B.state=f.memoizedState),typeof B.componentDidMount=="function"&&(f.flags|=4194308)}var _h=[],uo=0,vh=null,Pm=0,Ps=[],Ds=0,gl=null,Pr=1,ac="";function Mu(f,g){_h[uo++]=Pm,_h[uo++]=vh,vh=f,Pm=g}function Zf(f,g,C){Ps[Ds++]=Pr,Ps[Ds++]=ac,Ps[Ds++]=gl,gl=f;var N=Pr;f=ac;var B=32-Di(N)-1;N&=~(1<<B),C+=1;var Y=32-Di(g)+B;if(30<Y){var me=B-B%5;Y=(N&(1<<me)-1).toString(32),N>>=me,B-=me,Pr=1<<32-Di(g)+B|C<<B|N,ac=Y+f}else Pr=1<<Y|C<<B|N,ac=f}function Iu(f){f.return!==null&&(Mu(f,1),Zf(f,1,0))}function o0(f){for(;f===vh;)vh=_h[--uo],_h[uo]=null,Pm=_h[--uo],_h[uo]=null;for(;f===gl;)gl=Ps[--Ds],Ps[Ds]=null,ac=Ps[--Ds],Ps[Ds]=null,Pr=Ps[--Ds],Ps[Ds]=null}var ja=null,wo=null,si=!1,cc=!1,lc=null;function yd(f,g){var C=ss(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=f,g=f.deletions,g===null?(f.deletions=[C],f.flags|=16):g.push(C)}function ep(f,g){switch(f.tag){case 5:return g=Br(g,f.type,f.pendingProps),g!==null?(f.stateNode=g,ja=f,wo=lr(g),!0):!1;case 6:return g=Qn(g,f.pendingProps),g!==null?(f.stateNode=g,ja=f,wo=null,!0):!1;case 13:if(g=Fn(g),g!==null){var C=gl!==null?{id:Pr,overflow:ac}:null;return f.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=ss(18,null,null,0),C.stateNode=g,C.return=f,f.child=C,ja=f,wo=null,!0}return!1;default:return!1}}function tp(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Kl(f){if(si){var g=wo;if(g){var C=g;if(!ep(f,g)){if(tp(f))throw Error(o(418));g=vn(C);var N=ja;g&&ep(f,g)?yd(N,C):(f.flags=f.flags&-4097|2,si=!1,ja=f)}}else{if(tp(f))throw Error(o(418));f.flags=f.flags&-4097|2,si=!1,ja=f}}}function a0(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;ja=f}function Mc(f){if(!xn||f!==ja)return!1;if(!si)return a0(f),si=!0,!1;if(f.tag!==3&&(f.tag!==5||Xe(f.type)&&!Ae(f.type,f.memoizedProps))){var g=wo;if(g){if(tp(f)){for(f=wo;f;)f=vn(f);throw Error(o(418))}for(;g;)yd(f,g),g=vn(g)}}if(a0(f),f.tag===13){if(!xn)throw Error(o(316));if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(o(317));wo=fd(f)}else wo=ja?vn(f.stateNode):null;return!0}function Ha(){xn&&(wo=ja=null,cc=si=!1)}function yh(f){lc===null?lc=[f]:lc.push(f)}function kt(f,g,C){if(f=C.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(o(309));var N=C.stateNode}if(!N)throw Error(o(147,f));var B=N,Y=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===Y?g.ref:(g=function(me){var xe=B.refs;xe===Vt&&(xe=B.refs={}),me===null?delete xe[Y]:xe[Y]=me},g._stringRef=Y,g)}if(typeof f!="string")throw Error(o(284));if(!C._owner)throw Error(o(290,f))}return f}function $i(f,g){throw f=Object.prototype.toString.call(g),Error(o(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function j_(f){var g=f._init;return g(f._payload)}function np(f){function g(Ce,De){if(f){var He=Ce.deletions;He===null?(Ce.deletions=[De],Ce.flags|=16):He.push(De)}}function C(Ce,De){if(!f)return null;for(;De!==null;)g(Ce,De),De=De.sibling;return null}function N(Ce,De){for(Ce=new Map;De!==null;)De.key!==null?Ce.set(De.key,De):Ce.set(De.index,De),De=De.sibling;return Ce}function B(Ce,De){return Ce=Po(Ce,De),Ce.index=0,Ce.sibling=null,Ce}function Y(Ce,De,He){return Ce.index=He,f?(He=Ce.alternate,He!==null?(He=He.index,He<De?(Ce.flags|=2,De):He):(Ce.flags|=2,De)):(Ce.flags|=1048576,De)}function me(Ce){return f&&Ce.alternate===null&&(Ce.flags|=2),Ce}function xe(Ce,De,He,Tt){return De===null||De.tag!==6?(De=po(He,Ce.mode,Tt),De.return=Ce,De):(De=B(De,He),De.return=Ce,De)}function tt(Ce,De,He,Tt){var un=He.type;return un===u?rn(Ce,De,He.props.children,Tt,He.key):De!==null&&(De.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===R&&j_(un)===De.type)?(Tt=B(De,He.props),Tt.ref=kt(Ce,De,He),Tt.return=Ce,Tt):(Tt=bl(He.type,He.key,He.props,null,Ce.mode,Tt),Tt.ref=kt(Ce,De,He),Tt.return=Ce,Tt)}function Mt(Ce,De,He,Tt){return De===null||De.tag!==4||De.stateNode.containerInfo!==He.containerInfo||De.stateNode.implementation!==He.implementation?(De=Cp(He,Ce.mode,Tt),De.return=Ce,De):(De=B(De,He.children||[]),De.return=Ce,De)}function rn(Ce,De,He,Tt,un){return De===null||De.tag!==7?(De=ea(He,Ce.mode,Tt,un),De.return=Ce,De):(De=B(De,He),De.return=Ce,De)}function ir(Ce,De,He){if(typeof De=="string"&&De!==""||typeof De=="number")return De=po(""+De,Ce.mode,He),De.return=Ce,De;if(typeof De=="object"&&De!==null){switch(De.$$typeof){case c:return He=bl(De.type,De.key,De.props,null,Ce.mode,He),He.ref=kt(Ce,null,De),He.return=Ce,He;case l:return De=Cp(De,Ce.mode,He),De.return=Ce,De;case R:var Tt=De._init;return ir(Ce,Tt(De._payload),He)}if(te(De)||D(De))return De=ea(De,Ce.mode,He,null),De.return=Ce,De;$i(Ce,De)}return null}function on(Ce,De,He,Tt){var un=De!==null?De.key:null;if(typeof He=="string"&&He!==""||typeof He=="number")return un!==null?null:xe(Ce,De,""+He,Tt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case c:return He.key===un?tt(Ce,De,He,Tt):null;case l:return He.key===un?Mt(Ce,De,He,Tt):null;case R:return un=He._init,on(Ce,De,un(He._payload),Tt)}if(te(He)||D(He))return un!==null?null:rn(Ce,De,He,Tt,null);$i(Ce,He)}return null}function $n(Ce,De,He,Tt,un){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return Ce=Ce.get(He)||null,xe(De,Ce,""+Tt,un);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case c:return Ce=Ce.get(Tt.key===null?He:Tt.key)||null,tt(De,Ce,Tt,un);case l:return Ce=Ce.get(Tt.key===null?He:Tt.key)||null,Mt(De,Ce,Tt,un);case R:var tr=Tt._init;return $n(Ce,De,He,tr(Tt._payload),un)}if(te(Tt)||D(Tt))return Ce=Ce.get(He)||null,rn(De,Ce,Tt,un,null);$i(De,Tt)}return null}function hn(Ce,De,He,Tt){for(var un=null,tr=null,nr=De,x=De=0,v=null;nr!==null&&x<He.length;x++){nr.index>x?(v=nr,nr=null):v=nr.sibling;var E=on(Ce,nr,He[x],Tt);if(E===null){nr===null&&(nr=v);break}f&&nr&&E.alternate===null&&g(Ce,nr),De=Y(E,De,x),tr===null?un=E:tr.sibling=E,tr=E,nr=v}if(x===He.length)return C(Ce,nr),si&&Mu(Ce,x),un;if(nr===null){for(;x<He.length;x++)nr=ir(Ce,He[x],Tt),nr!==null&&(De=Y(nr,De,x),tr===null?un=nr:tr.sibling=nr,tr=nr);return si&&Mu(Ce,x),un}for(nr=N(Ce,nr);x<He.length;x++)v=$n(nr,Ce,x,He[x],Tt),v!==null&&(f&&v.alternate!==null&&nr.delete(v.key===null?x:v.key),De=Y(v,De,x),tr===null?un=v:tr.sibling=v,tr=v);return f&&nr.forEach(function(w){return g(Ce,w)}),si&&Mu(Ce,x),un}function Do(Ce,De,He,Tt){var un=D(He);if(typeof un!="function")throw Error(o(150));if(He=un.call(He),He==null)throw Error(o(151));for(var tr=un=null,nr=De,x=De=0,v=null,E=He.next();nr!==null&&!E.done;x++,E=He.next()){nr.index>x?(v=nr,nr=null):v=nr.sibling;var w=on(Ce,nr,E.value,Tt);if(w===null){nr===null&&(nr=v);break}f&&nr&&w.alternate===null&&g(Ce,nr),De=Y(w,De,x),tr===null?un=w:tr.sibling=w,tr=w,nr=v}if(E.done)return C(Ce,nr),si&&Mu(Ce,x),un;if(nr===null){for(;!E.done;x++,E=He.next())E=ir(Ce,E.value,Tt),E!==null&&(De=Y(E,De,x),tr===null?un=E:tr.sibling=E,tr=E);return si&&Mu(Ce,x),un}for(nr=N(Ce,nr);!E.done;x++,E=He.next())E=$n(nr,Ce,x,E.value,Tt),E!==null&&(f&&E.alternate!==null&&nr.delete(E.key===null?x:E.key),De=Y(E,De,x),tr===null?un=E:tr.sibling=E,tr=E);return f&&nr.forEach(function(M){return g(Ce,M)}),si&&Mu(Ce,x),un}function _r(Ce,De,He,Tt){if(typeof He=="object"&&He!==null&&He.type===u&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case c:e:{for(var un=He.key,tr=De;tr!==null;){if(tr.key===un){if(un=He.type,un===u){if(tr.tag===7){C(Ce,tr.sibling),De=B(tr,He.props.children),De.return=Ce,Ce=De;break e}}else if(tr.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===R&&j_(un)===tr.type){C(Ce,tr.sibling),De=B(tr,He.props),De.ref=kt(Ce,tr,He),De.return=Ce,Ce=De;break e}C(Ce,tr);break}else g(Ce,tr);tr=tr.sibling}He.type===u?(De=ea(He.props.children,Ce.mode,Tt,He.key),De.return=Ce,Ce=De):(Tt=bl(He.type,He.key,He.props,null,Ce.mode,Tt),Tt.ref=kt(Ce,De,He),Tt.return=Ce,Ce=Tt)}return me(Ce);case l:e:{for(tr=He.key;De!==null;){if(De.key===tr)if(De.tag===4&&De.stateNode.containerInfo===He.containerInfo&&De.stateNode.implementation===He.implementation){C(Ce,De.sibling),De=B(De,He.children||[]),De.return=Ce,Ce=De;break e}else{C(Ce,De);break}else g(Ce,De);De=De.sibling}De=Cp(He,Ce.mode,Tt),De.return=Ce,Ce=De}return me(Ce);case R:return tr=He._init,_r(Ce,De,tr(He._payload),Tt)}if(te(He))return hn(Ce,De,He,Tt);if(D(He))return Do(Ce,De,He,Tt);$i(Ce,He)}return typeof He=="string"&&He!==""||typeof He=="number"?(He=""+He,De!==null&&De.tag===6?(C(Ce,De.sibling),De=B(De,He),De.return=Ce,Ce=De):(C(Ce,De),De=po(He,Ce.mode,Tt),De.return=Ce,Ce=De),me(Ce)):C(Ce,De)}return _r}var qs=np(!0),rp=np(!1),ip={},Ls=Or(ip),Sd=Or(ip),Us=Or(ip);function Xr(f){if(f===ip)throw Error(o(174));return f}function Zi(f,g){On(Us,g),On(Sd,f),On(Ls,ip),f=ne(g),fn(Ls),On(Ls,f)}function Wn(){fn(Ls),fn(Sd),fn(Us)}function Ga(f){var g=Xr(Us.current),C=Xr(Ls.current);g=G(C,f.type,g),C!==g&&(On(Sd,f),On(Ls,g))}function Xs(f){Sd.current===f&&(fn(Ls),fn(Sd))}var _i=Or(0);function Sh(f){for(var g=f;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||en(C)||zt(C)))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if(g.flags&128)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Ks=[];function vt(){for(var f=0;f<Ks.length;f++){var g=Ks[f];Xt?g._workInProgressVersionPrimary=null:g._workInProgressVersionSecondary=null}Ks.length=0}var _s=a.ReactCurrentDispatcher,Co=a.ReactCurrentBatchConfig,Wa=0,Ei=null,qi=null,vs=null,Ed=!1,sp=!1,Yl=0,H_=0;function Rs(){throw Error(o(321))}function ku(f,g){if(g===null)return!1;for(var C=0;C<g.length&&C<f.length;C++)if(!fl(f[C],g[C]))return!1;return!0}function bd(f,g,C,N,B,Y){if(Wa=Y,Ei=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,_s.current=f===null||f.memoizedState===null?c0:_l,f=C(N,B),sp){Y=0;do{if(sp=!1,Yl=0,25<=Y)throw Error(o(301));Y+=1,vs=qi=null,g.updateQueue=null,_s.current=es,f=C(N,B)}while(sp)}if(_s.current=Ea,g=qi!==null&&qi.next!==null,Wa=0,vs=qi=Ei=null,Ed=!1,g)throw Error(o(300));return f}function ce(){var f=Yl!==0;return Yl=0,f}function Ro(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vs===null?Ei.memoizedState=vs=f:vs=vs.next=f,vs}function Sa(){if(qi===null){var f=Ei.alternate;f=f!==null?f.memoizedState:null}else f=qi.next;var g=vs===null?Ei.memoizedState:vs.next;if(g!==null)vs=g,qi=f;else{if(f===null)throw Error(o(310));qi=f,f={memoizedState:qi.memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},vs===null?Ei.memoizedState=vs=f:vs=vs.next=f}return vs}function As(f,g){return typeof g=="function"?g(f):g}function yr(f){var g=Sa(),C=g.queue;if(C===null)throw Error(o(311));C.lastRenderedReducer=f;var N=qi,B=N.baseQueue,Y=C.pending;if(Y!==null){if(B!==null){var me=B.next;B.next=Y.next,Y.next=me}N.baseQueue=B=Y,C.pending=null}if(B!==null){Y=B.next,N=N.baseState;var xe=me=null,tt=null,Mt=Y;do{var rn=Mt.lane;if((Wa&rn)===rn)tt!==null&&(tt=tt.next={lane:0,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null}),N=Mt.hasEagerState?Mt.eagerState:f(N,Mt.action);else{var ir={lane:rn,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null};tt===null?(xe=tt=ir,me=N):tt=tt.next=ir,Ei.lanes|=rn,Ta|=rn}Mt=Mt.next}while(Mt!==null&&Mt!==Y);tt===null?me=N:tt.next=xe,fl(N,g.memoizedState)||(ba=!0),g.memoizedState=N,g.baseState=me,g.baseQueue=tt,C.lastRenderedState=N}if(f=C.interleaved,f!==null){B=f;do Y=B.lane,Ei.lanes|=Y,Ta|=Y,B=B.next;while(B!==f)}else B===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function Ic(f){var g=Sa(),C=g.queue;if(C===null)throw Error(o(311));C.lastRenderedReducer=f;var N=C.dispatch,B=C.pending,Y=g.memoizedState;if(B!==null){C.pending=null;var me=B=B.next;do Y=f(Y,me.action),me=me.next;while(me!==B);fl(Y,g.memoizedState)||(ba=!0),g.memoizedState=Y,g.baseQueue===null&&(g.baseState=Y),C.lastRenderedState=Y}return[Y,N]}function kc(){}function Oc(f,g){var C=Ei,N=Sa(),B=g(),Y=!fl(N.memoizedState,B);if(Y&&(N.memoizedState=B,ba=!0),N=N.queue,Td(Dm.bind(null,C,N,f),[f]),N.getSnapshot!==g||Y||vs!==null&&vs.memoizedState.tag&1){if(C.flags|=2048,Eh(9,$a.bind(null,C,N,B,g),void 0,null),ts===null)throw Error(o(349));Wa&30||Nc(C,g,B)}return B}function Nc(f,g,C){f.flags|=16384,f={getSnapshot:g,value:C},g=Ei.updateQueue,g===null?(g={lastEffect:null,stores:null},Ei.updateQueue=g,g.stores=[f]):(C=g.stores,C===null?g.stores=[f]:C.push(f))}function $a(f,g,C,N){g.value=C,g.getSnapshot=N,Pc(g)&&Qo(f,1,-1)}function Dm(f,g,C){return C(function(){Pc(g)&&Qo(f,1,-1)})}function Pc(f){var g=f.getSnapshot;f=f.value;try{var C=g();return!fl(f,C)}catch{return!0}}function Lm(f){var g=Ro();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:f},g.queue=f,f=f.dispatch=cp.bind(null,Ei,f),[g.memoizedState,f]}function Eh(f,g,C,N){return f={tag:f,create:g,destroy:C,deps:N,next:null},g=Ei.updateQueue,g===null?(g={lastEffect:null,stores:null},Ei.updateQueue=g,g.lastEffect=f.next=f):(C=g.lastEffect,C===null?g.lastEffect=f.next=f:(N=C.next,C.next=f,f.next=N,g.lastEffect=f)),f}function op(){return Sa().memoizedState}function Jl(f,g,C,N){var B=Ro();Ei.flags|=f,B.memoizedState=Eh(1|g,C,void 0,N===void 0?null:N)}function Ou(f,g,C,N){var B=Sa();N=N===void 0?null:N;var Y=void 0;if(qi!==null){var me=qi.memoizedState;if(Y=me.destroy,N!==null&&ku(N,me.deps)){B.memoizedState=Eh(g,C,Y,N);return}}Ei.flags|=f,B.memoizedState=Eh(1|g,C,Y,N)}function Um(f,g){return Jl(8390656,8,f,g)}function Td(f,g){return Ou(2048,8,f,g)}function Dc(f,g){return Ou(4,2,f,g)}function Fm(f,g){return Ou(4,4,f,g)}function Ql(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function Ao(f,g,C){return C=C!=null?C.concat([f]):null,Ou(4,4,Ql.bind(null,g,f),C)}function ys(){}function Bm(f,g){var C=Sa();g=g===void 0?null:g;var N=C.memoizedState;return N!==null&&g!==null&&ku(g,N[1])?N[0]:(C.memoizedState=[f,g],f)}function bh(f,g){var C=Sa();g=g===void 0?null:g;var N=C.memoizedState;return N!==null&&g!==null&&ku(g,N[1])?N[0]:(f=f(),C.memoizedState=[f,g],f)}function Nu(f,g){var C=er;er=C!==0&&4>C?C:4,f(!0);var N=Co.transition;Co.transition={};try{f(!1),g()}finally{er=C,Co.transition=N}}function ap(){return Sa().memoizedState}function G_(f,g,C){var N=Ya(f);C={lane:N,action:C,hasEagerState:!1,eagerState:null,next:null},xd(f)?Ys(g,C):(zm(f,g,C),C=bi(),f=Qo(f,N,C),f!==null&&Vm(f,g,N))}function cp(f,g,C){var N=Ya(f),B={lane:N,action:C,hasEagerState:!1,eagerState:null,next:null};if(xd(f))Ys(g,B);else{zm(f,g,B);var Y=f.alternate;if(f.lanes===0&&(Y===null||Y.lanes===0)&&(Y=g.lastRenderedReducer,Y!==null))try{var me=g.lastRenderedState,xe=Y(me,C);if(B.hasEagerState=!0,B.eagerState=xe,fl(xe,me))return}catch{}finally{}C=bi(),f=Qo(f,N,C),f!==null&&Vm(f,g,N)}}function xd(f){var g=f.alternate;return f===Ei||g!==null&&g===Ei}function Ys(f,g){sp=Ed=!0;var C=f.pending;C===null?g.next=g:(g.next=C.next,C.next=g),f.pending=g}function zm(f,g,C){ts!==null&&f.mode&1&&!(gr&2)?(f=g.interleaved,f===null?(C.next=C,ya===null?ya=[g]:ya.push(g)):(C.next=f.next,f.next=C),g.interleaved=C):(f=g.pending,f===null?C.next=C:(C.next=f.next,f.next=C),g.pending=C)}function Vm(f,g,C){if(C&4194240){var N=g.lanes;N&=f.pendingLanes,C|=N,g.lanes=C,gd(f,C)}}var Ea={readContext:Li,useCallback:Rs,useContext:Rs,useEffect:Rs,useImperativeHandle:Rs,useInsertionEffect:Rs,useLayoutEffect:Rs,useMemo:Rs,useReducer:Rs,useRef:Rs,useState:Rs,useDebugValue:Rs,useDeferredValue:Rs,useTransition:Rs,useMutableSource:Rs,useSyncExternalStore:Rs,useId:Rs,unstable_isNewReconciler:!1},c0={readContext:Li,useCallback:function(f,g){return Ro().memoizedState=[f,g===void 0?null:g],f},useContext:Li,useEffect:Um,useImperativeHandle:function(f,g,C){return C=C!=null?C.concat([f]):null,Jl(4194308,4,Ql.bind(null,g,f),C)},useLayoutEffect:function(f,g){return Jl(4194308,4,f,g)},useInsertionEffect:function(f,g){return Jl(4,2,f,g)},useMemo:function(f,g){var C=Ro();return g=g===void 0?null:g,f=f(),C.memoizedState=[f,g],f},useReducer:function(f,g,C){var N=Ro();return g=C!==void 0?C(g):g,N.memoizedState=N.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},N.queue=f,f=f.dispatch=G_.bind(null,Ei,f),[N.memoizedState,f]},useRef:function(f){var g=Ro();return f={current:f},g.memoizedState=f},useState:Lm,useDebugValue:ys,useDeferredValue:function(f){var g=Lm(f),C=g[0],N=g[1];return Um(function(){var B=Co.transition;Co.transition={};try{N(f)}finally{Co.transition=B}},[f]),C},useTransition:function(){var f=Lm(!1),g=f[0];return f=Nu.bind(null,f[1]),Ro().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,C){var N=Ei,B=Ro();if(si){if(C===void 0)throw Error(o(407));C=C()}else{if(C=g(),ts===null)throw Error(o(349));Wa&30||Nc(N,g,C)}B.memoizedState=C;var Y={value:C,getSnapshot:g};return B.queue=Y,Um(Dm.bind(null,N,Y,f),[f]),N.flags|=2048,Eh(9,$a.bind(null,N,Y,C,g),void 0,null),C},useId:function(){var f=Ro(),g=ts.identifierPrefix;if(si){var C=ac,N=Pr;C=(N&~(1<<32-Di(N)-1)).toString(32)+C,g=":"+g+"R"+C,C=Yl++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=H_++,g=":"+g+"r"+C.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},_l={readContext:Li,useCallback:Bm,useContext:Li,useEffect:Td,useImperativeHandle:Ao,useInsertionEffect:Dc,useLayoutEffect:Fm,useMemo:bh,useReducer:yr,useRef:op,useState:function(){return yr(As)},useDebugValue:ys,useDeferredValue:function(f){var g=yr(As),C=g[0],N=g[1];return Td(function(){var B=Co.transition;Co.transition={};try{N(f)}finally{Co.transition=B}},[f]),C},useTransition:function(){var f=yr(As)[0],g=Sa().memoizedState;return[f,g]},useMutableSource:kc,useSyncExternalStore:Oc,useId:ap,unstable_isNewReconciler:!1},es={readContext:Li,useCallback:Bm,useContext:Li,useEffect:Td,useImperativeHandle:Ao,useInsertionEffect:Dc,useLayoutEffect:Fm,useMemo:bh,useReducer:Ic,useRef:op,useState:function(){return Ic(As)},useDebugValue:ys,useDeferredValue:function(f){var g=Ic(As),C=g[0],N=g[1];return Td(function(){var B=Co.transition;Co.transition={};try{N(f)}finally{Co.transition=B}},[f]),C},useTransition:function(){var f=Ic(As)[0],g=Sa().memoizedState;return[f,g]},useMutableSource:kc,useSyncExternalStore:Oc,useId:ap,unstable_isNewReconciler:!1};function Zl(f,g){try{var C="",N=g;do C+=Va(N),N=N.return;while(N);var B=C}catch(Y){B=`
Error generating stack: `+Y.message+`
`+Y.stack}return{value:f,source:g,stack:B}}function Ms(f,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var vi=typeof WeakMap=="function"?WeakMap:Map;function wd(f,g,C){C=Rc(-1,C),C.tag=3,C.payload={element:null};var N=g.value;return C.callback=function(){Bs||(Bs=!0,Fd=N),Ms(f,g)},C}function Th(f,g,C){C=Rc(-1,C),C.tag=3;var N=f.type.getDerivedStateFromError;if(typeof N=="function"){var B=g.value;C.payload=function(){return N(B)},C.callback=function(){Ms(f,g)}}var Y=f.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(C.callback=function(){Ms(f,g),typeof N!="function"&&(El===null?El=new Set([this]):El.add(this));var me=g.stack;this.componentDidCatch(g.value,{componentStack:me!==null?me:""})}),C}function jm(f,g,C){var N=f.pingCache;if(N===null){N=f.pingCache=new vi;var B=new Set;N.set(g,B)}else B=N.get(g),B===void 0&&(B=new Set,N.set(g,B));B.has(C)||(B.add(C),f=Ky.bind(null,f,g,C),g.then(f,f))}function vl(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function lp(f,g,C,N,B){return f.mode&1?(f.flags|=65536,f.lanes=B,f):(f===g?f.flags|=65536:(f.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=Rc(-1,1),g.tag=2,Xo(C,g))),C.lanes|=1),f)}function ho(f){f.flags|=4}function Hm(f,g){if(f!==null&&f.child===g.child)return!0;if(g.flags&16)return!1;for(f=g.child;f!==null;){if(f.flags&12854||f.subtreeFlags&12854)return!1;f=f.sibling}return!0}var Cd,Rd,Ad,up;if(Qt)Cd=function(f,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)ye(f,C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},Rd=function(){},Ad=function(f,g,C,N,B){if(f=f.memoizedProps,f!==N){var Y=g.stateNode,me=Xr(Ls.current);C=_e(Y,C,f,N,B,me),(g.updateQueue=C)&&ho(g)}},up=function(f,g,C,N){C!==N&&ho(g)};else if(Kt){Cd=function(f,g,C,N){for(var B=g.child;B!==null;){if(B.tag===5){var Y=B.stateNode;C&&N&&(Y=ct(Y,B.type,B.memoizedProps,B)),ye(f,Y)}else if(B.tag===6)Y=B.stateNode,C&&N&&(Y=Rn(Y,B.memoizedProps,B)),ye(f,Y);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)Y=B.child,Y!==null&&(Y.return=B),Cd(f,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===g)break;for(;B.sibling===null;){if(B.return===null||B.return===g)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};var hp=function(f,g,C,N){for(var B=g.child;B!==null;){if(B.tag===5){var Y=B.stateNode;C&&N&&(Y=ct(Y,B.type,B.memoizedProps,B)),Ee(f,Y)}else if(B.tag===6)Y=B.stateNode,C&&N&&(Y=Rn(Y,B.memoizedProps,B)),Ee(f,Y);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)Y=B.child,Y!==null&&(Y.return=B),hp(f,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===g)break;for(;B.sibling===null;){if(B.return===null||B.return===g)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};Rd=function(f,g){var C=g.stateNode;if(!Hm(f,g)){f=C.containerInfo;var N=Lt(f);hp(N,g,!1,!1),C.pendingChildren=N,ho(g),ze(f,N)}},Ad=function(f,g,C,N,B){var Y=f.stateNode,me=f.memoizedProps;if((f=Hm(f,g))&&me===N)g.stateNode=Y;else{var xe=g.stateNode,tt=Xr(Ls.current),Mt=null;me!==N&&(Mt=_e(xe,C,me,N,B,tt)),f&&Mt===null?g.stateNode=Y:(Y=Ht(Y,Mt,C,me,N,g,f,xe),Ne(Y,C,N,B,tt)&&ho(g),g.stateNode=Y,f?ho(g):Cd(Y,g,!1,!1))}},up=function(f,g,C,N){C!==N?(f=Xr(Us.current),C=Xr(Ls.current),g.stateNode=Ye(N,f,C,g),ho(g)):g.stateNode=f.stateNode}}else Rd=function(){},Ad=function(){},up=function(){};function Ko(f,g){if(!si)switch(f.tailMode){case"hidden":g=f.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?f.tail=null:C.sibling=null;break;case"collapsed":C=f.tail;for(var N=null;C!==null;)C.alternate!==null&&(N=C),C=C.sibling;N===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:N.sibling=null}}function Js(f){var g=f.alternate!==null&&f.alternate.child===f.child,C=0,N=0;if(g)for(var B=f.child;B!==null;)C|=B.lanes|B.childLanes,N|=B.subtreeFlags&14680064,N|=B.flags&14680064,B.return=f,B=B.sibling;else for(B=f.child;B!==null;)C|=B.lanes|B.childLanes,N|=B.subtreeFlags,N|=B.flags,B.return=f,B=B.sibling;return f.subtreeFlags|=N,f.childLanes=C,g}function l0(f,g,C){var N=g.pendingProps;switch(o0(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Js(g),null;case 1:return Gn(g.type)&&Zn(),Js(g),null;case 3:return N=g.stateNode,Wn(),fn(Pi),fn(Gt),vt(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(f===null||f.child===null)&&(Mc(g)?ho(g):f===null||f.memoizedState.isDehydrated&&!(g.flags&256)||(g.flags|=1024,lc!==null&&(hc(lc),lc=null))),Rd(f,g),Js(g),null;case 5:Xs(g),C=Xr(Us.current);var B=g.type;if(f!==null&&g.stateNode!=null)Ad(f,g,B,N,C),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!N){if(g.stateNode===null)throw Error(o(166));return Js(g),null}if(f=Xr(Ls.current),Mc(g)){if(!xn)throw Error(o(175));f=co(g.stateNode,g.type,g.memoizedProps,C,f,g,!cc),g.updateQueue=f,f!==null&&ho(g)}else{var Y=ue(B,N,C,f,g);Cd(Y,g,!1,!1),g.stateNode=Y,Ne(Y,B,N,C,f)&&ho(g)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Js(g),null;case 6:if(f&&g.stateNode!=null)up(f,g,f.memoizedProps,N);else{if(typeof N!="string"&&g.stateNode===null)throw Error(o(166));if(f=Xr(Us.current),C=Xr(Ls.current),Mc(g)){if(!xn)throw Error(o(176));if(f=g.stateNode,N=g.memoizedProps,(C=$l(f,N,g,!cc))&&(B=ja,B!==null))switch(Y=(B.mode&1)!==0,B.tag){case 3:Pe(B.stateNode.containerInfo,f,N,Y);break;case 5:wt(B.type,B.memoizedProps,B.stateNode,f,N,Y)}C&&ho(g)}else g.stateNode=Ye(N,f,C,g)}return Js(g),null;case 13:if(fn(_i),N=g.memoizedState,si&&wo!==null&&g.mode&1&&!(g.flags&128)){for(f=wo;f;)f=vn(f);return Ha(),g.flags|=98560,g}if(N!==null&&N.dehydrated!==null){if(N=Mc(g),f===null){if(!N)throw Error(o(318));if(!xn)throw Error(o(344));if(f=g.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(o(317));dh(f,g)}else Ha(),!(g.flags&128)&&(g.memoizedState=null),g.flags|=4;return Js(g),null}return lc!==null&&(hc(lc),lc=null),g.flags&128?(g.lanes=C,g):(N=N!==null,C=!1,f===null?Mc(g):C=f.memoizedState!==null,N&&!C&&(g.child.flags|=8192,g.mode&1&&(f===null||_i.current&1?rs===0&&(rs=3):Bu())),g.updateQueue!==null&&(g.flags|=4),Js(g),null);case 4:return Wn(),Rd(f,g),f===null&&St(g.stateNode.containerInfo),Js(g),null;case 10:return Xl(g.type._context),Js(g),null;case 17:return Gn(g.type)&&Zn(),Js(g),null;case 19:if(fn(_i),B=g.memoizedState,B===null)return Js(g),null;if(N=(g.flags&128)!==0,Y=B.rendering,Y===null)if(N)Ko(B,!1);else{if(rs!==0||f!==null&&f.flags&128)for(f=g.child;f!==null;){if(Y=Sh(f),Y!==null){for(g.flags|=128,Ko(B,!1),f=Y.updateQueue,f!==null&&(g.updateQueue=f,g.flags|=4),g.subtreeFlags=0,f=C,N=g.child;N!==null;)C=N,B=f,C.flags&=14680066,Y=C.alternate,Y===null?(C.childLanes=0,C.lanes=B,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=Y.childLanes,C.lanes=Y.lanes,C.child=Y.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=Y.memoizedProps,C.memoizedState=Y.memoizedState,C.updateQueue=Y.updateQueue,C.type=Y.type,B=Y.dependencies,C.dependencies=B===null?null:{lanes:B.lanes,firstContext:B.firstContext}),N=N.sibling;return On(_i,_i.current&1|2),g.child}f=f.sibling}B.tail!==null&&pr()>bp&&(g.flags|=128,N=!0,Ko(B,!1),g.lanes=4194304)}else{if(!N)if(f=Sh(Y),f!==null){if(g.flags|=128,N=!0,f=f.updateQueue,f!==null&&(g.updateQueue=f,g.flags|=4),Ko(B,!0),B.tail===null&&B.tailMode==="hidden"&&!Y.alternate&&!si)return Js(g),null}else 2*pr()-B.renderingStartTime>bp&&C!==1073741824&&(g.flags|=128,N=!0,Ko(B,!1),g.lanes=4194304);B.isBackwards?(Y.sibling=g.child,g.child=Y):(f=B.last,f!==null?f.sibling=Y:g.child=Y,B.last=Y)}return B.tail!==null?(g=B.tail,B.rendering=g,B.tail=g.sibling,B.renderingStartTime=pr(),g.sibling=null,f=_i.current,On(_i,N?f&1|2:f&1),g):(Js(g),null);case 22:case 23:return Hd(),N=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==N&&(g.flags|=8192),N&&g.mode&1?Fs&1073741824&&(Js(g),Qt&&g.subtreeFlags&6&&(g.flags|=8192)):Js(g),null;case 24:return null;case 25:return null}throw Error(o(156,g.tag))}var Gm=a.ReactCurrentOwner,ba=!1;function Mo(f,g,C,N){g.child=f===null?rp(g,null,C,N):qs(g,f.child,C,N)}function u0(f,g,C,N,B){C=C.render;var Y=g.ref;return Ns(g,B),N=bd(f,g,C,N,Y,B),C=ce(),f!==null&&!ba?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~B,Jo(f,g,B)):(si&&C&&Iu(g),g.flags|=1,Mo(f,g,N,B),g.child)}function Wm(f,g,C,N,B){if(f===null){var Y=C.type;return typeof Y=="function"&&!Ja(Y)&&Y.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=Y,h0(f,g,Y,N,B)):(f=bl(C.type,null,N,g,g.mode,B),f.ref=g.ref,f.return=g,g.child=f)}if(Y=f.child,!(f.lanes&B)){var me=Y.memoizedProps;if(C=C.compare,C=C!==null?C:Jf,C(me,N)&&f.ref===g.ref)return Jo(f,g,B)}return g.flags|=1,f=Po(Y,N),f.ref=g.ref,f.return=g,g.child=f}function h0(f,g,C,N,B){if(f!==null&&Jf(f.memoizedProps,N)&&f.ref===g.ref)if(ba=!1,(f.lanes&B)!==0)f.flags&131072&&(ba=!0);else return g.lanes=f.lanes,Jo(f,g,B);return mr(f,g,C,N,B)}function $m(f,g,C){var N=g.pendingProps,B=N.children,Y=f!==null?f.memoizedState:null;if(N.mode==="hidden")if(!(g.mode&1))g.memoizedState={baseLanes:0,cachePool:null},On(wn,Fs),Fs|=C;else if(C&1073741824)g.memoizedState={baseLanes:0,cachePool:null},N=Y!==null?Y.baseLanes:C,On(wn,Fs),Fs|=N;else return f=Y!==null?Y.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null},g.updateQueue=null,On(wn,Fs),Fs|=f,null;else Y!==null?(N=Y.baseLanes|C,g.memoizedState=null):N=C,On(wn,Fs),Fs|=N;return Mo(f,g,B,C),g.child}function qm(f,g){var C=g.ref;(f===null&&C!==null||f!==null&&f.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function mr(f,g,C,N,B){var Y=Gn(C)?dr:Gt.current;return Y=ws(g,Y),Ns(g,B),C=bd(f,g,C,N,Y,B),N=ce(),f!==null&&!ba?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~B,Jo(f,g,B)):(si&&N&&Iu(g),g.flags|=1,Mo(f,g,C,B),g.child)}function dp(f,g,C,N,B){if(Gn(C)){var Y=!0;lo(g)}else Y=!1;if(Ns(g,B),g.stateNode===null)f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2),Ac(g,C,N),gh(g,C,N,B),N=!0;else if(f===null){var me=g.stateNode,xe=g.memoizedProps;me.props=xe;var tt=me.context,Mt=C.contextType;typeof Mt=="object"&&Mt!==null?Mt=Li(Mt):(Mt=Gn(C)?dr:Gt.current,Mt=ws(g,Mt));var rn=C.getDerivedStateFromProps,ir=typeof rn=="function"||typeof me.getSnapshotBeforeUpdate=="function";ir||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(xe!==N||tt!==Mt)&&wr(g,me,N,Mt),Ru=!1;var on=g.memoizedState;me.state=on,Be(g,N,me,B),tt=g.memoizedState,xe!==N||on!==tt||Pi.current||Ru?(typeof rn=="function"&&(Ct(g,C,rn,N),tt=g.memoizedState),(xe=Ru||Cs(g,C,xe,N,on,tt,Mt))?(ir||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount()),typeof me.componentDidMount=="function"&&(g.flags|=4194308)):(typeof me.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=N,g.memoizedState=tt),me.props=N,me.state=tt,me.context=Mt,N=xe):(typeof me.componentDidMount=="function"&&(g.flags|=4194308),N=!1)}else{me=g.stateNode,gs(f,g),xe=g.memoizedProps,Mt=g.type===g.elementType?xe:qr(g.type,xe),me.props=Mt,ir=g.pendingProps,on=me.context,tt=C.contextType,typeof tt=="object"&&tt!==null?tt=Li(tt):(tt=Gn(C)?dr:Gt.current,tt=ws(g,tt));var $n=C.getDerivedStateFromProps;(rn=typeof $n=="function"||typeof me.getSnapshotBeforeUpdate=="function")||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(xe!==ir||on!==tt)&&wr(g,me,N,tt),Ru=!1,on=g.memoizedState,me.state=on,Be(g,N,me,B);var hn=g.memoizedState;xe!==ir||on!==hn||Pi.current||Ru?(typeof $n=="function"&&(Ct(g,C,$n,N),hn=g.memoizedState),(Mt=Ru||Cs(g,C,Mt,N,on,hn,tt)||!1)?(rn||typeof me.UNSAFE_componentWillUpdate!="function"&&typeof me.componentWillUpdate!="function"||(typeof me.componentWillUpdate=="function"&&me.componentWillUpdate(N,hn,tt),typeof me.UNSAFE_componentWillUpdate=="function"&&me.UNSAFE_componentWillUpdate(N,hn,tt)),typeof me.componentDidUpdate=="function"&&(g.flags|=4),typeof me.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof me.componentDidUpdate!="function"||xe===f.memoizedProps&&on===f.memoizedState||(g.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||xe===f.memoizedProps&&on===f.memoizedState||(g.flags|=1024),g.memoizedProps=N,g.memoizedState=hn),me.props=N,me.state=hn,me.context=tt,N=Mt):(typeof me.componentDidUpdate!="function"||xe===f.memoizedProps&&on===f.memoizedState||(g.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||xe===f.memoizedProps&&on===f.memoizedState||(g.flags|=1024),N=!1)}return d0(f,g,C,N,Y,B)}function d0(f,g,C,N,B,Y){qm(f,g);var me=(g.flags&128)!==0;if(!N&&!me)return B&&ll(g,C,!1),Jo(f,g,Y);N=g.stateNode,Gm.current=g;var xe=me&&typeof C.getDerivedStateFromError!="function"?null:N.render();return g.flags|=1,f!==null&&me?(g.child=qs(g,f.child,null,Y),g.child=qs(g,null,xe,Y)):Mo(f,g,xe,Y),g.memoizedState=N.state,B&&ll(g,C,!0),g.child}function Md(f){var g=f.stateNode;g.pendingContext?cl(f,g.pendingContext,g.pendingContext!==g.context):g.context&&cl(f,g.context,!1),Zi(f,g.containerInfo)}function Pu(f,g,C,N,B){return Ha(),yh(B),g.flags|=256,Mo(f,g,C,N),g.child}var eu={dehydrated:null,treeContext:null,retryLane:0};function yl(f){return{baseLanes:f,cachePool:null}}function Io(f,g,C){var N=g.pendingProps,B=_i.current,Y=!1,me=(g.flags&128)!==0,xe;if((xe=me)||(xe=f!==null&&f.memoizedState===null?!1:(B&2)!==0),xe?(Y=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(B|=1),On(_i,B&1),f===null)return Kl(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?(g.mode&1?zt(f)?g.lanes=8:g.lanes=1073741824:g.lanes=1,null):(B=N.children,f=N.fallback,Y?(N=g.mode,Y=g.child,B={mode:"hidden",children:B},!(N&1)&&Y!==null?(Y.childLanes=0,Y.pendingProps=B):Y=Ni(B,N,0,null),f=ea(f,N,C,null),Y.return=g,f.return=g,Y.sibling=f,g.child=Y,g.child.memoizedState=yl(C),g.memoizedState=eu,f):Sl(g,B));if(B=f.memoizedState,B!==null){if(xe=B.dehydrated,xe!==null){if(me)return g.flags&256?(g.flags&=-257,fp(f,g,C,Error(o(422)))):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(Y=N.fallback,B=g.mode,N=Ni({mode:"visible",children:N.children},B,0,null),Y=ea(Y,B,C,null),Y.flags|=2,N.return=g,Y.return=g,N.sibling=Y,g.child=N,g.mode&1&&qs(g,f.child,null,C),g.child.memoizedState=yl(C),g.memoizedState=eu,Y);if(!(g.mode&1))g=fp(f,g,C,null);else if(zt(xe))g=fp(f,g,C,Error(o(419)));else if(N=(C&f.childLanes)!==0,ba||N){if(N=ts,N!==null){switch(C&-C){case 4:Y=2;break;case 16:Y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Y=32;break;case 536870912:Y=268435456;break;default:Y=0}N=Y&(N.suspendedLanes|C)?0:Y,N!==0&&N!==B.retryLane&&(B.retryLane=N,Qo(f,N,-1))}Bu(),g=fp(f,g,C,Error(o(421)))}else en(xe)?(g.flags|=128,g.child=f.child,g=Gd.bind(null,f),_n(xe,g),g=null):(C=B.treeContext,xn&&(wo=$r(xe),ja=g,si=!0,lc=null,cc=!1,C!==null&&(Ps[Ds++]=Pr,Ps[Ds++]=ac,Ps[Ds++]=gl,Pr=C.id,ac=C.overflow,gl=g)),g=Sl(g,g.pendingProps.children),g.flags|=4096);return g}return Y?(N=Xm(f,g,N.children,N.fallback,C),Y=g.child,B=f.child.memoizedState,Y.memoizedState=B===null?yl(C):{baseLanes:B.baseLanes|C,cachePool:null},Y.childLanes=f.childLanes&~C,g.memoizedState=eu,N):(C=Du(f,g,N.children,C),g.memoizedState=null,C)}return Y?(N=Xm(f,g,N.children,N.fallback,C),Y=g.child,B=f.child.memoizedState,Y.memoizedState=B===null?yl(C):{baseLanes:B.baseLanes|C,cachePool:null},Y.childLanes=f.childLanes&~C,g.memoizedState=eu,N):(C=Du(f,g,N.children,C),g.memoizedState=null,C)}function Sl(f,g){return g=Ni({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Du(f,g,C,N){var B=f.child;return f=B.sibling,C=Po(B,{mode:"visible",children:C}),!(g.mode&1)&&(C.lanes=N),C.return=g,C.sibling=null,f!==null&&(N=g.deletions,N===null?(g.deletions=[f],g.flags|=16):N.push(f)),g.child=C}function Xm(f,g,C,N,B){var Y=g.mode;f=f.child;var me=f.sibling,xe={mode:"hidden",children:C};return!(Y&1)&&g.child!==f?(C=g.child,C.childLanes=0,C.pendingProps=xe,g.deletions=null):(C=Po(f,xe),C.subtreeFlags=f.subtreeFlags&14680064),me!==null?N=Po(me,N):(N=ea(N,Y,B,null),N.flags|=2),N.return=g,C.return=g,C.sibling=N,g.child=C,N}function fp(f,g,C,N){return N!==null&&yh(N),qs(g,f.child,null,C),f=Sl(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function Id(f,g,C){f.lanes|=g;var N=f.alternate;N!==null&&(N.lanes|=g),mh(f.return,g,C)}function Yo(f,g,C,N,B){var Y=f.memoizedState;Y===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:N,tail:C,tailMode:B}:(Y.isBackwards=g,Y.rendering=null,Y.renderingStartTime=0,Y.last=N,Y.tail=C,Y.tailMode=B)}function tu(f,g,C){var N=g.pendingProps,B=N.revealOrder,Y=N.tail;if(Mo(f,g,N.children,C),N=_i.current,N&2)N=N&1|2,g.flags|=128;else{if(f!==null&&f.flags&128)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Id(f,C,g);else if(f.tag===19)Id(f,C,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}N&=1}if(On(_i,N),!(g.mode&1))g.memoizedState=null;else switch(B){case"forwards":for(C=g.child,B=null;C!==null;)f=C.alternate,f!==null&&Sh(f)===null&&(B=C),C=C.sibling;C=B,C===null?(B=g.child,g.child=null):(B=C.sibling,C.sibling=null),Yo(g,!1,B,C,Y);break;case"backwards":for(C=null,B=g.child,g.child=null;B!==null;){if(f=B.alternate,f!==null&&Sh(f)===null){g.child=B;break}f=B.sibling,B.sibling=C,C=B,B=f}Yo(g,!0,C,null,Y);break;case"together":Yo(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Jo(f,g,C){if(f!==null&&(g.dependencies=f.dependencies),Ta|=g.lanes,!(C&g.childLanes))return null;if(f!==null&&g.child!==f.child)throw Error(o(153));if(g.child!==null){for(f=g.child,C=Po(f,f.pendingProps),g.child=C,C.return=g;f.sibling!==null;)f=f.sibling,C=C.sibling=Po(f,f.pendingProps),C.return=g;C.sibling=null}return g.child}function W_(f,g,C){switch(g.tag){case 3:Md(g),Ha();break;case 5:Ga(g);break;case 1:Gn(g.type)&&lo(g);break;case 4:Zi(g,g.stateNode.containerInfo);break;case 10:V_(g,g.type._context,g.memoizedProps.value);break;case 13:var N=g.memoizedState;if(N!==null)return N.dehydrated!==null?(On(_i,_i.current&1),g.flags|=128,null):C&g.child.childLanes?Io(f,g,C):(On(_i,_i.current&1),f=Jo(f,g,C),f!==null?f.sibling:null);On(_i,_i.current&1);break;case 19:if(N=(C&g.childLanes)!==0,f.flags&128){if(N)return tu(f,g,C);g.flags|=128}var B=g.memoizedState;if(B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),On(_i,_i.current),N)break;return null;case 22:case 23:return g.lanes=0,$m(f,g,C)}return Jo(f,g,C)}function Km(f,g){switch(o0(g),g.tag){case 1:return Gn(g.type)&&Zn(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return Wn(),fn(Pi),fn(Gt),vt(),f=g.flags,f&65536&&!(f&128)?(g.flags=f&-65537|128,g):null;case 5:return Xs(g),null;case 13:if(fn(_i),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(o(340));Ha()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return fn(_i),null;case 4:return Wn(),null;case 10:return Xl(g.type._context),null;case 22:case 23:return Hd(),null;case 24:return null;default:return null}}var xh=!1,nu=!1,pp=typeof WeakSet=="function"?WeakSet:Set,jt=null;function wh(f,g){var C=f.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(N){xa(f,g,N)}else C.current=null}function Lc(f,g,C){try{C()}catch(N){xa(f,g,N)}}var $_=!1;function fo(f,g){for(J(f.containerInfo),jt=g;jt!==null;)if(f=jt,g=f.child,(f.subtreeFlags&1028)!==0&&g!==null)g.return=f,jt=g;else for(;jt!==null;){f=jt;try{var C=f.alternate;if(f.flags&1024)switch(f.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var N=C.memoizedProps,B=C.memoizedState,Y=f.stateNode,me=Y.getSnapshotBeforeUpdate(f.elementType===f.type?N:qr(f.type,N),B);Y.__reactInternalSnapshotBeforeUpdate=me}break;case 3:Qt&&ht(f.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(xe){xa(f,f.return,xe)}if(g=f.sibling,g!==null){g.return=f.return,jt=g;break}jt=f.return}return C=$_,$_=!1,C}function ru(f,g,C){var N=g.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var B=N=N.next;do{if((B.tag&f)===f){var Y=B.destroy;B.destroy=void 0,Y!==void 0&&Lc(g,C,Y)}B=B.next}while(B!==N)}}function Ch(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&f)===f){var N=C.create;C.destroy=N()}C=C.next}while(C!==g)}}function kd(f){var g=f.ref;if(g!==null){var C=f.stateNode;switch(f.tag){case 5:f=Q(C);break;default:f=C}typeof g=="function"?g(f):g.current=f}}function Ym(f,g,C){if(wc&&typeof wc.onCommitFiberUnmount=="function")try{wc.onCommitFiberUnmount(Xf,g)}catch{}switch(g.tag){case 0:case 11:case 14:case 15:if(f=g.updateQueue,f!==null&&(f=f.lastEffect,f!==null)){var N=f=f.next;do{var B=N,Y=B.destroy;B=B.tag,Y!==void 0&&(B&2||B&4)&&Lc(g,C,Y),N=N.next}while(N!==f)}break;case 1:if(wh(g,C),f=g.stateNode,typeof f.componentWillUnmount=="function")try{f.props=g.memoizedProps,f.state=g.memoizedState,f.componentWillUnmount()}catch(me){xa(g,C,me)}break;case 5:wh(g,C);break;case 4:Qt?f0(f,g,C):Kt&&Kt&&(g=g.stateNode.containerInfo,C=Lt(g),st(g,C))}}function Od(f,g,C){for(var N=g;;)if(Ym(f,N,C),N.child===null||Qt&&N.tag===4){if(N===g)break;for(;N.sibling===null;){if(N.return===null||N.return===g)return;N=N.return}N.sibling.return=N.return,N=N.sibling}else N.child.return=N,N=N.child}function Rh(f){var g=f.alternate;g!==null&&(f.alternate=null,Rh(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&nn(g)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function Nd(f){return f.tag===5||f.tag===3||f.tag===4}function ko(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Nd(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Uc(f){if(Qt){e:{for(var g=f.return;g!==null;){if(Nd(g))break e;g=g.return}throw Error(o(160))}var C=g;switch(C.tag){case 5:g=C.stateNode,C.flags&32&&(Et(g),C.flags&=-33),C=ko(f),Lu(f,C,g);break;case 3:case 4:g=C.stateNode.containerInfo,C=ko(f),Pd(f,C,g);break;default:throw Error(o(161))}}}function Pd(f,g,C){var N=f.tag;if(N===5||N===6)f=f.stateNode,g?Un(C,f,g):Wt(C,f);else if(N!==4&&(f=f.child,f!==null))for(Pd(f,g,C),f=f.sibling;f!==null;)Pd(f,g,C),f=f.sibling}function Lu(f,g,C){var N=f.tag;if(N===5||N===6)f=f.stateNode,g?Ft(C,f,g):Dt(C,f);else if(N!==4&&(f=f.child,f!==null))for(Lu(f,g,C),f=f.sibling;f!==null;)Lu(f,g,C),f=f.sibling}function f0(f,g,C){for(var N=g,B=!1,Y,me;;){if(!B){B=N.return;e:for(;;){if(B===null)throw Error(o(160));switch(Y=B.stateNode,B.tag){case 5:me=!1;break e;case 3:Y=Y.containerInfo,me=!0;break e;case 4:Y=Y.containerInfo,me=!0;break e}B=B.return}B=!0}if(N.tag===5||N.tag===6)Od(f,N,C),me?Ir(Y,N.stateNode):Zt(Y,N.stateNode);else if(N.tag===18)me?Ge(Y,N.stateNode):Ie(Y,N.stateNode);else if(N.tag===4){if(N.child!==null){Y=N.stateNode.containerInfo,me=!0,N.child.return=N,N=N.child;continue}}else if(Ym(f,N,C),N.child!==null){N.child.return=N,N=N.child;continue}if(N===g)break;for(;N.sibling===null;){if(N.return===null||N.return===g)return;N=N.return,N.tag===4&&(B=!1)}N.sibling.return=N.return,N=N.sibling}}function Jm(f,g){if(Qt){switch(g.tag){case 0:case 11:case 14:case 15:ru(3,g,g.return),Ch(3,g),ru(5,g,g.return);return;case 1:return;case 5:var C=g.stateNode;if(C!=null){var N=g.memoizedProps;f=f!==null?f.memoizedProps:N;var B=g.type,Y=g.updateQueue;g.updateQueue=null,Y!==null&&bt(C,Y,B,f,N,g)}return;case 6:if(g.stateNode===null)throw Error(o(162));C=g.memoizedProps,or(g.stateNode,f!==null?f.memoizedProps:C,C);return;case 3:xn&&f!==null&&f.memoizedState.isDehydrated&&pd(g.stateNode.containerInfo);return;case 12:return;case 13:mp(g);return;case 19:mp(g);return;case 17:return}throw Error(o(163))}switch(g.tag){case 0:case 11:case 14:case 15:ru(3,g,g.return),Ch(3,g),ru(5,g,g.return);return;case 12:return;case 13:mp(g);return;case 19:mp(g);return;case 3:xn&&f!==null&&f.memoizedState.isDehydrated&&pd(g.stateNode.containerInfo);break;case 22:case 23:return}e:if(Kt){switch(g.tag){case 1:case 5:case 6:break e;case 3:case 4:g=g.stateNode,st(g.containerInfo,g.pendingChildren);break e}throw Error(o(163))}}function mp(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var C=f.stateNode;C===null&&(C=f.stateNode=new pp),g.forEach(function(N){var B=wp.bind(null,f,N);C.has(N)||(C.add(N),N.then(B,B))})}}function Ah(f,g){for(jt=g;jt!==null;){g=jt;var C=g.deletions;if(C!==null)for(var N=0;N<C.length;N++){var B=C[N];try{var Y=f;Qt?f0(Y,B,g):Od(Y,B,g);var me=B.alternate;me!==null&&(me.return=null),B.return=null}catch(un){xa(B,g,un)}}if(C=g.child,g.subtreeFlags&12854&&C!==null)C.return=g,jt=C;else for(;jt!==null;){g=jt;try{var xe=g.flags;if(xe&32&&Qt&&Et(g.stateNode),xe&512){var tt=g.alternate;if(tt!==null){var Mt=tt.ref;Mt!==null&&(typeof Mt=="function"?Mt(null):Mt.current=null)}}if(xe&8192)switch(g.tag){case 13:if(g.memoizedState!==null){var rn=g.alternate;(rn===null||rn.memoizedState===null)&&(Zm=pr())}break;case 22:var ir=g.memoizedState!==null,on=g.alternate,$n=on!==null&&on.memoizedState!==null;if(C=g,Qt){e:if(N=C,B=ir,Y=null,Qt)for(var hn=N;;){if(hn.tag===5){if(Y===null){Y=hn;var Do=hn.stateNode;B?ii(Do):Nt(hn.stateNode,hn.memoizedProps)}}else if(hn.tag===6){if(Y===null){var _r=hn.stateNode;B?Me(_r):et(_r,hn.memoizedProps)}}else if((hn.tag!==22&&hn.tag!==23||hn.memoizedState===null||hn===N)&&hn.child!==null){hn.child.return=hn,hn=hn.child;continue}if(hn===N)break;for(;hn.sibling===null;){if(hn.return===null||hn.return===N)break e;Y===hn&&(Y=null),hn=hn.return}Y===hn&&(Y=null),hn.sibling.return=hn.return,hn=hn.sibling}}if(ir&&!$n&&C.mode&1){jt=C;for(var Ce=C.child;Ce!==null;){for(C=jt=Ce;jt!==null;){N=jt;var De=N.child;switch(N.tag){case 0:case 11:case 14:case 15:ru(4,N,N.return);break;case 1:wh(N,N.return);var He=N.stateNode;if(typeof He.componentWillUnmount=="function"){var Tt=N.return;try{He.props=N.memoizedProps,He.state=N.memoizedState,He.componentWillUnmount()}catch(un){xa(N,Tt,un)}}break;case 5:wh(N,N.return);break;case 22:if(N.memoizedState!==null){_p(C);continue}}De!==null?(De.return=N,jt=De):_p(C)}Ce=Ce.sibling}}}switch(xe&4102){case 2:Uc(g),g.flags&=-3;break;case 6:Uc(g),g.flags&=-3,Jm(g.alternate,g);break;case 4096:g.flags&=-4097;break;case 4100:g.flags&=-4097,Jm(g.alternate,g);break;case 4:Jm(g.alternate,g)}}catch(un){xa(g,g.return,un)}if(C=g.sibling,C!==null){C.return=g.return,jt=C;break}jt=g.return}}}function gp(f,g,C){jt=f,p0(f)}function p0(f,g,C){for(var N=(f.mode&1)!==0;jt!==null;){var B=jt,Y=B.child;if(B.tag===22&&N){var me=B.memoizedState!==null||xh;if(!me){var xe=B.alternate,tt=xe!==null&&xe.memoizedState!==null||nu;xe=xh;var Mt=nu;if(xh=me,(nu=tt)&&!Mt)for(jt=B;jt!==null;)me=jt,tt=me.child,me.tag===22&&me.memoizedState!==null?m0(B):tt!==null?(tt.return=me,jt=tt):m0(B);for(;Y!==null;)jt=Y,p0(Y),Y=Y.sibling;jt=B,xh=xe,nu=Mt}Qm(f)}else B.subtreeFlags&8772&&Y!==null?(Y.return=B,jt=Y):Qm(f)}}function Qm(f){for(;jt!==null;){var g=jt;if(g.flags&8772){var C=g.alternate;try{if(g.flags&8772)switch(g.tag){case 0:case 11:case 15:nu||Ch(5,g);break;case 1:var N=g.stateNode;if(g.flags&4&&!nu)if(C===null)N.componentDidMount();else{var B=g.elementType===g.type?C.memoizedProps:qr(g.type,C.memoizedProps);N.componentDidUpdate(B,C.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var Y=g.updateQueue;Y!==null&&ft(g,Y,N);break;case 3:var me=g.updateQueue;if(me!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=Q(g.child.stateNode);break;case 1:C=g.child.stateNode}ft(g,me,C)}break;case 5:var xe=g.stateNode;C===null&&g.flags&4&&xt(xe,g.type,g.memoizedProps,g);break;case 6:break;case 4:break;case 12:break;case 13:if(xn&&g.memoizedState===null){var tt=g.alternate;if(tt!==null){var Mt=tt.memoizedState;if(Mt!==null){var rn=Mt.dehydrated;rn!==null&&le(rn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}nu||g.flags&512&&kd(g)}catch(ir){xa(g,g.return,ir)}}if(g===f){jt=null;break}if(C=g.sibling,C!==null){C.return=g.return,jt=C;break}jt=g.return}}function _p(f){for(;jt!==null;){var g=jt;if(g===f){jt=null;break}var C=g.sibling;if(C!==null){C.return=g.return,jt=C;break}jt=g.return}}function m0(f){for(;jt!==null;){var g=jt;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{Ch(4,g)}catch(tt){xa(g,C,tt)}break;case 1:var N=g.stateNode;if(typeof N.componentDidMount=="function"){var B=g.return;try{N.componentDidMount()}catch(tt){xa(g,B,tt)}}var Y=g.return;try{kd(g)}catch(tt){xa(g,Y,tt)}break;case 5:var me=g.return;try{kd(g)}catch(tt){xa(g,me,tt)}}}catch(tt){xa(g,g.return,tt)}if(g===f){jt=null;break}var xe=g.sibling;if(xe!==null){xe.return=g.return,jt=xe;break}jt=g.return}}var Mh=0,Dd=1,Ih=2,vp=3,kh=4;if(typeof Symbol=="function"&&Symbol.for){var Ld=Symbol.for;Mh=Ld("selector.component"),Dd=Ld("selector.has_pseudo_class"),Ih=Ld("selector.role"),vp=Ld("selector.test_id"),kh=Ld("selector.text")}function Ud(f){var g=Re(f);if(g!=null){if(typeof g.memoizedProps["data-testname"]!="string")throw Error(o(364));return g}if(f=pe(f),f===null)throw Error(o(362));return f.stateNode.current}function g0(f,g){switch(g.$$typeof){case Mh:if(f.type===g.value)return!0;break;case Dd:e:{g=g.value,f=[f,0];for(var C=0;C<f.length;){var N=f[C++],B=f[C++],Y=g[B];if(N.tag!==5||!Je(N)){for(;Y!=null&&g0(N,Y);)B++,Y=g[B];if(B===g.length){g=!0;break e}else for(N=N.child;N!==null;)f.push(N,B),N=N.sibling}}g=!1}return g;case Ih:if(f.tag===5&&ut(f.stateNode,g.value))return!0;break;case kh:if((f.tag===5||f.tag===6)&&(f=ke(f),f!==null&&0<=f.indexOf(g.value)))return!0;break;case vp:if(f.tag===5&&(f=f.memoizedProps["data-testname"],typeof f=="string"&&f.toLowerCase()===g.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function yp(f){switch(f.$$typeof){case Mh:return"<"+(L(f.value)||"Unknown")+">";case Dd:return":has("+(yp(f)||"")+")";case Ih:return'[role="'+f.value+'"]';case kh:return'"'+f.value+'"';case vp:return'[data-testname="'+f.value+'"]';default:throw Error(o(365))}}function qa(f,g){var C=[];f=[f,0];for(var N=0;N<f.length;){var B=f[N++],Y=f[N++],me=g[Y];if(B.tag!==5||!Je(B)){for(;me!=null&&g0(B,me);)Y++,me=g[Y];if(Y===g.length)C.push(B);else for(B=B.child;B!==null;)f.push(B,Y),B=B.sibling}}return C}function Xa(f,g){if(!nt)throw Error(o(363));f=Ud(f),f=qa(f,g),g=[],f=Array.from(f);for(var C=0;C<f.length;){var N=f[C++];if(N.tag===5)Je(N)||g.push(N.stateNode);else for(N=N.child;N!==null;)f.push(N),N=N.sibling}return g}var Ka=Math.ceil,di=a.ReactCurrentDispatcher,Sp=a.ReactCurrentOwner,fi=a.ReactCurrentBatchConfig,gr=0,ts=null,ns=null,Is=0,Fs=0,wn=Or(0),rs=0,bn=null,Ta=0,Uu=0,Ep=0,Xi=null,Oo=null,Zm=0,bp=1/0;function yi(){bp=pr()+500}var Bs=!1,Fd=null,El=null,eg=!1,uc=null,Tp=0,Bd=0,Fu=null,zd=-1,Oh=0;function bi(){return gr&6?pr():zd!==-1?zd:zd=pr()}function Ya(f){return f.mode&1?gr&2&&Is!==0?Is&-Is:i0.transition!==null?(Oh===0&&(f=ar,ar<<=1,!(ar&4194240)&&(ar=64),Oh=f),Oh):(f=er,f!==0?f:Qe()):1}function Qo(f,g,C){if(50<Bd)throw Bd=0,Fu=null,Error(o(185));var N=is(f,g);return N===null?null:(wu(N,g,C),(!(gr&2)||N!==ts)&&(N===ts&&(!(gr&2)&&(Uu|=g),rs===4&&iu(N,Is)),zs(N,C),g===1&&gr===0&&!(f.mode&1)&&(yi(),Kf&&za())),N)}function is(f,g){f.lanes|=g;var C=f.alternate;for(C!==null&&(C.lanes|=g),C=f,f=f.return;f!==null;)f.childLanes|=g,C=f.alternate,C!==null&&(C.childLanes|=g),C=f,f=f.return;return C.tag===3?C.stateNode:null}function zs(f,g){var C=f.callbackNode;ql(f,g);var N=ph(f,f===ts?Is:0);if(N===0)C!==null&&hl(C),f.callbackNode=null,f.callbackPriority=0;else if(g=N&-N,f.callbackPriority!==g){if(C!=null&&hl(C),g===1)f.tag===0?z_(jd.bind(null,f)):Nm(jd.bind(null,f)),Ot?rt(function(){gr===0&&za()}):Mm(dl,za),C=null;else{switch(B_(N)){case 1:C=dl;break;case 4:C=r0;break;case 16:C=Im;break;case 536870912:C=km;break;default:C=Im}C=K_(C,Vd.bind(null,f))}f.callbackPriority=g,f.callbackNode=C}}function Vd(f,g){if(zd=-1,Oh=0,gr&6)throw Error(o(327));var C=f.callbackNode;if(Sr()&&f.callbackNode!==C)return null;var N=ph(f,f===ts?Is:0);if(N===0)return null;if(N&30||N&f.expiredLanes||g)g=Ph(f,N);else{g=N;var B=gr;gr|=2;var Y=_0();(ts!==f||Is!==g)&&(yi(),Oi(f,g));do try{No();break}catch(xe){Fc(f,xe)}while(!0);vd(),di.current=Y,gr=B,ns!==null?g=0:(ts=null,Is=0,g=rs)}if(g!==0){if(g===2&&(B=Wf(f),B!==0&&(N=B,g=xp(f,B))),g===1)throw C=bn,Oi(f,0),iu(f,N),zs(f,pr()),C;if(g===6)iu(f,N);else{if(B=f.current.alternate,!(N&30)&&!Nh(B)&&(g=Ph(f,N),g===2&&(Y=Wf(f),Y!==0&&(N=Y,g=xp(f,Y))),g===1))throw C=bn,Oi(f,0),iu(f,N),zs(f,pr()),C;switch(f.finishedWork=B,f.finishedLanes=N,g){case 0:case 1:throw Error(o(345));case 2:zu(f,Oo);break;case 3:if(iu(f,N),(N&130023424)===N&&(g=Zm+500-pr(),10<g)){if(ph(f,0)!==0)break;if(B=f.suspendedLanes,(B&N)!==N){bi(),f.pingedLanes|=f.suspendedLanes&B;break}f.timeoutHandle=Ze(zu.bind(null,f,Oo),g);break}zu(f,Oo);break;case 4:if(iu(f,N),(N&4194240)===N)break;for(g=f.eventTimes,B=-1;0<N;){var me=31-Di(N);Y=1<<me,me=g[me],me>B&&(B=me),N&=~Y}if(N=B,N=pr()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*Ka(N/1960))-N,10<N){f.timeoutHandle=Ze(zu.bind(null,f,Oo),N);break}zu(f,Oo);break;case 5:zu(f,Oo);break;default:throw Error(o(329))}}}return zs(f,pr()),f.callbackNode===C?Vd.bind(null,f):null}function xp(f,g){var C=Xi;return f.current.memoizedState.isDehydrated&&(Oi(f,g).flags|=256),f=Ph(f,g),f!==2&&(g=Oo,Oo=C,g!==null&&hc(g)),f}function hc(f){Oo===null?Oo=f:Oo.push.apply(Oo,f)}function Nh(f){for(var g=f;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var N=0;N<C.length;N++){var B=C[N],Y=B.getSnapshot;B=B.value;try{if(!fl(Y(),B))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function iu(f,g){for(g&=~Ep,g&=~Uu,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var C=31-Di(g),N=1<<C;f[C]=-1,g&=~N}}function jd(f){if(gr&6)throw Error(o(327));Sr();var g=ph(f,0);if(!(g&1))return zs(f,pr()),null;var C=Ph(f,g);if(f.tag!==0&&C===2){var N=Wf(f);N!==0&&(g=N,C=xp(f,N))}if(C===1)throw C=bn,Oi(f,0),iu(f,g),zs(f,pr()),C;if(C===6)throw Error(o(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,zu(f,Oo),zs(f,pr()),null}function Vs(f){uc!==null&&uc.tag===0&&!(gr&6)&&Sr();var g=gr;gr|=1;var C=fi.transition,N=er;try{if(fi.transition=null,er=1,f)return f()}finally{er=N,fi.transition=C,gr=g,!(gr&6)&&za()}}function Hd(){Fs=wn.current,fn(wn)}function Oi(f,g){f.finishedWork=null,f.finishedLanes=0;var C=f.timeoutHandle;if(C!==It&&(f.timeoutHandle=It,Ke(C)),ns!==null)for(C=ns.return;C!==null;){var N=C;switch(o0(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&Zn();break;case 3:Wn(),fn(Pi),fn(Gt),vt();break;case 5:Xs(N);break;case 4:Wn();break;case 13:fn(_i);break;case 19:fn(_i);break;case 10:Xl(N.type._context);break;case 22:case 23:Hd()}C=C.return}if(ts=f,ns=f=Po(f.current,null),Is=Fs=g,rs=0,bn=null,Ep=Uu=Ta=0,Oo=Xi=null,ya!==null){for(g=0;g<ya.length;g++)if(C=ya[g],N=C.interleaved,N!==null){C.interleaved=null;var B=N.next,Y=C.pending;if(Y!==null){var me=Y.next;Y.next=B,N.next=me}C.pending=N}ya=null}return f}function Fc(f,g){do{var C=ns;try{if(vd(),_s.current=Ea,Ed){for(var N=Ei.memoizedState;N!==null;){var B=N.queue;B!==null&&(B.pending=null),N=N.next}Ed=!1}if(Wa=0,vs=qi=Ei=null,sp=!1,Yl=0,Sp.current=null,C===null||C.return===null){rs=1,bn=g,ns=null;break}e:{var Y=f,me=C.return,xe=C,tt=g;if(g=Is,xe.flags|=32768,tt!==null&&typeof tt=="object"&&typeof tt.then=="function"){var Mt=tt,rn=xe,ir=rn.tag;if(!(rn.mode&1)&&(ir===0||ir===11||ir===15)){var on=rn.alternate;on?(rn.updateQueue=on.updateQueue,rn.memoizedState=on.memoizedState,rn.lanes=on.lanes):(rn.updateQueue=null,rn.memoizedState=null)}var $n=vl(me);if($n!==null){$n.flags&=-257,lp($n,me,xe,Y,g),$n.mode&1&&jm(Y,Mt,g),g=$n,tt=Mt;var hn=g.updateQueue;if(hn===null){var Do=new Set;Do.add(tt),g.updateQueue=Do}else hn.add(tt);break e}else{if(!(g&1)){jm(Y,Mt,g),Bu();break e}tt=Error(o(426))}}else if(si&&xe.mode&1){var _r=vl(me);if(_r!==null){!(_r.flags&65536)&&(_r.flags|=256),lp(_r,me,xe,Y,g),yh(tt);break e}}Y=tt,rs!==4&&(rs=2),Xi===null?Xi=[Y]:Xi.push(Y),tt=Zl(tt,xe),xe=me;do{switch(xe.tag){case 3:xe.flags|=65536,g&=-g,xe.lanes|=g;var Ce=wd(xe,tt,g);Ve(xe,Ce);break e;case 1:Y=tt;var De=xe.type,He=xe.stateNode;if(!(xe.flags&128)&&(typeof De.getDerivedStateFromError=="function"||He!==null&&typeof He.componentDidCatch=="function"&&(El===null||!El.has(He)))){xe.flags|=65536,g&=-g,xe.lanes|=g;var Tt=Th(xe,Y,g);Ve(xe,Tt);break e}}xe=xe.return}while(xe!==null)}tg(C)}catch(un){g=un,ns===C&&C!==null&&(ns=C=C.return);continue}break}while(!0)}function _0(){var f=di.current;return di.current=Ea,f===null?Ea:f}function Bu(){(rs===0||rs===3||rs===2)&&(rs=4),ts===null||!(Ta&268435455)&&!(Uu&268435455)||iu(ts,Is)}function Ph(f,g){var C=gr;gr|=2;var N=_0();ts===f&&Is===g||Oi(f,g);do try{Zo();break}catch(B){Fc(f,B)}while(!0);if(vd(),gr=C,di.current=N,ns!==null)throw Error(o(261));return ts=null,Is=0,rs}function Zo(){for(;ns!==null;)Qs(ns)}function No(){for(;ns!==null&&!qf();)Qs(ns)}function Qs(f){var g=X_(f.alternate,f,Fs);f.memoizedProps=f.pendingProps,g===null?tg(f):ns=g,Sp.current=null}function tg(f){var g=f;do{var C=g.alternate;if(f=g.return,g.flags&32768){if(C=Km(C,g),C!==null){C.flags&=32767,ns=C;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{rs=6,ns=null;return}}else if(C=l0(C,g,Fs),C!==null){ns=C;return}if(g=g.sibling,g!==null){ns=g;return}ns=g=f}while(g!==null);rs===0&&(rs=5)}function zu(f,g){var C=er,N=fi.transition;try{fi.transition=null,er=1,su(f,g,C)}finally{fi.transition=N,er=C}return null}function su(f,g,C){do Sr();while(uc!==null);if(gr&6)throw Error(o(327));var N=f.finishedWork,B=f.finishedLanes;if(N===null)return null;if(f.finishedWork=null,f.finishedLanes=0,N===f.current)throw Error(o(177));f.callbackNode=null,f.callbackPriority=0;var Y=N.lanes|N.childLanes;if(qo(f,Y),f===ts&&(ns=ts=null,Is=0),!(N.subtreeFlags&2064)&&!(N.flags&2064)||eg||(eg=!0,K_(Im,function(){return Sr(),null})),Y=(N.flags&15990)!==0,N.subtreeFlags&15990||Y){Y=fi.transition,fi.transition=null;var me=er;er=1;var xe=gr;gr|=4,Sp.current=null,fo(f,N),Ah(f,N),re(f.containerInfo),f.current=N,gp(N),Cu(),gr=xe,er=me,fi.transition=Y}else f.current=N;if(eg&&(eg=!1,uc=f,Tp=B),Y=f.pendingLanes,Y===0&&(El=null),Om(N.stateNode),zs(f,pr()),g!==null)for(C=f.onRecoverableError,N=0;N<g.length;N++)C(g[N]);if(Bs)throw Bs=!1,f=Fd,Fd=null,f;return Tp&1&&f.tag!==0&&Sr(),Y=f.pendingLanes,Y&1?f===Fu?Bd++:(Bd=0,Fu=f):Bd=0,za(),null}function Sr(){if(uc!==null){var f=B_(Tp),g=fi.transition,C=er;try{if(fi.transition=null,er=16>f?16:f,uc===null)var N=!1;else{if(f=uc,uc=null,Tp=0,gr&6)throw Error(o(331));var B=gr;for(gr|=4,jt=f.current;jt!==null;){var Y=jt,me=Y.child;if(jt.flags&16){var xe=Y.deletions;if(xe!==null){for(var tt=0;tt<xe.length;tt++){var Mt=xe[tt];for(jt=Mt;jt!==null;){var rn=jt;switch(rn.tag){case 0:case 11:case 15:ru(8,rn,Y)}var ir=rn.child;if(ir!==null)ir.return=rn,jt=ir;else for(;jt!==null;){rn=jt;var on=rn.sibling,$n=rn.return;if(Rh(rn),rn===Mt){jt=null;break}if(on!==null){on.return=$n,jt=on;break}jt=$n}}}var hn=Y.alternate;if(hn!==null){var Do=hn.child;if(Do!==null){hn.child=null;do{var _r=Do.sibling;Do.sibling=null,Do=_r}while(Do!==null)}}jt=Y}}if(Y.subtreeFlags&2064&&me!==null)me.return=Y,jt=me;else e:for(;jt!==null;){if(Y=jt,Y.flags&2048)switch(Y.tag){case 0:case 11:case 15:ru(9,Y,Y.return)}var Ce=Y.sibling;if(Ce!==null){Ce.return=Y.return,jt=Ce;break e}jt=Y.return}}var De=f.current;for(jt=De;jt!==null;){me=jt;var He=me.child;if(me.subtreeFlags&2064&&He!==null)He.return=me,jt=He;else e:for(me=De;jt!==null;){if(xe=jt,xe.flags&2048)try{switch(xe.tag){case 0:case 11:case 15:Ch(9,xe)}}catch(un){xa(xe,xe.return,un)}if(xe===me){jt=null;break e}var Tt=xe.sibling;if(Tt!==null){Tt.return=xe.return,jt=Tt;break e}jt=xe.return}}if(gr=B,za(),wc&&typeof wc.onPostCommitFiberRoot=="function")try{wc.onPostCommitFiberRoot(Xf,f)}catch{}N=!0}return N}finally{er=C,fi.transition=g}}return!1}function q_(f,g,C){g=Zl(C,g),g=wd(f,g,1),Xo(f,g),g=bi(),f=is(f,1),f!==null&&(wu(f,1,g),zs(f,g))}function xa(f,g,C){if(f.tag===3)q_(f,f,C);else for(;g!==null;){if(g.tag===3){q_(g,f,C);break}else if(g.tag===1){var N=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(El===null||!El.has(N))){f=Zl(C,f),f=Th(g,f,1),Xo(g,f),f=bi(),g=is(g,1),g!==null&&(wu(g,1,f),zs(g,f));break}}g=g.return}}function Ky(f,g,C){var N=f.pingCache;N!==null&&N.delete(g),g=bi(),f.pingedLanes|=f.suspendedLanes&C,ts===f&&(Is&C)===C&&(rs===4||rs===3&&(Is&130023424)===Is&&500>pr()-Zm?Oi(f,0):Ep|=C),zs(f,g)}function Dh(f,g){g===0&&(f.mode&1?(g=fh,fh<<=1,!(fh&130023424)&&(fh=4194304)):g=1);var C=bi();f=is(f,g),f!==null&&(wu(f,g,C),zs(f,C))}function Gd(f){var g=f.memoizedState,C=0;g!==null&&(C=g.retryLane),Dh(f,C)}function wp(f,g){var C=0;switch(f.tag){case 13:var N=f.stateNode,B=f.memoizedState;B!==null&&(C=B.retryLane);break;case 19:N=f.stateNode;break;default:throw Error(o(314))}N!==null&&N.delete(g),Dh(f,C)}var X_;X_=function(f,g,C){if(f!==null)if(f.memoizedProps!==g.pendingProps||Pi.current)ba=!0;else{if(!(f.lanes&C)&&!(g.flags&128))return ba=!1,W_(f,g,C);ba=!!(f.flags&131072)}else ba=!1,si&&g.flags&1048576&&Zf(g,Pm,g.index);switch(g.lanes=0,g.tag){case 2:var N=g.type;f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2),f=g.pendingProps;var B=ws(g,Gt.current);Ns(g,C),B=bd(null,g,N,f,B,C);var Y=ce();return g.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Gn(N)?(Y=!0,lo(g)):Y=!1,g.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,ms(g),B.updater=Nr,g.stateNode=B,B._reactInternals=g,gh(g,N,f,C),g=d0(null,g,N,!0,Y,C)):(g.tag=0,si&&Y&&Iu(g),Mo(null,g,B,C),g=g.child),g;case 16:N=g.elementType;e:{switch(f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2),f=g.pendingProps,B=N._init,N=B(N._payload),g.type=N,B=g.tag=Lh(N),f=qr(N,f),B){case 0:g=mr(null,g,N,f,C);break e;case 1:g=dp(null,g,N,f,C);break e;case 11:g=u0(null,g,N,f,C);break e;case 14:g=Wm(null,g,N,qr(N.type,f),C);break e}throw Error(o(306,N,""))}return g;case 0:return N=g.type,B=g.pendingProps,B=g.elementType===N?B:qr(N,B),mr(f,g,N,B,C);case 1:return N=g.type,B=g.pendingProps,B=g.elementType===N?B:qr(N,B),dp(f,g,N,B,C);case 3:e:{if(Md(g),f===null)throw Error(o(387));N=g.pendingProps,Y=g.memoizedState,B=Y.element,gs(f,g),Be(g,N,null,C);var me=g.memoizedState;if(N=me.element,xn&&Y.isDehydrated)if(Y={element:N,isDehydrated:!1,cache:me.cache,transitions:me.transitions},g.updateQueue.baseState=Y,g.memoizedState=Y,g.flags&256){B=Error(o(423)),g=Pu(f,g,N,C,B);break e}else if(N!==B){B=Error(o(424)),g=Pu(f,g,N,C,B);break e}else for(xn&&(wo=Qr(g.stateNode.containerInfo),ja=g,si=!0,lc=null,cc=!1),C=rp(g,null,N,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Ha(),N===B){g=Jo(f,g,C);break e}Mo(f,g,N,C)}g=g.child}return g;case 5:return Ga(g),f===null&&Kl(g),N=g.type,B=g.pendingProps,Y=f!==null?f.memoizedProps:null,me=B.children,Ae(N,B)?me=null:Y!==null&&Ae(N,Y)&&(g.flags|=32),qm(f,g),Mo(f,g,me,C),g.child;case 6:return f===null&&Kl(g),null;case 13:return Io(f,g,C);case 4:return Zi(g,g.stateNode.containerInfo),N=g.pendingProps,f===null?g.child=qs(g,null,N,C):Mo(f,g,N,C),g.child;case 11:return N=g.type,B=g.pendingProps,B=g.elementType===N?B:qr(N,B),u0(f,g,N,B,C);case 7:return Mo(f,g,g.pendingProps,C),g.child;case 8:return Mo(f,g,g.pendingProps.children,C),g.child;case 12:return Mo(f,g,g.pendingProps.children,C),g.child;case 10:e:{if(N=g.type._context,B=g.pendingProps,Y=g.memoizedProps,me=B.value,V_(g,N,me),Y!==null)if(fl(Y.value,me)){if(Y.children===B.children&&!Pi.current){g=Jo(f,g,C);break e}}else for(Y=g.child,Y!==null&&(Y.return=g);Y!==null;){var xe=Y.dependencies;if(xe!==null){me=Y.child;for(var tt=xe.firstContext;tt!==null;){if(tt.context===N){if(Y.tag===1){tt=Rc(-1,C&-C),tt.tag=2;var Mt=Y.updateQueue;if(Mt!==null){Mt=Mt.shared;var rn=Mt.pending;rn===null?tt.next=tt:(tt.next=rn.next,rn.next=tt),Mt.pending=tt}}Y.lanes|=C,tt=Y.alternate,tt!==null&&(tt.lanes|=C),mh(Y.return,C,g),xe.lanes|=C;break}tt=tt.next}}else if(Y.tag===10)me=Y.type===g.type?null:Y.child;else if(Y.tag===18){if(me=Y.return,me===null)throw Error(o(341));me.lanes|=C,xe=me.alternate,xe!==null&&(xe.lanes|=C),mh(me,C,g),me=Y.sibling}else me=Y.child;if(me!==null)me.return=Y;else for(me=Y;me!==null;){if(me===g){me=null;break}if(Y=me.sibling,Y!==null){Y.return=me.return,me=Y;break}me=me.return}Y=me}Mo(f,g,B.children,C),g=g.child}return g;case 9:return B=g.type,N=g.pendingProps.children,Ns(g,C),B=Li(B),N=N(B),g.flags|=1,Mo(f,g,N,C),g.child;case 14:return N=g.type,B=qr(N,g.pendingProps),B=qr(N.type,B),Wm(f,g,N,B,C);case 15:return h0(f,g,g.type,g.pendingProps,C);case 17:return N=g.type,B=g.pendingProps,B=g.elementType===N?B:qr(N,B),f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2),g.tag=1,Gn(N)?(f=!0,lo(g)):f=!1,Ns(g,C),Ac(g,N,B),gh(g,N,B,C),d0(null,g,N,!0,f,C);case 19:return tu(f,g,C);case 22:return $m(f,g,C)}throw Error(o(156,g.tag))};function K_(f,g){return Mm(f,g)}function Yy(f,g,C,N){this.tag=f,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ss(f,g,C,N){return new Yy(f,g,C,N)}function Ja(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Lh(f){if(typeof f=="function")return Ja(f)?1:0;if(f!=null){if(f=f.$$typeof,f===y)return 11;if(f===A)return 14}return 2}function Po(f,g){var C=f.alternate;return C===null?(C=ss(f.tag,g,f.key,f.mode),C.elementType=f.elementType,C.type=f.type,C.stateNode=f.stateNode,C.alternate=f,f.alternate=C):(C.pendingProps=g,C.type=f.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=f.flags&14680064,C.childLanes=f.childLanes,C.lanes=f.lanes,C.child=f.child,C.memoizedProps=f.memoizedProps,C.memoizedState=f.memoizedState,C.updateQueue=f.updateQueue,g=f.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=f.sibling,C.index=f.index,C.ref=f.ref,C}function bl(f,g,C,N,B,Y){var me=2;if(N=f,typeof f=="function")Ja(f)&&(me=1);else if(typeof f=="string")me=5;else e:switch(f){case u:return ea(C.children,B,Y,g);case h:me=8,B|=8;break;case d:return f=ss(12,C,g,B|2),f.elementType=d,f.lanes=Y,f;case S:return f=ss(13,C,g,B),f.elementType=S,f.lanes=Y,f;case T:return f=ss(19,C,g,B),f.elementType=T,f.lanes=Y,f;case I:return Ni(C,B,Y,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case p:me=10;break e;case _:me=9;break e;case y:me=11;break e;case A:me=14;break e;case R:me=16,N=null;break e}throw Error(o(130,f==null?f:typeof f,""))}return g=ss(me,C,g,B),g.elementType=f,g.type=N,g.lanes=Y,g}function ea(f,g,C,N){return f=ss(7,f,N,g),f.lanes=C,f}function Ni(f,g,C,N){return f=ss(22,f,N,g),f.elementType=I,f.lanes=C,f.stateNode={},f}function po(f,g,C){return f=ss(6,f,null,g),f.lanes=C,f}function Cp(f,g,C){return g=ss(4,f.children!==null?f.children:[],f.key,g),g.lanes=C,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function ng(f,g,C,N,B){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=It,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$f(0),this.expirationTimes=$f(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$f(0),this.identifierPrefix=N,this.onRecoverableError=B,xn&&(this.mutableSourceEagerHydrationData=null)}function v0(f,g,C,N,B,Y,me,xe,tt){return f=new ng(f,g,C,xe,tt),g===1?(g=1,Y===!0&&(g|=8)):g=0,Y=ss(3,null,null,g),f.current=Y,Y.stateNode=f,Y.memoizedState={element:N,isDehydrated:C,cache:null,transitions:null},ms(Y),f}function Y_(f){if(!f)return hr;f=f._reactInternals;e:{if(F(f)!==f||f.tag!==1)throw Error(o(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Gn(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(o(171))}if(f.tag===1){var C=f.type;if(Gn(C))return hi(f,C,g)}return g}function y0(f){var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(o(188)):(f=Object.keys(f).join(","),Error(o(268,f)));return f=X(g),f===null?null:f.stateNode}function Rp(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var C=f.retryLane;f.retryLane=C!==0&&C<g?C:g}}function rg(f,g){Rp(f,g),(f=f.alternate)&&Rp(f,g)}function Jy(f){return f=X(f),f===null?null:f.stateNode}function Ap(){return null}return t.attemptContinuousHydration=function(f){if(f.tag===13){var g=bi();Qo(f,134217728,g),rg(f,134217728)}},t.attemptHydrationAtCurrentPriority=function(f){if(f.tag===13){var g=bi(),C=Ya(f);Qo(f,C,g),rg(f,C)}},t.attemptSynchronousHydration=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var C=xo(g.pendingLanes);C!==0&&(gd(g,C|1),zs(g,pr()),!(gr&6)&&(yi(),za()))}break;case 13:var N=bi();Vs(function(){return Qo(f,1,N)}),rg(f,1)}},t.batchedUpdates=function(f,g){var C=gr;gr|=1;try{return f(g)}finally{gr=C,gr===0&&(yi(),Kf&&za())}},t.createComponentSelector=function(f){return{$$typeof:Mh,value:f}},t.createContainer=function(f,g,C,N,B,Y,me){return v0(f,g,!1,null,C,N,B,Y,me)},t.createHasPseudoClassSelector=function(f){return{$$typeof:Dd,value:f}},t.createHydrationContainer=function(f,g,C,N,B,Y,me,xe,tt){return f=v0(C,N,!0,f,B,Y,me,xe,tt),f.context=Y_(null),C=f.current,N=bi(),B=Ya(C),Y=Rc(N,B),Y.callback=g??null,Xo(C,Y),f.current.lanes=B,wu(f,B,N),zs(f,N),f},t.createPortal=function(f,g,C){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:N==null?null:""+N,children:f,containerInfo:g,implementation:C}},t.createRoleSelector=function(f){return{$$typeof:Ih,value:f}},t.createTestNameSelector=function(f){return{$$typeof:vp,value:f}},t.createTextSelector=function(f){return{$$typeof:kh,value:f}},t.deferredUpdates=function(f){var g=er,C=fi.transition;try{return fi.transition=null,er=16,f()}finally{er=g,fi.transition=C}},t.discreteUpdates=function(f,g,C,N,B){var Y=er,me=fi.transition;try{return fi.transition=null,er=1,f(g,C,N,B)}finally{er=Y,fi.transition=me,gr===0&&yi()}},t.findAllNodes=Xa,t.findBoundingRects=function(f,g){if(!nt)throw Error(o(363));g=Xa(f,g),f=[];for(var C=0;C<g.length;C++)f.push(oe(g[C]));for(g=f.length-1;0<g;g--){C=f[g];for(var N=C.x,B=N+C.width,Y=C.y,me=Y+C.height,xe=g-1;0<=xe;xe--)if(g!==xe){var tt=f[xe],Mt=tt.x,rn=Mt+tt.width,ir=tt.y,on=ir+tt.height;if(N>=Mt&&Y>=ir&&B<=rn&&me<=on){f.splice(g,1);break}else if(N!==Mt||C.width!==tt.width||on<Y||ir>me){if(!(Y!==ir||C.height!==tt.height||rn<N||Mt>B)){Mt>N&&(tt.width+=Mt-N,tt.x=N),rn<B&&(tt.width=B-Mt),f.splice(g,1);break}}else{ir>Y&&(tt.height+=ir-Y,tt.y=Y),on<me&&(tt.height=me-ir),f.splice(g,1);break}}}return f},t.findHostInstance=y0,t.findHostInstanceWithNoPortals=function(f){return f=W(f),f=f!==null?K(f):null,f===null?null:f.stateNode},t.findHostInstanceWithWarning=function(f){return y0(f)},t.flushControlled=function(f){var g=gr;gr|=1;var C=fi.transition,N=er;try{fi.transition=null,er=1,f()}finally{er=N,fi.transition=C,gr=g,gr===0&&(yi(),za())}},t.flushPassiveEffects=Sr,t.flushSync=Vs,t.focusWithin=function(f,g){if(!nt)throw Error(o(363));for(f=Ud(f),g=qa(f,g),g=Array.from(g),f=0;f<g.length;){var C=g[f++];if(!Je(C)){if(C.tag===5&&ot(C.stateNode))return!0;for(C=C.child;C!==null;)g.push(C),C=C.sibling}}return!1},t.getCurrentUpdatePriority=function(){return er},t.getFindAllNodesFailureDescription=function(f,g){if(!nt)throw Error(o(363));var C=0,N=[];f=[Ud(f),0];for(var B=0;B<f.length;){var Y=f[B++],me=f[B++],xe=g[me];if((Y.tag!==5||!Je(Y))&&(g0(Y,xe)&&(N.push(yp(xe)),me++,me>C&&(C=me)),me<g.length))for(Y=Y.child;Y!==null;)f.push(Y,me),Y=Y.sibling}if(C<g.length){for(f=[];C<g.length;C++)f.push(yp(g[C]));return`findAllNodes was able to match part of the selector:
  `+(N.join(" > ")+`

No matching component was found for:
  `)+f.join(" > ")}return null},t.getPublicRootInstance=function(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return Q(f.child.stateNode);default:return f.child.stateNode}},t.injectIntoDevTools=function(f){if(f={bundleType:f.bundleType,version:f.version,rendererPackageName:f.rendererPackageName,rendererConfig:f.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:Jy,findFiberByHostInstance:f.findFiberByHostInstance||Ap,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")f=!1;else{var g=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(g.isDisabled||!g.supportsFiber)f=!0;else{try{Xf=g.inject(f),wc=g}catch{}f=!!g.checkDCE}}return f},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(f,g,C,N){if(!nt)throw Error(o(363));f=Xa(f,g);var B=cn(f,C,N).disconnect;return{disconnect:function(){B()}}},t.registerMutableSourceForHydration=function(f,g){var C=g._getVersion;C=C(g._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[g,C]:f.mutableSourceEagerHydrationData.push(g,C)},t.runWithPriority=function(f,g){var C=er;try{return er=f,g()}finally{er=C}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(f,g,C,N){var B=g.current,Y=bi(),me=Ya(B);return C=Y_(C),g.context===null?g.context=C:g.pendingContext=C,g=Rc(Y,me),g.payload={element:f},N=N===void 0?null:N,N!==null&&(g.callback=N),Xo(B,g),f=Qo(B,me,Y),f!==null&&Au(f,B,me),me},t};xB.exports=zK;var VK=xB.exports;const jK=Wl(VK),sk={},ok=n=>void Object.assign(sk,n);function HK(n,e){function t(u,{args:h=[],attach:d,...p},_){let y=`${u[0].toUpperCase()}${u.slice(1)}`,S;if(u==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const T=p.object;S=Tv(T,{type:u,root:_,attach:d,primitive:!0})}else{const T=sk[y];if(!T)throw new Error(`R3F: ${y} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");S=Tv(new T(...h),{type:u,root:_,attach:d,memoizedProps:{args:h}})}return S.__r3f.attach===void 0&&(S instanceof sd?S.__r3f.attach="geometry":S instanceof mm&&(S.__r3f.attach="material")),y!=="inject"&&q1(S,p),S}function r(u,h){let d=!1;if(h){var p,_;(p=h.__r3f)!=null&&p.attach?$1(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(_=u.__r3f)==null||_.objects.push(h),h.__r3f||Tv(h,{}),h.__r3f.parent=u,VA(h),xv(h)}}function i(u,h,d){let p=!1;if(h){var _,y;if((_=h.__r3f)!=null&&_.attach)$1(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const S=u.children.filter(A=>A!==h),T=S.indexOf(d);u.children=[...S.slice(0,T),h,...S.slice(T)],p=!0}p||(y=u.__r3f)==null||y.objects.push(h),h.__r3f||Tv(h,{}),h.__r3f.parent=u,VA(h),xv(h)}}function s(u,h,d=!1){u&&[...u].forEach(p=>o(h,p,d))}function o(u,h,d){if(h){var p,_,y;if(h.__r3f&&(h.__r3f.parent=null),(p=u.__r3f)!=null&&p.objects&&(u.__r3f.objects=u.__r3f.objects.filter(I=>I!==h)),(_=h.__r3f)!=null&&_.attach)wD(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var S;u.remove(h),(S=h.__r3f)!=null&&S.root&&QK(BT(h),h)}const A=(y=h.__r3f)==null?void 0:y.primitive,R=!A&&(d===void 0?h.dispose!==null:d);if(!A){var T;s((T=h.__r3f)==null?void 0:T.objects,h,R),s(h.children,h,R)}if(delete h.__r3f,R&&h.dispose&&h.type!=="Scene"){const I=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?BA.unstable_scheduleCallback(BA.unstable_IdlePriority,I):I()}xv(u)}}function a(u,h,d,p){var _;const y=(_=u.__r3f)==null?void 0:_.parent;if(!y)return;const S=t(h,d,u.__r3f.root);if(u.children){for(const T of u.children)T.__r3f&&r(S,T);u.children=u.children.filter(T=>!T.__r3f)}u.__r3f.objects.forEach(T=>r(S,T)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(y,u),S.parent&&(S.__r3f.autoRemovedBeforeAppend=!0),r(y,S),S.raycast&&S.__r3f.eventCount&&BT(S).getState().internal.interaction.push(S),[p,p.alternate].forEach(T=>{T!==null&&(T.stateNode=S,T.ref&&(typeof T.ref=="function"?T.ref(S):T.ref.current=S))})}const c=()=>{};return{reconciler:jK({createInstance:t,removeChild:o,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const p=u.getState().scene;p.__r3f&&i(p,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,p){var _;if(((_=u==null?void 0:u.__r3f)!=null?_:{}).primitive&&p.object&&p.object!==u)return[!0];{const{args:S=[],children:T,...A}=p,{args:R=[],children:I,...U}=d;if(!Array.isArray(S))throw new Error("R3F: the args prop must be an array!");if(S.some((L,z)=>L!==R[z]))return[!0];const D=kB(u,A,U,!0);return D.changes.length?[!1,D]:null}},commitUpdate(u,[h,d],p,_,y,S){h?a(u,p,y,S):q1(u,d)},commitMount(u,h,d,p){var _;const y=(_=u.__r3f)!=null?_:{};u.raycast&&y.handlers&&y.eventCount&&BT(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Tv(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:p}=(h=u.__r3f)!=null?h:{};d&&p&&wD(p,u,d),u.isObject3D&&(u.visible=!1),xv(u)},unhideInstance(u,h){var d;const{attach:p,parent:_}=(d=u.__r3f)!=null?d:{};p&&_&&$1(_,u,p),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),xv(u)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>e?e():Nv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&ls.fun(performance.now)?performance.now:ls.fun(Date.now)?Date.now:()=>0,scheduleTimeout:ls.fun(setTimeout)?setTimeout:void 0,cancelTimeout:ls.fun(clearTimeout)?clearTimeout:void 0}),applyProps:q1}}var ED,bD;const W1=n=>"colorSpace"in n||"outputColorSpace"in n,RB=()=>{var n;return(n=sk.ColorManagement)!=null?n:null},AB=n=>n&&n.isOrthographicCamera,zw=typeof window<"u"&&((ED=window.document)!=null&&ED.createElement||((bD=window.navigator)==null?void 0:bD.product)==="ReactNative")?at.useLayoutEffect:at.useEffect;function GK(n){const e=at.useRef(n);return zw(()=>void(e.current=n),[n]),e}class WK extends at.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}WK.getDerivedStateFromError=()=>({error:!0});const MB="__default",TD=new Map,$K=n=>n&&!!n.memoized&&!!n.changes;function IB(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const rS=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()};function BT(n){let e=n.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const ls={obj:n=>n===Object(n)&&!ls.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(ls.str(n)||ls.num(n)||ls.boo(n))return n===e;const s=ls.obj(n);if(s&&r==="reference")return n===e;const o=ls.arr(n);if(o&&t==="reference")return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(s&&t==="shallow"&&r==="shallow"){for(a in i?e:n)if(!ls.equ(n[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:n)if(n[a]!==e[a])return!1;if(ls.und(a)){if(o&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function qK(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function XK(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function Tv(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function zA(n,e){let t=n;if(e.includes("-")){const r=e.split("-"),i=r.pop();return t=r.reduce((s,o)=>s[o],n),{target:t,key:i}}else return{target:t,key:e}}const xD=/-\d+$/;function $1(n,e,t){if(ls.str(t)){if(xD.test(t)){const s=t.replace(xD,""),{target:o,key:a}=zA(n,s);Array.isArray(o[a])||(o[a]=[])}const{target:r,key:i}=zA(n,t);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=t(n,e)}function wD(n,e,t){var r,i;if(ls.str(t)){const{target:s,key:o}=zA(n,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(n,e);(i=e.__r3f)==null||delete i.previousAttach}function kB(n,{children:e,key:t,ref:r,...i},{children:s,key:o,ref:a,...c}={},l=!1){const u=n.__r3f,h=Object.entries(i),d=[];if(l){const _=Object.keys(c);for(let y=0;y<_.length;y++)i.hasOwnProperty(_[y])||h.unshift([_[y],MB+"remove"])}h.forEach(([_,y])=>{var S;if((S=n.__r3f)!=null&&S.primitive&&_==="object"||ls.equ(y,c[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return d.push([_,y,!0,[]]);let T=[];_.includes("-")&&(T=_.split("-")),d.push([_,y,!1,T]);for(const A in i){const R=i[A];A.startsWith(`${_}-`)&&d.push([A,R,!1,A.split("-")])}});const p={...i};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:d}}const KK=typeof process<"u"&&!1;function q1(n,e){var t;const r=n.__r3f,i=r==null?void 0:r.root,s=i==null||i.getState==null?void 0:i.getState(),{memoized:o,changes:a}=$K(e)?e:kB(n,e),c=r==null?void 0:r.eventCount;n.__r3f&&(n.__r3f.memoizedProps=o);for(let u=0;u<a.length;u++){let[h,d,p,_]=a[u];if(W1(n)){const A="srgb",R="srgb-linear";h==="encoding"?(h="colorSpace",d=d===3001?A:R):h==="outputEncoding"&&(h="outputColorSpace",d=d===3001?A:R)}let y=n,S=y[h];if(_.length&&(S=_.reduce((T,A)=>T[A],n),!(S&&S.set))){const[T,...A]=_.reverse();y=A.reverse().reduce((R,I)=>R[I],n),h=T}if(d===MB+"remove")if(y.constructor){let T=TD.get(y.constructor);T||(T=new y.constructor,TD.set(y.constructor,T)),d=T[h]}else d=0;if(p&&r)d?r.handlers[h]=d:delete r.handlers[h],r.eventCount=Object.keys(r.handlers).length;else if(S&&S.set&&(S.copy||S instanceof Gv)){if(Array.isArray(d))S.fromArray?S.fromArray(d):S.set(...d);else if(S.copy&&d&&d.constructor&&(KK?S.constructor.name===d.constructor.name:S.constructor===d.constructor))S.copy(d);else if(d!==void 0){const T=S instanceof pi;!T&&S.setScalar?S.setScalar(d):S instanceof Gv&&d instanceof Gv?S.mask=d.mask:S.set(d),!RB()&&s&&!s.linear&&T&&S.convertSRGBToLinear()}}else if(y[h]=d,y[h]instanceof so&&y[h].format===Zu&&y[h].type===Ec&&s){const T=y[h];W1(T)&&W1(s.gl)?T.colorSpace=s.gl.outputColorSpace:T.encoding=s.gl.outputEncoding}xv(n)}if(r&&r.parent&&n.raycast&&c!==r.eventCount){const u=BT(n).getState().internal,h=u.interaction.indexOf(n);h>-1&&u.interaction.splice(h,1),r.eventCount&&u.interaction.push(n)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=n.__r3f)!=null&&t.parent&&VA(n),n}function xv(n){var e,t;const r=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();r&&r.internal.frames===0&&r.invalidate()}function VA(n){n.onUpdate==null||n.onUpdate(n)}function YK(n,e){n.manual||(AB(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function Yb(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function JK(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Nv.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Nv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Nv.ContinuousEventPriority;default:return Nv.DefaultEventPriority}}function OB(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function QK(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{OB(t.capturedMap,e,r,i)})}function ZK(n){function e(c){const{internal:l}=n.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=n.getState(),h=new Set,d=[],p=l?l(u.internal.interaction):u.internal.interaction;for(let T=0;T<p.length;T++){const A=rS(p[T]);A&&(A.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function _(T){const A=rS(T);if(!A||!A.events.enabled||A.raycaster.camera===null)return[];if(A.raycaster.camera===void 0){var R;A.events.compute==null||A.events.compute(c,A,(R=A.previousRoot)==null?void 0:R.getState()),A.raycaster.camera===void 0&&(A.raycaster.camera=null)}return A.raycaster.camera?A.raycaster.intersectObject(T,!0):[]}let y=p.flatMap(_).sort((T,A)=>{const R=rS(T.object),I=rS(A.object);return!R||!I?T.distance-A.distance:I.events.priority-R.events.priority||T.distance-A.distance}).filter(T=>{const A=Yb(T);return h.has(A)?!1:(h.add(A),!0)});u.events.filter&&(y=u.events.filter(y,u));for(const T of y){let A=T.object;for(;A;){var S;(S=A.__r3f)!=null&&S.eventCount&&d.push({...T,eventObject:A}),A=A.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let T of u.internal.capturedMap.get(c.pointerId).values())h.has(Yb(T.intersection))||d.push(T.intersection);return d}function i(c,l,u,h){const d=n.getState();if(c.length){const p={stopped:!1};for(const _ of c){const y=rS(_.object)||d,{raycaster:S,pointer:T,camera:A,internal:R}=y,I=new qe(T.x,T.y,0).unproject(A),U=V=>{var W,X;return(W=(X=R.capturedMap.get(V))==null?void 0:X.has(_.eventObject))!=null?W:!1},D=V=>{const W={intersection:_,target:l.target};R.capturedMap.has(V)?R.capturedMap.get(V).set(_.eventObject,W):R.capturedMap.set(V,new Map([[_.eventObject,W]])),l.target.setPointerCapture(V)},L=V=>{const W=R.capturedMap.get(V);W&&OB(R.capturedMap,_.eventObject,W,V)};let z={};for(let V in l){let W=l[V];typeof W!="function"&&(z[V]=W)}let F={..._,...z,pointer:T,intersections:c,stopped:p.stopped,delta:u,unprojectedPoint:I,ray:S.ray,camera:A,stopPropagation(){const V="pointerId"in l&&R.capturedMap.get(l.pointerId);if((!V||V.has(_.eventObject))&&(F.stopped=p.stopped=!0,R.hovered.size&&Array.from(R.hovered.values()).find(W=>W.eventObject===_.eventObject))){const W=c.slice(0,c.indexOf(_));s([...W,_])}},target:{hasPointerCapture:U,setPointerCapture:D,releasePointerCapture:L},currentTarget:{hasPointerCapture:U,setPointerCapture:D,releasePointerCapture:L},nativeEvent:l};if(h(F),p.stopped===!0)break}}return c}function s(c){const{internal:l}=n.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,p=d==null?void 0:d.handlers;if(l.hovered.delete(Yb(u)),d!=null&&d.eventCount){const _={...u,intersections:c};p.onPointerOut==null||p.onPointerOut(_),p.onPointerLeave==null||p.onPointerLeave(_)}}}function o(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=n.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=n.getState();d.lastEvent.current=u;const p=c==="onPointerMove",_=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",S=r(u,p?t:void 0),T=_?e(u):0;c==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=S.map(R=>R.eventObject)),_&&!S.length&&T<=2&&(o(u,d.interaction),h&&h(u)),p&&s(S);function A(R){const I=R.eventObject,U=I.__r3f,D=U==null?void 0:U.handlers;if(U!=null&&U.eventCount)if(p){if(D.onPointerOver||D.onPointerEnter||D.onPointerOut||D.onPointerLeave){const L=Yb(R),z=d.hovered.get(L);z?z.stopped&&R.stopPropagation():(d.hovered.set(L,R),D.onPointerOver==null||D.onPointerOver(R),D.onPointerEnter==null||D.onPointerEnter(R))}D.onPointerMove==null||D.onPointerMove(R)}else{const L=D[c];L?(!_||d.initialHits.includes(I))&&(o(u,d.interaction.filter(z=>!d.initialHits.includes(z))),L(R)):_&&d.initialHits.includes(I)&&o(u,d.interaction.filter(z=>!d.initialHits.includes(z)))}}i(S,u,T,A)}}return{handlePointer:a}}const NB=n=>!!(n!=null&&n.render),PB=at.createContext(null),eY=(n,e)=>{const t=DK((a,c)=>{const l=new qe,u=new qe,h=new qe;function d(T=c().camera,A=u,R=c().size){const{width:I,height:U,top:D,left:L}=R,z=I/U;A instanceof qe?h.copy(A):h.set(...A);const F=T.getWorldPosition(l).distanceTo(h);if(AB(T))return{width:I/T.zoom,height:U/T.zoom,top:D,left:L,factor:1,distance:F,aspect:z};{const V=T.fov*Math.PI/180,W=2*Math.tan(V/2)*F,X=W*(I/U);return{width:X,height:W,top:D,left:L,factor:I/X,distance:F,aspect:z}}}let p;const _=T=>a(A=>({performance:{...A.performance,current:T}})),y=new Ln;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(T=1)=>n(c(),T),advance:(T,A)=>e(T,A,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new IK,pointer:y,mouse:y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const T=c();p&&clearTimeout(p),T.performance.current!==T.performance.min&&_(T.performance.min),p=setTimeout(()=>_(c().performance.max),T.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:T=>a(A=>({...A,events:{...A.events,...T}})),setSize:(T,A,R,I,U)=>{const D=c().camera,L={width:T,height:A,top:I||0,left:U||0,updateStyle:R};a(z=>({size:L,viewport:{...z.viewport,...d(D,u,L)}}))},setDpr:T=>a(A=>{const R=IB(T);return{viewport:{...A.viewport,dpr:R,initialDpr:A.viewport.initialDpr||R}}}),setFrameloop:(T="always")=>{const A=c().clock;A.stop(),A.elapsedTime=0,T!=="never"&&(A.start(),A.elapsedTime=0),a(()=>({frameloop:T}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:at.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(T,A,R)=>{const I=c().internal;return I.priority=I.priority+(A>0?1:0),I.subscribers.push({ref:T,priority:A,store:R}),I.subscribers=I.subscribers.sort((U,D)=>U.priority-D.priority),()=>{const U=c().internal;U!=null&&U.subscribers&&(U.priority=U.priority-(A>0?1:0),U.subscribers=U.subscribers.filter(D=>D.ref!==T))}}}}}),r=t.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return t.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:h}=t.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){var d;i=c,s=l.dpr,YK(a,c),u.setPixelRatio(l.dpr);const p=(d=c.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,p)}a!==o&&(o=a,h(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};function DB(n,e){const t={callback:n};return e.add(t),()=>void e.delete(t)}let Jb,LB=new Set,UB=new Set,tY=new Set;const nY=n=>DB(n,LB),rY=n=>DB(n,UB);function X1(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function iS(n,e){switch(n){case"before":return X1(LB,e);case"after":return X1(UB,e);case"tail":return X1(tY,e)}}let K1,Y1;function J1(n,e,t){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),K1=e.internal.subscribers,Jb=0;Jb<K1.length;Jb++)Y1=K1[Jb],Y1.ref.current(Y1.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function iY(n){let e=!1,t=!1,r,i,s;function o(l){i=requestAnimationFrame(o),e=!0,r=0,iS("before",l),t=!0;for(const h of n.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=J1(l,s))}if(t=!1,iS("after",l),r===0)return iS("tail",l),e=!1,cancelAnimationFrame(i)}function a(l,u=1){var h;if(!l)return n.forEach(d=>a(d.store.getState(),u));(h=l.gl.xr)!=null&&h.isPresenting||!l.internal.active||l.frameloop==="never"||(u>1?l.internal.frames=Math.min(60,l.internal.frames+u):t?l.internal.frames=2:l.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function c(l,u=!0,h,d){if(u&&iS("before",l),h)J1(l,h,d);else for(const p of n.values())J1(l,p.store.getState());u&&iS("after",l)}return{loop:o,invalidate:a,advance:c}}function sY(n){const e=at.useRef(null);return zw(()=>void(e.current=n.current.__r3f),[n]),e}function FB(){const n=at.useContext(PB);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function Ly(n=t=>t,e){return FB()(n,e)}function Vw(n,e=0){const t=FB(),r=t.getState().internal.subscribe,i=GK(n);return zw(()=>r(i,e,t),[e,r,t]),null}const CD=new WeakMap;function BB(n,e){return function(t,...r){let i=CD.get(t);return i||(i=new t,CD.set(t,i)),n&&n(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{c.scene&&Object.assign(c,qK(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function CE(n,e,t,r){const i=Array.isArray(e)?e:[e],s=UK(BB(t,r),[n,...i],{equal:ls.equ});return Array.isArray(e)?s:s[0]}CE.preload=function(n,e,t){const r=Array.isArray(e)?e:[e];return FK(BB(t),[n,...r])};CE.clear=function(n,e){const t=Array.isArray(e)?e:[e];return BK([n,...t])};const ly=new Map,{invalidate:RD,advance:AD}=iY(ly),{reconciler:Cx,applyProps:pv}=HK(ly,JK),mv={objects:"shallow",strict:!1},oY=(n,e)=>{const t=typeof n=="function"?n(e):n;return NB(t)?t:new bK({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function aY(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:s,left:o,updateStyle:a=t}=e;return{width:r,height:i,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:r,height:i,top:s,left:o}=n.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function cY(n){const e=ly.get(n),t=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||eY(RD,AD),o=t||Cx.createContainer(s,Nv.ConcurrentRoot,null,!1,null,"",i,null);e||ly.set(n,{fiber:o,store:s});let a,c=!1,l;return{configure(u={}){let{gl:h,size:d,scene:p,events:_,onCreated:y,shadows:S=!1,linear:T=!1,flat:A=!1,legacy:R=!1,orthographic:I=!1,frameloop:U="always",dpr:D=[1,2],performance:L,raycaster:z,camera:F,onPointerMissed:V}=u,W=s.getState(),X=W.gl;W.gl||W.set({gl:X=oY(h,n)});let $=W.raycaster;$||W.set({raycaster:$=new kK});const{params:K,...te}=z||{};if(ls.equ(te,$,mv)||pv($,{...te}),ls.equ(K,$.params,mv)||pv($,{params:{...$.params,...K}}),!W.camera||W.camera===l&&!ls.equ(l,F,mv)){l=F;const re=F instanceof Uw,ue=re?F:I?new Fw(0,0,0,0,.1,1e3):new fu(75,0,.1,1e3);re||(ue.position.z=5,F&&(pv(ue,F),("aspect"in F||"left"in F||"right"in F||"bottom"in F||"top"in F)&&(ue.manual=!0,ue.updateProjectionMatrix())),!W.camera&&!(F!=null&&F.rotation)&&ue.lookAt(0,0,0)),W.set({camera:ue}),$.camera=ue}if(!W.scene){let re;p instanceof wx?re=p:(re=new wx,p&&pv(re,p)),W.set({scene:Tv(re)})}if(!W.xr){var Q;const re=(Ne,_e)=>{const Ae=s.getState();Ae.frameloop!=="never"&&AD(Ne,!0,Ae,_e)},ue=()=>{const Ne=s.getState();Ne.gl.xr.enabled=Ne.gl.xr.isPresenting,Ne.gl.xr.setAnimationLoop(Ne.gl.xr.isPresenting?re:null),Ne.gl.xr.isPresenting||RD(Ne)},ye={connect(){const Ne=s.getState().gl;Ne.xr.addEventListener("sessionstart",ue),Ne.xr.addEventListener("sessionend",ue)},disconnect(){const Ne=s.getState().gl;Ne.xr.removeEventListener("sessionstart",ue),Ne.xr.removeEventListener("sessionend",ue)}};typeof((Q=X.xr)==null?void 0:Q.addEventListener)=="function"&&ye.connect(),W.set({xr:ye})}if(X.shadowMap){const re=X.shadowMap.enabled,ue=X.shadowMap.type;if(X.shadowMap.enabled=!!S,ls.boo(S))X.shadowMap.type=OT;else if(ls.str(S)){var ne;const ye={basic:uW,percentage:$I,soft:OT,variance:Zd};X.shadowMap.type=(ne=ye[S])!=null?ne:OT}else ls.obj(S)&&Object.assign(X.shadowMap,S);(re!==X.shadowMap.enabled||ue!==X.shadowMap.type)&&(X.shadowMap.needsUpdate=!0)}const G=RB();G&&("enabled"in G?G.enabled=!R:"legacyMode"in G&&(G.legacyMode=R)),c||pv(X,{outputEncoding:T?3e3:3001,toneMapping:A?mf:$F}),W.legacy!==R&&W.set(()=>({legacy:R})),W.linear!==T&&W.set(()=>({linear:T})),W.flat!==A&&W.set(()=>({flat:A})),h&&!ls.fun(h)&&!NB(h)&&!ls.equ(h,X,mv)&&pv(X,h),_&&!W.events.handlers&&W.set({events:_(s)});const J=aY(n,d);return ls.equ(J,W.size,mv)||W.setSize(J.width,J.height,J.updateStyle,J.top,J.left),D&&W.viewport.dpr!==IB(D)&&W.setDpr(D),W.frameloop!==U&&W.setFrameloop(U),W.onPointerMissed||W.set({onPointerMissed:V}),L&&!ls.equ(L,W.performance,mv)&&W.set(re=>({performance:{...re.performance,...L}})),a=y,c=!0,this},render(u){return c||this.configure(),Cx.updateContainer(Fe.jsx(lY,{store:s,children:u,onCreated:a,rootElement:n}),o,null,()=>{}),s},unmount(){uY(n)}}}function lY({store:n,children:e,onCreated:t,rootElement:r}){return zw(()=>{const i=n.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),Fe.jsx(PB.Provider,{value:n,children:e})}function uY(n,e){const t=ly.get(n),r=t==null?void 0:t.fiber;if(r){const i=t==null?void 0:t.store.getState();i&&(i.internal.active=!1),Cx.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),XK(i),ly.delete(n)}catch{}},500)})}}Cx.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:at.version});const Q1={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function hY(n){const{handlePointer:e}=ZK(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Q1).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var r;const{set:i,events:s}=n.getState();s.disconnect==null||s.disconnect(),i(o=>({events:{...o.events,connected:t}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([o,a])=>{const[c,l]=Q1[o];t.addEventListener(c,a,{passive:l})})},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,o])=>{if(r&&r.connected instanceof HTMLElement){const[a]=Q1[s];r.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}var ak={exports:{}};function zB(n,e=100,t={}){if(typeof n!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof n}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:r}=typeof t=="boolean"?{immediate:t}:t;let i,s,o,a,c;function l(){const d=i,p=s;return i=void 0,s=void 0,c=n.apply(d,p),c}function u(){const d=Date.now()-a;d<e&&d>=0?o=setTimeout(u,e-d):(o=void 0,r||(c=l()))}const h=function(...d){if(i&&this!==i&&Object.getPrototypeOf(this)===Object.getPrototypeOf(i))throw new Error("Debounced method called with different contexts of the same prototype.");i=this,s=d,a=Date.now();const p=r&&!o;return o||(o=setTimeout(u,e)),p&&(c=l()),c};return Object.defineProperty(h,"isPending",{get(){return o!==void 0}}),h.clear=()=>{o&&(clearTimeout(o),o=void 0)},h.flush=()=>{o&&h.trigger()},h.trigger=()=>{c=l(),h.clear()},h}ak.exports.debounce=zB;ak.exports=zB;var dY=ak.exports;const fY=Wl(dY);/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var pY=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),mY=Object.prototype.hasOwnProperty;function jA(n,e){return mY.call(n,e)}function HA(n){if(Array.isArray(n)){for(var e=new Array(n.length),t=0;t<e.length;t++)e[t]=""+t;return e}if(Object.keys)return Object.keys(n);var r=[];for(var i in n)jA(n,i)&&r.push(i);return r}function Zc(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function GA(n){for(var e=0,t=n.length,r;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function z0(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function VB(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function WA(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(var e=0,t=n.length;e<t;e++)if(WA(n[e]))return!0}else if(typeof n=="object"){for(var r=HA(n),i=r.length,s=0;s<i;s++)if(WA(n[r[s]]))return!0}}return!1}function MD(n,e){var t=[n];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(r+": "+i)}return t.join(`
`)}var ck=function(n){pY(e,n);function e(t,r,i,s,o){var a=this.constructor,c=n.call(this,MD(t,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=MD(t,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),eo=ck,gY=Zc,Pv={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){var r=Rx(t,this.path);r&&(r=Zc(r));var i=e_(t,{op:"remove",path:this.from}).removed;return e_(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){var r=Rx(t,this.from);return e_(t,{op:"add",path:this.path,value:Zc(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:uy(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},_Y={add:function(n,e,t){return GA(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Pv.move,copy:Pv.copy,test:Pv.test,_get:Pv._get};function Rx(n,e){if(e=="")return n;var t={op:"_get",path:e};return e_(n,t),t.value}function e_(n,e,t,r,i,s){if(t===void 0&&(t=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),t&&(typeof t=="function"?t(e,0,n,e.path):Ax(e,0)),e.path===""){var o={newDocument:n};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=n,o;if(e.op==="move"||e.op==="copy")return o.newDocument=Rx(n,e.from),e.op==="move"&&(o.removed=n),o;if(e.op==="test"){if(o.test=uy(n,e.value),o.test===!1)throw new eo("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o.newDocument=n,o}else{if(e.op==="remove")return o.removed=n,o.newDocument=null,o;if(e.op==="_get")return e.value=n,o;if(t)throw new eo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return o}}else{r||(n=Zc(n));var a=e.path||"",c=a.split("/"),l=n,u=1,h=c.length,d=void 0,p=void 0,_=void 0;for(typeof t=="function"?_=t:_=Ax;;){if(p=c[u],p&&p.indexOf("~")!=-1&&(p=VB(p)),i&&(p=="__proto__"||p=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[p]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&_(e,0,n,d)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(t&&!GA(p))throw new eo("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);GA(p)&&(p=~~p)}if(u>=h){if(t&&e.op==="add"&&p>l.length)throw new eo("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);var o=_Y[e.op].call(e,l,p,n);if(o.test===!1)throw new eo("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}}else if(u>=h){var o=Pv[e.op].call(e,l,p,n);if(o.test===!1)throw new eo("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}if(l=l[p],t&&u<h&&(!l||typeof l!="object"))throw new eo("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function jw(n,e,t,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),t&&!Array.isArray(e))throw new eo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Zc(n));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=e_(n,e[o],t,!0,i,o),n=s[o].newDocument;return s.newDocument=n,s}function vY(n,e,t){var r=e_(n,e);if(r.test===!1)throw new eo("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function Ax(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new eo("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Pv[n.op]){if(typeof n.path!="string")throw new eo("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new eo('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new eo("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new eo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&WA(n.value))throw new eo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new eo("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new eo("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var o={op:"_get",path:n.from,value:void 0},a=jB([o],t);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new eo("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new eo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function jB(n,e,t){try{if(!Array.isArray(n))throw new eo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)jw(Zc(e),Zc(n),t||!0);else{t=t||Ax;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof eo)return i;throw i}}function uy(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,o;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!uy(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var a=Object.keys(n);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!uy(n[o],e[o]))return!1;return!0}return n!==n&&e!==e}const yY=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:eo,_areEquals:uy,applyOperation:e_,applyPatch:jw,applyReducer:vY,deepClone:gY,getValueByPointer:Rx,validate:jB,validator:Ax},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var lk=new WeakMap,SY=function(){function n(e){this.observers=new Map,this.obj=e}return n}(),EY=function(){function n(e,t){this.callback=e,this.observer=t}return n}();function bY(n){return lk.get(n)}function TY(n,e){return n.observers.get(e)}function xY(n,e){n.observers.delete(e.callback)}function wY(n,e){e.unobserve()}function CY(n,e){var t=[],r,i=bY(n);if(!i)i=new SY(n),lk.set(n,i);else{var s=TY(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Zc(n),e){r.callback=e,r.next=null;var o=function(){$A(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=t,r.object=n,r.unobserve=function(){$A(r),clearTimeout(r.next),xY(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new EY(e,r)),r}function $A(n,e){e===void 0&&(e=!1);var t=lk.get(n.object);uk(t.value,n.object,n.patches,"",e),n.patches.length&&jw(t.value,n.patches);var r=n.patches;return r.length>0&&(n.patches=[],n.callback&&n.callback(r)),r}function uk(n,e,t,r,i){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=HA(e),o=HA(n),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=n[l];if(jA(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?uk(u,h,t,r+"/"+z0(l),i):u!==h&&(i&&t.push({op:"test",path:r+"/"+z0(l),value:Zc(u)}),t.push({op:"replace",path:r+"/"+z0(l),value:Zc(h)}))}else Array.isArray(n)===Array.isArray(e)?(i&&t.push({op:"test",path:r+"/"+z0(l),value:Zc(u)}),t.push({op:"remove",path:r+"/"+z0(l)}),a=!0):(i&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!jA(n,l)&&e[l]!==void 0&&t.push({op:"add",path:r+"/"+z0(l),value:Zc(e[l])})}}}function RY(n,e,t){t===void 0&&(t=!1);var r=[];return uk(n,e,r,"",t),r}const AY=Object.freeze(Object.defineProperty({__proto__:null,compare:RY,generate:$A,observe:CY,unobserve:wY},Symbol.toStringTag,{value:"Module"}));Object.assign({},yY,AY,{JsonPatchError:ck,deepClone:Zc,escapePathComponent:z0,unescapePathComponent:VB});var MY=typeof Element<"u",IY=typeof Map=="function",kY=typeof Set=="function",OY=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function zT(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){if(n.constructor!==e.constructor)return!1;var t,r,i;if(Array.isArray(n)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!zT(n[r],e[r]))return!1;return!0}var s;if(IY&&n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(s=n.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=n.entries();!(r=s.next()).done;)if(!zT(r.value[1],e.get(r.value[0])))return!1;return!0}if(kY&&n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(s=n.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(OY&&ArrayBuffer.isView(n)&&ArrayBuffer.isView(e)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(n[r]!==e[r])return!1;return!0}if(n.constructor===RegExp)return n.source===e.source&&n.flags===e.flags;if(n.valueOf!==Object.prototype.valueOf&&typeof n.valueOf=="function"&&typeof e.valueOf=="function")return n.valueOf()===e.valueOf();if(n.toString!==Object.prototype.toString&&typeof n.toString=="function"&&typeof e.toString=="function")return n.toString()===e.toString();if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(MY&&n instanceof Element)return!1;for(r=t;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&n.$$typeof)&&!zT(n[i[r]],e[i[r]]))return!1;return!0}return n!==n&&e!==e}var NY=function(e,t){try{return zT(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const HB=Wl(NY);function fe(n){return n!=null}const GB=Object.keys;function Uy(n){return Zc(n)}function PY(n){return typeof n=="boolean"}function En(n){return typeof n=="number"&&isNaN(n)===!1}function vr(n){return typeof n=="string"}function ni(n){return Array.isArray(n)}function DY(n){return n}var WB={};(function(n){var e=Ng&&Ng.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,p=u.length,_;d<p;d++)(_||!(d in u))&&(_||(_=Array.prototype.slice.call(u,0,d)),_[d]=u[d]);return l.concat(_||Array.prototype.slice.call(u))};Object.defineProperty(n,"__esModule",{value:!0}),n.minLength=n.maxLength=n.poolSize=n.humanId=n.adverbs=n.verbs=n.nouns=n.adjectives=void 0,n.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],n.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],n.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],n.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function t(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,p=d===void 0?!0:d,_=l.adjectiveCount,y=_===void 0?1:_,S=l.addAdverb,T=S===void 0?!1:S,A=e(e(e([],e([],Array(y),!0).map(function(R){return t(n.adjectives)}),!0),[t(n.nouns),t(n.verbs)],!1),T?[t(n.adverbs)]:[],!0);return p&&(A=A.map(function(R){return R.charAt(0).toUpperCase()+R.substr(1)})),A.join(h)}n.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,p=d===void 0?!1:d;return n.adjectives.length*h*n.nouns.length*n.verbs.length*(p?n.adverbs.length:1)}n.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,p=d===void 0?!1:d,_=l.separator,y=_===void 0?"":_;return r(n.adjectives).length*h+h*y.length+r(n.nouns).length+y.length+r(n.verbs).length+(p?r(n.adverbs).length+y.length:0)}n.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,p=d===void 0?!1:d,_=l.separator,y=_===void 0?"":_;return i(n.adjectives).length*h+h*y.length+i(n.nouns).length+y.length+i(n.verbs).length+(p?i(n.adverbs).length+y.length:0)}n.minLength=c,n.default=s})(WB);const LY=Wl(WB),UY="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let FY=n=>crypto.getRandomValues(new Uint8Array(n)),BY=(n,e,t)=>{let r=(2<<Math.log2(n.length-1))-1,i=-~(1.6*r*e/n.length);return(s=e)=>{let o="";for(;;){let a=t(i),c=i;for(;c--;)if(o+=n[a[c]&r]||"",o.length===s)return o}}},$B=(n,e=21)=>BY(n,e,FY),zY=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=UY[t[n]&63];return e};var qB="abcdefghijklmnopqrstuvwxyz",XB="ABCDEFGHIJKLMNOPQRSTUVWXYZ",KB="0123456789",VY="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",jY="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const HY=KB,GY=qB,WY=XB;var $Y=HY+GY+WY,qA={lowercase:qB,uppercase:XB,numbers:KB,nolookalikes:VY,nolookalikesSafe:jY,alphanumeric:$Y};function _o(){return`sid_${zY(12).replaceAll("-",".")}`}const qY=$B(qA.numbers,4),XY=$B(`${qA.numbers}${qA.lowercase}`,16);function YB(){return`pid_${qY()}_${XY()}`}function JB(n){return(n==null?void 0:n.startsWith("pid_"))??!1}function KY(){return LY({capitalize:!1,adjectiveCount:1})}var Kr=(n=>(n[n.BLACK=0]="BLACK",n[n.DKBLUE=1]="DKBLUE",n[n.DKGREEN=2]="DKGREEN",n[n.DKCYAN=3]="DKCYAN",n[n.DKRED=4]="DKRED",n[n.DKPURPLE=5]="DKPURPLE",n[n.DKYELLOW=6]="DKYELLOW",n[n.LTGRAY=7]="LTGRAY",n[n.DKGRAY=8]="DKGRAY",n[n.BLUE=9]="BLUE",n[n.GREEN=10]="GREEN",n[n.CYAN=11]="CYAN",n[n.RED=12]="RED",n[n.PURPLE=13]="PURPLE",n[n.YELLOW=14]="YELLOW",n[n.WHITE=15]="WHITE",n[n.ONBLACK=16]="ONBLACK",n[n.ONDKBLUE=17]="ONDKBLUE",n[n.ONDKGREEN=18]="ONDKGREEN",n[n.ONDKCYAN=19]="ONDKCYAN",n[n.ONDKRED=20]="ONDKRED",n[n.ONDKPURPLE=21]="ONDKPURPLE",n[n.ONDKYELLOW=22]="ONDKYELLOW",n[n.ONLTGRAY=23]="ONLTGRAY",n[n.ONDKGRAY=24]="ONDKGRAY",n[n.ONBLUE=25]="ONBLUE",n[n.ONGREEN=26]="ONGREEN",n[n.ONCYAN=27]="ONCYAN",n[n.ONRED=28]="ONRED",n[n.ONPURPLE=29]="ONPURPLE",n[n.ONYELLOW=30]="ONYELLOW",n[n.ONWHITE=31]="ONWHITE",n[n.ONCLEAR=32]="ONCLEAR",n))(Kr||{}),Ts=(n=>(n[n.ISWALK=0]="ISWALK",n[n.ISSOLID=1]="ISSOLID",n[n.ISSWIM=2]="ISSWIM",n[n.ISBULLET=3]="ISBULLET",n))(Ts||{}),Mx=(n=>(n[n.ISTERRAIN=0]="ISTERRAIN",n[n.ISOBJECT=1]="ISOBJECT",n))(Mx||{}),dn=(n=>(n[n.IDLE=0]="IDLE",n[n.NORTH=1]="NORTH",n[n.SOUTH=2]="SOUTH",n[n.WEST=3]="WEST",n[n.EAST=4]="EAST",n[n.BY=5]="BY",n[n.AT=6]="AT",n[n.FLOW=7]="FLOW",n[n.SEEK=8]="SEEK",n[n.RNDNS=9]="RNDNS",n[n.RNDNE=10]="RNDNE",n[n.RND=11]="RND",n[n.CW=12]="CW",n[n.CCW=13]="CCW",n[n.OPP=14]="OPP",n[n.RNDP=15]="RNDP",n))(dn||{}),An=(n=>(n[n.LOADER=0]="LOADER",n[n.BOARD=1]="BOARD",n[n.OBJECT=2]="OBJECT",n[n.TERRAIN=3]="TERRAIN",n[n.CHARSET=4]="CHARSET",n[n.PALETTE=5]="PALETTE",n[n.CONST=6]="CONST",n[n.RANGE=7]="RANGE",n[n.SELECT=8]="SELECT",n[n.NUMBER=9]="NUMBER",n[n.TEXT=10]="TEXT",n[n.LINK=11]="LINK",n[n.HOTKEY=12]="HOTKEY",n[n.SCROLL=13]="SCROLL",n[n.COPYIT=14]="COPYIT",n))(An||{});function Ur(n){return n.toLowerCase().trim()}function YY(n,e,t,r){return{id:_o(),target:n,sender:e,data:t,player:r}}function QB(n){const[e,...t]=n.split(":");return{target:e,path:t.join(":")}}function Nf(n,e,t){const r=_o(),i=Ur(n),s=e.map(Ur),o={id(){return r},name(){return n},topics(){return e},emit(a,c,l){Vn.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=QB(a.target),u=Ur(c);s.findIndex(h=>h==="all"||h===u)!==-1&&t(a),(r===c||u==="all"||i===u)&&t({...a,target:l})}};return Vn.connect(o),o}const Z1=new Set,Vn={emit(n,e,t,r){Vn.invoke(YY(n,e,t,r))},invoke(n){Z1.forEach(e=>e.handle(n))},connect(n){Z1.add(n)},disconnect(n){Z1.delete(n)}};function ti(n,e,t,r){const i=r??"";return Vn.emit(`error:${e}`,n,t,i),mJ(n,t,i)}function JY(n,e,t){Vn.emit("broadcast:startstream",n,e,t)}function QY(n,e){Vn.emit("broadcast:stopstream",n,void 0,e)}function ZY(n,e,t){Vn.emit("chat:connect",n,e,t)}function eJ(n,e){Vn.emit("chat:disconnect",n,void 0,e)}function tJ(n,e){Vn.emit("gadgetserver:desync",n,void 0,e)}function nJ(n,e){Vn.emit("gadgetserver:clearscroll",n,void 0,e)}function ZB(n,e,t){Vn.emit("peer:create",n,e,t)}function e3(n,e){Vn.emit("peer:joincode",n,void 0,e)}function rJ(n,e){Vn.emit("init",n,void 0,e)}function iJ(n,e){Vn.emit("register:ready",n,void 0,e)}function sJ(n,e){Vn.emit("register:ackbooks",n,!0,e)}function oJ(n,e){Vn.emit("register:dev",n,void 0,e)}function aJ(n,e){Vn.emit("register:share",n,void 0,e)}function cJ(n,e){Vn.emit("register:nuke",n,void 0,e)}function lJ(n,e,t){Vn.emit("synth:tts",n,[e,t])}function uJ(n,e,t){Vn.emit("synth:play",n,[e,t])}function hJ(n,e,t){Vn.emit("synth:mainvolume",n,e,t)}function dJ(n,e,t){Vn.emit("synth:drumvolume",n,e,t)}function fJ(n,e,t){Vn.emit("synth:ttsvolume",n,e,t)}function eR(n,e,t,r){Vn.emit("synth:voice",n,[e,t,r])}function pJ(n,e,t,r,i){Vn.emit("synth:voicefx",n,[e,t,r,i])}function th(n,...e){return Vn.emit("tape:info",n,e),!0}function mJ(n,...e){return Vn.emit("tape:error",n,e),!1}function t3(n,e){Vn.emit("tape:terminal:open",n,void 0,e)}function hk(n,e){Vn.emit("tape:terminal:close",n,void 0,e)}function gJ(n,e){Vn.emit("tape:terminal:toggle",n,void 0,e)}function n3(n,e,t){Vn.emit("tape:terminal:inclayout",n,e,t)}function r3(n,e){Vn.emit("tape:crash",n,void 0,e)}function _J(n,e,t,r,i,s){Vn.emit("tape:editor:open",n,[e,t,r,i],s)}function vJ(n,e){Vn.emit("tape:editor:close",n,void 0,e)}function Vi(n,e,t){Vn.emit("userinput:up",n,e,t)}function Cl(n,e,t){Vn.emit("userinput:down",n,e,t)}function yJ(n,e){Vn.emit("userinput:update",n,void 0,e)}function SJ(n,e,t,r){Vn.emit("vm:books",n,[e,t],r)}function EJ(n,e){Vn.emit("vm:login",n,void 0,e)}function bJ(n,e){Vn.emit("vm:endgame",n,void 0,e)}function TJ(n,e){Vn.emit("vm:doot",n,void 0,e)}function VT(n,e,t,r){Vn.emit("vm:input",n,[e,t],r)}function i3(n,e){return`${n}${e}`}function xJ(n,e,t,r){Vn.emit("vm:codewatch",n,[e,t],r)}function wJ(n,e,t,r){Vn.emit("vm:coderelease",n,[e,t],r)}function Hw(n,e,t){Vn.emit("vm:cli",n,e,t)}function s3(n,e,t){Vn.emit("vm:flush",n,e,t)}function Ix(n,e,t,r,i){function s(){return{filename:t,cursor:0,lines:r.split(`
`)}}function o(){return{filename:t,cursor:0,bytes:r,dataview:new DataView(r.buffer)}}let a;switch(e){case"file":a=r;break;case"chat":a=s();break;case"text":a=s();break;case"binary":a=o();break}Vn.emit("vm:loader",n,[e,a],i)}function dk(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function CJ(n,e){const t=indexedDB.open(n);t.onupgradeneeded=()=>t.result.createObjectStore(e);const r=dk(t);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let tR;function o3(){return tR||(tR=CJ("keyval-store","keyval")),tR}function RJ(n,e=o3()){return e("readonly",t=>dk(t.get(n)))}function AJ(n,e,t=o3()){return t("readwrite",r=>new Promise((i,s)=>{r.get(n).onsuccess=function(){try{r.put(e(this.result),n),i(dk(r.transaction))}catch(o){s(o)}}}))}function du(n,e){function t(r){console.error(r),ti(n,"crash",r.message)}e().catch(t)}const MJ=66.666,a3=Math.round(1e3/MJ),IJ=3;function Vh(n){return new Promise(e=>setTimeout(e,n))}async function XA(n){const e=new FormData;e.append("url",n);const t=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(t)).text()}function ID(){return location.href.includes("/join/")}function kJ(){return location.href.includes("/locked/")}function OJ(n){return fe(n)&&typeof n=="object"&&vr(n.id)&&vr(n.target)&&vr(n.sender)}function c3(n){const e=new Set;function t(s){OJ(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Vn.invoke(s))}const r=Nf("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),n(s))});function i(){Vn.disconnect(r)}return{forward:t,disconnect:i}}function NJ(n){return new Worker("/assets/simspace-CINpQqez.js",{name:n==null?void 0:n.name})}function PJ(n){return new Worker("/assets/stubspace-Mt81ZBb1.js",{name:n==null?void 0:n.name})}let Qb;function DJ(n=!1){if(!fe(Qb)){Qb=n?new PJ:new NJ;const{forward:e}=c3(t=>Qb.postMessage(t));Qb.addEventListener("message",t=>e(t.data))}}var G0=(n=>(n[n.Border=-1]="Border",n[n.Data=0]="Data",n[n.Function=1]="Function",n[n.Position=2]="Position",n[n.Timing=3]="Timing",n[n.Alignment=4]="Alignment",n))(G0||{}),LJ=Object.defineProperty,UJ=(n,e,t)=>e in n?LJ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Zb=(n,e,t)=>(UJ(n,typeof e!="symbol"?e+"":e,t),t);const FJ=[0,1],l3=[1,0],u3=[2,3],h3=[3,2],BJ={L:FJ,M:l3,Q:u3,H:h3},zJ=/^[0-9]*$/,VJ=/^[A-Z0-9 $%*+.\/:-]*$/,nR="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",fk=1,pk=40,kD=3,jJ=3,eT=40,HJ=10,d3=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],f3=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class GJ{constructor(e,t,r,i){if(this.version=e,this.ecc=t,Zb(this,"size"),Zb(this,"mask"),Zb(this,"modules",[]),Zb(this,"types",[]),e<fk||e>pk)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,t){return e>=0&&e<this.size&&t>=0&&t<this.size&&this.modules[t][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,G0.Timing),this.setFunctionModule(r,6,r%2===0,G0.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let r=0;r<t;r++)for(let i=0;i<t;i++)r===0&&i===0||r===0&&i===t-1||r===t-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.ecc[1]<<3|e;let r=t;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(t<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Up(i,s));this.setFunctionModule(8,7,Up(i,6)),this.setFunctionModule(8,8,Up(i,7)),this.setFunctionModule(7,8,Up(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Up(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Up(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Up(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const t=this.version<<12|e;for(let r=0;r<18;r++){const i=Up(t,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,t){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=t+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,G0.Position)}}drawAlignmentPattern(e,t){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,t+r,Math.max(Math.abs(i),Math.abs(r))!==1,G0.Alignment)}setFunctionModule(e,t,r,i=G0.Function){this.modules[t][e]=r,this.types[t][e]=i}addEccAndInterleave(e){const t=this.version,r=this.ecc;if(e.length!==jT(t,r))throw new RangeError("Invalid argument");const i=f3[r[0]][t],s=d3[r[0]][t],o=Math.floor(KA(t)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=ZJ(s);for(let d=0,p=0;d<i;d++){const _=e.slice(p,p+c-s+(d<a?0:1));p+=_.length;const y=eQ(_,u);d<a&&_.push(0),l.push(_.concat(y))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((p,_)=>{(d!==c-s||_>=a)&&h.push(p[d])});return h}drawCodewords(e){if(e.length!==Math.floor(KA(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&t<e.length*8&&(this.modules[c][o]=Up(e[t>>>3],7-(t&7)),t++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+t)%2===0;break;case 1:i=t%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+t)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(t/2))%2===0;break;case 5:i=r*t%2+r*t%3===0;break;case 6:i=(r*t%2+r*t%3)%2===0;break;case 7:i=((r+t)%2+r*t%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[t][r]&&i&&(this.modules[t][r]=!this.modules[t][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=kD:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*eT),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*eT}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=kD:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*eT),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*eT}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=jJ)}let t=0;for(const s of this.modules)t=s.reduce((o,a)=>o+(a?1:0),t);const r=this.size*this.size,i=Math.ceil(Math.abs(t*20-r*10)/r)-1;return e+=i*HJ,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,t=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=t)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const t=e[1],r=t>0&&e[2]===t&&e[3]===t*3&&e[4]===t&&e[5]===t;return(r&&e[0]>=t*4&&e[6]>=t?1:0)+(r&&e[6]>=t*4&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,r){return e&&(this.finderPenaltyAddHistory(t,r),t=0),t+=this.size,this.finderPenaltyAddHistory(t,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,t){t[0]===0&&(e+=this.size),t.pop(),t.unshift(e)}}function Yp(n,e,t){if(e<0||e>31||n>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)t.push(n>>>r&1)}function Up(n,e){return(n>>>e&1)!==0}class mk{constructor(e,t,r){if(this.mode=e,this.numChars=t,this.bitData=r,t<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const WJ=[1,10,12,14],$J=[2,9,11,13],qJ=[4,8,16,16];function p3(n,e){return n[Math.floor((e+7)/17)+1]}function m3(n){const e=[];for(const t of n)Yp(t,8,e);return new mk(qJ,n.length,e)}function XJ(n){if(!g3(n))throw new RangeError("String contains non-numeric characters");const e=[];for(let t=0;t<n.length;){const r=Math.min(n.length-t,3);Yp(Number.parseInt(n.substring(t,t+r),10),r*3+1,e),t+=r}return new mk(WJ,n.length,e)}function KJ(n){if(!_3(n))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let t;for(t=0;t+2<=n.length;t+=2){let r=nR.indexOf(n.charAt(t))*45;r+=nR.indexOf(n.charAt(t+1)),Yp(r,11,e)}return t<n.length&&Yp(nR.indexOf(n.charAt(t)),6,e),new mk($J,n.length,e)}function YJ(n){return n===""?[]:g3(n)?[XJ(n)]:_3(n)?[KJ(n)]:[m3(QJ(n))]}function g3(n){return zJ.test(n)}function _3(n){return VJ.test(n)}function JJ(n,e){let t=0;for(const r of n){const i=p3(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;t+=4+i+r.bitData.length}return t}function QJ(n){n=encodeURI(n);const e=[];for(let t=0;t<n.length;t++)n.charAt(t)!=="%"?e.push(n.charCodeAt(t)):(e.push(Number.parseInt(n.substring(t+1,t+3),16)),t+=2);return e}function KA(n){if(n<fk||n>pk)throw new RangeError("Version number out of range");let e=(16*n+128)*n+64;if(n>=2){const t=Math.floor(n/7)+2;e-=(25*t-10)*t-55,n>=7&&(e-=36)}return e}function jT(n,e){return Math.floor(KA(n)/8)-d3[e[0]][n]*f3[e[0]][n]}function ZJ(n){if(n<1||n>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<n-1;r++)e.push(0);e.push(1);let t=1;for(let r=0;r<n;r++){for(let i=0;i<e.length;i++)e[i]=YA(e[i],t),i+1<e.length&&(e[i]^=e[i+1]);t=YA(t,2)}return e}function eQ(n,e){const t=e.map(r=>0);for(const r of n){const i=r^t.shift();t.push(0),e.forEach((s,o)=>t[o]^=YA(s,i))}return t}function YA(n,e){if(n>>>8||e>>>8)throw new RangeError("Byte out of range");let t=0;for(let r=7;r>=0;r--)t=t<<1^(t>>>7)*285,t^=(e>>>r&1)*n;return t}function tQ(n,e,t=1,r=40,i=-1,s=!0){if(!(fk<=t&&t<=r&&r<=pk)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=t;;o++){const h=jT(o,e)*8,d=JJ(n,o);if(d<=h){a=d;break}if(o>=r)throw new RangeError("Data too long")}for(const h of[l3,u3,h3])s&&a<=jT(o,h)*8&&(e=h);const c=[];for(const h of n){Yp(h.mode[0],4,c),Yp(h.numChars,p3(h.mode,o),c);for(const d of h.getData())c.push(d)}const l=jT(o,e)*8;Yp(0,Math.min(4,l-c.length),c),Yp(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)Yp(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new GJ(o,e,u,i)}function nQ(n,e){var h;const{ecc:t="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof n=="string"?YJ(n):Array.isArray(n)?[m3(n)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof n}`);const l=tQ(c,BJ[t],i,s,o,r),u=rQ({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e!=null&&e.invert&&(u.data=u.data.map(d=>d.map(p=>!p))),(h=e==null?void 0:e.onEncoded)==null||h.call(e,u),u}function rQ(n,e=1){if(!e)return n;const{size:t}=n,r=t+e*2;n.size=r,n.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)n.data.unshift(Array.from({length:r},o=>!1)),n.data.push(Array.from({length:r},o=>!1));const i=G0.Border;n.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)n.types.unshift(Array.from({length:r},o=>i)),n.types.push(Array.from({length:r},o=>i));return n}function iQ(n,e,t,r=!1){return e<0||t<0||e>=n.length||t>=n.length?r:n[t][e]}function sQ(n,e={}){const t={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},r=nQ(n,e),i=!1,s=!0,o=(l,u)=>iQ(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=t.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=t.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=t.BLACK_WHITE:c+=t.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const Dg="$dkpurple",oQ="$196",aQ="$205";function hu(n,e){return`$${n}${e}$blue`}function OD(n,e){return`$${n}${e}$ondkblue`}function Lr(n,e){th(n,e)}function cQ(n,e){const t=oQ.repeat(e);Lr(n,`${Dg}${t}`)}function gk(n,e){const t=aQ.repeat(e);Lr(n,`${Dg}${t}`)}function af(n,e){Lr(n,`${Dg} ${" ".repeat(e.length)} `),cQ(n,e.length+2),Lr(n,`${Dg} $white${e} `),gk(n,e.length+2)}function Fp(n,e){Lr(n,`${Dg} ${" ".repeat(e.length)} `),Lr(n,`${Dg} $gray${e} `),gk(n,e.length+2)}function Hr(n,e,t){Lr(n,`${Dg} $white${e} $blue${t}`)}function wi(n,e){Lr(n,`${Dg}$blue${e}`)}function JA(n,e,t){const r=sQ(e).split(`
`),i={32:32,9600:223,9604:220,9608:219};for(let s=0;s<r.length;s++){const o=[...r[s]].map(a=>`$${i[a.charCodeAt(0)]}`).join("");Lr(n,o)}Lr(n,`!copyit ${e};${t}`)}function GS(){return GS=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},GS.apply(this,arguments)}function lQ(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,QA(n,e)}function QA(n,e){return QA=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},QA(n,e)}function uQ(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var _k=function(){function n(t){this.trigger=t,this.observing=new Map}var e=n.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[fa].connections.iterate.delete(r),i.byKey.forEach(function(o){s[fa].connections.byKey.get(o).delete(r)})}),this.observing.clear()},n}(),t_=[],Gw=function(n){lQ(e,n);function e(r,i,s){var o;if(o=n.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){t_.push(uQ(o));try{o.func()}finally{t_.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var t=e.prototype;return t._trigger=function(){if(t_.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(_k);function v3(){return!!t_.length}function y3(){return t_.length?t_[t_.length-1]:void 0}function hQ(n,e,t){var r=GS({name:"unnamed",fireImmediately:!0},t),i=new Gw(n,r,e);return i}var HT=0;function S3(){return HT>0}function ZA(n){HT++;try{return n()}finally{HT--,HT===0&&fQ()}}var eM=!1;function E3(){return eM}function b3(n){eM=!0;try{n()}finally{eM=!1}}function dQ(n){return function(){return b3(n)}}var tM=[];function fQ(){var n=[].concat(tM);tM=[],T3(n)}function T3(n){var e=new Set;n.forEach(function(t){var r;(t.type==="add"||t.type==="delete")&&t.observable[fa].connections.iterate.forEach(function(i){e.add(i)}),(r=t.observable[fa].connections.byKey.get(t.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(t){t.trigger()})}function tT(n){if(S3()){tM.push(n);return}T3([n])}function ND(n,e){if(n.type==="iterate")n.observable[fa].connections.iterate.add(e);else{var t=n.observable[fa].connections.byKey.get(n.key);t||(t=new Set,n.observable[fa].connections.byKey.set(n.key,t)),t.add(e)}}function nT(n,e){if(!E3()){var t=y3();t&&(ND(n,t),t.registerConnection(n)),e&&(ND(n,e),e.registerConnection(n))}}var vk=Symbol("$skipreactive"),fa=Symbol("$reactive"),sh=Symbol("$reactiveproxy");function RE(n,e){return!!(n&&n[sh]&&n[sh].implicitObserver===e)}function yk(n){return n[vk]=!0,n}function x3(n){return!!(n&&!RE(n)&&n[fa])}function nM(n,e,t){if(t===void 0&&(t=!1),n[vk]||RE(n,e))return n;var r=pQ(n,t);if(!e)return r;var i=r[fa].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,w3),i=new Proxy(r[fa].raw,s),r[fa].proxiesWithImplicitObserver.set(e,i)}return i}var hy=nM;function pQ(n,e){if(e===void 0&&(e=!1),RE(n))return n;if(x3(n))return n[fa].proxy;if(n[fa]||n[sh])throw new Error("unexpected");var t={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:n,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(n,fa,{enumerable:!1,writable:!0,configurable:!0,value:t});var r=new Proxy(n,w3);return t.proxy=r,r}var w3={has:function(e,t){var r=Reflect.has(e,t);return typeof t=="symbol"||nT({observable:e,key:t,type:"has"},this.implicitObserver),r},get:function(e,t,r){if(t===sh)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,t,r);if(typeof t=="symbol")return t.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(t==="length"&&Array.isArray(e)?nT({observable:e,type:"iterate"},this.implicitObserver):nT({observable:e,key:t,type:"get"},this.implicitObserver),x3(i))return nM(i,this.implicitObserver);if(e[fa].shallow)return i;if(typeof i=="object"&&i!==null&&!RE(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,t);if((!s||!(s.writable===!1&&s.configurable===!1))&&(v3()||this.implicitObserver))return nM(i,this.implicitObserver)}return i},ownKeys:function(e){return nT({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,t,r,i){return ZA(function(){if(typeof t=="symbol")return Reflect.set(e,t,r,i);var s=Object.hasOwnProperty.call(e,t),o=Reflect.get(e,t,i),a=Reflect.set(e,t,r,i);if(!s)tT({observable:e,key:t,value:r,type:"add"});else if(r!==o)if(t==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)tT({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else tT({observable:e,key:t,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,t){return ZA(function(){if(typeof t=="symbol")return Reflect.deleteProperty(e,t);var r=Object.hasOwnProperty.call(e,t),i=Reflect.get(e,t),s=Reflect.deleteProperty(e,t);return r&&tT({observable:e,key:t,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function mQ(n,e){var t=GS({name:"unnamed",fireImmediately:!0},e),r=new Gw(n,t);return r}function gQ(n,e,t){var r=GS({name:"unnamed",fireImmediately:!0},t),i=new Gw(function(){n(e)},r);return e=hy(e,i),r.fireImmediately&&i.trigger(),i}var C3=function(){function n(){this._observable=hy({_key:1})}var e=n.prototype;return e.reportObserved=function(r){return hy(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},n}();function _Q(n,e,t){return new C3}const vQ=Object.freeze(Object.defineProperty({__proto__:null,$reactive:fa,$reactiveproxy:sh,$skipreactive:vk,Atom:C3,Observer:_k,Reaction:Gw,autorun:mQ,autorunAsync:gQ,createAtom:_Q,hasRunningReaction:v3,isActionRunning:S3,isReactive:RE,isTrackingDisabled:E3,markRaw:yk,reaction:hQ,reactive:hy,runInAction:ZA,runningReaction:y3,untracked:b3,untrackedCB:dQ},Symbol.toStringTag,{value:"Module"})),Yh=()=>new Map,rM=n=>{const e=Yh();return n.forEach((t,r)=>{e.set(r,t)}),e},Kg=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},yQ=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},SQ=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},dy=()=>new Set,rR=n=>n[n.length-1],EQ=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},Lg=Array.from,bQ=Array.isArray;class TQ{constructor(){this._observers=Yh()}on(e,t){return Kg(this._observers,e,dy).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Lg((this._observers.get(e)||Yh()).values()).forEach(r=>r(...t))}destroy(){this._observers=Yh()}}const Ug=Math.floor,GT=Math.abs,R3=(n,e)=>n<e?n:e,T_=(n,e)=>n>e?n:e,A3=n=>n!==0?n<0:1/n<0,PD=1,DD=2,iR=4,sR=8,WS=32,rm=64,Eu=128,Ww=31,iM=63,n_=127,xQ=2147483647,M3=Number.MAX_SAFE_INTEGER,wQ=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Ug(n)===n),CQ=n=>n.toLowerCase(),RQ=/^\s*/g,AQ=n=>n.replace(RQ,""),MQ=/([A-Z])/g,LD=(n,e)=>AQ(n.replace(MQ,t=>`${e}${CQ(t)}`)),IQ=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},$S=typeof TextEncoder<"u"?new TextEncoder:null,kQ=n=>$S.encode(n),OQ=$S?kQ:IQ;let IS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});IS&&IS.decode(new Uint8Array).length===1&&(IS=null);class AE{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ag=()=>new AE,NQ=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},qh=n=>{const e=new Uint8Array(NQ(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},PQ=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(T_(t,e)*2),n.cpos=0)},Ia=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},sM=Ia,zr=(n,e)=>{for(;e>n_;)Ia(n,Eu|n_&e),e=Ug(e/128);Ia(n,n_&e)},Sk=(n,e)=>{const t=A3(e);for(t&&(e=-e),Ia(n,(e>iM?Eu:0)|(t?rm:0)|iM&e),e=Ug(e/64);e>0;)Ia(n,(e>n_?Eu:0)|n_&e),e=Ug(e/128)},oM=new Uint8Array(3e4),DQ=oM.length/3,LQ=(n,e)=>{if(e.length<DQ){const t=$S.encodeInto(e,oM).written||0;zr(n,t);for(let r=0;r<t;r++)Ia(n,oM[r])}else _c(n,OQ(e))},UQ=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;zr(n,r);for(let i=0;i<r;i++)Ia(n,t.codePointAt(i))},Wv=$S&&$S.encodeInto?LQ:UQ,$w=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=R3(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(T_(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},_c=(n,e)=>{zr(n,e.byteLength),$w(n,e)},Ek=(n,e)=>{PQ(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},FQ=(n,e)=>Ek(n,4).setFloat32(0,e,!1),BQ=(n,e)=>Ek(n,8).setFloat64(0,e,!1),zQ=(n,e)=>Ek(n,8).setBigInt64(0,e,!1),UD=new DataView(new ArrayBuffer(4)),VQ=n=>(UD.setFloat32(0,n),UD.getFloat32(0)===n),qS=(n,e)=>{switch(typeof e){case"string":Ia(n,119),Wv(n,e);break;case"number":wQ(e)&&GT(e)<=xQ?(Ia(n,125),Sk(n,e)):VQ(e)?(Ia(n,124),FQ(n,e)):(Ia(n,123),BQ(n,e));break;case"bigint":Ia(n,122),zQ(n,e);break;case"object":if(e===null)Ia(n,126);else if(bQ(e)){Ia(n,117),zr(n,e.length);for(let t=0;t<e.length;t++)qS(n,e[t])}else if(e instanceof Uint8Array)Ia(n,116),_c(n,e);else{Ia(n,118);const t=Object.keys(e);zr(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];Wv(n,i),qS(n,e[i])}}break;case"boolean":Ia(n,e?120:121);break;default:Ia(n,127)}};class FD extends AE{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&zr(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const BD=n=>{n.count>0&&(Sk(n.encoder,n.count===1?n.s:-n.s),n.count>1&&zr(n.encoder,n.count-2))};class WT{constructor(){this.encoder=new AE,this.s=0,this.count=0}write(e){this.s===e?this.count++:(BD(this),this.count=1,this.s=e)}toUint8Array(){return BD(this),qh(this.encoder)}}const zD=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);Sk(n.encoder,e),n.count>1&&zr(n.encoder,n.count-2)}};class oR{constructor(){this.encoder=new AE,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(zD(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return zD(this),qh(this.encoder)}}class jQ{constructor(){this.sarr=[],this.s="",this.lensE=new WT}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new AE;return this.sarr.push(this.s),this.s="",Wv(e,this.sarr.join("")),$w(e,this.lensE.toUint8Array()),qh(e)}}const Fg=n=>new Error(n),gf=()=>{throw Fg("Method unimplemented")},bf=()=>{throw Fg("Unexpected case")},I3=Fg("Unexpected end of array"),k3=Fg("Integer out of Range");class qw{constructor(e){this.arr=e,this.pos=0}}const x_=n=>new qw(n),HQ=n=>n.pos!==n.arr.length,GQ=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},$c=n=>GQ(n,Vr(n)),fy=n=>n.arr[n.pos++],Vr=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&n_)*t,t*=128,i<Eu)return e;if(e>M3)throw k3}throw I3},bk=n=>{let e=n.arr[n.pos++],t=e&iM,r=64;const i=(e&rm)>0?-1:1;if(!(e&Eu))return i*t;const s=n.arr.length;for(;n.pos<s;){if(e=n.arr[n.pos++],t=t+(e&n_)*r,r*=128,e<Eu)return i*t;if(t>M3)throw k3}throw I3},WQ=n=>{let e=Vr(n);if(e===0)return"";{let t=String.fromCodePoint(fy(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(fy(n));else for(;e>0;){const r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},$Q=n=>IS.decode($c(n)),$v=IS?$Q:WQ,Tk=(n,e)=>{const t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},qQ=n=>Tk(n,4).getFloat32(0,!1),XQ=n=>Tk(n,8).getFloat64(0,!1),KQ=n=>Tk(n,8).getBigInt64(0,!1),YQ=[n=>{},n=>null,bk,qQ,XQ,KQ,n=>!1,n=>!0,$v,n=>{const e=Vr(n),t={};for(let r=0;r<e;r++){const i=$v(n);t[i]=XS(n)}return t},n=>{const e=Vr(n),t=[];for(let r=0;r<e;r++)t.push(XS(n));return t},$c],XS=n=>YQ[127-fy(n)](n);class VD extends qw{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),HQ(this)?this.count=Vr(this)+1:this.count=-1),this.count--,this.s}}class $T extends qw{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=bk(this);const e=A3(this.s);this.count=1,e&&(this.s=-this.s,this.count=Vr(this)+2)}return this.count--,this.s}}class aR extends qw{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=bk(this),t=e&1;this.diff=Ug(e/2),this.count=1,t&&(this.count=Vr(this)+2)}return this.s+=this.diff,this.count--,this.s}}class JQ{constructor(e){this.decoder=new $T(e),this.str=$v(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const QQ=crypto.getRandomValues.bind(crypto),O3=()=>QQ(new Uint32Array(1))[0],ZQ="10000000-1000-4000-8000"+-1e11,eZ=()=>ZQ.replace(/[018]/g,n=>(n^O3()&15>>n/4).toString(16)),jD=n=>new Promise(n);Promise.all.bind(Promise);const HD=n=>n===void 0?null:n;class tZ{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let N3=new tZ,nZ=!0;try{typeof localStorage<"u"&&localStorage&&(N3=localStorage,nZ=!1)}catch{}const rZ=N3,iZ=Object.assign,sZ=Object.keys,oZ=(n,e)=>{for(const t in n)e(n[t],t)},GD=n=>sZ(n).length,aZ=n=>{for(const e in n)return!1;return!0},cZ=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},lZ=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),uZ=(n,e)=>n===e||GD(n)===GD(e)&&cZ(n,(t,r)=>(t!==void 0||lZ(e,r))&&e[r]===t),hZ=Object.freeze,P3=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&P3(n[e])}return hZ(n)},xk=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&xk(n,e,t+1)}},dZ=n=>n,fZ=(n,e)=>e.includes(n);var D3={};const KS=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let qd;const pZ=()=>{if(qd===void 0)if(KS){qd=Yh();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&qd.set(e,""),e=r):e!==null&&(qd.set(e,r),e=null)}e!==null&&qd.set(e,"")}else typeof location=="object"?(qd=Yh(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");qd.set(`--${LD(e,"-")}`,t),qd.set(`-${LD(e,"-")}`,t)}})):qd=Yh();return qd},aM=n=>pZ().has(n),kx=n=>HD(KS?D3[n.toUpperCase().replaceAll("-","_")]:rZ.getItem(n)),L3=n=>aM("--"+n)||kx(n)!==null;L3("production");const mZ=KS&&fZ(D3.FORCE_COLOR,["true","1","2"]),gZ=mZ||!aM("--no-colors")&&!L3("no-color")&&(!KS||process.stdout.isTTY)&&(!KS||aM("--color")||kx("COLORTERM")!==null||(kx("TERM")||"").includes("color")),_Z=n=>new Uint8Array(n),vZ=n=>{const e=_Z(n.byteLength);return e.set(n),e};class yZ{constructor(e,t){this.left=e,this.right=t}}const Bp=(n,e)=>new yZ(n,e);typeof DOMParser<"u"&&new DOMParser;const SZ=n=>yQ(n,(e,t)=>`${t}:${e};`).join(""),gm=Symbol,U3=gm(),F3=gm(),EZ=gm(),bZ=gm(),TZ=gm(),B3=gm(),xZ=gm(),wk=gm(),wZ=gm(),CZ=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},RZ={[U3]:Bp("font-weight","bold"),[F3]:Bp("font-weight","normal"),[EZ]:Bp("color","blue"),[TZ]:Bp("color","green"),[bZ]:Bp("color","grey"),[B3]:Bp("color","red"),[xZ]:Bp("color","purple"),[wk]:Bp("color","orange"),[wZ]:Bp("color","black")},AZ=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=Yh();let i=[],s=0;for(;s<n.length;s++){const a=n[s],c=RZ[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=SZ(r);s>0||l.length>0?(e.push("%c"+a),t.push(l)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},z3=gZ?AZ:CZ,MZ=(...n)=>{console.log(...z3(n)),V3.forEach(e=>e.print(n))},IZ=(...n)=>{console.warn(...z3(n)),n.unshift(wk),V3.forEach(e=>e.print(n))},V3=dy(),j3=n=>({[Symbol.iterator](){return this},next:n}),kZ=(n,e)=>j3(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),cR=(n,e)=>j3(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class Ck{constructor(e,t){this.clock=e,this.len=t}}class ME{constructor(){this.clients=new Map}}const H3=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];n4(n,s,a.clock,a.len,t)}}),OZ=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Ug((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},G3=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&OZ(t,e.clock)!==null},Rk=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=T_(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},NZ=n=>{const e=new ME;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=t+1;o<n.length;o++)EQ(s,n[o].clients.get(i)||[]);e.clients.set(i,s)}});return Rk(e),e},Ox=(n,e,t,r)=>{Kg(n.clients,e,()=>[]).push(new Ck(t,r))},PZ=()=>new ME,DZ=n=>{const e=PZ();return n.clients.forEach((t,r)=>{const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<t.length)for(let l=t[s+1];s+1<t.length&&l.deleted;l=t[++s+1])c+=l.length;i.push(new Ck(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Fy=(n,e)=>{zr(n.restEncoder,e.clients.size),Lg(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),zr(n.restEncoder,t);const i=r.length;zr(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},Ak=n=>{const e=new ME,t=Vr(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();const i=Vr(n.restDecoder),s=Vr(n.restDecoder);if(s>0){const o=Kg(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Ck(n.readDsClock(),n.readDsLen()))}}return e},WD=(n,e,t)=>{const r=new ME,i=Vr(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();const o=Vr(n.restDecoder),a=Vr(n.restDecoder),c=t.clients.get(o)||[],l=La(t,o);for(let u=0;u<a;u++){const h=n.readDsClock(),d=h+n.readDsLen();if(h<l){l<d&&Ox(r,o,l,d-l);let p=Qh(c,h),_=c[p];for(!_.deleted&&_.id.clock<h&&(c.splice(p+1,0,Ux(e,_,h-_.id.clock)),p++);p<c.length&&(_=c[p++],_.id.clock<d);)_.deleted||(d<_.id.clock+_.length&&c.splice(p,0,Ux(e,_,d-_.id.clock)),_.delete(e))}else Ox(r,o,h,d-h)}}if(r.clients.size>0){const s=new a_;return zr(s.restEncoder,0),Fy(s,r),s.toUint8Array()}return null},W3=O3;class _m extends TQ{constructor({guid:e=eZ(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=W3(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new e4,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=jD(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>jD(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&hs(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Lg(this.subdocs).map(e=>e.guid))}transact(e,t=null){return hs(this,e,t)}get(e,t=ao){const r=Kg(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==ao&&i!==t)if(i===ao){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,_f)}getText(e=""){return this.get(e,Zh)}getMap(e=""){return this.get(e,Tf)}getXmlElement(e=""){return this.get(e,lm)}getXmlFragment(e=""){return this.get(e,xf)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Lg(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new _m({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,hs(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class $3{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Vr(this.restDecoder)}readDsLen(){return Vr(this.restDecoder)}}class q3 extends $3{readLeftID(){return ui(Vr(this.restDecoder),Vr(this.restDecoder))}readRightID(){return ui(Vr(this.restDecoder),Vr(this.restDecoder))}readClient(){return Vr(this.restDecoder)}readInfo(){return fy(this.restDecoder)}readString(){return $v(this.restDecoder)}readParentInfo(){return Vr(this.restDecoder)===1}readTypeRef(){return Vr(this.restDecoder)}readLen(){return Vr(this.restDecoder)}readAny(){return XS(this.restDecoder)}readBuf(){return vZ($c(this.restDecoder))}readJSON(){return JSON.parse($v(this.restDecoder))}readKey(){return $v(this.restDecoder)}}class LZ{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Vr(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Vr(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class py extends LZ{constructor(e){super(e),this.keys=[],Vr(e),this.keyClockDecoder=new aR($c(e)),this.clientDecoder=new $T($c(e)),this.leftClockDecoder=new aR($c(e)),this.rightClockDecoder=new aR($c(e)),this.infoDecoder=new VD($c(e),fy),this.stringDecoder=new JQ($c(e)),this.parentInfoDecoder=new VD($c(e),fy),this.typeRefDecoder=new $T($c(e)),this.lenDecoder=new $T($c(e))}readLeftID(){return new qv(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new qv(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return XS(this.restDecoder)}readBuf(){return $c(this.restDecoder)}readJSON(){return XS(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class X3{constructor(){this.restEncoder=Ag()}toUint8Array(){return qh(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){zr(this.restEncoder,e)}writeDsLen(e){zr(this.restEncoder,e)}}class IE extends X3{writeLeftID(e){zr(this.restEncoder,e.client),zr(this.restEncoder,e.clock)}writeRightID(e){zr(this.restEncoder,e.client),zr(this.restEncoder,e.clock)}writeClient(e){zr(this.restEncoder,e)}writeInfo(e){sM(this.restEncoder,e)}writeString(e){Wv(this.restEncoder,e)}writeParentInfo(e){zr(this.restEncoder,e?1:0)}writeTypeRef(e){zr(this.restEncoder,e)}writeLen(e){zr(this.restEncoder,e)}writeAny(e){qS(this.restEncoder,e)}writeBuf(e){_c(this.restEncoder,e)}writeJSON(e){Wv(this.restEncoder,JSON.stringify(e))}writeKey(e){Wv(this.restEncoder,e)}}class K3{constructor(){this.restEncoder=Ag(),this.dsCurrVal=0}toUint8Array(){return qh(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,zr(this.restEncoder,t)}writeDsLen(e){e===0&&bf(),zr(this.restEncoder,e-1),this.dsCurrVal+=e}}class a_ extends K3{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new oR,this.clientEncoder=new WT,this.leftClockEncoder=new oR,this.rightClockEncoder=new oR,this.infoEncoder=new FD(sM),this.stringEncoder=new jQ,this.parentInfoEncoder=new FD(sM),this.typeRefEncoder=new WT,this.lenEncoder=new WT}toUint8Array(){const e=Ag();return zr(e,0),_c(e,this.keyClockEncoder.toUint8Array()),_c(e,this.clientEncoder.toUint8Array()),_c(e,this.leftClockEncoder.toUint8Array()),_c(e,this.rightClockEncoder.toUint8Array()),_c(e,qh(this.infoEncoder)),_c(e,this.stringEncoder.toUint8Array()),_c(e,qh(this.parentInfoEncoder)),_c(e,this.typeRefEncoder.toUint8Array()),_c(e,this.lenEncoder.toUint8Array()),$w(e,qh(this.restEncoder)),qh(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){qS(this.restEncoder,e)}writeBuf(e){_c(this.restEncoder,e)}writeJSON(e){qS(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const UZ=(n,e,t,r)=>{r=T_(r,e[0].id.clock);const i=Qh(e,r);zr(n.restEncoder,e.length-i),n.writeClient(t),zr(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},Mk=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{La(e,s)>i&&r.set(s,i)}),Xw(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),zr(n.restEncoder,r.size),Lg(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{UZ(n,e.clients.get(i),i,s)})},FZ=(n,e)=>{const t=Yh(),r=Vr(n.restDecoder);for(let i=0;i<r;i++){const s=Vr(n.restDecoder),o=new Array(s),a=n.readClient();let c=Vr(n.restDecoder);t.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=n.readInfo();switch(Ww&u){case 0:{const h=n.readLen();o[l]=new _u(ui(a,c),h),c+=h;break}case 10:{const h=Vr(n.restDecoder);o[l]=new Ju(ui(a,c),h),c+=h;break}default:{const h=(u&(rm|Eu))===0,d=new da(ui(a,c),null,(u&Eu)===Eu?n.readLeftID():null,null,(u&rm)===rm?n.readRightID():null,h?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,h&&(u&WS)===WS?n.readString():null,E4(n,u));o[l]=d,c+=d.length}}}}return t},BZ=(n,e,t)=>{const r=[];let i=Lg(t.keys()).sort((p,_)=>p-_);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let p=t.get(i[i.length-1]);for(;p.refs.length===p.i;)if(i.pop(),i.length>0)p=t.get(i[i.length-1]);else return null;return p};let o=s();if(o===null)return null;const a=new e4,c=new Map,l=(p,_)=>{const y=c.get(p);(y==null||y>_)&&c.set(p,_)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const p of r){const _=p.id.client,y=t.get(_);y?(y.i--,a.clients.set(_,y.refs.slice(y.i)),t.delete(_),y.i=0,y.refs=[]):a.clients.set(_,[p]),i=i.filter(S=>S!==_)}r.length=0};for(;;){if(u.constructor!==Ju){const _=Kg(h,u.id.client,()=>La(e,u.id.client))-u.id.clock;if(_<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const y=u.getMissing(n,e);if(y!==null){r.push(u);const S=t.get(y)||{refs:[],i:0};if(S.refs.length===S.i)l(y,La(e,y)),d();else{u=S.refs[S.i++];continue}}else(_===0||_<u.length)&&(u.integrate(n,_),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const p=new a_;return Mk(p,a,new Map),zr(p.restEncoder,0),{missing:c,update:p.toUint8Array()}}return null},zZ=(n,e)=>Mk(n,e.doc.store,e.beforeState),VZ=(n,e,t,r=new py(n))=>hs(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=FZ(r,o),l=BZ(i,a,c),u=a.pendingStructs;if(u){for(const[d,p]of u.missing)if(p<La(a,d)){s=!0;break}if(l){for(const[d,p]of l.missing){const _=u.missing.get(d);(_==null||_>p)&&u.missing.set(d,p)}u.update=Nx([u.update,l.update])}}else a.pendingStructs=l;const h=WD(r,i,a);if(a.pendingDs){const d=new py(x_(a.pendingDs));Vr(d.restDecoder);const p=WD(d,i,a);h&&p?a.pendingDs=Nx([h,p]):a.pendingDs=h||p}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,Y3(i.doc,d)}},t,!1),Y3=(n,e,t,r=py)=>{const i=x_(e);VZ(i,n,t,new r(i))},jZ=(n,e,t)=>Y3(n,e,t,q3),HZ=(n,e,t=new Map)=>{Mk(n,e.store,t),Fy(n,DZ(e.store))},GZ=(n,e=new Uint8Array([0]),t=new a_)=>{const r=J3(e);HZ(t,n,r);const i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(oee(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===IE)return iee(i.map((s,o)=>o===0?s:cee(s)));if(t.constructor===a_)return Nx(i)}return i[0]},WZ=(n,e)=>GZ(n,e,new IE),$Z=n=>{const e=new Map,t=Vr(n.restDecoder);for(let r=0;r<t;r++){const i=Vr(n.restDecoder),s=Vr(n.restDecoder);e.set(i,s)}return e},J3=n=>$Z(new $3(x_(n))),Q3=(n,e)=>(zr(n.restEncoder,e.size),Lg(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{zr(n.restEncoder,t),zr(n.restEncoder,r)}),n),qZ=(n,e)=>Q3(n,Xw(e.store)),XZ=(n,e=new K3)=>(n instanceof Map?Q3(e,n):qZ(e,n),e.toUint8Array()),KZ=n=>XZ(n,new X3);class YZ{constructor(){this.l=[]}}const $D=()=>new YZ,qD=(n,e)=>n.l.push(e),XD=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Z3=(n,e,t)=>xk(n.l,[e,t]);class qv{constructor(e,t){this.client=e,this.clock=t}}const rT=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,ui=(n,e)=>new qv(n,e),JZ=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw bf()},wv=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!G3(e.ds,n.id),cM=(n,e)=>{const t=Kg(n.meta,cM,dy),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<La(r,s)&&Bg(n,ui(s,i))}),H3(n,e.ds,i=>{}),t.add(e))};class e4{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Xw=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},La=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},t4=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw bf()}t.push(e)},Qh=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Ug(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Ug((t+r)/2)}throw bf()},QZ=(n,e)=>{const t=n.clients.get(e.client);return t[Qh(t,e.clock)]},lR=QZ,lM=(n,e,t)=>{const r=Qh(e,t),i=e[r];return i.id.clock<t&&i instanceof da?(e.splice(r+1,0,Ux(n,i,t-i.id.clock)),r+1):r},Bg=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[lM(n,t,e.clock)]},KD=(n,e,t)=>{const r=e.clients.get(t.client),i=Qh(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==_u&&r.splice(i+1,0,Ux(n,s,t.clock-s.id.clock+1)),s},ZZ=(n,e,t)=>{const r=n.clients.get(e.id.client);r[Qh(r,e.id.clock)]=t},n4=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=lM(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&lM(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class eee{constructor(e,t,r){this.doc=e,this.deleteSet=new ME,this.beforeState=Xw(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const YD=(n,e)=>e.deleteSet.clients.size===0&&!SQ(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Rk(e.deleteSet),zZ(n,e),Fy(n,e.deleteSet),!0),JD=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&Kg(n.changed,e,dy).add(t)},qT=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof da&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},tee=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Qh(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof da&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},nee=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=R3(i.length-1,1+Qh(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+qT(i,c)}})},r4=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{Rk(s),t.afterState=Xw(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Z3(l._dEH,c,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),xk(a,[]),t._needFormattingCleanup&&bee(t)}finally{r.gc&&tee(s,i,r.gcFilter),nee(s,i),t.afterState.forEach((u,h)=>{const d=t.beforeState.get(h)||0;if(d!==u){const p=i.clients.get(h),_=T_(Qh(p,d),1);for(let y=p.length-1;y>=_;)y-=1+qT(p,y)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,p=i.clients.get(h),_=Qh(p,d);_+1<p.length&&qT(p,_+1)>1||_>0&&qT(p,_)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(MZ(wk,U3,"[yjs] ",F3,B3,"Changed the client-id because another client seems to be using it."),r.clientID=W3()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new IE;YD(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new a_;YD(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=t;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,t]),l.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):r4(n,e+1)}}},hs=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new eee(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&r4(i,0)}}return o};function*ree(n){const e=Vr(n.restDecoder);for(let t=0;t<e;t++){const r=Vr(n.restDecoder),i=n.readClient();let s=Vr(n.restDecoder);for(let o=0;o<r;o++){const a=n.readInfo();if(a===10){const c=Vr(n.restDecoder);yield new Ju(ui(i,s),c),s+=c}else if(Ww&a){const c=(a&(rm|Eu))===0,l=new da(ui(i,s),null,(a&Eu)===Eu?n.readLeftID():null,null,(a&rm)===rm?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&WS)===WS?n.readString():null,E4(n,a));yield l,s+=l.length}else{const c=n.readLen();yield new _u(ui(i,s),c),s+=c}}}}class Ik{constructor(e,t){this.gen=ree(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ju);return this.curr}}class kk{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const iee=n=>Nx(n,q3,IE),see=(n,e)=>{if(n.constructor===_u){const{client:t,clock:r}=n.id;return new _u(ui(t,r+e),n.length-e)}else if(n.constructor===Ju){const{client:t,clock:r}=n.id;return new Ju(ui(t,r+e),n.length-e)}else{const t=n,{client:r,clock:i}=t.id;return new da(ui(r,i+e),null,ui(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Nx=(n,e=py,t=a_)=>{if(n.length===1)return n[0];const r=n.map(u=>new e(x_(u)));let i=r.map(u=>new Ik(u,!0)),s=null;const o=new t,a=new kk(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){const _=d.curr.id.clock-p.curr.id.clock;return _===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===Ju?1:-1:_}else return p.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),p=!0;if(d===null||d.id.client!==h||p&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)bg(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Ju)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{bg(a,s.struct,s.offset);const _=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Ju(ui(h,s.struct.id.clock+s.struct.length),_),offset:0}}else{const _=s.struct.id.clock+s.struct.length-d.id.clock;_>0&&(s.struct.constructor===Ju?s.struct.length-=_:d=see(d,_)),s.struct.mergeWith(d)||(bg(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Ju;d=u.next())bg(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(bg(a,s.struct,s.offset),s=null),Ok(a);const c=r.map(u=>Ak(u)),l=NZ(c);return Fy(o,l),o.toUint8Array()},oee=(n,e,t=py,r=a_)=>{const i=J3(e),s=new r,o=new kk(s),a=new t(x_(n)),c=new Ik(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===Ju){c.next();continue}if(u.id.clock+u.length>d)for(bg(o,u,T_(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)bg(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Ok(o);const l=Ak(a);return Fy(s,l),s.toUint8Array()},i4=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:qh(n.encoder.restEncoder)}),n.encoder.restEncoder=Ag(),n.written=0)},bg=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&i4(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),zr(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},Ok=n=>{i4(n);const e=n.encoder.restEncoder;zr(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){const r=n.clientStructs[t];zr(e,r.written),$w(e,r.restEncoder)}},aee=(n,e,t,r)=>{const i=new t(x_(n)),s=new Ik(i,!1),o=new r,a=new kk(o);for(let l=s.curr;l!==null;l=s.next())bg(a,e(l),0);Ok(a);const c=Ak(i);return Fy(o,c),o.toUint8Array()},cee=n=>aee(n,dZ,py,IE),QD="You must not compute changes after the event-handler fired.";class Kw{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=lee(this.currentTarget,this.target))}deletes(e){return G3(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fg(QD);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=rR(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=rR(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=rR(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fg(QD);const t=this.target,r=dy(),i=dy(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const lee=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},yc=()=>{IZ("Invalid access: Add Yjs type to a document before reading data.")},s4=80;let Nk=0;class uee{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Nk++}}const hee=n=>{n.timestamp=Nk++},o4=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Nk++},dee=(n,e,t)=>{if(n.length>=s4){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return o4(r,e,t),r}else{const r=new uee(e,t);return n.push(r),r}},Yw=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>GT(e-s.index)<GT(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,hee(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&GT(t.index-i)<r.parent.length/s4?(o4(t,r,i),t):dee(n._searchMarker,r,i)},YS=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=T_(e,i.index+t))}},Jw=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;Kg(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;Z3(r._eH,t,e)};class ao{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=$D(),this._dEH=$D(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw gf()}clone(){throw gf()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){qD(this._eH,e)}observeDeep(e){qD(this._dEH,e)}unobserve(e){XD(this._eH,e)}unobserveDeep(e){XD(this._dEH,e)}toJSON(){}}const a4=(n,e,t)=>{n.doc??yc(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},c4=n=>{n.doc??yc();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},JS=(n,e)=>{let t=0,r=n._start;for(n.doc??yc();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},l4=(n,e)=>{const t=[];return JS(n,(r,i)=>{t.push(e(r,i,n))}),t},fee=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},u4=(n,e)=>{n.doc??yc();const t=Yw(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Px=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,c=t===null?e._start:t.right;let l=[];const u=()=>{l.length>0&&(i=new da(ui(o,La(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new l_(l)),i.integrate(n,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new da(ui(o,La(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new kE(new Uint8Array(h))),i.integrate(n,0);break;case _m:i=new da(ui(o,La(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new OE(h)),i.integrate(n,0);break;default:if(h instanceof ao)i=new da(ui(o,La(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new vm(h)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},h4=()=>Fg("Length exceeded!"),d4=(n,e,t,r)=>{if(t>e._length)throw h4();if(t===0)return e._searchMarker&&YS(e._searchMarker,t,r.length),Px(n,e,null,r);const i=t,s=Yw(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&Bg(n,ui(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&YS(e._searchMarker,i,r.length),Px(n,e,o,r)},pee=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Px(n,e,i,t)},f4=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=Yw(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Bg(n,ui(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bg(n,ui(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw h4();e._searchMarker&&YS(e._searchMarker,i,-s+r)},Dx=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},Pk=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new l_([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new l_([r]);break;case Uint8Array:a=new kE(r);break;case _m:a=new OE(r);break;default:if(r instanceof ao)a=new vm(r);else throw new Error("Unexpected content type")}new da(ui(o,La(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},Dk=(n,e)=>{n.doc??yc();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},p4=n=>{const e={};return n.doc??yc(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},m4=(n,e)=>{n.doc??yc();const t=n._map.get(e);return t!==void 0&&!t.deleted},mee=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&wv(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},iT=n=>(n.doc??yc(),kZ(n._map.entries(),e=>!e[1].deleted));class gee extends Kw{}class _f extends ao{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new _f;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new _f}clone(){const e=new _f;return e.insert(0,this.toArray().map(t=>t instanceof ao?t.clone():t)),e}get length(){return this.doc??yc(),this._length}_callObserver(e,t){super._callObserver(e,t),Jw(this,e,new gee(this,e))}insert(e,t){this.doc!==null?hs(this.doc,r=>{d4(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?hs(this.doc,t=>{pee(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?hs(this.doc,r=>{f4(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return u4(this,e)}toArray(){return c4(this)}slice(e=0,t=this.length){return a4(this,e,t)}toJSON(){return this.map(e=>e instanceof ao?e.toJSON():e)}map(e){return l4(this,e)}forEach(e){JS(this,e)}[Symbol.iterator](){return fee(this)}_write(e){e.writeTypeRef(Vee)}}const _ee=n=>new _f;class vee extends Kw{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Tf extends ao{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Tf}clone(){const e=new Tf;return this.forEach((t,r)=>{e.set(r,t instanceof ao?t.clone():t)}),e}_callObserver(e,t){Jw(this,e,new vee(this,e,t))}toJSON(){this.doc??yc();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof ao?i.toJSON():i}}),e}get size(){return[...iT(this)].length}keys(){return cR(iT(this),e=>e[0])}values(){return cR(iT(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return cR(iT(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??yc(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?hs(this.doc,t=>{Dx(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?hs(this.doc,r=>{Pk(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Dk(this,e)}has(e){return m4(this,e)}clear(){this.doc!==null?hs(this.doc,e=>{this.forEach(function(t,r,i){Dx(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(jee)}}const yee=n=>new Tf,xg=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&uZ(n,e);class uM{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&bf(),this.right.content.constructor){case _a:this.right.deleted||By(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ZD=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case _a:e.right.deleted||By(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Bg(n,ui(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},sT=(n,e,t,r)=>{const i=new Map,s=r?Yw(e,t):null;if(s){const o=new uM(s.p.left,s.p,s.index,i);return ZD(n,o,t-s.index)}else{const o=new uM(null,e._start,0,i);return ZD(n,o,t)}},g4=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===_a&&xg(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const c=t.left,l=t.right,u=new da(ui(s,La(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new _a(a,o));u.integrate(n,0),t.right=u,t.forward()})},By=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},_4=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===_a&&xg(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},v4=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=t.currentAttributes.get(a)??null;if(!xg(l,c)){o.set(a,l);const{left:u,right:h}=t;t.right=new da(ui(s,La(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new _a(a,c)),t.right.integrate(n,0),t.forward()}}return o},uR=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,p)=>{i[p]===void 0&&(i[p]=null)});const s=n.doc,o=s.clientID;_4(t,i);const a=v4(n,e,t,i),c=r.constructor===String?new wf(r):r instanceof ao?new vm(r):new w_(r);let{left:l,right:u,index:h}=t;e._searchMarker&&YS(e._searchMarker,t.index,c.getLength()),u=new da(ui(o,La(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(n,0),t.right=u,t.index=h,t.forward(),g4(n,e,t,a)},eL=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;_4(t,i);const a=v4(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===_a));){if(!t.right.deleted)switch(t.right.content.constructor){case _a:{const{key:c,value:l}=t.right.content,u=i[c];if(u!==void 0){if(xg(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}t.right.delete(n)}else t.currentAttributes.set(c,l);break}default:r<t.right.length&&Bg(n,ui(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new da(ui(o,La(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new wf(c)),t.right.integrate(n,0),t.forward()}g4(n,e,t,a)},y4=(n,e,t,r,i)=>{let s=e;const o=Yh();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===_a){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(t===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case _a:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(n),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&By(i,l);break}}}e=e.right}return a},See=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===_a){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},Eee=n=>{let e=0;return hs(n.doc,t=>{let r=n._start,i=n._start,s=Yh();const o=rM(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case _a:By(o,i.content);break;default:e+=y4(t,r,i,s,o),s=rM(o),r=i;break}i=i.right}}),e},bee=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&n4(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===_a&&o.constructor!==_u&&e.add(o.parent)})}hs(t,r=>{H3(n,n.deleteSet,i=>{if(i instanceof _u||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===_a?e.add(s):See(r,i)});for(const i of e)Eee(i)})},tL=(n,e,t)=>{const r=t,i=rM(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case vm:case w_:case wf:t<e.right.length&&Bg(n,ui(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&y4(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&YS(o._searchMarker,e.index,-r+t),e};class Tee extends Kw{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];hs(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let p=null;switch(a){case"delete":h>0&&(p={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(p={insert:l},i.size>0&&(p.attributes={},i.forEach((_,y)=>{_!==null&&(p.attributes[y]=_)}))),l="";break;case"retain":u>0&&(p={retain:u},aZ(c)||(p.attributes=iZ({},c))),u=0;break}p&&t.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case vm:case w_:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case wf:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case _a:{const{key:p,value:_}=o.content;if(this.adds(o)){if(!this.deletes(o)){const y=i.get(p)??null;xg(y,_)?_!==null&&o.delete(r):(a==="retain"&&d(),xg(_,s.get(p)??null)?delete c[p]:c[p]=_)}}else if(this.deletes(o)){s.set(p,_);const y=i.get(p)??null;xg(y,_)||(a==="retain"&&d(),c[p]=y)}else if(!o.deleted){s.set(p,_);const y=c[p];y!==void 0&&(xg(y,_)?y!==null&&o.delete(r):(a==="retain"&&d(),_===null?delete c[p]:c[p]=_))}o.deleted||(a==="insert"&&d(),By(i,o.content));break}}o=o.right}for(d();t.length>0;){const p=t[t.length-1];if(p.retain!==void 0&&p.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class Zh extends ao{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??yc(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Zh}clone(){const e=new Zh;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new Tee(this,e,t);Jw(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??yc();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===wf&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?hs(this.doc,r=>{const i=new uM(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&uR(r,this,i,a,o.attributes||{})}else o.retain!==void 0?eL(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&tL(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??yc();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((_,y)=>{d=!0,h[y]=_});const p={insert:a};d&&(p.attributes=h),i.push(p),a=""}}const u=()=>{for(;c!==null;){if(wv(c,e)||t!==void 0&&wv(c,t))switch(c.content.constructor){case wf:{const h=s.get("ychange");e!==void 0&&!wv(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!wv(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case vm:case w_:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((p,_)=>{d[_]=p})}i.push(h);break}case _a:wv(c,e)&&(l(),By(s,c.content));break}c=c.right}l()};return e||t?hs(o,h=>{e&&cM(h,e),t&&cM(h,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?hs(i,s=>{const o=sT(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),uR(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?hs(i,s=>{const o=sT(s,this,e,!r);uR(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?hs(r,i=>{tL(i,sT(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?hs(i,s=>{const o=sT(s,this,e,!1);o.right!==null&&eL(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?hs(this.doc,t=>{Dx(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?hs(this.doc,r=>{Pk(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Dk(this,e)}getAttributes(){return p4(this)}_write(e){e.writeTypeRef(Hee)}}const xee=n=>new Zh;class hR{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??yc()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===lm||t.constructor===xf)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class xf extends ao{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new xf}clone(){const e=new xf;return e.insert(0,this.toArray().map(t=>t instanceof ao?t.clone():t)),e}get length(){return this.doc??yc(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new hR(this,e)}querySelector(e){e=e.toUpperCase();const r=new hR(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Lg(new hR(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Jw(this,e,new Ree(this,t,e))}toString(){return l4(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),JS(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?hs(this.doc,r=>{d4(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)hs(this.doc,r=>{const i=e&&e instanceof ao?e._item:e;Px(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Fg("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?hs(this.doc,r=>{f4(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return c4(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return u4(this,e)}slice(e=0,t=this.length){return a4(this,e,t)}forEach(e){JS(this,e)}_write(e){e.writeTypeRef(Wee)}}const wee=n=>new xf;class lm extends xf{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new lm(this.nodeName)}clone(){const e=new lm(this.nodeName),t=this.getAttributes();return oZ(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ao?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];t.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?hs(this.doc,t=>{Dx(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?hs(this.doc,r=>{Pk(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Dk(this,e)}hasAttribute(e){return m4(this,e)}getAttributes(e){return e?mee(this,e):p4(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return JS(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Gee),e.writeKey(this.nodeName)}}const Cee=n=>new lm(n.readKey());class Ree extends Kw{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class my extends Tf{constructor(e){super(),this.hookName=e}_copy(){return new my(this.hookName)}clone(){const e=new my(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const i=t[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef($ee),e.writeKey(this.hookName)}}const Aee=n=>new my(n.readKey());class c_ extends Zh{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new c_}clone(){const e=new c_;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const t=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){const s=t[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(qee)}}const Mee=n=>new c_;class Lk{constructor(e,t){this.id=e,this.length=t}get deleted(){throw gf()}mergeWith(e){return!1}write(e,t,r){throw gf()}integrate(e,t){throw gf()}}const Iee=0;class _u extends Lk{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),t4(e.doc.store,this)}write(e,t){e.writeInfo(Iee),e.writeLen(this.length-t)}getMissing(e,t){return null}}class kE{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new kE(this.content)}splice(e){throw gf()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const kee=n=>new kE(n.readBuf());class QS{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new QS(this.len)}splice(e){const t=new QS(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Ox(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const Oee=n=>new QS(n.readLen()),S4=(n,e)=>new _m({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class OE{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new OE(S4(this.doc.guid,this.opts))}splice(e){throw gf()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Nee=n=>new OE(S4(n.readString(),n.readAny()));class w_{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new w_(this.embed)}splice(e){throw gf()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const Pee=n=>new w_(n.readJSON());class _a{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new _a(this.key,this.value)}splice(e){throw gf()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Dee=n=>new _a(n.readKey(),n.readJSON());class Lx{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Lx(this.arr)}splice(e){const t=new Lx(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Lee=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++){const i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new Lx(t)},Uee=kx("node_env")==="development";class l_{constructor(e){this.arr=e,Uee&&P3(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new l_(this.arr)}splice(e){const t=new l_(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const Fee=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new l_(t)};class wf{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new wf(this.str)}splice(e){const t=new wf(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const Bee=n=>new wf(n.readString()),zee=[_ee,yee,xee,Cee,wee,Aee,Mee],Vee=0,jee=1,Hee=2,Gee=3,Wee=4,$ee=5,qee=6;class vm{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new vm(this.type._copy())}splice(e){throw gf()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Xee=n=>new vm(zee[n.readTypeRef()](n)),Ux=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new da(ui(r,i+t),e,ui(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=ui(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class da extends Lk{constructor(e,t,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?DD:0}set marker(e){(this.info&sR)>0!==e&&(this.info^=sR)}get marker(){return(this.info&sR)>0}get keep(){return(this.info&PD)>0}set keep(e){this.keep!==e&&(this.info^=PD)}get countable(){return(this.info&DD)>0}get deleted(){return(this.info&iR)>0}set deleted(e){this.deleted!==e&&(this.info^=iR)}markDeleted(){this.info|=iR}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=La(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=La(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===qv&&this.id.client!==this.parent.client&&this.parent.clock>=La(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=KD(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bg(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===_u||this.right&&this.right.constructor===_u)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===da&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===da&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===qv){const r=lR(t,this.parent);r.constructor===_u?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=KD(e,e.doc.store,ui(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),rT(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(rT(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(lR(e.doc.store,i.origin)))s.has(lR(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),t4(e.doc.store,this),this.content.integrate(e,this),JD(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new _u(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ui(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&rT(e.origin,this.lastId)&&this.right===e&&rT(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Ox(e.deleteSet,this.id.client,this.id.clock,this.length),JD(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw bf();this.content.gc(e),t?ZZ(e,this,new _u(this.id,this.length)):this.content=new QS(this.length)}write(e,t){const r=t>0?ui(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ww|(r===null?0:Eu)|(i===null?0:rm)|(s===null?0:WS);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=JZ(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===qv?(e.writeParentInfo(!1),e.writeLeftID(a)):bf();s!==null&&e.writeString(s)}this.content.write(e,t)}}const E4=(n,e)=>Kee[e&Ww](n),Kee=[()=>{bf()},Oee,Lee,kee,Bee,Pee,Dee,Xee,Fee,Nee,()=>{bf()}],Yee=10;class Ju extends Lk{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){bf()}write(e,t){e.writeInfo(Yee),zr(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const b4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},T4="__ $YJS$ __";b4[T4]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");b4[T4]=!0;let hM,dM,Jee=n=>n();function Qee(n,e){if(dM)return dM(n,e);Jee(n)}function u_(n,e,t){if(hM)return hM.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function Zee(n){hM=function(e,t,r){const i=n.createAtom(e);return t&&t(),i},dM=(e,t)=>n.reaction(e,t,{fireImmediately:!1})}const nL=new WeakSet;function ete(n){if(nL.has(n))return n;nL.add(n);let e;const t=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=u_("map",()=>{n.observe(h)},()=>{n.unobserve(h)})}e.reportObserved(n._implicitObserver)}function i(h){let d=t.get(h);if(!d){const p=_=>{d.reportChanged()};d=u_(h+"",()=>{n.observe(p)},()=>{n.unobserve(p)}),t.set(h,d)}d.reportObserved(n._implicitObserver)}const s=n.get;n.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const d=n[h];n[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=n,p=Object.getOwnPropertyDescriptor(d,h);if(p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),p||(d=Object.getPrototypeOf(d),p=Object.getOwnPropertyDescriptor(d,h)),!p)throw new Error("property not found");const _=p.get;p.get=function(){return this._disableTracking||r(),Reflect.apply(_,this,arguments)},Object.defineProperty(n,h,p)}function c(h,d){let p=n,_=Object.getOwnPropertyDescriptor(p,h);if(_||(p=Object.getPrototypeOf(p),_=Object.getOwnPropertyDescriptor(p,h)),_||(p=Object.getPrototypeOf(p),_=Object.getOwnPropertyDescriptor(p,h)),!_)throw new Error("property not found");Object.defineProperty(n,d,_)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=n.push;n.push=function(h){this._disableTracking=!0;const d=l.call(this,h);return this._disableTracking=!1,d};const u=n.slice;return n.slice=function(h,d){this._disableTracking=!0;const p=u.call(this,h,d);return this._disableTracking=!1,p},n}const rL=new WeakSet;function tte(n){if(rL.has(n))return n;rL.add(n);let e;function t(){if(!e){let s=Array.from(n.share.keys());const o=a=>{const c=Array.from(n.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=u_("map",()=>{n.on("beforeObserverCalls",o)},()=>{n.off("beforeObserverCalls",o)})}e.reportObserved(n._implicitObserver)}const r=n.get;n.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Qw(o),o};function i(s){const o=n[s];let a;n[s]=function(){let c,l=arguments;return t(),a&&a.removeObservers(),a=Qee(()=>(c=Reflect.apply(o,n,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(n,"keys",{get:()=>(t(),Object.keys(n.share))}),n}const iL=new WeakSet;function nte(n){if(iL.has(n))return n;iL.add(n);let e;const t=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=u_("map",()=>{n.observe(a)},()=>{n.unobserve(a)})}e.reportObserved(n._implicitObserver)}function i(a){let c=t.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=u_(a,()=>{n.observe(l)},()=>{n.unobserve(l)}),t.set(a,c)}c.reportObserved(n._implicitObserver)}const s=n.get;n.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=n[a];n[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),n}const sL=new WeakSet;function oL(n){if(sL.has(n))return n;sL.add(n);let e;const t=i=>{e.reportChanged()};e=u_("text",()=>{n.observe(t)},()=>{n.unobserve(t)});function r(i){const s=n[i];n[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),n}const aL=new WeakSet;function cL(n){if(aL.has(n))return n;aL.add(n);let e;const t=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=u_("xml",()=>{n.observe(t)},()=>{n.unobserve(t)});function r(s){const o=n[s];n[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=n,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(n,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),n}function Qw(n){return n instanceof c_||n instanceof Zh?oL(n):n instanceof _f?ete(n):n instanceof Tf?nte(n):n instanceof _m||Object.prototype.hasOwnProperty.call(n,"autoLoad")?tte(n):n instanceof xf||n instanceof lm?cL(n):n}function lL(n){n.share.forEach(e=>{e.constructor!==ao&&Qw(e)})}function uL(n,e){for(let r=n.length-1;r>=e;r--){let i=n[r];if(!i.deleted){var t;if(i instanceof _u)continue;(t=i.content)==null||t.getContent().forEach(s=>{s instanceof ao&&Qw(s)})}}}const hL=new WeakSet;function rte(n){hL.has(n)||(hL.add(n),Qw(n),n.store.clients.forEach(e=>{e&&uL(e,0)}),lL(n),n.on("beforeObserverCalls",e=>{lL(n),e.afterState.forEach((t,r)=>{const i=e.beforeState.get(r)||0;if(i!==t){const s=e.doc.store.clients.get(r);if(!s)return;const o=Qh(s,i);uL(s,o)}})}))}class ZS{constructor(e){this.value=void 0,this.value=e}}function ite(n){return ArrayBuffer.isView(n)?new ZS(n):new ZS(Object.freeze(n))}function ste(n){const e=function(){var a;let c=(a=this[sh])==null?void 0:a.implicitObserver;return n._implicitObserver=c,n.slice.bind(n).apply(n,arguments).map(u=>{const h=Zw(u,c);return c&&typeof h=="object"?hy(h,c):h})},t=function(a){return a.map(c=>{const l=Uk(c);let u=zg(l)||l;if(u instanceof ZS&&(u=u.value),u instanceof ao&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(n.unshift(t(o)),n.lengthUntracked),push:(...o)=>(n.push(t(o)),n.lengthUntracked),insert:n.insert.bind(n),toJSON:n.toJSON.bind(n),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>ute(a,o))},splice:function(){let o=arguments[0]<0?n.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return n.doc?n.doc.transact(()=>{n.delete(o,a),n.insert(o,t(c))}):(n.delete(o,a),n.insert(o,t(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function sS(n){if(typeof n=="string"&&n.trim().length){const e=Number(n);if(Number.isInteger(e))return e}return n}function dL(n,e=new _f){if(e[fa])throw new Error("unexpected");const t=ste(e),r=new Proxy(t,{set:(i,s,o)=>{throw typeof sS(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=sS(s);if(a===eC)return e;if(typeof a=="number"){let u;if(o&&o[sh]){var c;u=(c=o[sh])==null?void 0:c.implicitObserver,e._implicitObserver=u}let h=e.get(a);return h=Zw(h,u),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=sS(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=sS(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=sS(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return t.push.apply(r,n),r}function fL(n,e=new Tf){if(e[fa])throw new Error("unexpected");const t=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Uk(s);let a=zg(o)||o;if(a instanceof ZS&&(a=a.value),a instanceof ao&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===eC)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[sh]){var a;o=(a=s[sh])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=Zw(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});kS.set(e,t);for(let r in n)t[r]=n[r];return t}function ote(n){return n instanceof ao}const kS=new WeakMap;function Zw(n,e){if(ote(n)){if(n._implicitObserver=e,n instanceof _f||n instanceof Tf){if(!kS.has(n)){const t=Uk(n);kS.set(n,t)}n=kS.get(n)}else if(n instanceof lm||n instanceof xf||n instanceof c_||n instanceof my||n instanceof Zh)yk(n),n.__v_skip=!0;else throw new Error("unknown YType");return n}else{if(n===null)return null;if(typeof n=="object")return ite(n)}return n}function Uk(n){if(n==null)return n;if(n=zg(n)||n,n instanceof _f)return dL([],n);if(n instanceof Tf)return fL({},n);if(typeof n=="string")return n;if(Array.isArray(n))return dL(n);if(n instanceof lm||n instanceof xf||n instanceof c_||n instanceof my)return n;if(n instanceof Zh)return n;if(typeof n=="object")return n instanceof ZS?n:fL(n);if(typeof n=="number"||typeof n=="boolean")return n;throw new Error("invalid")}function ate(n){for(let[e,t]of Object.entries(n))if(Array.isArray(t)){if(t.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(t&&typeof t=="object"){if(Object.keys(t).length!==0||Object.getPrototypeOf(t)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(t!=="xml"&&t!=="text")throw new Error("unknown Root initializer")}function pL(n,e,t){let r=e[t];if(!r){t!=="__v_raw"&&t!=="__v_isRef"&&t!=="__v_isReadonly"&&console.warn("property not found on root doc",t);return}return r==="xml"?n.getXmlFragment(t):r==="text"?n.getText(t):Array.isArray(r)?n.getArray(t):n.getMap(t)}function cte(n,e){if(n[fa])throw new Error("unexpected");ate(e);const t=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===eC)return n;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[sh]){var a;o=(a=s[sh])==null?void 0:a.implicitObserver,n._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))pL(n,e,u);return Reflect.get(n,i)}let c=pL(n,e,i);return c=Zw(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&n.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&n.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(n.share.keys())});return kS.set(n,t),t}Zee(vQ);const eC=Symbol("INTERNAL_SYMBOL");function mL(n,e){const t=zg(n)||n;if(!t)throw new Error("not a valid synced object");return t instanceof _m?(t.on("update",e),()=>{t.off("update",e)}):(t.observeDeep(e),()=>{t.unobserveDeep(e)})}function lte(n){const e=zg(n);if(!(e instanceof _m))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function zg(n){if(typeof n!="object"||n===null)return;const e=n[eC];return e&&(yk(e),e.__v_skip=!0),e}function ute(n,e){if(n===e)return!0;if(typeof n=="object"&&typeof e=="object"){const t=zg(n),r=zg(e);return!t||!r?!1:t===r}return!1}function hte(n,e=new _m){return rte(e),cte(e,n)}function dte(n,e){var t=at.useReducer(function(a){return a+1},0),r=t[1],i=at.useRef(),s=at.useRef(!1);i.current||(i.current=new _k(function(){s.current&&r()}));var o=at.useMemo(function(){var a;return(a=i.current)==null||a.removeObservers(),hy(n,i.current)},[]);return at.useEffect(function(){return s.current=!0,i.current||r(),function(){var a;s.current=!1,(a=i.current)==null||a.removeObservers(),i.current=null}},[]),o}function fte(n,e){if(!zg(n))throw new Error("syncedObject passed to useSyncedStore is not a SyncedStore Store or internal data type.");return dte(n)}const Fk=0,x4=1,w4=2,pte=(n,e)=>{zr(n,Fk);const t=KZ(e);_c(n,t)},C4=(n,e,t)=>{zr(n,x4),_c(n,WZ(e,t))},mte=(n,e,t)=>C4(e,t,$c(n)),R4=(n,e,t)=>{try{jZ(e,$c(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},gte=(n,e)=>{zr(n,w4),_c(n,e)},_te=R4,vte=(n,e,t,r)=>{const i=Vr(n);switch(i){case Fk:mte(n,e,t);break;case x4:R4(n,t,r);break;case w4:_te(n,t,r);break;default:throw new Error("Unknown message type")}return i},Cf=hte({shared:[]});function NE(n,e,t){return n.find(r=>r.key===e&&r.type===t)}function yte(){return fte(Cf)}function A4(n,e){const t=yte(),r=NE(t.shared,n,e);return fe(r)?r:void 0}function Bk(n){return A4(n,0)}function M4(n){return A4(n,1)}function I4(n,e,t){const r=NE(Cf.shared,n,e);fe(r)||Cf.shared.push({key:n,type:e,value:t})}function Ste(n,e){I4(n,0,e)}function k4(n,e){const t=new Zh(e);I4(n,1,t)}function Mg(n,e){const t=NE(Cf.shared,n,0);if(fe(t)){t.value=e;return}Cf.shared.push({key:n,type:0,value:e})}function Ete(n,e){const t=new Zh(e),r=NE(Cf.shared,n,1);if(fe(r)){r.value=t;return}Cf.shared.push({key:n,type:1,value:t})}function O4(n,e,t){let r;function i(){const o=NE(Cf.shared,n,e);fe(o)&&(s(),r=mL(o,()=>t(o.value)))}const s=mL(Cf.shared,i);return i(),()=>r==null?void 0:r()}function bte(n,e){return O4(n,0,e)}function Tte(n,e){return O4(n,1,t=>e(t.toJSON()))}function XT(n){return qh(n)}const wg=lte(Cf),Yd=Nf("modem",["second"],n=>{switch(n.target){case"second":break;case"join":if(n.sender!==Yd.id()){Yd.reply(n,"joinack");const e=Ag();pte(e,wg),Yd.reply(n,"sync",XT(e));const t=Ag();C4(t,wg),Yd.reply(n,"sync",XT(t))}break;case"joinack":n.sender,Yd.id();break;case"sync":{if(n.sender!==Yd.id()&&fe(n.data))try{const e=x_(n.data),t=Ag();vte(e,t,wg,Yd)===Fk&&Yd.emit("modem:sync",XT(t))}catch(e){ti(Yd.name(),"sync",e.message)}break}}});function N4(n){const e=Ag();gte(e,n),Yd.emit("modem:sync",XT(e))}wg.on("update",N4);wg.on("destroy",()=>{wg==null||wg.off("update",N4)});async function xte(n){return RJ(n)}async function wte(n,e){return AJ(n,e)}function Cte(n){try{return sessionStorage.getItem(n)??void 0}catch(e){ti(Go.name(),`readsession ${n}`,e.message)}}function Rte(n,e){try{fe(e)?sessionStorage.setItem(n,e):sessionStorage.removeItem(n)}catch(t){ti(Go.name(),`writesession ${n} <- ${e}`,t.message)}}function P4(){try{const n=location.hash.slice(1);if(n.length)return n}catch(n){ti("register","crash",n.message)}return""}async function fM(n){const e=P4();if(e.length===0){ti(Go.name(),"content","no content found"),r3(Go.name(),ca);return}const t=await Mte()??"";SJ(Go.name(),e,t,n)}let pM=!0;window.addEventListener("hashchange",()=>{du("registoer:hashchange",async()=>{pM?await fM(ca):pM=!0})});function Ate(n){const e=`#${n}`;location.hash!==e&&(pM=!1,location.hash=e,th(Go.name(),`wrote ${(n==null?void 0:n.length)??0} chars [${n.slice(0,8)}...${n.slice(-8)}]`))}async function Mte(){return xte("SELECTED_ID")}async function Ite(n){return wte("SELECTED_ID",()=>n)}let dR=0;const gL=1,ca=Cte("SESSION_ID")??YB();Rte("SESSION_ID",ca);function Fa(){return ca}const Go=Nf("register",["started","second","error"],function(n){switch(n.target){case"ready":{Lr("register","creating platform"),DJ(ID());break}case"started":{du("register:started",async()=>{await Vh(256),Lr("register",`sessionid ${ca}`),rJ("register",ca)});break}case"error:login:main":case"error:login:title":case"error:login:player":n.player===ca&&r3(Go.name(),ca);break;case"ackinit":{du("register:ackinit",async()=>{n.player===ca&&(ID()?(t3(Go.name(),ca),ZB(Go.name(),P4(),n.player)):await fM(n.player))});break}case"ackbooks":n.player===ca&&EJ(Go.name(),n.player);break;case"acklogin":du("register:acklogin",async()=>{if(n.player===ca){const{player:e}=n;await Vh(128),tJ(Go.name(),e),await Vh(512),hk(Go.name(),ca)}});break;case"dev":n.player===ca&&du("register:dev",async function(){if(kJ()){const e=await XA(location.href);JA("devshare",e,e)}else af(Go.name(),"creating locked terminal"),await Vh(100),location.href=location.href.replace("/#","/locked/#")});break;case"share":n.player===ca&&du("register:share",async function(){const e=await XA(location.href.replace(/cafe.*locked/,"cafe"));JA("share",e,e)});break;case"nuke":n.player===ca&&du("register:nuke",async function(){af(Go.name(),"nuke in"),Hr(Go.name(),"3","..."),await Vh(1e3),Hr(Go.name(),"2","..."),await Vh(1e3),Hr(Go.name(),"1","..."),await Vh(1e3),af(Go.name(),"BYE"),await Vh(100),location.hash="",location.reload()});break;case"flush":if(n.player===ca&&ni(n.data)){const[e,t]=n.data;vr(e)&&vr(t)&&(document.title=e,Ate(t))}break;case"select":n.player===ca&&du("register:select",async()=>{vr(n.player)&&vr(n.data)&&(await Ite(n.data),await fM(n.player))});break;case"second":++dR,dR>=gL&&(dR-=gL,TJ(Go.name(),Fa()));break}});setTimeout(()=>iJ(Go.name(),ca),100);function h_(n){"@babel/helpers - typeof";return h_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h_(n)}function pu(){pu=function(){return e};var n,e={},t=Object.prototype,r=t.hasOwnProperty,i=Object.defineProperty||function(Q,ne,G){Q[ne]=G.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(Q,ne,G){return Object.defineProperty(Q,ne,{value:G,enumerable:!0,configurable:!0,writable:!0}),Q[ne]}try{l({},"")}catch{l=function(G,J,re){return G[J]=re}}function u(Q,ne,G,J){var re=ne&&ne.prototype instanceof T?ne:T,ue=Object.create(re.prototype),ye=new K(J||[]);return i(ue,"_invoke",{value:V(Q,G,ye)}),ue}function h(Q,ne,G){try{return{type:"normal",arg:Q.call(ne,G)}}catch(J){return{type:"throw",arg:J}}}e.wrap=u;var d="suspendedStart",p="suspendedYield",_="executing",y="completed",S={};function T(){}function A(){}function R(){}var I={};l(I,o,function(){return this});var U=Object.getPrototypeOf,D=U&&U(U(te([])));D&&D!==t&&r.call(D,o)&&(I=D);var L=R.prototype=T.prototype=Object.create(I);function z(Q){["next","throw","return"].forEach(function(ne){l(Q,ne,function(G){return this._invoke(ne,G)})})}function F(Q,ne){function G(re,ue,ye,Ne){var _e=h(Q[re],Q,ue);if(_e.type!=="throw"){var Ae=_e.arg,Ye=Ae.value;return Ye&&h_(Ye)=="object"&&r.call(Ye,"__await")?ne.resolve(Ye.__await).then(function(Ze){G("next",Ze,ye,Ne)},function(Ze){G("throw",Ze,ye,Ne)}):ne.resolve(Ye).then(function(Ze){Ae.value=Ze,ye(Ae)},function(Ze){return G("throw",Ze,ye,Ne)})}Ne(_e.arg)}var J;i(this,"_invoke",{value:function(ue,ye){function Ne(){return new ne(function(_e,Ae){G(ue,ye,_e,Ae)})}return J=J?J.then(Ne,Ne):Ne()}})}function V(Q,ne,G){var J=d;return function(re,ue){if(J===_)throw Error("Generator is already running");if(J===y){if(re==="throw")throw ue;return{value:n,done:!0}}for(G.method=re,G.arg=ue;;){var ye=G.delegate;if(ye){var Ne=W(ye,G);if(Ne){if(Ne===S)continue;return Ne}}if(G.method==="next")G.sent=G._sent=G.arg;else if(G.method==="throw"){if(J===d)throw J=y,G.arg;G.dispatchException(G.arg)}else G.method==="return"&&G.abrupt("return",G.arg);J=_;var _e=h(Q,ne,G);if(_e.type==="normal"){if(J=G.done?y:p,_e.arg===S)continue;return{value:_e.arg,done:G.done}}_e.type==="throw"&&(J=y,G.method="throw",G.arg=_e.arg)}}}function W(Q,ne){var G=ne.method,J=Q.iterator[G];if(J===n)return ne.delegate=null,G==="throw"&&Q.iterator.return&&(ne.method="return",ne.arg=n,W(Q,ne),ne.method==="throw")||G!=="return"&&(ne.method="throw",ne.arg=new TypeError("The iterator does not provide a '"+G+"' method")),S;var re=h(J,Q.iterator,ne.arg);if(re.type==="throw")return ne.method="throw",ne.arg=re.arg,ne.delegate=null,S;var ue=re.arg;return ue?ue.done?(ne[Q.resultName]=ue.value,ne.next=Q.nextLoc,ne.method!=="return"&&(ne.method="next",ne.arg=n),ne.delegate=null,S):ue:(ne.method="throw",ne.arg=new TypeError("iterator result is not an object"),ne.delegate=null,S)}function X(Q){var ne={tryLoc:Q[0]};1 in Q&&(ne.catchLoc=Q[1]),2 in Q&&(ne.finallyLoc=Q[2],ne.afterLoc=Q[3]),this.tryEntries.push(ne)}function $(Q){var ne=Q.completion||{};ne.type="normal",delete ne.arg,Q.completion=ne}function K(Q){this.tryEntries=[{tryLoc:"root"}],Q.forEach(X,this),this.reset(!0)}function te(Q){if(Q||Q===""){var ne=Q[o];if(ne)return ne.call(Q);if(typeof Q.next=="function")return Q;if(!isNaN(Q.length)){var G=-1,J=function re(){for(;++G<Q.length;)if(r.call(Q,G))return re.value=Q[G],re.done=!1,re;return re.value=n,re.done=!0,re};return J.next=J}}throw new TypeError(h_(Q)+" is not iterable")}return A.prototype=R,i(L,"constructor",{value:R,configurable:!0}),i(R,"constructor",{value:A,configurable:!0}),A.displayName=l(R,c,"GeneratorFunction"),e.isGeneratorFunction=function(Q){var ne=typeof Q=="function"&&Q.constructor;return!!ne&&(ne===A||(ne.displayName||ne.name)==="GeneratorFunction")},e.mark=function(Q){return Object.setPrototypeOf?Object.setPrototypeOf(Q,R):(Q.__proto__=R,l(Q,c,"GeneratorFunction")),Q.prototype=Object.create(L),Q},e.awrap=function(Q){return{__await:Q}},z(F.prototype),l(F.prototype,a,function(){return this}),e.AsyncIterator=F,e.async=function(Q,ne,G,J,re){re===void 0&&(re=Promise);var ue=new F(u(Q,ne,G,J),re);return e.isGeneratorFunction(ne)?ue:ue.next().then(function(ye){return ye.done?ye.value:ue.next()})},z(L),l(L,c,"Generator"),l(L,o,function(){return this}),l(L,"toString",function(){return"[object Generator]"}),e.keys=function(Q){var ne=Object(Q),G=[];for(var J in ne)G.push(J);return G.reverse(),function re(){for(;G.length;){var ue=G.pop();if(ue in ne)return re.value=ue,re.done=!1,re}return re.done=!0,re}},e.values=te,K.prototype={constructor:K,reset:function(ne){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach($),!ne)for(var G in this)G.charAt(0)==="t"&&r.call(this,G)&&!isNaN(+G.slice(1))&&(this[G]=n)},stop:function(){this.done=!0;var ne=this.tryEntries[0].completion;if(ne.type==="throw")throw ne.arg;return this.rval},dispatchException:function(ne){if(this.done)throw ne;var G=this;function J(Ae,Ye){return ye.type="throw",ye.arg=ne,G.next=Ae,Ye&&(G.method="next",G.arg=n),!!Ye}for(var re=this.tryEntries.length-1;re>=0;--re){var ue=this.tryEntries[re],ye=ue.completion;if(ue.tryLoc==="root")return J("end");if(ue.tryLoc<=this.prev){var Ne=r.call(ue,"catchLoc"),_e=r.call(ue,"finallyLoc");if(Ne&&_e){if(this.prev<ue.catchLoc)return J(ue.catchLoc,!0);if(this.prev<ue.finallyLoc)return J(ue.finallyLoc)}else if(Ne){if(this.prev<ue.catchLoc)return J(ue.catchLoc,!0)}else{if(!_e)throw Error("try statement without catch or finally");if(this.prev<ue.finallyLoc)return J(ue.finallyLoc)}}}},abrupt:function(ne,G){for(var J=this.tryEntries.length-1;J>=0;--J){var re=this.tryEntries[J];if(re.tryLoc<=this.prev&&r.call(re,"finallyLoc")&&this.prev<re.finallyLoc){var ue=re;break}}ue&&(ne==="break"||ne==="continue")&&ue.tryLoc<=G&&G<=ue.finallyLoc&&(ue=null);var ye=ue?ue.completion:{};return ye.type=ne,ye.arg=G,ue?(this.method="next",this.next=ue.finallyLoc,S):this.complete(ye)},complete:function(ne,G){if(ne.type==="throw")throw ne.arg;return ne.type==="break"||ne.type==="continue"?this.next=ne.arg:ne.type==="return"?(this.rval=this.arg=ne.arg,this.method="return",this.next="end"):ne.type==="normal"&&G&&(this.next=G),S},finish:function(ne){for(var G=this.tryEntries.length-1;G>=0;--G){var J=this.tryEntries[G];if(J.finallyLoc===ne)return this.complete(J.completion,J.afterLoc),$(J),S}},catch:function(ne){for(var G=this.tryEntries.length-1;G>=0;--G){var J=this.tryEntries[G];if(J.tryLoc===ne){var re=J.completion;if(re.type==="throw"){var ue=re.arg;$(J)}return ue}}throw Error("illegal catch attempt")},delegateYield:function(ne,G,J){return this.delegate={iterator:te(ne),resultName:G,nextLoc:J},this.method==="next"&&(this.arg=n),S}},e}function _L(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function Xv(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){_L(s,r,i,o,a,"next",c)}function a(c){_L(s,r,i,o,a,"throw",c)}o(void 0)})}}function kte(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Ote(n,e){if(h_(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(h_(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function D4(n){var e=Ote(n,"string");return h_(e)=="symbol"?e:e+""}function Nte(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,D4(r.key),r)}}function Pte(n,e,t){return e&&Nte(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function nf(n,e,t){return(e=D4(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const KT={"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-KatjaNeural","de-DE-KillianNeural"],"en-US":["en-US-AriaNeural","en-US-AnaNeural","en-US-ChristopherNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-YunJheNeural","zh-TW-HsiaoYuNeural"]},YT={"ar-SA-HamedNeural":"حامد","ar-SA-ZariyahNeural":"زارية","de-DE-AmalaNeural":"Amala","de-DE-BerndNeural":"Bernd","de-DE-ChristophNeural":"Christoph","de-DE-ConradNeural":"Conrad","de-DE-ElkeNeural":"Elke","de-DE-GiselaNeural":"Gisela","de-DE-KasperNeural":"Kasper","de-DE-KatjaNeural":"Katja","de-DE-KillianNeural":"Killian","de-DE-KlarissaNeural":"Klarissa","de-DE-KlausNeural":"Klaus","de-DE-LouisaNeural":"Louisa","de-DE-MajaNeural":"Maja","de-DE-RalfNeural":"Ralf","de-DE-TanjaNeural":"Tanja","en-US-AIGenerate1Neural":"AIGenerate1","en-US-AIGenerate2Neural":"AIGenerate2","en-US-AmberNeural":"Amber","en-US-AnaNeural":"Ana","en-US-AndrewNeural":"Andrew","en-US-AriaNeural":"Aria","en-US-AshleyNeural":"Ashley","en-US-BlueNeural":"Blue","en-US-BrandonNeural":"Brandon","en-US-BrianNeural":"Brian","en-US-ChristopherNeural":"Christopher","en-US-CoraNeural":"Cora","en-US-DavisNeural":"Davis","en-US-ElizabethNeural":"Elizabeth","en-US-EmmaNeural":"Emma","en-US-EricNeural":"Eric","en-US-GuyNeural":"Guy","en-US-JacobNeural":"Jacob","en-US-JaneNeural":"Jane","en-US-JasonNeural":"Jason","en-US-JennyMultilingualNeural":"Jenny Multilingual","en-US-JennyMultilingualV2Neural":"Jenny Multilingual V2","en-US-JennyNeural":"Jenny","en-US-MichelleNeural":"Michelle","en-US-MonicaNeural":"Monica","en-US-NancyNeural":"Nancy","en-US-RogerNeural":"Roger","en-US-RyanMultilingualNeural":"Ryan Multilingual","en-US-SaraNeural":"Sara","en-US-SteffanNeural":"Steffan","en-US-TonyNeural":"Tony","es-ES-AbrilNeural":"Abril","es-ES-AlvaroNeural":"Álvaro","es-ES-ArnauNeural":"Arnau","es-ES-DarioNeural":"Dario","es-ES-EliasNeural":"Elias","es-ES-ElviraNeural":"Elvira","es-ES-EstrellaNeural":"Estrella","es-ES-IreneNeural":"Irene","es-ES-LaiaNeural":"Laia","es-ES-LiaNeural":"Lia","es-ES-NilNeural":"Nil","es-ES-SaulNeural":"Saul","es-ES-TeoNeural":"Teo","es-ES-TrianaNeural":"Triana","es-ES-VeraNeural":"Vera","fr-FR-AlainNeural":"Alain","fr-FR-BrigitteNeural":"Brigitte","fr-FR-CelesteNeural":"Celeste","fr-FR-ClaudeNeural":"Claude","fr-FR-CoralieNeural":"Coralie","fr-FR-DeniseNeural":"Denise","fr-FR-EloiseNeural":"Eloise","fr-FR-HenriNeural":"Henri","fr-FR-JacquelineNeural":"Jacqueline","fr-FR-JeromeNeural":"Jerome","fr-FR-JosephineNeural":"Josephine","fr-FR-MauriceNeural":"Maurice","fr-FR-YvesNeural":"Yves","fr-FR-YvetteNeural":"Yvette","ja-JP-AoiNeural":"碧衣","ja-JP-DaichiNeural":"大智","ja-JP-KeitaNeural":"圭太","ja-JP-MayuNeural":"真夕","ja-JP-NanamiNeural":"七海","ja-JP-NaokiNeural":"直紀","ja-JP-ShioriNeural":"志織","ko-KR-BongJinNeural":"봉진","ko-KR-GookMinNeural":"국민","ko-KR-InJoonNeural":"인준","ko-KR-JiMinNeural":"지민","ko-KR-SeoHyeonNeural":"서현","ko-KR-SoonBokNeural":"순복","ko-KR-SunHiNeural":"선히","ko-KR-YuJinNeural":"유진","pt-BR-AntonioNeural":"Antônio","pt-BR-BrendaNeural":"Brenda","pt-BR-DonatoNeural":"Donato","pt-BR-ElzaNeural":"Elza","pt-BR-FabioNeural":"Fabio","pt-BR-FranciscaNeural":"Francisca","pt-BR-GiovannaNeural":"Giovanna","pt-BR-HumbertoNeural":"Humberto","pt-BR-JulioNeural":"Julio","pt-BR-LeilaNeural":"Leila","pt-BR-LeticiaNeural":"Leticia","pt-BR-ManuelaNeural":"Manuela","pt-BR-NicolauNeural":"Nicolau","pt-BR-ValerioNeural":"Valerio","pt-BR-YaraNeural":"Yara","ru-RU-DariyaNeural":"Дария","ru-RU-DmitryNeural":"Дмитрий","ru-RU-SvetlanaNeural":"Светлана","wuu-CN-XiaotongNeural":"晓彤","wuu-CN-YunzheNeural":"云哲","yue-CN-XiaoMinNeural":"晓敏","yue-CN-YunSongNeural":"云松","zh-CN-XiaochenNeural":"晓辰","zh-CN-XiaohanNeural":"晓涵","zh-CN-XiaomengNeural":"晓梦","zh-CN-XiaomoNeural":"晓墨","zh-CN-XiaoqiuNeural":"晓秋","zh-CN-XiaorouNeural":"晓柔","zh-CN-XiaoruiNeural":"晓睿","zh-CN-XiaoshuangNeural":"晓双","zh-CN-XiaoxiaoNeural":"晓晓","zh-CN-XiaoxuanNeural":"晓萱","zh-CN-XiaoyanNeural":"晓颜","zh-CN-XiaoyiNeural":"晓伊","zh-CN-XiaoyouNeural":"晓悠","zh-CN-XiaozhenNeural":"晓甄","zh-CN-YunfengNeural":"云枫","zh-CN-YunhaoNeural":"云皓","zh-CN-YunjianNeural":"云健","zh-CN-YunjieNeural":"云杰","zh-CN-YunxiNeural":"云希","zh-CN-YunxiaNeural":"云夏","zh-CN-YunyangNeural":"云扬","zh-CN-YunyeNeural":"云野","zh-CN-YunzeNeural":"云泽","zh-CN-guangxi-YunqiNeural":"云奇","zh-CN-henan-YundengNeural":"云登","zh-CN-liaoning-XiaobeiNeural":"晓北","zh-CN-liaoning-YunbiaoNeural":"云彪","zh-CN-shaanxi-XiaoniNeural":"晓妮","zh-CN-shandong-YunxiangNeural":"云翔","zh-CN-sichuan-YunxiNeural":"云希","zh-TW-HsiaoChenNeural":"曉臻","zh-TW-HsiaoYuNeural":"曉雨","zh-TW-YunJheNeural":"雲哲"};var Dte=function(){var n=Xv(pu().mark(function e(t){var r;return pu().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=new AudioContext,s.next=3,r.decodeAudioData(t);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},e)}));return function(t){return n.apply(this,arguments)}}();function Lte(n){if(Array.isArray(n))return n}function Ute(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function vL(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function L4(n,e){if(n){if(typeof n=="string")return vL(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?vL(n,e):void 0}}function Fte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zk(n,e){return Lte(n)||Ute(n,e)||L4(n,e)||Fte()}const Bte={"ar-SA":"العربية","de-DE":"Deutsch","en-US":"English","es-ES":"Español","fr-FR":"Français","ja-JP":"日本語","ko-KR":"한국어","pt-BR":"Português","ru-RU":"Русский","zh-CN":"简体中文","zh-TW":"繁體中文"};var zte=function(){return Object.entries(Bte).map(function(e){var t=zk(e,2),r=t[0],i=t[1];return{label:i,value:r}})};const U4="%[a-f0-9]{2}",yL=new RegExp("("+U4+")|([^%]+?)","gi"),SL=new RegExp("("+U4+")+","gi");function mM(n,e){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;e=e||1;const t=n.slice(0,e),r=n.slice(e);return Array.prototype.concat.call([],mM(t),mM(r))}function Vte(n){try{return decodeURIComponent(n)}catch{let e=n.match(yL)||[];for(let t=1;t<e.length;t++)n=mM(e,t).join(""),e=n.match(yL)||[];return n}}function jte(n){const e={"%FE%FF":"��","%FF%FE":"��"};let t=SL.exec(n);for(;t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{const i=Vte(t[0]);i!==t[0]&&(e[t[0]]=i)}t=SL.exec(n)}e["%C2"]="�";const r=Object.keys(e);for(const i of r)n=n.replace(new RegExp(i,"g"),e[i]);return n}function Hte(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return decodeURIComponent(n)}catch{return jte(n)}}function Gte(n,e){const t={};if(Array.isArray(e))for(const r of e){const i=Object.getOwnPropertyDescriptor(n,r);i!=null&&i.enumerable&&Object.defineProperty(t,r,i)}else for(const r of Reflect.ownKeys(n)){const i=Object.getOwnPropertyDescriptor(n,r);if(i.enumerable){const s=n[r];e(r,s,n)&&Object.defineProperty(t,r,i)}}return t}function F4(n,e){if(!(typeof n=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(n===""||e==="")return[];const t=n.indexOf(e);return t===-1?[]:[n.slice(0,t),n.slice(t+e.length)]}const Wte=n=>n==null,$te=n=>encodeURIComponent(n).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),gM=Symbol("encodeFragmentIdentifier");function qte(n){switch(n.arrayFormat){case"index":return e=>(t,r)=>{const i=t.length;return r===void 0||n.skipNull&&r===null||n.skipEmptyString&&r===""?t:r===null?[...t,[Vo(e,n),"[",i,"]"].join("")]:[...t,[Vo(e,n),"[",Vo(i,n),"]=",Vo(r,n)].join("")]};case"bracket":return e=>(t,r)=>r===void 0||n.skipNull&&r===null||n.skipEmptyString&&r===""?t:r===null?[...t,[Vo(e,n),"[]"].join("")]:[...t,[Vo(e,n),"[]=",Vo(r,n)].join("")];case"colon-list-separator":return e=>(t,r)=>r===void 0||n.skipNull&&r===null||n.skipEmptyString&&r===""?t:r===null?[...t,[Vo(e,n),":list="].join("")]:[...t,[Vo(e,n),":list=",Vo(r,n)].join("")];case"comma":case"separator":case"bracket-separator":{const e=n.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(r,i)=>i===void 0||n.skipNull&&i===null||n.skipEmptyString&&i===""?r:(i=i===null?"":i,r.length===0?[[Vo(t,n),e,Vo(i,n)].join("")]:[[r,Vo(i,n)].join(n.arrayFormatSeparator)])}default:return e=>(t,r)=>r===void 0||n.skipNull&&r===null||n.skipEmptyString&&r===""?t:r===null?[...t,Vo(e,n)]:[...t,[Vo(e,n),"=",Vo(r,n)].join("")]}}function Xte(n){let e;switch(n.arrayFormat){case"index":return(t,r,i)=>{if(e=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!e){i[t]=r;return}i[t]===void 0&&(i[t]={}),i[t][e[1]]=r};case"bracket":return(t,r,i)=>{if(e=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!e){i[t]=r;return}if(i[t]===void 0){i[t]=[r];return}i[t]=[...i[t],r]};case"colon-list-separator":return(t,r,i)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){i[t]=r;return}if(i[t]===void 0){i[t]=[r];return}i[t]=[...i[t],r]};case"comma":case"separator":return(t,r,i)=>{const s=typeof r=="string"&&r.includes(n.arrayFormatSeparator),o=typeof r=="string"&&!s&&Kp(r,n).includes(n.arrayFormatSeparator);r=o?Kp(r,n):r;const a=s||o?r.split(n.arrayFormatSeparator).map(c=>Kp(c,n)):r===null?r:Kp(r,n);i[t]=a};case"bracket-separator":return(t,r,i)=>{const s=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!s){i[t]=r&&Kp(r,n);return}const o=r===null?[]:Kp(r,n).split(n.arrayFormatSeparator);if(i[t]===void 0){i[t]=o;return}i[t]=[...i[t],...o]};default:return(t,r,i)=>{if(i[t]===void 0){i[t]=r;return}i[t]=[...[i[t]].flat(),r]}}}function B4(n){if(typeof n!="string"||n.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function Vo(n,e){return e.encode?e.strict?$te(n):encodeURIComponent(n):n}function Kp(n,e){return e.decode?Hte(n):n}function z4(n){return Array.isArray(n)?n.sort():typeof n=="object"?z4(Object.keys(n)).sort((e,t)=>Number(e)-Number(t)).map(e=>n[e]):n}function V4(n){const e=n.indexOf("#");return e!==-1&&(n=n.slice(0,e)),n}function Kte(n){let e="";const t=n.indexOf("#");return t!==-1&&(e=n.slice(t)),e}function EL(n,e,t){return t==="string"&&typeof n=="string"?n:typeof t=="function"&&typeof n=="string"?t(n):e.parseBooleans&&n!==null&&(n.toLowerCase()==="true"||n.toLowerCase()==="false")?n.toLowerCase()==="true":t==="number"&&!Number.isNaN(Number(n))&&typeof n=="string"&&n.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(n))&&typeof n=="string"&&n.trim()!==""?Number(n):n}function Vk(n){n=V4(n);const e=n.indexOf("?");return e===-1?"":n.slice(e+1)}function jk(n,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...e},B4(e.arrayFormatSeparator);const t=Xte(e),r=Object.create(null);if(typeof n!="string"||(n=n.trim().replace(/^[?#&]/,""),!n))return r;for(const i of n.split("&")){if(i==="")continue;const s=e.decode?i.replaceAll("+"," "):i;let[o,a]=F4(s,"=");o===void 0&&(o=s),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:Kp(a,e),t(Kp(o,e),a,r)}for(const[i,s]of Object.entries(r))if(typeof s=="object"&&s!==null&&e.types[i]!=="string")for(const[o,a]of Object.entries(s)){const c=e.types[i]?e.types[i].replace("[]",""):void 0;s[o]=EL(a,e,c)}else typeof s=="object"&&s!==null&&e.types[i]==="string"?r[i]=Object.values(s).join(e.arrayFormatSeparator):r[i]=EL(s,e,e.types[i]);return e.sort===!1?r:(e.sort===!0?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce((i,s)=>{const o=r[s];return i[s]=o&&typeof o=="object"&&!Array.isArray(o)?z4(o):o,i},Object.create(null))}function j4(n,e){if(!n)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},B4(e.arrayFormatSeparator);const t=o=>e.skipNull&&Wte(n[o])||e.skipEmptyString&&n[o]==="",r=qte(e),i={};for(const[o,a]of Object.entries(n))t(o)||(i[o]=a);const s=Object.keys(i);return e.sort!==!1&&s.sort(e.sort),s.map(o=>{const a=n[o];return a===void 0?"":a===null?Vo(o,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?Vo(o,e)+"[]":a.reduce(r(o),[]).join("&"):Vo(o,e)+"="+Vo(a,e)}).filter(o=>o.length>0).join("&")}function H4(n,e){var i;e={decode:!0,...e};let[t,r]=F4(n,"#");return t===void 0&&(t=n),{url:((i=t==null?void 0:t.split("?"))==null?void 0:i[0])??"",query:jk(Vk(n),e),...e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:Kp(r,e)}:{}}}function G4(n,e){e={encode:!0,strict:!0,[gM]:!0,...e};const t=V4(n.url).split("?")[0]||"",r=Vk(n.url),i={...jk(r,{sort:!1}),...n.query};let s=j4(i,e);s&&(s=`?${s}`);let o=Kte(n.url);if(typeof n.fragmentIdentifier=="string"){const a=new URL(t);a.hash=n.fragmentIdentifier,o=e[gM]?a.hash:`#${n.fragmentIdentifier}`}return`${t}${s}${o}`}function W4(n,e,t){t={parseFragmentIdentifier:!0,[gM]:!1,...t};const{url:r,query:i,fragmentIdentifier:s}=H4(n,t);return G4({url:r,query:Gte(i,e),fragmentIdentifier:s},t)}function Yte(n,e,t){const r=Array.isArray(e)?i=>!e.includes(i):(i,s)=>!e(i,s);return W4(n,r,t)}const Jte=Object.freeze(Object.defineProperty({__proto__:null,exclude:Yte,extract:Vk,parse:jk,parseUrl:H4,pick:W4,stringify:j4,stringifyUrl:G4},Symbol.toStringTag,{value:"Module"}));var tc=[];for(var fR=0;fR<256;++fR)tc.push((fR+256).toString(16).slice(1));function Qte(n,e=0){return(tc[n[e+0]]+tc[n[e+1]]+tc[n[e+2]]+tc[n[e+3]]+"-"+tc[n[e+4]]+tc[n[e+5]]+"-"+tc[n[e+6]]+tc[n[e+7]]+"-"+tc[n[e+8]]+tc[n[e+9]]+"-"+tc[n[e+10]]+tc[n[e+11]]+tc[n[e+12]]+tc[n[e+13]]+tc[n[e+14]]+tc[n[e+15]]).toLowerCase()}var oT,Zte=new Uint8Array(16);function ene(){if(!oT&&(oT=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oT))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oT(Zte)}var tne=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const bL={randomUUID:tne};function nne(n,e,t){if(bL.randomUUID&&!e&&!n)return bL.randomUUID();n=n||{};var r=n.random||(n.rng||ene)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Qte(r)}var rne=function(e,t){var r=t.voice;return'<voice name="'.concat(r,'">').concat(e,"</voice>")},ine=function(e,t){var r=t.style;return r?'<mstts:express-as style="'.concat(r,'">').concat(e,"</mstts:express-as>"):e},sne=function(e,t){var r=t.pitch,i=t.rate;return!r&&!i?e:'<prosody pitch="'.concat(Math.floor((r||1)*100),'%" rate="').concat(Math.floor((i||1)*100),'%">').concat(e,"</prosody>")},one=function(e){return'<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="en-US">'.concat(e,"</speak>")},ane=function(e,t){var r=sne(e,t);return r=ine(r,t),r=rne(r,t),r=one(r),r},TL=function(e,t){for(var r=[],i=0,s=Object.entries(e);i<s.length;i++){var o=zk(s[i],2),a=o[0],c=o[1];r.push("".concat(a,":").concat(c))}return r.push("",t),r.join(`\r
`)};function cne(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=L4(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{o||t.return==null||t.return()}finally{if(a)throw s}}}}var lne=function(e){var t={},r=cne(e.slice(0,e.indexOf(`\r
\r
`)).split(`\r
`)),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=s.split(":",2),a=zk(o,2),c=a[0],l=a[1];t[c]=l}}catch(u){r.e(u)}finally{r.f()}return{data:e.slice(e.indexOf(`\r
\r
`)+4),headers:t}},une="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",hne="6A5AA1D4EAFF4E9FB37E23D68491D6F4",dne=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),fne=function(e){var t=new Date().toString(),r={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":t},i={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":e,"X-Timestamp":t};return{configHeader:r,contentHeader:i}},$4=function(){var n=Xv(pu().mark(function e(t){var r,i,s,o,a,c,l,u,h,d,p,_,y,S=arguments;return pu().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return r=t.payload,i=S.length>1&&S[1]!==void 0?S[1]:{},s=i.proxyUrl,o=i.token,a=r.input,c=r.options,l=nne().replaceAll("-",""),u=Jte.stringifyUrl({query:{ConnectionId:l,TrustedClientToken:o||hne},url:s||une}),h=fne(l),d=h.configHeader,p=h.contentHeader,_=TL(d,dne),y=TL(p,ane(a,c)),A.abrupt("return",new Promise(function(R,I){var U=new WebSocket(u);U.binaryType="arraybuffer";var D=function(){U.send(_),U.send(y)},L=new ArrayBuffer(0),z=function(){var V=Xv(pu().mark(function W(X){var $,K,te,Q,ne,G,J,re;return pu().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(typeof X.data!="string"){ye.next=13;break}$=lne(X.data),K=$.headers,ye.t0=K.Path,ye.next=ye.t0==="turn.end"?5:11;break;case 5:if(U.close(),L.byteLength){ye.next=8;break}return ye.abrupt("return");case 8:return te=new Response(L),R(te),ye.abrupt("break",11);case 11:ye.next=14;break;case 13:X.data instanceof ArrayBuffer&&(Q=new DataView(X.data),ne=Q.getInt16(0),X.data.byteLength>ne+2&&(G=X.data.slice(2+ne),J=new ArrayBuffer(L.byteLength+G.byteLength),re=new Uint8Array(J),re.set(new Uint8Array(L),0),re.set(new Uint8Array(G),L.byteLength),L=J));case 14:case"end":return ye.stop()}},W)}));return function(X){return V.apply(this,arguments)}}(),F=function(){I(new Error("WebSocket error occurred.")),U.close()};U.addEventListener("open",D),U.addEventListener("message",z),U.addEventListener("error",F)}));case 9:case"end":return A.stop()}},e)}));return function(t){return n.apply(this,arguments)}}(),q4=typeof global=="object"&&global&&global.Object===Object&&global,pne=typeof self=="object"&&self&&self.Object===Object&&self,Pf=q4||pne||Function("return this")(),oh=Pf.Symbol,X4=Object.prototype,mne=X4.hasOwnProperty,gne=X4.toString,oS=oh?oh.toStringTag:void 0;function _ne(n){var e=mne.call(n,oS),t=n[oS];try{n[oS]=void 0;var r=!0}catch{}var i=gne.call(n);return r&&(e?n[oS]=t:delete n[oS]),i}var vne=Object.prototype,yne=vne.toString;function Sne(n){return yne.call(n)}var Ene="[object Null]",bne="[object Undefined]",xL=oh?oh.toStringTag:void 0;function Yg(n){return n==null?n===void 0?bne:Ene:xL&&xL in Object(n)?_ne(n):Sne(n)}function ed(n){return n!=null&&typeof n=="object"}var Tne="[object Symbol]";function tC(n){return typeof n=="symbol"||ed(n)&&Yg(n)==Tne}function nC(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}var gi=Array.isArray,xne=1/0,wL=oh?oh.prototype:void 0,CL=wL?wL.toString:void 0;function K4(n){if(typeof n=="string")return n;if(gi(n))return nC(n,K4)+"";if(tC(n))return CL?CL.call(n):"";var e=n+"";return e=="0"&&1/n==-xne?"-0":e}var wne=/\s/;function Cne(n){for(var e=n.length;e--&&wne.test(n.charAt(e)););return e}var Rne=/^\s+/;function Ane(n){return n&&n.slice(0,Cne(n)+1).replace(Rne,"")}function ah(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var RL=NaN,Mne=/^[-+]0x[0-9a-f]+$/i,Ine=/^0b[01]+$/i,kne=/^0o[0-7]+$/i,One=parseInt;function Nne(n){if(typeof n=="number")return n;if(tC(n))return RL;if(ah(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=ah(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=Ane(n);var t=Ine.test(n);return t||kne.test(n)?One(n.slice(2),t?2:8):Mne.test(n)?RL:+n}var AL=1/0,Pne=17976931348623157e292;function Dne(n){if(!n)return n===0?n:0;if(n=Nne(n),n===AL||n===-AL){var e=n<0?-1:1;return e*Pne}return n===n?n:0}function rC(n){var e=Dne(n),t=e%1;return e===e?t?e-t:e:0}function gy(n){return n}var Lne="[object AsyncFunction]",Une="[object Function]",Fne="[object GeneratorFunction]",Bne="[object Proxy]";function ym(n){if(!ah(n))return!1;var e=Yg(n);return e==Une||e==Fne||e==Lne||e==Bne}var pR=Pf["__core-js_shared__"],ML=function(){var n=/[^.]+$/.exec(pR&&pR.keys&&pR.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function zne(n){return!!ML&&ML in n}var Vne=Function.prototype,jne=Vne.toString;function C_(n){if(n!=null){try{return jne.call(n)}catch{}try{return n+""}catch{}}return""}var Hne=/[\\^$.*+?()[\]{}|]/g,Gne=/^\[object .+?Constructor\]$/,Wne=Function.prototype,$ne=Object.prototype,qne=Wne.toString,Xne=$ne.hasOwnProperty,Kne=RegExp("^"+qne.call(Xne).replace(Hne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Yne(n){if(!ah(n)||zne(n))return!1;var e=ym(n)?Kne:Gne;return e.test(C_(n))}function Jne(n,e){return n==null?void 0:n[e]}function R_(n,e){var t=Jne(n,e);return Yne(t)?t:void 0}var _M=R_(Pf,"WeakMap"),IL=Object.create,Qne=function(){function n(){}return function(e){if(!ah(e))return{};if(IL)return IL(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}();function Zne(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function oa(){}function ere(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var tre=800,nre=16,rre=Date.now;function ire(n){var e=0,t=0;return function(){var r=rre(),i=nre-(r-t);if(t=r,i>0){if(++e>=tre)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function sre(n){return function(){return n}}var Fx=function(){try{var n=R_(Object,"defineProperty");return n({},"",{}),n}catch{}}(),ore=Fx?function(n,e){return Fx(n,"toString",{configurable:!0,enumerable:!1,value:sre(e),writable:!0})}:gy,are=ire(ore);function Y4(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}function J4(n,e,t,r){for(var i=n.length,s=t+-1;++s<i;)if(e(n[s],s,n))return s;return-1}function cre(n){return n!==n}function lre(n,e,t){for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function Hk(n,e,t){return e===e?lre(n,e,t):J4(n,cre,t)}function Q4(n,e){var t=n==null?0:n.length;return!!t&&Hk(n,e,0)>-1}var ure=9007199254740991,hre=/^(?:0|[1-9]\d*)$/;function iC(n,e){var t=typeof n;return e=e??ure,!!e&&(t=="number"||t!="symbol"&&hre.test(n))&&n>-1&&n%1==0&&n<e}function Gk(n,e,t){e=="__proto__"&&Fx?Fx(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function PE(n,e){return n===e||n!==n&&e!==e}var dre=Object.prototype,fre=dre.hasOwnProperty;function sC(n,e,t){var r=n[e];(!(fre.call(n,e)&&PE(r,t))||t===void 0&&!(e in n))&&Gk(n,e,t)}function Wk(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=n[a]),i?Gk(t,a,c):sC(t,a,c)}return t}var kL=Math.max;function pre(n,e,t){return e=kL(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=kL(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),Zne(n,this,a)}}function $k(n,e){return are(pre(n,e,gy),n+"")}var mre=9007199254740991;function qk(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=mre}function Df(n){return n!=null&&qk(n.length)&&!ym(n)}function Z4(n,e,t){if(!ah(t))return!1;var r=typeof e;return(r=="number"?Df(t)&&iC(e,t.length):r=="string"&&e in t)?PE(t[e],n):!1}function gre(n){return $k(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&Z4(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var _re=Object.prototype;function DE(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||_re;return n===t}function vre(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var yre="[object Arguments]";function OL(n){return ed(n)&&Yg(n)==yre}var e5=Object.prototype,Sre=e5.hasOwnProperty,Ere=e5.propertyIsEnumerable,oC=OL(function(){return arguments}())?OL:function(n){return ed(n)&&Sre.call(n,"callee")&&!Ere.call(n,"callee")};function bre(){return!1}var t5=typeof yu=="object"&&yu&&!yu.nodeType&&yu,NL=t5&&typeof Su=="object"&&Su&&!Su.nodeType&&Su,Tre=NL&&NL.exports===t5,PL=Tre?Pf.Buffer:void 0,xre=PL?PL.isBuffer:void 0,eE=xre||bre,wre="[object Arguments]",Cre="[object Array]",Rre="[object Boolean]",Are="[object Date]",Mre="[object Error]",Ire="[object Function]",kre="[object Map]",Ore="[object Number]",Nre="[object Object]",Pre="[object RegExp]",Dre="[object Set]",Lre="[object String]",Ure="[object WeakMap]",Fre="[object ArrayBuffer]",Bre="[object DataView]",zre="[object Float32Array]",Vre="[object Float64Array]",jre="[object Int8Array]",Hre="[object Int16Array]",Gre="[object Int32Array]",Wre="[object Uint8Array]",$re="[object Uint8ClampedArray]",qre="[object Uint16Array]",Xre="[object Uint32Array]",bs={};bs[zre]=bs[Vre]=bs[jre]=bs[Hre]=bs[Gre]=bs[Wre]=bs[$re]=bs[qre]=bs[Xre]=!0;bs[wre]=bs[Cre]=bs[Fre]=bs[Rre]=bs[Bre]=bs[Are]=bs[Mre]=bs[Ire]=bs[kre]=bs[Ore]=bs[Nre]=bs[Pre]=bs[Dre]=bs[Lre]=bs[Ure]=!1;function Kre(n){return ed(n)&&qk(n.length)&&!!bs[Yg(n)]}function aC(n){return function(e){return n(e)}}var n5=typeof yu=="object"&&yu&&!yu.nodeType&&yu,OS=n5&&typeof Su=="object"&&Su&&!Su.nodeType&&Su,Yre=OS&&OS.exports===n5,mR=Yre&&q4.process,Vg=function(){try{var n=OS&&OS.require&&OS.require("util").types;return n||mR&&mR.binding&&mR.binding("util")}catch{}}(),DL=Vg&&Vg.isTypedArray,Xk=DL?aC(DL):Kre,Jre=Object.prototype,Qre=Jre.hasOwnProperty;function r5(n,e){var t=gi(n),r=!t&&oC(n),i=!t&&!r&&eE(n),s=!t&&!r&&!i&&Xk(n),o=t||r||i||s,a=o?vre(n.length,String):[],c=a.length;for(var l in n)(e||Qre.call(n,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||iC(l,c)))&&a.push(l);return a}function i5(n,e){return function(t){return n(e(t))}}var Zre=i5(Object.keys,Object),eie=Object.prototype,tie=eie.hasOwnProperty;function s5(n){if(!DE(n))return Zre(n);var e=[];for(var t in Object(n))tie.call(n,t)&&t!="constructor"&&e.push(t);return e}function ch(n){return Df(n)?r5(n):s5(n)}var nie=Object.prototype,rie=nie.hasOwnProperty,Ul=gre(function(n,e){if(DE(e)||Df(e)){Wk(e,ch(e),n);return}for(var t in e)rie.call(e,t)&&sC(n,t,e[t])});function iie(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var sie=Object.prototype,oie=sie.hasOwnProperty;function aie(n){if(!ah(n))return iie(n);var e=DE(n),t=[];for(var r in n)r=="constructor"&&(e||!oie.call(n,r))||t.push(r);return t}function o5(n){return Df(n)?r5(n,!0):aie(n)}var cie=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lie=/^\w*$/;function Kk(n,e){if(gi(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||tC(n)?!0:lie.test(n)||!cie.test(n)||e!=null&&n in Object(e)}var tE=R_(Object,"create");function uie(){this.__data__=tE?tE(null):{},this.size=0}function hie(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var die="__lodash_hash_undefined__",fie=Object.prototype,pie=fie.hasOwnProperty;function mie(n){var e=this.__data__;if(tE){var t=e[n];return t===die?void 0:t}return pie.call(e,n)?e[n]:void 0}var gie=Object.prototype,_ie=gie.hasOwnProperty;function vie(n){var e=this.__data__;return tE?e[n]!==void 0:_ie.call(e,n)}var yie="__lodash_hash_undefined__";function Sie(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=tE&&e===void 0?yie:e,this}function d_(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}d_.prototype.clear=uie;d_.prototype.delete=hie;d_.prototype.get=mie;d_.prototype.has=vie;d_.prototype.set=Sie;function Eie(){this.__data__=[],this.size=0}function cC(n,e){for(var t=n.length;t--;)if(PE(n[t][0],e))return t;return-1}var bie=Array.prototype,Tie=bie.splice;function xie(n){var e=this.__data__,t=cC(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():Tie.call(e,t,1),--this.size,!0}function wie(n){var e=this.__data__,t=cC(e,n);return t<0?void 0:e[t][1]}function Cie(n){return cC(this.__data__,n)>-1}function Rie(n,e){var t=this.__data__,r=cC(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function Sm(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Sm.prototype.clear=Eie;Sm.prototype.delete=xie;Sm.prototype.get=wie;Sm.prototype.has=Cie;Sm.prototype.set=Rie;var nE=R_(Pf,"Map");function Aie(){this.size=0,this.__data__={hash:new d_,map:new(nE||Sm),string:new d_}}function Mie(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function lC(n,e){var t=n.__data__;return Mie(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Iie(n){var e=lC(this,n).delete(n);return this.size-=e?1:0,e}function kie(n){return lC(this,n).get(n)}function Oie(n){return lC(this,n).has(n)}function Nie(n,e){var t=lC(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function Em(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Em.prototype.clear=Aie;Em.prototype.delete=Iie;Em.prototype.get=kie;Em.prototype.has=Oie;Em.prototype.set=Nie;var Pie="Expected a function";function Yk(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(Pie);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=t.cache;if(s.has(i))return s.get(i);var o=n.apply(this,r);return t.cache=s.set(i,o)||s,o};return t.cache=new(Yk.Cache||Em),t}Yk.Cache=Em;var Die=500;function Lie(n){var e=Yk(n,function(r){return t.size===Die&&t.clear(),r}),t=e.cache;return e}var Uie=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fie=/\\(\\)?/g,Bie=Lie(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(Uie,function(t,r,i,s){e.push(i?s.replace(Fie,"$1"):r||t)}),e});function a5(n){return n==null?"":K4(n)}function uC(n,e){return gi(n)?n:Kk(n,e)?[n]:Bie(a5(n))}var zie=1/0;function LE(n){if(typeof n=="string"||tC(n))return n;var e=n+"";return e=="0"&&1/n==-zie?"-0":e}function Jk(n,e){e=uC(e,n);for(var t=0,r=e.length;n!=null&&t<r;)n=n[LE(e[t++])];return t&&t==r?n:void 0}function Vie(n,e,t){var r=n==null?void 0:Jk(n,e);return r===void 0?t:r}function Qk(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var LL=oh?oh.isConcatSpreadable:void 0;function jie(n){return gi(n)||oC(n)||!!(LL&&n&&n[LL])}function Zk(n,e,t,r,i){var s=-1,o=n.length;for(t||(t=jie),i||(i=[]);++s<o;){var a=n[s];t(a)?Qk(i,a):r||(i[i.length]=a)}return i}function Pl(n){var e=n==null?0:n.length;return e?Zk(n):[]}var c5=i5(Object.getPrototypeOf,Object);function eO(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Hie(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:eO(n,e,t)}var Gie="\\ud800-\\udfff",Wie="\\u0300-\\u036f",$ie="\\ufe20-\\ufe2f",qie="\\u20d0-\\u20ff",Xie=Wie+$ie+qie,Kie="\\ufe0e\\ufe0f",Yie="\\u200d",Jie=RegExp("["+Yie+Gie+Xie+Kie+"]");function l5(n){return Jie.test(n)}function Qie(n){return n.split("")}var u5="\\ud800-\\udfff",Zie="\\u0300-\\u036f",ese="\\ufe20-\\ufe2f",tse="\\u20d0-\\u20ff",nse=Zie+ese+tse,rse="\\ufe0e\\ufe0f",ise="["+u5+"]",vM="["+nse+"]",yM="\\ud83c[\\udffb-\\udfff]",sse="(?:"+vM+"|"+yM+")",h5="[^"+u5+"]",d5="(?:\\ud83c[\\udde6-\\uddff]){2}",f5="[\\ud800-\\udbff][\\udc00-\\udfff]",ose="\\u200d",p5=sse+"?",m5="["+rse+"]?",ase="(?:"+ose+"(?:"+[h5,d5,f5].join("|")+")"+m5+p5+")*",cse=m5+p5+ase,lse="(?:"+[h5+vM+"?",vM,d5,f5,ise].join("|")+")",use=RegExp(yM+"(?="+yM+")|"+lse+cse,"g");function hse(n){return n.match(use)||[]}function dse(n){return l5(n)?hse(n):Qie(n)}function fse(n){return function(e){e=a5(e);var t=l5(e)?dse(e):void 0,r=t?t[0]:e.charAt(0),i=t?Hie(t,1).join(""):e.slice(1);return r[n]()+i}}var g5=fse("toUpperCase");function pse(n,e,t,r){var i=-1,s=n==null?0:n.length;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function mse(){this.__data__=new Sm,this.size=0}function gse(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function _se(n){return this.__data__.get(n)}function vse(n){return this.__data__.has(n)}var yse=200;function Sse(n,e){var t=this.__data__;if(t instanceof Sm){var r=t.__data__;if(!nE||r.length<yse-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new Em(r)}return t.set(n,e),this.size=t.size,this}function vf(n){var e=this.__data__=new Sm(n);this.size=e.size}vf.prototype.clear=mse;vf.prototype.delete=gse;vf.prototype.get=_se;vf.prototype.has=vse;vf.prototype.set=Sse;function Ese(n,e){return n&&Wk(e,ch(e),n)}var _5=typeof yu=="object"&&yu&&!yu.nodeType&&yu,UL=_5&&typeof Su=="object"&&Su&&!Su.nodeType&&Su,bse=UL&&UL.exports===_5,FL=bse?Pf.Buffer:void 0,BL=FL?FL.allocUnsafe:void 0;function Tse(n,e){var t=n.length,r=BL?BL(t):new n.constructor(t);return n.copy(r),r}function tO(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}function v5(){return[]}var xse=Object.prototype,wse=xse.propertyIsEnumerable,zL=Object.getOwnPropertySymbols,nO=zL?function(n){return n==null?[]:(n=Object(n),tO(zL(n),function(e){return wse.call(n,e)}))}:v5;function Cse(n,e){return Wk(n,nO(n),e)}var Rse=Object.getOwnPropertySymbols,Ase=Rse?function(n){for(var e=[];n;)Qk(e,nO(n)),n=c5(n);return e}:v5;function y5(n,e,t){var r=e(n);return gi(n)?r:Qk(r,t(n))}function SM(n){return y5(n,ch,nO)}function Mse(n){return y5(n,o5,Ase)}var EM=R_(Pf,"DataView"),bM=R_(Pf,"Promise"),Kv=R_(Pf,"Set"),VL="[object Map]",Ise="[object Object]",jL="[object Promise]",HL="[object Set]",GL="[object WeakMap]",WL="[object DataView]",kse=C_(EM),Ose=C_(nE),Nse=C_(bM),Pse=C_(Kv),Dse=C_(_M),qu=Yg;(EM&&qu(new EM(new ArrayBuffer(1)))!=WL||nE&&qu(new nE)!=VL||bM&&qu(bM.resolve())!=jL||Kv&&qu(new Kv)!=HL||_M&&qu(new _M)!=GL)&&(qu=function(n){var e=Yg(n),t=e==Ise?n.constructor:void 0,r=t?C_(t):"";if(r)switch(r){case kse:return WL;case Ose:return VL;case Nse:return jL;case Pse:return HL;case Dse:return GL}return e});var Lse=Object.prototype,Use=Lse.hasOwnProperty;function Fse(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&Use.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var Bx=Pf.Uint8Array;function Bse(n){var e=new n.constructor(n.byteLength);return new Bx(e).set(new Bx(n)),e}function zse(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var Vse=/\w*$/;function jse(n){var e=new n.constructor(n.source,Vse.exec(n));return e.lastIndex=n.lastIndex,e}var $L=oh?oh.prototype:void 0,qL=$L?$L.valueOf:void 0;function Hse(n){return qL?Object(qL.call(n)):{}}function Gse(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var Wse="[object Boolean]",$se="[object Date]",qse="[object Map]",Xse="[object Number]",Kse="[object RegExp]",Yse="[object Set]",Jse="[object String]",Qse="[object Symbol]",Zse="[object ArrayBuffer]",eoe="[object DataView]",toe="[object Float32Array]",noe="[object Float64Array]",roe="[object Int8Array]",ioe="[object Int16Array]",soe="[object Int32Array]",ooe="[object Uint8Array]",aoe="[object Uint8ClampedArray]",coe="[object Uint16Array]",loe="[object Uint32Array]";function uoe(n,e,t){var r=n.constructor;switch(e){case Zse:return Bse(n);case Wse:case $se:return new r(+n);case eoe:return zse(n);case toe:case noe:case roe:case ioe:case soe:case ooe:case aoe:case coe:case loe:return Gse(n);case qse:return new r;case Xse:case Jse:return new r(n);case Kse:return jse(n);case Yse:return new r;case Qse:return Hse(n)}}function hoe(n){return typeof n.constructor=="function"&&!DE(n)?Qne(c5(n)):{}}var doe="[object Map]";function foe(n){return ed(n)&&qu(n)==doe}var XL=Vg&&Vg.isMap,poe=XL?aC(XL):foe,moe="[object Set]";function goe(n){return ed(n)&&qu(n)==moe}var KL=Vg&&Vg.isSet,_oe=KL?aC(KL):goe,S5="[object Arguments]",voe="[object Array]",yoe="[object Boolean]",Soe="[object Date]",Eoe="[object Error]",E5="[object Function]",boe="[object GeneratorFunction]",Toe="[object Map]",xoe="[object Number]",b5="[object Object]",woe="[object RegExp]",Coe="[object Set]",Roe="[object String]",Aoe="[object Symbol]",Moe="[object WeakMap]",Ioe="[object ArrayBuffer]",koe="[object DataView]",Ooe="[object Float32Array]",Noe="[object Float64Array]",Poe="[object Int8Array]",Doe="[object Int16Array]",Loe="[object Int32Array]",Uoe="[object Uint8Array]",Foe="[object Uint8ClampedArray]",Boe="[object Uint16Array]",zoe="[object Uint32Array]",cs={};cs[S5]=cs[voe]=cs[Ioe]=cs[koe]=cs[yoe]=cs[Soe]=cs[Ooe]=cs[Noe]=cs[Poe]=cs[Doe]=cs[Loe]=cs[Toe]=cs[xoe]=cs[b5]=cs[woe]=cs[Coe]=cs[Roe]=cs[Aoe]=cs[Uoe]=cs[Foe]=cs[Boe]=cs[zoe]=!0;cs[Eoe]=cs[E5]=cs[Moe]=!1;function JT(n,e,t,r,i,s){var o;if(o!==void 0)return o;if(!ah(n))return n;var a=gi(n);if(a)return o=Fse(n),ere(n,o);var c=qu(n),l=c==E5||c==boe;if(eE(n))return Tse(n);if(c==b5||c==S5||l&&!i)return o=l?{}:hoe(n),Cse(n,Ese(o,n));if(!cs[c])return i?n:{};o=uoe(n,c),s||(s=new vf);var u=s.get(n);if(u)return u;s.set(n,o),_oe(n)?n.forEach(function(p){o.add(JT(p,e,t,p,n,s))}):poe(n)&&n.forEach(function(p,_){o.set(_,JT(p,e,t,_,n,s))});var h=SM,d=a?void 0:h(n);return Y4(d||n,function(p,_){d&&(_=p,p=n[_]),sC(o,_,JT(p,e,t,_,n,s))}),o}var Voe=4;function sc(n){return JT(n,Voe)}function UE(n){for(var e=-1,t=n==null?0:n.length,r=0,i=[];++e<t;){var s=n[e];s&&(i[r++]=s)}return i}var joe="__lodash_hash_undefined__";function Hoe(n){return this.__data__.set(n,joe),this}function Goe(n){return this.__data__.has(n)}function _y(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new Em;++e<t;)this.add(n[e])}_y.prototype.add=_y.prototype.push=Hoe;_y.prototype.has=Goe;function T5(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function rO(n,e){return n.has(e)}var Woe=1,$oe=2;function x5(n,e,t,r,i,s){var o=t&Woe,a=n.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(n),u=s.get(e);if(l&&u)return l==e&&u==n;var h=-1,d=!0,p=t&$oe?new _y:void 0;for(s.set(n,e),s.set(e,n);++h<a;){var _=n[h],y=e[h];if(r)var S=o?r(y,_,h,e,n,s):r(_,y,h,n,e,s);if(S!==void 0){if(S)continue;d=!1;break}if(p){if(!T5(e,function(T,A){if(!rO(p,A)&&(_===T||i(_,T,t,r,s)))return p.push(A)})){d=!1;break}}else if(!(_===y||i(_,y,t,r,s))){d=!1;break}}return s.delete(n),s.delete(e),d}function qoe(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function iO(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var Xoe=1,Koe=2,Yoe="[object Boolean]",Joe="[object Date]",Qoe="[object Error]",Zoe="[object Map]",eae="[object Number]",tae="[object RegExp]",nae="[object Set]",rae="[object String]",iae="[object Symbol]",sae="[object ArrayBuffer]",oae="[object DataView]",YL=oh?oh.prototype:void 0,gR=YL?YL.valueOf:void 0;function aae(n,e,t,r,i,s,o){switch(t){case oae:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case sae:return!(n.byteLength!=e.byteLength||!s(new Bx(n),new Bx(e)));case Yoe:case Joe:case eae:return PE(+n,+e);case Qoe:return n.name==e.name&&n.message==e.message;case tae:case rae:return n==e+"";case Zoe:var a=qoe;case nae:var c=r&Xoe;if(a||(a=iO),n.size!=e.size&&!c)return!1;var l=o.get(n);if(l)return l==e;r|=Koe,o.set(n,e);var u=x5(a(n),a(e),r,i,s,o);return o.delete(n),u;case iae:if(gR)return gR.call(n)==gR.call(e)}return!1}var cae=1,lae=Object.prototype,uae=lae.hasOwnProperty;function hae(n,e,t,r,i,s){var o=t&cae,a=SM(n),c=a.length,l=SM(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:uae.call(e,d)))return!1}var p=s.get(n),_=s.get(e);if(p&&_)return p==e&&_==n;var y=!0;s.set(n,e),s.set(e,n);for(var S=o;++h<c;){d=a[h];var T=n[d],A=e[d];if(r)var R=o?r(A,T,d,e,n,s):r(T,A,d,n,e,s);if(!(R===void 0?T===A||i(T,A,t,r,s):R)){y=!1;break}S||(S=d=="constructor")}if(y&&!S){var I=n.constructor,U=e.constructor;I!=U&&"constructor"in n&&"constructor"in e&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(y=!1)}return s.delete(n),s.delete(e),y}var dae=1,JL="[object Arguments]",QL="[object Array]",aT="[object Object]",fae=Object.prototype,ZL=fae.hasOwnProperty;function pae(n,e,t,r,i,s){var o=gi(n),a=gi(e),c=o?QL:qu(n),l=a?QL:qu(e);c=c==JL?aT:c,l=l==JL?aT:l;var u=c==aT,h=l==aT,d=c==l;if(d&&eE(n)){if(!eE(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new vf),o||Xk(n)?x5(n,e,t,r,i,s):aae(n,e,c,t,r,i,s);if(!(t&dae)){var p=u&&ZL.call(n,"__wrapped__"),_=h&&ZL.call(e,"__wrapped__");if(p||_){var y=p?n.value():n,S=_?e.value():e;return s||(s=new vf),i(y,S,t,r,s)}}return d?(s||(s=new vf),hae(n,e,t,r,i,s)):!1}function sO(n,e,t,r,i){return n===e?!0:n==null||e==null||!ed(n)&&!ed(e)?n!==n&&e!==e:pae(n,e,t,r,sO,i)}var mae=1,gae=2;function _ae(n,e,t,r){var i=t.length,s=i;if(n==null)return!s;for(n=Object(n);i--;){var o=t[i];if(o[2]?o[1]!==n[o[0]]:!(o[0]in n))return!1}for(;++i<s;){o=t[i];var a=o[0],c=n[a],l=o[1];if(o[2]){if(c===void 0&&!(a in n))return!1}else{var u=new vf,h;if(!(h===void 0?sO(l,c,mae|gae,r,u):h))return!1}}return!0}function w5(n){return n===n&&!ah(n)}function vae(n){for(var e=ch(n),t=e.length;t--;){var r=e[t],i=n[r];e[t]=[r,i,w5(i)]}return e}function C5(n,e){return function(t){return t==null?!1:t[n]===e&&(e!==void 0||n in Object(t))}}function yae(n){var e=vae(n);return e.length==1&&e[0][2]?C5(e[0][0],e[0][1]):function(t){return t===n||_ae(t,n,e)}}function Sae(n,e){return n!=null&&e in Object(n)}function R5(n,e,t){e=uC(e,n);for(var r=-1,i=e.length,s=!1;++r<i;){var o=LE(e[r]);if(!(s=n!=null&&t(n,o)))break;n=n[o]}return s||++r!=i?s:(i=n==null?0:n.length,!!i&&qk(i)&&iC(o,i)&&(gi(n)||oC(n)))}function Eae(n,e){return n!=null&&R5(n,e,Sae)}var bae=1,Tae=2;function xae(n,e){return Kk(n)&&w5(e)?C5(LE(n),e):function(t){var r=Vie(t,n);return r===void 0&&r===e?Eae(t,n):sO(e,r,bae|Tae)}}function wae(n){return function(e){return e==null?void 0:e[n]}}function Cae(n){return function(e){return Jk(e,n)}}function Rae(n){return Kk(n)?wae(LE(n)):Cae(n)}function Lf(n){return typeof n=="function"?n:n==null?gy:typeof n=="object"?gi(n)?xae(n[0],n[1]):yae(n):Rae(n)}function Aae(n,e,t,r){for(var i=-1,s=n==null?0:n.length;++i<s;){var o=n[i];e(r,o,t(o),n)}return r}function Mae(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(t(s[c],c,s)===!1)break}return e}}var Iae=Mae();function kae(n,e){return n&&Iae(n,e,ch)}function Oae(n,e){return function(t,r){if(t==null)return t;if(!Df(t))return n(t,r);for(var i=t.length,s=-1,o=Object(t);++s<i&&r(o[s],s,o)!==!1;);return t}}var A_=Oae(kae);function Nae(n,e,t,r){return A_(n,function(i,s,o){e(r,i,t(i),o)}),r}function Pae(n,e){return function(t,r){var i=gi(t)?Aae:Nae,s=e?e():{};return i(t,n,Lf(r),s)}}var A5=Object.prototype,Dae=A5.hasOwnProperty,oO=$k(function(n,e){n=Object(n);var t=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&Z4(e[0],e[1],i)&&(r=1);++t<r;)for(var s=e[t],o=o5(s),a=-1,c=o.length;++a<c;){var l=o[a],u=n[l];(u===void 0||PE(u,A5[l])&&!Dae.call(n,l))&&(n[l]=s[l])}return n});function e2(n){return ed(n)&&Df(n)}var Lae=200;function Uae(n,e,t,r){var i=-1,s=Q4,o=!0,a=n.length,c=[],l=e.length;if(!a)return c;e.length>=Lae&&(s=rO,o=!1,e=new _y(e));e:for(;++i<a;){var u=n[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var hC=$k(function(n,e){return e2(n)?Uae(n,Zk(e,1,e2,!0)):[]});function vy(n){var e=n==null?0:n.length;return e?n[e-1]:void 0}function nc(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:rC(e),eO(n,e<0?0:e,r)):[]}function rE(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:rC(e),e=r-e,eO(n,0,e<0?0:e)):[]}function Fae(n){return typeof n=="function"?n:gy}function rr(n,e){var t=gi(n)?Y4:A_;return t(n,Fae(e))}function Bae(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(!e(n[t],t,n))return!1;return!0}function zae(n,e){var t=!0;return A_(n,function(r,i,s){return t=!!e(r,i,s),t}),t}function Jh(n,e,t){var r=gi(n)?Bae:zae;return r(n,Lf(e))}function M5(n,e){var t=[];return A_(n,function(r,i,s){e(r,i,s)&&t.push(r)}),t}function uh(n,e){var t=gi(n)?tO:M5;return t(n,Lf(e))}function Vae(n){return function(e,t,r){var i=Object(e);if(!Df(e)){var s=Lf(t);e=ch(e),t=function(a){return s(i[a],a,i)}}var o=n(e,t,r);return o>-1?i[s?e[o]:o]:void 0}}var jae=Math.max;function Hae(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=t==null?0:rC(t);return i<0&&(i=jae(r+i,0)),J4(n,Lf(e),i)}var yy=Vae(Hae);function td(n){return n&&n.length?n[0]:void 0}function Gae(n,e){var t=-1,r=Df(n)?Array(n.length):[];return A_(n,function(i,s,o){r[++t]=e(i,s,o)}),r}function mn(n,e){var t=gi(n)?nC:Gae;return t(n,Lf(e))}function nh(n,e){return Zk(mn(n,e))}var Wae=Object.prototype,$ae=Wae.hasOwnProperty,I5=Pae(function(n,e,t){$ae.call(n,t)?n[t].push(e):Gk(n,t,[e])}),qae=Object.prototype,Xae=qae.hasOwnProperty;function Kae(n,e){return n!=null&&Xae.call(n,e)}function Xn(n,e){return n!=null&&R5(n,e,Kae)}var Yae="[object String]";function Fl(n){return typeof n=="string"||!gi(n)&&ed(n)&&Yg(n)==Yae}function Jae(n,e){return nC(e,function(t){return n[t]})}function $o(n){return n==null?[]:Jae(n,ch(n))}var Qae=Math.max;function ol(n,e,t,r){n=Df(n)?n:$o(n),t=t&&!r?rC(t):0;var i=n.length;return t<0&&(t=Qae(i+t,0)),Fl(n)?t<=i&&n.indexOf(e,t)>-1:!!i&&Hk(n,e,t)>-1}function t2(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=0;return Hk(n,e,i)}var Zae="[object Map]",ece="[object Set]",tce=Object.prototype,nce=tce.hasOwnProperty;function ds(n){if(n==null)return!0;if(Df(n)&&(gi(n)||typeof n=="string"||typeof n.splice=="function"||eE(n)||Xk(n)||oC(n)))return!n.length;var e=qu(n);if(e==Zae||e==ece)return!n.size;if(DE(n))return!s5(n).length;for(var t in n)if(nce.call(n,t))return!1;return!0}var rce="[object RegExp]";function ice(n){return ed(n)&&Yg(n)==rce}var n2=Vg&&Vg.isRegExp,um=n2?aC(n2):ice;function hm(n){return n===void 0}var sce="Expected a function";function oce(n){if(typeof n!="function")throw new TypeError(sce);return function(){var e=arguments;switch(e.length){case 0:return!n.call(this);case 1:return!n.call(this,e[0]);case 2:return!n.call(this,e[0],e[1]);case 3:return!n.call(this,e[0],e[1],e[2])}return!n.apply(this,e)}}function ace(n,e,t,r){if(!ah(n))return n;e=uC(e,n);for(var i=-1,s=e.length,o=s-1,a=n;a!=null&&++i<s;){var c=LE(e[i]),l=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return n;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=ah(u)?u:iC(e[i+1])?[]:{})}sC(a,c,l),a=a[c]}return n}function cce(n,e,t){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Jk(n,o);t(a,o)&&ace(s,uC(o,n),a)}return s}function od(n,e){if(n==null)return{};var t=nC(Mse(n),function(r){return[r]});return e=Lf(e),cce(n,t,function(r,i){return e(r,i[0])})}function lce(n,e,t,r,i){return i(n,function(s,o,a){t=r?(r=!1,s):e(t,s,o,a)}),t}function Bl(n,e,t){var r=gi(n)?pse:lce,i=arguments.length<3;return r(n,Lf(e),t,i,A_)}function dC(n,e){var t=gi(n)?tO:M5;return t(n,oce(Lf(e)))}function uce(n,e){var t;return A_(n,function(r,i,s){return t=e(r,i,s),!t}),!!t}function aO(n,e,t){var r=gi(n)?T5:uce;return r(n,Lf(e))}var hce=1/0,dce=Kv&&1/iO(new Kv([,-0]))[1]==hce?function(n){return new Kv(n)}:oa,fce=200;function pce(n,e,t){var r=-1,i=Q4,s=n.length,o=!0,a=[],c=a;if(s>=fce){var l=dce(n);if(l)return iO(l);o=!1,i=rO,c=new _y}else c=a;e:for(;++r<s;){var u=n[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,t)||(c!==a&&c.push(h),a.push(u))}return a}function fC(n){return n&&n.length?pce(n):[]}var mce=function(e){var t=e&&KT[e]?KT[e]||[]:Pl(Object.values(KT));return t.map(function(r){return{label:(YT==null?void 0:YT[r])||r,value:r}})},FE=function(){function n(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.serviceUrl,i=t.locale,s=t.headers;kte(this,n),nf(this,"locale",void 0),nf(this,"serviceUrl",void 0),nf(this,"headers",void 0),nf(this,"fetch",function(){var o=Xv(pu().mark(function a(c){var l;return pu().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.serviceUrl?fetch(e.serviceUrl,{body:JSON.stringify(c),headers:e.headers,method:"POST"}):$4({payload:c});case 2:return l=h.sent,h.abrupt("return",l);case 4:case"end":return h.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),nf(this,"create",function(){var o=Xv(pu().mark(function a(c){return pu().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",e.fetch(c));case 1:case"end":return u.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),nf(this,"createAudio",function(){var o=Xv(pu().mark(function a(c){var l,u;return pu().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,e.create(c);case 2:return l=d.sent,d.next=5,l.arrayBuffer();case 5:return u=d.sent,d.abrupt("return",Dte(u));case 7:case"end":return d.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),this.locale=i,this.serviceUrl=r,this.headers=s}return Pte(n,[{key:"voiceOptions",get:function(){return mce(this.locale)}}]),n}();nf(FE,"localeOptions",zte());nf(FE,"voiceList",KT);nf(FE,"voiceName",YT);nf(FE,"createRequest",$4);const k5="15.0.4",r2=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),i2=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),TM=(n,e)=>({startTime:e,type:"setValue",value:n}),O5=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),N5=(n,e,{startTime:t,target:r,timeConstant:i})=>r+(e-r)*Math.exp((t-n)/i),Dv=n=>n.type==="exponentialRampToValue",zx=n=>n.type==="linearRampToValue",Sg=n=>Dv(n)||zx(n),cO=n=>n.type==="setValue",Xp=n=>n.type==="setValueCurve",Vx=(n,e,t,r)=>{const i=n[e];return i===void 0?r:Sg(i)||cO(i)?i.value:Xp(i)?i.values[i.values.length-1]:N5(t,Vx(n,e-1,i.startTime,r),i)},s2=(n,e,t,r,i)=>t===void 0?[r.insertTime,i]:Sg(t)?[t.endTime,t.value]:cO(t)?[t.startTime,t.value]:Xp(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,Vx(n,e-1,t.startTime,i)],xM=n=>n.type==="cancelAndHold",wM=n=>n.type==="cancelScheduledValues",pg=n=>xM(n)||wM(n)?n.cancelTime:Dv(n)||zx(n)?n.endTime:n.startTime,o2=(n,e,t,{endTime:r,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(r-e)):0,a2=(n,e,t,{endTime:r,value:i})=>t+(n-e)/(r-e)*(i-t),gce=(n,e)=>{const t=Math.floor(e),r=Math.ceil(e);return t===r?n[t]:(1-(e-t))*n[t]+(1-(r-e))*n[r]},_ce=(n,{duration:e,startTime:t,values:r})=>{const i=(n-t)/e*(r.length-1);return gce(r,i)},cT=n=>n.type==="setTarget";class vce{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=pg(e);if(xM(e)||wM(e)){const r=this._automationEvents.findIndex(s=>wM(e)&&Xp(s)?s.startTime+s.duration>=t:pg(s)>=t),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),xM(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Sg(i)){if(s!==void 0&&cT(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:Xp(s)?s.startTime+s.duration:pg(s),a=s===void 0?this._defaultValue:Xp(s)?s.values[s.values.length-1]:s.value,c=Dv(i)?o2(t,o,a,i):a2(t,o,a,i),l=Dv(i)?r2(c,t,this._currenTime):i2(c,t,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&cT(s)&&this._automationEvents.push(TM(this.getValue(t),t)),s!==void 0&&Xp(s)&&s.startTime+s.duration>t){const o=t-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=s.values[h-1]*(1-d)+s.values[h]*d}this._automationEvents[this._automationEvents.length-1]=O5(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>pg(o)>t),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&Xp(i)&&pg(i)+i.duration>t)return!1;const s=Dv(e)?r2(e.value,e.endTime,this._currenTime):zx(e)?i2(e.value,t,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(Xp(e)&&t+e.duration>pg(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const t=this._automationEvents.findIndex(r=>pg(r)>e);if(t>1){const r=this._automationEvents.slice(t-1),i=r[0];cT(i)&&r.unshift(TM(Vx(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>pg(o)>e),r=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,s=this._automationEvents[i];if(s!==void 0&&cT(s)&&(r===void 0||!Sg(r)||r.insertTime>e))return N5(e,Vx(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&cO(s)&&(r===void 0||!Sg(r)))return s.value;if(s!==void 0&&Xp(s)&&(r===void 0||!Sg(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?_ce(e,s):s.values[s.values.length-1];if(s!==void 0&&Sg(s)&&(r===void 0||!Sg(r)))return s.value;if(r!==void 0&&Dv(r)){const[o,a]=s2(this._automationEvents,i,s,r,this._defaultValue);return o2(e,o,a,r)}if(r!==void 0&&zx(r)){const[o,a]=s2(this._automationEvents,i,s,r,this._defaultValue);return a2(e,o,a,r)}return this._defaultValue}}const yce=n=>({cancelTime:n,type:"cancelAndHold"}),Sce=n=>({cancelTime:n,type:"cancelScheduledValues"}),Ece=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),bce=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),Tce=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),xce=()=>new DOMException("","AbortError"),wce=n=>(e,t,[r,i,s],o)=>{n(e[i],[t,r,s],a=>a[0]===t&&a[1]===r,o)},Cce=n=>(e,t,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},Rce=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Sy=new WeakSet,P5=new WeakMap,lO=new WeakMap,D5=new WeakMap,uO=new WeakMap,pC=new WeakMap,L5=new WeakMap,CM=new WeakMap,RM=new WeakMap,AM=new WeakMap,U5={construct(){return U5}},Ace=n=>{try{const e=new Proxy(n,U5);new e}catch{return!1}return!0},c2=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,l2=(n,e)=>{const t=[];let r=n.replace(/^[\s]+/,""),i=r.match(c2);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());t.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(c2)}return[t.join(";"),r]},u2=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},h2=n=>{if(!Ace(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Mce=(n,e,t,r,i,s,o,a,c,l,u,h,d)=>{let p=0;return(_,y,S={credentials:"omit"})=>{const T=u.get(_);if(T!==void 0&&T.has(y))return Promise.resolve();const A=l.get(_);if(A!==void 0){const U=A.get(y);if(U!==void 0)return U}const R=s(_),I=R.audioWorklet===void 0?i(y).then(([U,D])=>{const[L,z]=l2(U,D),F=`${L};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${z}
})})(window,'_AWGS')`;return t(F)}).then(()=>{const U=d._AWGS.pop();if(U===void 0)throw new SyntaxError;r(R.currentTime,R.sampleRate,()=>U(class{},void 0,(D,L)=>{if(D.trim()==="")throw e();const z=RM.get(R);if(z!==void 0){if(z.has(D))throw e();h2(L),u2(L.parameterDescriptors),z.set(D,L)}else h2(L),u2(L.parameterDescriptors),RM.set(R,new Map([[D,L]]))},R.sampleRate,void 0,void 0))}):Promise.all([i(y),Promise.resolve(n(h,h))]).then(([[U,D],L])=>{const z=p+1;p=z;const[F,V]=l2(U,D),K=`${F};((AudioWorkletProcessor,registerProcessor)=>{${V}
})(${L?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${L?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${L?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${z}',class extends AudioWorkletProcessor{process(){return !1}})`,te=new Blob([K],{type:"application/javascript; charset=utf-8"}),Q=URL.createObjectURL(te);return R.audioWorklet.addModule(Q,S).then(()=>{if(a(R))return R;const ne=o(R);return ne.audioWorklet.addModule(Q,S).then(()=>ne)}).then(ne=>{if(c===null)throw new SyntaxError;try{new c(ne,`__sac${z}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Q))});return A===void 0?l.set(_,new Map([[y,I]])):A.set(y,I),I.then(()=>{const U=u.get(_);U===void 0?u.set(_,new Set([y])):U.add(y)}).finally(()=>{const U=l.get(_);U!==void 0&&U.delete(y)}),I}},nd=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},mC=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[r]=t;return n.delete(r),r},F5=(n,e,t,r)=>{const i=nd(n,e),s=mC(i,o=>o[0]===t&&o[1]===r);return i.size===0&&n.delete(e),s},BE=n=>nd(L5,n),Ey=n=>{if(Sy.has(n))throw new Error("The AudioNode is already stored.");Sy.add(n),BE(n).forEach(e=>e(!0))},B5=n=>"port"in n,zE=n=>{if(!Sy.has(n))throw new Error("The AudioNode is not stored.");Sy.delete(n),BE(n).forEach(e=>e(!1))},MM=(n,e)=>{!B5(n)&&e.every(t=>t.size===0)&&zE(n)},Ice=(n,e,t,r,i,s,o,a,c,l,u,h,d)=>{const p=new WeakMap;return(_,y,S,T,A)=>{const{activeInputs:R,passiveInputs:I}=s(y),{outputs:U}=s(_),D=a(_),L=z=>{const F=c(y),V=c(_);if(z){const W=F5(I,_,S,T);n(R,_,W,!1),!A&&!h(_)&&t(V,F,S,T),d(y)&&Ey(y)}else{const W=r(R,_,S,T);e(I,T,W,!1),!A&&!h(_)&&i(V,F,S,T);const X=o(y);if(X===0)u(y)&&MM(y,R);else{const $=p.get(y);$!==void 0&&clearTimeout($),p.set(y,setTimeout(()=>{u(y)&&MM(y,R)},X*1e3))}}};return l(U,[y,S,T],z=>z[0]===y&&z[1]===S&&z[2]===T,!0)?(D.add(L),u(_)?n(R,_,[S,T,L],!0):e(I,T,[_,S,L],!0),!0):!1}},kce=n=>(e,t,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,t,s]])):n(a,[i,t,s],c=>c[0]===i&&c[1]===t,o)},Oce=n=>(e,t)=>{const r=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(r).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(r),r.disconnect()};t.addEventListener("ended",i)},Nce=n=>(e,t)=>{n(e).add(t)},Pce={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Dce=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...Pce,...c},h=r(l,u),d=s(l)?e():null;super(a,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},xc=(n,e)=>n.context===e,Lce=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!xc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},jx=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Uf=()=>new DOMException("","IndexSizeError"),hO=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(r){throw r.code===12?Uf():r}})(n.getChannelData)},Uce={numberOfChannels:1},Fce=(n,e,t,r,i,s,o,a)=>{let c=null;return class z5{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:p}={...Uce,...u};c===null&&(c=new i(1,1,44100));const _=r!==null&&e(s,s)?new r({length:h,numberOfChannels:d,sampleRate:p}):c.createBuffer(d,h,p);if(_.numberOfChannels===0)throw t();return typeof _.copyFromChannel!="function"?(o(_),hO(_)):e(jx,()=>jx(_))||a(_),n.add(_),_}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===z5.prototype||n.has(u)}}},Al=-34028234663852886e22,Qc=-Al,im=n=>Sy.has(n),Bce={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},zce=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),d={...Bce,...u},p=i(h,d),_=o(h),y=_?e():null;super(l,!1,p,y),this._audioBufferSourceNodeRenderer=y,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=t(this,_,p.playbackRate,Qc,Al)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){Ey(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),im(this)&&zE(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},Vce=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=xc(h,u);if(!d){const p={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,p),o!==null&&h.start(...o),a!==null&&h.stop(a)}return s.set(u,h),d?await n(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},jce=n=>"playbackRate"in n,Hce=n=>"frequency"in n&&"gain"in n,Gce=n=>"offset"in n,Wce=n=>!("frequency"in n)&&"gain"in n,$ce=n=>"detune"in n&&"frequency"in n&&!("gain"in n),qce=n=>"pan"in n,el=n=>nd(P5,n),VE=n=>nd(D5,n),IM=(n,e)=>{const{activeInputs:t}=el(n);t.forEach(i=>i.forEach(([s])=>{e.includes(n)||IM(s,[...e,n])}));const r=jce(n)?[n.playbackRate]:B5(n)?Array.from(n.parameters.values()):Hce(n)?[n.Q,n.detune,n.frequency,n.gain]:Gce(n)?[n.offset]:Wce(n)?[n.gain]:$ce(n)?[n.detune,n.frequency]:qce(n)?[n.pan]:[];for(const i of r){const s=VE(i);s!==void 0&&s.activeInputs.forEach(([o])=>IM(o,e))}im(n)&&zE(n)},V5=n=>{IM(n.destination,[])},Xce=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),Kce=(n,e,t,r,i,s,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(_){throw _.code===12&&_.message==="sampleRate is not in range"?t():_}if(h===null)throw r();if(!Xce(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:p}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/p:d==="interactive"||d===void 0?256/p:d==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(d*p/128)))*128/p,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const _=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",_)};h.addEventListener("statechange",_)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),V5(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},Yce=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),d=o(h),p=i(h,u,d),_=d?e(a):null;super(l,!1,p,_),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},Jce=n=>{const e=new WeakMap,t=async(r,i)=>{const s=i.destination;return e.set(i,s),await n(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):t(r,i)}}},Qce=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const U=new Float32Array(1),D=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),L=o(l);let z=!1,F=[0,0,-1,0,1,0],V=[0,0,0];const W=()=>{if(z)return;z=!0;const te=r(l,256,9,0);te.onaudioprocess=({inputBuffer:Q})=>{const ne=[s(Q,U,0),s(Q,U,1),s(Q,U,2),s(Q,U,3),s(Q,U,4),s(Q,U,5)];ne.some((J,re)=>J!==F[re])&&(u.setOrientation(...ne),F=ne);const G=[s(Q,U,6),s(Q,U,7),s(Q,U,8)];G.some((J,re)=>J!==V[re])&&(u.setPosition(...G),V=G)},D.connect(te)},X=te=>Q=>{Q!==F[te]&&(F[te]=Q,u.setOrientation(...F))},$=te=>Q=>{Q!==V[te]&&(V[te]=Q,u.setPosition(...V))},K=(te,Q,ne)=>{const G=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Q});G.connect(D,0,te),G.start(),Object.defineProperty(G.offset,"defaultValue",{get(){return Q}});const J=n({context:c},L,G.offset,Qc,Al);return a(J,"value",re=>()=>re.call(J),re=>ue=>{try{re.call(J,ue)}catch(ye){if(ye.code!==9)throw ye}W(),L&&ne(ue)}),J.cancelAndHoldAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.cancelAndHoldAtTime),J.cancelScheduledValues=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.cancelScheduledValues),J.exponentialRampToValueAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.exponentialRampToValueAtTime),J.linearRampToValueAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.linearRampToValueAtTime),J.setTargetAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.setTargetAtTime),J.setValueAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.setValueAtTime),J.setValueCurveAtTime=(re=>L?()=>{throw i()}:(...ue)=>{const ye=re.apply(J,ue);return W(),ye})(J.setValueCurveAtTime),J};return{forwardX:K(0,0,X(0)),forwardY:K(1,0,X(1)),forwardZ:K(2,-1,X(2)),positionX:K(6,0,$(0)),positionY:K(7,0,$(1)),positionZ:K(8,0,$(2)),upX:K(3,0,X(3)),upY:K(4,1,X(4)),upZ:K(5,0,X(5))}},{forwardX:d,forwardY:p,forwardZ:_,positionX:y,positionY:S,positionZ:T,upX:A,upY:R,upZ:I}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return p},get forwardZ(){return _},get positionX(){return y},get positionY(){return S},get positionZ(){return T},get upX(){return A},get upY(){return R},get upZ(){return I}}},Hx=n=>"context"in n,jE=n=>Hx(n[0]),M_=(n,e,t,r)=>{for(const i of n)if(t(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},d2=(n,e,[t,r],i)=>{M_(n,[e,t,r],s=>s[0]===e&&s[1]===t,i)},f2=(n,[e,t,r],i)=>{const s=n.get(e);s===void 0?n.set(e,new Set([[t,r]])):M_(s,[t,r],o=>o[0]===t,i)},zy=n=>"inputs"in n,Gx=(n,e,t,r)=>{if(zy(e)){const i=e.inputs[r];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,r),[e,t,r]},j5=(n,e,t)=>{for(const r of n)if(r[0]===e&&r[1]===t)return n.delete(r),r;return null},Zce=(n,e,t)=>mC(n,r=>r[0]===e&&r[1]===t),H5=(n,e)=>{if(!BE(n).delete(e))throw new Error("Missing the expected event listener.")},G5=(n,e,t)=>{const r=nd(n,e),i=mC(r,s=>s[0]===t);return r.size===0&&n.delete(e),i},Wx=(n,e,t,r)=>{zy(e)?n.disconnect(e.inputs[r],t,0):n.disconnect(e,t,r)},xs=n=>nd(lO,n),iE=n=>nd(uO,n),f_=n=>CM.has(n),QT=n=>!Sy.has(n),p2=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const r=n.createScriptProcessor(256,1,1),i=n.createGain(),s=n.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(n.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(n.destination)},a.start()}}),_R=(n,e)=>{const t=new Map;for(const r of n)for(const i of r){const s=t.get(i);t.set(i,s===void 0?1:s+1)}t.forEach((r,i)=>e(i,r))},$x=n=>"context"in n,ele=n=>{const e=new Map;n.connect=(t=>(r,i=0,s=0)=>{const o=$x(r)?t(r,i,s):t(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(r,i,s)=>{if(t.apply(n),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{$x(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},tle=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=VE(e),{outputs:o}=el(n),a=BE(n),c=l=>{const u=xs(n),h=iE(e);if(l){const d=G5(s,n,t);d2(i,n,d,!1),!r&&!f_(n)&&u.connect(h,t)}else{const d=Zce(i,n,t);f2(s,d,!1),!r&&!f_(n)&&u.disconnect(h,t)}};return M_(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),im(n)?d2(i,n,[t,c],!0):f2(s,[n,t,c],!0),!0):!1},nle=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=el(e),o=j5(i[r],n,t);return o===null?[F5(s,n,t,r)[2],!1]:[o[2],!0]},rle=(n,e,t)=>{const{activeInputs:r,passiveInputs:i}=VE(e),s=j5(r,n,t);return s===null?[G5(i,n,t)[1],!1]:[s[2],!0]},dO=(n,e,t,r,i)=>{const[s,o]=nle(n,t,r,i);if(s!==null&&(H5(n,s),o&&!e&&!f_(n)&&Wx(xs(n),xs(t),r,i)),im(t)){const{activeInputs:a}=el(t);MM(t,a)}},fO=(n,e,t,r)=>{const[i,s]=rle(n,t,r);i!==null&&(H5(n,i),s&&!e&&!f_(n)&&xs(n).disconnect(iE(t),r))},ile=(n,e)=>{const t=el(n),r=[];for(const i of t.outputs)jE(i)?dO(n,e,...i):fO(n,e,...i),r.push(i[0]);return t.outputs.clear(),r},sle=(n,e,t)=>{const r=el(n),i=[];for(const s of r.outputs)s[1]===t&&(jE(s)?dO(n,e,...s):fO(n,e,...s),i.push(s[0]),r.outputs.delete(s));return i},ole=(n,e,t,r,i)=>{const s=el(n);return Array.from(s.outputs).filter(o=>o[0]===t&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(jE(o)?dO(n,e,...o):fO(n,e,...o),s.outputs.delete(o),o[0]))},ale=(n,e,t,r,i,s,o,a,c,l,u,h,d,p,_,y)=>class extends l{constructor(T,A,R,I){super(R),this._context=T,this._nativeAudioNode=R;const U=u(T);h(U)&&t(p2,()=>p2(U,y))!==!0&&ele(R),lO.set(this,R),L5.set(this,new Set),T.state!=="closed"&&A&&Ey(this),n(this,I,R)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(T){this._nativeAudioNode.channelCount=T}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(T){this._nativeAudioNode.channelCountMode=T}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(T){this._nativeAudioNode.channelInterpretation=T}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(T,A=0,R=0){if(A<0||A>=this._nativeAudioNode.numberOfOutputs)throw i();const I=u(this._context),U=_(I);if(d(T)||p(T))throw s();if(Hx(T)){const z=xs(T);try{const V=Gx(this._nativeAudioNode,z,A,R),W=QT(this);(U||W)&&this._nativeAudioNode.disconnect(...V),this.context.state!=="closed"&&!W&&QT(T)&&Ey(T)}catch(V){throw V.code===12?s():V}if(e(this,T,A,R,U)){const V=c([this],T);_R(V,r(U))}return T}const D=iE(T);if(D.name==="playbackRate"&&D.maxValue===1024)throw o();try{this._nativeAudioNode.connect(D,A),(U||QT(this))&&this._nativeAudioNode.disconnect(D,A)}catch(z){throw z.code===12?s():z}if(tle(this,T,A,U)){const z=c([this],T);_R(z,r(U))}}disconnect(T,A,R){let I;const U=u(this._context),D=_(U);if(T===void 0)I=ile(this,D);else if(typeof T=="number"){if(T<0||T>=this.numberOfOutputs)throw i();I=sle(this,D,T)}else{if(A!==void 0&&(A<0||A>=this.numberOfOutputs)||Hx(T)&&R!==void 0&&(R<0||R>=T.numberOfInputs))throw i();if(I=ole(this,D,T,A,R),I.length===0)throw s()}for(const L of I){const z=c([this],L);_R(z,a)}}},cle=(n,e,t,r,i,s,o,a,c,l,u,h,d)=>(p,_,y,S=null,T=null)=>{const A=y.value,R=new vce(A),I=_?r(R):null,U={get defaultValue(){return A},get maxValue(){return S===null?y.maxValue:S},get minValue(){return T===null?y.minValue:T},get value(){return y.value},set value(D){y.value=D,U.setValueAtTime(D,p.context.currentTime)},cancelAndHoldAtTime(D){if(typeof y.cancelAndHoldAtTime=="function")I===null&&R.flush(p.context.currentTime),R.add(i(D)),y.cancelAndHoldAtTime(D);else{const L=Array.from(R).pop();I===null&&R.flush(p.context.currentTime),R.add(i(D));const z=Array.from(R).pop();y.cancelScheduledValues(D),L!==z&&z!==void 0&&(z.type==="exponentialRampToValue"?y.exponentialRampToValueAtTime(z.value,z.endTime):z.type==="linearRampToValue"?y.linearRampToValueAtTime(z.value,z.endTime):z.type==="setValue"?y.setValueAtTime(z.value,z.startTime):z.type==="setValueCurve"&&y.setValueCurveAtTime(z.values,z.startTime,z.duration))}return U},cancelScheduledValues(D){return I===null&&R.flush(p.context.currentTime),R.add(s(D)),y.cancelScheduledValues(D),U},exponentialRampToValueAtTime(D,L){if(D===0)throw new RangeError;if(!Number.isFinite(L)||L<0)throw new RangeError;const z=p.context.currentTime;return I===null&&R.flush(z),Array.from(R).length===0&&(R.add(l(A,z)),y.setValueAtTime(A,z)),R.add(o(D,L)),y.exponentialRampToValueAtTime(D,L),U},linearRampToValueAtTime(D,L){const z=p.context.currentTime;return I===null&&R.flush(z),Array.from(R).length===0&&(R.add(l(A,z)),y.setValueAtTime(A,z)),R.add(a(D,L)),y.linearRampToValueAtTime(D,L),U},setTargetAtTime(D,L,z){return I===null&&R.flush(p.context.currentTime),R.add(c(D,L,z)),y.setTargetAtTime(D,L,z),U},setValueAtTime(D,L){return I===null&&R.flush(p.context.currentTime),R.add(l(D,L)),y.setValueAtTime(D,L),U},setValueCurveAtTime(D,L,z){const F=D instanceof Float32Array?D:new Float32Array(D);if(h!==null&&h.name==="webkitAudioContext"){const V=L+z,W=p.context.sampleRate,X=Math.ceil(L*W),$=Math.floor(V*W),K=$-X,te=new Float32Array(K);for(let ne=0;ne<K;ne+=1){const G=(F.length-1)/z*((X+ne)/W-L),J=Math.floor(G),re=Math.ceil(G);te[ne]=J===re?F[J]:(1-(G-J))*F[J]+(1-(re-G))*F[re]}I===null&&R.flush(p.context.currentTime),R.add(u(te,L,z)),y.setValueCurveAtTime(te,L,z);const Q=$/W;Q<V&&d(U,te[te.length-1],Q),d(U,F[F.length-1],V)}else I===null&&R.flush(p.context.currentTime),R.add(u(F,L,z)),y.setValueCurveAtTime(F,L,z);return U}};return t.set(U,y),e.set(U,p),n(U,I),U},lle=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:r,value:i}=t;e.exponentialRampToValueAtTime(i,r)}else if(t.type==="linearRampToValue"){const{endTime:r,value:i}=t;e.linearRampToValueAtTime(i,r)}else if(t.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=t;e.setTargetAtTime(i,r,s)}else if(t.type==="setValue"){const{startTime:r,value:i}=t;e.setValueAtTime(i,r)}else if(t.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=t;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class W5{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((r,i)=>e.call(t,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const ule={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},hle=(n,e,t,r,i,s,o,a,c,l,u,h,d,p)=>class extends e{constructor(y,S,T){var A;const R=a(y),I=c(R),U=u({...ule,...T});d(U);const D=RM.get(R),L=D==null?void 0:D.get(S),z=I||R.state!=="closed"?R:(A=o(R))!==null&&A!==void 0?A:R,F=i(z,I?null:y.baseLatency,l,S,L,U),V=I?r(S,U,L):null;super(y,!0,F,V);const W=[];F.parameters.forEach(($,K)=>{const te=t(this,I,$);W.push([K,te])}),this._nativeAudioWorkletNode=F,this._onprocessorerror=null,this._parameters=new W5(W),I&&n(R,this);const{activeInputs:X}=s(this);h(F,X)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(y){const S=typeof y=="function"?p(this,y):null;this._nativeAudioWorkletNode.onprocessorerror=S;const T=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=T!==null&&T===S?y:T}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function qx(n,e,t,r,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],r,i);else{const s=n.getChannelData(r);if(e[t].byteLength===0)e[t]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const $5=(n,e,t,r,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],r,i):e[t].byteLength!==0&&n.getChannelData(r).set(e[t],i)},Xx=(n,e)=>{const t=[];for(let r=0;r<n;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));t.push(i)}return t},dle=(n,e)=>{const t=nd(AM,n),r=xs(e);return nd(t,r)},fle=async(n,e,t,r,i,s,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((S,T)=>S+T,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=el(n),d=await dle(t,n),p=Xx(r.numberOfInputs,r.channelCount),_=Xx(r.numberOfOutputs,i),y=Array.from(n.parameters.keys()).reduce((S,T)=>({...S,[T]:new Float32Array(128)}),{});for(let S=0;S<a;S+=128){if(r.numberOfInputs>0&&e!==null)for(let T=0;T<r.numberOfInputs;T+=1)for(let A=0;A<r.channelCount;A+=1)qx(e,p[T],A,A,S);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:T},A)=>{qx(e,y,T,c+A,S)});for(let T=0;T<r.numberOfInputs;T+=1)for(let A=0;A<i[T];A+=1)_[T][A].byteLength===0&&(_[T][A]=new Float32Array(128));try{const T=p.map((R,I)=>h.activeInputs[I].size===0?[]:R),A=o(S/t.sampleRate,t.sampleRate,()=>d.process(T,_,y));if(u!==null)for(let R=0,I=0;R<r.numberOfOutputs;R+=1){for(let U=0;U<i[R];U+=1)$5(u,_[R],U,I+U,S);I+=i[R]}if(!A)break}catch(T){n.dispatchEvent(new ErrorEvent("processorerror",{colno:T.colno,filename:T.filename,lineno:T.lineno,message:T.message}));break}}return u},ple=(n,e,t,r,i,s,o,a,c,l,u,h,d,p,_,y)=>(S,T,A)=>{const R=new WeakMap;let I=null;const U=async(D,L)=>{let z=u(D),F=null;const V=xc(z,L),W=Array.isArray(T.outputChannelCount)?T.outputChannelCount:Array.from(T.outputChannelCount);if(h===null){const X=W.reduce((Q,ne)=>Q+ne,0),$=i(L,{channelCount:Math.max(1,X),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,X)}),K=[];for(let Q=0;Q<D.numberOfOutputs;Q+=1)K.push(r(L,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:W[Q]}));const te=o(L,{channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,gain:1});te.connect=e.bind(null,K),te.disconnect=c.bind(null,K),F=[$,K,te]}else V||(z=new h(L,S));if(R.set(L,F===null?z:F[2]),F!==null){if(I===null){if(A===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ne=D.channelCount*D.numberOfInputs,G=A.parameterDescriptors===void 0?0:A.parameterDescriptors.length,J=ne+G;I=fle(D,J===0?null:await(async()=>{const ue=new d(J,Math.ceil(D.context.length/128)*128,L.sampleRate),ye=[],Ne=[];for(let Ye=0;Ye<T.numberOfInputs;Ye+=1)ye.push(o(ue,{channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,gain:1})),Ne.push(i(ue,{channelCount:T.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:T.channelCount}));const _e=await Promise.all(Array.from(D.parameters.values()).map(async Ye=>{const Ze=s(ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ye.value});return await p(ue,Ye,Ze.offset),Ze})),Ae=r(ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ne+G)});for(let Ye=0;Ye<T.numberOfInputs;Ye+=1){ye[Ye].connect(Ne[Ye]);for(let Ze=0;Ze<T.channelCount;Ze+=1)Ne[Ye].connect(Ae,Ze,Ye*T.channelCount+Ze)}for(const[Ye,Ze]of _e.entries())Ze.connect(Ae,0,ne+Ye),Ze.start(0);return Ae.connect(ue.destination),await Promise.all(ye.map(Ye=>_(D,ue,Ye))),y(ue)})(),L,T,W,A,l)}const X=await I,$=t(L,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[K,te,Q]=F;X!==null&&($.buffer=X,$.start(0)),$.connect(K);for(let ne=0,G=0;ne<D.numberOfOutputs;ne+=1){const J=te[ne];for(let re=0;re<W[ne];re+=1)K.connect(J,G+re,re);G+=W[ne]}return Q}if(V)for(const[X,$]of D.parameters.entries())await n(L,$,z.parameters.get(X));else for(const[X,$]of D.parameters.entries())await p(L,$,z.parameters.get(X));return await _(D,L,z),z};return{render(D,L){a(L,D);const z=R.get(L);return z!==void 0?Promise.resolve(z):U(D,L)}}},mle=(n,e,t,r,i,s,o,a,c,l,u,h,d,p,_,y,S,T,A,R)=>class extends _{constructor(U,D){super(U,D),this._nativeContext=U,this._audioWorklet=n===void 0?void 0:{addModule:(L,z)=>n(this,L,z)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(U,D,L){return new t({length:D,numberOfChannels:U,sampleRate:L})}createBufferSource(){return new r(this)}createChannelMerger(U=6){return new s(this,{numberOfInputs:U})}createChannelSplitter(U=6){return new o(this,{numberOfOutputs:U})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(U=1){return new u(this,{maxDelayTime:U})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(U,D){return new p(this,{feedback:D,feedforward:U})}createOscillator(){return new y(this)}createPanner(){return new S(this)}createPeriodicWave(U,D,L={disableNormalization:!1}){return new T(this,{...L,imag:D,real:U})}createStereoPanner(){return new A(this)}createWaveShaper(){return new R(this)}decodeAudioData(U,D,L){return l(this._nativeContext,U).then(z=>(typeof D=="function"&&D(z),z),z=>{throw typeof L=="function"&&L(z),z})}},gle={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},_le=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),d={...gle,...u},p=i(h,d),_=o(h),y=_?t():null;super(l,!1,p,y),this._Q=e(this,_,p.Q,Qc,Al),this._detune=e(this,_,p.detune,1200*Math.log2(Qc),-1200*Math.log2(Qc)),this._frequency=e(this,_,p.frequency,l.sampleRate/2,0),this._gain=e(this,_,p.gain,40*Math.log10(Qc),Al),this._nativeBiquadFilterNode=p,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?r():d}if(l.length!==u.length||u.length!==h.length)throw r()}},vle=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=xc(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},yle=(n,e)=>(t,r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n.get(t);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},Sle={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Ele=(n,e,t,r,i)=>class extends n{constructor(o,a){const c=r(o),l={...Sle,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},ble=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!xc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},Tle={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},xle=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=s({...Tle,...c}),h=t(l,u),d=i(l)?e():null;super(a,!1,h,d)}},wle=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!xc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},Cle=n=>(e,t,r)=>n(t,e,r),Rle=n=>(e,t,r=0,i=0)=>{const s=e[r];if(s===void 0)throw n();return $x(t)?s.connect(t,0,i):s.connect(t,0)},Ale=n=>(e,t)=>{const r=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(t),r.start(),()=>{r.stop(),r.disconnect(t)}},Mle={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Ile=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...Mle,...l},d=r(u,h),p=s(u),_=p?t():null;super(c,!1,d,_),this._constantSourceNodeRenderer=_,this._nativeConstantSourceNode=d,this._offset=e(this,p,d.offset,Qc,Al),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Ey(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),im(this)&&zE(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},kle=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const d=xc(h,u);if(!d){const p={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,p),o!==null&&h.start(o),a!==null&&h.stop(a)}return s.set(u,h),d?await n(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Ole=n=>e=>(n[0]=e,n[0]),Nle={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Ple=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u={...Nle,...c},h=t(l,u),p=i(l)?e():null;super(a,!1,h,p),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},Dle=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!xc(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return r.set(o,a),zy(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},Lle=(n,e)=>(t,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,r,i)}catch(s){throw s.name==="SyntaxError"?n():s}},Ule=()=>new DOMException("","DataCloneError"),m2=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(r=>{const i=()=>{t.onmessage=null,e.close(),t.close(),r()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},Fle=(n,e,t,r,i,s,o,a,c,l,u)=>(h,d)=>{const p=o(h)?h:s(h);if(i.has(d)){const _=t();return Promise.reject(_)}try{i.add(d)}catch{}return e(c,()=>c(p))?p.decodeAudioData(d).then(_=>(m2(d).catch(()=>{}),e(a,()=>a(_))||u(_),n.add(_),_)):new Promise((_,y)=>{const S=async()=>{try{await m2(d)}catch{}},T=A=>{y(A),S()};try{p.decodeAudioData(d,A=>{typeof A.copyFromChannel!="function"&&(l(A),hO(A)),n.add(A),S().then(()=>_(A))},A=>{T(A===null?r():A)})}catch(A){T(A)}})},Ble=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),d=a(h);if(u===l){if(e.delete(c),!d&&o(c)){const p=r(c),{outputs:_}=t(c);for(const y of _)if(jE(y)){const S=r(y[0]);n(p,S,y[1],y[2])}else{const S=i(y[0]);p.connect(S,y[1])}}}else e.set(c,u-l)},zle={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Vle=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...zle,...l},d=r(u,h),p=s(u),_=p?t(h.maxDelayTime):null;super(c,!1,d,_),this._delayTime=e(this,p,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},jle=(n,e,t,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=xc(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,d)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},Hle=n=>(e,t,r,i)=>n(e[i],s=>s[0]===t&&s[1]===r),Gle=n=>(e,t)=>{n(e).delete(t)},Wle=n=>"delayTime"in n,$le=(n,e,t)=>function r(i,s){const o=Hx(s)?s:t(n,s);if(Wle(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},lT=(n,e,t)=>{const r=e[t];if(r===void 0)throw n();return r},qle=n=>(e,t=void 0,r=void 0,i=0)=>t===void 0?e.forEach(s=>s.disconnect()):typeof t=="number"?lT(n,e,t).disconnect():$x(t)?r===void 0?e.forEach(s=>s.disconnect(t)):i===void 0?lT(n,e,r).disconnect(t,0):lT(n,e,r).disconnect(t,0,i):r===void 0?e.forEach(s=>s.disconnect(t)):lT(n,e,r).disconnect(t,0),Xle={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Kle=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),d={...Xle,...u},p=r(h,d),_=o(h),y=_?t():null;super(l,!1,p,y),this._attack=e(this,_,p.attack),this._knee=e(this,_,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=e(this,_,p.ratio),this._release=e(this,_,p.release),this._threshold=e(this,_,p.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Yle=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=xc(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Jle=()=>new DOMException("","EncodingError"),Qle=n=>e=>new Promise((t,r)=>{if(n===null){r(new SyntaxError);return}const i=n.document.head;if(i===null)r(new SyntaxError);else{const s=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,d,p,_)=>{if(h===a||h===n.location.href&&d===1&&p===1)return l(),r(_),!1;if(c!==null)return c(u,h,d,p,_)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),t()},s.src=a,s.type="module",i.appendChild(s)}}),Zle=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=n(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(t,s,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(t,s===void 0?null:s,i)}},eue=n=>(e,t,r)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},tue=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},nue={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},rue=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...nue,...c},h=r(l,u),d=s(l),p=d?t():null;super(a,!1,h,p),this._gain=e(this,d,h.gain,Qc,Al)}get gain(){return this._gain}},iue=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=xc(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},sue=(n,e)=>t=>e(n,t),oue=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},aue=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},cue=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},lue=n=>e=>n.get(e),Ua=()=>new DOMException("","InvalidStateError"),uue=n=>e=>{const t=n.get(e);if(t===void 0)throw Ua();return t},hue=(n,e)=>t=>{let r=n.get(t);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),n.set(t,r),r},due=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},gC=()=>new DOMException("","InvalidAccessError"),fue=n=>{n.getFrequencyResponse=(e=>(t,r,i)=>{if(t.length!==r.length||r.length!==i.length)throw gC();return e.call(n,t,r,i)})(n.getFrequencyResponse)},pue={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},mue=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=i(l),h={...pue,...c},d=e(l,u?null:a.baseLatency,h),p=u?t(h.feedback,h.feedforward):null;super(a,!1,d,p),fue(d),this._nativeIIRFilterNode=d,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},q5=(n,e,t,r,i,s,o,a,c,l,u)=>{const h=l.length;let d=a;for(let p=0;p<h;p+=1){let _=t[0]*l[p];for(let y=1;y<i;y+=1){const S=d-y&c-1;_+=t[y]*s[S],_-=n[y]*o[S]}for(let y=i;y<r;y+=1)_+=t[y]*s[d-y&c-1];for(let y=i;y<e;y+=1)_-=n[y]*o[d-y&c-1];s[d]=l[p],o[d]=_,d=d+1&c-1,u[p]=_}return d},gue=(n,e,t,r)=>{const i=t instanceof Float64Array?t:new Float64Array(t),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let _=0;_<o;_+=1)s[_]/=i[0];for(let _=1;_<a;_+=1)i[_]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),p=n.numberOfChannels;for(let _=0;_<p;_+=1){const y=n.getChannelData(_),S=d.getChannelData(_);u.fill(0),h.fill(0),q5(i,o,s,a,c,u,h,0,l,y,S)}return d},_ue=(n,e,t,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,p=e(u);const _=xc(p,h);if(h.createIIRFilter===void 0?d=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):_||(p=h.createIIRFilter(o,s)),a.set(h,d===null?p:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const S=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,S,S.destination);const T=await i(S);return gue(T,h,s,o)})()}const y=await c;return d.buffer=y,d.start(0),d}return await r(u,h,p),p};return{render(u,h){const d=a.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},vue=(n,e,t,r,i,s)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:h}=t(a);for(const d of h)if(jE(d)){const p=r(d[0]);e(u,p,d[1],d[2])}else{const p=i(d[0]);u.disconnect(p,d[1])}}n.set(a,c)}else n.set(a,l+c)},yue=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},Sue=(n,e)=>t=>n.has(t)||e(t),Eue=(n,e)=>t=>n.has(t)||e(t),bue=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},Tue=n=>e=>n!==null&&e instanceof n,xue=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,wue=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,Cue=(n,e)=>t=>n(t)||e(t),Rue=n=>e=>n!==null&&e instanceof n,Aue=n=>n!==null&&n.isSecureContext,Mue=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Iue={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},kue=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s);if(r(a))throw new TypeError;const c={...Iue,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Oue=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Nue=(n,e,t)=>class extends n{constructor(i,s){const o=t(i),a=e(o,s);super(i,!0,a,null)}},Pue=(n,e,t,r,i,s)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,pC.set(this,a),r(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},sE=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},Due=(n,e)=>(t,r,i)=>{const s=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(t,a,c,l),n(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&r(),a;o.call(t,a,c),n(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&r()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(t),s.clear();else if(typeof a=="number"){o.call(t,a);for(const d of s)d[1]===a&&s.delete(d)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const d of s)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&s.delete(d)}const h=s.size===0;u&&h&&i()})(t.disconnect),t},Os=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t]&&(n[t]=r)},va=(n,e)=>{Os(n,e,"channelCount"),Os(n,e,"channelCountMode"),Os(n,e,"channelInterpretation")},g2=n=>typeof n.getFloatTimeDomainData=="function",Lue=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const r=Math.max(t.length,n.fftSize);for(let i=0;i<r;i+=1)e[i]=(t[i]-128)*.0078125;return e}},Uue=(n,e)=>(t,r)=>{const i=t.createAnalyser();if(va(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Os(i,r,"fftSize"),Os(i,r,"maxDecibels"),Os(i,r,"minDecibels"),Os(i,r,"smoothingTimeConstant"),n(g2,()=>g2(i))||Lue(i),i},Fue=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,to=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t].value&&(n[t].value=r)},Bue=n=>{n.start=(e=>{let t=!1;return(r=0,i=0,s)=>{if(t)throw Ua();e.call(n,r,i,s),t=!0}})(n.start)},pO=n=>{n.start=(e=>(t=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,r,i)})(n.start)},mO=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},zue=(n,e,t,r,i,s,o,a,c,l,u)=>(h,d)=>{const p=h.createBufferSource();return va(p,d),to(p,d,"playbackRate"),Os(p,d,"buffer"),Os(p,d,"loop"),Os(p,d,"loopEnd"),Os(p,d,"loopStart"),e(t,()=>t(h))||Bue(p),e(r,()=>r(h))||c(p),e(i,()=>i(h))||l(p,h),e(s,()=>s(h))||pO(p),e(o,()=>o(h))||u(p,h),e(a,()=>a(h))||mO(p),n(h,p),p},Vue=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,jue=(n,e)=>(t,r,i)=>{const s=t.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=n(t,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},Hue=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,Gue=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},Wue=(n,e,t,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const h=new a(s,c,u),d=new Map;let p=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>p,set:_=>{typeof p=="function"&&h.removeEventListener("processorerror",p),p=typeof _=="function"?_:null,typeof p=="function"&&h.addEventListener("processorerror",p)}}}),h.addEventListener=(_=>(...y)=>{if(y[0]==="processorerror"){const S=typeof y[1]=="function"?y[1]:typeof y[1]=="object"&&y[1]!==null&&typeof y[1].handleEvent=="function"?y[1].handleEvent:null;if(S!==null){const T=d.get(y[1]);T!==void 0?y[1]=T:(y[1]=A=>{A.type==="error"?(Object.defineProperties(A,{type:{value:"processorerror"}}),S(A)):S(new ErrorEvent(y[0],{...A}))},d.set(S,y[1]))}}return _.call(h,"error",y[1],y[2]),_.call(h,...y)})(h.addEventListener),h.removeEventListener=(_=>(...y)=>{if(y[0]==="processorerror"){const S=d.get(y[1]);S!==void 0&&(d.delete(y[1]),y[1]=S)}return _.call(h,"error",y[1],y[2]),_.call(h,y[0],y[1],y[2])})(h.removeEventListener),u.numberOfOutputs!==0){const _=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(_).connect(s.destination),i(h,()=>_.disconnect(),()=>_.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return Gue(u),e(s,o,l,u)},X5=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),$ue=n=>new Promise((e,t)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),t(s)},i.postMessage(n)}),que=async(n,e)=>{const t=await $ue(e);return new n(t)},Xue=(n,e,t,r)=>{let i=AM.get(n);i===void 0&&(i=new WeakMap,AM.set(n,i));const s=que(t,r);return i.set(e,s),s},Kue=(n,e,t,r,i,s,o,a,c,l,u,h,d)=>(p,_,y,S)=>{if(S.numberOfInputs===0&&S.numberOfOutputs===0)throw c();const T=Array.isArray(S.outputChannelCount)?S.outputChannelCount:Array.from(S.outputChannelCount);if(T.some(St=>St<1))throw c();if(T.length!==S.numberOfOutputs)throw e();if(S.channelCountMode!=="explicit")throw c();const A=S.channelCount*S.numberOfInputs,R=T.reduce((St,Qe)=>St+Qe,0),I=y.parameterDescriptors===void 0?0:y.parameterDescriptors.length;if(A+I>6||R>6)throw c();const U=new MessageChannel,D=[],L=[];for(let St=0;St<S.numberOfInputs;St+=1)D.push(o(p,{channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,gain:1})),L.push(i(p,{channelCount:S.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:S.channelCount}));const z=[];if(y.parameterDescriptors!==void 0)for(const{defaultValue:St,maxValue:Qe,minValue:nn,name:Ot}of y.parameterDescriptors){const rt=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:S.parameterData[Ot]!==void 0?S.parameterData[Ot]:St===void 0?0:St});Object.defineProperties(rt.offset,{defaultValue:{get:()=>St===void 0?0:St},maxValue:{get:()=>Qe===void 0?Qc:Qe},minValue:{get:()=>nn===void 0?Al:nn}}),z.push(rt)}const F=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,A+I)}),V=X5(_,p.sampleRate),W=a(p,V,A+I,Math.max(1,R)),X=i(p,{channelCount:Math.max(1,R),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,R)}),$=[];for(let St=0;St<S.numberOfOutputs;St+=1)$.push(r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:T[St]}));for(let St=0;St<S.numberOfInputs;St+=1){D[St].connect(L[St]);for(let Qe=0;Qe<S.channelCount;Qe+=1)L[St].connect(F,Qe,St*S.channelCount+Qe)}const K=new W5(y.parameterDescriptors===void 0?[]:y.parameterDescriptors.map(({name:St},Qe)=>{const nn=z[Qe];return nn.connect(F,0,A+Qe),nn.start(0),[St,nn.offset]}));F.connect(W);let te=S.channelInterpretation,Q=null;const ne=S.numberOfOutputs===0?[W]:$,G={get bufferSize(){return V},get channelCount(){return S.channelCount},set channelCount(St){throw t()},get channelCountMode(){return S.channelCountMode},set channelCountMode(St){throw t()},get channelInterpretation(){return te},set channelInterpretation(St){for(const Qe of D)Qe.channelInterpretation=St;te=St},get context(){return W.context},get inputs(){return D},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get onprocessorerror(){return Q},set onprocessorerror(St){typeof Q=="function"&&G.removeEventListener("processorerror",Q),Q=typeof St=="function"?St:null,typeof Q=="function"&&G.addEventListener("processorerror",Q)},get parameters(){return K},get port(){return U.port2},addEventListener(...St){return W.addEventListener(St[0],St[1],St[2])},connect:n.bind(null,ne),disconnect:l.bind(null,ne),dispatchEvent(...St){return W.dispatchEvent(St[0])},removeEventListener(...St){return W.removeEventListener(St[0],St[1],St[2])}},J=new Map;U.port1.addEventListener=(St=>(...Qe)=>{if(Qe[0]==="message"){const nn=typeof Qe[1]=="function"?Qe[1]:typeof Qe[1]=="object"&&Qe[1]!==null&&typeof Qe[1].handleEvent=="function"?Qe[1].handleEvent:null;if(nn!==null){const Ot=J.get(Qe[1]);Ot!==void 0?Qe[1]=Ot:(Qe[1]=rt=>{u(p.currentTime,p.sampleRate,()=>nn(rt))},J.set(nn,Qe[1]))}}return St.call(U.port1,Qe[0],Qe[1],Qe[2])})(U.port1.addEventListener),U.port1.removeEventListener=(St=>(...Qe)=>{if(Qe[0]==="message"){const nn=J.get(Qe[1]);nn!==void 0&&(J.delete(Qe[1]),Qe[1]=nn)}return St.call(U.port1,Qe[0],Qe[1],Qe[2])})(U.port1.removeEventListener);let re=null;Object.defineProperty(U.port1,"onmessage",{get:()=>re,set:St=>{typeof re=="function"&&U.port1.removeEventListener("message",re),re=typeof St=="function"?St:null,typeof re=="function"&&(U.port1.addEventListener("message",re),U.port1.start())}}),y.prototype.port=U.port1;let ue=null;Xue(p,G,y,S).then(St=>ue=St);const Ne=Xx(S.numberOfInputs,S.channelCount),_e=Xx(S.numberOfOutputs,T),Ae=y.parameterDescriptors===void 0?[]:y.parameterDescriptors.reduce((St,{name:Qe})=>({...St,[Qe]:new Float32Array(128)}),{});let Ye=!0;const Ze=()=>{S.numberOfOutputs>0&&W.disconnect(X);for(let St=0,Qe=0;St<S.numberOfOutputs;St+=1){const nn=$[St];for(let Ot=0;Ot<T[St];Ot+=1)X.disconnect(nn,Qe+Ot,Ot);Qe+=T[St]}},Ke=new Map;W.onaudioprocess=({inputBuffer:St,outputBuffer:Qe})=>{if(ue!==null){const nn=h(G);for(let Ot=0;Ot<V;Ot+=128){for(let rt=0;rt<S.numberOfInputs;rt+=1)for(let nt=0;nt<S.channelCount;nt+=1)qx(St,Ne[rt],nt,nt,Ot);y.parameterDescriptors!==void 0&&y.parameterDescriptors.forEach(({name:rt},nt)=>{qx(St,Ae,rt,A+nt,Ot)});for(let rt=0;rt<S.numberOfInputs;rt+=1)for(let nt=0;nt<T[rt];nt+=1)_e[rt][nt].byteLength===0&&(_e[rt][nt]=new Float32Array(128));try{const rt=Ne.map((pe,oe)=>{if(nn[oe].size>0)return Ke.set(oe,V/128),pe;const Je=Ke.get(oe);return Je===void 0?[]:(pe.every(ut=>ut.every(ot=>ot===0))&&(Je===1?Ke.delete(oe):Ke.set(oe,Je-1)),pe)});Ye=u(p.currentTime+Ot/p.sampleRate,p.sampleRate,()=>ue.process(rt,_e,Ae));for(let pe=0,oe=0;pe<S.numberOfOutputs;pe+=1){for(let ke=0;ke<T[pe];ke+=1)$5(Qe,_e[pe],ke,oe+ke,Ot);oe+=T[pe]}}catch(rt){Ye=!1,G.dispatchEvent(new ErrorEvent("processorerror",{colno:rt.colno,filename:rt.filename,lineno:rt.lineno,message:rt.message}))}if(!Ye){for(let rt=0;rt<S.numberOfInputs;rt+=1){D[rt].disconnect(L[rt]);for(let nt=0;nt<S.channelCount;nt+=1)L[Ot].disconnect(F,nt,rt*S.channelCount+nt)}if(y.parameterDescriptors!==void 0){const rt=y.parameterDescriptors.length;for(let nt=0;nt<rt;nt+=1){const pe=z[nt];pe.disconnect(F,0,A+nt),pe.stop()}}F.disconnect(W),W.onaudioprocess=null,It?Ze():Kt();break}}}};let It=!1;const Xt=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Qt=()=>W.connect(Xt).connect(p.destination),Kt=()=>{W.disconnect(Xt),Xt.disconnect()},xn=()=>{if(Ye){Kt(),S.numberOfOutputs>0&&W.connect(X);for(let St=0,Qe=0;St<S.numberOfOutputs;St+=1){const nn=$[St];for(let Ot=0;Ot<T[St];Ot+=1)X.connect(nn,Qe+Ot,Ot);Qe+=T[St]}}It=!0},Re=()=>{Ye&&(Qt(),Ze()),It=!1};return Qt(),d(G,xn,Re)},K5=(n,e)=>{const t=n.createBiquadFilter();return va(t,e),to(t,e,"Q"),to(t,e,"detune"),to(t,e,"frequency"),to(t,e,"gain"),Os(t,e,"type"),t},Yue=(n,e)=>(t,r)=>{const i=t.createChannelMerger(r.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),va(i,r),i},Jue=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Ua()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw Ua()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw Ua()}})},HE=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return va(t,e),Jue(t),t},Que=(n,e,t,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return t(s,o);const a=s.createConstantSource();return va(a,o),to(a,o,"offset"),e(r,()=>r(s))||pO(a),e(i,()=>i(s))||mO(a),n(s,a),a},Vy=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),Zue=(n,e,t,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(_){l.channelCount=_},get channelCountMode(){return l.channelCountMode},set channelCountMode(_){l.channelCountMode=_},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(_){l.channelInterpretation=_},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(_){c.onended=_},addEventListener(..._){return c.addEventListener(_[0],_[1],_[2])},dispatchEvent(..._){return c.dispatchEvent(_[0])},removeEventListener(..._){return c.removeEventListener(_[0],_[1],_[2])},start(_=0){c.start.call(c,_)},stop(_=0){c.stop.call(c,_)}},d=()=>c.connect(l),p=()=>c.disconnect(l);return n(i,c),r(Vy(h,l),d,p)},ehe=(n,e)=>(t,r)=>{const i=t.createConvolver();if(va(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Os(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw n();return s.call(i,o)}),r.channelCountMode==="max"))throw n();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw n();return s.call(i,o)}),i},Y5=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return va(t,e),to(t,e,"delayTime"),t},the=n=>(e,t)=>{const r=e.createDynamicsCompressor();if(va(r,t),t.channelCount>2||t.channelCountMode==="max")throw n();return to(r,t,"attack"),to(r,t,"knee"),to(r,t,"ratio"),to(r,t,"release"),to(r,t,"threshold"),r},zl=(n,e)=>{const t=n.createGain();return va(t,e),to(t,e,"gain"),t},nhe=n=>(e,t,r)=>{if(e.createIIRFilter===void 0)return n(e,t,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return va(i,r),i};function rhe(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function ihe(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function _2(n,e){let t=[0,0];for(let r=n.length-1;r>=0;r-=1)t=ihe(t,e),t[0]+=n[r];return t}const she=(n,e,t,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=X5(s,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=u instanceof Float64Array?u:new Float64Array(u),_=d.length,y=p.length,S=Math.min(_,y);if(_===0||_>20)throw r();if(d[0]===0)throw e();if(y===0||y>20)throw r();if(p[0]===0)throw e();if(d[0]!==1){for(let z=0;z<y;z+=1)p[z]/=d[0];for(let z=1;z<_;z+=1)d[z]/=d[0]}const T=t(i,h,o,o);T.channelCount=o,T.channelCountMode=a,T.channelInterpretation=c;const A=32,R=[],I=[],U=[];for(let z=0;z<o;z+=1){R.push(0);const F=new Float32Array(A),V=new Float32Array(A);F.fill(0),V.fill(0),I.push(F),U.push(V)}T.onaudioprocess=z=>{const F=z.inputBuffer,V=z.outputBuffer,W=F.numberOfChannels;for(let X=0;X<W;X+=1){const $=F.getChannelData(X),K=V.getChannelData(X);R[X]=q5(d,_,p,y,S,I[X],U[X],R[X],A,$,K)}};const D=i.sampleRate/2;return Vy({get bufferSize(){return h},get channelCount(){return T.channelCount},set channelCount(z){T.channelCount=z},get channelCountMode(){return T.channelCountMode},set channelCountMode(z){T.channelCountMode=z},get channelInterpretation(){return T.channelInterpretation},set channelInterpretation(z){T.channelInterpretation=z},get context(){return T.context},get inputs(){return[T]},get numberOfInputs(){return T.numberOfInputs},get numberOfOutputs(){return T.numberOfOutputs},addEventListener(...z){return T.addEventListener(z[0],z[1],z[2])},dispatchEvent(...z){return T.dispatchEvent(z[0])},getFrequencyResponse(z,F,V){if(z.length!==F.length||F.length!==V.length)throw n();const W=z.length;for(let X=0;X<W;X+=1){const $=-Math.PI*(z[X]/D),K=[Math.cos($),Math.sin($)],te=_2(p,K),Q=_2(d,K),ne=rhe(te,Q);F[X]=Math.sqrt(ne[0]*ne[0]+ne[1]*ne[1]),V[X]=Math.atan2(ne[1],ne[0])}},removeEventListener(...z){return T.removeEventListener(z[0],z[1],z[2])}},T)},ohe=(n,e)=>n.createMediaElementSource(e.mediaElement),ahe=(n,e)=>{const t=n.createMediaStreamDestination();return va(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},che=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},lhe=(n,e)=>(t,{mediaStreamTrack:r})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=t.createMediaStreamSource(i);if(r.kind!=="audio")throw n();if(e(t))throw new TypeError;return s},uhe=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,hhe=(n,e,t,r,i,s)=>(o,a)=>{const c=o.createOscillator();return va(c,a),to(c,a,"detune"),to(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Os(c,a,"type"),e(t,()=>t(o))||pO(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||mO(c),n(o,c),c},dhe=n=>(e,t)=>{const r=e.createPanner();return r.orientationX===void 0?n(e,t):(va(r,t),to(r,t,"orientationX"),to(r,t,"orientationY"),to(r,t,"orientationZ"),to(r,t,"positionX"),to(r,t,"positionY"),to(r,t,"positionZ"),Os(r,t,"coneInnerAngle"),Os(r,t,"coneOuterAngle"),Os(r,t,"coneOuterGain"),Os(r,t,"distanceModel"),Os(r,t,"maxDistance"),Os(r,t,"panningModel"),Os(r,t,"refDistance"),Os(r,t,"rolloffFactor"),r)},fhe=(n,e,t,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:p,distanceModel:_,maxDistance:y,orientationX:S,orientationY:T,orientationZ:A,panningModel:R,positionX:I,positionY:U,positionZ:D,refDistance:L,rolloffFactor:z,...F})=>{const V=u.createPanner();if(F.channelCount>2||F.channelCountMode==="max")throw o();va(V,F);const W={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},X=t(u,{...W,channelInterpretation:"speakers",numberOfInputs:6}),$=r(u,{...F,gain:1}),K=r(u,{...W,gain:1}),te=r(u,{...W,gain:0}),Q=r(u,{...W,gain:0}),ne=r(u,{...W,gain:0}),G=r(u,{...W,gain:0}),J=r(u,{...W,gain:0}),re=i(u,256,6,1),ue=s(u,{...W,curve:new Float32Array([1,1]),oversample:"none"});let ye=[S,T,A],Ne=[I,U,D];const _e=new Float32Array(1);re.onaudioprocess=({inputBuffer:Ke})=>{const It=[c(Ke,_e,0),c(Ke,_e,1),c(Ke,_e,2)];It.some((Qt,Kt)=>Qt!==ye[Kt])&&(V.setOrientation(...It),ye=It);const Xt=[c(Ke,_e,3),c(Ke,_e,4),c(Ke,_e,5)];Xt.some((Qt,Kt)=>Qt!==Ne[Kt])&&(V.setPosition(...Xt),Ne=Xt)},Object.defineProperty(te.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ne.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(J.gain,"defaultValue",{get:()=>0});const Ae={get bufferSize(){},get channelCount(){return V.channelCount},set channelCount(Ke){if(Ke>2)throw o();$.channelCount=Ke,V.channelCount=Ke},get channelCountMode(){return V.channelCountMode},set channelCountMode(Ke){if(Ke==="max")throw o();$.channelCountMode=Ke,V.channelCountMode=Ke},get channelInterpretation(){return V.channelInterpretation},set channelInterpretation(Ke){$.channelInterpretation=Ke,V.channelInterpretation=Ke},get coneInnerAngle(){return V.coneInnerAngle},set coneInnerAngle(Ke){V.coneInnerAngle=Ke},get coneOuterAngle(){return V.coneOuterAngle},set coneOuterAngle(Ke){V.coneOuterAngle=Ke},get coneOuterGain(){return V.coneOuterGain},set coneOuterGain(Ke){if(Ke<0||Ke>1)throw e();V.coneOuterGain=Ke},get context(){return V.context},get distanceModel(){return V.distanceModel},set distanceModel(Ke){V.distanceModel=Ke},get inputs(){return[$]},get maxDistance(){return V.maxDistance},set maxDistance(Ke){if(Ke<0)throw new RangeError;V.maxDistance=Ke},get numberOfInputs(){return V.numberOfInputs},get numberOfOutputs(){return V.numberOfOutputs},get orientationX(){return K.gain},get orientationY(){return te.gain},get orientationZ(){return Q.gain},get panningModel(){return V.panningModel},set panningModel(Ke){V.panningModel=Ke},get positionX(){return ne.gain},get positionY(){return G.gain},get positionZ(){return J.gain},get refDistance(){return V.refDistance},set refDistance(Ke){if(Ke<0)throw new RangeError;V.refDistance=Ke},get rolloffFactor(){return V.rolloffFactor},set rolloffFactor(Ke){if(Ke<0)throw new RangeError;V.rolloffFactor=Ke},addEventListener(...Ke){return $.addEventListener(Ke[0],Ke[1],Ke[2])},dispatchEvent(...Ke){return $.dispatchEvent(Ke[0])},removeEventListener(...Ke){return $.removeEventListener(Ke[0],Ke[1],Ke[2])}};h!==Ae.coneInnerAngle&&(Ae.coneInnerAngle=h),d!==Ae.coneOuterAngle&&(Ae.coneOuterAngle=d),p!==Ae.coneOuterGain&&(Ae.coneOuterGain=p),_!==Ae.distanceModel&&(Ae.distanceModel=_),y!==Ae.maxDistance&&(Ae.maxDistance=y),S!==Ae.orientationX.value&&(Ae.orientationX.value=S),T!==Ae.orientationY.value&&(Ae.orientationY.value=T),A!==Ae.orientationZ.value&&(Ae.orientationZ.value=A),R!==Ae.panningModel&&(Ae.panningModel=R),I!==Ae.positionX.value&&(Ae.positionX.value=I),U!==Ae.positionY.value&&(Ae.positionY.value=U),D!==Ae.positionZ.value&&(Ae.positionZ.value=D),L!==Ae.refDistance&&(Ae.refDistance=L),z!==Ae.rolloffFactor&&(Ae.rolloffFactor=z),(ye[0]!==1||ye[1]!==0||ye[2]!==0)&&V.setOrientation(...ye),(Ne[0]!==0||Ne[1]!==0||Ne[2]!==0)&&V.setPosition(...Ne);const Ye=()=>{$.connect(V),n($,ue,0,0),ue.connect(K).connect(X,0,0),ue.connect(te).connect(X,0,1),ue.connect(Q).connect(X,0,2),ue.connect(ne).connect(X,0,3),ue.connect(G).connect(X,0,4),ue.connect(J).connect(X,0,5),X.connect(re).connect(u.destination)},Ze=()=>{$.disconnect(V),a($,ue,0,0),ue.disconnect(K),K.disconnect(X),ue.disconnect(te),te.disconnect(X),ue.disconnect(Q),Q.disconnect(X),ue.disconnect(ne),ne.disconnect(X),ue.disconnect(G),G.disconnect(X),ue.disconnect(J),J.disconnect(X),X.disconnect(re),re.disconnect(u.destination)};return l(Vy(Ae,V),Ye,Ze)},phe=n=>(e,{disableNormalization:t,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:t});if(Array.from(r).length<2)throw n();return a},GE=(n,e,t,r)=>n.createScriptProcessor(e,t,r),mhe=(n,e)=>(t,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,r);const s=t.createStereoPanner();return va(s,r),to(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},ghe=(n,e,t,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(_,y,S,T)=>{const A=new Float32Array(16385),R=new Float32Array(16385);for(let F=0;F<16385;F+=1){const V=F/16384*c;A[F]=Math.cos(V),R[F]=Math.sin(V)}const I=t(_,{...l,gain:0}),U=r(_,{...u,curve:A}),D=r(_,{...u,curve:a}),L=t(_,{...l,gain:0}),z=r(_,{...u,curve:R});return{connectGraph(){y.connect(I),y.connect(D.inputs===void 0?D:D.inputs[0]),y.connect(L),D.connect(S),S.connect(U.inputs===void 0?U:U.inputs[0]),S.connect(z.inputs===void 0?z:z.inputs[0]),U.connect(I.gain),z.connect(L.gain),I.connect(T,0,0),L.connect(T,0,1)},disconnectGraph(){y.disconnect(I),y.disconnect(D.inputs===void 0?D:D.inputs[0]),y.disconnect(L),D.disconnect(S),S.disconnect(U.inputs===void 0?U:U.inputs[0]),S.disconnect(z.inputs===void 0?z:z.inputs[0]),U.disconnect(I.gain),z.disconnect(L.gain),I.disconnect(T,0,0),L.disconnect(T,0,1)}}},d=(_,y,S,T)=>{const A=new Float32Array(16385),R=new Float32Array(16385),I=new Float32Array(16385),U=new Float32Array(16385),D=Math.floor(16385/2);for(let ne=0;ne<16385;ne+=1)if(ne>D){const G=(ne-D)/(16384-D)*c;A[ne]=Math.cos(G),R[ne]=Math.sin(G),I[ne]=0,U[ne]=1}else{const G=ne/(16384-D)*c;A[ne]=1,R[ne]=0,I[ne]=Math.cos(G),U[ne]=Math.sin(G)}const L=e(_,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),z=t(_,{...l,gain:0}),F=r(_,{...u,curve:A}),V=t(_,{...l,gain:0}),W=r(_,{...u,curve:R}),X=r(_,{...u,curve:a}),$=t(_,{...l,gain:0}),K=r(_,{...u,curve:I}),te=t(_,{...l,gain:0}),Q=r(_,{...u,curve:U});return{connectGraph(){y.connect(L),y.connect(X.inputs===void 0?X:X.inputs[0]),L.connect(z,0),L.connect(V,0),L.connect($,1),L.connect(te,1),X.connect(S),S.connect(F.inputs===void 0?F:F.inputs[0]),S.connect(W.inputs===void 0?W:W.inputs[0]),S.connect(K.inputs===void 0?K:K.inputs[0]),S.connect(Q.inputs===void 0?Q:Q.inputs[0]),F.connect(z.gain),W.connect(V.gain),K.connect($.gain),Q.connect(te.gain),z.connect(T,0,0),$.connect(T,0,0),V.connect(T,0,1),te.connect(T,0,1)},disconnectGraph(){y.disconnect(L),y.disconnect(X.inputs===void 0?X:X.inputs[0]),L.disconnect(z,0),L.disconnect(V,0),L.disconnect($,1),L.disconnect(te,1),X.disconnect(S),S.disconnect(F.inputs===void 0?F:F.inputs[0]),S.disconnect(W.inputs===void 0?W:W.inputs[0]),S.disconnect(K.inputs===void 0?K:K.inputs[0]),S.disconnect(Q.inputs===void 0?Q:Q.inputs[0]),F.disconnect(z.gain),W.disconnect(V.gain),K.disconnect($.gain),Q.disconnect(te.gain),z.disconnect(T,0,0),$.disconnect(T,0,0),V.disconnect(T,0,1),te.disconnect(T,0,1)}}},p=(_,y,S,T,A)=>{if(y===1)return h(_,S,T,A);if(y===2)return d(_,S,T,A);throw i()};return(_,{channelCount:y,channelCountMode:S,pan:T,...A})=>{if(S==="max")throw i();const R=n(_,{...A,channelCount:1,channelCountMode:S,numberOfInputs:2}),I=t(_,{...A,channelCount:y,channelCountMode:S,gain:1}),U=t(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:T});let{connectGraph:D,disconnectGraph:L}=p(_,y,I,U,R);Object.defineProperty(U.gain,"defaultValue",{get:()=>0}),Object.defineProperty(U.gain,"maxValue",{get:()=>1}),Object.defineProperty(U.gain,"minValue",{get:()=>-1});const z={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(X){I.channelCount!==X&&(F&&L(),{connectGraph:D,disconnectGraph:L}=p(_,X,I,U,R),F&&D()),I.channelCount=X},get channelCountMode(){return I.channelCountMode},set channelCountMode(X){if(X==="clamped-max"||X==="max")throw i();I.channelCountMode=X},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(X){I.channelInterpretation=X},get context(){return I.context},get inputs(){return[I]},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get pan(){return U.gain},addEventListener(...X){return I.addEventListener(X[0],X[1],X[2])},dispatchEvent(...X){return I.dispatchEvent(X[0])},removeEventListener(...X){return I.removeEventListener(X[0],X[1],X[2])}};let F=!1;const V=()=>{D(),F=!0},W=()=>{L(),F=!1};return s(Vy(z,R),V,W)}},_he=(n,e,t,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);va(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Os(l,{curve:u},"curve"),Os(l,c,"oversample");let h=null,d=!1;return o(l,"curve",y=>()=>y.call(l),y=>S=>(y.call(l,S),d&&(r(S)&&h===null?h=n(a,l):!r(S)&&h!==null&&(h(),h=null)),S)),i(l,()=>{d=!0,r(l.curve)&&(h=n(a,l))},()=>{d=!1,h!==null&&(h(),h=null)})},vhe=(n,e,t,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();va(l,c),va(u,c);const h=t(s,{...c,gain:1}),d=t(s,{...c,gain:-1}),p=t(s,{...c,gain:1}),_=t(s,{...c,gain:-1});let y=null,S=!1,T=null;const A={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(U){h.channelCount=U,d.channelCount=U,l.channelCount=U,p.channelCount=U,u.channelCount=U,_.channelCount=U},get channelCountMode(){return l.channelCountMode},set channelCountMode(U){h.channelCountMode=U,d.channelCountMode=U,l.channelCountMode=U,p.channelCountMode=U,u.channelCountMode=U,_.channelCountMode=U},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(U){h.channelInterpretation=U,d.channelInterpretation=U,l.channelInterpretation=U,p.channelInterpretation=U,u.channelInterpretation=U,_.channelInterpretation=U},get context(){return l.context},get curve(){return T},set curve(U){if(U!==null&&U.length<2)throw e();if(U===null)l.curve=U,u.curve=U;else{const D=U.length,L=new Float32Array(D+2-D%2),z=new Float32Array(D+2-D%2);L[0]=U[0],z[0]=-U[D-1];const F=Math.ceil((D+1)/2),V=(D+1)/2-1;for(let W=1;W<F;W+=1){const X=W/F*V,$=Math.floor(X),K=Math.ceil(X);L[W]=$===K?U[$]:(1-(X-$))*U[$]+(1-(K-X))*U[K],z[W]=$===K?-U[D-1-$]:-((1-(X-$))*U[D-1-$])-(1-(K-X))*U[D-1-K]}L[F]=D%2===1?U[F-1]:(U[F-2]+U[F-1])/2,l.curve=L,u.curve=z}T=U,S&&(r(T)&&y===null?y=n(s,h):y!==null&&(y(),y=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(U){l.oversample=U,u.oversample=U},addEventListener(...U){return h.addEventListener(U[0],U[1],U[2])},dispatchEvent(...U){return h.dispatchEvent(U[0])},removeEventListener(...U){return h.removeEventListener(U[0],U[1],U[2])}};o!==null&&(A.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==A.oversample&&(A.oversample=a);const R=()=>{h.connect(l).connect(p),h.connect(d).connect(u).connect(_).connect(p),S=!0,r(T)&&(y=n(s,h))},I=()=>{h.disconnect(l),l.disconnect(p),h.disconnect(d),d.disconnect(u),u.disconnect(_),_.disconnect(p),S=!1,y!==null&&(y(),y=null)};return i(Vy(A,p),R,I)},al=()=>new DOMException("","NotSupportedError"),yhe={numberOfChannels:1},She=(n,e,t,r,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...yhe,...l},p=r(h,u,d);e(sE,()=>sE(p))||p.addEventListener("statechange",(()=>{let _=0;const y=S=>{this._state==="running"&&(_>0?(p.removeEventListener("statechange",y),S.stopImmediatePropagation(),this._waitForThePromiseToSettle(S)):_+=1)};return y})()),super(p,h),this._length=u,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,V5(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},Ehe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},bhe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...Ehe,...l},d=t(u,h),p=s(u),_=p?r():null,y=c.sampleRate/2;super(c,!1,d,_),this._detune=e(this,p,d.detune,153600,-153600),this._frequency=e(this,p,d.frequency,y,-y),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=_,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Ey(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),im(this)&&zE(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},The=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let d=t(u);const p=xc(d,h);if(!p){const _={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:o===null?void 0:o,type:d.type};d=e(h,_),a!==null&&d.start(a),c!==null&&d.stop(c)}return s.set(h,d),p?(await n(h,u.detune,d.detune),await n(h,u.frequency,d.frequency)):(await r(h,u.detune,d.detune),await r(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const d=s.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},xhe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},whe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...xhe,...l},d=t(u,h),p=s(u),_=p?r():null;super(c,!1,d,_),this._nativePannerNode=d,this._orientationX=e(this,p,d.orientationX,Qc,Al),this._orientationY=e(this,p,d.orientationY,Qc,Al),this._orientationZ=e(this,p,d.orientationZ,Qc,Al),this._positionX=e(this,p,d.positionX,Qc,Al),this._positionY=e(this,p,d.positionY,Qc,Al),this._positionZ=e(this,p,d.positionZ,Qc,Al),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Che=(n,e,t,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(p,_)=>{let y=null,S=s(p);const T={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation},A={...T,coneInnerAngle:S.coneInnerAngle,coneOuterAngle:S.coneOuterAngle,coneOuterGain:S.coneOuterGain,distanceModel:S.distanceModel,maxDistance:S.maxDistance,panningModel:S.panningModel,refDistance:S.refDistance,rolloffFactor:S.rolloffFactor},R=xc(S,_);if("bufferSize"in S)y=r(_,{...T,gain:1});else if(!R){const I={...A,orientationX:S.orientationX.value,orientationY:S.orientationY.value,orientationZ:S.orientationZ.value,positionX:S.positionX.value,positionY:S.positionY.value,positionZ:S.positionZ.value};S=i(_,I)}if(u.set(_,y===null?S:y),y!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const W=new o(6,p.context.length,_.sampleRate),X=e(W,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});X.connect(W.destination),h=(async()=>{const $=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(K,te)=>{const Q=t(W,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:te===0?1:0});return await a(W,K,Q.offset),Q}));for(let K=0;K<6;K+=1)$[K].connect(X,0,K),$[K].start(0);return l(W)})()}const I=await h,U=r(_,{...T,gain:1});await c(p,_,U);const D=[];for(let W=0;W<I.numberOfChannels;W+=1)D.push(I.getChannelData(W));let L=[D[0][0],D[1][0],D[2][0]],z=[D[3][0],D[4][0],D[5][0]],F=r(_,{...T,gain:1}),V=i(_,{...A,orientationX:L[0],orientationY:L[1],orientationZ:L[2],positionX:z[0],positionY:z[1],positionZ:z[2]});U.connect(F).connect(V.inputs[0]),V.connect(y);for(let W=128;W<I.length;W+=128){const X=[D[0][W],D[1][W],D[2][W]],$=[D[3][W],D[4][W],D[5][W]];if(X.some((K,te)=>K!==L[te])||$.some((K,te)=>K!==z[te])){L=X,z=$;const K=W/_.sampleRate;F.gain.setValueAtTime(0,K),F=r(_,{...T,gain:0}),V=i(_,{...A,orientationX:L[0],orientationY:L[1],orientationZ:L[2],positionX:z[0],positionY:z[1],positionZ:z[2]}),F.gain.setValueAtTime(1,K),U.connect(F).connect(V.inputs[0]),V.connect(y)}}return y}return R?(await n(_,p.orientationX,S.orientationX),await n(_,p.orientationY,S.orientationY),await n(_,p.orientationZ,S.orientationZ),await n(_,p.positionX,S.positionX),await n(_,p.positionY,S.positionY),await n(_,p.positionZ,S.positionZ)):(await a(_,p.orientationX,S.orientationX),await a(_,p.orientationY,S.orientationY),await a(_,p.orientationZ,S.orientationZ),await a(_,p.positionX,S.positionX),await a(_,p.positionY,S.positionY),await a(_,p.positionZ,S.positionZ)),zy(S)?await c(p,_,S.inputs[0]):await c(p,_,S),S};return{render(p,_){const y=u.get(_);return y!==void 0?Promise.resolve(y):d(p,_)}}},Rhe={disableNormalization:!1},Ahe=(n,e,t,r)=>class J5{constructor(s,o){const a=e(s),c=r({...Rhe,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===J5.prototype||t.has(s)}},Mhe=(n,e)=>(t,r,i)=>(n(r).replay(i),e(r,t,i)),Ihe=(n,e,t)=>async(r,i,s)=>{const o=n(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const d=await e(l).render(l,i),p=r.context.destination;!t(l)&&(r!==p||!t(r))&&d.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},khe=(n,e,t)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(s,c)}))},Ohe=(n,e,t,r)=>i=>n(sE,()=>sE(i))?Promise.resolve(n(r,r)).then(s=>{if(!s){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),Nhe=n=>(e,t)=>{n.set(e,t)},Phe=n=>(e,t)=>n.set(e,t),Dhe=(n,e,t,r,i,s,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),hO(u)):e(s,()=>s(u))||a(u),n.add(u),u)),Lhe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Uhe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...Lhe,...c},h=t(l,u),d=s(l),p=d?r():null;super(a,!1,h,p),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},Fhe=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=xc(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.pan,l.pan):await r(c,a.pan,l.pan),zy(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Bhe=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},zhe=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(t);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new n(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},Vhe=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),r=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{r.disconnect(),i(t.currentTime!==0)},t.startRendering()})},jhe=()=>new DOMException("","UnknownError"),Hhe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Ghe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...Hhe,...l},d=t(u,h),_=s(u)?r():null;super(c,!0,d,_),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},Whe=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!xc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return r.set(o,a),zy(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},$he=()=>typeof window>"u"?null:window,qhe=(n,e)=>t=>{t.copyFromChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)r[h]=l[h+o]},t.copyToChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=r[h]}},Xhe=n=>e=>{e.copyFromChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyToChannel)},Khe=n=>(e,t)=>{const r=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),n(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},Yhe=(n,e)=>(t,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},Q5=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Z5=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},WE=(n,e,t,r)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(s),set:r(o)})},Jhe=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),Qhe=n=>({...n,channelCount:n.numberOfOutputs}),Zhe=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},ez=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(r){if(r.code!==9)throw r;ez(n,e,t+1e-7)}},ede=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},tde=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},nde=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},gO=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},tz=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},_O=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},rde=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},ide=n=>{n.start=(e=>(t=0,r=0,i)=>{const s=n.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},nz=(n,e)=>{const t=e.createGain();n.connect(t);const r=(i=>()=>{i.call(n,t),n.removeEventListener("ended",r)})(n.disconnect);n.addEventListener("ended",r),Vy(n,t),n.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),s=!0}})(n.stop)},jy=(n,e)=>t=>{const r={value:n};return Object.defineProperties(t,{currentTarget:r,target:r}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},sde=wce(M_),ode=kce(M_),ade=Hle(mC),rz=new WeakMap,cde=aue(rz),ad=yle(new Map,new WeakMap),Rf=$he(),iz=Uue(ad,Uf),vO=oue(el),oc=Ihe(el,vO,f_),lde=Lce(iz,xs,oc),fs=uue(pC),bm=uhe(Rf),Wi=Rue(bm),sz=new WeakMap,oz=Zle(jy),$E=Vue(Rf),yO=Tue($E),SO=xue(Rf),az=wue(Rf),oE=Hue(Rf),To=ale(Cce(P5),Ice(sde,ode,Gx,ade,Wx,el,cde,BE,xs,M_,im,f_,QT),ad,vue(CM,Wx,el,xs,iE,im),Uf,gC,al,Ble(Gx,CM,el,xs,iE,fs,im,Wi),$le(sz,el,nd),oz,fs,yO,SO,az,Wi,oE),ude=Dce(To,lde,Uf,iz,fs,Wi),EO=new WeakSet,v2=Fue(Rf),cz=Ole(new Uint32Array(1)),bO=qhe(cz,Uf),TO=Xhe(cz),lz=Fce(EO,ad,al,v2,bm,Bhe(v2),bO,TO),_C=Oce(zl),uz=khe(vO,VE,f_),Ff=Cle(uz),Hy=zue(_C,ad,ede,tde,nde,gO,tz,_O,ide,Khe(WE),nz),Bf=Mhe(cue(VE),uz),hde=Vce(Ff,Hy,xs,Bf,oc),cd=cle(Rce(D5),sz,uO,lle,yce,Sce,Ece,bce,Tce,TM,O5,$E,ez),dde=zce(To,hde,cd,Ua,Hy,fs,Wi,jy),fde=Yce(To,Jce,Uf,Ua,jue(zl,WE),fs,Wi,oc),pde=vle(Ff,K5,xs,Bf,oc),I_=Phe(rz),mde=_le(To,cd,pde,gC,K5,fs,Wi,I_),Jg=Due(M_,SO),gde=Yhe(Ua,Jg),Qg=Yue($E,gde),_de=ble(Qg,xs,oc),vde=Ele(To,_de,Qg,fs,Wi),yde=wle(HE,xs,oc),Sde=xle(To,yde,HE,fs,Wi,Qhe),Ede=Zue(_C,Hy,zl,Jg),Gy=Que(_C,ad,Ede,gO,_O),bde=kle(Ff,Gy,xs,Bf,oc),Tde=Ile(To,cd,bde,Gy,fs,Wi,jy),hz=ehe(al,WE),xde=Dle(hz,xs,oc),wde=Ple(To,xde,hz,fs,Wi,I_),Cde=jle(Ff,Y5,xs,Bf,oc),Rde=Vle(To,cd,Cde,Y5,fs,Wi,I_),dz=the(al),Ade=Yle(Ff,dz,xs,Bf,oc),Mde=Kle(To,cd,Ade,dz,al,fs,Wi,I_),Ide=iue(Ff,zl,xs,Bf,oc),kde=rue(To,cd,Ide,zl,fs,Wi),Ode=she(gC,Ua,GE,al),vC=Ohe(ad,zl,GE,Vhe(zl,bm)),Nde=_ue(Hy,xs,bm,oc,vC),Pde=nhe(Ode),Dde=mue(To,Pde,Nde,fs,Wi,I_),Lde=Qce(cd,Qg,Gy,GE,al,Q5,Wi,WE),fz=new WeakMap,Ude=Pue(fde,Lde,oz,Wi,fz,jy),pz=hhe(_C,ad,gO,tz,_O,nz),Fde=The(Ff,pz,xs,Bf,oc),Bde=bhe(To,cd,pz,Fde,fs,Wi,jy),mz=Ale(Hy),zde=vhe(mz,Ua,zl,Z5,Jg),yC=_he(mz,Ua,zde,Z5,Jg,$E,WE),Vde=fhe(Gx,Ua,Qg,zl,GE,yC,al,Wx,Q5,Jg),gz=dhe(Vde),jde=Che(Ff,Qg,Gy,zl,gz,xs,bm,Bf,oc,vC),Hde=whe(To,cd,gz,jde,fs,Wi,I_),Gde=phe(Uf),Wde=Ahe(Gde,fs,new WeakSet,Zhe),$de=ghe(Qg,HE,zl,yC,al,Jg),_z=mhe($de,al),qde=Fhe(Ff,_z,xs,Bf,oc),Xde=Uhe(To,cd,_z,qde,fs,Wi),Kde=Whe(yC,xs,oc),Yde=Ghe(To,Ua,yC,Kde,fs,Wi,I_),vz=Aue(Rf),xO=eue(Rf),yz=new WeakMap,Jde=hue(yz,bm),Qde=vz?Mce(ad,al,Qle(Rf),xO,tue(xce),fs,Jde,Wi,oE,new WeakMap,new WeakMap,zhe(oE,bm),Rf):void 0,Zde=Cue(yO,Wi),efe=Fle(EO,ad,Ule,Jle,new WeakSet,fs,Zde,jx,sE,bO,TO),Sz=mle(Qde,ude,lz,dde,mde,vde,Sde,Tde,wde,efe,Rde,Mde,kde,Dde,Ude,Bde,Hde,Wde,Xde,Yde),tfe=Mue(To,ohe,fs,Wi),nfe=kue(To,ahe,fs,Wi),rfe=Oue(To,che,fs,Wi),ife=lhe(Ua,Wi),sfe=Nue(To,ife,fs),ofe=Kce(Sz,Ua,al,jhe,tfe,nfe,rfe,sfe,$E),wO=due(fz),afe=Nce(wO),Ez=Rle(Uf),cfe=Gle(wO),bz=qle(Uf),Tz=new WeakMap,lfe=sue(Tz,nd),ufe=Kue(Ez,Uf,Ua,Qg,HE,Gy,zl,GE,al,bz,xO,lfe,Jg),hfe=Wue(Ua,ufe,zl,al,Jg),dfe=ple(Ff,Ez,Hy,Qg,HE,Gy,zl,cfe,bz,xO,xs,oE,bm,Bf,oc,vC),ffe=lue(yz),pfe=Nhe(Tz),y2=vz?hle(afe,To,cd,dfe,hfe,el,ffe,fs,Wi,oE,Jhe,pfe,rde,jy):void 0,mfe=Lle(al,bm),gfe=Dhe(EO,ad,vO,wO,vC,jx,bO,TO),_fe=She(Sz,ad,Ua,mfe,gfe),vfe=yue(pC,yO),yfe=Sue(lO,SO),Sfe=Eue(uO,az),Efe=bue(pC,Wi);function bu(n){return n===void 0}function jr(n){return n!==void 0}function bfe(n){return typeof n=="function"}function rd(n){return typeof n=="number"}function Ig(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function xz(n){return typeof n=="boolean"}function Dl(n){return Array.isArray(n)}function dm(n){return typeof n=="string"}function uT(n){return dm(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function Jn(n,e){if(!n)throw new Error(e)}function Af(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function wz(n){!n.isOffline&&n.state!=="running"&&SC('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Cz=!1,S2=!1;function E2(n){Cz=n}function Tfe(n){bu(n)&&Cz&&!S2&&(S2=!0,SC("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Rz=console;function xfe(...n){Rz.log(...n)}function SC(...n){Rz.warn(...n)}function wfe(n){return new ofe(n)}function Cfe(n,e,t){return new _fe(n,e,t)}const mu=typeof self=="object"?self:null,Rfe=mu&&(mu.hasOwnProperty("AudioContext")||mu.hasOwnProperty("webkitAudioContext"));function Afe(n,e,t){return Jn(jr(y2),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof(mu==null?void 0:mu.BaseAudioContext)?mu==null?void 0:mu.AudioWorkletNode:y2)(n,e,t)}var kM=function(n,e){return kM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},kM(n,e)};function Az(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");kM(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ps(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Ws(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function CO(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function EC(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function OM(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}class Mfe{constructor(e,t,r,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),r=new Worker(t);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function p_(n){return Sfe(n)}function kg(n){return yfe(n)}function ZT(n){return Efe(n)}function Cv(n){return vfe(n)}function Ife(n){return n instanceof lz}function kfe(n,e){return n==="value"||p_(e)||kg(e)||Ife(e)}function r_(n,...e){if(!e.length)return n;const t=e.shift();if(Ig(n)&&Ig(t))for(const r in t)kfe(r,t[r])?n[r]=t[r]:Ig(t[r])?(n[r]||Object.assign(n,{[r]:{}}),r_(n[r],t[r])):Object.assign(n,{[r]:t[r]});return r_(n,...e)}function Ofe(n,e){return n.length===e.length&&n.every((t,r)=>e[r]===t)}function gn(n,e,t=[],r){const i={},s=Array.from(e);if(Ig(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(n,a))||(r_(i,{[r]:s[0]}),t.splice(t.indexOf(r),1),s.shift())),s.length===1&&Ig(s[0]))r_(i,s[0]);else for(let o=0;o<t.length;o++)jr(s[o])&&(i[t[o]]=s[o]);return r_(n,i)}function Nfe(n){return n.constructor.getDefaults()}function yf(n,e){return bu(n)?e:n}function aE(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class Tm{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||mu&&this.toString()===mu.TONE_DEBUG_CLASS)&&xfe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tm.version=k5;const RO=1e-6;function by(n,e){return n>e+RO}function NM(n,e){return by(n,e)||Gh(n,e)}function Kx(n,e){return n+RO<e}function Gh(n,e){return Math.abs(n-e)<RO}function Pfe(n,e,t){return Math.max(Math.min(n,t),e)}class rh extends Tm{constructor(){super(),this.name="Timeline",this._timeline=[];const e=gn(rh.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Jn(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];Jn(NM(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const r=this._search(e,t);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const r=this._search(e,t);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Gh(this._timeline[t].time,e)){for(let r=t;r>=0&&Gh(this._timeline[r].time,e);r--)t=r;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&NM(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Gh(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Gh(u[t],e))o=l;else break}return o}else{if(Kx(a[t],e)&&by(c[t],e))return o;by(a[t],e)?s=o:r=o+1}}return-1}_iterate(e,t=0,r=this._timeline.length-1){this._timeline.slice(t,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const r=this._search(e);return r!==-1&&this._iterate(t,0,r),this}forEachAfter(e,t){const r=this._search(e);return this._iterate(t,r+1),this}forEachBetween(e,t,r){let i=this._search(e),s=this._search(t);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===t&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,t){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(t,r+1),this}forEachAtTime(e,t){const r=this._search(e);if(r!==-1&&Gh(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&Gh(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{t(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Mz=[];function bC(n){Mz.push(n)}function Dfe(n){Mz.forEach(e=>e(n))}const Iz=[];function TC(n){Iz.push(n)}function Lfe(n){Iz.forEach(e=>e(n))}class qE extends Tm{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{bu(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const r=(...i)=>{t(...i),this.off(e,r)};return this.on(e,r),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(bu(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(bu(t))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===t&&s.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const r=Object.getOwnPropertyDescriptor(qE.prototype,t);Object.defineProperty(e.prototype,t,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class kz extends qE{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class XE extends kz{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new rh,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=gn(XE.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=wfe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new Mfe(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Dfe(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,r){return this._context.createBuffer(e,t,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,r){return this._context.createPeriodicWave(e,t,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Jn(Cv(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Jn(Cv(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Jn(Cv(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Jn(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Jn(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Jn(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Jn(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Afe(this.rawContext,e,t)}addAudioWorkletModule(e){return Ws(this,void 0,void 0,function*(){Jn(jr(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Ws(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Cv(this._context)?this._context.resume():Promise.resolve()}close(){return Ws(this,void 0,void 0,function*(){Cv(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Lfe(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),r=t.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+t})};return i(),r}}class Ufe extends kz{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Ws(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Yr(n,e){Dl(e)?e.forEach(t=>Yr(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function KE(n,e){Dl(e)?e.forEach(t=>KE(n,t)):Object.defineProperty(n,e,{writable:!0})}const ki=()=>{};class Hi extends Tm{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ki;const e=gn(Hi.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,dm(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ki,onload:ki,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:rc().sampleRate}set(e){return e instanceof Hi?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Ws(this,void 0,void 0,function*(){const t=Hi.load(e).then(r=>{this.set(r),this.onload(this)});Hi.downloads.push(t);try{yield t}finally{const r=Hi.downloads.indexOf(t);Hi.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Dl(e)&&e[0].length>0,r=t?e.length:1,i=t?e[0].length:e.length,s=rc(),o=s.createBuffer(r,i,s.sampleRate),a=!t&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(rd(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)t[o]+=s[o]}t=t.map(i=>i/r),this.fromArray(t)}return this}toArray(e){if(rd(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let r=0;r<this.numberOfChannels;r++)t[r]=this.getChannelData(r);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){Jn(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);Jn(r<i,"The start time must be less than the end time");const s=i-r,o=rc().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new Hi(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Hi().fromArray(e)}static fromUrl(e){return Ws(this,void 0,void 0,function*(){return yield new Hi().load(e)})}static load(e){return Ws(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const c=t[1].split("|");let l=c[0];for(const u of c)if(Hi.supportsType(u)){l=u;break}e=e.replace(t[0],l)}const r=Hi.baseUrl===""||Hi.baseUrl.endsWith("/")?Hi.baseUrl:Hi.baseUrl+"/",i=document.createElement("a");i.href=r+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const s=yield fetch(i.href);if(!s.ok)throw new Error(`could not load url: ${e}`);const o=yield s.arrayBuffer();return yield rc().decodeAudioData(o)})}static supportsType(e){const t=e.split("."),r=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return Ws(this,void 0,void 0,function*(){for(yield Promise.resolve();Hi.downloads.length;)yield Hi.downloads[0]})}}Hi.baseUrl="";Hi.downloads=[];class xC extends XE{constructor(){super({clockSource:"offline",context:ZT(arguments[0])?arguments[0]:Cfe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:ZT(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ZT(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Ws(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const r=Math.floor(this.sampleRate/128);e&&t%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Ws(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Hi(t)})}close(){return Promise.resolve()}}const Oz=new Ufe;let Y0=Oz;function rc(){return Y0===Oz&&Rfe&&Ffe(new XE),Y0}function Ffe(n,e=!1){e&&Y0.dispose(),Cv(n)?Y0=new XE(n):ZT(n)?Y0=new xC(n):Y0=n}function Bfe(){return Y0.resume()}if(mu&&!mu.TONE_SILENCE_LOGGING){const e=` * Tone.js v${k5} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function zfe(n){return Math.pow(10,n/20)}function Vfe(n){return 20*(Math.log(n)/Math.LN10)}function Nz(n){return Math.pow(2,n/12)}let wC=440;function jfe(){return wC}function Hfe(n){wC=n}function J0(n){return Math.round(Pz(n))}function Pz(n){return 69+12*Math.log2(n/wC)}function Dz(n){return wC*Math.pow(2,(n-69)/12)}class AO extends Tm{constructor(e,t,r){super(),this.defaultUnits="s",this._val=t,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const r=parseInt(e,10),i=t==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof AO&&this.fromType(this._val),bu(this._val))return this._noArg();if(dm(this._val)&&bu(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Ig(this._val)){let e=0;for(const t in this._val)if(jr(this._val[t])){const r=this._val[t],i=new this.constructor(this.context,t).valueOf()*r;e+=i}return e}if(jr(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return dm(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class eh extends AO{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new eh(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let r=t[0],i=new eh(this.context,t[0]).toSeconds();return t.forEach(s=>{const o=new eh(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const r=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return J0(this.toFrequency())}_now(){return this.context.now()}}function sa(n,e){return new eh(rc(),n,e)}class Ol extends eh{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return jfe()}static set A4(e){Hfe(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Ol.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=Gfe[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Ol.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new Ol(this.context,this.valueOf()*Nz(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return J0(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Ol.A4);let r=Math.round(12*t)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),Wfe[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Dz(e)}static ftom(e){return J0(e)}}const Gfe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Wfe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function b2(n,e){return new Ol(rc(),n,e)}class Yv extends eh{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Sc extends Tm{constructor(){super();const e=gn(Sc.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:rc()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Tfe(e),new eh(this.context,e).toSeconds()}toFrequency(e){return new Ol(this.context,e).toFrequency()}toTicks(e){return new Yv(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(r=>{bu(e[r])&&delete t[r]}),t}get(){const e=Nfe(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const r=this[t];jr(r)&&jr(r.value)&&jr(r.setValueAtTime)?e[t]=r.value:r instanceof Sc?e[t]=r._getPartialProperties(e[t]):Dl(r)||rd(r)||dm(r)||xz(r)?e[t]=r:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&jr(this[t])&&(this[t]&&jr(this[t].value)&&jr(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Sc?this[t].set(e[t]):this[t]=e[t])}),this}}class YE extends rh{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,r){return Af(t,0),this.add(Object.assign({},r,{state:e,time:t})),this}getLastState(e,t){const r=this._search(t);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,t){const r=this._search(t);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class Gr extends Sc{constructor(){const e=gn(Gr.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Jn(jr(e.param)&&(p_(e.param)||e.param instanceof Gr),"param must be an AudioParam");!p_(e.param);)e.param=e.param._param;this._swappable=jr(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new rh(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,jr(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Sc.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return jr(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return jr(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return jr(this.maxValue)&&jr(this.minValue)&&Af(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?zfe(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Vfe(e):e}setValueAtTime(e,t){const r=this.toSeconds(t),i=this._fromType(e);return Jn(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),r=this._events.getAfter(t),i=this._events.get(t);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,t):s=this._exponentialInterpolate(i.time,o,r.time,r.value,t)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const r=this._fromType(e),i=this.toSeconds(t);return Jn(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,t){let r=this._fromType(e);r=Gh(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(t);return Jn(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(t)),this}linearRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(t)),this}targetRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,t),this}exponentialApproachValueAtTime(e,t,r){t=this.toSeconds(t),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+r*.9),this.linearRampToValueAtTime(e,t+r),this}setTargetAtTime(e,t,r){const i=this._fromType(e);Jn(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(t);return this._assertRange(i),Jn(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,t,r,i=1){r=this.toSeconds(r),t=this.toSeconds(t);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),t);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return Jn(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),r=this._fromType(this.getValueAtTime(t));Jn(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+r);const i=this._events.get(t),s=this._events.getAfter(t);return i&&Gh(i.time,t)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),t):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),t)),this._events.add({time:t,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,t),this}rampTo(e,t=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,r):this.linearRampTo(e,t,r),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const r=this._events.get(t);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:t+2,o=(s-t)/10;for(let a=t;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Jn(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,r,i,s){return r+(t-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,t,r,i,s){return t+(i-t)*((s-e)/(r-e))}_exponentialInterpolate(e,t,r,i,s){return t*Math.pow(i/t,(s-e)/(r-e))}}class Tn extends Sc{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return jr(this.input)?p_(this.input)||this.input instanceof Gr?1:this.input.numberOfInputs:0}get numberOfOutputs(){return jr(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return jr(e)&&(e instanceof Tn||kg(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Jn(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,r=0){return id(this,e,t,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return SC("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,r=0){return Lz(this,e,t,r),this}chain(...e){return m_(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),jr(this.input)&&(this.input instanceof Tn?this.input.dispose():kg(this.input)&&this.input.disconnect()),jr(this.output)&&(this.output instanceof Tn?this.output.dispose():kg(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function m_(...n){const e=n.shift();n.reduce((t,r)=>(t instanceof Tn?t.connect(r):kg(t)&&id(t,r),r),e)}function id(n,e,t=0,r=0){for(Jn(jr(n),"Cannot connect from undefined node"),Jn(jr(e),"Cannot connect to undefined node"),(e instanceof Tn||kg(e))&&Jn(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Jn(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Tn||e instanceof Gr;)jr(e.input)&&(e=e.input);for(;n instanceof Tn;)jr(n.output)&&(n=n.output);p_(e)?n.connect(e,t):n.connect(e,t,r)}function Lz(n,e,t=0,r=0){if(jr(e))for(;e instanceof Tn;)e=e.input;for(;!kg(n);)jr(n.output)&&(n=n.output);p_(e)?n.disconnect(e,t):kg(e)?n.disconnect(e,t,r):n.disconnect()}class Wr extends Tn{constructor(){const e=gn(Wr.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Gr({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Yr(this,"gain")}static getDefaults(){return Object.assign(Tn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ty extends Tn{constructor(e){super(e),this.onended=ki,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Wr({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const r=this.toSeconds(t);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Tn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ki})}_startGain(e,t=1){Jn(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+r):this._gainNode.gain.exponentialApproachValueAtTime(t,e,r)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Jn(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ki&&(this.onended(this),this.onended=ki,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Jn(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ki,this}}class MO extends Ty{constructor(){const e=gn(MO.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),id(this._source,this._gainNode),this.offset=new Gr({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ty.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Ai extends Tn{constructor(){const e=gn(Ai.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new MO({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Tn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,r=0){return CC(this,e,t,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,r){return this._param.exponentialRampTo(e,t,r),this}linearRampTo(e,t,r){return this._param.linearRampTo(e,t,r),this}targetRampTo(e,t,r){return this._param.targetRampTo(e,t,r),this}exponentialApproachValueAtTime(e,t,r){return this._param.exponentialApproachValueAtTime(e,t,r),this}setTargetAtTime(e,t,r){return this._param.setTargetAtTime(e,t,r),this}setValueCurveAtTime(e,t,r,i){return this._param.setValueCurveAtTime(e,t,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,r){return this._param.rampTo(e,t,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function CC(n,e,t,r){(e instanceof Gr||p_(e)||e instanceof Ai&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Ai&&(e.overridden=!0)),id(n,e,t,r)}class IO extends Gr{constructor(){const e=gn(IO.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new rh(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Gr.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,r){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),s=this._events.get(t),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+t,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const r=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const r=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const r=this._fromType(e),i=this._events.get(t),s=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(bu(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const s=this._events.get(t);return s&&s.time===t&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),r=this._events.get(t);return Math.max(this._getTicksUntilEvent(r,t),0)}getDurationOfTicks(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const t=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&r&&r.type==="linearRampToValueAtTime"&&t.value!==r.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const r=this.toSeconds(t),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class kO extends Ai{constructor(){const e=gn(kO.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new IO({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Ai.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class OO extends Sc{constructor(){const e=gn(OO.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new YE,this._tickOffset=new rh,this._ticksAtTime=new rh,this._secondsAtTime=new rh,this.frequency=new kO({context:this.context,units:e.units,value:e.frequency}),Yr(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Sc.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),jr(t)&&this.setTicksAtTime(t,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const r=this._state.get(t);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),r=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),s={state:"paused",time:t};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),r=this.frequency.timeToTicks(e,t);this.setTicksAtTime(r,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const r=this._tickOffset.get(t),i=this._state.get(t),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,r){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Gh(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(d){s=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class RC extends Sc{constructor(){const e=gn(RC.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=ki,this._lastUpdate=0,this._state=new YE("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new OO({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Yr(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Sc.getDefaults(),{callback:ki,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){wz(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,t),r<this._lastUpdate&&this.emit("start",r,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,t,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}qE.mixin(RC);class xy extends Tn{constructor(){const e=gn(xy.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const t=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(t,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(t),this.delayTime=new Gr({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),Yr(this,"delayTime")}static getDefaults(){return Object.assign(Tn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class df extends Tn{constructor(){const e=gn(df.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Wr({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Yr(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Tn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class NO extends Tn{constructor(){const e=gn(NO.getDefaults(),arguments);super(e),this.name="Destination",this.input=new df({context:this.context}),this.output=new Wr({context:this.context}),this.volume=this.input.volume,m_(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Tn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),m_(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}bC(n=>{n.destination=new NO({context:n})});TC(n=>{n.destination.dispose()});class $fe extends Tn{constructor(){super(...arguments),this.name="Listener",this.positionX=new Gr({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Gr({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Gr({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Gr({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Gr({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Gr({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Gr({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Gr({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Gr({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Tn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}bC(n=>{n.listener=new $fe({context:n})});TC(n=>{n.listener.dispose()});class PO extends Tm{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=gn(PO.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const r=e.urls[t];this.add(t,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:ki,onload:ki,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Jn(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,r=ki,i=ki){return dm(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Hi(this.baseUrl+t,r,i))):this._buffers.set(e.toString(),new Hi(t,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Yx extends Ol{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return J0(super._frequencyToUnits(e))}_ticksToUnits(e){return J0(super._ticksToUnits(e))}_beatsToUnits(e){return J0(super._beatsToUnits(e))}_secondsToUnits(e){return J0(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return Dz(this.toMidi())}transpose(e){return new Yx(this.context,this.toMidi()+e)}}class ua extends Yv{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class qfe extends Sc{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new rh,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}bC(n=>{n.draw=new qfe({context:n})});TC(n=>{n.draw.dispose()});class Xfe extends Tm{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Jn(jr(e.time),"Events must have a time property"),Jn(jr(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new Kfe(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const r of t)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let r,i=null;if(t>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let r=t[0];for(let i=1;i<t.length;i++)t[i].low>r.low&&(r=t[i]);return r.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(r=>t.push(r)),t.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Kfe{constructor(e,t,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Yfe extends Tm{constructor(e){super(),this.name="TimelineValue",this._timeline=new rh({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Mf extends Tn{constructor(){super(gn(Mf.getDefaults(),arguments,["context"]))}connect(e,t=0,r=0){return CC(this,e,t,r),this}}class k_ extends Mf{constructor(){const e=gn(k_.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Dl(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):bfe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Ai.getDefaults(),{length:1024})}setMap(e,t=1024){const r=new Float32Array(t);for(let i=0,s=t;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(r=>r.includes(e));Jn(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class DO extends Mf{constructor(){const e=gn(DO.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new k_({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Mf.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class jg{constructor(e,t){this.id=jg._eventId++,this._remainderTime=0;const r=Object.assign(jg.getDefaults(),t);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:ki,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}jg._eventId=0;class LO extends jg{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(LO.getDefaults(),t);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},jg.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Kx(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new ua(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Kx(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ua(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);by(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class AC extends Sc{constructor(){const e=gn(AC.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Yfe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new rh,this._repeatedEvents=new Xfe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new RC({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Yr(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Sc.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const r=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new ua(this.context,this._swingTicks*2/3).toSeconds()*i}E2(!0),this._timeline.forEachAtTime(t,r=>r.invoke(e)),E2(!1)}schedule(e,t){const r=new jg(this,{callback:e,time:new Yv(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,t,r,i=1/0){const s=new LO(this,{callback:e,duration:new eh(this.context,i).toTicks(),interval:new eh(this.context,t).toTicks(),time:new Yv(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,t){const r=new jg(this,{callback:e,once:!0,time:new Yv(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(t,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new ua(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let r;return jr(t)&&(r=this.toTicks(t)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Dl(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new eh(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new eh(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new ua(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new ua(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),r=this._clock.frequency.timeToTicks(e,t);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,t),s=t+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),r=this.getTicksAtTime(t),i=e-r%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new Wr(c),u=new DO(-1),h=new Wr(c);i.chain(l,u,h),i=h,s=1/s,o=[l,u,h]}t||(e.getValueAtTime(r)!==0?t=e.getValueAtTime(r)/s:t=0);const a=new Wr(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const r=this._syncedSignals[t];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),KE(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}qE.mixin(AC);bC(n=>{n.transport=new AC({context:n})});TC(n=>{n.transport.dispose()});class bc extends Tn{constructor(e){super(e),this.input=void 0,this._state=new YE("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ki,this._syncedStop=ki,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new df({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Yr(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Tn.getDefaults(),{mute:!1,onstop:ki,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,r){let i=bu(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Jn(by(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(yf(t,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else wz(this.context),this._start(i,t,r);return this}stop(e){let t=bu(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||jr(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const r=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(r)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(by(t,0)){const r=this._state.get(t);if(r&&r.state==="started"&&r.time!==t){const i=t-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ki,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class JE extends Ty{constructor(){const e=gn(JE.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,id(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Gr({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Hi(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ty.getDefaults(),{url:new Hi,loop:!1,loopEnd:0,loopStart:0,onload:ki,onerror:ki,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,r,i=1){Jn(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?t=yf(t,this.loopStart):t=yf(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;NM(o,a)&&(o=(o-c)%l+c),Gh(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Kx(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),jr(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class wy extends bc{constructor(){const e=gn(wy.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(bc.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Jn(e in T2,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=T2[this._type];this._source=new JE({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const gv=44100*5,vR=2,zp={brown:null,pink:null,white:null},T2={get brown(){if(!zp.brown){const n=[];for(let e=0;e<vR;e++){const t=new Float32Array(gv);n[e]=t;let r=0;for(let i=0;i<gv;i++){const s=Math.random()*2-1;t[i]=(r+.02*s)/1.02,r=t[i],t[i]*=3.5}}zp.brown=new Hi().fromArray(n)}return zp.brown},get pink(){if(!zp.pink){const n=[];for(let e=0;e<vR;e++){const t=new Float32Array(gv);n[e]=t;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<gv;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=r+i+s+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}zp.pink=new Hi().fromArray(n)}return zp.pink},get white(){if(!zp.white){const n=[];for(let e=0;e<vR;e++){const t=new Float32Array(gv);n[e]=t;for(let r=0;r<gv;r++)t[r]=Math.random()*2-1}zp.white=new Hi().fromArray(n)}return zp.white}};function O_(n,e){return Ws(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,r=new xC(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class UO extends Ty{constructor(){const e=gn(UO.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],id(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Gr({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Gr({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Yr(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ty.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class no extends bc{constructor(){const e=gn(no.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new Ai({context:this.context,units:"frequency",value:e.frequency}),Yr(this,"frequency"),this.detune=new Ai({context:this.context,units:"cents",value:e.detune}),Yr(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(bc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),r=new UO({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return no._periodicWaveCache.find(t=>t.phase===this._phase&&Ofe(t.partials,this._partials));{const e=no._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(jr(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),no._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),no._periodicWaveCache.length>100&&no._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Af(e,0);let t=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(t=r[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,t,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+t[o]*Math.sin(o*r);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,t,o/s*i),r);return Pfe(-this._inverseFFT(e,t,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}no._periodicWaveCache=[];class Uz extends Mf{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new k_({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class g_ extends Ai{constructor(){const e=gn(g_.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Wr({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ai.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class MC extends bc{constructor(){const e=gn(MC.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new Uz({context:this.context}),this._modulationNode=new Wr({context:this.context}),this._carrier=new no({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new no({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new g_({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Yr(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(no.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class IC extends bc{constructor(){const e=gn(IC.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Wr({context:this.context,gain:0}),this._carrier=new no({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Ai({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new no({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new g_({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new g_({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Yr(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(no.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class QE extends bc{constructor(){const e=gn(QE.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Wr({context:this.context,gain:0}),this._thresh=new k_({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new Ai({context:this.context,units:"audioRange",value:e.width}),this._triangle=new no({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Yr(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(bc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class kC extends bc{constructor(){const e=gn(kC.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Ai({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Ai({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Yr(this,["frequency","detune"])}static getDefaults(){return Object.assign(no.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=t+r*s)}}get count(){return this._oscillators.length}set count(e){if(Af(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const r=new no({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):ki});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[t]=r}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,r)=>t.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class OC extends bc{constructor(){const e=gn(OC.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new g_({context:this.context,value:2}),this._pulse=new QE({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new no({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Yr(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(bc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const x2={am:MC,fat:kC,fm:IC,oscillator:no,pulse:QE,pwm:OC};class Jx extends bc{constructor(){const e=gn(Jx.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Ai({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Ai({context:this.context,units:"cents",value:e.detune}),Yr(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(no.getDefaults(),IC.getDefaults(),MC.getDefaults(),kC.getDefaults(),QE.getDefaults(),OC.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=x2[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof x2[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&rd(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&rd(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&dm(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return Ws(this,arguments,void 0,function*(e=1024){return O_(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class FO extends Ai{constructor(){super(gn(FO.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Wr({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,m_(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Ai.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class BO extends Mf{constructor(){const e=gn(BO.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new g_({context:this.context,value:e.max-e.min}),this._add=this.output=new FO({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Mf.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class zO extends Mf{constructor(){super(gn(zO.getDefaults(),arguments)),this.name="Zero",this._gain=new Wr({context:this.context}),this.output=this._gain,this.input=void 0,id(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Lz(this.context.getConstant(0),this._gain),this}}class __ extends Tn{constructor(){const e=gn(__.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Gr.prototype._fromType,this._toType=Gr.prototype._toType,this._is=Gr.prototype._is,this._clampValue=Gr.prototype._clampValue,this._oscillator=new no(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Wr({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Ai({context:this.context,units:"audioRange",value:0}),this._zeros=new zO({context:this.context}),this._a2g=new Uz({context:this.context}),this._scaler=this.output=new BO({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Yr(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(no.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,r=this.max;this._units=e,this.min=t,this.max=r}get state(){return this._oscillator.state}connect(e,t,r){return(e instanceof Gr||e instanceof Ai)&&(this.convert=e.convert,this.units=e.units),CC(this,e,t,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Fz(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){Af(s,n,e),t.set(this,s)}})}}function xm(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){Af(this.toSeconds(s),n,e),t.set(this,s)}})}}class ZE extends bc{constructor(){const e=gn(ZE.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Hi({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(bc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ki,onerror:ki,playbackRate:1,reverse:!1})}load(e){return Ws(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=ki){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,r){return super.start(e,t,r),this}_start(e,t,r){this._loop?t=yf(t,this._loopStart):t=yf(t,0);const i=this.toSeconds(t),s=r;r=yf(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new JE({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&bu(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(t))}restart(e,t,r){return super.restart(e,t,r),this}_restart(e,t,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,r)}seek(e,t){const r=this.toSeconds(t);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Af(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Af(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),r=this._state.getNextState("stopped",t);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}ps([xm(0)],ZE.prototype,"fadeIn",void 0);ps([xm(0)],ZE.prototype,"fadeOut",void 0);class Jfe extends Mf{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new k_({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class wm extends Tn{constructor(){const e=gn(wm.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Ai({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Tn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(dm(e))return e;{let r;for(r in hT)if(hT[r][t]===e)return r;return e}}_setCurve(e,t,r){if(dm(r)&&Reflect.has(hT,r)){const i=hT[r];Ig(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Dl(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(s&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Jn(Dl(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),this.triggerAttack(t,r),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,r=0){return CC(this,e,t,r),this}asArray(){return Ws(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,r=new xC(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}ps([xm(0)],wm.prototype,"attack",void 0);ps([xm(0)],wm.prototype,"decay",void 0);ps([Fz(0,1)],wm.prototype,"sustain",void 0);ps([xm(0)],wm.prototype,"release",void 0);const hT=(()=>{let e,t;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(Math.PI*2)*s-Math.PI/2)+1;i[e]=d/10+t*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const d=Math.pow(t,3)*4+.2,p=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(p*(1-t))}function u(d){const p=new Array(d.length);for(let _=0;_<d.length;_++)p[_]=1-d[_];return p}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class If extends Tn{constructor(){const e=gn(If.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new df({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Yr(this,"volume")}static getDefaults(){return Object.assign(Tn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[t],o=this.context.transport.schedule(a=>{i[t]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r),o=this.toSeconds(t);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class v_ extends If{constructor(){const e=gn(v_.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(If.getDefaults(),{detune:0,onsilence:ki,portamento:0})}triggerAttack(e,t,r=1){this.log("triggerAttack",e,t,r);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const r=this.toSeconds(t),i=e instanceof Ol?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}ps([xm(0)],v_.prototype,"portamento",void 0);class NC extends wm{constructor(){super(gn(NC.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Wr({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Xc extends v_{constructor(){const e=gn(Xc.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Jx(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new NC(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Yr(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(v_.getDefaults(),{envelope:Object.assign(aE(wm.getDefaults(),Object.keys(Tn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(aE(Jx.getDefaults(),[...Object.keys(bc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Qx extends Tn{constructor(){const e=gn(Qx.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Gr({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Gr({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Gr({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Gr({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Tn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Jn(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;t[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(t,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Xu extends Tn{constructor(){const e=gn(Xu.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Wr({context:this.context}),this.output=new Wr({context:this.context}),this._filters=[],this._filters=[],this.Q=new Ai({context:this.context,units:"positive",value:e.Q}),this.frequency=new Ai({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Ai({context:this.context,units:"cents",value:e.detune}),this.gain=new Ai({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Yr(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Tn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Jn(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=rd(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(t);Jn(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new Qx({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,m_(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Qx({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),t.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),KE(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class eb extends Xc{constructor(){const e=gn(eb.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Yr(this,["oscillator","envelope"])}static getDefaults(){return r_(v_.getDefaults(),Xc.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const r=this.toSeconds(t),i=this.toFrequency(e instanceof Ol?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ps([Fz(0)],eb.prototype,"octaves",void 0);ps([xm(0)],eb.prototype,"pitchDecay",void 0);class Lv extends If{constructor(){const e=gn(Lv.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new wy(Object.assign({context:this.context},e.noise)),this.envelope=new NC(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(If.getDefaults(),{envelope:Object.assign(aE(wm.getDefaults(),Object.keys(Tn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(aE(wy.getDefaults(),Object.keys(bc.getDefaults())),{type:"white"})})}triggerAttack(e,t=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,r),this.triggerRelease(t+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Bz=new Set;function VO(n){Bz.add(n)}function zz(n,e){const t=`registerProcessor("${n}", ${e})`;Bz.add(t)}const Qfe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;VO(Qfe);const Zfe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;VO(Zfe);const epe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;VO(epe);const tpe="feedback-comb-filter",npe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;zz(tpe,npe);class Zx extends If{constructor(){const e=gn(Zx.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Jn(!rd(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const t=e.voice.getDefaults();this.options=Object.assign(t,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(If.getDefaults(),{maxPolyphony:32,options:{},voice:Xc})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const t=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Jn(e instanceof v_,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else SC("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,t,r){e.forEach(i=>{const s=new Yx(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,t,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,t))})}_triggerRelease(e,t){e.forEach(r=>{const i=new Yx(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(t),s.released=!0,this.log("triggerRelease",r,t))})}_scheduleEvent(e,t,r,i){Jn(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(t,r,i):this._triggerRelease(t,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,t,r,i)},r-this.now())}triggerAttack(e,t,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(t);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,t){Array.isArray(e)||(e=[e]);const r=this.toSeconds(t);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),Dl(t)){Jn(Dl(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=t[Math.min(o,t.length-1)],c=this.toSeconds(a);Jn(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(t);Jn(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const t=aE(e,["onsilence","context"]);return this.options=r_(this.options,t),this._voices.forEach(r=>r.set(t)),this._dummyVoice.set(t),this}get(){return this._dummyVoice.get()}releaseAll(e){const t=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(t)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class PC extends If{constructor(){const e=gn(PC.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Jn(uT(r)||rd(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),uT(r)){const s=new Ol(this.context,r).toMidi();t[s]=e.urls[r]}else rd(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new PO({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(If.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ki,onerror:ki,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,r=1){return this.log("triggerAttack",e,t,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=Pz(new Ol(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Nz(c+a),d=new JE({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,r),Dl(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),_=p.indexOf(d);_!==-1&&p.splice(_,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new Ol(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);t=this.toSeconds(t),s.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),Dl(t)?(Jn(Dl(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(t)),this}add(e,t,r){if(Jn(uT(e)||isFinite(e),`note must be a pitch or midi: ${e}`),uT(e)){const i=new Ol(this.context,e).toMidi();this._buffers.add(i,t,r)}else this._buffers.add(e,t,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}ps([xm(0)],PC.prototype,"attack",void 0);ps([xm(0)],PC.prototype,"release",void 0);class Uv extends Sc{constructor(){const e=gn(Uv.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new YE("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Sc.getDefaults(),{callback:ki,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,t=>{let r;if(t.state==="started"){t.id!==-1&&this.context.transport.clear(t.id);const i=t.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||rd(this._loop)&&this._loop>1){r=1/0,rd(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new ua(this.context,r));const o=new ua(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new ua(this.context,i),r)}else t.id=this.context.transport.schedule(this._tick.bind(this),new ua(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const t=this.toTicks(e);return this._state.getValueAtTime(t)==="stopped"&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}stop(e){this.cancel(e);const t=this.toTicks(e);if(this._state.getValueAtTime(t)==="started"){this._state.setStateAtTime("stopped",t,{id:-1});const r=this._state.getBefore(t);let i=t;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=yf(e,-1/0);const t=this.toTicks(e);return this._state.forEachFrom(t,r=>{this.context.transport.clear(r.id)}),this._state.cancel(t),this}_tick(e){const t=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(t)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;xz(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new ua(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new ua(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,t=this._state.get(e);if(t!==null&&t.state==="started"){const r=this._getLoopDuration();return(e-t.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class ew extends Uv{constructor(){const e=gn(ew.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new YE("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(t=>{Dl(t)?this.add(t[0],t[1]):this.add(t)})}static getDefaults(){return Object.assign(Uv.getDefaults(),{events:[]})}start(e,t){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){t=yf(t,this._loop?this._loopStart:0),this._loop?t=yf(t,this._loopStart):t=yf(t,0);const i=this.toTicks(t);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,t,r){t-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(t+=this._getLoopDuration()),e.start(new ua(this.context,t))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new ua(this.context,t))):e.startOffset>=r&&e.start(new ua(this.context,t))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(e){const t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach(r=>{r.stop(e)}),this}at(e,t){const r=new Yv(this.context,e).toTicks(),i=new ua(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return jr(t)&&(a.value=t),a;o=s.next()}return jr(t)?(this.add(e,t),this.at(e)):null}add(e,t){e instanceof Object&&Reflect.has(e,"time")&&(t=e,e=t.time);const r=this.toTicks(e);let i;return t instanceof Uv?(i=t,i.callback=this._tick.bind(this)):i=new Uv({callback:this._tick.bind(this),context:this.context,value:t}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(t=>{t.state==="started"?this._startNote(e,t.time,t.offset):e.stop(new ua(this.context,t.time))})}remove(e,t){return Ig(e)&&e.hasOwnProperty("time")&&(t=e,e=t.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(bu(t)||jr(t)&&r.value===t)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(t=>t.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(t=>{t instanceof ew?t._forEach(e):e(t)}),this}_setAll(e,t){this._forEach(r=>{r[e]=t})}_tick(e,t){this.mute||this.callback(e,t)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(t=>{t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.loop=e,this._testLoopBoundries(t)})}get loopEnd(){return new ua(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopEnd=e,this._testLoopBoundries(t)})}get loopStart(){return new ua(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class DC extends Tn{constructor(){const e=gn(DC.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Jfe({context:this.context}),this.a=new Wr({context:this.context,gain:0}),this.b=new Wr({context:this.context,gain:0}),this.output=new Wr({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Ai({context:this.context,units:"normalRange",value:e.fade}),Yr(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",id(this._split,this.a.gain,0),id(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Tn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let Hg=class extends Tn{constructor(e){super(e),this.name="Effect",this._dryWet=new DC({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Wr({context:this.context}),this.effectReturn=new Wr({context:this.context}),this.input=new Wr({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Yr(this,"wet")}static getDefaults(){return Object.assign(Tn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class jO extends Tn{constructor(){const e=gn(jO.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Gr({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Yr(this,"pan")}static getDefaults(){return Object.assign(Tn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const rpe="bit-crusher",ipe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;zz(rpe,ipe);class LC extends Tn{constructor(){const e=gn(LC.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Tn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class tb extends Tn{constructor(){const e=gn(tb.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Tn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class tw extends Tn{constructor(e){super(e),this.name="StereoEffect",this.input=new Wr({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new DC({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new LC({context:this.context,channels:2}),this._merge=new tb({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Yr(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),m_(...e),id(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),m_(...e),id(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Tn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class w2 extends tw{constructor(e){super(e),this.feedback=new Ai({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new Wr({context:this.context}),this._feedbackR=new Wr({context:this.context}),this._feedbackSplit=new LC({context:this.context,channels:2}),this._feedbackMerge=new tb({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Yr(this,["feedback"])}static getDefaults(){return Object.assign(tw.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class HO extends w2{constructor(){const e=gn(HO.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new __({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new __({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new xy({context:this.context}),this._delayNodeR=new xy({context:this.context}),this.frequency=this._lfoL.frequency,Yr(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(w2.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class cE extends Hg{constructor(){const e=gn(cE.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new k_({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(Hg.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const t=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+t)*i*20*r/(Math.PI+t*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class C2 extends Hg{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new Wr({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Yr(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Hg.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class UC extends C2{constructor(){const e=gn(UC.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new xy({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Yr(this,"delayTime")}static getDefaults(){return Object.assign(C2.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class GO extends tw{constructor(){const e=gn(GO.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(e),this.name="Phaser",this._lfoL=new __({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new __({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new Ai({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),Yr(this,["frequency","Q"])}static getDefaults(){return Object.assign(tw.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,t){const r=[];for(let i=0;i<e;i++){const s=this.context.createBiquadFilter();s.type="allpass",this.Q.connect(s.Q),t.connect(s.frequency),r.push(s)}return r}get octaves(){return this._octaves}set octaves(e){this._octaves=e;const t=this._baseFrequency*Math.pow(2,e);this._lfoL.max=t,this._lfoR.max=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class WO extends Hg{constructor(){const e=gn(WO.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Hg.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Af(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Af(e,0),this._preDelay=e,this.generate()}generate(){return Ws(this,void 0,void 0,function*(){const e=this.ready,t=new xC(2,this._decay+this._preDelay,this.context.sampleRate),r=new wy({context:t}),i=new wy({context:t}),s=new tb({context:t});r.connect(s,0,0),i.connect(s,0,1);const o=new Wr({context:t}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(ki),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class $O extends Hg{constructor(){const e=gn($O.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new xy({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new __({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,Yr(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Hg.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class jo extends Tn{constructor(){const e=gn(jo.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Wr({context:this.context}),jo._allSolos.has(this.context)||jo._allSolos.set(this.context,new Set),jo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Tn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),jo._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){jo._soloed.has(this.context)||jo._soloed.set(this.context,new Set),jo._soloed.get(this.context).add(this)}_removeSolo(){jo._soloed.has(this.context)&&jo._soloed.get(this.context).delete(this)}_isSoloed(){return jo._soloed.has(this.context)&&jo._soloed.get(this.context).has(this)}_noSolos(){return!jo._soloed.has(this.context)||jo._soloed.has(this.context)&&jo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),jo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}jo._allSolos=new Map;jo._soloed=new Map;class qO extends Tn{constructor(){const e=gn(qO.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new jO({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new df({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Yr(this,["pan","volume"])}static getDefaults(){return Object.assign(Tn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Fv extends Tn{constructor(){const e=gn(Fv.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new jo({solo:e.solo,context:this.context}),this._panVol=this.output=new qO({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Yr(this,["pan","volume"])}static getDefaults(){return Object.assign(Tn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Fv.buses.has(e)||Fv.buses.set(e,new Wr({context:this.context})),Fv.buses.get(e)}send(e,t=0){const r=this._getBus(e),i=new Wr({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Fv.buses=new Map;class XO extends Tn{constructor(){const e=gn(XO.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new Wr({context:this.context}),this.output=void 0,this.low=new Xu({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Xu({context:this.context,frequency:0,type:"highpass"}),this.mid=new Xu({context:this.context,frequency:0,type:"lowpass"}),this.high=new Xu({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Ai({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new Ai({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new Ai({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Yr(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Tn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),KE(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class KO extends Tn{constructor(){const e=gn(KO.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Gr({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Gr({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Gr({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Gr({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Gr({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),Yr(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Tn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class YO extends Tn{constructor(){const e=gn(YO.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new Wr({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new XO({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new Wr({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new Wr({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new Wr({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Yr(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Tn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),KE(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}rc().transport;function JO(){return rc().transport}rc().destination;rc().destination;function spe(){return rc().destination}rc().listener;rc().draw;rc();const PM=sa("256n").toSeconds(),ope=sa("8n").toSeconds();function ape(){const n=new WO;n.set({wet:0});const e=new UC;e.set({wet:0,delayTime:PM,maxDelay:"1n",feedback:.666});const t=new HO;t.set({wet:0,depth:.999,frequency:7,feedback:.666});const r=new GO;r.set({wet:0,Q:10});const i=new cE;i.set({wet:0,distortion:.9});const s=new $O;return s.set({wet:0,depth:.2}),{reverb:n,echo:e,chorus:t,phaser:r,distortion:i,vibrato:s}}const cpe={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31};let lpe=0;function upe(n,e,t){let r=e,i=3,s="32n",o="",a="";const c=[];function l(){a="",o="",r+=sa(s).toSeconds()}function u(){a===null?(c.push([r,[n,s,a]]),l()):En(a)?(c.push([r,[n,s,a]]),l()):a!==""&&(c.push([r,[n,s,`${a}${o}${i}`]]),l())}for(let h=0;h<t.length;++h){switch(t[h]){case 9:case 10:break;default:u();break}switch(t[h]){case 1:a="A";break;case 2:a="B";break;case 3:a="C";break;case 4:a="D";break;case 5:a="E";break;case 6:a="F";break;case 7:a="G";break;case 8:a=null;break;case 9:o+="#";break;case 10:o+="b";break;case 11:++i;break;case 12:--i;break;case 13:s="64n";break;case 14:s="32n";break;case 15:s="16n";break;case 16:s="8n";break;case 17:s="4n";break;case 18:s="2n";break;case 19:s="1n";break;case 20:s=s.replace("n","t");break;case 21:s+=".";break;case 22:a=0;break;case 23:a=1;break;case 24:a=2;break;case 25:a=3;break;case 26:a=4;break;case 27:a=5;break;case 29:a=6;break;case 28:a=7;break;case 30:a=8;break;case 31:a=9;break}}return u(),c.push([r,[--lpe,"8n",-1]]),c}function hpe(n){const e=[],t=n.split(";");for(let r=0;r<t.length;++r){const i=[],s=t[r];for(let o=0;o<s.length;++o){const a=cpe[s[o]];fe(a)&&i.push(a)}e.push(i)}return e}function Vp(n){const e=new Xc;e.set({envelope:{attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{type:"square"}});const t=ape();return e.chain(t.vibrato,t.chorus,t.phaser,t.distortion,t.echo,t.reverb,n),{source:e,fx:t}}function dpe(n,e=!1,t=!1){let r={hidden:"hidden",visibilitychange:"visibilitychange"};document.hidden!==void 0?r={hidden:"hidden",visibilitychange:"visibilitychange"}:document.webkitHidden!==void 0?r={hidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"}:document.mozHidden!==void 0?r={hidden:"mozHidden",visibilitychange:"mozvisibilitychange"}:document.msHidden!==void 0&&(r={hidden:"msHidden",visibilitychange:"msvisibilitychange"});function i(L,z,F,V,W){for(let X=0;X<z.length;++X)L.addEventListener(z[X],F,{capture:V,passive:W})}function s(L,z,F,V,W){for(let X=0;X<z.length;++X)L.removeEventListener(z[X],F,{capture:V,passive:W})}function o(){}const a=navigator.userAgent.toLowerCase(),c=t||a.includes("iphone")&&!a.includes("like iphone")||a.includes("ipad")&&!a.includes("like ipad")||a.includes("ipod")&&!a.includes("like ipod")||a.includes("mac os x")&&navigator.maxTouchPoints>0;let l=!0;function u(){const L=!!(e||(!r||!document[r.hidden])&&(!c||document.hasFocus()));L!==l&&(l=L,A(!1),p())}function h(){u()}r&&i(document,[r.visibilitychange],h,!0,!0);function d(L){L&&L.target!==window||u()}c&&i(window,["focus","blur"],d,!0,!0);function p(){if(l){if(n.state!=="running"&&n.state!=="closed"&&U){const L=n.resume();fe(L)&&L.then(o,o).catch(o)}}else if(n.state==="running"){const L=n.suspend();fe(L)&&L.then(o,o).catch(o)}}function _(L){(!L||!L.unmute_handled)&&(L.unmute_handled=!0,p())}i(n,["statechange"],_,!0,!0),n.onstatechange||(n.onstatechange=_);let y=null;function S(L,z){let F=z;for(;L>1;L--)F+=z;return F}const T="data:audio/mpeg;base64,//uQx"+S(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+S(16,"gICA")+S(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+S(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+S(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+S(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+S(97,"V")+"Q==";function A(L){if(c)if(l){if(L){if(!y){const z=document.createElement("div");z.innerHTML="<audio x-webkit-airplay='deny'></audio>",y=z.children.item(0),y.controls=!1,y.disableRemotePlayback=!0,y.preload="auto",y.src=T,y.loop=!0,y.load()}if(y.paused){const z=y.play();fe(z)&&z.then(o,R).catch(R)}}}else R()}function R(){y&&(y.src="about:blank",y.load(),y=null)}const I=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let U=!1;function D(){U=!0,A(!0),p()}return i(window,I,D,!0,!0),{dispose:function(){R(),r&&s(document,[r.visibilitychange],h,!0,!0),c&&s(window,["focus","blur"],d,!0,!0),s(window,I,D,!0,!0),s(n,["statechange"],_,!0,!0),n.onstatechange===_&&(n.onstatechange=null)}}}var Vz={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(Ng,function(){return t.importState=function(i){var s=new t;return s.importState(i),s},t;function t(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Vz);var fpe=Vz.exports;const jz=Wl(fpe);new Ln;new Ln;function Ii(n,e,t){return Math.max(e,Math.min(t,n))}function ppe(n){return n/180*Math.PI}function Hz(n){return n*180/Math.PI}const mpe=jz("089fad0j9awfem09wavefc09uwaef");function QO(n,e){return Math.round(n/e)*e}function gpe(){return mpe()}function _pe(n){return jz(n)()}function yS(n,e){const t=Math.min(n,e),i=Math.max(n,e)-t+1;return t+Math.floor(gpe()*i)}function vpe(n,e,t){const r=Math.min(e,t),s=Math.max(e,t)-r+1;return r+Math.floor(_pe(n)*s)}let ex=!1;function Wy(){ex||Bfe().then(()=>{if(!ex){const n=JO();ex=!0,n.start(),n.bpm.value=107,th("synth","audio is enabled!");try{const e=rc();dpe(e,!0)}catch{}}}).catch(n=>{ti("synth","audio",n.message)})}function ype(){const n=spe(),e=rc().createMediaStreamDestination(),t=new df(0);t.connect(n),t.connect(e);const r=new KO({threshold:-24,ratio:4,attack:.003,release:.25,knee:30});r.connect(t);const i=new df(0);i.connect(r);const s=new df(1);s.connect(r);const o=new df(3);o.connect(r);const a=[Vp(i),Vp(i),Vp(i),Vp(i),Vp(i),Vp(i),Vp(i),Vp(i),Vp(i)],c=new Zx().connect(s);c.maxPolyphony=8,c.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function l(rt){c.triggerAttackRelease("C6","1i",rt)}const u=new Xc().connect(s);c.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function h(rt){const nt=sa("64n").toSeconds();u.triggerAttackRelease("C6","8n",rt),u.frequency.exponentialRampToValueAtTime("C11",nt+rt)}const d=new Xu(350,"bandpass").connect(s),p=new Wr().connect(d);p.gain.value=0;const _=new Zx().connect(p);_.maxPolyphony=8,_.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function y(rt,nt){const pe=sa("64n").toSeconds()+sa(rt).toSeconds();p.gain.setValueAtTime(.5,nt),p.gain.exponentialRampToValueAtTime(.01,pe+nt),_.triggerAttackRelease([800,540],rt,nt)}const S=new YO(-10,10,-1).connect(s),T=new Xu(800,"highpass",-12);T.connect(S);const A=new Lv;A.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),A.connect(T);function R(rt,nt){A.triggerAttackRelease(rt,nt)}const I=new cE().connect(s);I.set({distortion:.666});const U=new Xc;U.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),U.connect(I);const D=new Xu;D.set({type:"highpass",frequency:1e4}),D.connect(I);const L=new Lv;L.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),L.connect(D);function z(rt,nt){const pe=sa("512n").toSeconds(),oe=sa("32n").toSeconds();U.triggerAttackRelease(1e4,rt,nt,1),U.frequency.exponentialRampToValueAtTime(300,nt+pe),U.frequency.exponentialRampToValueAtTime(100,nt+oe),L.triggerAttackRelease("8n",nt,.333),L.volume.setValueAtTime(1,nt),L.volume.exponentialRampToValueAtTime(0,nt+sa("32n").toSeconds())}const F=new Xu;F.set({type:"bandpass",frequency:256,Q:.17}),F.connect(s);const V=new Xc;V.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),V.connect(F);const W=new Xc;W.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),W.connect(F);function X(rt,nt){V.triggerAttackRelease(2e3,rt,nt),V.frequency.exponentialRampToValueAtTime(1e3,nt+sa("32n").toSeconds()),W.triggerAttackRelease(999,rt,nt),W.frequency.exponentialRampToValueAtTime(888,nt+sa("256n").toSeconds())}const $=new cE().connect(s);$.set({distortion:.876});const K=new Xc;K.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),K.connect($);const te=new Xu;te.set({type:"highpass",frequency:1e4}),te.connect($);const Q=new Lv;Q.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),Q.connect(te);function ne(rt,nt){const pe=sa("512n").toSeconds(),oe=sa("32n").toSeconds();K.triggerAttackRelease(1e4,rt,nt,1),K.frequency.exponentialRampToValueAtTime(150,nt+pe),K.frequency.exponentialRampToValueAtTime(100,nt+oe),Q.triggerAttackRelease("8n",nt,.25),Q.volume.setValueAtTime(1,nt),Q.volume.exponentialRampToValueAtTime(0,nt+sa("32n").toSeconds())}const G=new Xc().connect(s);G.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const J=new Xc().connect(s);G.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const re=new Lv().connect(s);re.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function ue(rt,nt){const pe=sa("256n").toSeconds(),oe=sa(rt).toSeconds()-pe;G.triggerAttackRelease("C4",oe,nt,1),G.frequency.exponentialRampToValueAtTime(b2("C0").toFrequency(),nt+oe),J.triggerAttackRelease("C5",oe,nt,.5),J.frequency.exponentialRampToValueAtTime(b2("C0").toFrequency(),nt+oe);const ke=sa("4n").toSeconds();re.triggerAttackRelease("8n",nt),re.volume.setValueAtTime(1,nt),re.volume.exponentialRampToValueAtTime(0,nt+ke)}const ye=new Xu;ye.set({type:"bandpass",frequency:256,Q:.17}),ye.connect(s);const Ne=new Xc;Ne.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),Ne.connect(ye);const _e=new Xc;_e.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),_e.connect(ye);function Ae(rt,nt){Ne.triggerAttackRelease(2e3,rt,nt),Ne.frequency.exponentialRampToValueAtTime(100,nt+sa("32n").toSeconds()),_e.triggerAttackRelease(699,rt,nt),_e.frequency.exponentialRampToValueAtTime(399,nt+sa("256n").toSeconds())}const Ye=new eb().connect(s);Ye.set({octaves:8});function Ze(rt){Ye.triggerAttackRelease("C1","8n",rt)}const Ke=new ew(It);function It(rt,nt){if(nt===null)return;const[pe,oe,ke]=nt;if(vr(ke)&&fe(a[pe])&&a[pe].source.triggerAttackRelease(ke,oe,rt),En(ke))switch(ke){case 0:l(rt);break;case 1:h(rt);break;case 2:y(oe,rt);break;case 3:R(oe,rt);break;case 4:z(oe,rt);break;case 5:X(oe,rt);break;case 6:ne(oe,rt);break;case 7:ue(oe,rt);break;case 8:Ae(oe,rt);break;case 9:Ze(rt);break;case-1:--Kt,Kt===0&&(Ke.clear(),Qt=-1);break}}function Xt(rt,nt,pe){let oe=nt;const ke=upe(rt,nt,pe),Je=ke[ke.length-1];fe(Je)&&(oe=Math.max(oe,Je[0]));for(let ut=0;ut<ke.length;++ut){const[ot,cn]=ke[ut];Ke.add(ot,cn)}return oe}let Qt=-1,Kt=0;function xn(rt,nt){const pe=hpe(nt),oe=JO().seconds;if(rt){Qt===-1&&(Qt=oe),Kt+=pe.length;const ke=Qt;for(let Je=0;Je<pe.length;++Je){const ut=Xt(1+Je,ke,pe[Je]);Qt=Math.max(Qt,ut)}}else for(let ke=0;ke<pe.length;++ke)Xt(0,oe,pe[ke])}Ke.start(0);function Re(){Ke.clear(),Qt=-1,Kt=0}function St(rt){t.volume.value=rt}function Qe(rt){s.volume.value=rt}function nn(rt){new ZE(rt).connect(o).start(0)}function Ot(rt){o.volume.value=rt}return{broadcastdestination:e,addplay:xn,stopplay:Re,addttsaudiobuffer:nn,setmainvolume:St,setdrumvolume:Qe,setttsvolume:Ot,SOURCE:a}}function Spe(n,e){if(vr(n)){let r=Ur(n);if(ni(e))return r==="custom"||r==="amcustom"||r==="fmcustom"||r==="fatcustom";switch(r){case"custom":case"amcustom":case"fmcustom":case"fatcustom":if(!ni(e))return!1;break}if(r==="pwm"||r==="pulse"||((r.startsWith("am")||r.startsWith("fm"))&&(r=r.substring(2)),r.startsWith("fat")&&(r=r.substring(3)),r.startsWith("sine")&&(r=r.substring(4)),r.startsWith("square")&&(r=r.substring(6)),r.startsWith("triangle")&&(r=r.substring(8)),r.startsWith("sawtooth")&&(r=r.substring(8)),r===""))return!0;const i=parseInt(r,10);return!!En(i)}}let yR,Wc;function Epe(){return Wc==null?void 0:Wc.broadcastdestination}const jp=Nf("synth",[],n=>{if(ex&&!fe(Wc)&&(Wc=ype()),!!fe(Wc))switch(n.target){case"mainvolume":En(n.data)&&Wc.setmainvolume(n.data);break;case"drumvolume":En(n.data)&&Wc.setdrumvolume(n.data);break;case"ttsvolume":En(n.data)&&Wc.setttsvolume(n.data);break;case"play":if(ni(n.data)){const[e,t]=n.data;t===""?Wc.stopplay():Wc.addplay(e,t)}break;case"voice":if(ni(n.data)){const[e,t,r]=n.data,i=Wc.SOURCE[e];if(!fe(i)){ti(jp.name(),n.target,`unknown voice ${e}`);return}switch(t){case"bpm":if(En(r)){JO().bpm.value=r;return}break;case"vol":case"volume":if(En(r)){i.source.volume.value=r;return}break;case"port":case"portamento":if(En(r)){i.source.portamento=r;return}break;case"env":case"envelope":if(ni(r)){const[s,o,a,c]=r;i.source.set({envelope:{attack:s,decay:o,sustain:a,release:c}});return}break;default:if(vr(t)){if(Spe(t,r)){i.source.set({oscillator:{type:t}}),ni(r)&&i.source.set({oscillator:{partials:r}}),En(r)&&i.source.set({oscillator:{partials:[r]}});return}const s=i.source.get().oscillator.type;switch(s){case"pwm":switch(t){case"modfreq":case"modulationfrequency":if(En(r)){i.source.set({oscillator:{modulationFrequency:r}});return}break}break;case"pulse":switch(t){case"width":if(En(r)){i.source.set({oscillator:{width:r}});return}break}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(t){case"phase":if(En(r)){i.source.set({oscillator:{phase:r}});return}break}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(t){case"harmonicity":if(En(r)){i.source.set({oscillator:{harmonicity:r}});return}break;case"modtype":case"modulationtype":if(vr(r)){i.source.set({oscillator:{modulationType:r}});return}break;case"modenv":case"modulationenvelope":if(ni(r)){const[o,a,c,l]=r;i.source.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(t){case"harmonicity":if(En(r)){i.source.set({oscillator:{harmonicity:r}});return}break;case"modindex":if(En(r)){i.source.set({oscillator:{modulationIndex:r}});return}break;case"modtype":if(vr(r)){i.source.set({oscillator:{modulationType:r}});return}break;case"modenv":if(ni(r)){const[o,a,c,l]=r;i.source.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(t){case"count":if(En(r)){i.source.set({oscillator:{count:r}});return}break;case"phase":if(En(r)){i.source.set({oscillator:{phase:r}});return}break;case"spread":if(En(r)){i.source.set({oscillator:{spread:r}});return}break}break}ti(jp.name(),n.target,`unknown ${s} config ${t}`)}break}}break;case"voicefx":if(ni(n.data)){const[e,t,r,i]=n.data,s=Wc.SOURCE[e],o=s==null?void 0:s.fx[t];if(fe(o)){switch(r){case"on":o.wet.value=.2;break;case"off":o.wet.value=0;break;default:if(En(r))o.wet.value=Ii(.01*r,0,1);else switch(t){case"vibrato":{switch(r){default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}case"chorus":{switch(r){default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}case"phaser":{const a=o;switch(r){case"q":En(i)&&(a.Q.value=i);break;case"octaves":En(i)&&(a.octaves=i);break;case"basefrequency":En(i)&&(a.baseFrequency=i);break;default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}case"distortion":{const a=o;switch(r){case"distortion":En(i)&&(a.distortion=i);break;case"oversample":switch(i){case"2x":case"4x":case"none":a.oversample=i;break}break;default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}case"echo":{const a=o;switch(r){case"delaytime":a.delayTime.value=i;break;default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}case"reverb":{const a=o;switch(r){case"decay":a.decay=i;break;case"predelay":a.preDelay=i;break;default:ti(jp.name(),n.target,`unknown ${t} config ${r}`);break}break}}break}o instanceof UC&&(o.wet.value===0?o.set({delayTime:PM}):o.get().delayTime===PM&&o.set({delayTime:ope}));return}ti(jp.name(),n.target,`unknown fx ${t}`)}break;case"tts":du("tts",async()=>{if(fe(yR)||(yR=new FE({locale:"en-US"})),fe(Wc)&&ni(n.data)){const[e,t]=n.data,r=await yR.createAudio({input:t,options:{voice:e||"en-US-GuyNeural"}});Wc.addttsaudiobuffer(r)}});break}});/**
 * postprocessing v6.36.4 build Tue Nov 05 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rüschen
 * @license Zlib
 */var SR=1/1e3,bpe=1e3,Tpe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*SR}get fixedDelta(){return this._fixedDelta*SR}set fixedDelta(n){this._fixedDelta=n*bpe}get elapsed(){return this._elapsed*SR}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},xpe=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new sd;return t.setAttribute("position",new Gs(n,3)),t.setAttribute("uv",new Gs(e,2)),t})(),ld=class DM{static get fullscreenGeometry(){return xpe}constructor(e="Pass",t=new wx,r=new Uw){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new $h(DM.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new wx),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=E_){}render(e,t,r,i,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Tu||t instanceof mm||t instanceof so||t instanceof DM)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},wpe=class extends ld{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,r,i){const s=n.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Cpe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Rpe="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Ape=class extends tl{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Gi(null),opacity:new Gi(1)},blending:Kh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Cpe,vertexShader:Rpe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Mpe=class extends ld{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Ape,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new Tu(1,1,{minFilter:kl,magFilter:kl,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,r,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Ec?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===yo&&(this.renderTarget.texture.colorSpace=yo))}},R2=new pi,Gz=class extends ld{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=s!==null,l=o>=0;c?(n.getClearColor(R2),n.setClearColor(s,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(R2,a):l&&n.setClearAlpha(a)}},Ipe=class extends ld{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Gz(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,r,i){const s=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},kpe=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Mpe,this.depthTexture=null,this.passes=[],this.timer=new Tpe,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new Ln),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Ec&&e.outputColorSpace===yo&&(this.inputBuffer.texture.colorSpace=yo,this.outputBuffer.texture.colorSpace=yo,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,t=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new nk;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=o_,e.type=s_):e.type=Pg,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const s=this.renderer,o=s===null?new Ln:s.getDrawingBufferSize(new Ln),a={minFilter:kl,magFilter:kl,stencilBuffer:t,depthBuffer:e,type:r},c=new Tu(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),r===Ec&&s!==null&&s.outputColorSpace===yo&&(c.texture.colorSpace=yo),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new Ln),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(t,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(t,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof Ipe?o=!0:u instanceof wpe&&(o=!1))}setSize(e,t,r){const i=this.renderer,s=i.getSize(new Ln);(e===void 0||t===void 0)&&(e=s.width,t=s.height),(s.width!==e||s.height!==t)&&i.setSize(e,t,r);const o=i.getDrawingBufferSize(new Ln);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),ld.fullscreenGeometry.dispose()}},Sf={NONE:0,DEPTH:1,CONVOLUTION:2},Ci={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Ope=class{constructor(){this.shaderParts=new Map([[Ci.FRAGMENT_HEAD,null],[Ci.FRAGMENT_MAIN_UV,null],[Ci.FRAGMENT_MAIN_IMAGE,null],[Ci.VERTEX_HEAD,null],[Ci.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Sf.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Xg}},ER=!1,A2=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case gu:t=this.materialsFlatShadedDoubleSide;break;case Da:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case gu:t=this.materialsDoubleSide;break;case Da:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof tl))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,t.set(i,s))}const r=n.clone();for(const i of t)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=am;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Da,r}),this.materialsDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=gu,r}),this.materialsFlatShaded=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Da,r}),this.materialsFlatShadedDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=gu,r})}}render(n,e,t){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,ER){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return ER}static set workaroundEnabled(n){ER=n}},mg=-1,Jv=class extends pm{constructor(n,e=mg,t=mg,r=1){super(),this.resizable=n,this.baseSize=new Ln(1,1),this.preferredSize=new Ln(e,t),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Ln,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,r=this.scale;e.width!==mg?t.width=e.width:e.height!==mg?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*r),e.height!==mg?t.height=e.height:e.width!==mg?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(mg),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return mg}},Zr={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Npe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Ppe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Dpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Lpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Upe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Fpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Bpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",zpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Vpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",jpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Hpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Gpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Wpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",$pe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",qpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",Xpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Kpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Ype="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",Jpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Qpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Zpe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",eme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",tme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",nme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",rme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",ime="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",sme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",ome="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",ame="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",cme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",lme="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",ume="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",hme=new Map([[Zr.ADD,Npe],[Zr.ALPHA,Ppe],[Zr.AVERAGE,Dpe],[Zr.COLOR,Lpe],[Zr.COLOR_BURN,Upe],[Zr.COLOR_DODGE,Fpe],[Zr.DARKEN,Bpe],[Zr.DIFFERENCE,zpe],[Zr.DIVIDE,Vpe],[Zr.DST,null],[Zr.EXCLUSION,jpe],[Zr.HARD_LIGHT,Hpe],[Zr.HARD_MIX,Gpe],[Zr.HUE,Wpe],[Zr.INVERT,$pe],[Zr.INVERT_RGB,qpe],[Zr.LIGHTEN,Xpe],[Zr.LINEAR_BURN,Kpe],[Zr.LINEAR_DODGE,Ype],[Zr.LINEAR_LIGHT,Jpe],[Zr.LUMINOSITY,Qpe],[Zr.MULTIPLY,Zpe],[Zr.NEGATION,eme],[Zr.NORMAL,tme],[Zr.OVERLAY,nme],[Zr.PIN_LIGHT,rme],[Zr.REFLECT,ime],[Zr.SATURATION,sme],[Zr.SCREEN,ome],[Zr.SOFT_LIGHT,ame],[Zr.SRC,cme],[Zr.SUBTRACT,lme],[Zr.VIVID_LIGHT,ume]]),dme=class extends pm{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Gi(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return hme.get(this.blendFunction)}},LM=class extends pm{constructor(n,e,{attributes:t=Sf.NONE,blendFunction:r=Zr.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new dme(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Xg,this._outputColorSpace=of}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=E_){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof Tu||e instanceof mm||e instanceof so||e instanceof ld)&&this[n].dispose()}}},dT={RED:0,GREEN:1,BLUE:2,ALPHA:3},Wz=class extends ld{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Gz,this.overrideMaterialManager=t===null?null:new A2(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new A2(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,s,o):n.render(s,o),o.layers.mask=c,s.background=l,n.shadowMap.autoUpdate=u}},fme=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,pme="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",mme=class extends tl{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Gi(null),normalBuffer:new Gi(null),texelSize:new Gi(new Ln)},blending:Kh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:fme,vertexShader:pme})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=E_){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},gme=class extends ld{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:t=Jv.AUTO_SIZE,height:r=Jv.AUTO_SIZE,resolutionX:i=t,resolutionY:s=r}={}){super("DepthDownsamplingPass");const o=new mme;o.normalBuffer=n,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Tu(1,1,{minFilter:bo,magFilter:bo,depthBuffer:!1,type:hf}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Jv(this,i,s,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=E_){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,t,r,i){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){const r=n.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},_me=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,vme="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",yme=class extends tl{constructor(n,e,t,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Ow.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Gi(null),depthBuffer:new Gi(null),resolution:new Gi(new Ln),texelSize:new Gi(new Ln),cameraNear:new Gi(.3),cameraFar:new Gi(1e3),aspect:new Gi(1),time:new Gi(0)},blending:Kh,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=E_){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=_me.replace(Ci.FRAGMENT_HEAD,n.get(Ci.FRAGMENT_HEAD)||"").replace(Ci.FRAGMENT_MAIN_UV,n.get(Ci.FRAGMENT_MAIN_UV)||"").replace(Ci.FRAGMENT_MAIN_IMAGE,n.get(Ci.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=vme.replace(Ci.VERTEX_HEAD,n.get(Ci.VERTEX_HEAD)||"").replace(Ci.VERTEX_MAIN_SUPPORT,n.get(Ci.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof fu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return Ci}};function M2(n,e,t){for(const r of e){const i="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(s,i))}}function Sme(n,e,t){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(t.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&Sf.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(Ci.FRAGMENT_HEAD)||"",u=c.get(Ci.FRAGMENT_MAIN_UV)||"",h=c.get(Ci.FRAGMENT_MAIN_IMAGE)||"",d=c.get(Ci.VERTEX_HEAD)||"",p=c.get(Ci.VERTEX_MAIN_SUPPORT)||"";const _=new Set,y=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const A=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);p+=`	${n}MainSupport(`,p+=A?`vUv);
`:`);
`;for(const R of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const I of R[1].split(/\s*,\s*/))t.varyings.add(I),_.add(I),y.add(I);for(const R of i.matchAll(a))y.add(R[1])}for(const A of r.matchAll(a))y.add(A[1]);for(const A of e.defines.keys())y.add(A.replace(/\([\w\s,]*\)/g,""));for(const A of e.uniforms.keys())y.add(A);y.delete("while"),y.delete("for"),y.delete("if"),e.uniforms.forEach((A,R)=>t.uniforms.set(n+R.charAt(0).toUpperCase()+R.slice(1),A)),e.defines.forEach((A,R)=>t.defines.set(n+R.charAt(0).toUpperCase()+R.slice(1),A));const S=new Map([["fragment",r],["vertex",i]]);M2(n,y,t.defines),M2(n,y,S),r=S.get("fragment"),i=S.get("vertex");const T=e.blendMode;if(t.blendModes.set(T.blendFunction,T),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===yo?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==of?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const A=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&Sf.DEPTH&&A.test(r)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const R=n+"BlendOpacity";t.uniforms.set(R,T.opacity),h+=`color0 = blend${T.blendFunction}(color0, color1, ${R});

	`,l+=`uniform float ${R};

`}if(l+=r+`
`,i!==null&&(d+=i+`
`),c.set(Ci.FRAGMENT_HEAD,l),c.set(Ci.FRAGMENT_MAIN_UV,u),c.set(Ci.FRAGMENT_MAIN_IMAGE,h),c.set(Ci.VERTEX_HEAD,d),c.set(Ci.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const A of e.extensions)t.extensions.add(A)}}var Eme=class extends ld{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new yme(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Ope;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===Zr.DST)n.attributes|=o.getAttributes()&Sf.DEPTH;else{if(n.attributes&o.getAttributes()&Sf.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);Sme("e"+e++,o,n)}let t=n.shaderParts.get(Ci.FRAGMENT_HEAD),r=n.shaderParts.get(Ci.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(Ci.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;n.attributes&Sf.DEPTH?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===yo&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Ci.FRAGMENT_HEAD,t),n.shaderParts.set(Ci.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set(Ci.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=E_){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,r,i){for(const s of this.effects)s.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const r of this.effects)r.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==Ec&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},bme=class extends ld{constructor(n,e,{renderTarget:t,resolutionScale:r=1,width:i=Jv.AUTO_SIZE,height:s=Jv.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Wz(n,e,new CK);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new pi(7829503),l.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new Tu(1,1,{minFilter:bo,magFilter:bo}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Jv(this,o,a,r);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,r,i){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,s,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}};let aS;function Tme(){var n;if(aS!==void 0)return aS;try{let e;const t=document.createElement("canvas");return aS=!!(window.WebGL2RenderingContext&&(e=t.getContext("webgl2"))),e&&((n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext()),aS}catch{return aS=!1}}const xme=at.createContext(null),I2=n=>(n.getAttributes()&Sf.CONVOLUTION)===Sf.CONVOLUTION,wme=Xh.memo(at.forwardRef(({children:n,camera:e,scene:t,resolutionScale:r,enabled:i=!0,renderPriority:s=1,autoClear:o=!0,depthBuffer:a,enableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=Ny},d)=>{const{gl:p,scene:_,camera:y,size:S}=Ly(),T=t||_,A=e||y,[R,I,U]=at.useMemo(()=>{const F=Tme(),V=new kpe(p,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&F?u:0,frameBufferType:h});V.addPass(new Wz(T,A));let W=null,X=null;return c&&(X=new bme(T,A),X.enabled=!1,V.addPass(X),r!==void 0&&F&&(W=new gme({normalBuffer:X.texture,resolutionScale:r}),W.enabled=!1,V.addPass(W))),[V,X,W]},[A,p,a,l,u,h,T,c,r]);at.useEffect(()=>R==null?void 0:R.setSize(S.width,S.height),[R,S]),Vw((F,V)=>{if(i){const W=p.autoClear;p.autoClear=o,l&&!o&&p.clearStencil(),R.render(V),p.autoClear=W}},i?s:0);const D=at.useRef(null),L=sY(D);at.useLayoutEffect(()=>{const F=[];if(D.current&&L.current&&R){const V=L.current.objects;for(let W=0;W<V.length;W++){const X=V[W];if(X instanceof LM){const $=[X];if(!I2(X)){let te=null;for(;(te=V[W+1])instanceof LM&&!I2(te);)$.push(te),W++}const K=new Eme(A,...$);F.push(K)}else X instanceof ld&&F.push(X)}for(const W of F)R==null||R.addPass(W);I&&(I.enabled=!0),U&&(U.enabled=!0)}return()=>{for(const V of F)R==null||R.removePass(V);I&&(I.enabled=!1),U&&(U.enabled=!1)}},[R,n,A,I,U,L]),at.useEffect(()=>{const F=p.toneMapping;return p.toneMapping=mf,()=>{p.toneMapping=F}},[]);const z=at.useMemo(()=>({composer:R,normalPass:I,downSamplingPass:U,resolutionScale:r,camera:A,scene:T}),[R,I,U,r,A,T]);return at.useImperativeHandle(d,()=>R,[R]),Fe.jsx(xme.Provider,{value:z,children:Fe.jsx("group",{ref:D,children:n})})}));let Cme=0;const k2=new WeakMap,Rme=(n,e)=>Xh.forwardRef(function({blendFunction:r=void 0,opacity:i=void 0,...s},o){let a=k2.get(n);if(!a){const u=`@react-three/postprocessing/${n.name}-${Cme++}`;ok({[u]:n}),k2.set(n,a=u)}const c=Ly(u=>u.camera),l=Xh.useMemo(()=>{var u,h;return[...(u=void 0)!=null?u:[],...(h=s.args)!=null?h:[{...e,...s}]]},[JSON.stringify(s)]);return Fe.jsx(a,{camera:c,"blendMode-blendFunction":r,"blendMode-opacity-value":i,...s,ref:o,args:l})});function bR(n,e,t,r){return new(t||(t=Promise))(function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof t?u:new t(function(h){h(u)})).then(o,a)}c((r=r.apply(n,[])).next())})}const Ame=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function O2(n){return n=n.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const $z=typeof window>"u",ef=(()=>{if($z)return;const{userAgent:n,platform:e,maxTouchPoints:t}=window.navigator,r=/(iphone|ipod|ipad)/i.test(n),i=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(n)||r||i,isSafari12:/Version\/12.+Safari/.test(n),isFirefox:/Firefox/.test(n)}})();function Mme(n,e,t){if(!t)return[e];const r=function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,d=l.createShader(35633),p=l.createShader(35632),_=l.createProgram();if(!(p&&d&&_))return;l.shaderSource(d,u),l.shaderSource(p,h),l.compileShader(d),l.compileShader(p),l.attachShader(_,d),l.attachShader(_,p),l.linkProgram(_),l.detachShader(_,d),l.detachShader(_,p),l.deleteShader(d),l.deleteShader(p),l.useProgram(_);const y=l.createBuffer();l.bindBuffer(34962,y),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const S=l.getAttribLocation(_,"aPosition");l.vertexAttribPointer(S,3,5126,!1,0,0),l.enableVertexAttribArray(S),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const T=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,T),l.deleteProgram(_),l.deleteBuffer(y),T.join("")}(n),i="801621810",s="8016218135",o="80162181161",a=ef!=null&&ef.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter(([,,l])=>l>=14):(c=a.filter(([,l])=>l===r),c.length||(c=a)),c.map(([l])=>`apple ${l} gpu`)}class N2 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const TR=[],P2=[];function Ime(n,e){if(n===e)return 0;const t=n;n.length>e.length&&(n=e,e=t);let r=n.length,i=e.length;for(;r>0&&n.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&n.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,h=0;for(;u<r;)P2[u]=n.charCodeAt(o+u),TR[u]=++u;for(;h<i;)for(s=e.charCodeAt(o+h),a=h++,l=h,u=0;u<r;u++)c=s===P2[u]?a:a+1,a=TR[u],l=TR[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function kme(n){return n!=null}const Ome=({mobileTiers:n=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.56/dist/benchmarks"}={})=>bR(void 0,void 0,void 0,function*(){const o={};if($z)return{tier:0,type:"SSR"};const{isIpad:a=!!(ef!=null&&ef.isIpad),isMobile:c=!!(ef!=null&&ef.isMobile),screenSize:l=window.screen,loadBenchmarks:u=U=>bR(void 0,void 0,void 0,function*(){const D=yield fetch(`${s}/${U}`).then(L=>L.json());if(parseInt(D.shift().split(".")[0],10)<4)throw new N2("Detect GPU benchmark data is out of date. Please update to version 4x");return D})}=t;let{renderer:h}=t;const d=(U,D,L,z,F)=>({device:F,fps:z,gpu:L,isMobile:c,tier:U,type:D});let p,_="";if(h)h=O2(h),p=[h];else{const U=r||function(L,z=!1){const F={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:z,powerPreference:"high-performance",stencil:!1};L&&delete F.powerPreference;const V=window.document.createElement("canvas"),W=V.getContext("webgl",F)||V.getContext("experimental-webgl",F);return W??void 0}(ef==null?void 0:ef.isSafari12,i);if(!U)return d(0,"WEBGL_UNSUPPORTED");const D=ef!=null&&ef.isFirefox?null:U.getExtension("WEBGL_debug_renderer_info");if(h=D?U.getParameter(D.UNMASKED_RENDERER_WEBGL):U.getParameter(U.RENDERER),!h)return d(1,"FALLBACK");_=h,h=O2(h),p=function(L,z,F){return z==="apple gpu"?Mme(L,z,F):[z]}(U,h,c)}const y=(yield Promise.all(p.map(function(U){var D;return bR(this,void 0,void 0,function*(){const L=(Ne=>{const _e=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const Ae of _e)if(Ne.includes(Ae))return Ae})(U);if(!L)return;const z=`${c?"m":"d"}-${L}${a?"-ipad":""}.json`,F=o[z]=(D=o[z])!==null&&D!==void 0?D:u(z);let V;try{V=yield F}catch(Ne){if(Ne instanceof N2)throw Ne;return}const W=function(Ne){var _e;const Ae=(Ne=Ne.replace(/\([^)]+\)/,"")).match(/\d+/)||Ne.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(_e=Ae==null?void 0:Ae.join("").replace(/\W|amd/g,""))!==null&&_e!==void 0?_e:""}(U);let X=V.filter(([,Ne])=>Ne===W);X.length||(X=V.filter(([Ne])=>Ne.includes(U)));const $=X.length;if($===0)return;const K=U.split(/[.,()\[\]/\s]/g).sort().filter((Ne,_e,Ae)=>_e===0||Ne!==Ae[_e-1]).join(" ");let te,[Q,,,,ne]=$>1?X.map(Ne=>[Ne,Ime(K,Ne[2])]).sort(([,Ne],[,_e])=>Ne-_e)[0][0]:X[0],G=Number.MAX_VALUE;const{devicePixelRatio:J}=window,re=l.width*J*l.height*J;for(const Ne of ne){const[_e,Ae]=Ne,Ye=_e*Ae,Ze=Math.abs(re-Ye);Ze<G&&(G=Ze,te=Ne)}if(!te)return;const[,,ue,ye]=te;return[G,ue,Q,ye]})}))).filter(kme).sort(([U=Number.MAX_VALUE,D],[L=Number.MAX_VALUE,z])=>U===L?D-z:U-L);if(!y.length){const U=Ame.find(D=>h.includes(D));return U?d(0,"BLOCKLISTED",U):d(1,"FALLBACK",`${h} (${_})`)}const[,S,T,A]=y[0];if(S===-1)return d(0,"BLOCKLISTED",T,S,A);const R=c?n:e;let I=0;for(let U=0;U<R.length;U++)S>=R[U]&&(I=U);return d(I,"BENCHMARK",T,S,A)});var lh=typeof window<"u"?window:{screen:{},navigator:{}},Cy=(lh.matchMedia||function(){return{matches:!1}}).bind(lh),Nme={get passive(){return!0}},qz=function(){};lh.addEventListener&&lh.addEventListener("p",qz,Nme);lh.removeEventListener&&lh.removeEventListener("p",qz,!1);var ZO="ontouchstart"in lh,Pme="TouchEvent"in lh,Dme=ZO||Pme&&Cy("(any-pointer: coarse)").matches,D2=(lh.navigator.maxTouchPoints||0)>0||Dme,Xz=lh.navigator.userAgent||"",Lme=Cy("(pointer: coarse)").matches&&/iPad|Macintosh/.test(Xz)&&Math.min(lh.screen.width||0,lh.screen.height||0)>=768,Kz=(Cy("(pointer: coarse)").matches||!Cy("(pointer: fine)").matches&&ZO)&&!/Windows.*Firefox/.test(Xz),Ume=Cy("(any-pointer: fine)").matches||Cy("(any-hover: hover)").matches||Lme||!ZO,UM=D2&&(Ume||!Kz)?"hybrid":D2?"touchOnly":"mouseOnly",Fme=UM==="mouseOnly"?"mouse":UM==="touchOnly"||Kz?"touch":"mouse",Yz={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(Ng,function(){var t=function(){function r(p){return o.appendChild(p.dom),p}function i(p){for(var _=0;_<o.children.length;_++)o.children[_].style.display=_===p?"block":"none";s=p}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(p){p.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new t.Panel("FPS","#0ff","#002")),h=r(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=r(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var p=(performance||Date).now();if(h.update(p-a,200),p>c+1e3&&(u.update(1e3*l/(p-c),100),c=p,l=0,d)){var _=performance.memory;d.update(_.usedJSHeapSize/1048576,_.jsHeapSizeLimit/1048576)}return p},update:function(){a=this.end()},domElement:o,setMode:i}};return t.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,d=3*l,p=2*l,_=3*l,y=15*l,S=74*l,T=30*l,A=document.createElement("canvas");A.width=u,A.height=h,A.style.cssText="width:80px;height:48px";var R=A.getContext("2d");return R.font="bold "+9*l+"px Helvetica,Arial,sans-serif",R.textBaseline="top",R.fillStyle=s,R.fillRect(0,0,u,h),R.fillStyle=i,R.fillText(r,d,p),R.fillRect(_,y,S,T),R.fillStyle=s,R.globalAlpha=.9,R.fillRect(_,y,S,T),{dom:A,update:function(I,U){o=Math.min(o,I),a=Math.max(a,I),R.fillStyle=s,R.globalAlpha=1,R.fillRect(0,0,u,y),R.fillStyle=i,R.fillText(c(I)+" "+r+" ("+c(o)+"-"+c(a)+")",d,p),R.drawImage(A,_+l,y,S-l,T,_,y,S-l,T),R.fillRect(_+S-l,y,l,T),R.fillStyle=s,R.globalAlpha=.9,R.fillRect(_+S-l,y,l,c((1-I/U)*T))}}},t})})(Yz);var Bme=Yz.exports;const zme=Wl(Bme),FM=3,Qv=8,Zv=14,Qp=16;var SS=(n=>(n[n.BLANK=0]="BLANK",n[n.TILES=1]="TILES",n[n.SPRITES=2]="SPRITES",n[n.DITHER=3]="DITHER",n[n.MEDIA=4]="MEDIA",n[n.CONTROL=5]="CONTROL",n))(SS||{});function Vme(n){let e=0,t=0,r=0,i=0,s=1;return n.forEach(o=>{switch(o.type){case 1:e=Math.max(e,o.width),t=Math.max(t,o.height);break;case 3:e=Math.max(e,o.width),t=Math.max(t,o.height);break;case 5:r=o.focusx,i=o.focusy,s=o.viewscale;break}}),{width:e,height:t,focusx:r,focusy:i,viewscale:s}}var vc=(n=>(n[n.START=0]="START",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n[n.TOP=3]="TOP",n[n.BOTTOM=4]="BOTTOM",n[n.SCROLL=5]="SCROLL",n))(vc||{});const jme={start:0,left:1,right:2,top:3,bottom:4,scroll:5},Hme={0:1,1:20,2:20,3:1,4:1,5:40};function $y(n,e){return`${n}:${e}`}const Jz=1,Qz=16,Zz=256;var it=(n=>(n[n.NONE=0]="NONE",n[n.ALT=1]="ALT",n[n.CTRL=2]="CTRL",n[n.SHIFT=3]="SHIFT",n[n.MOVE_UP=4]="MOVE_UP",n[n.MOVE_DOWN=5]="MOVE_DOWN",n[n.MOVE_LEFT=6]="MOVE_LEFT",n[n.MOVE_RIGHT=7]="MOVE_RIGHT",n[n.OK_BUTTON=8]="OK_BUTTON",n[n.CANCEL_BUTTON=9]="CANCEL_BUTTON",n[n.MENU_BUTTON=10]="MENU_BUTTON",n))(it||{});const kf=!!JSON.parse("false"),Gme=!!JSON.parse("false"),Wme=!!JSON.parse("false"),$me=!!JSON.parse("false");JSON.parse("false");const qme=!!JSON.parse("false"),Xme=!!JSON.parse("false"),Kme=!!JSON.parse("false"),mi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Qv*mi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Zv*mi.DRAW_CHAR_SCALE}},Yme=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,Jme=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,Qme=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,Zme=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,ege=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,tge=`
uniform float viewheight;
uniform sampler2D splat;

${Jme}
${Qme}
${Zme}
${Yme}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  vec2 edge = bendy(xn, 0.0091 * n, 0.0011 * -n);
  vec2 bent = edge.xy * 0.5 + 0.5;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.111);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.111);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class nge extends LM{constructor({splat:e,viewheight:t}={}){super("CRTShapeEffect",tge,{blendFunction:Zr.NORMAL,attributes:Sf.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new Gi(e)],["viewheight",new Gi(t??128)]])})}get splat(){var e;return(e=this.uniforms.get("splat"))==null?void 0:e.value}set splat(e){const{splat:t,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");t!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(ege)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==Ec&&i.set("TEXTURE_PRECISION_HIGH","1"),(t===null||(t==null?void 0:t.type)!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const e=this.splat;return!!(e!=null&&e.matrixAutoUpdate)}set uvTransform(e){const t=this.splat;fe(t)&&(t.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,t=e,r=e,i=e){const s="rgba";let o="";(e!==dT.RED||t!==dT.GREEN||r!==dT.BLUE||i!==dT.ALPHA)&&(o=[".",s[e],s[t],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){var e;(e=this.splat)!=null&&e.matrixAutoUpdate&&this.splat.updateMatrix()}}const rge=Rme(nge),ige="/assets/scratches-BBiC0fzb.gif",xR=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function eN(n,e){const{gl:t}=Ly(),r=CE(ik,xR(n)?Object.values(n):n);return at.useLayoutEffect(()=>{e==null||e(r)},[e,r]),at.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(r)?s=r:r instanceof so?s=[r]:xR(r)&&(s=Object.values(r)),s.forEach(o=>{o instanceof so&&t.initTexture(o)})}},[t,r]),at.useMemo(()=>{if(xR(n)){const s={};let o=0;for(const a in n)s[a]=r[o++];return s}else return r},[n,r])}eN.preload=n=>CE.preload(ik,n);eN.clear=n=>CE.clear(ik,n);const L2=n=>{let e;const t=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const d=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(p=>p(e,d))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(t.add(l),()=>t.delete(l))},c=e=n(r,i,a);return a},tN=n=>n?L2(n):L2,sge=n=>n;function nN(n,e=sge){const t=Xh.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return Xh.useDebugValue(t),t}const U2=n=>{const e=tN(n),t=r=>nN(e,r);return Object.assign(t,e),t},nb=n=>n?U2(n):U2;function oge(n){const e=at.useRef();return t=>{const r=n(t);return(e.current===void 0||r===void 0?e.current===r:HB(e.current,r))?e.current:e.current=r}}const Zp=nb(()=>({desync:!1,gadget:{player:"",layers:[],panels:[],reset:!1,focus:""}}));var tx=(n=>(n[n.OFF=0]="OFF",n[n.INFO=1]="INFO",n[n.DEBUG=2]="DEBUG",n))(tx||{});const F2=128;var Yc=(n=>(n[n.TOP=0]="TOP",n[n.FULL=1]="FULL",n[n.BOTTOM=2]="BOTTOM",n[n.SPLIT_Y=3]="SPLIT_Y",n[n.SPLIT_Y_ALT=4]="SPLIT_Y_ALT",n[n.MAX=5]="MAX",n))(Yc||{});const Kc=nb(()=>({layout:0,terminal:{open:!0,level:1,logs:[]},editor:{open:!1,player:"",book:"",page:"",type:"",title:""}})),zo=nb(()=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})),go=nb(()=>({id:"",xscroll:0,yscroll:0,cursor:0,select:void 0})),age=new qe,e8=at.createContext([]);function FC(){return at.useContext(e8)}function cge({width:n=0,height:e=0,children:t,...r}){const i=at.useRef(null),[s]=at.useState(()=>{const a=[];return n&&a.push(new Hh,new Hh),e&&a.push(new Hh,new Hh),a}),[o]=at.useState(()=>[new qe(0,0,0),new qe(0,0,0),new qe(0,0,0),new qe(0,0,0),new qe(0,0,0)]);return Vw(()=>{if(i.current){const a=i.current.localToWorld(o[0].set(0,0,0)),c=[];if(n){const l=n*.5;c.push(i.current.localToWorld(o[3].set(l,0,0)),i.current.localToWorld(o[4].set(-l,0,0)))}if(e){const l=e*.5;c.push(i.current.localToWorld(o[1].set(0,l,0)),i.current.localToWorld(o[2].set(0,-l,0)))}for(let l=0;l<s.length;l+=1)s[l].setFromNormalAndCoplanarPoint(age.subVectors(a,c[l]).normalize(),c[l])}}),Fe.jsx(e8.Provider,{value:s,children:Fe.jsx("group",{position:[n*.5,e*.5,0],children:Fe.jsx("group",{ref:i,...r,children:Fe.jsx("group",{position:[n*-.5,e*-.5,0],children:t})})})})}const B2=n=>Symbol.iterator in n,z2=n=>"entries"in n,V2=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),r=e instanceof Map?e:new Map(e.entries());if(t.size!==r.size)return!1;for(const[i,s]of t)if(!Object.is(s,r.get(i)))return!1;return!0},lge=(n,e)=>{const t=n[Symbol.iterator](),r=e[Symbol.iterator]();let i=t.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=t.next(),s=r.next()}return!!i.done&&!!s.done};function uge(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null?!1:!B2(n)||!B2(e)?V2({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)}):z2(n)&&z2(e)?V2(n,e):lge(n,e)}function Zg(n){const e=Xh.useRef();return t=>{const r=n(t);return uge(e.current,r)?e.current:e.current=r}}const hge=Date.now(),jh={get value(){return(Date.now()-hge)/1e3%1e6}},dge=120;let t8=0;function fge(n){t8=dge/n}fge(150);const rN={get value(){return t8}};function iN(n){const e=n.clone();return e.uniforms.time=jh,e.uniforms.interval=rN,e}function pge(n,e,t,r){const i=e*t*4;for(let s=0,o=0;s<i;++o)n.image.data[s]=r[o]*255,s+=4;return n.needsUpdate=!0,n}function mge(n,e){const t=new Uint8Array(4*n*e);return new SB(t,n,e)}const gge=new tl({transparent:!1,uniforms:{color:{value:new pi(0,0,0)},data:{value:null}},vertexShader:`
      #include <clipping_planes_pars_vertex>
  
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
        
        #include <clipping_planes_vertex>
      }
    `,fragmentShader:`
      #include <clipping_planes_pars_fragment>
  
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        #include <clipping_planes_fragment>
  
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function _ge(){return iN(gge)}function BC(n,e,t){typeof n!="number"&&(n=0,e=0,t=1),typeof e!="number"&&(e=n,n=0,t=1),typeof t!="number"&&(t=1);const r=[],i=Math.min(n,e),s=Math.max(n,e);for(let o=i;o<=s;o+=t)r.push(o);return r}function vge(n){return n[yS(0,n.length-1)]}function yge(n,e){return e[vpe(n,0,e.length-1)]}function Rv(...n){return vge(n.flat())}function Sge(n,...e){return yge(n,e.flat())}function n8(n,e=16){return n?BC(e-1).map(t=>{const r=t*FM;return new pi(n.bits[r]/63,n.bits[r+1]/63,n.bits[r+2]/63)}):[]}function Ege(n){const e=document.createElement("canvas");if(e.width=(n==null?void 0:n.width)||1,e.height=(n==null?void 0:n.height)||1,n){const t=e.getContext("2d"),r=t==null?void 0:t.getImageData(0,0,n.width,n.height);if(r&&t){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=n.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}t.putImageData(r,0,0)}}return e}function r8(n,e){return{width:n,height:e,size:n*e,bits:new Uint8Array(n*e).fill(0)}}const bge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Tge=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);function xge(n){const e=Math.floor(n.length/FM);if(e*FM!==n.length)return;const t=r8(3,e);for(let r=0;r<t.bits.length;++r)t.bits[r]=n[r];return t}const wge=xge(Tge);function i8(){return wge}const j2=14;function Cge(n,e){return n&1<<e?255:0}function Rge(n){const e=Math.floor(n.length/j2);if(e*j2!==n.length)return;const t=Math.ceil(e/Qp),r=Qv*Qp,i=r8(r,Zv*t);let s=0,o=0,a=0;for(let c=0;c<n.length;++c){const l=o*Zv+a,u=n[c];for(let h=0;h<Qv;++h){const d=s*Qv+h;i.bits[d+l*r]=Cge(u,7-h)}++a,a===Zv&&(a=0,++s,s===Qp&&(s=0,++o))}return i}const Age=Rge(bge);function zC(){return Age}function Mge(n){return n.generateMipmaps=!1,n.minFilter=bo,n.magFilter=bo,n.needsUpdate=!0,n}function sN(n){if(fe(n))return Mge(new wK(Ege(n)))}function s8(n){return at.useMemo(()=>sN(n),[n])}const nw=[0,1,0],o8=[1,1,0],rw=[1,0,0],a8=[0,0,0],Ige=new Float32Array([...nw,...rw,...o8,...nw,...a8,...rw]),kge=new Float32Array([...nw.slice(0,2),...rw.slice(0,2),...o8.slice(0,2),...nw.slice(0,2),...a8.slice(0,2),...rw.slice(0,2)]);function Oge(n,e,t,r,i,s){const o=e*t*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;n.image.data[a++]=l%Qp,n.image.data[a++]=Math.floor(l/Qp),n.image.data[a++]=i[c]??16,n.image.data[a++]=s[c]??16}return n.needsUpdate=!0,n}function Nge(n,e){const t=new Uint8Array(4*n*e),r=new SB(t,n,e,Pw,Ec);return r.internalFormat="RGBA8UI",r}function c8(n,e,t){const r=e*mi.DRAW_CHAR_WIDTH(),i=t*mi.DRAW_CHAR_HEIGHT(),s=Ige.map((o,a)=>{switch(a%3){case 0:return o*r;case 1:return o*i;default:return o}});n.setAttribute("position",new Gs(s,3)),n.setAttribute("uv",new Gs(kge,2)),n.computeBoundingBox(),n.computeBoundingSphere()}const Pge=n8(i8()),H2=sN(zC()),Dge=new tl({transparent:!1,uniforms:{time:jh,interval:rN,map:new Gi(H2),alt:new Gi(H2),data:new Gi(null),palette:new Gi(Pge),size:{value:new Ln},step:{value:new Ln}},vertexShader:`
    #include <clipping_planes_pars_vertex>
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    varying vec2 vUv;

    void main() {
      #include <clipping_planes_fragment>

      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      vec3 color = palette[colori];

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Kr.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function Lge(){return iN(Dge)}function VC({width:n,height:e,alphas:t}){const r=FC(),i=at.useRef(null),[s]=at.useState(()=>_ge());return at.useEffect(()=>{s.uniforms.data.value=mge(n,e)},[s.uniforms.data,n,e]),at.useEffect(()=>{pge(s.uniforms.data.value,n,e,t)},[s.uniforms.data.value,n,e,t]),at.useEffect(()=>{i.current&&(c8(i.current,n,e),s.clipping=r.length>0,s.clippingPlanes=r,s.needsUpdate=!0)},[s,r,n,e]),Fe.jsx("mesh",{material:s,children:Fe.jsx("bufferGeometry",{ref:i})})}function Uge({width:n,height:e,alpha:t}){const r=at.useMemo(()=>new Array(n*e).fill(t),[n,e,t]);return Fe.jsx(VC,{width:n,height:e,alphas:r})}const cS=new OK,k0=new Ln;function BM({width:n,height:e,top:t,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=at.useMemo(()=>{const l=new Array(n*e);cS.min.x=r,cS.min.y=t,cS.max.x=i,cS.max.y=s,k0.x=0,k0.y=0;for(let u=0;u<l.length;++u)l[u]=l$.smootherstep(1-cS.distanceToPoint(k0)*o,0,1)*a,++k0.x,k0.x>=n&&(k0.x=0,++k0.y);return l},[n,e,t,r,i,s,o,a]);return Fe.jsx(VC,{width:n,height:e,alphas:c})}const Fge=n8(i8()),G2=sN(zC()),Bge=a3*2,zge=new tl({transparent:!1,uniforms:{time:jh,interval:rN,smoothrate:new Gi(Bge),map:new Gi(G2),alt:new Gi(G2),palette:new Gi(Fge),pointSize:{value:new Ln(1,1)},rows:new Gi(1),step:new Gi(new Ln)},vertexShader:`
    #include <clipping_planes_pars_vertex>

    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 empty;

    vec4 bgFromIndex(float index) {
      if (int(index) >= ${Kr.ONCLEAR}) {
        return empty;
      }
      vec4 bg;
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      vec3 sourceColor = colorFromIndex(lastColor.x);
      vec3 destColor = colorFromIndex(charData.z);
      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      vCharData.xy = charData.xy;

      animPosition = animPosition * pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x += (pointSize.y - pointSize.x) * 0.5;

      vec4 mvPosition = modelViewMatrix * vec4(animPosition, 0.0, 1.0);
      gl_Position = projectionMatrix * mvPosition;      

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * 2.0;
      
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 pointSize;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      #include <clipping_planes_fragment>

      float xscale = pointSize.y / pointSize.x;
      float px = gl_PointCoord.x * xscale;
      
      if (vVisible == 0.0 || px >= 1.0) {
        discard;
      }

      vec2 lookup = vec2(vCharData.x, vCharData.y);

      vec2 idx = vec2(px, 1.0 - gl_PointCoord.y);
      vec2 char = vec2(lookup.x * step.x, (rows - lookup.y) * step.y);
      vec2 uv = idx * step + char;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        gl_FragColor = vBg;
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function Vge(){return iN(zge)}const jge=zC(),W2=2048;function Hge({sprites:n}){const e=s8(jge),t=FC(),r=at.useRef(null),i=at.useRef([]),[s]=at.useState(()=>Vge()),{width:o=0,height:a=0}=(e==null?void 0:e.image)??{};return at.useMemo(()=>{var h;i.current.length===0&&(i.current=Array.from({length:W2},()=>({id:"",x:0,y:0,char:0,color:0,bg:0})));const c={};for(let d=0;d<n.length;++d)c[n[d].id]=n[d];const l=new Set(i.current.map(d=>d.id));let u=0;for(let d=0;d<W2;++d)if(i.current[d].id){const p=c[i.current[d].id];fe(p)?i.current[d]={...p}:i.current[d].id=""}else if(u<n.length){for(;l.has((h=n[u])==null?void 0:h.id)===!0;)++u;u<n.length&&(i.current[d]={...n[u++]})}},[n]),at.useEffect(()=>{const{current:c}=r,{current:l}=i;if(!c||!l)return;let u=c.getAttribute("visible"),h=c.getAttribute("lastVisible"),d=c.getAttribute("position"),p=c.getAttribute("charData"),_=c.getAttribute("lastPosition"),y=c.getAttribute("lastColor"),S=c.getAttribute("lastBg"),T=c.getAttribute("animShake"),A=c.getAttribute("animBounce");if(!u||u.count!==l.length){u=new Gs(new Float32Array(l.length),1),h=new Gs(new Float32Array(l.length),1),d=new Gs(new Float32Array(l.length*3),3),p=new Gs(new Float32Array(l.length*4),4),_=new Gs(new Float32Array(l.length*3),3),y=new Gs(new Float32Array(l.length*2),2),S=new Gs(new Float32Array(l.length*2),2),T=new Gs(new Float32Array(l.length*2),2),A=new Gs(new Float32Array(l.length*2),2);for(let R=0;R<l.length;++R){const I=l[R],U=I.id?1:0;u.setX(R,U),h.setX(R,U),d.setXY(R,I.x,I.y),p.setXYZW(R,I.char%Qp,Math.floor(I.char/Qp),I.color,I.bg),_.setXYZ(R,I.x,I.y,jh.value),y.setXY(R,I.color,jh.value),S.setXY(R,I.bg,jh.value),T.setXY(R,0,jh.value-1e6),A.setXY(R,0,jh.value-1e6)}c.setAttribute("visible",u),c.setAttribute("lastVisible",h),c.setAttribute("position",d),c.setAttribute("charData",p),c.setAttribute("lastPosition",_),c.setAttribute("lastColor",y),c.setAttribute("lastBg",S),c.setAttribute("animShake",T),c.setAttribute("animBounce",A)}else for(let R=0;R<l.length;++R){const I=l[R],U=d.getX(R),D=d.getY(R),L=p.getX(R),z=p.getY(R),F=p.getZ(R),V=p.getW(R);h.setX(R,u.getX(R)),h.needsUpdate=!0,u.setX(R,I.id?1:0),u.needsUpdate=!0;const W=h.getX(R)===0&&u.getX(R)===1;(W||U!==I.x||D!==I.y)&&(_.setXYZ(R,W?I.x:U,W?I.y:D,jh.value),_.needsUpdate=!0,d.setXY(R,I.x,I.y),d.needsUpdate=!0),(W||F!==I.color)&&(y.setXY(R,W?I.color:F,jh.value),y.needsUpdate=!0,p.setZ(R,I.color),p.needsUpdate=!0),(W||V!==I.bg)&&(S.setXY(R,W?I.bg:V,jh.value),S.needsUpdate=!0,p.setW(R,I.bg),p.needsUpdate=!0);const X=I.char%Qp,$=Math.floor(I.char/Qp);(L!==X||z!==$)&&(p.setXY(R,X,$),p.needsUpdate=!0)}c.computeBoundingBox(),c.computeBoundingSphere()},[n]),at.useEffect(()=>{if(!e||!r.current)return;const c=Math.round(o/Qv),l=Math.round(a/Zv);s.uniforms.pointSize.value.x=mi.DRAW_CHAR_WIDTH(),s.uniforms.pointSize.value.y=mi.DRAW_CHAR_HEIGHT(),s.uniforms.rows.value=l-1,s.uniforms.step.value.x=1/c,s.uniforms.step.value.y=1/l,s.clipping=t.length>0,s.clippingPlanes=t,s.needsUpdate=!0},[e,s,o,a,t]),Fe.jsx("points",{frustumCulled:!1,material:s,children:Fe.jsx("bufferGeometry",{ref:r})})}const Gge=zC();function l8({width:n,height:e,char:t,color:r,bg:i}){const s=s8(Gge),o=FC(),[a]=at.useState(()=>Lge()),c=at.useRef(null),{width:l=0,height:u=0}=(s==null?void 0:s.image)??{};return at.useEffect(()=>{n===0||e===0||(a.uniforms.data.value=Nge(n,e))},[a.uniforms.data,n,e]),at.useEffect(()=>{n===0||e===0||Oge(a.uniforms.data.value,n,e,t,r,i)},[a.uniforms.data.value,n,e,t,r,i]),at.useEffect(()=>{n===0||e===0||!c.current||!s||(c8(c.current,n,e),a.uniforms.size.value.x=1/n,a.uniforms.size.value.y=1/e,a.uniforms.step.value.x=1/Math.round(l/Qv),a.uniforms.step.value.y=1/Math.round(u/Zv),a.clipping=o.length>0,a.clippingPlanes=o,a.needsUpdate=!0)},[s,a,n,e,l,u,o]),Fe.jsx("mesh",{material:a,children:Fe.jsx("bufferGeometry",{ref:c})})}function Wge({id:n,z:e}){const t=Zp(Zg(r=>r.gadget.layers.find(i=>i.id===n)));switch(t==null?void 0:t.type){default:case SS.BLANK:return null;case SS.TILES:return Fe.jsx("group",{position:[0,0,e],children:Fe.jsx(l8,{width:t.width,height:t.height,char:[...t.char],color:[...t.color],bg:[...t.bg]})},t.id);case SS.SPRITES:return Fe.jsx("group",{position:[0,0,e],children:Fe.jsx(Hge,{sprites:[...t.sprites]})},t.id);case SS.DITHER:return Fe.jsx("group",{position:[0,0,e],children:Fe.jsx(VC,{width:t.width,height:t.height,alphas:[...t.alphas]})},t.id)}}var oN={};Object.defineProperty(oN,"__esModule",{value:!0});var u8=oN.GamepadHelper=void 0;const js=class js{static getButtonValue(e,t){var r,i;return(i=(r=js.gamepads[e])==null?void 0:r.buttons[t])==null?void 0:i.value}static getAxisValue(e,t){var r;return(r=js.gamepads[e])==null?void 0:r.axes[t]}static update(){js.checkForNewGamepads(),!(!js.gamepads||Object.keys(js.gamepads).length<1)&&(js.gamepadsLastUpdate&&Object.keys(js.gamepadsLastUpdate).length>0&&Object.values(js.gamepads).forEach(e=>{var t;for(let r=0;r<e.buttons.length;r++){const i=(t=js.gamepadsLastUpdate[e.index])==null?void 0:t.buttons[r],s=e.buttons[r];(s==null?void 0:s.value)==1&&(i==null?void 0:i.value)==0?js.dispatchButtonDownEvent(e.index,r):(s==null?void 0:s.value)==0&&(i==null?void 0:i.value)==1&&js.dispatchButtonUpEvent(e.index,r)}}),js.gamepadsLastUpdate=Object.assign({},js.gamepads))}static checkForNewGamepads(){const e=navigator.getGamepads();for(const t of e)t&&(js.gamepads[t.index]||js.logOutput&&console.log("gamepad "+t.index+" connected"),js.gamepads[t.index]=t)}static dispatchButtonDownEvent(e,t){js.logOutput&&console.log(`gamepad ${e}: button ${t} is down`),document.dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:{gamepad:e,button:t}}))}static dispatchButtonUpEvent(e,t){js.logOutput&&console.log(`gamepad ${e}: button ${t} is up`),document.dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:{gamepad:e,button:t}}))}};Dn(js,"gamepads",{}),Dn(js,"gamepadsLastUpdate"),Dn(js,"logOutput",!1);let zM=js;u8=oN.GamepadHelper=zM;var Cm={};Object.defineProperty(Cm,"__esModule",{value:!0});var $ge=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),wR={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},h8={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:$ge?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},aN={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var fT=1;fT<20;fT++)aN["f"+fT]=111+fT;function jC(n,e,t){e&&!("byKey"in e)&&(t=e,e=null),Array.isArray(n)||(n=[n]);var r=n.map(function(o){return d8(o,e)}),i=function(a){return r.some(function(c){return f8(c,a)})},s=t==null?i:i(t);return s}function qge(n,e){return jC(n,e)}function Xge(n,e){return jC(n,{byKey:!0},e)}function d8(n,e){var t=e&&e.byKey,r={};n=n.replace("++","+add");var i=n.split("+"),s=i.length;for(var o in wR)r[wR[o]]=!1;var a=!0,c=!1,l=void 0;try{for(var u=i[Symbol.iterator](),h;!(a=(h=u.next()).done);a=!0){var d=h.value,p=d.endsWith("?")&&d.length>1;p&&(d=d.slice(0,-1));var _=cN(d),y=wR[_];if(d.length>1&&!y&&!h8[d]&&!aN[_])throw new TypeError('Unknown modifier: "'+d+'"');(s===1||!y)&&(t?r.key=_:r.which=p8(d)),y&&(r[y]=p?null:!0)}}catch(S){c=!0,l=S}finally{try{!a&&u.return&&u.return()}finally{if(c)throw l}}return r}function f8(n,e){for(var t in n){var r=n[t],i=void 0;if(r!=null&&(t==="key"&&e.key!=null?i=e.key.toLowerCase():t==="which"?i=r===91&&e.which===93?91:e.which:i=e[t],!(i==null&&r===!1)&&i!==r))return!1}return!0}function p8(n){n=cN(n);var e=aN[n]||n.toUpperCase().charCodeAt(0);return e}function cN(n){return n=n.toLowerCase(),n=h8[n]||n,n}var Kge=Cm.default=jC;Cm.isHotkey=jC;Cm.isCodeHotkey=qge;Cm.isKeyHotkey=Xge;Cm.parseHotkey=d8;Cm.compareHotkey=f8;Cm.toKeyCode=p8;Cm.toKeyName=cN;function m8(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(i){i(t)}),(r=n.get("*"))&&r.slice().map(function(i){i(e,t)})}}}const Ry=navigator.userAgent.includes("Mac"),Yge=Ry?"cmd":"ctrl",cf={[it.NONE]:!1,[it.ALT]:!1,[it.CTRL]:!1,[it.SHIFT]:!1,[it.MOVE_UP]:!1,[it.MOVE_DOWN]:!1,[it.MOVE_LEFT]:!1,[it.MOVE_RIGHT]:!1,[it.OK_BUTTON]:!1,[it.CANCEL_BUTTON]:!1,[it.MENU_BUTTON]:!1};let nx=0,$2=performance.now();const q2=200;function qc(n){cf[n]||(nx=0,_8(n,{alt:cf[it.ALT],ctrl:cf[it.CTRL],shift:cf[it.SHIFT]})),cf[n]=!0}function la(n){cf[n]=!1}const rf={root:m8(),ignorehotkeys:!1},g8=at.createContext(rf.root);function HC(n){return{alt:n.altKey,ctrl:Ry?n.metaKey:n.ctrlKey,shift:n.shiftKey}}function _8(n,e){rf.root.emit(it[n],e)}const CR=location.hostname==="localhost";document.addEventListener("keydown",n=>{const e=Ur(n.key),t=HC(n);switch(e){case"c":case"x":case"v":t.ctrl||n.preventDefault();break;case"r":t.ctrl&&CR||n.preventDefault();break;case"i":!Ry&&t.shift&&t.ctrl&&CR||n.preventDefault();break;case"dead":Ry&&t.alt&&t.ctrl&&CR||n.preventDefault();break;case"s":t.ctrl&&Hw("tape","#save",Fa()),n.preventDefault();break;default:n.preventDefault();break}switch(t.alt?qc(it.ALT):la(it.ALT),t.ctrl?qc(it.CTRL):la(it.CTRL),t.shift?qc(it.SHIFT):la(it.SHIFT),e){case"arrowleft":qc(it.MOVE_LEFT);break;case"arrowright":qc(it.MOVE_RIGHT);break;case"arrowup":qc(it.MOVE_UP);break;case"arrowdown":qc(it.MOVE_DOWN);break;case"enter":qc(it.OK_BUTTON);break;case"esc":case"escape":qc(it.CANCEL_BUTTON);break;case"tab":qc(it.MENU_BUTTON);break}rf.root.emit("keydown",n)},{capture:!0});document.addEventListener("keyup",n=>{const e=Ur(n.key),t=HC(n);switch(t.alt?qc(it.ALT):la(it.ALT),t.ctrl?qc(it.CTRL):la(it.CTRL),t.shift?qc(it.SHIFT):la(it.SHIFT),e){case"meta":la(it.MOVE_LEFT),la(it.MOVE_RIGHT),la(it.MOVE_UP),la(it.MOVE_DOWN);break;case"arrowleft":la(it.MOVE_LEFT);break;case"arrowright":la(it.MOVE_RIGHT);break;case"arrowup":la(it.MOVE_UP);break;case"arrowdown":la(it.MOVE_DOWN);break;case"enter":la(it.OK_BUTTON);break;case"esc":case"escape":la(it.CANCEL_BUTTON);break;case"tab":la(it.MENU_BUTTON);break}},{capture:!0});Nf("userinput",["tock"],n=>{switch(n.target){case"up":En(n.data)&&la(n.data);break;case"down":En(n.data)&&qc(n.data);break;case"update":{const e=performance.now(),t=e-$2;if(nx+=t,nx>=q2){nx%=q2;const r={alt:!!cf[it.ALT],ctrl:!!cf[it.CTRL],shift:!!cf[it.SHIFT]};[it.MOVE_UP,it.MOVE_DOWN,it.MOVE_LEFT,it.MOVE_RIGHT,it.OK_BUTTON,it.CANCEL_BUTTON,it.MENU_BUTTON].forEach(s=>{cf[s]&&_8(s,r)})}$2=e,u8.update();break}}});const Jge=0,Qge=1,Zge=2,e0e=3,t0e=4,n0e=5,r0e=6,i0e=7,s0e=9,o0e=12,a0e=13,c0e=14,l0e=15,v8={[Jge]:it.OK_BUTTON,[Qge]:it.CANCEL_BUTTON,[Zge]:it.OK_BUTTON,[e0e]:it.CANCEL_BUTTON,[t0e]:it.ALT,[n0e]:it.CTRL,[r0e]:it.SHIFT,[i0e]:it.SHIFT,[s0e]:it.MENU_BUTTON,[o0e]:it.MOVE_UP,[a0e]:it.MOVE_DOWN,[c0e]:it.MOVE_LEFT,[l0e]:it.MOVE_RIGHT};document.addEventListener("gamepadbuttondown",n=>{qc(v8[n.detail.button])});document.addEventListener("gamepadbuttonup",n=>{la(v8[n.detail.button])});const X2="keyup";function NS({hotkey:n,children:e}){return at.useEffect(()=>{const t=Kge(n,{byKey:!0});function r(i){rf.ignorehotkeys===!1&&t(i)&&e()}return document.addEventListener(X2,r,!1),()=>document.removeEventListener(X2,r,!1)},[n,e]),null}function Vl(n){const e=at.useContext(g8);return at.useEffect(()=>{const t=Object.entries(n);return t.forEach(([r,i])=>e.on(r,i)),()=>{t.forEach(([r,i])=>e.off(r,i))}},[e,n]),null}function rb({blockhotkeys:n,children:e}){const[t]=at.useState(()=>m8());return at.useEffect(()=>{const r=rf.root,i=rf.ignorehotkeys;return rf.root=t,rf.ignorehotkeys=!!n,()=>{rf.root=r,rf.ignorehotkeys=i}},[t,n]),Fe.jsx(g8.Provider,{value:t,children:e})}const u0e=new Ln(0,0);function O0(n,e,t){let r=0;t.alt&&(r|=Jz),t.ctrl&&(r|=Qz),t.shift&&(r|=Zz),JB(n)&&VT("framed",e,r,n)}function h0e({width:n,height:e}){const t=n*mi.DRAW_CHAR_WIDTH(),r=e*mi.DRAW_CHAR_HEIGHT(),i=at.useRef(null);Vw((a,c)=>{const{current:l}=i;if(!l)return;const u=Vme(Zp.getState().gadget.layers),h=u.width*mi.DRAW_CHAR_WIDTH()*u.viewscale,d=h-t,p=u.height*mi.DRAW_CHAR_HEIGHT()*u.viewscale,_=p-r,y=Math.round(Math.min(t,r)*.3333),S=-u.focusx*mi.DRAW_CHAR_WIDTH()*u.viewscale,T=t*.5+S,A=-u.focusy*mi.DRAW_CHAR_HEIGHT()*u.viewscale,R=r*.5+A,I=h<t?d*-.5:T,U=p<r?_*-.5:R;if(fe(l.userData.focus)||(l.position.x=I,l.position.y=U,l.userData.focus=u0e,l.userData.focus.x=I,l.userData.focus.y=U),l.scale.setScalar(u.viewscale),d<0)l.userData.focus.x=I;else{const L=l.position.x-I;if(Math.abs(L)>=y){const z=L<0?-y:y;l.userData.focus.x=Math.round(I-z)}}if(_<0)l.userData.focus.y=U;else{const L=l.position.y-U;if(Math.abs(L)>=y){const z=L<0?-y:y;l.userData.focus.y=Math.round(U-z*.5)}}const D=6;l.position.x+=(l.userData.focus.x-l.position.x)*c*D,l.position.y+=(l.userData.focus.y-l.position.y)*c*D,d>=0&&(l.position.x=Ii(l.position.x,-d,0)),_>=0&&(l.position.y=Ii(l.position.y,-_,0))});const s=Fa();Zp(a=>a.gadget.layers.length);const{layers:o}=Zp.getState().gadget;return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Vl,{MOVE_LEFT:a=>O0(s,it.MOVE_LEFT,a),MOVE_RIGHT:a=>O0(s,it.MOVE_RIGHT,a),MOVE_UP:a=>O0(s,it.MOVE_UP,a),MOVE_DOWN:a=>O0(s,it.MOVE_DOWN,a),OK_BUTTON:a=>O0(s,it.OK_BUTTON,a),CANCEL_BUTTON:a=>O0(s,it.CANCEL_BUTTON,a),MENU_BUTTON:a=>O0(s,it.MENU_BUTTON,a)}),Fe.jsx(cge,{width:t,height:r,children:Fe.jsx("group",{ref:i,children:o.map((a,c)=>Fe.jsx(Wge,{id:a.id,z:c*2},a.id))})})]})}function VM(n){console&&console.error&&console.error(`Error: ${n}`)}function y8(n){console&&console.warn&&console.warn(`Warning: ${n}`)}function S8(n){const e=new Date().getTime(),t=n();return{time:new Date().getTime()-e,value:t}}function E8(n){function e(){}e.prototype=n;const t=new e;function r(){return typeof t.bar}return r(),r(),n}function d0e(n){return f0e(n)?n.LABEL:n.name}function f0e(n){return Fl(n.LABEL)&&n.LABEL!==""}class zf{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),rr(this.definition,t=>{t.accept(e)})}}class jl extends zf{constructor(e){super([]),this.idx=1,Ul(this,od(e,t=>t!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class qy extends zf{constructor(e){super(e.definition),this.orgText="",Ul(this,od(e,t=>t!==void 0))}}class Hl extends zf{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Ul(this,od(e,t=>t!==void 0))}}class Ll extends zf{constructor(e){super(e.definition),this.idx=1,Ul(this,od(e,t=>t!==void 0))}}class Vf extends zf{constructor(e){super(e.definition),this.idx=1,Ul(this,od(e,t=>t!==void 0))}}class jf extends zf{constructor(e){super(e.definition),this.idx=1,Ul(this,od(e,t=>t!==void 0))}}class ha extends zf{constructor(e){super(e.definition),this.idx=1,Ul(this,od(e,t=>t!==void 0))}}class ud extends zf{constructor(e){super(e.definition),this.idx=1,Ul(this,od(e,t=>t!==void 0))}}class hd extends zf{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ul(this,od(e,t=>t!==void 0))}}let $s=class{constructor(e){this.idx=1,Ul(this,od(e,t=>t!==void 0))}accept(e){e.visit(this)}};function p0e(n){return mn(n,rx)}function rx(n){function e(t){return mn(t,rx)}if(n instanceof jl){const t={type:"NonTerminal",name:n.nonTerminalName,idx:n.idx};return Fl(n.label)&&(t.label=n.label),t}else{if(n instanceof Hl)return{type:"Alternative",definition:e(n.definition)};if(n instanceof Ll)return{type:"Option",idx:n.idx,definition:e(n.definition)};if(n instanceof Vf)return{type:"RepetitionMandatory",idx:n.idx,definition:e(n.definition)};if(n instanceof jf)return{type:"RepetitionMandatoryWithSeparator",idx:n.idx,separator:rx(new $s({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof ud)return{type:"RepetitionWithSeparator",idx:n.idx,separator:rx(new $s({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof ha)return{type:"Repetition",idx:n.idx,definition:e(n.definition)};if(n instanceof hd)return{type:"Alternation",idx:n.idx,definition:e(n.definition)};if(n instanceof $s){const t={type:"Terminal",name:n.terminalType.name,label:d0e(n.terminalType),idx:n.idx};Fl(n.label)&&(t.terminalLabel=n.label);const r=n.terminalType.PATTERN;return n.terminalType.PATTERN&&(t.pattern=um(r)?r.source:r),t}else{if(n instanceof qy)return{type:"Rule",name:n.name,orgText:n.orgText,definition:e(n.definition)};throw Error("non exhaustive match")}}}class N_{visit(e){const t=e;switch(t.constructor){case jl:return this.visitNonTerminal(t);case Hl:return this.visitAlternative(t);case Ll:return this.visitOption(t);case Vf:return this.visitRepetitionMandatory(t);case jf:return this.visitRepetitionMandatoryWithSeparator(t);case ud:return this.visitRepetitionWithSeparator(t);case ha:return this.visitRepetition(t);case hd:return this.visitAlternation(t);case $s:return this.visitTerminal(t);case qy:return this.visitRule(t);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function m0e(n){return n instanceof Hl||n instanceof Ll||n instanceof ha||n instanceof Vf||n instanceof jf||n instanceof ud||n instanceof $s||n instanceof qy}function iw(n,e=[]){return n instanceof Ll||n instanceof ha||n instanceof ud?!0:n instanceof hd?aO(n.definition,r=>iw(r,e)):n instanceof jl&&ol(e,n)?!1:n instanceof zf?(n instanceof jl&&e.push(n),Jh(n.definition,r=>iw(r,e))):!1}function g0e(n){return n instanceof hd}function sf(n){if(n instanceof jl)return"SUBRULE";if(n instanceof Ll)return"OPTION";if(n instanceof hd)return"OR";if(n instanceof Vf)return"AT_LEAST_ONE";if(n instanceof jf)return"AT_LEAST_ONE_SEP";if(n instanceof ud)return"MANY_SEP";if(n instanceof ha)return"MANY";if(n instanceof $s)return"CONSUME";throw Error("non exhaustive match")}class GC{walk(e,t=[]){rr(e.definition,(r,i)=>{const s=nc(e.definition,i+1);if(r instanceof jl)this.walkProdRef(r,s,t);else if(r instanceof $s)this.walkTerminal(r,s,t);else if(r instanceof Hl)this.walkFlat(r,s,t);else if(r instanceof Ll)this.walkOption(r,s,t);else if(r instanceof Vf)this.walkAtLeastOne(r,s,t);else if(r instanceof jf)this.walkAtLeastOneSep(r,s,t);else if(r instanceof ud)this.walkManySep(r,s,t);else if(r instanceof ha)this.walkMany(r,s,t);else if(r instanceof hd)this.walkOr(r,s,t);else throw Error("non exhaustive match")})}walkTerminal(e,t,r){}walkProdRef(e,t,r){}walkFlat(e,t,r){const i=t.concat(r);this.walk(e,i)}walkOption(e,t,r){const i=t.concat(r);this.walk(e,i)}walkAtLeastOne(e,t,r){const i=[new Ll({definition:e.definition})].concat(t,r);this.walk(e,i)}walkAtLeastOneSep(e,t,r){const i=K2(e,t,r);this.walk(e,i)}walkMany(e,t,r){const i=[new Ll({definition:e.definition})].concat(t,r);this.walk(e,i)}walkManySep(e,t,r){const i=K2(e,t,r);this.walk(e,i)}walkOr(e,t,r){const i=t.concat(r);rr(e.definition,s=>{const o=new Hl({definition:[s]});this.walk(o,i)})}}function K2(n,e,t){return[new Ll({definition:[new $s({terminalType:n.separator})].concat(n.definition)})].concat(e,t)}function ib(n){if(n instanceof jl)return ib(n.referencedRule);if(n instanceof $s)return y0e(n);if(m0e(n))return _0e(n);if(g0e(n))return v0e(n);throw Error("non exhaustive match")}function _0e(n){let e=[];const t=n.definition;let r=0,i=t.length>r,s,o=!0;for(;i&&o;)s=t[r],o=iw(s),e=e.concat(ib(s)),r=r+1,i=t.length>r;return fC(e)}function v0e(n){const e=mn(n.definition,t=>ib(t));return fC(Pl(e))}function y0e(n){return[n.terminalType]}const b8="_~IN~_";class S0e extends GC{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,t,r){}walkProdRef(e,t,r){const i=b0e(e.referencedRule,e.idx)+this.topProd.name,s=t.concat(r),o=new Hl({definition:s}),a=ib(o);this.follows[i]=a}}function E0e(n){const e={};return rr(n,t=>{const r=new S0e(t).startWalking();Ul(e,r)}),e}function b0e(n,e){return n.name+e+b8}function sr(n){return n.charCodeAt(0)}function RR(n,e){Array.isArray(n)?n.forEach(function(t){e.push(t)}):e.push(n)}function lS(n,e){if(n[e]===!0)throw"duplicate flag "+e;n[e],n[e]=!0}function _v(n){if(n===void 0)throw Error("Internal Error - Should never get here!");return!0}function T0e(){throw Error("Internal Error - Should never get here!")}function Y2(n){return n.type==="Character"}const sw=[];for(let n=sr("0");n<=sr("9");n++)sw.push(n);const ow=[sr("_")].concat(sw);for(let n=sr("a");n<=sr("z");n++)ow.push(n);for(let n=sr("A");n<=sr("Z");n++)ow.push(n);const J2=[sr(" "),sr("\f"),sr(`
`),sr("\r"),sr("	"),sr("\v"),sr("	"),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr(" "),sr("\u2028"),sr("\u2029"),sr(" "),sr(" "),sr("　"),sr("\uFEFF")],x0e=/[0-9a-fA-F]/,pT=/[0-9]/,w0e=/[1-9]/;class C0e{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const t=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":lS(r,"global");break;case"i":lS(r,"ignoreCase");break;case"m":lS(r,"multiLine");break;case"u":lS(r,"unicode");break;case"y":lS(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t,loc:this.loc(0)}}disjunction(){const e=[],t=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}}alternative(){const e=[],t=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let t;switch(this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead";break}_v(t);const r=this.disjunction();return this.consumeChar(")"),{type:t,value:r,loc:this.loc(e)}}return T0e()}quantifier(e=!1){let t;const r=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),t={atLeast:i,atMost:s}):t={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&t===void 0)return;_v(t);break}if(!(e===!0&&t===void 0)&&_v(t))return this.peekChar(0)==="?"?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(r),t}atom(){let e;const t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),_v(e))return e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[sr(`
`),sr("\r"),sr("\u2028"),sr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,t=!1;switch(this.popChar()){case"d":e=sw;break;case"D":e=sw,t=!0;break;case"s":e=J2;break;case"S":e=J2,t=!0;break;case"w":e=ow;break;case"W":e=ow,t=!0;break}if(_v(e))return{type:"Set",value:e,complement:t}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=sr("\f");break;case"n":e=sr(`
`);break;case"r":e=sr("\r");break;case"t":e=sr("	");break;case"v":e=sr("\v");break}if(_v(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:sr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:sr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:sr(e)}}}characterClass(){const e=[];let t=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),t=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Y2(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,Y2(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else RR(r.value,e),e.push(sr("-")),RR(i.value,e)}else RR(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:sr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const t=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(w0e.test(e)===!1)throw Error("Expecting a positive integer");for(;pT.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(pT.test(e)===!1)throw Error("Expecting an integer");for(;pT.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:sr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return pT.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let t="";for(let i=0;i<e;i++){const s=this.popChar();if(x0e.test(s)===!1)throw Error("Expecting a HexDecimal digits");t+=s}return{type:"Character",value:parseInt(t,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class lN{visitChildren(e){for(const t in e){const r=e[t];e.hasOwnProperty(t)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let ix={};const R0e=new C0e;function WC(n){const e=n.toString();if(ix.hasOwnProperty(e))return ix[e];{const t=R0e.pattern(e);return ix[e]=t,t}}function A0e(){ix={}}const T8="Complement Sets are not supported for first char optimization",aw=`Unable to use "first char" lexer optimizations:
`;function M0e(n,e=!1){try{const t=WC(n);return jM(t.value,{},t.flags.ignoreCase)}catch(t){if(t.message===T8)e&&y8(`${aw}	Unable to optimize: < ${n.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),VM(`${aw}
	Failed parsing: < ${n.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function jM(n,e,t){switch(n.type){case"Disjunction":for(let i=0;i<n.value.length;i++)jM(n.value[i],e,t);break;case"Alternative":const r=n.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":mT(o.value,e,t);break;case"Set":if(o.complement===!0)throw Error(T8);rr(o.value,c=>{if(typeof c=="number")mT(c,e,t);else{const l=c;if(t===!0)for(let u=l.from;u<=l.to;u++)mT(u,e,t);else{for(let u=l.from;u<=l.to&&u<bS;u++)mT(u,e,t);if(l.to>=bS){const u=l.from>=bS?l.from:bS,h=l.to,d=Gg(u),p=Gg(h);for(let _=d;_<=p;_++)e[_]=_}}}});break;case"Group":jM(o.value,e,t);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&HM(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return $o(e)}function mT(n,e,t){const r=Gg(n);e[r]=r,t===!0&&I0e(n,e)}function I0e(n,e){const t=String.fromCharCode(n),r=t.toUpperCase();if(r!==t){const i=Gg(r.charCodeAt(0));e[i]=i}else{const i=t.toLowerCase();if(i!==t){const s=Gg(i.charCodeAt(0));e[s]=s}}}function Q2(n,e){return yy(n.value,t=>{if(typeof t=="number")return ol(e,t);{const r=t;return yy(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function HM(n){const e=n.quantifier;return e&&e.atLeast===0?!0:n.value?gi(n.value)?Jh(n.value,HM):HM(n.value):!1}class k0e extends lN{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){ol(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Q2(e,this.targetCharCodes)===void 0&&(this.found=!0):Q2(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function uN(n,e){if(e instanceof RegExp){const t=WC(e),r=new k0e(n);return r.visit(t),r.found}else return yy(e,t=>ol(n,t.charCodeAt(0)))!==void 0}const y_="PATTERN",ES="defaultMode",gT="modes";let x8=typeof new RegExp("(?:)").sticky=="boolean";function O0e(n,e){e=oO(e,{useSticky:x8,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(A,R)=>R()});const t=e.tracer;t("initCharCodeToOptimizedIndexMap",()=>{t_e()});let r;t("Reject Lexer.NA",()=>{r=dC(n,A=>A[y_]===pa.NA)});let i=!1,s;t("Transform Patterns",()=>{i=!1,s=mn(r,A=>{const R=A[y_];if(um(R)){const I=R.source;return I.length===1&&I!=="^"&&I!=="$"&&I!=="."&&!R.ignoreCase?I:I.length===2&&I[0]==="\\"&&!ol(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],I[1])?I[1]:e.useSticky?eU(R):Z2(R)}else{if(ym(R))return i=!0,{exec:R};if(typeof R=="object")return i=!0,R;if(typeof R=="string"){if(R.length===1)return R;{const I=R.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(I);return e.useSticky?eU(U):Z2(U)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;t("misc mapping",()=>{o=mn(r,A=>A.tokenTypeIdx),a=mn(r,A=>{const R=A.GROUP;if(R!==pa.SKIPPED){if(Fl(R))return R;if(hm(R))return!1;throw Error("non exhaustive match")}}),c=mn(r,A=>{const R=A.LONGER_ALT;if(R)return gi(R)?mn(R,U=>t2(r,U)):[t2(r,R)]}),l=mn(r,A=>A.PUSH_MODE),u=mn(r,A=>Xn(A,"POP_MODE"))});let h;t("Line Terminator Handling",()=>{const A=R8(e.lineTerminatorCharacters);h=mn(r,R=>!1),e.positionTracking!=="onlyOffset"&&(h=mn(r,R=>Xn(R,"LINE_BREAKS")?!!R.LINE_BREAKS:C8(R,A)===!1&&uN(A,R.PATTERN)))});let d,p,_,y;t("Misc Mapping #2",()=>{d=mn(r,w8),p=mn(s,Q0e),_=Bl(r,(A,R)=>{const I=R.GROUP;return Fl(I)&&I!==pa.SKIPPED&&(A[I]=[]),A},{}),y=mn(s,(A,R)=>({pattern:s[R],longerAlt:c[R],canLineTerminator:h[R],isCustom:d[R],short:p[R],group:a[R],push:l[R],pop:u[R],tokenTypeIdx:o[R],tokenType:r[R]}))});let S=!0,T=[];return e.safeMode||t("First Char Optimization",()=>{T=Bl(r,(A,R,I)=>{if(typeof R.PATTERN=="string"){const U=R.PATTERN.charCodeAt(0),D=Gg(U);AR(A,D,y[I])}else if(gi(R.START_CHARS_HINT)){let U;rr(R.START_CHARS_HINT,D=>{const L=typeof D=="string"?D.charCodeAt(0):D,z=Gg(L);U!==z&&(U=z,AR(A,z,y[I]))})}else if(um(R.PATTERN))if(R.PATTERN.unicode)S=!1,e.ensureOptimizations&&VM(`${aw}	Unable to analyze < ${R.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=M0e(R.PATTERN,e.ensureOptimizations);ds(U)&&(S=!1),rr(U,D=>{AR(A,D,y[I])})}else e.ensureOptimizations&&VM(`${aw}	TokenType: <${R.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),S=!1;return A},[])}),{emptyGroups:_,patternIdxToConfig:y,charCodeToPatternIdxToConfig:T,hasCustom:i,canBeOptimized:S}}function N0e(n,e){let t=[];const r=D0e(n);t=t.concat(r.errors);const i=L0e(r.valid),s=i.valid;return t=t.concat(i.errors),t=t.concat(P0e(s)),t=t.concat(G0e(s)),t=t.concat(W0e(s,e)),t=t.concat($0e(s)),t}function P0e(n){let e=[];const t=uh(n,r=>um(r[y_]));return e=e.concat(F0e(t)),e=e.concat(V0e(t)),e=e.concat(j0e(t)),e=e.concat(H0e(t)),e=e.concat(B0e(t)),e}function D0e(n){const e=uh(n,i=>!Xn(i,y_)),t=mn(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:io.MISSING_PATTERN,tokenTypes:[i]})),r=hC(n,e);return{errors:t,valid:r}}function L0e(n){const e=uh(n,i=>{const s=i[y_];return!um(s)&&!ym(s)&&!Xn(s,"exec")&&!Fl(s)}),t=mn(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:io.INVALID_PATTERN,tokenTypes:[i]})),r=hC(n,e);return{errors:t,valid:r}}const U0e=/[^\\][$]/;function F0e(n){class e extends lN{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const t=uh(n,i=>{const s=i.PATTERN;try{const o=WC(s),a=new e;return a.visit(o),a.found}catch{return U0e.test(s.source)}});return mn(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:io.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function B0e(n){const e=uh(n,r=>r.PATTERN.test(""));return mn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:io.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const z0e=/[^\\[][\^]|^\^/;function V0e(n){class e extends lN{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const t=uh(n,i=>{const s=i.PATTERN;try{const o=WC(s),a=new e;return a.visit(o),a.found}catch{return z0e.test(s.source)}});return mn(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:io.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function j0e(n){const e=uh(n,r=>{const i=r[y_];return i instanceof RegExp&&(i.multiline||i.global)});return mn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:io.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function H0e(n){const e=[];let t=mn(n,s=>Bl(n,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!ol(e,a)&&a.PATTERN!==pa.NA&&(e.push(a),o.push(a)),o),[]));t=UE(t);const r=uh(t,s=>s.length>1);return mn(r,s=>{const o=mn(s,c=>c.name);return{message:`The same RegExp pattern ->${td(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:io.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function G0e(n){const e=uh(n,r=>{if(!Xn(r,"GROUP"))return!1;const i=r.GROUP;return i!==pa.SKIPPED&&i!==pa.NA&&!Fl(i)});return mn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:io.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function W0e(n,e){const t=uh(n,i=>i.PUSH_MODE!==void 0&&!ol(e,i.PUSH_MODE));return mn(t,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:io.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function $0e(n){const e=[],t=Bl(n,(r,i,s)=>{const o=i.PATTERN;return o===pa.NA||(Fl(o)?r.push({str:o,idx:s,tokenType:i}):um(o)&&X0e(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return rr(n,(r,i)=>{rr(t,({str:s,idx:o,tokenType:a})=>{if(i<o&&q0e(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:io.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function q0e(n,e){if(um(e)){const t=e.exec(n);return t!==null&&t.index===0}else{if(ym(e))return e(n,0,[],{});if(Xn(e,"exec"))return e.exec(n,0,[],{});if(typeof e=="string")return e===n;throw Error("non exhaustive match")}}function X0e(n){return yy([".","\\","[","]","|","^","$","(",")","?","*","+","{"],t=>n.source.indexOf(t)!==-1)===void 0}function Z2(n){const e=n.ignoreCase?"i":"";return new RegExp(`^(?:${n.source})`,e)}function eU(n){const e=n.ignoreCase?"iy":"y";return new RegExp(`${n.source}`,e)}function K0e(n,e,t){const r=[];return Xn(n,ES)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ES+`> property in its definition
`,type:io.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Xn(n,gT)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+gT+`> property in its definition
`,type:io.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Xn(n,gT)&&Xn(n,ES)&&!Xn(n.modes,n.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ES}: <${n.defaultMode}>which does not exist
`,type:io.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Xn(n,gT)&&rr(n.modes,(i,s)=>{rr(i,(o,a)=>{if(hm(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:io.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Xn(o,"LONGER_ALT")){const c=gi(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];rr(c,l=>{!hm(l)&&!ol(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:io.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Y0e(n,e,t){const r=[];let i=!1;const s=UE(Pl($o(n.modes))),o=dC(s,c=>c[y_]===pa.NA),a=R8(t);return e&&rr(o,c=>{const l=C8(c,a);if(l!==!1){const h={message:e_e(c,l),type:l.issue,tokenType:c};r.push(h)}else Xn(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):uN(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:io.NO_LINE_BREAKS_FLAGS}),r}function J0e(n){const e={},t=ch(n);return rr(t,r=>{const i=n[r];if(gi(i))e[r]=[];else throw Error("non exhaustive match")}),e}function w8(n){const e=n.PATTERN;if(um(e))return!1;if(ym(e))return!0;if(Xn(e,"exec"))return!0;if(Fl(e))return!1;throw Error("non exhaustive match")}function Q0e(n){return Fl(n)&&n.length===1?n.charCodeAt(0):!1}const Z0e={test:function(n){const e=n.length;for(let t=this.lastIndex;t<e;t++){const r=n.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return n.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function C8(n,e){if(Xn(n,"LINE_BREAKS"))return!1;if(um(n.PATTERN)){try{uN(e,n.PATTERN)}catch(t){return{issue:io.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(Fl(n.PATTERN))return!1;if(w8(n))return{issue:io.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function e_e(n,e){if(e.issue===io.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${n.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===io.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${n.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function R8(n){return mn(n,t=>Fl(t)?t.charCodeAt(0):t)}function AR(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}const bS=256;let sx=[];function Gg(n){return n<bS?n:sx[n]}function t_e(){if(ds(sx)){sx=new Array(65536);for(let n=0;n<65536;n++)sx[n]=n>255?255+~~(n/255):n}}function sb(n,e){const t=n.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function cw(n,e){return n.tokenTypeIdx===e.tokenTypeIdx}let tU=1;const A8={};function ob(n){const e=n_e(n);r_e(e),s_e(e),i_e(e),rr(e,t=>{t.isParent=t.categoryMatches.length>0})}function n_e(n){let e=sc(n),t=n,r=!0;for(;r;){t=UE(Pl(mn(t,s=>s.CATEGORIES)));const i=hC(t,e);e=e.concat(i),ds(i)?r=!1:t=i}return e}function r_e(n){rr(n,e=>{I8(e)||(A8[tU]=e,e.tokenTypeIdx=tU++),nU(e)&&!gi(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),nU(e)||(e.CATEGORIES=[]),o_e(e)||(e.categoryMatches=[]),a_e(e)||(e.categoryMatchesMap={})})}function i_e(n){rr(n,e=>{e.categoryMatches=[],rr(e.categoryMatchesMap,(t,r)=>{e.categoryMatches.push(A8[r].tokenTypeIdx)})})}function s_e(n){rr(n,e=>{M8([],e)})}function M8(n,e){rr(n,t=>{e.categoryMatchesMap[t.tokenTypeIdx]=!0}),rr(e.CATEGORIES,t=>{const r=n.concat(e);ol(r,t)||M8(r,t)})}function I8(n){return Xn(n,"tokenTypeIdx")}function nU(n){return Xn(n,"CATEGORIES")}function o_e(n){return Xn(n,"categoryMatches")}function a_e(n){return Xn(n,"categoryMatchesMap")}function c_e(n){return Xn(n,"tokenTypeIdx")}const l_e={buildUnableToPopLexerModeMessage(n){return`Unable to pop Lexer Mode after encountering Token ->${n.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(n,e,t,r,i){return`unexpected character: ->${n.charAt(e)}<- at offset: ${e}, skipped ${t} characters.`}};var io;(function(n){n[n.MISSING_PATTERN=0]="MISSING_PATTERN",n[n.INVALID_PATTERN=1]="INVALID_PATTERN",n[n.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",n[n.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",n[n.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",n[n.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",n[n.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",n[n.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",n[n.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",n[n.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",n[n.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",n[n.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",n[n.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",n[n.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",n[n.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",n[n.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",n[n.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",n[n.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(io||(io={}));const TS={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:l_e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(TS);class pa{constructor(e,t=TS){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=S8(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ul({},TS,t);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===TS.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Z0e;else if(this.config.lineTerminatorCharacters===TS.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),gi(e)?i={modes:{defaultMode:sc(e)},defaultMode:ES}:(s=!1,i=sc(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(K0e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Y0e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},rr(i.modes,(a,c)=>{i.modes[c]=dC(a,l=>hm(l))});const o=ch(i.modes);if(rr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(N0e(a,o))}),ds(this.lexerDefinitionErrors)){ob(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=O0e(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ul({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ds(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=mn(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}rr(this.lexerDefinitionWarning,a=>{y8(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(x8?(this.chopInput=gy,this.match=this.matchWithTest):(this.updateLastIndex=oa,this.match=this.matchWithExec),s&&(this.handleModes=oa),this.trackStartLines===!1&&(this.computeNewColumn=gy),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=oa),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Bl(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(t.ensureOptimizations&&!ds(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{A0e()}),this.TRACE_INIT("toFastProperties",()=>{E8(this)})})}tokenize(e,t=this.defaultMode){if(!ds(this.lexerDefinitionErrors)){const i=mn(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,t)}tokenizeInternal(e,t){let r,i,s,o,a,c,l,u,h,d,p,_,y,S,T;const A=e,R=A.length;let I=0,U=0;const D=this.hasCustom?0:Math.floor(e.length/10),L=new Array(D),z=[];let F=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const W=J0e(this.emptyGroups),X=this.trackStartLines,$=this.config.lineTerminatorsPattern;let K=0,te=[],Q=[];const ne=[],G=[];Object.freeze(G);let J;function re(){return te}function ue(Ye){const Ze=Gg(Ye),Ke=Q[Ze];return Ke===void 0?G:Ke}const ye=Ye=>{if(ne.length===1&&Ye.tokenType.PUSH_MODE===void 0){const Ze=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ye);z.push({offset:Ye.startOffset,line:Ye.startLine,column:Ye.startColumn,length:Ye.image.length,message:Ze})}else{ne.pop();const Ze=vy(ne);te=this.patternIdxToConfig[Ze],Q=this.charCodeToPatternIdxToConfig[Ze],K=te.length;const Ke=this.canModeBeOptimized[Ze]&&this.config.safeMode===!1;Q&&Ke?J=ue:J=re}};function Ne(Ye){ne.push(Ye),Q=this.charCodeToPatternIdxToConfig[Ye],te=this.patternIdxToConfig[Ye],K=te.length,K=te.length;const Ze=this.canModeBeOptimized[Ye]&&this.config.safeMode===!1;Q&&Ze?J=ue:J=re}Ne.call(this,t);let _e;const Ae=this.config.recoveryEnabled;for(;I<R;){c=null;const Ye=A.charCodeAt(I),Ze=J(Ye),Ke=Ze.length;for(r=0;r<Ke;r++){_e=Ze[r];const It=_e.pattern;l=null;const Xt=_e.short;if(Xt!==!1?Ye===Xt&&(c=It):_e.isCustom===!0?(T=It.exec(A,I,L,W),T!==null?(c=T[0],T.payload!==void 0&&(l=T.payload)):c=null):(this.updateLastIndex(It,I),c=this.match(It,e,I)),c!==null){if(a=_e.longerAlt,a!==void 0){const Qt=a.length;for(s=0;s<Qt;s++){const Kt=te[a[s]],xn=Kt.pattern;if(u=null,Kt.isCustom===!0?(T=xn.exec(A,I,L,W),T!==null?(o=T[0],T.payload!==void 0&&(u=T.payload)):o=null):(this.updateLastIndex(xn,I),o=this.match(xn,e,I)),o&&o.length>c.length){c=o,l=u,_e=Kt;break}}}break}}if(c!==null){if(h=c.length,d=_e.group,d!==void 0&&(p=_e.tokenTypeIdx,_=this.createTokenInstance(c,I,p,_e.tokenType,F,V,h),this.handlePayload(_,l),d===!1?U=this.addToken(L,U,_):W[d].push(_)),e=this.chopInput(e,h),I=I+h,V=this.computeNewColumn(V,h),X===!0&&_e.canLineTerminator===!0){let It=0,Xt,Qt;$.lastIndex=0;do Xt=$.test(c),Xt===!0&&(Qt=$.lastIndex-1,It++);while(Xt===!0);It!==0&&(F=F+It,V=h-Qt,this.updateTokenEndLineColumnLocation(_,d,Qt,It,F,V,h))}this.handleModes(_e,ye,Ne,_)}else{const It=I,Xt=F,Qt=V;let Kt=Ae===!1;for(;Kt===!1&&I<R;)for(e=this.chopInput(e,1),I++,i=0;i<K;i++){const xn=te[i],Re=xn.pattern,St=xn.short;if(St!==!1?A.charCodeAt(I)===St&&(Kt=!0):xn.isCustom===!0?Kt=Re.exec(A,I,L,W)!==null:(this.updateLastIndex(Re,I),Kt=Re.exec(e)!==null),Kt===!0)break}if(y=I-It,V=this.computeNewColumn(V,y),S=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,It,y,Xt,Qt),z.push({offset:It,line:Xt,column:Qt,length:y,message:S}),Ae===!1)break}}return this.hasCustom||(L.length=U),{tokens:L,groups:W,errors:z}}handleModes(e,t,r,i){if(e.pop===!0){const s=e.push;t(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,t){return e.substring(t)}updateLastIndex(e,t){e.lastIndex=t}updateTokenEndLineColumnLocation(e,t,r,i,s,o,a){let c,l;t!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,t){return e+t}createOffsetOnlyToken(e,t,r,i){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,t,r,i,s,o){return{image:e,startOffset:t,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,t,r){return e.push(r),t}addTokenUsingMemberAccess(e,t,r){return e[t]=r,t++,t}handlePayloadNoCustom(e,t){}handlePayloadWithCustom(e,t){t!==null&&(e.payload=t)}matchWithTest(e,t,r){return e.test(t)===!0?t.substring(r,e.lastIndex):null}matchWithExec(e,t){const r=e.exec(t);return r!==null?r[0]:null}}pa.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";pa.NA=/NOT_APPLICABLE/;function PS(n){return k8(n)?n.LABEL:n.name}function k8(n){return Fl(n.LABEL)&&n.LABEL!==""}const u_e="parent",rU="categories",iU="label",sU="group",oU="push_mode",aU="pop_mode",cU="longer_alt",lU="line_breaks",uU="start_chars_hint";function xu(n){return h_e(n)}function h_e(n){const e=n.pattern,t={};if(t.name=n.name,hm(e)||(t.PATTERN=e),Xn(n,u_e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Xn(n,rU)&&(t.CATEGORIES=n[rU]),ob([t]),Xn(n,iU)&&(t.LABEL=n[iU]),Xn(n,sU)&&(t.GROUP=n[sU]),Xn(n,aU)&&(t.POP_MODE=n[aU]),Xn(n,oU)&&(t.PUSH_MODE=n[oU]),Xn(n,cU)&&(t.LONGER_ALT=n[cU]),Xn(n,lU)&&(t.LINE_BREAKS=n[lU]),Xn(n,uU)&&(t.START_CHARS_HINT=n[uU]),t}const S_=xu({name:"EOF",pattern:pa.NA});ob([S_]);function ab(n,e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:n.tokenTypeIdx,tokenType:n}}function d_e(n,e){return sb(n,e)}const O8={buildMismatchTokenMessage({expected:n,actual:e,previous:t,ruleName:r}){return`Expecting ${k8(n)?`--> ${PS(n)} <--`:`token of type --> ${n.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:n,ruleName:e}){return"Redundant input, expecting EOF but found: "+n.image},buildNoViableAltMessage({expectedPathsPerAlt:n,actual:e,previous:t,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+td(e).image+"'";if(r)return s+r+a;{const c=Bl(n,(d,p)=>d.concat(p),[]),l=mn(c,d=>`[${mn(d,p=>PS(p)).join(", ")}]`),h=`one of these possible Token sequences:
${mn(l,(d,p)=>`  ${p+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:n,actual:e,customUserDescription:t,ruleName:r}){const i="Expecting: ",o=`
but found: '`+td(e).image+"'";if(t)return i+t+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${mn(n,l=>`[${mn(l,u=>PS(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(O8);const f_e={buildRuleNotFoundError(n,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+n.name+"<-"}},Q0={buildDuplicateFoundError(n,e){function t(u){return u instanceof $s?u.terminalType.name:u instanceof jl?u.nonTerminalName:""}const r=n.name,i=td(e),s=i.idx,o=sf(i),a=t(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(n){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${n.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(n){const e=mn(n.prefixPath,i=>PS(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;return`Ambiguous alternatives: <${n.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(n){const e=mn(n.prefixPath,i=>PS(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;let r=`Ambiguous Alternatives Detected: <${n.ambiguityIndices.join(" ,")}> in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(n){let e=sf(n.repetition);return n.repetition.idx!==0&&(e+=n.repetition.idx),`The repetition <${e}> within Rule <${n.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(n){return"deprecated"},buildEmptyAlternationError(n){return`Ambiguous empty alternative: <${n.emptyChoiceIdx+1}> in <OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(n){return`An Alternation cannot have more than 256 alternatives:
<OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
 has ${n.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(n){const e=n.topLevelRule.name,t=mn(n.leftRecursionPath,s=>s.name),r=`${e} --> ${t.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(n){return"deprecated"},buildDuplicateRuleNameError(n){let e;return n.topLevelRule instanceof qy?e=n.topLevelRule.name:e=n.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${n.grammarName}<-`}};function p_e(n,e){const t=new m_e(n,e);return t.resolveRefs(),t.errors}class m_e extends N_{constructor(e,t){super(),this.nameToTopRule=e,this.errMsgProvider=t,this.errors=[]}resolveRefs(){rr($o(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:nl.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class g_e extends GC{constructor(e,t){super(),this.topProd=e,this.path=t,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=sc(this.path.ruleStack).reverse(),this.occurrenceStack=sc(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,t=[]){this.found||super.walk(e,t)}walkProdRef(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ds(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class __e extends g_e{constructor(e,t){super(e,t),this.path=t,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,t,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=t.concat(r),s=new Hl({definition:i});this.possibleTokTypes=ib(s),this.found=!0}}}class $C extends GC{constructor(e,t){super(),this.topRule=e,this.occurrence=t,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class v_e extends $C{walkMany(e,t,r){if(e.idx===this.occurrence){const i=td(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof $s&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,t,r)}}class hU extends $C{walkManySep(e,t,r){if(e.idx===this.occurrence){const i=td(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof $s&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,t,r)}}class y_e extends $C{walkAtLeastOne(e,t,r){if(e.idx===this.occurrence){const i=td(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof $s&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,t,r)}}class dU extends $C{walkAtLeastOneSep(e,t,r){if(e.idx===this.occurrence){const i=td(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof $s&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,t,r)}}function GM(n,e,t=[]){t=sc(t);let r=[],i=0;function s(a){return a.concat(nc(n,i+1))}function o(a){const c=GM(s(a),e,t);return r.concat(c)}for(;t.length<e&&i<n.length;){const a=n[i];if(a instanceof Hl)return o(a.definition);if(a instanceof jl)return o(a.definition);if(a instanceof Ll)r=o(a.definition);else if(a instanceof Vf){const c=a.definition.concat([new ha({definition:a.definition})]);return o(c)}else if(a instanceof jf){const c=[new Hl({definition:a.definition}),new ha({definition:[new $s({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof ud){const c=a.definition.concat([new ha({definition:[new $s({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof ha){const c=a.definition.concat([new ha({definition:a.definition})]);r=o(c)}else{if(a instanceof hd)return rr(a.definition,c=>{ds(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof $s)t.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:t,suffixDef:nc(n,i)}),r}function N8(n,e,t,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:n,ruleStack:[],occurrenceStack:[]});!ds(h);){const d=h.pop();if(d===o){a&&vy(h).idx<=l&&h.pop();continue}const p=d.def,_=d.idx,y=d.ruleStack,S=d.occurrenceStack;if(ds(p))continue;const T=p[0];if(T===i){const A={idx:_,def:nc(p),ruleStack:rE(y),occurrenceStack:rE(S)};h.push(A)}else if(T instanceof $s)if(_<c-1){const A=_+1,R=e[A];if(t(R,T.terminalType)){const I={idx:A,def:nc(p),ruleStack:y,occurrenceStack:S};h.push(I)}}else if(_===c-1)u.push({nextTokenType:T.terminalType,nextTokenOccurrence:T.idx,ruleStack:y,occurrenceStack:S}),a=!0;else throw Error("non exhaustive match");else if(T instanceof jl){const A=sc(y);A.push(T.nonTerminalName);const R=sc(S);R.push(T.idx);const I={idx:_,def:T.definition.concat(s,nc(p)),ruleStack:A,occurrenceStack:R};h.push(I)}else if(T instanceof Ll){const A={idx:_,def:nc(p),ruleStack:y,occurrenceStack:S};h.push(A),h.push(o);const R={idx:_,def:T.definition.concat(nc(p)),ruleStack:y,occurrenceStack:S};h.push(R)}else if(T instanceof Vf){const A=new ha({definition:T.definition,idx:T.idx}),R=T.definition.concat([A],nc(p)),I={idx:_,def:R,ruleStack:y,occurrenceStack:S};h.push(I)}else if(T instanceof jf){const A=new $s({terminalType:T.separator}),R=new ha({definition:[A].concat(T.definition),idx:T.idx}),I=T.definition.concat([R],nc(p)),U={idx:_,def:I,ruleStack:y,occurrenceStack:S};h.push(U)}else if(T instanceof ud){const A={idx:_,def:nc(p),ruleStack:y,occurrenceStack:S};h.push(A),h.push(o);const R=new $s({terminalType:T.separator}),I=new ha({definition:[R].concat(T.definition),idx:T.idx}),U=T.definition.concat([I],nc(p)),D={idx:_,def:U,ruleStack:y,occurrenceStack:S};h.push(D)}else if(T instanceof ha){const A={idx:_,def:nc(p),ruleStack:y,occurrenceStack:S};h.push(A),h.push(o);const R=new ha({definition:T.definition,idx:T.idx}),I=T.definition.concat([R],nc(p)),U={idx:_,def:I,ruleStack:y,occurrenceStack:S};h.push(U)}else if(T instanceof hd)for(let A=T.definition.length-1;A>=0;A--){const R=T.definition[A],I={idx:_,def:R.definition.concat(nc(p)),ruleStack:y,occurrenceStack:S};h.push(I),h.push(o)}else if(T instanceof Hl)h.push({idx:_,def:T.definition.concat(nc(p)),ruleStack:y,occurrenceStack:S});else if(T instanceof qy)h.push(S_e(T,_,y,S));else throw Error("non exhaustive match")}return u}function S_e(n,e,t,r){const i=sc(t);i.push(n.name);const s=sc(r);return s.push(1),{idx:e,def:n.definition,ruleStack:i,occurrenceStack:s}}var ro;(function(n){n[n.OPTION=0]="OPTION",n[n.REPETITION=1]="REPETITION",n[n.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",n[n.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",n[n.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",n[n.ALTERNATION=5]="ALTERNATION"})(ro||(ro={}));function P8(n){if(n instanceof Ll||n==="Option")return ro.OPTION;if(n instanceof ha||n==="Repetition")return ro.REPETITION;if(n instanceof Vf||n==="RepetitionMandatory")return ro.REPETITION_MANDATORY;if(n instanceof jf||n==="RepetitionMandatoryWithSeparator")return ro.REPETITION_MANDATORY_WITH_SEPARATOR;if(n instanceof ud||n==="RepetitionWithSeparator")return ro.REPETITION_WITH_SEPARATOR;if(n instanceof hd||n==="Alternation")return ro.ALTERNATION;throw Error("non exhaustive match")}function E_e(n,e,t,r,i,s){const o=hN(n,e,t),a=U8(o)?cw:sb;return s(o,r,a,i)}function b_e(n,e,t,r,i,s){const o=dN(n,e,i,t),a=U8(o)?cw:sb;return s(o[0],a,r)}function T_e(n,e,t,r){const i=n.length,s=Jh(n,o=>Jh(o,a=>a.length===1));if(e)return function(o){const a=mn(o,c=>c.GATE);for(let c=0;c<i;c++){const l=n[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const p=l[d],_=p.length;for(let y=0;y<_;y++){const S=this.LA(y+1);if(t(S,p[y])===!1)continue e}return c}}};if(s&&!r){const o=mn(n,c=>Pl(c)),a=Bl(o,(c,l,u)=>(rr(l,h=>{Xn(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),rr(h.categoryMatches,d=>{Xn(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=n[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const p=this.LA(d+1);if(t(p,u[d])===!1)continue e}return o}}}}function x_e(n,e,t){const r=Jh(n,s=>s.length===1),i=n.length;if(r&&!t){const s=Pl(n);if(s.length===1&&ds(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Bl(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,rr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=n[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class w_e extends GC{constructor(e,t,r){super(),this.topProd=e,this.targetOccurrence=t,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,t,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===t?(this.restDef=r.concat(i),!0):!1}walkOption(e,t,r){this.checkIsTarget(e,ro.OPTION,t,r)||super.walkOption(e,t,r)}walkAtLeastOne(e,t,r){this.checkIsTarget(e,ro.REPETITION_MANDATORY,t,r)||super.walkOption(e,t,r)}walkAtLeastOneSep(e,t,r){this.checkIsTarget(e,ro.REPETITION_MANDATORY_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}walkMany(e,t,r){this.checkIsTarget(e,ro.REPETITION,t,r)||super.walkOption(e,t,r)}walkManySep(e,t,r){this.checkIsTarget(e,ro.REPETITION_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}}class D8 extends N_{constructor(e,t,r){super(),this.targetOccurrence=e,this.targetProdType=t,this.targetRef=r,this.result=[]}checkIsTarget(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ro.OPTION)}visitRepetition(e){this.checkIsTarget(e,ro.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ro.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ro.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ro.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ro.ALTERNATION)}}function fU(n){const e=new Array(n);for(let t=0;t<n;t++)e[t]=[];return e}function MR(n){let e=[""];for(let t=0;t<n.length;t++){const r=n[t],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function C_e(n,e,t){for(let r=0;r<n.length;r++){if(r===t)continue;const i=n[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function L8(n,e){const t=mn(n,o=>GM([o],1)),r=fU(t.length),i=mn(t,o=>{const a={};return rr(o,c=>{const l=MR(c.partialPath);rr(l,u=>{a[u]=!0})}),a});let s=t;for(let o=1;o<=e;o++){const a=s;s=fU(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,p=MR(h);if(C_e(i,p,c)||ds(d)||h.length===e){const y=r[c];if(WM(y,h)===!1){y.push(h);for(let S=0;S<p.length;S++){const T=p[S];i[c][T]=!0}}}else{const y=GM(d,o+1,h);s[c]=s[c].concat(y),rr(y,S=>{const T=MR(S.partialPath);rr(T,A=>{i[c][A]=!0})})}}}}return r}function hN(n,e,t,r){const i=new D8(n,ro.ALTERNATION,r);return e.accept(i),L8(i.result,t)}function dN(n,e,t,r){const i=new D8(n,t);e.accept(i);const s=i.result,a=new w_e(e,n,t).startWalking(),c=new Hl({definition:s}),l=new Hl({definition:a});return L8([c,l],r)}function WM(n,e){e:for(let t=0;t<n.length;t++){const r=n[t];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function R_e(n,e){return n.length<e.length&&Jh(n,(t,r)=>{const i=e[r];return t===i||i.categoryMatchesMap[t.tokenTypeIdx]})}function U8(n){return Jh(n,e=>Jh(e,t=>Jh(t,r=>ds(r.categoryMatches))))}function A_e(n){const e=n.lookaheadStrategy.validate({rules:n.rules,tokenTypes:n.tokenTypes,grammarName:n.grammarName});return mn(e,t=>Object.assign({type:nl.CUSTOM_LOOKAHEAD_VALIDATION},t))}function M_e(n,e,t,r){const i=nh(n,c=>I_e(c,t)),s=j_e(n,e,t),o=nh(n,c=>F_e(c,t)),a=nh(n,c=>N_e(c,n,r,t));return i.concat(s,o,a)}function I_e(n,e){const t=new O_e;n.accept(t);const r=t.allProductions,i=I5(r,k_e),s=od(i,a=>a.length>1);return mn($o(s),a=>{const c=td(a),l=e.buildDuplicateFoundError(n,a),u=sf(c),h={message:l,type:nl.DUPLICATE_PRODUCTIONS,ruleName:n.name,dslName:u,occurrence:c.idx},d=F8(c);return d&&(h.parameter=d),h})}function k_e(n){return`${sf(n)}_#_${n.idx}_#_${F8(n)}`}function F8(n){return n instanceof $s?n.terminalType.name:n instanceof jl?n.nonTerminalName:""}class O_e extends N_{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function N_e(n,e,t,r){const i=[];if(Bl(e,(o,a)=>a.name===n.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:n,grammarName:t});i.push({message:o,type:nl.DUPLICATE_RULE_NAME,ruleName:n.name})}return i}function P_e(n,e,t){const r=[];let i;return ol(e,n)||(i=`Invalid rule override, rule: ->${n}<- cannot be overridden in the grammar: ->${t}<-as it is not defined in any of the super grammars `,r.push({message:i,type:nl.INVALID_RULE_OVERRIDE,ruleName:n})),r}function B8(n,e,t,r=[]){const i=[],s=ox(e.definition);if(ds(s))return[];{const o=n.name;ol(s,n)&&i.push({message:t.buildLeftRecursionError({topLevelRule:n,leftRecursionPath:r}),type:nl.LEFT_RECURSION,ruleName:o});const c=hC(s,r.concat([n])),l=nh(c,u=>{const h=sc(r);return h.push(u),B8(n,u,t,h)});return i.concat(l)}}function ox(n){let e=[];if(ds(n))return e;const t=td(n);if(t instanceof jl)e.push(t.referencedRule);else if(t instanceof Hl||t instanceof Ll||t instanceof Vf||t instanceof jf||t instanceof ud||t instanceof ha)e=e.concat(ox(t.definition));else if(t instanceof hd)e=Pl(mn(t.definition,s=>ox(s.definition)));else if(!(t instanceof $s))throw Error("non exhaustive match");const r=iw(t),i=n.length>1;if(r&&i){const s=nc(n);return e.concat(ox(s))}else return e}class fN extends N_{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function D_e(n,e){const t=new fN;n.accept(t);const r=t.alternations;return nh(r,s=>{const o=rE(s.definition);return nh(o,(a,c)=>{const l=N8([a],[],sb,1);return ds(l)?[{message:e.buildEmptyAlternationError({topLevelRule:n,alternation:s,emptyChoiceIdx:c}),type:nl.NONE_LAST_EMPTY_ALT,ruleName:n.name,occurrence:s.idx,alternative:c+1}]:[]})})}function L_e(n,e,t){const r=new fN;n.accept(r);let i=r.alternations;return i=dC(i,o=>o.ignoreAmbiguities===!0),nh(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=hN(a,n,c,o),u=z_e(l,o,n,t),h=V_e(l,o,n,t);return u.concat(h)})}class U_e extends N_{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function F_e(n,e){const t=new fN;n.accept(t);const r=t.alternations;return nh(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:n,alternation:s}),type:nl.TOO_MANY_ALTS,ruleName:n.name,occurrence:s.idx}]:[])}function B_e(n,e,t){const r=[];return rr(n,i=>{const s=new U_e;i.accept(s);const o=s.allProductions;rr(o,a=>{const c=P8(a),l=a.maxLookahead||e,u=a.idx,d=dN(u,i,c,l)[0];if(ds(Pl(d))){const p=t.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:p,type:nl.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function z_e(n,e,t,r){const i=[],s=Bl(n,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||rr(c,u=>{const h=[l];rr(n,(d,p)=>{l!==p&&WM(d,u)&&e.definition[p].ignoreAmbiguities!==!0&&h.push(p)}),h.length>1&&!WM(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return mn(s,a=>{const c=mn(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:nl.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:a.alts}})}function V_e(n,e,t,r){const i=Bl(n,(o,a,c)=>{const l=mn(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return UE(nh(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=uh(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&R_e(d.path,l));return mn(u,d=>{const p=[d.idx+1,c+1],_=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:p,prefixPath:d.path}),type:nl.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:_,alternatives:p}})}))}function j_e(n,e,t){const r=[],i=mn(e,s=>s.name);return rr(n,s=>{const o=s.name;if(ol(i,o)){const a=t.buildNamespaceConflictError(s);r.push({message:a,type:nl.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function H_e(n){const e=oO(n,{errMsgProvider:f_e}),t={};return rr(n.rules,r=>{t[r.name]=r}),p_e(t,e.errMsgProvider)}function G_e(n){return n=oO(n,{errMsgProvider:Q0}),M_e(n.rules,n.tokenTypes,n.errMsgProvider,n.grammarName)}const z8="MismatchedTokenException",V8="NoViableAltException",j8="EarlyExitException",H8="NotAllInputParsedException",G8=[z8,V8,j8,H8];Object.freeze(G8);function lw(n){return ol(G8,n.name)}class qC extends Error{constructor(e,t){super(e),this.token=t,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class W8 extends qC{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=z8}}class W_e extends qC{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=V8}}class $_e extends qC{constructor(e,t){super(e,t),this.name=H8}}class q_e extends qC{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=j8}}const IR={},$8="InRuleRecoveryException";class X_e extends Error{constructor(e){super(e),this.name=$8}}class K_e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Xn(e,"recoveryEnabled")?e.recoveryEnabled:fm.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Y_e)}getTokenToInsert(e){const t=ab(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),p=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),_=new W8(p,l,this.LA(0));_.resyncedTokens=rE(a),this.SAVE_ERROR(_)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,t);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,t,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))}getFollowsForInRuleRecovery(e,t){const r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new X_e("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||ds(t))return!1;const r=this.LA(1);return yy(t,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return ol(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let t=this.LA(1),r=2;for(;;){const i=yy(e,s=>d_e(t,s));if(i!==void 0)return i;t=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return IR;const e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return mn(e,(r,i)=>i===0?IR:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:t[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=mn(this.buildFullFollowKeyStack(),t=>this.getFollowSetFromFollowKey(t));return Pl(e)}getFollowSetFromFollowKey(e){if(e===IR)return[S_];const t=e.ruleName+e.idxInCallingRule+b8+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,S_)||t.push(e),t}reSyncTo(e){const t=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return rE(t)}attemptInRepetitionRecovery(e,t,r,i,s,o,a){}getCurrentGrammarPath(e,t){const r=this.getHumanReadableRuleStack(),i=sc(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return mn(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Y_e(n,e,t,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),p=this.getGAstProductions()[d];c=new s(p,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=S_,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(n,e,t,l)}const J_e=4,e0=8,q8=1<<e0,X8=2<<e0,$M=3<<e0,qM=4<<e0,XM=5<<e0,ax=6<<e0;function kR(n,e,t){return t|e|n}class Q_e{constructor(e){var t;this.maxLookahead=(t=e==null?void 0:e.maxLookahead)!==null&&t!==void 0?t:fm.maxLookahead}validate(e){const t=this.validateNoLeftRecursion(e.rules);if(ds(t)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...t,...r,...i,...s]}return t}validateNoLeftRecursion(e){return nh(e,t=>B8(t,t,Q0))}validateEmptyOrAlternatives(e){return nh(e,t=>D_e(t,Q0))}validateAmbiguousAlternationAlternatives(e,t){return nh(e,r=>L_e(r,t,Q0))}validateSomeNonEmptyLookaheadPath(e,t){return B_e(e,t,Q0)}buildLookaheadForAlternation(e){return E_e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,T_e)}buildLookaheadForOptional(e){return b_e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,P8(e.prodType),x_e)}}class Z_e{initLooksAhead(e){this.dynamicTokensEnabled=Xn(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:fm.dynamicTokensEnabled,this.maxLookahead=Xn(e,"maxLookahead")?e.maxLookahead:fm.maxLookahead,this.lookaheadStrategy=Xn(e,"lookaheadStrategy")?e.lookaheadStrategy:new Q_e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){rr(e,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=tve(t);rr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${sf(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:t,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=kR(this.fullRuleNameToShort[t.name],q8,l.idx);this.setLaFuncCache(d,h)})}),rr(i,l=>{this.computeLookaheadFunc(t,l.idx,$M,"Repetition",l.maxLookahead,sf(l))}),rr(s,l=>{this.computeLookaheadFunc(t,l.idx,X8,"Option",l.maxLookahead,sf(l))}),rr(o,l=>{this.computeLookaheadFunc(t,l.idx,qM,"RepetitionMandatory",l.maxLookahead,sf(l))}),rr(a,l=>{this.computeLookaheadFunc(t,l.idx,ax,"RepetitionMandatoryWithSeparator",l.maxLookahead,sf(l))}),rr(c,l=>{this.computeLookaheadFunc(t,l.idx,XM,"RepetitionWithSeparator",l.maxLookahead,sf(l))})})})}computeLookaheadFunc(e,t,r,i,s,o){this.TRACE_INIT(`${o}${t===0?"":t}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=kR(this.fullRuleNameToShort[e.name],r,t);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,t){const r=this.getLastExplicitRuleShortName();return kR(r,e,t)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}}class eve extends N_{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const _T=new eve;function tve(n){_T.reset(),n.accept(_T);const e=_T.dslMethods;return _T.reset(),e}function pU(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.endOffset=e.endOffset):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset)}function mU(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.startColumn=e.startColumn,n.startLine=e.startLine,n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine)}function nve(n,e,t){n.children[t]===void 0?n.children[t]=[e]:n.children[t].push(e)}function rve(n,e,t){n.children[e]===void 0?n.children[e]=[t]:n.children[e].push(t)}const ive="name";function K8(n,e){Object.defineProperty(n,ive,{enumerable:!1,configurable:!0,writable:!1,value:e})}function sve(n,e){const t=ch(n),r=t.length;for(let i=0;i<r;i++){const s=t[i],o=n[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function ove(n,e){const t=function(){};K8(t,n+"BaseSemantics");const r={visit:function(i,s){if(gi(i)&&(i=i[0]),!hm(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=cve(this,e);if(!ds(i)){const s=mn(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function ave(n,e,t){const r=function(){};K8(r,n+"BaseSemanticsWithDefaults");const i=Object.create(t.prototype);return rr(e,s=>{i[s]=sve}),r.prototype=i,r.prototype.constructor=r,r}var KM;(function(n){n[n.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",n[n.MISSING_METHOD=1]="MISSING_METHOD"})(KM||(KM={}));function cve(n,e){return lve(n,e)}function lve(n,e){const t=uh(e,i=>ym(n[i])===!1),r=mn(t,i=>({msg:`Missing visitor method: <${i}> on ${n.constructor.name} CST Visitor.`,type:KM.MISSING_METHOD,methodName:i}));return UE(r)}class uve{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Xn(e,"nodeLocationTracking")?e.nodeLocationTracking:fm.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=oa,this.cstFinallyStateUpdate=oa,this.cstPostTerminal=oa,this.cstPostNonTerminal=oa,this.cstPostRule=oa;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=mU,this.setNodeLocationFromNode=mU,this.cstPostRule=oa,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=oa,this.setNodeLocationFromNode=oa,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=pU,this.setNodeLocationFromNode=pU,this.cstPostRule=oa,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=oa,this.setNodeLocationFromNode=oa,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=oa,this.setNodeLocationFromNode=oa,this.cstPostRule=oa,this.setInitialNodeLocation=oa;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN}cstPostTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];nve(r,t,e),this.setNodeLocationFromToken(r.location,t)}cstPostNonTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];rve(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(hm(this.baseCstVisitorConstructor)){const e=ove(this.className,ch(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(hm(this.baseCstVisitorWithDefaultsConstructor)){const e=ave(this.className,ch(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class hve{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):hw}LA(e){const t=this.currIdx+e;return t<0||this.tokVectorLength<=t?hw:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class dve{ACTION(e){return e.call(this)}consume(e,t,r){return this.consumeInternal(t,e,r)}subrule(e,t,r){return this.subruleInternal(t,e,r)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t,r=dw){if(ol(this.definedRulesNames,e)){const o={message:Q0.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:nl.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,t,r);return this[e]=i,i}OVERRIDE_RULE(e,t,r=dw){const i=P_e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,t,r);return this[e]=s,s}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,t),!0}catch(i){if(lw(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return p0e($o(this.gastProductionsCache))}}class fve{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=cw,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Xn(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(gi(e)){if(ds(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(gi(e))this.tokensMap=Bl(e,(s,o)=>(s[o.name]=o,s),{});else if(Xn(e,"modes")&&Jh(Pl($o(e.modes)),c_e)){const s=Pl($o(e.modes)),o=fC(s);this.tokensMap=Bl(o,(a,c)=>(a[c.name]=c,a),{})}else if(ah(e))this.tokensMap=sc(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=S_;const r=Xn(e,"modes")?Pl($o(e.modes)):$o(e),i=Jh(r,s=>ds(s.categoryMatches));this.tokenMatcher=i?cw:sb,ob($o(this.tokensMap))}defineRule(e,t,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Xn(r,"resyncEnabled")?r.resyncEnabled:dw.resyncEnabled,s=Xn(r,"recoveryValueFunc")?r.recoveryValueFunc:dw.recoveryValueFunc,o=this.ruleShortNameIdx<<J_e+e0;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,r){const i=this.RULE_STACK.length===1,s=t&&!this.isBackTracking()&&this.recoveryEnabled;if(lw(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,t){const r=this.getKeyForAutomaticLookahead(X8,t);return this.optionInternalLogic(e,t,r)}optionInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,t){const r=this.getKeyForAutomaticLookahead(qM,e);return this.atLeastOneInternalLogic(e,t,r)}atLeastOneInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ro.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,qM,e,y_e)}atLeastOneSepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(ax,e);this.atLeastOneSepFirstInternalLogic(e,t,r)}atLeastOneSepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,dU],a,ax,e,dU)}else throw this.raiseEarlyExitException(e,ro.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)}manyInternal(e,t){const r=this.getKeyForAutomaticLookahead($M,e);return this.manyInternalLogic(e,t,r)}manyInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const a=t.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=t;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,$M,e,v_e,o)}manySepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(XM,e);this.manySepFirstInternalLogic(e,t,r)}manySepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,hU],a,XM,e,hU)}}repetitionSepSecondInternal(e,t,r,i,s){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,s],r,ax,e,s)}doSingleRepetition(e){const t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){const r=this.getKeyForAutomaticLookahead(q8,t),i=gi(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new $_e(t,e))}}subruleInternal(e,t,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=t,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,t,r){throw lw(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,t,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,t,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,t,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new W8(i,t,s))}consumeInternalRecovery(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===$8?r:s}}else throw r}saveRecogState(){const e=this.errors,t=sc(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),S_)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class pve{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Xn(e,"errorMessageProvider")?e.errorMessageProvider:fm.errorMessageProvider}SAVE_ERROR(e){if(lw(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:sc(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return sc(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=dN(e,s,t,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new q_e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=hN(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new W_e(c,this.LA(1),a))}}class mve{initContentAssist(){}computeContentAssist(e,t){const r=this.gastProductionsCache[e];if(hm(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return N8([r],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const t=td(e.ruleStack),i=this.getGAstProductions()[t];return new __e(i,e).startWalking()}}const XC={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(XC);const gU=!0,_U=Math.pow(2,e0)-1,Y8=xu({name:"RECORDING_PHASE_TOKEN",pattern:pa.NA});ob([Y8]);const J8=ab(Y8,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(J8);const gve={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class _ve{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const t=e>0?e:"";this[`CONSUME${t}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${t}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${t}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${t}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${t}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${t}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${t}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${t}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,t,r){return this.consumeInternalRecord(t,e,r)},this.subrule=function(e,t,r){return this.subruleInternalRecord(t,e,r)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let t=0;t<10;t++){const r=t>0?t:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return hw}topLevelRuleRecord(e,t){try{const r=new qy({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,t){return uS.call(this,Ll,e,t)}atLeastOneInternalRecord(e,t){uS.call(this,Vf,t,e)}atLeastOneSepFirstInternalRecord(e,t){uS.call(this,jf,t,e,gU)}manyInternalRecord(e,t){uS.call(this,ha,t,e)}manySepFirstInternalRecord(e,t){uS.call(this,ud,t,e,gU)}orInternalRecord(e,t){return vve.call(this,e,t)}subruleInternalRecord(e,t,r){if(uw(t),!e||Xn(e,"ruleName")===!1){const a=new Error(`<SUBRULE${vU(t)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=vy(this.recordingProdStack),s=e.ruleName,o=new jl({idx:t,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?gve:XC}consumeInternalRecord(e,t,r){if(uw(t),!I8(e)){const o=new Error(`<CONSUME${vU(t)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=vy(this.recordingProdStack),s=new $s({idx:t,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),J8}}function uS(n,e,t,r=!1){uw(t);const i=vy(this.recordingProdStack),s=ym(e)?e:e.DEF,o=new n({definition:[],idx:t});return r&&(o.separator=e.SEP),Xn(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),XC}function vve(n,e){uw(e);const t=vy(this.recordingProdStack),r=gi(n)===!1,i=r===!1?n:n.DEF,s=new hd({definition:[],idx:e,ignoreAmbiguities:r&&n.IGNORE_AMBIGUITIES===!0});Xn(n,"MAX_LOOKAHEAD")&&(s.maxLookahead=n.MAX_LOOKAHEAD);const o=aO(i,a=>ym(a.GATE));return s.hasPredicates=o,t.definition.push(s),rr(i,a=>{const c=new Hl({definition:[]});s.definition.push(c),Xn(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Xn(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),XC}function vU(n){return n===0?"":`${n}`}function uw(n){if(n<0||n>_U){const e=new Error(`Invalid DSL Method idx value: <${n}>
	Idx value must be a none negative value smaller than ${_U+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class yve{initPerformanceTracer(e){if(Xn(e,"traceInitPerf")){const t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=fm.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=S8(t),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return t()}}function Sve(n,e){e.forEach(t=>{const r=t.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(n.prototype,i,s):n.prototype[i]=t.prototype[i]})})}const hw=ab(S_,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(hw);const fm=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:O8,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),dw=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var nl;(function(n){n[n.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",n[n.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",n[n.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",n[n.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",n[n.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",n[n.LEFT_RECURSION=5]="LEFT_RECURSION",n[n.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",n[n.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",n[n.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",n[n.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",n[n.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",n[n.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",n[n.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",n[n.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(nl||(nl={}));class cb{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const t=this.className;this.TRACE_INIT("toFastProps",()=>{E8(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),rr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=H_e({rules:$o(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ds(r)&&this.skipValidations===!1){const i=G_e({rules:$o(this.gastProductionsCache),tokenTypes:$o(this.tokensMap),errMsgProvider:Q0,grammarName:t}),s=A_e({lookaheadStrategy:this.lookaheadStrategy,rules:$o(this.gastProductionsCache),tokenTypes:$o(this.tokensMap),grammarName:t});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ds(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=E0e($o(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:$o(this.gastProductionsCache)}),this.preComputeLookaheadFunctions($o(this.gastProductionsCache))})),!cb.DEFER_DEFINITION_ERRORS_HANDLING&&!ds(this.definitionErrors))throw e=mn(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),Xn(t,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Xn(t,"skipValidations")?t.skipValidations:fm.skipValidations}}cb.DEFER_DEFINITION_ERRORS_HANDLING=!1;Sve(cb,[K_e,Z_e,uve,hve,fve,dve,pve,mve,_ve,yve]);class Eve extends cb{constructor(e,t=fm){const r=sc(t);r.outputCst=!0,super(e,r)}}function bve(n){const e=new Tve,t=$o(n);return mn(t,r=>e.visitRule(r))}class Tve extends N_{visitRule(e){const t=this.visitEach(e.definition),r=I5(t,s=>s.propertyName),i=mn(r,(s,o)=>{const a=!aO(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=mn(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:vT(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:vT(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:vT(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:vT(e)}]}visitEachAndOverrideWith(e,t){return mn(this.visitEach(e),r=>Ul({},r,t))}visitEach(e){return Pl(mn(e,t=>this.visit(t)))}}function vT(n){return n instanceof jl?{kind:"rule",name:n.referencedRule.name}:{kind:"token"}}function xve(n,e){let t=[];return t=t.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),t=t.concat(Pl(mn(n,r=>wve(r)))),e.includeVisitorInterface&&(t=t.concat(Mve(e.visitorInterfaceName,n))),t.join(`

`)+`
`}function wve(n){const e=Cve(n),t=Rve(n);return[e,t]}function Cve(n){const e=Q8(n.name),t=pN(n.name);return`export interface ${e} extends CstNode {
  name: "${n.name}";
  children: ${t};
}`}function Rve(n){return`export type ${pN(n.name)} = {
  ${mn(n.properties,t=>Ave(t)).join(`
  `)}
};`}function Ave(n){const e=kve(n.type);return`${n.name}${n.optional?"?":""}: ${e}[];`}function Mve(n,e){return`export interface ${n}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${mn(e,t=>Ive(t)).join(`
  `)}
}`}function Ive(n){const e=pN(n.name);return`${n.name}(children: ${e}, param?: IN): OUT;`}function kve(n){if(gi(n)){const e=fC(mn(n,r=>yU(r)));return"("+Bl(e,(r,i)=>r+" | "+i)+")"}else return yU(n)}function yU(n){return n.kind==="token"?"IToken":Q8(n.name)}function Q8(n){return g5(n)+"CstNode"}function pN(n){return g5(n)+"CstChildren"}const Ove={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function Nve(n,e){const t=Object.assign(Object.assign({},Ove),e),r=bve(n);return xve(r,t)}var Z8={exports:{}},OR={exports:{}},SU;function Pve(){return SU||(SU=1,function(n,e){(function(t,r){n.exports=r()})(Ng,function(){function t(y){return!isNaN(parseFloat(y))&&isFinite(y)}function r(y){return y.charAt(0).toUpperCase()+y.substring(1)}function i(y){return function(){return this[y]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(y){if(y)for(var S=0;S<u.length;S++)y[u[S]]!==void 0&&this["set"+r(u[S])](y[u[S]])}h.prototype={getArgs:function(){return this.args},setArgs:function(y){if(Object.prototype.toString.call(y)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=y},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(y){if(y instanceof h)this.evalOrigin=y;else if(y instanceof Object)this.evalOrigin=new h(y);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var y=this.getFileName()||"",S=this.getLineNumber()||"",T=this.getColumnNumber()||"",A=this.getFunctionName()||"";return this.getIsEval()?y?"[eval] ("+y+":"+S+":"+T+")":"[eval]:"+S+":"+T:A?A+" ("+y+":"+S+":"+T+")":y+":"+S+":"+T}},h.fromString=function(S){var T=S.indexOf("("),A=S.lastIndexOf(")"),R=S.substring(0,T),I=S.substring(T+1,A).split(","),U=S.substring(A+1);if(U.indexOf("@")===0)var D=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),L=D[1],z=D[2],F=D[3];return new h({functionName:R,args:I||void 0,fileName:L,lineNumber:z||void 0,columnNumber:F||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(y){return function(S){this[y]=!!S}}(s[d]);for(var p=0;p<o.length;p++)h.prototype["get"+r(o[p])]=i(o[p]),h.prototype["set"+r(o[p])]=function(y){return function(S){if(!t(S))throw new TypeError(y+" must be a Number");this[y]=Number(S)}}(o[p]);for(var _=0;_<a.length;_++)h.prototype["get"+r(a[_])]=i(a[_]),h.prototype["set"+r(a[_])]=function(y){return function(S){this[y]=String(S)}}(a[_]);return h})}(OR)),OR.exports}(function(n,e){(function(t,r){n.exports=r(Pve())})(Ng,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var p=this.extractLocation(d?d[1]:h),_=d&&h||void 0,y=["eval","<anonymous>"].indexOf(p[0])>-1?void 0:p[0];return new r({functionName:_,fileName:y,lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),p=d&&d[1]?d[1]:void 0,_=this.extractLocation(u.replace(h,""));return new r({functionName:p,fileName:_[0],lineNumber:_[1],columnNumber:_[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,p=u.length;d<p;d+=2){var _=l.exec(u[d]);_&&h.push(new r({fileName:_[2],lineNumber:_[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,p=u.length;d<p;d+=2){var _=l.exec(u[d]);_&&h.push(new r({functionName:_[3]||void 0,fileName:_[2],lineNumber:_[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),p=h.shift()||"",_=p.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,y;p.match(/\(([^)]*)\)/)&&(y=p.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var S=y===void 0||y==="[arguments not available]"?void 0:y.split(",");return new r({functionName:_,args:S,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Z8);var Dve=Z8.exports;const Lve=Wl(Dve);function Rm(n){const e={},t={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...n,getcommand(r){return e[r]},command(r,i){return e[r]=i,t}};return t}function lb(n){return fe(n)&&fe(n.x)&&fe(n.y)}function Aa(n,e){switch(e){case dn.NORTH:--n.y;break;case dn.SOUTH:++n.y;break;case dn.WEST:--n.x;break;case dn.EAST:++n.x;break}return n}function vv(n,e){const t=e.x-n.x,r=e.y-n.y;if(t<0)return dn.WEST;if(t>0)return dn.EAST;if(r<0)return dn.NORTH;if(r>0)return dn.SOUTH}const eV={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function ff(n){return ni(n)&&tV(n[0])}function tV(n){return fe(dn[n])&&vr(n)}function Uve(n){const e=dn[n];return fe(e)?e:dn.IDLE}function nV(n){if(vr(n))return eV[Ur(n)]}function EU(n){if(ff(n))return n;if(tV(n))return[n];const e=nV(n);if(fe(e))return[e]}function bU(n){const e=be.words[n],t=EU(e);if(ff(t))return[t,n+1];const[r,i]=Oa(n),s=EU(r);return ff(s)?[s,i]:[void 0,n]}function YM(n){const e=[];let[t,r]=bU(n);for(;ff(t);){if(e.push(...t),(t[0]==="AT"||t[0]==="BY")&&t.length<2){const[o,a,c]=Rt(be.words,r,[lt.NUMBER,lt.NUMBER]);e.push(o,a),r=c}const[i,s]=bU(r);t=i,r=s}return e.length?[e,r]:[void 0,n]}function Ay(n){return ni(n)&&typeof n[0]=="string"}function TU(n){const e=be.words[n];if(Ay(e))return[e,n+1];const[t,r]=Sw(n),[i,s]=Oa(r,!1);return vr(i)?[[i,t],s]:[void 0,n]}function fw(n){if(!Ay(n))return;const[e]=n;return e}function rV(n){if(!Ay(n))return;const[,e]=n,t=fe(e)?sEe(e):void 0;return fe(t)?t:void 0}function iV(n){if(!Ay(n))return;const[,e]=n,t=fe(e)?oEe(e):void 0;return fe(t)?t:void 0}const ic=60,P_=25;var Ri=(n=>(n[n.ERROR=0]="ERROR",n[n.LOADER=1]="LOADER",n[n.BOARD=2]="BOARD",n[n.OBJECT=3]="OBJECT",n[n.TERRAIN=4]="TERRAIN",n[n.CHARSET=5]="CHARSET",n[n.PALETTE=6]="PALETTE",n))(Ri||{});function sV(n,e){const t=n??Ts.ISWALK,r=e??Ts.ISWALK;switch(t){case Ts.ISWALK:return r!==Ts.ISWALK;case Ts.ISSWIM:return r!==Ts.ISSWIM;case Ts.ISSOLID:return!0;case Ts.ISBULLET:return r!==Ts.ISWALK&&r!==Ts.ISSWIM}}function xU(n,e,t){const r=n==null?void 0:n.objects[t];if(fe(r))return r;if(fe(e)){const i=ub(n,"player"),s={x:e.x??0,y:e.y??0};aV(s,i)}}function ub(n,e){var r,i;return[...((i=(r=n==null?void 0:n.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?n==null?void 0:n.objects[s]:n==null?void 0:n.terrain[s]).filter(fe)}function oV(n,e){const t=fw(e),r=rV(e),i=iV(e);return n.filter(s=>!(fe(t)&&vN(s)!==t||fe(r)&&iye(s)!==r||fe(i)&&sye(s)!==i)).filter(fe)}function NR(n,e){return fe(n)?e.map(t=>{var r;if(typeof t=="string"){const i=n.objects[t];if(fe(i))return i;const s=ub(n,Ur(t));if(s.length)return s}else if(lb(t)&&t.x>=0&&t.x<ic&&t.y>=0&&t.y<P_){const i=t.x+t.y*ic,s=(r=n.lookup)==null?void 0:r[i];return fe(s)?n.objects[s]:n.terrain[i]}}).flat().filter(fe):[]}function aV(n,e){let t=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=n.x-(s.x??0),a=n.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<t)&&(t=c,r=s)}}return r}var JM;try{JM=new TextDecoder}catch{}var qt,Qu,Oe=0,us={},li,Cg,$u=0,lf=0,ka,sm,Gl=[],ei,wU={useRecords:!1,mapsAsObjects:!0};class cV{}const lV=new cV;lV.name="MessagePack 0xC1";var Og=!1,uV=2,CU;try{new Function("")}catch{uV=1/0}class lE{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(qt)return gV(()=>(ZM(),this?this.unpack(e,t):lE.prototype.unpack.call(wU,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof t=="object"?(Qu=t.end||e.length,Oe=t.start||0):(Oe=0,Qu=t>-1?t:e.length),lf=0,Cg=null,ka=null,qt=e;try{ei=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw qt=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof lE){if(us=this,this.structures)return li=this.structures,yT(t);(!li||li.length>0)&&(li=[])}else us=wU,(!li||li.length>0)&&(li=[]);return yT(t)}unpackMultiple(e,t){let r,i=0;try{Og=!0;let s=e.length,o=this?this.unpack(e,s):KC.unpack(e,s);if(t){if(t(o,i,Oe)===!1)return;for(;Oe<s;)if(i=Oe,t(yT(),i,Oe)===!1)return}else{for(r=[o];Oe<s;)i=Oe,r.push(yT());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Og=!1,ZM()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],s=t[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function yT(n){try{if(!us.trusted&&!Og){let t=li.sharedLength||0;t<li.length&&(li.length=t)}let e;if(us.randomAccessStructure&&qt[Oe]<64&&qt[Oe]>=32&&CU?(e=CU(qt,Oe,Qu,us),qt=null,!(n&&n.lazy)&&e&&(e=e.toJSON()),Oe=Qu):e=So(),ka&&(Oe=ka.postBundlePosition,ka=null),Og&&(li.restoreStructures=null),Oe==Qu)li&&li.restoreStructures&&RU(),li=null,qt=null,sm&&(sm=null);else{if(Oe>Qu)throw new Error("Unexpected end of MessagePack data");if(!Og){let t;try{t=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw li&&li.restoreStructures&&RU(),ZM(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Oe>Qu)&&(e.incomplete=!0),e}}function RU(){for(let n in li.restoreStructures)li[n]=li.restoreStructures[n];li.restoreStructures=null}function So(){let n=qt[Oe++];if(n<160)if(n<128){if(n<64)return n;{let e=li[n&63]||us.getStructures&&hV()[n&63];return e?(e.read||(e.read=mN(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,us.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=fV();r==="__proto__"&&(r="__proto_"),e[r]=So()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(So(),So());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=So();return us.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(lf>=Oe)return Cg.slice(Oe-$u,(Oe+=e)-$u);if(lf==0&&Qu<140){let t=e<16?gN(e):dV(e);if(t!=null)return t}return QM(e)}else{let e;switch(n){case 192:return null;case 193:return ka?(e=So(),e>0?ka[1].slice(ka.position1,ka.position1+=e):ka[0].slice(ka.position0,ka.position0-=e)):lV;case 194:return!1;case 195:return!0;case 196:if(e=qt[Oe++],e===void 0)throw new Error("Unexpected end of buffer");return PR(e);case 197:return e=ei.getUint16(Oe),Oe+=2,PR(e);case 198:return e=ei.getUint32(Oe),Oe+=4,PR(e);case 199:return N0(qt[Oe++]);case 200:return e=ei.getUint16(Oe),Oe+=2,N0(e);case 201:return e=ei.getUint32(Oe),Oe+=4,N0(e);case 202:if(e=ei.getFloat32(Oe),us.useFloat32>2){let t=_N[(qt[Oe]&127)<<1|qt[Oe+1]>>7];return Oe+=4,(t*e+(e>0?.5:-.5)>>0)/t}return Oe+=4,e;case 203:return e=ei.getFloat64(Oe),Oe+=8,e;case 204:return qt[Oe++];case 205:return e=ei.getUint16(Oe),Oe+=2,e;case 206:return e=ei.getUint32(Oe),Oe+=4,e;case 207:return us.int64AsType==="number"?(e=ei.getUint32(Oe)*4294967296,e+=ei.getUint32(Oe+4)):us.int64AsType==="string"?e=ei.getBigUint64(Oe).toString():us.int64AsType==="auto"?(e=ei.getBigUint64(Oe),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=ei.getBigUint64(Oe),Oe+=8,e;case 208:return ei.getInt8(Oe++);case 209:return e=ei.getInt16(Oe),Oe+=2,e;case 210:return e=ei.getInt32(Oe),Oe+=4,e;case 211:return us.int64AsType==="number"?(e=ei.getInt32(Oe)*4294967296,e+=ei.getUint32(Oe+4)):us.int64AsType==="string"?e=ei.getBigInt64(Oe).toString():us.int64AsType==="auto"?(e=ei.getBigInt64(Oe),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=ei.getBigInt64(Oe),Oe+=8,e;case 212:if(e=qt[Oe++],e==114)return NU(qt[Oe++]&63);{let t=Gl[e];if(t)return t.read?(Oe++,t.read(So())):t.noBuffer?(Oe++,t()):t(qt.subarray(Oe,++Oe));throw new Error("Unknown extension "+e)}case 213:return e=qt[Oe],e==114?(Oe++,NU(qt[Oe++]&63,qt[Oe++])):N0(2);case 214:return N0(4);case 215:return N0(8);case 216:return N0(16);case 217:return e=qt[Oe++],lf>=Oe?Cg.slice(Oe-$u,(Oe+=e)-$u):Bve(e);case 218:return e=ei.getUint16(Oe),Oe+=2,lf>=Oe?Cg.slice(Oe-$u,(Oe+=e)-$u):zve(e);case 219:return e=ei.getUint32(Oe),Oe+=4,lf>=Oe?Cg.slice(Oe-$u,(Oe+=e)-$u):Vve(e);case 220:return e=ei.getUint16(Oe),Oe+=2,MU(e);case 221:return e=ei.getUint32(Oe),Oe+=4,MU(e);case 222:return e=ei.getUint16(Oe),Oe+=2,IU(e);case 223:return e=ei.getUint32(Oe),Oe+=4,IU(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const Fve=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function mN(n,e){function t(){if(t.count++>uV){let i=n.read=new Function("r","return function(){return "+(us.freezeData?"Object.freeze":"")+"({"+n.map(s=>s==="__proto__"?"__proto_:r()":Fve.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(So);return n.highByte===0&&(n.read=AU(e,n.read)),i()}let r={};for(let i=0,s=n.length;i<s;i++){let o=n[i];o==="__proto__"&&(o="__proto_"),r[o]=So()}return us.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?AU(e,t):t}const AU=(n,e)=>function(){let t=qt[Oe++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),i=li[r]||hV()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=mN(i,n)),i.read()};function hV(){let n=gV(()=>(qt=null,us.getStructures()));return li=us._mergeStructures(n,li)}var QM=hb,Bve=hb,zve=hb,Vve=hb;function hb(n){let e;if(n<16&&(e=gN(n)))return e;if(n>64&&JM)return JM.decode(qt.subarray(Oe,Oe+=n));const t=Oe+n,r=[];for(e="";Oe<t;){const i=qt[Oe++];if(!(i&128))r.push(i);else if((i&224)===192){const s=qt[Oe++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=qt[Oe++]&63,o=qt[Oe++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=qt[Oe++]&63,o=qt[Oe++]&63,a=qt[Oe++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Ma.apply(String,r),r.length=0)}return r.length>0&&(e+=Ma.apply(String,r)),e}function MU(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=So();return us.freezeData?Object.freeze(e):e}function IU(n){if(us.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=fV();r==="__proto__"&&(r="__proto_"),e[r]=So()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(So(),So());return e}}var Ma=String.fromCharCode;function dV(n){let e=Oe,t=new Array(n);for(let r=0;r<n;r++){const i=qt[Oe++];if((i&128)>0){Oe=e;return}t[r]=i}return Ma.apply(String,t)}function gN(n){if(n<4)if(n<2){if(n===0)return"";{let e=qt[Oe++];if((e&128)>1){Oe-=1;return}return Ma(e)}}else{let e=qt[Oe++],t=qt[Oe++];if((e&128)>0||(t&128)>0){Oe-=2;return}if(n<3)return Ma(e,t);let r=qt[Oe++];if((r&128)>0){Oe-=3;return}return Ma(e,t,r)}else{let e=qt[Oe++],t=qt[Oe++],r=qt[Oe++],i=qt[Oe++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){Oe-=4;return}if(n<6){if(n===4)return Ma(e,t,r,i);{let s=qt[Oe++];if((s&128)>0){Oe-=5;return}return Ma(e,t,r,i,s)}}else if(n<8){let s=qt[Oe++],o=qt[Oe++];if((s&128)>0||(o&128)>0){Oe-=6;return}if(n<7)return Ma(e,t,r,i,s,o);let a=qt[Oe++];if((a&128)>0){Oe-=7;return}return Ma(e,t,r,i,s,o,a)}else{let s=qt[Oe++],o=qt[Oe++],a=qt[Oe++],c=qt[Oe++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Oe-=8;return}if(n<10){if(n===8)return Ma(e,t,r,i,s,o,a,c);{let l=qt[Oe++];if((l&128)>0){Oe-=9;return}return Ma(e,t,r,i,s,o,a,c,l)}}else if(n<12){let l=qt[Oe++],u=qt[Oe++];if((l&128)>0||(u&128)>0){Oe-=10;return}if(n<11)return Ma(e,t,r,i,s,o,a,c,l,u);let h=qt[Oe++];if((h&128)>0){Oe-=11;return}return Ma(e,t,r,i,s,o,a,c,l,u,h)}else{let l=qt[Oe++],u=qt[Oe++],h=qt[Oe++],d=qt[Oe++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){Oe-=12;return}if(n<14){if(n===12)return Ma(e,t,r,i,s,o,a,c,l,u,h,d);{let p=qt[Oe++];if((p&128)>0){Oe-=13;return}return Ma(e,t,r,i,s,o,a,c,l,u,h,d,p)}}else{let p=qt[Oe++],_=qt[Oe++];if((p&128)>0||(_&128)>0){Oe-=14;return}if(n<15)return Ma(e,t,r,i,s,o,a,c,l,u,h,d,p,_);let y=qt[Oe++];if((y&128)>0){Oe-=15;return}return Ma(e,t,r,i,s,o,a,c,l,u,h,d,p,_,y)}}}}}function kU(){let n=qt[Oe++],e;if(n<192)e=n-160;else switch(n){case 217:e=qt[Oe++];break;case 218:e=ei.getUint16(Oe),Oe+=2;break;case 219:e=ei.getUint32(Oe),Oe+=4;break;default:throw new Error("Expected string")}return hb(e)}function PR(n){return us.copyBuffers?Uint8Array.prototype.slice.call(qt,Oe,Oe+=n):qt.subarray(Oe,Oe+=n)}function N0(n){let e=qt[Oe++];if(Gl[e]){let t;return Gl[e](qt.subarray(Oe,t=Oe+=n),r=>{Oe=r;try{return So()}finally{Oe=t}})}else throw new Error("Unknown extension type "+e)}var OU=new Array(4096);function fV(){let n=qt[Oe++];if(n>=160&&n<192){if(n=n-160,lf>=Oe)return Cg.slice(Oe-$u,(Oe+=n)-$u);if(!(lf==0&&Qu<180))return QM(n)}else return Oe--,pV(So());let e=(n<<5^(n>1?ei.getUint16(Oe):n>0?qt[Oe]:0))&4095,t=OU[e],r=Oe,i=Oe+n-3,s,o=0;if(t&&t.bytes==n){for(;r<i;){if(s=ei.getUint32(r),s!=t[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=qt[r++],s!=t[o++]){r=1879048192;break}if(r===i)return Oe=r,t.string;i-=3,r=Oe}for(t=[],OU[e]=t,t.bytes=n;r<i;)s=ei.getUint32(r),t.push(s),r+=4;for(i+=3;r<i;)s=qt[r++],t.push(s);let a=n<16?gN(n):dV(n);return a!=null?t.string=a:t.string=QM(n)}function pV(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";throw new Error("Invalid property type for record",typeof n)}const NU=(n,e)=>{let t=So().map(pV),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let i=li[n];return i&&(i.isShared||Og)&&((li.restoreStructures||(li.restoreStructures=[]))[n]=i),li[n]=t,t.read=mN(t,r),t.read()};Gl[0]=()=>{};Gl[0].noBuffer=!0;Gl[66]=n=>{let e=n.length,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);return t};let jve={Error,TypeError,ReferenceError};Gl[101]=()=>{let n=So();return(jve[n[0]]||Error)(n[1],{cause:n[2]})};Gl[105]=n=>{if(us.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=ei.getUint32(Oe-4);sm||(sm=new Map);let t=qt[Oe],r;t>=144&&t<160||t==220||t==221?r=[]:r={};let i={target:r};sm.set(e,i);let s=So();return i.used?Object.assign(r,s):(i.target=s,s)};Gl[112]=n=>{if(us.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=ei.getUint32(Oe-4),t=sm.get(e);return t.used=!0,t.target};Gl[115]=()=>new Set(So());const mV=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let Hve=typeof globalThis=="object"?globalThis:window;Gl[116]=n=>{let e=n[0],t=mV[e];if(!t){if(e===16){let r=new ArrayBuffer(n.length-1);return new Uint8Array(r).set(n.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new Hve[t](Uint8Array.prototype.slice.call(n,1).buffer)};Gl[120]=()=>{let n=So();return new RegExp(n[0],n[1])};const Gve=[];Gl[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=Oe;return Oe+=e-n.length,ka=Gve,ka=[kU(),kU()],ka.position0=0,ka.position1=0,ka.postBundlePosition=Oe,Oe=t,So()};Gl[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function gV(n){let e=Qu,t=Oe,r=$u,i=lf,s=Cg,o=sm,a=ka,c=new Uint8Array(qt.slice(0,Qu)),l=li,u=li.slice(0,li.length),h=us,d=Og,p=n();return Qu=e,Oe=t,$u=r,lf=i,Cg=s,sm=o,ka=a,qt=c,Og=d,li=l,li.splice(0,li.length,...u),us=h,ei=new DataView(qt.buffer,qt.byteOffset,qt.byteLength),p}function ZM(){qt=null,sm=null,li=null}const _N=new Array(147);for(let n=0;n<256;n++)_N[n]=+("1e"+Math.floor(45.15-n*.30103));var KC=new lE({useRecords:!1});KC.unpack;KC.unpackMultiple;KC.unpack;let Wve=new Float32Array(1);new Uint8Array(Wve.buffer,0,4);let cx;try{cx=new TextEncoder}catch{}let eI,_V;const YC=typeof Buffer<"u",ST=YC?function(n){return Buffer.allocUnsafeSlow(n)}:Uint8Array,vV=YC?Buffer:Uint8Array,PU=YC?4294967296:2144337920;let We,hS,as,Ue=0,jc,Hs=null,$ve;const qve=21760,Xve=/[\u0080-\uFFFF]/,yv=Symbol("record-id");class Kve extends lE{constructor(e){super(e),this.offset=0;let t,r,i,s,o=vV.prototype.utf8Write?function($,K){return We.utf8Write($,K,We.byteLength-K)}:cx&&cx.encodeInto?function($,K){return cx.encodeInto($,We.subarray(K)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,p=u+64,_=u+h+64;if(_>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let y=[],S=0,T=0;this.pack=this.encode=function($,K){if(We||(We=new ST(8192),as=We.dataView||(We.dataView=new DataView(We.buffer,0,8192)),Ue=0),jc=We.length-10,jc-Ue<2048?(We=new ST(We.length),as=We.dataView||(We.dataView=new DataView(We.buffer,0,We.length)),jc=We.length-10,Ue=0):Ue=Ue+7&2147483640,t=Ue,K&tye&&(Ue+=K&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof $!="string"?(Hs=[],Hs.size=1/0):Hs=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Q=i.sharedLength||0;if(Q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let ne=0;ne<Q;ne++){let G=i[ne];if(!G)continue;let J,re=i.transitions;for(let ue=0,ye=G.length;ue<ye;ue++){let Ne=G[ue];J=re[Ne],J||(J=re[Ne]=Object.create(null)),re=J}re[yv]=ne+64}this.lastNamedStructuresLength=Q}c||(i.nextId=Q+64)}r&&(r=!1);let te;try{a.randomAccessStructure&&$&&$.constructor&&$.constructor===Object?X($):I($);let Q=Hs;if(Hs&&UU(t,I,0),s&&s.idsToInsert){let ne=s.idsToInsert.sort((ue,ye)=>ue.offset>ye.offset?1:-1),G=ne.length,J=-1;for(;Q&&G>0;){let ue=ne[--G].offset+t;ue<Q.stringsPosition+t&&J===-1&&(J=0),ue>Q.position+t?J>=0&&(J+=6):(J>=0&&(as.setUint32(Q.position+t,as.getUint32(Q.position+t)+J),J=-1),Q=Q.previous,G++)}J>=0&&Q&&as.setUint32(Q.position+t,as.getUint32(Q.position+t)+J),Ue+=ne.length*6,Ue>jc&&F(Ue),a.offset=Ue;let re=Jve(We.subarray(t,Ue),ne);return s=null,re}return a.offset=Ue,K&Zve?(We.start=t,We.end=Ue,We):We.subarray(t,Ue)}catch(Q){throw te=Q,Q}finally{if(i&&(A(),r&&a.saveStructures)){let Q=i.sharedLength||0,ne=We.subarray(t,Ue),G=Qve(i,a);if(!te)return a.saveStructures(G,G.isCompatible)===!1?a.pack($,K):(a.lastNamedStructuresLength=Q,We.length>1073741824&&(We=null),ne)}We.length>1073741824&&(We=null),K&eye&&(Ue=t)}};const A=()=>{T<10&&T++;let $=i.sharedLength||0;if(i.length>$&&!c&&(i.length=$),S>1e4)i.transitions=null,T=0,S=0,y.length>0&&(y=[]);else if(y.length>0&&!c){for(let K=0,te=y.length;K<te;K++)y[K][yv]=0;y=[]}},R=$=>{var K=$.length;K<16?We[Ue++]=144|K:K<65536?(We[Ue++]=220,We[Ue++]=K>>8,We[Ue++]=K&255):(We[Ue++]=221,as.setUint32(Ue,K),Ue+=4);for(let te=0;te<K;te++)I($[te])},I=$=>{Ue>jc&&(We=F(Ue));var K=typeof $,te;if(K==="string"){let Q=$.length;if(Hs&&Q>=4&&Q<4096){if((Hs.size+=Q)>qve){let re,ue=(Hs[0]?Hs[0].length*3+Hs[1].length:0)+10;Ue+ue>jc&&(We=F(Ue+ue));let ye;Hs.position?(ye=Hs,We[Ue]=200,Ue+=3,We[Ue++]=98,re=Ue-t,Ue+=4,UU(t,I,0),as.setUint16(re+t-3,Ue-t-re)):(We[Ue++]=214,We[Ue++]=98,re=Ue-t,Ue+=4),Hs=["",""],Hs.previous=ye,Hs.size=0,Hs.position=re}let J=Xve.test($);Hs[J?0:1]+=$,We[Ue++]=193,I(J?-Q:Q);return}let ne;Q<32?ne=1:Q<256?ne=2:Q<65536?ne=3:ne=5;let G=Q*3;if(Ue+G>jc&&(We=F(Ue+G)),Q<64||!o){let J,re,ue,ye=Ue+ne;for(J=0;J<Q;J++)re=$.charCodeAt(J),re<128?We[ye++]=re:re<2048?(We[ye++]=re>>6|192,We[ye++]=re&63|128):(re&64512)===55296&&((ue=$.charCodeAt(J+1))&64512)===56320?(re=65536+((re&1023)<<10)+(ue&1023),J++,We[ye++]=re>>18|240,We[ye++]=re>>12&63|128,We[ye++]=re>>6&63|128,We[ye++]=re&63|128):(We[ye++]=re>>12|224,We[ye++]=re>>6&63|128,We[ye++]=re&63|128);te=ye-Ue-ne}else te=o($,Ue+ne);te<32?We[Ue++]=160|te:te<256?(ne<2&&We.copyWithin(Ue+2,Ue+1,Ue+1+te),We[Ue++]=217,We[Ue++]=te):te<65536?(ne<3&&We.copyWithin(Ue+3,Ue+2,Ue+2+te),We[Ue++]=218,We[Ue++]=te>>8,We[Ue++]=te&255):(ne<5&&We.copyWithin(Ue+5,Ue+3,Ue+3+te),We[Ue++]=219,as.setUint32(Ue,te),Ue+=4),Ue+=te}else if(K==="number")if($>>>0===$)$<32||$<128&&this.useRecords===!1||$<64&&!this.randomAccessStructure?We[Ue++]=$:$<256?(We[Ue++]=204,We[Ue++]=$):$<65536?(We[Ue++]=205,We[Ue++]=$>>8,We[Ue++]=$&255):(We[Ue++]=206,as.setUint32(Ue,$),Ue+=4);else if($>>0===$)$>=-32?We[Ue++]=256+$:$>=-128?(We[Ue++]=208,We[Ue++]=$+256):$>=-32768?(We[Ue++]=209,as.setInt16(Ue,$),Ue+=2):(We[Ue++]=210,as.setInt32(Ue,$),Ue+=4);else{let Q;if((Q=this.useFloat32)>0&&$<4294967296&&$>=-2147483648){We[Ue++]=202,as.setFloat32(Ue,$);let ne;if(Q<4||(ne=$*_N[(We[Ue]&127)<<1|We[Ue+1]>>7])>>0===ne){Ue+=4;return}else Ue--}We[Ue++]=203,as.setFloat64(Ue,$),Ue+=8}else if(K==="object"||K==="function")if(!$)We[Ue++]=192;else{if(s){let ne=s.get($);if(ne){if(!ne.id){let G=s.idsToInsert||(s.idsToInsert=[]);ne.id=G.push(ne)}We[Ue++]=214,We[Ue++]=112,as.setUint32(Ue,ne.id),Ue+=4;return}else s.set($,{offset:Ue-t})}let Q=$.constructor;if(Q===Object)z($);else if(Q===Array)R($);else if(Q===Map)if(this.mapAsEmptyObject)We[Ue++]=128;else{te=$.size,te<16?We[Ue++]=128|te:te<65536?(We[Ue++]=222,We[Ue++]=te>>8,We[Ue++]=te&255):(We[Ue++]=223,as.setUint32(Ue,te),Ue+=4);for(let[ne,G]of $)I(ne),I(G)}else{for(let ne=0,G=eI.length;ne<G;ne++){let J=_V[ne];if($ instanceof J){let re=eI[ne];if(re.write){re.type&&(We[Ue++]=212,We[Ue++]=re.type,We[Ue++]=0);let Ae=re.write.call(this,$);Ae===$?Array.isArray($)?R($):z($):I(Ae);return}let ue=We,ye=as,Ne=Ue;We=null;let _e;try{_e=re.pack.call(this,$,Ae=>(We=ue,ue=null,Ue+=Ae,Ue>jc&&F(Ue),{target:We,targetView:as,position:Ue-Ae}),I)}finally{ue&&(We=ue,as=ye,Ue=Ne,jc=We.length-10)}_e&&(_e.length+Ue>jc&&F(_e.length+Ue),Ue=Yve(_e,We,Ue,re.type));return}}if(Array.isArray($))R($);else{if($.toJSON){const ne=$.toJSON();if(ne!==$)return I(ne)}if(K==="function")return I(this.writeFunction&&this.writeFunction($));z($)}}}else if(K==="boolean")We[Ue++]=$?195:194;else if(K==="bigint"){if($<BigInt(1)<<BigInt(63)&&$>=-(BigInt(1)<<BigInt(63)))We[Ue++]=211,as.setBigInt64(Ue,$);else if($<BigInt(1)<<BigInt(64)&&$>0)We[Ue++]=207,as.setBigUint64(Ue,$);else if(this.largeBigIntToFloat)We[Ue++]=203,as.setFloat64(Ue,Number($));else{if(this.largeBigIntToString)return I($.toString());if(this.useBigIntExtension&&$<BigInt(2)**BigInt(1023)&&$>-(BigInt(2)**BigInt(1023))){We[Ue++]=199,Ue++,We[Ue++]=66;let Q=[],ne;do{let G=$&BigInt(255);ne=(G&BigInt(128))===($<BigInt(0)?BigInt(128):BigInt(0)),Q.push(G),$>>=BigInt(8)}while(!(($===BigInt(0)||$===BigInt(-1))&&ne));We[Ue-2]=Q.length;for(let G=Q.length;G>0;)We[Ue++]=Number(Q[--G]);return}else throw new RangeError($+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Ue+=8}else if(K==="undefined")this.encodeUndefinedAsNil?We[Ue++]=192:(We[Ue++]=212,We[Ue++]=0,We[Ue++]=0);else throw new Error("Unknown type: "+K)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?$=>{let K;if(this.skipValues){K=[];for(let ne in $)(typeof $.hasOwnProperty!="function"||$.hasOwnProperty(ne))&&!this.skipValues.includes($[ne])&&K.push(ne)}else K=Object.keys($);let te=K.length;te<16?We[Ue++]=128|te:te<65536?(We[Ue++]=222,We[Ue++]=te>>8,We[Ue++]=te&255):(We[Ue++]=223,as.setUint32(Ue,te),Ue+=4);let Q;if(this.coercibleKeyAsNumber)for(let ne=0;ne<te;ne++){Q=K[ne];let G=Number(Q);I(isNaN(G)?Q:G),I($[Q])}else for(let ne=0;ne<te;ne++)I(Q=K[ne]),I($[Q])}:$=>{We[Ue++]=222;let K=Ue-t;Ue+=2;let te=0;for(let Q in $)(typeof $.hasOwnProperty!="function"||$.hasOwnProperty(Q))&&(I(Q),I($[Q]),te++);if(te>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');We[K+++t]=te>>8,We[K+t]=te&255},D=this.useRecords===!1?U:e.progressiveRecords&&!d?$=>{let K,te=i.transitions||(i.transitions=Object.create(null)),Q=Ue++-t,ne;for(let G in $)if(typeof $.hasOwnProperty!="function"||$.hasOwnProperty(G)){if(K=te[G],K)te=K;else{let J=Object.keys($),re=te;te=i.transitions;let ue=0;for(let ye=0,Ne=J.length;ye<Ne;ye++){let _e=J[ye];K=te[_e],K||(K=te[_e]=Object.create(null),ue++),te=K}Q+t+1==Ue?(Ue--,V(te,J,ue)):W(te,J,Q,ue),ne=!0,te=re[G]}I($[G])}if(!ne){let G=te[yv];G?We[Q+t]=G:W(te,Object.keys($),Q,0)}}:$=>{let K,te=i.transitions||(i.transitions=Object.create(null)),Q=0;for(let G in $)(typeof $.hasOwnProperty!="function"||$.hasOwnProperty(G))&&(K=te[G],K||(K=te[G]=Object.create(null),Q++),te=K);let ne=te[yv];ne?ne>=96&&d?(We[Ue++]=((ne-=96)&31)+96,We[Ue++]=ne>>5):We[Ue++]=ne:V(te,te.__keys__||Object.keys($),Q);for(let G in $)(typeof $.hasOwnProperty!="function"||$.hasOwnProperty(G))&&I($[G])},L=typeof this.useRecords=="function"&&this.useRecords,z=L?$=>{L($)?D($):U($)}:D,F=$=>{let K;if($>16777216){if($-t>PU)throw new Error("Packed buffer would be larger than maximum buffer size");K=Math.min(PU,Math.round(Math.max(($-t)*($>67108864?1.25:2),4194304)/4096)*4096)}else K=(Math.max($-t<<2,We.length-1)>>12)+1<<12;let te=new ST(K);return as=te.dataView||(te.dataView=new DataView(te.buffer,0,K)),$=Math.min($,We.length),We.copy?We.copy(te,0,t,$):te.set(We.slice(t,$)),Ue-=t,t=0,jc=te.length-10,We=te},V=($,K,te)=>{let Q=i.nextId;Q||(Q=64),Q<p&&this.shouldShareStructure&&!this.shouldShareStructure(K)?(Q=i.nextOwnId,Q<_||(Q=p),i.nextOwnId=Q+1):(Q>=_&&(Q=p),i.nextId=Q+1);let ne=K.highByte=Q>=96&&d?Q-96>>5:-1;$[yv]=Q,$.__keys__=K,i[Q-64]=K,Q<p?(K.isShared=!0,i.sharedLength=Q-63,r=!0,ne>=0?(We[Ue++]=(Q&31)+96,We[Ue++]=ne):We[Ue++]=Q):(ne>=0?(We[Ue++]=213,We[Ue++]=114,We[Ue++]=(Q&31)+96,We[Ue++]=ne):(We[Ue++]=212,We[Ue++]=114,We[Ue++]=Q),te&&(S+=T*te),y.length>=h&&(y.shift()[yv]=0),y.push($),I(K))},W=($,K,te,Q)=>{let ne=We,G=Ue,J=jc,re=t;We=hS,Ue=0,t=0,We||(hS=We=new ST(8192)),jc=We.length-10,V($,K,Q),hS=We;let ue=Ue;if(We=ne,Ue=G,jc=J,t=re,ue>1){let ye=Ue+ue-1;ye>jc&&F(ye);let Ne=te+t;We.copyWithin(Ne+ue,Ne+1,Ue),We.set(hS.slice(0,ue),Ne),Ue=ye}else We[te+t]=hS[0]},X=$=>{let K=$ve($,We,t,Ue,i,F,(te,Q,ne)=>{if(ne)return r=!0;Ue=Q;let G=We;return I(te),A(),G!==We?{position:Ue,targetView:as,target:We}:Ue},this);if(K===0)return z($);Ue=K}}useBuffer(e){We=e,We.dataView||(We.dataView=new DataView(We.buffer,We.byteOffset,We.byteLength)),Ue=0}set position(e){Ue=e}get position(){return Ue}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}_V=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,cV];eI=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,n.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),t(r)}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?DU(n,16,e):LU(YC?Buffer.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==vV&&this.moreTypes?DU(n,mV.indexOf(t.name),e):LU(n,e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function DU(n,e,t,r){let i=n.byteLength;if(i+1<256){var{target:s,position:o}=t(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=t(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=t(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,n.buffer||(n=new Uint8Array(n)),s.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o)}function LU(n,e){let t=n.byteLength;var r,i;if(t<256){var{target:r,position:i}=e(t+2);r[i++]=196,r[i++]=t}else if(t<65536){var{target:r,position:i}=e(t+3);r[i++]=197,r[i++]=t>>8,r[i++]=t&255}else{var{target:r,position:i,targetView:s}=e(t+5);r[i++]=198,s.setUint32(i,t),i+=4}r.set(n,i)}function Yve(n,e,t,r){let i=n.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=r,e.set(n,t),t+=i,t}function Jve(n,e){let t,r=e.length*6,i=n.length-r;for(;t=e.pop();){let s=t.offset,o=t.id;n.copyWithin(s+r,s,i),r-=6;let a=s+r;n[a++]=214,n[a++]=105,n[a++]=o>>24,n[a++]=o>>16&255,n[a++]=o>>8&255,n[a++]=o&255,i=s}return n}function UU(n,e,t){if(Hs.length>0){as.setUint32(Hs.position+n,Ue+t-Hs.position-n),Hs.stringsPosition=Ue-n;let r=Hs;Hs=null,e(r[0]),e(r[1])}}function Qve(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}let yV=new Kve({useRecords:!1});yV.pack;yV.pack;const Zve=512,eye=1024,tye=2048;function FU(){return{id:_o()}}function nye(){return new Array(ic*P_).map(()=>{})}function rye(n=DY){const e={terrain:nye(),objects:{},id:""};return n(e)}function vN(n){var e;return Ur((n==null?void 0:n.name)??((e=n==null?void 0:n.kinddata)==null?void 0:e.name)??"object")}function iye(n){var e;return(n==null?void 0:n.color)??((e=n==null?void 0:n.kinddata)==null?void 0:e.color)??Kr.BLACK}function sye(n){var e;return(n==null?void 0:n.bg)??((e=n==null?void 0:n.kinddata)==null?void 0:e.bg)??Kr.BLACK}function pw(n,e){if(!fe(n)||!vu(e))return;const{color:t,bg:r}=aEe(e);fe(t)&&(n.color=t),fe(r)&&(n.bg=r)}function oye(n,e){if(!fe(n)||!fe(e)||!fe(e.x)||!fe(e.y)||e.x<0||e.x>=ic||e.y<0||e.y>=P_)return;const t=Uy(e),r=e.x+e.y*ic;return n.terrain[r]=t,n.terrain[r]}function aye(n,e){if(!fe(n)||!fe(e))return;const t=Uy(e);return t.id=t.id??_o(),n.objects[t.id]=t,n.objects[t.id]}function SV(n,e,t){return oye(n,{...e,kind:t})}function EV(n,e,t,r){const i=aye(n,{...e,kind:t});return fe(r)&&fe(i)&&(i.id=r),i}function mw(n,e){if(n)return n.objects[e]}function tI(n,e,t,r,i){if(!fe(n)||!fe(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=vv(o,s),c=ic-1,l=P_-1;for(let u=0;u<r.length;++u){const h=Uve(r[u]);switch(h){case dn.IDLE:break;case dn.NORTH:case dn.SOUTH:case dn.WEST:case dn.EAST:Aa(s,h);break;case dn.BY:{const[d,p]=r.slice(u+1);En(d)&&En(p)&&(s.x=Ii(s.x+d,0,c),s.y=Ii(s.y+p,0,l)),u+=2;break}case dn.AT:{const[d,p]=r.slice(u+1);En(d)&&En(p)&&(s.x=Ii(d,0,c),s.y=Ii(p,0,l)),u+=2;break}case dn.FLOW:Aa(s,a);break;case dn.SEEK:{const d=cye(n,e,t);lb(d)&&Aa(s,vv(i,d));break}case dn.RNDNS:Aa(s,Rv(dn.NORTH,dn.SOUTH));break;case dn.RNDNE:Aa(s,Rv(dn.NORTH,dn.EAST));break;case dn.RND:Aa(s,Rv(dn.NORTH,dn.SOUTH,dn.WEST,dn.EAST));break;case dn.CW:case dn.CCW:case dn.OPP:case dn.RNDP:{const d=tI(n,e,t,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,h){case dn.CW:switch(vv(i,d)){case dn.NORTH:Aa(s,dn.EAST);break;case dn.SOUTH:Aa(s,dn.WEST);break;case dn.EAST:Aa(s,dn.SOUTH);break;case dn.WEST:Aa(s,dn.NORTH);break}break;case dn.CCW:switch(vv(i,d)){case dn.NORTH:Aa(s,dn.WEST);break;case dn.SOUTH:Aa(s,dn.EAST);break;case dn.EAST:Aa(s,dn.NORTH);break;case dn.WEST:Aa(s,dn.SOUTH);break}break;case dn.OPP:switch(vv(i,d)){case dn.NORTH:Aa(s,dn.SOUTH);break;case dn.SOUTH:Aa(s,dn.NORTH);break;case dn.EAST:Aa(s,dn.WEST);break;case dn.WEST:Aa(s,dn.EAST);break}break;case dn.RNDP:switch(vv(i,d)){case dn.NORTH:case dn.SOUTH:s.x+=Rv(-1,1);break;case dn.WEST:case dn.EAST:s.y+=Rv(-1,1);break}break}break}}}return s}function cye(n,e,t){if(!fe(n)||!fe(e))return;const r=n.objects[t];if(fe(r))return r;if(lb(e))return aV(e,ub(n,"player"))}const bV={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function em(n){return ni(n)&&TV(n[0])}function TV(n){return fe(Mx[n])&&vr(n)}function xV(n){if(vr(n))return bV[Ur(n)]}function BU(n){if(em(n))return n;if(TV(n))return[n];const e=xV(n);if(fe(e))return[e]}function lx(n){const e=be.words[n],t=BU(e);if(em(t))return[t,n+1];const[r,i]=Oa(n),s=BU(r);return em(s)?[s,i]:[void 0,n]}const wV={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Ts.ISSOLID,Ts.ISWALK,Ts.ISSWIM,Ts.ISBULLET,Ts.ISWALK,Ts.ISSWIM;function Rg(n){return ni(n)&&nI(n[0])}function nI(n){return fe(Ts[n])&&vr(n)}function lye(n){if(vr(n))return wV[Ur(n)]}function CV(n){const e=be.words[n];if(Rg(e))return[e,n+1];if(nI(e))return[[e],n+1];const[t,r]=Oa(n);return Rg(t)?[t,r]:nI(t)?[[t],r]:[void 0,n]}const be={timestamp:0,book:void 0,board:void 0,element:void 0,player:"",isplayer:!1,words:[],get:void 0};var lt=(n=>(n[n.CATEGORY=0]="CATEGORY",n[n.COLLISION=1]="COLLISION",n[n.COLOR=2]="COLOR",n[n.KIND=3]="KIND",n[n.DIR=4]="DIR",n[n.NAME=5]="NAME",n[n.NUMBER=6]="NUMBER",n[n.STRING=7]="STRING",n[n.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",n[n.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",n[n.MAYBE_COLLISION=10]="MAYBE_COLLISION",n[n.MAYBE_COLOR=11]="MAYBE_COLOR",n[n.MAYBE_KIND=12]="MAYBE_KIND",n[n.MAYBE_DIR=13]="MAYBE_DIR",n[n.MAYBE_NAME=14]="MAYBE_NAME",n[n.MAYBE_NUMBER=15]="MAYBE_NUMBER",n[n.MAYBE_STRING=16]="MAYBE_STRING",n[n.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",n[n.ANY=18]="ANY",n))(lt||{});function Fo(n,e){throw new Error(`Invalid arg, expected: ${n} but got ${JSON.stringify(e)}`)}function Rt(n,e,t){var o,a,c,l;const r=be.words;be.words=n;const i=[];let s=e;for(let u=0;u<t.length;++u)switch(t[u]){case 0:{const[h,d]=lx(s);em(h)||Fo("terrain or object",h),s=d,i.push(h);break}case 1:{const[h,d]=CV(s);Rg(h)||Fo("solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 2:{const[h,d]=Sw(s);vu(h)||Fo("color",h),s=d,i.push(h);break}case 3:{const[h,d]=TU(s);Ay(h)?(s=d,i.push(h)):Fo("kind",h);break}case 4:{const[h,d]=YM(s);if(ff(h)){const p=((o=be.element)==null?void 0:o.x)??0,_=((a=be.element)==null?void 0:a.y)??0,y={x:p,y:_},S=fe(be.board)&&fe(be.element)?tI(be.board,be.element,be.player,h,y):y;s=d,i.push(S)}else Fo("direction",h);break}case 5:{const h=be.words[s];vr(h)||Fo("string",h),++s,i.push(h);break}case 6:{const[h,d]=Oa(s);if(vr(h)){const p=parseFloat(h);En(p)?i.push(p):Fo("number",h)}else En(h)?i.push(h):Fo("number",h);s=d;break}case 7:{const[h,d]=Oa(s);vr(h)||Fo("string",h),s=d,i.push(h);break}case 8:{const[h,d]=Oa(s,!1);let p=h;if(vr(p)){const _=parseFloat(p);En(_)&&(p=_)}else En(p)||Fo("number or string",p);s=d,i.push(p);break}case 9:{const[h,d]=lx(s);h!==void 0&&!em(h)&&Fo("optional terrain or object",h),s=d,i.push(h);break}case 10:{const[h,d]=lx(s);h!==void 0&&!Rg(h)&&Fo("optional solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 11:{const[h,d]=Sw(s);h!==void 0&&!vu(h)&&Fo("optional color",h),s=d,i.push(h);break}case 12:{const[h,d]=TU(s);h!==void 0&&!Ay(h)&&Fo("optional kind",h),s=d,i.push(h);break}case 13:{const[h,d]=YM(s);if(ff(h)){const p=((c=be.element)==null?void 0:c.x)??0,_=((l=be.element)==null?void 0:l.y)??0,y={x:p,y:_},S=be.board?tI(be.board,be.element,be.player,h,y):y;s=d,i.push(S)}else h===void 0?(s=d,i.push(void 0)):Fo("optional direction",h);break}case 14:{const h=be.words[s];h!==void 0&&!vr(h)&&Fo("optional string",h),++s,i.push(h);break}case 15:{const[h,d]=Oa(s);if(vr(h)){const p=parseFloat(h);En(p)?i.push(p):Fo("optional number",h)}else En(h)||h===void 0?i.push(h):Fo("optional number",h);s=d;break}case 16:{const[h,d]=Oa(s);h!==void 0&&!vr(h)&&Fo("optional string",h),s=d,i.push(h);break}case 17:{const[h,d]=Oa(s,!1);let p=h;if(vr(p)){const _=parseFloat(p);En(_)&&(p=_)}else p!==void 0&&!En(p)&&Fo("number or string",p);s=d,i.push(p);break}case 18:{const[h,d]=Oa(s);s=d,i.push(h);break}}return be.words=r,[...i,s]}const uye=["echo","reverb","chorus","phaser","distortion","vibrato"];function zU(n,e){const[t]=Rt(e,0,[lt.STRING]);uJ("audio",n,t)}function Xd(n,e){const[t]=Rt(e,0,[lt.NUMBER_OR_STRING]);if(En(t))eR("audio",n,"volume",t);else if(uye.includes(Ur(t))){const[r,i]=Rt(e,1,[lt.NUMBER_OR_STRING,lt.MAYBE_NUMBER_OR_STRING]);pJ("audio",n,t,r,i)}else{const[r]=Rt(e,1,[lt.MAYBE_NUMBER_OR_STRING]);if(En(r)){const i=e.length-1,s=new Array(i).fill(lt.NUMBER),o=Rt(e,1,s).slice(0,i),a=o.length===1?o[0]:o;eR("audio",n,t,a)}else{const[i]=Rt(e,1,[lt.MAYBE_NUMBER_OR_STRING]);eR("audio",n,t,i)}}}const hye=Rm().command("mainvolume",(n,e)=>{const[t]=Rt(e,0,[lt.NUMBER]);return hJ("audio",t,be.player),0}).command("drumvolume",(n,e)=>{const[t]=Rt(e,0,[lt.NUMBER]);return dJ("audio",t,be.player),0}).command("ttsvolume",(n,e)=>{const[t]=Rt(e,0,[lt.NUMBER]);return fJ("audio",t,be.player),0}).command("play",(n,e)=>(zU(1,e),0)).command("synth",(n,e)=>{for(let t=1;t<=8;++t)Xd(t,e);return 0}).command("synth1",(n,e)=>(Xd(1,e),0)).command("synth2",(n,e)=>(Xd(2,e),0)).command("synth3",(n,e)=>(Xd(3,e),0)).command("synth4",(n,e)=>(Xd(4,e),0)).command("synth5",(n,e)=>(Xd(5,e),0)).command("synth6",(n,e)=>(Xd(6,e),0)).command("synth7",(n,e)=>(Xd(7,e),0)).command("synth8",(n,e)=>(Xd(8,e),0)).command("bgplay",(n,e)=>(zU(0,e),0)).command("bgsynth",(n,e)=>(Xd(0,e),0)).command("tts",(n,e)=>{const[t,r]=Rt(e,0,[lt.STRING,lt.MAYBE_STRING]);return lJ("audio",r??"",t),0}),yN=BC(32,126).map(n=>String.fromCharCode(n));function ri(n){return xu({...n,name:`token_${n.name}`})}function hh(n,e=!1){return ri(e?{name:n,pattern:new RegExp(n.toLowerCase(),"i"),longer_alt:rl,group:pa.SKIPPED}:{name:n,pattern:new RegExp(n.toLowerCase(),"i"),longer_alt:rl})}const uE=ri({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),dye=ri({name:"whitespace",pattern:/ +/,group:pa.SKIPPED}),fye=ri({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:pa.SKIPPED}),SN=ri({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Av=ri({name:"command",pattern:/#/,start_chars_hint:["#"]});let RV=!1;function pye(n,e,t){if(!RV)return null;const[r]=t.slice(-1);if(r&&r.tokenType!==uE)return null;let i=e;for(;n[i]===" ";)i++;if("@#/?':!".includes(n[i]))return null;let s=e+1;for(;s<n.length&&n[s]!==`
`;)s++;const o=n.substring(e,s);return o.trim().length===0?null:[o]}const AV=ri({name:"text",pattern:pye,line_breaks:!1,start_chars_hint:yN.filter(n=>"@#/?':!".includes(n)===!1)}),MV=ri({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),IV=ri({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),kV=ri({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),OV=ri({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),rl=ri({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:yN}),NV=ri({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),PV=ri({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),DV=ri({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:rl}),LV=ri({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:rl}),UV=ri({name:"islessthan",pattern:/<|below/,longer_alt:rl}),FV=ri({name:"isgreaterthan",pattern:/>|above/,longer_alt:rl}),BV=ri({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:rl}),zV=ri({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:rl}),rI=ri({name:"or",pattern:/or/i,longer_alt:rl}),iI=ri({name:"not",pattern:/not/i,longer_alt:rl}),sI=ri({name:"and",pattern:/and/i,longer_alt:rl}),oI=ri({name:"plus",pattern:/\+/}),aI=ri({name:"minus",pattern:/-/}),VV=ri({name:"power",pattern:/\*\*/}),jV=ri({name:"multiply",pattern:/\*/}),cI=ri({name:"divide",pattern:/\//}),HV=ri({name:"moddivide",pattern:/%/}),GV=ri({name:"floordivide",pattern:/%%/}),WV=ri({name:"query",pattern:/\?/}),$V=ri({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),qV=ri({name:"rparen",pattern:/\)/,pop_mode:!0}),XV=ri({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:yN,longer_alt:rl}),KV=hh("debugger"),lI=hh("if"),ux=hh("do"),mye=hh("to",!0),uI=hh("done"),gye=hh("then",!0),hI=hh("else"),YV=hh("while"),JV=hh("repeat"),QV=hh("waitfor"),ZV=ri({name:"foreach",pattern:/foreach|for/,longer_alt:rl}),ej=hh("break"),tj=hh("continue");function nj(n){return[...n,PV,DV,LV,BV,UV,zV,FV,rI,iI,sI,oI,aI,VV,jV,cI,GV,HV,WV,$V,qV,NV,rl]}const rj=nj([AV,SN,XV,Av,MV,IV,kV,OV,uE,dye,ej,tj,KV,uI,ux,hI,ZV,lI,JV,gye,mye,QV,YV]),_ye=new pa({defaultMode:"use_newlines",modes:{use_newlines:rj,ignore_newlines:nj([fye])}},{skipValidations:!kf,ensureOptimizations:kf});function ij(n){RV=!0;const e=_ye.tokenize(n||` 
`),[t]=(ni(e.tokens)?e.tokens:[]).slice(-1);return t&&t.tokenType.name!=="Newline"&&e.tokens.push(ab(uE,`
`,t.startOffset,t.endOffset??NaN,t.startLine??NaN,t.endLine??NaN,t.startColumn??NaN,t.endColumn??NaN)),e}function sj(n,e=!0){const[t,...r]=n;switch(Ur(t)){default:return e?{type:An.OBJECT,values:n}:{type:An.CONST,values:n};case"loader":return{type:An.LOADER,values:r};case"board":return{type:An.BOARD,values:r};case"object":return{type:An.OBJECT,values:r};case"terrain":return{type:An.TERRAIN,values:r};case"charset":return{type:An.CHARSET,values:r};case"palette":return{type:An.PALETTE,values:r};case"rn":case"range":return{type:An.RANGE,values:r};case"sl":case"select":return{type:An.SELECT,values:r};case"nm":case"number":return{type:An.NUMBER,values:r};case"tx":case"text":return{type:An.TEXT,values:r};case"ln":case"link":return{type:An.LINK,values:r};case"hk":case"hotkey":return{type:An.HOTKEY,values:r};case"scroll":return{type:An.SCROLL,values:r};case"copyit":return{type:An.COPYIT,values:r}}}function Ku(n){switch(n){case An.LOADER:return"loader";case An.BOARD:return"board";case An.OBJECT:return"object";case An.TERRAIN:return"terrain";case An.CHARSET:return"charset";case An.PALETTE:return"palette";case An.CONST:return"const";case An.RANGE:return"range";case An.SELECT:return"select";case An.NUMBER:return"number";case An.TEXT:return"text";case An.LINK:return"link";case An.HOTKEY:return"hotkey";case An.SCROLL:return"scroll";case An.COPYIT:return"copyit"}}function vye(n,e){return{id:_o(),code:n,...e}}function oj(n){const e={...EN(n)};return Object.keys(e).forEach(t=>{switch(t){case"type":case"name":delete e[t];break}}),e}function EN(n){var r;if(!fe(n))return{};if(fe((r=n.stats)==null?void 0:r.type))return n.stats;n.stats={};const e=ij(n.code);let t=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===SN){const a=s.image.slice(1).split(" "),c=sj(a,t),l=Ur(c.values.join(" "));switch(t=!1,c.type){case An.LOADER:n.stats.type=Ri.LOADER,n.stats.name=l;break;case An.BOARD:n.stats.type=Ri.BOARD,n.stats.name=l;break;case An.OBJECT:n.stats.type=Ri.OBJECT,n.stats.name=l;break;case An.TERRAIN:n.stats.type=Ri.TERRAIN,n.stats.name=l;break;case An.CHARSET:n.stats.type=Ri.CHARSET,n.stats.name=l;break;case An.PALETTE:n.stats.type=Ri.PALETTE,n.stats.name=l;break;case An.CONST:{const[u,h]=c.values;if(vr(u)){const d=Ur(u);if(vr(h)){const p=parseFloat(h);n.stats[d]=En(p)?p:h}else En(h)?n.stats[d]=h:n.stats[d]=1}break}case An.RANGE:case An.SELECT:case An.NUMBER:case An.TEXT:case An.LINK:case An.HOTKEY:case An.SCROLL:{const[u,...h]=c.values;if(vr(u)){const d=Ur(u);n.stats[d]=h}break}}}}return fe(n.stats.type)||(n.stats.type=Ri.OBJECT),n.stats}function aj(n){switch(n){default:case Ri.ERROR:return"error";case Ri.LOADER:return Ku(An.LOADER);case Ri.BOARD:return Ku(An.BOARD);case Ri.OBJECT:return Ku(An.OBJECT);case Ri.TERRAIN:return Ku(An.TERRAIN);case Ri.CHARSET:return Ku(An.CHARSET);case Ri.PALETTE:return Ku(An.PALETTE)}}function bN(n){return EN(n).type??Ri.ERROR}function ET(n){return aj(bN(n))}function tm(n){return EN(n).name??""}function VU(n,e){const t=oj(n),r=Object.keys(t);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[s]=t[s];break;case"canpush":case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=Ts.ISWALK;break;case"isswim":case"isswimable":e.collision=Ts.ISSWIM;break;case"issolid":e.collision=Ts.ISSOLID;break;case"isbullet":e.collision=Ts.ISBULLET;break;case"canshoot":case"isdestructible":e.destructible=1;break}}}function cj(n){if(fe(n))switch(bN(n)){default:return;case Ri.ERROR:return n.code??"";case Ri.LOADER:return n.code??"";case Ri.BOARD:{fe(n.board)||(n.board=rye()),n.board.id=n.id;const e=oj(n);return n.board.isdark=fe(e.isdark)&&e.isdark?1:0,n.board.over=e.over??n.board.over,n.board.under=e.under??n.board.under,n.board.exitnorth=e.exitnorth??n.board.exitnorth,n.board.exitsouth=e.exitsouth??n.board.exitsouth,n.board.exitwest=e.exitwest??n.board.exitwest,n.board.exiteast=e.exiteast??n.board.exiteast,n.board.timelimit=e.timelimit??n.board.timelimit,n.board.restartonzap=e.restartonzap??n.board.restartonzap,n.board.maxplayershots=e.maxplayershots??n.board.maxplayershots,n.board}case Ri.OBJECT:return fe(n.object)||(n.object=FU()),n.object.name=tm(n),VU(n,n.object),n.object;case Ri.TERRAIN:return fe(n.terrain)||(n.terrain=FU()),n.terrain.name=tm(n),VU(n,n.terrain),n.terrain;case Ri.CHARSET:return fe(n.charset),n.charset;case Ri.PALETTE:return fe(n.palette),n.palette}}function lj(n){return{id:_o(),name:KY(),timestamp:0,activelist:[],pages:n,flags:{}}}function db(n,e){if(!fe(n))return;const t=Ur(e);return n.pages.find(i=>i.id===e||t===tm(i))}function uj(n,e,t){if(!fe(n))return;const r=Ur(t);return n.pages.find(s=>bN(s)===e&&(s.id===t||r===tm(s)))}function yye(n,e){if(!fe(n)||!fe(e))return!1;const t=db(n,e.id);return fe(t)?!1:(n.pages.push(e),!0)}function Sye(n,e){const t=db(n,e);if(fe(n)&&fe(t)){const r=Ur(e);return n.pages=n.pages.filter(i=>i.id!==e&&r!==tm(i)),t}}function Of(n,e){if(fe(e)&&fe(e.kind))return fe(e.kinddata)||(e.kinddata=fe(e.id)?TN(n,e.kind):hj(n,e.kind)),e.kinddata}function Eye(n,e,t){const r=Of(n,e);return(e==null?void 0:e[t])??(r==null?void 0:r[t])}function bye(n,e,t,r,i){const s=Of(n,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??t,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function TN(n,e){const t=e??"",r=uj(n,Ri.OBJECT,t);if(fe(r)){const i=cj(r);return{...Uy(i),name:t,code:r.code}}}function hj(n,e){const t=e??"",r=uj(n,Ri.TERRAIN,t);if(fe(r)){const i=cj(r);return{...Uy(i),name:t,code:r.code}}}function Tye(n,e){return n?(n.flags[e]=n.flags[e]??{},n.flags[e]):{}}function xye(n,e){n&&delete n.flags[e]}function wye(n,e,t,r){const i=mw(e,(t==null?void 0:t.id)??"");if(!fe(n)||!fe(e)||!fe(i)||!fe(i.x)||!fe(i.y)||!fe(e.lookup)||r.x<0||r.x>=ic||r.y<0||r.y>=P_||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*ic,o=Of(n,i),a=i.collision??(o==null?void 0:o.collision),c=mw(e,e.lookup[s]??"");if(fe(c))return!0;const l=e.terrain[s];if(fe(l)){const u=Of(n,l),h=l.collision??(u==null?void 0:u.collision);if(sV(a,h))return!0}return!1}function Cye(n,e,t,r){const i=mw(e,(t==null?void 0:t.id)??"");if(!fe(n)||!fe(e)||!fe(i)||!fe(i.x)||!fe(i.y)||!fe(e.lookup)||r.x<0||r.x>=ic||r.y<0||r.y>=P_)return{kind:"edge",collision:Ts.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*ic,o=r.x+r.y*ic,a=Of(n,i),c=i.collision??(a==null?void 0:a.collision),l=mw(e,e.lookup[o]??"");if(fe(l))return{...l};const u=e.terrain[o];if(fe(u)){const h=Of(n,u),d=u.collision??(h==null?void 0:h.collision);if(sV(c,d))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,fe(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function My(n,e){const t=Of(n,e);return fe(e==null?void 0:e.id)&&fe(e.x)&&fe(e.y)?Ur(e.name??(t==null?void 0:t.name)??"object"):Ur((e==null?void 0:e.name)??(t==null?void 0:t.name)??"terrain")}function dI(n,e,t,r){if(!fe(n)||!fe(e)||!fe(e.named)||!fe(t))return;const i=My(n,t);e.named[i]||(e.named[i]=new Set),e.named[i].add((t==null?void 0:t.id)??r??"")}function Rye(n,e,t){if(!(!fe(n)||!fe(e)||!fe(e.lookup)||!fe(t==null?void 0:t.id))&&!fe(t.removed)){const r=t.x??0,i=t.y??0;e.lookup[r+i*ic]=t.id}}function fI(n,e){if(!fe(n)||!fe(e)||fe(e.lookup)&&fe(e.named))return;const t=new Array(ic*P_).fill(void 0),r={},i=Object.values(e.objects);for(let a=0;a<i.length;++a){const c=i[a];if(fe(c.x)&&fe(c.y)&&fe(c.id)&&!fe(c.removed)){c.category=Mx.ISOBJECT,t[c.x+c.y*ic]=c.id;const l=My(n,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let s=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(fe(c)){c.x=s,c.y=o,c.category=Mx.ISTERRAIN;const l=My(n,c);r[l]||(r[l]=new Set),r[l].add(a)}++s,s>=ic&&(s=0,++o)}e.lookup=t,e.named=r}function gw(n,e,t){return My(n,e)!=="player"&&fe(e)?(e.removed=t,!0):!1}function JC(n,e,t){var r;if(fe(n)&&fe(e)&&fe(t==null?void 0:t.id)){if(fe(e.lookup)&&fe(t.x)&&fe(t.y)){const s=t.x+t.y*ic;e.lookup[s]===t.id&&e.lookup.splice(s,1)}const i=My(n,t);fe((r=e.named)==null?void 0:r[i])&&fe(t.id)&&e.named[i].delete(t.id)}}function Aye(n,e,t,r){if(fe(n)&&fe(e)&&fe(t)){const[i,s]=t,o=TN(n,i);if(fe(o)&&fe(o.name)){const a=EV(e,r,i);return pw(a,s),dI(n,e,a),a}}}function pI(n,e,t,r){if(fe(n)&&fe(e)&&fe(t)){const[i,s]=t,o=hj(n,i);if(fe(o)){const c=SV(e,r,i);pw(c,s);const l=r.x+r.y*ic;return dI(n,e,c,l),c}const a=TN(n,i);if(fe(a)&&fe(a.name)){const c=EV(e,r,i);return pw(c,s),Rye(n,e,c),dI(n,e,c),c}}}function bT(n,e,t,r){const i=vr(e)?e:e.id,s=vr(e)?void 0:{x:e.x??0,y:e.y??0},o=vr(t)?t:t.id,a=i??s;fe(o)&&fe(a)&&n.send(o,r,a)}function Mye(n,e,t,r){fe(t==null?void 0:t.id)?(t.headless=!0,JC(n,e,t)):SV(e,r,"empty")}function jU(n,e,t,r,i){const s=Cye(e,t,r,i);if(fe(s)){bT(n,s,n.id(),"thud"),r.kind===Ho.PLAYER?bT(n,n.id(),s,"touch"):r.collision===Ts.ISBULLET?bT(n,n.id(),s,"shot"):bT(n,n.id(),s,"bump");const o=Of(e,s);return(s.destructible??(o==null?void 0:o.destructible))&&Mye(e,t,s,i),!1}return!0}function HU(n,e,t){if(!lb(be.element))return 0;const[r,i]=Rt(e,0,[lt.DIR,lt.MAYBE_KIND]),s=i??["bullet"],o=Aye(be.book,be.board,s,{x:be.element.x,y:be.element.y});if(fe(o)){o.arg=t,o.collision=Ts.ISBULLET,o.destructible=1,o.stepx=r.x-be.element.x,o.stepy=r.y-be.element.y;const a=Of(be.book,o),c=o.code??(a==null?void 0:a.code)??"";nEe(be.book,be.board,o,c,1),o.x===be.element.x&&o.y===be.element.y?o.headless=!0:n.bucket(o.id)}return n.yield(),0}const Iye=Rm().command("change",(n,e)=>{if(!fe(be.book)||!fe(be.board))return 0;const[t,r]=Rt(e,0,[lt.KIND,lt.KIND]);fI(be.book,be.board);const i=fw(t)??"",s=ub(be.board,i),o=oV(s,t),a=fw(r),c=rV(r),l=iV(r);return o.forEach(u=>{if(My(be.book,u)===a)fe(c)&&(u.color=c),fe(l)&&(u.bg=l);else{if(fe(u.id)&&(JC(be.book,be.board,u),!gw(be.book,u,be.timestamp)))return;lb(u)&&pI(be.book,be.board,r,u)}}),0}).command("put",(n,e)=>{if(!fe(be.book)||!fe(be.board))return 0;const[t,r]=Rt(e,0,[lt.DIR,lt.KIND]);return fI(be.book,be.board),pI(be.book,be.board,r,t),0}).command("shootwith",(n,e)=>{const[t,r]=Rt(e,0,[lt.ANY]);return HU(n,e.slice(r),t)}).command("shoot",HU).command("throwstar",()=>0);function Sv(n=""){s3("cli",n,be.player)}const kye=Rm().command("send",(n,e)=>{const[t,r]=Rt(e,0,[lt.NAME,lt.ANY]);switch(t){case"helpmenu":af("cli","H E L P"),Hr("cli","#help controls","zss controls and inputs"),Lr("cli","!helpcontrols;read help controls"),Lr("cli",""),Hr("cli","#help text","text formatting"),Lr("cli","!helptext;read help text"),Lr("cli",""),Hr("cli","#help developer","developer commands"),Lr("cli","!helpdeveloper;read help developer"),Lr("cli",""),Hr("cli","#help player","player settings"),Lr("cli","!helpplayer;read help player"),Fp("cli","keyboard input"),Hr("cli","?","open console"),Hr("cli","esc","close console"),Hr("cli","tab","move console"),Hr("cli","up / down arrow keys","navigate console items"),Hr("cli","left / right arrow keys","change console items"),Hr("cli","enter","interact with console items"),Hr("cli","alt + arrow keys","skip words and console lines"),Hr("cli",`${Yge} + up / down arrow keys`,"input history");break;case"helpcontrols":af("cli","zss controls and inputs"),Fp("cli","keyboard input"),Hr("cli","arrow keys","move"),Hr("cli","shift + arrow keys","shoot"),Hr("cli","enter","ok / accept"),Hr("cli","escape","cancel / close"),Hr("cli","tab","menu / action"),Fp("cli","mouse input"),wi("cli","todo ???"),Fp("cli","controller input"),Hr("cli","left stick","move"),Hr("cli","right stick","aim"),Hr("cli","a","ok / accept"),Hr("cli","b","cancel / close"),Hr("cli","y","menu / action"),Hr("cli","x","shoot"),Hr("cli","triggers","shoot");break;case"helptext":af("cli","text formatting"),Fp("cli","typography"),wi("cli","plain text"),wi("cli","$centering text"),wi("cli",'"\\"@quoted strings for special chars\\""'),wi("cli","$$0-255 for ascii chars $159$176$240"),wi("cli",`use color names like ${hu("red","$$red")} to change foreground color`),wi("cli",`use color names like ${OD("ongreen","$$ongreen")} to change background color`),wi("cli",`use clear ${OD("onclear","to change background to")} transparent`),Fp("cli","hyperlinks"),wi("cli",`${hu("white",'"!hotkey"')} message shortcut;${hu("gray","Label")}`),wi("cli",`${hu("white",'"!range"')} flag [labelmin] [labelmax];${hu("gray","Input Label")}`),wi("cli",`${hu("white",'"!select"')} flag ...list of values;${hu("gray","Input Label")}`),wi("cli",`${hu("white",'"!number"')} flag [minvalue] [maxvalue];${hu("gray","Input Label")}`),wi("cli",`${hu("white",'"!text"')} flag;${hu("gray","Input Label")}`),wi("cli",`${hu("white",'"!copyit"')} flag;${hu("gray","Input Label")}`);break;case"helpdeveloper":af("cli","developer commands"),Hr("cli","#books","list books in memory"),Hr("cli","#pages","list pages in opened book"),Hr("cli","@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Hr("cli","#trash","list books and pages from open book you can delete"),Hr("cli","#save","flush state to register");break;case"helpplayer":af("cli","player settings"),wi("cli","todo");break;default:th("$2",`${t} ${r??""}`);break}return 0}).command("stat",(n,e)=>{let t;const[r,...i]=e.map(Pa),s=i.join(" ");switch(Ur(r)){case Ku(An.LOADER):t=L0(Ho.CONTENT,s,Ri.LOADER);break;default:t=L0(Ho.CONTENT,[r,...i].join(" "),Ri.OBJECT);break;case Ku(An.BOARD):t=L0(Ho.CONTENT,s,Ri.BOARD);break;case Ku(An.OBJECT):t=L0(Ho.CONTENT,s,Ri.OBJECT);break;case Ku(An.TERRAIN):t=L0(Ho.CONTENT,s,Ri.TERRAIN);break;case Ku(An.CHARSET):t=L0(Ho.CONTENT,s,Ri.CHARSET);break;case Ku(An.PALETTE):t=L0(Ho.CONTENT,s,Ri.PALETTE);break}return fe(t)&&n.command("pageopen",t.id),0}).command("text",(n,e)=>{const t=e.map(Pa).join(" ");return th("$2",t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=Pa(t),s=r.map(Pa).join(" ");return th("$2",`!${s};${i}`),0}).command("dev",()=>(Sv(),oJ("cli",be.player),0)).command("share",()=>(Sv(),aJ("cli",be.player),0)).command("bookcreate",(n,e)=>{const[t]=Rt(e,0,[lt.MAYBE_NAME]),r=kj(t);return fe(r)&&n.command("bookopen",r.id),0}).command("bookopen",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]),r=Iy(t);return fe(r)?(wi("cli",`opened [book] ${r.name}`),EI(Ho.MAIN,r.id),n.command("pages")):ti("cli","bookopen",`book ${t} not found`,be.player),0}).command("booktrash",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]),r=CS(Ho.MAIN),i=Iy(t);return fe(i)&&(r===i&&EI(Ho.MAIN,""),tEe(t),wi("cli",`trashed [book] ${i.name}`),Sv(),n.command("pages")),0}).command("pageopen",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]),r=om(Ho.MAIN);if(!fe(r))return 0;const i=db(r,t);if(fe(i)){const s=tm(i),o=ET(i);wi("cli",`opened [${o}] ${s}`),k4(i3(r.id,i.id),i.code);const a=ET(i);_J("cli",r.id,i.id,a,`${s} - ${r.name}`,be.player)}else ti("cli","pageopen",`page ${t} not found`,be.player);return 0}).command("pagetrash",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]),r=om(Ho.MAIN),i=Sye(r,t);if(fe(t)){const s=tm(i),o=ET(i);wi("cli",`trashed [${o}] ${s}`),Sv(),n.command("pages")}return 0}).command("help",(n,e)=>{const t=e.map(Pa).join(" ")||"menu";return n.command(`help${t}`),0}).command("books",()=>{Fp("cli","books");const n=CS(Ho.MAIN);Hr("cli","main",`${(n==null?void 0:n.name)??"empty"} $GREEN${(n==null?void 0:n.id)??""}`);const e=CS(Ho.CONTENT);Hr("cli","content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),gk("cli",7);const t=SI();return t.length?t.forEach(r=>{Lr("cli",`!bookopen ${r.id};${r.name}`)}):wi("cli","no books found"),Lr("cli","!bookcreate;create a new book"),0}).command("pages",()=>{Fp("cli","pages");const n=om(Ho.MAIN);return fe(n)&&(Hr("cli","main",`${n.name} $GREEN${n.id}`),n.pages.length?n.pages.forEach(e=>{const t=tm(e),r=ET(e);Lr("cli",`!pageopen ${e.id};[${r}] ${t}`)}):(Lr("cli",""),wi("cli","no pages found"),wi("cli","use @ to create a page"),wi("cli","@board name of board"),wi("cli","@object name of object"),wi("cli","@terrain name of terrain"),wi("cli","You can omit the type and it will default to object"),wi("cli","@object name of object"),wi("cli","@name of object"))),0}).command("trash",()=>{Fp("cli","$REDTRASH"),wi("cli","books");const n=SI();n.length&&(n.forEach(t=>{Lr("cli",`!booktrash ${t.id};$REDTRASH ${t.name}`)}),Lr("cli",""));const e=CS(Ho.MAIN);return fe(e)&&(wi("cli",`pages in open ${e.name} book`),e.pages.forEach(t=>{const r=tm(t);Lr("cli",`!pagetrash ${t.id};$REDTRASH ${r}`)}),Lr("cli","")),0}).command("save",()=>(Sv(),0)).command("savewith",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]);return Sv(t),0}).command("nuke",()=>(cJ("cli",be.player),0)).command("joincode",()=>(e3("cli",be.player),0)).command("chat",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]);switch(Ur(t)){default:ZY("cli",t,be.player);break;case"close":eJ("cli",be.player);break}return 0}).command("broadcast",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]);switch(Ur(t)){default:JY("cli",t,be.player);break;case"stop":QY("cli",be.player);break}return 0});function Oye(n){const e=bV[n];if(fe(e))return e;const t=wV[n];if(fe(t))return t;const r=e1[n];if(fe(r))return r;const i=eV[n];if(fe(i))return i}const Nye=Rm({get(n,e){const t=Oye(e);return fe(t)?[!0,t]:[!1,void 0]}}),Pye=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),GU=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),Dye=["NORTH","SOUTH","WEST","EAST"];function Lye(n){const e=hE(n);if(En(e.inputcurrent)||(e.inputcurrent=0),ni(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[t]=e.inputqueue,[r=it.NONE,i=0]=t??[it.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&Jz?1:0,e.inputctrl=i&Qz?1:0,e.inputshift=i&Zz?1:0,r){case it.MOVE_UP:case it.MOVE_DOWN:case it.MOVE_LEFT:case it.MOVE_RIGHT:e.inputmove=[Dye[r-it.MOVE_UP]];break;case it.OK_BUTTON:e.inputok=1;break;case it.CANCEL_BUTTON:e.inputcancel=1;break;case it.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==it.NONE&&o!==r}),e}const Uye=Rm({get(n,e){var s,o;if(be.isplayer&&Pye.has(e)){const a=Lye(((s=be.element)==null?void 0:s.id)??"")[e];return[fe(a),a]}const t=(o=be.element)==null?void 0:o[e];if(fe(t)||GU.has(e))return[!0,t];const i=hE(be.player)[e];return[fe(i),i]},set(n,e,t){var s;const r=(s=be.element)==null?void 0:s[e];if(fe(r)||GU.has(e))return fe(be.element)&&(be.element[e]=t),[!0,t];const i=hE(be.player);return i[e]=t,[!0,t]},everytick(n){var e,t;(e=be.element)!=null&&e.headless&&n.command("die"),fe((t=be.element)==null?void 0:t.x)&&fe(be.element.y)&&fe(be.element.stepx)&&fe(be.element.stepy)&&jU(n,be.book,be.board,be.element,{x:be.element.x+be.element.stepx,y:be.element.y+be.element.stepy})===!1&&(be.element.stepx=0,be.element.stepy=0,Eye(be.book,be.element,"destructible")&&(be.element.headless=!0,gw(be.book,be.element,be.timestamp)))}}).command("become",(n,e)=>{var i,s;const t={x:((i=be.element)==null?void 0:i.x)??0,y:((s=be.element)==null?void 0:s.y)??0},[r]=Rt(e,0,[lt.KIND]);return fI(be.book,be.board),JC(be.book,be.board,be.element),gw(be.book,be.element,be.timestamp)&&pI(be.book,be.board,r,t),n.endofprogram(),0}).command("bind",()=>0).command("char",(n,e)=>{const[t]=Rt(e,0,[lt.NUMBER]);return fe(be.element)&&(be.element.char=t),0}).command("color",(n,e)=>{const[t]=Rt(e,0,[lt.COLOR]);return fe(be.element)&&fe(t)&&pw(be.element,t),0}).command("go",(n,e)=>{if(fe(be.element)){const[t]=Rt(e,0,[lt.DIR]);if(jU(n,be.book,be.board,be.element,t),n.yield(),be.element.x===t.x&&be.element.y===t.y)return 0}return 1}).command("try",(n,e)=>{const[,t]=Rt(e,0,[lt.DIR]);return n.command("go",...e)&&t<e.length&&n.command(...e.slice(t)),0}).command("walk",(n,e)=>{if(!fe(be.element))return 0;const[t]=Rt(e,0,[lt.DIR]),r=be.element.x??0,i=be.element.y??0;return be.element.stepx=t.x-r,be.element.stepy=t.y-i,0}),Fye=Rm().command("clear",(n,e)=>(e.forEach(t=>n.set(Pa(t),0)),0)).command("set",(n,e)=>{const[t,r]=Rt(e,0,[lt.NAME,lt.ANY]);return n.set(t,r),0}).command("take",(n,e)=>{const[t,r,i]=Rt(e,0,[lt.NAME,lt.MAYBE_NUMBER]),s=n.get(t),o=r??1;if(!En(s))return 1;const a=s-o;return a<0?(i<e.length&&n.command(...e.slice(i)),1):(n.set(t,a),0)}).command("give",(n,e)=>{const[t,r,i]=Rt(e,0,[lt.NAME,lt.MAYBE_NUMBER]),s=n.get(t),o=En(s)?s:0,a=r??1;if(!En(a))return 0;const c=s===void 0?1:0;return c&&i<e.length&&n.command(...e.slice(i)),n.set(t,o+a),c});var dj={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(n){(function(){var e=function(p,_){return _=_||"",p.replace(/(^|-)/g,"$1\\u"+_).replace(/,/g,"\\u"+_)},t=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),i="A-Z"+e("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(p,_,y,S){return p=p||t,_=_||r,y=y||i,S=S||s,{capitalize:new RegExp("(^|["+p+"])(["+_+"])","g"),pascal:new RegExp("(^|["+p+"])+(["+_+y+"])","g"),fill:new RegExp("["+p+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+_+"])","g"),improper:new RegExp("\\b("+S+")\\b","g"),relax:new RegExp("([^"+y+"])(["+y+"]*)(["+y+"])(?=[^"+y+"]|$)","g"),upper:new RegExp("^[^"+_+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+p+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(p){return c.up.call(p.charAt(0))+p.slice(1)},decap:function(p){return c.low.call(p.charAt(0))+p.slice(1)},deapostrophe:function(p){return p.replace(a.apostrophe,"")},fill:function(p,_,y){return _!=null&&(p=p.replace(a.fill,function(S,T){return T?_+T:""})),y&&(p=c.deapostrophe(p)),p},prep:function(p,_,y,S){if(p=p==null?"":p+"",!S&&a.upper.test(p)&&(p=c.low.call(p)),!_&&!a.hole.test(p)){var T=c.fill(p," ");a.hole.test(T)&&(p=T)}return!y&&!a.room.test(p)&&(p=p.replace(a.relax,c.relax)),p},relax:function(p,_,y,S){return _+" "+(y?y+" ":"")+S}},l={_:c,of:function(p){for(var _=0,y=c.types.length;_<y;_++)if(l[c.types[_]].apply(l,arguments)===p)return c.types[_]},flip:function(p){return p.replace(/\w/g,function(_){return(_==c.up.call(_)?c.low:c.up).call(_)})},random:function(p){return p.replace(/\w/g,function(_){return(Math.round(Math.random())?c.up:c.low).call(_)})},type:function(p,_){l[p]=_,c.types.push(p)}},u={lower:function(p,_,y){return c.fill(c.low.call(c.prep(p,_)),_,y)},snake:function(p){return l.lower(p,"_",!0)},constant:function(p){return l.upper(p,"_",!0)},camel:function(p){return c.decap(l.pascal(p))},kebab:function(p){return l.lower(p,"-",!0)},upper:function(p,_,y){return c.fill(c.up.call(c.prep(p,_,!1,!0)),_,y)},capital:function(p,_,y){return c.fill(c.prep(p).replace(a.capitalize,function(S,T,A){return T+c.up.call(A)}),_,y)},header:function(p){return l.capital(p,"-",!0)},pascal:function(p){return c.fill(c.prep(p,!1,!0).replace(a.pascal,function(_,y,S){return c.up.call(S)}),"",!0)},title:function(p){return l.capital(p).replace(a.improper,function(_,y,S,T){return S>0&&S<T.lastIndexOf(" ")?c.low.call(_):_})},sentence:function(p,_,y){return p=l.lower(p).replace(a.sentence,function(S,T,A){return T+c.up.call(A)}),_&&_.forEach(function(S){p=p.replace(new RegExp("\\b"+l.lower(S)+"\\b","g"),c.cap)}),y&&y.forEach(function(S){p=p.replace(new RegExp("(\\b"+l.lower(S)+"\\. +)(\\w)"),function(T,A,R){return A+c.low.call(R)})}),p}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(n.exports?n.exports=l:this.Case=l)}).call(Ng)})(dj);var Bye=dj.exports;const zye=Wl(Bye),Tg={};function fj(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function pj(n){n.text=[],Object.values(Tg[n.id]??{}).forEach(e=>e==null?void 0:e()),Tg[n.id]={}}function mj(n){const e=n.panels.find(t=>t.name===n.focus);if(!e){const t={id:_o(),name:n.focus,edge:vc.RIGHT,size:20,text:[]};return n.panels.push(t),n.reset=!1,t}return e}const Vye=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),jye=new Set(["rn","range","sl","select","nm","number","tx","text"]),Hye=new Set(["tx","text"]),Gye={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},mI={};let Wye=n=>{let e=mI[n];return fe(e)||(mI[n]=e=fj()),e};function QC(n){return Wye(n)}function $ye(n,e,t){Object.values(Tg).forEach(r=>{if(r[e]!==void 0){const i=$y(n.id(),e);En(t)&&Mg(i,t),vr(t)&&Ete(i,t)}})}function qye(n){let e="";const t=QC(n);return t.panels=t.panels.filter(r=>{if(r.edge===vc.SCROLL){const[i]=r.text;return vr(i)&&r.text.length===1&&(e=i),r.text.length>1}return!0}),e}function DR(n,e,t,r,i){const s=QC(n),o=r,a=i??zye.capital(e),c=s.panels.find(l=>l.name===a);if(c)s.reset=!0,s.focus=a,En(o)&&(c.size=o);else switch(t){case vc.START:{mI[n]=fj();break}case vc.LEFT:case vc.RIGHT:case vc.TOP:case vc.BOTTOM:case vc.SCROLL:{const l={id:_o(),name:a,edge:t,size:o??Hme[t],text:[]};s.panels.push(l),s.focus=a;break}}}function Xye(n,e){const t=QC(n),r=mj(t);t.reset&&(t.reset=!1,pj(r)),r.text.push(e)}function Kye(n,e,t,r,i){const s=QC(n),o=mj(s);s.reset&&(s.reset=!1,pj(o));const a=Ur(r),c=[e.id(),t,...Vye.has(a)?[a]:["hyperlink",r],...i],l=c[2];if(jye.has(l)){const u=`${c[3]??""}`;Tg[o.id]=Tg[o.id]??{};const h=e.get(u)??Gye[l];if(Tg[o.id][u]===void 0){const d=$y(e.id(),u);En(h)&&Ste(d,h),vr(h)&&k4(d,h),Hye.has(l)?Tg[o.id][u]=Tte(d,p=>{fe(p)&&p!==e.get(u)&&e.set(u,p)}):Tg[o.id][u]=bte(d,p=>{fe(p)&&p!==e.get(u)&&e.set(u,p)})}}o.text.push(c)}const Yye=Rm({get(){return[!1,void 0]},set(n,e,t){return $ye(n,e,t),[!1,void 0]},tick(){var e;const n=((e=be.element)==null?void 0:e.name)??"scroll";DR(be.player,"scroll",vc.SCROLL,void 0,n)},everytick(){const n=qye(be.player);if(n&&fe(be.element)){be.element.tickertext=n,be.element.tickertime=be.timestamp;const e=bye(be.book,be.element,1,Kr.WHITE,Kr.ONCLEAR);th(`$${Kr[e.color]}$${e.char}`,n)}}}).command("send",(n,e)=>{var u,h;const[t,r]=Rt(e,0,[lt.NAME,lt.ANY]),[i,s]=t.split(":"),o=fe(s)?i:"self",a=s??i;function c(d){d.forEach(p=>{fe(p.id)&&n.send(p.id,a,r)})}const l=Ur(o);switch(l){case"all":for(const d of Object.keys(((u=be.board)==null?void 0:u.objects)??{}))n.send(d,a,r);break;case"self":n.message({id:_o(),sender:n.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((h=be.board)==null?void 0:h.objects)??{}))d!==n.id()&&n.send(d,a,r);break;default:{c(NR(be.board,[o]));const d=n.get(l);ni(d)?c(NR(be.board,d)):c(NR(be.board,[d]));break}}return 0}).command("stat",(n,e)=>{const t=sj(e.map(Pa));switch(t.type){case An.OBJECT:fe(be.element)&&(be.element.name=t.values.join(" "));break}return 0}).command("text",(n,e)=>{const t=e.map(Pa).join("");return Xye(be.player,t),0}).command("hyperlink",(n,e)=>{const[t,r,...i]=e,s=Pa(t),o=Pa(r);return Kye(be.player,n,s,o,i),0}).command("gadget",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]),r=jme[Ur(t)];if(r===vc.SCROLL){const[i,s]=Rt(e,1,[lt.MAYBE_NAME,lt.MAYBE_NUMBER]);DR(be.player,t,r,s,i)}else if(fe(r)){const[i,s]=Rt(e,1,[lt.MAYBE_NUMBER,lt.MAYBE_NAME]);DR(be.player,t,r,i,s)}return 0}),Jye=Rm().command("idle",n=>(n.yield(),0)).command("end",n=>(n.endofprogram(),0)).command("endwith",(n,e)=>{const[t]=Rt(e,0,[lt.ANY]);return n.set("arg",t),n.command("end")}).command("lock",n=>(n.lock(n.id()),0)).command("restore",(n,e)=>(n.restore(Pa(e[0])),0)).command("unlock",n=>(n.unlock(),0)).command("zap",(n,e)=>(n.zap(Pa(e[0])),0)).command("cycle",(n,e)=>{if(fe(be.element)){const[t]=Rt(e,0,[lt.NUMBER]);be.element.cycle=Ii(Math.round(t),1,255)}return 0}).command("die",n=>{var e;return(e=be.element)!=null&&e.headless&&JC(be.book,be.board,be.element),gw(be.book,be.element,be.timestamp),n.endofprogram(),0}).command("endgame",()=>(bJ("element",be.player),0)).command("run",(n,e)=>{const[t]=Rt(e,0,[lt.NAME]);return yw(t),0}).command("runwith",(n,e)=>{const[t,r]=Rt(e,0,[lt.ANY,lt.NAME]);return n.set("arg",t),yw(r),0}),Qye={},Zye={};function eSe(n){return Qye[n]}function _w(n){return Zye[n]}function WU(n,e){if(!fe(n))return;const t=Ur(e),r=t.endsWith("le");switch(t){case"float32":case"float32le":{const i=n.dataview.getFloat32(n.cursor,r);return n.cursor+=4,i}case"float64":case"float64le":{const i=n.dataview.getFloat64(n.cursor,r);return n.cursor+=8,i}case"int8":case"int8le":{const i=n.dataview.getInt8(n.cursor);return n.cursor+=1,i}case"int16":case"int16le":{const i=n.dataview.getInt16(n.cursor,r);return n.cursor+=2,i}case"int32":case"int32le":{const i=n.dataview.getInt32(n.cursor,r);return n.cursor+=4,i}case"int64":case"int64le":{const i=n.dataview.getBigInt64(n.cursor,r);return n.cursor+=8,i}case"uint8":case"uint8le":{const i=n.dataview.getUint8(n.cursor);return n.cursor+=1,i}case"uint16":case"uint16le":{const i=n.dataview.getUint16(n.cursor,r);return n.cursor+=2,i}case"uint32":case"uint32le":{const i=n.dataview.getUint32(n.cursor,r);return n.cursor+=4,i}case"uint64":case"uint64le":{const i=n.dataview.getBigUint64(n.cursor,r);return n.cursor+=8,i}}}const tSe=(n,e)=>{const t=_w(n.id());if(!fe(t))return 0;const[r,i]=Rt(e,0,[lt.NAME]),s=Ur(r);switch(s){case"seek":{const[o]=Rt(e,i,[lt.NUMBER]);t.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Rt(e,i,[lt.NAME]);n.set(o,WU(t,s));break}case"text":{const[o,a]=Rt(e,i,[lt.NAME,lt.NAME]),c=WU(t,o);if(En(c)&&vr(a)){const l=new Uint8Array(t.bytes.buffer,t.cursor,c),h=new TextDecoder("utf-8").decode(l);n.set(a,h),t.cursor+=c}break}}return 0},nSe=(n,e)=>{const t=_w(n.id());if(!fe(t))return 0;const[r,i]=Rt(e,0,[lt.NAME]);switch(Ur(r)){case"seek":{const[o]=Rt(e,i,[lt.NUMBER]);t.cursor=Ii(o,0,t.lines.length-1);break}case"line":t.cursor=Ii(t.cursor+1,0,t.lines.length-1);break;default:{const o=t.lines[t.cursor]??"",c=new RegExp(r,"i").exec(o);if(fe(c)){let l=1;for(let u=i;u<e.length;){const[h,d]=Rt(e,u,[lt.NAME]);fe(c[l])&&n.set(h,c[l]),++l,u=d}}break}}return 0},rSe=Rm({get(n,e){switch(eSe(n.id())){case"chat":{const r=_w(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"binary":{const r=_w(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(n,e)=>{const[t,r]=Rt(e,0,[lt.NAME,lt.ANY]);return n.message({id:_o(),sender:n.id(),target:t,data:r}),0}).command("stat",()=>0).command("text",(n,e)=>{const t=e.map(Pa).join(" ");return th("$2",t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=Pa(t),s=r.map(Pa).join(" ");return th("$2",`!${s};${i}`),0}).command("load",(n,e)=>{const t=e.map(Pa).join(" "),r=n.get(t)??t;return om(Ho.CONTENT,r),0}).command("reload",(n,e)=>{const t=e.map(Pa).join(" "),r=n.get(t)??t,i=om(Ho.CONTENT,r);return i.pages=[],0}).command("bin",tSe).command("txt",nSe);var xN=(n=>(n[n.ERROR=0]="ERROR",n[n.CLI=1]="CLI",n[n.LOADER=2]="LOADER",n[n.CODE_PAGE=3]="CODE_PAGE",n))(xN||{});const iSe={audio:hye,board:Iye,cli:kye,const:Nye,element:Uye,flags:Fye,gadget:Yye,lifecycle:Jye,loader:rSe},LR=["const","flags","audio","board","lifecycle","element"],sSe={0:[],1:["cli",...LR],2:["loader",...LR],3:["gadget",...LR]},oSe={0:new Map,1:new Map,2:new Map,3:new Map};function fb(n){return(sSe[n]??[]).map(t=>iSe[t]).filter(fe)}function aSe(n,e){const t=oSe[n];if(!t.has(e)){let r;const i=fb(n);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!fe(r));++s);t.set(e,r)}return t.get(e)}function cSe(n,e,t){const r=fb(n);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,t);if(s)return[s,o]}return[!1,void 0]}function lSe(n,e,t,r){const i=fb(n);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,t,r);if(o)return[o,r]}return[!1,void 0]}function uSe(n,e){const t=fb(n);for(let r=0;r<t.length;++r)t[r].tick(e)}function $U(n,e){const t=fb(n);for(let r=0;r<t.length;++r)t[r].everytick(e)}var gj={},_j={},vj={};const qU="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");vj.encode=function(n){if(0<=n&&n<qU.length)return qU[n];throw new TypeError("Must be between 0 and 63: "+n)};const hSe=vj,yj=5,Sj=1<<yj,dSe=Sj-1,fSe=Sj;function pSe(n){return n<0?(-n<<1)+1:(n<<1)+0}_j.encode=function(e){let t="",r,i=pSe(e);do r=i&dSe,i>>>=yj,i>0&&(r|=fSe),t+=hSe.encode(r);while(i>0);return t};var pb={};(function(n){function e(D,L,z){if(L in D)return D[L];if(arguments.length===3)return z;throw new Error('"'+L+'" is a required argument.')}n.getArg=e;const t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(D){const L=D.match(t);return L?{scheme:L[1],auth:L[2],host:L[3],port:L[4],path:L[5]}:null}n.urlParse=i;function s(D){let L="";return D.scheme&&(L+=D.scheme+":"),L+="//",D.auth&&(L+=D.auth+"@"),D.host&&(L+=D.host),D.port&&(L+=":"+D.port),D.path&&(L+=D.path),L}n.urlGenerate=s;const o=32;function a(D){const L=[];return function(z){for(let V=0;V<L.length;V++)if(L[V].input===z){const W=L[0];return L[0]=L[V],L[V]=W,L[0].result}const F=D(z);return L.unshift({input:z,result:F}),L.length>o&&L.pop(),F}}const c=a(function(L){let z=L;const F=i(L);if(F){if(!F.path)return L;z=F.path}const V=n.isAbsolute(z),W=[];let X=0,$=0;for(;;)if(X=$,$=z.indexOf("/",X),$===-1){W.push(z.slice(X));break}else for(W.push(z.slice(X,$));$<z.length&&z[$]==="/";)$++;let K=0;for($=W.length-1;$>=0;$--){const te=W[$];te==="."?W.splice($,1):te===".."?K++:K>0&&(te===""?(W.splice($+1,K),K=0):(W.splice($,2),K--))}return z=W.join("/"),z===""&&(z=V?"/":"."),F?(F.path=z,s(F)):z});n.normalize=c;function l(D,L){D===""&&(D="."),L===""&&(L=".");const z=i(L),F=i(D);if(F&&(D=F.path||"/"),z&&!z.scheme)return F&&(z.scheme=F.scheme),s(z);if(z||L.match(r))return L;if(F&&!F.host&&!F.path)return F.host=L,s(F);const V=L.charAt(0)==="/"?L:c(D.replace(/\/+$/,"")+"/"+L);return F?(F.path=V,s(F)):V}n.join=l,n.isAbsolute=function(D){return D.charAt(0)==="/"||t.test(D)};function u(D,L){D===""&&(D="."),D=D.replace(/\/$/,"");let z=0;for(;L.indexOf(D+"/")!==0;){const F=D.lastIndexOf("/");if(F<0||(D=D.slice(0,F),D.match(/^([^\/]+:\/)?\/*$/)))return L;++z}return Array(z+1).join("../")+L.substr(D.length+1)}n.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(D){return D}function p(D){return y(D)?"$"+D:D}n.toSetString=h?d:p;function _(D){return y(D)?D.slice(1):D}n.fromSetString=h?d:_;function y(D){if(!D)return!1;const L=D.length;if(L<9||D.charCodeAt(L-1)!==95||D.charCodeAt(L-2)!==95||D.charCodeAt(L-3)!==111||D.charCodeAt(L-4)!==116||D.charCodeAt(L-5)!==111||D.charCodeAt(L-6)!==114||D.charCodeAt(L-7)!==112||D.charCodeAt(L-8)!==95||D.charCodeAt(L-9)!==95)return!1;for(let z=L-10;z>=0;z--)if(D.charCodeAt(z)!==36)return!1;return!0}function S(D,L,z){let F=A(D.source,L.source);return F!==0||(F=D.originalLine-L.originalLine,F!==0)||(F=D.originalColumn-L.originalColumn,F!==0||z)||(F=D.generatedColumn-L.generatedColumn,F!==0)||(F=D.generatedLine-L.generatedLine,F!==0)?F:A(D.name,L.name)}n.compareByOriginalPositions=S;function T(D,L,z){let F=D.generatedLine-L.generatedLine;return F!==0||(F=D.generatedColumn-L.generatedColumn,F!==0||z)||(F=A(D.source,L.source),F!==0)||(F=D.originalLine-L.originalLine,F!==0)||(F=D.originalColumn-L.originalColumn,F!==0)?F:A(D.name,L.name)}n.compareByGeneratedPositionsDeflated=T;function A(D,L){return D===L?0:D===null?1:L===null?-1:D>L?1:-1}function R(D,L){let z=D.generatedLine-L.generatedLine;return z!==0||(z=D.generatedColumn-L.generatedColumn,z!==0)||(z=A(D.source,L.source),z!==0)||(z=D.originalLine-L.originalLine,z!==0)||(z=D.originalColumn-L.originalColumn,z!==0)?z:A(D.name,L.name)}n.compareByGeneratedPositionsInflated=R;function I(D){return JSON.parse(D.replace(/^\)]}'[^\n]*\n/,""))}n.parseSourceMapInput=I;function U(D,L,z){if(L=L||"",D&&(D[D.length-1]!=="/"&&L[0]!=="/"&&(D+="/"),L=D+L),z){const F=i(z);if(!F)throw new Error("sourceMapURL could not be parsed");if(F.path){const V=F.path.lastIndexOf("/");V>=0&&(F.path=F.path.substring(0,V+1))}L=l(s(F),L)}return c(L)}n.computeSourceURL=U})(pb);var wN={};let mSe=class Ej{constructor(){this._array=[],this._set=new Map}static fromArray(e,t){const r=new Ej;for(let i=0,s=e.length;i<s;i++)r.add(e[i],t);return r}size(){return this._set.size}add(e,t){const r=this.has(e),i=this._array.length;(!r||t)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};wN.ArraySet=mSe;var bj={};const Tj=pb;function gSe(n,e){const t=n.generatedLine,r=e.generatedLine,i=n.generatedColumn,s=e.generatedColumn;return r>t||r==t&&s>=i||Tj.compareByGeneratedPositionsInflated(n,e)<=0}let _Se=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(e){gSe(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Tj.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};bj.MappingList=_Se;const dS=_j,Bo=pb,TT=wN.ArraySet,vSe=bj.MappingList;let xj=class wj{constructor(e){e||(e={}),this._file=Bo.getArg(e,"file",null),this._sourceRoot=Bo.getArg(e,"sourceRoot",null),this._skipValidation=Bo.getArg(e,"skipValidation",!1),this._sources=new TT,this._names=new TT,this._mappings=new vSe,this._sourcesContents=null}static fromSourceMap(e){const t=e.sourceRoot,r=new wj({file:e.file,sourceRoot:t});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,t!=null&&(s.source=Bo.relative(t,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;t!==null&&(s=Bo.relative(t,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const t=Bo.getArg(e,"generated"),r=Bo.getArg(e,"original",null);let i=Bo.getArg(e,"source",null),s=Bo.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,t){let r=e;this._sourceRoot!=null&&(r=Bo.relative(this._sourceRoot,r)),t!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Bo.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[Bo.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,t,r){let i=t;if(t==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=Bo.relative(s,i));const o=this._mappings.toArray().length>0?new TT:this._sources,a=new TT;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Bo.join(r,c.source)),s!=null&&(c.source=Bo.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=Bo.join(r,c)),s!=null&&(c=Bo.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,t,r,i){if(t&&typeof t.line!="number"&&typeof t.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:i}))}}_serializeMappings(){let e=0,t=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let p=0,_=d.length;p<_;p++){if(l=d[p],c="",l.generatedLine!==t)for(e=0;l.generatedLine!==t;)c+=";",t++;else if(p>0){if(!Bo.compareByGeneratedPositionsInflated(l,d[p-1]))continue;c+=","}c+=dS.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=dS.encode(h-o),o=h,c+=dS.encode(l.originalLine-1-i),i=l.originalLine-1,c+=dS.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=dS.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,t){return e.map(function(r){if(!this._sourcesContents)return null;t!=null&&(r=Bo.relative(t,r));const i=Bo.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};xj.prototype._version=3;gj.SourceMapGenerator=xj;var Cj={};(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,r,i,s,o,a){const c=Math.floor((r-t)/2)+t,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==n.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-t>1?e(t,c,i,s,o,a):a==n.LEAST_UPPER_BOUND?c:t<0?-1:t}n.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||n.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Cj);var xS={exports:{}};const ySe={},SSe=Object.freeze(Object.defineProperty({__proto__:null,default:ySe},Symbol.toStringTag,{value:"Module"})),XU=zG(SSe),ESe=(function(){return typeof window<"u"&&this===window}).call();if(ESe){let n=null;xS.exports=function(){if(typeof n=="string")return fetch(n).then(t=>t.arrayBuffer());if(n instanceof ArrayBuffer)return Promise.resolve(n);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},xS.exports.initialize=e=>n=e}else{const n=XU,e=XU;xS.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");n.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},xS.exports.initialize=t=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Rj=xS.exports;const bSe=Rj;function TSe(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let fS=null;var xSe=function(){if(fS)return fS;const e=[];return fS=bSe().then(t=>WebAssembly.instantiate(t,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const p=new TSe;p.generatedLine=r+1,p.generatedColumn=i,s&&(p.lastGeneratedColumn=o-1),a&&(p.source=c,p.originalLine=l+1,p.originalColumn=u,h&&(p.name=d)),e[e.length-1](p)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(t=>({exports:t.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,t=>{throw fS=null,t}),fS};const kn=pb,UR=Cj,vw=wN.ArraySet,wSe=Rj,CSe=xSe,CN=Symbol("smcInternal");class vo{constructor(e,t){return e==CN?Promise.resolve(this):ASe(e,t)}static initialize(e){wSe.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,t){return MSe(e,t)}static async with(e,t,r){const i=await new vo(e,t);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,t){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,t,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}vo.prototype._version=3;vo.GENERATED_ORDER=1;vo.ORIGINAL_ORDER=2;vo.GREATEST_LOWER_BOUND=1;vo.LEAST_UPPER_BOUND=2;class mb extends vo{constructor(e,t){return super(CN).then(r=>{let i=e;typeof e=="string"&&(i=kn.parseSourceMapInput(e));const s=kn.getArg(i,"version");let o=kn.getArg(i,"sources");const a=kn.getArg(i,"names",[]);let c=kn.getArg(i,"sourceRoot",null);const l=kn.getArg(i,"sourcesContent",null),u=kn.getArg(i,"mappings"),h=kn.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=kn.normalize(c)),o=o.map(String).map(kn.normalize).map(function(d){return c&&kn.isAbsolute(c)&&kn.isAbsolute(d)?kn.relative(c,d):d}),r._names=vw.fromArray(a.map(String),!0),r._sources=vw.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return kn.computeSourceURL(c,d,t)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=t,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,CSe().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let t=e;if(this.sourceRoot!=null&&(t=kn.relative(this.sourceRoot,t)),this._sources.has(t))return this._sources.indexOf(t);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,t){return new mb(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,t){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,t,r){const i=t||null,s=r||vo.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=kn.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case vo.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case vo.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let t=kn.getArg(e,"source");const r=kn.getArg(e,"line"),i=e.column||0;if(t=this._findSourceIndex(t),t<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),t,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const t={generatedLine:kn.getArg(e,"line"),generatedColumn:kn.getArg(e,"column")};if(t.generatedLine<1)throw new Error("Line numbers must be >= 1");if(t.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=kn.getArg(e,"bias",vo.GREATEST_LOWER_BOUND);r==null&&(r=vo.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),t.generatedLine-1,t.generatedColumn,r)}),i&&i.generatedLine===t.generatedLine){let s=kn.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=kn.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=kn.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:kn.getArg(i,"originalLine",null),column:kn.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,t){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=kn.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=kn.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(t)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let t=kn.getArg(e,"source");if(t=this._findSourceIndex(t),t<0)return{line:null,column:null,lastColumn:null};const r={source:t,originalLine:kn.getArg(e,"line"),originalColumn:kn.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=kn.getArg(e,"bias",vo.GREATEST_LOWER_BOUND);i==null&&(i=vo.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:kn.getArg(s,"generatedLine",null),column:kn.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}mb.prototype.consumer=vo;class RSe extends vo{constructor(e,t){return super(CN).then(r=>{let i=e;typeof e=="string"&&(i=kn.parseSourceMapInput(e));const s=kn.getArg(i,"version"),o=kn.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new vw,r._names=new vw,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=kn.getArg(c,"offset"),u=kn.getArg(l,"line"),h=kn.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new vo(kn.getArg(c,"map"),t).then(p=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:p}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(kn.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(kn.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let t=0;t<this._sections.length;t++)for(let r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}originalPositionFor(e){const t={generatedLine:kn.getArg(e,"line"),generatedColumn:kn.getArg(e,"column")},r=UR.search(t,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:t.generatedLine-(i.generatedOffset.generatedLine-1),column:t.generatedColumn-(i.generatedOffset.generatedLine===t.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,t){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let t=0;t<this._sections.length;t++){const r=this._sections[t];if(r.consumer._findSourceIndex(kn.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,t){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=kn.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,t,r){const i=t||null,s=r||vo.GENERATED_ORDER;let o;switch(s){case vo.GENERATED_ORDER:o=this._generatedMappings;break;case vo.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=kn.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,t,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return UR.search(e,t,s,o)}allGeneratedPositionsFor(e){const t=kn.getArg(e,"line"),r={source:kn.getArg(e,"source"),originalLine:t,originalColumn:kn.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",kn.compareByOriginalPositions,UR.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kn.getArg(o,"generatedLine",null),column:kn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===t&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:kn.getArg(o,"generatedLine",null),column:kn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function ASe(n,e){let t=n;typeof n=="string"&&(t=kn.parseSourceMapInput(n));const r=t.sections!=null?new RSe(t,e):new mb(t,e);return Promise.resolve(r)}function MSe(n,e){return mb.fromSourceMap(n,e)}var Aj={};const ISe=gj.SourceMapGenerator,xT=pb,kSe=/(\r?\n)/,OSe=10,Ev="$$$isSourceNode$$$";let NSe=class gI{constructor(e,t,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=t??null,this.source=r??null,this.name=s??null,this[Ev]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,t,r){const i=new gI,s=e.split(kSe);let o=0;const a=function(){const p=y(),_=y()||"";return p+_;function y(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return t.eachMapping(function(p){if(u!==null)if(c<p.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const _=h.substr(0,p.generatedColumn-l);s[o]=h.substr(p.generatedColumn-l),l=p.generatedColumn,d(u,_),u=p;return}for(;c<p.generatedLine;)i.add(a()),c++;l<p.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,p.generatedColumn)),s[o]=h.substr(p.generatedColumn),l=p.generatedColumn),u=p},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),t.sources.forEach(function(p){const _=t.sourceContentFor(p);_!=null&&(r!=null&&(p=xT.join(r,p)),i.setSourceContent(p,_))}),i;function d(p,_){if(p===null||p.source===void 0)i.add(_);else{const y=r?xT.join(r,p.source):p.source;i.add(new gI(p.originalLine,p.originalColumn,y,_,p.name))}}}add(e){if(Array.isArray(e))e.forEach(function(t){this.add(t)},this);else if(e[Ev]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else if(e[Ev]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let t;for(let r=0,i=this.children.length;r<i;r++)t=this.children[r],t[Ev]?t.walk(e):t!==""&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const i=this.children.length;if(i>0){for(t=[],r=0;r<i-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[Ev]?r.replaceRight(e,t):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,t){this.sourceContents[xT.toSetString(e)]=t}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][Ev]&&this.children[r].walkSourceContents(e);const t=Object.keys(this.sourceContents);for(let r=0,i=t.length;r<i;r++)e(xT.fromSetString(t[r]),this.sourceContents[t[r]])}toString(){let e="";return this.walk(function(t){e+=t}),e}toStringWithSourceMap(e){const t={code:"",line:1,column:0},r=new ISe(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){t.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:t.line,column:t.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===OSe?(t.line++,t.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name})):t.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:t.code,map:r}}};Aj.SourceNode=NSe;var PSe=Aj.SourceNode;let KU=0;const YU=kf,DSe=["Command","lines"];class LSe extends Eve{constructor(){super(rj,{traceInitPerf:kf,skipValidations:!kf,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Dn(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Dn(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(uE)}])}));Dn(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Dn(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Dn(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Dn(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(IV)}));Dn(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(SN)}));Dn(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(AV)}])}));Dn(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(MV)}));Dn(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(kV),this.SUBRULE(this.words),this.CONSUME(OV)}));Dn(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Av),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Dn(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Dn(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Dn(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_debugger)},{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Dn(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(cI),this.SUBRULE(this.words)}));Dn(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(WV),this.SUBRULE(this.words)}));Dn(this,"command_debugger",this.RULED("command_debugger",()=>{this.CONSUME(KV)}));Dn(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(lI),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Dn(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ux),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(uE)),this.CONSUME4(Av),this.CONSUME4(uI)}}])}));Dn(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ux),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Av),this.CONSUME(uI)}}])}));Dn(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ux),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Dn(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Av),this.CONSUME(hI),this.CONSUME(lI),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Dn(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Av),this.CONSUME(hI),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Dn(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(YV),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Dn(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(JV),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Dn(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(QV),this.SUBRULE(this.words)}));Dn(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(ZV),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Dn(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ej)}));Dn(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(tj)}));Dn(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(XV)}));Dn(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(rI),this.SUBRULE2(this.and_test)})}));Dn(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(sI),this.SUBRULE2(this.not_test)})}));Dn(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(iI),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Dn(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Dn(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(DV)},{ALT:()=>this.CONSUME(LV)},{ALT:()=>this.CONSUME(UV)},{ALT:()=>this.CONSUME(FV)},{ALT:()=>this.CONSUME(BV)},{ALT:()=>this.CONSUME(zV)}])}));Dn(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(rI),this.SUBRULE2(this.and_test_value)})}));Dn(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(sI),this.SUBRULE2(this.not_test_value)})}));Dn(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(iI),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Dn(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Dn(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(oI)},{ALT:()=>this.CONSUME(aI)}]),this.SUBRULE(this.term)}));Dn(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Dn(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(jV)},{ALT:()=>this.CONSUME(cI)},{ALT:()=>this.CONSUME(HV)},{ALT:()=>this.CONSUME(GV)}]),this.SUBRULE(this.factor)}));Dn(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(oI)},{ALT:()=>this.CONSUME(aI)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Dn(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(VV),this.SUBRULE(this.factor)})}));Dn(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Dn(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(NV)},{ALT:()=>this.CONSUME(rl)},{ALT:()=>this.CONSUME(PV)},{ALT:()=>{this.CONSUME($V),this.SUBRULE(this.expr),this.CONSUME(qV)}}])}));this.performSelfAnalysis()}PEEK(t,r,...i){console.info(t,i.map(s=>[s.image,s.tokenType]),r)}RULED(t,r,i){const s=DSe.some(o=>t.includes(o));return this.RULE(t,()=>{const a=(KU++).toString().padStart(3),c=s?"font-weight: bold;":"";if(YU&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${t} ${l.join(" ")}`,c)}r(),YU&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${t} `,c),KU--},i)}}const Bv=new LSe;if(Gme){const n=Bv.getGAstProductions(),e=Nve(n);console.info(e)}const USe=Bv.getBaseCstVisitorConstructor();var Jt=(n=>(n[n.PROGRAM=0]="PROGRAM",n[n.API=1]="API",n[n.LINE=2]="LINE",n[n.MARK=3]="MARK",n[n.GOTO=4]="GOTO",n[n.COUNT=5]="COUNT",n[n.TEXT=6]="TEXT",n[n.LABEL=7]="LABEL",n[n.HYPERLINK=8]="HYPERLINK",n[n.STAT=9]="STAT",n[n.MOVE=10]="MOVE",n[n.COMMAND=11]="COMMAND",n[n.LITERAL=12]="LITERAL",n[n.IF=13]="IF",n[n.IF_CHECK=14]="IF_CHECK",n[n.IF_BLOCK=15]="IF_BLOCK",n[n.ELSE_IF=16]="ELSE_IF",n[n.ELSE=17]="ELSE",n[n.WHILE=18]="WHILE",n[n.BREAK=19]="BREAK",n[n.CONTINUE=20]="CONTINUE",n[n.REPEAT=21]="REPEAT",n[n.WAITFOR=22]="WAITFOR",n[n.FOREACH=23]="FOREACH",n[n.OR=24]="OR",n[n.AND=25]="AND",n[n.NOT=26]="NOT",n[n.COMPARE=27]="COMPARE",n[n.COMPARE_ITEM=28]="COMPARE_ITEM",n[n.OPERATOR=29]="OPERATOR",n[n.OPERATOR_ITEM=30]="OPERATOR_ITEM",n[n.EXPR=31]="EXPR",n))(Jt||{}),V0=(n=>(n[n.IS_EQ=0]="IS_EQ",n[n.IS_NOT_EQ=1]="IS_NOT_EQ",n[n.IS_LESS_THAN=2]="IS_LESS_THAN",n[n.IS_GREATER_THAN=3]="IS_GREATER_THAN",n[n.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",n[n.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",n))(V0||{}),Jd=(n=>(n[n.EMPTY=0]="EMPTY",n[n.PLUS=1]="PLUS",n[n.MINUS=2]="MINUS",n[n.POWER=3]="POWER",n[n.MULTIPLY=4]="MULTIPLY",n[n.DIVIDE=5]="DIVIDE",n[n.MOD_DIVIDE=6]="MOD_DIVIDE",n[n.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",n[n.UNI_PLUS=8]="UNI_PLUS",n[n.UNI_MINUS=9]="UNI_MINUS",n))(Jd||{}),hx=(n=>(n[n.NUMBER=0]="NUMBER",n[n.STRING=1]="STRING",n[n.TEMPLATE=2]="TEMPLATE",n))(hx||{});function FSe(n){return!!(n!=null&&n.tokenType)}function Hp(n,e){const[t]=n??[];return((t==null?void 0:t.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class BSe extends USe{constructor(){super();Dn(this,"unique",0);kf&&this.validateVisitor()}getnodelocation(t){const r=Object.values(t).flat().filter(i=>!!i).map(i=>i&&FSe(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(t,r){return[{...r,...this.getnodelocation(t),lineindex:0}]}createstringnode(t,r){return this.createcodenode(t,{type:12,literal:1,value:r})}createmarknode(t,r,i){return this.createlinenode(t,this.createcodenode(t,{type:3,id:r,comment:i}))}creategotonode(t,r,i){return this.createlinenode(t,this.createcodenode(t,{type:4,id:r,comment:i}))}createlinenode(t,r){return this.createcodenode(t,{type:2,stmts:r})}createapinode(t,r,i){return this.createlinenode(t,this.createcodenode(t,{type:1,words:i,method:r}))}createlogicnode(t,r,i,s){return this.createlinenode(t,this.createcodenode(t,{type:14,skip:i,words:s,method:r}))}createcountnode(t){return this.createcodenode(t,{type:5,index:this.unique++})}go(t){return Array.isArray(t)?t.map(r=>this.visit(r)).flat():fe(t)?[this.visit(t)].flat():[]}program(t){return this.unique=0,this.createcodenode(t,{type:0,lines:[this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:"restart"})),this.go(t.line)].flat()})}line(t){return t.stmt?this.go(t.stmt):[]}stmt(t){return t.stmt_label?this.go(t.stmt_label):t.stmt_stat?this.go(t.stmt_stat):t.stmt_text?this.go(t.stmt_text):t.stmt_comment?this.go(t.stmt_comment):t.stmt_command?this.go(t.stmt_command):t.stmt_hyperlink?this.go(t.stmt_hyperlink):t.short_commands?[this.go(t.short_commands),this.go(t.commands)].flat():[]}inline(t){return this.go(t.instmt)}instmt(t){return t.stmt_label?this.go(t.stmt_label):t.stmt_stat?this.go(t.stmt_stat):t.stmt_text?this.go(t.stmt_text):t.stmt_comment?this.go(t.stmt_comment):t.stmt_command?this.go(t.stmt_command):t.stmt_hyperlink?this.go(t.stmt_hyperlink):t.commands?this.go(t.commands):[]}stmt_label(t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:Hp(t.token_label,":").slice(1).trim()}))}stmt_stat(t){return this.createlinenode(t,this.createcodenode(t,{type:9,value:Hp(t.token_stat,"@").slice(1)}))}stmt_text(t){return this.createlinenode(t,this.createcodenode(t,{type:6,value:Hp(t.token_text,"")}))}stmt_comment(t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!1,name:Hp(t.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(t){return this.createlinenode(t,this.createcodenode(t,{type:8,link:this.go(t.words),text:Hp(t.token_hyperlinktext,";").slice(1)}))}stmt_command(t){return t.commands?this.go(t.commands):[]}short_commands(t){return t.short_go?this.go(t.short_go):t.short_try?this.go(t.short_try):[]}commands(t){return t.words?this.createlinenode(t,this.createcodenode(t,{type:11,words:this.go(t.words)})):t.short_go?this.go(t.short_go):t.short_try?this.go(t.short_try):t.command_play?this.go(t.command_play):t.structured_cmd?this.go(t.structured_cmd):[]}structured_cmd(t){return t.command_if?this.go(t.command_if):t.command_while?this.go(t.command_while):t.command_repeat?this.go(t.command_repeat):t.command_waitfor?this.go(t.command_waitfor):t.command_foreach?this.go(t.command_foreach):t.command_break?this.go(t.command_break):t.command_continue?this.go(t.command_continue):[]}short_go(t){return t.token_divide?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!0,words:this.go(t.words)})):[]}short_try(t){return t.token_query?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!1,words:this.go(t.words)})):[]}command_if(t){const[r]=this.createlogicnode(t,"if","",this.go(t.words)),[i]=this.go(t.command_if_block)??[];return this.createcodenode(t,{type:13,check:r,block:i})}command_if_block(t){const r=_o(),i=_o();return this.createcodenode(t,{type:15,skip:r,done:i,lines:[this.go(t.inline),this.go(t.line),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"alt logic")].flat(),altlines:[this.go(t.command_else_if),this.go(t.command_else),this.createmarknode(t,i,"end of if")].flat()})}command_block(t){return[this.go(t.inline),this.go(t.line)].flat()}command_fork(t){return[this.go(t.inline),this.go(t.line)].flat()}command_else_if(t){const r=_o(),i=_o();return this.createcodenode(t,{type:16,done:i,lines:[this.createlogicnode(t,"if",r,this.go(t.words)),this.go(t.command_fork),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"skip")].flat()})}command_else(t){return this.createcodenode(t,{type:17,lines:this.go(t.command_fork)})}command_while(t){const r=_o(),i=_o();return this.createcodenode(t,{type:18,loop:r,done:i,lines:[this.createmarknode(t,r,"start of while"),this.createlogicnode(t,"if",i,this.go(t.words)),this.go(t.command_block),this.creategotonode(t,r,"loop of while"),this.createmarknode(t,i,"end of while")].flat()})}command_repeat(t){const r=_o(),i=_o(),o=[this.createcountnode(t),this.go(t.words)].flat();return this.createcodenode(t,{type:21,loop:r,done:i,lines:[this.createapinode(t,"repeatstart",o),this.createmarknode(t,r,"start of repeat"),this.createlogicnode(t,"repeat",i,o),this.go(t.command_block),this.creategotonode(t,r,"loop of repeat"),this.createmarknode(t,i,"end of repeat")].flat()})}command_foreach(t){const r=_o(),i=_o(),o=[this.createcountnode(t),this.go(t.words)].flat();return this.createcodenode(t,{type:23,loop:r,done:i,lines:[this.createapinode(t,"foreachstart",o),this.createmarknode(t,r,"start of foreach"),this.createlogicnode(t,"foreach",i,o),this.go(t.command_block),this.creategotonode(t,r,"loop of foreach"),this.createmarknode(t,i,"end of foreach")].flat()})}command_waitfor(t){return this.createcodenode(t,{type:22,words:this.go(t.words)})}command_break(t){return this.createcodenode(t,{type:19,goto:0})}command_continue(t){return this.createcodenode(t,{type:20,goto:0})}command_play(t){const r=Hp(t.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(t,this.createcodenode(t,{type:11,words:[this.createstringnode(t,s?"bgplay":"play"),this.createstringnode(t,i)].flat()}))}expr(t){return t.and_test.length===1?this.go(t.and_test):this.createcodenode(t,{type:24,items:this.go(t.and_test)})}and_test(t){return t.not_test.length===1?this.go(t.not_test):this.createcodenode(t,{type:25,items:this.go(t.not_test)})}not_test(t){return t.comparison?this.go(t.comparison):t.not_test?this.createcodenode(t,{type:26,items:this.go(t.not_test)}):[]}comparison(t){if(t.arith_expr.length===1)return this.go(t.arith_expr);const[r,i]=this.go(t.arith_expr),[s]=this.go(t.comp_op);return this.createcodenode(t,{type:27,lhs:r,compare:s,rhs:i})}comp_op(t){return t.token_iseq?this.createcodenode(t,{type:28,method:0}):t.token_isnoteq?this.createcodenode(t,{type:28,method:1}):t.token_islessthan?this.createcodenode(t,{type:28,method:2}):t.token_isgreaterthan?this.createcodenode(t,{type:28,method:3}):t.token_isgreaterthanorequal?this.createcodenode(t,{type:28,method:4}):t.token_isgreaterthanorequal?this.createcodenode(t,{type:28,method:5}):[]}expr_value(t){return t.and_test_value.length===1?this.go(t.and_test_value):this.createcodenode(t,{type:24,items:this.go(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.go(t.not_test_value):this.createcodenode(t,{type:25,items:this.go(t.not_test_value)})}not_test_value(t){return t.arith_expr?this.go(t.arith_expr):t.not_test_value?this.createcodenode(t,{type:26,items:this.go(t.not_test_value)}):[]}arith_expr(t){const r=this.go(t.term);return t.arith_expr_item?this.createcodenode(t,{type:29,lhs:r[0],items:this.go(t.arith_expr_item)}):r}arith_expr_item(t){return this.createcodenode(t,{type:30,operator:t.token_plus?1:2,rhs:this.go(t.term)[0]})}term(t){return t.term_item?this.createcodenode(t,{type:29,lhs:this.go(t.factor)[0],items:this.go(t.term_item)}):this.go(t.factor)}term_item(t){let r=0;return t.token_multiply&&(r=4),t.token_divide&&(r=5),t.token_moddivide&&(r=6),t.token_floordivide&&(r=7),this.createcodenode(t,{type:30,operator:r,rhs:this.go(t.factor)[0]})}factor(t){if(t.power)return this.go(t.power);let r=0;return t.token_plus&&(r=8),t.token_minus&&(r=9),this.createcodenode(t,{type:29,lhs:void 0,items:this.createcodenode(t,{type:30,operator:r,rhs:this.go(t.factor)[0]})})}power(t){const r=this.go(t.token);return t.factor?this.createcodenode(t,{type:29,lhs:r[0],items:this.createcodenode(t,{type:30,operator:3,rhs:this.go(t.factor)[0]})}):r}words(t){return this.go(t.expr)}token(t){if(t.token_stringliteraldouble){const r=Hp(t.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(t.token_stringliteral){const r=Hp(t.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(t.token_numberliteral){const r=parseFloat(Hp(t.token_numberliteral,"0"));return this.createcodenode(t,{type:12,literal:0,value:r})}return t.token_lparen?this.createcodenode(t,{type:31,words:this.go(t.expr)}):[]}}const zSe=new BSe,Ml={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},ZC="zss.js";function ai(n,e){return new PSe(n.startLine??1,n.startColumn??1,ZC,e)}function _I(n){return n.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function FR(n){return`'${_I(n)}'`}function dx(n){if(n.startsWith('"'))return dx(n.replaceAll(/(^"|"$)/g,""));const e=t1(n);return e.errors.length?n:`['${e.tokens.map(r=>r.tokenType===kN?`', api.get('${_I(r.image.substring(1))}'), '`:_I(r.image)).join("")}'].join('')`}function P0(n){return n.filter(e=>e!==void 0).map(Mi)}function JU(n){return ai(n,"")}function VSe(n,e){const t=[];return n.forEach(r=>{t.push(r,e)}),t.pop(),t}function Wo(n,e,t){return ai(n,[`api.${e}(`,...VSe(t,", "),")"])}function jSe(n){if(n.type===Jt.COMPARE&&n.compare.type===Jt.COMPARE_ITEM)switch(n.compare.method){case V0.IS_EQ:return Wo(n,"isEq",[Mi(n.lhs),Mi(n.rhs)]);case V0.IS_NOT_EQ:return Wo(n,"isNotEq",[Mi(n.lhs),Mi(n.rhs)]);case V0.IS_LESS_THAN:return Wo(n,"isLessThan",[Mi(n.lhs),Mi(n.rhs)]);case V0.IS_GREATER_THAN:return Wo(n,"isGreaterThan",[Mi(n.lhs),Mi(n.rhs)]);case V0.IS_LESS_THAN_OR_EQ:return Wo(n,"isLessThanOrEq",[Mi(n.lhs),Mi(n.rhs)]);case V0.IS_GREATER_THAN_OR_EQ:return Wo(n,"isGreaterThanOrEq",[Mi(n.lhs),Mi(n.rhs)])}return ai(n,"")}function D0(n,e,t){return n.prepend(`api.${e}(`),n.add([", ",Mi(t),")"])}function QU(n,e,t){return n.prepend(`api.${e}(`),n.add([Mi(t),")"])}function HSe(n,e){if(n.type===Jt.OPERATOR_ITEM)switch(n.operator){case Jd.PLUS:return D0(e,"opPlus",n.rhs);case Jd.MINUS:return D0(e,"opMinus",n.rhs);case Jd.POWER:return D0(e,"opPower",n.rhs);case Jd.MULTIPLY:return D0(e,"opMultiply",n.rhs);case Jd.DIVIDE:return D0(e,"opDivide",n.rhs);case Jd.MOD_DIVIDE:return D0(e,"opModDivide",n.rhs);case Jd.FLOOR_DIVIDE:return D0(e,"opFloorDivide",n.rhs);case Jd.UNI_PLUS:return QU(e,"opUniPlus",n.rhs);case Jd.UNI_MINUS:return QU(e,"opUniMinus",n.rhs)}return ai(n,"")}function GSe(n){if(n.type===Jt.OPERATOR){const e=n.lhs?Mi(n.lhs):ai(n,"");return n.items.forEach(t=>HSe(t,e)),e}return ai(n,"")}function wT(n,e){return ai(n,[Wo(n,"jump",[`${e}`]),"; continue;"])}function Gp(n){return Ml.linelookup[n??""]??-1}function vI(n,e){Ml.linelookup[n]=e}function wS(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Jt.WHILE:case Jt.REPEAT:case Jt.FOREACH:case Jt.ELSE_IF:i.type===e&&(i.done=t);break;case Jt.IF_BLOCK:case Jt.IF_CHECK:i.type===e&&(i.skip=t);break;case Jt.LINE:wS(i.stmts,e,t);break}}}function Mj(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Jt.WHILE:case Jt.REPEAT:case Jt.FOREACH:case Jt.ELSE_IF:i.type===e&&vI(i.done,t);break;case Jt.IF_BLOCK:case Jt.IF_CHECK:i.type===e&&vI(i.skip,t);break;case Jt.LINE:Mj(i.stmts,e,t);break}}}function Mi(n){var e;switch(n.type){case Jt.PROGRAM:return ai(n,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...n.lines.map(Mi).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${ZC}`]);case Jt.API:return ai(n,["  ",Wo(n,n.method,P0(n.words)),`;
`]);case Jt.LINE:return ai(n,[`case ${n.lineindex}:
`,...n.stmts.map(Mi).flat(),`  break;
`]);case Jt.MARK:return ai(n,`  // ${n.comment}
`);case Jt.GOTO:{const t=Gp(n.id);return ai(n,["  ",wT(n,t),`
`])}case Jt.COUNT:return ai(n,`${n.index}`);case Jt.LITERAL:switch(n.literal){case hx.NUMBER:return ai(n,`${n.value}`);case hx.STRING:return ai(n,FR(n.value));case hx.TEMPLATE:return ai(n,dx(n.value))}return JU(n);case Jt.TEXT:return ai(n,["  ",Wo(n,"text",[dx(n.value)]),`;
`]);case Jt.STAT:if(Ml.isfirststat){Ml.isfirststat=!1;const t=n.value.trim().split(" ").map(FR);return ai(n,["  ",Wo(n,"stat",t),`;
`])}return ai(n,`  // skipped ${n.value}
`);case Jt.LABEL:{const t=Ur(n.name),r=n.active?"label":"comment";Ml.labels[t]||(Ml.labels[t]=[]);const i=(n.active?1:-1)*n.lineindex;return Ml.labels[t].push(i),ai(n,`  // ${i} '${t}' ${r}
`)}case Jt.HYPERLINK:return ai(n,["  ",Wo(n,"hyperlink",[dx(n.text),...P0(n.link)]),`;
`]);case Jt.MOVE:{const t=Wo(n,"command",[FR("go"),P0(n.words)].flat());return n.wait?ai(n,["  if (",t,`) { continue; };
`]):ai(n,["  ",t,`;
`])}case Jt.COMMAND:return ai(n,["  ",Wo(n,"command",P0(n.words)),`;
`]);case Jt.IF:{const t=((e=n.block)==null?void 0:e.type)===Jt.IF_BLOCK?n.block:void 0;if(fe(t)){wS([n.check],Jt.IF_CHECK,t.skip);const r=ai(n,Mi(n.check));return t.lines.forEach(i=>r.add(Mi(i))),Mj(t.altlines,Jt.ELSE_IF,Gp(t.done)),t.altlines.forEach(i=>r.add(Mi(i))),r}return ai(n,Mi(n.check))}case Jt.IF_CHECK:{const t=Gp(n.skip);return t===-1?ai(n,["  ",Wo(n,n.method,P0(n.words)),`;
`]):ai(n,["  if (!",Wo(n,n.method,P0(n.words)),") { ",wT(n,t),` }
`])}case Jt.ELSE_IF:case Jt.ELSE:{const t=ai(n,"");return n.lines.forEach(r=>t.add(Mi(r))),t}case Jt.WHILE:{const t=Gp(n.loop),r=Gp(n.done),i=ai(n,"");return wS(n.lines,Jt.IF_CHECK,n.done),n.lines.forEach(s=>{switch(s.type){case Jt.BREAK:s.goto=r;break;case Jt.CONTINUE:s.goto=t;break}i.add(Mi(s))}),i}case Jt.REPEAT:{const t=Gp(n.loop),r=Gp(n.done),i=ai(n,"");return wS(n.lines,Jt.IF_CHECK,n.done),n.lines.forEach(s=>{switch(s.type){case Jt.BREAK:s.goto=r;break;case Jt.CONTINUE:s.goto=t;break}i.add(Mi(s))}),i}case Jt.WAITFOR:{const t=ai(n,"");return t.add(["  if (!",Wo(n,"if",P0(n.words)),`) { api.i(${n.lineindex-1}); }
`]),t}case Jt.FOREACH:{const t=Gp(n.loop),r=Gp(n.done),i=ai(n,"");return wS(n.lines,Jt.IF_CHECK,n.done),n.lines.forEach(s=>{switch(s.type){case Jt.BREAK:s.goto=r;break;case Jt.CONTINUE:s.goto=t;break}i.add(Mi(s))}),i}case Jt.BREAK:return ai(n,["  ",wT(n,n.goto),`
`]);case Jt.CONTINUE:return ai(n,["  ",wT(n,n.goto),`
`]);case Jt.OR:return Wo(n,"or",n.items.map(Mi));case Jt.AND:return Wo(n,"and",n.items.map(Mi));case Jt.NOT:return Wo(n,"not",n.items.map(Mi));case Jt.COMPARE:return jSe(n);case Jt.OPERATOR:return GSe(n);case Jt.EXPR:return Wo(n,"expr",n.words.map(Mi));default:return console.error("<unsupported node>",n.type,n),JU(n)}}function Qd(n){if(fe(n))switch(n.type===Jt.LINE&&++Ml.lineindex,n.lineindex=Ml.lineindex,n.type){case Jt.PROGRAM:n.lines.forEach(Qd);break;case Jt.LINE:n.stmts.forEach(Qd);break;case Jt.MARK:vI(n.id,n.lineindex);break;case Jt.IF:Qd(n.check),Qd(n.block);break;case Jt.IF_BLOCK:n.lines.forEach(Qd),n.altlines.forEach(Qd);break;case Jt.ELSE_IF:n.lines.forEach(Qd);break;case Jt.ELSE:case Jt.WHILE:case Jt.REPEAT:case Jt.FOREACH:n.lines.forEach(Qd);break;case Jt.MOVE:case Jt.COMMAND:case Jt.WAITFOR:case Jt.IF_CHECK:n.words.forEach(Qd);break}}function WSe(n){return Ml.labels={},Ml.internal=1,Ml.lineindex=0,Ml.isfirststat=!0,Qd(n),{...Mi(n).toStringWithSourceMap({file:`${ZC}.map`}),...Ml}}function $Se(n){return ni(n)?n.length>0?1:0:n??0}function Pa(n){return`${n??""}`}function qSe(n){return`${n}_chip`}function XSe(n,e,t){var c,l;const r=qSe(n),i=hE(r);let s;ni(i.lb)||(i.lb=Uy(Object.entries(t.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=t.errors)==null?void 0:c.length)??0)!==0?1:0);function o(u,h){be.words=h;const d=aSe(e,u);return fe(d)?d(a,h):u!=="send"?o("send",[u,...h]):0}const a={halt(){eEe(r)},id(){return n},senderid(u=n){return`vm:${u??n}`},set(u,h){const[d,p]=lSe(e,a,u,h);if(d)return p},get(u){const[h,d]=cSe(e,a,u);if(h)return d},bucket(u){const h=a.get("bucket");ni(h)?h.push(u):a.set("bucket",[u])},tick(u){const h=En(i.ps)?i.ps:0,d=h%u===0;if(i.ps=h+1,d===!1)return!1;if(a.shouldtick()===!1)return $U(e,a),!1;i.lc=0,i.ys=0,be.get=a.get,uSe(e,a);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ti("chip","crash",p.message),i.es=1}return $U(e,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return En(i.lc)?++i.lc>mi.HALT_AT_COUNT:!0},hm(){if(ni(i.mg)&&ni(i.lb)){const[,u]=i.mg;if(fe(u))for(let h=0;h<i.lb.length;++h){const[d,p]=i.lb[h];if(d===u)return p.find(_=>En(_)&&_>0)??0}}return 0},yield(){i.ys=1},jump(u){i.ec=u},sy(){return!!i.ys||a.shouldhalt()},emit(u,h,d){Vn.emit(u,a.senderid(),h,d)},send(u,h,d,p){Vn.emit(`${a.senderid(u)}:${h}`,n,d,p)},lock(u){i.lk=u},unlock(){i.lk=""},message(u){i.lk&&u.sender!==i.lk||(i.mg=[u.id,u.target,u.data,u.sender,u.player])},zap(u){if(ni(i.lb))for(let h=0;h<i.lb.length;++h){const[d,p]=i.lb[h];if(d===u){const _=p.findIndex(y=>y>0);_>=0&&(p[_]*=-1)}}},restore(u){if(ni(i.lb))for(let h=0;h<i.lb.length;++h){const[d,p]=i.lb[h];if(d===u)for(let _=0;_<p.length;_++)p[h]=Math.abs(p[h])}},getcase(){i.ec=En(i.ec)?i.ec:1;const u=a.hm();if(u&&ni(i.mg)){const[,,h,d,p]=i.mg;a.set("sender",d),fe(h)&&a.set("arg",h),p&&a.set("player",p),i.mg=void 0,i.ys=0,i.es=0,i.ec=u}return i.ec},nextcase(){const u=En(i.ec)?i.ec:1;return i.ec=u+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(u){const h=Lve.parse(u),[d]=h.filter(p=>p.fileName===ZC);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(u){return o("text",[u])},stat(...u){return o("stat",u)},hyperlink(...u){return o("hyperlink",u)},command(...u){if(u.length===0)return 0;const[h,...d]=u;return o(Pa(h),d)},if(...u){const[h,d]=Rt(u,0,[lt.ANY]),p=$Se(h);return p&&d<u.length&&a.command(...u.slice(d)),p?1:0},repeatstart(u,...h){const[d,p]=Rt(h,0,[lt.NUMBER]),_=`repeatcount${u}`,y=`repeatwords${u}`;i[_]=d,i[y]=p<h.length?h.slice(p):void 0},repeat(u){const h=`repeatcount${u}`,d=`repeatwords${u}`;if(!En(i[h]))return 0;const p=i[h];i[h]=p-1;const _=p>0,y=i[d];return _&&ni(y)&&a.command(...y),_?1:0},foreachstart(u,...h){const[d,p,_,y]=Rt(h,0,[lt.STRING,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let S=Math.min(p,_),T=Math.max(p,_);const A=(y??0)||1;if(A<0){const R=S;S=T,T=R}return a.set(d,S-A),0},foreach(u,...h){const[d,p,_,y,S]=Rt(h,0,[lt.STRING,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let T=Math.min(p,_),A=Math.max(p,_);const R=(y??0)||1;if(R<0){const D=T;T=A,A=D}let I=a.get(d);!En(I)||I<T||I>A?I=T:I+=R;const U=I<=A?1:0;return U&&(a.set(d,I),S<h.length&&a.command(...h.slice(S))),U},or(...u){let h=0;for(let d=0;d<u.length;){const[p,_]=Rt(u,d,[lt.ANY]);if(h=p,h)break;d=_}return h},and(...u){let h=0;for(let d=0;d<u.length;){const[p,_]=Rt(u,d,[lt.ANY]);if(h=p,!h)break;d=_}return h},not(...u){const[h]=Rt(u,0,[lt.ANY]);return h?0:1},expr(...u){const[h]=Rt(u,0,[lt.ANY]);return h},isEq(u,h){const[d]=Rt([u],0,[lt.ANY]),[p]=Rt([h],0,[lt.ANY]);return typeof d=="object"||typeof p=="object"?HB(d,p)?1:0:d===p?1:0},isNotEq(u,h){return this.isEq(u,h)?0:1},isLessThan(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d<p?1:0},isGreaterThan(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d>p?1:0},isLessThanOrEq(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d>=p?1:0},opPlus(u,h){const[d]=Rt([u],0,[lt.ANY]),[p]=Rt([h],0,[lt.ANY]);return d+p},opMinus(u,h){const[d]=Rt([u],0,[lt.ANY]),[p]=Rt([h],0,[lt.ANY]);return d-p},opPower(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return Math.pow(d,p)},opMultiply(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d*p},opDivide(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d/p},opModDivide(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return d%p},opFloorDivide(u,h){const[d]=Rt([u],0,[lt.NUMBER]),[p]=Rt([h],0,[lt.NUMBER]);return Math.floor(d/p)},opUniPlus(u){const[h]=Rt([u],0,[lt.NUMBER]);return+h},opUniMinus(u){const[h]=Rt([u],0,[lt.NUMBER]);return-h}};return s=(l=t.code)==null?void 0:l.call(t,a),a}function yI(n){if(!n||n.type===void 0)return;const e=[{start:n.startOffset,end:n.endOffset??0}];return Object.keys(n).forEach(t=>{if(t!=="parent"){const r=n[t];ni(r)?r.forEach(i=>{e.push(yI(i))}):e.push(yI(r))}}),n.range={start:Math.min(...e.filter(t=>t).map(t=>(t==null?void 0:t.start)??0)),end:Math.max(...e.filter(t=>t).map(t=>(t==null?void 0:t.end)??0))},n.range}function KSe(n){const e=ij(`${n}
`);if(e.errors.length>0)return e;Bv.input=e.tokens;const t=Bv.program();if(Bv.errors.length>0)return{tokens:e.tokens,errors:Bv.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=zSe.go(t);return r?(yI(r),{tokens:e.tokens,cst:t,ast:r}):{tokens:e.tokens,cst:t,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const BR=Object.getPrototypeOf(function*(){}).constructor;function YSe(n,e){const t=`compile-${n}`;console.time(t);const r=KSe(e);if(console.timeEnd(t),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=WSe(r.ast);if(i.code){$me&&console.info(i.code);try{return{...r,...i,source:i.code,code:new BR("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new BR("api"," ")}}}return{...r,...i,source:"",code:new BR("api"," ")}}function JSe(){const n={},e={};function t(i,s){const o=n[s];if(o)return o;const a=YSe(i,s);return n[s]=a,a}const r={ids(){return Object.keys(e)},has(i){return fe(e[i])},isended(i){const s=e[i];return fe(s)?s.isended():!0},halt(i){const s=e[i];return fe(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var u;let l=e[i];if(!fe(e[i])){const h=t(a,c);if(l=e[i]=XSe(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,p=((d==null?void 0:d.line)??2)-1,_=c.replaceAll(`\r
`,"").split(`
`).map((T,A)=>[T,A]);_.slice(p-5,p).forEach(([T,A])=>{ti("os","build",`$grey${A+1} $grey${T}`)});const[y,S]=_[p]??[];if(vr(y)&&fe(S)){const T=(d.column??1)-1,A=T+d.length,R=T<y.length?y:`${y}*`,I=R.substring(0,T),U=R.substring(T,A),D=R.substring(A);ti("os","build",`$red${S+1} $grey${I}$red${U}$grey${D}`)}return d.message.split(`
`).forEach(T=>{ti("os","build",T)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=QB(i.target),a=e[s];if(fe(a)){const c={...i,target:o};a.message(c)}}};return r}function CT(n,e,t,r,i,s){return n>=s&&n<=r&&e>=t&&e<=i}new Ln;const Ij=JSe();var Ho=(n=>(n.MAIN="main",n.TITLE="title",n.PLAYER="player",n.CONTENT="content",n.GADGETSTORE="gadgetstore",n.GADGETSYNC="gadgetsync",n))(Ho||{});const Am={defaultplayer:YB(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function SI(){return[...Am.books.values()]}function QSe(){const[n]=Am.books.values();return n}function Iy(n){const e=Ur(n);return Am.books.get(n)??SI().find(t=>t.name===e)}function EI(n,e){fe(Iy(e))&&(Am.software[n]=e)}function CS(n){return Iy(Am.software[n])}function kj(n){const e=lj([]);return vr(n)&&(e.name=n),Oj(e),th("memory",`created [book] ${e.name}`),e}function ZSe(n){let e=Iy(n);return fe(e)||(e=lj([]),e.name=n),Oj(e),th("memory",`created [book] ${e.name}`),e}function om(n,e){let t=fe(e)?ZSe(e):CS(n);return fe(t)||(fe(t)||(t=QSe()),fe(t)||(t=kj(e)),fe(t)&&th("memory",`opened [book] ${t.name} for ${n}`)),EI(n,t.id),t}function L0(n,e,t){const r=om(n);let i=db(r,e);if(fe(i))return i;const s=aj(t);return i=vye(s==="object"?`@${e}
`:`@${s} ${e}
`,{}),yye(r,i),s3("memory","",Am.defaultplayer),i}function hE(n){const e=om("main");return Tye(e,n)}function eEe(n){const e=om("main");return xye(e,n)}function Oj(n){return Am.books.set(n.id,n),n.id}function tEe(n){const e=Iy(n);e&&Am.books.delete(e.id)}function nEe(n,e,t,r,i=IJ){if(!fe(n)||!fe(e)||!fe(t))return;const s={...be},o=t.id??"";be.book=n,be.board=e,be.element=t,be.isplayer=JB(o),be.player=t.player??Am.defaultplayer;const a=Of(n,t),c=t.cycle??(a==null?void 0:a.cycle)??i,l=t.id??"",u=vN(t);if(Ij.tick(l,xN.CODE_PAGE,En(c)?c:i,u,r),En(t==null?void 0:t.tickertime)&&be.timestamp-t.tickertime>a3*5&&(t.tickertime=0,t.tickertext=""),be.isplayer){const h=hE(be.element.id??"");h.inputcurrent=0}GB(s).forEach(h=>{be[h]=s[h]})}function yw(n){const e=om("main"),t=db(e,n);if(!fe(e)||!fe(t)||!fe(be.element))return;const r=`${n}_run`,i=vN(be.element),s=(t==null?void 0:t.code)??"";Ij.once(r,xN.CODE_PAGE,i,s)}function Oa(n,e=!0){var i,s,o,a,c;const t=be.words[n],r=n+1;if(xV(t)){const[l,u]=lx(n);if(fe(l))return[l,u]}if(lye(t)){const[l,u]=CV(n);if(fe(l))return[l,u]}if(Pj(t)){const[l,u]=Sw(n);if(fe(l))return[l,u]}if(vr(t)&&Ur(t)==="rnd"){const[l,u]=Oa(r),[h,d]=Oa(u);return En(l)&&En(h)?[yS(l,h),d]:En(l)?[yS(0,l),u]:[yS(0,1),r]}if(nV(t)){const[l,u]=YM(n);if(fe(l))return[l,u]}if(!fe(t))return[void 0,n];if(En(t)||ni(t))return[t,r];if(vr(t)){const l=Ur(t);if(e){const u=(i=be.get)==null?void 0:i.call(be,t);if(fe(u))return[u,r]}switch(l){case"aligned":case"alligned":{const u=xU(be.board,be.element,be.player);return!fe(be.element)||!fe(u)?[0,r]:[be.element.x===u.x||be.element.y===u.y?1:0,r]}case"contact":{const u=xU(be.board,be.element,be.player);if(!fe(be.element)||!fe(u))return[0,r];const h=(u.x??0)-(((s=be.element)==null?void 0:s.x)??0),d=(u.y??0)-(((o=be.element)==null?void 0:o.y)??0);return[h===0&&Math.abs(d)<2||d===0&&Math.abs(h)<2?1:0,r]}case"blocked":{const[u,h]=Rt(be.words,r,[lt.DIR]);return[wye(be.book,be.board,be.element,u)?1:0,h]}case"any":{const[u,h]=Rt(be.words,r,[lt.KIND]),d=fw(u)??"",p=ub(be.board,d);return[oV(p,u).length?1:0,h]}case"rnd":return[yS(0,1),r];case"abs":{const[u,h]=Rt(be.words,r,[lt.NUMBER]);return[Math.abs(u),h]}case"ceil":{const[u,h]=Rt(be.words,r,[lt.NUMBER]);return[Math.ceil(u),h]}case"floor":{const[u,h]=Rt(be.words,r,[lt.NUMBER]);return[Math.floor(u),h]}case"round":{const[u,h]=Rt(be.words,r,[lt.NUMBER]);return[Math.round(u),h]}case"clamp":{const[u,h,d,p]=Rt(be.words,r,[lt.NUMBER,lt.NUMBER,lt.NUMBER]);return[Ii(u,h,d),p]}case"min":{const u=[];for(let h=r;h<be.words.length;){const[d,p]=Oa(h);ni(d)&&!ff(d)&&!em(d)&&!Rg(d)&&!vu(d)&&u.push(...d),h=p,u.push(d)}return[Math.min(...u),be.words.length]}case"max":{const u=[];for(let h=r;h<be.words.length;){const[d,p]=Oa(h);ni(d)&&!ff(d)&&!em(d)&&!Rg(d)&&!vu(d)&&u.push(...d),h=p,u.push(d)}return[Math.max(...u),be.words.length]}case"pick":{const u=[];for(let h=r;h<be.words.length;){const[d,p]=Oa(h);ni(d)&&!ff(d)&&!em(d)&&!Rg(d)&&!vu(d)&&u.push(...d),h=p,u.push(d)}return[Rv(u),be.words.length]}case"pickwith":{const u=[],[h,d]=Rt(be.words,r,[lt.STRING]);for(let p=d;p<be.words.length;){const[_,y]=Oa(p);ni(_)&&!ff(_)&&!em(_)&&!Rg(_)&&!vu(_)&&u.push(..._),p=y,u.push(_)}return[Sge(h,u),be.words.length]}case"range":{const[u,h,d,p]=Rt(be.words,r,[lt.NUMBER,lt.MAYBE_NUMBER,lt.MAYBE_NUMBER]);return[BC(u,h,d),p]}case"run":{const[u,h]=Rt(be.words,r,[lt.NAME]);return yw(u),[(a=be.get)==null?void 0:a.call(be,"arg"),h]}case"runwith":{const[u,h,d]=Rt(be.words,r,[lt.ANY,lt.NAME]);return fe(be.element)&&(be.element.arg=u),yw(h),[(c=be.get)==null?void 0:c.call(be,"arg"),d]}}}return[t,r]}function rEe(n){return fe(n)&&n<Kr.ONBLACK?n:void 0}function iEe(n){return fe(n)&&n>Kr.WHITE&&n<Kr.ONCLEAR?n-Kr.ONBLACK:void 0}const e1={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function vu(n){return ni(n)&&Nj(n[0])}function ZU(n){return vu(n)&&n[0].startsWith("ON")}function Nj(n){return fe(Kr[n])&&vr(n)}function Pj(n){if(vr(n))return e1[Ur(n)]}function sEe(n){return n.map(e=>Kr[e]).find(e=>fe(e)&&e<Kr.ONBLACK)}function oEe(n){return n.map(e=>Kr[e]).find(e=>fe(e)&&e>=Kr.ONBLACK)}function eF(n){if(vu(n))return n;if(Nj(n))return[n];const e=Pj(n);if(fe(e))return[e]}function tF(n){const e=be.words[n],t=eF(e);if(vu(t))return[t,n+1];const[r,i]=Oa(n),s=eF(r);return vu(s)?[s,i]:[void 0,n]}function Sw(n){const e=[];let t=n;const[r,i]=tF(n);if(vu(r)&&(e.push(...r),t=i),vu(e)&&!ZU(e)){const[s,o]=tF(i);ZU(s)&&(t=o)}return e.length?[e,t]:[void 0,n]}function aEe(n){const e={};return n.every(t=>{const r=Kr[t];fe(r)&&(r<Kr.ONBLACK?e.color=r:e.bg=r-Kr.ONBLACK)}),e}const cEe=BC(32,126).map(n=>String.fromCharCode(n)),lEe=xu({name:"Whitespace",pattern:/ +/}),uEe=xu({name:"WhitespaceSkipped",pattern:/ +/,group:pa.SKIPPED}),RN=xu({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),AN=xu({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:cEe}),MN=xu({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),IN=xu({name:"EscapedDollar",pattern:"$$"}),kN=xu({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),ON=xu({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),NN=xu({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function hEe(n,e=""){return xu({name:e||n,pattern:new RegExp(n.toLowerCase(),"i")})}const dEe=Object.keys(e1),Dj=dEe.map(n=>hEe(`\\$(${n})`,n)),fEe=[lEe,RN,...Dj,MN,AN,ON,IN,NN,kN],pEe=new pa(fEe,{skipValidations:!kf,ensureOptimizations:kf}),mEe=new pa([uEe,RN,...Dj,MN,AN,ON,IN,NN,kN],{skipValidations:!kf,ensureOptimizations:kf});function t1(n,e=!1){return e?mEe.tokenize(n):pEe.tokenize(n)}function Xy(n,e,t,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:n,height:e,char:[],color:[],bg:[],changed(){}}}function n1(n){n.active={...n.reset}}function PN(n,e){const t=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<n.length;++a){const c=n[a];switch(c.tokenType){case IN:s("$");break;case ON:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case MN:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case RN:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=e1[l],h=rEe(Kr[u]),d=iEe(Kr[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):fe(h)?e.active.color=h:fe(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(fe(e.writefullwidth)&&(e.x>o||e.y===t)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){n1(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;i1(u,u+l.length,e.active.color,e.active.bg,e),r1(u,l,e)}}}function ci(n,e,t){const r=t1(n);r.tokens&&(PN(r.tokens,e),t&&n1(e))}function DN(n,e,t){const r=t1(n);if(!r.tokens)return;const i=Xy(e,t,Kr.WHITE,Kr.BLACK);return i.measureonly=!0,PN(r.tokens,i),i.x>0&&++i.y,i}function r1(n,e,t){let r=0;const i=n+e.length;for(let s=n;s<i;++s)t.char[s]=e.charCodeAt(r++)}function i1(n,e,t,r,i){const s=Math.min(n,e),o=Math.max(n,e);for(let a=s;a<=o;++a)i.color[a]=t,i.bg[a]=r}function Lj(n,e,t){const r=ab(AN,n,0,0,0,0,0,0);PN([r],e),t&&n1(e)}function gEe(n,e,t,r,i){i.active.topedge=n,i.active.leftedge=e,i.active.rightedge=t,i.active.bottomedge=r}function dd(n){const e=n.reset.leftedge??0,t=n.reset.rightedge??n.width-1,r=n.reset.topedge??0,i=n.reset.bottomedge??n.height-1,s=t-e+1,o=i-r+1;return{left:e,right:t,top:r,bottom:i,width:s,height:o}}const W0=at.createContext(Xy(1,1,15,1));function Hf(){return at.useContext(W0)}const Uj=nb(()=>({blink:!1}));setInterval(()=>{Uj.setState(n=>({blink:!n.blink}))},333);function Gf(){return Uj(n=>n.blink)}function Fj(){return tN(n=>{function e(){n({render:Math.random()})}return{dither:[],render:0,changed(){setTimeout(e,0)}}})}function _Ee(n){n.fill(0)}function zR(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return-1;n[r+i*e]=s}const Bj=at.createContext(Fj());function vEe(n,e,t){const[r]=at.useState(()=>Fj()),i=n*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(t),s.render=0),r}function zj(){return tN(n=>{function e(){n({render:Math.random()})}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){setTimeout(e,0)}}})}function Vj(n,e,t,r){n.char.fill(e),n.color.fill(t),n.bg.fill(r)}function aa(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return;const o=r+i*e;GB(s).forEach(a=>{const c=s[a];fe(c)&&(n[a][o]=c)})}const LN=at.createContext(zj());function s1(n,e,t,r,i){const[s]=at.useState(()=>zj()),o=n*e,a=s.getState();return a.char.length!==o&&(a.width=n,a.height=e,a.char=new Array(o).fill(t),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function yEe(){return at.useContext(LN).getState()}function SEe({item:n,context:e}){return ci(`${n}
`,e,!0),null}const o1=at.createContext({sendmessage(){},sendclose(){},didclose(){}}),nF={input:{color:"$white",active:"$yellow"}};function t0(n){return n?nF.input.active:nF.input.color}function ih(n,e){return typeof n==typeof e?n:e}function jj(n,e){return`vm:${n}:${e}`}function RS(n,e,t=0,r=""){return`${n.substring(0,e)}${r}${n.substring(e+t)}`}function EEe({chip:n,active:e,label:t,args:r,context:i}){var d;const[s,o,a]=[ih(r[0],""),ih(r[1],((d=r[1])==null?void 0:d.toString())??""),ih(r[2],"")],c=a||` ${o.toUpperCase()} `,l=t0(e);ci(`${i.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${t}
`,i,!0);const u=at.useContext(o1),h=at.useCallback(()=>{u.sendmessage(jj(n,s)),u.sendclose()},[n,u,s]);return Fe.jsxs(Fe.Fragment,{children:[e&&Fe.jsx(Vl,{OK_BUTTON:h}),Fe.jsx(NS,{hotkey:o,children:h})]})}function bEe({chip:n,active:e,label:t,args:r,context:i}){const[s,o]=[ih(r[0],""),r[1]],a=t0(e);ci(`  $purple$16 ${a}${t}
`,i,!0);const c=at.useContext(o1),l=at.useCallback(()=>{c.sendmessage(jj(n,s),o),c.sendclose()},[c,n,s,o]);return e&&Fe.jsx(Vl,{OK_BUTTON:l})}function TEe({chip:n,active:e,label:t,args:r,context:i}){const[s,o,a]=[ih(r[0],""),ih(r[1],-1),ih(r[2],-1)];let c,l;o===-1?(c=0,l=31):a===-1?(c=0,l=o):(c=o,l=a);const u=$y(n,s),h=Bk(u),d=h==null?void 0:h.value,p=d??0,_=Gf(),[y,S]=at.useState(""),[T,A]=at.useState(0),[R,I]=at.useState(!1);let U=`${p}`;const D=t.trim(),L=t0(e);R&&(U=_?RS(y,T,1,"$219+"):y),i.writefullwidth=32,ci(`  # ${L}${D} $green${U}`,i,!1),i.writefullwidth=void 0,ci(`
`,i,!1);const z=at.useCallback(W=>{const X=W.alt?10:1;Mg(u,Math.min(l,p+X))},[l,p,u]),F=at.useCallback(W=>{const X=W.alt?10:1;Mg(u,Math.max(c,p-X))},[c,p,u]),V=at.useCallback(()=>{I(W=>{const X=!W;if(X){const $=`${d}`;S($),A($.length)}else{const $=parseFloat(y),K=isNaN($)?0:$;Mg(s,Math.min(l,Math.max(c,K)))}return X})},[l,c,y,s,d]);return d!==void 0&&Fe.jsxs(Fe.Fragment,{children:[e&&Fe.jsx(Vl,{MOVE_LEFT:F,MOVE_RIGHT:z,OK_BUTTON:V}),R&&Fe.jsxs(rb,{blockhotkeys:!0,children:[Fe.jsx(NS,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),Fe.jsx(NS,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),Fe.jsx(NS,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),Fe.jsx(Vl,{MOVE_LEFT:()=>{A(W=>Math.max(0,W-1))},MOVE_RIGHT:()=>{A(W=>Math.min(y.length,W+1))},CANCEL_BUTTON:V,OK_BUTTON:V,keydown:W=>{switch(Ur(W.key)){case"delete":y.length>0&&S(X=>RS(X,T,1));break;case"backspace":T>0&&(S(X=>RS(X,T-1,1)),A(X=>Math.max(0,X-1)));break}W.key.length===1&&y.length<i.width*.5&&(S(X=>RS(X,T,0,W.key)),A(X=>X+1))}})]})]})}function xEe({chip:n,active:e,label:t,args:r,context:i}){const[s,o,a]=[ih(r[0],""),ih(r[1],""),ih(r[2],"")];let c,l;o===""?(c="L ",l=" H"):a===""?(c="L ",l=` ${o}`):(c=`${o} `,l=` ${a}`);const u=0,h=8,d=$y(n,s),p=Bk(d),_=(p==null?void 0:p.value)??0,y=Gf(),S=t.trim(),T=t0(e);ci(` $red $29 ${T}${S} `,i,!1);const R=RS("----:----",_,1,`$green${e?y?"$26":"$27":"$4"}${T}`).replaceAll("-","$7").replaceAll(":","$9");ci(`${T}${c}${R}${l} $green${_+1}
`,i,!1);const I=at.useCallback(D=>{const L=D.alt?10:1;Mg(d,Math.min(h,_+L))},[h,_,d]),U=at.useCallback(D=>{const L=D.alt?10:1;Mg(d,Math.max(u,_-L))},[u,_,d]);return Fe.jsx(Fe.Fragment,{children:e&&Fe.jsx(Vl,{MOVE_LEFT:U,MOVE_RIGHT:I})})}function wEe({chip:n,active:e,label:t,args:r,context:i}){const[s,...o]=[ih(r[0],""),...r.slice(1)],a=0,c=o.length-1,l=$y(n,s),u=Bk(l),h=(u==null?void 0:u.value)??0,d=Gf(),p=`${o[h]}`,_=t.trim(),y=t0(e);ci(` $dkred ? ${y}${_} `,i,!1);const S=e?d?"$26":"$27":"/";ci(`${h+1}$green${S}${y}${c+1}`,i,!1),i.writefullwidth=32,ci(` $green${p}`,i,!1),i.writefullwidth=void 0,ci(`
`,i,!1);const T=at.useCallback(R=>{const I=R.alt?10:1;Mg(l,Math.min(c,h+I))},[c,h,l]),A=at.useCallback(R=>{const I=R.alt?10:1;Mg(l,Math.max(a,h-I))},[a,h,l]);return Fe.jsx(Fe.Fragment,{children:e&&Fe.jsx(Vl,{MOVE_LEFT:A,MOVE_RIGHT:T})})}function CEe({chip:n,active:e,label:t,args:r,context:i}){const s=ih(r[0],""),o=$y(n,s),a=M4(o),c=a==null?void 0:a.value,l=(c==null?void 0:c.toJSON())??"",u=Gf(),[h,d]=at.useState(0),[p,_]=at.useState(!1),[y,S]=at.useState(void 0),T=`${l} `,A=t.trim(),R=t0(e);ci(`$green  $20 ${R}${A} $green`,i,!1);const I=i.x,D=i.y*i.width;i.writefullwidth=32,ci(`${T}`,i,!1),i.writefullwidth=void 0,ci(`
`,i,!1);const L=fe(y),z=i.width-I-2,F=L?Math.min(y,h):h;let V=L?Math.max(y,h):h;L&&(V!==F&&V===h&&--V,i1(I+F+D,I+V+D,15,8,i)),p&&u&&r1(I+h+D,"Û",i);function W(){fe(c)&&(d(F),S(void 0),c.delete(F,V-F+1))}return Fe.jsxs(Fe.Fragment,{children:[e&&Fe.jsx(Vl,{OK_BUTTON:()=>{c&&(_(!0),d(c.length),S(void 0))}}),p&&Fe.jsx(rb,{blockhotkeys:!0,children:Fe.jsx(Vl,{MOVE_LEFT:X=>{X.shift?fe(y)||S(Ii(h-1,0,l.length)):S(void 0),d($=>Ii($-1,0,l.length))},MOVE_RIGHT:X=>{X.shift?fe(y)||S(h):S(void 0),d($=>Ii($+1,0,l.length))},CANCEL_BUTTON:()=>{_(!1),d(l.length),S(void 0)},OK_BUTTON:()=>_(!1),keydown:X=>{if(!c)return;const{key:$}=X,K=Ur($),te={alt:X.altKey,ctrl:Ry?X.metaKey:X.ctrlKey,shift:X.shiftKey},Q=c.toJSON();switch(K){case"delete":L?W():Q.length>0&&c.delete(h,1);break;case"backspace":L?W():h>0&&(c.delete(h-1,1),d(ne=>Math.max(0,ne-1)));break;default:if(te.ctrl)switch(K){case"a":S(0),d(Q.length);break;case"c":fe(navigator.clipboard)&&navigator.clipboard.writeText(c.toJSON()).catch(ne=>console.error(ne));break;case"v":fe(navigator.clipboard)&&navigator.clipboard.readText().then(ne=>{L&&W(),c.insert(h,ne),d(h+ne.length)}).catch(ne=>console.error(ne));break;case"x":fe(navigator.clipboard)&&navigator.clipboard.writeText(c.toJSON()).then(()=>W()).catch(ne=>console.error(ne));break}else te.alt||$.length===1&&Q.length<z&&(c.insert(h,$),d(ne=>ne+1));break}}})})]})}function REe({item:n,active:e}){const t=Fa(),r=Hf();if(r.iseven=r.y%2===0,typeof n=="string")return Fe.jsx(SEe,{player:t,item:n,context:r});if(ni(n)){const[i,s,o,...a]=n;if(typeof i!="string"||typeof s!="string"||typeof o!="string")return null;const c={player:t,chip:i,active:e,label:s,args:a,context:r};switch(Ur(o)){case"hk":case"hotkey":return Fe.jsx(EEe,{...c});case"hyperlink":return Fe.jsx(bEe,{...c});case"rn":case"range":return Fe.jsx(xEe,{...c});case"sl":case"select":return Fe.jsx(wEe,{...c});case"nm":case"number":return Fe.jsx(TEe,{...c});case"tx":case"text":return Fe.jsx(CEe,{...c})}n1(r)}return null}function a1({store:n,children:e}){return Fe.jsx(LN.Provider,{value:n,children:e})}function c1({width:n,height:e}){const t=at.useContext(LN),[r,i,s]=nN(t,Zg(o=>[o.char,o.color,o.bg,o.render]));return n>0&&e>0&&Fe.jsx(l8,{char:r.slice(),color:i.slice(),bg:s.slice(),width:n,height:e})}function Hj({margin:n=1,selected:e=-1,width:t,height:r,color:i,bg:s,text:o}){const a=s1(t,r,0,i,s),c=a.getState(),l={...Xy(t,r,i,s,0,n,t-n,r),...a.getState(),x:n};return Vj(c,0,i,s),c.changed(),Fe.jsxs(a1,{store:a,children:[Fe.jsx(W0.Provider,{value:l,children:o.map((u,h)=>Fe.jsx(REe,{item:u,active:h===e},h))}),Fe.jsx(c1,{width:t,height:r})]})}var AEe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},MEe=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function IEe(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:MEe,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[c]===void 0&&(n.__damp[c]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),h=n[e]-t,d=t,p=s*r;h=Math.min(Math.max(h,-p),p),t=n[e]-h;var _=(n.__damp[c]+l*h)*i;n.__damp[c]=(n.__damp[c]-l*_)*u;var y=t+(h+_)*u;return d-n[e]>0==y>d&&(y=d,n.__damp[c]=(y-d)/i),n[e]=y,!0}const kEe=2,OEe=14,Gj=OEe*kEe;function NEe(n){return QO(n,Gj*.5)}function PEe(n,e,t,r,i=1.235){function s(a){return AEe(a,r)}IEe(n.userData,e,t,i,r,Gj*12,s),n.position[e]=NEe(n.userData[e]);const o=t-n.position.y;return Math.abs(o)<.1}function rF({x:n,y:e,color:t,on:r=232,off:i=7,alt:s}){const o=Gf(),a=yEe(),c=at.useRef(0),l=fe(s)?c.current%2===0?r:s:r;return aa(a,a.width,a.height,n,e,{char:o?l:i,color:t}),a.changed(),o&&++c.current,null}function DEe({store:n,children:e}){return Fe.jsx(Bj.Provider,{value:n,children:e})}function LEe({width:n,height:e}){const t=at.useContext(Bj),[r]=nN(t,Zg(i=>[i.dither,i.render]));return n>0&&e>0&&Fe.jsx(VC,{alphas:r.slice(),width:n,height:e})}function UEe({name:n,width:e,height:t,color:r,bg:i,text:s,shouldclose:o}){const{viewport:a}=Ly(),c=e-3,l=t-3,u=s1(e,t,0,r,i),h=vEe(c,l,0),d=at.useContext(o1),p=u.getState();for(let K=1;K<e-1;++K)aa(p,e,t,K,0,{char:196,color:15}),K>2&&K<e-1&&aa(p,e,t,K,1,{char:205,color:15}),aa(p,e,t,K,t-1,{char:205,color:15});aa(p,e,t,1,0,{char:205,color:15}),aa(p,e,t,2,0,{char:187,color:15}),aa(p,e,t,2,1,{char:200,color:15});for(let K=1;K<t-1;++K)aa(p,e,t,0,K,{char:179,color:15}),aa(p,e,t,e-1,K,{char:179,color:15});for(let K=2;K<t-1;++K)aa(p,e,t,1,K,{char:0,color:15}),aa(p,e,t,e-2,K,{char:0,color:15});aa(p,e,t,0,0,{char:213,color:15}),aa(p,e,t,e-1,0,{char:191,color:15}),aa(p,e,t,e-1,1,{char:181,color:15}),aa(p,e,t,0,t-1,{char:212,color:15}),aa(p,e,t,e-1,t-1,{char:190,color:15});const _=` ${n} `,y=DN(_,e,t),S=(y==null?void 0:y.x)??_.length,T={...Xy(e,t,r,i,0,0,e,t),...p,x:Math.round(e*.5)-Math.round(S*.5)};ci(_,T,!0);const[A,R]=at.useState(0);let I=A-Math.floor(l*.5);I=Math.min(s.length-l,I),I=Math.max(0,I);const U=s.slice(I,I+l),D=A-I,L=[.001,.05,.1,.2],z=.4,{dither:F}=h.getState();_Ee(F);for(let K=0;K<c;++K){zR(F,c,l,K,D,z);for(let te=0;te<L.length;++te){const Q=L.length-te;zR(F,c,l,K,D-Q,L[te]),zR(F,c,l,K,D+Q,L[te])}}const V=at.useRef(null),W=at.useCallback(()=>{o&&d.didclose()},[o,d]);at.useEffect(()=>{if(V.current&&!o){const K=a.height;V.current.position.y=K,V.current.userData.y=K,V.current.userData.vy=0}},[o]),Vw(at.useCallback((K,te)=>{if(fe(V.current)){const Q=o?t*2*-mi.DRAW_CHAR_HEIGHT():0;PEe(V.current,"y",Q,te)&&W()}},[o,W,t]));const X=at.useCallback(K=>{const te=K.alt?10:1;R(Q=>Math.max(0,Q-te))},[R]),$=at.useCallback(K=>{const te=K.alt?10:1;R(Q=>Math.min(s.length,Q+te))},[R,s.length]);return Fe.jsx(a1,{store:u,children:Fe.jsx(DEe,{store:h,children:Fe.jsx("group",{ref:V,"position-y":1e6,children:Fe.jsxs(rb,{children:[Fe.jsx(Vl,{MOVE_UP:X,MOVE_DOWN:$,CANCEL_BUTTON:d.sendclose}),Fe.jsx(c1,{width:e,height:t}),Fe.jsxs("group",{position:[2*mi.DRAW_CHAR_WIDTH(),2*mi.DRAW_CHAR_HEIGHT(),0],children:[Fe.jsx(LEe,{width:c,height:l}),Fe.jsx(Hj,{name:n,width:c,height:l,margin:0,color:r,bg:Kr.ONCLEAR,text:U,selected:D}),Fe.jsx(rF,{x:1,y:1}),Fe.jsx(rF,{x:1,y:2+D,on:26,alt:27,off:45,color:12})]})]})})})})}const iF=new Ln,sF=[2,1,176,5,153,177,254];function FEe({context:n,width:e,height:t,islandscape:r,drawstick:i}){if(Vj(n,0,Kr.WHITE,Kr.ONCLEAR),!r){const s=e*t;for(let o=4*e;o<s;++o)n.char[o]=sF[o%sF.length],n.color[o]=Kr.DKPURPLE}n.y=3;for(let s=0;s<3;++s)n.x=n.active.leftedge=1,ci("$YELLOW$176$176$176$176$176",n,!1),n.x=n.active.leftedge=e-7,ci(`$WHITE$176$176$176$176$176
`,n,!1);n.y=t-5;for(let s=0;s<3;++s)n.x=n.active.leftedge=1,ci("$GREEN$176$176$176$176$176",n,!1),n.x=n.active.leftedge=e-7,ci(`$RED$176$176$176$176$176
`,n,!1);if(i.startx!==-1){n.active.leftedge=0,n.x=n.active.leftedge=i.startx-4,n.y=i.starty-3;for(let o=0;o<5;++o)ci(`$BLUE$176$176$176$176$176$176$176$176
`,n,!1);iF.set(i.tipx-i.startx,i.tipy-i.starty);const s=ppe(QO(Hz(iF.angle()),45));n.x=n.active.leftedge=Math.round(i.startx+Math.cos(s)*4)-2,n.y=Math.round(i.starty+Math.sin(s)*3)-2;for(let o=0;o<3;++o)ci(`$BLUE$177$177$177$177
`,n,!1)}return r||(n.active.leftedge=1,n.y=4,n.x=2,ci("$YELLOW?",n,!1),n.x=e-7,ci("$WHITEMENU",n,!1),n.y=t-4,n.x=2,ci("$GREENOKAY",n,!1),n.x=e-9,ci("$REDCANCEL",n,!1)),null}function oF(){}const BEe=Xh.forwardRef(function({args:e,children:t,...r},i){const s=Xh.useRef(null);return Xh.useImperativeHandle(i,()=>s.current),Fe.jsxs("mesh",{ref:s,...r,children:[Fe.jsx("planeGeometry",{attach:"geometry",args:e}),t]})}),Wj=Xh.forwardRef(function({blocking:e=!1,cursor:t="default",x:r=0,y:i=0,width:s=1,height:o=1,opacity:a=1,visible:c=!0,...l},u){const h=s*.5,d=o*.5,p=[(r+h)*mi.DRAW_CHAR_WIDTH(),(i+d)*mi.DRAW_CHAR_HEIGHT(),0],_=FC();return Fe.jsx(BEe,{ref:u,args:[s*mi.DRAW_CHAR_WIDTH(),o*mi.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:t,clippingPlanes:_},onClick:e?oF:void 0,onPointerMove:e?oF:void 0,position:p,...l,children:Fe.jsx("meshBasicMaterial",{color:"white",opacity:a,visible:c,transparent:a!==1,clippingPlanes:_})})});function zEe(n,e){switch(n){case 0:Cl("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_UP,e),Vi("touchui",it.MOVE_DOWN,e);break;case 45:Cl("touchui",it.MOVE_UP,e),Cl("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_DOWN,e);break;case 90:Cl("touchui",it.MOVE_UP,e),Vi("touchui",it.MOVE_DOWN,e),Vi("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e);break;case 135:Cl("touchui",it.MOVE_UP,e),Cl("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_DOWN,e);break;case 180:Cl("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_UP,e),Vi("touchui",it.MOVE_DOWN,e);break;case 225:Cl("touchui",it.MOVE_DOWN,e),Cl("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_DOWN,e);break;case 270:Cl("touchui",it.MOVE_DOWN,e),Vi("touchui",it.MOVE_UP,e),Vi("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e);break;case 315:Cl("touchui",it.MOVE_DOWN,e),Cl("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_UP,e);break;case 360:Cl("touchui",it.MOVE_LEFT,e),Vi("touchui",it.MOVE_RIGHT,e),Vi("touchui",it.MOVE_UP,e),Vi("touchui",it.MOVE_DOWN,e);break}}const VR=new Ln,DS=new qe;function jR(n,e){const t=mi.DRAW_CHAR_WIDTH(),r=mi.DRAW_CHAR_HEIGHT(),i=DS.x+t*.5,s=DS.y+r*.5;return{cx:Math.floor(n*.5)+Math.floor(i/t),cy:Math.floor(e*.5)+Math.floor(s/r)}}function VEe({width:n,height:e,player:t,onDrawStick:r}){const[i]=at.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerId:-1});function s(o,a){i.tipx===-1?(CT(o,a,3,6,6,1)&&(gJ("touchui",t),console.info("top-left")),CT(o,a,3,n-2,6,n-6)&&(VT("touchui",it.MENU_BUTTON,0,t),console.info("top-right")),CT(o,a,e-5,6,e-2,1)&&(VT("touchui",it.OK_BUTTON,0,t),console.info("bottom-left")),CT(o,a,e-5,n-2,e-2,n-6)&&(VT("touchui",it.CANCEL_BUTTON,0,t),console.info("bottom-right"))):(Vi("touchui",it.MOVE_UP,t),Vi("touchui",it.MOVE_DOWN,t),Vi("touchui",it.MOVE_LEFT,t),Vi("touchui",it.MOVE_RIGHT,t)),i.startx=-1,i.starty=-1,i.tipx=-1,i.tipy=-1,i.pointerId=-1,r(i.startx,i.starty,i.tipx,i.tipy)}return Fe.jsx(Wj,{blocking:!0,width:n,height:e,visible:!1,onPointerDown:o=>{if(i.startx===-1){o.intersections[0].object.worldToLocal(DS.copy(o.intersections[0].point));const{cx:a,cy:c}=jR(n,e);i.startx=a,i.starty=c,i.tipx=-1,i.tipy=-1,i.pointerId=o.pointerId}else Cl("touchui",it.SHIFT,t)},onPointerMove:o=>{if(o.pointerId===i.pointerId){o.intersections[0].object.worldToLocal(DS.copy(o.intersections[0].point));const{cx:a,cy:c}=jR(n,e);if(VR.set(i.startx-a,i.starty-c),i.tipx!==-1||VR.length()>3){const l=QO(Hz(VR.angle()),45);i.tipx=a,i.tipy=c,zEe(l,t),r(i.startx,i.starty,i.tipx,i.tipy)}}},onPointerUp:o=>{if(o.pointerId===i.pointerId){o.intersections[0].object.worldToLocal(DS.copy(o.intersections[0].point));const{cx:a,cy:c}=jR(n,e);s(a,c)}else Vi("touchui",it.SHIFT,t)}})}function jEe({width:n,height:e,islandscape:t}){const r=UN(),i=Fa(),[s,o]=at.useState({startx:-1,starty:-1,tipx:-1,tipy:-1}),a=s1(n,e,0,Kr.WHITE,Kr.ONCLEAR),c={...Xy(n,e,Kr.WHITE,Kr.ONCLEAR),...a.getState()};return r.cols<10||r.rows<10?null:(gEe(1,1,n-2,e-2,c),Fe.jsx(a1,{store:a,children:Fe.jsxs("group",{position:[0,0,999],children:[Fe.jsx(FEe,{context:c,width:n,height:e,islandscape:t,drawstick:s}),Fe.jsx(VEe,{width:n,height:e,player:i,onDrawStick:(l,u,h,d)=>o({startx:l,starty:u,tipx:h,tipy:d})}),Fe.jsx(BM,{width:n,height:e,top:3,left:0,right:5,bottom:e-6}),Fe.jsx(BM,{width:n,height:e,top:3,left:n-6,right:n-1,bottom:e-6}),Fe.jsx(c1,{width:n,height:e})]})}))}const $j=at.createContext({cols:1,rows:1});function UN(){return at.useContext($j)}function HEe({islandscape:n,showtouchcontrols:e,children:t}){const{viewport:r,set:i,size:s,camera:o}=Ly(),a=at.useRef(null),{width:c,height:l}=r.getCurrentViewport();at.useLayoutEffect(()=>{const I=o;return o.updateProjectionMatrix(),i(()=>({camera:a.current})),()=>i(()=>({camera:I}))},[i,o,a]);const u=c/mi.DRAW_CHAR_WIDTH();let h=Math.floor(u);const d=l/mi.DRAW_CHAR_HEIGHT();let p=Math.floor(d);const _=(c-h*mi.DRAW_CHAR_WIDTH())*.5,y=(l-p*mi.DRAW_CHAR_HEIGHT())*.5;let S=0,T=0;const A=Math.round(u);let R=Math.round(d);if(e)if(n)S=5*mi.DRAW_CHAR_WIDTH(),h-=5*2;else{p=Math.round(p*.666);const I=p-4;R-=I,T=I*mi.DRAW_CHAR_HEIGHT()}return Fe.jsxs($j.Provider,{value:{cols:h,rows:p},children:[Fe.jsx("orthographicCamera",{ref:a,left:s.width/-2,right:s.width/2,top:s.height/2,bottom:s.height/-2,near:1,far:2e3,position:[0,0,1e3]}),h>=10&&p>=10&&Fe.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:Fe.jsxs("group",{position:[c*-.5+_,l*-.5+y,0],children:[Fe.jsx("group",{position:[S,0,0],children:t}),e&&Fe.jsx("group",{position:[0,T,0],children:Fe.jsx(jEe,{width:A,height:R,islandscape:n},A*R)})]})})]})}function aF({rect:n,shouldclose:e=!1}){switch(n.type){case 0:return Fe.jsx(Hj,{name:n.name,width:n.width,height:n.height,color:14,bg:1,text:n.text});case 1:return Fe.jsx(UEe,{name:n.name,width:n.width,height:n.height,color:14,bg:1,text:n.text,shouldclose:e});case 2:return Fe.jsx(h0e,{width:n.width,height:n.height})}return null}function GEe(){const n=UN(),[e,t]=at.useState(),r=Zp(oge(c=>c.gadget.panels));if(n.cols<10||n.rows<10)return null;const i={name:"main",type:2,x:0,y:0,text:[],width:n.cols,height:n.rows},s=[];let o=!0;r.forEach(c=>{let l;switch(c.edge){case vc.LEFT:l={name:c.name,type:0,x:i.x,y:i.y,width:c.size,height:i.height,text:c.text},i.x+=c.size,i.width-=c.size,s.push(l);break;default:case vc.RIGHT:l={name:c.name,type:0,x:i.x+i.width-c.size,y:i.y,width:c.size,height:i.height,text:c.text},i.width-=c.size,s.push(l);break;case vc.TOP:l={name:c.name,type:0,x:i.x,y:i.y,width:i.width,height:c.size,text:c.text},i.y+=c.size,i.height-=c.size,s.push(l);break;case vc.BOTTOM:l={name:c.name,type:0,x:i.x,y:i.y+i.height-c.size,width:i.width,height:c.size,text:c.text},i.height-=c.size,s.push(l);break;case vc.SCROLL:l={name:c.name,type:1,x:0,y:0,width:Ii(c.size||50,24,i.width-2),height:Ii(18,8,i.height-8),text:c.text},l.x=i.x+Math.floor((i.width-l.width)*.5),l.y=i.y+Math.floor((i.height-l.height)*.5),o=!1,uy(e,l)||t(Zc(l))}}),s.unshift(i);const a=Fa();return Fe.jsx(o1.Provider,{value:{sendmessage(c,l){Vn.emit(c,"gadget",l,a)},sendclose(){nJ("gadget",a)},didclose(){t(void 0)}},children:Fe.jsxs("group",{position:[0,0,-512],children:[s.map(c=>Fe.jsx("group",{position:[c.x*mi.DRAW_CHAR_WIDTH(),c.y*mi.DRAW_CHAR_HEIGHT(),0],children:Fe.jsx(aF,{rect:c})},c.name)),e&&Fe.jsxs(Xh.Fragment,{children:[Fe.jsx("group",{position:[0,0,800],children:Fe.jsx(Uge,{width:n.cols,height:n.rows,alpha:.14})}),Fe.jsx("group",{position:[e.x*mi.DRAW_CHAR_WIDTH(),e.y*mi.DRAW_CHAR_HEIGHT(),900],children:Fe.jsx(aF,{rect:e,shouldclose:o})})]},e.name)]})})}const WEe=250,$Ee=249,dE=Kr.BLUE,qEe=Kr.WHITE,Wg=Kr.DKBLUE,XEe=Kr.DKGRAY,qj=Kr.BLACK,Xj=at.createContext({sendmessage(){}});function ey(n,e,t,r,i){const s=dd(i);i.iseven=i.y%2===0,i.active.bg=e&&!n?qj:Wg,i.active.leftedge=s.left,i.active.rightedge=s.right,i.active.topedge=s.top,i.active.bottomedge=s.bottom,i.x=i.active.leftedge+t,i.y=i.active.topedge+r}function zv(n,e,t,r,i,s,o,a){const c=dd(i);i.iseven=i.y%2===0,i.active.bg=Wg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+t,i.y=i.active.topedge+r}function KEe(n){let e=0;return n.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function YEe(n){return n.reduce((e,t)=>{const r=t.code.length;return r>e?r:e},0)}function JEe(n,e){for(let t=0;t<e.length;++t)if(n<=e[t].end)return t;return 0}function Kj(n){return fe(n)?n.value:void 0}function FN({context:n}){const e=dd(n);for(let t=e.top;t<=e.bottom;++t)for(let r=e.left;r<=e.right;++r){let i=0;(r+t)%2===0&&(i=Math.abs(Math.round(Math.cos(r*t*.01)))?WEe:$Ee),aa(n,n.width,n.height,r,t,{char:i,color:dE,bg:Wg})}return null}function QEe(n,e,t,r){const i=n.slice(0,e),s=n.slice(e+t);return`${i}${r??""}${s}`}function ZEe(n){const[e,t]=n.split(":"),r=fe(t)?e:"self",i=fe(t)?t:n;return[r,i]}const ebe=n=>{const e="nativeEvent"in n?n.nativeEvent:n;return{deltaX:e.deltaX||0,deltaY:e.deltaY||0,deltaZ:e.deltaZ||0,timeStamp:e.timeStamp}},tbe=n=>[n.deltaX,n.deltaY,n.deltaZ],RT=n=>{const e=tbe(n).map(Math.abs);return Math.max(...e)};var Eg;(function(n){n.ALL_OTHER_CHECKS_FAILED="ALL_OTHER_CHECKS_FAILED",n.NO_PREVIOUS_EVENT_TO_COMPARE="NO_PREVIOUS_EVENT_TO_COMPARE",n.PAST_TIMESTAMP_EVENT="PAST_TIMESTAMP_EVENT",n.ENOUGH_TIME_PASSED="ENOUGH_TIME_PASSED",n.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN="NON_DECREASING_DELTAS_OF_KNOWN_HUMAN",n.DELTA_MODULE_HAS_BEEN_INCREASING="DELTA_MODULE_HAS_BEEN_INCREASING"})(Eg||(Eg={}));class nbe{constructor({sensitivity:e=2,delay:t=100,increasingDeltasThreshold:r=3}={}){Dn(this,"sensitivity");Dn(this,"delay");Dn(this,"increasingDeltasThreshold");Dn(this,"previousEvents");this.sensitivity=Math.max(1,e),this.delay=Math.max(1,t),this.increasingDeltasThreshold=Math.max(2,r),this.previousEvents=[]}check(e){var s;if(!(("nativeEvent"in e?e.nativeEvent:e)instanceof Event))throw new Error(`"${e}" is not a valid event`);const r=ebe(e);if(RT(r)<this.sensitivity)return!1;const{isHuman:i}=this.isHuman(r);return i?this.previousEvents=[r]:r.timeStamp>(((s=this.previousEvents.at(-1))==null?void 0:s.timeStamp)||0)&&this.previousEvents.push(r),i}isHuman(e){const t=this.previousEvents.at(-1);if(!t)return{isHuman:!0,reason:Eg.NO_PREVIOUS_EVENT_TO_COMPARE};if(e.timeStamp<t.timeStamp)return{isHuman:!1,reason:Eg.PAST_TIMESTAMP_EVENT};if(e.timeStamp>t.timeStamp+this.delay)return{isHuman:!0,reason:Eg.ENOUGH_TIME_PASSED};const s=RT(e),o=RT(t);if(s>=o){if(this.previousEvents.length===1)return{isHuman:!0,reason:Eg.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN};if(this.increasingDeltasThreshold<=2||this.previousEvents.length>=this.increasingDeltasThreshold&&this.previousEvents.slice(-this.increasingDeltasThreshold).map(RT).every((u,h,d)=>h===0||u>d[h-1]))return{isHuman:!0,reason:Eg.DELTA_MODULE_HAS_BEEN_INCREASING}}return{isHuman:!1,reason:Eg.ALL_OTHER_CHECKS_FAILED}}}const rbe=new nbe({sensitivity:Ry?7:2}),cF=4,ibe=.75;function sbe(n){const e=Ii(n,-cF,cF);return Math.round(e*ibe)}function Yj({debug:n=!1,disabled:e=!1,blocking:t=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onScroll:l,...u}){return Fe.jsxs("group",{...u,children:[Fe.jsx(Wj,{blocking:t,cursor:r,visible:n,x:i,y:s,width:o,height:a,onWheel:h=>{e||!rbe.check(h)||l==null||l(sbe(h.deltaY))}}),c]})}function obe({tapeycursor:n,logrowtotalheight:e}){const t=Gf(),r=Hf(),i=zo(),s=Fa(),o=dd(r),a=i.buffer[i.bufferindex];let c=i.xcursor,l=i.xcursor,u=!1;fe(i.xselect)&&fe(i.yselect)&&(u=!0,c=Math.min(i.xcursor,i.xselect),l=Math.max(i.xcursor,i.xselect),i.xcursor!==i.xselect&&--l);const h=l-c+1,d=i.ycursor===0,p=u?a.substring(c,l+1):a;function _(z,F,V){i.bufferindex>0&&zo.setState({bufferindex:0}),i.buffer[0]=QEe(a,z,F,V),zo.setState({buffer:i.buffer,xselect:void 0,xcursor:z+(V??"").length})}function y(z){const F=i.buffer.length-1,V=Ii(z,0,F);zo.setState({bufferindex:V,xcursor:i.buffer[V].length,ycursor:0,xselect:void 0,yselect:void 0})}function S(z){z?fe(i.xselect)||zo.setState({xselect:i.xcursor,yselect:i.ycursor}):zo.setState({xselect:void 0,yselect:void 0})}function T(){fe(i.xselect)&&(zo.setState({xcursor:c,xselect:void 0,yselect:void 0}),_(c,h))}function A(){zo.setState({xcursor:a.length,ycursor:0,xselect:void 0,yselect:void 0})}ey(!1,!1,0,0,r);const R="main:0.21.38 - if lost try #help";r.x=o.right-R.length,ci(`$dkcyan${R}`,r,!0);const I="$196",D="$205".repeat(o.width-6);ey(!1,!1,0,o.height-2,r),ci(`  ${I}${D}${I}  `,r,!0);const L=a.padEnd(o.width," ");if(ey(!1,!1,0,o.height-1,r),Lj(L,r,!0),fe(i.xselect)&&fe(i.yselect)&&i.xcursor!==i.xselect){const z=Math.min(i.xcursor,i.xselect),F=Math.min(i.ycursor,i.yselect),V=Math.max(i.xcursor,i.xselect)-1,W=Math.max(i.ycursor,i.yselect);for(let X=F;X<=W;++X){const $=z+(o.bottom-X)*o.width,K=V+(o.bottom-X)*o.width;i1($,K,15,8,r)}}if(t){const z=o.left+i.xcursor,F=o.top+n;r1(z+F*r.width,"Ý",r)}return at.useEffect(()=>{let z=i.scroll;n<4&&z++,n>o.bottom-4&&z--,zo.setState({scroll:Math.round(Ii(z,0,e))})},[i.scroll,n,e,o.bottom]),r.changed(),Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Yj,{blocking:!0,x:o.left,y:o.top,width:o.width,height:o.height,onScroll:z=>{S(!1),zo.setState({ycursor:Ii(Math.round(i.ycursor-z),0,e)})}}),Fe.jsx(Vl,{keydown:z=>{const{key:F}=z,V=Ur(F),W=HC(z);switch(V){case"arrowleft":S(W.shift),W.ctrl?zo.setState({xcursor:0}):zo.setState({xcursor:Ii(i.xcursor-(W.alt?10:1),0,o.right)});break;case"arrowright":S(W.shift),W.ctrl?zo.setState({xcursor:d?a.length:o.right}):zo.setState({xcursor:Ii(i.xcursor+(W.alt?10:1),0,o.right)});break;case"arrowup":W.ctrl?y(i.bufferindex+1):(S(W.shift),zo.setState({ycursor:Ii(Math.round(i.ycursor+(W.alt?10:1)),0,e)}));break;case"arrowdown":W.ctrl?y(i.bufferindex-1):(S(W.shift),zo.setState({ycursor:Ii(Math.round(i.ycursor-(W.alt?10:1)),0,e)}));break;case"enter":{const X=u?p:a;X.length&&(d?(zo.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:["",X,...i.buffer.slice(1).filter($=>$!==X)]}),Hw("tape",X,s)):A());break}case"esc":case"escape":hk("tape",s);break;case"tab":n3("tape",!W.shift,s);break;case"delete":d?u?T():a.length>0&&_(i.xcursor,1):A();break;case"backspace":d?u?T():i.xcursor>0&&_(i.xcursor-1,1):A();break;default:if(W.ctrl)switch(V){case"a":zo.setState({xselect:0,yselect:0,xcursor:a.length,ycursor:0});break;case"c":d&&fe(navigator.clipboard)?navigator.clipboard.writeText(p).catch(X=>console.error(X)):A();break;case"v":d&&fe(navigator.clipboard)?navigator.clipboard.readText().then(X=>{const $=X.replaceAll("\r","");u?_(c,h,$):_(i.xcursor,0,$)}).catch(X=>console.error(X)):A();break;case"x":d&&fe(navigator.clipboard)?navigator.clipboard.writeText(p).then(()=>T()).catch(X=>console.error(X)):A();break}else W.alt||F.length===1&&(d&&i.xcursor<=a.length?u?(_(c,h,F),zo.setState({xselect:void 0})):_(i.xcursor,0,F):A());break}}})]})}function abe({blink:n,active:e,prefix:t,label:r,words:i,y:s}){const o=Hf(),a=at.useCallback(()=>{if(fe(navigator.clipboard)){const[,...l]=i,u=l.join(" ");navigator.clipboard.writeText(u).then(()=>wi("copyit","copied!")).catch(h=>console.error(h))}},[i]),c=t0(!!e);return ey(!!n,!!e,0,s,o),ci(`${t} $purple$16 $yellowCOPYIT ${c}${r}`,o,!0),o.changed(),e&&Fe.jsx(Vl,{OK_BUTTON:a})}function cbe({blink:n,active:e,prefix:t,label:r,words:i,y:s}){const o=Hf(),a=at.useContext(Xj),c=at.useCallback(()=>{const[u,h]=i;a.sendmessage(u,h)},[i,a]),l=t0(!!e);return ey(!!n,!!e,0,s,o),ci(`${t} $purple$16 ${l}${r}`,o,!0),o.changed(),e&&Fe.jsx(Vl,{OK_BUTTON:c})}function Jj({blink:n,active:e,text:t,y:r}){const i=Hf(),s=dd(i),o=t.startsWith("!");if(ey(!!n,!!e,0,r,i),i.active.bottomedge=s.bottom,ci(o?"":t,i,!0),o){const[a,...c]=t.slice(1).split("!"),l=`${c.join("!")}`;let u="PRESS ME";const h=[];t1(l,!0).tokens.forEach(S=>{switch(S.tokenType){case NN:u=S.image.slice(1);break;default:h.push(S.image);break}});const[p,..._]=h,y={blink:n,active:e,prefix:a,label:u,words:_,y:r};switch(Ur(p)){case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"copyit":return Fe.jsx(abe,{...y,words:h});default:case"hyperlink":return Fe.jsx(cbe,{...y,words:h})}}return null}function lbe(n){const e=Gf();return Fe.jsx(Jj,{active:!0,blink:e,...n})}function HR(){const n=Fa(),[e,t]=Kc(Zg(d=>[d.terminal.logs,d.editor.open])),r=Hf(),i=zo(),s=dd(r),o=e.map(d=>{const[,p,_,...y]=d;let S="$white";switch(p){case"debug":S="$yellow";break;case"error":S="$red";break}const T=y.map(I=>`${I}`).join(" "),A=T.startsWith("!"),R=`$blue[${S}${_}$blue]`;return`${A?"!":""}${R} ${T}`}),a=o.map(d=>{if(d.startsWith("!"))return 1;const p=DN(d,s.width,s.height);return(p==null?void 0:p.y)??1});let c=0,l=s.bottom-1;const u=a.map(d=>(l-=d,c+=d,l));++c;const h=s.bottom-i.ycursor+i.scroll;return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(FN,{context:r}),Fe.jsxs(Xj.Provider,{value:{sendmessage(d,p){const[_,y]=ZEe(d);if(_==="self"){const S=`#${y} ${p??""}`;Hw("tape",S,n)}else Vn.emit(`${_}:${y}`,"gadget",p,n)}},children:[o.map((d,p)=>{const _=u[p]+i.scroll,y=a[p],S=_+y;return S<0||_>s.bottom-1?null:!t&&h>=_&&h<S?Fe.jsx(lbe,{text:d,y:_},p):Fe.jsx(Jj,{text:d,y:_},p)}),!t&&Fe.jsx(obe,{tapeycursor:h,logrowtotalheight:c})]})]})}function ube(){const n=Hf(),e=dd(n);for(let p=e.top;p<e.bottom;++p)aa(n,n.width,n.height,e.left,p,{char:179,color:dE,bg:Wg}),aa(n,n.width,n.height,e.right,p,{char:179,color:dE,bg:Wg});const t="$196".repeat(e.width-4);zv(!1,!1,0,0,n,0,0,0),ci(`$213$205$187${t}$191`,n,!0);const r="$205".repeat(e.width-2);zv(!1,!1,0,e.height-1,n,0,0,0),ci(`$212${r}$190`,n,!0);const[i,s]=Kc(Zg(p=>[p.editor.type,p.editor.title])),o=Gf(),a="$205".repeat(e.width-4);zv(!1,!1,0,1,n,0,0,0),ci(`$179$${o?"7":"232"}$200${a}$181`,n,!0);const l=` ${`[${i}] `}${s} `,u=DN(l,e.width,e.height),h=(u==null?void 0:u.measuredwidth)??1,d=Math.round(e.width*.5)-Math.round(h*.5);return zv(!1,!1,d,0,n,0,0,0),ci(l,n,!0),n.changed(),null}function hbe({xcursor:n,ycursor:e,xoffset:t,yoffset:r,rows:i,codepage:s}){var $,K;const o=Gf(),a=Hf(),c=at.useRef(),l=go(),u=dd(a),h=Kc(te=>te.editor.player),d=Kj(s),p=fe(d)?d.toJSON():"",_=i.length-1,y=n+1-t,S=e+2-r;if(fe(s)){const te=(($=c.current)==null?void 0:$.x)!==y||((K=c.current)==null?void 0:K.y)!==S;if(o||te){const Q=u.left+y,ne=u.top+S;ne>u.top+1&&ne<u.bottom&&Q>u.left&&Q<u.right&&r1(Q+ne*a.width,"Ý",a)}}c.current={x:y,y:S};const T=i[_].end,A=i[e];let R=l.cursor,I=l.cursor,U=!1;fe(l.select)&&(U=!0,R=Math.min(l.cursor,l.select),I=Math.max(l.cursor,l.select),l.cursor!==l.select&&--I);const D=I-R+1,L=U?p.substring(R,I+1):p;function z(te){te?fe(l.select)||go.setState({select:l.cursor}):go.setState({select:void 0})}function F(te,Q,ne){Q>0&&(d==null||d.delete(te,Q)),fe(ne)&&(d==null||d.insert(te,ne)),go.setState({cursor:te+(ne??"").length,select:void 0})}function V(){fe(l.select)&&(go.setState({cursor:R}),F(R,D))}function W(){go.setState({cursor:T,select:void 0})}const X=at.useCallback(function(Q){const ne=Math.round(e+Q);if(ne<0)go.setState({cursor:0});else if(ne>_)go.setState({cursor:T});else{const G=i[ne];go.setState({cursor:G.start+Math.min(n,G.code.length-1)})}},[T,i,_,n,e]);return a.changed(),Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(Yj,{blocking:!0,x:u.left,y:u.top,width:u.width,height:u.height,onScroll:te=>X(te*.75)}),Fe.jsx(Vl,{keydown:te=>{if(!fe(d))return;const{key:Q}=te,ne=Ur(Q),G=HC(te);switch(ne){case"arrowleft":if(z(G.shift),G.ctrl)go.setState({cursor:A.start});else{const J=l.cursor-(G.alt?10:1);go.setState({cursor:Ii(J,0,T)})}break;case"arrowright":if(z(G.shift),G.ctrl)go.setState({cursor:A.end});else{const J=l.cursor+(G.alt?10:1);go.setState({cursor:Ii(J,0,T)})}break;case"arrowup":z(G.shift),G.ctrl?go.setState({cursor:0}):X(G.alt?-10:-1);break;case"arrowdown":z(G.shift),G.ctrl?go.setState({cursor:T}):X(G.alt?10:1);break;case"enter":fe(d)&&(d.insert(l.cursor,`
`),go.setState({cursor:l.cursor+1}));break;case"esc":case"escape":G.shift||G.alt||G.ctrl?hk("tape",h):vJ("editor",h);break;case"tab":n3("editor",!G.shift,h);break;case"delete":U?V():F(l.cursor,1);break;case"backspace":U?V():p.length>0&&F(Math.max(l.cursor-1,0),1);break;default:if(G.ctrl)switch(ne){case"a":go.setState({cursor:T,select:0});break;case"c":fe(navigator.clipboard)?navigator.clipboard.writeText(L).catch(J=>ti("tape","clipboard",J)):W();break;case"v":fe(navigator.clipboard)?navigator.clipboard.readText().then(J=>{const re=J.replaceAll("\r","");U?F(R,D,re):F(l.cursor,0,re)}).catch(J=>ti("tape","clipboard",J)):W();break;case"x":fe(navigator.clipboard)?navigator.clipboard.writeText(L).then(()=>V()).catch(J=>ti("tape","clipboard",J)):W();break;case"p":Hw("editor",L,h),wi("editor",`running: ${L.substring(0,18)}`);break}else if(!G.alt){if(Q.length===1)if(U)F(R,D,Q);else{const J=l.cursor+Q.length;d.insert(l.cursor,Q),go.setState({cursor:J})}}break}}})]})}function dbe({ycursor:n,xoffset:e,yoffset:t,rows:r,codepage:i}){const s=Gf(),o=Hf(),a=go(),c=dd(o);if(!fe(i)){const p=(s?"|":"-").repeat(3);return zv(!1,!1,0,0,o,1,2,1),ci(` ${p} LOADING ${p}`,o,!0),null}let l=a.cursor,u=a.cursor,h=!1;fe(a.select)&&(h=!0,l=Math.min(a.cursor,a.select),u=Math.max(a.cursor,a.select),a.cursor!==a.select&&--u);const d=c.left+1;zv(!1,!1,-e,-t,o,1,2,1);for(let p=0;p<r.length;++p){if(o.y<=c.top+1){++o.y;continue}const _=r[p],y=p===n,S=_.code.replaceAll(`
`,"");if(o.x=d-e,o.iseven=o.y%2===0,o.active.bg=y?qj:Wg,o.disablewrap=!0,Lj(`${S} `,o,!1),h&&_.start<=u&&_.end>=l){const T=Math.max(_.start,l)-_.start-e,A=Math.min(_.end,u)-_.start-e,R=c.width-3,I=1+o.y*o.width,U=Math.max(0,T),D=Math.min(R,A);U<=R&&D>=d&&i1(I+U,I+D,qEe,XEe,o)}if(++o.y,o.y>=c.bottom)break}return o.disablewrap=!1,null}function GR(){const[n]=Kc(Zg(y=>[y.editor])),e=Hf(),t=go(),r=M4(i3(n.book,n.page)),i=dd(e);at.useEffect(()=>(xJ("editor",n.book,n.page,n.player),()=>{wJ("editor",n.book,n.page,n.player)}),[n.book,n.page,n.player]);const s=Kj(r),o=fe(s)?s.toJSON():"",a=KEe(o),c=JEe(t.cursor,a),l=t.cursor-a[c].start,u=YEe(a),h={rows:a,xcursor:l,ycursor:c,codepage:r,xoffset:t.xscroll,yoffset:t.yscroll},d=32,p=(Math.round(u/d)+1)*d,_=a.length;return at.useEffect(()=>{let y=t.xscroll;const S=l-y,T=i.width-3;let A=Math.round(Ii(Math.abs(S)*.5,1,d));A<8&&(A=1),S>T-8&&(y+=A),S<8&&(y-=A);let R=t.yscroll;const I=c-R,U=i.height-4,D=Math.round(U*.5);let L=Math.round(Ii(Math.abs(I)*.25,1,D));L<8&&(L=1),I>U-4&&(R+=L),I<4&&(R-=L),setTimeout(()=>go.setState({xscroll:Math.round(Ii(y,0,p)),yscroll:Math.round(Ii(R,0,_))}),16)},[l,p,t.xscroll,c,_,t.yscroll,i.width,i.height]),Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(FN,{context:e}),Fe.jsx(ube,{}),Fe.jsx(dbe,{...h}),Fe.jsx(hbe,{...h})]})}function lF(n,e,t,r,i){return{...i,x:n,y:e,reset:{...i.reset,topedge:e,leftedge:n,rightedge:t,bottomedge:r},active:{...i.reset,topedge:e,leftedge:n,rightedge:t,bottomedge:r}}}function fbe({context:n}){const[e,t]=Kc(Zg(l=>[l.layout,l.editor.open])),r=n.width-1,i=n.height-1,s=dd(n),o=Math.floor(s.height*.5),a=at.useMemo(()=>lF(0,0,r,o-1,n),[o,r,n]),c=at.useMemo(()=>lF(0,o,r,i,n),[o,r,i,n]);if(t){let l,u;switch(e){case Yc.SPLIT_Y:case Yc.SPLIT_Y_ALT:l=a,u=c;break}if(fe(l)&&fe(u))switch(e){case Yc.SPLIT_Y:return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(W0.Provider,{value:l,children:Fe.jsx(HR,{})}),Fe.jsx(W0.Provider,{value:u,children:Fe.jsx(GR,{})})]});case Yc.SPLIT_Y_ALT:return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(W0.Provider,{value:l,children:Fe.jsx(GR,{})}),Fe.jsx(W0.Provider,{value:u,children:Fe.jsx(HR,{})})]})}}return Fe.jsx(Fe.Fragment,{children:Fe.jsx(W0.Provider,{value:n,children:t?Fe.jsx(GR,{}):Fe.jsx(HR,{})})})}function pbe(){const n=UN();let e=0,t=n.rows;const[r,i]=Kc(Zg(c=>[c.layout,c.terminal.open]));switch(r){case Yc.TOP:t=Math.round(n.rows*.5);break;case Yc.BOTTOM:t=Math.round(n.rows*.5),e=n.rows-t;break;default:case Yc.FULL:break}const s=s1(n.cols,t,0,dE,Wg),o={...Xy(n.cols,t,dE,Wg),...s.getState()};if(n.cols<10||n.rows<10)return null;const a=Fa();return Fe.jsx(a1,{store:s,children:Fe.jsxs("group",{position:[0,0,900],children:[i&&Fe.jsx(BM,{width:n.cols,height:n.rows,top:e,left:0,right:n.cols-1,bottom:e+t-1}),i?Fe.jsxs(rb,{blockhotkeys:!0,children:[Fe.jsx(FN,{context:o}),Fe.jsx(fbe,{context:o}),Fe.jsx("group",{position:[0,e*mi.DRAW_CHAR_HEIGHT(),0],children:Fe.jsx(c1,{width:n.cols,height:t})})]}):Fe.jsx(NS,{hotkey:"Shift+?",children:()=>t3("tape",a)})]})})}var Qj={exports:{}};/*! For license information please see amazon-ivs-web-broadcast.js.LICENSE.txt */(function(n,e){(function(t,r){n.exports=r()})(self,()=>(()=>{var t={9669:(o,a,c)=>{o.exports=c(1609)},5448:(o,a,c)=>{var l=c(4867),u=c(6026),h=c(4372),d=c(5327),p=c(4097),_=c(4109),y=c(7985),S=c(7874),T=c(2648),A=c(644),R=c(205);o.exports=function(I){return new Promise(function(U,D){var L,z=I.data,F=I.headers,V=I.responseType;function W(){I.cancelToken&&I.cancelToken.unsubscribe(L),I.signal&&I.signal.removeEventListener("abort",L)}l.isFormData(z)&&l.isStandardBrowserEnv()&&delete F["Content-Type"];var X=new XMLHttpRequest;if(I.auth){var $=I.auth.username||"",K=I.auth.password?unescape(encodeURIComponent(I.auth.password)):"";F.Authorization="Basic "+btoa($+":"+K)}var te=p(I.baseURL,I.url);function Q(){if(X){var J="getAllResponseHeaders"in X?_(X.getAllResponseHeaders()):null,re={data:V&&V!=="text"&&V!=="json"?X.response:X.responseText,status:X.status,statusText:X.statusText,headers:J,config:I,request:X};u(function(ue){U(ue),W()},function(ue){D(ue),W()},re),X=null}}if(X.open(I.method.toUpperCase(),d(te,I.params,I.paramsSerializer),!0),X.timeout=I.timeout,"onloadend"in X?X.onloadend=Q:X.onreadystatechange=function(){X&&X.readyState===4&&(X.status!==0||X.responseURL&&X.responseURL.indexOf("file:")===0)&&setTimeout(Q)},X.onabort=function(){X&&(D(new T("Request aborted",T.ECONNABORTED,I,X)),X=null)},X.onerror=function(){D(new T("Network Error",T.ERR_NETWORK,I,X,X)),X=null},X.ontimeout=function(){var J=I.timeout?"timeout of "+I.timeout+"ms exceeded":"timeout exceeded",re=I.transitional||S;I.timeoutErrorMessage&&(J=I.timeoutErrorMessage),D(new T(J,re.clarifyTimeoutError?T.ETIMEDOUT:T.ECONNABORTED,I,X)),X=null},l.isStandardBrowserEnv()){var ne=(I.withCredentials||y(te))&&I.xsrfCookieName?h.read(I.xsrfCookieName):void 0;ne&&(F[I.xsrfHeaderName]=ne)}"setRequestHeader"in X&&l.forEach(F,function(J,re){z===void 0&&re.toLowerCase()==="content-type"?delete F[re]:X.setRequestHeader(re,J)}),l.isUndefined(I.withCredentials)||(X.withCredentials=!!I.withCredentials),V&&V!=="json"&&(X.responseType=I.responseType),typeof I.onDownloadProgress=="function"&&X.addEventListener("progress",I.onDownloadProgress),typeof I.onUploadProgress=="function"&&X.upload&&X.upload.addEventListener("progress",I.onUploadProgress),(I.cancelToken||I.signal)&&(L=function(J){X&&(D(!J||J&&J.type?new A:J),X.abort(),X=null)},I.cancelToken&&I.cancelToken.subscribe(L),I.signal&&(I.signal.aborted?L():I.signal.addEventListener("abort",L))),z||(z=null);var G=R(te);G&&["http","https","file"].indexOf(G)===-1?D(new T("Unsupported protocol "+G+":",T.ERR_BAD_REQUEST,I)):X.send(z)})}},1609:(o,a,c)=>{var l=c(4867),u=c(1849),h=c(321),d=c(7185),p=function _(y){var S=new h(y),T=u(h.prototype.request,S);return l.extend(T,h.prototype,S),l.extend(T,S),T.create=function(A){return _(d(y,A))},T}(c(5546));p.Axios=h,p.CanceledError=c(644),p.CancelToken=c(4972),p.isCancel=c(6502),p.VERSION=c(7288).version,p.toFormData=c(7675),p.AxiosError=c(2648),p.Cancel=p.CanceledError,p.all=function(_){return Promise.all(_)},p.spread=c(8713),p.isAxiosError=c(6268),o.exports=p,o.exports.default=p},4972:(o,a,c)=>{var l=c(644);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(_){d=_});var p=this;this.promise.then(function(_){if(p._listeners){var y,S=p._listeners.length;for(y=0;y<S;y++)p._listeners[y](_);p._listeners=null}}),this.promise.then=function(_){var y,S=new Promise(function(T){p.subscribe(T),y=T}).then(_);return S.cancel=function(){p.unsubscribe(y)},S},h(function(_){p.reason||(p.reason=new l(_),d(p.reason))})}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var d=this._listeners.indexOf(h);d!==-1&&this._listeners.splice(d,1)}},u.source=function(){var h;return{token:new u(function(d){h=d}),cancel:h}},o.exports=u},644:(o,a,c)=>{var l=c(2648);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(4867).inherits(u,l,{__CANCEL__:!0}),o.exports=u},6502:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},321:(o,a,c)=>{var l=c(4867),u=c(5327),h=c(782),d=c(3572),p=c(7185),_=c(4097),y=c(4875),S=y.validators;function T(A){this.defaults=A,this.interceptors={request:new h,response:new h}}T.prototype.request=function(A,R){typeof A=="string"?(R=R||{}).url=A:R=A||{},(R=p(this.defaults,R)).method?R.method=R.method.toLowerCase():this.defaults.method?R.method=this.defaults.method.toLowerCase():R.method="get";var I=R.transitional;I!==void 0&&y.assertOptions(I,{silentJSONParsing:S.transitional(S.boolean),forcedJSONParsing:S.transitional(S.boolean),clarifyTimeoutError:S.transitional(S.boolean)},!1);var U=[],D=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(R)===!1||(D=D&&$.synchronous,U.unshift($.fulfilled,$.rejected))});var L,z=[];if(this.interceptors.response.forEach(function($){z.push($.fulfilled,$.rejected)}),!D){var F=[d,void 0];for(Array.prototype.unshift.apply(F,U),F=F.concat(z),L=Promise.resolve(R);F.length;)L=L.then(F.shift(),F.shift());return L}for(var V=R;U.length;){var W=U.shift(),X=U.shift();try{V=W(V)}catch($){X($);break}}try{L=d(V)}catch($){return Promise.reject($)}for(;z.length;)L=L.then(z.shift(),z.shift());return L},T.prototype.getUri=function(A){A=p(this.defaults,A);var R=_(A.baseURL,A.url);return u(R,A.params,A.paramsSerializer)},l.forEach(["delete","get","head","options"],function(A){T.prototype[A]=function(R,I){return this.request(p(I||{},{method:A,url:R,data:(I||{}).data}))}}),l.forEach(["post","put","patch"],function(A){function R(I){return function(U,D,L){return this.request(p(L||{},{method:A,headers:I?{"Content-Type":"multipart/form-data"}:{},url:U,data:D}))}}T.prototype[A]=R(),T.prototype[A+"Form"]=R(!0)}),o.exports=T},2648:(o,a,c)=>{var l=c(4867);function u(p,_,y,S,T){Error.call(this),this.message=p,this.name="AxiosError",_&&(this.code=_),y&&(this.config=y),S&&(this.request=S),T&&(this.response=T)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,d={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(p){d[p]={value:p}}),Object.defineProperties(u,d),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(p,_,y,S,T,A){var R=Object.create(h);return l.toFlatObject(p,R,function(I){return I!==Error.prototype}),u.call(R,p.message,_,y,S,T),R.name=p.name,A&&Object.assign(R,A),R},o.exports=u},782:(o,a,c)=>{var l=c(4867);function u(){this.handlers=[]}u.prototype.use=function(h,d,p){return this.handlers.push({fulfilled:h,rejected:d,synchronous:!!p&&p.synchronous,runWhen:p?p.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,function(d){d!==null&&h(d)})},o.exports=u},4097:(o,a,c)=>{var l=c(1793),u=c(7303);o.exports=function(h,d){return h&&!l(d)?u(h,d):d}},3572:(o,a,c)=>{var l=c(4867),u=c(8527),h=c(6502),d=c(5546),p=c(644);function _(y){if(y.cancelToken&&y.cancelToken.throwIfRequested(),y.signal&&y.signal.aborted)throw new p}o.exports=function(y){return _(y),y.headers=y.headers||{},y.data=u.call(y,y.data,y.headers,y.transformRequest),y.headers=l.merge(y.headers.common||{},y.headers[y.method]||{},y.headers),l.forEach(["delete","get","head","post","put","patch","common"],function(S){delete y.headers[S]}),(y.adapter||d.adapter)(y).then(function(S){return _(y),S.data=u.call(y,S.data,S.headers,y.transformResponse),S},function(S){return h(S)||(_(y),S&&S.response&&(S.response.data=u.call(y,S.response.data,S.response.headers,y.transformResponse))),Promise.reject(S)})}},7185:(o,a,c)=>{var l=c(4867);o.exports=function(u,h){h=h||{};var d={};function p(R,I){return l.isPlainObject(R)&&l.isPlainObject(I)?l.merge(R,I):l.isPlainObject(I)?l.merge({},I):l.isArray(I)?I.slice():I}function _(R){return l.isUndefined(h[R])?l.isUndefined(u[R])?void 0:p(void 0,u[R]):p(u[R],h[R])}function y(R){if(!l.isUndefined(h[R]))return p(void 0,h[R])}function S(R){return l.isUndefined(h[R])?l.isUndefined(u[R])?void 0:p(void 0,u[R]):p(void 0,h[R])}function T(R){return R in h?p(u[R],h[R]):R in u?p(void 0,u[R]):void 0}var A={url:y,method:y,data:y,baseURL:S,transformRequest:S,transformResponse:S,paramsSerializer:S,timeout:S,timeoutMessage:S,withCredentials:S,adapter:S,responseType:S,xsrfCookieName:S,xsrfHeaderName:S,onUploadProgress:S,onDownloadProgress:S,decompress:S,maxContentLength:S,maxBodyLength:S,beforeRedirect:S,transport:S,httpAgent:S,httpsAgent:S,cancelToken:S,socketPath:S,responseEncoding:S,validateStatus:T};return l.forEach(Object.keys(u).concat(Object.keys(h)),function(R){var I=A[R]||_,U=I(R);l.isUndefined(U)&&I!==T||(d[R]=U)}),d}},6026:(o,a,c)=>{var l=c(2648);o.exports=function(u,h,d){var p=d.config.validateStatus;d.status&&p&&!p(d.status)?h(new l("Request failed with status code "+d.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d)):u(d)}},8527:(o,a,c)=>{var l=c(4867),u=c(5546);o.exports=function(h,d,p){var _=this||u;return l.forEach(p,function(y){h=y.call(_,h,d)}),h}},5546:(o,a,c)=>{var l=c(4867),u=c(6016),h=c(2648),d=c(7874),p=c(7675),_={"Content-Type":"application/x-www-form-urlencoded"};function y(A,R){!l.isUndefined(A)&&l.isUndefined(A["Content-Type"])&&(A["Content-Type"]=R)}var S,T={transitional:d,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(S=c(5448)),S),transformRequest:[function(A,R){if(u(R,"Accept"),u(R,"Content-Type"),l.isFormData(A)||l.isArrayBuffer(A)||l.isBuffer(A)||l.isStream(A)||l.isFile(A)||l.isBlob(A))return A;if(l.isArrayBufferView(A))return A.buffer;if(l.isURLSearchParams(A))return y(R,"application/x-www-form-urlencoded;charset=utf-8"),A.toString();var I,U=l.isObject(A),D=R&&R["Content-Type"];if((I=l.isFileList(A))||U&&D==="multipart/form-data"){var L=this.env&&this.env.FormData;return p(I?{"files[]":A}:A,L&&new L)}return U||D==="application/json"?(y(R,"application/json"),function(z,F,V){if(l.isString(z))try{return(F||JSON.parse)(z),l.trim(z)}catch(W){if(W.name!=="SyntaxError")throw W}return(0,JSON.stringify)(z)}(A)):A}],transformResponse:[function(A){var R=this.transitional||T.transitional,I=R&&R.silentJSONParsing,U=R&&R.forcedJSONParsing,D=!I&&this.responseType==="json";if(D||U&&l.isString(A)&&A.length)try{return JSON.parse(A)}catch(L){if(D)throw L.name==="SyntaxError"?h.from(L,h.ERR_BAD_RESPONSE,this,null,this.response):L}return A}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1623)},validateStatus:function(A){return A>=200&&A<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],function(A){T.headers[A]={}}),l.forEach(["post","put","patch"],function(A){T.headers[A]=l.merge(_)}),o.exports=T},7874:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:o=>{o.exports={version:"0.27.2"}},1849:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},5327:(o,a,c)=>{var l=c(4867);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(h,d,p){if(!d)return h;var _;if(p)_=p(d);else if(l.isURLSearchParams(d))_=d.toString();else{var y=[];l.forEach(d,function(T,A){T!=null&&(l.isArray(T)?A+="[]":T=[T],l.forEach(T,function(R){l.isDate(R)?R=R.toISOString():l.isObject(R)&&(R=JSON.stringify(R)),y.push(u(A)+"="+u(R))}))}),_=y.join("&")}if(_){var S=h.indexOf("#");S!==-1&&(h=h.slice(0,S)),h+=(h.indexOf("?")===-1?"?":"&")+_}return h}},7303:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},4372:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?{write:function(u,h,d,p,_,y){var S=[];S.push(u+"="+encodeURIComponent(h)),l.isNumber(d)&&S.push("expires="+new Date(d).toGMTString()),l.isString(p)&&S.push("path="+p),l.isString(_)&&S.push("domain="+_),y===!0&&S.push("secure"),document.cookie=S.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},6268:(o,a,c)=>{var l=c(4867);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},7985:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");function p(_){var y=_;return h&&(d.setAttribute("href",y),y=d.href),d.setAttribute("href",y),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return u=p(window.location.href),function(_){var y=l.isString(_)?p(_):_;return y.protocol===u.protocol&&y.host===u.host}}():function(){return!0}},6016:(o,a,c)=>{var l=c(4867);o.exports=function(u,h){l.forEach(u,function(d,p){p!==h&&p.toUpperCase()===h.toUpperCase()&&(u[h]=d,delete u[p])})}},1623:o=>{o.exports=null},4109:(o,a,c)=>{var l=c(4867),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(h){var d,p,_,y={};return h&&l.forEach(h.split(`
`),function(S){if(_=S.indexOf(":"),d=l.trim(S.substr(0,_)).toLowerCase(),p=l.trim(S.substr(_+1)),d){if(y[d]&&u.indexOf(d)>=0)return;y[d]=d==="set-cookie"?(y[d]?y[d]:[]).concat([p]):y[d]?y[d]+", "+p:p}}),y}},205:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},8713:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},7675:(o,a,c)=>{var l=c(4867);o.exports=function(u,h){h=h||new FormData;var d=[];function p(_){return _===null?"":l.isDate(_)?_.toISOString():l.isArrayBuffer(_)||l.isTypedArray(_)?typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}return function _(y,S){if(l.isPlainObject(y)||l.isArray(y)){if(d.indexOf(y)!==-1)throw Error("Circular reference detected in "+S);d.push(y),l.forEach(y,function(T,A){if(!l.isUndefined(T)){var R,I=S?S+"."+A:A;if(T&&!S&&typeof T=="object"){if(l.endsWith(A,"{}"))T=JSON.stringify(T);else if(l.endsWith(A,"[]")&&(R=l.toArray(T)))return void R.forEach(function(U){!l.isUndefined(U)&&h.append(I,p(U))})}_(T,I)}}),d.pop()}else h.append(S,p(y))}(u),h}},4875:(o,a,c)=>{var l=c(7288).version,u=c(2648),h={};["object","boolean","number","function","string","symbol"].forEach(function(p,_){h[p]=function(y){return typeof y===p||"a"+(_<1?"n ":" ")+p}});var d={};h.transitional=function(p,_,y){function S(T,A){return"[Axios v"+l+"] Transitional option '"+T+"'"+A+(y?". "+y:"")}return function(T,A,R){if(p===!1)throw new u(S(A," has been removed"+(_?" in "+_:"")),u.ERR_DEPRECATED);return _&&!d[A]&&(d[A]=!0,console.warn(S(A," has been deprecated since v"+_+" and will be removed in the near future"))),!p||p(T,A,R)}},o.exports={assertOptions:function(p,_,y){if(typeof p!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var S=Object.keys(p),T=S.length;T-- >0;){var A=S[T],R=_[A];if(R){var I=p[A],U=I===void 0||R(I,A,p);if(U!==!0)throw new u("option "+A+" must be "+U,u.ERR_BAD_OPTION_VALUE)}else if(y!==!0)throw new u("Unknown option "+A,u.ERR_BAD_OPTION)}},validators:h}},4867:(o,a,c)=>{var l,u=c(1849),h=Object.prototype.toString,d=(l=Object.create(null),function(X){var $=h.call(X);return l[$]||(l[$]=$.slice(8,-1).toLowerCase())});function p(X){return X=X.toLowerCase(),function($){return d($)===X}}function _(X){return Array.isArray(X)}function y(X){return X===void 0}var S=p("ArrayBuffer");function T(X){return X!==null&&typeof X=="object"}function A(X){if(d(X)!=="object")return!1;var $=Object.getPrototypeOf(X);return $===null||$===Object.prototype}var R=p("Date"),I=p("File"),U=p("Blob"),D=p("FileList");function L(X){return h.call(X)==="[object Function]"}var z=p("URLSearchParams");function F(X,$){if(X!=null)if(typeof X!="object"&&(X=[X]),_(X))for(var K=0,te=X.length;K<te;K++)$.call(null,X[K],K,X);else for(var Q in X)Object.prototype.hasOwnProperty.call(X,Q)&&$.call(null,X[Q],Q,X)}var V,W=(V=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(X){return V&&X instanceof V});o.exports={isArray:_,isArrayBuffer:S,isBuffer:function(X){return X!==null&&!y(X)&&X.constructor!==null&&!y(X.constructor)&&typeof X.constructor.isBuffer=="function"&&X.constructor.isBuffer(X)},isFormData:function(X){var $="[object FormData]";return X&&(typeof FormData=="function"&&X instanceof FormData||h.call(X)===$||L(X.toString)&&X.toString()===$)},isArrayBufferView:function(X){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(X):X&&X.buffer&&S(X.buffer)},isString:function(X){return typeof X=="string"},isNumber:function(X){return typeof X=="number"},isObject:T,isPlainObject:A,isUndefined:y,isDate:R,isFile:I,isBlob:U,isFunction:L,isStream:function(X){return T(X)&&L(X.pipe)},isURLSearchParams:z,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:F,merge:function X(){var $={};function K(ne,G){A($[G])&&A(ne)?$[G]=X($[G],ne):A(ne)?$[G]=X({},ne):_(ne)?$[G]=ne.slice():$[G]=ne}for(var te=0,Q=arguments.length;te<Q;te++)F(arguments[te],K);return $},extend:function(X,$,K){return F($,function(te,Q){X[Q]=K&&typeof te=="function"?u(te,K):te}),X},trim:function(X){return X.trim?X.trim():X.replace(/^\s+|\s+$/g,"")},stripBOM:function(X){return X.charCodeAt(0)===65279&&(X=X.slice(1)),X},inherits:function(X,$,K,te){X.prototype=Object.create($.prototype,te),X.prototype.constructor=X,K&&Object.assign(X.prototype,K)},toFlatObject:function(X,$,K){var te,Q,ne,G={};$=$||{};do{for(Q=(te=Object.getOwnPropertyNames(X)).length;Q-- >0;)G[ne=te[Q]]||($[ne]=X[ne],G[ne]=!0);X=Object.getPrototypeOf(X)}while(X&&(!K||K(X,$))&&X!==Object.prototype);return $},kindOf:d,kindOfTest:p,endsWith:function(X,$,K){X=String(X),(K===void 0||K>X.length)&&(K=X.length),K-=$.length;var te=X.indexOf($,K);return te!==-1&&te===K},toArray:function(X){if(!X)return null;var $=X.length;if(y($))return null;for(var K=new Array($);$-- >0;)K[$]=X[$];return K},isTypedArray:W,isFileList:D}},1206:function(o){o.exports=function(a){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return a[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=a,l.c=c,l.d=function(u,h,d){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:d})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var d=Object.create(null);if(l.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var p in u)l.d(d,p,(function(_){return u[_]}).bind(null,p));return d},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)}({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=function(){function d(){}return d.getFirstMatch=function(p,_){var y=_.match(p);return y&&y.length>0&&y[1]||""},d.getSecondMatch=function(p,_){var y=_.match(p);return y&&y.length>1&&y[2]||""},d.matchAndReturnConst=function(p,_,y){if(p.test(_))return y},d.getWindowsVersionName=function(p){switch(p){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},d.getMacOSVersionName=function(p){var _=p.split(".").splice(0,2).map(function(y){return parseInt(y,10)||0});if(_.push(0),_[0]===10)switch(_[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},d.getAndroidVersionName=function(p){var _=p.split(".").splice(0,2).map(function(y){return parseInt(y,10)||0});if(_.push(0),!(_[0]===1&&_[1]<5))return _[0]===1&&_[1]<6?"Cupcake":_[0]===1&&_[1]>=6?"Donut":_[0]===2&&_[1]<2?"Eclair":_[0]===2&&_[1]===2?"Froyo":_[0]===2&&_[1]>2?"Gingerbread":_[0]===3?"Honeycomb":_[0]===4&&_[1]<1?"Ice Cream Sandwich":_[0]===4&&_[1]<4?"Jelly Bean":_[0]===4&&_[1]>=4?"KitKat":_[0]===5?"Lollipop":_[0]===6?"Marshmallow":_[0]===7?"Nougat":_[0]===8?"Oreo":_[0]===9?"Pie":void 0},d.getVersionPrecision=function(p){return p.split(".").length},d.compareVersions=function(p,_,y){y===void 0&&(y=!1);var S=d.getVersionPrecision(p),T=d.getVersionPrecision(_),A=Math.max(S,T),R=0,I=d.map([p,_],function(U){var D=A-d.getVersionPrecision(U),L=U+new Array(D+1).join(".0");return d.map(L.split("."),function(z){return new Array(20-z.length).join("0")+z}).reverse()});for(y&&(R=A-Math.min(S,T)),A-=1;A>=R;){if(I[0][A]>I[1][A])return 1;if(I[0][A]===I[1][A]){if(A===R)return 0;A-=1}else if(I[0][A]<I[1][A])return-1}},d.map=function(p,_){var y,S=[];if(Array.prototype.map)return Array.prototype.map.call(p,_);for(y=0;y<p.length;y+=1)S.push(_(p[y]));return S},d.find=function(p,_){var y,S;if(Array.prototype.find)return Array.prototype.find.call(p,_);for(y=0,S=p.length;y<S;y+=1){var T=p[y];if(_(T,y))return T}},d.assign=function(p){for(var _,y,S=p,T=arguments.length,A=new Array(T>1?T-1:0),R=1;R<T;R++)A[R-1]=arguments[R];if(Object.assign)return Object.assign.apply(Object,[p].concat(A));var I=function(){var U=A[_];typeof U=="object"&&U!==null&&Object.keys(U).forEach(function(D){S[D]=U[D]})};for(_=0,y=A.length;_<y;_+=1)I();return p},d.getBrowserAlias=function(p){return u.BROWSER_ALIASES_MAP[p]},d.getBrowserTypeByAlias=function(p){return u.BROWSER_MAP[p]||""},d}();c.default=h,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},d=l(18);function p(y,S){for(var T=0;T<S.length;T++){var A=S[T];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(y,A.key,A)}}var _=function(){function y(){}var S,T,A;return y.getParser=function(R,I){if(I===void 0&&(I=!1),typeof R!="string")throw new Error("UserAgent should be a string");return new h.default(R,I)},y.parse=function(R){return new h.default(R).getResult()},S=y,A=[{key:"BROWSER_MAP",get:function(){return d.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return d.ENGINE_MAP}},{key:"OS_MAP",get:function(){return d.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return d.PLATFORMS_MAP}}],(T=null)&&p(S.prototype,T),A&&p(S,A),y}();c.default=_,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=y(l(92)),h=y(l(93)),d=y(l(94)),p=y(l(95)),_=y(l(17));function y(T){return T&&T.__esModule?T:{default:T}}var S=function(){function T(R,I){if(I===void 0&&(I=!1),R==null||R==="")throw new Error("UserAgent parameter can't be empty");this._ua=R,this.parsedResult={},I!==!0&&this.parse()}var A=T.prototype;return A.getUA=function(){return this._ua},A.test=function(R){return R.test(this._ua)},A.parseBrowser=function(){var R=this;this.parsedResult.browser={};var I=_.default.find(u.default,function(U){if(typeof U.test=="function")return U.test(R);if(U.test instanceof Array)return U.test.some(function(D){return R.test(D)});throw new Error("Browser's test function is not valid")});return I&&(this.parsedResult.browser=I.describe(this.getUA())),this.parsedResult.browser},A.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},A.getBrowserName=function(R){return R?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},A.getBrowserVersion=function(){return this.getBrowser().version},A.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},A.parseOS=function(){var R=this;this.parsedResult.os={};var I=_.default.find(h.default,function(U){if(typeof U.test=="function")return U.test(R);if(U.test instanceof Array)return U.test.some(function(D){return R.test(D)});throw new Error("Browser's test function is not valid")});return I&&(this.parsedResult.os=I.describe(this.getUA())),this.parsedResult.os},A.getOSName=function(R){var I=this.getOS().name;return R?String(I).toLowerCase()||"":I||""},A.getOSVersion=function(){return this.getOS().version},A.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},A.getPlatformType=function(R){R===void 0&&(R=!1);var I=this.getPlatform().type;return R?String(I).toLowerCase()||"":I||""},A.parsePlatform=function(){var R=this;this.parsedResult.platform={};var I=_.default.find(d.default,function(U){if(typeof U.test=="function")return U.test(R);if(U.test instanceof Array)return U.test.some(function(D){return R.test(D)});throw new Error("Browser's test function is not valid")});return I&&(this.parsedResult.platform=I.describe(this.getUA())),this.parsedResult.platform},A.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},A.getEngineName=function(R){return R?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},A.parseEngine=function(){var R=this;this.parsedResult.engine={};var I=_.default.find(p.default,function(U){if(typeof U.test=="function")return U.test(R);if(U.test instanceof Array)return U.test.some(function(D){return R.test(D)});throw new Error("Browser's test function is not valid")});return I&&(this.parsedResult.engine=I.describe(this.getUA())),this.parsedResult.engine},A.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},A.getResult=function(){return _.default.assign({},this.parsedResult)},A.satisfies=function(R){var I=this,U={},D=0,L={},z=0;if(Object.keys(R).forEach(function(Q){var ne=R[Q];typeof ne=="string"?(L[Q]=ne,z+=1):typeof ne=="object"&&(U[Q]=ne,D+=1)}),D>0){var F=Object.keys(U),V=_.default.find(F,function(Q){return I.isOS(Q)});if(V){var W=this.satisfies(U[V]);if(W!==void 0)return W}var X=_.default.find(F,function(Q){return I.isPlatform(Q)});if(X){var $=this.satisfies(U[X]);if($!==void 0)return $}}if(z>0){var K=Object.keys(L),te=_.default.find(K,function(Q){return I.isBrowser(Q,!0)});if(te!==void 0)return this.compareVersion(L[te])}},A.isBrowser=function(R,I){I===void 0&&(I=!1);var U=this.getBrowserName().toLowerCase(),D=R.toLowerCase(),L=_.default.getBrowserTypeByAlias(D);return I&&L&&(D=L.toLowerCase()),D===U},A.compareVersion=function(R){var I=[0],U=R,D=!1,L=this.getBrowserVersion();if(typeof L=="string")return R[0]===">"||R[0]==="<"?(U=R.substr(1),R[1]==="="?(D=!0,U=R.substr(2)):I=[],R[0]===">"?I.push(1):I.push(-1)):R[0]==="="?U=R.substr(1):R[0]==="~"&&(D=!0,U=R.substr(1)),I.indexOf(_.default.compareVersions(L,U,D))>-1},A.isOS=function(R){return this.getOSName(!0)===String(R).toLowerCase()},A.isPlatform=function(R){return this.getPlatformType(!0)===String(R).toLowerCase()},A.isEngine=function(R){return this.getEngineName(!0)===String(R).toLowerCase()},A.is=function(R,I){return I===void 0&&(I=!1),this.isBrowser(R,I)||this.isOS(R)||this.isPlatform(R)},A.some=function(R){var I=this;return R===void 0&&(R=[]),R.some(function(U){return I.is(U)})},T}();c.default=S,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=/version\/(\d+(\.?_?\d+)+)/i,p=[{test:[/googlebot/i],describe:function(_){var y={name:"Googlebot"},S=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/opera/i],describe:function(_){var y={name:"Opera"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/opr\/|opios/i],describe:function(_){var y={name:"Opera"},S=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/SamsungBrowser/i],describe:function(_){var y={name:"Samsung Internet for Android"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/Whale/i],describe:function(_){var y={name:"NAVER Whale Browser"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/MZBrowser/i],describe:function(_){var y={name:"MZ Browser"},S=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/focus/i],describe:function(_){var y={name:"Focus"},S=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/swing/i],describe:function(_){var y={name:"Swing"},S=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/coast/i],describe:function(_){var y={name:"Opera Coast"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(_){var y={name:"Opera Touch"},S=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/yabrowser/i],describe:function(_){var y={name:"Yandex Browser"},S=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/ucbrowser/i],describe:function(_){var y={name:"UC Browser"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/Maxthon|mxios/i],describe:function(_){var y={name:"Maxthon"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/epiphany/i],describe:function(_){var y={name:"Epiphany"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/puffin/i],describe:function(_){var y={name:"Puffin"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/sleipnir/i],describe:function(_){var y={name:"Sleipnir"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/k-meleon/i],describe:function(_){var y={name:"K-Meleon"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/micromessenger/i],describe:function(_){var y={name:"WeChat"},S=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/qqbrowser/i],describe:function(_){var y={name:/qqbrowserlite/i.test(_)?"QQ Browser Lite":"QQ Browser"},S=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/msie|trident/i],describe:function(_){var y={name:"Internet Explorer"},S=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/\sedg\//i],describe:function(_){var y={name:"Microsoft Edge"},S=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/edg([ea]|ios)/i],describe:function(_){var y={name:"Microsoft Edge"},S=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/vivaldi/i],describe:function(_){var y={name:"Vivaldi"},S=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/seamonkey/i],describe:function(_){var y={name:"SeaMonkey"},S=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/sailfish/i],describe:function(_){var y={name:"Sailfish"},S=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,_);return S&&(y.version=S),y}},{test:[/silk/i],describe:function(_){var y={name:"Amazon Silk"},S=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/phantom/i],describe:function(_){var y={name:"PhantomJS"},S=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/slimerjs/i],describe:function(_){var y={name:"SlimerJS"},S=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(_){var y={name:"BlackBerry"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/(web|hpw)[o0]s/i],describe:function(_){var y={name:"WebOS Browser"},S=h.default.getFirstMatch(d,_)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/bada/i],describe:function(_){var y={name:"Bada"},S=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/tizen/i],describe:function(_){var y={name:"Tizen"},S=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/qupzilla/i],describe:function(_){var y={name:"QupZilla"},S=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/firefox|iceweasel|fxios/i],describe:function(_){var y={name:"Firefox"},S=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/electron/i],describe:function(_){var y={name:"Electron"},S=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/MiuiBrowser/i],describe:function(_){var y={name:"Miui"},S=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/chromium/i],describe:function(_){var y={name:"Chromium"},S=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,_)||h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/chrome|crios|crmo/i],describe:function(_){var y={name:"Chrome"},S=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/GSA/i],describe:function(_){var y={name:"Google Search"},S=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:function(_){var y=!_.test(/like android/i),S=_.test(/android/i);return y&&S},describe:function(_){var y={name:"Android Browser"},S=h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/playstation 4/i],describe:function(_){var y={name:"PlayStation 4"},S=h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/safari|applewebkit/i],describe:function(_){var y={name:"Safari"},S=h.default.getFirstMatch(d,_);return S&&(y.version=S),y}},{test:[/.*/i],describe:function(_){var y=_.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(y,_),version:h.default.getSecondMatch(y,_)}}}];c.default=p,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),p=[{test:[/Roku\/DVP/],describe:function(_){var y=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,_);return{name:d.OS_MAP.Roku,version:y}}},{test:[/windows phone/i],describe:function(_){var y=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,_);return{name:d.OS_MAP.WindowsPhone,version:y}}},{test:[/windows /i],describe:function(_){var y=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,_),S=h.default.getWindowsVersionName(y);return{name:d.OS_MAP.Windows,version:y,versionName:S}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(_){var y={name:d.OS_MAP.iOS},S=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,_);return S&&(y.version=S),y}},{test:[/macintosh/i],describe:function(_){var y=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,_).replace(/[_\s]/g,"."),S=h.default.getMacOSVersionName(y),T={name:d.OS_MAP.MacOS,version:y};return S&&(T.versionName=S),T}},{test:[/(ipod|iphone|ipad)/i],describe:function(_){var y=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,_).replace(/[_\s]/g,".");return{name:d.OS_MAP.iOS,version:y}}},{test:function(_){var y=!_.test(/like android/i),S=_.test(/android/i);return y&&S},describe:function(_){var y=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,_),S=h.default.getAndroidVersionName(y),T={name:d.OS_MAP.Android,version:y};return S&&(T.versionName=S),T}},{test:[/(web|hpw)[o0]s/i],describe:function(_){var y=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,_),S={name:d.OS_MAP.WebOS};return y&&y.length&&(S.version=y),S}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(_){var y=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,_)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,_)||h.default.getFirstMatch(/\bbb(\d+)/i,_);return{name:d.OS_MAP.BlackBerry,version:y}}},{test:[/bada/i],describe:function(_){var y=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,_);return{name:d.OS_MAP.Bada,version:y}}},{test:[/tizen/i],describe:function(_){var y=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,_);return{name:d.OS_MAP.Tizen,version:y}}},{test:[/linux/i],describe:function(){return{name:d.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:d.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(_){var y=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,_);return{name:d.OS_MAP.PlayStation4,version:y}}}];c.default=p,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),p=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(_){var y=h.default.getFirstMatch(/(can-l01)/i,_)&&"Nova",S={type:d.PLATFORMS_MAP.mobile,vendor:"Huawei"};return y&&(S.model=y),S}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(_){var y=_.test(/ipod|iphone/i),S=_.test(/like (ipod|iphone)/i);return y&&!S},describe:function(_){var y=h.default.getFirstMatch(/(ipod|iphone)/i,_);return{type:d.PLATFORMS_MAP.mobile,vendor:"Apple",model:y}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(_){return _.getBrowserName(!0)==="blackberry"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(_){return _.getBrowserName(!0)==="bada"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(_){return _.getBrowserName()==="windows phone"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(_){var y=Number(String(_.getOSVersion()).split(".")[0]);return _.getOSName(!0)==="android"&&y>=3},describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(_){return _.getOSName(!0)==="android"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(_){return _.getOSName(!0)==="macos"},describe:function(){return{type:d.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(_){return _.getOSName(!0)==="windows"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(_){return _.getOSName(!0)==="linux"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(_){return _.getOSName(!0)==="playstation 4"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}},{test:function(_){return _.getOSName(!0)==="roku"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}}];c.default=p,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),p=[{test:function(_){return _.getBrowserName(!0)==="microsoft edge"},describe:function(_){if(/\sedg\//i.test(_))return{name:d.ENGINE_MAP.Blink};var y=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,_);return{name:d.ENGINE_MAP.EdgeHTML,version:y}}},{test:[/trident/i],describe:function(_){var y={name:d.ENGINE_MAP.Trident},S=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:function(_){return _.test(/presto/i)},describe:function(_){var y={name:d.ENGINE_MAP.Presto},S=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:function(_){var y=_.test(/gecko/i),S=_.test(/like gecko/i);return y&&!S},describe:function(_){var y={name:d.ENGINE_MAP.Gecko},S=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:d.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(_){var y={name:d.ENGINE_MAP.WebKit},S=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,_);return S&&(y.version=S),y}}];c.default=p,a.exports=c.default}})},6729:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(_,y,S){this.fn=_,this.context=y,this.once=S||!1}function h(_,y,S,T,A){if(typeof S!="function")throw new TypeError("The listener must be a function");var R=new u(S,T||_,A),I=c?c+y:y;return _._events[I]?_._events[I].fn?_._events[I]=[_._events[I],R]:_._events[I].push(R):(_._events[I]=R,_._eventsCount++),_}function d(_,y){--_._eventsCount==0?_._events=new l:delete _._events[y]}function p(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),p.prototype.eventNames=function(){var _,y,S=[];if(this._eventsCount===0)return S;for(y in _=this._events)a.call(_,y)&&S.push(c?y.slice(1):y);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(_)):S},p.prototype.listeners=function(_){var y=c?c+_:_,S=this._events[y];if(!S)return[];if(S.fn)return[S.fn];for(var T=0,A=S.length,R=new Array(A);T<A;T++)R[T]=S[T].fn;return R},p.prototype.listenerCount=function(_){var y=c?c+_:_,S=this._events[y];return S?S.fn?1:S.length:0},p.prototype.emit=function(_,y,S,T,A,R){var I=c?c+_:_;if(!this._events[I])return!1;var U,D,L=this._events[I],z=arguments.length;if(L.fn){switch(L.once&&this.removeListener(_,L.fn,void 0,!0),z){case 1:return L.fn.call(L.context),!0;case 2:return L.fn.call(L.context,y),!0;case 3:return L.fn.call(L.context,y,S),!0;case 4:return L.fn.call(L.context,y,S,T),!0;case 5:return L.fn.call(L.context,y,S,T,A),!0;case 6:return L.fn.call(L.context,y,S,T,A,R),!0}for(D=1,U=new Array(z-1);D<z;D++)U[D-1]=arguments[D];L.fn.apply(L.context,U)}else{var F,V=L.length;for(D=0;D<V;D++)switch(L[D].once&&this.removeListener(_,L[D].fn,void 0,!0),z){case 1:L[D].fn.call(L[D].context);break;case 2:L[D].fn.call(L[D].context,y);break;case 3:L[D].fn.call(L[D].context,y,S);break;case 4:L[D].fn.call(L[D].context,y,S,T);break;default:if(!U)for(F=1,U=new Array(z-1);F<z;F++)U[F-1]=arguments[F];L[D].fn.apply(L[D].context,U)}}return!0},p.prototype.on=function(_,y,S){return h(this,_,y,S,!1)},p.prototype.once=function(_,y,S){return h(this,_,y,S,!0)},p.prototype.removeListener=function(_,y,S,T){var A=c?c+_:_;if(!this._events[A])return this;if(!y)return d(this,A),this;var R=this._events[A];if(R.fn)R.fn!==y||T&&!R.once||S&&R.context!==S||d(this,A);else{for(var I=0,U=[],D=R.length;I<D;I++)(R[I].fn!==y||T&&!R[I].once||S&&R[I].context!==S)&&U.push(R[I]);U.length?this._events[A]=U.length===1?U[0]:U:d(this,A)}return this},p.prototype.removeAllListeners=function(_){var y;return _?(y=c?c+_:_,this._events[y]&&d(this,y)):(this._events=new l,this._eventsCount=0),this},p.prototype.off=p.prototype.removeListener,p.prototype.addListener=p.prototype.on,p.prefixed=c,p.EventEmitter=p,o.exports=p},1564:o=>{var a;a=()=>(()=>{var c={228:u=>{var h=Object.prototype.hasOwnProperty,d="~";function p(){}function _(A,R,I){this.fn=A,this.context=R,this.once=I||!1}function y(A,R,I,U,D){if(typeof I!="function")throw new TypeError("The listener must be a function");var L=new _(I,U||A,D),z=d?d+R:R;return A._events[z]?A._events[z].fn?A._events[z]=[A._events[z],L]:A._events[z].push(L):(A._events[z]=L,A._eventsCount++),A}function S(A,R){--A._eventsCount==0?A._events=new p:delete A._events[R]}function T(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(d=!1)),T.prototype.eventNames=function(){var A,R,I=[];if(this._eventsCount===0)return I;for(R in A=this._events)h.call(A,R)&&I.push(d?R.slice(1):R);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(A)):I},T.prototype.listeners=function(A){var R=d?d+A:A,I=this._events[R];if(!I)return[];if(I.fn)return[I.fn];for(var U=0,D=I.length,L=new Array(D);U<D;U++)L[U]=I[U].fn;return L},T.prototype.listenerCount=function(A){var R=d?d+A:A,I=this._events[R];return I?I.fn?1:I.length:0},T.prototype.emit=function(A,R,I,U,D,L){var z=d?d+A:A;if(!this._events[z])return!1;var F,V,W=this._events[z],X=arguments.length;if(W.fn){switch(W.once&&this.removeListener(A,W.fn,void 0,!0),X){case 1:return W.fn.call(W.context),!0;case 2:return W.fn.call(W.context,R),!0;case 3:return W.fn.call(W.context,R,I),!0;case 4:return W.fn.call(W.context,R,I,U),!0;case 5:return W.fn.call(W.context,R,I,U,D),!0;case 6:return W.fn.call(W.context,R,I,U,D,L),!0}for(V=1,F=new Array(X-1);V<X;V++)F[V-1]=arguments[V];W.fn.apply(W.context,F)}else{var $,K=W.length;for(V=0;V<K;V++)switch(W[V].once&&this.removeListener(A,W[V].fn,void 0,!0),X){case 1:W[V].fn.call(W[V].context);break;case 2:W[V].fn.call(W[V].context,R);break;case 3:W[V].fn.call(W[V].context,R,I);break;case 4:W[V].fn.call(W[V].context,R,I,U);break;default:if(!F)for($=1,F=new Array(X-1);$<X;$++)F[$-1]=arguments[$];W[V].fn.apply(W[V].context,F)}}return!0},T.prototype.on=function(A,R,I){return y(this,A,R,I,!1)},T.prototype.once=function(A,R,I){return y(this,A,R,I,!0)},T.prototype.removeListener=function(A,R,I,U){var D=d?d+A:A;if(!this._events[D])return this;if(!R)return S(this,D),this;var L=this._events[D];if(L.fn)L.fn!==R||U&&!L.once||I&&L.context!==I||S(this,D);else{for(var z=0,F=[],V=L.length;z<V;z++)(L[z].fn!==R||U&&!L[z].once||I&&L[z].context!==I)&&F.push(L[z]);F.length?this._events[D]=F.length===1?F[0]:F:S(this,D)}return this},T.prototype.removeAllListeners=function(A){var R;return A?(R=d?d+A:A,this._events[R]&&S(this,R)):(this._events=new p,this._eventsCount=0),this},T.prototype.off=T.prototype.removeListener,T.prototype.addListener=T.prototype.on,T.prefixed=d,T.EventEmitter=T,u.exports=T},815:function(u,h){var d,p,_=this&&this.__extends||(d=function(G,J){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(re,ue){re.__proto__=ue}||function(re,ue){for(var ye in ue)Object.prototype.hasOwnProperty.call(ue,ye)&&(re[ye]=ue[ye])},d(G,J)},function(G,J){if(typeof J!="function"&&J!==null)throw new TypeError("Class extends value "+String(J)+" is not a constructor or null");function re(){this.constructor=G}d(G,J),G.prototype=J===null?Object.create(J):(re.prototype=J.prototype,new re)});function y(G){return 60*G*60}function S(G){return 60*G*60*24}Object.defineProperty(h,"__esModule",{value:!0}),h.daysToSeconds=h.hoursToSeconds=h.ConfigurationHolder=h.ConfigurationManager=h.Env=void 0,function(G){G.BETA="beta",G.PROD="prod",G.CUSTOM="custom"}(p||(h.Env=p={})),h.hoursToSeconds=y,h.daysToSeconds=S;var T=function(G){function J(re){return G.call(this,re)||this}return _(J,G),J}(Error),A="data",R="metrics",I=y(1),U=S(3),D=y(2),L="base64",z=function(){function G(J,re){var ue,ye,Ne,_e,Ae,Ye,Ze,Ke;if(!re.fileKey)throw new Error("options.fileKey cannot be empty");var It=(ue=re.clock)!==null&&ue!==void 0?ue:new te,Xt=It.getMillis();switch(this.context=J,this.fileKey=re.fileKey,this.env=re.standardEnv,re.standardEnv){case p.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case p.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case p.CUSTOM:if(!re.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=re.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(re.standardEnv))}this.trace=(ye=re.trace)!==null&&ye!==void 0?ye:new X(this.env),this.fetch=(Ne=re.fetch)!==null&&Ne!==void 0?Ne:new W(J),this.storage=new K("amazon_ivs_device_config_v1_"+re.fileKey,J.localStorage),this.state=new ne(this.storage,"state"),this.refresh={refreshIntervalSeconds:(_e=re.refresh.refreshIntervalSeconds)!==null&&_e!==void 0?_e:I,retryCount:(Ae=re.refresh.retryCount)!==null&&Ae!==void 0?Ae:3,retryIntervalSeconds:(Ye=re.refresh.retryIntervalSeconds)!==null&&Ye!==void 0?Ye:10,maxCacheAgeSeconds:(Ze=re.refresh.maxCacheAgeSeconds)!==null&&Ze!==void 0?Ze:U,stopRefreshAfterSeconds:(Ke=re.refresh.stopRefreshAfterSeconds)!==null&&Ke!==void 0?Ke:D,canRefreshNow:re.refresh.canRefreshNow},this.clock=It,this.isInitialRefreshDone=!1;var Qt=0,Kt=this.state.getState();Kt&&Kt.fetchServer===this.fetchServer&&Kt.lastFetchWhenMs&&(Qt=Kt.lastFetchWhenMs);var xn=It.getMillis(),Re=(xn-Qt)/1e3;if(Re<=this.refresh.maxCacheAgeSeconds){var St=this.storage.getJson(A);St&&St.fetchServer===this.fetchServer&&this.setData(St.json)}if(this.lastUseMs=xn,Re>=this.refresh.refreshIntervalSeconds||Qt==0)this.trace.onTrace("Will start refresh right now"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),0);else{var Qe=Math.round(this.refresh.refreshIntervalSeconds-Re);this.trace.onTrace("Will start refresh in "+Qe+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*Qe),this.isInitialRefreshDone=!0}var nn=It.getMillis();this.initialLoadTime=nn-Xt}return G.getInstance=function(J,re){try{if(!(J.fetch&&J.setTimeout&&J.clearTimeout&&J.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(ue){return void console.error("Error checking for context properties "+ue)}if(this.gInstance){if(this.gInstance.fileKey!=re.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(re.fileKey));return this.gInstance}return this.gInstance=new G(J,re),this.gInstance},G.prototype.getConfigurationHolder=function(J){var re,ue=this,ye=this.clock.getMillis();this.lastUseMs=ye;var Ne=(re=J.analytics)!==null&&re!==void 0?re:new $(this.env);this.context.setTimeout(function(){ue.emitMetrics(Ne)});var _e=0,Ae=this.state.getState();return Ae&&Ae.fetchServer===this.fetchServer&&Ae.lastFetchWhenMs&&(_e=Ae.lastFetchWhenMs),(ye-_e)/1e3<=this.refresh.maxCacheAgeSeconds?new F(Ne,this.properties):new F(Ne,void 0)},G.prototype.getFetchUrl=function(){var J="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),re=new URL(J);return re.searchParams.set("version","1.0"),re},G.clearInstance=function(){var J;(J=this.gInstance)===null||J===void 0||J.clearInstanceImpl(),this.gInstance=void 0},G.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},G.prototype.startRefresh=function(){var J=this;this.trace.onTrace("Starting refresh request..."),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0);var re=this.clock.getMillis();return(re-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds?(this.trace.onTrace("Actually will not refresh due to refresh timeout"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):this.isInitialRefreshDone&&!this.refresh.canRefreshNow()?(this.trace.onTrace("Will not refresh due to callback having returned false"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):void this.fetchData().then(function(ue){J.processResponse(ue,re)}).catch(function(ue){J.exceptionMetrics(ue),J.trace.onTrace("Fetch error: "+ue),J.refresh.retryCount>0&&J.scheduleRetry(1)}).finally(function(){J.isInitialRefreshDone=!0,J.fetchTask=J.context.setTimeout(J.startRefresh.bind(J),1e3*J.refresh.refreshIntervalSeconds)})},G.prototype.fetchData=function(){var J=this.getFetchUrl(),re=new Headers,ue=this.state.getState();return ue.fetchServer===this.fetchServer&&(ue.lastFetchWhenFullMs&&this.clock.getMillis()-ue.lastFetchWhenFullMs>1e3*y(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&ue.lastFetchEtagHeader&&re.set("If-None-Match",ue.lastFetchEtagHeader)),this.incrementMetrics("fetch_attempt_count"),this.fetch.fetchUrl(J,re)},G.prototype.processResponse=function(J,re){var ue={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},ye=J.headers.get("etag");ye&&(ue.lastFetchEtagHeader=ye);try{if(J.status<300&&J.json)if(this.setData(J.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(A,{fetchServer:this.fetchServer,json:J.json});var Ne=this.clock.getMillis();ue.lastFetchWhenFullMs=Ne,this.incrementMetricsWithDuration("success_new_data_count",Ne-re)}else this.incrementMetrics("fail_invalid_data_count");else{if(J.status!==304){var _e="Unexpected http fetch status: "+J.status;throw this.trace.onTrace(_e),new T(_e)}this.trace.onTrace("Server said no change in data"),Ne=this.clock.getMillis(),this.incrementMetricsWithDuration("success_no_change_count",Ne-re)}}finally{this.state.setState(ue)}},G.prototype.scheduleRetry=function(J){var re=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var ue=J*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout(function(){re.retryTask=void 0,re.fetchRetry(J)},1e3*ue)},G.prototype.fetchRetry=function(J){var re=this;this.trace.onTrace("Starting retry request ".concat(J,"..."));var ue=this.clock.getMillis();this.fetchData().then(function(ye){re.processResponse(ye,ue)}).catch(function(ye){re.exceptionMetrics(ye),re.trace.onTrace("Fetch error: "+ye),re.refresh.retryCount>J&&re.scheduleRetry(J+1)})},G.prototype.setData=function(J){if(!J)return!1;if(J.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var re=J.properties;if(!re||!Array.isArray(re))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var ue=new Map,ye=0,Ne=re;ye<Ne.length;ye++){var _e=Ne[ye];if(_e.name&&_e.type&&this.isValidValueType(_e.type)){if(_e.value_string&&typeof _e.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof _e.value_string);continue}if(_e.value_number&&typeof _e.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof _e.value_number);continue}if(_e.value_boolean&&typeof _e.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof _e.value_boolean);continue}if(_e.value_json&&typeof _e.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof _e.value_json);continue}if(_e.value_analytics&&typeof _e.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof _e.value_analytics);continue}var Ae=new Q(_e.name,this.parseValueType(_e.type),_e.value_string,_e.value_number,_e.value_boolean,_e.value_json,_e.value_analytics,_e.encoding);ue.set(Ae.name,Ae)}}return ue.size!=0&&(this.properties=ue,!0)},G.prototype.isValidValueType=function(J){return J==="string"||J==="number"||J==="boolean"||J=="json"},G.prototype.parseValueType=function(J){switch(J){case"string":return V.STRING;case"number":return V.NUMBER;case"boolean":return V.BOOLEAN;case"json":return V.JSON;default:throw new Error("Unsupported value type ".concat(J))}},G.prototype.emitMetrics=function(J){var re,ue,ye,Ne,_e,Ae,Ye,Ze,Ke=(re=this.storage.getJson(R))!==null&&re!==void 0?re:{},It={initial_load_time:this.initialLoadTime,fetch_attempt_count:(ue=Ke.fetch_attempt_count)!==null&&ue!==void 0?ue:0,fetch_duration_average:(ye=Ke.fetch_duration_average)!==null&&ye!==void 0?ye:0,success_no_change_count:(Ne=Ke.success_no_change_count)!==null&&Ne!==void 0?Ne:0,success_new_data_count:(_e=Ke.success_new_data_count)!==null&&_e!==void 0?_e:0,fail_exception_count:(Ae=Ke.fail_exception_count)!==null&&Ae!==void 0?Ae:0,fail_http_error_count:(Ye=Ke.fail_http_error_count)!==null&&Ye!==void 0?Ye:0,fail_invalid_data_count:(Ze=Ke.fail_invalid_data_count)!==null&&Ze!==void 0?Ze:0};J.onMetrics(It),Ke.fetch_attempt_count=0,Ke.success_no_change_count=0,Ke.success_new_data_count=0,Ke.fail_exception_count=0,Ke.fail_http_error_count=0,Ke.fail_invalid_data_count=0,this.storage.setJson(R,Ke)},G.prototype.exceptionMetrics=function(J){J instanceof T||J.message.startsWith("http error")?this.incrementMetrics("fail_http_error_count"):this.incrementMetrics("fail_exception_count")},G.prototype.incrementMetrics=function(J){var re,ue,ye=(re=this.storage.getJson(R))!==null&&re!==void 0?re:{};ye[J]=((ue=ye[J])!==null&&ue!==void 0?ue:0)+1,this.storage.setJson(R,ye)},G.prototype.incrementMetricsWithDuration=function(J,re){var ue,ye,Ne=(ue=this.storage.getJson(R))!==null&&ue!==void 0?ue:{};Ne[J]=((ye=Ne[J])!==null&&ye!==void 0?ye:0)+1,re>0&&(Ne.fetch_duration_average!==void 0?Ne.fetch_duration_average=.9*Ne.fetch_duration_average+.1*re|0:Ne.fetch_duration_average=re),this.storage.setJson(R,Ne)},G}();h.ConfigurationManager=z;var F=function(){function G(J,re){this.analytics=J,this.properties=re}return G.prototype.getSize=function(){return this.properties?this.properties.size:-1},G.prototype.getStringValue=function(J){var re,ue;if(this.properties){var ye=this.properties.get(J);if(ye){if(ye.type===V.STRING){var Ne=(re=ye.valueString)!==null&&re!==void 0?re:"";return this.analytics.onValue(J,(ue=ye.valueAnalytics)!==null&&ue!==void 0?ue:Ne),Ne}this.analytics.onError(J,"Type is not string")}}else this.analytics.onTrace(J,"Configuration is not available")},G.prototype.getNumberValue=function(J){var re,ue;if(this.properties){var ye=this.properties.get(J);if(ye){if(ye.type===V.NUMBER){var Ne=(re=ye.valueNumber)!==null&&re!==void 0?re:0;return this.analytics.onValue(J,(ue=ye.valueAnalytics)!==null&&ue!==void 0?ue:Ne.toString()),Ne}this.analytics.onError(J,"Type is not number")}}else this.analytics.onTrace(J,"Configuration is not available")},G.prototype.getBooleanValue=function(J){var re,ue;if(this.properties){var ye=this.properties.get(J);if(ye){if(ye.type===V.BOOLEAN){var Ne=(re=ye.valueBoolean)!==null&&re!==void 0&&re;return this.analytics.onValue(J,(ue=ye.valueAnalytics)!==null&&ue!==void 0?ue:Ne.toString()),Ne}this.analytics.onError(J,"Type is not boolean")}}else this.analytics.onTrace(J,"Configuration is not available")},G.prototype.getJsonValue=function(J){var re,ue;if(this.properties){var ye=this.properties.get(J);if(ye){if(ye.type===V.JSON){var Ne=ye.valueJson;if(!Ne)return this.analytics.onValue(J,(re=ye.valueAnalytics)!==null&&re!==void 0?re:""),null;try{var _e=JSON.parse(Ne);return this.analytics.onValue(J,(ue=ye.valueAnalytics)!==null&&ue!==void 0?ue:Ne),_e}catch{return void this.analytics.onError(J,"Json parse error")}}this.analytics.onError(J,"Type is not json")}}else this.analytics.onTrace(J,"Configuration is not available")},G}();h.ConfigurationHolder=F;var V,W=function(){function G(J){this.context=J}return G.prototype.fetchUrl=function(J,re){var ue=this;return new Promise(function(ye,Ne){ue.context.fetch(J,{headers:re,cache:"no-store"}).then(function(_e){if(_e.status>=400)Ne(new T("http error ".concat(_e.status,", ").concat(_e.statusText)));else{var Ae={status:_e.status,headers:_e.headers};_e.json().then(function(Ye){Ae.json=Ye}).catch(function(){}).finally(function(){ye(Ae)})}}).catch(function(_e){Ne(_e)})})},G}(),X=function(){function G(J){this.env=J}return G.prototype.onTrace=function(J){this.env!=p.PROD&&console.log("Configuration: "+J)},G}(),$=function(){function G(J){this.env=J}return G.prototype.onMetrics=function(J){this.env!=p.PROD&&console.log("Metrics",J)},G.prototype.onValue=function(J,re){this.env!=p.PROD&&console.log("Configuration for ".concat(J,": value = ").concat(re))},G.prototype.onError=function(J,re){this.env!=p.PROD&&console.error("Configuration for ".concat(J,": error = ").concat(re))},G.prototype.onTrace=function(J,re){this.env!=p.PROD&&console.log("Configuration for ".concat(J,": trace = ").concat(re))},G}(),K=function(){function G(J,re){this.prefix=J,this.storage=re}return G.prototype.getJson=function(J){var re=this.prefix+"_"+J;try{var ue=this.storage.getItem(re);if(ue)return JSON.parse(ue)}catch(ye){console.error("Error getting local storage key ".concat(re)+ye)}return null},G.prototype.setJson=function(J,re){var ue=this.prefix+"_"+J;try{this.storage.setItem(ue,JSON.stringify(re))}catch(ye){console.error("Error setting local storage key ".concat(ue,": ")+ye)}},G}(),te=function(){function G(){}return G.prototype.getMillis=function(){return Date.now()},G}();(function(G){G[G.STRING=0]="STRING",G[G.NUMBER=1]="NUMBER",G[G.BOOLEAN=2]="BOOLEAN",G[G.JSON=3]="JSON"})(V||(V={}));var Q=function(G,J,re,ue,ye,Ne,_e,Ae){switch(this.name=G,this.type=J,this.valueString=re,this.valueNumber=ue,this.valueBoolean=ye,this.valueJson=Ne,this.valueAnalytics=_e,this.type){case V.STRING:Ae===L&&re&&(this.valueString=atob(re));break;case V.JSON:Ae===L&&Ne&&(this.valueJson=atob(Ne))}},ne=function(){function G(J,re){var ue;this.storage=J,this.key=re,this.state=(ue=J.getJson(re))!==null&&ue!==void 0?ue:{}}return G.prototype.getState=function(){return this.state},G.prototype.setState=function(J){Object.assign(this.state,J),this.storage.setJson(this.key,this.state)},G}()},456:function(u,h,d){var p=this&&this.__createBinding||(Object.create?function(y,S,T,A){A===void 0&&(A=T);var R=Object.getOwnPropertyDescriptor(S,T);R&&!("get"in R?!S.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return S[T]}}),Object.defineProperty(y,A,R)}:function(y,S,T,A){A===void 0&&(A=T),y[A]=S[T]}),_=this&&this.__exportStar||function(y,S){for(var T in y)T==="default"||Object.prototype.hasOwnProperty.call(S,T)||p(S,y,T)};Object.defineProperty(h,"__esModule",{value:!0}),_(d(903),h)},903:function(u,h,d){var p=this&&this.__spreadArray||function(S,T,A){if(A||arguments.length===2)for(var R,I=0,U=T.length;I<U;I++)!R&&I in T||(R||(R=Array.prototype.slice.call(T,0,I)),R[I]=T[I]);return S.concat(R||Array.prototype.slice.call(T))};Object.defineProperty(h,"__esModule",{value:!0}),h.TypedEmitter=void 0;var _=d(228),y=function(){function S(T){var A=T.propagateErrors;this.emitter=new _.EventEmitter,this.propagateErrors=A!=null&&A}return S.prototype.on=function(T,A){A.call=this.wrapCall(T,A),this.emitter.on(T,A)},S.prototype.off=function(T,A){this.emitter.off(T,A)},S.prototype.emit=function(T){for(var A,R=[],I=1;I<arguments.length;I++)R[I-1]=arguments[I];(A=this.emitter).emit.apply(A,p([T],R,!1))},S.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},S.prototype.wrapCall=function(T,A){var R=this;return function(I){for(var U=[],D=1;D<arguments.length;D++)U[D-1]=arguments[D];if(R.propagateErrors)A.apply(I,U);else try{A.apply(I,U)}catch(F){var L="Error in callback for ".concat(T),z=A.name;return z&&(L+=" for function ".concat(z)),void console.error(L,F)}}},S}();h.TypedEmitter=y},987:function(u,h,d){var p,_=this&&this.__extends||(p=function(U,D){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,z){L.__proto__=z}||function(L,z){for(var F in z)Object.prototype.hasOwnProperty.call(z,F)&&(L[F]=z[F])},p(U,D)},function(U,D){if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function L(){this.constructor=U}p(U,D),U.prototype=D===null?Object.create(D):(L.prototype=D.prototype,new L)}),y=this&&this.__createBinding||(Object.create?function(U,D,L,z){z===void 0&&(z=L);var F=Object.getOwnPropertyDescriptor(D,L);F&&!("get"in F?!D.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return D[L]}}),Object.defineProperty(U,z,F)}:function(U,D,L,z){z===void 0&&(z=L),U[z]=D[L]}),S=this&&this.__setModuleDefault||(Object.create?function(U,D){Object.defineProperty(U,"default",{enumerable:!0,value:D})}:function(U,D){U.default=D}),T=this&&this.__importStar||function(U){if(U&&U.__esModule)return U;var D={};if(U!=null)for(var L in U)L!=="default"&&Object.prototype.hasOwnProperty.call(U,L)&&y(D,U,L);return S(D,U),D};Object.defineProperty(h,"__esModule",{value:!0}),h.createFsm=h.FsmWildcardState=h.RejectedTransitionError=h.InvalidStateTransitionError=void 0;var A=T(d(293)),R=function(U){function D(L,z){var F=U.call(this,"Invalid transition from '".concat(z,"' via event '").concat(L,"'"))||this;return F.name="InvalidStateTransitionError",F}return _(D,U),D}(Error);h.InvalidStateTransitionError=R;var I=function(U){function D(L,z,F){var V=U.call(this,"Transition from '".concat(z,"' via event '").concat(L,"' was rejected for: ").concat(F))||this;return V.name="RejectedTransitionError",V}return _(D,U),D}(Error);h.RejectedTransitionError=I,h.FsmWildcardState="*",h.createFsm=function(U){var D,L=U.transitions,z=U.callbacks,F=U.initialState,V=function(W){var X,$=(X=L[W])===null||X===void 0?void 0:X.from;return!!$&&(typeof $=="string"?$===h.FsmWildcardState:$.includes(F))};return{canTransition:V,transition:function(W,X){var $,K,te,Q,ne,G;if(!V(W))return A.err(new R(String(F),String(W)));var J=L[W];return J.shouldTransition===void 0||J.shouldTransition(F)?((K=($=z==null?void 0:z[F])===null||$===void 0?void 0:$.onExiting)===null||K===void 0||K.call($),(te=z==null?void 0:z.onStateExiting)===null||te===void 0||te.call(z,F),D=F,F=J.to,(ne=(Q=z==null?void 0:z[F])===null||Q===void 0?void 0:Q.onChanged)===null||ne===void 0||ne.call(Q,D,X),(G=z==null?void 0:z.onStateChanged)===null||G===void 0||G.call(z,D,F,X),A.ok(F)):A.err(new I(String(F),String(W),"shouldTransition returned false"))},previousState:function(){return D},currentState:function(){return F}}}},156:function(u,h,d){var p=this&&this.__createBinding||(Object.create?function(y,S,T,A){A===void 0&&(A=T);var R=Object.getOwnPropertyDescriptor(S,T);R&&!("get"in R?!S.__esModule:R.writable||R.configurable)||(R={enumerable:!0,get:function(){return S[T]}}),Object.defineProperty(y,A,R)}:function(y,S,T,A){A===void 0&&(A=T),y[A]=S[T]}),_=this&&this.__exportStar||function(y,S){for(var T in y)T==="default"||Object.prototype.hasOwnProperty.call(S,T)||p(S,y,T)};Object.defineProperty(h,"__esModule",{value:!0}),h.VERSION=void 0,h.VERSION="0.2.0",_(d(815),h),_(d(456),h),_(d(987),h),_(d(293),h)},293:(u,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.getErr=h.getOk_or=h.getOk=h.isNotOk=h.isOk=h.err=h.ok=void 0,h.ok=function(d){return{ok:!0,value:d}},h.err=function(d){return{ok:!1,error:d}},h.isOk=function(d){return d.ok===!0},h.isNotOk=function(d){return!(0,h.isOk)(d)},h.getOk=function(d){return d.ok===!0?d.value:void 0},h.getOk_or=function(d,p){return d.ok===!0?d.value:p},h.getErr=function(d){return d.ok===!0?void 0:d.error}}},l={};return function u(h){var d=l[h];if(d!==void 0)return d.exports;var p=l[h]={exports:{}};return c[h].call(p.exports,p,p.exports,u),p.exports}(156)})(),o.exports=a()},1989:(o,a,c)=>{var l=c(1789),u=c(401),h=c(7667),d=c(1327),p=c(1866);function _(y){var S=-1,T=y==null?0:y.length;for(this.clear();++S<T;){var A=y[S];this.set(A[0],A[1])}}_.prototype.clear=l,_.prototype.delete=u,_.prototype.get=h,_.prototype.has=d,_.prototype.set=p,o.exports=_},8407:(o,a,c)=>{var l=c(7040),u=c(4125),h=c(2117),d=c(7518),p=c(4705);function _(y){var S=-1,T=y==null?0:y.length;for(this.clear();++S<T;){var A=y[S];this.set(A[0],A[1])}}_.prototype.clear=l,_.prototype.delete=u,_.prototype.get=h,_.prototype.has=d,_.prototype.set=p,o.exports=_},7071:(o,a,c)=>{var l=c(852)(c(5639),"Map");o.exports=l},3369:(o,a,c)=>{var l=c(4785),u=c(1285),h=c(6e3),d=c(9916),p=c(5265);function _(y){var S=-1,T=y==null?0:y.length;for(this.clear();++S<T;){var A=y[S];this.set(A[0],A[1])}}_.prototype.clear=l,_.prototype.delete=u,_.prototype.get=h,_.prototype.has=d,_.prototype.set=p,o.exports=_},6384:(o,a,c)=>{var l=c(8407),u=c(7465),h=c(3779),d=c(7599),p=c(4758),_=c(4309);function y(S){var T=this.__data__=new l(S);this.size=T.size}y.prototype.clear=u,y.prototype.delete=h,y.prototype.get=d,y.prototype.has=p,y.prototype.set=_,o.exports=y},2705:(o,a,c)=>{var l=c(5639).Symbol;o.exports=l},1149:(o,a,c)=>{var l=c(5639).Uint8Array;o.exports=l},6874:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},4636:(o,a,c)=>{var l=c(2545),u=c(5694),h=c(1469),d=c(4144),p=c(5776),_=c(6719),y=Object.prototype.hasOwnProperty;o.exports=function(S,T){var A=h(S),R=!A&&u(S),I=!A&&!R&&d(S),U=!A&&!R&&!I&&_(S),D=A||R||I||U,L=D?l(S.length,String):[],z=L.length;for(var F in S)!T&&!y.call(S,F)||D&&(F=="length"||I&&(F=="offset"||F=="parent")||U&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||p(F,z))||L.push(F);return L}},6556:(o,a,c)=>{var l=c(9465),u=c(7813);o.exports=function(h,d,p){(p!==void 0&&!u(h[d],p)||p===void 0&&!(d in h))&&l(h,d,p)}},4865:(o,a,c)=>{var l=c(9465),u=c(7813),h=Object.prototype.hasOwnProperty;o.exports=function(d,p,_){var y=d[p];h.call(d,p)&&u(y,_)&&(_!==void 0||p in d)||l(d,p,_)}},8470:(o,a,c)=>{var l=c(7813);o.exports=function(u,h){for(var d=u.length;d--;)if(l(u[d][0],h))return d;return-1}},9465:(o,a,c)=>{var l=c(8777);o.exports=function(u,h,d){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:d,writable:!0}):u[h]=d}},3118:(o,a,c)=>{var l=c(3218),u=Object.create,h=function(){function d(){}return function(p){if(!l(p))return{};if(u)return u(p);d.prototype=p;var _=new d;return d.prototype=void 0,_}}();o.exports=h},8483:(o,a,c)=>{var l=c(5063)();o.exports=l},4239:(o,a,c)=>{var l=c(2705),u=c(9607),h=c(2333),d="[object Null]",p="[object Undefined]",_=l?l.toStringTag:void 0;o.exports=function(y){return y==null?y===void 0?p:d:_&&_ in Object(y)?u(y):h(y)}},9454:(o,a,c)=>{var l=c(4239),u=c(7005),h="[object Arguments]";o.exports=function(d){return u(d)&&l(d)==h}},8458:(o,a,c)=>{var l=c(3560),u=c(5346),h=c(3218),d=c(346),p=/^\[object .+?Constructor\]$/,_=Function.prototype,y=Object.prototype,S=_.toString,T=y.hasOwnProperty,A=RegExp("^"+S.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(R){return!(!h(R)||u(R))&&(l(R)?A:p).test(d(R))}},8749:(o,a,c)=>{var l=c(4239),u=c(1780),h=c(7005),d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Arguments]"]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d["[object Function]"]=d["[object Map]"]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1,o.exports=function(p){return h(p)&&u(p.length)&&!!d[l(p)]}},313:(o,a,c)=>{var l=c(3218),u=c(5726),h=c(3498),d=Object.prototype.hasOwnProperty;o.exports=function(p){if(!l(p))return h(p);var _=u(p),y=[];for(var S in p)(S!="constructor"||!_&&d.call(p,S))&&y.push(S);return y}},2980:(o,a,c)=>{var l=c(6384),u=c(6556),h=c(8483),d=c(9783),p=c(3218),_=c(1704),y=c(6390);o.exports=function S(T,A,R,I,U){T!==A&&h(A,function(D,L){if(U||(U=new l),p(D))d(T,A,L,R,S,I,U);else{var z=I?I(y(T,L),D,L+"",T,A,U):void 0;z===void 0&&(z=D),u(T,L,z)}},_)}},9783:(o,a,c)=>{var l=c(6556),u=c(4626),h=c(7133),d=c(278),p=c(8517),_=c(5694),y=c(1469),S=c(9246),T=c(4144),A=c(3560),R=c(3218),I=c(8630),U=c(6719),D=c(6390),L=c(9881);o.exports=function(z,F,V,W,X,$,K){var te=D(z,V),Q=D(F,V),ne=K.get(Q);if(ne)l(z,V,ne);else{var G=$?$(te,Q,V+"",z,F,K):void 0,J=G===void 0;if(J){var re=y(Q),ue=!re&&T(Q),ye=!re&&!ue&&U(Q);G=Q,re||ue||ye?y(te)?G=te:S(te)?G=d(te):ue?(J=!1,G=u(Q,!0)):ye?(J=!1,G=h(Q,!0)):G=[]:I(Q)||_(Q)?(G=te,_(te)?G=L(te):R(te)&&!A(te)||(G=p(Q))):J=!1}J&&(K.set(Q,G),X(G,Q,W,$,K),K.delete(Q)),l(z,V,G)}}},5976:(o,a,c)=>{var l=c(6557),u=c(5357),h=c(61);o.exports=function(d,p){return h(u(d,p,l),d+"")}},6560:(o,a,c)=>{var l=c(5703),u=c(8777),h=c(6557),d=u?function(p,_){return u(p,"toString",{configurable:!0,enumerable:!1,value:l(_),writable:!0})}:h;o.exports=d},2545:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},1717:o=>{o.exports=function(a){return function(c){return a(c)}}},4318:(o,a,c)=>{var l=c(1149);o.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},4626:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,d=h&&h.exports===u?l.Buffer:void 0,p=d?d.allocUnsafe:void 0;o.exports=function(_,y){if(y)return _.slice();var S=_.length,T=p?p(S):new _.constructor(S);return _.copy(T),T}},7133:(o,a,c)=>{var l=c(4318);o.exports=function(u,h){var d=h?l(u.buffer):u.buffer;return new u.constructor(d,u.byteOffset,u.length)}},278:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},8363:(o,a,c)=>{var l=c(4865),u=c(9465);o.exports=function(h,d,p,_){var y=!p;p||(p={});for(var S=-1,T=d.length;++S<T;){var A=d[S],R=_?_(p[A],h[A],A,p,h):void 0;R===void 0&&(R=h[A]),y?u(p,A,R):l(p,A,R)}return p}},4429:(o,a,c)=>{var l=c(5639)["__core-js_shared__"];o.exports=l},1463:(o,a,c)=>{var l=c(5976),u=c(6612);o.exports=function(h){return l(function(d,p){var _=-1,y=p.length,S=y>1?p[y-1]:void 0,T=y>2?p[2]:void 0;for(S=h.length>3&&typeof S=="function"?(y--,S):void 0,T&&u(p[0],p[1],T)&&(S=y<3?void 0:S,y=1),d=Object(d);++_<y;){var A=p[_];A&&h(d,A,_,S)}return d})}},5063:o=>{o.exports=function(a){return function(c,l,u){for(var h=-1,d=Object(c),p=u(c),_=p.length;_--;){var y=p[a?_:++h];if(l(d[y],y,d)===!1)break}return c}}},8777:(o,a,c)=>{var l=c(852),u=function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}}();o.exports=u},1957:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},5050:(o,a,c)=>{var l=c(7019);o.exports=function(u,h){var d=u.__data__;return l(h)?d[typeof h=="string"?"string":"hash"]:d.map}},852:(o,a,c)=>{var l=c(8458),u=c(7801);o.exports=function(h,d){var p=u(h,d);return l(p)?p:void 0}},5924:(o,a,c)=>{var l=c(5569)(Object.getPrototypeOf,Object);o.exports=l},9607:(o,a,c)=>{var l=c(2705),u=Object.prototype,h=u.hasOwnProperty,d=u.toString,p=l?l.toStringTag:void 0;o.exports=function(_){var y=h.call(_,p),S=_[p];try{_[p]=void 0;var T=!0}catch{}var A=d.call(_);return T&&(y?_[p]=S:delete _[p]),A}},7801:o=>{o.exports=function(a,c){return a==null?void 0:a[c]}},1789:(o,a,c)=>{var l=c(4536);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},401:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},7667:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__",h=Object.prototype.hasOwnProperty;o.exports=function(d){var p=this.__data__;if(l){var _=p[d];return _===u?void 0:_}return h.call(p,d)?p[d]:void 0}},1327:(o,a,c)=>{var l=c(4536),u=Object.prototype.hasOwnProperty;o.exports=function(h){var d=this.__data__;return l?d[h]!==void 0:u.call(d,h)}},1866:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__";o.exports=function(h,d){var p=this.__data__;return this.size+=this.has(h)?0:1,p[h]=l&&d===void 0?u:d,this}},8517:(o,a,c)=>{var l=c(3118),u=c(5924),h=c(5726);o.exports=function(d){return typeof d.constructor!="function"||h(d)?{}:l(u(d))}},5776:o=>{var a=9007199254740991,c=/^(?:0|[1-9]\d*)$/;o.exports=function(l,u){var h=typeof l;return!!(u=u??a)&&(h=="number"||h!="symbol"&&c.test(l))&&l>-1&&l%1==0&&l<u}},6612:(o,a,c)=>{var l=c(7813),u=c(8612),h=c(5776),d=c(3218);o.exports=function(p,_,y){if(!d(y))return!1;var S=typeof _;return!!(S=="number"?u(y)&&h(_,y.length):S=="string"&&_ in y)&&l(y[_],p)}},7019:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},5346:(o,a,c)=>{var l,u=c(4429),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(d){return!!h&&h in d}},5726:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},7040:o=>{o.exports=function(){this.__data__=[],this.size=0}},4125:(o,a,c)=>{var l=c(8470),u=Array.prototype.splice;o.exports=function(h){var d=this.__data__,p=l(d,h);return!(p<0)&&(p==d.length-1?d.pop():u.call(d,p,1),--this.size,!0)}},2117:(o,a,c)=>{var l=c(8470);o.exports=function(u){var h=this.__data__,d=l(h,u);return d<0?void 0:h[d][1]}},7518:(o,a,c)=>{var l=c(8470);o.exports=function(u){return l(this.__data__,u)>-1}},4705:(o,a,c)=>{var l=c(8470);o.exports=function(u,h){var d=this.__data__,p=l(d,u);return p<0?(++this.size,d.push([u,h])):d[p][1]=h,this}},4785:(o,a,c)=>{var l=c(1989),u=c(8407),h=c(7071);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},1285:(o,a,c)=>{var l=c(5050);o.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},6e3:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).get(u)}},9916:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).has(u)}},5265:(o,a,c)=>{var l=c(5050);o.exports=function(u,h){var d=l(this,u),p=d.size;return d.set(u,h),this.size+=d.size==p?0:1,this}},4536:(o,a,c)=>{var l=c(852)(Object,"create");o.exports=l},3498:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},1167:(o,a,c)=>{o=c.nmd(o);var l=c(1957),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,d=h&&h.exports===u&&l.process,p=function(){try{var _=h&&h.require&&h.require("util").types;return _||d&&d.binding&&d.binding("util")}catch{}}();o.exports=p},2333:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},5569:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},5357:(o,a,c)=>{var l=c(6874),u=Math.max;o.exports=function(h,d,p){return d=u(d===void 0?h.length-1:d,0),function(){for(var _=arguments,y=-1,S=u(_.length-d,0),T=Array(S);++y<S;)T[y]=_[d+y];y=-1;for(var A=Array(d+1);++y<d;)A[y]=_[y];return A[d]=p(T),l(h,this,A)}}},5639:(o,a,c)=>{var l=c(1957),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();o.exports=h},6390:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},61:(o,a,c)=>{var l=c(6560),u=c(1275)(l);o.exports=u},1275:o=>{var a=800,c=16,l=Date.now;o.exports=function(u){var h=0,d=0;return function(){var p=l(),_=c-(p-d);if(d=p,_>0){if(++h>=a)return arguments[0]}else h=0;return u.apply(void 0,arguments)}}},7465:(o,a,c)=>{var l=c(8407);o.exports=function(){this.__data__=new l,this.size=0}},3779:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},7599:o=>{o.exports=function(a){return this.__data__.get(a)}},4758:o=>{o.exports=function(a){return this.__data__.has(a)}},4309:(o,a,c)=>{var l=c(8407),u=c(7071),h=c(3369),d=200;o.exports=function(p,_){var y=this.__data__;if(y instanceof l){var S=y.__data__;if(!u||S.length<d-1)return S.push([p,_]),this.size=++y.size,this;y=this.__data__=new h(S)}return y.set(p,_),this.size=y.size,this}},346:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},5703:o=>{o.exports=function(a){return function(){return a}}},7813:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},6557:o=>{o.exports=function(a){return a}},5694:(o,a,c)=>{var l=c(9454),u=c(7005),h=Object.prototype,d=h.hasOwnProperty,p=h.propertyIsEnumerable,_=l(function(){return arguments}())?l:function(y){return u(y)&&d.call(y,"callee")&&!p.call(y,"callee")};o.exports=_},1469:o=>{var a=Array.isArray;o.exports=a},8612:(o,a,c)=>{var l=c(3560),u=c(1780);o.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},9246:(o,a,c)=>{var l=c(8612),u=c(7005);o.exports=function(h){return u(h)&&l(h)}},4144:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=c(5062),h=a&&!a.nodeType&&a,d=h&&o&&!o.nodeType&&o,p=d&&d.exports===h?l.Buffer:void 0,_=(p?p.isBuffer:void 0)||u;o.exports=_},3560:(o,a,c)=>{var l=c(4239),u=c(3218),h="[object AsyncFunction]",d="[object Function]",p="[object GeneratorFunction]",_="[object Proxy]";o.exports=function(y){if(!u(y))return!1;var S=l(y);return S==d||S==p||S==h||S==_}},1780:o=>{var a=9007199254740991;o.exports=function(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=a}},3218:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},7005:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},8630:(o,a,c)=>{var l=c(4239),u=c(5924),h=c(7005),d="[object Object]",p=Function.prototype,_=Object.prototype,y=p.toString,S=_.hasOwnProperty,T=y.call(Object);o.exports=function(A){if(!h(A)||l(A)!=d)return!1;var R=u(A);if(R===null)return!0;var I=S.call(R,"constructor")&&R.constructor;return typeof I=="function"&&I instanceof I&&y.call(I)==T}},6719:(o,a,c)=>{var l=c(8749),u=c(1717),h=c(1167),d=h&&h.isTypedArray,p=d?u(d):l;o.exports=p},1704:(o,a,c)=>{var l=c(4636),u=c(313),h=c(8612);o.exports=function(d){return h(d)?l(d,!0):u(d)}},6486:function(o,a,c){var l;o=c.nmd(o),(function(){var u,h="Expected a function",d="__lodash_hash_undefined__",p="__lodash_placeholder__",_=16,y=32,S=64,T=128,A=256,R=1/0,I=9007199254740991,U=NaN,D=4294967295,L=[["ary",T],["bind",1],["bindKey",2],["curry",8],["curryRight",_],["flip",512],["partial",y],["partialRight",S],["rearg",A]],z="[object Arguments]",F="[object Array]",V="[object Boolean]",W="[object Date]",X="[object Error]",$="[object Function]",K="[object GeneratorFunction]",te="[object Map]",Q="[object Number]",ne="[object Object]",G="[object Promise]",J="[object RegExp]",re="[object Set]",ue="[object String]",ye="[object Symbol]",Ne="[object WeakMap]",_e="[object ArrayBuffer]",Ae="[object DataView]",Ye="[object Float32Array]",Ze="[object Float64Array]",Ke="[object Int8Array]",It="[object Int16Array]",Xt="[object Int32Array]",Qt="[object Uint8Array]",Kt="[object Uint8ClampedArray]",xn="[object Uint16Array]",Re="[object Uint32Array]",St=/\b__p \+= '';/g,Qe=/\b(__p \+=) '' \+/g,nn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ot=/&(?:amp|lt|gt|quot|#39);/g,rt=/[&<>"']/g,nt=RegExp(Ot.source),pe=RegExp(rt.source),oe=/<%-([\s\S]+?)%>/g,ke=/<%([\s\S]+?)%>/g,Je=/<%=([\s\S]+?)%>/g,ut=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ot=/^\w*$/,cn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dt=/[\\^$.*+?()[\]{}|]/g,Wt=RegExp(Dt.source),or=/^\s+/,xt=/\s/,bt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ft=/\{\n\/\* \[wrapped with (.+)\] \*/,Un=/,? & /,Zt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ir=/[()=,{}\[\]\/\s]/,Et=/\\(\\)?/g,ii=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Me=/\w*$/,Nt=/^[-+]0x[0-9a-f]+$/i,et=/^0b[01]+$/i,ht=/^\[object .+?Constructor\]$/,Ht=/^0o[0-7]+$/i,Lt=/^(?:0|[1-9]\d*)$/,Ee=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ze=/($^)/,st=/['\n\r\u2028\u2029\\]/g,ct="\\ud800-\\udfff",Rn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Br="\\u2700-\\u27bf",Qn="a-z\\xdf-\\xf6\\xf8-\\xff",Fn="A-Z\\xc0-\\xd6\\xd8-\\xde",en="\\ufe0e\\ufe0f",zt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_n="['’]",vn="["+ct+"]",lr="["+zt+"]",Qr="["+Rn+"]",$r="\\d+",co="["+Br+"]",$l="["+Qn+"]",dh="[^"+ct+zt+$r+Br+Qn+Fn+"]",fd="\\ud83c[\\udffb-\\udfff]",pd="[^"+ct+"]",le="(?:\\ud83c[\\udde6-\\uddff]){2}",Ie="[\\ud800-\\udbff][\\udc00-\\udfff]",Ge="["+Fn+"]",Xe="\\u200d",Pe="(?:"+$l+"|"+dh+")",wt="(?:"+Ge+"|"+dh+")",Ut="(?:['’](?:d|ll|m|re|s|t|ve))?",tn="(?:['’](?:D|LL|M|RE|S|T|VE))?",sn="(?:"+Qr+"|"+fd+")?",In="["+en+"]?",Hn=In+sn+("(?:"+Xe+"(?:"+[pd,le,Ie].join("|")+")"+In+sn+")*"),ln="(?:"+[co,le,Ie].join("|")+")"+Hn,ur="(?:"+[pd+Qr+"?",Qr,le,Ie,vn].join("|")+")",Or=RegExp(_n,"g"),fn=RegExp(Qr,"g"),On=RegExp(fd+"(?="+fd+")|"+ur+Hn,"g"),hr=RegExp([Ge+"?"+$l+"+"+Ut+"(?="+[lr,Ge,"$"].join("|")+")",wt+"+"+tn+"(?="+[lr,Ge+Pe,"$"].join("|")+")",Ge+"?"+Pe+"+"+Ut,Ge+"+"+tn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",$r,ln].join("|"),"g"),Gt=RegExp("["+Xe+ct+Rn+en+"]"),Pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ws=-1,Gn={};Gn[Ye]=Gn[Ze]=Gn[Ke]=Gn[It]=Gn[Xt]=Gn[Qt]=Gn[Kt]=Gn[xn]=Gn[Re]=!0,Gn[z]=Gn[F]=Gn[_e]=Gn[V]=Gn[Ae]=Gn[W]=Gn[X]=Gn[$]=Gn[te]=Gn[Q]=Gn[ne]=Gn[J]=Gn[re]=Gn[ue]=Gn[Ne]=!1;var Zn={};Zn[z]=Zn[F]=Zn[_e]=Zn[Ae]=Zn[V]=Zn[W]=Zn[Ye]=Zn[Ze]=Zn[Ke]=Zn[It]=Zn[Xt]=Zn[te]=Zn[Q]=Zn[ne]=Zn[J]=Zn[re]=Zn[ue]=Zn[ye]=Zn[Qt]=Zn[Kt]=Zn[xn]=Zn[Re]=!0,Zn[X]=Zn[$]=Zn[Ne]=!1;var cl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},hi=parseFloat,lo=parseInt,ll=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Di=typeof self=="object"&&self&&self.Object===Object&&self,an=ll||Di||Function("return this")(),Ba=a&&!a.nodeType&&a,ul=Ba&&o&&!o.nodeType&&o,ar=ul&&ul.exports===Ba,fh=ar&&ll.process,xo=function(){try{var Ve=ul&&ul.require&&ul.require("util").types;return Ve||fh&&fh.binding&&fh.binding("util")}catch{}}(),ph=xo&&xo.isArrayBuffer,md=xo&&xo.isDate,ql=xo&&xo.isMap,Wf=xo&&xo.isRegExp,$f=xo&&xo.isSet,wu=xo&&xo.isTypedArray;function qo(Ve,Be,ft){switch(ft.length){case 0:return Ve.call(Be);case 1:return Ve.call(Be,ft[0]);case 2:return Ve.call(Be,ft[0],ft[1]);case 3:return Ve.call(Be,ft[0],ft[1],ft[2])}return Ve.apply(Be,ft)}function gd(Ve,Be,ft,Vt){for(var Ct=-1,Nr=Ve==null?0:Ve.length;++Ct<Nr;){var Cs=Ve[Ct];Be(Vt,Cs,ft(Cs),Ve)}return Vt}function er(Ve,Be){for(var ft=-1,Vt=Ve==null?0:Ve.length;++ft<Vt&&Be(Ve[ft],ft,Ve)!==!1;);return Ve}function B_(Ve,Be){for(var ft=Ve==null?0:Ve.length;ft--&&Be(Ve[ft],ft,Ve)!==!1;);return Ve}function Mm(Ve,Be){for(var ft=-1,Vt=Ve==null?0:Ve.length;++ft<Vt;)if(!Be(Ve[ft],ft,Ve))return!1;return!0}function hl(Ve,Be){for(var ft=-1,Vt=Ve==null?0:Ve.length,Ct=0,Nr=[];++ft<Vt;){var Cs=Ve[ft];Be(Cs,ft,Ve)&&(Nr[Ct++]=Cs)}return Nr}function qf(Ve,Be){return!!(Ve!=null&&Ve.length)&&_d(Ve,Be,0)>-1}function Cu(Ve,Be,ft){for(var Vt=-1,Ct=Ve==null?0:Ve.length;++Vt<Ct;)if(ft(Be,Ve[Vt]))return!0;return!1}function pr(Ve,Be){for(var ft=-1,Vt=Ve==null?0:Ve.length,Ct=Array(Vt);++ft<Vt;)Ct[ft]=Be(Ve[ft],ft,Ve);return Ct}function dl(Ve,Be){for(var ft=-1,Vt=Be.length,Ct=Ve.length;++ft<Vt;)Ve[Ct+ft]=Be[ft];return Ve}function r0(Ve,Be,ft,Vt){var Ct=-1,Nr=Ve==null?0:Ve.length;for(Vt&&Nr&&(ft=Ve[++Ct]);++Ct<Nr;)ft=Be(ft,Ve[Ct],Ct,Ve);return ft}function Im(Ve,Be,ft,Vt){var Ct=Ve==null?0:Ve.length;for(Vt&&Ct&&(ft=Ve[--Ct]);Ct--;)ft=Be(ft,Ve[Ct],Ct,Ve);return ft}function km(Ve,Be){for(var ft=-1,Vt=Ve==null?0:Ve.length;++ft<Vt;)if(Be(Ve[ft],ft,Ve))return!0;return!1}var Xf=Yf("length");function wc(Ve,Be,ft){var Vt;return ft(Ve,function(Ct,Nr,Cs){if(Be(Ct,Nr,Cs))return Vt=Nr,!1}),Vt}function Om(Ve,Be,ft,Vt){for(var Ct=Ve.length,Nr=ft+(Vt?1:-1);Vt?Nr--:++Nr<Ct;)if(Be(Ve[Nr],Nr,Ve))return Nr;return-1}function _d(Ve,Be,ft){return Be==Be?function(Vt,Ct,Nr){for(var Cs=Nr-1,Ac=Vt.length;++Cs<Ac;)if(Vt[Cs]===Ct)return Cs;return-1}(Ve,Be,ft):Om(Ve,pl,ft)}function fl(Ve,Be,ft,Vt){for(var Ct=ft-1,Nr=Ve.length;++Ct<Nr;)if(Vt(Ve[Ct],Be))return Ct;return-1}function pl(Ve){return Ve!=Ve}function Kf(Ve,Be){var ft=Ve==null?0:Ve.length;return ft?za(Ve,Be)/ft:U}function Yf(Ve){return function(Be){return Be==null?u:Be[Ve]}}function Nm(Ve){return function(Be){return Ve==null?u:Ve[Be]}}function z_(Ve,Be,ft,Vt,Ct){return Ct(Ve,function(Nr,Cs,Ac){ft=Vt?(Vt=!1,Nr):Be(ft,Nr,Cs,Ac)}),ft}function za(Ve,Be){for(var ft,Vt=-1,Ct=Ve.length;++Vt<Ct;){var Nr=Be(Ve[Vt]);Nr!==u&&(ft=ft===u?Nr:ft+Nr)}return ft}function i0(Ve,Be){for(var ft=-1,Vt=Array(Ve);++ft<Ve;)Vt[ft]=Be(ft);return Vt}function Jf(Ve){return Ve&&Ve.slice(0,Rc(Ve)+1).replace(or,"")}function Va(Ve){return function(Be){return Ve(Be)}}function qr(Ve,Be){return pr(Be,function(ft){return Ve[ft]})}function Cc(Ve,Be){return Ve.has(Be)}function Qf(Ve,Be){for(var ft=-1,Vt=Ve.length;++ft<Vt&&_d(Be,Ve[ft],0)>-1;);return ft}function ml(Ve,Be){for(var ft=Ve.length;ft--&&_d(Be,Ve[ft],0)>-1;);return ft}var s0=Nm({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),vd=Nm({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function V_(Ve){return"\\"+cl[Ve]}function Xl(Ve){return Gt.test(Ve)}function mh(Ve){var Be=-1,ft=Array(Ve.size);return Ve.forEach(function(Vt,Ct){ft[++Be]=[Ct,Vt]}),ft}function Ns(Ve,Be){return function(ft){return Ve(Be(ft))}}function Li(Ve,Be){for(var ft=-1,Vt=Ve.length,Ct=0,Nr=[];++ft<Vt;){var Cs=Ve[ft];Cs!==Be&&Cs!==p||(Ve[ft]=p,Nr[Ct++]=ft)}return Nr}function ya(Ve){var Be=-1,ft=Array(Ve.size);return Ve.forEach(function(Vt){ft[++Be]=Vt}),ft}function Ru(Ve){var Be=-1,ft=Array(Ve.size);return Ve.forEach(function(Vt){ft[++Be]=[Vt,Vt]}),ft}function ms(Ve){return Xl(Ve)?function(Be){for(var ft=On.lastIndex=0;On.test(Be);)++ft;return ft}(Ve):Xf(Ve)}function gs(Ve){return Xl(Ve)?function(Be){return Be.match(On)||[]}(Ve):function(Be){return Be.split("")}(Ve)}function Rc(Ve){for(var Be=Ve.length;Be--&&xt.test(Ve.charAt(Be)););return Be}var Xo=Nm({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Au=function Ve(Be){var ft,Vt=(Be=Be==null?an:Au.defaults(an.Object(),Be,Au.pick(an,dr))).Array,Ct=Be.Date,Nr=Be.Error,Cs=Be.Function,Ac=Be.Math,wr=Be.Object,gh=Be.RegExp,_h=Be.String,uo=Be.TypeError,vh=Vt.prototype,Pm=Cs.prototype,Ps=wr.prototype,Ds=Be["__core-js_shared__"],gl=Pm.toString,Pr=Ps.hasOwnProperty,ac=0,Mu=(ft=/[^.]+$/.exec(Ds&&Ds.keys&&Ds.keys.IE_PROTO||""))?"Symbol(src)_1."+ft:"",Zf=Ps.toString,Iu=gl.call(wr),o0=an._,ja=gh("^"+gl.call(Pr).replace(Dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wo=ar?Be.Buffer:u,si=Be.Symbol,cc=Be.Uint8Array,lc=wo?wo.allocUnsafe:u,yd=Ns(wr.getPrototypeOf,wr),ep=wr.create,tp=Ps.propertyIsEnumerable,Kl=vh.splice,a0=si?si.isConcatSpreadable:u,Mc=si?si.iterator:u,Ha=si?si.toStringTag:u,yh=function(){try{var m=Ta(wr,"defineProperty");return m({},"",{}),m}catch{}}(),kt=Be.clearTimeout!==an.clearTimeout&&Be.clearTimeout,$i=Ct&&Ct.now!==an.Date.now&&Ct.now,j_=Be.setTimeout!==an.setTimeout&&Be.setTimeout,np=Ac.ceil,qs=Ac.floor,rp=wr.getOwnPropertySymbols,ip=wo?wo.isBuffer:u,Ls=Be.isFinite,Sd=vh.join,Us=Ns(wr.keys,wr),Xr=Ac.max,Zi=Ac.min,Wn=Ct.now,Ga=Be.parseInt,Xs=Ac.random,_i=vh.reverse,Sh=Ta(Be,"DataView"),Ks=Ta(Be,"Map"),vt=Ta(Be,"Promise"),_s=Ta(Be,"Set"),Co=Ta(Be,"WeakMap"),Wa=Ta(wr,"create"),Ei=Co&&new Co,qi={},vs=Nh(Sh),Ed=Nh(Ks),sp=Nh(vt),Yl=Nh(_s),H_=Nh(Co),Rs=si?si.prototype:u,ku=Rs?Rs.valueOf:u,bd=Rs?Rs.toString:u;function ce(m){if(M(m)&&!Ce(m)&&!(m instanceof yr)){if(m instanceof As)return m;if(Pr.call(m,"__wrapped__"))return iu(m)}return new As(m)}var Ro=function(){function m(){}return function(b){if(!w(b))return{};if(ep)return ep(b);m.prototype=b;var O=new m;return m.prototype=u,O}}();function Sa(){}function As(m,b){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=u}function yr(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=D,this.__views__=[]}function Ic(m){var b=-1,O=m==null?0:m.length;for(this.clear();++b<O;){var H=m[b];this.set(H[0],H[1])}}function kc(m){var b=-1,O=m==null?0:m.length;for(this.clear();++b<O;){var H=m[b];this.set(H[0],H[1])}}function Oc(m){var b=-1,O=m==null?0:m.length;for(this.clear();++b<O;){var H=m[b];this.set(H[0],H[1])}}function Nc(m){var b=-1,O=m==null?0:m.length;for(this.__data__=new Oc;++b<O;)this.add(m[b])}function $a(m){var b=this.__data__=new kc(m);this.size=b.size}function Dm(m,b){var O=Ce(m),H=!O&&_r(m),ie=!O&&!H&&un(m),de=!O&&!H&&!ie&&ae(m),Se=O||H||ie||de,we=Se?i0(m.length,_h):[],je=we.length;for(var pt in m)!b&&!Pr.call(m,pt)||Se&&(pt=="length"||ie&&(pt=="offset"||pt=="parent")||de&&(pt=="buffer"||pt=="byteLength"||pt=="byteOffset")||yi(pt,je))||we.push(pt);return we}function Pc(m){var b=m.length;return b?m[$m(0,b-1)]:u}function Lm(m,b){return Vd(ko(m),Ql(b,0,m.length))}function Eh(m){return Vd(ko(m))}function op(m,b,O){(O!==u&&!$n(m[b],O)||O===u&&!(b in m))&&Dc(m,b,O)}function Jl(m,b,O){var H=m[b];Pr.call(m,b)&&$n(H,O)&&(O!==u||b in m)||Dc(m,b,O)}function Ou(m,b){for(var O=m.length;O--;)if($n(m[O][0],b))return O;return-1}function Um(m,b,O,H){return Nu(m,function(ie,de,Se){b(H,ie,O(ie),Se)}),H}function Td(m,b){return m&&Uc(b,pn(b),m)}function Dc(m,b,O){b=="__proto__"&&yh?yh(m,b,{configurable:!0,enumerable:!0,value:O,writable:!0}):m[b]=O}function Fm(m,b){for(var O=-1,H=b.length,ie=Vt(H),de=m==null;++O<H;)ie[O]=de?u:br(m,b[O]);return ie}function Ql(m,b,O){return m==m&&(O!==u&&(m=m<=O?m:O),b!==u&&(m=m>=b?m:b)),m}function Ao(m,b,O,H,ie,de){var Se,we=1&b,je=2&b,pt=4&b;if(O&&(Se=ie?O(m,H,ie,de):O(m)),Se!==u)return Se;if(!w(m))return m;var dt=Ce(m);if(dt){if(Se=function(mt){var Pt=mt.length,Kn=new mt.constructor(Pt);return Pt&&typeof mt[0]=="string"&&Pr.call(mt,"index")&&(Kn.index=mt.index,Kn.input=mt.input),Kn}(m),!we)return ko(m,Se)}else{var At=Xi(m),yn=At==$||At==K;if(un(m))return Ch(m,we);if(At==ne||At==z||yn&&!ie){if(Se=je||yn?{}:Zm(m),!we)return je?function(mt,Pt){return Uc(mt,Ep(mt),Pt)}(m,function(mt,Pt){return mt&&Uc(Pt,Bn(Pt),mt)}(Se,m)):function(mt,Pt){return Uc(mt,Uu(mt),Pt)}(m,Td(Se,m))}else{if(!Zn[At])return ie?m:{};Se=function(mt,Pt,Kn){var $t=mt.constructor;switch(Pt){case _e:return kd(mt);case V:case W:return new $t(+mt);case Ae:return function(fr,xi){var Nn=xi?kd(fr.buffer):fr.buffer;return new fr.constructor(Nn,fr.byteOffset,fr.byteLength)}(mt,Kn);case Ye:case Ze:case Ke:case It:case Xt:case Qt:case Kt:case xn:case Re:return Ym(mt,Kn);case te:return new $t;case Q:case ue:return new $t(mt);case J:return function(fr){var xi=new fr.constructor(fr.source,Me.exec(fr));return xi.lastIndex=fr.lastIndex,xi}(mt);case re:return new $t;case ye:return kr=mt,ku?wr(ku.call(kr)):{}}var kr}(m,At,we)}}de||(de=new $a);var Cn=de.get(m);if(Cn)return Cn;de.set(m,Se),j(m)?m.forEach(function(mt){Se.add(Ao(mt,b,O,mt,m,de))}):k(m)&&m.forEach(function(mt,Pt){Se.set(Pt,Ao(mt,b,O,Pt,m,de))});var jn=dt?u:(pt?je?ts:gr:je?Bn:pn)(m);return er(jn||m,function(mt,Pt){jn&&(mt=m[Pt=mt]),Jl(Se,Pt,Ao(mt,b,O,Pt,m,de))}),Se}function ys(m,b,O){var H=O.length;if(m==null)return!H;for(m=wr(m);H--;){var ie=O[H],de=b[ie],Se=m[ie];if(Se===u&&!(ie in m)||!de(Se))return!1}return!0}function Bm(m,b,O){if(typeof m!="function")throw new uo(h);return Ya(function(){m.apply(u,O)},b)}function bh(m,b,O,H){var ie=-1,de=qf,Se=!0,we=m.length,je=[],pt=b.length;if(!we)return je;O&&(b=pr(b,Va(O))),H?(de=Cu,Se=!1):b.length>=200&&(de=Cc,Se=!1,b=new Nc(b));e:for(;++ie<we;){var dt=m[ie],At=O==null?dt:O(dt);if(dt=H||dt!==0?dt:0,Se&&At==At){for(var yn=pt;yn--;)if(b[yn]===At)continue e;je.push(dt)}else de(b,At,H)||je.push(dt)}return je}ce.templateSettings={escape:oe,evaluate:ke,interpolate:Je,variable:"",imports:{_:ce}},ce.prototype=Sa.prototype,ce.prototype.constructor=ce,As.prototype=Ro(Sa.prototype),As.prototype.constructor=As,yr.prototype=Ro(Sa.prototype),yr.prototype.constructor=yr,Ic.prototype.clear=function(){this.__data__=Wa?Wa(null):{},this.size=0},Ic.prototype.delete=function(m){var b=this.has(m)&&delete this.__data__[m];return this.size-=b?1:0,b},Ic.prototype.get=function(m){var b=this.__data__;if(Wa){var O=b[m];return O===d?u:O}return Pr.call(b,m)?b[m]:u},Ic.prototype.has=function(m){var b=this.__data__;return Wa?b[m]!==u:Pr.call(b,m)},Ic.prototype.set=function(m,b){var O=this.__data__;return this.size+=this.has(m)?0:1,O[m]=Wa&&b===u?d:b,this},kc.prototype.clear=function(){this.__data__=[],this.size=0},kc.prototype.delete=function(m){var b=this.__data__,O=Ou(b,m);return!(O<0)&&(O==b.length-1?b.pop():Kl.call(b,O,1),--this.size,!0)},kc.prototype.get=function(m){var b=this.__data__,O=Ou(b,m);return O<0?u:b[O][1]},kc.prototype.has=function(m){return Ou(this.__data__,m)>-1},kc.prototype.set=function(m,b){var O=this.__data__,H=Ou(O,m);return H<0?(++this.size,O.push([m,b])):O[H][1]=b,this},Oc.prototype.clear=function(){this.size=0,this.__data__={hash:new Ic,map:new(Ks||kc),string:new Ic}},Oc.prototype.delete=function(m){var b=rs(this,m).delete(m);return this.size-=b?1:0,b},Oc.prototype.get=function(m){return rs(this,m).get(m)},Oc.prototype.has=function(m){return rs(this,m).has(m)},Oc.prototype.set=function(m,b){var O=rs(this,m),H=O.size;return O.set(m,b),this.size+=O.size==H?0:1,this},Nc.prototype.add=Nc.prototype.push=function(m){return this.__data__.set(m,d),this},Nc.prototype.has=function(m){return this.__data__.has(m)},$a.prototype.clear=function(){this.__data__=new kc,this.size=0},$a.prototype.delete=function(m){var b=this.__data__,O=b.delete(m);return this.size=b.size,O},$a.prototype.get=function(m){return this.__data__.get(m)},$a.prototype.has=function(m){return this.__data__.has(m)},$a.prototype.set=function(m,b){var O=this.__data__;if(O instanceof kc){var H=O.__data__;if(!Ks||H.length<199)return H.push([m,b]),this.size=++O.size,this;O=this.__data__=new Oc(H)}return O.set(m,b),this.size=O.size,this};var Nu=f0(Ea),ap=f0(c0,!0);function G_(m,b){var O=!0;return Nu(m,function(H,ie,de){return O=!!b(H,ie,de)}),O}function cp(m,b,O){for(var H=-1,ie=m.length;++H<ie;){var de=m[H],Se=b(de);if(Se!=null&&(we===u?Se==Se&&!se(Se):O(Se,we)))var we=Se,je=de}return je}function xd(m,b){var O=[];return Nu(m,function(H,ie,de){b(H,ie,de)&&O.push(H)}),O}function Ys(m,b,O,H,ie){var de=-1,Se=m.length;for(O||(O=bp),ie||(ie=[]);++de<Se;){var we=m[de];b>0&&O(we)?b>1?Ys(we,b-1,O,H,ie):dl(ie,we):H||(ie[ie.length]=we)}return ie}var zm=Jm(),Vm=Jm(!0);function Ea(m,b){return m&&zm(m,b,pn)}function c0(m,b){return m&&Vm(m,b,pn)}function _l(m,b){return hl(b,function(O){return x(m[O])})}function es(m,b){for(var O=0,H=(b=Lc(b,m)).length;m!=null&&O<H;)m=m[hc(b[O++])];return O&&O==H?m:u}function Zl(m,b,O){var H=b(m);return Ce(m)?H:dl(H,O(m))}function Ms(m){return m==null?m===u?"[object Undefined]":"[object Null]":Ha&&Ha in wr(m)?function(b){var O=Pr.call(b,Ha),H=b[Ha];try{b[Ha]=u;var ie=!0}catch{}var de=Zf.call(b);return ie&&(O?b[Ha]=H:delete b[Ha]),de}(m):function(b){return Zf.call(b)}(m)}function vi(m,b){return m>b}function wd(m,b){return m!=null&&Pr.call(m,b)}function Th(m,b){return m!=null&&b in wr(m)}function jm(m,b,O){for(var H=O?Cu:qf,ie=m[0].length,de=m.length,Se=de,we=Vt(de),je=1/0,pt=[];Se--;){var dt=m[Se];Se&&b&&(dt=pr(dt,Va(b))),je=Zi(dt.length,je),we[Se]=!O&&(b||ie>=120&&dt.length>=120)?new Nc(Se&&dt):u}dt=m[0];var At=-1,yn=we[0];e:for(;++At<ie&&pt.length<je;){var Cn=dt[At],jn=b?b(Cn):Cn;if(Cn=O||Cn!==0?Cn:0,!(yn?Cc(yn,jn):H(pt,jn,O))){for(Se=de;--Se;){var mt=we[Se];if(!(mt?Cc(mt,jn):H(m[Se],jn,O)))continue e}yn&&yn.push(jn),pt.push(Cn)}}return pt}function vl(m,b,O){var H=(m=zd(m,b=Lc(b,m)))==null?m:m[hc(Qs(b))];return H==null?u:qo(H,m,O)}function lp(m){return M(m)&&Ms(m)==z}function ho(m,b,O,H,ie){return m===b||(m==null||b==null||!M(m)&&!M(b)?m!=m&&b!=b:function(de,Se,we,je,pt,dt){var At=Ce(de),yn=Ce(Se),Cn=At?F:Xi(de),jn=yn?F:Xi(Se),mt=(Cn=Cn==z?ne:Cn)==ne,Pt=(jn=jn==z?ne:jn)==ne,Kn=Cn==jn;if(Kn&&un(de)){if(!un(Se))return!1;At=!0,mt=!1}if(Kn&&!mt)return dt||(dt=new $a),At||ae(de)?Sp(de,Se,we,je,pt,dt):function(Nn,Yn,ra,mo,Vc,Es,fc){switch(ra){case Ae:if(Nn.byteLength!=Yn.byteLength||Nn.byteOffset!=Yn.byteOffset)return!1;Nn=Nn.buffer,Yn=Yn.buffer;case _e:return!(Nn.byteLength!=Yn.byteLength||!Es(new cc(Nn),new cc(Yn)));case V:case W:case Q:return $n(+Nn,+Yn);case X:return Nn.name==Yn.name&&Nn.message==Yn.message;case J:case ue:return Nn==Yn+"";case te:var $d=mh;case re:var ag=1&mo;if($d||($d=ya),Nn.size!=Yn.size&&!ag)return!1;var yb=fc.get(Nn);if(yb)return yb==Yn;mo|=2,fc.set(Nn,Yn);var p1=Sp($d(Nn),$d(Yn),mo,Vc,Es,fc);return fc.delete(Nn),p1;case ye:if(ku)return ku.call(Nn)==ku.call(Yn)}return!1}(de,Se,Cn,we,je,pt,dt);if(!(1&we)){var $t=mt&&Pr.call(de,"__wrapped__"),kr=Pt&&Pr.call(Se,"__wrapped__");if($t||kr){var fr=$t?de.value():de,xi=kr?Se.value():Se;return dt||(dt=new $a),pt(fr,xi,we,je,dt)}}return Kn?(dt||(dt=new $a),function(Nn,Yn,ra,mo,Vc,Es){var fc=1&ra,$d=gr(Nn),ag=$d.length,yb=gr(Yn),p1=yb.length;if(ag!=p1&&!fc)return!1;for(var Sb=ag;Sb--;){var x0=$d[Sb];if(!(fc?x0 in Yn:Pr.call(Yn,x0)))return!1}var cP=Es.get(Nn),lP=Es.get(Yn);if(cP&&lP)return cP==Yn&&lP==Nn;var Eb=!0;Es.set(Nn,Yn),Es.set(Yn,Nn);for(var m1=fc;++Sb<ag;){var bb=Nn[x0=$d[Sb]],Tb=Yn[x0];if(mo)var uP=fc?mo(Tb,bb,x0,Yn,Nn,Es):mo(bb,Tb,x0,Nn,Yn,Es);if(!(uP===u?bb===Tb||Vc(bb,Tb,ra,mo,Es):uP)){Eb=!1;break}m1||(m1=x0=="constructor")}if(Eb&&!m1){var xb=Nn.constructor,wb=Yn.constructor;xb==wb||!("constructor"in Nn)||!("constructor"in Yn)||typeof xb=="function"&&xb instanceof xb&&typeof wb=="function"&&wb instanceof wb||(Eb=!1)}return Es.delete(Nn),Es.delete(Yn),Eb}(de,Se,we,je,pt,dt)):!1}(m,b,O,H,ho,ie))}function Hm(m,b,O,H){var ie=O.length,de=ie,Se=!H;if(m==null)return!de;for(m=wr(m);ie--;){var we=O[ie];if(Se&&we[2]?we[1]!==m[we[0]]:!(we[0]in m))return!1}for(;++ie<de;){var je=(we=O[ie])[0],pt=m[je],dt=we[1];if(Se&&we[2]){if(pt===u&&!(je in m))return!1}else{var At=new $a;if(H)var yn=H(pt,dt,je,m,b,At);if(!(yn===u?ho(dt,pt,3,H,At):yn))return!1}}return!0}function Cd(m){return!(!w(m)||(b=m,Mu&&Mu in b))&&(x(m)?ja:ht).test(Nh(m));var b}function Rd(m){return typeof m=="function"?m:m==null?Ss:typeof m=="object"?Ce(m)?l0(m[0],m[1]):Js(m):Mp(m)}function Ad(m){if(!uc(m))return Us(m);var b=[];for(var O in wr(m))Pr.call(m,O)&&O!="constructor"&&b.push(O);return b}function up(m){if(!w(m))return function(ie){var de=[];if(ie!=null)for(var Se in wr(ie))de.push(Se);return de}(m);var b=uc(m),O=[];for(var H in m)(H!="constructor"||!b&&Pr.call(m,H))&&O.push(H);return O}function hp(m,b){return m<b}function Ko(m,b){var O=-1,H=He(m)?Vt(m.length):[];return Nu(m,function(ie,de,Se){H[++O]=b(ie,de,Se)}),H}function Js(m){var b=bn(m);return b.length==1&&b[0][2]?Bd(b[0][0],b[0][1]):function(O){return O===m||Hm(O,m,b)}}function l0(m,b){return Fd(m)&&Tp(b)?Bd(hc(m),b):function(O){var H=br(O,m);return H===u&&H===b?Tr(O,m):ho(b,H,3)}}function Gm(m,b,O,H,ie){m!==b&&zm(b,function(de,Se){if(ie||(ie=new $a),w(de))(function(je,pt,dt,At,yn,Cn,jn){var mt=Oh(je,dt),Pt=Oh(pt,dt),Kn=jn.get(Pt);if(Kn)return void op(je,dt,Kn);var $t=Cn?Cn(mt,Pt,dt+"",je,pt,jn):u,kr=$t===u;if(kr){var fr=Ce(Pt),xi=!fr&&un(Pt),Nn=!fr&&!xi&&ae(Pt);$t=Pt,fr||xi||Nn?Ce(mt)?$t=mt:Tt(mt)?$t=ko(mt):xi?(kr=!1,$t=Ch(Pt,!0)):Nn?(kr=!1,$t=Ym(Pt,!0)):$t=[]:q(Pt)||_r(Pt)?($t=mt,_r(mt)?$t=Bt(mt):w(mt)&&!x(mt)||($t=Zm(Pt))):kr=!1}kr&&(jn.set(Pt,$t),yn($t,Pt,At,Cn,jn),jn.delete(Pt)),op(je,dt,$t)})(m,b,Se,O,Gm,H,ie);else{var we=H?H(Oh(m,Se),de,Se+"",m,b,ie):u;we===u&&(we=de),op(m,Se,we)}},Bn)}function ba(m,b){var O=m.length;if(O)return yi(b+=b<0?O:0,O)?m[b]:u}function Mo(m,b,O){b=b.length?pr(b,function(de){return Ce(de)?function(Se){return es(Se,de.length===1?de[0]:de)}:de}):[Ss];var H=-1;b=pr(b,Va(wn()));var ie=Ko(m,function(de,Se,we){var je=pr(b,function(pt){return pt(de)});return{criteria:je,index:++H,value:de}});return function(de,Se){var we=de.length;for(de.sort(Se);we--;)de[we]=de[we].value;return de}(ie,function(de,Se){return function(we,je,pt){for(var dt=-1,At=we.criteria,yn=je.criteria,Cn=At.length,jn=pt.length;++dt<Cn;){var mt=Od(At[dt],yn[dt]);if(mt)return dt>=jn?mt:mt*(pt[dt]=="desc"?-1:1)}return we.index-je.index}(de,Se,O)})}function u0(m,b,O){for(var H=-1,ie=b.length,de={};++H<ie;){var Se=b[H],we=es(m,Se);O(we,Se)&&Md(de,Lc(Se,m),we)}return de}function Wm(m,b,O,H){var ie=H?fl:_d,de=-1,Se=b.length,we=m;for(m===b&&(b=ko(b)),O&&(we=pr(m,Va(O)));++de<Se;)for(var je=0,pt=b[de],dt=O?O(pt):pt;(je=ie(we,dt,je,H))>-1;)we!==m&&Kl.call(we,je,1),Kl.call(m,je,1);return m}function h0(m,b){for(var O=m?b.length:0,H=O-1;O--;){var ie=b[O];if(O==H||ie!==de){var de=ie;yi(ie)?Kl.call(m,ie,1):Jo(m,ie)}}return m}function $m(m,b){return m+qs(Xs()*(b-m+1))}function qm(m,b){var O="";if(!m||b<1||b>I)return O;do b%2&&(O+=m),(b=qs(b/2))&&(m+=m);while(b);return O}function mr(m,b){return Qo(Fu(m,b,Ss),m+"")}function dp(m){return Pc(Ti(m))}function d0(m,b){var O=Ti(m);return Vd(O,Ql(b,0,O.length))}function Md(m,b,O,H){if(!w(m))return m;for(var ie=-1,de=(b=Lc(b,m)).length,Se=de-1,we=m;we!=null&&++ie<de;){var je=hc(b[ie]),pt=O;if(je==="__proto__"||je==="constructor"||je==="prototype")return m;if(ie!=Se){var dt=we[je];(pt=H?H(dt,je,we):u)===u&&(pt=w(dt)?dt:yi(b[ie+1])?[]:{})}Jl(we,je,pt),we=we[je]}return m}var Pu=Ei?function(m,b){return Ei.set(m,b),m}:Ss,eu=yh?function(m,b){return yh(m,"toString",{configurable:!0,enumerable:!1,value:Tl(b),writable:!0})}:Ss;function yl(m){return Vd(Ti(m))}function Io(m,b,O){var H=-1,ie=m.length;b<0&&(b=-b>ie?0:ie+b),(O=O>ie?ie:O)<0&&(O+=ie),ie=b>O?0:O-b>>>0,b>>>=0;for(var de=Vt(ie);++H<ie;)de[H]=m[H+b];return de}function Sl(m,b){var O;return Nu(m,function(H,ie,de){return!(O=b(H,ie,de))}),!!O}function Du(m,b,O){var H=0,ie=m==null?H:m.length;if(typeof b=="number"&&b==b&&ie<=2147483647){for(;H<ie;){var de=H+ie>>>1,Se=m[de];Se!==null&&!se(Se)&&(O?Se<=b:Se<b)?H=de+1:ie=de}return ie}return Xm(m,b,Ss,O)}function Xm(m,b,O,H){var ie=0,de=m==null?0:m.length;if(de===0)return 0;for(var Se=(b=O(b))!=b,we=b===null,je=se(b),pt=b===u;ie<de;){var dt=qs((ie+de)/2),At=O(m[dt]),yn=At!==u,Cn=At===null,jn=At==At,mt=se(At);if(Se)var Pt=H||jn;else Pt=pt?jn&&(H||yn):we?jn&&yn&&(H||!Cn):je?jn&&yn&&!Cn&&(H||!mt):!Cn&&!mt&&(H?At<=b:At<b);Pt?ie=dt+1:de=dt}return Zi(de,4294967294)}function fp(m,b){for(var O=-1,H=m.length,ie=0,de=[];++O<H;){var Se=m[O],we=b?b(Se):Se;if(!O||!$n(we,je)){var je=we;de[ie++]=Se===0?0:Se}}return de}function Id(m){return typeof m=="number"?m:se(m)?U:+m}function Yo(m){if(typeof m=="string")return m;if(Ce(m))return pr(m,Yo)+"";if(se(m))return bd?bd.call(m):"";var b=m+"";return b=="0"&&1/m==-1/0?"-0":b}function tu(m,b,O){var H=-1,ie=qf,de=m.length,Se=!0,we=[],je=we;if(O)Se=!1,ie=Cu;else if(de>=200){var pt=b?null:g0(m);if(pt)return ya(pt);Se=!1,ie=Cc,je=new Nc}else je=b?[]:we;e:for(;++H<de;){var dt=m[H],At=b?b(dt):dt;if(dt=O||dt!==0?dt:0,Se&&At==At){for(var yn=je.length;yn--;)if(je[yn]===At)continue e;b&&je.push(At),we.push(dt)}else ie(je,At,O)||(je!==we&&je.push(At),we.push(dt))}return we}function Jo(m,b){return(m=zd(m,b=Lc(b,m)))==null||delete m[hc(Qs(b))]}function W_(m,b,O,H){return Md(m,b,O(es(m,b)),H)}function Km(m,b,O,H){for(var ie=m.length,de=H?ie:-1;(H?de--:++de<ie)&&b(m[de],de,m););return O?Io(m,H?0:de,H?de+1:ie):Io(m,H?de+1:0,H?ie:de)}function xh(m,b){var O=m;return O instanceof yr&&(O=O.value()),r0(b,function(H,ie){return ie.func.apply(ie.thisArg,dl([H],ie.args))},O)}function nu(m,b,O){var H=m.length;if(H<2)return H?tu(m[0]):[];for(var ie=-1,de=Vt(H);++ie<H;)for(var Se=m[ie],we=-1;++we<H;)we!=ie&&(de[ie]=bh(de[ie]||Se,m[we],b,O));return tu(Ys(de,1),b,O)}function pp(m,b,O){for(var H=-1,ie=m.length,de=b.length,Se={};++H<ie;){var we=H<de?b[H]:u;O(Se,m[H],we)}return Se}function jt(m){return Tt(m)?m:[]}function wh(m){return typeof m=="function"?m:Ss}function Lc(m,b){return Ce(m)?m:Fd(m,b)?[m]:xp(_t(m))}var $_=mr;function fo(m,b,O){var H=m.length;return O=O===u?H:O,!b&&O>=H?m:Io(m,b,O)}var ru=kt||function(m){return an.clearTimeout(m)};function Ch(m,b){if(b)return m.slice();var O=m.length,H=lc?lc(O):new m.constructor(O);return m.copy(H),H}function kd(m){var b=new m.constructor(m.byteLength);return new cc(b).set(new cc(m)),b}function Ym(m,b){var O=b?kd(m.buffer):m.buffer;return new m.constructor(O,m.byteOffset,m.length)}function Od(m,b){if(m!==b){var O=m!==u,H=m===null,ie=m==m,de=se(m),Se=b!==u,we=b===null,je=b==b,pt=se(b);if(!we&&!pt&&!de&&m>b||de&&Se&&je&&!we&&!pt||H&&Se&&je||!O&&je||!ie)return 1;if(!H&&!de&&!pt&&m<b||pt&&O&&ie&&!H&&!de||we&&O&&ie||!Se&&ie||!je)return-1}return 0}function Rh(m,b,O,H){for(var ie=-1,de=m.length,Se=O.length,we=-1,je=b.length,pt=Xr(de-Se,0),dt=Vt(je+pt),At=!H;++we<je;)dt[we]=b[we];for(;++ie<Se;)(At||ie<de)&&(dt[O[ie]]=m[ie]);for(;pt--;)dt[we++]=m[ie++];return dt}function Nd(m,b,O,H){for(var ie=-1,de=m.length,Se=-1,we=O.length,je=-1,pt=b.length,dt=Xr(de-we,0),At=Vt(dt+pt),yn=!H;++ie<dt;)At[ie]=m[ie];for(var Cn=ie;++je<pt;)At[Cn+je]=b[je];for(;++Se<we;)(yn||ie<de)&&(At[Cn+O[Se]]=m[ie++]);return At}function ko(m,b){var O=-1,H=m.length;for(b||(b=Vt(H));++O<H;)b[O]=m[O];return b}function Uc(m,b,O,H){var ie=!O;O||(O={});for(var de=-1,Se=b.length;++de<Se;){var we=b[de],je=H?H(O[we],m[we],we,O,m):u;je===u&&(je=m[we]),ie?Dc(O,we,je):Jl(O,we,je)}return O}function Pd(m,b){return function(O,H){var ie=Ce(O)?gd:Um,de=b?b():{};return ie(O,m,wn(H,2),de)}}function Lu(m){return mr(function(b,O){var H=-1,ie=O.length,de=ie>1?O[ie-1]:u,Se=ie>2?O[2]:u;for(de=m.length>3&&typeof de=="function"?(ie--,de):u,Se&&Bs(O[0],O[1],Se)&&(de=ie<3?u:de,ie=1),b=wr(b);++H<ie;){var we=O[H];we&&m(b,we,H,de)}return b})}function f0(m,b){return function(O,H){if(O==null)return O;if(!He(O))return m(O,H);for(var ie=O.length,de=b?ie:-1,Se=wr(O);(b?de--:++de<ie)&&H(Se[de],de,Se)!==!1;);return O}}function Jm(m){return function(b,O,H){for(var ie=-1,de=wr(b),Se=H(b),we=Se.length;we--;){var je=Se[m?we:++ie];if(O(de[je],je,de)===!1)break}return b}}function mp(m){return function(b){var O=Xl(b=_t(b))?gs(b):u,H=O?O[0]:b.charAt(0),ie=O?fo(O,1).join(""):b.slice(1);return H[m]()+ie}}function Ah(m){return function(b){return r0(dc(zi(b).replace(Or,"")),m,"")}}function gp(m){return function(){var b=arguments;switch(b.length){case 0:return new m;case 1:return new m(b[0]);case 2:return new m(b[0],b[1]);case 3:return new m(b[0],b[1],b[2]);case 4:return new m(b[0],b[1],b[2],b[3]);case 5:return new m(b[0],b[1],b[2],b[3],b[4]);case 6:return new m(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new m(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var O=Ro(m.prototype),H=m.apply(O,b);return w(H)?H:O}}function p0(m){return function(b,O,H){var ie=wr(b);if(!He(b)){var de=wn(O,3);b=pn(b),O=function(we){return de(ie[we],we,ie)}}var Se=m(b,O,H);return Se>-1?ie[de?b[Se]:Se]:u}}function Qm(m){return fi(function(b){var O=b.length,H=O,ie=As.prototype.thru;for(m&&b.reverse();H--;){var de=b[H];if(typeof de!="function")throw new uo(h);if(ie&&!Se&&Is(de)=="wrapper")var Se=new As([],!0)}for(H=Se?H:O;++H<O;){var we=Is(de=b[H]),je=we=="wrapper"?ns(de):u;Se=je&&El(je[0])&&je[1]==424&&!je[4].length&&je[9]==1?Se[Is(je[0])].apply(Se,je[3]):de.length==1&&El(de)?Se[we]():Se.thru(de)}return function(){var pt=arguments,dt=pt[0];if(Se&&pt.length==1&&Ce(dt))return Se.plant(dt).value();for(var At=0,yn=O?b[At].apply(this,pt):dt;++At<O;)yn=b[At].call(this,yn);return yn}})}function _p(m,b,O,H,ie,de,Se,we,je,pt){var dt=b&T,At=1&b,yn=2&b,Cn=24&b,jn=512&b,mt=yn?u:gp(m);return function Pt(){for(var Kn=arguments.length,$t=Vt(Kn),kr=Kn;kr--;)$t[kr]=arguments[kr];if(Cn)var fr=Fs(Pt),xi=function(mo,Vc){for(var Es=mo.length,fc=0;Es--;)mo[Es]===Vc&&++fc;return fc}($t,fr);if(H&&($t=Rh($t,H,ie,Cn)),de&&($t=Nd($t,de,Se,Cn)),Kn-=xi,Cn&&Kn<pt){var Nn=Li($t,fr);return Ld(m,b,_p,Pt.placeholder,O,$t,Nn,we,je,pt-Kn)}var Yn=At?O:this,ra=yn?Yn[m]:m;return Kn=$t.length,we?$t=function(mo,Vc){for(var Es=mo.length,fc=Zi(Vc.length,Es),$d=ko(mo);fc--;){var ag=Vc[fc];mo[fc]=yi(ag,Es)?$d[ag]:u}return mo}($t,we):jn&&Kn>1&&$t.reverse(),dt&&je<Kn&&($t.length=je),this&&this!==an&&this instanceof Pt&&(ra=mt||gp(ra)),ra.apply(Yn,$t)}}function m0(m,b){return function(O,H){return function(ie,de,Se,we){return Ea(ie,function(je,pt,dt){de(we,Se(je),pt,dt)}),we}(O,m,b(H),{})}}function Mh(m,b){return function(O,H){var ie;if(O===u&&H===u)return b;if(O!==u&&(ie=O),H!==u){if(ie===u)return H;typeof O=="string"||typeof H=="string"?(O=Yo(O),H=Yo(H)):(O=Id(O),H=Id(H)),ie=m(O,H)}return ie}}function Dd(m){return fi(function(b){return b=pr(b,Va(wn())),mr(function(O){var H=this;return m(b,function(ie){return qo(ie,H,O)})})})}function Ih(m,b){var O=(b=b===u?" ":Yo(b)).length;if(O<2)return O?qm(b,m):b;var H=qm(b,np(m/ms(b)));return Xl(b)?fo(gs(H),0,m).join(""):H.slice(0,m)}function vp(m){return function(b,O,H){return H&&typeof H!="number"&&Bs(b,O,H)&&(O=H=u),b=ge(b),O===u?(O=b,b=0):O=ge(O),function(ie,de,Se,we){for(var je=-1,pt=Xr(np((de-ie)/(Se||1)),0),dt=Vt(pt);pt--;)dt[we?pt:++je]=ie,ie+=Se;return dt}(b,O,H=H===u?b<O?1:-1:ge(H),m)}}function kh(m){return function(b,O){return typeof b=="string"&&typeof O=="string"||(b=yt(b),O=yt(O)),m(b,O)}}function Ld(m,b,O,H,ie,de,Se,we,je,pt){var dt=8&b;b|=dt?y:S,4&(b&=~(dt?S:y))||(b&=-4);var At=[m,b,ie,dt?de:u,dt?Se:u,dt?u:de,dt?u:Se,we,je,pt],yn=O.apply(u,At);return El(m)&&bi(yn,At),yn.placeholder=H,is(yn,m,b)}function Ud(m){var b=Ac[m];return function(O,H){if(O=yt(O),(H=H==null?0:Zi(he(H),292))&&Ls(O)){var ie=(_t(O)+"e").split("e");return+((ie=(_t(b(ie[0]+"e"+(+ie[1]+H)))+"e").split("e"))[0]+"e"+(+ie[1]-H))}return b(O)}}var g0=_s&&1/ya(new _s([,-0]))[1]==R?function(m){return new _s(m)}:xl;function yp(m){return function(b){var O=Xi(b);return O==te?mh(b):O==re?Ru(b):function(H,ie){return pr(ie,function(de){return[de,H[de]]})}(b,m(b))}}function qa(m,b,O,H,ie,de,Se,we){var je=2&b;if(!je&&typeof m!="function")throw new uo(h);var pt=H?H.length:0;if(pt||(b&=-97,H=ie=u),Se=Se===u?Se:Xr(he(Se),0),we=we===u?we:he(we),pt-=ie?ie.length:0,b&S){var dt=H,At=ie;H=ie=u}var yn=je?u:ns(m),Cn=[m,b,O,H,ie,dt,At,de,Se,we];if(yn&&function(mt,Pt){var Kn=mt[1],$t=Pt[1],kr=Kn|$t,fr=kr<131,xi=$t==T&&Kn==8||$t==T&&Kn==A&&mt[7].length<=Pt[8]||$t==384&&Pt[7].length<=Pt[8]&&Kn==8;if(!fr&&!xi)return mt;1&$t&&(mt[2]=Pt[2],kr|=1&Kn?0:4);var Nn=Pt[3];if(Nn){var Yn=mt[3];mt[3]=Yn?Rh(Yn,Nn,Pt[4]):Nn,mt[4]=Yn?Li(mt[3],p):Pt[4]}(Nn=Pt[5])&&(Yn=mt[5],mt[5]=Yn?Nd(Yn,Nn,Pt[6]):Nn,mt[6]=Yn?Li(mt[5],p):Pt[6]),(Nn=Pt[7])&&(mt[7]=Nn),$t&T&&(mt[8]=mt[8]==null?Pt[8]:Zi(mt[8],Pt[8])),mt[9]==null&&(mt[9]=Pt[9]),mt[0]=Pt[0],mt[1]=kr}(Cn,yn),m=Cn[0],b=Cn[1],O=Cn[2],H=Cn[3],ie=Cn[4],!(we=Cn[9]=Cn[9]===u?je?0:m.length:Xr(Cn[9]-pt,0))&&24&b&&(b&=-25),b&&b!=1)jn=b==8||b==_?function(mt,Pt,Kn){var $t=gp(mt);return function kr(){for(var fr=arguments.length,xi=Vt(fr),Nn=fr,Yn=Fs(kr);Nn--;)xi[Nn]=arguments[Nn];var ra=fr<3&&xi[0]!==Yn&&xi[fr-1]!==Yn?[]:Li(xi,Yn);return(fr-=ra.length)<Kn?Ld(mt,Pt,_p,kr.placeholder,u,xi,ra,u,u,Kn-fr):qo(this&&this!==an&&this instanceof kr?$t:mt,this,xi)}}(m,b,we):b!=y&&b!=33||ie.length?_p.apply(u,Cn):function(mt,Pt,Kn,$t){var kr=1&Pt,fr=gp(mt);return function xi(){for(var Nn=-1,Yn=arguments.length,ra=-1,mo=$t.length,Vc=Vt(mo+Yn),Es=this&&this!==an&&this instanceof xi?fr:mt;++ra<mo;)Vc[ra]=$t[ra];for(;Yn--;)Vc[ra++]=arguments[++Nn];return qo(Es,kr?Kn:this,Vc)}}(m,b,O,H);else var jn=function(mt,Pt,Kn){var $t=1&Pt,kr=gp(mt);return function fr(){return(this&&this!==an&&this instanceof fr?kr:mt).apply($t?Kn:this,arguments)}}(m,b,O);return is((yn?Pu:bi)(jn,Cn),m,b)}function Xa(m,b,O,H){return m===u||$n(m,Ps[O])&&!Pr.call(H,O)?b:m}function Ka(m,b,O,H,ie,de){return w(m)&&w(b)&&(de.set(b,m),Gm(m,b,u,Ka,de),de.delete(b)),m}function di(m){return q(m)?u:m}function Sp(m,b,O,H,ie,de){var Se=1&O,we=m.length,je=b.length;if(we!=je&&!(Se&&je>we))return!1;var pt=de.get(m),dt=de.get(b);if(pt&&dt)return pt==b&&dt==m;var At=-1,yn=!0,Cn=2&O?new Nc:u;for(de.set(m,b),de.set(b,m);++At<we;){var jn=m[At],mt=b[At];if(H)var Pt=Se?H(mt,jn,At,b,m,de):H(jn,mt,At,m,b,de);if(Pt!==u){if(Pt)continue;yn=!1;break}if(Cn){if(!km(b,function(Kn,$t){if(!Cc(Cn,$t)&&(jn===Kn||ie(jn,Kn,O,H,de)))return Cn.push($t)})){yn=!1;break}}else if(jn!==mt&&!ie(jn,mt,O,H,de)){yn=!1;break}}return de.delete(m),de.delete(b),yn}function fi(m){return Qo(Fu(m,u,_0),m+"")}function gr(m){return Zl(m,pn,Uu)}function ts(m){return Zl(m,Bn,Ep)}var ns=Ei?function(m){return Ei.get(m)}:xl;function Is(m){for(var b=m.name+"",O=qi[b],H=Pr.call(qi,b)?O.length:0;H--;){var ie=O[H],de=ie.func;if(de==null||de==m)return ie.name}return b}function Fs(m){return(Pr.call(ce,"placeholder")?ce:m).placeholder}function wn(){var m=ce.iteratee||au;return m=m===au?Rd:m,arguments.length?m(arguments[0],arguments[1]):m}function rs(m,b){var O,H,ie=m.__data__;return((H=typeof(O=b))=="string"||H=="number"||H=="symbol"||H=="boolean"?O!=="__proto__":O===null)?ie[typeof b=="string"?"string":"hash"]:ie.map}function bn(m){for(var b=pn(m),O=b.length;O--;){var H=b[O],ie=m[H];b[O]=[H,ie,Tp(ie)]}return b}function Ta(m,b){var O=function(H,ie){return H==null?u:H[ie]}(m,b);return Cd(O)?O:u}var Uu=rp?function(m){return m==null?[]:(m=wr(m),hl(rp(m),function(b){return tp.call(m,b)}))}:Ip,Ep=rp?function(m){for(var b=[];m;)dl(b,Uu(m)),m=yd(m);return b}:Ip,Xi=Ms;function Oo(m,b,O){for(var H=-1,ie=(b=Lc(b,m)).length,de=!1;++H<ie;){var Se=hc(b[H]);if(!(de=m!=null&&O(m,Se)))break;m=m[Se]}return de||++H!=ie?de:!!(ie=m==null?0:m.length)&&E(ie)&&yi(Se,ie)&&(Ce(m)||_r(m))}function Zm(m){return typeof m.constructor!="function"||uc(m)?{}:Ro(yd(m))}function bp(m){return Ce(m)||_r(m)||!!(a0&&m&&m[a0])}function yi(m,b){var O=typeof m;return!!(b=b??I)&&(O=="number"||O!="symbol"&&Lt.test(m))&&m>-1&&m%1==0&&m<b}function Bs(m,b,O){if(!w(O))return!1;var H=typeof b;return!!(H=="number"?He(O)&&yi(b,O.length):H=="string"&&b in O)&&$n(O[b],m)}function Fd(m,b){if(Ce(m))return!1;var O=typeof m;return!(O!="number"&&O!="symbol"&&O!="boolean"&&m!=null&&!se(m))||ot.test(m)||!ut.test(m)||b!=null&&m in wr(b)}function El(m){var b=Is(m),O=ce[b];if(typeof O!="function"||!(b in yr.prototype))return!1;if(m===O)return!0;var H=ns(O);return!!H&&m===H[0]}(Sh&&Xi(new Sh(new ArrayBuffer(1)))!=Ae||Ks&&Xi(new Ks)!=te||vt&&Xi(vt.resolve())!=G||_s&&Xi(new _s)!=re||Co&&Xi(new Co)!=Ne)&&(Xi=function(m){var b=Ms(m),O=b==ne?m.constructor:u,H=O?Nh(O):"";if(H)switch(H){case vs:return Ae;case Ed:return te;case sp:return G;case Yl:return re;case H_:return Ne}return b});var eg=Ds?x:kp;function uc(m){var b=m&&m.constructor;return m===(typeof b=="function"&&b.prototype||Ps)}function Tp(m){return m==m&&!w(m)}function Bd(m,b){return function(O){return O!=null&&O[m]===b&&(b!==u||m in wr(O))}}function Fu(m,b,O){return b=Xr(b===u?m.length-1:b,0),function(){for(var H=arguments,ie=-1,de=Xr(H.length-b,0),Se=Vt(de);++ie<de;)Se[ie]=H[b+ie];ie=-1;for(var we=Vt(b+1);++ie<b;)we[ie]=H[ie];return we[b]=O(Se),qo(m,this,we)}}function zd(m,b){return b.length<2?m:es(m,Io(b,0,-1))}function Oh(m,b){if((b!=="constructor"||typeof m[b]!="function")&&b!="__proto__")return m[b]}var bi=zs(Pu),Ya=j_||function(m,b){return an.setTimeout(m,b)},Qo=zs(eu);function is(m,b,O){var H=b+"";return Qo(m,function(ie,de){var Se=de.length;if(!Se)return ie;var we=Se-1;return de[we]=(Se>1?"& ":"")+de[we],de=de.join(Se>2?", ":" "),ie.replace(bt,`{
/* [wrapped with `+de+`] */
`)}(H,function(ie,de){return er(L,function(Se){var we="_."+Se[0];de&Se[1]&&!qf(ie,we)&&ie.push(we)}),ie.sort()}(function(ie){var de=ie.match(Ft);return de?de[1].split(Un):[]}(H),O)))}function zs(m){var b=0,O=0;return function(){var H=Wn(),ie=16-(H-O);if(O=H,ie>0){if(++b>=800)return arguments[0]}else b=0;return m.apply(u,arguments)}}function Vd(m,b){var O=-1,H=m.length,ie=H-1;for(b=b===u?H:b;++O<b;){var de=$m(O,ie),Se=m[de];m[de]=m[O],m[O]=Se}return m.length=b,m}var xp=function(m){var b=xe(m,function(H){return O.size===500&&O.clear(),H}),O=b.cache;return b}(function(m){var b=[];return m.charCodeAt(0)===46&&b.push(""),m.replace(cn,function(O,H,ie,de){b.push(ie?de.replace(Et,"$1"):H||O)}),b});function hc(m){if(typeof m=="string"||se(m))return m;var b=m+"";return b=="0"&&1/m==-1/0?"-0":b}function Nh(m){if(m!=null){try{return gl.call(m)}catch{}try{return m+""}catch{}}return""}function iu(m){if(m instanceof yr)return m.clone();var b=new As(m.__wrapped__,m.__chain__);return b.__actions__=ko(m.__actions__),b.__index__=m.__index__,b.__values__=m.__values__,b}var jd=mr(function(m,b){return Tt(m)?bh(m,Ys(b,1,Tt,!0)):[]}),Vs=mr(function(m,b){var O=Qs(b);return Tt(O)&&(O=u),Tt(m)?bh(m,Ys(b,1,Tt,!0),wn(O,2)):[]}),Hd=mr(function(m,b){var O=Qs(b);return Tt(O)&&(O=u),Tt(m)?bh(m,Ys(b,1,Tt,!0),u,O):[]});function Oi(m,b,O){var H=m==null?0:m.length;if(!H)return-1;var ie=O==null?0:he(O);return ie<0&&(ie=Xr(H+ie,0)),Om(m,wn(b,3),ie)}function Fc(m,b,O){var H=m==null?0:m.length;if(!H)return-1;var ie=H-1;return O!==u&&(ie=he(O),ie=O<0?Xr(H+ie,0):Zi(ie,H-1)),Om(m,wn(b,3),ie,!0)}function _0(m){return m!=null&&m.length?Ys(m,1):[]}function Bu(m){return m&&m.length?m[0]:u}var Ph=mr(function(m){var b=pr(m,jt);return b.length&&b[0]===m[0]?jm(b):[]}),Zo=mr(function(m){var b=Qs(m),O=pr(m,jt);return b===Qs(O)?b=u:O.pop(),O.length&&O[0]===m[0]?jm(O,wn(b,2)):[]}),No=mr(function(m){var b=Qs(m),O=pr(m,jt);return(b=typeof b=="function"?b:u)&&O.pop(),O.length&&O[0]===m[0]?jm(O,u,b):[]});function Qs(m){var b=m==null?0:m.length;return b?m[b-1]:u}var tg=mr(zu);function zu(m,b){return m&&m.length&&b&&b.length?Wm(m,b):m}var su=fi(function(m,b){var O=m==null?0:m.length,H=Fm(m,b);return h0(m,pr(b,function(ie){return yi(ie,O)?+ie:ie}).sort(Od)),H});function Sr(m){return m==null?m:_i.call(m)}var q_=mr(function(m){return tu(Ys(m,1,Tt,!0))}),xa=mr(function(m){var b=Qs(m);return Tt(b)&&(b=u),tu(Ys(m,1,Tt,!0),wn(b,2))}),Ky=mr(function(m){var b=Qs(m);return b=typeof b=="function"?b:u,tu(Ys(m,1,Tt,!0),u,b)});function Dh(m){if(!m||!m.length)return[];var b=0;return m=hl(m,function(O){if(Tt(O))return b=Xr(O.length,b),!0}),i0(b,function(O){return pr(m,Yf(O))})}function Gd(m,b){if(!m||!m.length)return[];var O=Dh(m);return b==null?O:pr(O,function(H){return qo(b,u,H)})}var wp=mr(function(m,b){return Tt(m)?bh(m,b):[]}),X_=mr(function(m){return nu(hl(m,Tt))}),K_=mr(function(m){var b=Qs(m);return Tt(b)&&(b=u),nu(hl(m,Tt),wn(b,2))}),Yy=mr(function(m){var b=Qs(m);return b=typeof b=="function"?b:u,nu(hl(m,Tt),u,b)}),ss=mr(Dh),Ja=mr(function(m){var b=m.length,O=b>1?m[b-1]:u;return O=typeof O=="function"?(m.pop(),O):u,Gd(m,O)});function Lh(m){var b=ce(m);return b.__chain__=!0,b}function Po(m,b){return b(m)}var bl=fi(function(m){var b=m.length,O=b?m[0]:0,H=this.__wrapped__,ie=function(de){return Fm(de,m)};return!(b>1||this.__actions__.length)&&H instanceof yr&&yi(O)?((H=H.slice(O,+O+(b?1:0))).__actions__.push({func:Po,args:[ie],thisArg:u}),new As(H,this.__chain__).thru(function(de){return b&&!de.length&&de.push(u),de})):this.thru(ie)}),ea=Pd(function(m,b,O){Pr.call(m,O)?++m[O]:Dc(m,O,1)}),Ni=p0(Oi),po=p0(Fc);function Cp(m,b){return(Ce(m)?er:Nu)(m,wn(b,3))}function ng(m,b){return(Ce(m)?B_:ap)(m,wn(b,3))}var v0=Pd(function(m,b,O){Pr.call(m,O)?m[O].push(b):Dc(m,O,[b])}),Y_=mr(function(m,b,O){var H=-1,ie=typeof b=="function",de=He(m)?Vt(m.length):[];return Nu(m,function(Se){de[++H]=ie?qo(b,Se,O):vl(Se,b,O)}),de}),y0=Pd(function(m,b,O){Dc(m,O,b)});function Rp(m,b){return(Ce(m)?pr:Ko)(m,wn(b,3))}var rg=Pd(function(m,b,O){m[O?0:1].push(b)},function(){return[[],[]]}),Jy=mr(function(m,b){if(m==null)return[];var O=b.length;return O>1&&Bs(m,b[0],b[1])?b=[]:O>2&&Bs(b[0],b[1],b[2])&&(b=[b[0]]),Mo(m,Ys(b,1),[])}),Ap=$i||function(){return an.Date.now()};function f(m,b,O){return b=O?u:b,b=m&&b==null?m.length:b,qa(m,T,u,u,u,u,b)}function g(m,b){var O;if(typeof b!="function")throw new uo(h);return m=he(m),function(){return--m>0&&(O=b.apply(this,arguments)),m<=1&&(b=u),O}}var C=mr(function(m,b,O){var H=1;if(O.length){var ie=Li(O,Fs(C));H|=y}return qa(m,H,b,O,ie)}),N=mr(function(m,b,O){var H=3;if(O.length){var ie=Li(O,Fs(N));H|=y}return qa(b,H,m,O,ie)});function B(m,b,O){var H,ie,de,Se,we,je,pt=0,dt=!1,At=!1,yn=!0;if(typeof m!="function")throw new uo(h);function Cn($t){var kr=H,fr=ie;return H=ie=u,pt=$t,Se=m.apply(fr,kr)}function jn($t){var kr=$t-je;return je===u||kr>=b||kr<0||At&&$t-pt>=de}function mt(){var $t=Ap();if(jn($t))return Pt($t);we=Ya(mt,function(kr){var fr=b-(kr-je);return At?Zi(fr,de-(kr-pt)):fr}($t))}function Pt($t){return we=u,yn&&H?Cn($t):(H=ie=u,Se)}function Kn(){var $t=Ap(),kr=jn($t);if(H=arguments,ie=this,je=$t,kr){if(we===u)return function(fr){return pt=fr,we=Ya(mt,b),dt?Cn(fr):Se}(je);if(At)return ru(we),we=Ya(mt,b),Cn(je)}return we===u&&(we=Ya(mt,b)),Se}return b=yt(b)||0,w(O)&&(dt=!!O.leading,de=(At="maxWait"in O)?Xr(yt(O.maxWait)||0,b):de,yn="trailing"in O?!!O.trailing:yn),Kn.cancel=function(){we!==u&&ru(we),pt=0,H=je=ie=we=u},Kn.flush=function(){return we===u?Se:Pt(Ap())},Kn}var Y=mr(function(m,b){return Bm(m,1,b)}),me=mr(function(m,b,O){return Bm(m,yt(b)||0,O)});function xe(m,b){if(typeof m!="function"||b!=null&&typeof b!="function")throw new uo(h);var O=function(){var H=arguments,ie=b?b.apply(this,H):H[0],de=O.cache;if(de.has(ie))return de.get(ie);var Se=m.apply(this,H);return O.cache=de.set(ie,Se)||de,Se};return O.cache=new(xe.Cache||Oc),O}function tt(m){if(typeof m!="function")throw new uo(h);return function(){var b=arguments;switch(b.length){case 0:return!m.call(this);case 1:return!m.call(this,b[0]);case 2:return!m.call(this,b[0],b[1]);case 3:return!m.call(this,b[0],b[1],b[2])}return!m.apply(this,b)}}xe.Cache=Oc;var Mt=$_(function(m,b){var O=(b=b.length==1&&Ce(b[0])?pr(b[0],Va(wn())):pr(Ys(b,1),Va(wn()))).length;return mr(function(H){for(var ie=-1,de=Zi(H.length,O);++ie<de;)H[ie]=b[ie].call(this,H[ie]);return qo(m,this,H)})}),rn=mr(function(m,b){var O=Li(b,Fs(rn));return qa(m,y,u,b,O)}),ir=mr(function(m,b){var O=Li(b,Fs(ir));return qa(m,S,u,b,O)}),on=fi(function(m,b){return qa(m,A,u,u,u,b)});function $n(m,b){return m===b||m!=m&&b!=b}var hn=kh(vi),Do=kh(function(m,b){return m>=b}),_r=lp(function(){return arguments}())?lp:function(m){return M(m)&&Pr.call(m,"callee")&&!tp.call(m,"callee")},Ce=Vt.isArray,De=ph?Va(ph):function(m){return M(m)&&Ms(m)==_e};function He(m){return m!=null&&E(m.length)&&!x(m)}function Tt(m){return M(m)&&He(m)}var un=ip||kp,tr=md?Va(md):function(m){return M(m)&&Ms(m)==W};function nr(m){if(!M(m))return!1;var b=Ms(m);return b==X||b=="[object DOMException]"||typeof m.message=="string"&&typeof m.name=="string"&&!q(m)}function x(m){if(!w(m))return!1;var b=Ms(m);return b==$||b==K||b=="[object AsyncFunction]"||b=="[object Proxy]"}function v(m){return typeof m=="number"&&m==he(m)}function E(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=I}function w(m){var b=typeof m;return m!=null&&(b=="object"||b=="function")}function M(m){return m!=null&&typeof m=="object"}var k=ql?Va(ql):function(m){return M(m)&&Xi(m)==te};function P(m){return typeof m=="number"||M(m)&&Ms(m)==Q}function q(m){if(!M(m)||Ms(m)!=ne)return!1;var b=yd(m);if(b===null)return!0;var O=Pr.call(b,"constructor")&&b.constructor;return typeof O=="function"&&O instanceof O&&gl.call(O)==Iu}var Z=Wf?Va(Wf):function(m){return M(m)&&Ms(m)==J},j=$f?Va($f):function(m){return M(m)&&Xi(m)==re};function ee(m){return typeof m=="string"||!Ce(m)&&M(m)&&Ms(m)==ue}function se(m){return typeof m=="symbol"||M(m)&&Ms(m)==ye}var ae=wu?Va(wu):function(m){return M(m)&&E(m.length)&&!!Gn[Ms(m)]},ve=kh(hp),Le=kh(function(m,b){return m<=b});function Te(m){if(!m)return[];if(He(m))return ee(m)?gs(m):ko(m);if(Mc&&m[Mc])return function(O){for(var H,ie=[];!(H=O.next()).done;)ie.push(H.value);return ie}(m[Mc]());var b=Xi(m);return(b==te?mh:b==re?ya:Ti)(m)}function ge(m){return m?(m=yt(m))===R||m===-1/0?17976931348623157e292*(m<0?-1:1):m==m?m:0:m===0?m:0}function he(m){var b=ge(m),O=b%1;return b==b?O?b-O:b:0}function $e(m){return m?Ql(he(m),0,D):0}function yt(m){if(typeof m=="number")return m;if(se(m))return U;if(w(m)){var b=typeof m.valueOf=="function"?m.valueOf():m;m=w(b)?b+"":b}if(typeof m!="string")return m===0?m:+m;m=Jf(m);var O=et.test(m);return O||Ht.test(m)?lo(m.slice(2),O?2:8):Nt.test(m)?U:+m}function Bt(m){return Uc(m,Bn(m))}function _t(m){return m==null?"":Yo(m)}var Pn=Lu(function(m,b){if(uc(b)||He(b))Uc(b,pn(b),m);else for(var O in b)Pr.call(b,O)&&Jl(m,O,b[O])}),Mn=Lu(function(m,b){Uc(b,Bn(b),m)}),Er=Lu(function(m,b,O,H){Uc(b,Bn(b),m,H)}),Cr=Lu(function(m,b,O,H){Uc(b,pn(b),m,H)}),Rr=fi(Fm),Ar=mr(function(m,b){m=wr(m);var O=-1,H=b.length,ie=H>2?b[2]:u;for(ie&&Bs(b[0],b[1],ie)&&(H=1);++O<H;)for(var de=b[O],Se=Bn(de),we=-1,je=Se.length;++we<je;){var pt=Se[we],dt=m[pt];(dt===u||$n(dt,Ps[pt])&&!Pr.call(m,pt))&&(m[pt]=de[pt])}return m}),cr=mr(function(m){return m.push(u,Ka),qo(Ui,u,m)});function br(m,b,O){var H=m==null?u:es(m,b);return H===u?O:H}function Tr(m,b){return m!=null&&Oo(m,b,Th)}var xr=m0(function(m,b,O){b!=null&&typeof b.toString!="function"&&(b=Zf.call(b)),m[b]=O},Tl(Ss)),Mr=m0(function(m,b,O){b!=null&&typeof b.toString!="function"&&(b=Zf.call(b)),Pr.call(m,b)?m[b].push(O):m[b]=[O]},wn),qn=mr(vl);function pn(m){return He(m)?Dm(m):Ad(m)}function Bn(m){return He(m)?Dm(m,!0):up(m)}var oi=Lu(function(m,b,O){Gm(m,b,O)}),Ui=Lu(function(m,b,O,H){Gm(m,b,O,H)}),Fi=fi(function(m,b){var O={};if(m==null)return O;var H=!1;b=pr(b,function(de){return de=Lc(de,m),H||(H=de.length>1),de}),Uc(m,ts(m),O),H&&(O=Ao(O,7,di));for(var ie=b.length;ie--;)Jo(O,b[ie]);return O}),os=fi(function(m,b){return m==null?{}:function(O,H){return u0(O,H,function(ie,de){return Tr(O,de)})}(m,b)});function Ki(m,b){if(m==null)return{};var O=pr(ts(m),function(H){return[H]});return b=wn(b),u0(m,O,function(H,ie){return b(H,ie[0])})}var Yi=yp(pn),Bi=yp(Bn);function Ti(m){return m==null?[]:qr(m,pn(m))}var Ji=Ah(function(m,b,O){return b=b.toLowerCase(),m+(O?ks(b):b)});function ks(m){return wa(_t(m).toLowerCase())}function zi(m){return(m=_t(m))&&m.replace(Ee,s0).replace(fn,"")}var ta=Ah(function(m,b,O){return m+(O?"-":"")+b.toLowerCase()}),Lo=Ah(function(m,b,O){return m+(O?" ":"")+b.toLowerCase()}),Qa=mp("toLowerCase"),Za=Ah(function(m,b,O){return m+(O?"_":"")+b.toLowerCase()}),na=Ah(function(m,b,O){return m+(O?" ":"")+wa(b)}),Bc=Ah(function(m,b,O){return m+(O?" ":"")+b.toUpperCase()}),wa=mp("toUpperCase");function dc(m,b,O){return m=_t(m),(b=O?u:b)===u?function(H){return Pi.test(H)}(m)?function(H){return H.match(hr)||[]}(m):function(H){return H.match(Zt)||[]}(m):m.match(b)||[]}var zc=mr(function(m,b){try{return qo(m,u,b)}catch(O){return nr(O)?O:new Nr(O)}}),Ca=fi(function(m,b){return er(b,function(O){O=hc(O),Dc(m,O,C(m[O],m))}),m});function Tl(m){return function(){return m}}var Uh=Qm(),ou=Qm(!0);function Ss(m){return m}function au(m){return Rd(typeof m=="function"?m:Ao(m,1))}var Vu=mr(function(m,b){return function(O){return vl(O,m,b)}}),ju=mr(function(m,b){return function(O){return vl(m,O,b)}});function cu(m,b,O){var H=pn(b),ie=_l(b,H);O!=null||w(b)&&(ie.length||!H.length)||(O=b,b=m,m=this,ie=_l(b,pn(b)));var de=!(w(O)&&"chain"in O&&!O.chain),Se=x(m);return er(ie,function(we){var je=b[we];m[we]=je,Se&&(m.prototype[we]=function(){var pt=this.__chain__;if(de||pt){var dt=m(this.__wrapped__);return(dt.__actions__=ko(this.__actions__)).push({func:je,args:arguments,thisArg:m}),dt.__chain__=pt,dt}return je.apply(m,dl([this.value()],arguments))})}),m}function xl(){}var Hu=Dd(pr),Gu=Dd(Mm),ig=Dd(km);function Mp(m){return Fd(m)?Yf(hc(m)):function(b){return function(O){return es(O,b)}}(m)}var sg=vp(),og=vp(!0);function Ip(){return[]}function kp(){return!1}var S0=Mh(function(m,b){return m+b},0),E0=Ud("ceil"),b0=Mh(function(m,b){return m/b},1),J_=Ud("floor"),T0,Wd=Mh(function(m,b){return m*b},1),Q_=Ud("round"),Z_=Mh(function(m,b){return m-b},0);return ce.after=function(m,b){if(typeof b!="function")throw new uo(h);return m=he(m),function(){if(--m<1)return b.apply(this,arguments)}},ce.ary=f,ce.assign=Pn,ce.assignIn=Mn,ce.assignInWith=Er,ce.assignWith=Cr,ce.at=Rr,ce.before=g,ce.bind=C,ce.bindAll=Ca,ce.bindKey=N,ce.castArray=function(){if(!arguments.length)return[];var m=arguments[0];return Ce(m)?m:[m]},ce.chain=Lh,ce.chunk=function(m,b,O){b=(O?Bs(m,b,O):b===u)?1:Xr(he(b),0);var H=m==null?0:m.length;if(!H||b<1)return[];for(var ie=0,de=0,Se=Vt(np(H/b));ie<H;)Se[de++]=Io(m,ie,ie+=b);return Se},ce.compact=function(m){for(var b=-1,O=m==null?0:m.length,H=0,ie=[];++b<O;){var de=m[b];de&&(ie[H++]=de)}return ie},ce.concat=function(){var m=arguments.length;if(!m)return[];for(var b=Vt(m-1),O=arguments[0],H=m;H--;)b[H-1]=arguments[H];return dl(Ce(O)?ko(O):[O],Ys(b,1))},ce.cond=function(m){var b=m==null?0:m.length,O=wn();return m=b?pr(m,function(H){if(typeof H[1]!="function")throw new uo(h);return[O(H[0]),H[1]]}):[],mr(function(H){for(var ie=-1;++ie<b;){var de=m[ie];if(qo(de[0],this,H))return qo(de[1],this,H)}})},ce.conforms=function(m){return function(b){var O=pn(b);return function(H){return ys(H,b,O)}}(Ao(m,1))},ce.constant=Tl,ce.countBy=ea,ce.create=function(m,b){var O=Ro(m);return b==null?O:Td(O,b)},ce.curry=function m(b,O,H){var ie=qa(b,8,u,u,u,u,u,O=H?u:O);return ie.placeholder=m.placeholder,ie},ce.curryRight=function m(b,O,H){var ie=qa(b,_,u,u,u,u,u,O=H?u:O);return ie.placeholder=m.placeholder,ie},ce.debounce=B,ce.defaults=Ar,ce.defaultsDeep=cr,ce.defer=Y,ce.delay=me,ce.difference=jd,ce.differenceBy=Vs,ce.differenceWith=Hd,ce.drop=function(m,b,O){var H=m==null?0:m.length;return H?Io(m,(b=O||b===u?1:he(b))<0?0:b,H):[]},ce.dropRight=function(m,b,O){var H=m==null?0:m.length;return H?Io(m,0,(b=H-(b=O||b===u?1:he(b)))<0?0:b):[]},ce.dropRightWhile=function(m,b){return m&&m.length?Km(m,wn(b,3),!0,!0):[]},ce.dropWhile=function(m,b){return m&&m.length?Km(m,wn(b,3),!0):[]},ce.fill=function(m,b,O,H){var ie=m==null?0:m.length;return ie?(O&&typeof O!="number"&&Bs(m,b,O)&&(O=0,H=ie),function(de,Se,we,je){var pt=de.length;for((we=he(we))<0&&(we=-we>pt?0:pt+we),(je=je===u||je>pt?pt:he(je))<0&&(je+=pt),je=we>je?0:$e(je);we<je;)de[we++]=Se;return de}(m,b,O,H)):[]},ce.filter=function(m,b){return(Ce(m)?hl:xd)(m,wn(b,3))},ce.flatMap=function(m,b){return Ys(Rp(m,b),1)},ce.flatMapDeep=function(m,b){return Ys(Rp(m,b),R)},ce.flatMapDepth=function(m,b,O){return O=O===u?1:he(O),Ys(Rp(m,b),O)},ce.flatten=_0,ce.flattenDeep=function(m){return m!=null&&m.length?Ys(m,R):[]},ce.flattenDepth=function(m,b){return m!=null&&m.length?Ys(m,b=b===u?1:he(b)):[]},ce.flip=function(m){return qa(m,512)},ce.flow=Uh,ce.flowRight=ou,ce.fromPairs=function(m){for(var b=-1,O=m==null?0:m.length,H={};++b<O;){var ie=m[b];H[ie[0]]=ie[1]}return H},ce.functions=function(m){return m==null?[]:_l(m,pn(m))},ce.functionsIn=function(m){return m==null?[]:_l(m,Bn(m))},ce.groupBy=v0,ce.initial=function(m){return m!=null&&m.length?Io(m,0,-1):[]},ce.intersection=Ph,ce.intersectionBy=Zo,ce.intersectionWith=No,ce.invert=xr,ce.invertBy=Mr,ce.invokeMap=Y_,ce.iteratee=au,ce.keyBy=y0,ce.keys=pn,ce.keysIn=Bn,ce.map=Rp,ce.mapKeys=function(m,b){var O={};return b=wn(b,3),Ea(m,function(H,ie,de){Dc(O,b(H,ie,de),H)}),O},ce.mapValues=function(m,b){var O={};return b=wn(b,3),Ea(m,function(H,ie,de){Dc(O,ie,b(H,ie,de))}),O},ce.matches=function(m){return Js(Ao(m,1))},ce.matchesProperty=function(m,b){return l0(m,Ao(b,1))},ce.memoize=xe,ce.merge=oi,ce.mergeWith=Ui,ce.method=Vu,ce.methodOf=ju,ce.mixin=cu,ce.negate=tt,ce.nthArg=function(m){return m=he(m),mr(function(b){return ba(b,m)})},ce.omit=Fi,ce.omitBy=function(m,b){return Ki(m,tt(wn(b)))},ce.once=function(m){return g(2,m)},ce.orderBy=function(m,b,O,H){return m==null?[]:(Ce(b)||(b=b==null?[]:[b]),Ce(O=H?u:O)||(O=O==null?[]:[O]),Mo(m,b,O))},ce.over=Hu,ce.overArgs=Mt,ce.overEvery=Gu,ce.overSome=ig,ce.partial=rn,ce.partialRight=ir,ce.partition=rg,ce.pick=os,ce.pickBy=Ki,ce.property=Mp,ce.propertyOf=function(m){return function(b){return m==null?u:es(m,b)}},ce.pull=tg,ce.pullAll=zu,ce.pullAllBy=function(m,b,O){return m&&m.length&&b&&b.length?Wm(m,b,wn(O,2)):m},ce.pullAllWith=function(m,b,O){return m&&m.length&&b&&b.length?Wm(m,b,u,O):m},ce.pullAt=su,ce.range=sg,ce.rangeRight=og,ce.rearg=on,ce.reject=function(m,b){return(Ce(m)?hl:xd)(m,tt(wn(b,3)))},ce.remove=function(m,b){var O=[];if(!m||!m.length)return O;var H=-1,ie=[],de=m.length;for(b=wn(b,3);++H<de;){var Se=m[H];b(Se,H,m)&&(O.push(Se),ie.push(H))}return h0(m,ie),O},ce.rest=function(m,b){if(typeof m!="function")throw new uo(h);return mr(m,b=b===u?b:he(b))},ce.reverse=Sr,ce.sampleSize=function(m,b,O){return b=(O?Bs(m,b,O):b===u)?1:he(b),(Ce(m)?Lm:d0)(m,b)},ce.set=function(m,b,O){return m==null?m:Md(m,b,O)},ce.setWith=function(m,b,O,H){return H=typeof H=="function"?H:u,m==null?m:Md(m,b,O,H)},ce.shuffle=function(m){return(Ce(m)?Eh:yl)(m)},ce.slice=function(m,b,O){var H=m==null?0:m.length;return H?(O&&typeof O!="number"&&Bs(m,b,O)?(b=0,O=H):(b=b==null?0:he(b),O=O===u?H:he(O)),Io(m,b,O)):[]},ce.sortBy=Jy,ce.sortedUniq=function(m){return m&&m.length?fp(m):[]},ce.sortedUniqBy=function(m,b){return m&&m.length?fp(m,wn(b,2)):[]},ce.split=function(m,b,O){return O&&typeof O!="number"&&Bs(m,b,O)&&(b=O=u),(O=O===u?D:O>>>0)?(m=_t(m))&&(typeof b=="string"||b!=null&&!Z(b))&&!(b=Yo(b))&&Xl(m)?fo(gs(m),0,O):m.split(b,O):[]},ce.spread=function(m,b){if(typeof m!="function")throw new uo(h);return b=b==null?0:Xr(he(b),0),mr(function(O){var H=O[b],ie=fo(O,0,b);return H&&dl(ie,H),qo(m,this,ie)})},ce.tail=function(m){var b=m==null?0:m.length;return b?Io(m,1,b):[]},ce.take=function(m,b,O){return m&&m.length?Io(m,0,(b=O||b===u?1:he(b))<0?0:b):[]},ce.takeRight=function(m,b,O){var H=m==null?0:m.length;return H?Io(m,(b=H-(b=O||b===u?1:he(b)))<0?0:b,H):[]},ce.takeRightWhile=function(m,b){return m&&m.length?Km(m,wn(b,3),!1,!0):[]},ce.takeWhile=function(m,b){return m&&m.length?Km(m,wn(b,3)):[]},ce.tap=function(m,b){return b(m),m},ce.throttle=function(m,b,O){var H=!0,ie=!0;if(typeof m!="function")throw new uo(h);return w(O)&&(H="leading"in O?!!O.leading:H,ie="trailing"in O?!!O.trailing:ie),B(m,b,{leading:H,maxWait:b,trailing:ie})},ce.thru=Po,ce.toArray=Te,ce.toPairs=Yi,ce.toPairsIn=Bi,ce.toPath=function(m){return Ce(m)?pr(m,hc):se(m)?[m]:ko(xp(_t(m)))},ce.toPlainObject=Bt,ce.transform=function(m,b,O){var H=Ce(m),ie=H||un(m)||ae(m);if(b=wn(b,4),O==null){var de=m&&m.constructor;O=ie?H?new de:[]:w(m)&&x(de)?Ro(yd(m)):{}}return(ie?er:Ea)(m,function(Se,we,je){return b(O,Se,we,je)}),O},ce.unary=function(m){return f(m,1)},ce.union=q_,ce.unionBy=xa,ce.unionWith=Ky,ce.uniq=function(m){return m&&m.length?tu(m):[]},ce.uniqBy=function(m,b){return m&&m.length?tu(m,wn(b,2)):[]},ce.uniqWith=function(m,b){return b=typeof b=="function"?b:u,m&&m.length?tu(m,u,b):[]},ce.unset=function(m,b){return m==null||Jo(m,b)},ce.unzip=Dh,ce.unzipWith=Gd,ce.update=function(m,b,O){return m==null?m:W_(m,b,wh(O))},ce.updateWith=function(m,b,O,H){return H=typeof H=="function"?H:u,m==null?m:W_(m,b,wh(O),H)},ce.values=Ti,ce.valuesIn=function(m){return m==null?[]:qr(m,Bn(m))},ce.without=wp,ce.words=dc,ce.wrap=function(m,b){return rn(wh(b),m)},ce.xor=X_,ce.xorBy=K_,ce.xorWith=Yy,ce.zip=ss,ce.zipObject=function(m,b){return pp(m||[],b||[],Jl)},ce.zipObjectDeep=function(m,b){return pp(m||[],b||[],Md)},ce.zipWith=Ja,ce.entries=Yi,ce.entriesIn=Bi,ce.extend=Mn,ce.extendWith=Er,cu(ce,ce),ce.add=S0,ce.attempt=zc,ce.camelCase=Ji,ce.capitalize=ks,ce.ceil=E0,ce.clamp=function(m,b,O){return O===u&&(O=b,b=u),O!==u&&(O=(O=yt(O))==O?O:0),b!==u&&(b=(b=yt(b))==b?b:0),Ql(yt(m),b,O)},ce.clone=function(m){return Ao(m,4)},ce.cloneDeep=function(m){return Ao(m,5)},ce.cloneDeepWith=function(m,b){return Ao(m,5,b=typeof b=="function"?b:u)},ce.cloneWith=function(m,b){return Ao(m,4,b=typeof b=="function"?b:u)},ce.conformsTo=function(m,b){return b==null||ys(m,b,pn(b))},ce.deburr=zi,ce.defaultTo=function(m,b){return m==null||m!=m?b:m},ce.divide=b0,ce.endsWith=function(m,b,O){m=_t(m),b=Yo(b);var H=m.length,ie=O=O===u?H:Ql(he(O),0,H);return(O-=b.length)>=0&&m.slice(O,ie)==b},ce.eq=$n,ce.escape=function(m){return(m=_t(m))&&pe.test(m)?m.replace(rt,vd):m},ce.escapeRegExp=function(m){return(m=_t(m))&&Wt.test(m)?m.replace(Dt,"\\$&"):m},ce.every=function(m,b,O){var H=Ce(m)?Mm:G_;return O&&Bs(m,b,O)&&(b=u),H(m,wn(b,3))},ce.find=Ni,ce.findIndex=Oi,ce.findKey=function(m,b){return wc(m,wn(b,3),Ea)},ce.findLast=po,ce.findLastIndex=Fc,ce.findLastKey=function(m,b){return wc(m,wn(b,3),c0)},ce.floor=J_,ce.forEach=Cp,ce.forEachRight=ng,ce.forIn=function(m,b){return m==null?m:zm(m,wn(b,3),Bn)},ce.forInRight=function(m,b){return m==null?m:Vm(m,wn(b,3),Bn)},ce.forOwn=function(m,b){return m&&Ea(m,wn(b,3))},ce.forOwnRight=function(m,b){return m&&c0(m,wn(b,3))},ce.get=br,ce.gt=hn,ce.gte=Do,ce.has=function(m,b){return m!=null&&Oo(m,b,wd)},ce.hasIn=Tr,ce.head=Bu,ce.identity=Ss,ce.includes=function(m,b,O,H){m=He(m)?m:Ti(m),O=O&&!H?he(O):0;var ie=m.length;return O<0&&(O=Xr(ie+O,0)),ee(m)?O<=ie&&m.indexOf(b,O)>-1:!!ie&&_d(m,b,O)>-1},ce.indexOf=function(m,b,O){var H=m==null?0:m.length;if(!H)return-1;var ie=O==null?0:he(O);return ie<0&&(ie=Xr(H+ie,0)),_d(m,b,ie)},ce.inRange=function(m,b,O){return b=ge(b),O===u?(O=b,b=0):O=ge(O),function(H,ie,de){return H>=Zi(ie,de)&&H<Xr(ie,de)}(m=yt(m),b,O)},ce.invoke=qn,ce.isArguments=_r,ce.isArray=Ce,ce.isArrayBuffer=De,ce.isArrayLike=He,ce.isArrayLikeObject=Tt,ce.isBoolean=function(m){return m===!0||m===!1||M(m)&&Ms(m)==V},ce.isBuffer=un,ce.isDate=tr,ce.isElement=function(m){return M(m)&&m.nodeType===1&&!q(m)},ce.isEmpty=function(m){if(m==null)return!0;if(He(m)&&(Ce(m)||typeof m=="string"||typeof m.splice=="function"||un(m)||ae(m)||_r(m)))return!m.length;var b=Xi(m);if(b==te||b==re)return!m.size;if(uc(m))return!Ad(m).length;for(var O in m)if(Pr.call(m,O))return!1;return!0},ce.isEqual=function(m,b){return ho(m,b)},ce.isEqualWith=function(m,b,O){var H=(O=typeof O=="function"?O:u)?O(m,b):u;return H===u?ho(m,b,u,O):!!H},ce.isError=nr,ce.isFinite=function(m){return typeof m=="number"&&Ls(m)},ce.isFunction=x,ce.isInteger=v,ce.isLength=E,ce.isMap=k,ce.isMatch=function(m,b){return m===b||Hm(m,b,bn(b))},ce.isMatchWith=function(m,b,O){return O=typeof O=="function"?O:u,Hm(m,b,bn(b),O)},ce.isNaN=function(m){return P(m)&&m!=+m},ce.isNative=function(m){if(eg(m))throw new Nr("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Cd(m)},ce.isNil=function(m){return m==null},ce.isNull=function(m){return m===null},ce.isNumber=P,ce.isObject=w,ce.isObjectLike=M,ce.isPlainObject=q,ce.isRegExp=Z,ce.isSafeInteger=function(m){return v(m)&&m>=-9007199254740991&&m<=I},ce.isSet=j,ce.isString=ee,ce.isSymbol=se,ce.isTypedArray=ae,ce.isUndefined=function(m){return m===u},ce.isWeakMap=function(m){return M(m)&&Xi(m)==Ne},ce.isWeakSet=function(m){return M(m)&&Ms(m)=="[object WeakSet]"},ce.join=function(m,b){return m==null?"":Sd.call(m,b)},ce.kebabCase=ta,ce.last=Qs,ce.lastIndexOf=function(m,b,O){var H=m==null?0:m.length;if(!H)return-1;var ie=H;return O!==u&&(ie=(ie=he(O))<0?Xr(H+ie,0):Zi(ie,H-1)),b==b?function(de,Se,we){for(var je=we+1;je--;)if(de[je]===Se)return je;return je}(m,b,ie):Om(m,pl,ie,!0)},ce.lowerCase=Lo,ce.lowerFirst=Qa,ce.lt=ve,ce.lte=Le,ce.max=function(m){return m&&m.length?cp(m,Ss,vi):u},ce.maxBy=function(m,b){return m&&m.length?cp(m,wn(b,2),vi):u},ce.mean=function(m){return Kf(m,Ss)},ce.meanBy=function(m,b){return Kf(m,wn(b,2))},ce.min=function(m){return m&&m.length?cp(m,Ss,hp):u},ce.minBy=function(m,b){return m&&m.length?cp(m,wn(b,2),hp):u},ce.stubArray=Ip,ce.stubFalse=kp,ce.stubObject=function(){return{}},ce.stubString=function(){return""},ce.stubTrue=function(){return!0},ce.multiply=Wd,ce.nth=function(m,b){return m&&m.length?ba(m,he(b)):u},ce.noConflict=function(){return an._===this&&(an._=o0),this},ce.noop=xl,ce.now=Ap,ce.pad=function(m,b,O){m=_t(m);var H=(b=he(b))?ms(m):0;if(!b||H>=b)return m;var ie=(b-H)/2;return Ih(qs(ie),O)+m+Ih(np(ie),O)},ce.padEnd=function(m,b,O){m=_t(m);var H=(b=he(b))?ms(m):0;return b&&H<b?m+Ih(b-H,O):m},ce.padStart=function(m,b,O){m=_t(m);var H=(b=he(b))?ms(m):0;return b&&H<b?Ih(b-H,O)+m:m},ce.parseInt=function(m,b,O){return O||b==null?b=0:b&&(b=+b),Ga(_t(m).replace(or,""),b||0)},ce.random=function(m,b,O){if(O&&typeof O!="boolean"&&Bs(m,b,O)&&(b=O=u),O===u&&(typeof b=="boolean"?(O=b,b=u):typeof m=="boolean"&&(O=m,m=u)),m===u&&b===u?(m=0,b=1):(m=ge(m),b===u?(b=m,m=0):b=ge(b)),m>b){var H=m;m=b,b=H}if(O||m%1||b%1){var ie=Xs();return Zi(m+ie*(b-m+hi("1e-"+((ie+"").length-1))),b)}return $m(m,b)},ce.reduce=function(m,b,O){var H=Ce(m)?r0:z_,ie=arguments.length<3;return H(m,wn(b,4),O,ie,Nu)},ce.reduceRight=function(m,b,O){var H=Ce(m)?Im:z_,ie=arguments.length<3;return H(m,wn(b,4),O,ie,ap)},ce.repeat=function(m,b,O){return b=(O?Bs(m,b,O):b===u)?1:he(b),qm(_t(m),b)},ce.replace=function(){var m=arguments,b=_t(m[0]);return m.length<3?b:b.replace(m[1],m[2])},ce.result=function(m,b,O){var H=-1,ie=(b=Lc(b,m)).length;for(ie||(ie=1,m=u);++H<ie;){var de=m==null?u:m[hc(b[H])];de===u&&(H=ie,de=O),m=x(de)?de.call(m):de}return m},ce.round=Q_,ce.runInContext=Ve,ce.sample=function(m){return(Ce(m)?Pc:dp)(m)},ce.size=function(m){if(m==null)return 0;if(He(m))return ee(m)?ms(m):m.length;var b=Xi(m);return b==te||b==re?m.size:Ad(m).length},ce.snakeCase=Za,ce.some=function(m,b,O){var H=Ce(m)?km:Sl;return O&&Bs(m,b,O)&&(b=u),H(m,wn(b,3))},ce.sortedIndex=function(m,b){return Du(m,b)},ce.sortedIndexBy=function(m,b,O){return Xm(m,b,wn(O,2))},ce.sortedIndexOf=function(m,b){var O=m==null?0:m.length;if(O){var H=Du(m,b);if(H<O&&$n(m[H],b))return H}return-1},ce.sortedLastIndex=function(m,b){return Du(m,b,!0)},ce.sortedLastIndexBy=function(m,b,O){return Xm(m,b,wn(O,2),!0)},ce.sortedLastIndexOf=function(m,b){if(m!=null&&m.length){var O=Du(m,b,!0)-1;if($n(m[O],b))return O}return-1},ce.startCase=na,ce.startsWith=function(m,b,O){return m=_t(m),O=O==null?0:Ql(he(O),0,m.length),b=Yo(b),m.slice(O,O+b.length)==b},ce.subtract=Z_,ce.sum=function(m){return m&&m.length?za(m,Ss):0},ce.sumBy=function(m,b){return m&&m.length?za(m,wn(b,2)):0},ce.template=function(m,b,O){var H=ce.templateSettings;O&&Bs(m,b,O)&&(b=u),m=_t(m),b=Er({},b,H,Xa);var ie,de,Se=Er({},b.imports,H.imports,Xa),we=pn(Se),je=qr(Se,we),pt=0,dt=b.interpolate||ze,At="__p += '",yn=gh((b.escape||ze).source+"|"+dt.source+"|"+(dt===Je?ii:ze).source+"|"+(b.evaluate||ze).source+"|$","g"),Cn="//# sourceURL="+(Pr.call(b,"sourceURL")?(b.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ws+"]")+`
`;m.replace(yn,function(Pt,Kn,$t,kr,fr,xi){return $t||($t=kr),At+=m.slice(pt,xi).replace(st,V_),Kn&&(ie=!0,At+=`' +
__e(`+Kn+`) +
'`),fr&&(de=!0,At+=`';
`+fr+`;
__p += '`),$t&&(At+=`' +
((__t = (`+$t+`)) == null ? '' : __t) +
'`),pt=xi+Pt.length,Pt}),At+=`';
`;var jn=Pr.call(b,"variable")&&b.variable;if(jn){if(Ir.test(jn))throw new Nr("Invalid `variable` option passed into `_.template`")}else At=`with (obj) {
`+At+`
}
`;At=(de?At.replace(St,""):At).replace(Qe,"$1").replace(nn,"$1;"),At="function("+(jn||"obj")+`) {
`+(jn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ie?", __e = _.escape":"")+(de?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+At+`return __p
}`;var mt=zc(function(){return Cs(we,Cn+"return "+At).apply(u,je)});if(mt.source=At,nr(mt))throw mt;return mt},ce.times=function(m,b){if((m=he(m))<1||m>I)return[];var O=D,H=Zi(m,D);b=wn(b),m-=D;for(var ie=i0(H,b);++O<m;)b(O);return ie},ce.toFinite=ge,ce.toInteger=he,ce.toLength=$e,ce.toLower=function(m){return _t(m).toLowerCase()},ce.toNumber=yt,ce.toSafeInteger=function(m){return m?Ql(he(m),-9007199254740991,I):m===0?m:0},ce.toString=_t,ce.toUpper=function(m){return _t(m).toUpperCase()},ce.trim=function(m,b,O){if((m=_t(m))&&(O||b===u))return Jf(m);if(!m||!(b=Yo(b)))return m;var H=gs(m),ie=gs(b);return fo(H,Qf(H,ie),ml(H,ie)+1).join("")},ce.trimEnd=function(m,b,O){if((m=_t(m))&&(O||b===u))return m.slice(0,Rc(m)+1);if(!m||!(b=Yo(b)))return m;var H=gs(m);return fo(H,0,ml(H,gs(b))+1).join("")},ce.trimStart=function(m,b,O){if((m=_t(m))&&(O||b===u))return m.replace(or,"");if(!m||!(b=Yo(b)))return m;var H=gs(m);return fo(H,Qf(H,gs(b))).join("")},ce.truncate=function(m,b){var O=30,H="...";if(w(b)){var ie="separator"in b?b.separator:ie;O="length"in b?he(b.length):O,H="omission"in b?Yo(b.omission):H}var de=(m=_t(m)).length;if(Xl(m)){var Se=gs(m);de=Se.length}if(O>=de)return m;var we=O-ms(H);if(we<1)return H;var je=Se?fo(Se,0,we).join(""):m.slice(0,we);if(ie===u)return je+H;if(Se&&(we+=je.length-we),Z(ie)){if(m.slice(we).search(ie)){var pt,dt=je;for(ie.global||(ie=gh(ie.source,_t(Me.exec(ie))+"g")),ie.lastIndex=0;pt=ie.exec(dt);)var At=pt.index;je=je.slice(0,At===u?we:At)}}else if(m.indexOf(Yo(ie),we)!=we){var yn=je.lastIndexOf(ie);yn>-1&&(je=je.slice(0,yn))}return je+H},ce.unescape=function(m){return(m=_t(m))&&nt.test(m)?m.replace(Ot,Xo):m},ce.uniqueId=function(m){var b=++ac;return _t(m)+b},ce.upperCase=Bc,ce.upperFirst=wa,ce.each=Cp,ce.eachRight=ng,ce.first=Bu,cu(ce,(T0={},Ea(ce,function(m,b){Pr.call(ce.prototype,b)||(T0[b]=m)}),T0),{chain:!1}),ce.VERSION="4.17.21",er(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){ce[m].placeholder=ce}),er(["drop","take"],function(m,b){yr.prototype[m]=function(O){O=O===u?1:Xr(he(O),0);var H=this.__filtered__&&!b?new yr(this):this.clone();return H.__filtered__?H.__takeCount__=Zi(O,H.__takeCount__):H.__views__.push({size:Zi(O,D),type:m+(H.__dir__<0?"Right":"")}),H},yr.prototype[m+"Right"]=function(O){return this.reverse()[m](O).reverse()}}),er(["filter","map","takeWhile"],function(m,b){var O=b+1,H=O==1||O==3;yr.prototype[m]=function(ie){var de=this.clone();return de.__iteratees__.push({iteratee:wn(ie,3),type:O}),de.__filtered__=de.__filtered__||H,de}}),er(["head","last"],function(m,b){var O="take"+(b?"Right":"");yr.prototype[m]=function(){return this[O](1).value()[0]}}),er(["initial","tail"],function(m,b){var O="drop"+(b?"":"Right");yr.prototype[m]=function(){return this.__filtered__?new yr(this):this[O](1)}}),yr.prototype.compact=function(){return this.filter(Ss)},yr.prototype.find=function(m){return this.filter(m).head()},yr.prototype.findLast=function(m){return this.reverse().find(m)},yr.prototype.invokeMap=mr(function(m,b){return typeof m=="function"?new yr(this):this.map(function(O){return vl(O,m,b)})}),yr.prototype.reject=function(m){return this.filter(tt(wn(m)))},yr.prototype.slice=function(m,b){m=he(m);var O=this;return O.__filtered__&&(m>0||b<0)?new yr(O):(m<0?O=O.takeRight(-m):m&&(O=O.drop(m)),b!==u&&(O=(b=he(b))<0?O.dropRight(-b):O.take(b-m)),O)},yr.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},yr.prototype.toArray=function(){return this.take(D)},Ea(yr.prototype,function(m,b){var O=/^(?:filter|find|map|reject)|While$/.test(b),H=/^(?:head|last)$/.test(b),ie=ce[H?"take"+(b=="last"?"Right":""):b],de=H||/^find/.test(b);ie&&(ce.prototype[b]=function(){var Se=this.__wrapped__,we=H?[1]:arguments,je=Se instanceof yr,pt=we[0],dt=je||Ce(Se),At=function(Kn){var $t=ie.apply(ce,dl([Kn],we));return H&&yn?$t[0]:$t};dt&&O&&typeof pt=="function"&&pt.length!=1&&(je=dt=!1);var yn=this.__chain__,Cn=!!this.__actions__.length,jn=de&&!yn,mt=je&&!Cn;if(!de&&dt){Se=mt?Se:new yr(this);var Pt=m.apply(Se,we);return Pt.__actions__.push({func:Po,args:[At],thisArg:u}),new As(Pt,yn)}return jn&&mt?m.apply(this,we):(Pt=this.thru(At),jn?H?Pt.value()[0]:Pt.value():Pt)})}),er(["pop","push","shift","sort","splice","unshift"],function(m){var b=vh[m],O=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",H=/^(?:pop|shift)$/.test(m);ce.prototype[m]=function(){var ie=arguments;if(H&&!this.__chain__){var de=this.value();return b.apply(Ce(de)?de:[],ie)}return this[O](function(Se){return b.apply(Ce(Se)?Se:[],ie)})}}),Ea(yr.prototype,function(m,b){var O=ce[b];if(O){var H=O.name+"";Pr.call(qi,H)||(qi[H]=[]),qi[H].push({name:b,func:O})}}),qi[_p(u,2).name]=[{name:"wrapper",func:u}],yr.prototype.clone=function(){var m=new yr(this.__wrapped__);return m.__actions__=ko(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=ko(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=ko(this.__views__),m},yr.prototype.reverse=function(){if(this.__filtered__){var m=new yr(this);m.__dir__=-1,m.__filtered__=!0}else(m=this.clone()).__dir__*=-1;return m},yr.prototype.value=function(){var m=this.__wrapped__.value(),b=this.__dir__,O=Ce(m),H=b<0,ie=O?m.length:0,de=function(xi,Nn,Yn){for(var ra=-1,mo=Yn.length;++ra<mo;){var Vc=Yn[ra],Es=Vc.size;switch(Vc.type){case"drop":xi+=Es;break;case"dropRight":Nn-=Es;break;case"take":Nn=Zi(Nn,xi+Es);break;case"takeRight":xi=Xr(xi,Nn-Es)}}return{start:xi,end:Nn}}(0,ie,this.__views__),Se=de.start,we=de.end,je=we-Se,pt=H?we:Se-1,dt=this.__iteratees__,At=dt.length,yn=0,Cn=Zi(je,this.__takeCount__);if(!O||!H&&ie==je&&Cn==je)return xh(m,this.__actions__);var jn=[];e:for(;je--&&yn<Cn;){for(var mt=-1,Pt=m[pt+=b];++mt<At;){var Kn=dt[mt],$t=Kn.iteratee,kr=Kn.type,fr=$t(Pt);if(kr==2)Pt=fr;else if(!fr){if(kr==1)continue e;break e}}jn[yn++]=Pt}return jn},ce.prototype.at=bl,ce.prototype.chain=function(){return Lh(this)},ce.prototype.commit=function(){return new As(this.value(),this.__chain__)},ce.prototype.next=function(){this.__values__===u&&(this.__values__=Te(this.value()));var m=this.__index__>=this.__values__.length;return{done:m,value:m?u:this.__values__[this.__index__++]}},ce.prototype.plant=function(m){for(var b,O=this;O instanceof Sa;){var H=iu(O);H.__index__=0,H.__values__=u,b?ie.__wrapped__=H:b=H;var ie=H;O=O.__wrapped__}return ie.__wrapped__=m,b},ce.prototype.reverse=function(){var m=this.__wrapped__;if(m instanceof yr){var b=m;return this.__actions__.length&&(b=new yr(this)),(b=b.reverse()).__actions__.push({func:Po,args:[Sr],thisArg:u}),new As(b,this.__chain__)}return this.thru(Sr)},ce.prototype.toJSON=ce.prototype.valueOf=ce.prototype.value=function(){return xh(this.__wrapped__,this.__actions__)},ce.prototype.first=ce.prototype.head,Mc&&(ce.prototype[Mc]=function(){return this}),ce}();an._=Au,(l=(function(){return Au}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},2492:(o,a,c)=>{var l=c(2980),u=c(1463)(function(h,d,p){l(h,d,p)});o.exports=u},5062:o=>{o.exports=function(){return!1}},9881:(o,a,c)=>{var l=c(8363),u=c(1704);o.exports=function(h){return l(h,u(h))}},6692:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach(function(c){a[c].forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})},766:(o,a,c)=>{var l=c(962),u=c(8627);a.cW=u,a.Qc=l.parse,a.rz=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},962:(o,a,c)=>{var l=function(_){return String(Number(_))===_?Number(_):_},u=function(_,y,S){var T=_.name&&_.names;_.push&&!y[_.push]?y[_.push]=[]:T&&!y[_.name]&&(y[_.name]={});var A=_.push?{}:T?y[_.name]:y;(function(R,I,U,D){if(D&&!U)I[D]=l(R[1]);else for(var L=0;L<U.length;L+=1)R[L+1]!=null&&(I[U[L]]=l(R[L+1]))})(S.match(_.reg),A,_.names,_.name),_.push&&y[_.push].push(A)},h=c(6692),d=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(_){var y={},S=[],T=y;return _.split(/(\r\n|\r|\n)/).filter(d).forEach(function(A){var R=A[0],I=A.slice(2);R==="m"&&(S.push({rtp:[],fmtp:[]}),T=S[S.length-1]);for(var U=0;U<(h[R]||[]).length;U+=1){var D=h[R][U];if(D.reg.test(I))return u(D,T,I)}}),y.media=S,y};var p=function(_,y){var S=y.split(/=(.+)/,2);return S.length===2?_[S[0]]=l(S[1]):S.length===1&&y.length>1&&(_[S[0]]=void 0),_};a.parseParams=function(_){return _.split(/;\s?/).reduce(p,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(_){return _.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(_){for(var y=[],S=_.split(" ").map(l),T=0;T<S.length;T+=3)y.push({component:S[T],ip:S[T+1],port:S[T+2]});return y},a.parseImageAttributes=function(_){return _.split(" ").map(function(y){return y.substring(1,y.length-1).split(",").reduce(p,{})})},a.parseSimulcastStreamList=function(_){return _.split(";").map(function(y){return y.split(",").map(function(S){var T,A=!1;return S[0]!=="~"?T=l(S):(T=l(S.substring(1,S.length)),A=!0),{scid:T,paused:A}})})}},8627:(o,a,c)=>{var l=c(6692),u=/%[sdv%]/g,h=function(y){var S=1,T=arguments,A=T.length;return y.replace(u,function(R){if(S>=A)return R;var I=T[S];switch(S+=1,R){case"%%":return"%";case"%s":return String(I);case"%d":return Number(I);case"%v":return""}})},d=function(y,S,T){var A=[y+"="+(S.format instanceof Function?S.format(S.push?T:T[S.name]):S.format)];if(S.names)for(var R=0;R<S.names.length;R+=1){var I=S.names[R];S.name?A.push(T[S.name][I]):A.push(T[S.names[R]])}else A.push(T[S.name]);return h.apply(null,A)},p=["v","o","s","i","u","e","p","c","b","t","r","z","a"],_=["i","c","b","a"];o.exports=function(y,S){S=S||{},y.version==null&&(y.version=0),y.name==null&&(y.name=" "),y.media.forEach(function(I){I.payloads==null&&(I.payloads="")});var T=S.outerOrder||p,A=S.innerOrder||_,R=[];return T.forEach(function(I){l[I].forEach(function(U){U.name in y&&y[U.name]!=null?R.push(d(I,U,y)):U.push in y&&y[U.push]!=null&&y[U.push].forEach(function(D){R.push(d(I,U,D))})})}),y.media.forEach(function(I){R.push(d("m",l.m[0],I)),A.forEach(function(U){l[U].forEach(function(D){D.name in I&&I[D.name]!=null?R.push(d(U,D,I)):D.push in I&&I[D.push]!=null&&I[D.push].forEach(function(L){R.push(d(U,D,L))})})})}),R.join(`\r
`)+`\r
`}},7539:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map(l=>l.trim())},a.splitSections=function(c){return c.split(`
m=`).map((l,u)=>(u>0?"m="+l:l).trim()+`\r
`)},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter(u=>u.indexOf(l)===0)},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let d=0;d<h.length;d++)u=h[d].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach(d=>{c.parameters[d]!==void 0?h.push(d+"="+c.parameters[d]):h.push(d)}),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(u=>parseInt(u,10))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach(h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],h=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let d=3;d<u.length;d++){const p=u[d],_=a.matchPrefix(c,"a=rtpmap:"+p+" ")[0];if(_){const y=a.parseRtpMap(_),S=a.matchPrefix(c,"a=fmtp:"+p+" ");switch(y.parameters=S.length?a.parseFmtp(S[0]):{},y.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),l.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(y.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach(d=>{l.headerExtensions.push(a.parseExtmap(d))});const h=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach(d=>{h.forEach(p=>{d.rtcpFeedback.find(_=>_.type===p.type&&_.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(d=>{u+=a.writeRtpMap(d),u+=a.writeFmtp(d),u+=a.writeRtcpFb(d)});let h=0;return l.codecs.forEach(d=>{d.maxptime>h&&(h=d.maxptime)}),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach(d=>{u+=a.writeExtmap(d)}),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,d=u.fecMechanisms.indexOf("ULPFEC")!==-1,p=a.matchPrefix(c,"a=ssrc:").map(A=>a.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),_=p.length>0&&p[0].ssrc;let y;const S=a.matchPrefix(c,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(R=>parseInt(R,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),u.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let R={ssrc:_,codecPayloadType:parseInt(A.parameters.apt,10)};_&&y&&(R.rtx={ssrc:y}),l.push(R),h&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:_,mechanism:d?"red+ulpfec":"red"},l.push(R))}}),l.length===0&&_&&l.push({ssrc:_});let T=a.matchPrefix(c,"b=");return T.length&&(T=T[0].indexOf("b=TIAS:")===0?parseInt(T[0].substring(7),10):T[0].indexOf("b=AS:")===0?1e3*parseInt(T[0].substring(5),10)*.95-16e3:void 0,l.forEach(A=>{A.maxBitrate=T})),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map(p=>a.parseSsrcMedia(p)).filter(p=>p.attribute==="cname")[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const d=a.matchPrefix(c,"a=rtcp-mux");return l.mux=d.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=a.matchPrefix(c,"a=ssrc:").map(d=>a.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const d=a.matchPrefix(c,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const p=a.matchPrefix(c,"a=sctpmap:");if(p.length>0){const _=p[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:h}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let h;const d=l!==void 0?l:2;return h=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},477:o=>{o.exports=function(a,c,l,u){var h=self||window;try{try{var d;try{d=new h.Blob([a])}catch{(d=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(a),d=d.getBlob()}var p=h.URL||h.webkitURL,_=p.createObjectURL(d),y=new h[c](_,l);return p.revokeObjectURL(_),y}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8520:(o,a,c)=>{var l;(function(u){(function(h){var d=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:function(){try{return Function("return this;")()}catch{}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch{}}(),p=_(u);function _(y,S){return function(T,A){Object.defineProperty(y,T,{configurable:!0,writable:!0,value:A}),S&&S(T,A)}}d.Reflect!==void 0&&(p=_(d.Reflect,p)),function(y,S){var T=Object.prototype.hasOwnProperty,A=typeof Symbol=="function",R=A&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",I=A&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",U=typeof Object.create=="function",D={__proto__:[]}instanceof Array,L=!U&&!D,z={create:U?function(){return Lt(Object.create(null))}:D?function(){return Lt({__proto__:null})}:function(){return Lt({})},has:L?function(Ee,ze){return T.call(Ee,ze)}:function(Ee,ze){return ze in Ee},get:L?function(Ee,ze){return T.call(Ee,ze)?Ee[ze]:void 0}:function(Ee,ze){return Ee[ze]}},F=Object.getPrototypeOf(Function),V=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:et(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ht(),X=typeof WeakMap=="function"?WeakMap:Ht(),$=A?Symbol.for("@reflect-metadata:registry"):void 0,K=Et(),te=ii(K);function Q(Ee,ze,st,ct){if(Qe(st)){if(!ut(Ee))throw new TypeError;if(!cn(ze))throw new TypeError;return Ye(Ee,ze)}if(!ut(Ee))throw new TypeError;if(!rt(ze))throw new TypeError;if(!rt(ct)&&!Qe(ct)&&!nn(ct))throw new TypeError;return nn(ct)&&(ct=void 0),Ze(Ee,ze,st=Je(st),ct)}function ne(Ee,ze){function st(ct,Rn){if(!rt(ct))throw new TypeError;if(!Qe(Rn)&&!Dt(Rn))throw new TypeError;Kt(Ee,ze,ct,Rn)}return st}function G(Ee,ze,st,ct){if(!rt(st))throw new TypeError;return Qe(ct)||(ct=Je(ct)),Kt(Ee,ze,st,ct)}function J(Ee,ze,st){if(!rt(ze))throw new TypeError;return Qe(st)||(st=Je(st)),Ke(Ee,ze,st)}function re(Ee,ze,st){if(!rt(ze))throw new TypeError;return Qe(st)||(st=Je(st)),It(Ee,ze,st)}function ue(Ee,ze,st){if(!rt(ze))throw new TypeError;return Qe(st)||(st=Je(st)),Xt(Ee,ze,st)}function ye(Ee,ze,st){if(!rt(ze))throw new TypeError;return Qe(st)||(st=Je(st)),Qt(Ee,ze,st)}function Ne(Ee,ze){if(!rt(Ee))throw new TypeError;return Qe(ze)||(ze=Je(ze)),xn(Ee,ze)}function _e(Ee,ze){if(!rt(Ee))throw new TypeError;return Qe(ze)||(ze=Je(ze)),Re(Ee,ze)}function Ae(Ee,ze,st){if(!rt(ze))throw new TypeError;if(Qe(st)||(st=Je(st)),!rt(ze))throw new TypeError;Qe(st)||(st=Je(st));var ct=Nt(ze,st,!1);return!Qe(ct)&&ct.OrdinaryDeleteMetadata(Ee,ze,st)}function Ye(Ee,ze){for(var st=Ee.length-1;st>=0;--st){var ct=(0,Ee[st])(ze);if(!Qe(ct)&&!nn(ct)){if(!cn(ct))throw new TypeError;ze=ct}}return ze}function Ze(Ee,ze,st,ct){for(var Rn=Ee.length-1;Rn>=0;--Rn){var Br=(0,Ee[Rn])(ze,st,ct);if(!Qe(Br)&&!nn(Br)){if(!rt(Br))throw new TypeError;ct=Br}}return ct}function Ke(Ee,ze,st){if(It(Ee,ze,st))return!0;var ct=Zt(ze);return!nn(ct)&&Ke(Ee,ct,st)}function It(Ee,ze,st){var ct=Nt(ze,st,!1);return!Qe(ct)&&oe(ct.OrdinaryHasOwnMetadata(Ee,ze,st))}function Xt(Ee,ze,st){if(It(Ee,ze,st))return Qt(Ee,ze,st);var ct=Zt(ze);return nn(ct)?void 0:Xt(Ee,ct,st)}function Qt(Ee,ze,st){var ct=Nt(ze,st,!1);if(!Qe(ct))return ct.OrdinaryGetOwnMetadata(Ee,ze,st)}function Kt(Ee,ze,st,ct){Nt(st,ct,!0).OrdinaryDefineOwnMetadata(Ee,ze,st,ct)}function xn(Ee,ze){var st=Re(Ee,ze),ct=Zt(Ee);if(ct===null)return st;var Rn=xn(ct,ze);if(Rn.length<=0)return st;if(st.length<=0)return Rn;for(var Br=new W,Qn=[],Fn=0,en=st;Fn<en.length;Fn++){var zt=en[Fn];Br.has(zt)||(Br.add(zt),Qn.push(zt))}for(var _n=0,vn=Rn;_n<vn.length;_n++)zt=vn[_n],Br.has(zt)||(Br.add(zt),Qn.push(zt));return Qn}function Re(Ee,ze){var st=Nt(Ee,ze,!1);return st?st.OrdinaryOwnMetadataKeys(Ee,ze):[]}function St(Ee){if(Ee===null)return 1;switch(typeof Ee){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ee===null?1:6;default:return 6}}function Qe(Ee){return Ee===void 0}function nn(Ee){return Ee===null}function Ot(Ee){return typeof Ee=="symbol"}function rt(Ee){return typeof Ee=="object"?Ee!==null:typeof Ee=="function"}function nt(Ee,ze){switch(St(Ee)){case 0:case 1:case 2:case 3:case 4:case 5:return Ee}var st="string",ct=or(Ee,R);if(ct!==void 0){var Rn=ct.call(Ee,st);if(rt(Rn))throw new TypeError;return Rn}return pe(Ee)}function pe(Ee,ze){var st,ct;{var Rn=Ee.toString;if(ot(Rn)&&!rt(ct=Rn.call(Ee))||ot(st=Ee.valueOf)&&!rt(ct=st.call(Ee)))return ct}throw new TypeError}function oe(Ee){return!!Ee}function ke(Ee){return""+Ee}function Je(Ee){var ze=nt(Ee);return Ot(ze)?ze:ke(ze)}function ut(Ee){return Array.isArray?Array.isArray(Ee):Ee instanceof Object?Ee instanceof Array:Object.prototype.toString.call(Ee)==="[object Array]"}function ot(Ee){return typeof Ee=="function"}function cn(Ee){return typeof Ee=="function"}function Dt(Ee){switch(St(Ee)){case 3:case 4:return!0;default:return!1}}function Wt(Ee,ze){return Ee===ze||Ee!=Ee&&ze!=ze}function or(Ee,ze){var st=Ee[ze];if(st!=null){if(!ot(st))throw new TypeError;return st}}function xt(Ee){var ze=or(Ee,I);if(!ot(ze))throw new TypeError;var st=ze.call(Ee);if(!rt(st))throw new TypeError;return st}function bt(Ee){return Ee.value}function Ft(Ee){var ze=Ee.next();return!ze.done&&ze}function Un(Ee){var ze=Ee.return;ze&&ze.call(Ee)}function Zt(Ee){var ze=Object.getPrototypeOf(Ee);if(typeof Ee!="function"||Ee===F||ze!==F)return ze;var st=Ee.prototype,ct=st&&Object.getPrototypeOf(st);if(ct==null||ct===Object.prototype)return ze;var Rn=ct.constructor;return typeof Rn!="function"||Rn===Ee?ze:Rn}function Ir(){var Ee,ze,st,ct;Qe($)||S.Reflect===void 0||$ in S.Reflect||typeof S.Reflect.defineMetadata!="function"||(Ee=Me(S.Reflect));var Rn=new X,Br={registerProvider:Qn,getProvider:en,setProvider:_n};return Br;function Qn(vn){if(!Object.isExtensible(Br))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Ee===vn:break;case Qe(ze):ze=vn;break;case ze===vn:break;case Qe(st):st=vn;break;case st===vn:break;default:ct===void 0&&(ct=new W),ct.add(vn)}}function Fn(vn,lr){if(!Qe(ze)){if(ze.isProviderFor(vn,lr))return ze;if(!Qe(st)){if(st.isProviderFor(vn,lr))return ze;if(!Qe(ct))for(var Qr=xt(ct);;){var $r=Ft(Qr);if(!$r)return;var co=bt($r);if(co.isProviderFor(vn,lr))return Un(Qr),co}}}if(!Qe(Ee)&&Ee.isProviderFor(vn,lr))return Ee}function en(vn,lr){var Qr,$r=Rn.get(vn);return Qe($r)||(Qr=$r.get(lr)),Qe(Qr)&&(Qe(Qr=Fn(vn,lr))||(Qe($r)&&($r=new V,Rn.set(vn,$r)),$r.set(lr,Qr))),Qr}function zt(vn){if(Qe(vn))throw new TypeError;return ze===vn||st===vn||!Qe(ct)&&ct.has(vn)}function _n(vn,lr,Qr){if(!zt(Qr))throw new Error("Metadata provider not registered.");var $r=en(vn,lr);if($r!==Qr){if(!Qe($r))return!1;var co=Rn.get(vn);Qe(co)&&(co=new V,Rn.set(vn,co)),co.set(lr,Qr)}return!0}}function Et(){var Ee;return!Qe($)&&rt(S.Reflect)&&Object.isExtensible(S.Reflect)&&(Ee=S.Reflect[$]),Qe(Ee)&&(Ee=Ir()),!Qe($)&&rt(S.Reflect)&&Object.isExtensible(S.Reflect)&&Object.defineProperty(S.Reflect,$,{enumerable:!1,configurable:!1,writable:!1,value:Ee}),Ee}function ii(Ee){var ze=new X,st={isProviderFor:function(zt,_n){var vn=ze.get(zt);return!Qe(vn)&&vn.has(_n)},OrdinaryDefineOwnMetadata:Qn,OrdinaryHasOwnMetadata:Rn,OrdinaryGetOwnMetadata:Br,OrdinaryOwnMetadataKeys:Fn,OrdinaryDeleteMetadata:en};return K.registerProvider(st),st;function ct(zt,_n,vn){var lr=ze.get(zt),Qr=!1;if(Qe(lr)){if(!vn)return;lr=new V,ze.set(zt,lr),Qr=!0}var $r=lr.get(_n);if(Qe($r)){if(!vn)return;if($r=new V,lr.set(_n,$r),!Ee.setProvider(zt,_n,st))throw lr.delete(_n),Qr&&ze.delete(zt),new Error("Wrong provider for target.")}return $r}function Rn(zt,_n,vn){var lr=ct(_n,vn,!1);return!Qe(lr)&&oe(lr.has(zt))}function Br(zt,_n,vn){var lr=ct(_n,vn,!1);if(!Qe(lr))return lr.get(zt)}function Qn(zt,_n,vn,lr){ct(vn,lr,!0).set(zt,_n)}function Fn(zt,_n){var vn=[],lr=ct(zt,_n,!1);if(Qe(lr))return vn;for(var Qr=xt(lr.keys()),$r=0;;){var co=Ft(Qr);if(!co)return vn.length=$r,vn;var $l=bt(co);try{vn[$r]=$l}catch(dh){try{Un(Qr)}finally{throw dh}}$r++}}function en(zt,_n,vn){var lr=ct(_n,vn,!1);if(Qe(lr)||!lr.delete(zt))return!1;if(lr.size===0){var Qr=ze.get(_n);Qe(Qr)||(Qr.delete(vn),Qr.size===0&&ze.delete(Qr))}return!0}}function Me(Ee){var ze=Ee.defineMetadata,st=Ee.hasOwnMetadata,ct=Ee.getOwnMetadata,Rn=Ee.getOwnMetadataKeys,Br=Ee.deleteMetadata,Qn=new X;return{isProviderFor:function(Fn,en){var zt=Qn.get(Fn);return!(Qe(zt)||!zt.has(en))||!!Rn(Fn,en).length&&(Qe(zt)&&(zt=new W,Qn.set(Fn,zt)),zt.add(en),!0)},OrdinaryDefineOwnMetadata:ze,OrdinaryHasOwnMetadata:st,OrdinaryGetOwnMetadata:ct,OrdinaryOwnMetadataKeys:Rn,OrdinaryDeleteMetadata:Br}}function Nt(Ee,ze,st){var ct=K.getProvider(Ee,ze);if(!Qe(ct))return ct;if(st){if(K.setProvider(Ee,ze,te))return te;throw new Error("Illegal state.")}}function et(){var Ee={},ze=[],st=function(){function Qn(Fn,en,zt){this._index=0,this._keys=Fn,this._values=en,this._selector=zt}return Qn.prototype["@@iterator"]=function(){return this},Qn.prototype[I]=function(){return this},Qn.prototype.next=function(){var Fn=this._index;if(Fn>=0&&Fn<this._keys.length){var en=this._selector(this._keys[Fn],this._values[Fn]);return Fn+1>=this._keys.length?(this._index=-1,this._keys=ze,this._values=ze):this._index++,{value:en,done:!1}}return{value:void 0,done:!0}},Qn.prototype.throw=function(Fn){throw this._index>=0&&(this._index=-1,this._keys=ze,this._values=ze),Fn},Qn.prototype.return=function(Fn){return this._index>=0&&(this._index=-1,this._keys=ze,this._values=ze),{value:Fn,done:!0}},Qn}();return function(){function Qn(){this._keys=[],this._values=[],this._cacheKey=Ee,this._cacheIndex=-2}return Object.defineProperty(Qn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Qn.prototype.has=function(Fn){return this._find(Fn,!1)>=0},Qn.prototype.get=function(Fn){var en=this._find(Fn,!1);return en>=0?this._values[en]:void 0},Qn.prototype.set=function(Fn,en){var zt=this._find(Fn,!0);return this._values[zt]=en,this},Qn.prototype.delete=function(Fn){var en=this._find(Fn,!1);if(en>=0){for(var zt=this._keys.length,_n=en+1;_n<zt;_n++)this._keys[_n-1]=this._keys[_n],this._values[_n-1]=this._values[_n];return this._keys.length--,this._values.length--,Wt(Fn,this._cacheKey)&&(this._cacheKey=Ee,this._cacheIndex=-2),!0}return!1},Qn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ee,this._cacheIndex=-2},Qn.prototype.keys=function(){return new st(this._keys,this._values,ct)},Qn.prototype.values=function(){return new st(this._keys,this._values,Rn)},Qn.prototype.entries=function(){return new st(this._keys,this._values,Br)},Qn.prototype["@@iterator"]=function(){return this.entries()},Qn.prototype[I]=function(){return this.entries()},Qn.prototype._find=function(Fn,en){if(!Wt(this._cacheKey,Fn)){this._cacheIndex=-1;for(var zt=0;zt<this._keys.length;zt++)if(Wt(this._keys[zt],Fn)){this._cacheIndex=zt;break}}return this._cacheIndex<0&&en&&(this._cacheIndex=this._keys.length,this._keys.push(Fn),this._values.push(void 0)),this._cacheIndex},Qn}();function ct(Qn,Fn){return Qn}function Rn(Qn,Fn){return Fn}function Br(Qn,Fn){return[Qn,Fn]}}function ht(){return function(){function Ee(){this._map=new V}return Object.defineProperty(Ee.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ee.prototype.has=function(ze){return this._map.has(ze)},Ee.prototype.add=function(ze){return this._map.set(ze,ze),this},Ee.prototype.delete=function(ze){return this._map.delete(ze)},Ee.prototype.clear=function(){this._map.clear()},Ee.prototype.keys=function(){return this._map.keys()},Ee.prototype.values=function(){return this._map.keys()},Ee.prototype.entries=function(){return this._map.entries()},Ee.prototype["@@iterator"]=function(){return this.keys()},Ee.prototype[I]=function(){return this.keys()},Ee}()}function Ht(){var Ee=16,ze=z.create(),st=ct();return function(){function en(){this._key=ct()}return en.prototype.has=function(zt){var _n=Rn(zt,!1);return _n!==void 0&&z.has(_n,this._key)},en.prototype.get=function(zt){var _n=Rn(zt,!1);return _n!==void 0?z.get(_n,this._key):void 0},en.prototype.set=function(zt,_n){return Rn(zt,!0)[this._key]=_n,this},en.prototype.delete=function(zt){var _n=Rn(zt,!1);return _n!==void 0&&delete _n[this._key]},en.prototype.clear=function(){this._key=ct()},en}();function ct(){var en;do en="@@WeakMap@@"+Fn();while(z.has(ze,en));return ze[en]=!0,en}function Rn(en,zt){if(!T.call(en,st)){if(!zt)return;Object.defineProperty(en,st,{value:z.create()})}return en[st]}function Br(en,zt){for(var _n=0;_n<zt;++_n)en[_n]=255*Math.random()|0;return en}function Qn(en){if(typeof Uint8Array=="function"){var zt=new Uint8Array(en);return typeof crypto<"u"?crypto.getRandomValues(zt):typeof msCrypto<"u"?msCrypto.getRandomValues(zt):Br(zt,en),zt}return Br(new Array(en),en)}function Fn(){var en=Qn(Ee);en[6]=79&en[6]|64,en[8]=191&en[8]|128;for(var zt="",_n=0;_n<Ee;++_n){var vn=en[_n];_n!==4&&_n!==6&&_n!==8||(zt+="-"),vn<16&&(zt+="0"),zt+=vn.toString(16).toLowerCase()}return zt}}function Lt(Ee){return Ee.__=void 0,delete Ee.__,Ee}y("decorate",Q),y("metadata",ne),y("defineMetadata",G),y("hasMetadata",J),y("hasOwnMetadata",re),y("getMetadata",ue),y("getOwnMetadata",ye),y("getMetadataKeys",Ne),y("getOwnMetadataKeys",_e),y("deleteMetadata",Ae)}(p,d),d.Reflect===void 0&&(d.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return t[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>Gn,BASIC_FULL_HD_PORTRAIT:()=>Zn,BASIC_LANDSCAPE:()=>dr,BASIC_PORTRAIT:()=>ws,BroadcastClientError:()=>Et,BroadcastClientEvents:()=>ms,ConnectionState:()=>Be,Errors:()=>u,InitialLayerPreference:()=>Zl,JitterBufferMinDelay:()=>es,LOG_LEVEL:()=>bt,LocalStageStream:()=>v0,LocalStageStreamEvents:()=>bl,LogLevels:()=>bt,RemoteStageStream:()=>N,RemoteStageStreamEvents:()=>Lh,STANDARD_LANDSCAPE:()=>cl,STANDARD_PORTRAIT:()=>hi,Stage:()=>un,StageConnectionState:()=>di,StageErrorCategory:()=>su,StageErrorCode:()=>Sr,StageEvents:()=>_r,StageLeftReason:()=>tr,StageParticipantPublishState:()=>Ni,StageParticipantSubscribeState:()=>po,StageStream:()=>ng,StageStreamLayerSelectedReason:()=>Po,StreamType:()=>Ct,SubscribeType:()=>No,__version:()=>yh,create:()=>Ha,default:()=>nr,isSupported:()=>xt});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>J,shimAddTrackRemoveTrack:()=>ne,shimAddTrackRemoveTrackWithNative:()=>Q,shimGetDisplayMedia:()=>V,shimGetSendersWithDtmf:()=>$,shimGetStats:()=>K,shimGetUserMedia:()=>F,shimMediaStream:()=>W,shimOnTrack:()=>X,shimPeerConnection:()=>G,shimSenderReceiverGetStats:()=>te});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>Ke,shimCreateAnswer:()=>Qt,shimCreateOffer:()=>Xt,shimGetDisplayMedia:()=>ue,shimGetParameters:()=>It,shimGetUserMedia:()=>re,shimOnTrack:()=>ye,shimPeerConnection:()=>Ne,shimRTCDataChannel:()=>Ze,shimReceiverGetStats:()=>Ae,shimRemoveStream:()=>Ye,shimSenderGetStats:()=>_e});var c={};i.r(c),i.d(c,{shimAudioContext:()=>nt,shimCallbacksAPI:()=>Re,shimConstraints:()=>Qe,shimCreateOfferLegacy:()=>rt,shimGetUserMedia:()=>St,shimLocalStreamsAPI:()=>Kt,shimRTCIceServerUrls:()=>nn,shimRemoteStreamsAPI:()=>xn,shimTrackEventTransceiver:()=>Ot});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>Dt,shimAddIceCandidateNullOrEmpty:()=>Wt,shimConnectionState:()=>cn,shimMaxMessageSize:()=>ut,shimParameterlessSetLocalDescription:()=>or,shimRTCIceCandidate:()=>ke,shimRTCIceCandidateRelayProtocol:()=>Je,shimSendThrowTypeError:()=>ot});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Lt,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>Ht,ADD_DEVICE_CONSTRAINTS_ERROR:()=>st,ADD_DEVICE_DEVICE_ERROR:()=>et,ADD_DEVICE_NAME_EXISTS_ERROR:()=>ht,ADD_DEVICE_NAME_MISSING_ERROR:()=>Ee,ADD_DEVICE_UNSUPPORTED:()=>ze,BROADCAST_CONFIGURATION_ERROR:()=>Qr,BROADCAST_ERROR:()=>ii,CAMERA_ERROR:()=>Me,CLIENT_INVALID_ERROR:()=>pd,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>en,FAILED_TO_ADD_IMAGE_ERROR:()=>zt,INGEST_ENDPOINT_TYPE_ERROR:()=>co,INGEST_ENDPOINT_URL_ERROR:()=>$l,INPUT_ERROR:()=>Nt,INVALID_STREAM_KEY:()=>lr,LOGGER_TYPE_ERROR:()=>fd,LOG_LEVEL_TYPE_ERROR:()=>dh,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>le,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>Ie,PEER_CONNECTION_ERROR:()=>vn,PEER_SETUP_ERROR:()=>_n,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>ct,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Rn,STAGE_TOKEN_TYPE_ERROR:()=>Xe,STAGE_WHIP_OVERRIDE_ERROR:()=>Pe,STREAM_CONFIGURATION_ERROR:()=>$r,STREAM_KEY_INVALID_CHAR_ERROR:()=>Ge,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Qn,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>Br,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>Fn});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>Gn,BASIC_FULL_HD_PORTRAIT:()=>Zn,BASIC_LANDSCAPE:()=>dr,BASIC_PORTRAIT:()=>ws,BroadcastClientError:()=>Et,BroadcastClientEvents:()=>ms,ConnectionState:()=>Be,Errors:()=>u,LOG_LEVEL:()=>bt,LogLevels:()=>bt,STANDARD_LANDSCAPE:()=>cl,STANDARD_PORTRAIT:()=>hi,__version:()=>yh,create:()=>Ha,isSupported:()=>xt});let d=!0,p=!0;function _(x,v,E){const w=x.match(v);return w&&w.length>=E&&parseInt(w[E],10)}function y(x,v,E){if(!x.RTCPeerConnection)return;const w=x.RTCPeerConnection.prototype,M=w.addEventListener;w.addEventListener=function(P,q){if(P!==v)return M.apply(this,arguments);const Z=j=>{const ee=E(j);ee&&(q.handleEvent?q.handleEvent(ee):q(ee))};return this._eventMap=this._eventMap||{},this._eventMap[v]||(this._eventMap[v]=new Map),this._eventMap[v].set(q,Z),M.apply(this,[P,Z])};const k=w.removeEventListener;w.removeEventListener=function(P,q){if(P!==v||!this._eventMap||!this._eventMap[v])return k.apply(this,arguments);if(!this._eventMap[v].has(q))return k.apply(this,arguments);const Z=this._eventMap[v].get(q);return this._eventMap[v].delete(q),this._eventMap[v].size===0&&delete this._eventMap[v],Object.keys(this._eventMap).length===0&&delete this._eventMap,k.apply(this,[P,Z])},Object.defineProperty(w,"on"+v,{get(){return this["_on"+v]},set(P){this["_on"+v]&&(this.removeEventListener(v,this["_on"+v]),delete this["_on"+v]),P&&this.addEventListener(v,this["_on"+v]=P)},enumerable:!0,configurable:!0})}function S(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(d=x,x?"adapter.js logging disabled":"adapter.js logging enabled")}function T(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(p=!x,"adapter.js deprecation warnings "+(x?"disabled":"enabled"))}function A(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function R(x,v){p&&console.warn(x+" is deprecated, please use "+v+" instead.")}function I(x){return Object.prototype.toString.call(x)==="[object Object]"}function U(x){return I(x)?Object.keys(x).reduce(function(v,E){const w=I(x[E]),M=w?U(x[E]):x[E],k=w&&!Object.keys(M).length;return M===void 0||k?v:Object.assign(v,{[E]:M})},{}):x}function D(x,v,E){v&&!E.has(v.id)&&(E.set(v.id,v),Object.keys(v).forEach(w=>{w.endsWith("Id")?D(x,x.get(v[w]),E):w.endsWith("Ids")&&v[w].forEach(M=>{D(x,x.get(M),E)})}))}function L(x,v,E){const w=E?"outbound-rtp":"inbound-rtp",M=new Map;if(v===null)return M;const k=[];return x.forEach(P=>{P.type==="track"&&P.trackIdentifier===v.id&&k.push(P)}),k.forEach(P=>{x.forEach(q=>{q.type===w&&q.trackId===P.id&&D(x,q,M)})}),M}const z=A;function F(x,v){const E=x&&x.navigator;if(!E.mediaDevices)return;const w=function(P){if(typeof P!="object"||P.mandatory||P.optional)return P;const q={};return Object.keys(P).forEach(Z=>{if(Z==="require"||Z==="advanced"||Z==="mediaSource")return;const j=typeof P[Z]=="object"?P[Z]:{ideal:P[Z]};j.exact!==void 0&&typeof j.exact=="number"&&(j.min=j.max=j.exact);const ee=function(se,ae){return se?se+ae.charAt(0).toUpperCase()+ae.slice(1):ae==="deviceId"?"sourceId":ae};if(j.ideal!==void 0){q.optional=q.optional||[];let se={};typeof j.ideal=="number"?(se[ee("min",Z)]=j.ideal,q.optional.push(se),se={},se[ee("max",Z)]=j.ideal,q.optional.push(se)):(se[ee("",Z)]=j.ideal,q.optional.push(se))}j.exact!==void 0&&typeof j.exact!="number"?(q.mandatory=q.mandatory||{},q.mandatory[ee("",Z)]=j.exact):["min","max"].forEach(se=>{j[se]!==void 0&&(q.mandatory=q.mandatory||{},q.mandatory[ee(se,Z)]=j[se])})}),P.advanced&&(q.optional=(q.optional||[]).concat(P.advanced)),q},M=function(P,q){if(v.version>=61)return q(P);if((P=JSON.parse(JSON.stringify(P)))&&typeof P.audio=="object"){const Z=function(j,ee,se){ee in j&&!(se in j)&&(j[se]=j[ee],delete j[ee])};Z((P=JSON.parse(JSON.stringify(P))).audio,"autoGainControl","googAutoGainControl"),Z(P.audio,"noiseSuppression","googNoiseSuppression"),P.audio=w(P.audio)}if(P&&typeof P.video=="object"){let Z=P.video.facingMode;Z=Z&&(typeof Z=="object"?Z:{ideal:Z});const j=v.version<66;if(Z&&(Z.exact==="user"||Z.exact==="environment"||Z.ideal==="user"||Z.ideal==="environment")&&(!E.mediaDevices.getSupportedConstraints||!E.mediaDevices.getSupportedConstraints().facingMode||j)){let ee;if(delete P.video.facingMode,Z.exact==="environment"||Z.ideal==="environment"?ee=["back","rear"]:Z.exact!=="user"&&Z.ideal!=="user"||(ee=["front"]),ee)return E.mediaDevices.enumerateDevices().then(se=>{let ae=(se=se.filter(ve=>ve.kind==="videoinput")).find(ve=>ee.some(Le=>ve.label.toLowerCase().includes(Le)));return!ae&&se.length&&ee.includes("back")&&(ae=se[se.length-1]),ae&&(P.video.deviceId=Z.exact?{exact:ae.deviceId}:{ideal:ae.deviceId}),P.video=w(P.video),z("chrome: "+JSON.stringify(P)),q(P)})}P.video=w(P.video)}return z("chrome: "+JSON.stringify(P)),q(P)},k=function(P){return v.version>=64?P:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[P.name]||P.name,message:P.message,constraint:P.constraint||P.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(E.getUserMedia=(function(P,q,Z){M(P,j=>{E.webkitGetUserMedia(j,q,ee=>{Z&&Z(k(ee))})})}).bind(E),E.mediaDevices.getUserMedia){const P=E.mediaDevices.getUserMedia.bind(E.mediaDevices);E.mediaDevices.getUserMedia=function(q){return M(q,Z=>P(Z).then(j=>{if(Z.audio&&!j.getAudioTracks().length||Z.video&&!j.getVideoTracks().length)throw j.getTracks().forEach(ee=>{ee.stop()}),new DOMException("","NotFoundError");return j},j=>Promise.reject(k(j))))}}}function V(x,v){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(typeof v=="function"?x.navigator.mediaDevices.getDisplayMedia=function(E){return v(E).then(w=>{const M=E.video&&E.video.width,k=E.video&&E.video.height,P=E.video&&E.video.frameRate;return E.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:w,maxFrameRate:P||3}},M&&(E.video.mandatory.maxWidth=M),k&&(E.video.mandatory.maxHeight=k),x.navigator.mediaDevices.getUserMedia(E)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function W(x){x.MediaStream=x.MediaStream||x.webkitMediaStream}function X(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("ontrack"in x.RTCPeerConnection.prototype)){Object.defineProperty(x.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(E){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=E)},enumerable:!0,configurable:!0});const v=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=E=>{E.stream.addEventListener("addtrack",w=>{let M;M=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(P=>P.track&&P.track.id===w.track.id):{track:w.track};const k=new Event("track");k.track=w.track,k.receiver=M,k.transceiver={receiver:M},k.streams=[E.stream],this.dispatchEvent(k)}),E.stream.getTracks().forEach(w=>{let M;M=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(P=>P.track&&P.track.id===w.id):{track:w};const k=new Event("track");k.track=w,k.receiver=M,k.transceiver={receiver:M},k.streams=[E.stream],this.dispatchEvent(k)})},this.addEventListener("addstream",this._ontrackpoly)),v.apply(this,arguments)}}else y(x,"track",v=>(v.transceiver||Object.defineProperty(v,"transceiver",{value:{receiver:v.receiver}}),v))}function $(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("getSenders"in x.RTCPeerConnection.prototype)&&"createDTMFSender"in x.RTCPeerConnection.prototype){const v=function(M,k){return{track:k,get dtmf(){return this._dtmf===void 0&&(k.kind==="audio"?this._dtmf=M.createDTMFSender(k):this._dtmf=null),this._dtmf},_pc:M}};if(!x.RTCPeerConnection.prototype.getSenders){x.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const M=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(P,q){let Z=M.apply(this,arguments);return Z||(Z=v(this,P),this._senders.push(Z)),Z};const k=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(P){k.apply(this,arguments);const q=this._senders.indexOf(P);q!==-1&&this._senders.splice(q,1)}}const E=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(M){this._senders=this._senders||[],E.apply(this,[M]),M.getTracks().forEach(k=>{this._senders.push(v(this,k))})};const w=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(M){this._senders=this._senders||[],w.apply(this,[M]),M.getTracks().forEach(k=>{const P=this._senders.find(q=>q.track===k);P&&this._senders.splice(this._senders.indexOf(P),1)})}}else if(typeof x=="object"&&x.RTCPeerConnection&&"getSenders"in x.RTCPeerConnection.prototype&&"createDTMFSender"in x.RTCPeerConnection.prototype&&x.RTCRtpSender&&!("dtmf"in x.RTCRtpSender.prototype)){const v=x.RTCPeerConnection.prototype.getSenders;x.RTCPeerConnection.prototype.getSenders=function(){const E=v.apply(this,[]);return E.forEach(w=>w._pc=this),E},Object.defineProperty(x.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(x){if(!x.RTCPeerConnection)return;const v=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[E,w,M]=arguments;if(arguments.length>0&&typeof E=="function")return v.apply(this,arguments);if(v.length===0&&(arguments.length===0||typeof E!="function"))return v.apply(this,[]);const k=function(q){const Z={};return q.result().forEach(j=>{const ee={id:j.id,timestamp:j.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[j.type]||j.type};j.names().forEach(se=>{ee[se]=j.stat(se)}),Z[ee.id]=ee}),Z},P=function(q){return new Map(Object.keys(q).map(Z=>[Z,q[Z]]))};if(arguments.length>=2){const q=function(Z){w(P(k(Z)))};return v.apply(this,[q,E])}return new Promise((q,Z)=>{v.apply(this,[function(j){q(P(k(j)))},Z])}).then(w,M)}}function te(x){if(!(typeof x=="object"&&x.RTCPeerConnection&&x.RTCRtpSender&&x.RTCRtpReceiver))return;if(!("getStats"in x.RTCRtpSender.prototype)){const E=x.RTCPeerConnection.prototype.getSenders;E&&(x.RTCPeerConnection.prototype.getSenders=function(){const M=E.apply(this,[]);return M.forEach(k=>k._pc=this),M});const w=x.RTCPeerConnection.prototype.addTrack;w&&(x.RTCPeerConnection.prototype.addTrack=function(){const M=w.apply(this,arguments);return M._pc=this,M}),x.RTCRtpSender.prototype.getStats=function(){const M=this;return this._pc.getStats().then(k=>L(k,M.track,!0))}}if(!("getStats"in x.RTCRtpReceiver.prototype)){const E=x.RTCPeerConnection.prototype.getReceivers;E&&(x.RTCPeerConnection.prototype.getReceivers=function(){const w=E.apply(this,[]);return w.forEach(M=>M._pc=this),w}),y(x,"track",w=>(w.receiver._pc=w.srcElement,w)),x.RTCRtpReceiver.prototype.getStats=function(){const w=this;return this._pc.getStats().then(M=>L(M,w.track,!1))}}if(!("getStats"in x.RTCRtpSender.prototype)||!("getStats"in x.RTCRtpReceiver.prototype))return;const v=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof x.MediaStreamTrack){const E=arguments[0];let w,M,k;return this.getSenders().forEach(P=>{P.track===E&&(w?k=!0:w=P)}),this.getReceivers().forEach(P=>(P.track===E&&(M?k=!0:M=P),P.track===E)),k||w&&M?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):w?w.getStats():M?M.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return v.apply(this,arguments)}}function Q(x){x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(k=>this._shimmedLocalStreams[k][0])};const v=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(k,P){if(!P)return v.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const q=v.apply(this,arguments);return this._shimmedLocalStreams[P.id]?this._shimmedLocalStreams[P.id].indexOf(q)===-1&&this._shimmedLocalStreams[P.id].push(q):this._shimmedLocalStreams[P.id]=[P,q],q};const E=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(k){this._shimmedLocalStreams=this._shimmedLocalStreams||{},k.getTracks().forEach(Z=>{if(this.getSenders().find(j=>j.track===Z))throw new DOMException("Track already exists.","InvalidAccessError")});const P=this.getSenders();E.apply(this,arguments);const q=this.getSenders().filter(Z=>P.indexOf(Z)===-1);this._shimmedLocalStreams[k.id]=[k].concat(q)};const w=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(k){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[k.id],w.apply(this,arguments)};const M=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(k){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},k&&Object.keys(this._shimmedLocalStreams).forEach(P=>{const q=this._shimmedLocalStreams[P].indexOf(k);q!==-1&&this._shimmedLocalStreams[P].splice(q,1),this._shimmedLocalStreams[P].length===1&&delete this._shimmedLocalStreams[P]}),M.apply(this,arguments)}}function ne(x,v){if(!x.RTCPeerConnection)return;if(x.RTCPeerConnection.prototype.addTrack&&v.version>=65)return Q(x);const E=x.RTCPeerConnection.prototype.getLocalStreams;x.RTCPeerConnection.prototype.getLocalStreams=function(){const Z=E.apply(this);return this._reverseStreams=this._reverseStreams||{},Z.map(j=>this._reverseStreams[j.id])};const w=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(Z){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Z.getTracks().forEach(j=>{if(this.getSenders().find(ee=>ee.track===j))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[Z.id]){const j=new x.MediaStream(Z.getTracks());this._streams[Z.id]=j,this._reverseStreams[j.id]=Z,Z=j}w.apply(this,[Z])};const M=x.RTCPeerConnection.prototype.removeStream;function k(Z,j){let ee=j.sdp;return Object.keys(Z._reverseStreams||[]).forEach(se=>{const ae=Z._reverseStreams[se],ve=Z._streams[ae.id];ee=ee.replace(new RegExp(ve.id,"g"),ae.id)}),new RTCSessionDescription({type:j.type,sdp:ee})}x.RTCPeerConnection.prototype.removeStream=function(Z){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},M.apply(this,[this._streams[Z.id]||Z]),delete this._reverseStreams[this._streams[Z.id]?this._streams[Z.id].id:Z.id],delete this._streams[Z.id]},x.RTCPeerConnection.prototype.addTrack=function(Z,j){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const ee=[].slice.call(arguments,1);if(ee.length!==1||!ee[0].getTracks().find(ae=>ae===Z))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(ae=>ae.track===Z))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const se=this._streams[j.id];if(se)se.addTrack(Z),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const ae=new x.MediaStream([Z]);this._streams[j.id]=ae,this._reverseStreams[ae.id]=j,this.addStream(ae)}return this.getSenders().find(ae=>ae.track===Z)},["createOffer","createAnswer"].forEach(function(Z){const j=x.RTCPeerConnection.prototype[Z],ee={[Z](){const se=arguments;return arguments.length&&typeof arguments[0]=="function"?j.apply(this,[ae=>{const ve=k(this,ae);se[0].apply(null,[ve])},ae=>{se[1]&&se[1].apply(null,ae)},arguments[2]]):j.apply(this,arguments).then(ae=>k(this,ae))}};x.RTCPeerConnection.prototype[Z]=ee[Z]});const P=x.RTCPeerConnection.prototype.setLocalDescription;x.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(Z,j){let ee=j.sdp;return Object.keys(Z._reverseStreams||[]).forEach(se=>{const ae=Z._reverseStreams[se],ve=Z._streams[ae.id];ee=ee.replace(new RegExp(ae.id,"g"),ve.id)}),new RTCSessionDescription({type:j.type,sdp:ee})}(this,arguments[0]),P.apply(this,arguments)):P.apply(this,arguments)};const q=Object.getOwnPropertyDescriptor(x.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(x.RTCPeerConnection.prototype,"localDescription",{get(){const Z=q.get.apply(this);return Z.type===""?Z:k(this,Z)}}),x.RTCPeerConnection.prototype.removeTrack=function(Z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!Z._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(Z._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let j;this._streams=this._streams||{},Object.keys(this._streams).forEach(ee=>{this._streams[ee].getTracks().find(se=>Z.track===se)&&(j=this._streams[ee])}),j&&(j.getTracks().length===1?this.removeStream(this._reverseStreams[j.id]):j.removeTrack(Z.track),this.dispatchEvent(new Event("negotiationneeded")))}}function G(x,v){!x.RTCPeerConnection&&x.webkitRTCPeerConnection&&(x.RTCPeerConnection=x.webkitRTCPeerConnection),x.RTCPeerConnection&&v.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(E){const w=x.RTCPeerConnection.prototype[E],M={[E](){return arguments[0]=new(E==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),w.apply(this,arguments)}};x.RTCPeerConnection.prototype[E]=M[E]})}function J(x,v){y(x,"negotiationneeded",E=>{const w=E.target;if(!(v.version<72||w.getConfiguration&&w.getConfiguration().sdpSemantics==="plan-b")||w.signalingState==="stable")return E})}function re(x,v){const E=x&&x.navigator,w=x&&x.MediaStreamTrack;if(E.getUserMedia=function(M,k,P){R("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),E.mediaDevices.getUserMedia(M).then(k,P)},!(v.version>55&&"autoGainControl"in E.mediaDevices.getSupportedConstraints())){const M=function(P,q,Z){q in P&&!(Z in P)&&(P[Z]=P[q],delete P[q])},k=E.mediaDevices.getUserMedia.bind(E.mediaDevices);if(E.mediaDevices.getUserMedia=function(P){return typeof P=="object"&&typeof P.audio=="object"&&(P=JSON.parse(JSON.stringify(P)),M(P.audio,"autoGainControl","mozAutoGainControl"),M(P.audio,"noiseSuppression","mozNoiseSuppression")),k(P)},w&&w.prototype.getSettings){const P=w.prototype.getSettings;w.prototype.getSettings=function(){const q=P.apply(this,arguments);return M(q,"mozAutoGainControl","autoGainControl"),M(q,"mozNoiseSuppression","noiseSuppression"),q}}if(w&&w.prototype.applyConstraints){const P=w.prototype.applyConstraints;w.prototype.applyConstraints=function(q){return this.kind==="audio"&&typeof q=="object"&&(q=JSON.parse(JSON.stringify(q)),M(q,"autoGainControl","mozAutoGainControl"),M(q,"noiseSuppression","mozNoiseSuppression")),P.apply(this,[q])}}}}function ue(x,v){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(x.navigator.mediaDevices.getDisplayMedia=function(E){if(!E||!E.video){const w=new DOMException("getDisplayMedia without video constraints is undefined");return w.name="NotFoundError",w.code=8,Promise.reject(w)}return E.video===!0?E.video={mediaSource:v}:E.video.mediaSource=v,x.navigator.mediaDevices.getUserMedia(E)})}function ye(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ne(x,v){if(typeof x!="object"||!x.RTCPeerConnection&&!x.mozRTCPeerConnection)return;!x.RTCPeerConnection&&x.mozRTCPeerConnection&&(x.RTCPeerConnection=x.mozRTCPeerConnection),v.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(M){const k=x.RTCPeerConnection.prototype[M],P={[M](){return arguments[0]=new(M==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),k.apply(this,arguments)}};x.RTCPeerConnection.prototype[M]=P[M]});const E={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},w=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[M,k,P]=arguments;return w.apply(this,[M||null]).then(q=>{if(v.version<53&&!k)try{q.forEach(Z=>{Z.type=E[Z.type]||Z.type})}catch(Z){if(Z.name!=="TypeError")throw Z;q.forEach((j,ee)=>{q.set(ee,Object.assign({},j,{type:E[j.type]||j.type}))})}return q}).then(k,P)}}function _e(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpSender.prototype)return;const v=x.RTCPeerConnection.prototype.getSenders;v&&(x.RTCPeerConnection.prototype.getSenders=function(){const w=v.apply(this,[]);return w.forEach(M=>M._pc=this),w});const E=x.RTCPeerConnection.prototype.addTrack;E&&(x.RTCPeerConnection.prototype.addTrack=function(){const w=E.apply(this,arguments);return w._pc=this,w}),x.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ae(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpReceiver.prototype)return;const v=x.RTCPeerConnection.prototype.getReceivers;v&&(x.RTCPeerConnection.prototype.getReceivers=function(){const E=v.apply(this,[]);return E.forEach(w=>w._pc=this),E}),y(x,"track",E=>(E.receiver._pc=E.srcElement,E)),x.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ye(x){x.RTCPeerConnection&&!("removeStream"in x.RTCPeerConnection.prototype)&&(x.RTCPeerConnection.prototype.removeStream=function(v){R("removeStream","removeTrack"),this.getSenders().forEach(E=>{E.track&&v.getTracks().includes(E.track)&&this.removeTrack(E)})})}function Ze(x){x.DataChannel&&!x.RTCDataChannel&&(x.RTCDataChannel=x.DataChannel)}function Ke(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const v=x.RTCPeerConnection.prototype.addTransceiver;v&&(x.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let E=arguments[1]&&arguments[1].sendEncodings;E===void 0&&(E=[]),E=[...E];const w=E.length>0;w&&E.forEach(k=>{if("rid"in k&&!/^[a-z0-9]{0,16}$/i.test(k.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in k&&!(parseFloat(k.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in k&&!(parseFloat(k.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const M=v.apply(this,arguments);if(w){const{sender:k}=M,P=k.getParameters();(!("encodings"in P)||P.encodings.length===1&&Object.keys(P.encodings[0]).length===0)&&(P.encodings=E,k.sendEncodings=E,this.setParametersPromises.push(k.setParameters(P).then(()=>{delete k.sendEncodings}).catch(()=>{delete k.sendEncodings})))}return M})}function It(x){if(typeof x!="object"||!x.RTCRtpSender)return;const v=x.RTCRtpSender.prototype.getParameters;v&&(x.RTCRtpSender.prototype.getParameters=function(){const E=v.apply(this,arguments);return"encodings"in E||(E.encodings=[].concat(this.sendEncodings||[{}])),E})}function Xt(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const v=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>v.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):v.apply(this,arguments)}}function Qt(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const v=x.RTCPeerConnection.prototype.createAnswer;x.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>v.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):v.apply(this,arguments)}}function Kt(x){if(typeof x=="object"&&x.RTCPeerConnection){if("getLocalStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in x.RTCPeerConnection.prototype)){const v=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addStream=function(E){this._localStreams||(this._localStreams=[]),this._localStreams.includes(E)||this._localStreams.push(E),E.getAudioTracks().forEach(w=>v.call(this,w,E)),E.getVideoTracks().forEach(w=>v.call(this,w,E))},x.RTCPeerConnection.prototype.addTrack=function(E,...w){return w&&w.forEach(M=>{this._localStreams?this._localStreams.includes(M)||this._localStreams.push(M):this._localStreams=[M]}),v.apply(this,arguments)}}"removeStream"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.removeStream=function(v){this._localStreams||(this._localStreams=[]);const E=this._localStreams.indexOf(v);if(E===-1)return;this._localStreams.splice(E,1);const w=v.getTracks();this.getSenders().forEach(M=>{w.includes(M.track)&&this.removeTrack(M)})})}}function xn(x){if(typeof x=="object"&&x.RTCPeerConnection&&("getRemoteStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in x.RTCPeerConnection.prototype))){Object.defineProperty(x.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(E){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=E),this.addEventListener("track",this._onaddstreampoly=w=>{w.streams.forEach(M=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(M))return;this._remoteStreams.push(M);const k=new Event("addstream");k.stream=M,this.dispatchEvent(k)})})}});const v=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){const E=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(w){w.streams.forEach(M=>{if(E._remoteStreams||(E._remoteStreams=[]),E._remoteStreams.indexOf(M)>=0)return;E._remoteStreams.push(M);const k=new Event("addstream");k.stream=M,E.dispatchEvent(k)})}),v.apply(E,arguments)}}}function Re(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const v=x.RTCPeerConnection.prototype,E=v.createOffer,w=v.createAnswer,M=v.setLocalDescription,k=v.setRemoteDescription,P=v.addIceCandidate;v.createOffer=function(Z,j){const ee=arguments.length>=2?arguments[2]:arguments[0],se=E.apply(this,[ee]);return j?(se.then(Z,j),Promise.resolve()):se},v.createAnswer=function(Z,j){const ee=arguments.length>=2?arguments[2]:arguments[0],se=w.apply(this,[ee]);return j?(se.then(Z,j),Promise.resolve()):se};let q=function(Z,j,ee){const se=M.apply(this,[Z]);return ee?(se.then(j,ee),Promise.resolve()):se};v.setLocalDescription=q,q=function(Z,j,ee){const se=k.apply(this,[Z]);return ee?(se.then(j,ee),Promise.resolve()):se},v.setRemoteDescription=q,q=function(Z,j,ee){const se=P.apply(this,[Z]);return ee?(se.then(j,ee),Promise.resolve()):se},v.addIceCandidate=q}function St(x){const v=x&&x.navigator;if(v.mediaDevices&&v.mediaDevices.getUserMedia){const E=v.mediaDevices,w=E.getUserMedia.bind(E);v.mediaDevices.getUserMedia=M=>w(Qe(M))}!v.getUserMedia&&v.mediaDevices&&v.mediaDevices.getUserMedia&&(v.getUserMedia=(function(E,w,M){v.mediaDevices.getUserMedia(E).then(w,M)}).bind(v))}function Qe(x){return x&&x.video!==void 0?Object.assign({},x,{video:U(x.video)}):x}function nn(x){if(!x.RTCPeerConnection)return;const v=x.RTCPeerConnection;x.RTCPeerConnection=function(E,w){if(E&&E.iceServers){const M=[];for(let k=0;k<E.iceServers.length;k++){let P=E.iceServers[k];P.urls===void 0&&P.url?(R("RTCIceServer.url","RTCIceServer.urls"),P=JSON.parse(JSON.stringify(P)),P.urls=P.url,delete P.url,M.push(P)):M.push(E.iceServers[k])}E.iceServers=M}return new v(E,w)},x.RTCPeerConnection.prototype=v.prototype,"generateCertificate"in v&&Object.defineProperty(x.RTCPeerConnection,"generateCertificate",{get:()=>v.generateCertificate})}function Ot(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rt(x){const v=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(E){if(E){E.offerToReceiveAudio!==void 0&&(E.offerToReceiveAudio=!!E.offerToReceiveAudio);const w=this.getTransceivers().find(k=>k.receiver.track.kind==="audio");E.offerToReceiveAudio===!1&&w?w.direction==="sendrecv"?w.setDirection?w.setDirection("sendonly"):w.direction="sendonly":w.direction==="recvonly"&&(w.setDirection?w.setDirection("inactive"):w.direction="inactive"):E.offerToReceiveAudio!==!0||w||this.addTransceiver("audio",{direction:"recvonly"}),E.offerToReceiveVideo!==void 0&&(E.offerToReceiveVideo=!!E.offerToReceiveVideo);const M=this.getTransceivers().find(k=>k.receiver.track.kind==="video");E.offerToReceiveVideo===!1&&M?M.direction==="sendrecv"?M.setDirection?M.setDirection("sendonly"):M.direction="sendonly":M.direction==="recvonly"&&(M.setDirection?M.setDirection("inactive"):M.direction="inactive"):E.offerToReceiveVideo!==!0||M||this.addTransceiver("video",{direction:"recvonly"})}return v.apply(this,arguments)}}function nt(x){typeof x!="object"||x.AudioContext||(x.AudioContext=x.webkitAudioContext)}var pe=i(7539),oe=i.n(pe);function ke(x){if(!x.RTCIceCandidate||x.RTCIceCandidate&&"foundation"in x.RTCIceCandidate.prototype)return;const v=x.RTCIceCandidate;x.RTCIceCandidate=function(E){if(typeof E=="object"&&E.candidate&&E.candidate.indexOf("a=")===0&&((E=JSON.parse(JSON.stringify(E))).candidate=E.candidate.substring(2)),E.candidate&&E.candidate.length){const w=new v(E),M=oe().parseCandidate(E.candidate);for(const k in M)k in w||Object.defineProperty(w,k,{value:M[k]});return w.toJSON=function(){return{candidate:w.candidate,sdpMid:w.sdpMid,sdpMLineIndex:w.sdpMLineIndex,usernameFragment:w.usernameFragment}},w}return new v(E)},x.RTCIceCandidate.prototype=v.prototype,y(x,"icecandidate",E=>(E.candidate&&Object.defineProperty(E,"candidate",{value:new x.RTCIceCandidate(E.candidate),writable:"false"}),E))}function Je(x){!x.RTCIceCandidate||x.RTCIceCandidate&&"relayProtocol"in x.RTCIceCandidate.prototype||y(x,"icecandidate",v=>{if(v.candidate){const E=oe().parseCandidate(v.candidate.candidate);E.type==="relay"&&(v.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[E.priority>>24])}return v})}function ut(x,v){if(!x.RTCPeerConnection)return;"sctp"in x.RTCPeerConnection.prototype||Object.defineProperty(x.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const E=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,v.browser==="chrome"&&v.version>=76){const{sdpSemantics:w}=this.getConfiguration();w==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(w){if(!w||!w.sdp)return!1;const M=oe().splitSections(w.sdp);return M.shift(),M.some(k=>{const P=oe().parseMLine(k);return P&&P.kind==="application"&&P.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const w=function(Z){const j=Z.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(j===null||j.length<2)return-1;const ee=parseInt(j[1],10);return ee!=ee?-1:ee}(arguments[0]),M=function(Z){let j=65536;return v.browser==="firefox"&&(j=v.version<57?Z===-1?16384:2147483637:v.version<60?v.version===57?65535:65536:2147483637),j}(w),k=function(Z,j){let ee=65536;v.browser==="firefox"&&v.version===57&&(ee=65535);const se=oe().matchPrefix(Z.sdp,"a=max-message-size:");return se.length>0?ee=parseInt(se[0].substring(19),10):v.browser==="firefox"&&j!==-1&&(ee=2147483637),ee}(arguments[0],w);let P;P=M===0&&k===0?Number.POSITIVE_INFINITY:M===0||k===0?Math.max(M,k):Math.min(M,k);const q={};Object.defineProperty(q,"maxMessageSize",{get:()=>P}),this._sctp=q}return E.apply(this,arguments)}}function ot(x){if(!x.RTCPeerConnection||!("createDataChannel"in x.RTCPeerConnection.prototype))return;function v(w,M){const k=w.send;w.send=function(){const P=arguments[0],q=P.length||P.size||P.byteLength;if(w.readyState==="open"&&M.sctp&&q>M.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+M.sctp.maxMessageSize+" bytes)");return k.apply(w,arguments)}}const E=x.RTCPeerConnection.prototype.createDataChannel;x.RTCPeerConnection.prototype.createDataChannel=function(){const w=E.apply(this,arguments);return v(w,this),w},y(x,"datachannel",w=>(v(w.channel,w.target),w))}function cn(x){if(!x.RTCPeerConnection||"connectionState"in x.RTCPeerConnection.prototype)return;const v=x.RTCPeerConnection.prototype;Object.defineProperty(v,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(v,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(E){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),E&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=E)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(E=>{const w=v[E];v[E]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=M=>{const k=M.target;if(k._lastConnectionState!==k.connectionState){k._lastConnectionState=k.connectionState;const P=new Event("connectionstatechange",M);k.dispatchEvent(P)}return M},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),w.apply(this,arguments)}})}function Dt(x,v){if(!x.RTCPeerConnection||v.browser==="chrome"&&v.version>=71||v.browser==="safari"&&v.version>=605)return;const E=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(w){if(w&&w.sdp&&w.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const M=w.sdp.split(`
`).filter(k=>k.trim()!=="a=extmap-allow-mixed").join(`
`);x.RTCSessionDescription&&w instanceof x.RTCSessionDescription?arguments[0]=new x.RTCSessionDescription({type:w.type,sdp:M}):w.sdp=M}return E.apply(this,arguments)}}function Wt(x,v){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const E=x.RTCPeerConnection.prototype.addIceCandidate;E&&E.length!==0&&(x.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(v.browser==="chrome"&&v.version<78||v.browser==="firefox"&&v.version<68||v.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():E.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function or(x,v){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const E=x.RTCPeerConnection.prototype.setLocalDescription;E&&E.length!==0&&(x.RTCPeerConnection.prototype.setLocalDescription=function(){let w=arguments[0]||{};if(typeof w!="object"||w.type&&w.sdp)return E.apply(this,arguments);if(w={type:w.type,sdp:w.sdp},!w.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":w.type="offer";break;default:w.type="answer"}return w.sdp||w.type!=="offer"&&w.type!=="answer"?E.apply(this,[w]):(w.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(M=>E.apply(this,[M]))})}(function({window:x}={},v={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const E=A,w=function(k){const P={browser:null,version:null};if(k===void 0||!k.navigator||!k.navigator.userAgent)return P.browser="Not a browser.",P;const{navigator:q}=k;if(q.mozGetUserMedia)P.browser="firefox",P.version=_(q.userAgent,/Firefox\/(\d+)\./,1);else if(q.webkitGetUserMedia||k.isSecureContext===!1&&k.webkitRTCPeerConnection)P.browser="chrome",P.version=_(q.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!k.RTCPeerConnection||!q.userAgent.match(/AppleWebKit\/(\d+)\./))return P.browser="Not a supported browser.",P;P.browser="safari",P.version=_(q.userAgent,/AppleWebKit\/(\d+)\./,1),P.supportsUnifiedPlan=k.RTCRtpTransceiver&&"currentDirection"in k.RTCRtpTransceiver.prototype}return P}(x),M={browserDetails:w,commonShim:l,extractVersion:_,disableLog:S,disableWarnings:T,sdp:pe};switch(w.browser){case"chrome":if(!o||!G||!v.shimChrome)return E("Chrome shim is not included in this adapter release."),M;if(w.version===null)return E("Chrome shim can not determine version, not shimming."),M;E("adapter.js shimming chrome."),M.browserShim=o,Wt(x,w),or(x),F(x,w),W(x),G(x,w),X(x),ne(x,w),$(x),K(x),te(x),J(x,w),ke(x),Je(x),cn(x),ut(x,w),ot(x),Dt(x,w);break;case"firefox":if(!a||!Ne||!v.shimFirefox)return E("Firefox shim is not included in this adapter release."),M;E("adapter.js shimming firefox."),M.browserShim=a,Wt(x,w),or(x),re(x,w),Ne(x,w),ye(x),Ye(x),_e(x),Ae(x),Ze(x),Ke(x),It(x),Xt(x),Qt(x),ke(x),cn(x),ut(x,w),ot(x);break;case"safari":if(!c||!v.shimSafari)return E("Safari shim is not included in this adapter release."),M;E("adapter.js shimming safari."),M.browserShim=c,Wt(x,w),or(x),nn(x),rt(x),Re(x),Kt(x),xn(x),Ot(x),St(x),nt(x),ke(x),Je(x),ut(x,w),ot(x),Dt(x,w);break;default:E("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8520);const xt=()=>typeof RTCPeerConnection=="function";var bt,Ft;(function(x){x[x.TRACE=0]="TRACE",x[x.DEBUG=1]="DEBUG",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT"})(bt||(bt={})),function(x){x.SPADE="SPADE",x.TIME="Time",x.WEBRTC="WebRTC",x.EMITTER="Emitter",x.MEDIA="Media",x.SUBSCRIPTION="StageSubscription",x.PUBLICATION="StagePublication",x.CONNECTION="StageConnection",x.SOCKET="StageSocket",x.BROADCAST_STAGE_CLIENT="BroadcastStageClient",x.STAGE="Stage",x.REMOTE_PARTICIPANT="RemoteParticipant",x.LOCAL_PARTICIPANT="LocalParticipant",x.CONFIGURATION="Configuration",x.REMOTE_PLAYBACK="RemotePlaybackController",x.REMOTE_STAGE_STREAM="RemoteStageStream"}(Ft||(Ft={}));const Un=1007,Zt=12e4,Ir=3e5;class Et extends Error{constructor({name:v,message:E,code:w,details:M,cause:k,params:P}){super(E),Error.captureStackTrace&&Error.captureStackTrace(this,Et),this.name=v||"BroadcastClientError",this.message=E,this.code=w,this.details=M,this.cause=k,this.params=P}}const ii={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Me={name:"CameraError",code:2e3,message:"Camera could not be captured"},Nt={name:"InputError",code:3e3,message:"Input could not be attached"},et={name:"AddDeviceError",code:4e3,message:"Device is missing"},ht={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},Ht={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Lt={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},Ee={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},ze={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},st={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},ct={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Rn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},Br={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Qn={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},Fn={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},en={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},zt={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},_n={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},vn={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},lr={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},Qr={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},$r={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},co={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},$l={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},dh={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},fd={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},pd={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},le={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},Ie={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},Ge={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},Xe={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},Pe={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var wt,Ut,tn,sn,In,Hn,ln,ur,Or,fn=function(x,v,E,w){if(E==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?x!==v||!w:!v.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?w:E==="a"?w.call(x):w?w.value:v.get(x)},On=function(x,v,E,w,M){if(typeof v=="function"?x!==v||!M:!v.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return v.set(x,E),E};const hr=1920,Gt=1080,Pi=bt.ERROR,dr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},ws={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},Gn={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},Zn={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},cl={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},hi={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},lo={reconnect:!1,timeout:Zt};function ll(x){var v,E;if(typeof x!="string"&&x!==void 0)throw new Et(co);if(x){if(x.startsWith("https"))return x;{const w=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(x);if(((v=w==null?void 0:w.groups)===null||v===void 0?void 0:v.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(E=w==null?void 0:w.groups)===null||E===void 0?void 0:E.id)return`https://${w.groups.id}.webrtc.live-video.net:4443`;throw new Et($l)}}return""}class Di{constructor(v,E,w=dr,M,k=lo){this.LOG_LEVEL=bt,this.BASIC_LANDSCAPE=dr,this.BASIC_PORTRAIT=ws,this.BASIC_FULL_HD_LANDSCAPE=Gn,this.BASIC_FULL_HD_PORTRAIT=Zn,this.STANDARD_LANDSCAPE=cl,this.STANDARD_PORTRAIT=hi,wt.set(this,void 0),Ut.set(this,void 0),tn.set(this,dr),sn.set(this,void 0),In.set(this,lo),Hn.set(this,P=>{if(!P)throw new Et(Object.assign(Object.assign({},$r),{details:"missing stream configuration"}));if(!(P.maxBitrate<=8500&&P.maxBitrate>=200))throw new Et(Object.assign(Object.assign({},$r),{details:"maxBitrate must be between 200 and 8500"}));if(!(P.maxFramerate<=60&&P.maxFramerate>=10))throw new Et(Object.assign(Object.assign({},$r),{details:"maxFramerate must be between 10 and 60"}));const q=P.maxResolution.width,Z=P.maxResolution.height;if(q>hr||Z>hr||q<160||Z<160||q===hr&&Z>Gt||Z===hr&&q>Gt)throw new Et(Object.assign(Object.assign({},$r),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))}),ln.set(this,P=>{if(!P)return;const q=Number(P),Z=Number.isInteger(q),j=q>=bt.TRACE,ee=q<=bt.SILENT;if(!Z||!j||!ee)throw new Et(dh)}),ur.set(this,P=>{if(P&&typeof P!="object")throw new Et(fd)}),Or.set(this,P=>{if(!P)return;if(typeof P!="object"||typeof P.reconnect!="boolean")throw new Et(le);const{timeout:q}=P;if(q!==void 0&&(Number.isNaN(q)||typeof q!="number"||q<1e4||q>Ir))throw new Et(Ie)}),fn(this,ur,"f").call(this,M),fn(this,ln,"f").call(this,E),fn(this,Hn,"f").call(this,w),On(this,wt,v),On(this,Ut,E),On(this,tn,w),On(this,sn,M),On(this,In,k)}get ingestEndpoint(){return fn(this,wt,"f")}set ingestEndpoint(v){On(this,wt,ll(v))}get streamConfig(){return fn(this,tn,"f")}set streamConfig(v){fn(this,Hn,"f").call(this,v),On(this,tn,v)}get logLevel(){return fn(this,Ut,"f")}set logLevel(v){fn(this,ln,"f").call(this,v),On(this,Ut,v)}get logger(){return fn(this,sn,"f")}set logger(v){fn(this,ur,"f").call(this,v),On(this,sn,v)}get networkReconnectConfig(){return fn(this,In,"f")}set networkReconnectConfig(v){fn(this,Or,"f").call(this,v),On(this,In,v)}}wt=new WeakMap,Ut=new WeakMap,tn=new WeakMap,sn=new WeakMap,In=new WeakMap,Hn=new WeakMap,ln=new WeakMap,ur=new WeakMap,Or=new WeakMap;var an,Ba=i(6729),ul=i(1206);(function(x){x.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",x.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",x.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",x.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",x.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",x.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",x.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",x.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",x.PUBLISH="ivs_broadcast_multihost_publish",x.UNPUBLISH="ivs_broadcast_multihost_unpublish",x.SUBSCRIBE="ivs_broadcast_multihost_subscribe",x.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",x.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",x.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",x.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",x.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",x.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",x.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",x.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",x.FIRST_FRAME="ivs_broadcast_multihost_first_frame",x.JOIN="ivs_broadcast_multihost_join",x.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",x.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",x.JOIN_ENDED="ivs_broadcast_multihost_join_ended",x.LEAVE="ivs_broadcast_multihost_leave",x.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",x.SERVER_REQUEST="ivs_broadcast_multihost_server_request",x.TRACE="ivs_broadcast_stage_trace",x.ERROR="ivs_broadcast_error",x.MINUTE="ivs_broadcast_multihost_minute",x.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",x.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",x.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",x.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",x.EDP_PONG="ivs_broadcast_multihost_edp_rtt",x.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",x.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",x.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",x.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",x.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state"})(an||(an={}));class ar{constructor(v,E,w,M){let k="unknown";if(E.stageARN&&E.stageARN.startsWith("arn:aws:ivs:")){const P=E.stageARN.split(":");P.length===6&&(k=P[4])}this.event=v,this.properties={client_time:new Date().toISOString(),customer_id:k,device_software:window.navigator.userAgent,multihost_id:E.stageARN,participant_id:E.participantID,participant_user_id:E.userID,platform:"web",sdk_version:"1.19.0",stage_arn:E.stageARN,trace_id:w.value},E.attrGsRole&&(this.properties.token_attribute_0=E.attrGsRole),E.attrGsSessionId&&(this.properties.token_attribute_1=E.attrGsSessionId),this.critical=M}}class fh extends ar{constructor(v){super(an.ERROR,v.token,v.traceId,!0),Object.assign(this.properties,{code:v.code,tag:v.tag,description:v.message,remote_participant_id:v.remoteParticipantId,request_uuid:v.requestUUID,is_nominal:v.nominal,is_fatal:v.fatal,details:v.details,location:v.location})}}const xo="IVS_CLIENT_OVERRIDES";function ph(x){const v=window[xo];return typeof v=="object"?v[x]:x==="logLevel"?window.STAGES_LOG_LEVEL:x==="appLabel"?window.IVS_APP_LABEL:x==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function md(x){const v=ph(x);if(typeof v=="string")return v}function ql(x){const v=ph(x);if(typeof v=="boolean")return v}function Wf(){const x=ph("logLevel");if(typeof x=="number"&&Object.values(bt).includes(x))return x}function $f(){return ql("disableXdp")}function wu(){return ql("enableXdpPublish")}function qo(){return ql("preferMainProfile")}function gd(){return ql("enableInitialLayerOnSdp")}var er=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};const B_=4;class Mm{constructor(v="https://broadcast.stats.live-video.net/"){this.spadeUrl=v}send(v,E=!1){return er(this,void 0,void 0,function*(){const w=Date.now();for(const q of v)q.properties.batch_time_millis=w;const M=this.b64EncodeUnicode(JSON.stringify(v)),k={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},P=`data=${M}`;E?navigator.sendBeacon(this.spadeUrl,P):er(this,void 0,void 0,function*(){try{yield function(q,Z,j={},ee=""){return er(this,void 0,void 0,function*(){const se=new XMLHttpRequest;return se.open(q,Z,!0),j&&Object.keys(j).forEach(ae=>{j.hasOwnProperty(ae)&&se.setRequestHeader(ae,j[ae])}),new Promise((ae,ve)=>{se.onreadystatechange=()=>{se.readyState===B_&&(se.status>=200&&se.status<300?ae(se.responseText):ve(new Error(`Spade ${q} ${Z} responded ${se.status}
${se.responseText}`)))},se.send(ee)})})}("POST",this.spadeUrl,k,P)}catch{}})})}b64EncodeUnicode(v){return btoa(encodeURIComponent(v).replace(/%([0-9A-F]{2})/g,(E,w)=>String.fromCharCode(+`0x${w}`)))}}function hl(x){if(!x)throw new Error("SpadeClient is not defined")}function qf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,x=>{const v=16*Math.random()|0;return(x==="x"?v:3&v|8).toString(16)})}class Cu{constructor(){this.sharedProperties={},this.spadeClient={},this.queuedEvents=[],this.genSessionId();const v=function(){const w=md("analyticsPostUrl");if(w!==void 0)return w}()||"https://broadcast.stats.live-video.net/",E=function(){const w=md("appLabel");if(w!==void 0)return w.substring(0,64)}();this.spadeClient=new Mm(v),this.initSharedProperties({appLabel:E})}start(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.flushEvents()},1e3))}stop(v){let E=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,v&&(this.queuedEvents=this.queuedEvents.filter(w=>w.critical),E=!0),this.flushEvents(E),this.genSessionId()}trackEvent(v,E=!1){let w=this.sharedProperties;E&&(w={global_session_id:Cu.globalSessionId,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version}),"data"in v?(v.data.properties=Object.assign({},w,v.data.properties),this.queuedEvents.push(v.data)):(v.properties=Object.assign({},w,v.properties),this.queuedEvents.push(v))}trackEventNoSharedProps(v){this.trackEvent(v,!0)}trackErrorAndThrow(v){throw this.trackError(v),v}trackError(v){this.trackEvent(new fh(v))}batchEvents(v){hl(this.spadeClient);const E=v.map(w=>(w.data.properties=Object.assign({},this.sharedProperties,w.data.properties),w.data));this.spadeClient.send(E)}initSharedProperties({appLabel:v}){const E=ul.getParser(navigator.userAgent),w=this.parseSemver(String(E.getBrowserVersion()));this.sharedProperties={browser:navigator.appVersion,browser_family:E.getBrowserName().toLowerCase(),browser_version:`${w.major}.${w.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:E.getOSName(),os_version:String(E.getOSVersion()),platform:"web",global_session_id:Cu.globalSessionId,session_id:this.sessionId,sdk_version:"1.19.0",user_agent:navigator.userAgent},v&&(this.sharedProperties.app_label=v)}genSessionId(){this.sessionId=qf(),this.sharedProperties.session_id=this.sessionId}flushEvents(v=!1){hl(this.spadeClient),this.queuedEvents.length>0&&this.spadeClient.send(this.queuedEvents,v),this.queuedEvents=[]}parseSemver(v){const E=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(v)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(v)||/^(\d+)$/.exec(v)||[];return{major:parseInt(E[1],10)||0,minor:parseInt(E[2],10)||0,patch:parseInt(E[3],10)||0}}getSessionId(){return this.sessionId}}Cu.globalSessionId=qf();class pr{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.CONGESTION_TIME,properties:w}}}class dl{constructor(v,E,w){this.transformProperties=(k,P,q)=>({duration:(k.getTime()-((P==null?void 0:P.getTime())||0))/1e3,ecn_negotiated:!1,ingest_session_id:q});const M=this.transformProperties(v,E,w);this.data={event:qr.CONNECTION_ESTABLISHED,properties:M}}}class r0{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.CONNECTION_RTT,properties:w}}}class Im{constructor(v){this.transformProperties=w=>{var M;return{is_fatal:(M=w.isFatal)!==null&&M!==void 0&&M,value:w.value,code:w.code,description:w.description}};const E=this.transformProperties(v);this.data={event:qr.ERROR,properties:E}}}class km{constructor(v,E){this.transformProperties=(M,k)=>({type:M,input_device_id:k.deviceId,position:k.facingMode||"unknown"});const w=this.transformProperties(v,E);this.data={event:qr.INPUT_DEVICE_ATTACHED,properties:w}}}class Xf{constructor(v,E){this.transformProperties=(M,k)=>({type:M,input_device_id:k.deviceId,position:k.facingMode||"unknown"});const w=this.transformProperties(v,E);this.data={event:qr.INPUT_DEVICE_DETACHED,properties:w}}}class wc{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.MEASURED_BITRATE,properties:w}}}class Om{constructor(v,E){this.transformProperties=(M,k)=>({minutes_logged:Math.round((M.timestamp-k)/6e4)});const w=this.transformProperties(v,E);this.data={event:qr.MINUTE_BROADCAST,properties:w}}}class _d{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.RECOMMENDED_BITRATE,properties:w}}}class fl{constructor(v){this.transformProperties=w=>({codec:w.mimeType,bitrate:0,sample_rate:w.clockRate,channel_count:w.channels});const E=this.transformProperties(v);this.data={event:qr.SESSION_AUDIO_ENCODER_CONFIGURED,properties:E}}}class pl{constructor(v){this.transformProperties=w=>({codec:"audio",bitrate:32e3,sample_rate:w.sampleRate,channel_count:w.channelCount});const E=this.transformProperties(v);this.data={event:qr.SESSION_AUDIO_PROPERTIES,properties:E}}}class Kf{constructor(v,E,w){this.transformProperties=(k,P,q)=>({codec:q.mimeType,codec_profile:P.profile,codec_level:P.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:k.width,height:k.height,bframe_count:0,target_fps:k.frameRate});const M=this.transformProperties(v,E,w);this.data={event:qr.SESSION_VIDEO_ENCODER_CONFIGURED,properties:M}}}class Yf{constructor(v){this.transformProperties=w=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:w.width,height:w.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:w.frameRate});const E=this.transformProperties(v);this.data={event:qr.SESSION_VIDEO_PROPERTIES,properties:E}}}class Nm{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.SOURCE_AUDIO_LATENCY,properties:w}}}class z_{constructor(v,E){this.transformProperties=(M,k)=>({sum:M.sum,median:M.median(),min:M.min,max:M.max,p90:M.percentile(.9),event_count:M.data.length,period:k});const w=this.transformProperties(v,E);this.data={event:qr.SOURCE_VIDEO_LATENCY,properties:w}}}class za{constructor(v,E){this.transformProperties=({protocol:M,hostname:k,port:P},q)=>({protocol:M,endpoint_host:k,endpoint_port:P,reason:q});const w=this.transformProperties(v,E);this.data={event:qr.START_BROADCAST,properties:w}}}class i0{constructor(v){this.transformProperties=({protocol:w,hostname:M,port:k})=>({protocol:w,endpoint_host:M,endpoint_port:k});const E=this.transformProperties(v);this.data={event:qr.STOP_BROADCAST,properties:E}}}class Jf{constructor(v){this.transformProperties=w=>({bytes_sent:w.bytesSent,header_bytes_sent:w.headerBytesSent,nack_count:w.nackCount,packets_sent:w.packetsSent,retransmitted_bytes_sent:w.retransmittedBytesSent,retransmitted_packets_sent:w.retransmittedPacketsSent});const E=this.transformProperties(v);this.data={event:qr.WEBRTC_AUDIO_STATS,properties:E}}}class Va{constructor(v){this.transformProperties=w=>({bytes_sent:w.bytesSent,fir_count:w.firCount,frames_encoded:w.framesEncoded,frames_sent:w.framesSent,header_bytes_sent:w.headerBytesSent,huge_frames_sent:w.hugeFramesSent,key_frames_encoded:w.keyFramesEncoded,nack_count:w.nackCount,packets_sent:w.packetsSent,pli_count:w.pliCount,quality_limitation_reason:w.qualityLimitationReason,quality_limitation_resolution_changes:w.qualityLimitationResolutionChanges,retransmitted_bytes_sent:w.retransmittedBytesSent,retransmitted_packets_sent:w.retransmittedPacketsSent,total_encode_time:w.totalEncodeTime,total_encoded_bytes_target:w.totalEncodedBytesTarget,total_packet_send_delay:w.totalPacketSendDelay});const E=this.transformProperties(v);this.data={event:qr.WEBRTC_VIDEO_STATS,properties:E}}}var qr,Cc;(function(x){x.START_BROADCAST="ivs_broadcast_start_broadcast",x.STOP_BROADCAST="ivs_broadcast_stop_broadcast",x.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",x.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",x.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",x.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",x.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",x.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",x.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",x.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",x.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",x.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",x.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",x.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",x.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",x.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",x.CONGESTION_TIME="ivs_broadcast_congestion_time",x.BUFFER_DURATION="ivs_broadcast_buffer_duration",x.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",x.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",x.CONNECTION_RTT="ivs_broadcast_connection_rtt",x.ERROR="ivs_broadcast_error"})(qr||(qr={})),function(x){x.USER_INITIATED="user-initiated",x.NETWORK_DISCONNECT="network-disconnect"}(Cc||(Cc={}));const Qf={[bt.INFO]:"#528bff",[bt.WARN]:"#ffb31a",[bt.DEBUG]:"#00f593",[bt.ERROR]:"#ff4f4d",[bt.TRACE]:"",[bt.SILENT]:"",[Ft.SPADE]:"#a970ff",[Ft.TIME]:"#53535f",[Ft.WEBRTC]:"#0e9bd8",[Ft.SUBSCRIPTION]:"#ffc400",[Ft.CONNECTION]:"#ff5edb",[Ft.SOCKET]:"#8585ff",[Ft.EMITTER]:"#adadb8",[Ft.LOCAL_PARTICIPANT]:"#1DD21D",[Ft.STAGE]:"#EC9806",[Ft.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},ml=({label:x})=>`background: ${Qf[x]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,s0=Object.entries(bt),vd=(x,v,E)=>{const w=ml({label:x}),[M]=s0.find(([,Le])=>Le===Number(x))||[],k=`%c${M}`,P=ml({label:v}),q=`%c${v}`,Z=ml({label:Ft.TIME}),j=`%c[${new Date().toISOString()}]`,ee=ml({label:"details"}),se=`%c[${E}]`,ae=[j,k,q],ve=[Z,w,P];return E&&(ae.push(se),ve.push(ee)),[ae.join(""),...ve]},V_={debug(x){console.groupCollapsed(...vd(bt.DEBUG,x.scope,x.label)),console.debug(x.msg,Object.assign(Object.assign({},x),{level:"debug"})),console.groupEnd()},info(x){console.groupCollapsed(...vd(bt.INFO,x.scope,x.label)),console.info(x.msg,Object.assign(Object.assign({},x),{level:"info"})),console.groupEnd()},warn(x){console.groupCollapsed(...vd(bt.WARN,x.scope,x.label)),console.warn(x.msg,Object.assign(Object.assign({},x),{level:"warn"})),console.groupEnd()},error(x){console.groupCollapsed(...vd(bt.ERROR,x.scope,x.label)),console.error(x),console.groupEnd()}};var Xl=function(x,v){var E={};for(var w in x)Object.prototype.hasOwnProperty.call(x,w)&&v.indexOf(w)<0&&(E[w]=x[w]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function"){var M=0;for(w=Object.getOwnPropertySymbols(x);M<w.length;M++)v.indexOf(w[M])<0&&Object.prototype.propertyIsEnumerable.call(x,w[M])&&(E[w[M]]=x[w[M]])}return E};Object.entries(bt);class mh{constructor(v=Pi,E=V_){this.logLevel=v,this.loggerInstance=E}debug(v){var E,w;this.logLevel>bt.DEBUG||(w=(E=this.loggerInstance).debug)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{level:"debug"}))))}info(v){var E,w;this.logLevel>bt.INFO||(w=(E=this.loggerInstance).info)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{level:"info"}))))}warn(v){var E,w;this.logLevel>bt.WARN||(w=(E=this.loggerInstance).warn)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{level:"warn"}))))}error(v){var E,w,{err:M}=v,k=Xl(v,["err"]);this.logLevel>bt.ERROR||(w=(E=this.loggerInstance).error)===null||w===void 0||w.call(E,Object.assign({err:M},k))}}class Ns{constructor(v,E){this.logger=v,this.scope=E}debug(v){var E,w;(w=(E=this.logger).debug)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{scope:this.scope}))))}info(v){var E,w;(w=(E=this.logger).info)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{scope:this.scope}))))}warn(v){var E,w;(w=(E=this.logger).warn)===null||w===void 0||w.call(E,JSON.parse(JSON.stringify(Object.assign(Object.assign({},v),{scope:this.scope}))))}error(v){var E,w,{err:M}=v,k=Xl(v,["err"]);(w=(E=this.logger).error)===null||w===void 0||w.call(E,Object.assign(Object.assign({err:M},k),{scope:this.scope}))}unwrap(){return this.logger}}class Li{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(v){(this.min===0||v<this.min)&&(this.min=v),v>=this.max&&(this.max=v),this.data.push(v),this.sum+=v}median(){this.data.sort();const v=this.data.length>>1;return this.data.length%2==0?this.data[v-1]+this.data[v]>>1:this.data[v]}percentile(v){if(this.data.length===0)return 0;if(v<=0)return this.data[0];if(v>=1)return this.data[this.data.length-1];const E=(this.data.length-1)*v,w=Math.floor(E),M=w+1,k=E%1;return M>=this.data.length?this.data[w]:this.data[w]*(1-k)+this.data[M]*k}}var ya=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class Ru{constructor(v,E,w,M){this.peerClient=v,this.broadcastCanvasManager=E,this.analyticsTracker=M,this.logger=new Ns(w,Ft.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval(()=>{this.collectSamples()},1e3),this.trackSamplesTimerId=window.setInterval(()=>{this.trackSamples()},3e4),this.trackPeerConnectionStatsTimerId=window.setInterval(()=>{this.trackPeerConnectionStats()},6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return ya(this,void 0,void 0,function*(){(yield this.peerClient.getReports()).forEach(v=>{if(v.type==="outbound-rtp")switch(v.kind){case"audio":this.analyticsTracker.trackEvent(new Jf(v));break;case"video":{const E=new Va(v),w=new Om(v,this.startTimestamp);this.analyticsTracker.batchEvents([E,w]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:v.kind})}})})}collectSamples(){return ya(this,void 0,void 0,function*(){let v=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach(w=>{switch(w.type){case"candidate-pair":w.nominated&&(this.rttSamples.push(w.currentRoundTripTime),this.recommendedBitrateSamples.push(w.availableOutgoingBitrate));break;case"outbound-rtp":v+=w.bytesSent||0,this.startTimestamp===0&&w.kind==="video"&&(this.startTimestamp=w.timestamp)}});const E=8*Math.round(v-this.previousBytesSent);this.previousBytesSent=v,this.measuredBitrateSamples.push(E)})}trackSamples(){const E=new Nm(this.audioLatencySamples,30),w=new z_(this.videoLatencySamples,30),M=new pr(this.congestionTimeSamples,30),k=new wc(this.measuredBitrateSamples,30),P=new _d(this.recommendedBitrateSamples,30),q=new r0(this.rttSamples,30);this.analyticsTracker.batchEvents([E,w,M,k,P,q]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Li,this.videoLatencySamples=new Li,this.congestionTimeSamples=new Li,this.measuredBitrateSamples=new Li,this.recommendedBitrateSamples=new Li,this.rttSamples=new Li}}const ms={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},gs="connectionStateChange",Rc="sdpNegotiated",Xo="clientError",Au="seiMessageReceived",Ve="transformError";var Be;(function(x){x.CLOSED="closed",x.COMPLETED="completed",x.CONNECTED="connected",x.CONNECTING="connecting",x.DISCONNECTED="disconnected",x.FAILED="failed",x.IDLE="idle",x.NEW="new",x.NONE="none"})(Be||(Be={}));const ft=x=>{const v=k=>{var P;return!((P=k.deviceId)===null||P===void 0)&&P.startsWith("web-contents-media-stream")?"tab":void 0},E=k=>{var P;return!((P=k.deviceId)===null||P===void 0)&&P.startsWith("window")&&k.displaySurface==="window"?"window":void 0},w=k=>{var P;return!((P=k.deviceId)===null||P===void 0)&&P.startsWith("screen")&&k.displaySurface==="monitor"?"screen":void 0};return(v(M=x)||E(M)||w(M)?void 0:"camera")||w(x)||E(x)||v(x)||"unknown";var M};function Vt(x,v){return x.find(E=>E.kind===v)}var Ct;(function(x){x.VIDEO="video",x.AUDIO="audio"})(Ct||(Ct={}));class Nr{constructor(){this.mediaTracks=new Map([[Ct.VIDEO,void 0],[Ct.AUDIO,void 0]])}setTrack(v,E){this.mediaTracks.set(v,E)}getTrack(v){return this.mediaTracks.get(v)}}class Cs{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(v){return v?(v.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map(E=>E.trim()).filter(Boolean).forEach(E=>{const w=E.split("=");if(w.length===2)switch(w[0]){case"level-asymmetry-allowed":w[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":w[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(w[1]),this.level=this.getLevelFromId(w[1])}}),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(v){const E=v.substr(0,2),w=v.substr(2,2);switch(E.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return w==="00"?"high 10":"high 10 intra";case"7a":return w==="00"?"high 42":"high 42 intra";case"f4":return w==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(v){return parseInt(v.substr(4,2),16)}}function Ac(x){return btoa(JSON.stringify(x))}var wr,gh=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};(function(x){x.IDLE="idle",x.EXECUTING="executing",x.RECONNECTING="reconnecting"})(wr||(wr={}));class _h{constructor(v,E=12e4,w,M){this.state=wr.IDLE,this.failureCallback=()=>{},this.peerClient=v,this.timeout=E,this.logger=w,this.emitter=M}onFailure(v){this.failureCallback=v}setStartConfig(v,E){this.ingestEndpoint=v,this.streamKey=E}execute(){const{id:v}=this;this.state===wr.IDLE&&(this.state=wr.EXECUTING,this.emitter.emit(ms.CONNECTION_STATE_CHANGE,Be.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:v}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(v){this.timeoutTimerId=window.setTimeout(()=>{this.state!==wr.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(ms.CONNECTION_STATE_CHANGE,Be.FAILED),this.failureCallback())},v)}stop(){this.state=wr.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return gh(this,void 0,void 0,function*(){if(this.ingestEndpoint&&this.streamKey){const v=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),v===Be.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(E){throw this.logger.error({err:E}),E}}})}isActive(){return this.state!==wr.IDLE}}class uo extends _h{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let v=5e3;const E=()=>gh(this,void 0,void 0,function*(){if(this.state===wr.EXECUTING)try{this.state=wr.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:v}),this.state=wr.EXECUTING,this.currentTimeoutId=window.setTimeout(E,v),v*=2}});this.currentTimeoutId=window.setTimeout(E,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class vh extends _h{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>gh(this,void 0,void 0,function*(){if(navigator.onLine&&this.state===wr.EXECUTING){this.state=wr.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=wr.EXECUTING}}})}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class Pm{static create(v,E=lo,w,M){const{reconnect:k,timeout:P}=E;if(k){const q=ul.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(q)&&navigator.connection?new vh(v,P,w,M):new uo(v,P,w,M)}}}var Ps,Ds=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})},gl=function(x,v,E,w){if(E==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?x!==v||!w:!v.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?w:E==="a"?w.call(x):w?w.value:v.get(x)};const Pr=x=>!!x;function ac(x){if(!x)throw new Error("PeerConnection is not defined")}const Mu={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class Zf{constructor(v,E,w,M,k){this.config=v,this.emitter=E,this.mediaStreamManager=w,this.analyticsTracker=k,this.establishConnection=(P,q)=>Ds(this,void 0,void 0,function*(){var Z,j,ee;ac(this.peerConnection);try{const se=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(se),yield this.sendSetupRequest(P,q,se)}catch(se){if(se instanceof Error){(Z=(ee=se).code)!==null&&Z!==void 0||(ee.code=_n.code);const ae=new Et(Object.assign(Object.assign({},_n),{name:se.name,message:se.message,code:se==null?void 0:se.code,cause:se}));throw!((j=this.reconnectStrategy)===null||j===void 0)&&j.isActive()||this.handleError(se.code,se.message),this.stop(),ae}}}),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var P;if(!this.peerConnection)return Be.NONE;const q=(P=this.reconnectStrategy)===null||P===void 0?void 0:P.isActive(),Z=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(Z){case"new":return Be.NEW;case"closed":return Be.CLOSED;case"disconnected":return q?Be.CONNECTING:Be.DISCONNECTED;case"failed":return q?Be.CONNECTING:Be.FAILED;case"idle":return Be.IDLE;case"checking":case"connecting":return Be.CONNECTING;case"completed":case"connected":return Be.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:Z}),Be.IDLE}},this.onConnectionStateChange=()=>{var P;const q=this.getConnectionState();switch(q){case Be.CONNECTED:{this.emitter.emit(ms.CONNECTION_STATE_CHANGE,q);const Z=new Date;this.analyticsTracker.trackEvent(new dl(Z,this.connectionStartDate,this.ingestSessionId));const j=this.mediaStreamManager.getTrack(Ct.AUDIO),ee=this.mediaStreamManager.getTrack(Ct.VIDEO);if(ee){const se=ee.getSettings();this.analyticsTracker.trackEvent(new Yf(se))}if(j){const se=j.getSettings();this.analyticsTracker.trackEvent(new pl(se))}(((P=this.peerConnection)===null||P===void 0?void 0:P.getSenders())||[]).forEach(se=>{var ae;(((ae=se.getParameters())===null||ae===void 0?void 0:ae.codecs)||[]).forEach(ve=>{var Le;switch((Le=se.track)===null||Le===void 0?void 0:Le.kind){case"video":{if(!ee)break;const Te=new Cs().extractVideoSdpFmtpLine(ve.sdpFmtpLine),ge=ee.getSettings();this.analyticsTracker.trackEvent(new Kf(ge,Te,ve));break}case"audio":if(!j)break;this.analyticsTracker.trackEvent(new fl(ve))}})});break}case Be.CONNECTING:this.emitter.emit(ms.CONNECTION_STATE_CHANGE,q),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case Be.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(ms.CONNECTION_STATE_CHANGE,q),this.handleTerminalConnectionFailure());break;case Be.DISCONNECTED:this.emitter.emit(ms.CONNECTION_STATE_CHANGE,q),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(ms.CONNECTION_STATE_CHANGE,q)}},this.handleLocalDescription=P=>Ds(this,void 0,void 0,function*(){var q;return(q=this.peerConnection)===null||q===void 0?void 0:q.setLocalDescription(P)}),Ps.set(this,P=>{if(typeof P!="string")throw new Et(co);try{new URL(P)}catch{throw new Et($l)}}),this.logger=new Ns(M,Ft.WEBRTC),this.createReconnectStrategy(v)}start(v,E){var w;return Ds(this,void 0,void 0,function*(){gl(this,Ps,"f").call(this,v);const M=[this.mediaStreamManager.getTrack(Ct.VIDEO),this.mediaStreamManager.getTrack(Ct.AUDIO)].filter(Pr);if(this.createPeerConnection(),this.addTracks({tracks:M}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(v,E),yield this.establishConnection(v,E),!((w=this.reconnectStrategy)===null||w===void 0)&&w.isActive()){const k=new URL(v);this.analyticsTracker.trackEvent(new za({protocol:"webrtc",hostname:k.hostname,port:k.port},Cc.NETWORK_DISCONNECT))}})}stop(){var v,E,w,M;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[Be.NEW,Be.CONNECTING,Be.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(ms.CONNECTION_STATE_CHANGE,Be.CLOSED),(v=this.peerConnection)===null||v===void 0||v.close(),(E=this.peerConnection)===null||E===void 0||E.removeEventListener("connectionstatechange",this.onConnectionStateChange),(w=this.peerConnection)===null||w===void 0||w.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(M=this.reconnectStrategy)===null||M===void 0||M.stop()}addTracks(v){var E;if(ac(this.peerConnection),!v)return;const w=this.peerConnection.getSenders().map(k=>{var P;return(P=k.track)===null||P===void 0?void 0:P.id}),M=v.tracks.filter(k=>!w.includes(k.id));for(const k of M)(E=this.peerConnection)===null||E===void 0||E.addTrack(k)}getReports(){var v;return Ds(this,void 0,void 0,function*(){try{const E=(yield(v=this.peerConnection)===null||v===void 0?void 0:v.getStats())||[],w=[];return E.forEach(M=>{w.push(M)}),w}catch{return[]}})}sendSetupRequest(v,E,w){var M;return Ds(this,void 0,void 0,function*(){const k=yield fetch(`${v}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:Ac(w),streamKey:E},this.config.streamConfig))});if(!k.ok)throw function(q){let Z=new Et(Object.assign({},_n));return(q==null?void 0:q.code)===Un&&(Z=new Et(Object.assign({},lr))),q!=null&&q.message&&(Z.message=q.message),Z}(yield k.json());const P=yield k.json();P!=null&&P.answer&&(yield(M=this.peerConnection)===null||M===void 0?void 0:M.setRemoteDescription(function(q){return JSON.parse(atob(q))}(P.answer)),this.ingestSessionId=P.ingestSessionId)})}handleTerminalConnectionFailure(){const v=new Et(vn);this.handleError(v.code,v.message)}handleError(v,E){this.analyticsTracker.trackEvent(new Im({code:v,description:E,isFatal:!0})),this.emitter.emit(ms.ERROR,{code:v,message:E})}createPeerConnection(){var v;const E=this.getConnectionState(),w=E!==Be.NONE,M=E!==Be.CLOSED,k=(v=this.reconnectStrategy)===null||v===void 0?void 0:v.isActive();w&&M&&!k||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval(()=>{const P=this.getConnectionState();if(this.reconnectStrategy&&P===Be.DISCONNECTED&&this.disconnectionStartDate){const q=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:q}),q>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else P===Be.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)},1e3),this.peerConnection=new RTCPeerConnection(Mu),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(v){if(this.reconnectStrategy=Pm.create(this,v.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const E=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:E})}}}Ps=new WeakMap;var Iu,o0=i(2492);(function(x){x.CONFIG="config",x.UPDATE="update",x.START="start",x.STOP="stop"})(Iu||(Iu={}));var ja=i(477),wo=i.n(ja);function si(){return wo()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var t;!function(t){t.CONFIG="config",t.UPDATE="update",t.START="start",t.STOP="stop"}(t||(t={}));const i=self;const s=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(t){this.config=Object.assign(Object.assign({},this.config),t),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{i.postMessage({type:t.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};i.addEventListener("message",(function(i){var n;if(null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.type)switch(i.data.type){case t.CONFIG:s.setConfig(i.data.payload||{});break;case t.START:s.start();break;case t.STOP:s.stop()}}))})();`,"Worker",void 0,void 0)}var cc=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class lc{constructor(v,E,w){this.config=v,this.mediaStreamManager=E,this.analyticsTracker=w,this.handleWorkerEvent=q=>{var Z;((Z=q.data)===null||Z===void 0?void 0:Z.type)===Iu.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new si,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const M=this.compositeEl.getContext("2d");if(M===null)throw new Et(Object.assign({},ii));this.compositeContext=M,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const k=Vt(this.compositeStream.getTracks(),Ct.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const P=Vt(this.audioDestination.stream.getTracks(),Ct.AUDIO);k&&this.mediaStreamManager.setTrack(Ct.VIDEO,k),P&&this.mediaStreamManager.setTrack(Ct.AUDIO,P),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:Iu.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(v){this.previewElement=v;const{width:E,height:w}=this.config.streamConfig.maxResolution;this.previewElement.width=E,this.previewElement.height=w,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const v=this.audioContext.createConstantSource(),E=this.audioContext.createGain();E.gain.value=.001,v.connect(E),E.connect(this.audioDestination),v.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const v=document.body,E=["touchstart","touchend","mousedown","keydown"],w=()=>{E.forEach(k=>{v.removeEventListener(k,M)})},M=()=>{this.audioContext.resume().then(w)};E.forEach(k=>{v.addEventListener(k,M,!1)})}getTracks(){return[this.mediaStreamManager.getTrack(Ct.VIDEO),this.mediaStreamManager.getTrack(Ct.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Ct.VIDEO)}getAudioInputDevice(v){if(typeof v!="string")return;const E=this.mixer.audio.find(w=>{if(w.name===v)return w.source});return E==null?void 0:E.source}getVideoInputDevice(v){if(typeof v=="string")return this.mixer.video.find(E=>E.name===v)}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(v,E,w){var M;return cc(this,void 0,void 0,function*(){if(typeof v!="object")throw new Et(Object.assign({},et));if(!E||typeof E!="string")throw new Et(Object.assign({},Ee));if(this.mixer.video.some(ae=>ae.name===E))throw new Et(Object.assign({},ht));if(!w)throw new Et(Object.assign({},Ht));if(typeof w.index!="number")throw new Et(Object.assign({},Lt));const k=function(){const ae=document.createElement("video");return ae.autoplay=!0,ae.muted=!0,ae.setAttribute("playsinline",""),ae.setAttribute("webkit-playsinline",""),ae}(),P=v.getVideoTracks(),[q]=P;if(!P.length)throw new Et(Object.assign({},Me));const Z=q.getConstraints(),j=o0({},Z,{frameRate:this.config.streamConfig.maxFramerate});try{yield q.applyConstraints(j)}catch(ae){let ve="Unknown constraints error";ae instanceof Error&&(ve=ae.message),this.analyticsTracker.trackEvent(new Im({description:`${st.message}: ${ve}`,isFatal:!1,code:st.code}))}const ee=()=>cc(this,void 0,void 0,function*(){let ae=0;for(;ae<5;)try{return void(yield k.play())}catch(ve){if(!(ve instanceof Error))throw new Error("unknown error trying to add video to broadcast");ae++,yield new Promise(Le=>setTimeout(Le,150))}throw new Error("Error playing video, tries exceeded")}),se=new MediaStream([q]);k.srcObject=se;try{yield ee();const ae={name:E,element:k,position:w,source:se,render:!0},ve=((M=q.getSettings)===null||M===void 0?void 0:M.call(q))||{};this.analyticsTracker.trackEvent(new km(ft(ve),ve)),this.mixer.video.push(ae)}catch(ae){throw new Et(Object.assign(Object.assign({},Me),{cause:ae}))}})}addImageSource(v,E,w){var M;return cc(this,void 0,void 0,function*(){if(!v)throw new Et(Object.assign({},et));if(!E||typeof E!="string")throw new Et(Object.assign({},Ee));if(v.tagName==="image")throw new Et(Object.assign({},ze));if(this.mixer.video.some(P=>P.name===E))throw new Et(Object.assign({},ht));if(!w)throw new Et(Object.assign({},Ht));if(typeof w.index!="number")throw new Et(Object.assign({},Lt));if(v instanceof Image){const P=(M=v.src)===null||M===void 0?void 0:M.slice();try{const q=v.src?new URL(v.src):{};if(q.host&&q.hostname){const Z=yield fetch(v.src).then(ee=>cc(this,void 0,void 0,function*(){return ee.blob()})),j=yield new Promise(ee=>{const se=new FileReader;se.onload=()=>{ee(se.result)},se.readAsDataURL(Z)});v.src=j}}catch{throw new Et(Object.assign(Object.assign({},zt),{params:{details:`Image URL: ${P}`}}))}}const k={name:E,element:v,position:w,render:!0};this.mixer.video.push(k)})}addAudioInputDevice(v,E){return cc(this,void 0,void 0,function*(){if(typeof v!="object")throw new Et(Object.assign({},et));if(!E||typeof E!="string")throw new Et(Object.assign({},Ee));if(this.mixer.audio.some(q=>q.name===E))throw new Et(Object.assign({},ht));const w=v.getAudioTracks();if(!w.length)throw new Et(Object.assign({},Nt));const M=this.audioContext.createMediaStreamSource(new MediaStream(w)),k=this.audioContext.createGain();k.gain.value=1,M.connect(k),k.connect(this.audioDestination);const P={name:E,source:v,audioTrackSource:M,gainNode:k};this.analyticsTracker.trackEvent(new km("audio",{deviceId:v.id})),this.mixer.audio.push(P)})}removeImage(v){const E=this.mixer.video.findIndex(w=>w.name===v);if(E<0)throw new Et(Object.assign({},Rn));this.mixer.video.splice(E,1)}removeVideoInputDevice(v){var E;const w=this.removeDevice(v,this.mixer.video);if(!w)throw new Et(Object.assign({},ct));{const M=Vt(w.source.getTracks(),Ct.VIDEO);if(!M)throw new Et(Object.assign({},ct));w.element.srcObject=null,M.stop();const k=((E=M==null?void 0:M.getSettings)===null||E===void 0?void 0:E.call(M))||{};this.analyticsTracker.trackEvent(new Xf(ft(k),k))}}removeAudioInputDevice(v){const E=this.removeDevice(v,this.mixer.audio);if(E!=null&&E.audioTrackSource){for(const w of E.source.getTracks())w.stop(),this.analyticsTracker.trackEvent(new Xf("audio",{deviceId:w.id}));E.gainNode.disconnect(this.audioDestination)}else if(!E)throw new Et(Object.assign({},ct))}updateVideoDeviceComposition(v,E){if(!v||typeof v!="string")throw new Et(Object.assign({},Fn));if(!E)throw new Et(Object.assign({},Br));if(typeof E.index!="number")throw new Et(Object.assign({},Qn));this.mixer.video.forEach((w,M)=>{w.name===v&&(w.position=E)})}exchangeVideoDevicePositions(v,E){const w=this.getVideoInputDevice(v),M=this.getVideoInputDevice(E);if(!w)throw new Et(Object.assign(Object.assign({},en),{params:{details:`device with name: "${v}" not found`}}));if(!M)throw new Et(Object.assign(Object.assign({},en),{params:{details:`device with name: "${E}" not found`}}));const k=Object.assign({},w.position),P=Object.assign({},M.position);for(const q of this.mixer.video)q.name===v&&(yd(P.x)?q.position=Object.assign(Object.assign({},q.position),P):q.position={index:P.index}),q.name===E&&(yd(k.x)?q.position=Object.assign(Object.assign({},q.position),k):q.position={index:k.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:Iu.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:Iu.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var v;return((v=this.mediaStreamManager.getTrack(Ct.VIDEO))===null||v===void 0?void 0:v.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach(v=>{v.render=!1})}enableVideo(){this.mixer.video.forEach(v=>{v.render=!0})}disableAudio(){this.mixer.audio.forEach(v=>{v.audioTrackSource&&(v.gainNode.gain.value=0)})}enableAudio(){this.mixer.audio.forEach(v=>{v.audioTrackSource&&(v.gainNode.gain.value=1)})}getDrawRegion(v,E,w){var M,k,P,q;let Z=(M=v.position.x)!==null&&M!==void 0?M:0,j=(k=v.position.y)!==null&&k!==void 0?k:0;const ee=(P=v.position.width)!==null&&P!==void 0?P:E-Z,se=(q=v.position.height)!==null&&q!==void 0?q:w-j,ae=ee/se;let ve=v.element.width,Le=v.element.height;v.element instanceof HTMLVideoElement&&(ve=v.element.videoWidth,Le=v.element.videoHeight);const Te=ve/Le;let ge=ee,he=se;return Te>ae?(ge=ee,he=2*Math.round(ee/Te/2),j+=(se-he)/2):Te<ae&&(he=se,ge=2*Math.round(se*Te/2),Z+=(ee-ge)/2),{x:Z,y:j,width:ge,height:he}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const v=this.mixer.video.filter(E=>E.render);v.sort((E,w)=>E.position.index-w.position.index);for(const E of v){const{x:w,y:M,width:k,height:P}=this.getDrawRegion(E,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(E.element,w,M,k,P)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Ct.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(v,E){const w=E.findIndex(M=>(k=>k.name===v)(M));if(!(w<0))return E.splice(w,1)[0]}shouldMix(v){if(v.getTime()<this.nextMix)return!1;for(;this.nextMix<=v.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function yd(x){return Number.isSafeInteger(x)}var ep,tp,Kl=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})},a0=function(x,v,E,w){if(E==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?x!==v||!w:!v.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?w:E==="a"?w.call(x):w?w.value:v.get(x)};class Mc{constructor(v){this.config=v,ep.add(this),this.emitter=new Ba,this.isValid=!0,this.emitter.on(ms.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new Cu,this.mediaStreamManager=new Nr;const E=new mh(v.logLevel,v.logger);this.peerClient=new Zf(this.config,this.emitter,this.mediaStreamManager,E,this.analyticsTracker),this.broadcastCanvasManager=new lc(v,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new Ru(this.peerClient,this.broadcastCanvasManager,E,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(Mc.prototype).forEach(w=>{this[w]=new Proxy(this[w],{apply:(M,k,P)=>{if(!k.isValid)throw new Et(Object.assign({},pd));return Reflect.apply(M,k,P)}})}),window.addEventListener("beforeunload",()=>{this.analyticsTracker.stop(!0)})}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(v,E){return Kl(this,void 0,void 0,function*(){a0(this,ep,"m",tp).call(this,v);const w=ll(E||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(w,v),this.emitter.emit(ms.ACTIVE_STATE_CHANGE,!0),this.url=new URL(w),this.url&&this.analyticsTracker.trackEvent(new za({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},Cc.USER_INITIATED))})}stopBroadcast(){var v,E,w;this.url&&this.analyticsTracker.trackEvent(new i0({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(v=this.peerStatsTracker)===null||v===void 0||v.stop(),(E=this.peerClient)===null||E===void 0||E.stop(),(w=this.emitter)===null||w===void 0||w.emit(ms.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(v,E,w){return Kl(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addVideoInputDevice(v,E,w)})}addImageSource(v,E,w){return Kl(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addImageSource(v,E,w)})}addAudioInputDevice(v,E){return Kl(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addAudioInputDevice(v,E)})}removeVideoInputDevice(v){this.broadcastCanvasManager.removeVideoInputDevice(v)}removeAudioInputDevice(v){this.broadcastCanvasManager.removeAudioInputDevice(v)}removeImage(v){this.broadcastCanvasManager.removeImage(v)}updateVideoDeviceComposition(v,E){this.broadcastCanvasManager.updateVideoDeviceComposition(v,E)}exchangeVideoDevicePositions(v,E){this.broadcastCanvasManager.exchangeVideoDevicePositions(v,E)}getAudioInputDevice(v){return this.broadcastCanvasManager.getAudioInputDevice(v)}getVideoInputDevice(v){return this.broadcastCanvasManager.getVideoInputDevice(v)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(v,E){this.emitter.on(v,E)}off(v,E){this.emitter.off(v,E)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(v){this.broadcastCanvasManager.attachPreview(v)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function Ha(x){return new Mc(function(v){const E=new Di;return E.streamConfig=v.streamConfig,E.ingestEndpoint=v.ingestEndpoint,E.logger=v.logger,E.logLevel=v.logLevel,E.networkReconnectConfig=v.networkReconnectConfig,E}(x))}ep=new WeakSet,tp=function(x){if(typeof x!="string"||!/^[a-zA-Z0-9_-]+$/.test(x))throw new Et(Ge)};const yh="1.19.0";var kt,$i=i(6486);(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe",x.JOIN="join",x.LEAVE="leave"})(kt||(kt={}));const j_=2;class np extends ar{constructor(v){super(an.LEAVE,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.LEAVE,event_endpoint:v.eventEndpoint,whip_endpoint:v.whipEndpoint,reason:v.reason}),this.critical=!0}}class qs{constructor(){this.emitter=new Ba}on(v,E,w){E.call=function(M,k){return function(P,...q){try{k.apply(P,q)}catch(Z){let j=`Error in callback for ${M}`;const ee=k.name;return ee&&(j+=` for function ${ee}`),void console.error(`${j}
`,Z)}}}(v,E),this.emitter.on(v,E,w)}off(v,E,w){this.emitter.off(v,E,w)}emit(v,...E){this.emitter.emit(v,...E)}removeAllListeners(){this.emitter.removeAllListeners()}}function rp(x){const v="0123456789abcdef";let E="";for(let w=0;w<x;w+=1)E+=v.charAt(Math.floor(Math.random()*v.length));return E}class ip{constructor(){const v=rp;this.value=`${v(8)}-${v(4)}-${v(4)}-${v(4)}-${v(12)}`}}function Ls(){return new ip}class Sd{constructor(){const v=(Date.now()/1e3|0).toString(16);this.value=`1-${v}-${rp(24)}`}}function Us(){return new Sd}var Xr=i(9669),Zi=i.n(Xr);class Wn extends Et{constructor({token:v,traceId:E,code:w,tag:M,location:k,message:P,details:q,remoteParticipantId:Z,requestUUID:j,fatal:ee,nominal:se,action:ae}){super({name:"StageClientError",message:P,code:w}),Error.captureStackTrace&&Error.captureStackTrace(this,Wn),this.action=ae,this.token=v,this.traceId=E,this.code=w,this.tag=M,this.location=k,this.message=P,this.details=q,this.remoteParticipantId=Z,this.requestUUID=j,this.fatal=ee,this.nominal=se}}const Ga={JOIN_RELATED:"signalling_session",PUBLISH_RELATED:"webrtc_sink",UNPUBLISH_RELATED:"webrtc_unsink",SUBSCRIBE_RELATED:"webrtc_source"};function Xs(x,v){switch(x){case kt.PUBLISH:return Ga.PUBLISH_RELATED;case kt.SUBSCRIBE:return`webrtc_source:${v}`;default:return"unknown"}}function _i(x,v){var E,w,M,k;const P={code:x.code,message:`${x.message}: ${v.name} ${v.message}`,fatal:(E=x.fatal)!==null&&E!==void 0&&E,nominal:(w=x.nominal)!==null&&w!==void 0&&w};return v instanceof Wn&&(P.fatal=(M=v.fatal)!==null&&M!==void 0&&M,P.nominal=(k=v.nominal)!==null&&k!==void 0&&k),P}function Sh(x,v){if(x===0)return vt.UNKNOWN_SERVER_ERROR;if(!(x<400))if(x>=400&&x<=403)switch(v){case Ks.TokenExpired:return vt.EXPIRED_TOKEN;case Ks.NoPermissions:return vt.TOKEN_PERMISSIONS_DENIED;case Ks.StageAtCapacity:return vt.STAGE_AT_CAPACITY;case Ks.NoMatchingCodec:return vt.NO_MATCHING_CODEC;default:return vt.UNKNOWN_SERVER_ERROR}else{if(x===404)return v===Ks.RemoteStreamNotFound?vt.REMOTE_STREAM_NOT_FOUND:vt.UNKNOWN_SERVER_ERROR;if(x===412)return v===Ks.AbortedMHCPError?vt.MHCP_ABORTED:vt.UNKNOWN_SERVER_ERROR;if(x===429)return v===Ks.StageAuthThrottled?vt.STAGE_AUTH_THROTTLED:vt.WHIP_TOO_MANY_REQUESTS;if(x!==500)return vt.UNKNOWN_SERVER_ERROR;switch(v){case Ks.InternalMHCPError:return vt.INTERNAL_MHCP_ERROR;case Ks.UnreachableMHCP:return vt.UNREACHABLE_MHCP;case Ks.InvalidSessionStatus:return vt.INVALID_SESSION_STATUS;default:return vt.INTERNAL_SERVER_ERROR}}}var Ks;(function(x){x[x.Unspecified=2001]="Unspecified",x[x.TokenExpired=2002]="TokenExpired",x[x.NoPermissions=2003]="NoPermissions",x[x.RemoteStreamNotFound=2004]="RemoteStreamNotFound",x[x.StageAtCapacity=2005]="StageAtCapacity",x[x.InternalMHCPError=2006]="InternalMHCPError",x[x.UncategorizedMHCPError=2007]="UncategorizedMHCPError",x[x.UnreachableMHCP=2008]="UnreachableMHCP",x[x.InvalidSessionStatus=2010]="InvalidSessionStatus",x[x.PostWithoutOptions=2011]="PostWithoutOptions",x[x.AbortedMHCPError=2012]="AbortedMHCPError",x[x.StageAuthThrottled=2013]="StageAuthThrottled",x[x.NoMatchingCodec=2014]="NoMatchingCodec"})(Ks||(Ks={}));const vt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},NO_CANDIDATES:{code:1022,message:"No ICE candidates",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNCATEGORIZED_MHCP_ERROR:{code:1029,message:"Authorization failed due to uncategorized MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},POST_WITHOUT_OPTIONS:{code:1032,message:"Cannot POST without OPTIONS in mandatory TURN",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},CHIME_MEETING_NOT_FOUND:{code:1098,message:"Meeting or Attendee was deleted",fatal:!0,nominal:!0},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message",fatal:!1,nominal:!1},WHIP_SESSION_RESOURCE_DELETED:{code:1206,message:"WHIP signaling session resource not found",fatal:!0,nominal:!0},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_OPTIONS_FAILURE:{code:1501,message:"Failed to get ICE Servers from OPTIONS",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PING_SEND_FAIL:{code:1303,message:"Ping send fail",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var _s;(function(x){x.UNPUBLISH="unpublish",x.UNSUBSCRIBE="unsubscribe",x.UNLOAD="unload",x.CONNECTION_FAIL="connection fail",x.REASSIGNMENT="reassignment"})(_s||(_s={}));const Co="stageJoined",Wa="stageParticipantJoined",Ei="stageParticipantLeft",qi="stageParticipantKicked",vs="stageParticipantUpdated",Ed="localPublishingChanged",sp="stageRefresh",Yl="stateChange",H_="error",Rs="reassignmentRequest",ku="incompatibleCodecs",bd="connectionStateChange",ce="stageStreamUpdate",Ro="error",Sa="stageStreamSeiMessageReceived",As="transformError",yr="reassignmentStarted",Ic="reassignmentSuccess",kc="reassignmentFailed",Oc="open",Nc="closed",$a="messageParseError",Dm="refresh",Pc="error",Lm="stageStateMessage",Eh="sdpAnswer",op="disconnectMessage",Jl="reassignmentMessage",Ou="incompatibleCodecs";function Um(x){return E=function(w){return w.replace(/-/g,"+").replace(/_/g,"/").padEnd(w.length+(4-w.length%4)%4,"=")}(x),window.atob(E);var E}class Td{constructor(v,E){this.analyticsTracker=E,this.rawToken=v;const w=v.split(".");if(w.length!==3)throw Error(`Token format incorrect. length: ${w.length}`);try{this.header=JSON.parse(Um(w[0]))}catch(P){const q=P instanceof Error?`: ${P.message}`:"";throw Error(`Error parsing Stage Token header${q}`)}try{this.claims=JSON.parse(Um(w[1]))}catch(P){const q=P instanceof Error?`: ${P.message}`:"";throw Error(`Error parsing Stage Token claims${q}`)}this.signature=w[2];const{claims:M}=this;this.stageARN=M.resource,this.participantID=M.jti,this.eventsURL=M.events_url,this.whipURL=md("whipUrl")||M.whip_url,this.userID=M.user_id,this.expirationTime=M.exp,this.topic=M.topic,this.parseVersionFlags(M.version);const{attributes:k}=M;k&&(this.attrGsRole=k.gs_role,this.attrGsSessionId=k.gs_session_id)}getPublishEndpoint(){let v="";return this.whipURL&&this.participantID&&(v=`${this.whipURL}/publish/${this.participantID}`),v}getSubscribeEndpoint(v){let E="";return this.whipURL&&(E=`${this.whipURL}/subscribe/${v}`),E}assertTokenIsUnexpired(v,E,w,M){(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Wn(Object.assign(Object.assign({},vt.EXPIRED_TOKEN),{action:kt.JOIN,location:w,tag:E,token:this,traceId:v,remoteParticipantId:M,message:vt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(v){if(!v)return;const E=v.split(".");E.length===2&&(this.versionFlags=parseInt(E[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||(this.versionFlags&j_)!=0}}function Dc(x,v){return new Td(x,v)}class Fm{constructor(v,E){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=v,this.trailing=!(E&&E.skipTrailing)}invoke(v,...E){return this.throttled?(this.trailingFn=v,this.trailingFnArgs=E,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),v(...E),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class Ql extends ar{constructor(v,E,w,M,k,P,q,Z){super(an.SERVER_REQUEST,E,q,!0),Object.assign(this.properties,{action:v,http_method:M,remote_participant_id:P,request_uuid:k,url:w,transport:Z})}}const Ao="draft-ietf-wish-whip-04";var ys,Bm=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};function bh(x,v){return Bm(this,void 0,void 0,function*(){x.validateStatus=w=>w>=200&&w<300||w===403;const E=yield Zi()(x);if(E.status===403){if(E.data.code===2003)throw new Xr.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",x,E.request,E);return x.url===E.request.responseURL?(x.validateStatus=w=>w>=200&&w<300,Zi()(x)):(x.url=E.request.responseURL,v<5?bh(x,v+1):(x.validateStatus=w=>w>=200&&w<300,Zi()(x)))}return E})}function Nu(x){return Bm(this,void 0,void 0,function*(){return bh(x,0)})}function ap(){}function G_(x){switch(x){case"new":return Be.NEW;case"closed":return Be.CLOSED;case"disconnected":return Be.DISCONNECTED;case"failed":return Be.FAILED;case"idle":return Be.IDLE;case"checking":case"connecting":return Be.CONNECTING;case"completed":case"connected":return Be.CONNECTED;default:throw new Error(`unknown connecion state: ${x}`)}}function cp(x,v,E){let w=document.createElement(v);const M=()=>{w&&(w.removeEventListener("loadeddata",k),w.removeEventListener("error",M),w.srcObject=null,w.src="",w=null)},k=()=>{M(),E(v)};return w.addEventListener("loadeddata",k),w.addEventListener("error",M),w.srcObject=x,M}class xd extends ar{constructor(v,E,w,M,k){super(an.TRACE,v,E,!1),Object.assign(this.properties,{action:M,message:w,remote_participant_id:k})}}class Ys extends ar{constructor(v,E,w,M,k){super(an.CONNECTION_STATE,E,w,!1),Object.assign(this.properties,{action:v,remote_participant_id:k,state:M})}}class zm extends ar{constructor(v,E,w,M,k){super(an.ICE_GATHERING_STATE,E,w,!1),Object.assign(this.properties,{action:v,remote_participant_id:k,state:M})}}(function(x){x.POST="post",x.CONNECTED="connected",x.ICE_GATHERING="icegathering",x.SDP_EXCHANGE="sdpExchange",x.SET_REMOTE_DESC="setRemoteDesc",x.PEER_CONNECTION="peerConnection"})(ys||(ys={}));const Vm="start",Ea="stop";class c0{constructor(v,E){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=v,this.traceId=E}markActionStart(){this.markStart(ys.CONNECTED)}markPostStart(){this.markStart(ys.POST)}markPostStop(){this.markStop(ys.POST),this.postDuration=this.measure(ys.POST)}markIceGatheringStart(){this.markStart(ys.ICE_GATHERING)}markIceGatheringStop(){this.markStop(ys.ICE_GATHERING),this.timeToCandidate=this.measure(ys.ICE_GATHERING)}markActionStop(){this.markStop(ys.CONNECTED),this.timeToConnected=this.measure(ys.CONNECTED),this.markStop(ys.PEER_CONNECTION),this.peerConnectionDuration=this.measure(ys.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(ys.SET_REMOTE_DESC)}markSetRemoteDescStop(){const v=ys.SET_REMOTE_DESC;this.markStop(v),this.setRemoteDescDuration=this.measure(v),this.markStart(ys.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(ys.SDP_EXCHANGE)}markSdpExchangeStop(){const v=ys.SDP_EXCHANGE;this.markStop(v),this.sdpExchangeDuration=this.measure(v)}setTransport(v){this.sdpExchangeTransport=v}markStart(v){this.marks[`${this.namespace}.${v}.${Vm}`]=performance.now()}markStop(v){this.marks[`${this.namespace}.${v}.${Ea}`]=performance.now()}measure(v){const E=`${this.namespace}.${v}.${Vm}`,w=`${this.namespace}.${v}.${Ea}`,M=this.marks[E],k=this.marks[w];return M===void 0||k===void 0?0:k-M}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:v,postDuration:E,timeToCandidate:w,timeToConnected:M,sdpExchangeDuration:k,sdpExchangeTransport:P,setRemoteDescDuration:q,peerConnectionDuration:Z}=this;return{optionsDuration:v,postDuration:E,timeToCandidate:w,timeToConnected:M,sdpExchangeDuration:k,sdpExchangeTransport:P,setRemoteDescDuration:q,peerConnectionDuration:Z}}resetMeasurements(v){this.traceId=v,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var _l,es,Zl;(function(x){x.VIDEO="video",x.AUDIO="audio"})(_l||(_l={})),function(x){x.DEFAULT="default",x.LOW="low",x.MEDIUM="medium",x.HIGH="high"}(es||(es={})),function(x){x.LOWEST_QUALITY="lowest_quality",x.HIGHEST_QUALITY="highest_quality"}(Zl||(Zl={}));var Ms=i(766);class vi{constructor(v){this.sdp=v}static splitLines(v){return v.trim().split(`
`).map(E=>E.trim())}static splitSections(v){return v.split(`
m=`).map((E,w)=>(w>0?`m=${E}`:E).trim()+vi.CRLF)}getUniqueRtpHeaderExtensionId(v){const E=[];for(const M of v)if(/^a=extmap:/.test(M.trim())){const k=+M.split("a=extmap:")[1].split(" ")[0];E.includes(k)||E.push(k)}E.sort((M,k)=>M-k);let w=0;for(const M of E){if(M-w>1)return w+1;w=M}return w===14?-1:w+1}withVideoLayersAllocationRtpHeaderExtension(v){const E="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",w=v?v.getRtpHeaderExtensionId(E):-1,M=w===-1?this.getUniqueRtpHeaderExtensionId(vi.splitLines(this.sdp)):w,k=vi.splitSections(this.sdp),P=[];for(let Z of k){if(/^m=video/.test(Z)&&vi.getRtpHeaderExtensionIdInSection(Z,E)===-1){const j=vi.splitLines(Z),ee=[];if(M===-1||this.hasRtpHeaderExtensionId(M)){P.push(Z);continue}for(const se of j)if(ee.push(se),/^a=sendrecv/.test(se.trim())){const ae=`a=extmap:${M} ${E}`;ee.push(ae)}Z=ee.join(vi.CRLF)+vi.CRLF}else if(w!==-1&&/^m=video/.test(Z)&&vi.getRtpHeaderExtensionIdInSection(Z,E)!==w){const j=vi.splitLines(Z),ee=[];for(const se of j){if(/^a=extmap:/.test(se.trim())&&se.split("a=extmap:")[1].split(" ")[1]===E){if(!this.hasRtpHeaderExtensionId(w)){const ae=`a=extmap:${w} ${E}`;ee.push(ae)}continue}ee.push(se)}Z=ee.join(vi.CRLF)+vi.CRLF}P.push(Z)}const q=P.join("");return new vi(q)}withOpusAudioConfig(v,E){const w=Ms.Qc(this.sdp);for(const M of w.media)if(M.type==="audio"){const{payload:k}=M.rtp.find(j=>j.codec==="opus");if(!k)continue;let P=M.fmtp.find(j=>j.payload===k);P||(P={payload:k,config:""});const q=Ms.rz(P.config);if(q.maxaveragebitrate=v,typeof E=="boolean"){const j=E?1:0;q["sprop-stereo"]=j,q.stereo=j}let Z="";for(const j of Object.keys(q))Z+=`${j}=${q[j]}; `;P.config=Z.trim()}return new vi(Ms.cW(w))}static getRtpHeaderExtensionIdInSection(v,E){const w=vi.splitLines(v);for(const M of w)if(/^a=extmap:/.test(M.trim())){const k=M.split("a=extmap:")[1].split(" "),P=+k[0];if(k[1]===E)return P}return-1}getRtpHeaderExtensionId(v){const E=vi.splitSections(this.sdp);for(const w of E)if(/^m=video/.test(w)){const M=vi.getRtpHeaderExtensionIdInSection(w,v);if(M!==-1)return M}return-1}hasRtpHeaderExtensionId(v){const E=vi.splitLines(this.sdp);for(const w of E)if(/^a=extmap:/.test(w.trim())&&+w.split("a=extmap:")[1].split(" ")[0]===v)return!0;return!1}hasAudioNacksEnabled(){var v,E,w;return((w=(E=((v=Ms.Qc(this.sdp).media.filter(M=>M.type==="audio")[0])!==null&&v!==void 0?v:{}).rtcpFb)===null||E===void 0?void 0:E.filter(M=>M.type==="nack"))!==null&&w!==void 0?w:[]).length>0}}vi.CRLF=`\r
`,vi.rfc7587LowestBitrate=6e3,vi.rfc7587HighestBitrate=51e4;const wd=200,Th=2500,jm=10,vl=30,lp=12,ho=128,Hm={[es.DEFAULT]:0,[es.LOW]:50,[es.MEDIUM]:150,[es.HIGH]:250},Cd={[es.DEFAULT]:0,[es.LOW]:100,[es.MEDIUM]:200,[es.HIGH]:300},Rd=()=>({minBitrate:wd,maxBitrate:Th,maxFramerate:vl,simulcast:{enabled:!1},maxAudioBitrateKbps:64,stereo:!1});var Ad=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};const up="H264",hp=x=>{const v=x==null?void 0:x.split("/");if((v==null?void 0:v.length)===2)return v[1]},Ko=(x,v)=>{const E=hp(x);if(x===void 0||E===void 0)return;const w={mimeSubtype:E};if(v){const M=(k=>{const P=k.split(";"),q=new Map;for(const Z of P){const[j,ee]=Z.split("=");q.set(j,ee)}return q})(v);switch(E){case up:{const k=M.get("profile-level-id");k&&((P,q)=>{if(q.length<6)return;const Z=q.substring(0,4),j=parseInt(q.substring(4,6),16);P.profile=Z,P.level=j})(w,k);break}case"H265":((k,P)=>{const q=P.get("profile-id")||"0",Z=P.get("tier-flag")||"0",j=parseInt(P.get("level-id")||"0",10),ee=[Z,q].join("_");k.profile=ee,k.level=j})(w,M)}}return w},Js=(x,v)=>x.sort((E,w)=>{if(hp(E.mimeType)===up){const M=Ko(E.mimeType,E.sdpFmtpLine);if((M==null?void 0:M.profile)===v)return-1}return 0}),l0=(x,v)=>{var E;const w=Ko(x.mimeType,x.sdpFmtpLine);return(w==null?void 0:w.mimeSubtype.toLowerCase())===v.mime.toLowerCase()&&((E=w==null?void 0:w.profile)===null||E===void 0?void 0:E.toLowerCase().indexOf(v.config.toLowerCase()))===0},Gm=(x,v)=>v.filter(E=>!E.mimeType.endsWith("rtx")).filter(E=>E.mimeType.indexOf("packetization-mode=0")===-1).find(E=>x.reduce((w,M)=>w&&l0(E,M)===!1,!0));class ba extends ar{constructor(v,E,w,M,k,P,q,Z,j){var ee,se;super(an.PUBLISHED_VIDEO_STATS,v,E,!1),Object.assign(this.properties,Object.assign({action:kt.PUBLISH,node:(ee=w==null?void 0:w.node)!==null&&ee!==void 0?ee:"",cluster:(se=w==null?void 0:w.cluster)!==null&&se!==void 0?se:""},((ae,ve,Le,Te,ge,he)=>{var $e,yt,Bt,_t,Pn,Mn,Er,Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui,Fi,os,Ki,Yi,Bi,Ti,Ji,ks,zi,ta,Lo;const Qa=(yt=($e=ae==null?void 0:ae.qualityLimitationDurations)===null||$e===void 0?void 0:$e.cpu)!==null&&yt!==void 0?yt:0,Za=(_t=(Bt=ae==null?void 0:ae.qualityLimitationDurations)===null||Bt===void 0?void 0:Bt.bandwidth)!==null&&_t!==void 0?_t:0,na=Math.max((Pn=ae==null?void 0:ae.bytesSent)!==null&&Pn!==void 0?Pn:0,0),Bc=8*na/(he??1),wa=Math.max((Mn=ve==null?void 0:ve.packetsLost)!==null&&Mn!==void 0?Mn:0,0),dc=Math.max((Er=ae==null?void 0:ae.packetsSent)!==null&&Er!==void 0?Er:0,0),zc=wa/Math.max(dc,1),Ca=Ko(Te==null?void 0:Te.mimeType,Te==null?void 0:Te.sdpFmtpLine);return{active:!!(ae!=null&&ae.framesPerSecond)&&ae.framesPerSecond!==0,bytes_sent:na,codec_mime_type:Ca==null?void 0:Ca.mimeSubtype,codec_profile:Ca==null?void 0:Ca.profile,codec_level:Ca==null?void 0:Ca.level,configured_bitrate:ge==null?void 0:ge.max_bitrate,connection_bandwidth:(Cr=Le==null?void 0:Le.availableOutgoingBitrate)!==null&&Cr!==void 0?Cr:0,encode_bitrate:Bc,encoder_implementation:(Rr=ae==null?void 0:ae.encoderImplementation)!==null&&Rr!==void 0?Rr:"unknown",fir_count:(Ar=ae==null?void 0:ae.firCount)!==null&&Ar!==void 0?Ar:0,fraction_packets_lost:zc,frame_height:Math.max((cr=ae==null?void 0:ae.frameHeight)!==null&&cr!==void 0?cr:0,0),frame_width:Math.max((br=ae==null?void 0:ae.frameWidth)!==null&&br!==void 0?br:0,0),frames_encoded:(Tr=ae==null?void 0:ae.framesEncoded)!==null&&Tr!==void 0?Tr:0,frames_per_second:Math.max((xr=ae==null?void 0:ae.framesPerSecond)!==null&&xr!==void 0?xr:0,0),frames_sent:(Mr=ae==null?void 0:ae.framesSent)!==null&&Mr!==void 0?Mr:0,header_bytes_sent:(qn=ae==null?void 0:ae.headerBytesSent)!==null&&qn!==void 0?qn:0,huge_frames_sent:(pn=ae==null?void 0:ae.hugeFramesSent)!==null&&pn!==void 0?pn:0,key_frames_encoded:(Bn=ae==null?void 0:ae.keyFramesEncoded)!==null&&Bn!==void 0?Bn:0,nack_count:(oi=ae==null?void 0:ae.nackCount)!==null&&oi!==void 0?oi:0,packets_lost:wa,packets_sent:dc,power_efficient_encoder:(Ui=ae==null?void 0:ae.powerEfficientEncoder)!==null&&Ui!==void 0&&Ui,pli_count:(Fi=ae==null?void 0:ae.pliCount)!==null&&Fi!==void 0?Fi:0,quality_limitation_reason:(os=ae==null?void 0:ae.qualityLimitationReason)!==null&&os!==void 0?os:"none",quality_limitation_resolution_changes:(Ki=ae==null?void 0:ae.qualityLimitationResolutionChanges)!==null&&Ki!==void 0?Ki:0,quality_limitation_cpu_duration:Qa,quality_limitation_bandwidth_duration:Za,retransmitted_bytes_sent:(Yi=ae==null?void 0:ae.retransmittedBytesSent)!==null&&Yi!==void 0?Yi:0,retransmitted_packets_sent:(Bi=ae==null?void 0:ae.retransmittedPacketsSent)!==null&&Bi!==void 0?Bi:0,rid:(Ti=ae==null?void 0:ae.rid)!==null&&Ti!==void 0?Ti:"no-rid",scalability_mode:(Ji=ae==null?void 0:ae.scalabilityMode)!==null&&Ji!==void 0?Ji:"unknown",target_bitrate:Math.max((ks=ae==null?void 0:ae.targetBitrate)!==null&&ks!==void 0?ks:0,0),total_encode_time:(zi=ae==null?void 0:ae.totalEncodeTime)!==null&&zi!==void 0?zi:0,total_encoded_bytes_target:(ta=ae==null?void 0:ae.totalEncodedBytesTarget)!==null&&ta!==void 0?ta:0,total_packet_send_delay:(Lo=ae==null?void 0:ae.totalPacketSendDelay)!==null&&Lo!==void 0?Lo:0}})(M,k,P,q,Z,j)))}}class Mo extends ar{constructor(v,E,w,M,k,P,q,Z,j,ee){var se,ae,ve,Le;super(an.PUBLISHED_VIDEO_STATS_WINDOW,v,E,!1);const Te=Math.max(((se=M==null?void 0:M.timestamp)!==null&&se!==void 0?se:0)-((ae=k==null?void 0:k.timestamp)!==null&&ae!==void 0?ae:0),0);Object.assign(this.properties,Object.assign({action:kt.PUBLISH,node:(ve=w==null?void 0:w.node)!==null&&ve!==void 0?ve:"",cluster:(Le=w==null?void 0:w.cluster)!==null&&Le!==void 0?Le:"",window_size_ms:Te},((ge,he,$e,yt,Bt,_t,Pn,Mn)=>{var Er,Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui,Fi,os,Ki,Yi,Bi,Ti,Ji,ks,zi,ta,Lo,Qa,Za,na,Bc,wa,dc,zc,Ca,Tl,Uh,ou,Ss,au,Vu,ju,cu,xl,Hu,Gu,ig,Mp,sg,og,Ip,kp,S0,E0;const b0=(Cr=(Er=ge==null?void 0:ge.qualityLimitationDurations)===null||Er===void 0?void 0:Er.cpu)!==null&&Cr!==void 0?Cr:0,J_=(Ar=(Rr=he==null?void 0:he.qualityLimitationDurations)===null||Rr===void 0?void 0:Rr.cpu)!==null&&Ar!==void 0?Ar:0,T0=(br=(cr=ge==null?void 0:ge.qualityLimitationDurations)===null||cr===void 0?void 0:cr.bandwidth)!==null&&br!==void 0?br:0,Wd=(xr=(Tr=he==null?void 0:he.qualityLimitationDurations)===null||Tr===void 0?void 0:Tr.bandwidth)!==null&&xr!==void 0?xr:0,Q_=Math.max(((Mr=ge==null?void 0:ge.bytesSent)!==null&&Mr!==void 0?Mr:0)-((qn=he==null?void 0:he.bytesSent)!==null&&qn!==void 0?qn:0),0),Z_=8*Q_/(typeof Mn!="number"?1:Mn/1e3),m=Math.max(((pn=$e==null?void 0:$e.packetsLost)!==null&&pn!==void 0?pn:0)-((Bn=yt==null?void 0:yt.packetsLost)!==null&&Bn!==void 0?Bn:0),0),b=Math.max(((oi=ge==null?void 0:ge.packetsSent)!==null&&oi!==void 0?oi:0)-((Ui=he==null?void 0:he.packetsSent)!==null&&Ui!==void 0?Ui:0),0),O=m/Math.max(b,1),H=Ko(_t==null?void 0:_t.mimeType,_t==null?void 0:_t.sdpFmtpLine);return{active:!!(ge!=null&&ge.framesPerSecond)&&(ge==null?void 0:ge.framesPerSecond)!==0,bytes_sent:Q_,codec_mime_type:H==null?void 0:H.mimeSubtype,codec_profile:H==null?void 0:H.profile,codec_level:H==null?void 0:H.level,configured_bitrate:Pn==null?void 0:Pn.max_bitrate,connection_bandwidth:(Fi=Bt==null?void 0:Bt.availableOutgoingBitrate)!==null&&Fi!==void 0?Fi:0,encode_bitrate:Z_,encoder_implementation:(os=ge==null?void 0:ge.encoderImplementation)!==null&&os!==void 0?os:"unknown",fir_count:Math.max(((Ki=ge==null?void 0:ge.firCount)!==null&&Ki!==void 0?Ki:0)-((Yi=he==null?void 0:he.firCount)!==null&&Yi!==void 0?Yi:0),0),fraction_packets_lost:O,frame_height:Math.max((Bi=ge==null?void 0:ge.frameHeight)!==null&&Bi!==void 0?Bi:0,0),frame_width:Math.max((Ti=ge==null?void 0:ge.frameWidth)!==null&&Ti!==void 0?Ti:0,0),frames_encoded:Math.max(((Ji=ge==null?void 0:ge.framesEncoded)!==null&&Ji!==void 0?Ji:0)-((ks=he==null?void 0:he.framesEncoded)!==null&&ks!==void 0?ks:0),0),frames_per_second:Math.max((zi=ge==null?void 0:ge.framesPerSecond)!==null&&zi!==void 0?zi:0,0),frames_sent:Math.max(((ta=ge==null?void 0:ge.framesSent)!==null&&ta!==void 0?ta:0)-((Lo=he==null?void 0:he.framesSent)!==null&&Lo!==void 0?Lo:0),0),header_bytes_sent:Math.max(((Qa=ge==null?void 0:ge.headerBytesSent)!==null&&Qa!==void 0?Qa:0)-((Za=he==null?void 0:he.headerBytesSent)!==null&&Za!==void 0?Za:0),0),huge_frames_sent:Math.max(((na=ge==null?void 0:ge.hugeFramesSent)!==null&&na!==void 0?na:0)-((Bc=he==null?void 0:he.hugeFramesSent)!==null&&Bc!==void 0?Bc:0),0),key_frames_encoded:Math.max(((wa=ge==null?void 0:ge.keyFramesEncoded)!==null&&wa!==void 0?wa:0)-((dc=he==null?void 0:he.keyFramesEncoded)!==null&&dc!==void 0?dc:0),0),nack_count:Math.max(((zc=ge==null?void 0:ge.nackCount)!==null&&zc!==void 0?zc:0)-((Ca=he==null?void 0:he.nackCount)!==null&&Ca!==void 0?Ca:0),0),packets_lost:m,packets_sent:b,power_efficient_encoder:(Tl=ge==null?void 0:ge.powerEfficientEncoder)!==null&&Tl!==void 0&&Tl,pli_count:Math.max(((Uh=ge==null?void 0:ge.pliCount)!==null&&Uh!==void 0?Uh:0)-((ou=he==null?void 0:he.pliCount)!==null&&ou!==void 0?ou:0),0),quality_limitation_reason:(Ss=ge==null?void 0:ge.qualityLimitationReason)!==null&&Ss!==void 0?Ss:"none",quality_limitation_resolution_changes:Math.max(((au=ge==null?void 0:ge.qualityLimitationResolutionChanges)!==null&&au!==void 0?au:0)-((Vu=he==null?void 0:he.qualityLimitationResolutionChanges)!==null&&Vu!==void 0?Vu:0),0),quality_limitation_cpu_duration:Math.max(b0-J_,0),quality_limitation_bandwidth_duration:Math.max(T0-Wd,0),retransmitted_bytes_sent:Math.max(((ju=ge==null?void 0:ge.retransmittedBytesSent)!==null&&ju!==void 0?ju:0)-((cu=he==null?void 0:he.retransmittedBytesSent)!==null&&cu!==void 0?cu:0),0),rid:(xl=ge==null?void 0:ge.rid)!==null&&xl!==void 0?xl:"no-rid",retransmitted_packets_sent:Math.max(((Hu=ge==null?void 0:ge.retransmittedPacketsSent)!==null&&Hu!==void 0?Hu:0)-((Gu=he==null?void 0:he.retransmittedPacketsSent)!==null&&Gu!==void 0?Gu:0),0),scalability_mode:(ig=ge==null?void 0:ge.scalabilityMode)!==null&&ig!==void 0?ig:"unknown",target_bitrate:Math.max((Mp=ge==null?void 0:ge.targetBitrate)!==null&&Mp!==void 0?Mp:0,0),total_encode_time:Math.max(((sg=ge==null?void 0:ge.totalEncodeTime)!==null&&sg!==void 0?sg:0)-((og=he==null?void 0:he.totalEncodeTime)!==null&&og!==void 0?og:0),0),total_encoded_bytes_target:Math.max(((Ip=ge==null?void 0:ge.totalEncodedBytesTarget)!==null&&Ip!==void 0?Ip:0)-((kp=he==null?void 0:he.totalEncodedBytesTarget)!==null&&kp!==void 0?kp:0),0),total_packet_send_delay:Math.max(((S0=ge==null?void 0:ge.totalPacketSendDelay)!==null&&S0!==void 0?S0:0)-((E0=he==null?void 0:he.totalPacketSendDelay)!==null&&E0!==void 0?E0:0),0)}})(M,k,P,q,Z,j,ee,Te)))}}class u0 extends ar{constructor(v,E,w,M,k,P,q,Z,j,ee){var se,ae;super(an.PUBLISHED_AUDIO_STATS,v,E,!1),Object.assign(this.properties,Object.assign({action:kt.PUBLISH,node:(se=w==null?void 0:w.node)!==null&&se!==void 0?se:"",cluster:(ae=w==null?void 0:w.cluster)!==null&&ae!==void 0?ae:""},((ve,Le,Te,ge,he,$e,yt)=>{var Bt,_t,Pn,Mn,Er,Cr,Rr,Ar,cr,br,Tr;const xr=Math.max((Bt=ve==null?void 0:ve.bytesSent)!==null&&Bt!==void 0?Bt:0,0),Mr=8*xr/($e??1),qn=Math.max((_t=Le==null?void 0:Le.packetsLost)!==null&&_t!==void 0?_t:0,0),pn=Math.max((Pn=ve==null?void 0:ve.packetsSent)!==null&&Pn!==void 0?Pn:0,0),Bn=qn/Math.max(pn,1),oi=Ko(ge==null?void 0:ge.mimeType,ge==null?void 0:ge.sdpFmtpLine);return{audio_nacks_enabled:(Mn=yt==null?void 0:yt.audioNacks)!==null&&Mn!==void 0&&Mn,bytes_sent:xr,codec_mime_type:oi==null?void 0:oi.mimeSubtype,configured_bitrate:(Er=he==null?void 0:he.max_audio_bitrate_bps)!==null&&Er!==void 0?Er:0,connection_bandwidth:(Cr=Te==null?void 0:Te.availableOutgoingBitrate)!==null&&Cr!==void 0?Cr:0,encode_bitrate:Mr,fraction_packets_lost:Bn,header_bytes_sent:(Rr=ve==null?void 0:ve.headerBytesSent)!==null&&Rr!==void 0?Rr:0,nack_count:(Ar=ve==null?void 0:ve.nackCount)!==null&&Ar!==void 0?Ar:0,packets_lost:qn,packets_sent:pn,retransmitted_bytes_sent:(cr=ve==null?void 0:ve.retransmittedBytesSent)!==null&&cr!==void 0?cr:0,retransmitted_packets_sent:(br=ve==null?void 0:ve.retransmittedPacketsSent)!==null&&br!==void 0?br:0,target_bitrate:(Tr=ve==null?void 0:ve.targetBitrate)!==null&&Tr!==void 0?Tr:0}})(M,k,P,q,Z,j,ee)))}}class Wm extends ar{constructor(v,E,w,M,k,P,q,Z,j,ee,se){var ae,ve,Le,Te;super(an.PUBLISHED_AUDIO_STATS_WINDOW,v,E,!1);const ge=Math.max(((ae=M==null?void 0:M.timestamp)!==null&&ae!==void 0?ae:0)-((ve=k==null?void 0:k.timestamp)!==null&&ve!==void 0?ve:0),0);Object.assign(this.properties,Object.assign({action:kt.PUBLISH,node:(Le=w==null?void 0:w.node)!==null&&Le!==void 0?Le:"",cluster:(Te=w==null?void 0:w.cluster)!==null&&Te!==void 0?Te:"",window_size_ms:ge},((he,$e,yt,Bt,_t,Pn,Mn,Er,Cr)=>{var Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui,Fi,os,Ki,Yi,Bi,Ti,Ji,ks;const zi=Math.max(((Rr=he==null?void 0:he.bytesSent)!==null&&Rr!==void 0?Rr:0)-((Ar=$e==null?void 0:$e.bytesSent)!==null&&Ar!==void 0?Ar:0),0),ta=8*zi/(typeof Er!="number"?1:Er/1e3),Lo=Math.max(((cr=yt==null?void 0:yt.packetsLost)!==null&&cr!==void 0?cr:0)-((br=Bt==null?void 0:Bt.packetsLost)!==null&&br!==void 0?br:0),0),Qa=Math.max(((Tr=he==null?void 0:he.packetsSent)!==null&&Tr!==void 0?Tr:0)-((xr=$e==null?void 0:$e.packetsSent)!==null&&xr!==void 0?xr:0),0),Za=Lo/Math.max(Qa,1),na=Ko(Pn==null?void 0:Pn.mimeType,Pn==null?void 0:Pn.sdpFmtpLine);return{audio_nacks_enabled:(Mr=Cr==null?void 0:Cr.audioNacks)!==null&&Mr!==void 0&&Mr,bytes_sent:zi,codec_mime_type:na==null?void 0:na.mimeSubtype,configured_bitrate:(qn=Mn==null?void 0:Mn.max_audio_bitrate_bps)!==null&&qn!==void 0?qn:0,connection_bandwidth:(pn=_t==null?void 0:_t.availableOutgoingBitrate)!==null&&pn!==void 0?pn:0,encode_bitrate:ta,fraction_packets_lost:Za,header_bytes_sent:Math.max(((Bn=he==null?void 0:he.headerBytesSent)!==null&&Bn!==void 0?Bn:0)-((oi=$e==null?void 0:$e.headerBytesSent)!==null&&oi!==void 0?oi:0),0),nack_count:Math.max(((Ui=he==null?void 0:he.nackCount)!==null&&Ui!==void 0?Ui:0)-((Fi=$e==null?void 0:$e.nackCount)!==null&&Fi!==void 0?Fi:0),0),packets_lost:Lo,packets_sent:Math.max(((os=he==null?void 0:he.packetsSent)!==null&&os!==void 0?os:0)-((Ki=$e==null?void 0:$e.packetsSent)!==null&&Ki!==void 0?Ki:0),0),retransmitted_bytes_sent:Math.max(((Yi=he==null?void 0:he.retransmittedBytesSent)!==null&&Yi!==void 0?Yi:0)-((Bi=$e==null?void 0:$e.retransmittedBytesSent)!==null&&Bi!==void 0?Bi:0),0),retransmitted_packets_sent:Math.max(((Ti=he==null?void 0:he.retransmittedPacketsSent)!==null&&Ti!==void 0?Ti:0)-((Ji=$e==null?void 0:$e.retransmittedPacketsSent)!==null&&Ji!==void 0?Ji:0),0),target_bitrate:Math.max((ks=he==null?void 0:he.targetBitrate)!==null&&ks!==void 0?ks:0,0)}})(M,k,P,q,Z,j,ee,ge,se)))}}class h0 extends ar{constructor(v,E,w,M,k,P,q,Z){var j,ee;super(an.SUBSCRIBED_VIDEO_STATS,v,E,!1),Object.assign(this.properties,Object.assign({action:kt.SUBSCRIBE,node:(j=M==null?void 0:M.node)!==null&&j!==void 0?j:"",cluster:(ee=M==null?void 0:M.cluster)!==null&&ee!==void 0?ee:"",remote_participant_id:w},((se,ae,ve,Le)=>{var Te,ge,he,$e,yt,Bt,_t,Pn,Mn,Er,Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui;let Fi=0;se!=null&&se.jitterBufferDelay&&(se!=null&&se.jitterBufferEmittedCount)&&se.jitterBufferEmittedCount>0&&(Fi=se.jitterBufferDelay/se.jitterBufferEmittedCount);const os=Le??1,Ki=Math.max((Te=se==null?void 0:se.bytesReceived)!==null&&Te!==void 0?Te:0,0),Yi=8*Ki/os;let Bi=0;se!=null&&se.totalDecodeTime&&(se!=null&&se.framesDecoded)&&(Bi=se.totalDecodeTime/Math.max(se==null?void 0:se.framesDecoded,1));const Ti=Math.max((ge=se==null?void 0:se.packetsLost)!==null&&ge!==void 0?ge:0,0),Ji=Math.max((he=se==null?void 0:se.packetsReceived)!==null&&he!==void 0?he:0,0),ks=Ti/Math.max(Ji+Ti,1),zi=Ko(ve==null?void 0:ve.mimeType,ve==null?void 0:ve.sdpFmtpLine);return{bytes_received:Ki,codec_mime_type:zi==null?void 0:zi.mimeSubtype,codec_profile:zi==null?void 0:zi.profile,codec_level:zi==null?void 0:zi.level,connection_bandwidth:($e=ae==null?void 0:ae.availableIncomingBitrate)!==null&&$e!==void 0?$e:0,decode_bitrate:Yi,decoder_implementation:(yt=se==null?void 0:se.decoderImplementation)!==null&&yt!==void 0?yt:"unknown",fir_count:Math.max((Bt=se==null?void 0:se.firCount)!==null&&Bt!==void 0?Bt:0,0),fraction_packets_lost:ks,frame_decode_time_avg:Bi,frame_height:Math.max((_t=se==null?void 0:se.frameHeight)!==null&&_t!==void 0?_t:0,0),frame_width:Math.max((Pn=se==null?void 0:se.frameWidth)!==null&&Pn!==void 0?Pn:0,0),frames_decoded:Math.max((Mn=se==null?void 0:se.framesDecoded)!==null&&Mn!==void 0?Mn:0,0),frames_dropped:Math.max((Er=se==null?void 0:se.framesDropped)!==null&&Er!==void 0?Er:0,0),frames_received:Math.max((Cr=se==null?void 0:se.framesReceived)!==null&&Cr!==void 0?Cr:0,0),freeze_count:Math.max((Rr=se==null?void 0:se.freezeCount)!==null&&Rr!==void 0?Rr:0,0),frames_rendered:Math.max((Ar=se==null?void 0:se.framesRendered)!==null&&Ar!==void 0?Ar:0,0),frames_per_second:Math.max((cr=se==null?void 0:se.framesPerSecond)!==null&&cr!==void 0?cr:0,0),header_bytes_received:Math.max((br=se==null?void 0:se.headerBytesReceived)!==null&&br!==void 0?br:0,0),jitter_buffer_delay_avg:Fi,key_frames_decoded:Math.max((Tr=se==null?void 0:se.keyFramesDecoded)!==null&&Tr!==void 0?Tr:0,0),nack_count:Math.max((xr=se==null?void 0:se.nackCount)!==null&&xr!==void 0?xr:0,0),packets_discarded:Math.max((Mr=se==null?void 0:se.packetsDiscarded)!==null&&Mr!==void 0?Mr:0,0),packets_lost:Ti,packets_received:Ji,pause_count:Math.max((qn=se==null?void 0:se.pauseCount)!==null&&qn!==void 0?qn:0,0),pli_count:Math.max((pn=se==null?void 0:se.pliCount)!==null&&pn!==void 0?pn:0,0),power_efficient_decoder:(Bn=se==null?void 0:se.powerEfficientDecoder)!==null&&Bn!==void 0&&Bn,total_freezes_duration:Math.max((oi=se==null?void 0:se.totalFreezesDuration)!==null&&oi!==void 0?oi:0,0),total_pauses_duration:Math.max((Ui=se==null?void 0:se.totalPausesDuration)!==null&&Ui!==void 0?Ui:0,0)}})(k,P,q,Z)))}}class $m extends ar{constructor(v,E,w,M,k,P,q,Z,j,ee,se){var ae,ve,Le,Te;super(an.SUBSCRIBED_VIDEO_STATS_WINDOW,v,E,!1);const ge=Math.max(((ae=k==null?void 0:k.timestamp)!==null&&ae!==void 0?ae:0)-((ve=P==null?void 0:P.timestamp)!==null&&ve!==void 0?ve:0),0);Object.assign(this.properties,Object.assign({action:kt.SUBSCRIBE,node:(Le=M==null?void 0:M.node)!==null&&Le!==void 0?Le:"",cluster:(Te=M==null?void 0:M.cluster)!==null&&Te!==void 0?Te:"",window_size_ms:ge,remote_participant_id:w},((he,$e,yt,Bt,_t,Pn,Mn,Er)=>{var Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui,Fi,os,Ki,Yi,Bi,Ti,Ji,ks,zi,ta,Lo,Qa,Za,na,Bc,wa,dc,zc,Ca,Tl,Uh,ou,Ss,au,Vu,ju,cu,xl,Hu,Gu;let ig=0,Mp=0;if(he!=null&&he.jitterBufferEmittedCount&&($e!=null&&$e.jitterBufferEmittedCount)&&he.jitterBufferEmittedCount>$e.jitterBufferEmittedCount){he!=null&&he.jitterBufferDelay&&($e!=null&&$e.jitterBufferDelay)&&(ig=(he.jitterBufferDelay-$e.jitterBufferDelay)/(he.jitterBufferEmittedCount-$e.jitterBufferEmittedCount));const Z_=$e==null?void 0:$e.jitterBufferMinimumDelay,m=he==null?void 0:he.jitterBufferMinimumDelay;Z_&&m&&(Mp=(m-Z_)/(he.jitterBufferEmittedCount-$e.jitterBufferEmittedCount))}const sg=Math.max(((Cr=he==null?void 0:he.bytesReceived)!==null&&Cr!==void 0?Cr:0)-((Rr=$e==null?void 0:$e.bytesReceived)!==null&&Rr!==void 0?Rr:0),0),og=typeof _t!="number"?1:_t/1e3,Ip=8*sg/og,kp=Math.max(((Ar=he==null?void 0:he.totalDecodeTime)!==null&&Ar!==void 0?Ar:0)-((cr=$e==null?void 0:$e.totalDecodeTime)!==null&&cr!==void 0?cr:0),0),S0=Math.max(((br=he==null?void 0:he.framesDecoded)!==null&&br!==void 0?br:0)-((Tr=$e==null?void 0:$e.framesDecoded)!==null&&Tr!==void 0?Tr:0),0),E0=kp/Math.max(S0,1),b0=Math.max(((xr=he==null?void 0:he.packetsLost)!==null&&xr!==void 0?xr:0)-((Mr=$e==null?void 0:$e.packetsLost)!==null&&Mr!==void 0?Mr:0),0),J_=Math.max(((qn=he==null?void 0:he.packetsReceived)!==null&&qn!==void 0?qn:0)-((pn=$e==null?void 0:$e.packetsReceived)!==null&&pn!==void 0?pn:0),0),T0=b0/Math.max(J_+b0,1),Wd=Ko(Bt==null?void 0:Bt.mimeType,Bt==null?void 0:Bt.sdpFmtpLine),Q_=8*(Er||0)/og;return{bytes_received:sg,codec_mime_type:Wd==null?void 0:Wd.mimeSubtype,codec_profile:Wd==null?void 0:Wd.profile,codec_level:Wd==null?void 0:Wd.level,connection_bandwidth:(Bn=yt==null?void 0:yt.availableIncomingBitrate)!==null&&Bn!==void 0?Bn:0,decode_bitrate:Ip,decoder_implementation:(oi=he==null?void 0:he.decoderImplementation)!==null&&oi!==void 0?oi:"unknown",fir_count:Math.max(((Ui=he==null?void 0:he.firCount)!==null&&Ui!==void 0?Ui:0)-((Fi=$e==null?void 0:$e.firCount)!==null&&Fi!==void 0?Fi:0),0),fraction_packets_lost:T0,frame_decode_time_avg:E0,frame_height:Math.max((os=he==null?void 0:he.frameHeight)!==null&&os!==void 0?os:0,0),frame_width:Math.max((Ki=he==null?void 0:he.frameWidth)!==null&&Ki!==void 0?Ki:0,0),frames_decoded:Math.max(((Yi=he==null?void 0:he.framesDecoded)!==null&&Yi!==void 0?Yi:0)-((Bi=$e==null?void 0:$e.framesDecoded)!==null&&Bi!==void 0?Bi:0),0),frames_dropped:Math.max(((Ti=he==null?void 0:he.framesDropped)!==null&&Ti!==void 0?Ti:0)-((Ji=$e==null?void 0:$e.framesDropped)!==null&&Ji!==void 0?Ji:0),0),frames_received:Math.max(((ks=he==null?void 0:he.framesReceived)!==null&&ks!==void 0?ks:0)-((zi=$e==null?void 0:$e.framesReceived)!==null&&zi!==void 0?zi:0),0),freeze_count:Math.max(((ta=he==null?void 0:he.freezeCount)!==null&&ta!==void 0?ta:0)-((Lo=$e==null?void 0:$e.freezeCount)!==null&&Lo!==void 0?Lo:0),0),frames_rendered:Math.max((Qa=he==null?void 0:he.framesRendered)!==null&&Qa!==void 0?Qa:0,0),frames_per_second:Math.max((Za=he==null?void 0:he.framesPerSecond)!==null&&Za!==void 0?Za:0,0),header_bytes_received:Math.max(((na=he==null?void 0:he.headerBytesReceived)!==null&&na!==void 0?na:0)-((Bc=$e==null?void 0:$e.headerBytesReceived)!==null&&Bc!==void 0?Bc:0),0),configured_jitter_buffer_min_delay_ms:Pn??0,jitter_buffer_min_obtainable_delay:Mp,jitter_buffer_delay_avg:ig,key_frames_decoded:Math.max(((wa=he==null?void 0:he.keyFramesDecoded)!==null&&wa!==void 0?wa:0)-((dc=$e==null?void 0:$e.keyFramesDecoded)!==null&&dc!==void 0?dc:0),0),nack_count:Math.max(((zc=he==null?void 0:he.nackCount)!==null&&zc!==void 0?zc:0)-((Ca=$e==null?void 0:$e.nackCount)!==null&&Ca!==void 0?Ca:0),0),packets_discarded:Math.max(((Tl=he==null?void 0:he.packetsDiscarded)!==null&&Tl!==void 0?Tl:0)-((Uh=$e==null?void 0:$e.packetsDiscarded)!==null&&Uh!==void 0?Uh:0),0),packets_lost:b0,packets_received:J_,pause_count:Math.max(((ou=he==null?void 0:he.pauseCount)!==null&&ou!==void 0?ou:0)-((Ss=$e==null?void 0:$e.pauseCount)!==null&&Ss!==void 0?Ss:0),0),pli_count:Math.max(((au=he==null?void 0:he.pliCount)!==null&&au!==void 0?au:0)-((Vu=$e==null?void 0:$e.pliCount)!==null&&Vu!==void 0?Vu:0),0),power_efficient_decoder:(ju=he==null?void 0:he.powerEfficientDecoder)!==null&&ju!==void 0&&ju,total_freezes_duration:Math.max(((cu=he==null?void 0:he.totalFreezesDuration)!==null&&cu!==void 0?cu:0)-((xl=$e==null?void 0:$e.totalFreezesDuration)!==null&&xl!==void 0?xl:0),0),total_pauses_duration:Math.max(((Hu=he==null?void 0:he.totalPausesDuration)!==null&&Hu!==void 0?Hu:0)-((Gu=$e==null?void 0:$e.totalPausesDuration)!==null&&Gu!==void 0?Gu:0),0),sei_read_count:Mn,sei_bytes_received:Er,sei_bitrate:Q_}})(k,P,q,Z,ge,j,ee,se)))}}class qm extends ar{constructor(v,E,w,M,k,P,q,Z,j){var ee,se;super(an.SUBSCRIBED_AUDIO_STATS,v,E,!1),Object.assign(this.properties,Object.assign({action:kt.SUBSCRIBE,node:(ee=M==null?void 0:M.node)!==null&&ee!==void 0?ee:"",cluster:(se=M==null?void 0:M.cluster)!==null&&se!==void 0?se:"",remote_participant_id:w},((ae,ve,Le,Te,ge)=>{var he,$e,yt,Bt,_t,Pn,Mn,Er,Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn;let pn=0;ae!=null&&ae.jitterBufferDelay&&(ae!=null&&ae.jitterBufferEmittedCount)&&ae.jitterBufferEmittedCount>0&&(pn=ae.jitterBufferDelay/ae.jitterBufferEmittedCount);const Bn=Te??1,oi=Math.max((he=ae==null?void 0:ae.bytesReceived)!==null&&he!==void 0?he:0,0),Ui=8*oi/Bn,Fi=Math.max(($e=ae==null?void 0:ae.packetsLost)!==null&&$e!==void 0?$e:0,0),os=Math.max((yt=ae==null?void 0:ae.packetsReceived)!==null&&yt!==void 0?yt:0,0),Ki=Fi/Math.max(os+Fi,1),Yi=Math.max((Bt=ae==null?void 0:ae.concealedSamples)!==null&&Bt!==void 0?Bt:0,0),Bi=Math.max((_t=ae==null?void 0:ae.totalSamplesReceived)!==null&&_t!==void 0?_t:0,0),Ti=Yi/Math.max(Bi,1),Ji=Ko(Le==null?void 0:Le.mimeType,Le==null?void 0:Le.sdpFmtpLine);return{audio_level:(Pn=ae==null?void 0:ae.audioLevel)!==null&&Pn!==void 0?Pn:0,audio_nacks_enabled:(Mn=ge==null?void 0:ge.audioNacks)!==null&&Mn!==void 0&&Mn,bytes_received:oi,codec_mime_type:Ji==null?void 0:Ji.mimeSubtype,connection_bandwidth:(Er=ve==null?void 0:ve.availableIncomingBitrate)!==null&&Er!==void 0?Er:0,concealed_samples:Yi,concealment_events:Math.max((Cr=ae==null?void 0:ae.concealmentEvents)!==null&&Cr!==void 0?Cr:0,0),silent_concealed_samples:Math.max((Rr=ae==null?void 0:ae.silentConcealedSamples)!==null&&Rr!==void 0?Rr:0,0),decode_bitrate:Ui,fraction_audio_concealed:Ti,fraction_packets_lost:Ki,header_bytes_received:Math.max((Ar=ae==null?void 0:ae.headerBytesReceived)!==null&&Ar!==void 0?Ar:0,0),inserted_samples_for_deceleration:Math.max((cr=ae==null?void 0:ae.insertedSamplesForDeceleration)!==null&&cr!==void 0?cr:0,0),jitter_buffer_delay_avg:pn,packets_discarded:Math.max((br=ae==null?void 0:ae.packetsDiscarded)!==null&&br!==void 0?br:0,0),retransmitted_packets_received:Math.max((Tr=ae==null?void 0:ae.retransmittedPacketsReceived)!==null&&Tr!==void 0?Tr:0,0),retransmitted_bytes_received:Math.max((xr=ae==null?void 0:ae.retransmittedBytesReceived)!==null&&xr!==void 0?xr:0,0),packets_lost:Fi,packets_received:os,nack_count:Math.max((Mr=ae==null?void 0:ae.nackCount)!==null&&Mr!==void 0?Mr:0,0),removed_samples_for_acceleration:Math.max((qn=ae==null?void 0:ae.removedSamplesForAcceleration)!==null&&qn!==void 0?qn:0,0),total_samples_received:Bi}})(k,P,q,Z,j)))}}class mr extends ar{constructor(v,E,w,M,k,P,q,Z,j,ee){var se,ae,ve,Le;super(an.SUBSCRIBED_AUDIO_STATS_WINDOW,v,E,!1);const Te=Math.max(((se=k==null?void 0:k.timestamp)!==null&&se!==void 0?se:0)-((ae=P==null?void 0:P.timestamp)!==null&&ae!==void 0?ae:0),0);Object.assign(this.properties,Object.assign({action:kt.SUBSCRIBE,window_size_ms:Te,node:(ve=M==null?void 0:M.node)!==null&&ve!==void 0?ve:"",cluster:(Le=M==null?void 0:M.cluster)!==null&&Le!==void 0?Le:"",remote_participant_id:w},((ge,he,$e,yt,Bt,_t,Pn)=>{var Mn,Er,Cr,Rr,Ar,cr,br,Tr,xr,Mr,qn,pn,Bn,oi,Ui,Fi,os,Ki,Yi,Bi,Ti,Ji,ks,zi,ta,Lo,Qa,Za,na,Bc,wa;let dc=0,zc=0;if(ge!=null&&ge.jitterBufferEmittedCount&&(he!=null&&he.jitterBufferEmittedCount)&&ge.jitterBufferEmittedCount>he.jitterBufferEmittedCount){ge!=null&&ge.jitterBufferDelay&&(he!=null&&he.jitterBufferDelay)&&(dc=(ge.jitterBufferDelay-he.jitterBufferDelay)/(ge.jitterBufferEmittedCount-he.jitterBufferEmittedCount));const Hu=he==null?void 0:he.jitterBufferMinimumDelay,Gu=ge==null?void 0:ge.jitterBufferMinimumDelay;Hu&&Gu&&(zc=(Gu-Hu)/(ge.jitterBufferEmittedCount-he.jitterBufferEmittedCount))}const Ca=typeof Bt!="number"?1:Bt/1e3,Tl=Math.max(((Mn=ge==null?void 0:ge.bytesReceived)!==null&&Mn!==void 0?Mn:0)-((Er=he==null?void 0:he.bytesReceived)!==null&&Er!==void 0?Er:0),0),Uh=8*Tl/Ca,ou=Math.max(((Cr=ge==null?void 0:ge.packetsLost)!==null&&Cr!==void 0?Cr:0)-((Rr=he==null?void 0:he.packetsLost)!==null&&Rr!==void 0?Rr:0),0),Ss=Math.max(((Ar=ge==null?void 0:ge.packetsReceived)!==null&&Ar!==void 0?Ar:0)-((cr=he==null?void 0:he.packetsReceived)!==null&&cr!==void 0?cr:0),0),au=ou/Math.max(Ss+ou,1),Vu=Math.max(((br=ge==null?void 0:ge.concealedSamples)!==null&&br!==void 0?br:0)-((Tr=he==null?void 0:he.concealedSamples)!==null&&Tr!==void 0?Tr:0),0),ju=Math.max(((xr=ge==null?void 0:ge.totalSamplesReceived)!==null&&xr!==void 0?xr:0)-((Mr=he==null?void 0:he.totalSamplesReceived)!==null&&Mr!==void 0?Mr:0),0),cu=Vu/Math.max(ju,1),xl=Ko(yt==null?void 0:yt.mimeType,yt==null?void 0:yt.sdpFmtpLine);return{audio_level:(qn=ge==null?void 0:ge.audioLevel)!==null&&qn!==void 0?qn:0,audio_nacks_enabled:(pn=_t==null?void 0:_t.audioNacks)!==null&&pn!==void 0&&pn,bytes_received:Tl,codec_mime_type:xl==null?void 0:xl.mimeSubtype,connection_bandwidth:(Bn=$e==null?void 0:$e.availableIncomingBitrate)!==null&&Bn!==void 0?Bn:0,decode_bitrate:Uh,concealed_samples:Vu,concealment_events:Math.max(((oi=ge==null?void 0:ge.concealmentEvents)!==null&&oi!==void 0?oi:0)-((Ui=he==null?void 0:he.concealmentEvents)!==null&&Ui!==void 0?Ui:0),0),silent_concealed_samples:Math.max(((Fi=ge==null?void 0:ge.silentConcealedSamples)!==null&&Fi!==void 0?Fi:0)-((os=he==null?void 0:he.silentConcealedSamples)!==null&&os!==void 0?os:0),0),fraction_audio_concealed:cu,fraction_packets_lost:au,header_bytes_received:Math.max(((Ki=ge==null?void 0:ge.headerBytesReceived)!==null&&Ki!==void 0?Ki:0)-((Yi=he==null?void 0:he.headerBytesReceived)!==null&&Yi!==void 0?Yi:0),0),inserted_samples_for_deceleration:Math.max(((Bi=ge==null?void 0:ge.insertedSamplesForDeceleration)!==null&&Bi!==void 0?Bi:0)-((Ti=he==null?void 0:he.insertedSamplesForDeceleration)!==null&&Ti!==void 0?Ti:0),0),configured_jitter_buffer_min_delay_ms:Pn??0,jitter_buffer_min_obtainable_delay:zc,jitter_buffer_delay_avg:dc,packets_discarded:Math.max(((Ji=ge==null?void 0:ge.packetsDiscarded)!==null&&Ji!==void 0?Ji:0)-((ks=he==null?void 0:he.packetsDiscarded)!==null&&ks!==void 0?ks:0),0),packets_lost:ou,packets_received:Ss,nack_count:Math.max(((zi=ge==null?void 0:ge.nackCount)!==null&&zi!==void 0?zi:0)-((ta=he==null?void 0:he.nackCount)!==null&&ta!==void 0?ta:0),0),removed_samples_for_acceleration:Math.max(((Lo=ge==null?void 0:ge.removedSamplesForAcceleration)!==null&&Lo!==void 0?Lo:0)-((Qa=he==null?void 0:he.removedSamplesForAcceleration)!==null&&Qa!==void 0?Qa:0),0),retransmitted_packets_received:Math.max(((Za=ge==null?void 0:ge.retransmittedPacketsReceived)!==null&&Za!==void 0?Za:0)-((na=he==null?void 0:he.retransmittedPacketsReceived)!==null&&na!==void 0?na:0),0),retransmitted_bytes_received:Math.max(((Bc=ge==null?void 0:ge.retransmittedBytesReceived)!==null&&Bc!==void 0?Bc:0)-((wa=he==null?void 0:he.retransmittedBytesReceived)!==null&&wa!==void 0?wa:0),0),total_samples_received:ju}})(k,P,q,Z,Te,j,ee)))}}class dp extends ar{constructor(v,E,w,M,k=kt.PUBLISH,P=!1,q=""){super(an.SIMULCAST_LAYER_INFO,v,E,!1),Object.assign(this.properties,{rid:w,active:M,selected:P,source:k===kt.PUBLISH?"publisher":"subscriber",remote_participant_id:q})}}class d0 extends ar{constructor(v,E,w,M){super(an.MULTIHOST_CONFIGURATION,v,E,!1),Object.assign(this.properties,Object.assign(Object.assign({},w),{action:M}))}}class Md extends ar{constructor(v,E,w){super(an.MULTIHOST_SUBSCRIBE_CONFIGURATION,v,E,!1),Object.assign(this.properties,Object.assign({},w))}}var Pu,eu,yl;(function(x){x.Mobile="mobile",x.Tablet="tablet",x.Desktop="desktop",x.Tv="tv"})(Pu||(Pu={})),function(x){x.IOS="iOS",x.MacOS="macOS",x.Windows="Windows",x.Android="Android"}(eu||(eu={})),function(x){x.Safari="Safari",x.Firefox="Firefox",x.Chrome="Chrome",x.IE="Internet Explorer",x.Edge="Microsoft Edge"}(yl||(yl={}));const Io=function(x){const v=Sl(x);return{platform:{isMobile:Du(Pu.Mobile,v),isTablet:Du(Pu.Tablet,v),isDesktop:Du(Pu.Desktop,v),isTv:Du(Pu.Tv,v)},os:{name:fp(v),version:Xm(v),isIOS:Id(eu.IOS,v),isMacOS:Id(eu.MacOS,v),isWindows:Id(eu.Windows,v),isAndroid:Id(eu.Android,v)},browser:{name:tu(v),version:Yo(v),isSafari:Jo(yl.Safari,v),isFirefox:Jo(yl.Firefox,v),isChrome:Jo(yl.Chrome,v),isIE:Jo(yl.IE,v),isEdge:Jo(yl.Edge,v)}}}(window.navigator.userAgent);function Sl(x){try{return ul.getParser(x||window.navigator.userAgent)}catch{}}function Du(x,v){return()=>(v||(v=Sl()),!(!v||v.getPlatformType(!0)!==x.toLowerCase()))}function Xm(x){return()=>(x||(x=Sl()),x&&x.getOSVersion()||"")}function fp(x){return()=>(x||(x=Sl()),x&&x.getOSName()||"")}function Id(x,v){return()=>(v||(v=Sl()),!(!v||v.getOSName(!0)!==x.toLowerCase()))}function Yo(x){return()=>(x||(x=Sl()),x&&x.getBrowserVersion()||"")}function tu(x){return()=>(x||(x=Sl()),x&&x.getBrowserName()||"")}function Jo(x,v){return()=>(v||(v=Sl()),!(!v||v.getBrowserName().toLowerCase()!==x.toLowerCase()))}const W_={active:!1,maxBitrate:2e5,rid:"low",maxFramerate:15,scaleResolutionDownBy:4},Km={width:320,height:180},xh={active:!1,maxBitrate:7e5,rid:"mid",maxFramerate:20,scaleResolutionDownBy:2},nu={width:640,height:360},pp={active:!1,maxBitrate:17e5,rid:"hi",maxFramerate:30,scaleResolutionDownBy:1},jt={width:1280,height:720};function wh(x){const{config:v}=x;return[{maxBitrate:v.maxBitrateBps}]}function Lc(x,v){var E,w;const M=v==null?void 0:v.track,k=v==null?void 0:v.config;if(x&&M){const P=(0,$i.cloneDeep)([{encodingParams:W_,targetResolution:Km},{encodingParams:xh,targetResolution:nu},{encodingParams:pp,targetResolution:jt}]),{height:q,width:Z}=M.getSettings(),j=q&&Z?{width:Z,height:q}:void 0;for(const ae of P){ae.encodingParams.active=!0;let ve=1;j&&(ve=Math.floor(Math.sqrt(j.width*j.height/(ae.targetResolution.width*ae.targetResolution.height))),ve=Math.max(ve,1)),ae.encodingParams.scaleResolutionDownBy=ve}let ee=(E=k==null?void 0:k.maxBitrateBps)!==null&&E!==void 0?E:pp.maxBitrate;const se=(w=k==null?void 0:k.maxFramerate)!==null&&w!==void 0?w:pp.maxFramerate;return ee<xh.maxBitrate&&(ee=pp.maxBitrate),P[2].encodingParams.maxBitrate=ee,P[2].encodingParams.maxFramerate=se,P[2].encodingParams.scaleResolutionDownBy=1,P.map(ae=>ae.encodingParams)}return k?[{maxBitrate:k.maxBitrateBps,maxFramerate:k.maxFramerate}]:[{maxBitrate:fo(Th),maxFramerate:vl}]}const $_=1e3;function fo(x){return x*$_}const ru=(x,...v)=>{const E=v.map(w=>typeof w!="object").filter(Boolean).length>0;if(typeof x=="object"&&!E)return(0,$i.merge)({},x,...v)},Ch=x=>kd(x),kd=x=>(0,$i.cloneDeep)(x),Ym=x=>{switch(x){case Zl.HIGHEST_QUALITY:return"highest";case Zl.LOWEST_QUALITY:default:return"lowest"}};var Od=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};const Rh="no-rid";class Nd{constructor(v,E,w,M,k,P){this.analyticsTracker=k,this.receiveVideoTransformer=P,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new vi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Nd.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case Be.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case Be.FAILED:this.flushStats()}},this.action=v,this.token=E,this.traceId=w,this.identifier=M}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:fo(ho)}}set sdpAnswer(v){try{this.sdp=new vi(v),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(v,E=!1){this.peerConnection=v,this.simulcastEnabled=E,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var v;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(v=this.peerConnection)===null||v===void 0||v.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(v){this.sfuResource=v}updateMultihostConfiguration(v,E){var w,M,k,P,q,Z;return Od(this,void 0,void 0,function*(){if(this.action!==kt.PUBLISH||!this.peerConnection)return;const j=Nd.defaultMultihostConfiguration();if(E){const ee=this.peerConnection.getSenders().filter(ae=>ae.track!==null&&ae.track.kind==="video");ee.length>0&&(yield ee[0].getStats()).forEach(ae=>{ae.type==="codec"&&(j.video_codec=ae.mimeType)});const se=E.track.getSettings();j.width=(w=se.width)!==null&&w!==void 0?w:0,j.height=(M=se.height)!==null&&M!==void 0?M:0,j.target_fps=(k=se.frameRate)!==null&&k!==void 0?k:0,E.config?(j.max_bitrate=E.config.maxBitrateBps,j.min_bitrate=E.config.minBitrateBps,j.enable_simulcast=E.config.simulcastEnabled):(j.max_bitrate=fo(Th),j.min_bitrate=fo(wd),j.enable_simulcast=!1)}if(v){const ee=v.track.getSettings();j.auto_gain=(P=ee.autoGainControl)!==null&&P!==void 0&&P,j.echo_cancellation=(q=ee.echoCancellation)!==null&&q!==void 0&&q,j.noise_suppression=(Z=ee.noiseSuppression)!==null&&Z!==void 0&&Z,j.max_audio_bitrate_bps=v.config.maxBitrateBps,j.stereo=v.config.stereo}(0,$i.isEqual)(j,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new d0(this.token,this.traceId,j,this.action)),this.multihostConfiguration=j)})}updateJitterBufferMinDelay(v){this.jitterBufferMinDelayInMs=v}setupIntervals(){this.action===kt.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(v,E){return setInterval(v.bind(this),E)}getConnectionState(){var v;if(!this.peerConnection)return Be.NONE;const E=(v=this.peerConnection.connectionState)!==null&&v!==void 0?v:this.peerConnection.iceConnectionState;try{return G_(E)}catch{return Be.IDLE}}pollSimulcastLayers(){var v;return Od(this,void 0,void 0,function*(){if(this.getConnectionState()===Be.CONNECTED){const E=yield(v=this.peerConnection)===null||v===void 0?void 0:v.getStats();if(!E)return;E.forEach(w=>{var M;if(w.type==="outbound-rtp"){const k=((M=w.framesPerSecond)!==null&&M!==void 0?M:0)!==0;switch(w.rid){case"low":k!==this.simulcastState.low&&(this.simulcastState.low=k,this.analyticsTracker.trackEventNoSharedProps(new dp(this.token,this.traceId,w.rid,k)));break;case"mid":k!==this.simulcastState.mid&&(this.simulcastState.mid=k,this.analyticsTracker.trackEventNoSharedProps(new dp(this.token,this.traceId,w.rid,k)));break;case"hi":k!==this.simulcastState.hi&&(this.simulcastState.hi=k,this.analyticsTracker.trackEventNoSharedProps(new dp(this.token,this.traceId,w.rid,k)))}}})}})}flushStats(){var v;return Od(this,void 0,void 0,function*(){const E=yield(v=this.peerConnection)===null||v===void 0?void 0:v.getStats();E&&(this.action===kt.PUBLISH?this.uploadPublisherStats(E):this.action===kt.SUBSCRIBE&&this.uploadSubscriberStats(E))})}uploadStats(){var v;return Od(this,void 0,void 0,function*(){if(this.getConnectionState()===Be.CONNECTED){const E=yield(v=this.peerConnection)===null||v===void 0?void 0:v.getStats();if(!E)return;this.action===kt.PUBLISH?this.uploadPublisherStats(E):this.action===kt.SUBSCRIBE&&this.uploadSubscriberStats(E)}})}uploadPublisherStats(v){const E={audio:{},video:[]},w=new Map,M=(Date.now()-this.connectionStartedTimestamp)/1e3,k=Object.assign({},this.multihostConfiguration);v.forEach(P=>{if(P.type==="outbound-rtp"){const q=v.get(P.remoteId),Z=this.prevRemoteInboundStats.get(P.remoteId);switch(q&&this.prevRemoteInboundStats.set(q.id,q),P.kind){case"audio":E.audio=this.updateOutboundAudio(P),E.audio.remoteInbound=q,E.audio.prevRemoteInbound=Z,E.audio.codec=w.get(P.codecId);break;case"video":E.video.push(Object.assign({},this.updateOutboundVideo(P),{remoteInbound:q,prevRemoteInbound:Z,codec:w.get(P.codecId)}))}}P.type==="candidate-pair"&&P.nominated&&(E.candidatePair=P),P.type==="codec"&&w.set(P.id,P)}),this.analyticsTracker.trackEventNoSharedProps(new u0(this.token,this.traceId,this.sfuResource,E.audio.outbound,E.audio.remoteInbound,E.candidatePair,E.audio.codec,k,M,this.sdpFeatures)),E.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Wm(this.token,this.traceId,this.sfuResource,E.audio.outbound,E.audio.prevOutbound,E.audio.remoteInbound,E.audio.prevRemoteInbound,E.candidatePair,E.audio.codec,k,this.sdpFeatures)),E.video.forEach(P=>{this.analyticsTracker.trackEventNoSharedProps(new ba(this.token,this.traceId,this.sfuResource,P.outbound,P.remoteInbound,E.candidatePair,P.codec,k,M)),P.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Mo(this.token,this.traceId,this.sfuResource,P.outbound,P.prevOutbound,P.remoteInbound,P.prevRemoteInbound,E.candidatePair,P.codec,k))})}uploadSubscriberStats(v){var E;const w={audio:{},video:{}},M=new Map,k=(Date.now()-this.connectionStartedTimestamp)/1e3,P=(E=this.jitterBufferMinDelayInMs)!==null&&E!==void 0?E:0,{seiReadCnt:q,seiBytesRead:Z}=this.updateAndDiffSinceLastUpdate(this.receiveVideoTransformer.getReceiverStats());v.forEach(j=>{if(j.type==="inbound-rtp")switch(j.kind){case"audio":w.audio=this.updateInboundAudio(j),w.audio.codec=M.get(j.codecId);break;case"video":w.video=this.updateInboundVideo(j),w.video.codec=M.get(j.codecId)}j.type==="candidate-pair"&&j.nominated&&(w.candidatePair=j),j.type==="codec"&&M.set(j.id,j)}),this.analyticsTracker.trackEventNoSharedProps(new qm(this.token,this.traceId,this.identifier,this.sfuResource,w.audio.inbound,w.candidatePair,w.audio.codec,k,this.sdpFeatures)),w.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new mr(this.token,this.traceId,this.identifier,this.sfuResource,w.audio.inbound,w.audio.prevInbound,w.candidatePair,w.audio.codec,this.sdpFeatures,P)),this.analyticsTracker.trackEventNoSharedProps(new h0(this.token,this.traceId,this.identifier,this.sfuResource,w.video.inbound,w.candidatePair,w.video.codec,k)),w.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new $m(this.token,this.traceId,this.identifier,this.sfuResource,w.video.inbound,w.video.prevInbound,w.candidatePair,w.video.codec,P,q,Z))}updateAndDiffSinceLastUpdate(v){const E=this.prevVideoReceiverTransformerStats,w=v.seiReadCnt-E.seiReadCnt,M=v.seiBytesRead-E.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:v.seiReadCnt,seiBytesRead:v.seiBytesRead},{seiReadCnt:w,seiBytesRead:M}}updateOutboundAudio(v){const E=v,w=this.prevOutboundAudioStats,M=v.id===(w==null?void 0:w.id)?w:void 0;return this.prevOutboundAudioStats=v,{outbound:E,prevOutbound:M}}updateInboundAudio(v){const E=v,w=this.prevInboundAudioStats,M=v.id===(w==null?void 0:w.id)?w:void 0;return this.prevInboundAudioStats=v,{inbound:E,prevInbound:M}}updateInboundVideo(v){const E=v,w=this.prevInboundVideoStats.get(Rh),M=v.id===(w==null?void 0:w.id)?w:void 0;return this.prevInboundVideoStats.set(Rh,v),{inbound:E,prevInbound:M}}updateOutboundVideo(v){const E=v,w=this.getPrevOutboundVideo(v),M=v.id===(w==null?void 0:w.id)?w:void 0;return this.setPrevVideoStat(v),{outbound:E,prevOutbound:M}}getPrevOutboundVideo(v){return this.simulcastEnabled&&v.rid&&this.prevOutboundVideoStats.has(v.rid)?this.prevOutboundVideoStats.get(v.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(Rh)?this.prevOutboundVideoStats.get(Rh):void 0}setPrevVideoStat(v){this.simulcastEnabled&&v.rid?this.prevOutboundVideoStats.set(v.rid,v):this.simulcastEnabled||this.prevOutboundVideoStats.set(Rh,v)}}class ko extends ar{constructor(v,E,w,M,k){super(an.MINUTE,v,E,!1),Object.assign(this.properties,{action:M?kt.PUBLISH:kt.SUBSCRIBE,is_publishing:M,minutes_logged:w,subscribed_number:k})}}class Uc extends ar{constructor(v){super(an.PUBLISH,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.PUBLISH,remote_participant_id:v.token.participantID})}}class Pd extends ar{constructor(v){super(an.UNPUBLISH,v.token,v.traceId,!0),Object.assign(this.properties,{action:kt.PUBLISH,remote_participant_id:v.token.participantID})}}class Lu extends ar{constructor(v){var E,w,M,k;super(an.SUBSCRIBE,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.SUBSCRIBE,remote_participant_id:v.subscribedId,subscribed_id:v.subscribedId,is_edp_connected:v.isEdpConnected,is_reassignment:v.isReassignment,node:(w=(E=v.preAttemptSfuResource)===null||E===void 0?void 0:E.node)!==null&&w!==void 0?w:"",cluster:(k=(M=v.preAttemptSfuResource)===null||M===void 0?void 0:M.cluster)!==null&&k!==void 0?k:""})}}class f0 extends ar{constructor(v){super(an.UNSUBSCRIBE,v.token,v.traceId,!0),Object.assign(this.properties,{action:kt.SUBSCRIBE,remote_participant_id:v.unsubscribedId,unsubscribed_id:v.unsubscribedId})}}class Jm extends ar{constructor(v){var E,w,M,k;super(an.PUBLISH_STARTED,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.PUBLISH,options_duration:v.optionsDuration,post_duration:v.postDuration,remote_participant_id:v.token.participantID,time_to_candidate:v.timeToCandidate,total_duration:v.totalDuration,edp_initial_connect_duration:v.edpInitialConnectDuration,edp_initial_connect_retry_times:v.edpInitialConnectRetries,edp_initial_state_duration:v.edpInitialStateDuration,edp_state_update_count:v.edpStateUpdateCount,sdp_exchange_duration:v.sdpExchangeDuration,sdp_exchange_transport:v.sdpExchangeTransport,set_remote_desc_duration:v.setRemoteDescDuration,peer_connection_duration:v.peerConnectionDuration,node:(w=(E=v.sfuResource)===null||E===void 0?void 0:E.node)!==null&&w!==void 0?w:"",cluster:(k=(M=v.sfuResource)===null||M===void 0?void 0:M.cluster)!==null&&k!==void 0?k:"",publish_retry_times:v.publishRetries,total_duration_with_retries:v.totalDurationWithRetries})}}class mp extends ar{constructor(v){super(an.PUBLISH_FAILED,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.PUBLISH,code:v.code,message:v.message,fatal:v.fatal,nominal:v.nominal})}}class Ah extends ar{constructor(v){super(an.PUBLISH_ENDED,v.token,v.traceId,!0),Object.assign(this.properties,{action:kt.PUBLISH,remote_participant_id:v.token.participantID,unpublish_successful:v.isUnpublishSuccessful,reason:v.reason})}}class gp extends ar{constructor(v){var E,w,M,k;super(an.SUBSCRIBE_STARTED,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.SUBSCRIBE,options_duration:v.optionsDuration,post_duration:v.postDuration,remote_participant_id:v.remoteParticipantId,time_to_candidate:v.timeToCandidate,total_duration:v.totalDuration,edp_initial_connect_duration:v.edpInitialConnectDuration,edp_initial_connect_retry_times:v.edpInitialConnectRetries,edp_initial_state_duration:v.edpInitialStateDuration,edp_initial_state_publishing_count:v.edpInitialStatePublishingCount,edp_state_update_count:v.edpStateUpdateCount,sdp_exchange_duration:v.sdpExchangeDuration,sdp_exchange_transport:v.sdpExchangeTransport,set_remote_desc_duration:v.setRemoteDescDuration,peer_connection_duration:v.peerConnectionDuration,node:(w=(E=v.sfuResource)===null||E===void 0?void 0:E.node)!==null&&w!==void 0?w:"",cluster:(k=(M=v.sfuResource)===null||M===void 0?void 0:M.cluster)!==null&&k!==void 0?k:"",total_duration_with_retries:v.totalDurationWithRetries,subscribe_retry_times:v.subscribeRetryTimes,is_reassignment:v.isReassignment})}}class p0 extends ar{constructor(v){super(an.SUBSCRIBE_FAILED,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.SUBSCRIBE,remote_participant_id:v.remoteParticipantId,code:v.code,message:v.message,fatal:v.fatal,nominal:v.nominal,is_reassignment:v.isReassignment})}}class Qm extends ar{constructor(v){super(an.SUBSCRIBE_ENDED,v.token,v.traceId,!0),Object.assign(this.properties,{action:kt.SUBSCRIBE,remote_participant_id:v.remoteParticipantId,unsubscribe_successful:v.isUnsubscribeSuccessful,reason:v.reason}),this.critical=!0}}class _p extends ar{constructor(v){super(an.STATE_UPDATED,v.token,v.traceId,!1),Object.assign(this.properties,{audio_muted:v.isAudioMuted,is_disconnected:v.isDisconnected,is_publishing:v.isPublishing,other_participant_id:v.otherParticipantId,other_participant_user_id:v.otherParticipantUserId,video_stopped:v.isVideoStopped})}}class m0 extends ar{constructor(v){var E,w,M,k,P;super(an.FIRST_FRAME,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.SUBSCRIBE,remote_participant_id:v.remoteParticipantId,edp_initial_connect_duration:v.edpInitialConnectDuration,edp_initial_connect_retry_times:v.edpInitialConnectRetries,edp_initial_state_duration:v.edpInitialStateDuration,edp_initial_state_publishing_count:v.edpInitialStatePublishingCount,edp_state_update_count:v.edpStateUpdateCount,sdp_exchange_duration:v.sdpExchangeDuration,sdp_exchange_transport:v.sdpExchangeTransport,set_remote_desc_duration:v.setRemoteDescDuration,peer_connection_duration:v.peerConnectionDuration,node:(w=(E=v.sfuResource)===null||E===void 0?void 0:E.node)!==null&&w!==void 0?w:"",cluster:(k=(M=v.sfuResource)===null||M===void 0?void 0:M.cluster)!==null&&k!==void 0?k:"",video_was_paused:v.videoWasPaused,first_frame_duration:v.firstFrameDuration,total_duration_with_retries:v.totalDurationWithRetries,subscribe_retry_times:v.subscribeRetryTimes,media_type:v.mediaType,configured_jitter_buffer_min_delay_ms:(P=v.currentJitterBufferMinDelayInMs)!==null&&P!==void 0?P:0})}}class Mh extends ar{constructor(v){super(an.EDP_PONG,v.token,v.traceId,!1),Object.assign(this.properties,{event_endpoint:v.eventEndpoint,protocol:v.protocol,edp_rtt:v.edpRttMs})}}class Dd extends ar{constructor(v){super(an.JOIN,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.JOIN,event_endpoint:v.eventEndpoint,whip_endpoint:v.whipEndpoint})}}class Ih extends ar{constructor(v){super(an.JOIN_ATTEMPT,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.JOIN,event_endpoint:v.eventEndpoint,whip_endpoint:v.whipEndpoint})}}class vp extends ar{constructor(v){super(an.JOIN_ATTEMPT_FAILED,v.token,v.traceId,!1),Object.assign(this.properties,{action:kt.JOIN,event_endpoint:v.eventEndpoint,whip_endpoint:v.whipEndpoint,code:v.code,message:v.message,fatal:v.fatal,nominal:v.nominal,connect_retry_times:v.retryCnt})}}class kh extends ar{constructor(v){super(an.EDP_DISCONNECTED,v.token,v.traceId,!1),Object.assign(this.properties,{event_endpoint:v.eventEndpoint,protocol:v.protocol}),this.critical=!0}}class Ld extends ar{constructor(v){super(an.EDP_CONNECTED,v.token,v.traceId,!1),Object.assign(this.properties,{event_endpoint:v.eventEndpoint,protocol:v.protocol,connect_retry_times:v.numRetries}),this.critical=!0}}var Ud;(function(x){x.MESSAGE="message",x.RESPONSE="response"})(Ud||(Ud={}));class g0{constructor(v,E,w){this.token=v,this.analyticsTracker=w,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.latestPingTimestamp=0,this.pongCount=0,this.latestSequenceNumber=0,this.nextConnectionAttempt=0,this.pingInterval=0,this.pongTimeout=0,this.connectTimeout=0,this.beforeUnload=()=>{this.emitter.emit(Nc,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(M,k,P,q,Z,j,ee,se)=>{var ae;const ve={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:k,requestId:q,traceId:P,platform:"web",sdk:"1.19.0",whipVersion:Ao,content:M,contentType:"application/sdp"}};Z&&(ve.payload.forceNode=Z),j&&(ve.payload.assignmentToken=j),ee&&(ve.payload.multiCodec=ee);const Le=gd()===void 0,Te=gd()||Le;se&&Te&&(ve.payload.initialLayerPref=Ym(se)),(ae=this.socket)===null||ae===void 0||ae.send(JSON.stringify(ve))},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new kh({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.logger=new Ns(E,Ft.SOCKET),this.emitter=new Ba.EventEmitter,this.connectionAttempts=0,this.sentPing=!1,this.receivedPong=!1,this.traceId=Us(),this.id=`[${Ls().value}] `,window.addEventListener("beforeunload",this.beforeUnload)}connect(v,E,w=!1){this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=v,this.traceId=E,w&&!this.connecting&&(window.clearTimeout(this.connectTimeout),this.connectTimeout=window.setTimeout(this.connectTimedOut.bind(this),1e4)),this.attemptConnect(E)}attemptConnect(v){this.traceId=v||Us(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:E,rawToken:w}=this.token;this.connecting=!0,this.closing=!1;try{const M=encodeURIComponent(this.traceId.value);this.socket=this.createWebSocket(`${this.addr}?topic=${E}/publishers&traceid=${M}`,w),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(M){const k=M instanceof Error?M.message:void 0,P=this.createError(vt.EVENT_PLANE_WS_CREATE_FAILED,k);this.trackJoinFailed(P,this.getRetryCount()),this.emitter.emit(Pc,P)}}send(v){var E;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(v)}`}),this.isReady()?(E=this.socket)===null||E===void 0||E.send(JSON.stringify(v)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const v=this.connecting,E=this.socket&&this.socket.readyState===this.socket.OPEN,w=this.socket&&this.socket.readyState===this.socket.CLOSING,M=this.getRetryCount();if(this.closing=!0,this.connecting=!1,this.cleanPingPongTimeouts(),window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.connectionAttempts=0,this.connectTimeout=0,this.socket){if(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,E)this.trackJoinEnded(),this.emitter.emit(Nc,"intentional-close");else if(v&&!w){const k=this.createError(vt.OPERATION_ABORTED);this.trackJoinFailed(k,M),this.analyticsTracker.trackError(k),this.emitter.emit(Pc,k)}}}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(v,E){return new WebSocket(v,E)}createError(v,E){return new Wn(Object.assign({action:kt.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:Ga.JOIN_RELATED,details:E},v))}on(v,E){this.emitter.on(v,E)}off(v,E){this.emitter.off(v,E)}isReady(){return this.logger.debug({msg:`${this.id}isReady called`}),!!this.socket&&this.socket.readyState===this.socket.OPEN}onMessage(v){this.logger.debug({msg:`${this.id}received message: ${v.data}`});try{const E=JSON.parse(v.data);switch(E.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const w=E.payload.sequenceNumber;w>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&wu()&&this.connectTimeout>0&&this.triggerSocketOpen(E),this.emitter.emit(Lm,E),this.latestSequenceNumber=w);break}case"PONG":this.receivedPong=!0,this.pongCount%2==0&&this.analyticsTracker.trackEventNoSharedProps(new Mh({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp})),this.pongCount++;break;case"REFRESH":this.emitter.emit(Dm);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(Eh,E.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(op,E.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(Jl,E.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(Ou,E.payload);break;default:(0,$i.noop)()}}catch(E){this.logger.debug({msg:`onMessage JSON Parse error: ${E}`}),this.emitter.emit($a,E)}}onError(v){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(v)}`})}onClose(v){if(this.logger.debug({msg:`${this.id}onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.cleanPingPongTimeouts(),this.closing)this.closing=!1;else if(!this.windowUnloading)if(this.connecting){let E=Math.pow(2,this.connectionAttempts-1);E>64&&(E=64),this.logger.debug({msg:`${this.id}reconnecting in ${E} seconds`}),window.clearTimeout(this.nextConnectionAttempt),this.nextConnectionAttempt=window.setTimeout(this.attemptConnect.bind(this),1e3*E);const w=this.createError(vt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,`code: ${v==null?void 0:v.code}, reason: ${v==null?void 0:v.reason}, wasClean: ${v==null?void 0:v.wasClean}`);this.trackJoinFailed(w,this.getRetryCount()),this.analyticsTracker.trackError(w)}else{this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(Nc,"unknown");const E=this.createError(vt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,`code: ${v==null?void 0:v.code}, reason: ${v==null?void 0:v.reason}, wasClean: ${v==null?void 0:v.wasClean}`);this.trackJoinEnded(),this.emitter.emit(Pc,E)}}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),wu()?this.connectTimeout=window.setTimeout(()=>{this.triggerSocketOpen()},1e4):this.triggerSocketOpen()}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.nextConnectionAttempt=0,this.connectTimeout=0}triggerSocketOpen(v){this.clearConnectionAttemptTimeouts();const E=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(),this.emitter.emit(Oc,{retryCnt:E,traceId:this.traceId,initialStageState:v}),this.pingInterval=window.setInterval(this.ping.bind(this),3e4)}ping(){var v;this.logger.debug({msg:`${this.id}sending PING`});try{this.latestPingTimestamp=performance.now(),(v=this.socket)===null||v===void 0||v.send(JSON.stringify({type:"PING"})),this.sentPing=!0,this.receivedPong=!1,this.pongTimeout&&clearTimeout(this.pongTimeout),this.pongTimeout=window.setTimeout(this.pongTimedOut.bind(this),5e3)}catch(E){const w=E instanceof Error?E.message:void 0,M=this.createError(vt.EVENT_PLANE_PING_SEND_FAIL,w);this.emitter.emit(Pc,M)}}connectTimedOut(){const v=this.socket&&this.socket.readyState===this.socket.CONNECTING;this.connecting=!1,this.logger.debug({msg:`${this.id}Connect timed out!`});const E=this.createError(vt.JOIN_TIMED_OUT);v&&this.trackJoinFailed(E,this.getRetryCount()),this.createError(vt.JOIN_TIMED_OUT),this.emitter.emit(Pc,E),this.close()}pongTimedOut(){if(this.sentPing&&!this.receivedPong){this.logger.debug({msg:`${this.id}Pong timed out!`});const v=this.createError(vt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(Pc,v)}}cleanPingPongTimeouts(){this.sentPing=this.receivedPong=!1,window.clearTimeout(this.pongTimeout),window.clearInterval(this.pingInterval)}trackJoinAttempt(v){const{token:E,traceId:w}=this;this.analyticsTracker.trackEvent(new Ih({token:E,eventEndpoint:(E==null?void 0:E.eventsURL)||"",whipEndpoint:(E==null?void 0:E.whipURL)||"",traceId:w}))}trackJoinFailed(v,E){const{token:w,traceId:M,code:k,message:P,fatal:q,nominal:Z}=v;this.analyticsTracker.trackEvent(new vp({token:w,eventEndpoint:w.eventsURL,whipEndpoint:w.whipURL,traceId:M,code:k,message:P,fatal:q,nominal:Z,retryCnt:E}))}trackJoinStarted(){this.analyticsTracker.trackEventNoSharedProps(new Ld({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:this.getRetryCount(),protocol:this.protocol,traceId:this.traceId}))}}var yp=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})},qa,Xa,Ka,di;(function(x){x.SDP_EXCHANGE="xdp",x.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(qa||(qa={})),function(x){x.USER_INITIATED="user-initiated",x.CLIENT_RECONNECT="reconnect",x.TOKEN_REUSED="token-reused",x.UNKNOWN="unknown",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"}(Xa||(Xa={})),function(x){x[x.NOT_CONNECTED=0]="NOT_CONNECTED",x[x.CONNECTION_LOST=1]="CONNECTION_LOST",x[x.TIMEDOUT=2]="TIMEDOUT",x[x.ABORTED=3]="ABORTED",x[x.INVALID_MESSAGE=4]="INVALID_MESSAGE",x[x.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"}(Ka||(Ka={})),function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"}(di||(di={}));class Sp extends qs{constructor(v,E,w){super(),this.token=v,this.nonScopedLogger=E,this.analyticsTracker=w,this.participants=new Map,this.disconnected=[],this.state={value:di.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(M,k)=>{this.logger.debug({msg:"onConnecting",context:M,event:k}),M.connectStartTime=performance.now();const P=k.type==="RECONNECT";P&&this.stageSocket.close();const{eventsURL:q}=this.token;this.emit(Yl,di.CONNECTING),this.state.value=di.CONNECTING;const Z=!P;this.stageSocket.connect(q,this.traceId,Z)},this.onConnected=(M,k)=>{this.logger.debug({msg:"onConnected",context:M,event:k}),M.hasConnected=!0,this.emit(Co),this.emit(Yl,di.CONNECTED),this.state.value=di.CONNECTED},this.onDisconnected=(M,k)=>{this.logger.debug({msg:"onDisconnected",context:M}),this.state.value=di.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),M.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(Yl,di.DISCONNECTED,k)},this.onErrored=(M,k)=>{this.logger.error({msg:"Connection failure occurred",err:k.payload.error}),this.emit(Yl,di.ERRORED),this.emit(H_,k.payload.error),this.state.value=di.ERRORED,M.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=M=>{const k=this.state.value,P=this.state.context;switch(k){case di.DISCONNECTED:M.type==="CONNECT"&&this.onConnecting(P,M);break;case di.CONNECTING:M.type==="RECONNECT"?this.onConnecting(P,M):M.type==="DISCONNECT"?this.onDisconnected(P,M.reason):M.type==="CONNECT_SUCCESS"?this.onConnected(P,M):M.type==="ERROR"&&this.onErrored(P,M);break;case di.CONNECTED:M.type==="RECONNECT"?this.onConnecting(P,M):M.type==="DISCONNECT"?this.onDisconnected(P,M.reason):M.type==="ERROR"&&this.onErrored(P,M);break;case di.ERRORED:M.type==="RECONNECT"?this.onConnecting(P,M):M.type==="DISCONNECT"&&this.onDisconnected(P,M.reason)}},this.measureConnect=(M,k)=>{const P=this.stats.edpConnectCount,q=P+1,Z=performance.now(),j=Z-k;return Object.assign(this.stats,{edpConnectCount:q,edpConnectDuration:j}),P===0&&Object.assign(this.stats,{edpInitialStartConnectTime:k,edpInitialFinishConnectTime:Z,edpInitialConnectDuration:j,edpInitialConnectRetries:M}),this.stats},this.measureStateUpdate=M=>{const{edpInitialFinishConnectTime:k}=this.stats,P=this.stats.edpStateUpdateCount,q=P+1;return Object.assign(this.stats,{edpStateUpdateCount:q}),P===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-k,edpInitialStatePublishingCount:M}),this.stats},this.trackMessageParseError=M=>{this.logger.error({msg:"Message Parse Error occurred",err:M.err});const k=new Wn({token:M.token,traceId:M.traceId,code:vt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:M.tag,location:M.location,message:M.message,details:M.err.message});this.analyticsTracker.trackEvent(new fh(k))},this.trackStageSocketMessageParseError=(M,k,P)=>{this.trackMessageParseError({token:M,traceId:k,tag:Ga.JOIN_RELATED,location:"StageConnection.onMessage",message:vt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:P})},this.trackStageStateMessageParseError=(M,k,P,q)=>{this.trackMessageParseError({token:M,traceId:k,tag:Ga.JOIN_RELATED,location:"StageConnection.onStageStateMessage",message:q,err:P})},this.onDisconnectMessage=M=>{this.analyticsTracker.trackEventNoSharedProps(new xd(this.token,this.traceId,`DISCONNECT message received: ${M.code}:${M.reason}`,kt.JOIN));let k=Xa.UNKNOWN;if(M.code==="PARTICIPANT_DISCONNECTED")k=Xa.PARTICIPANT_DISCONNECTED;else if(M.code==="STAGE_DELETED")k=Xa.STAGE_DELETED;else if(M.code==="TOKEN_REUSED"&&(k=Xa.TOKEN_REUSED,ql("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${M.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:k})},this.onReassignmentMessage=M=>{this.emit(Rs,M)},this.onIncompatibleCodecsMessage=M=>{this.emit(ku,M)},this.onStageStateMessage=(M,k,P)=>{var q,Z;this.logger.debug({msg:"State Stage Message occurred",state:P});const j=P.payload,ee=(q=j.participants)!==null&&q!==void 0?q:[],se=(Z=j.disconnected)!==null&&Z!==void 0?Z:[],ae=[],ve=[];this.measureStateUpdate(ee.length),this.enableFeaturesBasedOnServerFeatures(j.serverFeatures||[]);const Le=(Te,ge)=>{this.analyticsTracker.trackEventNoSharedProps(new _p({token:M,otherParticipantId:Te.id,otherParticipantUserId:Te.userId,isAudioMuted:Te.audioMuted,isVideoStopped:Te.videoStopped,isPublishing:Te.isPublishing,isDisconnected:ge,traceId:k}))};this.participants.forEach(Te=>{const ge=ee.find(he=>he.id===Te.id);if(ge){let he=!0,$e=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach(yt=>{he=he&&ge[yt.toString()]===Te[yt.toString()],he||(Te[yt.toString()]=ge[yt.toString()],$e=!0)}),Object.keys(Te.attributes).forEach(yt=>{he=he&&ge.attributes[yt]===Te.attributes[yt],he||(Te.attributes=ge.attributes,$e=!0)}),$e&&(Le(Te,!1),this.emit(vs,ge))}else ve.push(Te)}),ee.forEach(Te=>{this.participants.get(Te.id)||ae.push(Te)}),ve.forEach(Te=>{this.participants.delete(Te.id),Le(Te,!0),this.emit(Ei,Te)}),ae.forEach(Te=>{this.participants.set(Te.id,Te),Le(Te,!1),this.emit(Wa,Te)}),se.forEach(Te=>{this.disconnected.find(ge=>ge.id===Te.id)||(this.disconnected.push(Te),Te.status==="KICKED"&&this.emit(qi,Te))}),this.disconnected=se},this.nonScopedLogger=E,this.logger=new Ns(E,Ft.CONNECTION),this.stageSocket=new g0(v,this.nonScopedLogger,w),this.token=v,this.traceId=Us()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(v){return yp(this,void 0,void 0,function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:v}),this.traceId=v,this.state.value!==di.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:Xa.CLIENT_RECONNECT})),new Promise((E,w)=>{this.stageSocket.on(Oc,M=>{var k,P;const{retryCnt:q,initialStageState:Z}=M;Z&&this.enableFeaturesBasedOnServerFeatures((P=(k=Z.payload)===null||k===void 0?void 0:k.serverFeatures)!==null&&P!==void 0?P:[]),this.traceId=M.traceId||Us(),this.measureConnect(q,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),E(this.traceId)}),this.stageSocket.on(Pc,M=>{w(M),this.processStateUpdate({type:"ERROR",payload:{error:M}})}),this.stageSocket.on(Dm,()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(sp),this.processStateUpdate({type:"RECONNECT"})}),this.stageSocket.on(Lm,M=>this.onStageStateMessage(this.token,this.traceId,M)),this.stageSocket.on($a,M=>this.trackStageSocketMessageParseError(this.token,this.traceId,M)),this.stageSocket.on(op,this.onDisconnectMessage),this.stageSocket.on(Jl,this.onReassignmentMessage),this.stageSocket.on(Ou,this.onIncompatibleCodecsMessage),this.stageSocket.on(Nc,M=>{this.stopStageMinuteLoggedInterval()}),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:v}})})})}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:Xa.USER_INITIATED}),this.traceId}getParticipant(v){return this.participants.get(v)}listConnectedParticipants(){const v=[];return this.participants.forEach(E=>{E.subscribed&&v.push(E)}),v}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(v,E){this.stageSocket.send({audioMuted:v,type:"SET_STATE",version:"0",videoStopped:E})}setStagePublishing(v){this.isStagePublishing=v,this.emit(Ed,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(v,E){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new ko(v,E,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval(()=>{this.analyticsTracker.trackEvent(new ko(v,E??Us(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++},6e4))}stopStageMinuteLoggedInterval(v=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),v&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(v){const E=(P,q)=>{this.trackStageStateMessageParseError(this.token,this.traceId,q,`Could not parse "${P}" from the Eevee server features list`)},w=v.includes(qa.SDP_EXCHANGE);this.features.sdpExchange!==w&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${w}`}),this.features.sdpExchange=w);const M=v.find(P=>P.indexOf(qa.JITTER_BUFFER_MIN_DELAY_MS)!==-1),k=P=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${P}`}),this.features.jitterBufferMinDelayInMs=P};if(M!==void 0)try{const P=M.split("=")[1],q=parseInt(P,10);if(isNaN(q))throw new Error("Unable to parse - result is NaN");if(q<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===q||k(q)}catch(P){E(M,P),k(void 0)}else k(void 0)}isConnected(){return this.state.value===di.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(v,E,w,M,k,P,q,Z,j){return yp(this,void 0,void 0,function*(){return this.isConnected()?new Promise((ee,se)=>{const ae=window.setTimeout(()=>{ve(),se(Ka.TIMEDOUT)},8e3),ve=()=>{window.clearTimeout(ae),this.stageSocket.off(Eh,Le),this.stageSocket.off(Pc,Te)},Le=ge=>{ge.requestId===M&&(ve(),ee(ge))},Te=()=>{ve(),se(Ka.CONNECTION_LOST)};k==null||k.addEventListener("abort",()=>{ve(),se(Ka.ABORTED)}),this.stageSocket.on(Eh,Le),this.stageSocket.on(Pc,Te),this.stageSocket.sendSdpOffer(v,E,w,M,P,q,Z,j)}):Promise.reject(Ka.NOT_CONNECTED)})}}class fi{constructor(v){this.token=v}}var gr=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};const ts={[Ka.ABORTED]:vt.OPERATION_ABORTED,[Ka.NOT_CONNECTED]:vt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[Ka.CONNECTION_LOST]:vt.XDP_CONNECTION_LOST,[Ka.TIMEDOUT]:vt.XDP_TIMEOUT,[Ka.INVALID_MESSAGE]:vt.XDP_INVALID_ANSWER_MSG,[Ka.UNEXPECTED_ERROR]:vt.XDP_UNEXPECTED_ERROR};class ns extends fi{constructor(v,E,w,M){super(v),this.token=v,this.stageConnection=E,this.contextData=w,this.analyticsTracker=M}exchange(v){return gr(this,void 0,void 0,function*(){const E=Ls(),{action:w}=this.contextData,{sdpOffer:M,url:k,traceId:P,forceNode:q,assignmentToken:Z,multiCodec:j,abortController:ee,initialLayerPreference:se}=v;let ae;this.trackAttempt(k,E,P);try{ae=yield this.stageConnection.exchangeSdp(M,k,P.value,E.value,ee==null?void 0:ee.signal,q,Z,j,se)}catch(Bt){if(typeof Bt=="number")throw this.createClientSideErrorFromReasonCode(Bt,P,E,w)}if(!ae)return;const{httpStatusCode:ve,errorCode:Le,location:Te,content:ge,sessionDeleteLink:he,subscriberControlLink:$e,videoLayersLink:yt}=ae;if(ve>=200&&ve<300)return{sdpAnswer:ge,url:k,location:Te,sessionDeleteLink:he,mediaControls:$e,layerControls:yt};throw this.createServerSideError(P,E,ve,Le,w)})}trackAttempt(v,E,w){const{remoteParticipantId:M,action:k}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new Ql(k,this.token,v,"POST",E.value,M,w,"xdp"))}createServerSideError(v,E,w,M,k){const P=this.baseErrorProps(v,E);let q=Sh(w,M);return q||(q=vt.UNKNOWN_SERVER_ERROR),new Wn(Object.assign(Object.assign({action:k},P),q))}baseErrorProps(v,E){const{remoteParticipantId:w,action:M}=this.contextData;return{token:this.token,traceId:v,tag:Xs(M,w),location:"EdpSdpExchanger.exchange",requestUUID:E,remoteParticipantId:w}}createClientSideErrorFromReasonCode(v,E,w,M){const k=this.baseErrorProps(E,w),P=ts[v];return new Wn(P?Object.assign(Object.assign({action:M},k),P):Object.assign(Object.assign({action:M},k),vt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}const Is=new RegExp("^(?:[a-z+]+:)?//","i");function Fs(x){return Is.test(x)}var wn=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class rs extends fi{constructor(v,E,w){super(v),this.contextData=E,this.analyticsTracker=w}exchange(v){return wn(this,void 0,void 0,function*(){const E=Ls(),{token:w}=this,{action:M,remoteParticipantId:k}=this.contextData,{sdpOffer:P,url:q,traceId:Z,forceNode:j,assignmentToken:ee,multiCodec:se,abortController:ae,initialLayerPreference:ve}=v;try{const Te="POST",ge="http";this.analyticsTracker.trackEventNoSharedProps(new Ql(M,w,q,Te,E.value,k,Z,ge));const he={data:P,headers:{Authorization:`Bearer ${w.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":E.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":Z.value,"X-Stages-WHIP-Version":Ao,"X-Stages-Options":(Le=JSON.stringify({cap:["sau"]}),btoa(Le).replace(/[^A-Za-z0-9+/]/g,""))},method:Te,responseType:"text",url:q,signal:ae==null?void 0:ae.signal,params:{}};j&&(he.params.force_node=j),ee&&(he.params.assignment_token=ee),se&&(he.params.multi_codec=!0);const $e=gd()===void 0,yt=gd()||$e;ve&&he.headers&&yt&&(he.headers["X-Stages-Initial-Layer-Pref"]=Ym(ve));const{data:Bt,headers:_t,request:Pn}=yield Nu(he),Mn=this.parseWhipResource(q,_t.location,_t.link);return{url:Pn.responseURL,sdpAnswer:Bt,location:Mn==null?void 0:Mn.location,sessionDeleteLink:Mn==null?void 0:Mn.sessionDeleteLink,mediaControls:Mn==null?void 0:Mn.mediaControls,layerControls:Mn==null?void 0:Mn.layerControls}}catch(Te){if(Zi().isCancel(Te))throw new Wn(Object.assign(Object.assign({},_i(vt.OPERATION_ABORTED,Te)),{action:M,token:w,traceId:Z,tag:Xs(M,k),location:"StagePeerClient.start",requestUUID:E,remoteParticipantId:k}));const ge=function(he,$e){var yt;return he instanceof Xr.AxiosError&&he.response&&typeof he.response.status=="number"?he instanceof Xr.AxiosError&&he.code==="ERR_NETWORK"?vt.NETWORK_FAILURE:Sh(Number(he.response.status),(yt=he.response.data)===null||yt===void 0?void 0:yt.code)||$e:$e}(Te,vt.WHIP_POST_FAILURE);throw new Wn(Object.assign(Object.assign({},_i(ge,Te)),{action:M,token:w,traceId:Z,tag:Xs(M,k),location:"StagePeerClient.start",requestUUID:E,remoteParticipantId:k}))}var Le})}parseWhipResource(v,E,w){const M=new URL(v);let k;return k=function(P,q,Z){if(!Z)return P;if(P||(P={}),Fs(Z))return P.location=Z,P;const j=q.port?`:${q.port}`:"";return P.location=`${q.protocol}//${q.hostname}${j}${Z}`,P}(k,M,E),k=function(P,q,Z){if(!Z)return P;P||(P={});const j=P;return Z.split(",").forEach(ee=>{const se=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(ee);if((se==null?void 0:se.length)!==3)return;let ae;if(Fs(se[1]))ae=se[1];else{const ve=q.port?`:${q.port}`:"";ae=`${q.protocol}//${q.hostname}${ve}${se[1]}`}switch(se[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":j.sessionDeleteLink=ae;break;case"urn:ietf:params:whep:core:playback-controls":j.mediaControls=ae;break;case"urn:ietf:params:whep:ext:core:layer":j.layerControls=ae;break;default:return}}),j}(k,M,w),k}getTransport(){return"http"}}var bn=i(1564);function Ta(x){return x.track.kind===_l.AUDIO}function Uu(x){return x.track.kind===_l.VIDEO&&typeof x.config=="object"}const Ep=(x,v)=>function(E){return E.kind===_l.AUDIO}(x)?((E,w)=>{var M;const k={maxBitrateBps:fo((M=w==null?void 0:w.maxAudioBitrateKbps)!==null&&M!==void 0?M:64)},P=w==null?void 0:w.stereo;return typeof P=="boolean"&&(k.stereo=P),{track:E,config:k}})(x,v):((E,w)=>{var M,k,P,q;const Z=(M=w==null?void 0:w.minBitrate)!==null&&M!==void 0?M:wd,j=(k=w==null?void 0:w.maxBitrate)!==null&&k!==void 0?k:Th,ee=(P=w==null?void 0:w.maxFramerate)!==null&&P!==void 0?P:vl,se=!!(!((q=w==null?void 0:w.simulcast)===null||q===void 0)&&q.enabled);return{track:E,config:{minBitrateBps:fo(Z),maxBitrateBps:fo(j),maxFramerate:ee,simulcastEnabled:se,inBandMessagingEnabled:!1}}})(x,v),Xi=(x,v)=>{if(typeof x=="number")return x;const E=v?Hm:Cd;return E[x]!==void 0?E[x]:0};function Oo(x){if(x<wd||x>Th)throw new Error(`Stage bitrate must be between ${wd} kbps and ${Th} kbps`)}function Zm(x,v){const E=Rd();let w=Object.assign({},E,(0,$i.cloneDeep)(v));return w=function(M,k){var P,q,Z;const j=Object.assign({},(0,$i.cloneDeep)(k)),ee=!Io.browser.isChrome()&&!Io.browser.isEdge(),se=(Z=(q=(P=M.getSettings)===null||P===void 0?void 0:P.call(M))===null||q===void 0?void 0:q.displaySurface)!==null&&Z!==void 0&&Z,ae=fo(j.maxBitrate)<xh.maxBitrate;return(ee||se||ae)&&(j.simulcast.enabled=!1),j}(x,w),Oo(w.maxBitrate),Oo(w.minBitrate),function(M){if(M&&(M>vl||M<jm))throw new Error(`framerate cannot exceed ${vl} fps`)}(w.maxFramerate),function(M){if(M<lp||M>ho)throw new Error(`Stage audio bitrate must be between ${lp} kbps and ${ho} kbps`)}(w.maxAudioBitrateKbps),function(M){if(typeof M!="boolean")throw new Error("Stage stereo prop must be a boolean")}(w.stereo),w}function bp({stageErrorValue:x,action:v,token:E,traceId:w,tag:M,identifier:k,details:P}){return new Wn(Object.assign(Object.assign({},x),{token:E,traceId:w,location:"peer-client",tag:M,action:v,remoteParticipantId:k,details:P}))}var yi;function Bs(x){var v;return!((v=x==null?void 0:x.sender)===null||v===void 0)&&v.createEncodedStreams?yi.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?yi.ENCODED_TRANSFORMS:yi.NONE}function Fd(x){var v;return!((v=x==null?void 0:x.receiver)===null||v===void 0)&&v.createEncodedStreams?yi.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?yi.ENCODED_TRANSFORMS:yi.NONE}function El(x){let v=[];const E=new Map;function w(M){const k="0123456789abcdef";let P="";for(let q=0;q<M;q+=1)P+=k.charAt(Math.floor(Math.random()*k.length));return P}return{add(M){const k=w,P=`${k(8)}-${k(4)}-${k(4)}-${k(4)}-${k(12)}`,q=Date.now();return v.push({id:P,enqueuedAt:q,payload:M}),P},poll(M){return E.has(M)||E.set(M,[]),E.size>=x&&(E.forEach(k=>{k.push(...v)}),v=[]),(E.get(M)||[]).splice(0,1)}}}function eg(x,v){return v.type==="sei"?function(E,w){const q=new Uint8Array([1,2,1,8,1,2,3,4,2,2,2,4,4,3,2,1]);function Z(se,ae,ve){return ve+ae.length<=se.byteLength&&ae.every((Le,Te)=>se.getUint8(ve+Te)===Le)}function j(se,ae){const ve=function(Te,ge){return new Uint8Array([0,0,1,6,5,...ge,...Te])}(se,function(Te){const ge=[];for(;Te>=255;)ge.push(255),Te-=255;return ge.push(Te),new Uint8Array(ge)}(ae.length+se.length)),Le=function(Te){const ge=[...Te];let he=3;for(;he<ge.length-2;)ge[he]!==0||ge[he+1]!==0||ge[he+2]!==0&&ge[he+2]!==1&&ge[he+2]!==2&&ge[he+2]!==3?he+=1:(ge.splice(he+2,0,3),he+=3);return ge}(new Uint8Array([...ve,...ae,128]));return new Uint8Array(Le)}function ee(se,ae){const ve=function(Le){const Te=new DataView(Le);for(let ge=0;ge<Te.byteLength-4;ge++)if(Z(Te,[0,0,1],ge)){const he=31&Te.getUint8(ge+3);if(he>=1&&he<=5)return ge}return-1}(E.data);if(ve>=0){const Le=new ArrayBuffer(E.data.byteLength+ae.byteLength),Te=new Uint8Array(Le);return Te.set(new Uint8Array(E.data.slice(0,ve)),0),Te.set(ae,ve),Te.set(new Uint8Array(E.data.slice(ve)),ve+ae.byteLength),Le}return se}return function(){for(let se=0;se<w.length;se+=1){const ae=j(q,new Uint8Array(w[se]));E.data=ee(E.data,ae)}return E}()}(x,v.payloads||[]):x}function uc(x,v){const{type:E,transformerId:w}=v;if(E==="sei"){const M=function(q){function ee(ve,Le,Te){return Te+Le.length<ve.byteLength&&Le.every((ge,he)=>ve.getUint8(Te+he)===ge)}function se(ve){const Le=[];let Te=0;for(;Te<ve.length;)ve[Te]===0&&ve[Te+1]===0&&ve[Te+2]===3?(Le.push(ve[Te]),Le.push(ve[Te+1]),Te+=3):(Le.push(ve[Te]),Te+=1);return new Uint8Array(Le)}function ae(ve){let Le=2;const Te=ve.byteLength;for(;Le<Te;){let ge=0;for(;Le<Te&&ve[Le]===255;)ge+=255,Le++;ge+=ve[Le],Le++;const he=Math.min(Le+ge,Te),$e=new Uint8Array(ve.slice(Le,he));return{uuid:$e.slice(0,16),payload:$e.slice(16)}}}return{messages:function(ve){const Le=new DataView(ve.data),Te=[];let ge=0;if(!ee(Le,[0,0,1],0)&&!ee(Le,[0,0,0,1],0))return[];for(;ge<Le.byteLength-5;)if(ee(Le,[0,0,1],ge)){const he=ge+3;ge=he;const $e=31&Le.getUint8(ge),yt=31&Le.getUint8(ge+1);if($e===6&&yt===5){for(;ge<Le.byteLength&&!ee(Le,[0,0,1],ge);)ge++;const Bt=ge,_t=ae(se(new Uint8Array(ve.data.slice(he,Bt))));_t&&Te.push(Object.assign(Object.assign({},_t),{timestamp:ve.timestamp,type:ve.type}))}else ge++}else ge++;return Te}(q),frame:q}}(x),{frame:k,messages:P}=M;return{success:!0,frame:k,type:E,transformerId:w,seiResult:P}}return{success:!0,frame:x,transformerId:w,type:E}}function Tp(){let x;const v=M=>(k,P)=>{const q=k.getMetadata().synchronizationSource,Z=(x?x.poll(q):[]).map(j=>j.payload);P.enqueue("<SEND_TRANSFORMER_IMPL>"(k,Object.assign(Object.assign({},M),{payloads:Z})))},E=M=>(k,P)=>{try{const q="<RECEIVE_TRANSFORMER_IMPL>"(k,M);P.enqueue(q.frame),self.postMessage(Object.assign(Object.assign({success:q.success},M),{seiResult:q.seiResult}))}catch{self.postMessage(Object.assign({success:!1},M))}};function w(M,k,P,q){const Z=new TransformStream({transform:M==="video/send"?v(k):E(k)});P.pipeThrough(Z).pipeTo(q)}return self.onrtctransform=M=>{const k=M.transformer;k&&w(k.options.method,k.options,k.readable,k.writable)},self.onmessage=M=>{var k;const{operation:P,transformerId:q}=M.data;P==="insert"?(x||(x="<CREATE_MESSAGE_QUEUE>"(1)),x.add((k=M.data)===null||k===void 0?void 0:k.payload)):P!=="video/receive"&&P!=="video/send"||w(P,{method:P,transformerId:q,type:"sei"},M.data.readable,M.data.writable)},{videoReceiveTransform:E,videoSendTransform:v}}(function(x){x.NONE="none",x.ENCODED_TRANSFORMS="encodedTransforms",x.INSERTABLE_STREAMS="insertableStreams"})(yi||(yi={}));const Bd=()=>{let x=Tp.toString();return x=x.replace('"<SEND_TRANSFORMER_IMPL>"',eg.toString()),x=x.replace('"<RECEIVE_TRANSFORMER_IMPL>"',uc.toString()),x=x.replace('"<CREATE_MESSAGE_QUEUE>"',El.toString()),x},Fu=(()=>{let x;return{getWorker:()=>(x||(x=function(){const v=new Blob([`(${Bd()})()`],{type:"text/javascript"}),E=URL.createObjectURL(v);return new Worker(E)}()),x),destroy:()=>{x&&x.terminate(),x=void 0}}})(),zd="seiMessageReceived",Oh="error";var bi;(function(x){x.CREATED="created",x.INITIALIZED="initialized",x.DESTROYED="destroyed"})(bi||(bi={}));class Ya extends qs{constructor({enabled:v}){super(),this.state=bi.CREATED,this.transformerId=Ls().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=E=>{this.onTransformResult(E.data)},v||this.destroy()}initializeInsertableStreams(v){var E;this.worker=Fu.getWorker();const w=v.receiver.createEncodedStreams(),{readable:M,writable:k}=w;(E=this.worker)===null||E===void 0||E.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:M,writable:k},[M,k]),this.worker.addEventListener("message",this.onMessage)}initializeEncodedTransforms(v){this.worker=Fu.getWorker();const E={method:"video/receive",type:"sei",transformerId:this.transformerId};v.receiver.transform=new RTCRtpScriptTransform(this.worker,E),this.worker.addEventListener("message",this.onMessage)}initialize(v,E){if(this.state!==bi.CREATED)return!1;const w=Fd(v);if(w===yi.NONE)return!1;if(E&&w===yi.INSERTABLE_STREAMS)this.initializeInsertableStreams(v);else{if(E||w!==yi.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(v)}return this.transceiver=v,this.state=bi.INITIALIZED,!0}onTransceiverAdd(v){return this.initialize(v,!0)}onTrackEvent(v){return v.track.kind==="video"&&this.initialize(v.transceiver,!1)}static isSupported(v){return Fd(v)!==yi.NONE}onTransformResult(v){return v.transformerId===this.transformerId&&(v.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!v.seiResult&&(v.seiResult.forEach(E=>{const{payload:w,uuid:M}=E;this.updateReadStats(E),this.emit(zd,{uuid:M,payload:w})}),v.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(v,vt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(v,vt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(v){this.seiReadCnt++,this.seiBytesRead+=v.payload.byteLength}getReceiverStats(){const{seiBytesRead:v,seiReadCnt:E}=this;return{seiReadCnt:E,seiBytesRead:v}}onError(v,E){const{type:w}=v;this.emit(Oh,{type:w,stageErrorValue:E})}destroy(){var v,E;this.state!==bi.DESTROYED&&(this.removeAllListeners(),(v=this.worker)===null||v===void 0||v.removeEventListener("message",this.onMessage),!((E=this.transceiver)===null||E===void 0)&&E.receiver&&(this.transceiver.receiver.transform=null),this.state=bi.DESTROYED)}getState(){return this.state}}class Qo{constructor({enabled:v}){this.state=bi.CREATED,this.transformerId=Ls().value,v||this.destroy()}initializeInsertableStreams(v,E){var w;this.worker=Fu.getWorker();const M=v.sender.createEncodedStreams(),{readable:k,writable:P}=M;(w=this.worker)===null||w===void 0||w.postMessage({operation:"video/send",transformerId:this.transformerId,readable:k,writable:P},[k,P])}initializeEncodedTransforms(v,E){this.worker=Fu.getWorker();const w={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:E};v.sender.transform=new RTCRtpScriptTransform(this.worker,w)}initialize(v){var E;if(this.state!==bi.CREATED)return!1;const w=Bs(v);if(w===yi.NONE)return!1;const M=v.sender.getParameters(),k=((E=M==null?void 0:M.encodings)===null||E===void 0?void 0:E.length)||1;if(w===yi.INSERTABLE_STREAMS)this.initializeInsertableStreams(v,k);else{if(w!==yi.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(v,k)}return this.transceiver=v,this.state=bi.INITIALIZED,!0}static isSupported(v){return Bs(v)!==yi.NONE}sendSeiMessage(v){var E;this.state===bi.INITIALIZED&&this.transceiver&&((E=this.worker)===null||E===void 0||E.postMessage({operation:"insert",transformerId:this.transformerId,payload:v}))}onTransceiverAdd(v){return this.initialize(v)}onTrackEvent(v){return!1}destroy(){var v;this.state!==bi.DESTROYED&&(!((v=this.transceiver)===null||v===void 0)&&v.receiver&&(this.transceiver.receiver.transform=null),this.state=bi.DESTROYED)}getState(){return this.state}}var is=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};let zs=null;class Vd extends qs{constructor(v,E,w,M,k,P,q,Z,j){var ee,se;if(super(),this.analyticsTracker=P,this.sfuResource={node:"",cluster:""},this.stageCapabilities={simulcastNegotiated:!1},this.incompatibleCodecs=new Set,this.connect=({audioOnly:ae=!1,traceId:ve,iceRestartOptions:Le})=>is(this,void 0,void 0,function*(){const{token:Te,tag:ge,identifier:he,action:$e}=this,yt=!!Le,Bt=new AbortController;let _t,Pn,Mn;this.abortController=Bt,this.traceId=ve,this.perfTracker.resetMeasurements(ve);const Er=()=>{_t&&this.off(Xo,_t),Pn&&this.off(gs,Pn)},Cr=new Promise((Rr,Ar)=>{const cr=function({action:xr,token:Mr,traceId:qn,tag:pn,identifier:Bn}){const oi=xr===kt.SUBSCRIBE?vt.SUBSCRIBE_TIMED_OUT:vt.PUBLISH_TIMED_OUT;return new Wn(Object.assign(Object.assign({},oi),{action:xr,token:Mr,traceId:qn,tag:pn,location:"connect",remoteParticipantId:Bn}))}({action:$e,token:Te,traceId:ve,tag:ge,identifier:he}),br=function({action:xr,token:Mr,traceId:qn,tag:pn}){const Bn=vt.OPERATION_ABORTED;return new Wn(Object.assign(Object.assign({},Bn),{token:Mr,traceId:qn,location:"peer-client.connect",tag:pn,action:xr}))}({action:$e,token:Te,traceId:ve,tag:ge}),Tr=setTimeout(()=>{this.stop(),this.analyticsTracker.trackError(cr),Ar(cr)},1e4);_t=xr=>{clearTimeout(Tr),yt||this.stop(),Ar(xr)},Pn=xr=>{if(xr===Be.CONNECTED)clearTimeout(Tr),Rr();else if(xr===Be.FAILED){const Mr=function({action:qn,token:pn,traceId:Bn,tag:oi}){return new Wn(Object.assign(Object.assign({},vt.PEER_CONNECTION_NETWORK_FAILURE),{token:pn,traceId:Bn,location:"peer-client.connect",tag:oi,action:qn}))}({action:$e,token:Te,traceId:ve,tag:ge});clearTimeout(Tr),Ar(Mr)}},this.on(Xo,_t),this.on(gs,Pn),Mn=()=>{clearTimeout(Tr)},Bt.signal.aborted&&(clearTimeout(Tr),Ar(br)),Bt.signal.addEventListener("abort",()=>{clearTimeout(Tr),Ar(br)})});try{const Rr=yield Promise.all([is(this,void 0,void 0,function*(){yt||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(ae));const cr=Le==null?void 0:Le.assignmentToken,br=Le==null?void 0:Le.nodeOverride;return yield this.exchangeSdp({iceRestart:yt,nodeOverride:br,assignmentToken:cr,abortController:Bt}),this.mediaStream}),Cr]);this.statsReporter.traceId=ve;const Ar=Rr[0];if(this.abortController=void 0,!yt&&$e===kt.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(cr){this.logger.error({err:cr,msg:"error syncing transceivers"})}return{mediaStream:Ar}}catch(Rr){throw Mn&&Mn(),Rr}finally{Er()}}),this.disconnect=(ae=!1)=>is(this,void 0,void 0,function*(){var ve;const{token:Le,action:Te}=this;(ve=this.abortController)===null||ve===void 0||ve.abort(),this.stop(),ae?this.cleanup(Te,Le.participantID,Le,ae):yield this.cleanup(Te,Le.participantID,Le,ae)}),this.onTrack=ae=>{const{token:ve,action:Le,traceId:Te,identifier:ge}=this;this.trace(ve,Te,`onTrack: ${ae.track.kind}`,Le,ge),this.videoSenderTransformer.onTrackEvent(ae),this.videoReceiverTransformer.onTrackEvent(ae)},this.onIceGatheringStateChange=()=>{var ae,ve,Le;const{token:Te,action:ge,traceId:he,identifier:$e}=this;if(((ae=this.peerConnection)===null||ae===void 0?void 0:ae.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((ve=this.peerConnection)===null||ve===void 0?void 0:ve.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const yt=this.peerConnection.iceGatheringState,Bt=new zm(ge,Te,he,yt,$e);this.analyticsTracker.trackEventNoSharedProps(Bt)}this.trace(Te,he,`ICE gathering state change: ${(Le=this.peerConnection)===null||Le===void 0?void 0:Le.iceGatheringState}`,ge,$e)},this.onSelectedCandidatePairChange=()=>{var ae,ve;const{token:Le,action:Te,traceId:ge,identifier:he}=this,$e=(ve=(ae=this.peerConnection)===null||ae===void 0?void 0:ae.getReceivers()[0].transport)===null||ve===void 0?void 0:ve.iceTransport,yt=$e==null?void 0:$e.getSelectedCandidatePair();if(yt){const{local:Bt,remote:_t}=yt,Pn=`Selected candidate pair change (local, remote): ${Bt==null?void 0:Bt.candidate}, ${_t==null?void 0:_t.candidate}`;this.logger.debug({msg:Pn}),this.trace(Le,ge,Pn,Te,he)}},this.onIceCandidate=ae=>is(this,void 0,void 0,function*(){var ve,Le;const{identifier:Te,action:ge,traceId:he}=this,$e=(ve=ae.target.localDescription)===null||ve===void 0?void 0:ve.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new xd(this.token,he,`ice candidate: hasRelay = ${$e}, candidate = ${(Le=ae.candidate)===null||Le===void 0?void 0:Le.candidate}`,ge,Te))}),this.onMute=()=>is(this,void 0,void 0,function*(){const{token:ae,action:ve,traceId:Le,identifier:Te}=this;this.trace(ae,Le,"Track has muted",ve,Te)}),this.onUnMute=()=>is(this,void 0,void 0,function*(){const{token:ae,action:ve,traceId:Le,identifier:Te}=this;this.trace(ae,Le,"Track has unmuted",ve,Te)}),this.fetchAndSetRemoteDescription=ae=>is(this,void 0,void 0,function*(){var ve,Le,Te,ge;const he=(Le=(ve=this.peerConnection)===null||ve===void 0?void 0:ve.localDescription)===null||Le===void 0?void 0:Le.sdp;he||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:$e,traceId:yt,action:Bt,identifier:_t,tag:Pn}=this,{endpointURL:Mn,nodeOverride:Er,assignmentToken:Cr,multiCodec:Rr,abortController:Ar}=ae;let cr;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{this.perfTracker.setTransport(this.sdpExchanger.getTransport());const qn=Er||md("node")||md("dataPlaneEndpoint");cr=yield this.sdpExchanger.exchange({sdpOffer:he,url:Mn,traceId:yt,forceNode:qn,assignmentToken:Cr,multiCodec:Rr,abortController:Ar,initialLayerPreference:(Te=this.simulcastSubscribeConfig)===null||Te===void 0?void 0:Te.initialLayerPreference})}catch(qn){let pn=qn;pn instanceof Wn||(pn=new Wn(Object.assign(Object.assign({},vt.UNEXPECTED_ERROR),{action:Bt,token:$e,traceId:yt,tag:Pn,details:qn instanceof Error?qn.message:"",location:"sdp-exchange"}))),pn instanceof Wn&&(this.analyticsTracker.trackError(pn),this.emit(Xo,pn))}if(this.perfTracker.markSdpExchangeStop(),!cr)return;const{location:br,sessionDeleteLink:Tr,mediaControls:xr}=cr;let Mr=cr.sdpAnswer;try{Mr=this.mungeSdpAnswer(Mr),cr.sdpAnswer=Mr}catch(qn){this.logger.error({err:qn,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=Mr,this.emit(Rc,cr),br&&(this.whipResource={location:br,sessionDeleteLink:Tr,mediaControls:xr},this.sfuResource=function(qn){const pn=qn.match(/https:\/\/([^/]+)\//);if(pn){const Bn=pn[1].split(".");if(Bn[0].includes("video-rtx"))return{node:`${Bn[0]}.${Bn[1]}`,cluster:Bn[1]}}}(br)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(ge=this.peerConnection)===null||ge===void 0?void 0:ge.setRemoteDescription({sdp:Mr,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(qn){const pn=new Wn(Object.assign(Object.assign({},vt.SET_ANSWER_FAILURE),{action:Bt,token:$e,traceId:yt,tag:Xs(Bt,_t),location:"setRemoteDescription",remoteParticipantId:_t,details:qn instanceof Error?qn.message:""}));this.analyticsTracker.trackError(pn),this.emit(Xo,pn)}}),this.cleanup=(ae,ve,Le,Te=!1)=>is(this,void 0,void 0,function*(){var ge,he,$e;const yt=Ls();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,!(!((ge=this.whipResource)===null||ge===void 0)&&ge.location))return this.trace(Le,this.traceId,"whipResource location not known, exiting cleanup",ae,ve),void this.analyticsTracker.trackError(new Wn(Object.assign(Object.assign({},vt.WHIP_URL_MISSING),{action:ae,token:Le,traceId:this.traceId,tag:Xs(ae,ve),location:ae===kt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:yt,remoteParticipantId:ve})));let Bt=this.whipResource.location;if(this.trace(Le,this.traceId,`use hostnamecachedurl: ${Bt}`,ae,ve),Te){if(!(($e=this.whipResource)===null||$e===void 0)&&$e.sessionDeleteLink){Bt=this.whipResource.sessionDeleteLink,this.trace(Le,this.traceId,`DELETE via session-delete beacon path: ${Bt}`,ae,ve);try{navigator.sendBeacon(Bt,JSON.stringify({authorization:Le.rawToken}))}catch(_t){this.analyticsTracker.trackErrorAndThrow(new Wn(Object.assign(Object.assign({},_i(vt.WHIP_DELETE_FAILURE,_t)),{action:ae,token:Le,traceId:this.traceId,tag:Xs(ae,ve),location:kt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:yt,remoteParticipantId:ve})))}}}else try{yield Zi().delete(Bt,{headers:{Authorization:`Bearer ${Le.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":yt.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":Ao}})}catch(_t){((he=_t.response)===null||he===void 0?void 0:he.status)===404?this.trace(Le,this.traceId,`DELETE returned 404, ignoring, action = ${ae}, uuid = ${yt.value}`,ae,ve):this.analyticsTracker.trackErrorAndThrow(new Wn(Object.assign(Object.assign({},_i(vt.WHIP_DELETE_FAILURE,_t)),{action:ae,token:Le,traceId:this.traceId,tag:Xs(ae,ve),location:kt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:yt,remoteParticipantId:ve})))}}),this.getConnectionState=()=>{if(!this.peerConnection)return Be.NONE;const ae=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return G_(ae)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:ae}),Be.IDLE}},this.onIceCandidateError=ae=>{const{token:ve,traceId:Le,tag:Te}=this;if(ae.errorCode!==701){const ge=new Wn(Object.assign(Object.assign({},vt.ICE_CANDIDATE_ERROR),{action:this.action,token:ve,traceId:Le,tag:Te,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(ge),this.emit(Xo,ge)}},this.onIceConnectionStateChange=()=>{var ae;const{token:ve,traceId:Le,action:Te,identifier:ge}=this;this.trace(ve,Le,`ICE connection state change: ${(ae=this.peerConnection)===null||ae===void 0?void 0:ae.iceConnectionState}`,Te,ge),this.onConnectionStateChange()},this.createVideoReceiverTransformer=({enabled:ae})=>{const ve=new Ya({enabled:ae}),{token:Le,tag:Te,identifier:ge,action:he,traceId:$e}=this;ve.on(zd,_t=>{this.emit(Au,_t)});const yt=function(_t,Pn){let Mn=0;return function(...Er){const Cr=Date.now();Cr-Mn>=Pn&&(Mn=Cr,_t(...Er))}}(_t=>{const Pn=`Transform error occurred: ${_t.type}`,Mn=bp({traceId:$e,token:Le,tag:Te,identifier:ge,action:he,details:Pn,stageErrorValue:vt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Mn,msg:"Error encountered when transforming receiver",error:_t})},1e3),Bt=_t=>{const Pn=`Too many errors occurred: ${_t.type}`,Mn=bp({traceId:$e,token:Le,tag:Te,identifier:ge,action:he,details:Pn,stageErrorValue:vt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Mn,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:_t}),ve.destroy(),this.analyticsTracker.trackError(Mn),this.emit(Ve,Mn)};return ve.on(Oh,_t=>{_t.stageErrorValue.code!==vt.TRANSFORM_TOO_MANY_ERRORS.code?yt(_t):Bt(_t)}),ve},this.onConnectionStateChange=()=>{var ae;if(this.peerConnection){const Le=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:Te,traceId:ge,identifier:he,action:$e}=this,yt=new Ys($e,Te,ge,Le,he);this.analyticsTracker.trackEventNoSharedProps(yt),this.trace(Te,ge,`connection state change: ${Le}`,$e,he)}const ve=this.getConnectionState();switch(ve){case Be.CONNECTED:this.perfTracker.markActionStop(),this.emit(gs,ve),this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub),(ae=this.peerConnection)===null||ae===void 0||ae.getTransceivers().forEach(Le=>{var Te,ge;!((ge=(Te=Le.receiver)===null||Te===void 0?void 0:Te.transport)===null||ge===void 0)&&ge.iceTransport&&Le.receiver.transport.iceTransport.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)});break;case Be.FAILED:this.emit(gs,ve),this.handleConnectionFailure();break;default:this.emit(gs,ve)}},this.onIncompatibleCodecs=ae=>is(this,void 0,void 0,function*(){if(ae.forEach(Te=>{let ge=!1;this.incompatibleCodecs.forEach(he=>{he.config===Te.config&&he.mime===Te.mime&&(ge=!0)}),ge||this.incompatibleCodecs.add(Te)}),this.peerConnection)try{yield(ve=this.peerConnection,Le=[...this.incompatibleCodecs],Ad(void 0,void 0,void 0,function*(){var Te;for(const ge of ve.getSenders()){const he=ge.getParameters();if(he.codecs.length>1){const $e=he.codecs[0];let yt=!1;for(const Bt of Le)l0($e,Bt)&&(yt=!0);if(yt){const Bt=Gm(Le,he.codecs);(Te=he.encodings)===null||Te===void 0||Te.forEach(_t=>{_t.active&&(_t.codec=Bt)}),yield ge.setParameters(he)}}}}))}catch(Te){const{token:ge,action:he,traceId:$e,identifier:yt}=this,Bt=new Wn(Object.assign(Object.assign({},vt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:he,token:ge,traceId:$e,tag:Xs(he,yt),location:"onIncompatibleCodecs",remoteParticipantId:yt,details:Te instanceof Error?Te.message:""}));this.analyticsTracker.trackError(Bt),this.emit(Xo,Bt)}var ve,Le}),this.token=v,this.logger=new Ns(E,Ft.WEBRTC),this.action=w,this.tag=M,this.traceId=k,w===kt.SUBSCRIBE&&!q)throw new Error("Subscribe action provided without subscriber Id");this.inBandMessagingEnabled=w===kt.SUBSCRIBE?!!(!((ee=j==null?void 0:j.inBandMessaging)===null||ee===void 0)&&ee.enabled):(se=ql("enableInBandMessaging"))!==null&&se!==void 0&&se,this.jitterBufferConfig=j==null?void 0:j.jitterBuffer,this.simulcastSubscribeConfig=j==null?void 0:j.simulcast,this.subscriberId=q,this.stageConnection=Z,this.videoSenderTransformer=new Qo({enabled:this.action===kt.PUBLISH&&this.inBandMessagingEnabled}),this.videoReceiverTransformer=this.createVideoReceiverTransformer({enabled:this.action===kt.SUBSCRIBE&&this.inBandMessagingEnabled}),this.perfTracker=new c0(this.action,this.traceId),this.statsReporter=new Nd(w,v,k,this.identifier,this.analyticsTracker,this.videoReceiverTransformer),this.sdpExchanger=function(ae){const{connection:ve,token:Le,action:Te,identifier:ge,tracker:he}=ae,$e=ve&&ve.supportsSdpExchange(),yt=Te===kt.SUBSCRIBE&&$e&&!$f(),Bt=Te===kt.PUBLISH&&$e&&wu()&&!$f();return yt||Bt?new ns(Le,ve,{action:Te,remoteParticipantId:ge},he):new rs(Le,{action:Te,remoteParticipantId:ge},he)}({connection:Z,action:w,token:v,identifier:this.identifier,tracker:P}),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var v,E;return(E=(v=this.videoTransceiver)===null||v===void 0?void 0:v.mid)!==null&&E!==void 0?E:null}toggleStageConnectionListeners(v){var E,w;v?(E=this.stageConnection)===null||E===void 0||E.on(Ed,this.handlePublishingChangedBinding):(w=this.stageConnection)===null||w===void 0||w.off(Ed,this.handlePublishingChangedBinding)}updateSubscribeConfig(v){var E,w;this.jitterBufferConfig=v.jitterBuffer,this.simulcastSubscribeConfig=v.simulcast,this.action===kt.SUBSCRIBE&&(this.inBandMessagingEnabled=v.inBandMessaging.enabled),this.applyJitterBufferMinDelayConditionally((w=(E=this.stageConnection)===null||E===void 0?void 0:E.getIsStagePublishing())!==null&&w!==void 0&&w)}verifyOrUpdateTransceiverSync(){var v,E;return is(this,void 0,void 0,function*(){if(this.videoTrackForPub){const w=this.getTransceiverForKind("video");w?this.videoTrackForPub.track.id!==((v=w.sender.track)===null||v===void 0?void 0:v.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateTrack(this.videoTrackForPub)):this.logger.warn({msg:"missing transceiver for video"})}if(this.audioTrackForPub){const w=this.getTransceiverForKind("audio");w?this.audioTrackForPub.track.id!==((E=w.sender.track)===null||E===void 0?void 0:E.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateTrack(this.audioTrackForPub)):this.logger.warn({msg:"missing transceiver for audio"})}})}start(){var v,E,w;return is(this,void 0,void 0,function*(){const{token:M,action:k,traceId:P,identifier:q}=this;k!==kt.PUBLISH||M.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Wn(Object.assign(Object.assign({},_i(vt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:k,token:M,traceId:P,tag:Xs(k,q),location:"StagePeerClient.start",remoteParticipantId:q})));const Z=function({action:j,identifier:ee,token:se,analyticsTracker:ae}){let ve="";const Le=Dc(se,ae);switch(j){case kt.PUBLISH:ve=Le.getPublishEndpoint();break;case kt.SUBSCRIBE:ee&&(ve=Le.getSubscribeEndpoint(ee))}return ve}({action:k,identifier:q,token:M.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.stageCapabilities={simulcastNegotiated:(w=(E=(v=this.videoTrackForPub)===null||v===void 0?void 0:v.config)===null||E===void 0?void 0:E.simulcastEnabled)!==null&&w!==void 0&&w},this.endpointURL=Z,this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,this.stageCapabilities.simulcastNegotiated),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute),this.trace(M,P,"peer connection created",k,q)}catch(j){const ee=new Wn(Object.assign(Object.assign({action:k},_i(vt.CREATE_PEER_CONNECTION_FAILURE,j)),{token:M,traceId:P,tag:Xs(k,q),location:"StagePeerClient.start",remoteParticipantId:q}));k===kt.PUBLISH&&this.emit(gs,Be.FAILED),this.emit(Xo,ee),this.analyticsTracker.trackErrorAndThrow(ee)}})}mungeSdpOffer(v,E,w){if(w.simulcastNegotiated&&(v=new vi(v).withVideoLayersAllocationRtpHeaderExtension().sdp),E===kt.SUBSCRIBE)v=new vi(v).withOpusAudioConfig(fo(ho),!0).sdp;else if(E===kt.PUBLISH&&w.audioConfig){const{maxBitrateBps:M,stereo:k}=w.audioConfig;v=new vi(v).withOpusAudioConfig(M,k).sdp}return v}mungeSdpAnswer(v){return Io.browser.isFirefox()&&this.audioTrackForPub&&this.action===kt.PUBLISH&&(v=new vi(v).withOpusAudioConfig(this.audioTrackForPub.config.maxBitrateBps,void 0).sdp),v}stop(){var v,E,w,M,k,P,q,Z,j;this.statsReporter.stop(),this.videoReceiverTransformer.destroy(),this.videoSenderTransformer.destroy(),(v=this.peerConnection)===null||v===void 0||v.removeEventListener("connectionstatechange",this.onConnectionStateChange),(E=this.peerConnection)===null||E===void 0||E.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(w=this.peerConnection)===null||w===void 0||w.removeEventListener("icecandidateerror",this.onIceCandidateError),(M=this.peerConnection)===null||M===void 0||M.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(k=this.peerConnection)===null||k===void 0||k.removeEventListener("track",this.onTrack),(P=this.peerConnection)===null||P===void 0||P.removeEventListener("mute",this.onMute),(q=this.peerConnection)===null||q===void 0||q.removeEventListener("unmute",this.onUnMute),(Z=this.peerConnection)===null||Z===void 0||Z.removeEventListener("icecandidate",this.onIceCandidate),(j=this.peerConnection)===null||j===void 0||j.close()}getTransceiverForKind(v){if(!this.peerConnection)return;const E=this.peerConnection.getTransceivers();return v==="audio"?E.find(w=>w.mid==="0"):v==="video"?E.find(w=>w.mid==="1"):void 0}removeTrack(v){return is(this,void 0,void 0,function*(){if(v==="audio"||v==="video")if(this.peerConnection)try{const E=this.getTransceiverForKind(v);if(!E)return void this.logger.warn({msg:`tried removing track type ${v} but couldn't find transceiver`});yield E.sender.replaceTrack(null),v===_l.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0,yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(E){this.logger.warn({msg:"error replacing track",err:E})}else v===_l.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:v})})}replaceOrUpdateTrack(v){return is(this,void 0,void 0,function*(){if(v.track){if(Ta(v)?this.audioTrackForPub=v:Uu(v)&&(this.videoTrackForPub=v),this.peerConnection)try{const E=this.getTransceiverForKind(v.track.kind);if(!E)return void this.logger.warn({msg:`tried replacing track type ${v.track.kind} but couldn't find transceiver`,track:v.track});if(Uu(v)){const w=E.sender.getParameters(),M=Lc(this.stageCapabilities.simulcastNegotiated,v);w.encodings=w.encodings.map(k=>{var P;const q=(P=k.rid)!==null&&P!==void 0?P:"",Z=M.find(j=>{var ee;return((ee=j.rid)!==null&&ee!==void 0?ee:"")===q});return Z?Object.assign(Object.assign({},k),Z):k}),yield E.sender.setParameters(w)}else if(Ta(v)){const w=E.sender.getParameters(),M=wh(v)[0];w.encodings=w.encodings.map(k=>Object.assign(Object.assign({},k),M)),yield E.sender.setParameters(w)}yield E.sender.replaceTrack(v.track),yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(E){this.logger.warn({msg:"error replacing track",err:E})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateTrack with no track"})})}initializePeerConnection(v=!1){var E,w,M;return is(this,void 0,void 0,function*(){const{traceId:k,token:P,action:q,identifier:Z}=this;ac(this.peerConnection);let j=new MediaStream;if(q===kt.PUBLISH){this.audioTrackForPub||(this.audioTrackForPub={track:this.getSilentAudio(),config:{maxBitrateBps:fo(lp),stereo:!1}});const ee=this.peerConnection.getTransceivers(),se=[];ee.forEach(he=>{var $e;se.concat(($e=he.sender.track)===null||$e===void 0?void 0:$e.id)}),j=new MediaStream([this.audioTrackForPub.track,(E=this.videoTrackForPub)===null||E===void 0?void 0:E.track].filter(he=>!!he&&!se.includes(he.id)));const ae=j.getAudioTracks()[0]||"audio",ve=j.getVideoTracks()[0]||"video",Le={direction:"sendonly",streams:[j],sendEncodings:wh(this.audioTrackForPub)},Te={direction:"sendrecv",streams:[j],sendEncodings:Lc(this.stageCapabilities.simulcastNegotiated,this.videoTrackForPub)};this.peerConnection.addTransceiver(ae,Le),this.trace(P,k,`track added, type: ${ae.kind||ae}`,q,Z);const ge=this.peerConnection.addTransceiver(ve,Te);this.trace(P,k,`track added, type: ${ve.kind||ve}`,q,Z),this.inBandMessagingEnabled&&!Qo.isSupported(ge)&&this.handleTransformNotSupported(),this.videoSenderTransformer.onTransceiverAdd(ge)}else q===kt.SUBSCRIBE&&(P.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(P,k,"track added, type: audio",q,Z),v||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(P,k,"track added, type: video",q,Z),this.inBandMessagingEnabled&&!Ya.isSupported(this.videoTransceiver)&&this.handleTransformNotSupported(),this.videoReceiverTransformer.onTransceiverAdd(this.videoTransceiver)),this.peerConnection.getTransceivers().forEach(ee=>{ee.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),j==null||j.addTrack(ee.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})}),this.applyJitterBufferMinDelayConditionally((M=(w=this.stageConnection)===null||w===void 0?void 0:w.getIsStagePublishing())!==null&&M!==void 0&&M));return j})}handlePublishingChanged(v){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${v}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===kt.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(v)}applyJitterBufferMinDelayConditionally(v){const E=this.currentJitterBufferMinDelayInMs,w=this.calcJitterBufferMinDelay(v,this.jitterBufferConfig);if(v){if(E===void 0||E>w){const M=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${w}`;this.logger.debug({msg:M}),this.trace(this.token,this.traceId,M,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(w)}}else if(E===void 0||w!==E){const M=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${w}`;this.logger.debug({msg:M}),this.trace(this.token,this.traceId,M,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(w)}}calcJitterBufferMinDelay(v,E){var w,M,k;let P=0;if(!(()=>{const q=RTCRtpReceiver.prototype;return!(!q||typeof q!="object")&&("jitterBufferTarget"in q||"playoutDelayHint"in q)})())return 0;if(v)P=Xi((w=E==null?void 0:E.minDelayWhenPublishing)!==null&&w!==void 0?w:es.DEFAULT,v);else{P=Xi((M=E==null?void 0:E.minDelayWhenSubscribeOnly)!==null&&M!==void 0?M:es.DEFAULT,v);const q=(k=this.stageConnection)===null||k===void 0?void 0:k.jitterBufferMinDelayInMs();(E==null?void 0:E.minDelayWhenSubscribeOnly)===es.DEFAULT&&q!==void 0&&(P=q,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${P}`}))}return P}applyAndTrackJitterBufferMinDelay(v){var E,w;this.currentJitterBufferMinDelayInMs=v,this.statsReporter.updateJitterBufferMinDelay(v),v!==void 0&&((w=(E=this.peerConnection)===null||E===void 0?void 0:E.getTransceivers())===null||w===void 0||w.forEach(M=>{M.receiver&&this.applyJitterBufferMinDelay(M.receiver,v)}))}applyJitterBufferMinDelay(v,E){let w="Unable to set jitter buffer min delay";if("jitterBufferTarget"in v)w=`setting jitterBufferTarget to: ${E} for track: ${v.track.kind}`,this.logger.debug({msg:w}),v.jitterBufferTarget=E;else if("playoutDelayHint"in v){const M=E/1e3;w=`setting playoutDelayHint to: ${E} for track: ${v.track.kind}`,this.logger.debug({msg:w}),v.playoutDelayHint=M}else this.logger.warn({msg:w});this.trace(this.token,this.traceId,w,this.action,this.identifier)}exchangeSdp(v){var E;return is(this,void 0,void 0,function*(){const{traceId:w,token:M,action:k,identifier:P,tag:q,endpointURL:Z}=this,{iceRestart:j=!1,nodeOverride:ee,assignmentToken:se,abortController:ae}=v;let ve;this.logger.debug({msg:`Exchanging SDP: ${w.value}, iceRestart=${j}, nodeOverride=${ee}, assignmentToken=${se}`}),ac(this.peerConnection),k===kt.PUBLISH&&qo()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((Te,ge)=>{var he,$e;const yt=(he=RTCRtpReceiver.getCapabilities("video"))===null||he===void 0?void 0:he.codecs;if(!yt)return;let Bt=yt;Bt=Js(yt,"42e0"),ge.preferMainProfile&&(Bt=Js(yt,"4d00")),($e=Te.getTransceivers().find(_t=>_t.receiver.track.kind==="video"))===null||$e===void 0||$e.setCodecPreferences(Bt)})(this.peerConnection,{preferMainProfile:qo()}));try{this.trace(M,w,"Creating offer",k,P),ve=yield this.peerConnection.createOffer({iceRestart:j})}catch(Te){const ge=new Wn(Object.assign(Object.assign({},_i(vt.CREATE_OFFER_FAILURE,Te)),{action:k,token:M,traceId:w,tag:q,location:"exchangeSdp",remoteParticipantId:P}));this.emit(Xo,ge),this.analyticsTracker.trackErrorAndThrow(ge)}ve.sdp&&(ve.sdp=this.mungeSdpOffer(ve.sdp,k,{simulcastNegotiated:this.stageCapabilities.simulcastNegotiated,audioConfig:(E=this.audioTrackForPub)===null||E===void 0?void 0:E.config})),this.trace(M,w,"Setting local description",k,P),yield this.peerConnection.setLocalDescription(ve),this.trace(M,w,"local description set",k,P),Z||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const Le=k===kt.PUBLISH&&qo()||k===kt.SUBSCRIBE&&ql("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:Z,nodeOverride:ee,assignmentToken:se,multiCodec:Le,abortController:ae})})}getReports(){var v;return is(this,void 0,void 0,function*(){try{const E=(yield(v=this.peerConnection)===null||v===void 0?void 0:v.getStats())||[],w=[];return E.forEach(M=>{w.push(M)}),w}catch{return[]}})}requestRTCStats(v){return is(this,void 0,void 0,function*(){if(this.peerConnection)return this.peerConnection.getStats(v)})}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:v,tag:E,identifier:w,action:M,traceId:k}=this,P=bp({traceId:k,token:v,tag:E,identifier:w,action:M,stageErrorValue:vt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:P,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(P),this.emit(Ve,P)}handleConnectionFailure(){return is(this,void 0,void 0,function*(){const{token:v,traceId:E,tag:w}=this;this.analyticsTracker.trackError(new Wn(Object.assign(Object.assign({},vt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:v,traceId:E,tag:w,location:"onIceCandidateError",remoteParticipantId:this.identifier})))})}getSilentAudio(){zs||(zs=new AudioContext);const v=zs.createOscillator(),E=zs.createGain();v.connect(E);const w=zs.createMediaStreamDestination();return E.connect(w),E.gain.value=0,v.start(),w.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}initTracksToPublish(v){this.videoTrackForPub=v.find(Uu),this.audioTrackForPub=v.find(Ta)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var v,E;return this.calcJitterBufferMinDelay((E=(v=this.stageConnection)===null||v===void 0?void 0:v.getIsStagePublishing())!==null&&E!==void 0&&E,this.jitterBufferConfig)}trace(v,E,w,M,k){this.analyticsTracker.trackEventNoSharedProps(new xd(v,E,w,M,k))}sendSeiMessage(v){var E;this.action===kt.PUBLISH&&((E=this.videoSenderTransformer)===null||E===void 0||E.sendSeiMessage(v))}}const xp=kt.SUBSCRIBE;class hc{constructor(v,E,w){this.analyticsTracker=v,this.token=E,this.remoteId=w,this.action=xp}trackAttempt({stageConnectionStats:v,isReassignment:E=!1,traceIdOverride:w,preAttemptSfuResource:M}){const{action:k,analyticsTracker:P,token:q,remoteId:Z}=this,j=w||Us();return P.trackEvent(new Lu({token:this.token,subscribedId:this.remoteId,traceId:j,isEdpConnected:v.isConnected,isReassignment:E,preAttemptSfuResource:M})),{getTraceId:()=>j,trackSubscribeStarted({totalDurationWithRetries:ee,retryTimes:se,sfuResource:ae,peerClientPerfStats:ve}){const{optionsDuration:Le,postDuration:Te,timeToCandidate:ge,timeToConnected:he,sdpExchangeDuration:$e,sdpExchangeTransport:yt,setRemoteDescDuration:Bt,peerConnectionDuration:_t}=ve,{edpInitialConnectDuration:Pn,edpInitialConnectRetries:Mn,edpInitialStateDuration:Er,edpInitialStatePublishingCount:Cr,edpStateUpdateCount:Rr}=v;P.trackEvent(new gp({token:q,traceId:j,remoteParticipantId:Z,optionsDuration:Le,postDuration:Te,timeToCandidate:ge,totalDuration:he,edpInitialConnectDuration:Pn,edpInitialConnectRetries:Mn,edpInitialStateDuration:Er,edpInitialStatePublishingCount:Cr,edpStateUpdateCount:Rr,sdpExchangeDuration:$e,sdpExchangeTransport:yt,setRemoteDescDuration:Bt,peerConnectionDuration:_t,sfuResource:ae,totalDurationWithRetries:ee,subscribeRetryTimes:se,isReassignment:E}))},trackSubscribeFirstFrame:({peerClientPerfStats:ee,totalDurationWithRetries:se,sfuResource:ae,retryTimes:ve,currentJitterBufferMinDelayInMs:Le,mediaType:Te,firstFrameDuration:ge})=>{const{sdpExchangeDuration:he,sdpExchangeTransport:$e,setRemoteDescDuration:yt,peerConnectionDuration:Bt}=ee,{edpInitialConnectDuration:_t,edpInitialConnectRetries:Pn,edpInitialStateDuration:Mn,edpInitialStatePublishingCount:Er,edpStateUpdateCount:Cr}=v;this.analyticsTracker.trackEvent(new m0({token:this.token,traceId:j,remoteParticipantId:Z,edpInitialConnectDuration:_t,edpInitialConnectRetries:Pn,edpInitialStateDuration:Mn,edpInitialStatePublishingCount:Er,edpStateUpdateCount:Cr,sdpExchangeDuration:he,sdpExchangeTransport:$e,setRemoteDescDuration:yt,peerConnectionDuration:Bt,videoWasPaused:!1,firstFrameDuration:ge,mediaType:Te,sfuResource:ae,totalDurationWithRetries:se,subscribeRetryTimes:ve,currentJitterBufferMinDelayInMs:Le}))},trackSubscribeFailed(ee,se){const ae=((Te,ge,he)=>{if(Te instanceof Wn)return Te;let $e="";return Te instanceof Xr.AxiosError&&($e+=`AxiosError - ${Te.code}`),new Wn(Object.assign(Object.assign(Object.assign({},vt.SUBSCRIBE_FAILURE),{action:xp,token:ge,traceId:he,tag:Ga.SUBSCRIBE_RELATED,location:"subscribe",details:`${$e} ${Te==null?void 0:Te.message}`}),{fatal:!0}))})(ee,q,j);P.trackEvent(new p0({token:q,traceId:j,remoteParticipantId:Z,code:ae.code,message:ae.message,fatal:ae.fatal,nominal:ae.nominal,isReassignment:E}));const{isConnected:ve}=v,Le=new Wn(Object.assign(Object.assign({},vt.SUBSCRIBE_FAILURE),{action:k,token:q,traceId:j,tag:Xs(kt.SUBSCRIBE,Z),location:"subscribe",remoteParticipantId:Z,isEdpConnected:ve,details:se}));return ee instanceof Wn&&(Le.fatal=ee.fatal,Le.nominal=ee.nominal,Le.location=`subscribe > ${ee.location}`),P.trackError(Le),ae},trackUnsubscribe:()=>{P.trackEvent(new f0({token:q,unsubscribedId:Z,traceId:j}))},trackEndSucceeded:ee=>{P.trackEvent(new Qm({token:q,traceId:j,remoteParticipantId:Z,isUnsubscribeSuccessful:!0,reason:ee}))},trackEndFailed:ee=>{const se=new Wn(Object.assign(Object.assign({},vt.UNSUBSCRIBE_FAILURE),{token:q,traceId:j,tag:Xs(kt.SUBSCRIBE,Z),location:"unsubscribe",remoteParticipantId:Z}));return ee!==_s.UNLOAD&&ee!==_s.UNSUBSCRIBE||P.trackError(se),P.trackEvent(new Qm({token:q,traceId:j,remoteParticipantId:Z,isUnsubscribeSuccessful:!0,reason:ee})),se}}}}class Nh extends ar{constructor(v,E,w,M,k,P){super(an.PLAYBACK_LAYER_REQUEST,v,E,!1),Object.assign(this.properties,{media_type:w,remote_participant_id:M,track_id:k,layer_id:P})}}class iu extends ar{constructor(v,E,w,M,k,P=1){super(an.PLAYBACK_LAYER_STATE,v,E,!1),Object.assign(this.properties,{media_type:w,remote_participant_id:M,track_id:k,request_count:P})}}var jd,Vs,Hd,Oi;(function(x){x.PAUSE="pause",x.PLAY="play"})(jd||(jd={})),function(x){x.IDLE="idle",x.ACTIVE="active",x.ERRORED="errored",x.DESTROYED="destroyed"}(Vs||(Vs={})),function(x){x.SUCCESS="success"}(Hd||(Hd={})),function(x){x.FAILED="failed",x.DESTROYED="destroyed",x.THROTTLED="throttled"}(Oi||(Oi={}));var Fc=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class _0{constructor(v){this.state=Vs.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>Fc(this,void 0,void 0,function*(){return this.state!==Vs.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(jd.PAUSE)}),this.startVideo=()=>Fc(this,void 0,void 0,function*(){return this.state!==Vs.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(jd.PLAY)}),this.setLayer=E=>Fc(this,void 0,void 0,function*(){return this.state!==Vs.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(E)}),this.unsetLayer=()=>Fc(this,void 0,void 0,function*(){return this.state!==Vs.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()}),this.getLayers=()=>Fc(this,void 0,void 0,function*(){return this.state!==Vs.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()}),this.sendPlaybackRequest=E=>Fc(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,bn.err)(Oi.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,bn.err)(Oi.FAILED);this.logger.info({msg:`Sending ${E} request to ${this.playbackEndpoint}`});const w=E===jd.PAUSE?{pause:[this.mid]}:{play:[this.mid]},M=this.createPostWhepRequest(w);return fetch(this.playbackEndpoint,M).then(k=>k.status>=300?(new Error(`Error sending media controls request: ${k.status}:${k.statusText}`),this.logger.error({err:bn.err}),(0,bn.err)(Oi.FAILED)):(this.logger.debug({msg:`Request to ${E} was successful: ${k.status}`}),(0,bn.ok)(Hd.SUCCESS))).catch(k=>(this.logger.error({err:k,msg:"Error sending media controls request"}),(0,bn.err)(Oi.FAILED)))}),this.sendLayerRequest=E=>Fc(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,bn.err)(Oi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,bn.err)(Oi.FAILED);const w=typeof E=="string",M=w?{mediaId:this.mid,encodingId:E}:{},k=w?`set : ${E}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${k} at ${this.layersEndpoint}`});const P=this.createPostWhepRequest(M);return this.trackLayerRequest(E??"auto"),fetch(this.layersEndpoint,P).then(q=>this.state===Vs.DESTROYED?(0,bn.err)(Oi.DESTROYED):q.status>=300?this.handleLayerRequestError(q.status,q.statusText):(this.logger.debug({msg:`Request to ${k} was successful: ${q.status}`}),(0,bn.ok)(Hd.SUCCESS))).catch(q=>this.handleLayerRequestError(0,q.message))}),this.sendLayerStateRequest=()=>Fc(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,bn.err)(Oi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,bn.err)(Oi.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const E=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,E).then(w=>Fc(this,void 0,void 0,function*(){var M;if(this.state===Vs.DESTROYED)return(0,bn.err)(Oi.DESTROYED);if(w.status>=300)return this.handleLayerStateRequestError(w.status,w.statusText);const k=yield w.json(),P=(M=k==null?void 0:k.layers)!==null&&M!==void 0?M:[],q=JSON.stringify(P,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${q}`}),(0,bn.ok)(P)})).catch(w=>this.handleLayerStateRequestError(0,w.message))}),this.logger=new Ns(v.logger,Ft.REMOTE_PLAYBACK),this.token=v.token,this.traceId=v.traceId,this.analyticsTracker=v.analyticsTracker,this.remoteParticipantId=v.remoteParticipantId}set mediaId(v){if(this.state!==Vs.DESTROYED){if(this.mid=v,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Vs.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Vs.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(v){var E,w;if(this.state!==Vs.DESTROYED){if(this.playbackEndpoint=(E=v.playback)!==null&&E!==void 0?E:null,this.layersEndpoint=(w=v.layers)!==null&&w!==void 0?w:null,!this.playbackEndpoint||!this.layersEndpoint){const M={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(M,null)}`}),void(this.state=Vs.IDLE)}this.mid&&(this.state=Vs.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Vs.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(v="command"){this.logger.info({msg:`skipping ${v}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(v){return v===Vs.DESTROYED?(0,bn.err)(Oi.DESTROYED):(0,bn.err)(Oi.FAILED)}createPostWhepRequest(v){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(v)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var v,E;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Ls().value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(E=(v=this.traceId)===null||v===void 0?void 0:v.value)!==null&&E!==void 0?E:"","X-Stages-WHIP-Version":Ao}}trackLayerRequest(v){var E;this.analyticsTracker.trackEventNoSharedProps(new Nh(this.token,this.traceId,Ct.VIDEO,this.remoteParticipantId,(E=this.mid)!==null&&E!==void 0?E:"unknown",v))}trackLayerStateRequest(v=1){var E;this.analyticsTracker.trackEventNoSharedProps(new iu(this.token,this.traceId,Ct.VIDEO,this.remoteParticipantId,(E=this.mid)!==null&&E!==void 0?E:"unknown",v))}handleLayerRequestError(v,E){const w=`sendLayerRequest failed for reason: ${v} ${E}`;let M,k;return v===429?(M=Oi.THROTTLED,k=vt.WHEP_SET_LAYER_REQUEST_THROTTLED):(M=Oi.FAILED,k=vt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(k,w),(0,bn.err)(M)}handleLayerStateRequestError(v,E){const w=`sendLayerStateRequest failed for reason: ${v} ${E}`;let M,k;return v===429?(M=Oi.THROTTLED,k=vt.WHEP_GET_LAYER_STATE_THROTTLED):(M=Oi.FAILED,k=vt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(k,w),(0,bn.err)(M)}trackRequestError(v,E){const w=new Error(E);this.logger.error({err:w}),v.message=E;const M=this.createError(v);this.analyticsTracker.trackError(M)}createError(v,E){return new Wn(Object.assign({action:kt.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:Ga.SUBSCRIBE_RELATED,details:E},v))}}var Bu,Ph,Zo,No,Qs=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})},tg=function(x,v,E,w){if(E==="a"&&!w)throw new TypeError("Private accessor was defined without a getter");if(typeof v=="function"?x!==v||!w:!v.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?w:E==="a"?w.call(x):w?w.value:v.get(x)};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(Zo||(Zo={})),function(x){x.NONE="none",x.AUDIO_ONLY="audio_only",x.AUDIO_VIDEO="audio_video"}(No||(No={}));class zu extends qs{constructor(v,E,w,M,k,P,q){super(),this.id=v,this.token=E,this.stageConnection=w,this.nonScopedLogger=M,this.analyticsTracker=k,this.desiredSubscribeType=P,Bu.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:Zo.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new Fm(1e3),this.cleanupFirstFrameTracking=ap,this.actualSubscribeType=No.NONE,this.action=kt.SUBSCRIBE,this.updateDesiredSubscribeType=j=>{this.desiredSubscribeType=j,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=j=>{this.peerClient.updateSubscribeConfig(j)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const j=this.actualSubscribeType,ee=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${ee}`}),this.subscriptionState.connectionState===Zo.CONNECTED&&ee!==No.NONE&&j!==ee&&this.applyVideoControlsBySubscribeType(ee,j)},this.onParticipantUpdated=j=>{tg(this,Bu,"m",Ph).call(this,j)&&(this.logger.debug({msg:"onParticipantUpdated",participant:j}),this.processStateUpdate({isTargetPublishing:j.isPublishing}))},this.onParticipantJoined=j=>{tg(this,Bu,"m",Ph).call(this,j)&&(this.logger.debug({msg:"onParticipantJoined",participant:j}),this.processStateUpdate({isTargetPublishing:j.isPublishing}))},this.onParticipantLeft=j=>{tg(this,Bu,"m",Ph).call(this,j)&&(this.logger.debug({msg:"onParticipantLeft",participant:j}),this.processStateUpdate({isTargetPublishing:!1}))},this.requestRTCStats=j=>Qs(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(j)}),this.trySubscribe=j=>Qs(this,void 0,void 0,function*(){if(this.logger.debug({msg:`Subscribe attempt started: ${j}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==Zo.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:Zo.CONNECTING}));const ee=this.stageConnection.getConnectionStats(),se=this.peerClient.getExpectedJitterBufferMinDelayInMs(),ae=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:ee,preAttemptSfuResource:ae});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:ve}=yield this.subscribe(this.attemptTracker.getTraceId()),Le=performance.now()-this.startConnectingTimestamp,Te=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const ge=this.failedRetries;this.attemptToActualizeSubscribeType();const he=this.peerClient.getActionMeasurements();if(this.attemptTracker.trackSubscribeStarted({sfuResource:Te,totalDurationWithRetries:Le,retryTimes:ge,peerClientPerfStats:he}),ve){this.cleanupFirstFrameTracking();const $e=this.actualSubscribeType,yt=this.attemptTracker,Bt=(_t,Pn)=>{yt.trackSubscribeFirstFrame({peerClientPerfStats:he,sfuResource:Te,totalDurationWithRetries:Le,retryTimes:ge,currentJitterBufferMinDelayInMs:se,mediaType:Pn,firstFrameDuration:_t})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:ve,subscribeType:$e,callback:Bt})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,ve&&this.emit(ce,ve,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(ve){const Le=this.attemptTracker.trackSubscribeFailed(ve);this.logger.error({log:"Subscribe attempt failed",err:ve}),this.onTrySubscribeFailure(Le,j)}return!1});const Z=Us();this.peerClient=new Vd(E,this.nonScopedLogger,this.action,Xs(this.action,v),Z,k,v,w,q),this.logger=new Ns(M,Ft.SUBSCRIPTION),this.subscribeTracker=new hc(this.analyticsTracker,E,v),this.remotePlaybackController=new _0({token:E,analyticsTracker:k,traceId:Z,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(v,E){try{v===No.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch(w=>{this.logger.error({err:w,msg:"Remote playback request to stop video failed"})}):v===No.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch(w=>{this.logger.error({err:w,msg:"Remote playback request to start video failed"})}),this.actualSubscribeType=v,this.logger.debug({msg:`Desired subscribe type actualized from ${E} to ${v}.`})}catch(w){this.logger.error({err:w,msg:`Error updating subscribe type from ${E} to ${v}.`})}}onPeerClientConnectionStateChange(v){const E=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${v}`,state:v,targetParticipant:E}),this.processStateUpdate({peerClientState:v})}onPeerClientTransformError(v){this.emit(As,v)}processStateUpdate(v){const E=this.previousSignalState,w=Object.assign({},E,v);this.isSubscriptionActive?(w.isTargetPublishing?v.peerClientState===Be.CONNECTED?this.updateState({connectionState:Zo.CONNECTED,subscribeInProgress:!0}):v.peerClientState===Be.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(_s.CONNECTION_FAIL),this.updateState({subscribeInProgress:!1})):(E.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:Zo.DISCONNECTED})),(!E.isTargetPublishing&&v.isTargetPublishing||v.peerClientState===Be.FAILED)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,v)):this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"})}onTrySubscribeFailure(v,E){this.logger.debug({msg:"Changing/keeping state FAILED"});const w=v.fatal,M=v.code===vt.OPERATION_ABORTED.code,k=this.failedRetries<=4;if(!M&&!w&&k){const P=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${P}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout(()=>Qs(this,void 0,void 0,function*(){this.throttledTrySubscribe(E)}),P)}else this.updateState({connectionState:Zo.ERRORED}),this.emit(Ro,v),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(gs,this.onPeerClientConnectionStateChange,this),this.peerClient.on(Rc,E=>{this.remotePlaybackController.endpoints={playback:E.mediaControls,layers:E.layerControls}}),this.peerClient.on(Au,E=>{this.emit(Sa,E)}),this.peerClient.on(Ve,this.onPeerClientTransformError,this),this.stageConnection.on(vs,this.onParticipantUpdated),this.stageConnection.on(Wa,this.onParticipantJoined),this.stageConnection.on(Ei,this.onParticipantLeft),this.stageConnection.on(qi,this.onParticipantLeft);let v=!0;if(this.stageConnection.isConnected()){const E=this.stageConnection.getParticipant(this.id);v=!!(E!=null&&E.isPublishing)}this.processStateUpdate({isTargetPublishing:v})}throttledTrySubscribe(v){return this.throttler.invoke(this.trySubscribe,v)}updateState(v){v.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=v.subscribeInProgress),v.connectionState&&this.subscriptionState.connectionState!==v.connectionState&&(this.subscriptionState.connectionState=v.connectionState,this.emit(bd,this.subscriptionState.connectionState))}stop(v=!1){this.peerClient.off(gs,this.onPeerClientConnectionStateChange,this),this.peerClient.off(Ve,this.onPeerClientTransformError,this),this.unsubscribe(v),this.throttler.clear(),this.stageConnection.off(vs,this.onParticipantUpdated),this.stageConnection.off(Wa,this.onParticipantJoined),this.stageConnection.off(Ei,this.onParticipantLeft),this.stageConnection.off(qi,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:Zo.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(v,E){return Qs(this,void 0,void 0,function*(){const{token:w,id:M}=this;w.assertTokenIsUnexpired(v,Xs(kt.SUBSCRIBE,M),"subscribe",M);const{mediaStream:k}=yield this.peerClient.connect({audioOnly:E,traceId:v});return{peerClient:this.peerClient,mediaStream:k}})}unsubscribe(v=!1){return Qs(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===Zo.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const E=v?_s.UNLOAD:_s.UNSUBSCRIBE;try{v?this.peerClient.disconnect(v):yield this.peerClient.disconnect(v),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(E)}catch{this.attemptTracker.trackEndFailed(E)}})}triggerIceRestart(v){var E;return Qs(this,void 0,void 0,function*(){const w=this.stageConnection.getConnectionStats(),M=this.peerClient.getSfuResource(),k=this.subscribeTracker.trackAttempt({stageConnectionStats:w,isReassignment:!0,traceIdOverride:v.traceId,preAttemptSfuResource:M}),P=performance.now();try{this.emit(yr),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:v,traceId:v.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const q=performance.now()-P,Z=this.peerClient.getSfuResource(),j=this.peerClient.getActionMeasurements();(E=this.attemptTracker)===null||E===void 0||E.trackEndSucceeded(_s.REASSIGNMENT),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),k.trackSubscribeStarted({totalDurationWithRetries:q,sfuResource:Z,retryTimes:0,peerClientPerfStats:j}),this.emit(Ic)}catch(q){this.emit(kc),this.logger.error({msg:"ICE restart attempt failed",err:q});const Z=this.peerClient.getSfuResource(),j=k.trackSubscribeFailed(q,`iceRestart=true, startNode=${M.node}, endNode=${Z==null?void 0:Z.node}`);throw j.code===vt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(j,"ice restart timeout"),q}})}measureFirstFrameDuration({mediaStream:v,subscribeType:E,callback:w}){const M=performance.now(),k=Z=>{const j=performance.now()-M;w(j,Z),Z==="audio"?q():P()};let P=ap,q=ap;return E!==No.AUDIO_ONLY&&(P=function(Z,j){return cp(Z,"video",j)}(v,k)),q=function(Z,j){return cp(Z,"audio",j)}(v,k),()=>{P(),q()}}}var su,Sr;Bu=new WeakSet,Ph=function(x){return x.id===this.id},function(x){x.JOIN_ERROR="JOIN_ERROR",x.PUBLISH_ERROR="PUBLISH_ERROR",x.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"}(su||(su={})),function(x){x[x.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",x[x.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",x[x.TIMEOUT=3]="TIMEOUT",x[x.FAILED=4]="FAILED",x[x.CANCELED=5]="CANCELED",x[x.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",x[x.CODEC_MISMATCH=7]="CODEC_MISMATCH",x[x.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED"}(Sr||(Sr={}));const q_={[Sr.TOKEN_MALFORMED]:"Token is malformed",[Sr.TOKEN_EXPIRED]:"Token expired and is no longer valid",[Sr.TIMEOUT]:"Operation timed out",[Sr.FAILED]:"Operation failed",[Sr.CANCELED]:"Operation canceled",[Sr.STAGE_AT_CAPACITY]:"Stage at capacity",[Sr.CODEC_MISMATCH]:"Client codec is not supported",[Sr.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation"},xa={[vt.EXPIRED_TOKEN.code]:Sr.TOKEN_EXPIRED,[vt.MALFORMED_TOKEN.code]:Sr.TOKEN_MALFORMED,[vt.TOKEN_PERMISSIONS_DENIED.code]:Sr.TOKEN_NOT_ALLOWED,[vt.OPERATION_ABORTED.code]:Sr.CANCELED,[vt.JOIN_TIMED_OUT.code]:Sr.TIMEOUT,[vt.EVENT_PLANE_WS_CREATE_FAILED.code]:Sr.FAILED,[vt.EVENT_PLANE_PONG_TIMEOUT.code]:Sr.FAILED,[vt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:Sr.FAILED,[vt.PUBLISH_TIMED_OUT.code]:Sr.TIMEOUT,[vt.PUBLISH_FAILURE.code]:Sr.FAILED,[vt.SUBSCRIBE_TIMED_OUT.code]:Sr.TIMEOUT,[vt.SUBSCRIBE_FAILURE.code]:Sr.FAILED,[vt.STAGE_AT_CAPACITY.code]:Sr.STAGE_AT_CAPACITY,[vt.NO_MATCHING_CODEC.code]:Sr.CODEC_MISMATCH,[vt.NETWORK_FAILURE.code]:Sr.FAILED,[vt.INTERNAL_SERVER_ERROR.code]:Sr.FAILED,[vt.REMOTE_STREAM_NOT_FOUND.code]:Sr.FAILED,[vt.INTERNAL_MHCP_ERROR.code]:Sr.FAILED,[vt.UNREACHABLE_MHCP.code]:Sr.FAILED,[vt.INVALID_SESSION_STATUS.code]:Sr.FAILED,[vt.MHCP_ABORTED.code]:Sr.FAILED};class Ky extends Error{constructor(v,E,w){super(),this.code=v,this.category=E,this.message=w,this.name="StageError",this.errorDetails=[],this.message=`[${E}] ${w}`}addDetails(v){this.errorDetails.push(v)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var Dh,Gd,wp;(function(x){x.ERROR="error"})(Dh||(Dh={}));class X_ extends qs{constructor(){super(...arguments),this.handleError=(v,E,w=!0)=>{let M;if(v instanceof Wn){const k=xa[v.code];k&&(M=function(P,q,Z){var j,ee;const se=q_[P],ae=new Ky(P,q,se);return ae.addDetails({stageErrorMessage:se,stageErrorCode:P,stageErrorCategory:q,stageArn:(j=Z.token)===null||j===void 0?void 0:j.stageARN,traceId:(ee=Z.traceId)===null||ee===void 0?void 0:ee.value,causeCode:Z.code,causeDetails:Z.details,causeMessage:Z.message,causeLocation:Z.location}),ae}(k,E,v))}if(M)return w&&this.emit(Dh.ERROR,M),M}}}(function(x){x.INTERNAL="internal",x.API="api"})(Gd||(Gd={})),function(x){x.ADDITIVE="additive",x.REPLACE="replace"}(wp||(wp={}));class K_{constructor(v){this.logger=new Ns(v.logger,Ft.CONNECTION),this.subscribeConfig={defaults:v.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(v,E,w,M=wp.REPLACE){E=(ee=>{const se=kd(ee);if(se.jitterBuffer!==void 0){const ae=ve=>{if(typeof ve=="number"){if(ve<0)return 0;if(ve>4e3)return 4e3}return ve};se.jitterBuffer.minDelayWhenPublishing!==void 0&&(se.jitterBuffer.minDelayWhenPublishing=ae(se.jitterBuffer.minDelayWhenPublishing)),se.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(se.jitterBuffer.minDelayWhenSubscribeOnly=ae(se.jitterBuffer.minDelayWhenSubscribeOnly))}return se})(E),this.subscribeConfig.participants[v]===void 0&&(this.subscribeConfig.participants[v]={internalOverrides:{},apiOverrides:{},lastMerged:this.subscribeConfig.defaults});const k=this.subscribeConfig.participants[v];switch(w){case Gd.INTERNAL:k.internalOverrides=this.handleSubscribeConfigLevelMerging(k.internalOverrides,E,M);break;case Gd.API:k.apiOverrides=this.handleSubscribeConfigLevelMerging(k.apiOverrides,E,M);break;default:(function(ee){throw new Error(`Unknown case kind: ${ee}`)})(w)}const P=ru(this.subscribeConfig.defaults,k.internalOverrides,k.apiOverrides);if(P===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${v} | ${k}, ${E}`}),!1;const q=(Z=k.lastMerged,j=P,(typeof Z=="object"&&typeof j=="object"&&(0,$i.isEqual)(Z,j))===!1);var Z,j;return k.lastMerged=P,this.subscribeConfig.participants[v]=k,q}handleExternalSubscribeConfigUpdate(v,E,w,M=wp.REPLACE){const k=(P=>{const q={};return typeof P!="object"?bn.err(new Error("Invalid input")):(P.jitterBuffer!==void 0&&(q.jitterBuffer={},P.jitterBuffer.minDelay!==void 0&&(q.jitterBuffer.minDelayWhenSubscribeOnly=P.jitterBuffer.minDelay)),P.inBandMessaging!==void 0&&(q.inBandMessaging={enabled:P.inBandMessaging.enabled===!0}),P.simulcast!==void 0&&(q.simulcast={},P.simulcast.initialLayerPreference!==void 0&&(q.simulcast.initialLayerPreference=P.simulcast.initialLayerPreference)),bn.ok(q))})(E);return k.ok===!0&&this.handleSubscribeConfigUpdate(v,k.value,w,M)}handleSubscribeConfigLevelMerging(v,E,w){if(w===wp.REPLACE)return E;{const M=ru(v,E);return M===void 0?(this.logger.warn({msg:`Unable to merge '${v}' and '${E}' with type ${w}`}),v):M}}getSubscribeConfigSnapshot(v){return this.subscribeConfig.participants[v]===void 0?Ch(this.subscribeConfig.defaults):Ch(this.subscribeConfig.participants[v].lastMerged)}}class Yy extends ar{constructor(v){super(an.REASSIGNMENT_REQUEST,v.token,v.traceId,!1),Object.assign(this.properties,{target_local_participant_id:v.targetLocalParticipantId,target_remote_participant_id:v.targetRemoteParticipantId}),this.critical=!0}}var ss,Ja,Lh,Po,bl,ea,Ni,po,Cp=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class ng extends qs{constructor(v,E){super(),this.setGetStats=w=>{this.getInternalStats=w},this.getStats=()=>Cp(this,void 0,void 0,function*(){return this.requestRTCStats()}),this.requestRTCStats=()=>Cp(this,void 0,void 0,function*(){if(this.getInternalStats)return this.getInternalStats(this.mediaStreamTrack)}),this.getInternalStats=E,this.id=v.id,this.isMuted=!v.enabled,this.mediaStreamTrack=v,this.streamType=this.mediaStreamTrack.kind==="audio"?Ct.AUDIO:Ct.VIDEO}cleanup(){this.removeAllListeners(),this.getInternalStats=void 0}}(function(x){x.IDLE="IDLE",x.INITIALIZING="INITIALIZING",x.ACTIVE="ACTIVE",x.CONTROLS_PAUSED="CONTROLS_PAUSED",x.DESTROYED="DESTROYED"})(ss||(ss={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(Ja||(Ja={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(Lh||(Lh={})),function(x){x.UNAVAILABLE="unavailable",x.SELECTED="selected"}(Po||(Po={})),function(x){x.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged"}(bl||(bl={}));class v0 extends ng{constructor(v,E){super(v),this.setMuted=w=>{w!==this.isMuted&&(this.mediaStreamTrack.enabled=!w,this.isMuted=w,this.emit(bl.LOCAL_STREAM_MUTE_CHANGED,this))},this.mediaConfig=Zm(v,E)}}class Y_{constructor(v,E){this.strategy=v,this.logger=E}setStrategy(v){this.strategy=v}stageStreamsToPublish(){let v=[];try{v=this.strategy.stageStreamsToPublish(),v=v.filter(M=>M instanceof v0)}catch(M){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:M}),console.error("Error executing stageStreamsToPublish",M),bn.err(M)}let E=0,w=0;for(const M of v)M.mediaStreamTrack.kind==="audio"?E++:M.mediaStreamTrack.kind==="video"&&w++;if(E>1||w>1){const M=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return bn.err(M)}return bn.ok(v)}shouldPublishParticipant(v){try{return bn.ok(this.strategy.shouldPublishParticipant(v))}catch(E){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:E}),console.error("Error executing shouldPublishParticipant",E),bn.err(E)}}shouldSubscribeToParticipant(v){try{return bn.ok(this.strategy.shouldSubscribeToParticipant(v))}catch(E){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:E}),console.error("Error executing shouldSubscribeToParticipant",E),bn.err(E)}}subscribeConfiguration(v){var E,w;try{return bn.ok((w=(E=this.strategy).subscribeConfiguration)===null||w===void 0?void 0:w.call(E,v))}catch(M){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:M}),console.error("Error executing subscribeConfiguration",M),bn.err(M)}}preferredLayerForStream(v,E){var w,M;try{return bn.ok((M=(w=this.strategy).preferredLayerForStream)===null||M===void 0?void 0:M.call(w,v,E))}catch(k){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:k}),console.error("Error executing preferredLayerForStream",k),bn.err(k)}}}class y0 extends qs{constructor(v,E){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=Ni.NOT_PUBLISHED,this.logger=E,this.info=v,this.audioMuted=v.audioMuted,this.videoStopped=v.videoStopped}}(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe"})(ea||(ea={})),function(x){x.NOT_PUBLISHED="not_published",x.ATTEMPTING_PUBLISH="attempting_publish",x.PUBLISHED="published",x.ERRORED="errored"}(Ni||(Ni={})),function(x){x.NOT_SUBSCRIBED="not_subscribed",x.ATTEMPTING_SUBSCRIBE="attempting_subscribe",x.SUBSCRIBED="subscribed",x.ERRORED="errored"}(po||(po={}));const Rp=1e3;function rg(x){return x.map(v=>v.remote)}function Jy(x){return{label:x.encodingId,bitrateBps:x.bitrate*Rp,width:x.width,height:x.height,framesPerSecond:x.framesPerSecond,selected:x.selected}}function Ap(x,v){const E=x.width*x.height,w=v.width*v.height;return E>w||x.bitrateBps>v.bitrateBps||x.framesPerSecond>v.framesPerSecond?1:E===w||x.bitrateBps===v.bitrateBps||x.framesPerSecond>v.framesPerSecond?0:-1}var f,g,C=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class N extends qs{constructor(v){super(),this.setGetStats=()=>{},this.requestRTCStats=()=>this.internalStream.requestRTCStats(),this.getStats=()=>C(this,void 0,void 0,function*(){return this.internalStream.requestRTCStats()}),this.setMuted=E=>{this.internalStream.setMuted(E)},this.getLayers=()=>this.internalStream.layers,this.getSelectedLayer=()=>this.internalStream.selectedLayer,this.getLowestQualityLayer=()=>this.internalStream.lowestQualityLayer,this.getHighestQualityLayer=()=>this.internalStream.highestQualityLayer,this.internalStream=v,this.internalStream.on(Ja.ADAPTION_CHANGED,E=>{this.emit(Lh.ADAPTION_CHANGED,E)}),this.internalStream.on(Ja.LAYERS_CHANGED,E=>{this.emit(Lh.LAYERS_CHANGED,E)}),this.internalStream.on(Ja.LAYER_SELECTED,(E,w)=>{this.emit(Lh.LAYER_SELECTED,E,w)})}get id(){return this.internalStream.id}get participantInfo(){return this.internalStream.participantInfo}get streamType(){return this.internalStream.streamType}get mediaStreamTrack(){return this.internalStream.mediaStreamTrack}get isMuted(){return this.internalStream.isMuted}set isMuted(v){this.internalStream.setMuted(v)}get isAdapting(){return this.internalStream.isAdapting}cleanup(){this.removeAllListeners()}}class B extends ng{constructor({track:v,info:E,getStats:w,remotePlaybackController:M,analyticsTracker:k,token:P}){super(v,w),this.setMuted=Z=>{this.isMuted=Z},this.setLayer=Z=>{const j=(0,$i.cloneDeep)(Z);if(this.queueLayerUpdateForValidState(j))return void this.logger.debug({msg:`setLayer:${j} queued, skipping for now`});const ee=function(ae,ve){if(!ae)return(0,bn.ok)(void 0);const Le=typeof ae=="string"?ae:ae.label,Te=ve.filter(ge=>ge.label===Le)[0];return Te?(0,bn.ok)(Te):(0,bn.err)(`Provided layer with id ${Le} does not exist`)}(j,this._layers);if(!ee.ok){const ae=ee.error;return void this.logger.error({err:ae,msg:"Unable to select layer, skipping skipping selection"})}const se=ee.value;if(this.isNextUpdateAdaptionOnly(se))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(se)||this.isAdapting?se&&(this.logger.warn({msg:`setLayer:${JSON.stringify(se)} `}),this.handleManualUpdate(se)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=ss.INITIALIZING,this.prevState=ss.IDLE,this.analyticsTracker=k,this.token=P,this.id=v.id,this.info=E,this.mediaStreamTrack=v,this.remotePlaybackController=M,this.layerPollingTimeoutId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const q=Wf();this.logger=new Ns(new mh(q),Ft.REMOTE_STAGE_STREAM),this.streamType===Ct.AUDIO?this.isMuted=E.audioMuted:this.isMuted=E.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers()}transitionStateTo(v){this.state!==v&&(this.prevState=this.state,this.state=v)}initializeLayerPolling(){this.streamType!==Ct.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingTimeoutId=setInterval(()=>{this.pollInternalLayers()},3e3)):this.logger.debug({msg:"Skipping initializing polling for audio streams"})}startLayerPolling(){this.layerPollingTimeoutId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingTimeoutId!==null?(clearInterval(this.layerPollingTimeoutId),this.layerPollingTimeoutId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(){this.streamType!==Ct.AUDIO?this.remotePlaybackController.getLayers().then(v=>{if(this.isStateValidForLayerUpdates()){if(!v.ok)throw Error(v.error);this.updateInternalLayersFromRemote(v.value),this.transitionStateTo(ss.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})}).catch(v=>{this.logger.error({err:v,msg:"Error calling getLayers, returning current layers"})}):this.logger.debug({msg:"Skipping layer poll request for audio stream"})}updateInternalLayersFromRemote(v){const E=this._layers,w=v.map(Jy).sort(Ap),M=!(0,$i.isEqual)(w,E);this._layers=w;const k=this._selectedLayer,P=this._layers.filter(Z=>Z.selected)[0],q=!(0,$i.isEqual)(P,k);k&&(k.selected=!1),this._selectedLayer=P,q&&(this.trackLayerUpdate(k),this.trackLayerUpdate(P)),this.isCommandQueueEmpty()&&(M&&this.emitLayersChanged(),q&&this.emitLayerSelected(P))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const v=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${v}`});for(const E of this.commandMap.keys()){const w=this.commandMap.get(E);w==null||w()}this.commandMap.clear()}queueLayerUpdateForValidState(v){if(!v)return this.commandMap.delete("setLayer"),!1;if(this.state===ss.INITIALIZING){const E=this.setLayer.bind(this,v);return this.commandMap.set("setLayer",E),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const v=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then(E=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(v,`Stream in invalid state: ${this.state}`);E.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(v,E.error)}).catch(()=>{})}resetAdaptionStateOnError(v,E){this._isAdapting=v,this.emitAdaptionChanged(),this.logger.error({err:E,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(v){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const E=this._isAdapting,w=this._selectedLayer;w&&(w.selected=!1),this._isAdapting=!1,this._selectedLayer=v,v.selected=!0,E!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(v,w),this.trackLayerUpdate(w),this.trackLayerUpdate(v),this.emitLayersChanged(),this.emitLayerSelected(v),this.remotePlaybackController.setLayer(v.label).then(M=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const k=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(E,k),void this.resetLayerOnError(w,v,k)}if(!M.ok){const k=M.error;return this.resetAdaptionStateOnError(E,k),void this.resetLayerOnError(w,v,k)}this.logger.debug({msg:`Layer successfully selected: ${v.label}`})}).catch(()=>{})}applyExistingControlState(){var v;this._isAdapting?this.remotePlaybackController.unsetLayer().then(()=>{}).catch(()=>{}):!((v=this._selectedLayer)===null||v===void 0)&&v.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then(()=>{}).catch(()=>{})}resetLayerOnError(v,E,w){E&&(E.selected=!1),v&&(v.selected=!0),this._selectedLayer=v,this.logger.error({err:w,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(v,E),this.emitLayersChanged(),v!==null&&this.emitLayerSelected(v,Po.UNAVAILABLE),this.trackLayerUpdate(E),this.trackLayerUpdate(v)}updateLocalLayerStateBeforeRemote(v,E){this._layers=this._layers.map(w=>w.label===(v==null?void 0:v.label)?v:w.label===(E==null?void 0:E.label)?E:w).sort(Ap)}trackLayerUpdate(v){var E,w;this.analyticsTracker.trackEventNoSharedProps(new dp(this.token,Us(),(E=v==null?void 0:v.label)!==null&&E!==void 0?E:"auto",!0,kt.SUBSCRIBE,(w=v==null?void 0:v.selected)!==null&&w!==void 0&&w,this.info.id))}isNextUpdateAdaptionOnly(v){return v===void 0&&this.isFirstLayerUpdate()||v===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(v){var E;return((E=this._selectedLayer)===null||E===void 0?void 0:E.label)===(v==null?void 0:v.label)}isStateValidForLayerUpdates(){return this.state===ss.ACTIVE||this.state===ss.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(v,E=Po.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(v,null,2)}`}),this.emit(Ja.LAYER_SELECTED,(0,$i.cloneDeep)(v),E)}emitLayersChanged(){this.emit(Ja.LAYERS_CHANGED,(0,$i.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(Ja.ADAPTION_CHANGED,this._isAdapting)}get remote(){const v=this.weakRemoteMap.get(this.weakRemoteKey);if(v)return v;const E=new N(this);return this.weakRemoteMap.set(this.weakRemoteKey,E),E}get participantInfo(){return(0,$i.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,$i.cloneDeep)(this._layers)}get selectedLayer(){var v;return(0,$i.cloneDeep)((v=this._selectedLayer)!==null&&v!==void 0?v:void 0)}get highestQualityLayer(){return(0,$i.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,$i.cloneDeep)(this.layers[0])}pauseControls(){this.transitionStateTo(ss.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(ss.ACTIVE)}cleanup(){this.transitionStateTo(ss.DESTROYED),super.cleanup(),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(x){x.STATE_CHANGE="stateChange",x.MEDIA_STREAM_ADDED="mediaStreamAdded",x.MEDIA_STREAM_REMOVED="mediaStreamRemoved",x.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",x.ERROR="error"})(f||(f={})),function(x){x.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",x.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"}(g||(g={}));const Y=Object.assign(Object.assign({},f),g);var me;(function(x){x.PUBLICATION_STATE_CHANGE="publicationStateChange"})(me||(me={}));const xe=Object.assign(Object.assign({},f),me);var tt=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class Mt extends y0{constructor(v,E,w,M,k,P,q,Z=!1){super(v,new Ns(M,Ft.REMOTE_PARTICIPANT)),this.subscribeState=po.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=j=>{this.logger.debug({msg:"subscriptionStateChange",state:j}),j===Zo.DISCONNECTED?this.updateSubscriptionState(po.NOT_SUBSCRIBED):j===Zo.CONNECTED?this.updateSubscriptionState(po.SUBSCRIBED):j===Zo.CONNECTING?this.updateSubscriptionState(po.ATTEMPTING_SUBSCRIBE):j===Zo.ERRORED?this.updateSubscriptionState(po.ERRORED):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:j})},this.onSubscriptionMediaStream=(j,ee)=>{this.logger.debug({msg:"onSubscriptionMediaStream",stream:j});let se=j.getTracks().map(ae=>{const ve=new B({track:ae,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:ee,analyticsTracker:this.analyticsTracker,token:this.token});return this.streams.push(ve),ve});this.subscription.getDesiredSubscribeType()===No.AUDIO_ONLY&&(se=se.filter(ae=>ae.streamType!==Ct.VIDEO)),this.emit(Y.MEDIA_STREAM_ADDED,se)},this.onSubscriptionError=j=>{this.emit(Y.ERROR,j)},this.onSubscriptionSeiMessageReceived=j=>{this.emit(Y.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,j)},this.onSubscriptionTransformError=j=>{this.emit(Y.ERROR,j)},this.onSubscriptionReassignmentStart=()=>{for(const j of this.streams)j.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const j of this.streams)j.resumeControls()},this.updateSubscribeStateIfNecessary=(j,ee)=>{if(!this.info.capabilities.has(ea.SUBSCRIBE))return;ee!==void 0&&this.subscription.updateSubscribeConfig(ee);const se=j!==No.NONE&&this.publishState===Ni.PUBLISHED,ae=this.subscribeState!==po.NOT_SUBSCRIBED&&this.subscribeState!==po.ERRORED;if(se&&!ae)this.subscription.updateDesiredSubscribeType(j),this.subscribe();else if(!se&&ae)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(j);else if(this.subscribeState===po.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==j)try{j===No.AUDIO_ONLY?this.emit(Y.MEDIA_STREAM_REMOVED,this.streams.filter(ve=>ve.streamType===Ct.VIDEO)):j===No.AUDIO_VIDEO&&this.emit(Y.MEDIA_STREAM_ADDED,this.streams.filter(ve=>ve.streamType===Ct.VIDEO)),this.subscription.updateDesiredSubscribeType(j)}catch(ve){this.logger.error({err:ve,msg:"error updating subscribe type"})}},this.updatePublishState=j=>{const ee=j&&this.publishState===Ni.PUBLISHED,se=!j&&this.publishState===Ni.NOT_PUBLISHED;return!ee&&!se&&(this.info.isPublishing=j,this.publishState=j?Ni.PUBLISHED:Ni.NOT_PUBLISHED,!0)},this.updateStreamState=(j,ee)=>{this.audioMuted!==j&&(this.audioMuted=j,this.info.audioMuted=j,this.updateStreamMuteState(Ct.AUDIO,j)),this.videoStopped!==ee&&(this.videoStopped=ee,this.info.videoStopped=ee,this.updateStreamMuteState(Ct.VIDEO,ee))},this.updateStreamMuteState=(j,ee)=>{const se=this.streams.find(ae=>ae.streamType===j);se?(se.setMuted(ee),this.emit(Y.MEDIA_STREAM_MUTE_CHANGED,se)):this.logger.warn({msg:`tried to update mute state for ${j} stream on participant ${this.info.id} that didn't exist`})},this.cleanup=()=>{for(const j of this.streams)j.remote.removeAllListeners(),j.removeAllListeners();this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==po.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=q,this.token=E,this.createSubscription=()=>{const j=new zu(v.id,E,w,M,q,k,P);return j.on(bd,this.onSubscriptionStateChange),j.on(ce,this.onSubscriptionMediaStream),j.on(Ro,this.onSubscriptionError),j.on(Sa,this.onSubscriptionSeiMessageReceived),j.on(As,this.onSubscriptionTransformError),j.on(yr,this.onSubscriptionReassignmentStart),j.on(Ic,this.onSubscriptionReassignmentDone),j.on(kc,this.onSubscriptionReassignmentDone),j},this.subscription=this.createSubscription(),Z&&(this.publishState=Ni.PUBLISHED)}updateSubscriptionState(v){v!==this.subscribeState&&(this.subscribeState=v,this.emit(Y.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(po.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===po.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(bd,this.onSubscriptionStateChange),this.subscription.off(ce,this.onSubscriptionMediaStream),this.subscription.off(Ro,this.onSubscriptionError),this.subscription.off(As,this.onSubscriptionTransformError);const v=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),v===No.AUDIO_ONLY?this.emit(Y.MEDIA_STREAM_REMOVED,this.streams.filter(E=>E.streamType===Ct.AUDIO)):this.emit(Y.MEDIA_STREAM_REMOVED,this.streams),this.updateSubscriptionState(po.NOT_SUBSCRIBED),this.streams.forEach(E=>{E.cleanup()}),this.streams=[]}triggerIceRestart(v){return tt(this,void 0,void 0,function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(v)}finally{this.reassigning=!1}})}}const rn=kt.PUBLISH;class ir{constructor(v,E){this.analyticsTracker=v,this.token=E,this.action=rn,this.traceId=Us()}trackPublish(v){const{action:E,traceId:w,analyticsTracker:M,token:k}=this;return M.trackEvent(new Uc({token:k,traceId:w})),{getTraceId:()=>w,trackPublishStarted({totalDurationWithRetries:P,retryTimes:q,sfuResource:Z,peerClientPerfStats:j}){const{optionsDuration:ee,postDuration:se,timeToCandidate:ae,timeToConnected:ve,sdpExchangeDuration:Le,sdpExchangeTransport:Te,setRemoteDescDuration:ge,peerConnectionDuration:he}=j,{edpInitialConnectDuration:$e,edpInitialConnectRetries:yt,edpInitialStateDuration:Bt,edpStateUpdateCount:_t}=v;M.trackEvent(new Jm({token:k,traceId:w,optionsDuration:ee,postDuration:se,timeToCandidate:ae,totalDuration:ve,edpInitialConnectDuration:$e,edpInitialConnectRetries:yt,edpInitialStateDuration:Bt,edpStateUpdateCount:_t,sdpExchangeDuration:Le,sdpExchangeTransport:Te,setRemoteDescDuration:ge,peerConnectionDuration:he,publishRetries:q,totalDurationWithRetries:P,sfuResource:Z}))},trackPublishFailed(P){const q=((j,ee,se)=>{if(j instanceof Wn)return j;let ae="";return j instanceof Xr.AxiosError&&(ae+=`AxiosError - ${j.code}`),new Wn(Object.assign(Object.assign(Object.assign({},vt.PUBLISH_FAILURE),{action:rn,token:ee,traceId:se,tag:Ga.PUBLISH_RELATED,location:"publish",details:`${ae} ${j.message}`}),{fatal:!0}))})(P,k,w);M.trackEvent(new mp({token:k,traceId:w,code:q.code,message:q.message,fatal:q.fatal,nominal:q.nominal}));const Z=new Wn(Object.assign(Object.assign({},vt.PUBLISH_FAILURE),{action:E,token:k,traceId:w,tag:Ga.PUBLISH_RELATED,location:"publish"}));return P instanceof Wn&&(Z.fatal=P.fatal,Z.nominal=P.nominal,Z.location=`publish > ${P.location}`),M.trackError(Z),q},trackUnpublish:()=>{M.trackEvent(new Pd({token:k,traceId:w}))},trackEndSucceeded:P=>{M.trackEvent(new Ah({token:k,isUnpublishSuccessful:!0,traceId:w,reason:P}))},trackEndFailed:P=>{const q=new Wn(Object.assign(Object.assign({},vt.UNPUBLISH_FAILURE),{token:k,traceId:w,tag:Ga.UNPUBLISH_RELATED,location:"unpublish"}));return P!==_s.UNLOAD&&P!==_s.UNPUBLISH||this.analyticsTracker.trackError(q),M.trackEvent(new Ah({token:k,isUnpublishSuccessful:!1,traceId:w,reason:P})),q}}}}var on,$n,hn=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(on||(on={})),function(x){x.STATE_CHANGE="stateChange",x.ERROR="error",x.TRANSFORM_ERROR="transformError"}($n||($n={}));class Do extends qs{constructor(v,E,w,M){super(),this.token=v,this.stageConnection=E,this.nonScopedLogger=w,this.analyticsTracker=M,this.tracksToPublish=[],this.publicationState=on.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=kt.PUBLISH,this.start=k=>{this.publicationState===on.DISCONNECTED||this.publicationState===on.ERRORED?(this.tracksToPublish=k,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=k=>hn(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(k)}),this.stop=(k=!1)=>hn(this,void 0,void 0,function*(){this.peerClient.off(gs,this.onPeerClientConnectionStateChange,this),this.peerClient.off(Ve,this.onPeerClientTransformError,this),yield this.unpublish(k),this.updateState(on.DISCONNECTED)}),this.processStateUpdate=k=>{const{publicationState:P}=this;P===on.DISCONNECTED||P===on.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(on.CONNECTING),this.tryPublish()):P===on.CONNECTING?k===Be.CONNECTED&&this.updateState(on.CONNECTED):P===on.CONNECTED&&k===Be.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(_s.CONNECTION_FAIL),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(on.CONNECTING),this.tryPublish()))},this.updateState=k=>{this.publicationState=k,this.emit($n.STATE_CHANGE,k)},this.tryPublish=()=>hn(this,void 0,void 0,function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const k=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(k);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.tracksToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const P=this.peerClient.getSfuResource(),q=this.latestPubAttemptNum-1,Z=performance.now()-this.startConnectingTimestamp,j=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:P,totalDurationWithRetries:Z,retryTimes:q,peerClientPerfStats:j}),this.latestPubAttemptNum=0}catch(P){this.logger.error({msg:"publish failed!",err:P});const q=this.attemptTracker.trackPublishFailed(P),Z=q.code===vt.OPERATION_ABORTED.code,j=q.fatal,ee=this.latestPubAttemptNum===4;if(Z)return;if(j||ee)return this.logger.error({msg:`Stopping attempts: isFatal=${j}, isLastAttempt=${ee}`,err:P}),this.updateState(on.ERRORED),void this.emit($n.ERROR,q);const se=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${se}ms`}),this.nextAttemptTimerId=window.setTimeout(()=>{this.tryPublish()},se)}}}),this.publish=(k,P)=>hn(this,void 0,void 0,function*(){this.peerClient.initTracksToPublish(k),yield this.peerClient.connect({audioOnly:!1,traceId:P})}),this.unpublish=(k=!1)=>hn(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===on.DISCONNECTED||this.publicationState===on.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const P=k?_s.UNLOAD:_s.UNPUBLISH;try{k?this.peerClient.disconnect(k):yield this.peerClient.disconnect(k),this.attemptTracker.trackEndSucceeded(P)}catch{this.attemptTracker.trackEndFailed(P)}}),this.replaceOrUpdateTrack=k=>hn(this,void 0,void 0,function*(){this.tracksToPublish.find(P=>P.track.kind===k.track.kind)?this.tracksToPublish=this.tracksToPublish.map(P=>P.track.kind===k.track.kind?k:P):this.tracksToPublish.push(k),yield this.peerClient.replaceOrUpdateTrack(k)}),this.onPeerClientConnectionStateChange=k=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${k}`,state:k}),this.processStateUpdate(k)},this.onPeerClientTransformError=k=>{this.emit($n.TRANSFORM_ERROR,k)},this.onIncompatibleCodecs=k=>hn(this,void 0,void 0,function*(){yield this.peerClient.onIncompatibleCodecs(k)}),this.sendSeiMessage=k=>{this.peerClient.sendSeiMessage(k)},this.peerClient=new Vd(v,this.nonScopedLogger,this.action,Xs(this.action),Us(),this.analyticsTracker,void 0,E,void 0),this.logger=new Ns(w,Ft.PUBLICATION),this.peerClient.on(gs,this.onPeerClientConnectionStateChange,this),this.peerClient.on(Ve,this.onPeerClientTransformError,this),this.publishTracker=new ir(this.analyticsTracker,this.token)}removeTrack(v){return hn(this,void 0,void 0,function*(){this.tracksToPublish=this.tracksToPublish.filter(E=>E.track.kind!==v),yield this.peerClient.removeTrack(v)})}}var _r,Ce=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};class De extends y0{constructor(v,E,w,M,k){super(v,new Ns(w,Ft.LOCAL_PARTICIPANT)),this.onPublicationStateChange=P=>{switch(this.logger.debug({msg:"publicationStateChange",state:P}),P){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(Ni.PUBLISHED);break;case"connecting":this.updatePublishState(Ni.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(Ni.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:P})}},this.onPublicationError=P=>{this.emit(xe.ERROR,P)},this.updatePublishState=P=>{this.info.isPublishing=P===Ni.PUBLISHED,this.publishState=P,this.emit(xe.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=P=>{P.streamType===Ct.AUDIO&&(this.audioMuted=P.isMuted,this.info.audioMuted=P.isMuted),P.streamType===Ct.VIDEO&&(this.videoStopped=P.isMuted,this.info.videoStopped=P.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(xe.MEDIA_STREAM_MUTE_CHANGED,P)},this.publish=P=>{this.logger.debug({msg:"publish"}),P.forEach(Z=>{Z&&(this.setupStreamListener(Z),Z.streamType===Ct.AUDIO?(this.audioStream=Z,this.audioMuted=!Z.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):Z.streamType===Ct.VIDEO&&(this.videoStream=Z,this.videoStopped=!Z.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),Z.setGetStats(this.publication.requestRTCStats))}),this.connection.emitStageState(this.audioMuted,this.videoStopped);const q=P.map(Z=>Ep(Z.mediaStreamTrack,Z.mediaConfig));this.publication.start(q)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==Ni.NOT_PUBLISHED&&this.publishState!==Ni.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=P=>Ce(this,void 0,void 0,function*(){yield this.publication.onIncompatibleCodecs(P)}),this.sendSeiMessage=P=>{this.publication.sendSeiMessage(P)},this.sendSeiMessageString=P=>{const q=new TextEncoder().encode(P);this.publication.sendSeiMessage(q)},this.connection=M,this.createPublication=()=>{const P=new Do(E,M,w,k);return P.on($n.STATE_CHANGE,this.onPublicationStateChange),P.on($n.ERROR,this.onPublicationError),P.on($n.TRANSFORM_ERROR,this.onPublicationError),P},this.publication=this.createPublication()}setupStreamListener(v){v.on(bl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute)}removeTrack(v){var E,w;v.streamType===Ct.AUDIO?((E=this.audioStream)===null||E===void 0||E.off(bl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):v.streamType===Ct.VIDEO&&((w=this.videoStream)===null||w===void 0||w.off(bl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(v.streamType)}replaceOrAddTrack(v){return Ce(this,void 0,void 0,function*(){this.setupStreamListener(v),v.setGetStats(this.publication.requestRTCStats),v.streamType===Ct.AUDIO?(this.audioStream=v,this.audioMuted=!v.mediaStreamTrack.enabled):v.streamType===Ct.VIDEO&&(this.videoStream=v,this.videoStopped=!v.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const E=Ep(v.mediaStreamTrack,v.mediaConfig);yield this.publication.replaceOrUpdateTrack(E)})}unpublish(){if(this.publishState===Ni.NOT_PUBLISHED||this.publishState===Ni.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off($n.STATE_CHANGE,this.onPublicationStateChange),this.publication.off($n.ERROR,this.onPublicationError),this.publication.off($n.TRANSFORM_ERROR,this.onPublicationError);const v=[this.audioStream,this.videoStream].filter(E=>!!E);v.forEach(E=>{E.cleanup()}),this.audioStream=void 0,this.videoStream=void 0,this.emit(xe.MEDIA_STREAM_REMOVED,v),this.updatePublishState(Ni.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(x){x.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",x.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",x.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",x.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",x.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",x.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",x.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",x.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",x.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",x.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",x.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",x.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",x.ERROR="error",x.STAGE_LEFT="stageLeft"})(_r||(_r={}));var He=function(x,v,E,w){return new(E||(E=Promise))(function(M,k){function P(j){try{Z(w.next(j))}catch(ee){k(ee)}}function q(j){try{Z(w.throw(j))}catch(ee){k(ee)}}function Z(j){var ee;j.done?M(j.value):(ee=j.value,ee instanceof E?ee:new E(function(se){se(ee)})).then(P,q)}Z((w=w.apply(x,[])).next())})};const Tt=x=>!!x;class un extends qs{constructor(v,E){super(),this.connectionState=di.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(M,k)=>{var P,q;if(this.connectionState=M,M===di.ERRORED&&(this.connectionStateErrored=!0),M===di.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==Ni.NOT_PUBLISHED&&this.stageConnection.emitStageState((P=this.localParticipant)===null||P===void 0?void 0:P.audioMuted,(q=this.localParticipant)===null||q===void 0?void 0:q.videoStopped),M===di.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),M===di.DISCONNECTED){if(k&&k!==Xa.CLIENT_RECONNECT&&k!==Xa.USER_INITIATED){let Z=tr.UNKNOWN;(function(j){return Object.values(tr).includes(j)})(k)?Z=k:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${k}`}),this.cleanup(Z)}}else this.emit(_r.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var M;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new xd(this.token,(M=this.joinTraceId)!==null&&M!==void 0?M:new Sd,"reusing local participant from repeat join",kt.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const M=function(k){var P,q;const Z=new Set;return k.token.claims.capabilities.allow_publish&&Z.add(ea.PUBLISH),k.token.claims.capabilities.allow_subscribe&&Z.add(ea.SUBSCRIBE),{id:k.token.participantID,userId:(P=k.token.userID)!==null&&P!==void 0?P:"",attributes:(q=k.token.claims.attributes)!==null&&q!==void 0?q:{},capabilities:Z,isLocal:!0,userInfo:{},videoStopped:k.videoStopped,audioMuted:k.audioMuted,isPublishing:k.isPublishing}}({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new De(M,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(xe.PUBLICATION_STATE_CHANGE,k=>{this.onPublishStateChanged(this.localParticipant.info,k)}),this.localParticipant.on(xe.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(xe.MEDIA_STREAM_MUTE_CHANGED,k=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,k):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})}),this.localParticipant.on(xe.ERROR,k=>{this.errorManager.handleError(k,su.PUBLISH_ERROR)}),this.emit(_r.STAGE_PARTICIPANT_JOINED,M)},this.onRemoteParticipantJoined=M=>{var k;if(M.id!==((k=this.localParticipant)===null||k===void 0?void 0:k.info.id)){const P=function(ee){return{id:ee.id,userId:ee.userId,attributes:ee.attributes,capabilities:new Set([ea.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:ee.videoStopped,audioMuted:ee.audioMuted,isPublishing:ee.isPublishing}}(M);if(this.participants.has(P.id))return void this.logger.warn({msg:"Remote participant already tracked"});let q=No.NONE;P.capabilities.has(ea.SUBSCRIBE)&&(q=bn.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(P),q),this.updateManagerWithExternalSubscribeConfig(P,"joined"));const Z=this.configManager.getSubscribeConfigSnapshot(P.id),j=new Mt(P,this.token,this.stageConnection,this.logger.unwrap(),q,Z,this.analyticsTracker,M.isPublishing);this.participants.set(P.id,j),this.setupRemoteParticipantListeners(j),this.emit(_r.STAGE_PARTICIPANT_JOINED,j.info),j.updateSubscribeStateIfNecessary(q)}},this.setupRemoteParticipantListeners=M=>{M.on(Y.SUBSCRIPTION_STATE_CHANGE,k=>{this.onParticipantSubscribeStateChanged(M.info.id,k)}),M.on(Y.MEDIA_STREAM_ADDED,k=>{const P=this.participants.get(M.info.id);if(P){for(const q of k)this.setupRemoteParticipantStreamEvents(P.info,q);this.emit(_r.STAGE_PARTICIPANT_STREAMS_ADDED,P.info,rg(k)),this.updateStreamLayerForParticipant(M)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})}),M.on(Y.MEDIA_STREAM_REMOVED,k=>{const P=this.participants.get(M.info.id);P?this.emit(_r.STAGE_PARTICIPANT_STREAMS_REMOVED,P.info,rg(k)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})}),M.on(Y.MEDIA_STREAM_MUTE_CHANGED,k=>{this.onStreamMuteChange(M.info,k.remote)}),M.on(Y.ERROR,k=>{this.errorManager.handleError(k,su.SUBSCRIBE_ERROR)}),M.on(Y.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,k=>{this.onSeiMessageReceived(M.info,k)})},this.onRemoteParticipantLeft=M=>{if(this.connectionState!==di.CONNECTED)return;const k=this.participants.get(M);k?(k.participantLeave(),k.unsubscribe(),k.cleanup(),this.participants.delete(M),this.emitParticipantLeave(k.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=M=>{this.emit(_r.STAGE_PARTICIPANT_LEFT,M)},this.onRemoteParticipantStateChanged=M=>{const k=this.participants.get(M.id);if(!k)return void this.logger.warn({msg:"Remote participant updated but not tracked"});k.updatePublishState(M.isPublishing)&&this.onPublishStateChanged(k.info,k.publishState),k.updateStreamState(M.audioMuted,M.videoStopped);const P=this.strategyWrapper.shouldSubscribeToParticipant(k.info);if(bn.isNotOk(P))return;this.updateManagerWithExternalSubscribeConfig(k.info,"updated");const q=this.configManager.getSubscribeConfigSnapshot(k.info.id),Z=bn.getOk_or(P,No.NONE);k.updateSubscribeStateIfNecessary(Z,q)},this.onPublishStateChanged=(M,k)=>{this.emit(_r.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,M,k)},this.onParticipantSubscribeStateChanged=(M,k)=>{const P=this.participants.get(M);P?this.emit(_r.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,P.info,k):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=M=>{this.localParticipant&&this.emit(_r.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,M)},this.onLocalStreamsRemoved=M=>{this.localParticipant&&this.emit(_r.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,M)},this.onStreamMuteChange=(M,k)=>{this.emit(_r.STAGE_STREAM_MUTE_CHANGED,M,k)},this.onSeiMessageReceived=(M,k)=>{this.emit(_r.STAGE_STREAM_SEI_MESSAGE_RECEIVED,M,k)},this.leave=()=>{this.cleanup(tr.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var M;this.participants.forEach(k=>{k.quickUnsubscribe()}),(M=this.localParticipant)===null||M===void 0||M.quickUnpublish(),this.stageConnection.disconnect(),this.emit(_r.STAGE_CONNECTION_STATE_CHANGED,di.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=M=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new np({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:M})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const k=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(k);const P=this.participants.entries();for(const[q,Z]of P)Z.unsubscribe(),this.participants.delete(q),Z.cleanup(),this.emitParticipantLeave(Z.info);Fu.destroy(),this.stageConnection.disconnect(),this.emit(_r.STAGE_CONNECTION_STATE_CHANGED,di.DISCONNECTED),this.emit(_r.STAGE_LEFT,M),this.stageConnection.removeAllListeners(),this.stageConnection=new Sp(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners(),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(M=>{if(M.info.capabilities.has(ea.SUBSCRIBE)){const k=this.strategyWrapper.shouldSubscribeToParticipant(M.info);if(bn.isNotOk(k))return;const P=bn.getOk_or(k,No.NONE);this.updateManagerWithExternalSubscribeConfig(M.info,"updated");const q=this.configManager.getSubscribeConfigSnapshot(M.info.id);M.updateSubscribeStateIfNecessary(P,q),this.updateStreamLayerForParticipant(M)}}),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var M;if(!this.localParticipant||!(!((M=this.localParticipant)===null||M===void 0)&&M.info.capabilities.has(ea.PUBLISH)))return;const k=this.localParticipant.publishState!==Ni.NOT_PUBLISHED&&this.localParticipant.publishState!==Ni.ERRORED,P=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(bn.isNotOk(P))return;let q=bn.getOk_or(P,!1);if(!k&&!q)return;if(k&&!q)return void this.localParticipant.unpublish();const Z=this.strategyWrapper.stageStreamsToPublish();if(bn.isNotOk(Z)){const ee=bn.getErr(Z);if(ee instanceof Error&&ee.cause==="UserStrategy")throw ee;return}const j=bn.getOk_or(Z,[]);q=q&&j.length>0,!k&&q?(this.localParticipant.publish(j),this.onLocalStreamsAdded(j)):this.syncTracksToPublish(j)},this.syncTracksToPublish=M=>{var k;if(!this.localParticipant)return;const P=this.localParticipant.audioStream,q=this.localParticipant.videoStream,{updates:Z,streamsToAdd:j,streamsToRemove:ee}=this.determineStreamUpdates(P,q,M);if(Z.length){for(const se of Z)se.newStream?(k=this.localParticipant)===null||k===void 0||k.replaceOrAddTrack(se.newStream):se.oldStream&&this.localParticipant.removeTrack(se.oldStream);ee.length!==0&&this.onLocalStreamsRemoved(ee),j.length!==0&&this.onLocalStreamsAdded(j)}},this.determineStreamUpdates=(M,k,P=[])=>{const q=[],Z=P.slice(0,2);if(Z.sort((se,ae)=>se.streamType===Ct.AUDIO?-1:1),Z.length===0)M&&q.push({oldStream:M}),k&&q.push({oldStream:k});else if(Z.length===1){const se=Z[0];se.streamType===Ct.AUDIO?k&&q.push({oldStream:k}):se.streamType===Ct.VIDEO&&M&&q.push({oldStream:M})}Z.forEach(se=>{var ae,ve;se.streamType===Ct.AUDIO?M?M.id===se.id&&(0,$i.isEqual)(M.mediaConfig,se.mediaConfig)||(!!(!((ae=M.mediaConfig)===null||ae===void 0)&&ae.stereo)!=!!(!((ve=se.mediaConfig)===null||ve===void 0)&&ve.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),q.push({oldStream:M,newStream:se})):q.push({newStream:se}):se.streamType===Ct.VIDEO&&(k?k.id===se.id&&(0,$i.isEqual)(k.mediaConfig,se.mediaConfig)||q.push({oldStream:k,newStream:se}):q.push({newStream:se}))});const j=q.map(se=>se.newStream).filter(Tt),ee=q.map(se=>se.oldStream).filter(Tt);return{updates:q,streamsToAdd:j,streamsToRemove:ee}},this.onReassignmentMessage=M=>He(this,void 0,void 0,function*(){if(ql("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Io.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const k=Us();this.trackReassignmentRequest(M,k);const P=this.participants.get(M.remoteParticipantId),q=this.token.participantID,Z=function(j,{localParticipantId:ee,remoteParticipant:se}){const{participantId:ae}=j;if(ee!==ae)return bn.err(Object.assign(Object.assign({},vt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${ae}`}));if(!se)return bn.err(Object.assign(Object.assign({},vt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${se}`}));if(se.isReassigning())return bn.err(vt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const ve=se.subscription.peerClient.getConnectionState();return[Be.CONNECTED,Be.DISCONNECTED].includes(ve)?bn.ok(se):bn.err(Object.assign(Object.assign({},vt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${ve}`}))}(M,{localParticipantId:q,remoteParticipant:P});if(!Z.ok)this.trackReassignmentRequestRejected(Z.error,k);else try{const{token:j,nodeOverride:ee}=M;yield Z.value.triggerIceRestart({assignmentToken:j,traceId:k,nodeOverride:ee})}catch(j){this.logger.error({msg:"Reassignment failed.",err:j})}}),this.onIncompatibleCodecsMessage=M=>He(this,void 0,void 0,function*(){var k;yield(k=this.localParticipant)===null||k===void 0?void 0:k.onIncompatibleCodecs(M.codecs)}),this.analyticsTracker=new Cu;const w=Wf();this.logger=new Ns(new mh(w),Ft.STAGE),this.strategyWrapper=new Y_(E,this.logger),this.configManager=new K_({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:es.DEFAULT,minDelayWhenSubscribeOnly:es.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Zl.LOWEST_QUALITY}}}),this.errorManager=new X_;try{this.token=Dc(v,this.analyticsTracker)}catch(M){const k=new Wn(Object.assign({action:kt.JOIN,token:v,traceId:Us(),tag:Ga.JOIN_RELATED,location:"Stage.constructor"},vt.MALFORMED_TOKEN));throw M instanceof Error&&(k.details=M.message),this.errorManager.handleError(k,su.JOIN_ERROR)||M}this.stageConnection=new Sp(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(Yl,(v,E)=>{this.onConnectionStateChanged(v,E)}),this.stageConnection.on(Wa,v=>{this.onRemoteParticipantJoined(v)}),this.stageConnection.on(Ei,v=>{this.onRemoteParticipantLeft(v.id)}),this.stageConnection.on(vs,v=>{var E;v.id!==((E=this.localParticipant)===null||E===void 0?void 0:E.info.id)&&this.onRemoteParticipantStateChanged(v)}),this.stageConnection.on(Rs,v=>He(this,void 0,void 0,function*(){yield this.onReassignmentMessage(v)})),this.stageConnection.on(ku,v=>He(this,void 0,void 0,function*(){yield this.onIncompatibleCodecsMessage(v)})),this.stageConnection.on(H_,v=>{v instanceof Wn&&this.analyticsTracker.trackError(v),this.errorManager.handleError(v,su.JOIN_ERROR)}),this.errorManager.on(Dh.ERROR,v=>{this.emit(_r.ERROR,v)})}setupRemoteParticipantStreamEvents(v,E){const w=E.remote;E.on(Ja.ADAPTION_CHANGED,M=>{this.emit(_r.STAGE_STREAM_ADAPTION_CHANGED,v,w,M)}),E.on(Ja.LAYERS_CHANGED,M=>{this.emit(_r.STAGE_STREAM_LAYERS_CHANGED,v,w,M)}),E.on(Ja.LAYER_SELECTED,(M,k)=>{this.emit(_r.STAGE_STREAM_LAYER_SELECTED,v,w,M,k)}),E.layers.length>0&&(this.emit(_r.STAGE_STREAM_LAYERS_CHANGED,v,w,w.getLayers()),this.emit(_r.STAGE_STREAM_LAYER_SELECTED,v,w,w.getSelectedLayer(),Po.SELECTED))}join(){return He(this,void 0,void 0,function*(){this.analyticsTracker.start(),this.joinTraceId=Us(),this.analyticsTracker.trackEvent(new Dd({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Us(),Ga.JOIN_RELATED,"join")}catch(v){throw this.errorManager.handleError(v,su.JOIN_ERROR)||v}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===di.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(v){throw this.logger.error({err:v,msg:"error joining stage"}),this.errorManager.handleError(v,su.JOIN_ERROR,!1)||v}})}replaceStrategy(v){this.strategyWrapper.setStrategy(v),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(v,E){const w=bn.getOk(this.strategyWrapper.subscribeConfiguration(v));if(w===void 0)return;const M=v.id;if(this.configManager.handleExternalSubscribeConfigUpdate(M,w,Gd.API)){const k=this.configManager.getSubscribeConfigSnapshot(M);this.analyticsTracker.trackEventNoSharedProps(new Md(this.token,this.joinTraceId,{trigger:E==="joined"?"initial":"ad-hoc",remote_participant_id:M,min_delay_when_publishing:Xi(k.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:Xi(k.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:k.inBandMessaging.enabled,simulcast_initial_layer_preference:k.simulcast.initialLayerPreference}))}}updateStreamLayerForParticipant(v){v.streams.forEach(E=>{if(E.streamType==="audio")return;const w=this.strategyWrapper.preferredLayerForStream(v.info,E.remote),M=bn.getOk_or(w,void 0);E.setLayer(M)})}trackReassignmentRequestRejected(v,E){const{token:w}=this,M=new Wn(Object.assign(Object.assign({},v),{token:w,action:kt.JOIN,traceId:E,tag:Ga.SUBSCRIBE_RELATED,location:"publish"}));this.logger.error({err:M,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(M)}trackReassignmentRequest(v,E){const{token:w}=this;this.analyticsTracker.trackEvent(new Yy({token:w,traceId:E,targetLocalParticipantId:v.participantId,targetRemoteParticipantId:v.remoteParticipantId}))}}var tr;(function(x){x.UNKNOWN="unknown",x.USER_INITIATED="user-initiated",x.TOKEN_REUSED="token-reused",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"})(tr||(tr={}));const nr=h})(),s})())})(Qj);var mbe=Qj.exports;const U0=Wl(mbe);let ec;const wl=Nf("broadcast",["second"],n=>{switch(n.target){case"createsession":du("broadcast:createsession",async()=>{if(fe(ec))ti(wl.name(),"session","session is already open");else{const e=window.innerHeight>window.innerWidth;ec=U0.create({streamConfig:e?U0.BASIC_FULL_HD_PORTRAIT:U0.BASIC_FULL_HD_LANDSCAPE,logLevel:U0.LOG_LEVEL.DEBUG}),ec.on(U0.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(i){console.info({activestate:i})}),ec.on(U0.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(i){Lr(wl.name(),i)}),ec.on(U0.BroadcastClientEvents.ERROR,function(i){ti(wl.name(),"connection",i),ec=void 0});const t=document.querySelector("canvas");if(fe(t))await ec.addImageSource(t,"video",{index:1});else{ti(wl.name(),"video","unabled to find canvas element"),ec=void 0;return}const r=Epe();if(fe(r))await ec.addAudioInputDevice(r.stream,"audio");else{ti(wl.name(),"video","unable create media audio node destination"),ec=void 0;return}Lr(wl.name(),"created client")}});break;case"closesession":fe(ec)?(ec.delete(),ec=void 0,Lr(wl.name(),"closed client")):ti(wl.name(),"session","session is already closed");break;case"startstream":du("broadcast:startstream",async()=>{vr(n.data)&&fe(ec)&&(af(wl.name(),"broadcasting in"),Hr(wl.name(),"3","..."),await Vh(1e3),Hr(wl.name(),"2","..."),await Vh(1e3),Hr(wl.name(),"1","..."),await Vh(1e3),af(wl.name(),"GOING LIVE"),await ec.startBroadcast(n.data,"https://g.webrtc.live-video.net:4443"))});break;case"stopstream":fe(ec)?ec.stopBroadcast():ti(wl.name(),"session","need an active session to stop stream");break}}),BN=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";var gg,zn;(function(n){n[n.CRITICAL=0]="CRITICAL",n[n.ERROR=1]="ERROR",n[n.WARNING=2]="WARNING",n[n.INFO=3]="INFO",n[n.DEBUG=4]="DEBUG",n[n.TRACE=7]="TRACE"})(zn||(zn={}));function zN(n){if(typeof n=="number"){if(Object.prototype.hasOwnProperty.call(zn,n))return n;var e=Object.keys(zn).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<n});return e.length?Math.max.apply(Math,e):zn.WARNING}var t=n.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(zn,t))throw new Error("Unknown log level string: ".concat(n));return zn[t]}var gbe=BN?console.log.bind(console):console.debug.bind(console),Zj=(gg={},gg[zn.CRITICAL]=console.error.bind(console),gg[zn.ERROR]=console.error.bind(console),gg[zn.WARNING]=console.warn.bind(console),gg[zn.INFO]=console.info.bind(console),gg[zn.DEBUG]=gbe.bind(console),gg[zn.TRACE]=console.trace.bind(console),gg);function n0(n){return function(e,t){Object.defineProperty(e,t,{get:function(){},set:function(r){Object.defineProperty(this,t,{value:r,writable:!0,enumerable:n})},enumerable:n})}}function bI(n){return Ws(this,void 0,Promise,function(){return CO(this,function(e){switch(e.label){case 0:return typeof n!="function"?[3,2]:[4,n()];case 1:return[2,e.sent()];case 2:return[2,n]}})})}function _be(n){return typeof n=="function"?n():n}function e6(n){var e,t,r;return CO(this,function(i){switch(i.label){case 0:e=0,t=1,i.label=1;case 1:return e<n?[4,e]:[3,3];case 2:return i.sent(),r=EC([t,e+t],2),e=r[0],t=r[1],[3,1];case 3:return[4,n];case 4:return i.sent(),[3,3];case 5:return[2]}})}function AT(n,e){return Object.assign.apply(Object,OM([{}],EC(n.map(e)),!1))}function TI(n,e){Object.entries(n).forEach(function(t){var r=EC(t,2),i=r[0],s=r[1];return e(s,i)})}function t6(n){return n==null}function fE(n,e){return t6(n)?null:e(n)}function n6(n,e){return t6(n)?void 0:e(n)}function vbe(n){return Ws(this,void 0,Promise,function(){return CO(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t){return setTimeout(t,n)})];case 1:return e.sent(),[2]}})})}function xI(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{promise:t,resolve:n,reject:e}}function ybe(n,e,t){if(typeof n=="number"&&(n=n.toString()),e=e-n.length,e<=0)return n;t===void 0&&(t=" ");var r="";do(e&1)===1&&(r+=t),e>>=1,e&&(t+=t);while(e);return r+n}function i_(n,e,t){var r=n.split(e);return r.length<=t?r:OM(OM([],EC(r.slice(0,t-1)),!1),[r.slice(t-1).join(e)],!1)}var Sbe={},WR,$R,Ew=typeof process>"u"?[]:($R=(WR=Sbe.LOGGING)===null||WR===void 0?void 0:WR.split(";").map(function(n){var e=n.split("=",2),t=e[0],r=e[1];return r?[t==="default"?void 0:t.split(":"),zN(r)]:null}).filter(function(n){return!!n}).sort(function(n,e){var t,r,i=n[0],s=e[0];return((t=s==null?void 0:s.length)!==null&&t!==void 0?t:0)-((r=i==null?void 0:i.length)!==null&&r!==void 0?r:0)}))!==null&&$R!==void 0?$R:[],qR=Ew.findIndex(function(n){var e=n[0];return!e}),r6=void 0;qR!==-1&&(r6=Ew[qR][1],Ew.splice(qR));function Ebe(n,e){return e.length<=n.length&&e.every(function(t,r){return t===n[r]})}function i6(n){for(var e=n.split(":"),t=0,r=Ew;t<r.length;t++){var i=r[t],s=i[0],o=i[1];if(Ebe(e,s))return o}return r6}var s6=function(){function n(e){var t=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?BN:a,l,u;this._name=t,this._minLevel=(u=(l=n6(r,function(h){return zN(h)}))!==null&&l!==void 0?l:i6(t))!==null&&u!==void 0?u:zn.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return n.prototype.crit=function(e){this.log(zn.CRITICAL,e)},n.prototype.error=function(e){this.log(zn.ERROR,e)},n.prototype.warn=function(e){this.log(zn.WARNING,e)},n.prototype.info=function(e){this.log(zn.INFO,e)},n.prototype.debug=function(e){this.log(zn.DEBUG,e)},n.prototype.trace=function(e){this.log(zn.TRACE,e)},n}(),bbe=function(n){Az(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){if(!(t>this._minLevel)){var i=Zj[t],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e}(s6),Tbe=function(){function n(e){var t=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=n6(r,function(o){return zN(o)}))!==null&&s!==void 0?s:i6(t),this._override=typeof i=="function"?{log:i}:i}return n.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},n.prototype.crit=function(e){this._override.crit?this._shouldLog(zn.CRITICAL)&&this._override.crit(e):this.log(zn.CRITICAL,e)},n.prototype.error=function(e){this._override.error?this._shouldLog(zn.ERROR)&&this._override.error(e):this.log(zn.ERROR,e)},n.prototype.warn=function(e){this._override.warn?this._shouldLog(zn.WARNING)&&this._override.warn(e):this.log(zn.WARNING,e)},n.prototype.info=function(e){this._override.info?this._shouldLog(zn.INFO)&&this._override.info(e):this.log(zn.INFO,e)},n.prototype.debug=function(e){this._override.debug?this._shouldLog(zn.DEBUG)&&this._override.debug(e):this.log(zn.DEBUG,e)},n.prototype.trace=function(e){this._override.trace?this._shouldLog(zn.TRACE)&&this._override.trace(e):this.log(zn.TRACE,e)},n.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},n}(),_g,vg,yg,xbe=(_g={},_g[zn.CRITICAL]="🛑",_g[zn.ERROR]="❌",_g[zn.WARNING]="⚠️ ",_g[zn.INFO]="ℹ️ ",_g[zn.DEBUG]="🐞",_g[zn.TRACE]="🐾",_g),wbe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},Cbe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function l1(n,e,t){return function(r){return"\x1B[".concat(n,"m").concat(t?t(r):r,"\x1B[").concat(e,"m")}}function uf(n){return l1(wbe[n],39)}function pS(n,e){return l1(Cbe[n],49,e)}var Rbe=(vg={},vg[zn.CRITICAL]=uf("red"),vg[zn.ERROR]=uf("redBright"),vg[zn.WARNING]=uf("yellow"),vg[zn.INFO]=uf("blue"),vg[zn.DEBUG]=uf("magenta"),vg[zn.TRACE]=l1(0,0),vg),uF=(yg={},yg[zn.CRITICAL]=pS("bgRed",uf("white")),yg[zn.ERROR]=pS("bgRedBright",uf("white")),yg[zn.WARNING]=pS("bgYellow",uf("black")),yg[zn.INFO]=pS("bgBlue",uf("white")),yg[zn.DEBUG]=pS("bgMagenta",uf("black")),yg[zn.TRACE]=l1(7,27),yg),Abe=function(n){Az(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){var i,s,o;if(!(t>this._minLevel)){var a=Zj[t],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=xbe[t];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=process.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(uF[t](this._name)," ").concat(uF[t](zn[t])," ").concat(Rbe[t](r)):c+="[".concat(this._name,":").concat(zn[t].toLowerCase(),"] ").concat(r),a(c)}},e}(s6);function u1(n){return n.custom?new Tbe(n):BN?new Abe(n):new bbe(n)}let Mbe=class extends Error{constructor(...e){var t;super(...e),Object.setPrototypeOf(this,new.target.prototype),(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class o6 extends Mbe{}class Ibe{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=u1({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,t){return await new Promise((r,i)=>{var s,o;const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t==null?void 0:t.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new o6(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const t=[];return this._partitionedQueue.set(e,t),t}async _runRequest(e,t){var r;const i=this._getPartitionedQueue(t);this._logger.debug(`doing a request for ${t?`partition ${t}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(t,((r=this._usedFromBucket.get(t))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{setTimeout(()=>{const c=this._usedFromBucket.get(t)-1;this._usedFromBucket.set(t,c),i.length&&c<this._bucketSize&&this._runNextRequest(t)},this._timeFrame)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class wI{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._paused=!1,this._logger=u1({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i}async request(e,t){return await new Promise((r,i)=>{var s;const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t==null?void 0:t.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new o6(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:t,resolve:r,reject:i}=e;try{r(await this._callback(t))}catch(s){i(s)}finally{setTimeout(()=>{this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class kbe extends wI{constructor(e,t){super({...t,async doRequest(r,i){return await e.request(r,i)}})}}class Obe{constructor(e,t,r,i=!1){this.owner=e,this.event=t,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}class gb{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e,...t){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...t);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...t)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(t)?i.get(t).push(r):i.set(t,[r]),new Obe(this,t,r,e)}_removeListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;if(!t)i.clear();else if(typeof t=="object"){const s=t;this._removeListener(s._internal,s.event,s.listener)}else{const s=t;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}}const Nbe=6e4;function Pbe(n){return fE(n.expiresIn,e=>n.obtainmentTimestamp+e*1e3-Nbe)}function fx(n){var e;return(e=fE(Pbe(n),t=>Date.now()>t))!==null&&e!==void 0?e:!1}var CI={exports:{}};(function(n,e){var t=typeof self<"u"?self:Ng,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(K){return K&&DataView.prototype.isPrototypeOf(K)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(K){return K&&l.indexOf(Object.prototype.toString.call(K))>-1};function h(K){if(typeof K!="string"&&(K=String(K)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(K))throw new TypeError("Invalid character in header field name");return K.toLowerCase()}function d(K){return typeof K!="string"&&(K=String(K)),K}function p(K){var te={next:function(){var Q=K.shift();return{done:Q===void 0,value:Q}}};return a.iterable&&(te[Symbol.iterator]=function(){return te}),te}function _(K){this.map={},K instanceof _?K.forEach(function(te,Q){this.append(Q,te)},this):Array.isArray(K)?K.forEach(function(te){this.append(te[0],te[1])},this):K&&Object.getOwnPropertyNames(K).forEach(function(te){this.append(te,K[te])},this)}_.prototype.append=function(K,te){K=h(K),te=d(te);var Q=this.map[K];this.map[K]=Q?Q+", "+te:te},_.prototype.delete=function(K){delete this.map[h(K)]},_.prototype.get=function(K){return K=h(K),this.has(K)?this.map[K]:null},_.prototype.has=function(K){return this.map.hasOwnProperty(h(K))},_.prototype.set=function(K,te){this.map[h(K)]=d(te)},_.prototype.forEach=function(K,te){for(var Q in this.map)this.map.hasOwnProperty(Q)&&K.call(te,this.map[Q],Q,this)},_.prototype.keys=function(){var K=[];return this.forEach(function(te,Q){K.push(Q)}),p(K)},_.prototype.values=function(){var K=[];return this.forEach(function(te){K.push(te)}),p(K)},_.prototype.entries=function(){var K=[];return this.forEach(function(te,Q){K.push([Q,te])}),p(K)},a.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function y(K){if(K.bodyUsed)return Promise.reject(new TypeError("Already read"));K.bodyUsed=!0}function S(K){return new Promise(function(te,Q){K.onload=function(){te(K.result)},K.onerror=function(){Q(K.error)}})}function T(K){var te=new FileReader,Q=S(te);return te.readAsArrayBuffer(K),Q}function A(K){var te=new FileReader,Q=S(te);return te.readAsText(K),Q}function R(K){for(var te=new Uint8Array(K),Q=new Array(te.length),ne=0;ne<te.length;ne++)Q[ne]=String.fromCharCode(te[ne]);return Q.join("")}function I(K){if(K.slice)return K.slice(0);var te=new Uint8Array(K.byteLength);return te.set(new Uint8Array(K)),te.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(K){this._bodyInit=K,K?typeof K=="string"?this._bodyText=K:a.blob&&Blob.prototype.isPrototypeOf(K)?this._bodyBlob=K:a.formData&&FormData.prototype.isPrototypeOf(K)?this._bodyFormData=K:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(K)?this._bodyText=K.toString():a.arrayBuffer&&a.blob&&c(K)?(this._bodyArrayBuffer=I(K.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(K)||u(K))?this._bodyArrayBuffer=I(K):this._bodyText=K=Object.prototype.toString.call(K):this._bodyText="",this.headers.get("content-type")||(typeof K=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(K)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var K=y(this);if(K)return K;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(T)}),this.text=function(){var K=y(this);if(K)return K;if(this._bodyBlob)return A(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(R(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var D=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function L(K){var te=K.toUpperCase();return D.indexOf(te)>-1?te:K}function z(K,te){te=te||{};var Q=te.body;if(K instanceof z){if(K.bodyUsed)throw new TypeError("Already read");this.url=K.url,this.credentials=K.credentials,te.headers||(this.headers=new _(K.headers)),this.method=K.method,this.mode=K.mode,this.signal=K.signal,!Q&&K._bodyInit!=null&&(Q=K._bodyInit,K.bodyUsed=!0)}else this.url=String(K);if(this.credentials=te.credentials||this.credentials||"same-origin",(te.headers||!this.headers)&&(this.headers=new _(te.headers)),this.method=L(te.method||this.method||"GET"),this.mode=te.mode||this.mode||null,this.signal=te.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Q)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Q)}z.prototype.clone=function(){return new z(this,{body:this._bodyInit})};function F(K){var te=new FormData;return K.trim().split("&").forEach(function(Q){if(Q){var ne=Q.split("="),G=ne.shift().replace(/\+/g," "),J=ne.join("=").replace(/\+/g," ");te.append(decodeURIComponent(G),decodeURIComponent(J))}}),te}function V(K){var te=new _,Q=K.replace(/\r?\n[\t ]+/g," ");return Q.split(/\r?\n/).forEach(function(ne){var G=ne.split(":"),J=G.shift().trim();if(J){var re=G.join(":").trim();te.append(J,re)}}),te}U.call(z.prototype);function W(K,te){te||(te={}),this.type="default",this.status=te.status===void 0?200:te.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in te?te.statusText:"OK",this.headers=new _(te.headers),this.url=te.url||"",this._initBody(K)}U.call(W.prototype),W.prototype.clone=function(){return new W(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},W.error=function(){var K=new W(null,{status:0,statusText:""});return K.type="error",K};var X=[301,302,303,307,308];W.redirect=function(K,te){if(X.indexOf(te)===-1)throw new RangeError("Invalid status code");return new W(null,{status:te,headers:{location:K}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(te,Q){this.message=te,this.name=Q;var ne=Error(te);this.stack=ne.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function $(K,te){return new Promise(function(Q,ne){var G=new z(K,te);if(G.signal&&G.signal.aborted)return ne(new o.DOMException("Aborted","AbortError"));var J=new XMLHttpRequest;function re(){J.abort()}J.onload=function(){var ue={status:J.status,statusText:J.statusText,headers:V(J.getAllResponseHeaders()||"")};ue.url="responseURL"in J?J.responseURL:ue.headers.get("X-Request-URL");var ye="response"in J?J.response:J.responseText;Q(new W(ye,ue))},J.onerror=function(){ne(new TypeError("Network request failed"))},J.ontimeout=function(){ne(new TypeError("Network request failed"))},J.onabort=function(){ne(new o.DOMException("Aborted","AbortError"))},J.open(G.method,G.url,!0),G.credentials==="include"?J.withCredentials=!0:G.credentials==="omit"&&(J.withCredentials=!1),"responseType"in J&&a.blob&&(J.responseType="blob"),G.headers.forEach(function(ue,ye){J.setRequestHeader(ye,ue)}),G.signal&&(G.signal.addEventListener("abort",re),J.onreadystatechange=function(){J.readyState===4&&G.signal.removeEventListener("abort",re)}),J.send(typeof G._bodyInit>"u"?null:G._bodyInit)})}return $.polyfill=!0,s.fetch||(s.fetch=$,s.Headers=_,s.Request=z,s.Response=W),o.Headers=_,o.Request=z,o.Response=W,o.fetch=$,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,n.exports=e})(CI,CI.exports);var a6=CI.exports;const Dbe=Wl(a6);var XR=Object.prototype.hasOwnProperty,Mv=Array.isArray,Kd=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),Lbe=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Mv(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);t.obj[t.prop]=i}}},c6=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},Ube=function n(e,t,r){if(!t)return e;if(typeof t!="object"){if(Mv(e))e.push(t);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!XR.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var i=e;return Mv(e)&&!Mv(t)&&(i=c6(e,r)),Mv(e)&&Mv(t)?(t.forEach(function(s,o){if(XR.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=n(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(t).reduce(function(s,o){var a=t[o];return XR.call(s,o)?s[o]=n(s[o],a,r):s[o]=a,s},i)},Fbe=function(e,t){return Object.keys(t).reduce(function(r,i){return r[i]=t[i],r},e)},Bbe=function(n,e,t){var r=n.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},zbe=function(e,t,r){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),r==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var s="",o=0;o<i.length;++o){var a=i.charCodeAt(o);if(a===45||a===46||a===95||a===126||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122){s+=i.charAt(o);continue}if(a<128){s=s+Kd[a];continue}if(a<2048){s=s+(Kd[192|a>>6]+Kd[128|a&63]);continue}if(a<55296||a>=57344){s=s+(Kd[224|a>>12]+Kd[128|a>>6&63]+Kd[128|a&63]);continue}o+=1,a=65536+((a&1023)<<10|i.charCodeAt(o)&1023),s+=Kd[240|a>>18]+Kd[128|a>>12&63]+Kd[128|a>>6&63]+Kd[128|a&63]}return s},Vbe=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(t.push({obj:o,prop:l}),r.push(u))}return Lbe(t),e},jbe=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Hbe=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Gbe=function(e,t){return[].concat(e,t)},VN={arrayToObject:c6,assign:Fbe,combine:Gbe,compact:Vbe,decode:Bbe,encode:zbe,isBuffer:Hbe,isRegExp:jbe,merge:Ube},Wbe=String.prototype.replace,$be=/%20/g,qbe=VN,hF={RFC1738:"RFC1738",RFC3986:"RFC3986"},Xbe=qbe.assign({default:hF.RFC3986,formatters:{RFC1738:function(n){return Wbe.call(n,$be,"+")},RFC3986:function(n){return String(n)}}},hF),l6=VN,LS=Xbe,Kbe=Object.prototype.hasOwnProperty,dF={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},ty=Array.isArray,Ybe=Array.prototype.push,RI=function(n,e){Ybe.apply(n,ty(e)?e:[e])},Jbe=Date.prototype.toISOString,fF=LS.default,gc={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:l6.encode,encodeValuesOnly:!1,format:fF,formatter:LS.formatters[fF],indices:!1,serializeDate:function(e){return Jbe.call(e)},skipNulls:!1,strictNullHandling:!1},Qbe=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Zbe=function n(e,t,r,i,s,o,a,c,l,u,h,d,p){var _=e;if(typeof a=="function"?_=a(t,_):_ instanceof Date?_=u(_):r==="comma"&&ty(_)&&(_=_.join(",")),_===null){if(i)return o&&!d?o(t,gc.encoder,p,"key"):t;_=""}if(Qbe(_)||l6.isBuffer(_)){if(o){var y=d?t:o(t,gc.encoder,p,"key");return[h(y)+"="+h(o(_,gc.encoder,p,"value"))]}return[h(t)+"="+h(String(_))]}var S=[];if(typeof _>"u")return S;var T;if(ty(a))T=a;else{var A=Object.keys(_);T=c?A.sort(c):A}for(var R=0;R<T.length;++R){var I=T[R];s&&_[I]===null||(ty(_)?RI(S,n(_[I],typeof r=="function"?r(t,I):t,r,i,s,o,a,c,l,u,h,d,p)):RI(S,n(_[I],t+(l?"."+I:"["+I+"]"),r,i,s,o,a,c,l,u,h,d,p)))}return S},eTe=function(e){if(!e)return gc;if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||gc.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=LS.default;if(typeof e.format<"u"){if(!Kbe.call(LS.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=LS.formatters[r],s=gc.filter;return(typeof e.filter=="function"||ty(e.filter))&&(s=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:gc.addQueryPrefix,allowDots:typeof e.allowDots>"u"?gc.allowDots:!!e.allowDots,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:gc.charsetSentinel,delimiter:typeof e.delimiter>"u"?gc.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:gc.encode,encoder:typeof e.encoder=="function"?e.encoder:gc.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:gc.encodeValuesOnly,filter:s,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:gc.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:gc.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:gc.strictNullHandling}},tTe=function(n,e){var t=n,r=eTe(e),i,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):ty(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof t!="object"||t===null)return"";var a;e&&e.arrayFormat in dF?a=e.arrayFormat:e&&"indices"in e?a=e.indices?"indices":"repeat":a="indices";var c=dF[a];i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);for(var l=0;l<i.length;++l){var u=i[l];r.skipNulls&&t[u]===null||RI(o,Zbe(t[u],u,c,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.formatter,r.encodeValuesOnly,r.charset))}var h=o.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),h.length>0?d+h:""};const u6=Wl(tTe);var nTe=VN;nTe.decode;const Iv=Symbol("twurpleRawData");class rTe{constructor(e){this[Iv]=e}}class D_ extends Error{constructor(e,t){var r;super(e,t),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function _b(n,e,t){return r=>{const i=t?function(){return`[${e}#${this[t]} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class pF extends D_{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function Wp(n){return typeof n=="string"?n:typeof n=="number"?n.toString(10):n.id}class h6 extends D_{constructor(e,t,r,i,s,o){super(`Encountered HTTP status code ${e}: ${t}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function iTe(n,e){var t;if(!n.ok){const r=n.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await n.json(),null,2):await n.text(),s=u6(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${e.url}${s}`;throw new h6(n.status,n.statusText,o,(t=e.method)!==null&&t!==void 0?t:"GET",i,r)}}async function sTe(n){if(n.status===204)return;const e=await n.text();if(e)return JSON.parse(e)}function oTe(n,e,t){switch(e){case"helix":return`https://api.twitch.tv/helix/${n.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${n.replace(/^\//,"")}`;case"custom":return n;default:return n}}async function aTe(n,e,t,r,i={},s){var o,a;const c=(o=n.type)!==null&&o!==void 0?o:"helix",l=oTe(n.url,c),u=u6(n.query,{arrayFormat:"repeat",addQueryPrefix:!0}),h=new a6.Headers({Accept:"application/json"});let d;n.jsonBody&&(d=JSON.stringify(n.jsonBody),h.append("Content-Type","application/json")),e&&c!=="auth"&&h.append("Client-ID",e),t&&h.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${t}`);const p={...i,method:(a=n.method)!==null&&a!==void 0?a:"GET",headers:h,body:d};return await Dbe(`${l}${u}`,p)}async function h1(n,e,t,r,i={}){const s=await aTe(n,e,t,r,i);return await iTe(s,n),await sTe(s)}class ny extends D_{constructor(e){super("Invalid token supplied",e)}}class px extends D_{}function cTe(n,e,t,r){return{grant_type:"authorization_code",client_id:n,client_secret:e,code:t,redirect_uri:r}}function lTe(n,e){return{grant_type:"client_credentials",client_id:n,client_secret:e}}function uTe(n,e,t){return{grant_type:"refresh_token",client_id:n,client_secret:e,refresh_token:t}}let AI=class extends rTe{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[Iv].client_id}get userId(){var e;return(e=this[Iv].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[Iv].login)!==null&&e!==void 0?e:null}get scopes(){return this[Iv].scopes}get expiryDate(){return fE(this[Iv].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};AI=ps([_b("auth","TokenInfo","clientId")],AI);function jN(n){var e,t;return{accessToken:n.access_token,refreshToken:n.refresh_token||null,scope:(e=n.scope)!==null&&e!==void 0?e:[],expiresIn:(t=n.expires_in)!==null&&t!==void 0?t:null,obtainmentTimestamp:Date.now()}}async function hTe(n,e,t,r){return jN(await h1({type:"auth",url:"token",method:"POST",query:cTe(n,e,t,r)}))}async function dTe(n,e){return jN(await h1({type:"auth",url:"token",method:"POST",query:lTe(n,e)}))}async function mF(n,e,t){return jN(await h1({type:"auth",url:"token",method:"POST",query:uTe(n,e,t)}))}async function pE(n,e){try{const t=await h1({type:"auth",url:"validate"},e,n);return new AI(t)}catch(t){throw t instanceof h6&&t.statusCode===401?new ny({cause:t}):t}}const fTe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function pTe(n,e){if(e!=null&&e.length){const t=new Set(n.flatMap(r=>{var i;return[r,...(i=fTe.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!t.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function mx(n,e){for(const t of e)pTe(n,t)}async function mTe(n,e,t,r,i){if(i!=null&&i.length||!t){const s=await pE(e,n);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&mx(o,i.filter(a=>!!a)),[o,s.userId]}return[r,t]}class gF{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var t;const r=e.filter(a=>!!a);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:a,resolve:c,reject:l}=xI();this._queuePromise=a,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(h){l(h)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:o}=xI();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(a){o(a)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(t=this._queueExecutor)===null||t===void 0||t.call(this)}return await i}}class _F extends D_{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class gTe extends D_{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class _Te extends D_{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let $g=class extends gb{constructor(e){var t;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(t=e.appImpliedScopes)!==null&&t!==void 0?t:[],this._appTokenFetcher=new gF(async r=>await this._fetchAppToken(r))}addUser(e,t,r){const i=Wp(e);if(!t.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...t,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new gF(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,t){let r=null;if(e.accessToken&&!fx(e))try{const a=await pE(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof ny))throw a}if(!r){if(!e.refreshToken)throw new ny;const a=await mF(this._clientId,this._clientSecret,e.refreshToken),c=await pE(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new px("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,t),s.userId}async addUserForCode(e,t){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await hTe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,t)}hasUser(e){return this._userTokenFetchers.has(Wp(e))}removeUser(e){const t=Wp(e);if(this._userIdToIntents.has(t)){const r=this._userIdToIntents.get(t);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(t)}this._userAccessTokens.delete(t),this._userTokenFetchers.delete(t),this._cachedRefreshFailures.delete(t)}addIntentsToUser(e,t){const r=Wp(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of t)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const t=Wp(e);return this._userIdToIntents.has(t)?Array.from(this._userIdToIntents.get(t)):[]}removeIntents(e){var t;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(t=this._userIdToIntents.get(i))===null||t===void 0||t.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const t=Wp(e);if(this._cachedRefreshFailures.has(t))throw new _F(t);const r=this._userAccessTokens.get(t);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(t,r.refreshToken);return this._checkIntermediateUserRemoval(t),this._userAccessTokens.set(t,{...i,userId:t}),this.emit(this.onRefresh,t,i),{...i,userId:t}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new _Te(e);const t=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(t)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var t;const r=this._userAccessTokens.get(Wp(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(t=r.scope)!==null&&t!==void 0?t:[]}async getAccessTokenForUser(e,...t){const r=Wp(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new _F(r);return mx(this.getCurrentScopesForUser(r),t.filter(Boolean)),await i.fetch(...t)}async getAccessTokenForIntent(e,...t){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...t);if(!i)throw new pF(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const t=Wp(e);if(this._userAccessTokens.has(t)){const r=await this.getAccessTokenForUser(t);if(!r)throw new pF(`Token for user ID ${t} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:t}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(t=>[t]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new gTe(e)}async _fetchUserToken(e,t){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!fx(r))try{if(r.scope)return mx(r.scope,t),r;const[s=[]]=await mTe(this._clientId,r.accessToken,e,r.scope,t),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof ny))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return mx(i.scope,t),i}async _refreshUserTokenWithCallback(e,t){try{return await mF(this.clientId,this._clientSecret,t)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const t of e)if(this._appImpliedScopes.length){if(t.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${t.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${t.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||fx(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await dTe(this._clientId,this._clientSecret)}};ps([n0(!1)],$g.prototype,"_clientSecret",void 0);ps([n0(!1)],$g.prototype,"_userAccessTokens",void 0);ps([n0(!1)],$g.prototype,"_userTokenFetchers",void 0);ps([n0(!1)],$g.prototype,"_appAccessToken",void 0);ps([n0(!1)],$g.prototype,"_appTokenFetcher",void 0);$g=ps([_b("auth","RefreshingAuthProvider","clientId")],$g);class vTe extends gb{constructor({lineBased:e,logger:t,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=t,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var t,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(t=i.shift())!==null&&t!==void 0?t:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class yTe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class STe extends gb{constructor(e,t,r={}){var i;super(),this._type=e,this._target=t,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&t!==void 0?t:!1}get isConnecting(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&t!==void 0?t:this._connecting}get hasSocket(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&t!==void 0?t:!1}sendLine(e){var t;(t=this._currentConnection)===null||t===void 0||t.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const t=this._currentConnection;this._currentConnection=void 0,t.disconnect()}}assumeExternalDisconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(t=this._currentConnection)===null||t===void 0||t.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var t,r;(t=this._logger)===null||t===void 0||t.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=e6(120));const s=this._currentConnection=new this._type(_be(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a==null?void 0:a.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var d;this._connecting&&((d=this._logger)===null||d===void 0||d.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var kv=null;typeof WebSocket<"u"?kv=WebSocket:typeof MozWebSocket<"u"?kv=MozWebSocket:typeof global<"u"?kv=global.WebSocket||global.MozWebSocket:typeof window<"u"?kv=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(kv=self.WebSocket||self.MozWebSocket);class ETe extends vTe{constructor(e,t){if(super(t),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var t;(t=this._socket)===null||t===void 0||t.send(e)}connect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new kv(this._url,(t=this._additionalOptions)===null||t===void 0?void 0:t.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(t=this._socket)===null||t===void 0||t.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function US(n){var e,t,r;if(Array.isArray(n)){for(t=Array(e=n.length);e--;)t[e]=(r=n[e])&&typeof r=="object"?US(r):r;return t}if(Object.prototype.toString.call(n)==="[object Object]"){t={};for(e in n)e==="__proto__"?Object.defineProperty(t,e,{value:US(n[e]),configurable:!0,enumerable:!0,writable:!0}):t[e]=(r=n[e])&&typeof r=="object"?US(r):r;return t}return n}const bTe={name:"away-notify"};class bw extends Error{constructor(e,t,r){super(`command "${e}" expected ${t} or more parameters, got ${r}`),this._command=e,this._expectedParams=t,this._actualParams=r,Object.setPrototypeOf(this,bw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bw)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class Tw extends Error{constructor(e,t,r,i){var s;super(`required parameter "${t}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=t,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,Tw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Tw)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const ry={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var d6={exports:{}};(function(n){n.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},n.exports.default=n.exports})(d6);var TTe=d6.exports;const xTe=Wl(TTe);function MI(n,e="#&"){return new RegExp(`^[${xTe(e)}][^ \b\0
\r,]+$`).test(n)}const vF={0:"\0",n:`
`,r:"\r","":""};function yF(n){if(!n.startsWith("")||(n=n.substring(1),n.endsWith("")&&(n=n.slice(0,-1)),!n))return!1;n=n.replace(/\x10(.)/,(r,i)=>i in vF?vF[i]:"");let[e,t=""]=i_(n," ",2);return e=e?e.toUpperCase():"",{command:e,params:t}}const wTe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function CTe(n){return n.replace(/[\\;\n\r ]/g,e=>`\\${wTe[e]}`)}function RTe(n){let e=`${n.nick}`;return n.user&&(e+=`!${n.user}`),n.host&&(e+=`@${n.host}`),e}function ATe(n,e,t,r,i=ry,s=!1){const o=new n(n.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&TI(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(n.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${n.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(t,r),o}class gt{static checkParam(e,t,r=ry){return!(t.type==="channel"&&!MI(e,r.channelTypes)||t.type==="channelList"&&!e.split(",").every(s=>MI(s,r.channelTypes))||t.match&&!t.match.test(e))}constructor(e,{params:t,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=ry,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=ry,this._paramSpec=l,this._command=e,this._params=t,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(t=>t.noServer&&e||t.noClient&&!e?!1:!t.optional).length:0}get paramCount(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0}prefixToString(){return this._prefix?RTe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,t])=>t?`${e}=${CTe(t)}`:e).join(";")}toString(e=!1,t=!1){const i=[t?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,t){this._prefix=e,t&&(this._tags=t)}parseParams(e=!1){if(this._params){let t=this.getMinParamCount(e);if(t>this._params.length)throw new bw(this._command,t,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=t){if(a.optional)continue;if(this._params.length-i!==t)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(gt.checkParam(c.value,a))s[o]={...c},a.optional||--t,a.rest||++i;else if(!a.optional)throw new Tw(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&t!==void 0?t:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(t=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[t];if(i)return(i.trailing?":":"")+i.value}).filter(t=>t!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,t;return[this._command,...(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&t!==void 0?t:[]].join(" ")}}gt.COMMAND="";gt.SUPPORTS_CAPTURE=!1;class f6 extends gt{constructor(e,t,r){super(e,t,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}f6.COMMAND="BATCH";const MTe={name:"batch",messageTypes:[f6],usesTags:!0},ITe={name:"cap-notify"};class p6 extends gt{constructor(e,t,r){super(e,t,r,{newUser:{},newHost:{}})}}p6.COMMAND="CHGHOST";const kTe={name:"chghost",messageTypes:[p6]},OTe={name:"invite-notify"};class m6 extends gt{}m6.COMMAND="ACK";const NTe={name:"labeled-response",messageTypes:[m6],usesTags:!0},PTe={name:"message-tags",usesTags:!0},DTe={name:"multi-prefix"},LTe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:bTe,Batch:MTe,CapNotify:ITe,ChgHost:kTe,InviteNotify:OTe,LabeledResponse:NTe,MessageTags:PTe,MultiPrefix:DTe},Symbol.toStringTag,{value:"Module"}));class UTe{constructor(e,t,...r){this._client=e,this._originalMessage=t,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const t=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,t)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class HN extends gt{constructor(e,t,r){super(e,t,r,{password:{}})}}HN.COMMAND="PASS";class FS extends gt{constructor(e,t,r){super(e,t,r,{nick:{}})}}FS.COMMAND="NICK";class GN extends gt{constructor(e,t,r){super(e,t,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}GN.COMMAND="USER";class g6 extends gt{constructor(e,t,r){super(e,t,r,{name:{},password:{}})}}g6.COMMAND="OPER";class WN extends gt{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}WN.COMMAND="QUIT";class _6 extends gt{constructor(e,t,r){super(e,t,r,{server:{},reason:{trailing:!0}})}}_6.COMMAND="SQUIT";class mE extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},key:{optional:!0}})}}mE.COMMAND="JOIN";class gE extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}gE.COMMAND="PART";class xw extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,xw.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xw)}get char(){return this._char}}class v6 extends gt{constructor(e,t,r){super(e,t,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return MI(this.target,this._serverProperties.channelTypes)}separate(){const e=[],t=this.modes;if(!t)throw new Error("can't separate a channel mode request, just set actions");const r=t.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new xw(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}v6.COMMAND="MODE";class y6 extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}y6.COMMAND="TOPIC";class vb extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channelList",optional:!0}})}}vb.COMMAND="NAMES";vb.SUPPORTS_CAPTURE=!0;class S6 extends gt{constructor(e,t,r){super(e,t,r,{channel:{optional:!0},server:{optional:!0}})}}S6.COMMAND="LIST";class E6 extends gt{constructor(e,t,r){super(e,t,r,{target:{},channel:{type:"channel"}})}}E6.COMMAND="INVITE";class b6 extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}b6.COMMAND="KICK";class T6 extends gt{constructor(e,t,r){super(e,t,r,{server:{optional:!0}})}}T6.COMMAND="TIME";class _E extends gt{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}_E.COMMAND="PRIVMSG";class d1 extends gt{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}d1.COMMAND="NOTICE";class f1 extends gt{constructor(e,t,r){super(e,t,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}f1.COMMAND="WHO";class x6 extends gt{constructor(e,t,r){super(e,t,r,{server:{optional:!0},nickMask:{}})}}x6.COMMAND="WHOIS";class w6 extends gt{constructor(e,t,r){super(e,t,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}w6.COMMAND="WHOWAS";class C6 extends gt{constructor(e,t,r){super(e,t,r,{target:{},reason:{trailing:!0,optional:!0}})}}C6.COMMAND="KILL";class ww extends gt{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}ww.COMMAND="PING";class Cw extends gt{constructor(e,t,r){super(e,t,r,{server:{noClient:!0},text:{trailing:!0}})}}Cw.COMMAND="PONG";class R6 extends gt{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}R6.COMMAND="ERROR";class A6 extends gt{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}A6.COMMAND="AWAY";class M6 extends gt{}M6.COMMAND="REHASH";class I6 extends gt{}I6.COMMAND="RESTART";class k6 extends gt{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}k6.COMMAND="WALLOPS";class O6 extends gt{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}O6.COMMAND="USERHOST";class N6 extends gt{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}N6.COMMAND="ISON";class Yu extends gt{constructor(e,t,r){super(e,t,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof Yu))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof Yu))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}Yu.COMMAND="CAP";Yu.SUPPORTS_CAPTURE=!0;class P6 extends gt{constructor(e,t,r){super(e,t,r,{target:{}})}}P6.COMMAND="TAGMSG";const D6=Object.freeze(Object.defineProperty({__proto__:null,Away:A6,CapabilityNegotiation:Yu,ChannelInvite:E6,ChannelJoin:mE,ChannelKick:b6,ChannelList:S6,ChannelPart:gE,ClientQuit:WN,ErrorMessage:R6,IsOnQuery:N6,Kill:C6,Mode:v6,Names:vb,NickChange:FS,Notice:d1,OperLogin:g6,Password:HN,Ping:ww,Pong:Cw,PrivateMessage:_E,Rehash:M6,Restart:I6,ServerQuit:_6,TagMessage:P6,Time:T6,Topic:y6,UserHostQuery:O6,UserRegistration:GN,Wallops:k6,WhoIsQuery:x6,WhoQuery:f1,WhoWasQuery:w6},Symbol.toStringTag,{value:"Module"}));class $N extends gt{constructor(e,t,r){super(e,t,r,{me:{},welcomeText:{trailing:!0}})}}$N.COMMAND="001";class L6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},yourHost:{trailing:!0}})}}L6.COMMAND="002";class U6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},createdText:{trailing:!0}})}}U6.COMMAND="003";class qN extends gt{constructor(e,t,r){super(e,t,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}qN.COMMAND="004";class XN extends gt{constructor(e,t,r){super(e,t,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}XN.COMMAND="005";class F6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},modes:{}})}}F6.COMMAND="221";class B6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},text:{trailing:!0}})}}B6.COMMAND="301";class z6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},hosts:{trailing:!0}})}}z6.COMMAND="302";class V6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}V6.COMMAND="305";class j6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}j6.COMMAND="306";class H6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}H6.COMMAND="311";class G6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof f1}endsResponseTo(){return!0}}G6.COMMAND="315";class W6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}W6.COMMAND="318";class $6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channels:{trailing:!0}})}}$6.COMMAND="319";class q6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}q6.COMMAND="322";class X6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}X6.COMMAND="323";class K6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}K6.COMMAND="324";class Y6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Y6.COMMAND="331";class J6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}J6.COMMAND="332";class Q6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}Q6.COMMAND="333";class Z6 extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"}})}}Z6.COMMAND="341";class eH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}eH.COMMAND="348";class tH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}tH.COMMAND="349";class nH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof f1}}nH.COMMAND="352";class rH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof vb}}rH.COMMAND="353";class iH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof vb}endsResponseTo(){return!0}}iH.COMMAND="366";class sH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}sH.COMMAND="367";class oH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}oH.COMMAND="368";class aH extends gt{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}aH.COMMAND="372";class cH extends gt{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}cH.COMMAND="375";class KN extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}KN.COMMAND="376";class lH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}lH.COMMAND="381";class uH extends gt{constructor(e,t,r){super(e,t,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}uH.COMMAND="391";class hH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}}hH.COMMAND="401";class dH extends gt{constructor(e,t,r){super(e,t,r,{me:{},server:{},suffix:{trailing:!0}})}}dH.COMMAND="402";class fH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}fH.COMMAND="403";class pH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}pH.COMMAND="404";class mH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}mH.COMMAND="405";class gH extends gt{constructor(e,t,r){super(e,t,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}gH.COMMAND="410";class _H extends gt{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}_H.COMMAND="421";class YN extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}YN.COMMAND="422";class vH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}vH.COMMAND="431";class yH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}yH.COMMAND="432";class SH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}SH.COMMAND="433";class EH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}EH.COMMAND="436";class bH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}bH.COMMAND="441";class TH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}TH.COMMAND="442";class xH extends gt{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}xH.COMMAND="443";class wH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}wH.COMMAND="451";class CH extends gt{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}CH.COMMAND="461";class JN extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}JN.COMMAND="462";class RH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}RH.COMMAND="471";class AH extends gt{constructor(e,t,r){super(e,t,r,{me:{},char:{},suffix:{trailing:!0}})}}AH.COMMAND="472";class MH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}MH.COMMAND="473";class IH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}IH.COMMAND="474";class kH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}kH.COMMAND="475";class OH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}OH.COMMAND="479";class NH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}NH.COMMAND="481";class PH extends gt{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}PH.COMMAND="482";class DH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}DH.COMMAND="491";class LH extends gt{constructor(e,t,r){super(e,t,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}LH.COMMAND="501";class UH extends gt{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}UH.COMMAND="502";const FH=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:hH,Error402NoSuchServer:dH,Error403NoSuchChannel:fH,Error404CanNotSendToChan:pH,Error405TooManyChannels:mH,Error410InvalidCapCmd:gH,Error421UnknownCommand:_H,Error422NoMotd:YN,Error431NoNickNameGiven:vH,Error432ErroneusNickname:yH,Error433NickNameInUse:SH,Error436NickCollision:EH,Error441UserNotInChannel:bH,Error442NotOnChannel:TH,Error443UserOnChannel:xH,Error451NotRegistered:wH,Error461NeedMoreParams:CH,Error462AlreadyRegistered:JN,Error471ChannelIsFull:RH,Error472UnknownMode:AH,Error473InviteOnlyChan:MH,Error474BannedFromChan:IH,Error475BadChannelKey:kH,Error479BadChanName:OH,Error481NoPrivileges:NH,Error482ChanOpPrivsNeeded:PH,Error491NoOperHost:DH,Error501UmodeUnknownFlag:LH,Error502UsersDontMatch:UH,Reply001Welcome:$N,Reply002YourHost:L6,Reply003Created:U6,Reply004ServerInfo:qN,Reply005Isupport:XN,Reply221UmodeIs:F6,Reply301Away:B6,Reply302UserHost:z6,Reply305UnAway:V6,Reply306NowAway:j6,Reply311WhoisUser:H6,Reply315EndOfWho:G6,Reply318EndOfWhois:W6,Reply319WhoisChannels:$6,Reply322List:q6,Reply323ListEnd:X6,Reply324ChannelModeIs:K6,Reply331NoTopic:Y6,Reply332Topic:J6,Reply333TopicWhoTime:Q6,Reply341Inviting:Z6,Reply348ExceptList:eH,Reply349EndOfExceptList:tH,Reply352WhoReply:nH,Reply353NamesReply:rH,Reply366EndOfNames:iH,Reply367BanList:sH,Reply368EndOfBanList:oH,Reply372Motd:aH,Reply375MotdStart:cH,Reply376EndOfMotd:KN,Reply381YoureOper:lH,Reply391Time:uH},Symbol.toStringTag,{value:"Module"})),FTe=new Map([...Object.values(D6),...Object.values(FH)].map(n=>[n.COMMAND,n]));function BTe(n){const[e,t]=i_(n,"!",2);if(t){const[r,i]=i_(t,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const SF={":":";",n:`
`,r:"\r",s:" "};function zTe(n){const e=new Map,t=n.split(";");for(const r of t){const[i,s]=i_(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(SF,a)?SF[a]:a):"")}return e}function VTe(n,e=ry,t=FTe,r=!1,i=[],s=!0){const o=n.split(" ");let a,c;const l=[];let u,h;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!h)u=zTe(a.slice(1));else if(a.startsWith(":"))if(!h&&!c)a.length>1&&(h=BTe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${n}`);s&&(s=!i.includes(c));let d=gt;return t.has(c)&&(d=t.get(c)),new d(c,{params:l,tags:u,prefix:h,rawLine:n},{serverProperties:e,isServer:r,shouldParseParams:s})}class BH extends gb{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=US(ry),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:t,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=t;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=u1({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:d=!0}=t,p={hostName:u,port:this.port,secure:h},_={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},y=o?ETe:yTe;d?this._connection=new STe(y,p,_):this._connection=new y(_,this._logger,e.connectionOptions);for(const S of Object.values(LTe))this.addCapability(S);this.addInternalListener(this.onRegister,async()=>{const S=this._hasRegisteredBefore,T=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const A=S&&this._options.rejoinChannelsOnReconnect?T:await bI(i);if(A)for(const R of A)this.join(R)}),this.onTypedMessage(Yu,async({subCommand:S,capabilities:T})=>{const A=T.split(" ");switch(S.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${A.join(", ")}`);const R=AT(A,U=>{if(!U)return{};const[D,L]=i_(U,"=",2);return{[D]:{name:D,param:L||!0}}});for(const[U,D]of Object.entries(R))this._serverCapabilities.set(U,D);const I=Object.keys(R);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([U])=>I.includes(U)).map(([,U])=>U));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${A.join(", ")}`);for(const R of A)this._serverCapabilities.delete(R),this._negotiatedCapabilities.delete(R)}}}),this.onTypedMessage(ww,({text:S})=>{this.sendMessage(Cw,{text:S})}),this.onTypedMessage($N,({me:S})=>this._handleReceivedClientNick(S)),this.onTypedMessage(qN,({userModes:S})=>{S&&(this._serverProperties.supportedUserModes=S)}),this.onTypedMessage(XN,({supports:S})=>{const T=AT(S.split(" "),A=>{const[R,I]=i_(A,"=",2);return{[R]:I||!0}});this._supportedFeatures={...this._supportedFeatures,...T}}),this.onTypedMessage(KN,({me:S})=>{this._registered||(this._handleReceivedClientNick(S),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(YN,({me:S})=>{this._registered||(this._handleReceivedClientNick(S),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(JN,({me:S})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(S),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(_E,S=>{var T;const{target:A,text:R}=S,I=yF(R),U=(T=S.prefix)===null||T===void 0?void 0:T.nick;I?I.command==="ACTION"?this.emit(this.onAction,A,U,I.params,S):this.emit(this.onCtcp,A,U,I.command,I.params,S):this.emit(this.onPrivmsg,A,U,R,S)}),this.onTypedMessage(FS,S=>{var T;const{nick:A}=S,R=(T=S.prefix)===null||T===void 0?void 0:T.nick;R===this._currentNick&&(this._currentNick=A),this.emit(this.onNickChange,R,A,S)}),this.onTypedMessage(d1,S=>{var T;const{target:A,text:R}=S,I=yF(R),U=(T=S.prefix)===null||T===void 0?void 0:T.nick;I&&this.emit(this.onCtcpReply,A,U,I.command,I.params,S),this.emit(this.onNotice,A,U,R,S)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(mE,({channel:S,prefix:T})=>{(T==null?void 0:T.nick)===this._currentNick&&this.acknowledgeJoin(S)}),this.onTypedMessage(gE,S=>{var T;((T=S.prefix)===null||T===void 0?void 0:T.nick)===this._currentNick&&(this._currentChannels.delete(S.channel),this._channelsFromLastRegister.delete(S.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var t;this._logger.debug(`Received message: ${e}`);let r;try{r=VTe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((t=i.stack)!==null&&t!==void 0?t:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return US(this._serverProperties)}get port(){const{webSocket:e,connection:{port:t,secure:r}}=this._options;return t||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),t=e.toString(),r=this.onTypedMessage(Cw,i=>{const{text:s}=i;s===t&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(ww,{text:t})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const t of Object.values(e.messageTypes))this.registerMessageType(t)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,t,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${ybe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,t),r}onTypedMessage(e,t,r){return this.onNamedMessage(e.COMMAND,t,r)}removeMessageListener(e){const[t]=e.split(":");this._events.has(t)&&this._events.get(t).delete(e)}createMessage(e,t,r){const i=r?new Map(Object.entries(r)):void 0;return ATe(e,t,void 0,i,this.serverProperties)}sendMessage(e,t,r){this.send(this.createMessage(e,t,r))}async sendMessageAndCaptureReply(e,t){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,t),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...t){const r=new UTe(this,e,...t);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(t=>t===e),1)}join(e,t){this.sendMessage(mE,{channel:e,key:t})}part(e){this.sendMessage(gE,{channel:e})}quit(e){this.sendMessage(WN,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,t,r={}){this.sendMessage(_E,{target:e,text:t},r)}sendCtcp(e,t,r){this.say(e,`${t.toUpperCase()} ${r}`)}action(e,t){this.sendCtcp(e,"ACTION",t)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(FS,{nick:e}))}registerCoreMessageTypes(){TI(D6,e=>{this.registerMessageType(e)}),TI(FH,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(t=>t.length).map(async t=>await this._negotiateCapabilities(t)))}async _negotiateCapabilities(e){const t=AT(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(Yu,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof Yu))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>t[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,t;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([bI(this._options.credentials.password),this.sendMessageAndCaptureReply(Yu,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof Yu))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>AT(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=i_(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(Yu,{subCommand:"END"})})]);r&&this.sendMessage(HN,{password:r}),this.sendMessage(FS,{nick:this._desiredNick}),this.sendMessage(GN,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(t=this._realName)!==null&&t!==void 0?t:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,t)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=t?`Disconnected unexpectedly: ${t.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,t)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const t=this._events.get(e.constructor.COMMAND);if(t)for(const r of t.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}ps([n0(!1)],BH.prototype,"_options",void 0);class QN extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}QN.COMMAND="CLEARCHAT";class zH extends gt{}zH.COMMAND="RECONNECT";class ZN extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}ZN.COMMAND="ROOMSTATE";function jTe(n){switch(typeof n){case"undefined":return"";case"object":{if(n===null)return"";if("cacheKey"in n)return n.cacheKey;const e=JSON.stringify(n);if(e!=="{}")return e}default:return n.toString()}}function VH(n,e,t){return[n,...e.map(jTe)].join("/")+(t?"/":"")}const $p=Symbol("cache");function HTe(n){var e,t;return t=class extends n{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[$p].has(r)){const i=this[$p].get(r);if(i)return i.value}}setCache(r,i,s){this[$p].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[$p].forEach((o,a)=>{a.startsWith(s)&&this[$p].delete(a)}):this[$p].delete(s)}_cleanCache(){const r=Date.now();this[$p].forEach((i,s)=>{i.expires<r&&this[$p].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return VH(s,r,i)}}},e=$p,t}function jH(n=1/0){return function(e,t,r){if(r.get){const i=r.get;r.get=function(){const s=VH(t,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,n),a}}return r}}var gx;let qg=gx=class{constructor(e,t){this._userName=e.toLowerCase(),this._userData=t?new Map(t):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(t=>{const r=t.indexOf("/");return r===-1?[t,""]:[t.slice(0,r),t.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return gx._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return gx._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};ps([n0(!1)],qg.prototype,"_userData",void 0);ps([jH()],qg.prototype,"badges",null);ps([jH()],qg.prototype,"badgeInfo",null);qg=gx=ps([HTe,_b("chat","ChatUser","userId")],qg);function eP(n){return n?new Map(n.split("/").map(e=>{const[t,r]=e.split(":",2);return r?[t,r.split(",")]:null}).filter(e=>e!==null)):new Map}class tP extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new qg(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return eP(this._tags.get("emotes"))}}tP.COMMAND="USERNOTICE";class HH extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}HH.COMMAND="USERSTATE";class nP extends gt{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}get userInfo(){return new qg(this._prefix.nick,this._tags)}get emoteOffsets(){return eP(this._tags.get("emotes"))}}nP.COMMAND="WHISPER";const GTe={name:"twitch.tv/commands",messageTypes:[QN,zH,ZN,tP,HH,nP]},WTe={name:"twitch.tv/membership"};class rP extends gt{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}rP.COMMAND="CLEARMSG";class GH extends gt{}GH.COMMAND="GLOBALUSERSTATE";const $Te={name:"twitch.tv/tags",messageTypes:[GH,rP]},qTe=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let Rw=class extends _E{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new qg(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return eP(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return fE(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return fE(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?qTe.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};Rw=ps([_b("chat","ChatMessage","id")],Rw);function XTe(n){return n instanceof Rw?n.tags.get("id"):n}function EF(n,e){if(n.length<=e)return[n];n=n.trim();const t=[];let r=0,i=e;for(;r<n.length;){let s=n.lastIndexOf(" ",i);(s===-1||s<=r||n.length-r+1<=e)&&(s=r+e);const o=n.slice(r,s).trim();o.length&&t.push(o),r=s+(n[s]===" "?1:0),i=r+e}return t}const KTe=/^[a-z0-9][a-z0-9_]{0,24}$/;function ia(n){const e=n.replace(/^#/,"").toLowerCase();if(!KTe.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function MT(n){return`#${ia(n)}`}var II;let Aw=II=class extends gb{constructor(e={}){var t,r,i,s,o;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new px("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new BH({connection:{hostName:(t=e.hostName)!==null&&t!==void 0?t:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{this._messageRateLimiter.clear(),this._messageRateLimiter.pause(),this._joinRateLimiter.clear(),this._joinRateLimiter.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(Rw),this._chatLogger=u1({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"];const a=async({type:l,text:u,channel:h,tags:d})=>{l==="say"?this._ircClient.say(h,u,d):this._ircClient.action(h,u)},c=async l=>{const{promise:u,resolve:h,reject:d}=xI();let p;const _=this.addInternalListener(this._onJoinResult,(y,S,T)=>{y===l&&(clearTimeout(p),T?d(T):h(),this.removeListener(_))});p=setTimeout(()=>{this.removeListener(_),this.emit(this._onJoinResult,l,void 0,"twurple_timeout"),d(new Error(`Did not receive a reply to join ${l} in time; assuming that the join failed`))},1e4),this._ircClient.join(l),await u};if(e.isAlwaysMod)this._messageRateLimiter=new wI({bucketSize:e.botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:a});else{let l=20;e.botLevel==="verified"?l=7500:e.botLevel==="known"&&(l=50),this._messageRateLimiter=new kbe(new Ibe({bucketSize:1,timeFrame:1200,logger:{minLevel:zn.ERROR},doRequest:a,getPartitionKey:({channel:u})=>u}),{bucketSize:l,timeFrame:32e3})}this._joinRateLimiter=new wI({bucketSize:e.botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:c}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause(),this._ircClient.addCapability($Te),this._ircClient.addCapability(GTe),e.requestMembershipEvents&&this._ircClient.addCapability(WTe),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{this._messageRateLimiter.resume(),this._joinRateLimiter.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const l=await bI(e.channels);l&&await Promise.all(l.map(async u=>{var h;try{await this.join(u)}catch(d){this._chatLogger.warn(`Failed to join configured channel ${u}; original message: ${(h=d==null?void 0:d.message)!==null&&h!==void 0?h:d}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,d)=>{u!=="jtv"&&this.emit(this.onMessage,ia(l),u,h,d)}),this._ircClient.onAction((l,u,h,d)=>{this.emit(this.onAction,ia(l),u,h,d)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,ia(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(QN,l=>{const{channel:u,user:h,tags:d}=l,p=ia(u);if(h){const _=d.get("ban-duration");_===void 0?this.emit(this.onBan,p,h,l):this.emit(this.onTimeout,p,h,Number(_),l)}else this.emit(this.onChatClear,p,l)}),this._ircClient.onTypedMessage(rP,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,ia(u),h,l)}),this._ircClient.onTypedMessage(mE,({prefix:l,channel:u})=>{this.emit(this.onJoin,ia(u),l.nick)}),this._ircClient.onTypedMessage(gE,({prefix:l,channel:u})=>{this.emit(this.onPart,ia(u),l.nick)}),this._ircClient.onTypedMessage(ZN,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const d=ia(l);if(u.has("slow")){const p=Number(u.get("slow"));p?this.emit(this.onSlow,d,!0,p):this.emit(this.onSlow,d,!1)}if(u.has("followers-only")){const p=Number(u.get("followers-only"));p===-1?this.emit(this.onFollowersOnly,d,!1):this.emit(this.onFollowersOnly,d,!0,p)}}}),this._ircClient.onTypedMessage(tP,l=>{const{channel:u,text:h,tags:d}=l,p=d.get("msg-id"),_=ia(u);switch(p){case"sub":case"resub":{const y=p==="sub"?this.onSub:this.onResub,S=d.get("msg-param-sub-plan"),T=d.get("msg-param-streak-months"),A={userId:d.get("user-id"),displayName:d.get("display-name"),plan:S,planName:d.get("msg-param-sub-plan-name"),isPrime:S==="Prime",months:Number(d.get("msg-param-cumulative-months")),streak:T?Number(T):void 0,message:h};if(d.get("msg-param-was-gifted")==="true"){const I=d.get("msg-param-anon-gift")==="true",U=Number(d.get("msg-param-gift-months")),D=Number(d.get("msg-param-gift-month-being-redeemed"));I?A.originalGiftInfo={anonymous:!0,duration:U,redeemedMonth:D}:A.originalGiftInfo={anonymous:!1,duration:U,redeemedMonth:D,userId:d.get("msg-param-gifter-id"),userName:d.get("msg-param-gifter-login"),userDisplayName:d.get("msg-param-gifter-name")}}this.emit(y,_,d.get("login"),A,l);break}case"subgift":{const y=d.get("msg-param-sub-plan"),S=d.get("login"),T=S==="ananonymousgifter",A={userId:d.get("msg-param-recipient-id"),displayName:d.get("msg-param-recipient-display-name"),gifter:T?void 0:S,gifterUserId:T?void 0:d.get("user-id"),gifterDisplayName:T?void 0:d.get("display-name"),gifterGiftCount:T?void 0:Number(d.get("msg-param-sender-count")),giftDuration:Number(d.get("msg-param-gift-months")),plan:y,planName:d.get("msg-param-sub-plan-name"),isPrime:y==="Prime",months:Number(d.get("msg-param-months"))};this.emit(this.onSubGift,_,d.get("msg-param-recipient-user-name"),A,l);break}case"submysterygift":{const y=d.get("login"),S=y==="ananonymousgifter",T={gifter:S?void 0:y,gifterUserId:S?void 0:d.get("user-id"),gifterDisplayName:S?void 0:d.get("display-name"),gifterGiftCount:S?void 0:Number(d.get("msg-param-sender-count")),count:Number(d.get("msg-param-mass-gift-count")),plan:d.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,_,d.get("login"),T,l);break}case"primepaidupgrade":{const y={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,_,d.get("login"),y,l);break}case"giftpaidupgrade":{const y={userId:d.get("user-id"),displayName:d.get("display-name"),gifter:d.get("msg-param-sender-login"),gifterDisplayName:d.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,_,d.get("login"),y,l);break}case"standardpayforward":{const y=d.get("msg-param-prior-gifter-anonymous")==="true",S={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:y?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:y?void 0:d.get("msg-param-prior-gifter-display-name"),recipientUserId:d.get("msg-param-recipient-id"),recipientDisplayName:d.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,_,d.get("login"),S,l);break}case"communitypayforward":{const y=d.get("msg-param-prior-gifter-anonymous")==="true",S={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:y?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:y?void 0:d.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,_,d.get("login"),S,l);break}case"primecommunitygiftreceived":{const y={name:d.get("msg-param-gift-name"),gifter:d.get("login"),gifterDisplayName:d.get("display-name")};this.emit(this.onPrimeCommunityGift,_,d.get("msg-param-recipient"),y,l);break}case"raid":{const y={displayName:d.get("msg-param-displayName"),viewerCount:Number(d.get("msg-param-viewerCount"))};this.emit(this.onRaid,_,d.get("login"),y,l);break}case"unraid":{this.emit(this.onRaidCancel,_,l);break}case"ritual":{const y={ritualName:d.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,_,d.get("login"),y,l);break}case"bitsbadgetier":{const y={displayName:d.get("display-name"),threshold:Number(d.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,_,d.get("login"),y,l);break}case"extendsub":{const y={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan"),months:Number(d.get("msg-param-cumulative-months")),endMonth:Number(d.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,_,d.get("login"),y,l);break}case"rewardgift":{const y={domain:d.get("msg-param-domain"),gifterId:d.get("user-id"),gifterDisplayName:d.get("display-name"),count:Number(d.get("msg-param-selected-count")),gifterGiftCount:Number(d.get("msg-param-total-reward-count")),triggerType:d.get("msg-param-trigger-type")};this.emit(this.onRewardGift,_,d.get("login"),y,l);break}case"announcement":{const y={color:d.get("msg-param-color")};this.emit(this.onAnnouncement,_,d.get("login"),y,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${p}`)}}),this._ircClient.onTypedMessage(nP,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(d1,async({target:l,text:u,tags:h})=>{const d=h.get("msg-id");switch(d){case"emote_only_on":{this.emit(this.onEmoteOnly,ia(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,ia(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,d);break}case"r9k_on":{this.emit(this.onUniqueChat,ia(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,ia(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,ia(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,ia(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,ia(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,ia(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,ia(l),d);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=e6(120),this._authRetryCount=0);const p=this._authRetryTimer.next().value,_=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,_),p!==0&&this._chatLogger.info(`Retrying authentication in ${p} seconds`),await vbe(p*1e3),this._ircClient.reconnect()}break}default:d.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${d}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(II._generateJustinfanNick()),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,t,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=XTe(r.replyTo));const o=EF(t,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:MT(e),text:a,tags:s},i)))}async action(e,t,r){const i=EF(t,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:MT(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(MT(e))}part(e){this._ircClient.part(MT(e))}quit(){this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,t;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!fx(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await pE(this._authToken.accessToken);if(!a.userName)throw new px("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof ny?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((t=(e=this._authProvider).refreshAccessTokenForIntent)===null||t===void 0?void 0:t.call(e,o)),this._authToken){const a=await pE(this._authToken.accessToken);if(!a.userName)throw new px("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof ny?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof $g?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}};ps([n0(!1)],Aw.prototype,"_authProvider",void 0);Aw=II=ps([_b("chat","ChatClient")],Aw);let qp;const F0=Nf("chat",[],n=>{switch(n.target){case"connect":fe(qp)?ti(F0.name(),"connection","chat is already connected"):vr(n.data)&&(Lr(F0.name(),"connecting"),qp=new Aw({channels:[n.data]}),qp.connect(),qp.onConnect(()=>{Lr(F0.name(),"connected")}),qp.onDisconnect(()=>{Lr(F0.name(),"disconnected")}),qp.onMessage((e,t,r)=>{Ix(F0.name(),"chat",n.data,`${t}:${r}`,Fa())}));break;case"disconnect":fe(qp)?(qp.quit(),qp=void 0,Lr(F0.name(),"client quit")):ti(F0.name(),"connection","chat is already disconnected");break}});class YTe{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return JTe(e).buffer}}function JTe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t.set(s,r),r+=i.byteLength}return t}function WH(n){return new QTe(n).unpack()}function $H(n){const e=new ZTe,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class QTe{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,i="",s,o;for(;r<e;)s=t[r],s<160?(o=s,r++):(s^192)<32?(o=(s&31)<<6|t[r+1]&63,r+=2):(s^224)<16?(o=(s&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(s&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),i+=String.fromCodePoint(o);return this.index+=e,i}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const i=this.unpack();t[i]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(t===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(i-20)+t*2**(i-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class ZTe{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=i=>{if(i<t){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),o=2**32,a=t<<31|r+1023<<20|s/o&1048575,c=s%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<t.length){const o=t[s];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new YTe,this._textEncoder=new TextEncoder}}let qH=!0,XH=!0;function _x(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function L_(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function exe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(qH=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function txe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(XH=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function KH(){if(typeof window=="object"){if(qH)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function iP(n,e){XH&&console.warn(n+" is deprecated, please use "+e+" instead.")}function nxe(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=_x(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=_x(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=_x(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function bF(n){return Object.prototype.toString.call(n)==="[object Object]"}function YH(n){return bF(n)?Object.keys(n).reduce(function(e,t){const r=bF(n[t]),i=r?YH(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function kI(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?kI(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{kI(n,n.get(i),t)})}))}function TF(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&kI(n,a,i)})}),i}const xF=KH;function JH(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(d,p){return d?d+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let d={};typeof u.ideal=="number"?(d[h("min",l)]=u.ideal,c.optional.push(d),d={},d[h("max",l)]=u.ideal,c.optional.push(d)):(d[h("",l)]=u.ideal,c.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(d,l)]=u[d])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,d){h in u&&!(d in u)&&(u[d]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(d=>{d=d.filter(_=>_.kind==="videoinput");let p=d.find(_=>h.some(y=>_.label.toLowerCase().includes(y)));return!p&&d.length&&h.includes("back")&&(p=d[d.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=r(a.video),xF("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return xF("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function QH(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function ZH(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else L_(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function eG(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function tG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>TF(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),L_(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>TF(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function nG(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function rG(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return nG(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new n.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(y=>y===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[h.id];if(_)_.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new n.MediaStream([u]);this._streams[h.id]=y,this._reverseStreams[y.id]=h,this.addStream(y)}return this.getSenders().find(y=>y.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const p=l._reverseStreams[d],_=l._streams[p.id];h=h.replace(new RegExp(_.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const p=l._reverseStreams[d],_=l._streams[p.id];h=h.replace(new RegExp(p.id,"g"),_.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[_=>{const y=s(this,_);d[0].apply(null,[y])},_=>{d[1]&&d[1].apply(null,_)},arguments[2]]):u.apply(this,arguments).then(_=>s(this,_))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(y=>u.track===y)&&(d=this._streams[p])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function OI(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function iG(n,e){L_(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const wF=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:iG,shimAddTrackRemoveTrack:rG,shimAddTrackRemoveTrackWithNative:nG,shimGetSendersWithDtmf:eG,shimGetUserMedia:JH,shimMediaStream:QH,shimOnTrack:ZH,shimPeerConnection:OI,shimSenderReceiverGetStats:tG},Symbol.toStringTag,{value:"Module"}));function sG(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,o){iP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function rxe(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function oG(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function NI(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=o[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function aG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function cG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),L_(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function lG(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){iP("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function uG(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function hG(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function dG(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function fG(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function pG(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const CF=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:hG,shimCreateAnswer:pG,shimCreateOffer:fG,shimGetDisplayMedia:rxe,shimGetParameters:dG,shimGetUserMedia:sG,shimOnTrack:oG,shimPeerConnection:NI,shimRTCDataChannel:uG,shimReceiverGetStats:cG,shimRemoveStream:lG,shimSenderGetStats:aG},Symbol.toStringTag,{value:"Module"}));function mG(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function gG(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function _G(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function vG(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(yG(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function yG(n){return n&&n.video!==void 0?Object.assign({},n,{video:YH(n.video)}):n}function SG(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(iP("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function EG(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function bG(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function TG(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const RF=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:TG,shimCallbacksAPI:_G,shimConstraints:yG,shimCreateOfferLegacy:bG,shimGetUserMedia:vG,shimLocalStreamsAPI:mG,shimRTCIceServerUrls:SG,shimRemoteStreamsAPI:gG,shimTrackEventTransceiver:EG},Symbol.toStringTag,{value:"Module"}));var xG={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(_=>parseInt(_,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(d.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),r.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(d=>{d.maxBitrate=h})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const o=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e})(xG);var wG=xG.exports;const iy=Wl(wG),ixe=BG({__proto__:null,default:iy},[wG]);function vx(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=iy.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,L_(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function PI(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||L_(n,"icecandidate",e=>{if(e.candidate){const t=iy.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function yx(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=iy.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=iy.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=iy.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return h}}),this._sctp=d}return o.apply(this,arguments)}}function Sx(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},L_(n,"datachannel",r=>(e(r.channel,r.target),r))}function DI(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function LI(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function Ex(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function bx(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const sxe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:LI,shimAddIceCandidateNullOrEmpty:Ex,shimConnectionState:DI,shimMaxMessageSize:yx,shimParameterlessSetLocalDescription:bx,shimRTCIceCandidate:vx,shimRTCIceCandidateRelayProtocol:PI,shimSendThrowTypeError:Sx},Symbol.toStringTag,{value:"Module"}));function oxe({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=KH,r=nxe(n),i={browserDetails:r,commonShim:sxe,extractVersion:_x,disableLog:exe,disableWarnings:txe,sdp:ixe};switch(r.browser){case"chrome":if(!wF||!OI||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=wF,Ex(n,r),bx(n),JH(n,r),QH(n),OI(n,r),ZH(n),rG(n,r),eG(n),tG(n),iG(n,r),vx(n),PI(n),DI(n),yx(n,r),Sx(n),LI(n,r);break;case"firefox":if(!CF||!NI||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=CF,Ex(n,r),bx(n),sG(n,r),NI(n,r),oG(n),lG(n),aG(n),cG(n),uG(n),hG(n),dG(n),fG(n),pG(n),vx(n),DI(n),yx(n,r),Sx(n);break;case"safari":if(!RF||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=RF,Ex(n,r),bx(n),SG(n),bG(n),_G(n),mG(n),gG(n),EG(n),vG(n),TG(n),vx(n),PI(n),yx(n,r),Sx(n),LI(n,r);break;default:t("Unsupported browser!");break}return i}const AF=oxe({window:typeof window>"u"?void 0:window});function U_(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class CG{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:s,data:c,total:i};t.push(l),o=a,s++}return this._dataCount++,t}}}function axe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.byteLength;return t}const KR=AF.default||AF,mS=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return KR.browserDetails.browser}getVersion(){return KR.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=KR.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},cxe=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),RG=()=>Math.random().toString(36).slice(2),MF={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class lxe extends CG{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(i){i.target&&t(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=MF,this.browser=mS.getBrowser(),this.browserVersion=mS.getVersion(),this.pack=$H,this.unpack=WH,this.supports=function(){const t={browser:mS.isBrowserSupported(),webRTC:mS.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(MF),t.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!mS.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return t}(),this.validateId=cxe,this.randomToken=RG}}const Rl=new lxe,uxe="PeerJS: ";var IF;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(IF||(IF={}));class hxe{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[uxe,...t];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Sn=new hxe,sP={},dxe=Object.prototype.hasOwnProperty,il="~";function vE(){}Object.create&&(vE.prototype=Object.create(null),new vE().__proto__||(il=!1));function fxe(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function AG(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new fxe(t,r||n,i),o=il?il+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function Tx(n,e){--n._eventsCount===0?n._events=new vE:delete n._events[e]}function Tc(){this._events=new vE,this._eventsCount=0}Tc.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)dxe.call(t,r)&&e.push(il?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Tc.prototype.listeners=function(e){var t=il?il+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};Tc.prototype.listenerCount=function(e){var t=il?il+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Tc.prototype.emit=function(e,t,r,i,s,o){var a=il?il+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var d=c.length,p;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,r);break;case 4:c[h].fn.call(c[h].context,t,r,i);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[h].fn.apply(c[h].context,u)}}return!0};Tc.prototype.on=function(e,t,r){return AG(this,e,t,r,!1)};Tc.prototype.once=function(e,t,r){return AG(this,e,t,r,!0)};Tc.prototype.removeListener=function(e,t,r,i){var s=il?il+e:e;if(!this._events[s])return this;if(!t)return Tx(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&Tx(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:Tx(this,s)}return this};Tc.prototype.removeAllListeners=function(e){var t;return e?(t=il?il+e:e,this._events[t]&&Tx(this,t)):(this._events=new vE,this._eventsCount=0),this};Tc.prototype.off=Tc.prototype.removeListener;Tc.prototype.addListener=Tc.prototype.on;Tc.prefixed=il;Tc.EventEmitter=Tc;sP=Tc;var F_={};U_(F_,"ConnectionType",()=>Ef);U_(F_,"PeerErrorType",()=>Zs);U_(F_,"BaseConnectionErrorType",()=>yE);U_(F_,"DataConnectionErrorType",()=>SE);U_(F_,"SerializationType",()=>ky);U_(F_,"SocketEventType",()=>pf);U_(F_,"ServerMessageType",()=>Na);var Ef;(function(n){n.Data="data",n.Media="media"})(Ef||(Ef={}));var Zs;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Zs||(Zs={}));var yE;(function(n){n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed"})(yE||(yE={}));var SE;(function(n){n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big"})(SE||(SE={}));var ky;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw"})(ky||(ky={}));var pf;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(pf||(pf={}));var Na;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Na||(Na={}));var oP={};oP=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class pxe extends sP.EventEmitter{constructor(e,t,r,i,s,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+i+"peerjs?key="+s}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+oP.version),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),Sn.log("Server message received:",s)}catch{Sn.log("Invalid server message",i.data);return}this.emit(pf.Message,s)},this._socket.onclose=i=>{this._disconnected||(Sn.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(pf.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Sn.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Sn.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Na.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(pf.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class MG{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Ef.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=t.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Sn.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;Sn.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Sn.log(`Received ICE candidates for ${t}:`,o.candidate),s.socket.send({type:Na.Candidate,payload:{candidate:o.candidate,type:i,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Sn.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(yE.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":Sn.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(yE.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":Sn.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Sn.log("Listening for data channel"),e.ondatachannel=o=>{Sn.log("Received data channel");const a=o.channel;s.getConnection(t,r)._initializeDataChannel(a)},Sn.log("Listening for remote stream"),e.ontrack=o=>{Sn.log("Received remote stream");const a=o.streams[0],c=s.getConnection(t,r);if(c.type===Ef.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){Sn.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Sn.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Sn.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ef.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}t.socket.send({type:Na.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Zs.WebRTC,i),Sn.log("Failed to setLocalDescription, ",i))}}catch(r){t.emitError(Zs.WebRTC,r),Sn.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();Sn.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Sn.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:Na.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){t.emitError(Zs.WebRTC,i),Sn.log("Failed to setLocalDescription, ",i)}}catch(r){t.emitError(Zs.WebRTC,r),Sn.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,i=this.connection.provider;Sn.log("Setting remote description",t);const s=this;try{await r.setRemoteDescription(t),Sn.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(o){i.emitError(Zs.WebRTC,o),Sn.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Sn.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Sn.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(Zs.WebRTC,t),Sn.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(Sn.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return Sn.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){Sn.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class IG extends sP.EventEmitter{emitError(e,t){Sn.error("Error:",t),this.emit("error",new mxe(`${e}`,t))}}class mxe extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class kG extends IG{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}var FI;const BS=class BS extends kG{get type(){return Ef.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||BS.ID_PREFIX+Rl.randomToken(),this._negotiator=new MG(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Sn.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Sn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Sn.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case Na.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case Na.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Sn.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){Sn.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};FI=new WeakMap,Qy(BS,FI,BS.ID_PREFIX="mc_");let Mw=BS;class gxe{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:i,path:s,key:o}=this._options,a=new URL(`${t}://${r}:${i}${s}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",oP.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Sn.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==Rl.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===Rl.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Sn.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var BI,zI;const $0=class $0 extends kG{get type(){return Ef.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||$0.ID_PREFIX+RG(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new MG(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Sn.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{Sn.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{Sn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(SE.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case Na.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case Na.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:Sn.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};BI=new WeakMap,zI=new WeakMap,Qy($0,BI,$0.ID_PREFIX="dc_"),Qy($0,zI,$0.MAX_BUFFERED_AMOUNT=8388608);let Iw=$0;class aP extends Iw{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Iw.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return Sn.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class YR extends aP{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new CG,this.serialization=ky.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=WH(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const i=axe(r.data);this._handleDataMessage({data:i})}}_send(e,t){const r=$H(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);Sn.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class _xe extends aP{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=ky.None}}class vxe extends aP{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Rl.chunkedMTU){this.emitError(SE.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=ky.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var VI;const zS=class zS extends IG{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:_xe,json:vxe,binary:YR,"binary-utf8":YR,default:YR},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:Rl.CLOUD_HOST,port:Rl.CLOUD_PORT,path:"/",key:zS.DEFAULT_KEY,token:Rl.randomToken(),config:Rl.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Rl.CLOUD_HOST?this._options.secure=Rl.isSecure():this._options.host==Rl.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Sn.setLogFunction(this._options.logFunction),Sn.logLevel=this._options.debug||0,this._api=new gxe(t),this._socket=this._createServerConnection(),!Rl.supports.audioVideo&&!Rl.supports.data){this._delayedAbort(Zs.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Rl.validateId(r)){this._delayedAbort(Zs.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(Zs.ServerError,i))}_createServerConnection(){const e=new pxe(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(pf.Message,t=>{this._handleMessage(t)}),e.on(pf.Error,t=>{this._abort(Zs.SocketError,t)}),e.on(pf.Disconnected,()=>{this.disconnected||(this.emitError(Zs.Network,"Lost connection to server."),this.disconnect())}),e.on(pf.Close,()=>{this.disconnected||this._abort(Zs.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,i=e.src;switch(t){case Na.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Na.Error:this._abort(Zs.ServerError,r.msg);break;case Na.IdTaken:this._abort(Zs.UnavailableID,`ID "${this.id}" is taken`);break;case Na.InvalidKey:this._abort(Zs.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Na.Leave:Sn.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case Na.Expire:this.emitError(Zs.PeerUnavailable,`Could not connect to peer ${i}`);break;case Na.Offer:{const s=r.connectionId;let o=this.getConnection(i,s);if(o&&(o.close(),Sn.warn(`Offer received for existing Connection ID:${s}`)),r.type===Ef.Media){const c=new Mw(i,this,{connectionId:s,_payload:r,metadata:r.metadata});o=c,this._addConnection(i,o),this.emit("call",c)}else if(r.type===Ef.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(i,o),this.emit("connection",c)}else{Sn.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(s);for(const c of a)o.handleMessage(c);break}default:{if(!r){Sn.warn(`You received a malformed message from ${i} of type ${t}`);return}const s=r.connectionId,o=this.getConnection(i,s);o&&o.peerConnection?o.handleMessage(e):s?this._storeMessage(s,e):Sn.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){Sn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Zs.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){Sn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Zs.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){Sn.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new Mw(e,this,{...r,_stream:t});return this._addConnection(e,i),i}_addConnection(e,t){Sn.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===t)return i;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){Sn.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Sn.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Sn.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Sn.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Sn.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(Zs.ServerError,t))}};VI=new WeakMap,Qy(zS,VI,zS.DEFAULT_KEY="peerjs");let UI=zS;var OG=UI;let Qi;function yxe(){Qi==null||Qi.destroy(),Qi=void 0}window.addEventListener("beforeunload",yxe);function NG(n,e){n.on("open",()=>{const{forward:t,disconnect:r}=c3(i=>n.send(i));n.on("close",()=>{r(),Lr(Il.name(),`remote ${n.peer} disconnected`)}),n.on("data",t),e==null||e()}),n.on("error",t=>{const r=(Qi==null?void 0:Qi.id)??"";ti(Il.name(),`${r}-${n.peer}`,t.message)})}function Sxe(n){Lr(Il.name(),"connecting..."),Qi=new OG(n),Qi.on("open",()=>{fe(Qi)&&(Qi.on("connection",NG),Qi.on("close",()=>Lr(Il.name(),"closed")),e3(Il.name(),n))}),Qi.on("error",e=>ti(Il.name(),(Qi==null?void 0:Qi.id)??"",e.message))}function Exe(n,e){Lr(Il.name(),`connecting to ${e}`),Qi=new OG(n),Qi.on("open",()=>{if(fe(Qi)){Qi.on("close",()=>Lr(Il.name(),"closed"));const t=Qi.connect(e,{reliable:!0});NG(t,()=>{Lr(Il.name(),"connected"),sJ(Il.name(),n)})}}),Qi.on("error",t=>ti(Il.name(),(Qi==null?void 0:Qi.id)??"",t.message))}const Il=Nf("peer",["second"],n=>{switch(n.target){case"create":n.player===Fa()&&(n.data?Exe(n.player,n.data):Sxe(n.player));break;case"joincode":{n.player===Fa()&&du("peer:joincode",async()=>{if(fe(n.player))if(!fe(Qi))ZB(Il.name(),"",n.player);else{const e=`${location.origin}/join/#${Qi.id}`,t=await XA(e);JA(Il.name(),t,t),Lr(Il.name(),"ready to join")}});break}}}),bxe=Nf("gadgetclient",[],n=>{const{desync:e}=Zp.getState();switch(n.target){case"reset":n.player===Fa()&&Zp.setState({desync:!1,gadget:n.data});break;case"patch":n.player===Fa()&&!e&&Zp.setState(t=>{try{const{newDocument:r}=jw(t.gadget,n.data,!0,!1);return{...t,gadget:r}}catch(r){r instanceof ck&&(Zp.setState({desync:!0}),bxe.reply(n,"desync",void 0,n.player))}return t});break}});Nf("tape",[],n=>{const{layout:e,terminal:t,editor:r}=Kc.getState();function i(o){let a=[[_o(),o.target,o.sender,...o.data],...t.logs];a.length>F2&&(a=a.slice(0,F2)),Kc.setState(c=>({terminal:{...c.terminal,logs:a}}))}function s(o){let c=e+(o?1:-1);if(c<0&&(c+=Yc.MAX),c>=Yc.MAX&&(c-=Yc.MAX),!r.open)switch(c){case Yc.SPLIT_Y:case Yc.SPLIT_Y_ALT:c=Yc.TOP;break}Kc.setState({layout:c})}switch(n.target){case"info":t.level>=tx.INFO&&i(n);break;case"debug":t.level>=tx.DEBUG&&i(n);break;case"error":t.level>tx.OFF&&i(n);break;case"crash":Kc.setState(o=>({layout:Yc.FULL,terminal:{...o.terminal,open:!0}}));break;case"terminal:open":Kc.setState(o=>({terminal:{...o.terminal,open:!0}}));break;case"terminal:close":Kc.setState(o=>({terminal:{...o.terminal,open:!1}}));break;case"terminal:toggle":Kc.setState(o=>({terminal:{...o.terminal,open:!o.terminal.open}}));break;case"terminal:inclayout":PY(n.data)&&s(n.data);break;case"editor:open":if(ni(n.data)&&fe(n.player)){const{player:o}=n,[a,c,l,u]=n.data??["","",""];Kc.setState(h=>({terminal:{...h.terminal,open:!0},editor:{open:!0,player:o,book:a,page:c,type:l,title:u}}))}break;case"editor:close":Kc.setState(o=>({editor:{...o.editor,open:!1}}));break}});function PG(){const n=Fa();yJ("userspace",n),setTimeout(PG,10)}PG();ok({OrthographicCamera:Fw});function Txe(){const{viewport:n}=Ly(),{width:e,height:t}=n.getCurrentViewport(),[r]=at.useState(()=>new zme);at.useEffect(()=>{if(!Wme)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;";const d=nY(()=>r.begin()),p=rY(()=>r.end());return()=>{document.body.removeChild(r.dom),d(),p()}},[r]);const[i,s]=at.useState();at.useEffect(()=>{du("gpudetect",async()=>{const d=await Ome();s(d)})},[]);const a=Math.min(e,t)<600||Xme;mi.DRAW_CHAR_SCALE=a?1:2;const c=e>t,l=Kme||UM==="hybrid"||Fme==="touch",u=eN(ige);u.minFilter=bo,u.magFilter=bo;const h=!qme&&!a&&!l&&i&&i.tier>2&&!i.isMobile;return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(rb,{children:Fe.jsxs(HEe,{islandscape:c,showtouchcontrols:l,children:[Fe.jsx(GEe,{}),Fe.jsx(pbe,{})]})}),h&&Fe.jsx(wme,{children:Fe.jsx(rge,{splat:u,viewheight:t})})]})}ok({BufferGeometry:sd,Group:vS,Mesh:$h,MeshBasicMaterial:ek,OrthographicCamera:Fw,PlaneGeometry:wE,Points:xK});document.addEventListener("keydown",()=>{Wy()});window.addEventListener("touchstart",()=>{Wy()});window.addEventListener("click",()=>{Wy()});window.addEventListener("dragover",n=>{n.preventDefault()});window.addEventListener("contextmenu",n=>{Wy(),n.preventDefault()});window.addEventListener("paste",n=>{var t;if(!((t=n.clipboardData)!=null&&t.files.length))return;Wy(),n.preventDefault(),[...n.clipboardData.files].forEach(r=>Ix("app","file",r.name,r,Fa()))});window.addEventListener("drop",n=>{var e,t;Wy(),n.preventDefault(),(e=n.dataTransfer)!=null&&e.items?[...n.dataTransfer.items].forEach(i=>{if(i.kind==="file"){const s=i.getAsFile();fe(s)&&Ix("app","file",s.name,s,Fa())}}):[...((t=n.dataTransfer)==null?void 0:t.files)??[]].forEach(i=>Ix("app","file",i.name,i,Fa()))});function xxe(){return Fe.jsx(Txe,{})}const kF=new qe,OF=new qe,wxe=n=>({...hY(n),filter:e=>{const t=e.filter(o=>!(!o.object.visible||(o.object.userData.clippingPlanes??[]).some(c=>(c.projectPoint(o.point,kF),OF.subVectors(o.point,kF).normalize().round(),c.normal.equals(OF)===!1)))),r=t.findIndex(o=>o.object.userData.blocking),i=r===-1?t:t.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),NF=document.querySelector("canvas");if(fe(NF)){const n=cY(NF),e=(r,i)=>{n.configure({...Uy({flat:!0,linear:!0,shadows:!1,gl:{alpha:!1,stencil:!1,antialias:!1,powerPreference:"low-power",preserveDrawingBuffer:!0}}),events:wxe,size:{width:r,height:i,top:0,left:0},onCreated({gl:s}){s.localClippingEnabled=!0}})},t=fY(e,256);window.addEventListener("resize",()=>{t(window.innerWidth,window.innerHeight)}),e(window.innerWidth,window.innerHeight),n.render(Fe.jsx(xxe,{}))}});export default Cxe();

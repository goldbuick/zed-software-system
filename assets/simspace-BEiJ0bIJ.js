var pW=Object.defineProperty;var mW=(_i,nn,er)=>nn in _i?pW(_i,nn,{enumerable:!0,configurable:!0,writable:!0,value:er}):_i[nn]=er;var At=(_i,nn,er)=>mW(_i,typeof nn!="symbol"?nn+"":nn,er);(function(){"use strict";const _i=new Set,nn={emit(e,t,r,n,i){nn.invoke(aT(e,t,r,n,i))},invoke(e){_i.forEach(t=>t.handle(e))},connect(e){_i.add(e)},disconnect(e){_i.delete(e)}};var er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ps(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function TA(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var z0={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(er,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=n();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(z0);var SA=z0.exports,W0=ps(SA),H0={};(function(e){var t=er&&er.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(l){return l[Math.floor(Math.random()*l.length)]}function n(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,g=l.addAdverb,y=g===void 0?!1:g,b=t(t(t([],t([],Array(m),!0).map(function(A){return r(e.adjectives)}),!0),[r(e.nouns),r(e.verbs)],!1),y?[r(e.adverbs)]:[],!0);return f&&(b=b.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),b.join(h)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(f?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return n(e.adjectives).length*h+h*m.length+n(e.nouns).length+m.length+n(e.verbs).length+(f?n(e.adverbs).length+m.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(e.adjectives).length*h+h*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(f?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(H0);var G0=ps(H0);const RA="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let OA=e=>crypto.getRandomValues(new Uint8Array(e)),IA=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return(s=t)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=e[a[c]&n]||"",o.length>=s)return o}}},K0=(e,t=21)=>IA(e,t|0,OA),NA=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=RA[r[e]&63];return t};var Y0="abcdefghijklmnopqrstuvwxyz",q0="ABCDEFGHIJKLMNOPQRSTUVWXYZ",V0="0123456789",CA="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",LA="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const MA=V0,UA=Y0,PA=q0;var FA=MA+UA+PA,hf={lowercase:Y0,uppercase:q0,numbers:V0,nolookalikes:CA,nolookalikesSafe:LA,alphanumeric:FA};function We(){return`sid_${NA(12).replaceAll("-",".")}`}K0(hf.numbers,4),K0(`${hf.numbers}${hf.lowercase}`,16);function xr(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function $A(){return G0({capitalize:!1,adjectiveCount:1})}function BA(){return G0({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var DA=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),jA=Object.prototype.hasOwnProperty;function df(e,t){return jA.call(e,t)}function pf(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)df(e,i)&&n.push(i);return n}function Dr(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function mf(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function ms(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function X0(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function gf(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(gf(e[t]))return!0}else if(typeof e=="object"){for(var n=pf(e),i=n.length,s=0;s<i;s++)if(gf(e[n[s]]))return!0}}return!1}function J0(e,t){var r=[e];for(var n in t){var i=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var Z0=function(e){DA(t,e);function t(r,n,i,s,o){var a=this.constructor,c=e.call(this,J0(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=J0(r,{name:n,index:i,operation:s,tree:o}),c}return t}(Error),Be=Z0,zA=Dr,Js={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=kc(r,this.path);n&&(n=Dr(n));var i=gs(r,{op:"remove",path:this.from}).removed;return gs(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=kc(r,this.from);return gs(r,{op:"add",path:this.path,value:Dr(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:sa(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},WA={add:function(e,t,r){return mf(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:Js.move,copy:Js.copy,test:Js.test,_get:Js._get};function kc(e,t){if(t=="")return e;var r={op:"_get",path:t};return gs(e,r),r.value}function gs(e,t,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(t,0,e,t.path):xc(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=kc(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=sa(e,t.value),o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(r)throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{n||(e=Dr(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof r=="function"?p=r:p=xc;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=X0(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(r&&!mf(f))throw new Be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);mf(f)&&(f=~~f)}if(u>=h){if(r&&t.op==="add"&&f>l.length)throw new Be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=WA[t.op].call(t,l,f,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=h){var o=Js[t.op].call(t,l,f,e);if(o.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[f],r&&u<h&&(!l||typeof l!="object"))throw new Be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function yf(e,t,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(t))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=Dr(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=gs(e,t[o],r,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function HA(e,t,r){var n=gs(e,t);if(n.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function xc(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new Be("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(Js[e.op]){if(typeof e.path!="string")throw new Be("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&gf(e.value))throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var i=e.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new Be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Q0([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function Q0(e,t,r){try{if(!Array.isArray(e))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)yf(Dr(t),Dr(e),r||!0);else{r=r||xc;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(i){if(i instanceof Be)return i;throw i}}function sa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),i,s,o;if(r&&n){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!sa(e[i],t[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!sa(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var GA=Object.freeze({__proto__:null,JsonPatchError:Be,_areEquals:sa,applyOperation:gs,applyPatch:yf,applyReducer:HA,deepClone:zA,getValueByPointer:kc,validate:Q0,validator:xc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var _f=new WeakMap,KA=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),YA=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function qA(e){return _f.get(e)}function VA(e,t){return e.observers.get(t)}function XA(e,t){e.observers.delete(t.callback)}function JA(e,t){t.unobserve()}function ZA(e,t){var r=[],n,i=qA(e);if(!i)i=new KA(e),_f.set(e,i);else{var s=VA(i,t);n=s&&s.observer}if(n)return n;if(n={},i.value=Dr(e),t){n.callback=t,n.next=null;var o=function(){bf(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=e,n.unobserve=function(){bf(n),clearTimeout(n.next),XA(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new YA(t,n)),n}function bf(e,t){t===void 0&&(t=!1);var r=_f.get(e.object);wf(r.value,e.object,e.patches,"",t),e.patches.length&&yf(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function wf(e,t,r,n,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=pf(t),o=pf(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(df(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?wf(u,h,r,n+"/"+ms(l),i):u!==h&&(i&&r.push({op:"test",path:n+"/"+ms(l),value:Dr(u)}),r.push({op:"replace",path:n+"/"+ms(l),value:Dr(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:n+"/"+ms(l),value:Dr(u)}),r.push({op:"remove",path:n+"/"+ms(l)}),a=!0):(i&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!df(e,l)&&t[l]!==void 0&&r.push({op:"add",path:n+"/"+ms(l),value:Dr(t[l])})}}}function tm(e,t,r){r===void 0&&(r=!1);var n=[];return wf(e,t,n,"",r),n}var QA=Object.freeze({__proto__:null,compare:tm,generate:bf,observe:ZA,unobserve:JA});Object.assign({},GA,QA,{JsonPatchError:Z0,deepClone:Dr,escapePathComponent:ms,unescapePathComponent:X0});var tT=typeof Element<"u",eT=typeof Map=="function",rT=typeof Set=="function",nT=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ac(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(!Ac(e[n],t[n]))return!1;return!0}var s;if(eT&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;for(s=e.entries();!(n=s.next()).done;)if(!Ac(n.value[1],t.get(n.value[0])))return!1;return!0}if(rT&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(n=s.next()).done;)if(!t.has(n.value[0]))return!1;return!0}if(nT&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(n=r;n--!==0;)if(e[n]!==t[n])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;if(tT&&e instanceof Element)return!1;for(n=r;n--!==0;)if(!((i[n]==="_owner"||i[n]==="__v"||i[n]==="__o")&&e.$$typeof)&&!Ac(e[i[n]],t[i[n]]))return!1;return!0}return e!==e&&t!==t}var iT=function(t,r){try{return Ac(t,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},sT=ps(iT);function w(e){return e!=null}const jr=Object.keys;function Yn(e){return Dr(e)}function oT(e){return typeof e=="boolean"}function Et(e){return typeof e=="number"&&isNaN(e)===!1}function yt(e){return typeof e=="string"}function pe(e){return Array.isArray(e)}function vf(e){return e}var zt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(zt||{}),Wt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e[e.ISGHOST=4]="ISGHOST",e))(Wt||{}),Nr=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Nr||{}),bt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.FIND=18]="FIND",e[e.FLEE=19]="FLEE",e[e.TO=20]="TO",e[e.MID=21]="MID",e[e.OVER=22]="OVER",e[e.UNDER=23]="UNDER",e))(bt||{}),Ut=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.VIEWIT=14]="VIEWIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(Ut||{});function Dt(e){return yt(e)?e.toLowerCase().trim():""}function aT(e,t,r,n,i){return{session:e,player:t,id:We(),sender:r,target:n,data:i}}function zr(e){const[t,...r]=e.split(":");return{target:t,path:r.join(":")}}function Zs(e,t=[],r=vf,n=""){const i=We(),s=Dt(e),o=t.map(Dt);let a=n;const c={id(){return i},name(){return e},session(l){return w(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,h){nn.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=zr(l.target),d=Dt(u);!a&&d==="ready"&&(a=l.session),d==="session_reset"&&(a=""),o.findIndex(f=>f==="all"||f===d)!==-1&&r(l),(i===u||d==="all"||s===d)&&r({...l,target:h})}};return nn.connect(c),c}function cT(e){return typeof e=="object"&&yt(e.session)&&yt(e.player)&&yt(e.id)&&yt(e.sender)&&yt(e.target)}function _e(e,t,r,...n){return e.emit(t,"error",[`$red${r}$blue>>`,...n]),!1}function lT(e,t,...r){return e.emit(t,"info",r),!0}function Re(e,t,...r){return e.emit(t,"log",r),!0}function Tc(e,t,r){e.emit(t,"toast",r)}function uT(e,t,r){e.emit(t,"bridge:streamstart",r)}function fT(e,t){e.emit(t,"bridge:streamstop",void 0)}function hT(e,t,r){e.emit(t,"bridge:chatstart",r)}function dT(e,t){e.emit(t,"bridge:chatstop")}function pT(e,t,r,n,i,s,o){e.emit(t,"bridge:fetch",[r,n,i,s,o])}function mT(e,t){e.emit(t,"bridge:talkstart",t)}function gT(e,t){e.emit(t,"bridge:talkstop",t)}function yT(e,t){e.emit(t,"bridge:mediastart",t)}function _T(e,t){e.emit(t,"bridge:mediastop",t)}function bT(e,t,r){e.emit(t,"bridge:start",r)}function wT(e,t,r){e.emit(t,"bridge:tab",r)}function vT(e,t,r){e.emit(t,"gadgetclient:paint",r)}function ET(e,t,r){e.emit(t,"gadgetclient:patch",r)}function kT(e,t){e.emit(t,"gadgetserver:clearscroll")}function xT(e,t){e.emit(t,"gadgetserver:clearplayer")}function AT(e){e.emit("","ready")}function em(e,t){e.emit(t,"register:loginfail")}function Ef(e,t){e.emit(t,"register:loginready",!0)}function TT(e,t,r,n){e.emit(t,"register:savemem",[r,n])}function ST(e,t,r){e.emit(t,"register:forkmem",[r])}function RT(e,t,r,n){e.emit(t,"register:itchiopublishmem",[r,n])}function kf(e,t,r){e.emit(t,"register:copy",r)}function OT(e,t,r,n){e.emit(t,"register:copyjsonfile",[r,n])}function rm(e,t,r,n){e.emit(t,"register:downloadjsonfile",[r,n])}function IT(e,t){e.emit(t,"register:dev",void 0)}function NT(e,t){e.emit(t,"register:share",void 0)}function CT(e,t){e.emit(t,"register:nuke",void 0)}function LT(e,t){e.emit(t,"register:enterar",void 0)}function MT(e,t,r,n){e.emit(t,"synth:tts",[r,n])}function UT(e,t,r,n){e.emit(t,"synth:play",[r,n])}function PT(e,t,r,n,i){e.emit(t,"synth:bgplay",[r,n,i])}function FT(e,t,r){e.emit(t,"synth:bpm",r)}function $T(e,t,r){e.emit(t,"synth:playvolume",r)}function BT(e,t,r){e.emit(t,"synth:bgplayvolume",r)}function DT(e,t,r){e.emit(t,"synth:ttsvolume",r)}function xf(e,t,r,n,i){e.emit(t,"synth:voice",[r,n,i])}function nm(e,t,r,n,i,s){e.emit(t,"synth:voicefx",[r,n,i,s])}function im(e,t,r,n){e.emit(t,"register:config",[r,n])}function jT(e,t){e.emit(t,"register:configshow")}function zT(e,t){e.emit(t,"register:inspector")}function WT(e,t){e.emit(t,"register:terminal:full")}function sm(e,t,r,n,i,s){e.emit(t,"register:editor:open",[r,n,i,s])}function HT(e,t,r,n){e.emit(t,"vm:zztsearch",[r,n])}function GT(e,t){e.emit(t,"vm:zztrandom")}function KT(e,t){e.emit(t,"vm:local")}function Af(e,t){e.emit(t,"vm:logout")}function om(e,t,r,n,i){e.emit(t,"vm:touched",[r,n,i])}function YT(e,t){e.emit(t,"vm:readzipfilelist")}function Sc(e,t){const[r,n]=t;return`${e}:${[r,n].filter(w).join(":")}`}function qT(e,t,r){e.emit(t,"vm:cli",r)}function VT(e,t){e.emit(t,"vm:restart")}function am(e,t){e.emit(t,"vm:flush")}function XT(e,t){e.emit(t,"vm:fork")}function JT(e,t){e.emit(t,"vm:itchiopublish")}function ZT(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function QT(e,t){return{filename:e,json:t}}function tS(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Tf(e,t,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=ZT(i,s);break;case"json":o=QT(i,s);break;case"binary":o=tS(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[r,n,i,o])},1)}function eS(e){const t=new Set;function r(s){cT(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),nn.invoke(s))}const n=Zs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){nn.disconnect(n)}return{forward:r,disconnect:i}}function rS(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=zr(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const Sf=66.666,Rc=Math.round(1e3/Sf),cm=3;function Oc(e){return new Promise(t=>setTimeout(t,e))}const Rf=Zs("clock");let Of=0,Ic=0,If=0,lm=performance.now();function um(){const e=performance.now(),t=e-lm;If+=t,If>=Sf&&(If%=Sf,Rf.emit("","tick",Ic),Rf.emit("","tock",Ic),++Of,++Ic,Of>=Rc&&(Of%=Rc,Rf.emit("","second",Ic))),lm=e,setTimeout(um,2)}um();function nS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fm={exports:{}},He=fm.exports={},qn,Vn;function Nf(){throw new Error("setTimeout has not been defined")}function Cf(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?qn=setTimeout:qn=Nf}catch{qn=Nf}try{typeof clearTimeout=="function"?Vn=clearTimeout:Vn=Cf}catch{Vn=Cf}})();function hm(e){if(qn===setTimeout)return setTimeout(e,0);if((qn===Nf||!qn)&&setTimeout)return qn=setTimeout,setTimeout(e,0);try{return qn(e,0)}catch{try{return qn.call(null,e,0)}catch{return qn.call(this,e,0)}}}function iS(e){if(Vn===clearTimeout)return clearTimeout(e);if((Vn===Cf||!Vn)&&clearTimeout)return Vn=clearTimeout,clearTimeout(e);try{return Vn(e)}catch{try{return Vn.call(null,e)}catch{return Vn.call(this,e)}}}var bi=[],Qs=!1,ys,Nc=-1;function sS(){!Qs||!ys||(Qs=!1,ys.length?bi=ys.concat(bi):Nc=-1,bi.length&&dm())}function dm(){if(!Qs){var e=hm(sS);Qs=!0;for(var t=bi.length;t;){for(ys=bi,bi=[];++Nc<t;)ys&&ys[Nc].run();Nc=-1,t=bi.length}ys=null,Qs=!1,iS(e)}}He.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];bi.push(new pm(e,t)),bi.length===1&&!Qs&&hm(dm)};function pm(e,t){this.fun=e,this.array=t}pm.prototype.run=function(){this.fun.apply(null,this.array)},He.title="browser",He.browser=!0,He.env={},He.argv=[],He.version="",He.versions={};function wi(){}He.on=wi,He.addListener=wi,He.once=wi,He.off=wi,He.removeListener=wi,He.removeAllListeners=wi,He.emit=wi,He.prependListener=wi,He.prependOnceListener=wi,He.listeners=function(e){return[]},He.binding=function(e){throw new Error("process.binding is not supported")},He.cwd=function(){return"/"},He.chdir=function(e){throw new Error("process.chdir is not supported")},He.umask=function(){return 0};var oS=fm.exports;const Ln=nS(oS);var re={},Lf=Symbol.for("react.transitional.element"),aS=Symbol.for("react.portal"),cS=Symbol.for("react.fragment"),lS=Symbol.for("react.strict_mode"),uS=Symbol.for("react.profiler"),fS=Symbol.for("react.consumer"),hS=Symbol.for("react.context"),dS=Symbol.for("react.forward_ref"),pS=Symbol.for("react.suspense"),mS=Symbol.for("react.memo"),mm=Symbol.for("react.lazy"),gm=Symbol.iterator;function gS(e){return e===null||typeof e!="object"?null:(e=gm&&e[gm]||e["@@iterator"],typeof e=="function"?e:null)}var ym={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_m=Object.assign,bm={};function to(e,t,r){this.props=e,this.context=t,this.refs=bm,this.updater=r||ym}to.prototype.isReactComponent={},to.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},to.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wm(){}wm.prototype=to.prototype;function Mf(e,t,r){this.props=e,this.context=t,this.refs=bm,this.updater=r||ym}var Uf=Mf.prototype=new wm;Uf.constructor=Mf,_m(Uf,to.prototype),Uf.isPureReactComponent=!0;var vm=Array.isArray,Oe={H:null,A:null,T:null,S:null,V:null},Em=Object.prototype.hasOwnProperty;function Pf(e,t,r,n,i,s){return r=s.ref,{$$typeof:Lf,type:e,key:t,ref:r!==void 0?r:null,props:s}}function yS(e,t){return Pf(e.type,t,void 0,void 0,void 0,e.props)}function Ff(e){return typeof e=="object"&&e!==null&&e.$$typeof===Lf}function _S(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var km=/\/+/g;function $f(e,t){return typeof e=="object"&&e!==null&&e.key!=null?_S(""+e.key):t.toString(36)}function xm(){}function bS(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(xm,xm):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function eo(e,t,r,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Lf:case aS:o=!0;break;case mm:return o=e._init,eo(o(e._payload),t,r,n,i)}}if(o)return i=i(e),o=n===""?"."+$f(e,0):n,vm(i)?(r="",o!=null&&(r=o.replace(km,"$&/")+"/"),eo(i,t,r,"",function(l){return l})):i!=null&&(Ff(i)&&(i=yS(i,r+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(km,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=n===""?".":n+":";if(vm(e))for(var c=0;c<e.length;c++)n=e[c],s=a+$f(n,c),o+=eo(n,t,r,s,i);else if(c=gS(e),typeof c=="function")for(e=c.call(e),c=0;!(n=e.next()).done;)n=n.value,s=a+$f(n,c++),o+=eo(n,t,r,s,i);else if(s==="object"){if(typeof e.then=="function")return eo(bS(e),t,r,n,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Cc(e,t,r){if(e==null)return e;var n=[],i=0;return eo(e,n,"","",function(s){return t.call(r,s,i++)}),n}function wS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Am=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Ln=="object"&&typeof Ln.emit=="function"){Ln.emit("uncaughtException",e);return}console.error(e)};function vS(){}re.Children={map:Cc,forEach:function(e,t,r){Cc(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Cc(e,function(){t++}),t},toArray:function(e){return Cc(e,function(t){return t})||[]},only:function(e){if(!Ff(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},re.Component=to,re.Fragment=cS,re.Profiler=uS,re.PureComponent=Mf,re.StrictMode=lS,re.Suspense=pS,re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Oe,re.__COMPILER_RUNTIME={__proto__:null,c:function(e){return Oe.H.useMemoCache(e)}},re.cache=function(e){return function(){return e.apply(null,arguments)}},re.cloneElement=function(e,t,r){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var n=_m({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!Em.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(n[o]=t[o]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];n.children=a}return Pf(e.type,i,void 0,void 0,s,n)},re.createContext=function(e){return e={$$typeof:hS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:fS,_context:e},e},re.createElement=function(e,t,r){var n,i={},s=null;if(t!=null)for(n in t.key!==void 0&&(s=""+t.key),t)Em.call(t,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=t[n]);var o=arguments.length-2;if(o===1)i.children=r;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return Pf(e,s,void 0,void 0,null,i)},re.createRef=function(){return{current:null}},re.forwardRef=function(e){return{$$typeof:dS,render:e}},re.isValidElement=Ff,re.lazy=function(e){return{$$typeof:mm,_payload:{_status:-1,_result:e},_init:wS}},re.memo=function(e,t){return{$$typeof:mS,type:e,compare:t===void 0?null:t}},re.startTransition=function(e){var t=Oe.T,r={};Oe.T=r;try{var n=e(),i=Oe.S;i!==null&&i(r,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(vS,Am)}catch(s){Am(s)}finally{Oe.T=t}},re.unstable_useCacheRefresh=function(){return Oe.H.useCacheRefresh()},re.use=function(e){return Oe.H.use(e)},re.useActionState=function(e,t,r){return Oe.H.useActionState(e,t,r)},re.useCallback=function(e,t){return Oe.H.useCallback(e,t)},re.useContext=function(e){return Oe.H.useContext(e)},re.useDebugValue=function(){},re.useDeferredValue=function(e,t){return Oe.H.useDeferredValue(e,t)},re.useEffect=function(e,t,r){var n=Oe.H;if(typeof r=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},re.useId=function(){return Oe.H.useId()},re.useImperativeHandle=function(e,t,r){return Oe.H.useImperativeHandle(e,t,r)},re.useInsertionEffect=function(e,t){return Oe.H.useInsertionEffect(e,t)},re.useLayoutEffect=function(e,t){return Oe.H.useLayoutEffect(e,t)},re.useMemo=function(e,t){return Oe.H.useMemo(e,t)},re.useOptimistic=function(e,t){return Oe.H.useOptimistic(e,t)},re.useReducer=function(e,t,r){return Oe.H.useReducer(e,t,r)},re.useRef=function(e){return Oe.H.useRef(e)},re.useState=function(e){return Oe.H.useState(e)},re.useSyncExternalStore=function(e,t,r){return Oe.H.useSyncExternalStore(e,t,r)},re.useTransition=function(){return Oe.H.useTransition()},re.version="19.1.1";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const Tm="0123456789abcdef",Sm=[],Lc=[];for(let e=0;e<256;e++)Sm[e]=Tm[e>>4&15]+Tm[e&15],e<16&&(e<10?Lc[48+e]=e:Lc[87+e]=e);const Rm=e=>{const t=e.length;let r="",n=0;for(;n<t;)r+=Sm[e[n++]];return r},Mc=e=>{const t=e.length>>1,r=t<<1,n=new Uint8Array(t);let i=0,s=0;for(;s<r;)n[i++]=Lc[e.charCodeAt(s++)]<<4|Lc[e.charCodeAt(s++)];return n};for(var Om="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ES=typeof Uint8Array>"u"?[]:new Uint8Array(256),Uc=0;Uc<Om.length;Uc++)ES[Om.charCodeAt(Uc)]=Uc;new TextDecoder,new TextEncoder;const Im=typeof window<"u"?window:self,Nm=Im.crypto||Im.msCrypto||{};Nm.subtle||Nm.webkitSubtle;const ro=globalThis||void 0||self,Mn=()=>new Map,Bf=e=>{const t=Mn();return e.forEach((r,n)=>{t.set(n,r)}),t},ji=(e,t,r)=>{let n=e.get(t);return n===void 0&&e.set(t,n=r()),n},kS=(e,t)=>{const r=[];for(const[n,i]of e)r.push(t(i,n));return r},xS=(e,t)=>{for(const[r,n]of e)if(t(n,r))return!0;return!1},no=()=>new Set,Df=e=>e[e.length-1],AS=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},_s=Array.from,TS=Array.isArray;class SS{constructor(){this._observers=Mn()}on(t,r){return ji(this._observers,t,no).add(r),r}once(t,r){const n=(...i)=>{this.off(t,n),r(...i)};this.on(t,n)}off(t,r){const n=this._observers.get(t);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(t))}emit(t,r){return _s((this._observers.get(t)||Mn()).values()).forEach(n=>n(...r))}destroy(){this._observers=Mn()}}const zi=Math.floor,Pc=Math.abs,Cm=(e,t)=>e<t?e:t,bs=(e,t)=>e>t?e:t,Lm=e=>e!==0?e<0:1/e<0,Mm=1,Um=2,jf=4,zf=8,oa=32,vi=64,sn=128,Fc=31,Wf=63,ws=127,RS=2147483647,Pm=Number.MAX_SAFE_INTEGER,OS=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&zi(e)===e),IS=e=>e.toLowerCase(),NS=/^\s*/g,CS=e=>e.replace(NS,""),LS=/([A-Z])/g,Fm=(e,t)=>CS(e.replace(LS,r=>`${t}${IS(r)}`)),MS=e=>{const t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=t.codePointAt(i);return n},aa=typeof TextEncoder<"u"?new TextEncoder:null,US=aa?e=>aa.encode(e):MS;let ca=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ca&&ca.decode(new Uint8Array).length===1&&(ca=null);class la{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const $c=()=>new la,PS=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},Xn=e=>{const t=new Uint8Array(PS(e));let r=0;for(let n=0;n<e.bufs.length;n++){const i=e.bufs[n];t.set(i,r),r+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},FS=(e,t)=>{const r=e.cbuf.length;r-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(bs(r,t)*2),e.cpos=0)},ur=(e,t)=>{const r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(r*2),e.cpos=0),e.cbuf[e.cpos++]=t},Hf=ur,de=(e,t)=>{for(;t>ws;)ur(e,sn|ws&t),t=zi(t/128);ur(e,ws&t)},Gf=(e,t)=>{const r=Lm(t);for(r&&(t=-t),ur(e,(t>Wf?sn:0)|(r?vi:0)|Wf&t),t=zi(t/64);t>0;)ur(e,(t>ws?sn:0)|ws&t),t=zi(t/128)},Kf=new Uint8Array(3e4),$S=Kf.length/3,BS=(e,t)=>{if(t.length<$S){const r=aa.encodeInto(t,Kf).written||0;de(e,r);for(let n=0;n<r;n++)ur(e,Kf[n])}else on(e,US(t))},DS=(e,t)=>{const r=unescape(encodeURIComponent(t)),n=r.length;de(e,n);for(let i=0;i<n;i++)ur(e,r.codePointAt(i))},io=aa&&aa.encodeInto?BS:DS,Bc=(e,t)=>{const r=e.cbuf.length,n=e.cpos,i=Cm(r-n,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),n),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(bs(r*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},on=(e,t)=>{de(e,t.byteLength),Bc(e,t)},Yf=(e,t)=>{FS(e,t);const r=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,r},jS=(e,t)=>Yf(e,4).setFloat32(0,t,!1),zS=(e,t)=>Yf(e,8).setFloat64(0,t,!1),WS=(e,t)=>Yf(e,8).setBigInt64(0,t,!1),$m=new DataView(new ArrayBuffer(4)),HS=e=>($m.setFloat32(0,e),$m.getFloat32(0)===e),ua=(e,t)=>{switch(typeof t){case"string":ur(e,119),io(e,t);break;case"number":OS(t)&&Pc(t)<=RS?(ur(e,125),Gf(e,t)):HS(t)?(ur(e,124),jS(e,t)):(ur(e,123),zS(e,t));break;case"bigint":ur(e,122),WS(e,t);break;case"object":if(t===null)ur(e,126);else if(TS(t)){ur(e,117),de(e,t.length);for(let r=0;r<t.length;r++)ua(e,t[r])}else if(t instanceof Uint8Array)ur(e,116),on(e,t);else{ur(e,118);const r=Object.keys(t);de(e,r.length);for(let n=0;n<r.length;n++){const i=r[n];io(e,i),ua(e,t[i])}}break;case"boolean":ur(e,t?120:121);break;default:ur(e,127)}};class Bm extends la{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&de(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Dm=e=>{e.count>0&&(Gf(e.encoder,e.count===1?e.s:-e.s),e.count>1&&de(e.encoder,e.count-2))};class Dc{constructor(){this.encoder=new la,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Dm(this),this.count=1,this.s=t)}toUint8Array(){return Dm(this),Xn(this.encoder)}}const jm=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Gf(e.encoder,t),e.count>1&&de(e.encoder,e.count-2)}};class qf{constructor(){this.encoder=new la,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(jm(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return jm(this),Xn(this.encoder)}}class GS{constructor(){this.sarr=[],this.s="",this.lensE=new Dc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new la;return this.sarr.push(this.s),this.s="",io(t,this.sarr.join("")),Bc(t,this.lensE.toUint8Array()),Xn(t)}}const Wi=e=>new Error(e),Jn=()=>{throw Wi("Method unimplemented")},Zn=()=>{throw Wi("Unexpected case")},zm=Wi("Unexpected end of array"),Wm=Wi("Integer out of Range");class jc{constructor(t){this.arr=t,this.pos=0}}const so=e=>new jc(e),KS=e=>e.pos!==e.arr.length,YS=(e,t)=>{const r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,r},an=e=>YS(e,ie(e)),oo=e=>e.arr[e.pos++],ie=e=>{let t=0,r=1;const n=e.arr.length;for(;e.pos<n;){const i=e.arr[e.pos++];if(t=t+(i&ws)*r,r*=128,i<sn)return t;if(t>Pm)throw Wm}throw zm},Vf=e=>{let t=e.arr[e.pos++],r=t&Wf,n=64;const i=(t&vi)>0?-1:1;if(!(t&sn))return i*r;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],r=r+(t&ws)*n,n*=128,t<sn)return i*r;if(r>Pm)throw Wm}throw zm},ao=ca?e=>ca.decode(an(e)):e=>{let t=ie(e);if(t===0)return"";{let r=String.fromCodePoint(oo(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(oo(e));else for(;t>0;){const n=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,i),t-=n}return decodeURIComponent(escape(r))}},Xf=(e,t)=>{const r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},qS=[e=>{},e=>null,Vf,e=>Xf(e,4).getFloat32(0,!1),e=>Xf(e,8).getFloat64(0,!1),e=>Xf(e,8).getBigInt64(0,!1),e=>!1,e=>!0,ao,e=>{const t=ie(e),r={};for(let n=0;n<t;n++){const i=ao(e);r[i]=fa(e)}return r},e=>{const t=ie(e),r=[];for(let n=0;n<t;n++)r.push(fa(e));return r},an],fa=e=>qS[127-oo(e)](e);class Hm extends jc{constructor(t,r){super(t),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),KS(this)?this.count=ie(this)+1:this.count=-1),this.count--,this.s}}class zc extends jc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Vf(this);const t=Lm(this.s);this.count=1,t&&(this.s=-this.s,this.count=ie(this)+2)}return this.count--,this.s}}class Jf extends jc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Vf(this),r=t&1;this.diff=zi(t/2),this.count=1,r&&(this.count=ie(this)+2)}return this.s+=this.diff,this.count--,this.s}}class VS{constructor(t){this.decoder=new zc(t),this.str=ao(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),r=this.str.slice(this.spos,t);return this.spos=t,r}}const XS=crypto.getRandomValues.bind(crypto),Gm=()=>XS(new Uint32Array(1))[0],JS="10000000-1000-4000-8000"+-1e11,ZS=()=>JS.replace(/[018]/g,e=>(e^Gm()&15>>e/4).toString(16)),Km=e=>new Promise(e);Promise.all.bind(Promise);var Ym={},Wc={};Wc.byteLength=eR,Wc.toByteArray=nR,Wc.fromByteArray=oR;for(var Qn=[],mn=[],QS=typeof Uint8Array<"u"?Uint8Array:Array,Zf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",co=0,tR=Zf.length;co<tR;++co)Qn[co]=Zf[co],mn[Zf.charCodeAt(co)]=co;mn[45]=62,mn[95]=63;function qm(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function eR(e){var t=qm(e),r=t[0],n=t[1];return(r+n)*3/4-n}function rR(e,t,r){return(t+r)*3/4-r}function nR(e){var t,r=qm(e),n=r[0],i=r[1],s=new QS(rR(e,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)t=mn[e.charCodeAt(c)]<<18|mn[e.charCodeAt(c+1)]<<12|mn[e.charCodeAt(c+2)]<<6|mn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=mn[e.charCodeAt(c)]<<2|mn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=mn[e.charCodeAt(c)]<<10|mn[e.charCodeAt(c+1)]<<4|mn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function iR(e){return Qn[e>>18&63]+Qn[e>>12&63]+Qn[e>>6&63]+Qn[e&63]}function sR(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(iR(n));return i.join("")}function oR(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(sR(e,o,o+s>a?a:o+s));return n===1?(t=e[r-1],i.push(Qn[t>>2]+Qn[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(Qn[t>>10]+Qn[t>>4&63]+Qn[t<<2&63]+"=")),i.join("")}var Qf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Qf.read=function(e,t,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+e[t+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+e[t+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(f?-1:1)*o*Math.pow(2,s-n)},Qf.write=function(e,t,r,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,m=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=d/c:t+=d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[r+f]=o&255,f+=p,o/=256,l-=8);e[r+f-p]|=m*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Wc,r=Qf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=k,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const C=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(C,_),C.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(C){if(C>i)throw new RangeError('The value "'+C+'" is invalid for option "size"');const _=new s(C);return Object.setPrototypeOf(_,u.prototype),_}function u(C,_,v){if(typeof C=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(C)}return h(C,_,v)}u.poolSize=8192;function h(C,_,v){if(typeof C=="string")return m(C,_);if(o.isView(C))return y(C);if(C==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C);if(gt(C,o)||C&&gt(C.buffer,o)||typeof a<"u"&&(gt(C,a)||C&&gt(C.buffer,a)))return b(C,_,v);if(typeof C=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const F=C.valueOf&&C.valueOf();if(F!=null&&F!==C)return u.from(F,_,v);const Y=A(C);if(Y)return Y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof C[Symbol.toPrimitive]=="function")return u.from(C[Symbol.toPrimitive]("string"),_,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof C)}u.from=function(C,_,v){return h(C,_,v)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(C){if(typeof C!="number")throw new TypeError('"size" argument must be of type number');if(C<0)throw new RangeError('The value "'+C+'" is invalid for option "size"')}function f(C,_,v){return d(C),C<=0?l(C):_!==void 0?typeof v=="string"?l(C).fill(_,v):l(C).fill(_):l(C)}u.alloc=function(C,_,v){return f(C,_,v)};function p(C){return d(C),l(C<0?0:T(C)|0)}u.allocUnsafe=function(C){return p(C)},u.allocUnsafeSlow=function(C){return p(C)};function m(C,_){if((typeof _!="string"||_==="")&&(_="utf8"),!u.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const v=I(C,_)|0;let F=l(v);const Y=F.write(C,_);return Y!==v&&(F=F.slice(0,Y)),F}function g(C){const _=C.length<0?0:T(C.length)|0,v=l(_);for(let F=0;F<_;F+=1)v[F]=C[F]&255;return v}function y(C){if(gt(C,s)){const _=new s(C);return b(_.buffer,_.byteOffset,_.byteLength)}return g(C)}function b(C,_,v){if(_<0||C.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(C.byteLength<_+(v||0))throw new RangeError('"length" is outside of buffer bounds');let F;return _===void 0&&v===void 0?F=new s(C):v===void 0?F=new s(C,_):F=new s(C,_,v),Object.setPrototypeOf(F,u.prototype),F}function A(C){if(u.isBuffer(C)){const _=T(C.length)|0,v=l(_);return v.length===0||C.copy(v,0,0,_),v}if(C.length!==void 0)return typeof C.length!="number"||Ft(C.length)?l(0):g(C);if(C.type==="Buffer"&&Array.isArray(C.data))return g(C.data)}function T(C){if(C>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return C|0}function k(C){return+C!=C&&(C=0),u.alloc(+C)}u.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==u.prototype},u.compare=function(_,v){if(gt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),gt(v,s)&&(v=u.from(v,v.offset,v.byteLength)),!u.isBuffer(_)||!u.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===v)return 0;let F=_.length,Y=v.length;for(let at=0,D=Math.min(F,Y);at<D;++at)if(_[at]!==v[at]){F=_[at],Y=v[at];break}return F<Y?-1:Y<F?1:0},u.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(_,v){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return u.alloc(0);let F;if(v===void 0)for(v=0,F=0;F<_.length;++F)v+=_[F].length;const Y=u.allocUnsafe(v);let at=0;for(F=0;F<_.length;++F){let D=_[F];if(gt(D,s))at+D.length>Y.length?(u.isBuffer(D)||(D=u.from(D)),D.copy(Y,at)):s.prototype.set.call(Y,D,at);else if(u.isBuffer(D))D.copy(Y,at);else throw new TypeError('"list" argument must be an Array of Buffers');at+=D.length}return Y};function I(C,_){if(u.isBuffer(C))return C.length;if(o.isView(C)||gt(C,o))return C.byteLength;if(typeof C!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof C);const v=C.length,F=arguments.length>2&&arguments[2]===!0;if(!F&&v===0)return 0;let Y=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return dt(C).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return _t(C).length;default:if(Y)return F?-1:dt(C).length;_=(""+_).toLowerCase(),Y=!0}}u.byteLength=I;function R(C,_,v){let F=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,_>>>=0,v<=_))return"";for(C||(C="utf8");;)switch(C){case"hex":return P(this,_,v);case"utf8":case"utf-8":return U(this,_,v);case"ascii":return K(this,_,v);case"latin1":case"binary":return W(this,_,v);case"base64":return j(this,_,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,_,v);default:if(F)throw new TypeError("Unknown encoding: "+C);C=(C+"").toLowerCase(),F=!0}}u.prototype._isBuffer=!0;function $(C,_,v){const F=C[_];C[_]=C[v],C[v]=F}u.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let v=0;v<_;v+=2)$(this,v,v+1);return this},u.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let v=0;v<_;v+=4)$(this,v,v+3),$(this,v+1,v+2);return this},u.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let v=0;v<_;v+=8)$(this,v,v+7),$(this,v+1,v+6),$(this,v+2,v+5),$(this,v+3,v+4);return this},u.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?U(this,0,_):R.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(_){if(!u.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:u.compare(this,_)===0},u.prototype.inspect=function(){let _="";const v=e.INSPECT_MAX_BYTES;return _=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(_+=" ... "),"<Buffer "+_+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(_,v,F,Y,at){if(gt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(v===void 0&&(v=0),F===void 0&&(F=_?_.length:0),Y===void 0&&(Y=0),at===void 0&&(at=this.length),v<0||F>_.length||Y<0||at>this.length)throw new RangeError("out of range index");if(Y>=at&&v>=F)return 0;if(Y>=at)return-1;if(v>=F)return 1;if(v>>>=0,F>>>=0,Y>>>=0,at>>>=0,this===_)return 0;let D=at-Y,Z=F-v;const Bt=Math.min(D,Z),jt=this.slice(Y,at),Gt=_.slice(v,F);for(let Ot=0;Ot<Bt;++Ot)if(jt[Ot]!==Gt[Ot]){D=jt[Ot],Z=Gt[Ot];break}return D<Z?-1:Z<D?1:0};function M(C,_,v,F,Y){if(C.length===0)return-1;if(typeof v=="string"?(F=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,Ft(v)&&(v=Y?0:C.length-1),v<0&&(v=C.length+v),v>=C.length){if(Y)return-1;v=C.length-1}else if(v<0)if(Y)v=0;else return-1;if(typeof _=="string"&&(_=u.from(_,F)),u.isBuffer(_))return _.length===0?-1:H(C,_,v,F,Y);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?Y?s.prototype.indexOf.call(C,_,v):s.prototype.lastIndexOf.call(C,_,v):H(C,[_],v,F,Y);throw new TypeError("val must be string, number or Buffer")}function H(C,_,v,F,Y){let at=1,D=C.length,Z=_.length;if(F!==void 0&&(F=String(F).toLowerCase(),F==="ucs2"||F==="ucs-2"||F==="utf16le"||F==="utf-16le")){if(C.length<2||_.length<2)return-1;at=2,D/=2,Z/=2,v/=2}function Bt(Gt,Ot){return at===1?Gt[Ot]:Gt.readUInt16BE(Ot*at)}let jt;if(Y){let Gt=-1;for(jt=v;jt<D;jt++)if(Bt(C,jt)===Bt(_,Gt===-1?0:jt-Gt)){if(Gt===-1&&(Gt=jt),jt-Gt+1===Z)return Gt*at}else Gt!==-1&&(jt-=jt-Gt),Gt=-1}else for(v+Z>D&&(v=D-Z),jt=v;jt>=0;jt--){let Gt=!0;for(let Ot=0;Ot<Z;Ot++)if(Bt(C,jt+Ot)!==Bt(_,Ot)){Gt=!1;break}if(Gt)return jt}return-1}u.prototype.includes=function(_,v,F){return this.indexOf(_,v,F)!==-1},u.prototype.indexOf=function(_,v,F){return M(this,_,v,F,!0)},u.prototype.lastIndexOf=function(_,v,F){return M(this,_,v,F,!1)};function X(C,_,v,F){v=Number(v)||0;const Y=C.length-v;F?(F=Number(F),F>Y&&(F=Y)):F=Y;const at=_.length;F>at/2&&(F=at/2);let D;for(D=0;D<F;++D){const Z=parseInt(_.substr(D*2,2),16);if(Ft(Z))return D;C[v+D]=Z}return D}function O(C,_,v,F){return Rt(dt(_,C.length-v),C,v,F)}function N(C,_,v,F){return Rt(pt(_),C,v,F)}function E(C,_,v,F){return Rt(_t(_),C,v,F)}function L(C,_,v,F){return Rt(it(_,C.length-v),C,v,F)}u.prototype.write=function(_,v,F,Y){if(v===void 0)Y="utf8",F=this.length,v=0;else if(F===void 0&&typeof v=="string")Y=v,F=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(F)?(F=F>>>0,Y===void 0&&(Y="utf8")):(Y=F,F=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const at=this.length-v;if((F===void 0||F>at)&&(F=at),_.length>0&&(F<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");Y||(Y="utf8");let D=!1;for(;;)switch(Y){case"hex":return X(this,_,v,F);case"utf8":case"utf-8":return O(this,_,v,F);case"ascii":case"latin1":case"binary":return N(this,_,v,F);case"base64":return E(this,_,v,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,_,v,F);default:if(D)throw new TypeError("Unknown encoding: "+Y);Y=(""+Y).toLowerCase(),D=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function j(C,_,v){return _===0&&v===C.length?t.fromByteArray(C):t.fromByteArray(C.slice(_,v))}function U(C,_,v){v=Math.min(C.length,v);const F=[];let Y=_;for(;Y<v;){const at=C[Y];let D=null,Z=at>239?4:at>223?3:at>191?2:1;if(Y+Z<=v){let Bt,jt,Gt,Ot;switch(Z){case 1:at<128&&(D=at);break;case 2:Bt=C[Y+1],(Bt&192)===128&&(Ot=(at&31)<<6|Bt&63,Ot>127&&(D=Ot));break;case 3:Bt=C[Y+1],jt=C[Y+2],(Bt&192)===128&&(jt&192)===128&&(Ot=(at&15)<<12|(Bt&63)<<6|jt&63,Ot>2047&&(Ot<55296||Ot>57343)&&(D=Ot));break;case 4:Bt=C[Y+1],jt=C[Y+2],Gt=C[Y+3],(Bt&192)===128&&(jt&192)===128&&(Gt&192)===128&&(Ot=(at&15)<<18|(Bt&63)<<12|(jt&63)<<6|Gt&63,Ot>65535&&Ot<1114112&&(D=Ot))}}D===null?(D=65533,Z=1):D>65535&&(D-=65536,F.push(D>>>10&1023|55296),D=56320|D&1023),F.push(D),Y+=Z}return Q(F)}const q=4096;function Q(C){const _=C.length;if(_<=q)return String.fromCharCode.apply(String,C);let v="",F=0;for(;F<_;)v+=String.fromCharCode.apply(String,C.slice(F,F+=q));return v}function K(C,_,v){let F="";v=Math.min(C.length,v);for(let Y=_;Y<v;++Y)F+=String.fromCharCode(C[Y]&127);return F}function W(C,_,v){let F="";v=Math.min(C.length,v);for(let Y=_;Y<v;++Y)F+=String.fromCharCode(C[Y]);return F}function P(C,_,v){const F=C.length;(!_||_<0)&&(_=0),(!v||v<0||v>F)&&(v=F);let Y="";for(let at=_;at<v;++at)Y+=ye[C[at]];return Y}function st(C,_,v){const F=C.slice(_,v);let Y="";for(let at=0;at<F.length-1;at+=2)Y+=String.fromCharCode(F[at]+F[at+1]*256);return Y}u.prototype.slice=function(_,v){const F=this.length;_=~~_,v=v===void 0?F:~~v,_<0?(_+=F,_<0&&(_=0)):_>F&&(_=F),v<0?(v+=F,v<0&&(v=0)):v>F&&(v=F),v<_&&(v=_);const Y=this.subarray(_,v);return Object.setPrototypeOf(Y,u.prototype),Y};function G(C,_,v){if(C%1!==0||C<0)throw new RangeError("offset is not uint");if(C+_>v)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_],at=1,D=0;for(;++D<v&&(at*=256);)Y+=this[_+D]*at;return Y},u.prototype.readUintBE=u.prototype.readUIntBE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_+--v],at=1;for(;v>0&&(at*=256);)Y+=this[_+--v]*at;return Y},u.prototype.readUint8=u.prototype.readUInt8=function(_,v){return _=_>>>0,v||G(_,1,this.length),this[_]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(_,v){return _=_>>>0,v||G(_,2,this.length),this[_]|this[_+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(_,v){return _=_>>>0,v||G(_,2,this.length),this[_]<<8|this[_+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(_,v){return _=_>>>0,v||G(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},u.prototype.readBigUInt64LE=Xt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,at=this[++_]+this[++_]*2**8+this[++_]*2**16+F*2**24;return BigInt(Y)+(BigInt(at)<<BigInt(32))}),u.prototype.readBigUInt64BE=Xt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=v*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],at=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F;return(BigInt(Y)<<BigInt(32))+BigInt(at)}),u.prototype.readIntLE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=this[_],at=1,D=0;for(;++D<v&&(at*=256);)Y+=this[_+D]*at;return at*=128,Y>=at&&(Y-=Math.pow(2,8*v)),Y},u.prototype.readIntBE=function(_,v,F){_=_>>>0,v=v>>>0,F||G(_,v,this.length);let Y=v,at=1,D=this[_+--Y];for(;Y>0&&(at*=256);)D+=this[_+--Y]*at;return at*=128,D>=at&&(D-=Math.pow(2,8*v)),D},u.prototype.readInt8=function(_,v){return _=_>>>0,v||G(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},u.prototype.readInt16LE=function(_,v){_=_>>>0,v||G(_,2,this.length);const F=this[_]|this[_+1]<<8;return F&32768?F|4294901760:F},u.prototype.readInt16BE=function(_,v){_=_>>>0,v||G(_,2,this.length);const F=this[_+1]|this[_]<<8;return F&32768?F|4294901760:F},u.prototype.readInt32LE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},u.prototype.readInt32BE=function(_,v){return _=_>>>0,v||G(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},u.prototype.readBigInt64LE=Xt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(F<<24);return(BigInt(Y)<<BigInt(32))+BigInt(v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),u.prototype.readBigInt64BE=Xt(function(_){_=_>>>0,ct(_,"offset");const v=this[_],F=this[_+7];(v===void 0||F===void 0)&&z(_,this.length-8);const Y=(v<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(Y)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+F)}),u.prototype.readFloatLE=function(_,v){return _=_>>>0,v||G(_,4,this.length),r.read(this,_,!0,23,4)},u.prototype.readFloatBE=function(_,v){return _=_>>>0,v||G(_,4,this.length),r.read(this,_,!1,23,4)},u.prototype.readDoubleLE=function(_,v){return _=_>>>0,v||G(_,8,this.length),r.read(this,_,!0,52,8)},u.prototype.readDoubleBE=function(_,v){return _=_>>>0,v||G(_,8,this.length),r.read(this,_,!1,52,8)};function rt(C,_,v,F,Y,at){if(!u.isBuffer(C))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>Y||_<at)throw new RangeError('"value" argument is out of bounds');if(v+F>C.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(_,v,F,Y){if(_=+_,v=v>>>0,F=F>>>0,!Y){const Z=Math.pow(2,8*F)-1;rt(this,_,v,F,Z,0)}let at=1,D=0;for(this[v]=_&255;++D<F&&(at*=256);)this[v+D]=_/at&255;return v+F},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(_,v,F,Y){if(_=+_,v=v>>>0,F=F>>>0,!Y){const Z=Math.pow(2,8*F)-1;rt(this,_,v,F,Z,0)}let at=F-1,D=1;for(this[v+at]=_&255;--at>=0&&(D*=256);)this[v+at]=_/D&255;return v+F},u.prototype.writeUint8=u.prototype.writeUInt8=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,1,255,0),this[v]=_&255,v+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,65535,0),this[v]=_&255,this[v+1]=_>>>8,v+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,65535,0),this[v]=_>>>8,this[v+1]=_&255,v+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,4294967295,0),this[v+3]=_>>>24,this[v+2]=_>>>16,this[v+1]=_>>>8,this[v]=_&255,v+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,4294967295,0),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4};function wt(C,_,v,F,Y){ft(_,F,Y,C,v,7);let at=Number(_&BigInt(4294967295));C[v++]=at,at=at>>8,C[v++]=at,at=at>>8,C[v++]=at,at=at>>8,C[v++]=at;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[v++]=D,D=D>>8,C[v++]=D,D=D>>8,C[v++]=D,D=D>>8,C[v++]=D,v}function Tt(C,_,v,F,Y){ft(_,F,Y,C,v,7);let at=Number(_&BigInt(4294967295));C[v+7]=at,at=at>>8,C[v+6]=at,at=at>>8,C[v+5]=at,at=at>>8,C[v+4]=at;let D=Number(_>>BigInt(32)&BigInt(4294967295));return C[v+3]=D,D=D>>8,C[v+2]=D,D=D>>8,C[v+1]=D,D=D>>8,C[v]=D,v+8}u.prototype.writeBigUInt64LE=Xt(function(_,v=0){return wt(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Xt(function(_,v=0){return Tt(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(_,v,F,Y){if(_=+_,v=v>>>0,!Y){const Bt=Math.pow(2,8*F-1);rt(this,_,v,F,Bt-1,-Bt)}let at=0,D=1,Z=0;for(this[v]=_&255;++at<F&&(D*=256);)_<0&&Z===0&&this[v+at-1]!==0&&(Z=1),this[v+at]=(_/D>>0)-Z&255;return v+F},u.prototype.writeIntBE=function(_,v,F,Y){if(_=+_,v=v>>>0,!Y){const Bt=Math.pow(2,8*F-1);rt(this,_,v,F,Bt-1,-Bt)}let at=F-1,D=1,Z=0;for(this[v+at]=_&255;--at>=0&&(D*=256);)_<0&&Z===0&&this[v+at+1]!==0&&(Z=1),this[v+at]=(_/D>>0)-Z&255;return v+F},u.prototype.writeInt8=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,1,127,-128),_<0&&(_=255+_+1),this[v]=_&255,v+1},u.prototype.writeInt16LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,32767,-32768),this[v]=_&255,this[v+1]=_>>>8,v+2},u.prototype.writeInt16BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,2,32767,-32768),this[v]=_>>>8,this[v+1]=_&255,v+2},u.prototype.writeInt32LE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,2147483647,-2147483648),this[v]=_&255,this[v+1]=_>>>8,this[v+2]=_>>>16,this[v+3]=_>>>24,v+4},u.prototype.writeInt32BE=function(_,v,F){return _=+_,v=v>>>0,F||rt(this,_,v,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4},u.prototype.writeBigInt64LE=Xt(function(_,v=0){return wt(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Xt(function(_,v=0){return Tt(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function It(C,_,v,F,Y,at){if(v+F>C.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function St(C,_,v,F,Y){return _=+_,v=v>>>0,Y||It(C,_,v,4),r.write(C,_,v,F,23,4),v+4}u.prototype.writeFloatLE=function(_,v,F){return St(this,_,v,!0,F)},u.prototype.writeFloatBE=function(_,v,F){return St(this,_,v,!1,F)};function Pt(C,_,v,F,Y){return _=+_,v=v>>>0,Y||It(C,_,v,8),r.write(C,_,v,F,52,8),v+8}u.prototype.writeDoubleLE=function(_,v,F){return Pt(this,_,v,!0,F)},u.prototype.writeDoubleBE=function(_,v,F){return Pt(this,_,v,!1,F)},u.prototype.copy=function(_,v,F,Y){if(!u.isBuffer(_))throw new TypeError("argument should be a Buffer");if(F||(F=0),!Y&&Y!==0&&(Y=this.length),v>=_.length&&(v=_.length),v||(v=0),Y>0&&Y<F&&(Y=F),Y===F||_.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(F<0||F>=this.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("sourceEnd out of bounds");Y>this.length&&(Y=this.length),_.length-v<Y-F&&(Y=_.length-v+F);const at=Y-F;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(v,F,Y):s.prototype.set.call(_,this.subarray(F,Y),v),at},u.prototype.fill=function(_,v,F,Y){if(typeof _=="string"){if(typeof v=="string"?(Y=v,v=0,F=this.length):typeof F=="string"&&(Y=F,F=this.length),Y!==void 0&&typeof Y!="string")throw new TypeError("encoding must be a string");if(typeof Y=="string"&&!u.isEncoding(Y))throw new TypeError("Unknown encoding: "+Y);if(_.length===1){const D=_.charCodeAt(0);(Y==="utf8"&&D<128||Y==="latin1")&&(_=D)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(v<0||this.length<v||this.length<F)throw new RangeError("Out of range index");if(F<=v)return this;v=v>>>0,F=F===void 0?this.length:F>>>0,_||(_=0);let at;if(typeof _=="number")for(at=v;at<F;++at)this[at]=_;else{const D=u.isBuffer(_)?_:u.from(_,Y),Z=D.length;if(Z===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(at=0;at<F-v;++at)this[at+v]=D[at%Z]}return this};const Mt={};function qt(C,_,v){Mt[C]=class extends v{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${C}]`,this.stack,delete this.name}get code(){return C}set code(Y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Y,writable:!0})}toString(){return`${this.name} [${C}]: ${this.message}`}}}qt("ERR_BUFFER_OUT_OF_BOUNDS",function(C){return C?`${C} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),qt("ERR_INVALID_ARG_TYPE",function(C,_){return`The "${C}" argument must be of type number. Received type ${typeof _}`},TypeError),qt("ERR_OUT_OF_RANGE",function(C,_,v){let F=`The value of "${C}" is out of range.`,Y=v;return Number.isInteger(v)&&Math.abs(v)>2**32?Y=ee(String(v)):typeof v=="bigint"&&(Y=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(Y=ee(Y)),Y+="n"),F+=` It must be ${_}. Received ${Y}`,F},RangeError);function ee(C){let _="",v=C.length;const F=C[0]==="-"?1:0;for(;v>=F+4;v-=3)_=`_${C.slice(v-3,v)}${_}`;return`${C.slice(0,v)}${_}`}function S(C,_,v){ct(_,"offset"),(C[_]===void 0||C[_+v]===void 0)&&z(_,C.length-(v+1))}function ft(C,_,v,F,Y,at){if(C>v||C<_){const D=typeof _=="bigint"?"n":"";let Z;throw _===0||_===BigInt(0)?Z=`>= 0${D} and < 2${D} ** ${(at+1)*8}${D}`:Z=`>= -(2${D} ** ${(at+1)*8-1}${D}) and < 2 ** ${(at+1)*8-1}${D}`,new Mt.ERR_OUT_OF_RANGE("value",Z,C)}S(F,Y,at)}function ct(C,_){if(typeof C!="number")throw new Mt.ERR_INVALID_ARG_TYPE(_,"number",C)}function z(C,_,v){throw Math.floor(C)!==C?(ct(C,v),new Mt.ERR_OUT_OF_RANGE("offset","an integer",C)):_<0?new Mt.ERR_BUFFER_OUT_OF_BOUNDS:new Mt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,C)}const B=/[^+/0-9A-Za-z-_]/g;function tt(C){if(C=C.split("=")[0],C=C.trim().replace(B,""),C.length<2)return"";for(;C.length%4!==0;)C=C+"=";return C}function dt(C,_){_=_||1/0;let v;const F=C.length;let Y=null;const at=[];for(let D=0;D<F;++D){if(v=C.charCodeAt(D),v>55295&&v<57344){if(!Y){if(v>56319){(_-=3)>-1&&at.push(239,191,189);continue}else if(D+1===F){(_-=3)>-1&&at.push(239,191,189);continue}Y=v;continue}if(v<56320){(_-=3)>-1&&at.push(239,191,189),Y=v;continue}v=(Y-55296<<10|v-56320)+65536}else Y&&(_-=3)>-1&&at.push(239,191,189);if(Y=null,v<128){if((_-=1)<0)break;at.push(v)}else if(v<2048){if((_-=2)<0)break;at.push(v>>6|192,v&63|128)}else if(v<65536){if((_-=3)<0)break;at.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((_-=4)<0)break;at.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return at}function pt(C){const _=[];for(let v=0;v<C.length;++v)_.push(C.charCodeAt(v)&255);return _}function it(C,_){let v,F,Y;const at=[];for(let D=0;D<C.length&&!((_-=2)<0);++D)v=C.charCodeAt(D),F=v>>8,Y=v%256,at.push(Y),at.push(F);return at}function _t(C){return t.toByteArray(tt(C))}function Rt(C,_,v,F){let Y;for(Y=0;Y<F&&!(Y+v>=_.length||Y>=C.length);++Y)_[Y+v]=C[Y];return Y}function gt(C,_){return C instanceof _||C!=null&&C.constructor!=null&&C.constructor.name!=null&&C.constructor.name===_.name}function Ft(C){return C!==C}const ye=function(){const C="0123456789abcdef",_=new Array(256);for(let v=0;v<16;++v){const F=v*16;for(let Y=0;Y<16;++Y)_[F+Y]=C[v]+C[Y]}return _}();function Xt(C){return typeof BigInt>"u"?tr:C}function tr(){throw new Error("BigInt not supported")}})(Ym);const rr=Ym.Buffer,Vm=e=>e===void 0?null:e;class aR{constructor(){this.map=new Map}setItem(t,r){this.map.set(t,r)}getItem(t){return this.map.get(t)}}let Xm=new aR,cR=!0;try{typeof localStorage<"u"&&localStorage&&(Xm=localStorage,cR=!1)}catch{}const lR=Xm,uR=Object.assign,fR=Object.keys,hR=(e,t)=>{for(const r in e)t(e[r],r)},Jm=e=>fR(e).length,dR=e=>{for(const t in e)return!1;return!0},pR=(e,t)=>{for(const r in e)if(!t(e[r],r))return!1;return!0},mR=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),gR=(e,t)=>e===t||Jm(e)===Jm(t)&&pR(e,(r,n)=>(r!==void 0||mR(t,n))&&t[n]===r),yR=Object.freeze,Zm=e=>{for(const t in e){const r=e[t];(typeof r=="object"||typeof r=="function")&&Zm(e[t])}return yR(e)},th=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&th(e,t,r+1)}},_R=e=>e,bR=(e,t)=>t.includes(e);var Qm={};const ha=typeof Ln<"u"&&Ln.release&&/node|io\.js/.test(Ln.release.name)&&Object.prototype.toString.call(typeof Ln<"u"?Ln:0)==="[object process]";let ti;const wR=()=>{if(ti===void 0)if(ha){ti=Mn();const e=Ln.argv;let t=null;for(let r=0;r<e.length;r++){const n=e[r];n[0]==="-"?(t!==null&&ti.set(t,""),t=n):t!==null&&(ti.set(t,n),t=null)}t!==null&&ti.set(t,"")}else typeof location=="object"?(ti=Mn(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,r]=e.split("=");ti.set(`--${Fm(t,"-")}`,r),ti.set(`-${Fm(t,"-")}`,r)}})):ti=Mn();return ti},eh=e=>wR().has(e),Hc=e=>Vm(ha?Qm[e.toUpperCase().replaceAll("-","_")]:lR.getItem(e)),tg=e=>eh("--"+e)||Hc(e)!==null;tg("production");const vR=ha&&bR(Qm.FORCE_COLOR,["true","1","2"])||!eh("--no-colors")&&!tg("no-color")&&(!ha||Ln.stdout.isTTY)&&(!ha||eh("--color")||Hc("COLORTERM")!==null||(Hc("TERM")||"").includes("color")),ER=e=>new Uint8Array(e),kR=e=>{const t=ER(e.byteLength);return t.set(e),t};class xR{constructor(t,r){this.left=t,this.right=r}}const Ei=(e,t)=>new xR(e,t);typeof DOMParser<"u"&&new DOMParser;const AR=e=>kS(e,(t,r)=>`${r}:${t};`).join(""),ki=Symbol,eg=ki(),rg=ki(),TR=ki(),SR=ki(),RR=ki(),ng=ki(),OR=ki(),rh=ki(),IR=ki(),NR=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],r=[];let n=0;for(;n<e.length;n++){const s=e[n];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(n>0&&r.push(t.join(""));n<e.length;n++){const s=e[n];s instanceof Symbol||r.push(s)}return r},CR={[eg]:Ei("font-weight","bold"),[rg]:Ei("font-weight","normal"),[TR]:Ei("color","blue"),[RR]:Ei("color","green"),[SR]:Ei("color","grey"),[ng]:Ei("color","red"),[OR]:Ei("color","purple"),[rh]:Ei("color","orange"),[IR]:Ei("color","black")},ig=vR?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],r=[],n=Mn();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=CR[a];if(c!==void 0)n.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=AR(n);s>0||l.length>0?(t.push("%c"+a),r.push(l)):t.push(a)}else break}}for(s>0&&(i=r,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:NR,LR=(...e)=>{console.log(...ig(e)),sg.forEach(t=>t.print(e))},MR=(...e)=>{console.warn(...ig(e)),e.unshift(rh),sg.forEach(t=>t.print(e))},sg=no(),og=e=>({[Symbol.iterator](){return this},next:e}),UR=(e,t)=>og(()=>{let r;do r=e.next();while(!r.done&&!t(r.value));return r}),nh=(e,t)=>og(()=>{const{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class ih{constructor(t,r){this.clock=t,this.len=r}}class da{constructor(){this.clients=new Map}}const ag=(e,t,r)=>t.clients.forEach((n,i)=>{const s=e.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=n[c];c<n.length&&l.clock<a;l=n[++c])kg(e,s,l.clock,l.len,r)}}),PR=(e,t)=>{let r=0,n=e.length-1;for(;r<=n;){const i=zi((r+n)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;r=i+1}else n=i-1}return null},cg=(e,t)=>{const r=e.clients.get(t.client);return r!==void 0&&PR(r,t.clock)!==null},sh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<t.length;r++){const i=t[n-1],s=t[r];i.clock+i.len>=s.clock?i.len=bs(i.len,s.clock+s.len-i.clock):(n<r&&(t[n]=s),n++)}t.length=n})},FR=e=>{const t=new da;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,i)=>{if(!t.clients.has(i)){const s=n.slice();for(let o=r+1;o<e.length;o++)AS(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return sh(t),t},Gc=(e,t,r,n)=>{ji(e.clients,t,()=>[]).push(new ih(r,n))},$R=()=>new da,BR=e=>{const t=$R();return e.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let l=r[s+1];s+1<r.length&&l.deleted;l=r[++s+1])c+=l.length;i.push(new ih(a,c))}}i.length>0&&t.clients.set(n,i)}),t},lo=(e,t)=>{de(e.restEncoder,t.clients.size),_s(t.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{e.resetDsCurVal(),de(e.restEncoder,r);const i=n.length;de(e.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},oh=e=>{const t=new da,r=ie(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();const i=ie(e.restDecoder),s=ie(e.restDecoder);if(s>0){const o=ji(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ih(e.readDsClock(),e.readDsLen()))}}return t},lg=(e,t,r)=>{const n=new da,i=ie(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=ie(e.restDecoder),a=ie(e.restDecoder),c=r.clients.get(o)||[],l=fr(r,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&Gc(n,o,l,d-l);let f=ei(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,sl(t,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,sl(t,p,d-p.id.clock)),p.delete(t))}else Gc(n,o,h,d-h)}}if(n.clients.size>0){const s=new vs;return de(s.restEncoder,0),lo(s,n),s.toUint8Array()}return null},ug=Gm;class uo extends SS{constructor({guid:t=ZS(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=ug(),this.guid=t,this.collectionid=r,this.share=new Map,this.store=new wg,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Km(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Km(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Ee(t.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(_s(this.subdocs).map(t=>t.guid))}transact(t,r=null){return Ee(this,t,r)}get(t,r=vr){const n=ji(this.share,t,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==vr&&i!==r)if(i===vr){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,mo)}getText(t=""){return this.get(t,xi)}getMap(t=""){return this.get(t,go)}getXmlElement(t=""){return this.get(t,_o)}getXmlFragment(t=""){return this.get(t,Es)}toJSON(){const t={};return this.share.forEach((r,n)=>{t[n]=r.toJSON()}),t}destroy(){this.isDestroyed=!0,_s(this.subdocs).forEach(r=>r.destroy());const t=this._item;if(t!==null){this._item=null;const r=t.content;r.doc=new uo({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=t,Ee(t.parent.doc,n=>{const i=r.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class fg{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return ie(this.restDecoder)}readDsLen(){return ie(this.restDecoder)}}class hg extends fg{readLeftID(){return ae(ie(this.restDecoder),ie(this.restDecoder))}readRightID(){return ae(ie(this.restDecoder),ie(this.restDecoder))}readClient(){return ie(this.restDecoder)}readInfo(){return oo(this.restDecoder)}readString(){return ao(this.restDecoder)}readParentInfo(){return ie(this.restDecoder)===1}readTypeRef(){return ie(this.restDecoder)}readLen(){return ie(this.restDecoder)}readAny(){return fa(this.restDecoder)}readBuf(){return kR(an(this.restDecoder))}readJSON(){return JSON.parse(ao(this.restDecoder))}readKey(){return ao(this.restDecoder)}}class DR{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ie(this.restDecoder),this.dsCurrVal}readDsLen(){const t=ie(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class fo extends DR{constructor(t){super(t),this.keys=[],ie(t),this.keyClockDecoder=new Jf(an(t)),this.clientDecoder=new zc(an(t)),this.leftClockDecoder=new Jf(an(t)),this.rightClockDecoder=new Jf(an(t)),this.infoDecoder=new Hm(an(t),oo),this.stringDecoder=new VS(an(t)),this.parentInfoDecoder=new Hm(an(t),oo),this.typeRefDecoder=new zc(an(t)),this.lenDecoder=new zc(an(t))}readLeftID(){return new ho(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ho(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fa(this.restDecoder)}readBuf(){return an(this.restDecoder)}readJSON(){return fa(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class jR{constructor(){this.restEncoder=$c()}toUint8Array(){return Xn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){de(this.restEncoder,t)}writeDsLen(t){de(this.restEncoder,t)}}class pa extends jR{writeLeftID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeRightID(t){de(this.restEncoder,t.client),de(this.restEncoder,t.clock)}writeClient(t){de(this.restEncoder,t)}writeInfo(t){Hf(this.restEncoder,t)}writeString(t){io(this.restEncoder,t)}writeParentInfo(t){de(this.restEncoder,t?1:0)}writeTypeRef(t){de(this.restEncoder,t)}writeLen(t){de(this.restEncoder,t)}writeAny(t){ua(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){io(this.restEncoder,JSON.stringify(t))}writeKey(t){io(this.restEncoder,t)}}class zR{constructor(){this.restEncoder=$c(),this.dsCurrVal=0}toUint8Array(){return Xn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const r=t-this.dsCurrVal;this.dsCurrVal=t,de(this.restEncoder,r)}writeDsLen(t){t===0&&Zn(),de(this.restEncoder,t-1),this.dsCurrVal+=t}}class vs extends zR{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new qf,this.clientEncoder=new Dc,this.leftClockEncoder=new qf,this.rightClockEncoder=new qf,this.infoEncoder=new Bm(Hf),this.stringEncoder=new GS,this.parentInfoEncoder=new Bm(Hf),this.typeRefEncoder=new Dc,this.lenEncoder=new Dc}toUint8Array(){const t=$c();return de(t,0),on(t,this.keyClockEncoder.toUint8Array()),on(t,this.clientEncoder.toUint8Array()),on(t,this.leftClockEncoder.toUint8Array()),on(t,this.rightClockEncoder.toUint8Array()),on(t,Xn(this.infoEncoder)),on(t,this.stringEncoder.toUint8Array()),on(t,Xn(this.parentInfoEncoder)),on(t,this.typeRefEncoder.toUint8Array()),on(t,this.lenEncoder.toUint8Array()),Bc(t,Xn(this.restEncoder)),Xn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ua(this.restEncoder,t)}writeBuf(t){on(this.restEncoder,t)}writeJSON(t){ua(this.restEncoder,t)}writeKey(t){const r=this.keyMap.get(t);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(r)}}const WR=(e,t,r,n)=>{n=bs(n,t[0].id.clock);const i=ei(t,n);de(e.restEncoder,t.length-i),e.writeClient(r),de(e.restEncoder,n);const s=t[i];s.write(e,n-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},ah=(e,t,r)=>{const n=new Map;r.forEach((i,s)=>{fr(t,s)>i&&n.set(s,i)}),lh(t).forEach((i,s)=>{r.has(s)||n.set(s,0)}),de(e.restEncoder,n.size),_s(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{WR(e,t.clients.get(i),i,s)})},HR=(e,t)=>{const r=Mn(),n=ie(e.restDecoder);for(let i=0;i<n;i++){const s=ie(e.restDecoder),o=new Array(s),a=e.readClient();let c=ie(e.restDecoder);r.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(Fc&u){case 0:{const h=e.readLen();o[l]=new gn(ae(a,c),h),c+=h;break}case 10:{const h=ie(e.restDecoder);o[l]=new yn(ae(a,c),h),c+=h;break}default:{const h=(u&(vi|sn))===0,d=new ir(ae(a,c),null,(u&sn)===sn?e.readLeftID():null,null,(u&vi)===vi?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&oa)===oa?e.readString():null,qg(e,u));o[l]=d,c+=d.length}}}}return r},GR=(e,t,r)=>{const n=[];let i=_s(r.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=r.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=r.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new wg,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const p=f.id.client,m=r.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),r.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(g=>g!==p)}n.length=0};for(;;){if(u.constructor!==yn){const p=ji(h,u.id.client,()=>fr(t,u.id.client))-u.id.clock;if(p<0)n.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(e,t);if(m!==null){n.push(u);const g=r.get(m)||{refs:[],i:0};if(g.refs.length===g.i)l(m,fr(t,m)),d();else{u=g.refs[g.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),h.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new vs;return ah(f,a,new Map),de(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},KR=(e,t)=>ah(e,t.doc.store,t.beforeState),YR=(e,t,r,n=new fo(e))=>Ee(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=HR(n,o),l=GR(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<fr(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=qc([u.update,l.update])}}else a.pendingStructs=l;const h=lg(n,i,a);if(a.pendingDs){const d=new fo(so(a.pendingDs));ie(d.restDecoder);const f=lg(d,i,a);h&&f?a.pendingDs=qc([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,dg(i.doc,d)}},r,!1),dg=(e,t,r,n=fo)=>{const i=so(t);YR(i,e,r,new n(i))},pg=(e,t,r)=>dg(e,t,r,hg),qR=(e,t,r=new Map)=>{ah(e,t.store,r),lo(e,BR(t.store))},VR=(e,t=new Uint8Array([0]),r=new vs)=>{const n=mg(t);qR(r,e,n);const i=[r.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(aO(e.store.pendingStructs.update,t)),i.length>1){if(r.constructor===pa)return sO(i.map((s,o)=>o===0?s:lO(s)));if(r.constructor===vs)return qc(i)}return i[0]},XR=(e,t)=>VR(e,t,new pa),JR=e=>{const t=new Map,r=ie(e.restDecoder);for(let n=0;n<r;n++){const i=ie(e.restDecoder),s=ie(e.restDecoder);t.set(i,s)}return t},mg=e=>JR(new fg(so(e)));class ZR{constructor(){this.l=[]}}const gg=()=>new ZR,yg=(e,t)=>e.l.push(t),_g=(e,t)=>{const r=e.l,n=r.length;e.l=r.filter(i=>t!==i),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},bg=(e,t,r)=>th(e.l,[t,r]);class ho{constructor(t,r){this.client=t,this.clock=r}}const Kc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,ae=(e,t)=>new ho(e,t),QR=e=>{for(const[t,r]of e.doc.share.entries())if(r===e)return t;throw Zn()},po=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!cg(t.ds,e.id),ch=(e,t)=>{const r=ji(e.meta,ch,no),n=e.doc.store;r.has(t)||(t.sv.forEach((i,s)=>{i<fr(n,s)&&Hi(e,ae(s,i))}),ag(e,t.ds,i=>{}),r.add(t))};class wg{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const lh=e=>{const t=new Map;return e.clients.forEach((r,n)=>{const i=r[r.length-1];t.set(n,i.id.clock+i.length)}),t},fr=(e,t)=>{const r=e.clients.get(t);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},vg=(e,t)=>{let r=e.clients.get(t.id.client);if(r===void 0)r=[],e.clients.set(t.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==t.id.clock)throw Zn()}r.push(t)},ei=(e,t)=>{let r=0,n=e.length-1,i=e[n],s=i.id.clock;if(s===t)return n;let o=zi(t/(s+i.length-1)*n);for(;r<=n;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;r=o+1}else n=o-1;o=zi((r+n)/2)}throw Zn()},uh=(e,t)=>{const r=e.clients.get(t.client);return r[ei(r,t.clock)]},fh=(e,t,r)=>{const n=ei(t,r),i=t[n];return i.id.clock<r&&i instanceof ir?(t.splice(n+1,0,sl(e,i,r-i.id.clock)),n+1):n},Hi=(e,t)=>{const r=e.doc.store.clients.get(t.client);return r[fh(e,r,t.clock)]},Eg=(e,t,r)=>{const n=t.clients.get(r.client),i=ei(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==gn&&n.splice(i+1,0,sl(e,s,r.clock-s.id.clock+1)),s},tO=(e,t,r)=>{const n=e.clients.get(t.id.client);n[ei(n,t.id.clock)]=r},kg=(e,t,r,n,i)=>{if(n===0)return;const s=r+n;let o=fh(e,t,r),a;do a=t[o++],s<a.id.clock+a.length&&fh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class eO{constructor(t,r,n){this.doc=t,this.deleteSet=new da,this.beforeState=lh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const xg=(e,t)=>t.deleteSet.clients.size===0&&!xS(t.afterState,(r,n)=>t.beforeState.get(n)!==r)?!1:(sh(t.deleteSet),KR(e,t),lo(e,t.deleteSet),!0),Ag=(e,t,r)=>{const n=t._item;(n===null||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&ji(e.changed,t,no).add(r)},Yc=(e,t)=>{let r=e[t],n=e[t-1],i=t;for(;i>0;r=n,n=e[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof ir&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},rO=(e,t,r)=>{for(const[n,i]of e.clients.entries()){const s=t.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ei(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof ir&&h.deleted&&!h.keep&&r(h)&&h.gc(t,!1)}}}},nO=(e,t)=>{e.clients.forEach((r,n)=>{const i=t.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=Cm(i.length-1,1+ei(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Yc(i,c)}})},Tg=(e,t)=>{if(t<e.length){const r=e[t],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{sh(s),r.afterState=lh(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),bg(l._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),th(a,[]),r._needFormattingCleanup&&kO(r)}finally{n.gc&&rO(s,i,n.gcFilter),nO(s,i),r.afterState.forEach((u,h)=>{const d=r.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=bs(ei(f,d),1);for(let m=f.length-1;m>=p;)m-=1+Yc(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=ei(f,d);p+1<f.length&&Yc(f,p+1)>1||p>0&&Yc(f,p)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(LR(rh,eg,"[yjs] ",rg,ng,"Changed the client-id because another client seems to be using it."),n.clientID=ug()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const u=new pa;xg(u,r)&&n.emit("update",[u.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const u=new vs;xg(u,r)&&n.emit("updateV2",[u.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=r;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,r]),l.forEach(u=>u.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):Tg(e,t+1)}}},Ee=(e,t,r=null,n=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new eO(e,r,n),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Tg(i,0)}}return o};function*iO(e){const t=ie(e.restDecoder);for(let r=0;r<t;r++){const n=ie(e.restDecoder),i=e.readClient();let s=ie(e.restDecoder);for(let o=0;o<n;o++){const a=e.readInfo();if(a===10){const c=ie(e.restDecoder);yield new yn(ae(i,s),c),s+=c}else if(Fc&a){const c=(a&(vi|sn))===0,l=new ir(ae(i,s),null,(a&sn)===sn?e.readLeftID():null,null,(a&vi)===vi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&oa)===oa?e.readString():null,qg(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new gn(ae(i,s),c),s+=c}}}}class hh{constructor(t,r){this.gen=iO(t),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===yn);return this.curr}}class dh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const sO=e=>qc(e,hg,pa),oO=(e,t)=>{if(e.constructor===gn){const{client:r,clock:n}=e.id;return new gn(ae(r,n+t),e.length-t)}else if(e.constructor===yn){const{client:r,clock:n}=e.id;return new yn(ae(r,n+t),e.length-t)}else{const r=e,{client:n,clock:i}=r.id;return new ir(ae(n,i+t),null,ae(n,i+t-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(t))}},qc=(e,t=fo,r=vs)=>{if(e.length===1)return e[0];const n=e.map(u=>new t(so(u)));let i=n.map(u=>new hh(u,!0)),s=null;const o=new r,a=new dh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===yn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Gi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===yn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Gi(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new yn(ae(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===yn?s.struct.length-=p:d=oO(d,p)),s.struct.mergeWith(d)||(Gi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==yn;d=u.next())Gi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Gi(a,s.struct,s.offset),s=null),ph(a);const c=n.map(u=>oh(u)),l=FR(c);return lo(o,l),o.toUint8Array()},aO=(e,t,r=fo,n=vs)=>{const i=mg(t),s=new n,o=new dh(s),a=new r(so(e)),c=new hh(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===yn){c.next();continue}if(u.id.clock+u.length>d)for(Gi(o,u,bs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Gi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}ph(o);const l=oh(a);return lo(s,l),s.toUint8Array()},Sg=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Xn(e.encoder.restEncoder)}),e.encoder.restEncoder=$c(),e.written=0)},Gi=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&Sg(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),de(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},ph=e=>{Sg(e);const t=e.encoder.restEncoder;de(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){const n=e.clientStructs[r];de(t,n.written),Bc(t,n.restEncoder)}},cO=(e,t,r,n)=>{const i=new r(so(e)),s=new hh(i,!1),o=new n,a=new dh(o);for(let l=s.curr;l!==null;l=s.next())Gi(a,t(l),0);ph(a);const c=oh(i);return lo(o,c),o.toUint8Array()},lO=e=>cO(e,_R,fo,pa),Rg="You must not compute changes after the event-handler fired.";class Vc{constructor(t,r){this.target=t,this.currentTarget=t,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=uO(this.currentTarget,this.target))}deletes(t){return cg(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(Rg);const t=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Df(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Df(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Df(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(Rg);const r=this.target,n=no(),i=no(),s=[];if(t={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=r._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const uO=(e,t)=>{const r=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)r.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}t=t._item.parent}return r},Ar=()=>{MR("Invalid access: Add Yjs type to a document before reading data.")},Og=80;let mh=0;class fO{constructor(t,r){t.marker=!0,this.p=t,this.index=r,this.timestamp=mh++}}const hO=e=>{e.timestamp=mh++},Ig=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=mh++},dO=(e,t,r)=>{if(e.length>=Og){const n=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Ig(n,t,r),n}else{const n=new fO(t,r);return e.push(n),n}},Xc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const r=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Pc(t-s.index)<Pc(t-o.index)?s:o);let n=e._start,i=0;for(r!==null&&(n=r.p,i=r.index,hO(r));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Pc(r.index-i)<n.parent.length/Og?(Ig(r,n,i),r):dO(e._searchMarker,n,i)},ma=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){const i=e[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(n,1);continue}i.p=s,s.marker=!0}(t<i.index||r>0&&t===i.index)&&(i.index=bs(t,i.index+r))}},Jc=(e,t,r)=>{const n=e,i=t.changedParentTypes;for(;ji(i,e,()=>[]).push(r),e._item!==null;)e=e._item.parent;bg(n._eH,r,t)};class vr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=gg(),this._dEH=gg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,r){this.doc=t,this._item=r}_copy(){throw Jn()}clone(){throw Jn()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,r){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){yg(this._eH,t)}observeDeep(t){yg(this._dEH,t)}unobserve(t){_g(this._eH,t)}unobserveDeep(t){_g(this._dEH,t)}toJSON(){}}const Ng=(e,t,r)=>{e.doc??Ar(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t;const i=[];let s=e._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&n>0;a++)i.push(o[a]),n--;t=0}}s=s.right}return i},Cg=e=>{e.doc??Ar();const t=[];let r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}r=r.right}return t},ga=(e,t)=>{let r=0,n=e._start;for(e.doc??Ar();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)t(i[s],r++,e)}n=n.right}},Lg=(e,t)=>{const r=[];return ga(e,(n,i)=>{r.push(t(n,i,e))}),r},pO=e=>{let t=e._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};r=t.content.getContent(),n=0,t=t.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},Mg=(e,t)=>{e.doc??Ar();const r=Xc(e,t);let n=e._start;for(r!==null&&(n=r.p,t-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Zc=(e,t,r,n)=>{let i=r;const s=e.doc,o=s.clientID,a=s.store,c=r===null?t._start:r.right;let l=[];const u=()=>{l.length>0&&(i=new ir(ae(o,fr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new xs(l)),i.integrate(e,0),l=[])};n.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ir(ae(o,fr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ya(new Uint8Array(h))),i.integrate(e,0);break;case uo:i=new ir(ae(o,fr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ba(h)),i.integrate(e,0);break;default:if(h instanceof vr)i=new ir(ae(o,fr(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ai(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Ug=()=>Wi("Length exceeded!"),Pg=(e,t,r,n)=>{if(r>t._length)throw Ug();if(r===0)return t._searchMarker&&ma(t._searchMarker,r,n.length),Zc(e,t,null,n);const i=r,s=Xc(t,r);let o=t._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&Hi(e,ae(o.id.client,o.id.clock+r));break}r-=o.length}return t._searchMarker&&ma(t._searchMarker,i,n.length),Zc(e,t,o,n)},mO=(e,t,r)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Zc(e,t,i,r)},Fg=(e,t,r,n)=>{if(n===0)return;const i=r,s=n,o=Xc(t,r);let a=t._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&Hi(e,ae(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&Hi(e,ae(a.id.client,a.id.clock+n)),a.delete(e),n-=a.length),a=a.right;if(n>0)throw Ug();t._searchMarker&&ma(t._searchMarker,i,-s+n)},Qc=(e,t,r)=>{const n=t._map.get(r);n!==void 0&&n.delete(e)},gh=(e,t,r,n)=>{const i=t._map.get(r)||null,s=e.doc,o=s.clientID;let a;if(n==null)a=new xs([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new xs([n]);break;case Uint8Array:a=new ya(n);break;case uo:a=new ba(n);break;default:if(n instanceof vr)a=new Ai(n);else throw new Error("Unexpected content type")}new ir(ae(o,fr(s.store,o)),i,i&&i.lastId,null,null,t,r,a).integrate(e,0)},yh=(e,t)=>{e.doc??Ar();const r=e._map.get(t);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},$g=e=>{const t={};return e.doc??Ar(),e._map.forEach((r,n)=>{r.deleted||(t[n]=r.content.getContent()[r.length-1])}),t},Bg=(e,t)=>{e.doc??Ar();const r=e._map.get(t);return r!==void 0&&!r.deleted},gO=(e,t)=>{const r={};return e._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&po(s,t)&&(r[i]=s.content.getContent()[s.length-1])}),r},tl=e=>(e.doc??Ar(),UR(e._map.entries(),t=>!t[1].deleted));class yO extends Vc{}class mo extends vr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const r=new mo;return r.push(t),r}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mo}clone(){const t=new mo;return t.insert(0,this.toArray().map(r=>r instanceof vr?r.clone():r)),t}get length(){return this.doc??Ar(),this._length}_callObserver(t,r){super._callObserver(t,r),Jc(this,t,new yO(this,t))}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Pg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}push(t){this.doc!==null?Ee(this.doc,r=>{mO(r,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Fg(n,this,t,r)}):this._prelimContent.splice(t,r)}get(t){return Mg(this,t)}toArray(){return Cg(this)}slice(t=0,r=this.length){return Ng(this,t,r)}toJSON(){return this.map(t=>t instanceof vr?t.toJSON():t)}map(t){return Lg(this,t)}forEach(t){ga(this,t)}[Symbol.iterator](){return pO(this)}_write(t){t.writeTypeRef(zO)}}const _O=e=>new mo;class bO extends Vc{constructor(t,r,n){super(t,r),this.keysChanged=n}}class go extends vr{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,r){super._integrate(t,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new go}clone(){const t=new go;return this.forEach((r,n)=>{t.set(n,r instanceof vr?r.clone():r)}),t}_callObserver(t,r){Jc(this,t,new bO(this,t,r))}toJSON(){this.doc??Ar();const t={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];t[n]=i instanceof vr?i.toJSON():i}}),t}get size(){return[...tl(this)].length}keys(){return nh(tl(this),t=>t[0])}values(){return nh(tl(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return nh(tl(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Ar(),this._map.forEach((r,n)=>{r.deleted||t(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._prelimContent.delete(t)}set(t,r){return this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._prelimContent.set(t,r),r}get(t){return yh(this,t)}has(t){return Bg(this,t)}clear(){this.doc!==null?Ee(this.doc,t=>{this.forEach(function(r,n,i){Qc(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(WO)}}const wO=e=>new go,Ki=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&gR(e,t);class _h{constructor(t,r,n,i){this.left=t,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Zn(),this.right.content.constructor){case nr:this.right.deleted||yo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Dg=(e,t,r)=>{for(;t.right!==null&&r>0;){switch(t.right.content.constructor){case nr:t.right.deleted||yo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(r<t.right.length&&Hi(e,ae(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},el=(e,t,r,n)=>{const i=new Map,s=n?Xc(t,r):null;if(s){const o=new _h(s.p.left,s.p,s.index,i);return Dg(e,o,r-s.index)}else{const o=new _h(null,t._start,0,i);return Dg(e,o,r)}},jg=(e,t,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===nr&&Ki(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=e.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,l=r.right,u=new ir(ae(s,fr(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new nr(a,o));u.integrate(e,0),r.right=u,r.forward()})},yo=(e,t)=>{const{key:r,value:n}=t;n===null?e.delete(r):e.set(r,n)},zg=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===nr&&Ki(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Wg=(e,t,r,n)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],l=r.currentAttributes.get(a)??null;if(!Ki(l,c)){o.set(a,l);const{left:u,right:h}=r;r.right=new ir(ae(s,fr(i.store,s)),u,u&&u.lastId,h,h&&h.id,t,null,new nr(a,c)),r.right.integrate(e,0),r.forward()}}return o},bh=(e,t,r,n,i)=>{r.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=e.doc,o=s.clientID;zg(r,i);const a=Wg(e,t,r,i),c=n.constructor===String?new ri(n):n instanceof vr?new Ai(n):new ks(n);let{left:l,right:u,index:h}=r;t._searchMarker&&ma(t._searchMarker,r.index,c.getLength()),u=new ir(ae(o,fr(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),r.right=u,r.index=h,r.forward(),jg(e,t,r,a)},Hg=(e,t,r,n,i)=>{const s=e.doc,o=s.clientID;zg(r,i);const a=Wg(e,t,r,i);t:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===nr));){if(!r.right.deleted)switch(r.right.content.constructor){case nr:{const{key:c,value:l}=r.right.content,u=i[c];if(u!==void 0){if(Ki(u,l))a.delete(c);else{if(n===0)break t;a.set(c,l)}r.right.delete(e)}else r.currentAttributes.set(c,l);break}default:n<r.right.length&&Hi(e,ae(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new ir(ae(o,fr(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new ri(c)),r.right.integrate(e,0),r.forward()}jg(e,t,r,a)},Gg=(e,t,r,n,i)=>{let s=t;const o=Mn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===nr){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(r===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case nr:{const{key:u,value:h}=l,d=n.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&yo(i,l);break}}}t=t.right}return a},vO=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const r=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===nr){const n=t.content.key;r.has(n)?t.delete(e):r.add(n)}t=t.left}},EO=e=>{let t=0;return Ee(e.doc,r=>{let n=e._start,i=e._start,s=Mn();const o=Bf(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case nr:yo(o,i.content);break;default:t+=Gg(r,n,i,s,o),s=Bf(o),n=i;break}i=i.right}}),t},kO=e=>{const t=new Set,r=e.doc;for(const[n,i]of e.afterState.entries()){const s=e.beforeState.get(n)||0;i!==s&&kg(e,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===nr&&o.constructor!==gn&&t.add(o.parent)})}Ee(r,n=>{ag(e,e.deleteSet,i=>{if(i instanceof gn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===nr?t.add(s):vO(n,i)});for(const i of t)EO(i)})},Kg=(e,t,r)=>{const n=r,i=Bf(t.currentAttributes),s=t.right;for(;r>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ai:case ks:case ri:r<t.right.length&&Hi(e,ae(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e);break}t.forward()}s&&Gg(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ma(o._searchMarker,t.index,-n+r),t};class xO extends Vc{constructor(t,r,n){super(t,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,r=[];Ee(t,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},dR(c)||(f.attributes=uR({},c))),u=0;break}f&&r.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case Ai:case ks:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ri:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case nr:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Ki(m,p)?p!==null&&o.delete(n):(a==="retain"&&d(),Ki(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Ki(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Ki(m,p)?m!==null&&o.delete(n):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),yo(i,o.content));break}}o=o.right}for(d();r.length>0;){const f=r[r.length-1];if(f.retain!==void 0&&f.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class xi extends vr{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ar(),this._length}_integrate(t,r){super._integrate(t,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new xi}clone(){const t=new xi;return t.applyDelta(this.toDelta()),t}_callObserver(t,r){super._callObserver(t,r);const n=new xO(this,t,r);Jc(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Ar();let t="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===ri&&(t+=r.content.str),r=r.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:r=!0}={}){this.doc!==null?Ee(this.doc,n=>{const i=new _h(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&bh(n,this,i,a,o.attributes||{})}else o.retain!==void 0?Hg(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Kg(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,r,n){this.doc??Ar();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(po(c,t)||r!==void 0&&po(c,r))switch(c.content.constructor){case ri:{const h=s.get("ychange");t!==void 0&&!po(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!po(c,r)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Ai:case ks:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case nr:po(c,t)&&(l(),yo(s,c.content));break}c=c.right}l()};return t||r?Ee(o,h=>{t&&ch(h,t),r&&ch(h,r),u()},"cleanup"):u(),i}insert(t,r,n){if(r.length<=0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),bh(s,this,o,r,n)}):this._pending.push(()=>this.insert(t,r,n))}insertEmbed(t,r,n){const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!n);bh(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(t,r,n||{}))}delete(t,r){if(r===0)return;const n=this.doc;n!==null?Ee(n,i=>{Kg(i,el(i,this,t,!0),r)}):this._pending.push(()=>this.delete(t,r))}format(t,r,n){if(r===0)return;const i=this.doc;i!==null?Ee(i,s=>{const o=el(s,this,t,!1);o.right!==null&&Hg(s,this,o,r,n)}):this._pending.push(()=>this.format(t,r,n))}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._pending.push(()=>this.setAttribute(t,r))}getAttribute(t){return yh(this,t)}getAttributes(){return $g(this)}_write(t){t.writeTypeRef(HO)}}const AO=e=>new xi;class wh{constructor(t,r=()=>!0){this._filter=r,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Ar()}[Symbol.iterator](){return this}next(){let t=this._currentNode,r=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(r)))do if(r=t.content.type,!t.deleted&&(r.constructor===_o||r.constructor===Es)&&r._start!==null)t=r._start;else for(;t!==null;){const n=t.next;if(n!==null){t=n;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Es extends vr{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,r){super._integrate(t,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Es}clone(){const t=new Es;return t.insert(0,this.toArray().map(r=>r instanceof vr?r.clone():r)),t}get length(){return this.doc??Ar(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new wh(this,t)}querySelector(t){t=t.toUpperCase();const n=new wh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),_s(new wh(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t))}_callObserver(t,r){Jc(this,t,new RO(this,r,t))}toString(){return Lg(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,r={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),ga(this,s=>{i.insertBefore(s.toDOM(t,r,n),null)}),i}insert(t,r){this.doc!==null?Ee(this.doc,n=>{Pg(n,this,t,r)}):this._prelimContent.splice(t,0,...r)}insertAfter(t,r){if(this.doc!==null)Ee(this.doc,n=>{const i=t&&t instanceof vr?t._item:t;Zc(n,this,i,r)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Wi("Reference item not found");n.splice(i,0,...r)}}delete(t,r=1){this.doc!==null?Ee(this.doc,n=>{Fg(n,this,t,r)}):this._prelimContent.splice(t,r)}toArray(){return Cg(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Mg(this,t)}slice(t=0,r=this.length){return Ng(this,t,r)}forEach(t){ga(this,t)}_write(t){t.writeTypeRef(KO)}}const TO=e=>new Es;class _o extends Es{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,r){super._integrate(t,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new _o(this.nodeName)}clone(){const t=new _o(this.nodeName),r=this.getAttributes();return hR(r,(n,i)=>{typeof n=="string"&&t.setAttribute(i,n)}),t.insert(0,this.toArray().map(n=>n instanceof vr?n.clone():n)),t}toString(){const t=this.getAttributes(),r=[],n=[];for(const a in t)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?Ee(this.doc,r=>{Qc(r,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,r){this.doc!==null?Ee(this.doc,n=>{gh(n,this,t,r)}):this._prelimAttrs.set(t,r)}getAttribute(t){return yh(this,t)}hasAttribute(t){return Bg(this,t)}getAttributes(t){return t?gO(this,t):$g(this)}toDOM(t=document,r={},n){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ga(this,o=>{i.appendChild(o.toDOM(t,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(GO),t.writeKey(this.nodeName)}}const SO=e=>new _o(e.readKey());class RO extends Vc{constructor(t,r,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class rl extends go{constructor(t){super(),this.hookName=t}_copy(){return new rl(this.hookName)}clone(){const t=new rl(this.hookName);return this.forEach((r,n)=>{t.set(n,r)}),t}toDOM(t=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(t){t.writeTypeRef(YO),t.writeKey(this.hookName)}}const OO=e=>new rl(e.readKey());class nl extends xi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new nl}clone(){const t=new nl;return t.applyDelta(this.toDelta()),t}toDOM(t=document,r,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const r=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=t.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(qO)}}const IO=e=>new nl;class vh{constructor(t,r){this.id=t,this.length=r}get deleted(){throw Jn()}mergeWith(t){return!1}write(t,r,n){throw Jn()}integrate(t,r){throw Jn()}}const NO=0;class gn extends vh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){r>0&&(this.id.clock+=r,this.length-=r),vg(t.doc.store,this)}write(t,r){t.writeInfo(NO),t.writeLen(this.length-r)}getMissing(t,r){return null}}class ya{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ya(this.content)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeBuf(this.content)}getRef(){return 3}}const CO=e=>new ya(e.readBuf());class _a{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new _a(this.len)}splice(t){const r=new _a(this.len-t);return this.len=t,r}mergeWith(t){return this.len+=t.len,!0}integrate(t,r){Gc(t.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(t){}gc(t){}write(t,r){t.writeLen(this.len-r)}getRef(){return 1}}const LO=e=>new _a(e.readLen()),Yg=(e,t)=>new uo({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class ba{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const r={};this.opts=r,t.gc||(r.gc=!1),t.autoLoad&&(r.autoLoad=!0),t.meta!==null&&(r.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ba(Yg(this.doc.guid,this.opts))}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){this.doc._item=r,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,r){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const MO=e=>new ba(Yg(e.readString(),e.readAny()));class ks{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ks(this.embed)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeJSON(this.embed)}getRef(){return 5}}const UO=e=>new ks(e.readJSON());class nr{constructor(t,r){this.key=t,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new nr(this.key,this.value)}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,r){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const PO=e=>new nr(e.readKey(),e.readJSON());class il{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new il(this.arr)}splice(t){const r=new il(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const FO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++){const i=e.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new il(r)},$O=Hc("node_env")==="development";class xs{constructor(t){this.arr=t,$O&&Zm(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xs(this.arr)}splice(t){const r=new xs(this.arr.slice(t));return this.arr=this.arr.slice(0,t),r}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){const n=this.arr.length;t.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const BO=e=>{const t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new xs(r)};class ri{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ri(this.str)}splice(t){const r=new ri(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",r.str="ï¿½"+r.str.slice(1)),r}mergeWith(t){return this.str+=t.str,!0}integrate(t,r){}delete(t){}gc(t){}write(t,r){t.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const DO=e=>new ri(e.readString()),jO=[_O,wO,AO,SO,TO,OO,IO],zO=0,WO=1,HO=2,GO=3,KO=4,YO=5,qO=6;class Ai{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ai(this.type._copy())}splice(t){throw Jn()}mergeWith(t){return!1}integrate(t,r){this.type._integrate(t.doc,r)}delete(t){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let r=this.type._start;for(;r!==null;)r.gc(t,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,r){this.type._write(t)}getRef(){return 7}}const VO=e=>new Ai(jO[e.readTypeRef()](e)),sl=(e,t,r)=>{const{client:n,clock:i}=t.id,s=new ir(ae(n,i+r),t,ae(n,i+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=ae(t.redone.client,t.redone.clock+r)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=r,s};class ir extends vh{constructor(t,r,n,i,s,o,a,c){super(t,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Um:0}set marker(t){(this.info&zf)>0!==t&&(this.info^=zf)}get marker(){return(this.info&zf)>0}get keep(){return(this.info&Mm)>0}set keep(t){this.keep!==t&&(this.info^=Mm)}get countable(){return(this.info&Um)>0}get deleted(){return(this.info&jf)>0}set deleted(t){this.deleted!==t&&(this.info^=jf)}markDeleted(){this.info|=jf}getMissing(t,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=fr(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=fr(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ho&&this.id.client!==this.parent.client&&this.parent.clock>=fr(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Eg(t,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Hi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===gn||this.right&&this.right.constructor===gn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ir?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ir&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ho){const n=uh(r,this.parent);n.constructor===gn?this.parent=null:this.parent=n.content.type}return null}integrate(t,r){if(r>0&&(this.id.clock+=r,this.left=Eg(t,t.doc.store,ae(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Kc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(Kc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(uh(t.doc.store,i.origin)))s.has(uh(t.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vg(t.doc.store,this),this.content.integrate(t,this),Ag(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new gn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:ae(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Kc(t.origin,this.lastId)&&this.right===t&&Kc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Gc(t.deleteSet,this.id.client,this.id.clock,this.length),Ag(t,r,this.parentSub),this.content.delete(t)}}gc(t,r){if(!this.deleted)throw Zn();this.content.gc(t),r?tO(t,this,new gn(this.id,this.length)):this.content=new _a(this.length)}write(t,r){const n=r>0?ae(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Fc|(n===null?0:sn)|(i===null?0:vi)|(s===null?0:oa);if(t.writeInfo(o),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=QR(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===ho?(t.writeParentInfo(!1),t.writeLeftID(a)):Zn();s!==null&&t.writeString(s)}this.content.write(t,r)}}const qg=(e,t)=>XO[t&Fc](e),XO=[()=>{Zn()},LO,FO,CO,DO,UO,PO,VO,BO,MO,()=>{Zn()}],JO=10;class yn extends vh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,r){Zn()}write(t,r){t.writeInfo(JO),de(t.restEncoder,this.length-r)}getMissing(t,r){return null}}const Vg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ro<"u"?ro:{},Xg="__ $YJS$ __";Vg[Xg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Vg[Xg]=!0;let Jg=!1;const cn=new uo;function Zg(e,t,r){const n=cn.getMap();if(!n.has(e))switch(t){case 0:case 1:n.set(e,r);break}}function ZO(e,t){Zg(e,0,t)}function Eh(e,t){const r=new xi(t);Zg(e,1,r)}function QO(e,t){cn.getMap().set(e,t)}function tI(e,t){const r=cn.getMap(),n=new xi(t);r.set(e,n)}function Qg(e,t){const r=cn.getMap();function n(i){const s=r.get(e);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&t(s)}return r.has(e)&&t(r.get(e)),r.observeDeep(n),()=>{r.observeDeep(n)}}function eI(e,t){return Qg(e,r=>{Et(r)&&t(r)})}function ty(e,t){return Qg(e,r=>{r instanceof xi&&t(r.toJSON())})}const As=Zs("modem",["second"],e=>{if(As.session(e))switch(e.target){case"second":!Jg&&e.data%2===0&&As.emit(e.player,"modem:join");break;case"join":e.sender!==As.id()&&As.reply(e,"joinack",Rm(XR(cn)));break;case"joinack":e.sender!==As.id()&&(Jg=!0,pg(cn,Mc(e.data),cn));break;case"sync":{e.sender!==As.id()&&w(e.data)&&pg(cn,Mc(e.data),cn);break}}});function ey(e,t){t!==cn&&As.emit("","modem:sync",Rm(e))}cn.on("update",ey),cn.on("destroy",()=>{cn.off("update",ey)});function ry(e,t){return e%t}function ny(e,t){return Math.floor(e/t)}function rI(e,t){return{x:ry(e,t),y:ny(e,t)}}function Wr(e,t){return e.x+e.y*t}function bo(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function kh(e,t,r,n,i,s){return e>=s&&e<=n&&t>=r&&t<=i}function iy(e,t,r,n){const i=[],s=Math.min(e,r),o=Math.max(e,r),a=Math.min(t,n),c=Math.max(t,n);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function sy(e,t,r,n){const i=[],s=Math.abs(r-e),o=Math.abs(n-t),a=e<r?1:-1,c=t<n?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==r||t!==n;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const oy="176",nI="",Un="srgb",ay="srgb-linear",cy="linear",xh="srgb";function Pn(e,t,r){return Math.max(t,Math.min(r,e))}function iI(e,t){return(e%t+t)%t}function Ah(e,t,r){return(1-r)*e+r*t}class wa{constructor(t=0,r=0){wa.prototype.isVector2=!0,this.x=t,this.y=r}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,r){return this.x=t,this.y=r,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this}addScaledVector(t,r){return this.x+=t.x*r,this.y+=t.y*r,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const r=this.x,n=this.y,i=t.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,r){return this.x=Pn(this.x,t.x,r.x),this.y=Pn(this.y,t.y,r.y),this}clampScalar(t,r){return this.x=Pn(this.x,t,r),this.y=Pn(this.y,t,r),this}clampLength(t,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Pn(n,t,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const r=Math.sqrt(this.lengthSq()*t.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(t)/r;return Math.acos(Pn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this}lerpVectors(t,r,n){return this.x=t.x+(r.x-t.x)*n,this.y=t.y+(r.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,r=0){return this.x=t[r],this.y=t[r+1],this}toArray(t=[],r=0){return t[r]=this.x,t[r+1]=this.y,t}fromBufferAttribute(t,r){return this.x=t.getX(r),this.y=t.getY(r),this}rotateAround(t,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class va{constructor(t,r,n,i,s,o,a,c,l){va.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,r,n,i,s,o,a,c,l)}set(t,r,n,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=r,u[4]=s,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const r=this.elements,n=t.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(t,r,n){return t.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const r=t.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,r){const n=t.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],h=n[7],d=n[2],f=n[5],p=n[8],m=i[0],g=i[3],y=i[6],b=i[1],A=i[4],T=i[7],k=i[2],I=i[5],R=i[8];return s[0]=o*m+a*b+c*k,s[3]=o*g+a*A+c*I,s[6]=o*y+a*T+c*R,s[1]=l*m+u*b+h*k,s[4]=l*g+u*A+h*I,s[7]=l*y+u*T+h*R,s[2]=d*m+f*b+p*k,s[5]=d*g+f*A+p*I,s[8]=d*y+f*T+p*R,this}multiplyScalar(t){const r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=t,r[4]*=t,r[7]*=t,r[2]*=t,r[5]*=t,r[8]*=t,this}determinant(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return r*o*u-r*a*l-n*s*u+n*a*c+i*s*l-i*o*c}invert(){const t=this.elements,r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=r*h+n*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(i*l-u*n)*m,t[2]=(a*n-i*o)*m,t[3]=d*m,t[4]=(u*r-i*c)*m,t[5]=(i*s-a*r)*m,t[6]=f*m,t[7]=(n*c-l*r)*m,t[8]=(o*r-n*s)*m,this}transpose(){let t;const r=this.elements;return t=r[1],r[1]=r[3],r[3]=t,t=r[2],r[2]=r[6],r[6]=t,t=r[5],r[5]=r[7],r[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const r=this.elements;return t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8],this}setUvTransform(t,r,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+r,0,0,1),this}scale(t,r){return this.premultiply(Th.makeScale(t,r)),this}rotate(t){return this.premultiply(Th.makeRotation(-t)),this}translate(t,r){return this.premultiply(Th.makeTranslation(t,r)),this}makeTranslation(t,r){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,r,0,0,1),this}makeRotation(t){const r=Math.cos(t),n=Math.sin(t);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(t,r){return this.set(t,0,0,0,r,0,0,0,1),this}equals(t){const r=this.elements,n=t.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(t,r=0){for(let n=0;n<9;n++)this.elements[n]=t[n+r];return this}toArray(t=[],r=0){const n=this.elements;return t[r]=n[0],t[r+1]=n[1],t[r+2]=n[2],t[r+3]=n[3],t[r+4]=n[4],t[r+5]=n[5],t[r+6]=n[6],t[r+7]=n[7],t[r+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Th=new va,ly=new va().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),uy=new va().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function sI(){const e={enabled:!0,workingColorSpace:ay,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===xh&&(i.r=wo(i.r),i.g=wo(i.g),i.b=wo(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===xh&&(i.r=vo(i.r),i.g=vo(i.g),i.b=vo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===nI?cy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return e.define({[ay]:{primaries:t,whitePoint:n,transfer:cy,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Un},outputColorSpaceConfig:{drawingBufferColorSpace:Un}},[Un]:{primaries:t,whitePoint:n,transfer:xh,toXYZ:ly,fromXYZ:uy,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Un}}}),e}const Fn=sI();function wo(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function vo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const fy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yi={h:0,s:0,l:0},ol={h:0,s:0,l:0};function Sh(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*6*(2/3-r):e}class Rh{constructor(t,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,r,n)}set(t,r,n){if(r===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,r,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=Un){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Fn.toWorkingColorSpace(this,r),this}setRGB(t,r,n,i=Fn.workingColorSpace){return this.r=t,this.g=r,this.b=n,Fn.toWorkingColorSpace(this,i),this}setHSL(t,r,n,i=Fn.workingColorSpace){if(t=iI(t,1),r=Pn(r,0,1),n=Pn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=Sh(o,s,t+1/3),this.g=Sh(o,s,t),this.b=Sh(o,s,t-1/3)}return Fn.toWorkingColorSpace(this,i),this}setStyle(t,r=Un){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,r);return this}setColorName(t,r=Un){const n=fy[t.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=wo(t.r),this.g=wo(t.g),this.b=wo(t.b),this}copyLinearToSRGB(t){return this.r=vo(t.r),this.g=vo(t.g),this.b=vo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Un){return Fn.fromWorkingColorSpace(Tr.copy(this),t),Math.round(Pn(Tr.r*255,0,255))*65536+Math.round(Pn(Tr.g*255,0,255))*256+Math.round(Pn(Tr.b*255,0,255))}getHexString(t=Un){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=Fn.workingColorSpace){Fn.fromWorkingColorSpace(Tr.copy(this),r);const n=Tr.r,i=Tr.g,s=Tr.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case n:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-n)/h+2;break;case s:c=(n-i)/h+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,r=Fn.workingColorSpace){return Fn.fromWorkingColorSpace(Tr.copy(this),r),t.r=Tr.r,t.g=Tr.g,t.b=Tr.b,t}getStyle(t=Un){Fn.fromWorkingColorSpace(Tr.copy(this),t);const r=Tr.r,n=Tr.g,i=Tr.b;return t!==Un?`color(${t} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,r,n){return this.getHSL(Yi),this.setHSL(Yi.h+t,Yi.s+r,Yi.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,n){return this.r=t.r+(r.r-t.r)*n,this.g=t.g+(r.g-t.g)*n,this.b=t.b+(r.b-t.b)*n,this}lerpHSL(t,r){this.getHSL(Yi),t.getHSL(ol);const n=Ah(Yi.h,ol.h,r),i=Ah(Yi.s,ol.s,r),s=Ah(Yi.l,ol.l,r);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const r=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Tr=new Rh;Rh.NAMES=fy,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:oy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=oy),new wa,new wa;function Ge(e,t,r){return Math.max(t,Math.min(r,e))}function hy(e){return e/180*Math.PI}function dy(e){return e*180/Math.PI}const oI=W0("089fad0j9awfem09wavefc09uwaef");function aI(){return oI()}function cI(e){return W0(e)()}function _n(e,t){const r=Math.min(e,t),i=Math.max(e,t)-r+1;return r+Math.floor(aI()*i)}function py(e,t,r){const n=Math.min(t,r),s=Math.max(t,r)-n+1;return n+Math.floor(cI(e)*s)}function my(e,t,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=r)n.push(o);return n}function lI(e){return e[_n(0,e.length-1)]}function uI(e,t){return t[py(e,0,t.length-1)]}function bn(...e){return lI(e.flat())}function fI(e,...t){return uI(e,t.flat())}function hI(e){return[...new Set(e)].filter(w)}function Ea(e){return w(e)&&w(e.x)&&w(e.y)}function De(e,t){switch(t){case bt.NORTH:--e.y;break;case bt.SOUTH:++e.y;break;case bt.WEST:--e.x;break;case bt.EAST:++e.x;break}return e}function Oh(e,t){return e<0?bt.WEST:e>0?bt.EAST:t<0?bt.NORTH:t>0?bt.SOUTH:bt.IDLE}function $n(e,t){return Oh(t.x-e.x,t.y-e.y)}const Ih={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Hr(e){return pe(e)&&gy(e[0])}function gy(e){return w(bt[e])&&yt(e)}function yy(e){const t=bt[e];return w(t)?t:bt.IDLE}function al(e){if(yt(e))return Ih[Dt(e)]}function dI(e){if(Hr(e))return e;if(gy(e))return[e];const t=al(e);if(w(t))return[t]}function _y(e){const t=x.words[e],r=dI(t);return Hr(r)?[r,e+1]:[void 0,e]}function by(e){var i,s;const t=[];let[r,n]=_y(e);for(;Hr(r);){switch(t.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=ut(x.words,n,[V.NUMBER,V.NUMBER]);t.push(c,l),n=u;break}case"FLEE":case"FIND":{const[c,l]=ut(x.words,n,[V.KIND]);console.info("kind",c),n=l;break}case"TO":{const[c,l,u]=ut(x.words,n,[V.DIR,V.DIR]),h=((i=x.element)==null?void 0:i.x)??0,d=((s=x.element)==null?void 0:s.y)??0;c.destpt.x-=h,c.destpt.y-=d,l.destpt.x-=h,l.destpt.y-=d,t.push(h+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),n=u;break}}switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,n]}const[o,a]=_y(n);r=o,n=a}return t.length?[t,n]:[void 0,e]}function pI(e){return w(e)&&e<zt.ONBLACK?e:void 0}function Nh(e){return w(e)&&e>zt.WHITE&&e<zt.ONCLEAR?e-zt.ONBLACK:void 0}const ka={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Cr(e){return pe(e)&&wy(e[0])}function mI(e){return Cr(e)&&e[0].startsWith("ON")}function wy(e){return w(zt[e])&&yt(e)}function xa(e){if(yt(e))return ka[Dt(e)]}function Aa(e,t){return[w(e)?`${zt[e]}`:void 0,w(t)?`ON${zt[t]}`:void 0].filter(w)}function cl(e){return e.map(t=>zt[t]).find(t=>w(t)&&t<zt.ONBLACK)}function ll(e){return e.map(t=>zt[t]).find(t=>w(t)&&t>=zt.ONBLACK)}function gI(e){if(Cr(e))return e;if(wy(e))return[e];const t=xa(e);if(w(t))return[t]}function vy(e){const t=x.words[e],r=gI(t);return Cr(r)?[r,e+1]:[void 0,e]}function ul(e){const t=[];let r=e;const n=parseFloat(x.words[e]);if(Et(n))return[Aa(n,void 0),e+1];const[i,s]=vy(e);Cr(i)&&(t.push(...i),r=s);const[o,a]=vy(s);return mI(o)&&(t.push(...o),r=a),t.length?[t,r]:[void 0,e]}function Ey(e){const t={};for(let r=0;r<e.length;++r){const n=e[r],i=zt[n];w(i)&&(i<zt.ONBLACK?t.color=i:t.bg=Nh(i))}return t}var ky={exports:{}},Ch={exports:{}},xy;function yI(){return xy||(xy=1,function(e,t){(function(r,n){e.exports=n()})(er,function(){function r(m){return!isNaN(parseFloat(m))&&isFinite(m)}function n(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var g=0;g<u.length;g++)m[u[g]]!==void 0&&this["set"+n(u[g])](m[u[g]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+m+":"+g+":"+y+")":m+":"+g+":"+y}},h.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),A=g.substring(0,y),T=g.substring(y+1,b).split(","),k=g.substring(b+1);if(k.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(k,""),R=I[1],$=I[2],M=I[3];return new h({functionName:A,args:T||void 0,fileName:R,lineNumber:$||void 0,columnNumber:M||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+n(s[d])]=i(s[d]),h.prototype["set"+n(s[d])]=function(m){return function(g){this[m]=!!g}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+n(o[f])]=i(o[f]),h.prototype["set"+n(o[f])]=function(m){return function(g){if(!r(g))throw new TypeError(m+" must be a Number");this[m]=Number(g)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+n(a[p])]=i(a[p]),h.prototype["set"+n(a[p])]=function(m){return function(g){this[m]=String(g)}}(a[p]);return h})}(Ch)),Ch.exports}(function(e,t){(function(r,n){e.exports=n(yI())})(er,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new n({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new n({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new n({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new n({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new n({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new n({functionName:p,args:g,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(ky);var _I=ky.exports,bI=ps(_I);const Ct=60,te=25,Lh=Ct*te;var vt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(vt||{});const Mh=14,fl=3,Ts=8,Ss=14,hl=16,wI=16,vI=16;var dl=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(dl||{});function Ta(e,t){return new Array(e).fill(t)}function EI(e,t,r,n,i,s=0){const o=n*i;return{id:`tiles:${e}:${t}`,type:1,tag:r,width:n,height:i,char:Ta(o,0),color:Ta(o,0),bg:Ta(o,s),wall:Ta(o,0)}}function kI(e,t,r,n=1,i=15){return{id:`sprites:${e}:${t}:${r}`,x:0,y:0,char:n,color:i,bg:zt.ONCLEAR}}function xI(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function AI(e,t,r,n,i=0){const s=r*n;return{id:`dither:${e}:${t}`,type:3,width:r,height:n,alphas:Ta(s,i)}}function TI(e,t,r,n){return{id:`media:${e}:${t}`,type:4,mime:r,media:n}}function SI(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Ay(e,t){return`${e}:${t}`}const RI=1,OI=16,II=256;var Lr=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Lr||{});const ni=!!JSON.parse("false"),NI=!!JSON.parse("false");JSON.parse("false");const Ty=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const Rs={HALT_AT_COUNT:256},lt=Zs("SOFTWARE");function Ti(e){const t={},r={tick(){},everytick(){},listcommands(){return jr(t)},...e,getcommand(n){return t[n]},command(n,i){return t[n]=i,r}};return r}function Ie(e){return`${e??""}`}function Sa(e,t){const r=parseFloat(Ie(e));return isNaN(r)?t:r}function Gr(e,t,r,n){const[i,s]=ut(n,0,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);nm(lt,e,t,r,i,s)}const CI=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Sy(e,t,r){const[n,i]=ut(r,0,[V.NUMBER_OR_STRING]);if(Et(n))xf(lt,e,t,"volume",n);else if(CI.includes(Dt(n))){const[s,o]=ut(r,i,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);nm(lt,e,t,n,s,o)}else{const[s]=ut(r,i,[V.MAYBE_NUMBER_OR_STRING]);if(Et(s)){const o=r.length-i,a=new Array(o).fill(V.NUMBER),c=ut(r,i,a).slice(0,o),l=c.length===1?c[0]:c;xf(lt,e,t,n,l)}else{const[o]=ut(r,i,[V.MAYBE_NUMBER_OR_STRING]);xf(lt,e,t,n,o)}}}let Ry="en-US-GuyNeural";function qi(e,t){var n;const[r]=ut(e,0,[V.MAYBE_NAME]);PT(lt,x.elementfocus,((n=x.board)==null?void 0:n.id)??"",r??"",t)}const Uh=Ti().command("talk",(e,t)=>{const[r]=ut(t,0,[V.ANY]);switch(Dt(r)){default:mT(lt,x.elementfocus);break;case"stop":gT(lt,x.elementfocus);break}return 0}).command("media",(e,t)=>{const[r]=ut(t,0,[V.ANY]);switch(Dt(r)){default:yT(lt,x.elementfocus);break;case"stop":_T(lt,x.elementfocus);break}return 0}).command("tts",(e,t)=>{const r=t.map(Ie).join("");return MT(lt,x.elementfocus,Ry,r),0}).command("ttsvoice",(e,t)=>(Ry=t.map(Ie).join(""),0)).command("bpm",(e,t)=>{const[r]=ut(t,0,[V.NUMBER]);return FT(lt,x.elementfocus,r),0}).command("vol",(e,t)=>{const[r]=ut(t,0,[V.NUMBER]);return $T(lt,x.elementfocus,r),0}).command("bgvol",(e,t)=>{const[r]=ut(t,0,[V.NUMBER]);return BT(lt,x.elementfocus,r),0}).command("ttsvol",(e,t)=>{const[r]=ut(t,0,[V.NUMBER]);return DT(lt,x.elementfocus,r),0}).command("play",(e,t)=>{var n;const[r]=ut(t,0,[V.MAYBE_NAME]);return UT(lt,x.elementfocus,((n=x.board)==null?void 0:n.id)??"",r??""),0}).command("bgplay",(e,t)=>(qi(t,""),0)).command("bgplayon64n",(e,t)=>(qi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(qi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(qi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(qi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(qi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(qi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(qi(t,"@1m"),0)).command("synth",(e,t)=>{for(let r=0;r<8;++r)Sy(x.elementfocus,r,t);return 0}).command("echo",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"fc",t);return 0}).command("phaser",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"reverb",t);return 0}).command("distort",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let r=0;r<3;++r)Gr(x.elementfocus,r,"autowah",t);return 0});for(let e=0;e<8;++e)Uh.command(`synth${e+1}`,(t,r)=>(Sy(x.elementfocus,e,r),0));for(let e=0;e<3;++e){const t=e+1;Uh.command(`echo${t}`,(r,n)=>(Gr(x.elementfocus,e,"echo",n),0)).command(`fcrush${t}`,(r,n)=>(Gr(x.elementfocus,e,"fcrush",n),0)).command(`phaser${t}`,(r,n)=>(Gr(x.elementfocus,e,"phaser",n),0)).command(`reverb${t}`,(r,n)=>(Gr(x.elementfocus,e,"reverb",n),0)).command(`distort${t}`,(r,n)=>(Gr(x.elementfocus,e,"distort",n),0)).command(`vibrato${t}`,(r,n)=>(Gr(x.elementfocus,e,"vibrato",n),0)).command(`autowah${t}`,(r,n)=>(Gr(x.elementfocus,e,"autowah",n),0))}var pl={},Ph,Oy;function LI(){if(Oy)return Ph;Oy=1;var e,t,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},n;function i(f){throw{name:"SyntaxError",message:f,at:e,text:n}}function s(f){return f&&f!==t&&i("Expected '"+f+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t}function o(){var f,p="";for(t==="-"&&(p="-",s("-"));t>="0"&&t<="9";)p+=t,s();if(t===".")for(p+=".";s()&&t>="0"&&t<="9";)p+=t;if(t==="e"||t==="E")for(p+=t,s(),(t==="-"||t==="+")&&(p+=t,s());t>="0"&&t<="9";)p+=t,s();return f=Number(p),isFinite(f)||i("Bad number"),f}function a(){var f,p,m="",g;if(t==='"')for(;s();){if(t==='"')return s(),m;if(t==="\\")if(s(),t==="u"){for(g=0,p=0;p<4&&(f=parseInt(s(),16),!!isFinite(f));p+=1)g=g*16+f;m+=String.fromCharCode(g)}else if(typeof r[t]=="string")m+=r[t];else break;else m+=t}i("Bad string")}function c(){for(;t&&t<=" ";)s()}function l(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;default:i("Unexpected '"+t+"'")}}function u(){var f=[];if(t==="["){if(s("["),c(),t==="]")return s("]"),f;for(;t;){if(f.push(d()),c(),t==="]")return s("]"),f;s(","),c()}}i("Bad array")}function h(){var f,p={};if(t==="{"){if(s("{"),c(),t==="}")return s("}"),p;for(;t;){if(f=a(),c(),s(":"),Object.prototype.hasOwnProperty.call(p,f)&&i('Duplicate key "'+f+'"'),p[f]=d(),c(),t==="}")return s("}"),p;s(","),c()}}i("Bad object")}function d(){switch(c(),t){case"{":return h();case"[":return u();case'"':return a();case"-":return o();default:return t>="0"&&t<="9"?o():l()}}return Ph=function(f,p){var m;return n=f,e=0,t=" ",m=d(),c(),t&&i("Syntax error"),typeof p=="function"?function g(y,b){var A,T,k=y[b];if(k&&typeof k=="object")for(A in d)Object.prototype.hasOwnProperty.call(k,A)&&(T=g(k,A),typeof T>"u"?delete k[A]:k[A]=T);return p.call(y,b,k)}({"":m},""):m},Ph}var Fh,Iy;function MI(){if(Iy)return Fh;Iy=1;var e=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t,r,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},i;function s(a){return e.lastIndex=0,e.test(a)?'"'+a.replace(e,function(c){var l=n[c];return typeof l=="string"?l:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function o(a,c){var l,u,h,d,f=t,p,m=c[a];switch(m&&typeof m=="object"&&typeof m.toJSON=="function"&&(m=m.toJSON(a)),typeof i=="function"&&(m=i.call(c,a,m)),typeof m){case"string":return s(m);case"number":return isFinite(m)?String(m):"null";case"boolean":case"null":return String(m);case"object":if(!m)return"null";if(t+=r,p=[],Object.prototype.toString.apply(m)==="[object Array]"){for(d=m.length,l=0;l<d;l+=1)p[l]=o(l,m)||"null";return h=p.length===0?"[]":t?`[
`+t+p.join(`,
`+t)+`
`+f+"]":"["+p.join(",")+"]",t=f,h}if(i&&typeof i=="object")for(d=i.length,l=0;l<d;l+=1)u=i[l],typeof u=="string"&&(h=o(u,m),h&&p.push(s(u)+(t?": ":":")+h));else for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(h=o(u,m),h&&p.push(s(u)+(t?": ":":")+h));return h=p.length===0?"{}":t?`{
`+t+p.join(`,
`+t)+`
`+f+"}":"{"+p.join(",")+"}",t=f,h}}return Fh=function(a,c,l){var u;if(t="",r="",typeof l=="number")for(u=0;u<l;u+=1)r+=" ";else typeof l=="string"&&(r=l);if(i=c,c&&typeof c!="function"&&(typeof c!="object"||typeof c.length!="number"))throw new Error("JSON.stringify");return o("",{"":a})},Fh}var Ny;function UI(){return Ny||(Ny=1,pl.parse=LI(),pl.stringify=MI()),pl}var PI={}.toString,FI=Array.isArray||function(e){return PI.call(e)=="[object Array]"},Cy=Object.prototype.toString,Ly=function(t){var r=Cy.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Cy.call(t.callee)==="[object Function]"),n},$h,My;function $I(){if(My)return $h;My=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Ly,i=Object.prototype.propertyIsEnumerable,s=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(d){var f=d.constructor;return f&&f.prototype===d},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var d in window)try{if(!l["$"+d]&&t.call(window,d)&&window[d]!==null&&typeof window[d]=="object")try{c(window[d])}catch{return!0}}catch{return!0}return!1}(),h=function(d){if(typeof window>"u"||!u)return c(d);try{return c(d)}catch{return!1}};e=function(f){var p=f!==null&&typeof f=="object",m=r.call(f)==="[object Function]",g=n(f),y=p&&r.call(f)==="[object String]",b=[];if(!p&&!m&&!g)throw new TypeError("Object.keys called on a non-object");var A=o&&m;if(y&&f.length>0&&!t.call(f,0))for(var T=0;T<f.length;++T)b.push(String(T));if(g&&f.length>0)for(var k=0;k<f.length;++k)b.push(String(k));else for(var I in f)!(A&&I==="prototype")&&t.call(f,I)&&b.push(String(I));if(s)for(var R=h(f),$=0;$<a.length;++$)!(R&&a[$]==="constructor")&&t.call(f,a[$])&&b.push(a[$]);return b}}return $h=e,$h}var BI=Array.prototype.slice,DI=Ly,Uy=Object.keys,ml=Uy?function(t){return Uy(t)}:$I(),Py=Object.keys;ml.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return DI(n)?Py(BI.call(n)):Py(n)})}else Object.keys=ml;return Object.keys||ml};var jI=ml,Fy={exports:{}},$y=Object,zI=Error,WI=EvalError,HI=RangeError,GI=ReferenceError,By=SyntaxError,Vi=TypeError,KI=URIError,YI=Math.abs,qI=Math.floor,VI=Math.max,XI=Math.min,JI=Math.pow,ZI=Math.round,QI=Number.isNaN||function(t){return t!==t},tN=QI,eN=function(t){return tN(t)||t===0?t:t<0?-1:1},rN=Object.getOwnPropertyDescriptor,gl=rN;if(gl)try{gl([],"length")}catch{gl=null}var yl=gl,_l=Object.defineProperty||!1;if(_l)try{_l({},"a",{value:1})}catch{_l=!1}var bl=_l,Bh,Dy;function nN(){return Dy||(Dy=1,Bh=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),Bh}var Dh,jy;function iN(){if(jy)return Dh;jy=1;var e=typeof Symbol<"u"&&Symbol,t=nN();return Dh=function(){return typeof e!="function"||typeof Symbol!="function"||typeof e("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Dh}var jh,zy;function Wy(){return zy||(zy=1,jh=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),jh}var zh,Hy;function Gy(){if(Hy)return zh;Hy=1;var e=$y;return zh=e.getPrototypeOf||null,zh}var sN="Function.prototype.bind called on incompatible ",oN=Object.prototype.toString,aN=Math.max,cN="[object Function]",Ky=function(t,r){for(var n=[],i=0;i<t.length;i+=1)n[i]=t[i];for(var s=0;s<r.length;s+=1)n[s+t.length]=r[s];return n},lN=function(t,r){for(var n=[],i=r,s=0;i<t.length;i+=1,s+=1)n[s]=t[i];return n},uN=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r},fN=function(t){var r=this;if(typeof r!="function"||oN.apply(r)!==cN)throw new TypeError(sN+r);for(var n=lN(arguments,1),i,s=function(){if(this instanceof i){var u=r.apply(this,Ky(n,arguments));return Object(u)===u?u:this}return r.apply(t,Ky(n,arguments))},o=aN(0,r.length-n.length),a=[],c=0;c<o;c++)a[c]="$"+c;if(i=Function("binder","return function ("+uN(a,",")+"){ return binder.apply(this,arguments); }")(s),r.prototype){var l=function(){};l.prototype=r.prototype,i.prototype=new l,l.prototype=null}return i},hN=fN,Ra=Function.prototype.bind||hN,Wh=Function.prototype.call,Hh=Function.prototype.apply,dN=typeof Reflect<"u"&&Reflect&&Reflect.apply,pN=Ra,mN=Hh,gN=Wh,yN=dN,Yy=yN||pN.call(gN,mN),_N=Ra,bN=Vi,wN=Wh,vN=Yy,Gh=function(t){if(t.length<1||typeof t[0]!="function")throw new bN("a function is required");return vN(_N,wN,t)},Kh,qy;function EN(){if(qy)return Kh;qy=1;var e=Gh,t=yl,r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&t&&t(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return Kh=n&&typeof n.get=="function"?e([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,Kh}var Yh,Vy;function kN(){if(Vy)return Yh;Vy=1;var e=Wy(),t=Gy(),r=EN();return Yh=e?function(i){return e(i)}:t?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return t(i)}:r?function(i){return r(i)}:null,Yh}var qh,Xy;function xN(){if(Xy)return qh;Xy=1;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=Ra;return qh=r.call(e,t),qh}var se,AN=$y,TN=zI,SN=WI,RN=HI,ON=GI,Eo=By,ko=Vi,IN=KI,NN=YI,CN=qI,LN=VI,MN=XI,UN=JI,PN=ZI,FN=eN,Jy=Function,Vh=function(e){try{return Jy('"use strict"; return ('+e+").constructor;")()}catch{}},Oa=yl,$N=bl,Xh=function(){throw new ko},BN=Oa?function(){try{return arguments.callee,Xh}catch{try{return Oa(arguments,"callee").get}catch{return Xh}}}():Xh,xo=iN()(),hr=kN(),DN=Gy(),jN=Wy(),Zy=Hh,Ia=Wh,Ao={},zN=typeof Uint8Array>"u"||!hr?se:hr(Uint8Array),Os={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?se:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?se:ArrayBuffer,"%ArrayIteratorPrototype%":xo&&hr?hr([][Symbol.iterator]()):se,"%AsyncFromSyncIteratorPrototype%":se,"%AsyncFunction%":Ao,"%AsyncGenerator%":Ao,"%AsyncGeneratorFunction%":Ao,"%AsyncIteratorPrototype%":Ao,"%Atomics%":typeof Atomics>"u"?se:Atomics,"%BigInt%":typeof BigInt>"u"?se:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?se:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?se:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?se:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":TN,"%eval%":eval,"%EvalError%":SN,"%Float16Array%":typeof Float16Array>"u"?se:Float16Array,"%Float32Array%":typeof Float32Array>"u"?se:Float32Array,"%Float64Array%":typeof Float64Array>"u"?se:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?se:FinalizationRegistry,"%Function%":Jy,"%GeneratorFunction%":Ao,"%Int8Array%":typeof Int8Array>"u"?se:Int8Array,"%Int16Array%":typeof Int16Array>"u"?se:Int16Array,"%Int32Array%":typeof Int32Array>"u"?se:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":xo&&hr?hr(hr([][Symbol.iterator]())):se,"%JSON%":typeof JSON=="object"?JSON:se,"%Map%":typeof Map>"u"?se:Map,"%MapIteratorPrototype%":typeof Map>"u"||!xo||!hr?se:hr(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":AN,"%Object.getOwnPropertyDescriptor%":Oa,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?se:Promise,"%Proxy%":typeof Proxy>"u"?se:Proxy,"%RangeError%":RN,"%ReferenceError%":ON,"%Reflect%":typeof Reflect>"u"?se:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?se:Set,"%SetIteratorPrototype%":typeof Set>"u"||!xo||!hr?se:hr(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?se:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":xo&&hr?hr(""[Symbol.iterator]()):se,"%Symbol%":xo?Symbol:se,"%SyntaxError%":Eo,"%ThrowTypeError%":BN,"%TypedArray%":zN,"%TypeError%":ko,"%Uint8Array%":typeof Uint8Array>"u"?se:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?se:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?se:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?se:Uint32Array,"%URIError%":IN,"%WeakMap%":typeof WeakMap>"u"?se:WeakMap,"%WeakRef%":typeof WeakRef>"u"?se:WeakRef,"%WeakSet%":typeof WeakSet>"u"?se:WeakSet,"%Function.prototype.call%":Ia,"%Function.prototype.apply%":Zy,"%Object.defineProperty%":$N,"%Object.getPrototypeOf%":DN,"%Math.abs%":NN,"%Math.floor%":CN,"%Math.max%":LN,"%Math.min%":MN,"%Math.pow%":UN,"%Math.round%":PN,"%Math.sign%":FN,"%Reflect.getPrototypeOf%":jN};if(hr)try{null.error}catch(e){var WN=hr(hr(e));Os["%Error.prototype%"]=WN}var HN=function e(t){var r;if(t==="%AsyncFunction%")r=Vh("async function () {}");else if(t==="%GeneratorFunction%")r=Vh("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Vh("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&hr&&(r=hr(i.prototype))}return Os[t]=r,r},Qy={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Na=Ra,wl=xN(),GN=Na.call(Ia,Array.prototype.concat),KN=Na.call(Zy,Array.prototype.splice),t_=Na.call(Ia,String.prototype.replace),vl=Na.call(Ia,String.prototype.slice),YN=Na.call(Ia,RegExp.prototype.exec),qN=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,VN=/\\(\\)?/g,XN=function(t){var r=vl(t,0,1),n=vl(t,-1);if(r==="%"&&n!=="%")throw new Eo("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Eo("invalid intrinsic syntax, expected opening `%`");var i=[];return t_(t,qN,function(s,o,a,c){i[i.length]=a?t_(c,VN,"$1"):o||s}),i},JN=function(t,r){var n=t,i;if(wl(Qy,n)&&(i=Qy[n],n="%"+i[0]+"%"),wl(Os,n)){var s=Os[n];if(s===Ao&&(s=HN(n)),typeof s>"u"&&!r)throw new ko("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new Eo("intrinsic "+t+" does not exist!")},El=function(t,r){if(typeof t!="string"||t.length===0)throw new ko("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new ko('"allowMissing" argument must be a boolean');if(YN(/^%?[^%]*%?$/,t)===null)throw new Eo("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=XN(t),i=n.length>0?n[0]:"",s=JN("%"+i+"%",r),o=s.name,a=s.value,c=!1,l=s.alias;l&&(i=l[0],KN(n,GN([0,1],l)));for(var u=1,h=!0;u<n.length;u+=1){var d=n[u],f=vl(d,0,1),p=vl(d,-1);if((f==='"'||f==="'"||f==="`"||p==='"'||p==="'"||p==="`")&&f!==p)throw new Eo("property names with quotes must have matching quotes");if((d==="constructor"||!h)&&(c=!0),i+="."+d,o="%"+i+"%",wl(Os,o))a=Os[o];else if(a!=null){if(!(d in a)){if(!r)throw new ko("base intrinsic for "+t+" exists, but the property is not available.");return}if(Oa&&u+1>=n.length){var m=Oa(a,d);h=!!m,h&&"get"in m&&!("originalValue"in m.get)?a=m.get:a=a[d]}else h=wl(a,d),a=a[d];h&&!c&&(Os[o]=a)}}return a},e_=bl,ZN=By,To=Vi,r_=yl,QN=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new To("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new To("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new To("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new To("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new To("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new To("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,c=!!r_&&r_(t,r);if(e_)e_(t,r,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:n,writable:s===null&&c?c.writable:!s});else if(a||!i&&!s&&!o)t[r]=n;else throw new ZN("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Jh=bl,n_=function(){return!!Jh};n_.hasArrayLengthDefineBug=function(){if(!Jh)return null;try{return Jh([],"length",{value:1}).length!==1}catch{return!0}};var tC=n_,eC=El,i_=QN,rC=tC(),s_=yl,o_=Vi,nC=eC("%Math.floor%"),iC=function(t,r){if(typeof t!="function")throw new o_("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||nC(r)!==r)throw new o_("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in t&&s_){var o=s_(t,"length");o&&!o.configurable&&(i=!1),o&&!o.writable&&(s=!1)}return(i||s||!n)&&(rC?i_(t,"length",r,!0,!0):i_(t,"length",r)),t},sC=Ra,oC=Hh,aC=Yy,cC=function(){return aC(sC,oC,arguments)};(function(e){var t=iC,r=bl,n=Gh,i=cC;e.exports=function(o){var a=n(arguments),c=o.length-(arguments.length-1);return t(a,1+(c>0?c:0),!0)},r?r(e.exports,"apply",{value:i}):e.exports.apply=i})(Fy);var lC=Fy.exports,a_=El,c_=Gh,uC=c_([a_("%String.prototype.indexOf%")]),Zh=function(t,r){var n=a_(t,!!r);return typeof n=="function"&&uC(t,".prototype.")>-1?c_([n]):n},kl=(typeof JSON<"u"?JSON:UI()).stringify,fC=FI,hC=jI,dC=lC,xl=Zh,pC=xl("Array.prototype.join"),l_=xl("Array.prototype.indexOf"),mC=xl("Array.prototype.splice"),gC=xl("Array.prototype.sort"),u_=function(t,r){for(var n="",i=0;i<t;i+=1)n+=r;return n},yC=function(e,t,r){return r},_C=function(t){var r=arguments.length>1?arguments[1]:void 0,n=r&&r.space||"";typeof n=="number"&&(n=u_(n," "));var i=!!r&&typeof r.cycles=="boolean"&&r.cycles,s=r&&r.replacer?dC(r.replacer):yC;if(r&&typeof r.collapseEmpty<"u"&&typeof r.collapseEmpty!="boolean")throw new TypeError("`collapseEmpty` must be a boolean, if provided");var o=!!r&&r.collapseEmpty,a=typeof r=="function"?r:r&&r.cmp,c=a&&function(u){var h=a.length>2&&function(f){return u[f]};return function(d,f){return a({key:d,value:u[d]},{key:f,value:u[f]},h?{__proto__:null,get:h}:void 0)}},l=[];return function u(h,d,f,p){var m=n?`
`+u_(p,n):"",g=n?": ":":";if(f&&f.toJSON&&typeof f.toJSON=="function"&&(f=f.toJSON()),f=s(h,d,f),f!==void 0){if(typeof f!="object"||f===null)return kl(f);var y=function($,M){return o&&$.length===0?M:(M==="[]"?"[":"{")+pC($,",")+m+(M==="[]"?"]":"}")};if(fC(f)){for(var k=[],b=0;b<f.length;b++){var A=u(f,b,f[b],p+1)||kl(null);k[k.length]=m+n+A}return y(k,"[]")}if(l_(l,f)!==-1){if(i)return kl("__cycle__");throw new TypeError("Converting circular structure to JSON")}else l[l.length]=f;for(var T=gC(hC(f),c&&c(f)),k=[],b=0;b<T.length;b++){var d=T[b],I=u(f,d,f[d],p+1);if(I){var R=kl(d)+g+I;k[k.length]=m+n+R}}return mC(l,l_(l,f),1),y(k,"{}")}}({"":t},"",t,0)},bC=ps(_C),Qh;try{Qh=new TextDecoder}catch{}var kt,ii,J=0,ke={},ce,Xi,wn=0,si=0,dr,Si,Kr=[],oe,f_={useRecords:!1,mapsAsObjects:!0};class h_{}const d_=new h_;d_.name="MessagePack 0xC1";var Ji=!1,p_=2,wC;try{new Function("")}catch{p_=1/0}class Ca{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,r){if(kt)return R_(()=>(id(),this?this.unpack(t,r):Ca.prototype.unpack.call(f_,t,r)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof rr<"u"?rr.from(t):new Uint8Array(t)),typeof r=="object"?(ii=r.end||t.length,J=r.start||0):(J=0,ii=r>-1?r:t.length),si=0,Xi=null,dr=null,kt=t;try{oe=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw kt=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Ca){if(ke=this,this.structures)return ce=this.structures,Al(r);(!ce||ce.length>0)&&(ce=[])}else ke=f_,(!ce||ce.length>0)&&(ce=[]);return Al(r)}unpackMultiple(t,r){let n,i=0;try{Ji=!0;let s=t.length,o=this?this.unpack(t,s):Tl.unpack(t,s);if(r){if(r(o,i,J)===!1)return;for(;J<s;)if(i=J,r(Al(),i,J)===!1)return}else{for(n=[o];J<s;)i=J,n.push(Al());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{Ji=!1,id()}}_mergeStructures(t,r){t=t||[],Object.isFrozen(t)&&(t=t.map(n=>n.slice(0)));for(let n=0,i=t.length;n<i;n++){let s=t[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}t.sharedLength=t.length;for(let n in r||[])if(n>=0){let i=t[n],s=r[n];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=s)}return this.structures=t}decode(t,r){return this.unpack(t,r)}}function Al(e){try{if(!ke.trusted&&!Ji){let r=ce.sharedLength||0;r<ce.length&&(ce.length=r)}let t;if(ke.randomAccessStructure&&kt[J]<64&&kt[J]>=32&&wC||(t=Ke()),dr&&(J=dr.postBundlePosition,dr=null),Ji&&(ce.restoreStructures=null),J==ii)ce&&ce.restoreStructures&&m_(),ce=null,kt=null,Si&&(Si=null);else{if(J>ii)throw new Error("Unexpected end of MessagePack data");if(!Ji){let r;try{r=JSON.stringify(t,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return t}catch(t){throw ce&&ce.restoreStructures&&m_(),id(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||J>ii)&&(t.incomplete=!0),t}}function m_(){for(let e in ce.restoreStructures)ce[e]=ce.restoreStructures[e];ce.restoreStructures=null}function Ke(){let e=kt[J++];if(e<160)if(e<128){if(e<64)return e;{let t=ce[e&63]||ke.getStructures&&y_()[e&63];return t?(t.read||(t.read=td(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=k_();n==="__proto__"&&(n="__proto_"),t[n]=Ke()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ke(),Ke());return t}else{e-=144;let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ke();return ke.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(si>=J)return Xi.slice(J-wn,(J+=t)-wn);if(si==0&&ii<140){let r=t<16?rd(t):w_(t);if(r!=null)return r}return ed(t)}else{let t;switch(e){case 192:return null;case 193:return dr?(t=Ke(),t>0?dr[1].slice(dr.position1,dr.position1+=t):dr[0].slice(dr.position0,dr.position0-=t)):d_;case 194:return!1;case 195:return!0;case 196:if(t=kt[J++],t===void 0)throw new Error("Unexpected end of buffer");return nd(t);case 197:return t=oe.getUint16(J),J+=2,nd(t);case 198:return t=oe.getUint32(J),J+=4,nd(t);case 199:return Is(kt[J++]);case 200:return t=oe.getUint16(J),J+=2,Is(t);case 201:return t=oe.getUint32(J),J+=4,Is(t);case 202:if(t=oe.getFloat32(J),ke.useFloat32>2){let r=sd[(kt[J]&127)<<1|kt[J+1]>>7];return J+=4,(r*t+(t>0?.5:-.5)>>0)/r}return J+=4,t;case 203:return t=oe.getFloat64(J),J+=8,t;case 204:return kt[J++];case 205:return t=oe.getUint16(J),J+=2,t;case 206:return t=oe.getUint32(J),J+=4,t;case 207:return ke.int64AsType==="number"?(t=oe.getUint32(J)*4294967296,t+=oe.getUint32(J+4)):ke.int64AsType==="string"?t=oe.getBigUint64(J).toString():ke.int64AsType==="auto"?(t=oe.getBigUint64(J),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=oe.getBigUint64(J),J+=8,t;case 208:return oe.getInt8(J++);case 209:return t=oe.getInt16(J),J+=2,t;case 210:return t=oe.getInt32(J),J+=4,t;case 211:return ke.int64AsType==="number"?(t=oe.getInt32(J)*4294967296,t+=oe.getUint32(J+4)):ke.int64AsType==="string"?t=oe.getBigInt64(J).toString():ke.int64AsType==="auto"?(t=oe.getBigInt64(J),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=oe.getBigInt64(J),J+=8,t;case 212:if(t=kt[J++],t==114)return A_(kt[J++]&63);{let r=Kr[t];if(r)return r.read?(J++,r.read(Ke())):r.noBuffer?(J++,r()):r(kt.subarray(J,++J));throw new Error("Unknown extension "+t)}case 213:return t=kt[J],t==114?(J++,A_(kt[J++]&63,kt[J++])):Is(2);case 214:return Is(4);case 215:return Is(8);case 216:return Is(16);case 217:return t=kt[J++],si>=J?Xi.slice(J-wn,(J+=t)-wn):EC(t);case 218:return t=oe.getUint16(J),J+=2,si>=J?Xi.slice(J-wn,(J+=t)-wn):kC(t);case 219:return t=oe.getUint32(J),J+=4,si>=J?Xi.slice(J-wn,(J+=t)-wn):xC(t);case 220:return t=oe.getUint16(J),J+=2,__(t);case 221:return t=oe.getUint32(J),J+=4,__(t);case 222:return t=oe.getUint16(J),J+=2,b_(t);case 223:return t=oe.getUint32(J),J+=4,b_(t);default:if(e>=224)return e-256;if(e===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+e)}}}const vC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function td(e,t){function r(){if(r.count++>p_){let i=e.read=new Function("r","return function(){return "+(ke.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":vC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Ke);return e.highByte===0&&(e.read=g_(t,e.read)),i()}let n={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),n[o]=Ke()}return ke.freezeData?Object.freeze(n):n}return r.count=0,e.highByte===0?g_(t,r):r}const g_=(e,t)=>function(){let r=kt[J++];if(r===0)return t();let n=e<32?-(e+(r<<5)):e+(r<<5),i=ce[n]||y_()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=td(i,e)),i.read()};function y_(){let e=R_(()=>(kt=null,ke.getStructures()));return ce=ke._mergeStructures(e,ce)}var ed=La,EC=La,kC=La,xC=La;function La(e){let t;if(e<16&&(t=rd(e)))return t;if(e>64&&Qh)return Qh.decode(kt.subarray(J,J+=e));const r=J+e,n=[];for(t="";J<r;){const i=kt[J++];if(!(i&128))n.push(i);else if((i&224)===192){const s=kt[J++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[J++]&63,o=kt[J++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[J++]&63,o=kt[J++]&63,a=kt[J++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(t+=pr.apply(String,n),n.length=0)}return n.length>0&&(t+=pr.apply(String,n)),t}function __(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=Ke();return ke.freezeData?Object.freeze(t):t}function b_(e){if(ke.mapsAsObjects){let t={};for(let r=0;r<e;r++){let n=k_();n==="__proto__"&&(n="__proto_"),t[n]=Ke()}return t}else{let t=new Map;for(let r=0;r<e;r++)t.set(Ke(),Ke());return t}}var pr=String.fromCharCode;function w_(e){let t=J,r=new Array(e);for(let n=0;n<e;n++){const i=kt[J++];if((i&128)>0){J=t;return}r[n]=i}return pr.apply(String,r)}function rd(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[J++];if((t&128)>1){J-=1;return}return pr(t)}}else{let t=kt[J++],r=kt[J++];if((t&128)>0||(r&128)>0){J-=2;return}if(e<3)return pr(t,r);let n=kt[J++];if((n&128)>0){J-=3;return}return pr(t,r,n)}else{let t=kt[J++],r=kt[J++],n=kt[J++],i=kt[J++];if((t&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){J-=4;return}if(e<6){if(e===4)return pr(t,r,n,i);{let s=kt[J++];if((s&128)>0){J-=5;return}return pr(t,r,n,i,s)}}else if(e<8){let s=kt[J++],o=kt[J++];if((s&128)>0||(o&128)>0){J-=6;return}if(e<7)return pr(t,r,n,i,s,o);let a=kt[J++];if((a&128)>0){J-=7;return}return pr(t,r,n,i,s,o,a)}else{let s=kt[J++],o=kt[J++],a=kt[J++],c=kt[J++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){J-=8;return}if(e<10){if(e===8)return pr(t,r,n,i,s,o,a,c);{let l=kt[J++];if((l&128)>0){J-=9;return}return pr(t,r,n,i,s,o,a,c,l)}}else if(e<12){let l=kt[J++],u=kt[J++];if((l&128)>0||(u&128)>0){J-=10;return}if(e<11)return pr(t,r,n,i,s,o,a,c,l,u);let h=kt[J++];if((h&128)>0){J-=11;return}return pr(t,r,n,i,s,o,a,c,l,u,h)}else{let l=kt[J++],u=kt[J++],h=kt[J++],d=kt[J++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){J-=12;return}if(e<14){if(e===12)return pr(t,r,n,i,s,o,a,c,l,u,h,d);{let f=kt[J++];if((f&128)>0){J-=13;return}return pr(t,r,n,i,s,o,a,c,l,u,h,d,f)}}else{let f=kt[J++],p=kt[J++];if((f&128)>0||(p&128)>0){J-=14;return}if(e<15)return pr(t,r,n,i,s,o,a,c,l,u,h,d,f,p);let m=kt[J++];if((m&128)>0){J-=15;return}return pr(t,r,n,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function v_(){let e=kt[J++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[J++];break;case 218:t=oe.getUint16(J),J+=2;break;case 219:t=oe.getUint32(J),J+=4;break;default:throw new Error("Expected string")}return La(t)}function nd(e){return ke.copyBuffers?Uint8Array.prototype.slice.call(kt,J,J+=e):kt.subarray(J,J+=e)}function Is(e){let t=kt[J++];if(Kr[t]){let r;return Kr[t](kt.subarray(J,r=J+=e),n=>{J=n;try{return Ke()}finally{J=r}})}else throw new Error("Unknown extension type "+t)}var E_=new Array(4096);function k_(){let e=kt[J++];if(e>=160&&e<192){if(e=e-160,si>=J)return Xi.slice(J-wn,(J+=e)-wn);if(!(si==0&&ii<180))return ed(e)}else return J--,x_(Ke());let t=(e<<5^(e>1?oe.getUint16(J):e>0?kt[J]:0))&4095,r=E_[t],n=J,i=J+e-3,s,o=0;if(r&&r.bytes==e){for(;n<i;){if(s=oe.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=kt[n++],s!=r[o++]){n=1879048192;break}if(n===i)return J=n,r.string;i-=3,n=J}for(r=[],E_[t]=r,r.bytes=e;n<i;)s=oe.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=kt[n++],r.push(s);let a=e<16?rd(e):w_(e);return a!=null?r.string=a:r.string=ed(e)}function x_(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";if(ke.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every(t=>["string","number","boolean","bigint"].includes(typeof t)))return e.flat().toString();throw new Error(`Invalid property type for record: ${typeof e}`)}const A_=(e,t)=>{let r=Ke().map(x_),n=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,r.highByte=t);let i=ce[e];return i&&(i.isShared||Ji)&&((ce.restoreStructures||(ce.restoreStructures=[]))[e]=i),ce[e]=r,r.read=td(r,n),r.read()};Kr[0]=()=>{},Kr[0].noBuffer=!0,Kr[66]=e=>{let t=e.byteLength%8||8,r=BigInt(e[0]&128?e[0]-256:e[0]);for(let n=1;n<t;n++)r<<=BigInt(8),r+=BigInt(e[n]);if(e.byteLength!==t){let n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=n.getBigUint64(s);for(let d=s+8;d<o;d+=8)h<<=64n,h|=n.getBigUint64(d);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};r=r<<BigInt((n.byteLength-t)*8)|i(t,n.byteLength)}return r};let T_={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Kr[101]=()=>{let e=Ke();if(!T_[e[0]]){let t=Error(e[1],{cause:e[2]});return t.name=e[0],t}return T_[e[0]](e[1],{cause:e[2]})},Kr[105]=e=>{if(ke.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=oe.getUint32(J-4);Si||(Si=new Map);let r=kt[J],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&kt[J+1]===115?n=new Set:n={};let i={target:n};Si.set(t,i);let s=Ke();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},Kr[112]=e=>{if(ke.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=oe.getUint32(J-4),r=Si.get(t);return r.used=!0,r.target},Kr[115]=()=>new Set(Ke());const S_=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let AC=typeof globalThis=="object"?globalThis:window;Kr[116]=e=>{let t=e[0],r=Uint8Array.prototype.slice.call(e,1).buffer,n=S_[t];if(!n){if(t===16)return r;if(t===17)return new DataView(r);throw new Error("Could not find typed array for code "+t)}return new AC[n](r)},Kr[120]=()=>{let e=Ke();return new RegExp(e[0],e[1])};const TC=[];Kr[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],r=J;return J+=t-e.length,dr=TC,dr=[v_(),v_()],dr.position0=0,dr.position1=0,dr.postBundlePosition=J,J=r,Ke()},Kr[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function R_(e){let t=ii,r=J,n=wn,i=si,s=Xi,o=Si,a=dr,c=new Uint8Array(kt.slice(0,ii)),l=ce,u=ce.slice(0,ce.length),h=ke,d=Ji,f=e();return ii=t,J=r,wn=n,si=i,Xi=s,Si=o,dr=a,kt=c,Ji=d,ce=l,ce.splice(0,ce.length,...u),ke=h,oe=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),f}function id(){kt=null,Si=null,ce=null}const sd=new Array(147);for(let e=0;e<256;e++)sd[e]=+("1e"+Math.floor(45.15-e*.30103));var Tl=new Ca({useRecords:!1});const SC=Tl.unpack;Tl.unpackMultiple,Tl.unpack;let RC=new Float32Array(1);new Uint8Array(RC.buffer,0,4);let Sl;try{Sl=new TextEncoder}catch{}let od,O_;const So=typeof rr<"u",Rl=So?function(e){return rr.allocUnsafeSlow(e)}:Uint8Array,I_=So?rr:Uint8Array,N_=So?4294967296:2144337920;let ot,Ma,ve,et=0,Sr,Fe=null,OC;const IC=21760,NC=/[\u0080-\uFFFF]/,Ro=Symbol("record-id");class CC extends Ca{constructor(t){super(t),this.offset=0;let r,n,i,s,o=I_.prototype.utf8Write?function(N,E){return ot.utf8Write(N,E,ot.byteLength-E)}:Sl&&Sl.encodeInto?function(N,E){return Sl.encodeInto(N,ot.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],g=0,y=0;this.pack=this.encode=function(N,E){if(ot||(ot=new Rl(8192),ve=ot.dataView||(ot.dataView=new DataView(ot.buffer,0,8192)),et=0),Sr=ot.length-10,Sr-et<2048?(ot=new Rl(ot.length),ve=ot.dataView||(ot.dataView=new DataView(ot.buffer,0,ot.length)),Sr=ot.length-10,et=0):et=et+7&2147483640,r=et,E&FC&&(et+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof N!="string"?(Fe=[],Fe.size=1/0):Fe=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let j=i.sharedLength||0;if(j>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<j;U++){let q=i[U];if(!q)continue;let Q,K=i.transitions;for(let W=0,P=q.length;W<P;W++){let st=q[W];Q=K[st],Q||(Q=K[st]=Object.create(null)),K=Q}K[Ro]=U+64}this.lastNamedStructuresLength=j}c||(i.nextId=j+64)}n&&(n=!1);let L;try{a.randomAccessStructure&&N&&N.constructor&&N.constructor===Object?O(N):T(N);let j=Fe;if(Fe&&L_(r,T,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((W,P)=>W.offset>P.offset?1:-1),q=U.length,Q=-1;for(;j&&q>0;){let W=U[--q].offset+r;W<j.stringsPosition+r&&Q===-1&&(Q=0),W>j.position+r?Q>=0&&(Q+=6):(Q>=0&&(ve.setUint32(j.position+r,ve.getUint32(j.position+r)+Q),Q=-1),j=j.previous,q++)}Q>=0&&j&&ve.setUint32(j.position+r,ve.getUint32(j.position+r)+Q),et+=U.length*6,et>Sr&&M(et),a.offset=et;let K=LC(ot.subarray(r,et),U);return s=null,K}return a.offset=et,E&UC?(ot.start=r,ot.end=et,ot):ot.subarray(r,et)}catch(j){throw L=j,j}finally{if(i&&(b(),n&&a.saveStructures)){let j=i.sharedLength||0,U=ot.subarray(r,et),q=MC(i,a);if(!L)return a.saveStructures(q,q.isCompatible)===!1?a.pack(N,E):(a.lastNamedStructuresLength=j,ot.length>1073741824&&(ot=null),U)}ot.length>1073741824&&(ot=null),E&PC&&(et=r)}};const b=()=>{y<10&&y++;let N=i.sharedLength||0;if(i.length>N&&!c&&(i.length=N),g>1e4)i.transitions=null,y=0,g=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let E=0,L=m.length;E<L;E++)m[E][Ro]=0;m=[]}},A=N=>{var E=N.length;E<16?ot[et++]=144|E:E<65536?(ot[et++]=220,ot[et++]=E>>8,ot[et++]=E&255):(ot[et++]=221,ve.setUint32(et,E),et+=4);for(let L=0;L<E;L++)T(N[L])},T=N=>{et>Sr&&(ot=M(et));var E=typeof N,L;if(E==="string"){let j=N.length;if(Fe&&j>=4&&j<4096){if((Fe.size+=j)>IC){let K,W=(Fe[0]?Fe[0].length*3+Fe[1].length:0)+10;et+W>Sr&&(ot=M(et+W));let P;Fe.position?(P=Fe,ot[et]=200,et+=3,ot[et++]=98,K=et-r,et+=4,L_(r,T,0),ve.setUint16(K+r-3,et-r-K)):(ot[et++]=214,ot[et++]=98,K=et-r,et+=4),Fe=["",""],Fe.previous=P,Fe.size=0,Fe.position=K}let Q=NC.test(N);Fe[Q?0:1]+=N,ot[et++]=193,T(Q?-j:j);return}let U;j<32?U=1:j<256?U=2:j<65536?U=3:U=5;let q=j*3;if(et+q>Sr&&(ot=M(et+q)),j<64||!o){let Q,K,W,P=et+U;for(Q=0;Q<j;Q++)K=N.charCodeAt(Q),K<128?ot[P++]=K:K<2048?(ot[P++]=K>>6|192,ot[P++]=K&63|128):(K&64512)===55296&&((W=N.charCodeAt(Q+1))&64512)===56320?(K=65536+((K&1023)<<10)+(W&1023),Q++,ot[P++]=K>>18|240,ot[P++]=K>>12&63|128,ot[P++]=K>>6&63|128,ot[P++]=K&63|128):(ot[P++]=K>>12|224,ot[P++]=K>>6&63|128,ot[P++]=K&63|128);L=P-et-U}else L=o(N,et+U);L<32?ot[et++]=160|L:L<256?(U<2&&ot.copyWithin(et+2,et+1,et+1+L),ot[et++]=217,ot[et++]=L):L<65536?(U<3&&ot.copyWithin(et+3,et+2,et+2+L),ot[et++]=218,ot[et++]=L>>8,ot[et++]=L&255):(U<5&&ot.copyWithin(et+5,et+3,et+3+L),ot[et++]=219,ve.setUint32(et,L),et+=4),et+=L}else if(E==="number")if(N>>>0===N)N<32||N<128&&this.useRecords===!1||N<64&&!this.randomAccessStructure?ot[et++]=N:N<256?(ot[et++]=204,ot[et++]=N):N<65536?(ot[et++]=205,ot[et++]=N>>8,ot[et++]=N&255):(ot[et++]=206,ve.setUint32(et,N),et+=4);else if(N>>0===N)N>=-32?ot[et++]=256+N:N>=-128?(ot[et++]=208,ot[et++]=N+256):N>=-32768?(ot[et++]=209,ve.setInt16(et,N),et+=2):(ot[et++]=210,ve.setInt32(et,N),et+=4);else{let j;if((j=this.useFloat32)>0&&N<4294967296&&N>=-2147483648){ot[et++]=202,ve.setFloat32(et,N);let U;if(j<4||(U=N*sd[(ot[et]&127)<<1|ot[et+1]>>7])>>0===U){et+=4;return}else et--}ot[et++]=203,ve.setFloat64(et,N),et+=8}else if(E==="object"||E==="function")if(!N)ot[et++]=192;else{if(s){let U=s.get(N);if(U){if(!U.id){let q=s.idsToInsert||(s.idsToInsert=[]);U.id=q.push(U)}ot[et++]=214,ot[et++]=112,ve.setUint32(et,U.id),et+=4;return}else s.set(N,{offset:et-r})}let j=N.constructor;if(j===Object)$(N);else if(j===Array)A(N);else if(j===Map)if(this.mapAsEmptyObject)ot[et++]=128;else{L=N.size,L<16?ot[et++]=128|L:L<65536?(ot[et++]=222,ot[et++]=L>>8,ot[et++]=L&255):(ot[et++]=223,ve.setUint32(et,L),et+=4);for(let[U,q]of N)T(U),T(q)}else{for(let U=0,q=od.length;U<q;U++){let Q=O_[U];if(N instanceof Q){let K=od[U];if(K.write){K.type&&(ot[et++]=212,ot[et++]=K.type,ot[et++]=0);let rt=K.write.call(this,N);rt===N?Array.isArray(N)?A(N):$(N):T(rt);return}let W=ot,P=ve,st=et;ot=null;let G;try{G=K.pack.call(this,N,rt=>(ot=W,W=null,et+=rt,et>Sr&&M(et),{target:ot,targetView:ve,position:et-rt}),T)}finally{W&&(ot=W,ve=P,et=st,Sr=ot.length-10)}G&&(G.length+et>Sr&&M(G.length+et),et=C_(G,ot,et,K.type));return}}if(Array.isArray(N))A(N);else{if(N.toJSON){const U=N.toJSON();if(U!==N)return T(U)}if(E==="function")return T(this.writeFunction&&this.writeFunction(N));$(N)}}}else if(E==="boolean")ot[et++]=N?195:194;else if(E==="bigint"){if(N<9223372036854776e3&&N>=-9223372036854776e3)ot[et++]=211,ve.setBigInt64(et,N);else if(N<18446744073709552e3&&N>0)ot[et++]=207,ve.setBigUint64(et,N);else if(this.largeBigIntToFloat)ot[et++]=203,ve.setFloat64(et,Number(N));else{if(this.largeBigIntToString)return T(N.toString());if(this.useBigIntExtension||this.moreTypes){let j=N<0?BigInt(-1):BigInt(0),U;if(N>>BigInt(65536)===j){let q=BigInt(18446744073709552e3)-BigInt(1),Q=[];for(;Q.push(N&q),N>>BigInt(63)!==j;)N>>=BigInt(64);U=new Uint8Array(new BigUint64Array(Q).buffer),U.reverse()}else{let q=N<0,Q=(q?~N:N).toString(16);if(Q.length%2?Q="0"+Q:parseInt(Q.charAt(0),16)>=8&&(Q="00"+Q),So)U=rr.from(Q,"hex");else{U=new Uint8Array(Q.length/2);for(let K=0;K<U.length;K++)U[K]=parseInt(Q.slice(K*2,K*2+2),16)}if(q)for(let K=0;K<U.length;K++)U[K]=~U[K]}U.length+et>Sr&&M(U.length+et),et=C_(U,ot,et,66);return}else throw new RangeError(N+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}et+=8}else if(E==="undefined")this.encodeUndefinedAsNil?ot[et++]=192:(ot[et++]=212,ot[et++]=0,ot[et++]=0);else throw new Error("Unknown type: "+E)},k=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?N=>{let E;if(this.skipValues){E=[];for(let U in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(U))&&!this.skipValues.includes(N[U])&&E.push(U)}else E=Object.keys(N);let L=E.length;L<16?ot[et++]=128|L:L<65536?(ot[et++]=222,ot[et++]=L>>8,ot[et++]=L&255):(ot[et++]=223,ve.setUint32(et,L),et+=4);let j;if(this.coercibleKeyAsNumber)for(let U=0;U<L;U++){j=E[U];let q=Number(j);T(isNaN(q)?j:q),T(N[j])}else for(let U=0;U<L;U++)T(j=E[U]),T(N[j])}:N=>{ot[et++]=222;let E=et-r;et+=2;let L=0;for(let j in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(j))&&(T(j),T(N[j]),L++);if(L>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');ot[E+++r]=L>>8,ot[E+r]=L&255},I=this.useRecords===!1?k:t.progressiveRecords&&!d?N=>{let E,L=i.transitions||(i.transitions=Object.create(null)),j=et++-r,U;for(let q in N)if(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(q)){if(E=L[q],E)L=E;else{let Q=Object.keys(N),K=L;L=i.transitions;let W=0;for(let P=0,st=Q.length;P<st;P++){let G=Q[P];E=L[G],E||(E=L[G]=Object.create(null),W++),L=E}j+r+1==et?(et--,H(L,Q,W)):X(L,Q,j,W),U=!0,L=K[q]}T(N[q])}if(!U){let q=L[Ro];q?ot[j+r]=q:X(L,Object.keys(N),j,0)}}:N=>{let E,L=i.transitions||(i.transitions=Object.create(null)),j=0;for(let q in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(q))&&(E=L[q],E||(E=L[q]=Object.create(null),j++),L=E);let U=L[Ro];U?U>=96&&d?(ot[et++]=((U-=96)&31)+96,ot[et++]=U>>5):ot[et++]=U:H(L,L.__keys__||Object.keys(N),j);for(let q in N)(typeof N.hasOwnProperty!="function"||N.hasOwnProperty(q))&&T(N[q])},R=typeof this.useRecords=="function"&&this.useRecords,$=R?N=>{R(N)?I(N):k(N)}:I,M=N=>{let E;if(N>16777216){if(N-r>N_)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(N_,Math.round(Math.max((N-r)*(N>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(N-r<<2,ot.length-1)>>12)+1<<12;let L=new Rl(E);return ve=L.dataView||(L.dataView=new DataView(L.buffer,0,E)),N=Math.min(N,ot.length),ot.copy?ot.copy(L,0,r,N):L.set(ot.slice(r,N)),et-=r,r=0,Sr=L.length-10,ot=L},H=(N,E,L)=>{let j=i.nextId;j||(j=64),j<f&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(j=i.nextOwnId,j<p||(j=f),i.nextOwnId=j+1):(j>=p&&(j=f),i.nextId=j+1);let U=E.highByte=j>=96&&d?j-96>>5:-1;N[Ro]=j,N.__keys__=E,i[j-64]=E,j<f?(E.isShared=!0,i.sharedLength=j-63,n=!0,U>=0?(ot[et++]=(j&31)+96,ot[et++]=U):ot[et++]=j):(U>=0?(ot[et++]=213,ot[et++]=114,ot[et++]=(j&31)+96,ot[et++]=U):(ot[et++]=212,ot[et++]=114,ot[et++]=j),L&&(g+=y*L),m.length>=h&&(m.shift()[Ro]=0),m.push(N),T(E))},X=(N,E,L,j)=>{let U=ot,q=et,Q=Sr,K=r;ot=Ma,et=0,r=0,ot||(Ma=ot=new Rl(8192)),Sr=ot.length-10,H(N,E,j),Ma=ot;let W=et;if(ot=U,et=q,Sr=Q,r=K,W>1){let P=et+W-1;P>Sr&&M(P);let st=L+r;ot.copyWithin(st+W,st+1,et),ot.set(Ma.slice(0,W),st),et=P}else ot[L+r]=Ma[0]},O=N=>{let E=OC(N,ot,r,et,i,M,(L,j,U)=>{if(U)return n=!0;et=j;let q=ot;return T(L),b(),q!==ot?{position:et,targetView:ve,target:ot}:et},this);if(E===0)return $(N);et=E}}useBuffer(t){ot=t,ot.dataView||(ot.dataView=new DataView(ot.buffer,ot.byteOffset,ot.byteLength)),ve=ot.dataView,et=0}set position(t){et=t}get position(){return et}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}O_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,h_],od=[{pack(e,t,r){let n=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(e,t,r){if(this.setAsEmptyObject)return t(0),r({});let n=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([e.name,e.message,e.cause])}},{pack(e,t,r){let{target:n,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([e.source,e.flags])}},{pack(e,t){this.moreTypes?ad(e,16,t):cd(So?rr.from(e):new Uint8Array(e),t)}},{pack(e,t){let r=e.constructor;r!==I_&&this.moreTypes?ad(e,S_.indexOf(r.name),t):cd(e,t)}},{pack(e,t){this.moreTypes?ad(e,17,t):cd(So?rr.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:r,position:n}=t(1);r[n]=193}}];function ad(e,t,r,n){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function cd(e,t){let r=e.byteLength;var n,i;if(r<256){var{target:n,position:i}=t(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=t(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=t(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(e,i)}function C_(e,t,r,n){let i=e.length;switch(i){case 1:t[r++]=212;break;case 2:t[r++]=213;break;case 4:t[r++]=214;break;case 8:t[r++]=215;break;case 16:t[r++]=216;break;default:i<256?(t[r++]=199,t[r++]=i):i<65536?(t[r++]=200,t[r++]=i>>8,t[r++]=i&255):(t[r++]=201,t[r++]=i>>24,t[r++]=i>>16&255,t[r++]=i>>8&255,t[r++]=i&255)}return t[r++]=n,t.set(e,r),r+=i,r}function LC(e,t){let r,n=t.length*6,i=e.length-n;for(;r=t.pop();){let s=r.offset,o=r.id;e.copyWithin(s+n,s,i),n-=6;let a=s+n;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function L_(e,t,r){if(Fe.length>0){ve.setUint32(Fe.position+e,et+r-Fe.position-e),Fe.stringsPosition=et-e;let n=Fe;Fe=null,t(n[0]),t(n[1])}}function MC(e,t){return e.isCompatible=r=>{let n=!r||(t.lastNamedStructuresLength||0)===r.length;return n||t._mergeStructures(r),n},e}let M_=new CC({useRecords:!1});M_.pack,M_.pack;const UC=512,PC=1024,FC=2048;function Ne(){return null}function Oo(e,t,r={}){if(!w(e))return;const n=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=r[o];w(c)&&(a=c(a));const l=t[o];w(l)&&(o=l),a!==null&&n.push(o,a)}return n}function Ua(e,t,r={}){if(w(e))try{const n={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];w(a)&&(s=a);const c=r[s];w(c)&&(o=c(o)),n[s]=o}return n}catch(n){_e(lt,"","binary",n.message)}}function $C(e){try{return bC(e)}catch(t){_e(lt,"","binary",t.message)}}function U_(e){if(yt(e)){try{return JSON.parse(e)}catch(t){_e(lt,"","binary",t.message)}return}try{return SC(e)}catch(t){_e(lt,"","binary",t.message)}}function P_(){return{id:We()}}var Ol=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e[e.shootx=39]="shootx",e[e.shooty=40]="shooty",e))(Ol||{});function Il(e){return w(e==null?void 0:e.id)?Oo(e,Ol,{category:Ne,kinddata:Ne,stopped:Ne,removed:Ne,bucket:Ne}):Oo(e,Ol,{id:Ne,x:Ne,y:Ne,lx:Ne,ly:Ne,code:Ne,category:Ne,kinddata:Ne,stopped:Ne,removed:Ne,bucket:Ne})}function Nl(e){return Ua(e,Ol)}function Ye(e){return(e==null?void 0:e.category)===Nr.ISOBJECT}function Pa(e,t){if(!w(e)||!Cr(t))return;const{color:r,bg:n}=Ey(t);w(r)&&(e.color=r),w(n)&&(e.bg=n)}function F_(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function $_(e){const t=Math.floor(e.length/fl);if(t*fl!==e.length)return;const r=F_(3,t);for(let n=0;n<r.bits.length;++n)r.bits[n]=e[n];return r}function BC(e,t){return e&1<<t?255:0}function B_(e){const t=Math.floor(e.length/Mh);if(t*Mh!==e.length)return;const r=Math.ceil(t/hl),n=Ts*hl,i=F_(n,Ss*r);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Ss+a,u=e[c];for(let h=0;h<Ts;++h){const d=s*Ts+h;i.bits[d+l*n]=BC(u,7-h)}++a,a===Ss&&(a=0,++s,s===hl&&(s=0,++o))}return i}const DC=Mc("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),jC=Mc("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var D_=typeof ro=="object"&&ro&&ro.Object===Object&&ro,zC=typeof self=="object"&&self&&self.Object===Object&&self,oi=D_||zC||Function("return this")(),vn=oi.Symbol,j_=Object.prototype,WC=j_.hasOwnProperty,HC=j_.toString,Fa=vn?vn.toStringTag:void 0;function GC(e){var t=WC.call(e,Fa),r=e[Fa];try{e[Fa]=void 0;var n=!0}catch{}var i=HC.call(e);return n&&(t?e[Fa]=r:delete e[Fa]),i}var KC=Object.prototype,YC=KC.toString;function qC(e){return YC.call(e)}var VC="[object Null]",XC="[object Undefined]",z_=vn?vn.toStringTag:void 0;function Zi(e){return e==null?e===void 0?XC:VC:z_&&z_ in Object(e)?GC(e):qC(e)}function Bn(e){return e!=null&&typeof e=="object"}var JC="[object Symbol]";function Cl(e){return typeof e=="symbol"||Bn(e)&&Zi(e)==JC}function Ll(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var he=Array.isArray,W_=vn?vn.prototype:void 0,H_=W_?W_.toString:void 0;function G_(e){if(typeof e=="string")return e;if(he(e))return Ll(e,G_)+"";if(Cl(e))return H_?H_.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var ZC=/\s/;function QC(e){for(var t=e.length;t--&&ZC.test(e.charAt(t)););return t}var tL=/^\s+/;function eL(e){return e&&e.slice(0,QC(e)+1).replace(tL,"")}function En(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var K_=NaN,rL=/^[-+]0x[0-9a-f]+$/i,nL=/^0b[01]+$/i,iL=/^0o[0-7]+$/i,sL=parseInt;function oL(e){if(typeof e=="number")return e;if(Cl(e))return K_;if(En(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=En(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=eL(e);var r=nL.test(e);return r||iL.test(e)?sL(e.slice(2),r?2:8):rL.test(e)?K_:+e}var Y_=1/0,aL=17976931348623157e292;function cL(e){if(!e)return e===0?e:0;if(e=oL(e),e===Y_||e===-Y_){var t=e<0?-1:1;return t*aL}return e===e?e:0}function Ml(e){var t=cL(e),r=t%1;return t===t?r?t-r:t:0}function Io(e){return e}var lL="[object AsyncFunction]",uL="[object Function]",fL="[object GeneratorFunction]",hL="[object Proxy]";function Ri(e){if(!En(e))return!1;var t=Zi(e);return t==uL||t==fL||t==lL||t==hL}var ld=oi["__core-js_shared__"],q_=function(){var e=/[^.]+$/.exec(ld&&ld.keys&&ld.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function dL(e){return!!q_&&q_ in e}var pL=Function.prototype,mL=pL.toString;function Ns(e){if(e!=null){try{return mL.call(e)}catch{}try{return e+""}catch{}}return""}var gL=/[\\^$.*+?()[\]{}|]/g,yL=/^\[object .+?Constructor\]$/,_L=Function.prototype,bL=Object.prototype,wL=_L.toString,vL=bL.hasOwnProperty,EL=RegExp("^"+wL.call(vL).replace(gL,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kL(e){if(!En(e)||dL(e))return!1;var t=Ri(e)?EL:yL;return t.test(Ns(e))}function xL(e,t){return e==null?void 0:e[t]}function Cs(e,t){var r=xL(e,t);return kL(r)?r:void 0}var ud=Cs(oi,"WeakMap"),V_=Object.create,AL=function(){function e(){}return function(t){if(!En(t))return{};if(V_)return V_(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function TL(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function sr(){}function SL(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var RL=800,OL=16,IL=Date.now;function NL(e){var t=0,r=0;return function(){var n=IL(),i=OL-(n-r);if(r=n,i>0){if(++t>=RL)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function CL(e){return function(){return e}}var Ul=function(){try{var e=Cs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),LL=Ul?function(e,t){return Ul(e,"toString",{configurable:!0,enumerable:!1,value:CL(t),writable:!0})}:Io,ML=NL(LL);function X_(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function J_(e,t,r,n){for(var i=e.length,s=r+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function UL(e){return e!==e}function PL(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function fd(e,t,r){return t===t?PL(e,t,r):J_(e,UL,r)}function Z_(e,t){var r=e==null?0:e.length;return!!r&&fd(e,t,0)>-1}var FL=9007199254740991,$L=/^(?:0|[1-9]\d*)$/;function Pl(e,t){var r=typeof e;return t=t??FL,!!t&&(r=="number"||r!="symbol"&&$L.test(e))&&e>-1&&e%1==0&&e<t}function hd(e,t,r){t=="__proto__"&&Ul?Ul(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function $a(e,t){return e===t||e!==e&&t!==t}var BL=Object.prototype,DL=BL.hasOwnProperty;function Fl(e,t,r){var n=e[t];(!(DL.call(e,t)&&$a(n,r))||r===void 0&&!(t in e))&&hd(e,t,r)}function Ba(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?hd(r,a,c):Fl(r,a,c)}return r}var Q_=Math.max;function jL(e,t,r){return t=Q_(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,s=Q_(n.length-t,0),o=Array(s);++i<s;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=r(o),TL(e,this,a)}}function dd(e,t){return ML(jL(e,t,Io),e+"")}var zL=9007199254740991;function pd(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=zL}function ai(e){return e!=null&&pd(e.length)&&!Ri(e)}function tb(e,t,r){if(!En(r))return!1;var n=typeof t;return(n=="number"?ai(r)&&Pl(t,r.length):n=="string"&&t in r)?$a(r[t],e):!1}function WL(e){return dd(function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&tb(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var a=r[n];a&&e(t,a,n,s)}return t})}var HL=Object.prototype;function Da(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||HL;return e===r}function GL(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var KL="[object Arguments]";function eb(e){return Bn(e)&&Zi(e)==KL}var rb=Object.prototype,YL=rb.hasOwnProperty,qL=rb.propertyIsEnumerable,$l=eb(function(){return arguments}())?eb:function(e){return Bn(e)&&YL.call(e,"callee")&&!qL.call(e,"callee")};function VL(){return!1}var nb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ib=nb&&typeof module=="object"&&module&&!module.nodeType&&module,XL=ib&&ib.exports===nb,sb=XL?oi.Buffer:void 0,JL=sb?sb.isBuffer:void 0,ja=JL||VL,ZL="[object Arguments]",QL="[object Array]",t6="[object Boolean]",e6="[object Date]",r6="[object Error]",n6="[object Function]",i6="[object Map]",s6="[object Number]",o6="[object Object]",a6="[object RegExp]",c6="[object Set]",l6="[object String]",u6="[object WeakMap]",f6="[object ArrayBuffer]",h6="[object DataView]",d6="[object Float32Array]",p6="[object Float64Array]",m6="[object Int8Array]",g6="[object Int16Array]",y6="[object Int32Array]",_6="[object Uint8Array]",b6="[object Uint8ClampedArray]",w6="[object Uint16Array]",v6="[object Uint32Array]",Se={};Se[d6]=Se[p6]=Se[m6]=Se[g6]=Se[y6]=Se[_6]=Se[b6]=Se[w6]=Se[v6]=!0,Se[ZL]=Se[QL]=Se[f6]=Se[t6]=Se[h6]=Se[e6]=Se[r6]=Se[n6]=Se[i6]=Se[s6]=Se[o6]=Se[a6]=Se[c6]=Se[l6]=Se[u6]=!1;function E6(e){return Bn(e)&&pd(e.length)&&!!Se[Zi(e)]}function Bl(e){return function(t){return e(t)}}var ob=typeof exports=="object"&&exports&&!exports.nodeType&&exports,za=ob&&typeof module=="object"&&module&&!module.nodeType&&module,k6=za&&za.exports===ob,md=k6&&D_.process,Qi=function(){try{var e=za&&za.require&&za.require("util").types;return e||md&&md.binding&&md.binding("util")}catch{}}(),ab=Qi&&Qi.isTypedArray,gd=ab?Bl(ab):E6,x6=Object.prototype,A6=x6.hasOwnProperty;function cb(e,t){var r=he(e),n=!r&&$l(e),i=!r&&!n&&ja(e),s=!r&&!n&&!i&&gd(e),o=r||n||i||s,a=o?GL(e.length,String):[],c=a.length;for(var l in e)(t||A6.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Pl(l,c)))&&a.push(l);return a}function lb(e,t){return function(r){return e(t(r))}}var T6=lb(Object.keys,Object),S6=Object.prototype,R6=S6.hasOwnProperty;function ub(e){if(!Da(e))return T6(e);var t=[];for(var r in Object(e))R6.call(e,r)&&r!="constructor"&&t.push(r);return t}function kn(e){return ai(e)?cb(e):ub(e)}var O6=Object.prototype,I6=O6.hasOwnProperty,Yr=WL(function(e,t){if(Da(t)||ai(t)){Ba(t,kn(t),e);return}for(var r in t)I6.call(t,r)&&Fl(e,r,t[r])});function N6(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var C6=Object.prototype,L6=C6.hasOwnProperty;function M6(e){if(!En(e))return N6(e);var t=Da(e),r=[];for(var n in e)n=="constructor"&&(t||!L6.call(e,n))||r.push(n);return r}function yd(e){return ai(e)?cb(e,!0):M6(e)}var U6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,P6=/^\w*$/;function _d(e,t){if(he(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Cl(e)?!0:P6.test(e)||!U6.test(e)||t!=null&&e in Object(t)}var Wa=Cs(Object,"create");function F6(){this.__data__=Wa?Wa(null):{},this.size=0}function $6(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var B6="__lodash_hash_undefined__",D6=Object.prototype,j6=D6.hasOwnProperty;function z6(e){var t=this.__data__;if(Wa){var r=t[e];return r===B6?void 0:r}return j6.call(t,e)?t[e]:void 0}var W6=Object.prototype,H6=W6.hasOwnProperty;function G6(e){var t=this.__data__;return Wa?t[e]!==void 0:H6.call(t,e)}var K6="__lodash_hash_undefined__";function Y6(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Wa&&t===void 0?K6:t,this}function Ls(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ls.prototype.clear=F6,Ls.prototype.delete=$6,Ls.prototype.get=z6,Ls.prototype.has=G6,Ls.prototype.set=Y6;function q6(){this.__data__=[],this.size=0}function Dl(e,t){for(var r=e.length;r--;)if($a(e[r][0],t))return r;return-1}var V6=Array.prototype,X6=V6.splice;function J6(e){var t=this.__data__,r=Dl(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():X6.call(t,r,1),--this.size,!0}function Z6(e){var t=this.__data__,r=Dl(t,e);return r<0?void 0:t[r][1]}function Q6(e){return Dl(this.__data__,e)>-1}function tM(e,t){var r=this.__data__,n=Dl(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Oi(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Oi.prototype.clear=q6,Oi.prototype.delete=J6,Oi.prototype.get=Z6,Oi.prototype.has=Q6,Oi.prototype.set=tM;var Ha=Cs(oi,"Map");function eM(){this.size=0,this.__data__={hash:new Ls,map:new(Ha||Oi),string:new Ls}}function rM(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function jl(e,t){var r=e.__data__;return rM(t)?r[typeof t=="string"?"string":"hash"]:r.map}function nM(e){var t=jl(this,e).delete(e);return this.size-=t?1:0,t}function iM(e){return jl(this,e).get(e)}function sM(e){return jl(this,e).has(e)}function oM(e,t){var r=jl(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Ii(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ii.prototype.clear=eM,Ii.prototype.delete=nM,Ii.prototype.get=iM,Ii.prototype.has=sM,Ii.prototype.set=oM;var aM="Expected a function";function bd(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(aM);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(bd.Cache||Ii),r}bd.Cache=Ii;var cM=500;function lM(e){var t=bd(e,function(n){return r.size===cM&&r.clear(),n}),r=t.cache;return t}var uM=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fM=/\\(\\)?/g,hM=lM(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(uM,function(r,n,i,s){t.push(i?s.replace(fM,"$1"):n||r)}),t});function fb(e){return e==null?"":G_(e)}function zl(e,t){return he(e)?e:_d(e,t)?[e]:hM(fb(e))}function Ga(e){if(typeof e=="string"||Cl(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function wd(e,t){t=zl(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ga(t[r++])];return r&&r==n?e:void 0}function dM(e,t,r){var n=e==null?void 0:wd(e,t);return n===void 0?r:n}function vd(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var hb=vn?vn.isConcatSpreadable:void 0;function pM(e){return he(e)||$l(e)||!!(hb&&e&&e[hb])}function Ed(e,t,r,n,i){var s=-1,o=e.length;for(r||(r=pM),i||(i=[]);++s<o;){var a=e[s];r(a)?vd(i,a):n||(i[i.length]=a)}return i}function ln(e){var t=e==null?0:e.length;return t?Ed(e):[]}var db=lb(Object.getPrototypeOf,Object);function kd(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function mM(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:kd(e,t,r)}var gM="\\ud800-\\udfff",yM="\\u0300-\\u036f",_M="\\ufe20-\\ufe2f",bM="\\u20d0-\\u20ff",wM=yM+_M+bM,vM="\\ufe0e\\ufe0f",EM="\\u200d",kM=RegExp("["+EM+gM+wM+vM+"]");function pb(e){return kM.test(e)}function xM(e){return e.split("")}var mb="\\ud800-\\udfff",AM="\\u0300-\\u036f",TM="\\ufe20-\\ufe2f",SM="\\u20d0-\\u20ff",RM=AM+TM+SM,OM="\\ufe0e\\ufe0f",IM="["+mb+"]",xd="["+RM+"]",Ad="\\ud83c[\\udffb-\\udfff]",NM="(?:"+xd+"|"+Ad+")",gb="[^"+mb+"]",yb="(?:\\ud83c[\\udde6-\\uddff]){2}",_b="[\\ud800-\\udbff][\\udc00-\\udfff]",CM="\\u200d",bb=NM+"?",wb="["+OM+"]?",LM="(?:"+CM+"(?:"+[gb,yb,_b].join("|")+")"+wb+bb+")*",MM=wb+bb+LM,UM="(?:"+[gb+xd+"?",xd,yb,_b,IM].join("|")+")",PM=RegExp(Ad+"(?="+Ad+")|"+UM+MM,"g");function FM(e){return e.match(PM)||[]}function $M(e){return pb(e)?FM(e):xM(e)}function BM(e){return function(t){t=fb(t);var r=pb(t)?$M(t):void 0,n=r?r[0]:t.charAt(0),i=r?mM(r,1).join(""):t.slice(1);return n[e]()+i}}var vb=BM("toUpperCase");function DM(e,t,r,n){var i=-1,s=e==null?0:e.length;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function jM(){this.__data__=new Oi,this.size=0}function zM(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function WM(e){return this.__data__.get(e)}function HM(e){return this.__data__.has(e)}var GM=200;function KM(e,t){var r=this.__data__;if(r instanceof Oi){var n=r.__data__;if(!Ha||n.length<GM-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ii(n)}return r.set(e,t),this.size=r.size,this}function ci(e){var t=this.__data__=new Oi(e);this.size=t.size}ci.prototype.clear=jM,ci.prototype.delete=zM,ci.prototype.get=WM,ci.prototype.has=HM,ci.prototype.set=KM;function YM(e,t){return e&&Ba(t,kn(t),e)}function qM(e,t){return e&&Ba(t,yd(t),e)}var Eb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kb=Eb&&typeof module=="object"&&module&&!module.nodeType&&module,VM=kb&&kb.exports===Eb,xb=VM?oi.Buffer:void 0,Ab=xb?xb.allocUnsafe:void 0;function XM(e,t){var r=e.length,n=Ab?Ab(r):new e.constructor(r);return e.copy(n),n}function Td(e,t){for(var r=-1,n=e==null?0:e.length,i=0,s=[];++r<n;){var o=e[r];t(o,r,e)&&(s[i++]=o)}return s}function Tb(){return[]}var JM=Object.prototype,ZM=JM.propertyIsEnumerable,Sb=Object.getOwnPropertySymbols,Sd=Sb?function(e){return e==null?[]:(e=Object(e),Td(Sb(e),function(t){return ZM.call(e,t)}))}:Tb;function QM(e,t){return Ba(e,Sd(e),t)}var t2=Object.getOwnPropertySymbols,Rb=t2?function(e){for(var t=[];e;)vd(t,Sd(e)),e=db(e);return t}:Tb;function e2(e,t){return Ba(e,Rb(e),t)}function Ob(e,t,r){var n=t(e);return he(e)?n:vd(n,r(e))}function Rd(e){return Ob(e,kn,Sd)}function r2(e){return Ob(e,yd,Rb)}var Od=Cs(oi,"DataView"),Id=Cs(oi,"Promise"),No=Cs(oi,"Set"),Ib="[object Map]",n2="[object Object]",Nb="[object Promise]",Cb="[object Set]",Lb="[object WeakMap]",Mb="[object DataView]",i2=Ns(Od),s2=Ns(Ha),o2=Ns(Id),a2=Ns(No),c2=Ns(ud),xn=Zi;(Od&&xn(new Od(new ArrayBuffer(1)))!=Mb||Ha&&xn(new Ha)!=Ib||Id&&xn(Id.resolve())!=Nb||No&&xn(new No)!=Cb||ud&&xn(new ud)!=Lb)&&(xn=function(e){var t=Zi(e),r=t==n2?e.constructor:void 0,n=r?Ns(r):"";if(n)switch(n){case i2:return Mb;case s2:return Ib;case o2:return Nb;case a2:return Cb;case c2:return Lb}return t});var l2=Object.prototype,u2=l2.hasOwnProperty;function f2(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&u2.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Wl=oi.Uint8Array;function h2(e){var t=new e.constructor(e.byteLength);return new Wl(t).set(new Wl(e)),t}function d2(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var p2=/\w*$/;function m2(e){var t=new e.constructor(e.source,p2.exec(e));return t.lastIndex=e.lastIndex,t}var Ub=vn?vn.prototype:void 0,Pb=Ub?Ub.valueOf:void 0;function g2(e){return Pb?Object(Pb.call(e)):{}}function y2(e,t){var r=e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var _2="[object Boolean]",b2="[object Date]",w2="[object Map]",v2="[object Number]",E2="[object RegExp]",k2="[object Set]",x2="[object String]",A2="[object Symbol]",T2="[object ArrayBuffer]",S2="[object DataView]",R2="[object Float32Array]",O2="[object Float64Array]",I2="[object Int8Array]",N2="[object Int16Array]",C2="[object Int32Array]",L2="[object Uint8Array]",M2="[object Uint8ClampedArray]",U2="[object Uint16Array]",P2="[object Uint32Array]";function F2(e,t,r){var n=e.constructor;switch(t){case T2:return h2(e);case _2:case b2:return new n(+e);case S2:return d2(e);case R2:case O2:case I2:case N2:case C2:case L2:case M2:case U2:case P2:return y2(e);case w2:return new n;case v2:case x2:return new n(e);case E2:return m2(e);case k2:return new n;case A2:return g2(e)}}function $2(e){return typeof e.constructor=="function"&&!Da(e)?AL(db(e)):{}}var B2="[object Map]";function D2(e){return Bn(e)&&xn(e)==B2}var Fb=Qi&&Qi.isMap,j2=Fb?Bl(Fb):D2,z2="[object Set]";function W2(e){return Bn(e)&&xn(e)==z2}var $b=Qi&&Qi.isSet,H2=$b?Bl($b):W2,G2=2,Bb="[object Arguments]",K2="[object Array]",Y2="[object Boolean]",q2="[object Date]",V2="[object Error]",Db="[object Function]",X2="[object GeneratorFunction]",J2="[object Map]",Z2="[object Number]",jb="[object Object]",Q2="[object RegExp]",t3="[object Set]",e3="[object String]",r3="[object Symbol]",n3="[object WeakMap]",i3="[object ArrayBuffer]",s3="[object DataView]",o3="[object Float32Array]",a3="[object Float64Array]",c3="[object Int8Array]",l3="[object Int16Array]",u3="[object Int32Array]",f3="[object Uint8Array]",h3="[object Uint8ClampedArray]",d3="[object Uint16Array]",p3="[object Uint32Array]",xe={};xe[Bb]=xe[K2]=xe[i3]=xe[s3]=xe[Y2]=xe[q2]=xe[o3]=xe[a3]=xe[c3]=xe[l3]=xe[u3]=xe[J2]=xe[Z2]=xe[jb]=xe[Q2]=xe[t3]=xe[e3]=xe[r3]=xe[f3]=xe[h3]=xe[d3]=xe[p3]=!0,xe[V2]=xe[Db]=xe[n3]=!1;function Hl(e,t,r,n,i,s){var o,a=t&G2;if(o!==void 0)return o;if(!En(e))return e;var c=he(e);if(c)return o=f2(e),SL(e,o);var l=xn(e),u=l==Db||l==X2;if(ja(e))return XM(e);if(l==jb||l==Bb||u&&!i)return o=u?{}:$2(e),a?e2(e,qM(o,e)):QM(e,YM(o,e));if(!xe[l])return i?e:{};o=F2(e,l),s||(s=new ci);var h=s.get(e);if(h)return h;s.set(e,o),H2(e)?e.forEach(function(p){o.add(Hl(p,t,r,p,e,s))}):j2(e)&&e.forEach(function(p,m){o.set(m,Hl(p,t,r,m,e,s))});var d=Rd,f=c?void 0:d(e);return X_(f||e,function(p,m){f&&(m=p,p=e[m]),Fl(o,m,Hl(p,t,r,m,e,s))}),o}var m3=4;function Er(e){return Hl(e,m3)}function Ka(e){for(var t=-1,r=e==null?0:e.length,n=0,i=[];++t<r;){var s=e[t];s&&(i[n++]=s)}return i}var g3="__lodash_hash_undefined__";function y3(e){return this.__data__.set(e,g3),this}function _3(e){return this.__data__.has(e)}function Co(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ii;++t<r;)this.add(e[t])}Co.prototype.add=Co.prototype.push=y3,Co.prototype.has=_3;function zb(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Nd(e,t){return e.has(t)}var b3=1,w3=2;function Wb(e,t,r,n,i,s){var o=r&b3,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=r&w3?new Co:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],m=t[h];if(n)var g=o?n(m,p,h,t,e,s):n(p,m,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(f){if(!zb(t,function(y,b){if(!Nd(f,b)&&(p===y||i(p,y,r,n,s)))return f.push(b)})){d=!1;break}}else if(!(p===m||i(p,m,r,n,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function v3(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function Cd(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var E3=1,k3=2,x3="[object Boolean]",A3="[object Date]",T3="[object Error]",S3="[object Map]",R3="[object Number]",O3="[object RegExp]",I3="[object Set]",N3="[object String]",C3="[object Symbol]",L3="[object ArrayBuffer]",M3="[object DataView]",Hb=vn?vn.prototype:void 0,Ld=Hb?Hb.valueOf:void 0;function U3(e,t,r,n,i,s,o){switch(r){case M3:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case L3:return!(e.byteLength!=t.byteLength||!s(new Wl(e),new Wl(t)));case x3:case A3:case R3:return $a(+e,+t);case T3:return e.name==t.name&&e.message==t.message;case O3:case N3:return e==t+"";case S3:var a=v3;case I3:var c=n&E3;if(a||(a=Cd),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;n|=k3,o.set(e,t);var u=Wb(a(e),a(t),n,i,s,o);return o.delete(e),u;case C3:if(Ld)return Ld.call(e)==Ld.call(t)}return!1}var P3=1,F3=Object.prototype,$3=F3.hasOwnProperty;function B3(e,t,r,n,i,s){var o=r&P3,a=Rd(e),c=a.length,l=Rd(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:$3.call(t,d)))return!1}var f=s.get(e),p=s.get(t);if(f&&p)return f==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=o;++h<c;){d=a[h];var y=e[d],b=t[d];if(n)var A=o?n(b,y,d,t,e,s):n(y,b,d,e,t,s);if(!(A===void 0?y===b||i(y,b,r,n,s):A)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var T=e.constructor,k=t.constructor;T!=k&&"constructor"in e&&"constructor"in t&&!(typeof T=="function"&&T instanceof T&&typeof k=="function"&&k instanceof k)&&(m=!1)}return s.delete(e),s.delete(t),m}var D3=1,Gb="[object Arguments]",Kb="[object Array]",Gl="[object Object]",j3=Object.prototype,Yb=j3.hasOwnProperty;function z3(e,t,r,n,i,s){var o=he(e),a=he(t),c=o?Kb:xn(e),l=a?Kb:xn(t);c=c==Gb?Gl:c,l=l==Gb?Gl:l;var u=c==Gl,h=l==Gl,d=c==l;if(d&&ja(e)){if(!ja(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ci),o||gd(e)?Wb(e,t,r,n,i,s):U3(e,t,c,r,n,i,s);if(!(r&D3)){var f=u&&Yb.call(e,"__wrapped__"),p=h&&Yb.call(t,"__wrapped__");if(f||p){var m=f?e.value():e,g=p?t.value():t;return s||(s=new ci),i(m,g,r,n,s)}}return d?(s||(s=new ci),B3(e,t,r,n,i,s)):!1}function Md(e,t,r,n,i){return e===t?!0:e==null||t==null||!Bn(e)&&!Bn(t)?e!==e&&t!==t:z3(e,t,r,n,Md,i)}var W3=1,H3=2;function G3(e,t,r,n){var i=r.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=r[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=r[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ci,h;if(!(h===void 0?Md(l,c,W3|H3,n,u):h))return!1}}return!0}function qb(e){return e===e&&!En(e)}function K3(e){for(var t=kn(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,qb(i)]}return t}function Vb(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function Y3(e){var t=K3(e);return t.length==1&&t[0][2]?Vb(t[0][0],t[0][1]):function(r){return r===e||G3(r,e,t)}}function q3(e,t){return e!=null&&t in Object(e)}function Xb(e,t,r){t=zl(t,e);for(var n=-1,i=t.length,s=!1;++n<i;){var o=Ga(t[n]);if(!(s=e!=null&&r(e,o)))break;e=e[o]}return s||++n!=i?s:(i=e==null?0:e.length,!!i&&pd(i)&&Pl(o,i)&&(he(e)||$l(e)))}function V3(e,t){return e!=null&&Xb(e,t,q3)}var X3=1,J3=2;function Z3(e,t){return _d(e)&&qb(t)?Vb(Ga(e),t):function(r){var n=dM(r,e);return n===void 0&&n===t?V3(r,e):Md(t,n,X3|J3)}}function Q3(e){return function(t){return t==null?void 0:t[e]}}function t8(e){return function(t){return wd(t,e)}}function e8(e){return _d(e)?Q3(Ga(e)):t8(e)}function li(e){return typeof e=="function"?e:e==null?Io:typeof e=="object"?he(e)?Z3(e[0],e[1]):Y3(e):e8(e)}function r8(e,t,r,n){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(n,o,r(o),e)}return n}function n8(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return t}}var i8=n8();function s8(e,t){return e&&i8(e,t,kn)}function o8(e,t){return function(r,n){if(r==null)return r;if(!ai(r))return e(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var Ms=o8(s8);function a8(e,t,r,n){return Ms(e,function(i,s,o){t(n,i,r(i),o)}),n}function c8(e,t){return function(r,n){var i=he(r)?r8:a8,s=t?t():{};return i(r,e,li(n),s)}}var Jb=Object.prototype,l8=Jb.hasOwnProperty,Ud=dd(function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&tb(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=yd(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||$a(u,Jb[l])&&!l8.call(e,l))&&(e[l]=s[l])}return e});function Zb(e){return Bn(e)&&ai(e)}var u8=200;function f8(e,t,r,n){var i=-1,s=Z_,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=u8&&(s=Nd,o=!1,t=new Co(t));t:for(;++i<a;){var u=e[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else s(t,h,n)||c.push(u)}return c}var Kl=dd(function(e,t){return Zb(e)?f8(e,Ed(t,1,Zb,!0)):[]});function Lo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function kr(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Ml(t),kd(e,t<0?0:t,n)):[]}function Ya(e,t,r){var n=e==null?0:e.length;return n?(t=t===void 0?1:Ml(t),t=n-t,kd(e,0,t<0?0:t)):[]}function h8(e){return typeof e=="function"?e:Io}function Kt(e,t){var r=he(e)?X_:Ms;return r(e,h8(t))}function d8(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function p8(e,t){var r=!0;return Ms(e,function(n,i,s){return r=!!t(n,i,s),r}),r}function Dn(e,t,r){var n=he(e)?d8:p8;return n(e,li(t))}function Qb(e,t){var r=[];return Ms(e,function(n,i,s){t(n,i,s)&&r.push(n)}),r}function An(e,t){var r=he(e)?Td:Qb;return r(e,li(t))}function m8(e){return function(t,r,n){var i=Object(t);if(!ai(t)){var s=li(r);t=kn(t),r=function(a){return s(i[a],a,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:void 0}}var g8=Math.max;function y8(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:Ml(r);return i<0&&(i=g8(n+i,0)),J_(e,li(t),i)}var Mo=m8(y8);function jn(e){return e&&e.length?e[0]:void 0}function _8(e,t){var r=-1,n=ai(e)?Array(e.length):[];return Ms(e,function(i,s,o){n[++r]=t(i,s,o)}),n}function Lt(e,t){var r=he(e)?Ll:_8;return r(e,li(t))}function Tn(e,t){return Ed(Lt(e,t))}var b8=Object.prototype,w8=b8.hasOwnProperty,t1=c8(function(e,t,r){w8.call(e,r)?e[r].push(t):hd(e,r,[t])}),v8=Object.prototype,E8=v8.hasOwnProperty;function k8(e,t){return e!=null&&E8.call(e,t)}function Ht(e,t){return e!=null&&Xb(e,t,k8)}var x8="[object String]";function qr(e){return typeof e=="string"||!he(e)&&Bn(e)&&Zi(e)==x8}function A8(e,t){return Ll(t,function(r){return e[r]})}function Je(e){return e==null?[]:A8(e,kn(e))}var T8=Math.max;function Mr(e,t,r,n){e=ai(e)?e:Je(e),r=r?Ml(r):0;var i=e.length;return r<0&&(r=T8(i+r,0)),qr(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&fd(e,t,r)>-1}function e1(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=0;return fd(e,t,i)}var S8="[object Map]",R8="[object Set]",O8=Object.prototype,I8=O8.hasOwnProperty;function Ae(e){if(e==null)return!0;if(ai(e)&&(he(e)||typeof e=="string"||typeof e.splice=="function"||ja(e)||gd(e)||$l(e)))return!e.length;var t=xn(e);if(t==S8||t==R8)return!e.size;if(Da(e))return!ub(e).length;for(var r in e)if(I8.call(e,r))return!1;return!0}var N8="[object RegExp]";function C8(e){return Bn(e)&&Zi(e)==N8}var r1=Qi&&Qi.isRegExp,Ni=r1?Bl(r1):C8;function Ci(e){return e===void 0}var L8="Expected a function";function M8(e){if(typeof e!="function")throw new TypeError(L8);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function U8(e,t,r,n){if(!En(e))return e;t=zl(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ga(t[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=En(u)?u:Pl(t[i+1])?[]:{})}Fl(a,c,l),a=a[c]}return e}function P8(e,t,r){for(var n=-1,i=t.length,s={};++n<i;){var o=t[n],a=wd(e,o);r(a,o)&&U8(s,zl(o,e),a)}return s}function zn(e,t){if(e==null)return{};var r=Ll(r2(e),function(n){return[n]});return t=li(t),P8(e,r,function(n,i){return t(n,i[0])})}function F8(e,t,r,n,i){return i(e,function(s,o,a){r=n?(n=!1,s):t(r,s,o,a)}),r}function Vr(e,t,r){var n=he(e)?DM:F8,i=arguments.length<3;return n(e,li(t),r,i,Ms)}function Yl(e,t){var r=he(e)?Td:Qb;return r(e,M8(li(t)))}function $8(e,t){var r;return Ms(e,function(n,i,s){return r=t(n,i,s),!r}),!!r}function Pd(e,t,r){var n=he(e)?zb:$8;return n(e,li(t))}var B8=1/0,D8=No&&1/Cd(new No([,-0]))[1]==B8?function(e){return new No(e)}:sr,j8=200;function z8(e,t,r){var n=-1,i=Z_,s=e.length,o=!0,a=[],c=a;if(s>=j8){var l=D8(e);if(l)return Cd(l);o=!1,i=Nd,c=new Co}else c=a;t:for(;++n<s;){var u=e[n],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else i(c,h,r)||(c!==a&&c.push(h),a.push(u))}return a}function ql(e){return e&&e.length?z8(e):[]}function Fd(e){console&&console.error&&console.error(`Error: ${e}`)}function n1(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function i1(e){const t=new Date().getTime(),r=e();return{time:new Date().getTime()-t,value:r}}function s1(e){function t(){}t.prototype=e;const r=new t;function n(){return typeof r.bar}return n(),n(),e}function W8(e){return H8(e)?e.LABEL:e.name}function H8(e){return qr(e.LABEL)&&e.LABEL!==""}class ui{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Kt(this.definition,r=>{r.accept(t)})}}class Xr extends ui{constructor(t){super([]),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Uo extends ui{constructor(t){super(t.definition),this.orgText="",Yr(this,zn(t,r=>r!==void 0))}}class Jr extends ui{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Yr(this,zn(t,r=>r!==void 0))}}class Zr extends ui{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class fi extends ui{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class hi extends ui{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class or extends ui{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class Wn extends ui{constructor(t){super(t.definition),this.idx=1,Yr(this,zn(t,r=>r!==void 0))}}class Hn extends ui{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Yr(this,zn(t,r=>r!==void 0))}}class $e{constructor(t){this.idx=1,Yr(this,zn(t,r=>r!==void 0))}accept(t){t.visit(this)}}function G8(e){return Lt(e,Vl)}function Vl(e){function t(r){return Lt(r,Vl)}if(e instanceof Xr){const r={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return qr(e.label)&&(r.label=e.label),r}else{if(e instanceof Jr)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Zr)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof fi)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof hi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Vl(new $e({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Wn)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Vl(new $e({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof or)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Hn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof $e){const r={type:"Terminal",name:e.terminalType.name,label:W8(e.terminalType),idx:e.idx};qr(e.label)&&(r.terminalLabel=e.label);const n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=Ni(n)?n.source:n),r}else{if(e instanceof Uo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Us{visit(t){const r=t;switch(r.constructor){case Xr:return this.visitNonTerminal(r);case Jr:return this.visitAlternative(r);case Zr:return this.visitOption(r);case fi:return this.visitRepetitionMandatory(r);case hi:return this.visitRepetitionMandatoryWithSeparator(r);case Wn:return this.visitRepetitionWithSeparator(r);case or:return this.visitRepetition(r);case Hn:return this.visitAlternation(r);case $e:return this.visitTerminal(r);case Uo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function K8(e){return e instanceof Jr||e instanceof Zr||e instanceof or||e instanceof fi||e instanceof hi||e instanceof Wn||e instanceof $e||e instanceof Uo}function Xl(e,t=[]){return e instanceof Zr||e instanceof or||e instanceof Wn?!0:e instanceof Hn?Pd(e.definition,n=>Xl(n,t)):e instanceof Xr&&Mr(t,e)?!1:e instanceof ui?(e instanceof Xr&&t.push(e),Dn(e.definition,n=>Xl(n,t))):!1}function Y8(e){return e instanceof Hn}function di(e){if(e instanceof Xr)return"SUBRULE";if(e instanceof Zr)return"OPTION";if(e instanceof Hn)return"OR";if(e instanceof fi)return"AT_LEAST_ONE";if(e instanceof hi)return"AT_LEAST_ONE_SEP";if(e instanceof Wn)return"MANY_SEP";if(e instanceof or)return"MANY";if(e instanceof $e)return"CONSUME";throw Error("non exhaustive match")}class Jl{walk(t,r=[]){Kt(t.definition,(n,i)=>{const s=kr(t.definition,i+1);if(n instanceof Xr)this.walkProdRef(n,s,r);else if(n instanceof $e)this.walkTerminal(n,s,r);else if(n instanceof Jr)this.walkFlat(n,s,r);else if(n instanceof Zr)this.walkOption(n,s,r);else if(n instanceof fi)this.walkAtLeastOne(n,s,r);else if(n instanceof hi)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Wn)this.walkManySep(n,s,r);else if(n instanceof or)this.walkMany(n,s,r);else if(n instanceof Hn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(t,r,n){}walkProdRef(t,r,n){}walkFlat(t,r,n){const i=r.concat(n);this.walk(t,i)}walkOption(t,r,n){const i=r.concat(n);this.walk(t,i)}walkAtLeastOne(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkAtLeastOneSep(t,r,n){const i=o1(t,r,n);this.walk(t,i)}walkMany(t,r,n){const i=[new Zr({definition:t.definition})].concat(r,n);this.walk(t,i)}walkManySep(t,r,n){const i=o1(t,r,n);this.walk(t,i)}walkOr(t,r,n){const i=r.concat(n);Kt(t.definition,s=>{const o=new Jr({definition:[s]});this.walk(o,i)})}}function o1(e,t,r){return[new Zr({definition:[new $e({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}function qa(e){if(e instanceof Xr)return qa(e.referencedRule);if(e instanceof $e)return X8(e);if(K8(e))return q8(e);if(Y8(e))return V8(e);throw Error("non exhaustive match")}function q8(e){let t=[];const r=e.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Xl(s),t=t.concat(qa(s)),n=n+1,i=r.length>n;return ql(t)}function V8(e){const t=Lt(e.definition,r=>qa(r));return ql(ln(t))}function X8(e){return[e.terminalType]}const a1="_~IN~_";class J8 extends Jl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,r,n){}walkProdRef(t,r,n){const i=Q8(t.referencedRule,t.idx)+this.topProd.name,s=r.concat(n),o=new Jr({definition:s}),a=qa(o);this.follows[i]=a}}function Z8(e){const t={};return Kt(e,r=>{const n=new J8(r).startWalking();Yr(t,n)}),t}function Q8(e,t){return e.name+t+a1}function Yt(e){return e.charCodeAt(0)}function $d(e,t){Array.isArray(e)?e.forEach(function(r){t.push(r)}):t.push(e)}function Va(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Po(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function tU(){throw Error("Internal Error - Should never get here!")}function c1(e){return e.type==="Character"}const Zl=[];for(let e=Yt("0");e<=Yt("9");e++)Zl.push(e);const Ql=[Yt("_")].concat(Zl);for(let e=Yt("a");e<=Yt("z");e++)Ql.push(e);for(let e=Yt("A");e<=Yt("Z");e++)Ql.push(e);const l1=[Yt(" "),Yt("\f"),Yt(`
`),Yt("\r"),Yt("	"),Yt("\v"),Yt("	"),Yt("Â "),Yt("á"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("â"),Yt("\u2028"),Yt("\u2029"),Yt("â¯"),Yt("â"),Yt("ã"),Yt("\uFEFF")],eU=/[0-9a-fA-F]/,tu=/[0-9]/,rU=/[1-9]/;class nU{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Va(n,"global");break;case"i":Va(n,"ignoreCase");break;case"m":Va(n,"multiLine");break;case"u":Va(n,"unicode");break;case"y":Va(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const t=[],r=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(r)}}alternative(){const t=[],r=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}Po(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(t)}}return tU()}quantifier(t=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&r===void 0)return;Po(r);break}if(!(t===!0&&r===void 0)&&Po(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let t;const r=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Po(t))return t.loc=this.loc(r),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Yt(`
`),Yt("\r"),Yt("\u2028"),Yt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,r=!1;switch(this.popChar()){case"d":t=Zl;break;case"D":t=Zl,r=!0;break;case"s":t=l1;break;case"S":t=l1,r=!0;break;case"w":t=Ql;break;case"W":t=Ql,r=!0;break}if(Po(t))return{type:"Set",value:t,complement:r}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Yt("\f");break;case"n":t=Yt(`
`);break;case"r":t=Yt("\r");break;case"t":t=Yt("	");break;case"v":t=Yt("\v");break}if(Po(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Yt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Yt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Yt(t)}}}characterClass(){const t=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,c1(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,c1(i)){if(i.value<n.value)throw Error("Range out of order in character class");t.push({from:n.value,to:i.value})}else $d(n.value,t),t.push(Yt("-")),$d(i.value,t)}else $d(n.value,t)}return this.consumeChar("]"),{type:"Set",complement:r,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Yt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:t,value:r};return t&&(n.idx=this.groupIdx),n}positiveInteger(){let t=this.popChar();if(rU.test(t)===!1)throw Error("Expecting a positive integer");for(;tu.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(tu.test(t)===!1)throw Error("Expecting an integer");for(;tu.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Yt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return tu.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let r="";for(let i=0;i<t;i++){const s=this.popChar();if(eU.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Bd{visitChildren(t){for(const r in t){const n=t[r];t.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let eu={};const iU=new nU;function ru(e){const t=e.toString();if(eu.hasOwnProperty(t))return eu[t];{const r=iU.pattern(t);return eu[t]=r,r}}function sU(){eu={}}const u1="Complement Sets are not supported for first char optimization",nu=`Unable to use "first char" lexer optimizations:
`;function oU(e,t=!1){try{const r=ru(e);return Dd(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===u1)t&&n1(`${nu}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";t&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Fd(`${nu}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Dd(e,t,r){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Dd(e.value[i],t,r);break;case"Alternative":const n=e.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":iu(o.value,t,r);break;case"Set":if(o.complement===!0)throw Error(u1);Kt(o.value,c=>{if(typeof c=="number")iu(c,t,r);else{const l=c;if(r===!0)for(let u=l.from;u<=l.to;u++)iu(u,t,r);else{for(let u=l.from;u<=l.to&&u<Ja;u++)iu(u,t,r);if(l.to>=Ja){const u=l.from>=Ja?l.from:Ja,h=l.to,d=ts(u),f=ts(h);for(let p=d;p<=f;p++)t[p]=p}}}});break;case"Group":Dd(o.value,t,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&jd(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Je(t)}function iu(e,t,r){const n=ts(e);t[n]=n,r===!0&&aU(e,t)}function aU(e,t){const r=String.fromCharCode(e),n=r.toUpperCase();if(n!==r){const i=ts(n.charCodeAt(0));t[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=ts(i.charCodeAt(0));t[s]=s}}}function f1(e,t){return Mo(e.value,r=>{if(typeof r=="number")return Mr(t,r);{const n=r;return Mo(t,i=>n.from<=i&&i<=n.to)!==void 0}})}function jd(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?he(e.value)?Dn(e.value,jd):jd(e.value):!1}class cU extends Bd{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Mr(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?f1(t,this.targetCharCodes)===void 0&&(this.found=!0):f1(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function zd(e,t){if(t instanceof RegExp){const r=ru(t),n=new cU(e);return n.visit(r),n.found}else return Mo(t,r=>Mr(e,r.charCodeAt(0)))!==void 0}const Ps="PATTERN",Xa="defaultMode",su="modes";let h1=typeof new RegExp("(?:)").sticky=="boolean";function lU(e,t){t=Ud(t,{useSticky:h1,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,A)=>A()});const r=t.tracer;r("initCharCodeToOptimizedIndexMap",()=>{CU()});let n;r("Reject Lexer.NA",()=>{n=Yl(e,b=>b[Ps]===mr.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=Lt(n,b=>{const A=b[Ps];if(Ni(A)){const T=A.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!A.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Mr(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:t.useSticky?p1(A):d1(A)}else{if(Ri(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const T=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),k=new RegExp(T);return t.useSticky?p1(k):d1(k)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;r("misc mapping",()=>{o=Lt(n,b=>b.tokenTypeIdx),a=Lt(n,b=>{const A=b.GROUP;if(A!==mr.SKIPPED){if(qr(A))return A;if(Ci(A))return!1;throw Error("non exhaustive match")}}),c=Lt(n,b=>{const A=b.LONGER_ALT;if(A)return he(A)?Lt(A,k=>e1(n,k)):[e1(n,A)]}),l=Lt(n,b=>b.PUSH_MODE),u=Lt(n,b=>Ht(b,"POP_MODE"))});let h;r("Line Terminator Handling",()=>{const b=y1(t.lineTerminatorCharacters);h=Lt(n,A=>!1),t.positionTracking!=="onlyOffset"&&(h=Lt(n,A=>Ht(A,"LINE_BREAKS")?!!A.LINE_BREAKS:g1(A,b)===!1&&zd(b,A.PATTERN)))});let d,f,p,m;r("Misc Mapping #2",()=>{d=Lt(n,m1),f=Lt(s,OU),p=Vr(n,(b,A)=>{const T=A.GROUP;return qr(T)&&T!==mr.SKIPPED&&(b[T]=[]),b},{}),m=Lt(s,(b,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:h[A],isCustom:d[A],short:f[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:n[A]}))});let g=!0,y=[];return t.safeMode||r("First Char Optimization",()=>{y=Vr(n,(b,A,T)=>{if(typeof A.PATTERN=="string"){const k=A.PATTERN.charCodeAt(0),I=ts(k);Wd(b,I,m[T])}else if(he(A.START_CHARS_HINT)){let k;Kt(A.START_CHARS_HINT,I=>{const R=typeof I=="string"?I.charCodeAt(0):I,$=ts(R);k!==$&&(k=$,Wd(b,$,m[T]))})}else if(Ni(A.PATTERN))if(A.PATTERN.unicode)g=!1,t.ensureOptimizations&&Fd(`${nu}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const k=oU(A.PATTERN,t.ensureOptimizations);Ae(k)&&(g=!1),Kt(k,I=>{Wd(b,I,m[T])})}else t.ensureOptimizations&&Fd(`${nu}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function uU(e,t){let r=[];const n=hU(e);r=r.concat(n.errors);const i=dU(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(fU(s)),r=r.concat(vU(s)),r=r.concat(EU(s,t)),r=r.concat(kU(s)),r}function fU(e){let t=[];const r=An(e,n=>Ni(n[Ps]));return t=t.concat(mU(r)),t=t.concat(_U(r)),t=t.concat(bU(r)),t=t.concat(wU(r)),t=t.concat(gU(r)),t}function hU(e){const t=An(e,i=>!Ht(i,Ps)),r=Lt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:je.MISSING_PATTERN,tokenTypes:[i]})),n=Kl(e,t);return{errors:r,valid:n}}function dU(e){const t=An(e,i=>{const s=i[Ps];return!Ni(s)&&!Ri(s)&&!Ht(s,"exec")&&!qr(s)}),r=Lt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:je.INVALID_PATTERN,tokenTypes:[i]})),n=Kl(e,t);return{errors:r,valid:n}}const pU=/[^\\][$]/;function mU(e){class t extends Bd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=An(e,i=>{const s=i.PATTERN;try{const o=ru(s),a=new t;return a.visit(o),a.found}catch{return pU.test(s.source)}});return Lt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function gU(e){const t=An(e,n=>n.PATTERN.test(""));return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:je.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const yU=/[^\\[][\^]|^\^/;function _U(e){class t extends Bd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=An(e,i=>{const s=i.PATTERN;try{const o=ru(s),a=new t;return a.visit(o),a.found}catch{return yU.test(s.source)}});return Lt(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:je.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function bU(e){const t=An(e,n=>{const i=n[Ps];return i instanceof RegExp&&(i.multiline||i.global)});return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:je.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function wU(e){const t=[];let r=Lt(e,s=>Vr(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Mr(t,a)&&a.PATTERN!==mr.NA&&(t.push(a),o.push(a)),o),[]));r=Ka(r);const n=An(r,s=>s.length>1);return Lt(n,s=>{const o=Lt(s,c=>c.name);return{message:`The same RegExp pattern ->${jn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:je.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function vU(e){const t=An(e,n=>{if(!Ht(n,"GROUP"))return!1;const i=n.GROUP;return i!==mr.SKIPPED&&i!==mr.NA&&!qr(i)});return Lt(t,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:je.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function EU(e,t){const r=An(e,i=>i.PUSH_MODE!==void 0&&!Mr(t,i.PUSH_MODE));return Lt(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:je.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function kU(e){const t=[],r=Vr(e,(n,i,s)=>{const o=i.PATTERN;return o===mr.NA||(qr(o)?n.push({str:o,idx:s,tokenType:i}):Ni(o)&&AU(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Kt(e,(n,i)=>{Kt(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&xU(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:je.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),t}function xU(e,t){if(Ni(t)){const r=t.exec(e);return r!==null&&r.index===0}else{if(Ri(t))return t(e,0,[],{});if(Ht(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function AU(e){return Mo([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>e.source.indexOf(r)!==-1)===void 0}function d1(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function p1(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function TU(e,t,r){const n=[];return Ht(e,Xa)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Xa+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ht(e,su)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+su+`> property in its definition
`,type:je.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ht(e,su)&&Ht(e,Xa)&&!Ht(e.modes,e.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${Xa}: <${e.defaultMode}>which does not exist
`,type:je.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ht(e,su)&&Kt(e.modes,(i,s)=>{Kt(i,(o,a)=>{if(Ci(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:je.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ht(o,"LONGER_ALT")){const c=he(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Kt(c,l=>{!Ci(l)&&!Mr(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:je.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function SU(e,t,r){const n=[];let i=!1;const s=Ka(ln(Je(e.modes))),o=Yl(s,c=>c[Ps]===mr.NA),a=y1(r);return t&&Kt(o,c=>{const l=g1(c,a);if(l!==!1){const h={message:NU(c,l),type:l.issue,tokenType:c};n.push(h)}else Ht(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):zd(a,c.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:je.NO_LINE_BREAKS_FLAGS}),n}function RU(e){const t={},r=kn(e);return Kt(r,n=>{const i=e[n];if(he(i))t[n]=[];else throw Error("non exhaustive match")}),t}function m1(e){const t=e.PATTERN;if(Ni(t))return!1;if(Ri(t))return!0;if(Ht(t,"exec"))return!0;if(qr(t))return!1;throw Error("non exhaustive match")}function OU(e){return qr(e)&&e.length===1?e.charCodeAt(0):!1}const IU={test:function(e){const t=e.length;for(let r=this.lastIndex;r<t;r++){const n=e.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return e.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function g1(e,t){if(Ht(e,"LINE_BREAKS"))return!1;if(Ni(e.PATTERN)){try{zd(t,e.PATTERN)}catch(r){return{issue:je.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(qr(e.PATTERN))return!1;if(m1(e))return{issue:je.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function NU(e,t){if(t.issue===je.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===je.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function y1(e){return Lt(e,r=>qr(r)?r.charCodeAt(0):r)}function Wd(e,t,r){e[t]===void 0?e[t]=[r]:e[t].push(r)}const Ja=256;let ou=[];function ts(e){return e<Ja?e:ou[e]}function CU(){if(Ae(ou)){ou=new Array(65536);for(let e=0;e<65536;e++)ou[e]=e>255?255+~~(e/255):e}}function Za(e,t){const r=e.tokenTypeIdx;return r===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[r]===!0}function au(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let _1=1;const b1={};function Qa(e){const t=LU(e);MU(t),PU(t),UU(t),Kt(t,r=>{r.isParent=r.categoryMatches.length>0})}function LU(e){let t=Er(e),r=e,n=!0;for(;n;){r=Ka(ln(Lt(r,s=>s.CATEGORIES)));const i=Kl(r,t);t=t.concat(i),Ae(i)?n=!1:r=i}return t}function MU(e){Kt(e,t=>{v1(t)||(b1[_1]=t,t.tokenTypeIdx=_1++),E1(t)&&!he(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),E1(t)||(t.CATEGORIES=[]),FU(t)||(t.categoryMatches=[]),$U(t)||(t.categoryMatchesMap={})})}function UU(e){Kt(e,t=>{t.categoryMatches=[],Kt(t.categoryMatchesMap,(r,n)=>{t.categoryMatches.push(b1[n].tokenTypeIdx)})})}function PU(e){Kt(e,t=>{w1([],t)})}function w1(e,t){Kt(e,r=>{t.categoryMatchesMap[r.tokenTypeIdx]=!0}),Kt(t.CATEGORIES,r=>{const n=e.concat(t);Mr(n,r)||w1(n,r)})}function v1(e){return Ht(e,"tokenTypeIdx")}function E1(e){return Ht(e,"CATEGORIES")}function FU(e){return Ht(e,"categoryMatches")}function $U(e){return Ht(e,"categoryMatchesMap")}function BU(e){return Ht(e,"tokenTypeIdx")}const DU={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,r,n,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${r} characters.`}};var je;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(je||(je={}));const tc={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:DU,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(tc);let mr=class{constructor(t,r=tc){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=i1(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Yr({},tc,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===tc.lineTerminatorsPattern)this.config.lineTerminatorsPattern=IU;else if(this.config.lineTerminatorCharacters===tc.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),he(t)?i={modes:{defaultMode:Er(t)},defaultMode:Xa}:(s=!1,i=Er(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(TU(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(SU(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Kt(i.modes,(a,c)=>{i.modes[c]=Yl(a,l=>Ci(l))});const o=kn(i.modes);if(Kt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(uU(a,o))}),Ae(this.lexerDefinitionErrors)){Qa(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=lU(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Yr({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Ae(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Lt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Kt(this.lexerDefinitionWarning,a=>{n1(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(h1?(this.chopInput=Io,this.match=this.matchWithTest):(this.updateLastIndex=sr,this.match=this.matchWithExec),s&&(this.handleModes=sr),this.trackStartLines===!1&&(this.computeNewColumn=Io),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=sr),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Vr(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(r.ensureOptimizations&&!Ae(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{sU()}),this.TRACE_INIT("toFastProperties",()=>{s1(this)})})}tokenize(t,r=this.defaultMode){if(!Ae(this.lexerDefinitionErrors)){const i=Lt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,r)}tokenizeInternal(t,r){let n,i,s,o,a,c,l,u,h,d,f,p,m,g,y;const b=t,A=b.length;let T=0,k=0;const I=this.hasCustom?0:Math.floor(t.length/10),R=new Array(I),$=[];let M=this.trackStartLines?1:void 0,H=this.trackStartLines?1:void 0;const X=RU(this.emptyGroups),O=this.trackStartLines,N=this.config.lineTerminatorsPattern;let E=0,L=[],j=[];const U=[],q=[];Object.freeze(q);let Q;function K(){return L}function W(wt){const Tt=ts(wt),It=j[Tt];return It===void 0?q:It}const P=wt=>{if(U.length===1&&wt.tokenType.PUSH_MODE===void 0){const Tt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(wt);$.push({offset:wt.startOffset,line:wt.startLine,column:wt.startColumn,length:wt.image.length,message:Tt})}else{U.pop();const Tt=Lo(U);L=this.patternIdxToConfig[Tt],j=this.charCodeToPatternIdxToConfig[Tt],E=L.length;const It=this.canModeBeOptimized[Tt]&&this.config.safeMode===!1;j&&It?Q=W:Q=K}};function st(wt){U.push(wt),j=this.charCodeToPatternIdxToConfig[wt],L=this.patternIdxToConfig[wt],E=L.length,E=L.length;const Tt=this.canModeBeOptimized[wt]&&this.config.safeMode===!1;j&&Tt?Q=W:Q=K}st.call(this,r);let G;const rt=this.config.recoveryEnabled;for(;T<A;){c=null;const wt=b.charCodeAt(T),Tt=Q(wt),It=Tt.length;for(n=0;n<It;n++){G=Tt[n];const St=G.pattern;l=null;const Pt=G.short;if(Pt!==!1?wt===Pt&&(c=St):G.isCustom===!0?(y=St.exec(b,T,R,X),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(St,T),c=this.match(St,t,T)),c!==null){if(a=G.longerAlt,a!==void 0){const Mt=a.length;for(s=0;s<Mt;s++){const qt=L[a[s]],ee=qt.pattern;if(u=null,qt.isCustom===!0?(y=ee.exec(b,T,R,X),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(ee,T),o=this.match(ee,t,T)),o&&o.length>c.length){c=o,l=u,G=qt;break}}}break}}if(c!==null){if(h=c.length,d=G.group,d!==void 0&&(f=G.tokenTypeIdx,p=this.createTokenInstance(c,T,f,G.tokenType,M,H,h),this.handlePayload(p,l),d===!1?k=this.addToken(R,k,p):X[d].push(p)),t=this.chopInput(t,h),T=T+h,H=this.computeNewColumn(H,h),O===!0&&G.canLineTerminator===!0){let St=0,Pt,Mt;N.lastIndex=0;do Pt=N.test(c),Pt===!0&&(Mt=N.lastIndex-1,St++);while(Pt===!0);St!==0&&(M=M+St,H=h-Mt,this.updateTokenEndLineColumnLocation(p,d,Mt,St,M,H,h))}this.handleModes(G,P,st,p)}else{const St=T,Pt=M,Mt=H;let qt=rt===!1;for(;qt===!1&&T<A;)for(t=this.chopInput(t,1),T++,i=0;i<E;i++){const ee=L[i],S=ee.pattern,ft=ee.short;if(ft!==!1?b.charCodeAt(T)===ft&&(qt=!0):ee.isCustom===!0?qt=S.exec(b,T,R,X)!==null:(this.updateLastIndex(S,T),qt=S.exec(t)!==null),qt===!0)break}if(m=T-St,H=this.computeNewColumn(H,m),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,St,m,Pt,Mt),$.push({offset:St,line:Pt,column:Mt,length:m,message:g}),rt===!1)break}}return this.hasCustom||(R.length=k),{tokens:R,groups:X,errors:$}}handleModes(t,r,n,i){if(t.pop===!0){const s=t.push;r(i),s!==void 0&&n.call(this,s)}else t.push!==void 0&&n.call(this,t.push)}chopInput(t,r){return t.substring(r)}updateLastIndex(t,r){t.lastIndex=r}updateTokenEndLineColumnLocation(t,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,r){return t+r}createOffsetOnlyToken(t,r,n,i){return{image:t,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(t,r,n,i,s,o){return{image:t,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(t,r,n){return t.push(n),r}addTokenUsingMemberAccess(t,r,n){return t[r]=n,r++,r}handlePayloadNoCustom(t,r){}handlePayloadWithCustom(t,r){r!==null&&(t.payload=r)}matchWithTest(t,r,n){return t.test(r)===!0?r.substring(n,t.lastIndex):null}matchWithExec(t,r){const n=t.exec(r);return n!==null?n[0]:null}};mr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",mr.NA=/NOT_APPLICABLE/;function ec(e){return k1(e)?e.LABEL:e.name}function k1(e){return qr(e.LABEL)&&e.LABEL!==""}const jU="parent",x1="categories",A1="label",T1="group",S1="push_mode",R1="pop_mode",O1="longer_alt",I1="line_breaks",N1="start_chars_hint";function un(e){return zU(e)}function zU(e){const t=e.pattern,r={};if(r.name=e.name,Ci(t)||(r.PATTERN=t),Ht(e,jU))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ht(e,x1)&&(r.CATEGORIES=e[x1]),Qa([r]),Ht(e,A1)&&(r.LABEL=e[A1]),Ht(e,T1)&&(r.GROUP=e[T1]),Ht(e,R1)&&(r.POP_MODE=e[R1]),Ht(e,S1)&&(r.PUSH_MODE=e[S1]),Ht(e,O1)&&(r.LONGER_ALT=e[O1]),Ht(e,I1)&&(r.LINE_BREAKS=e[I1]),Ht(e,N1)&&(r.START_CHARS_HINT=e[N1]),r}const Fs=un({name:"EOF",pattern:mr.NA});Qa([Fs]);function cu(e,t,r,n,i,s,o,a){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function WU(e,t){return Za(e,t)}const C1={buildMismatchTokenMessage({expected:e,actual:t,previous:r,ruleName:n}){return`Expecting ${k1(e)?`--> ${ec(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+jn(t).image+"'";if(n)return s+n+a;{const c=Vr(e,(d,f)=>d.concat(f),[]),l=Lt(c,d=>`[${Lt(d,f=>ec(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Lt(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+jn(t).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Lt(e,l=>`[${Lt(l,u=>ec(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(C1);const HU={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},$s={buildDuplicateFoundError(e,t){function r(u){return u instanceof $e?u.terminalType.name:u instanceof Xr?u.nonTerminalName:""}const n=e.name,i=jn(t),s=i.idx,o=di(i),a=r(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Lt(e.prefixPath,i=>ec(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Lt(e.prefixPath,i=>ec(i)).join(", "),r=e.alternation.idx===0?"":e.alternation.idx;let n=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(e){let t=di(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,r=Lt(e.leftRecursionPath,s=>s.name),n=`${t} --> ${r.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Uo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function GU(e,t){const r=new KU(e,t);return r.resolveRefs(),r.errors}class KU extends Us{constructor(t,r){super(),this.nameToTopRule=t,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Kt(Je(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const r=this.nameToTopRule[t.nonTerminalName];if(r)t.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:Ur.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class YU extends Jl{constructor(t,r){super(),this.topProd=t,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Er(this.path.ruleStack).reverse(),this.occurrenceStack=Er(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,r=[]){this.found||super.walk(t,r)}walkProdRef(t,r,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){Ae(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class qU extends YU{constructor(t,r){super(t,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,r,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new Jr({definition:i});this.possibleTokTypes=qa(s),this.found=!0}}}class lu extends Jl{constructor(t,r){super(),this.topRule=t,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class VU extends lu{walkMany(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof $e&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,r,n)}}class L1 extends lu{walkManySep(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof $e&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,r,n)}}class XU extends lu{walkAtLeastOne(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof $e&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,r,n)}}class M1 extends lu{walkAtLeastOneSep(t,r,n){if(t.idx===this.occurrence){const i=jn(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof $e&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,r,n)}}function Hd(e,t,r=[]){r=Er(r);let n=[],i=0;function s(a){return a.concat(kr(e,i+1))}function o(a){const c=Hd(s(a),t,r);return n.concat(c)}for(;r.length<t&&i<e.length;){const a=e[i];if(a instanceof Jr)return o(a.definition);if(a instanceof Xr)return o(a.definition);if(a instanceof Zr)n=o(a.definition);else if(a instanceof fi){const c=a.definition.concat([new or({definition:a.definition})]);return o(c)}else if(a instanceof hi){const c=[new Jr({definition:a.definition}),new or({definition:[new $e({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Wn){const c=a.definition.concat([new or({definition:[new $e({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof or){const c=a.definition.concat([new or({definition:a.definition})]);n=o(c)}else{if(a instanceof Hn)return Kt(a.definition,c=>{Ae(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof $e)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:kr(e,i)}),n}function U1(e,t,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-n-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Ae(h);){const d=h.pop();if(d===o){a&&Lo(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,g=d.occurrenceStack;if(Ae(f))continue;const y=f[0];if(y===i){const b={idx:p,def:kr(f),ruleStack:Ya(m),occurrenceStack:Ya(g)};h.push(b)}else if(y instanceof $e)if(p<c-1){const b=p+1,A=t[b];if(r(A,y.terminalType)){const T={idx:b,def:kr(f),ruleStack:m,occurrenceStack:g};h.push(T)}}else if(p===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Xr){const b=Er(m);b.push(y.nonTerminalName);const A=Er(g);A.push(y.idx);const T={idx:p,def:y.definition.concat(s,kr(f)),ruleStack:b,occurrenceStack:A};h.push(T)}else if(y instanceof Zr){const b={idx:p,def:kr(f),ruleStack:m,occurrenceStack:g};h.push(b),h.push(o);const A={idx:p,def:y.definition.concat(kr(f)),ruleStack:m,occurrenceStack:g};h.push(A)}else if(y instanceof fi){const b=new or({definition:y.definition,idx:y.idx}),A=y.definition.concat([b],kr(f)),T={idx:p,def:A,ruleStack:m,occurrenceStack:g};h.push(T)}else if(y instanceof hi){const b=new $e({terminalType:y.separator}),A=new or({definition:[b].concat(y.definition),idx:y.idx}),T=y.definition.concat([A],kr(f)),k={idx:p,def:T,ruleStack:m,occurrenceStack:g};h.push(k)}else if(y instanceof Wn){const b={idx:p,def:kr(f),ruleStack:m,occurrenceStack:g};h.push(b),h.push(o);const A=new $e({terminalType:y.separator}),T=new or({definition:[A].concat(y.definition),idx:y.idx}),k=y.definition.concat([T],kr(f)),I={idx:p,def:k,ruleStack:m,occurrenceStack:g};h.push(I)}else if(y instanceof or){const b={idx:p,def:kr(f),ruleStack:m,occurrenceStack:g};h.push(b),h.push(o);const A=new or({definition:y.definition,idx:y.idx}),T=y.definition.concat([A],kr(f)),k={idx:p,def:T,ruleStack:m,occurrenceStack:g};h.push(k)}else if(y instanceof Hn)for(let b=y.definition.length-1;b>=0;b--){const A=y.definition[b],T={idx:p,def:A.definition.concat(kr(f)),ruleStack:m,occurrenceStack:g};h.push(T),h.push(o)}else if(y instanceof Jr)h.push({idx:p,def:y.definition.concat(kr(f)),ruleStack:m,occurrenceStack:g});else if(y instanceof Uo)h.push(JU(y,p,m,g));else throw Error("non exhaustive match")}return u}function JU(e,t,r,n){const i=Er(r);i.push(e.name);const s=Er(n);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var ze;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ze||(ze={}));function P1(e){if(e instanceof Zr||e==="Option")return ze.OPTION;if(e instanceof or||e==="Repetition")return ze.REPETITION;if(e instanceof fi||e==="RepetitionMandatory")return ze.REPETITION_MANDATORY;if(e instanceof hi||e==="RepetitionMandatoryWithSeparator")return ze.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Wn||e==="RepetitionWithSeparator")return ze.REPETITION_WITH_SEPARATOR;if(e instanceof Hn||e==="Alternation")return ze.ALTERNATION;throw Error("non exhaustive match")}function ZU(e,t,r,n,i,s){const o=Kd(e,t,r),a=D1(o)?au:Za;return s(o,n,a,i)}function QU(e,t,r,n,i,s){const o=Yd(e,t,i,r),a=D1(o)?au:Za;return s(o[0],a,n)}function tP(e,t,r,n){const i=e.length,s=Dn(e,o=>Dn(o,a=>a.length===1));if(t)return function(o){const a=Lt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const g=this.LA(m+1);if(r(g,f[m])===!1)continue t}return c}}};if(s&&!n){const o=Lt(e,c=>ln(c)),a=Vr(o,(c,l,u)=>(Kt(l,h=>{Ht(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Kt(h.categoryMatches,d=>{Ht(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(r(f,u[d])===!1)continue t}return o}}}}function eP(e,t,r){const n=Dn(e,s=>s.length===1),i=e.length;if(n&&!r){const s=ln(e);if(s.length===1&&Ae(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Vr(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Kt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class rP extends Jl{constructor(t,r,n){super(),this.topProd=t,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,r,n,i){return t.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(t,r,n){this.checkIsTarget(t,ze.OPTION,r,n)||super.walkOption(t,r,n)}walkAtLeastOne(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY,r,n)||super.walkOption(t,r,n)}walkAtLeastOneSep(t,r,n){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}walkMany(t,r,n){this.checkIsTarget(t,ze.REPETITION,r,n)||super.walkOption(t,r,n)}walkManySep(t,r,n){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(t,r,n)}}class F1 extends Us{constructor(t,r,n){super(),this.targetOccurrence=t,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(t,r){t.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ze.OPTION)}visitRepetition(t){this.checkIsTarget(t,ze.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ze.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ze.ALTERNATION)}}function $1(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=[];return t}function Gd(e){let t=[""];for(let r=0;r<e.length;r++){const n=e[r],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}t=i}return t}function nP(e,t,r){for(let n=0;n<e.length;n++){if(n===r)continue;const i=e[n];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function B1(e,t){const r=Lt(e,o=>Hd([o],1)),n=$1(r.length),i=Lt(r,o=>{const a={};return Kt(o,c=>{const l=Gd(c.partialPath);Kt(l,u=>{a[u]=!0})}),a});let s=r;for(let o=1;o<=t;o++){const a=s;s=$1(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=Gd(h);if(nP(i,f,c)||Ae(d)||h.length===t){const m=n[c];if(qd(m,h)===!1){m.push(h);for(let g=0;g<f.length;g++){const y=f[g];i[c][y]=!0}}}else{const m=Hd(d,o+1,h);s[c]=s[c].concat(m),Kt(m,g=>{const y=Gd(g.partialPath);Kt(y,b=>{i[c][b]=!0})})}}}}return n}function Kd(e,t,r,n){const i=new F1(e,ze.ALTERNATION,n);return t.accept(i),B1(i.result,r)}function Yd(e,t,r,n){const i=new F1(e,r);t.accept(i);const s=i.result,a=new rP(t,e,r).startWalking(),c=new Jr({definition:s}),l=new Jr({definition:a});return B1([c,l],n)}function qd(e,t){t:for(let r=0;r<e.length;r++){const n=e[r];if(n.length===t.length){for(let i=0;i<n.length;i++){const s=t[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function iP(e,t){return e.length<t.length&&Dn(e,(r,n)=>{const i=t[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function D1(e){return Dn(e,t=>Dn(t,r=>Dn(r,n=>Ae(n.categoryMatches))))}function sP(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Lt(t,r=>Object.assign({type:Ur.CUSTOM_LOOKAHEAD_VALIDATION},r))}function oP(e,t,r,n){const i=Tn(e,c=>aP(c,r)),s=bP(e,t,r),o=Tn(e,c=>mP(c,r)),a=Tn(e,c=>uP(c,e,n,r));return i.concat(s,o,a)}function aP(e,t){const r=new lP;e.accept(r);const n=r.allProductions,i=t1(n,cP),s=zn(i,a=>a.length>1);return Lt(Je(s),a=>{const c=jn(a),l=t.buildDuplicateFoundError(e,a),u=di(c),h={message:l,type:Ur.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=j1(c);return d&&(h.parameter=d),h})}function cP(e){return`${di(e)}_#_${e.idx}_#_${j1(e)}`}function j1(e){return e instanceof $e?e.terminalType.name:e instanceof Xr?e.nonTerminalName:""}class lP extends Us{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function uP(e,t,r,n){const i=[];if(Vr(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:o,type:Ur.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function fP(e,t,r){const n=[];let i;return Mr(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Ur.INVALID_RULE_OVERRIDE,ruleName:e})),n}function z1(e,t,r,n=[]){const i=[],s=uu(t.definition);if(Ae(s))return[];{const o=e.name;Mr(s,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:Ur.LEFT_RECURSION,ruleName:o});const c=Kl(s,n.concat([e])),l=Tn(c,u=>{const h=Er(n);return h.push(u),z1(e,u,r,h)});return i.concat(l)}}function uu(e){let t=[];if(Ae(e))return t;const r=jn(e);if(r instanceof Xr)t.push(r.referencedRule);else if(r instanceof Jr||r instanceof Zr||r instanceof fi||r instanceof hi||r instanceof Wn||r instanceof or)t=t.concat(uu(r.definition));else if(r instanceof Hn)t=ln(Lt(r.definition,s=>uu(s.definition)));else if(!(r instanceof $e))throw Error("non exhaustive match");const n=Xl(r),i=e.length>1;if(n&&i){const s=kr(e);return t.concat(uu(s))}else return t}class Vd extends Us{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function hP(e,t){const r=new Vd;e.accept(r);const n=r.alternations;return Tn(n,s=>{const o=Ya(s.definition);return Tn(o,(a,c)=>{const l=U1([a],[],Za,1);return Ae(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:Ur.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function dP(e,t,r){const n=new Vd;e.accept(n);let i=n.alternations;return i=Yl(i,o=>o.ignoreAmbiguities===!0),Tn(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=Kd(a,e,c,o),u=yP(l,o,e,r),h=_P(l,o,e,r);return u.concat(h)})}class pP extends Us{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function mP(e,t){const r=new Vd;e.accept(r);const n=r.alternations;return Tn(n,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:Ur.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function gP(e,t,r){const n=[];return Kt(e,i=>{const s=new pP;i.accept(s);const o=s.allProductions;Kt(o,a=>{const c=P1(a),l=a.maxLookahead||t,u=a.idx,d=Yd(u,i,c,l)[0];if(Ae(ln(d))){const f=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:f,type:Ur.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function yP(e,t,r,n){const i=[],s=Vr(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Kt(c,u=>{const h=[l];Kt(e,(d,f)=>{l!==f&&qd(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!qd(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return Lt(s,a=>{const c=Lt(a.alts,u=>u+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Ur.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:a.alts}})}function _P(e,t,r,n){const i=Vr(e,(o,a,c)=>{const l=Lt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Ka(Tn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=An(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&iP(d.path,l));return Lt(u,d=>{const f=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Ur.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:p,alternatives:f}})}))}function bP(e,t,r){const n=[],i=Lt(t,s=>s.name);return Kt(e,s=>{const o=s.name;if(Mr(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Ur.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function wP(e){const t=Ud(e,{errMsgProvider:HU}),r={};return Kt(e.rules,n=>{r[n.name]=n}),GU(r,t.errMsgProvider)}function vP(e){return e=Ud(e,{errMsgProvider:$s}),oP(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const W1="MismatchedTokenException",H1="NoViableAltException",G1="EarlyExitException",K1="NotAllInputParsedException",Y1=[W1,H1,G1,K1];Object.freeze(Y1);function fu(e){return Mr(Y1,e.name)}class hu extends Error{constructor(t,r){super(t),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class q1 extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=W1}}class EP extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=H1}}class kP extends hu{constructor(t,r){super(t,r),this.name=K1}}class xP extends hu{constructor(t,r,n){super(t,r),this.previousToken=n,this.name=G1}}const Xd={},V1="InRuleRecoveryException";class AP extends Error{constructor(t){super(t),this.name=V1}}class TP{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ht(t,"recoveryEnabled")?t.recoveryEnabled:Li.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=SP)}getTokenToInsert(t){const r=cu(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new q1(f,l,this.LA(0));p.resyncedTokens=Ya(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(n.call(this)){h(),t.apply(this,r);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,r)))}getFollowsForInRuleRecovery(t,r){const n=this.getCurrentGrammarPath(t,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(t,r){if(this.canRecoverWithSingleTokenInsertion(t,r))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new AP("sad sad panda")}canPerformInRuleRecovery(t,r){return this.canRecoverWithSingleTokenInsertion(t,r)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,r){if(!this.canTokenTypeBeInsertedInRecovery(t)||Ae(r))return!1;const n=this.LA(1);return Mo(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Mr(n,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=Mo(t,s=>WU(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Xd;const t=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return Lt(t,(n,i)=>i===0?Xd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Lt(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return ln(t)}getFollowSetFromFollowKey(t){if(t===Xd)return[Fs];const r=t.ruleName+t.idxInCallingRule+a1+t.inRule;return this.resyncFollows[r]}addToResyncTokens(t,r){return this.tokenMatcher(t,Fs)||r.push(t),r}reSyncTo(t){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,t)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Ya(r)}attemptInRepetitionRecovery(t,r,n,i,s,o,a){}getCurrentGrammarPath(t,r){const n=this.getHumanReadableRuleStack(),i=Er(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:t,lastTokOccurrence:r}}getHumanReadableRuleStack(){return Lt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function SP(e,t,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=Fs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,r,l)}const RP=4,es=8,X1=1<<es,J1=2<<es,Jd=3<<es,Zd=4<<es,Qd=5<<es,du=6<<es;function tp(e,t,r){return r|t|e}class OP{constructor(t){var r;this.maxLookahead=(r=t==null?void 0:t.maxLookahead)!==null&&r!==void 0?r:Li.maxLookahead}validate(t){const r=this.validateNoLeftRecursion(t.rules);if(Ae(r)){const n=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(t){return Tn(t,r=>z1(r,r,$s))}validateEmptyOrAlternatives(t){return Tn(t,r=>hP(r,$s))}validateAmbiguousAlternationAlternatives(t,r){return Tn(t,n=>dP(n,r,$s))}validateSomeNonEmptyLookaheadPath(t,r){return gP(t,r,$s)}buildLookaheadForAlternation(t){return ZU(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,tP)}buildLookaheadForOptional(t){return QU(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,P1(t.prodType),eP)}}class IP{initLooksAhead(t){this.dynamicTokensEnabled=Ht(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Li.dynamicTokensEnabled,this.maxLookahead=Ht(t,"maxLookahead")?t.maxLookahead:Li.maxLookahead,this.lookaheadStrategy=Ht(t,"lookaheadStrategy")?t.lookaheadStrategy:new OP({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Kt(t,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=CP(r);Kt(n,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${di(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=tp(this.fullRuleNameToShort[r.name],X1,l.idx);this.setLaFuncCache(d,h)})}),Kt(i,l=>{this.computeLookaheadFunc(r,l.idx,Jd,"Repetition",l.maxLookahead,di(l))}),Kt(s,l=>{this.computeLookaheadFunc(r,l.idx,J1,"Option",l.maxLookahead,di(l))}),Kt(o,l=>{this.computeLookaheadFunc(r,l.idx,Zd,"RepetitionMandatory",l.maxLookahead,di(l))}),Kt(a,l=>{this.computeLookaheadFunc(r,l.idx,du,"RepetitionMandatoryWithSeparator",l.maxLookahead,di(l))}),Kt(c,l=>{this.computeLookaheadFunc(r,l.idx,Qd,"RepetitionWithSeparator",l.maxLookahead,di(l))})})})}computeLookaheadFunc(t,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=tp(this.fullRuleNameToShort[t.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,r){const n=this.getLastExplicitRuleShortName();return tp(n,t,r)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,r){this.lookAheadFuncsCache.set(t,r)}}class NP extends Us{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const pu=new NP;function CP(e){pu.reset(),e.accept(pu);const t=pu.dslMethods;return pu.reset(),t}function Z1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Q1(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function LP(e,t,r){e.children[r]===void 0?e.children[r]=[t]:e.children[r].push(t)}function MP(e,t,r){e.children[t]===void 0?e.children[t]=[r]:e.children[t].push(r)}const UP="name";function tw(e,t){Object.defineProperty(e,UP,{enumerable:!1,configurable:!0,writable:!1,value:t})}function PP(e,t){const r=kn(e),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function FP(e,t){const r=function(){};tw(r,e+"BaseSemantics");const n={visit:function(i,s){if(he(i)&&(i=i[0]),!Ci(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=BP(this,t);if(!Ae(i)){const s=Lt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=t,r}function $P(e,t,r){const n=function(){};tw(n,e+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Kt(t,s=>{i[s]=PP}),n.prototype=i,n.prototype.constructor=n,n}var ep;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ep||(ep={}));function BP(e,t){return DP(e,t)}function DP(e,t){const r=An(t,i=>Ri(e[i])===!1),n=Lt(r,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:ep.MISSING_METHOD,methodName:i}));return Ka(n)}class jP{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Ht(t,"nodeLocationTracking")?t.nodeLocationTracking:Li.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=sr,this.cstFinallyStateUpdate=sr,this.cstPostTerminal=sr,this.cstPostNonTerminal=sr,this.cstPostRule=sr;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Q1,this.setNodeLocationFromNode=Q1,this.cstPostRule=sr,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=sr,this.setNodeLocationFromNode=sr,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Z1,this.setNodeLocationFromNode=Z1,this.cstPostRule=sr,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=sr,this.setNodeLocationFromNode=sr,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=sr,this.setNodeLocationFromNode=sr,this.cstPostRule=sr,this.setInitialNodeLocation=sr;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const r=this.LA(1);t.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const r={name:t,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(t){const r=this.LA(0),n=t.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];LP(n,r,t),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(t,r){const n=this.CST_STACK[this.CST_STACK.length-1];MP(n,r,t),this.setNodeLocationFromNode(n.location,t.location)}getBaseCstVisitorConstructor(){if(Ci(this.baseCstVisitorConstructor)){const t=FP(this.className,kn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ci(this.baseCstVisitorWithDefaultsConstructor)){const t=$P(this.className,kn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class zP{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):yu}LA(t){const r=this.currIdx+t;return r<0||this.tokVectorLength<=r?yu:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class WP{ACTION(t){return t.call(this)}consume(t,r,n){return this.consumeInternal(r,t,n)}subrule(t,r,n){return this.subruleInternal(r,t,n)}option(t,r){return this.optionInternal(r,t)}or(t,r){return this.orInternal(r,t)}many(t,r){return this.manyInternal(t,r)}atLeastOne(t,r){return this.atLeastOneInternal(t,r)}CONSUME(t,r){return this.consumeInternal(t,0,r)}CONSUME1(t,r){return this.consumeInternal(t,1,r)}CONSUME2(t,r){return this.consumeInternal(t,2,r)}CONSUME3(t,r){return this.consumeInternal(t,3,r)}CONSUME4(t,r){return this.consumeInternal(t,4,r)}CONSUME5(t,r){return this.consumeInternal(t,5,r)}CONSUME6(t,r){return this.consumeInternal(t,6,r)}CONSUME7(t,r){return this.consumeInternal(t,7,r)}CONSUME8(t,r){return this.consumeInternal(t,8,r)}CONSUME9(t,r){return this.consumeInternal(t,9,r)}SUBRULE(t,r){return this.subruleInternal(t,0,r)}SUBRULE1(t,r){return this.subruleInternal(t,1,r)}SUBRULE2(t,r){return this.subruleInternal(t,2,r)}SUBRULE3(t,r){return this.subruleInternal(t,3,r)}SUBRULE4(t,r){return this.subruleInternal(t,4,r)}SUBRULE5(t,r){return this.subruleInternal(t,5,r)}SUBRULE6(t,r){return this.subruleInternal(t,6,r)}SUBRULE7(t,r){return this.subruleInternal(t,7,r)}SUBRULE8(t,r){return this.subruleInternal(t,8,r)}SUBRULE9(t,r){return this.subruleInternal(t,9,r)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,r,n=_u){if(Mr(this.definedRulesNames,t)){const o={message:$s.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Ur.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,r,n);return this[t]=i,i}OVERRIDE_RULE(t,r,n=_u){const i=fP(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,r,n);return this[t]=s,s}BACKTRACK(t,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return t.apply(this,r),!0}catch(i){if(fu(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return G8(Je(this.gastProductionsCache))}}class HP{initRecognizerEngine(t,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=au,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ht(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(he(t)){if(Ae(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(he(t))this.tokensMap=Vr(t,(s,o)=>(s[o.name]=o,s),{});else if(Ht(t,"modes")&&Dn(ln(Je(t.modes)),BU)){const s=ln(Je(t.modes)),o=ql(s);this.tokensMap=Vr(o,(a,c)=>(a[c.name]=c,a),{})}else if(En(t))this.tokensMap=Er(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Fs;const n=Ht(t,"modes")?ln(Je(t.modes)):Je(t),i=Dn(n,s=>Ae(s.categoryMatches));this.tokenMatcher=i?au:Za,Qa(Je(this.tokensMap))}defineRule(t,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ht(n,"resyncEnabled")?n.resyncEnabled:_u.resyncEnabled,s=Ht(n,"recoveryValueFunc")?n.recoveryValueFunc:_u.recoveryValueFunc,o=this.ruleShortNameIdx<<RP+es;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),r.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:r})}invokeRuleCatch(t,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(fu(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(t);throw o}}else throw t}optionInternal(t,r){const n=this.getKeyForAutomaticLookahead(J1,r);return this.optionInternalLogic(t,r,n)}optionInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,r){const n=this.getKeyForAutomaticLookahead(Zd,t);return this.atLeastOneInternalLogic(t,r,n)}atLeastOneInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,r],i,Zd,t,XU)}atLeastOneSepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(du,t);this.atLeastOneSepFirstInternalLogic(t,r,n)}atLeastOneSepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,M1],a,du,t,M1)}else throw this.raiseEarlyExitException(t,ze.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(t,r){const n=this.getKeyForAutomaticLookahead(Jd,t);return this.manyInternalLogic(t,r,n)}manyInternalLogic(t,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,r],i,Jd,t,VU,o)}manySepFirstInternal(t,r){const n=this.getKeyForAutomaticLookahead(Qd,t);this.manySepFirstInternalLogic(t,r,n)}manySepFirstInternalLogic(t,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,L1],a,Qd,t,L1)}}repetitionSepSecondInternal(t,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,r,n,i,s],n,du,t,s)}doSingleRepetition(t){const r=this.getLexerPosition();return t.call(this),this.getLexerPosition()>r}orInternal(t,r){const n=this.getKeyForAutomaticLookahead(X1,r),i=he(t)?t:t.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new kP(r,t))}}subruleInternal(t,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=t.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,n,t.ruleName)}}subruleInternalError(t,r,n){throw fu(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete t.partialCstResult),t}consumeInternal(t,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,n)}catch(s){i=this.consumeInternalRecovery(t,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:t.name,i),i}consumeInternalError(t,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new q1(i,r,s))}consumeInternalRecovery(t,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,r);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===V1?n:s}}else throw n}saveRecogState(){const t=this.errors,r=Er(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Fs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class GP{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Ht(t,"errorMessageProvider")?t.errorMessageProvider:Li.errorMessageProvider}SAVE_ERROR(t){if(fu(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Er(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Er(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Yd(t,s,r,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new xP(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=Kd(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new EP(c,this.LA(1),a))}}class KP{initContentAssist(){}computeContentAssist(t,r){const n=this.gastProductionsCache[t];if(Ci(n))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return U1([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const r=jn(t.ruleStack),i=this.getGAstProductions()[r];return new qU(i,t).startWalking()}}const mu={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(mu);const ew=!0,rw=Math.pow(2,es)-1,nw=un({name:"RECORDING_PHASE_TOKEN",pattern:mr.NA});Qa([nw]);const iw=cu(nw,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(iw);const YP={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class qP{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const r=t>0?t:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,t,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,t,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,t)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,t)},this[`MANY${r}`]=function(n){this.manyInternalRecord(t,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(t,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(t,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(t,n)}}this.consume=function(t,r,n){return this.consumeInternalRecord(r,t,n)},this.subrule=function(t,r,n){return this.subruleInternalRecord(r,t,n)},this.option=function(t,r){return this.optionInternalRecord(r,t)},this.or=function(t,r){return this.orInternalRecord(r,t)},this.many=function(t,r){this.manyInternalRecord(t,r)},this.atLeastOne=function(t,r){this.atLeastOneInternalRecord(t,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete t[`CONSUME${n}`],delete t[`SUBRULE${n}`],delete t[`OPTION${n}`],delete t[`OR${n}`],delete t[`MANY${n}`],delete t[`MANY_SEP${n}`],delete t[`AT_LEAST_ONE${n}`],delete t[`AT_LEAST_ONE_SEP${n}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,r){return()=>!0}LA_RECORD(t){return yu}topLevelRuleRecord(t,r){try{const n=new Uo({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(t,r){return rc.call(this,Zr,t,r)}atLeastOneInternalRecord(t,r){rc.call(this,fi,r,t)}atLeastOneSepFirstInternalRecord(t,r){rc.call(this,hi,r,t,ew)}manyInternalRecord(t,r){rc.call(this,or,r,t)}manySepFirstInternalRecord(t,r){rc.call(this,Wn,r,t,ew)}orInternalRecord(t,r){return VP.call(this,t,r)}subruleInternalRecord(t,r,n){if(gu(r),!t||Ht(t,"ruleName")===!1){const a=new Error(`<SUBRULE${sw(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Lo(this.recordingProdStack),s=t.ruleName,o=new Xr({idx:r,nonTerminalName:s,label:n==null?void 0:n.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?YP:mu}consumeInternalRecord(t,r,n){if(gu(r),!v1(t)){const o=new Error(`<CONSUME${sw(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Lo(this.recordingProdStack),s=new $e({idx:r,terminalType:t,label:n==null?void 0:n.LABEL});return i.definition.push(s),iw}}function rc(e,t,r,n=!1){gu(r);const i=Lo(this.recordingProdStack),s=Ri(t)?t:t.DEF,o=new e({definition:[],idx:r});return n&&(o.separator=t.SEP),Ht(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),mu}function VP(e,t){gu(t);const r=Lo(this.recordingProdStack),n=he(e)===!1,i=n===!1?e:e.DEF,s=new Hn({definition:[],idx:t,ignoreAmbiguities:n&&e.IGNORE_AMBIGUITIES===!0});Ht(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Pd(i,a=>Ri(a.GATE));return s.hasPredicates=o,r.definition.push(s),Kt(i,a=>{const c=new Jr({definition:[]});s.definition.push(c),Ht(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ht(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),mu}function sw(e){return e===0?"":`${e}`}function gu(e){if(e<0||e>rw){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${rw+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class XP{initPerformanceTracer(t){if(Ht(t,"traceInitPerf")){const r=t.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=Li.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${t}>`);const{time:i,value:s}=i1(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function JP(e,t){t.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=r.prototype[i]})})}const yu=cu(Fs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(yu);const Li=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:C1,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_u=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ur;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ur||(Ur={}));let rp=class kA{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{s1(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Kt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=wP({rules:Je(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Ae(n)&&this.skipValidations===!1){const i=vP({rules:Je(this.gastProductionsCache),tokenTypes:Je(this.tokensMap),errMsgProvider:$s,grammarName:r}),s=sP({lookaheadStrategy:this.lookaheadStrategy,rules:Je(this.gastProductionsCache),tokenTypes:Je(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Ae(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=Z8(Je(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Je(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Je(this.gastProductionsCache))})),!kA.DEFER_DEFINITION_ERRORS_HANDLING&&!Ae(this.definitionErrors))throw t=Lt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(t,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Ht(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ht(r,"skipValidations")?r.skipValidations:Li.skipValidations}};rp.DEFER_DEFINITION_ERRORS_HANDLING=!1,JP(rp,[TP,IP,jP,zP,HP,WP,GP,KP,qP,XP]);class ZP extends rp{constructor(t,r=Li){const n=Er(r);n.outputCst=!0,super(t,n)}}function QP(e){const t=new tF,r=Je(e);return Lt(r,n=>t.visitRule(n))}class tF extends Us{visitRule(t){const r=this.visitEach(t.definition),n=t1(r,s=>s.propertyName),i=Lt(n,(s,o)=>{const a=!Pd(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Lt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:bu(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:bu(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:bu(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:bu(t)}]}visitEachAndOverrideWith(t,r){return Lt(this.visitEach(t),n=>Yr({},n,r))}visitEach(t){return ln(Lt(t,r=>this.visit(r)))}}function bu(e){return e instanceof Xr?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function eF(e,t){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(ln(Lt(e,n=>rF(n)))),t.includeVisitorInterface&&(r=r.concat(oF(t.visitorInterfaceName,e))),r.join(`

`)+`
`}function rF(e){const t=nF(e),r=iF(e);return[t,r]}function nF(e){const t=aw(e.name),r=np(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${r};
}`}function iF(e){return`export type ${np(e.name)} = {
  ${Lt(e.properties,r=>sF(r)).join(`
  `)}
};`}function sF(e){const t=cF(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function oF(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Lt(t,r=>aF(r)).join(`
  `)}
}`}function aF(e){const t=np(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function cF(e){if(he(e)){const t=ql(Lt(e,n=>ow(n)));return"("+Vr(t,(n,i)=>n+" | "+i)+")"}else return ow(e)}function ow(e){return e.kind==="token"?"IToken":aw(e.name)}function aw(e){return vb(e)+"CstNode"}function np(e){return vb(e)+"CstChildren"}const lF={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function uF(e,t){const r=Object.assign(Object.assign({},lF),t),n=QP(e);return eF(n,r)}const nc=my(32,126).map(e=>String.fromCharCode(e));function Zt(e){return un({...e,name:`token_${e.name}`})}function ht(e){return Zt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:qe})}const wu=Zt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),fF=Zt({name:"whitespace",pattern:/ +/,group:mr.SKIPPED}),hF=Zt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:mr.SKIPPED}),ip=Zt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Fo=Zt({name:"command",pattern:/#/,start_chars_hint:["#"]});let cw=!1;const dF="@#/?':!",pF=/[#\d]+/i,mF=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function gF(e,t){if(!cw)return null;let r=t;const n=e[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(e[r]===" "){for(;e[r]===" ";)r++;if(dF.includes(e[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(e[r])===!1;)r--;switch(e[r]){case"?":case"/":{const o=e.substring(r+1,t+1).toLowerCase();if(o.indexOf(" ")<1||mF.test(o))return null;break}case"#":{const o=e.substring(r+1,r+4).toLowerCase();if(pF.test(o)===!1)return null;break}case'"':{for(r--;r>0&&e[r]===" ";)r--;if(!(r<1||e[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=t;for(e[i]==='"'&&++i;i<e.length&&e[i]!==`
`;)i++;const s=e.substring(t,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const lw=Zt({name:"text",pattern:gF,line_breaks:!1,start_chars_hint:nc}),uw=Zt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),sp=Zt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),fw=Zt({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),hw=Zt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),qe=Zt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:nc}),vu=Zt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),op=Zt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),dw=ht("isterrain"),pw=ht("isobject"),mw=ht("issolid"),gw=ht("iswalk"),yw=ht("isswim"),_w=ht("isbullet"),bw=ht("isghost"),ww=ht("iswalking"),vw=ht("iswalkable"),Ew=ht("isswimming"),kw=ht("isswimmable"),xw=ht("black"),Aw=ht("dkblue"),Tw=ht("dkgreen"),Sw=ht("dkcyan"),Rw=ht("dkred"),Ow=ht("dkpurple"),Iw=ht("dkyellow"),Nw=ht("ltgray"),Cw=ht("dkgray"),Lw=ht("blue"),Mw=ht("green"),Uw=ht("cyan"),Pw=ht("red"),Fw=ht("purple"),$w=ht("yellow"),Bw=ht("white"),Dw=ht("brown"),jw=ht("dkwhite"),zw=ht("ltgrey"),Ww=ht("gray"),Hw=ht("grey"),Gw=ht("dkgrey"),Kw=ht("ltblack"),Yw=ht("onblack"),qw=ht("ondkblue"),Vw=ht("ondkgreen"),Xw=ht("ondkcyan"),Jw=ht("ondkred"),Zw=ht("ondkpurple"),Qw=ht("ondkyellow"),tv=ht("onltgray"),ev=ht("ondkgray"),rv=ht("onblue"),nv=ht("ongreen"),iv=ht("oncyan"),sv=ht("onred"),ov=ht("onpurple"),av=ht("onyellow"),cv=ht("onwhite"),lv=ht("onbrown"),uv=ht("ondkwhite"),fv=ht("onltgrey"),hv=ht("ongray"),dv=ht("ongrey"),pv=ht("ondkgrey"),mv=ht("onltblack"),gv=ht("onclear"),yv=ht("idle"),_v=ht("up"),bv=ht("down"),wv=ht("left"),vv=ht("right"),Ev=ht("by"),kv=ht("at"),xv=ht("flow"),Av=ht("seek"),Tv=ht("rndns"),Sv=ht("rndne"),Rv=ht("rnd"),Ov=ht("cw"),Iv=ht("ccw"),Nv=ht("opp"),Cv=ht("rndp"),Lv=ht("away"),Mv=ht("toward"),Uv=ht("find"),Pv=ht("flee"),Fv=ht("to"),$v=ht("i"),Bv=ht("u"),Dv=ht("north"),jv=ht("n"),zv=ht("d"),Wv=ht("south"),Hv=ht("s"),Gv=ht("l"),Kv=ht("west"),Yv=ht("w"),qv=ht("r"),Vv=ht("east"),Xv=ht("e"),Jv=ht("over"),Zv=ht("under"),Qv=Zt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:qe}),tE=ht("contact"),eE=ht("blocked"),rE=ht("any"),nE=ht("countof"),iE=ht("abs"),sE=ht("intceil"),oE=ht("intfloor"),aE=ht("intround"),cE=ht("clamp"),lE=ht("min"),uE=ht("max"),fE=ht("pick"),hE=ht("pickwith"),dE=ht("random"),pE=ht("randomwith"),mE=ht("run"),gE=ht("runwith"),yE=Zt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),_E=Zt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:qe}),bE=Zt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:qe}),wE=Zt({name:"islessthan",pattern:/<|below/i,longer_alt:qe}),vE=Zt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:qe}),EE=Zt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:qe}),kE=Zt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:qe}),ap=Zt({name:"or",pattern:/or/i,longer_alt:qe}),cp=Zt({name:"not",pattern:/not/i,longer_alt:qe}),lp=Zt({name:"and",pattern:/and/i,longer_alt:qe}),up=Zt({name:"plus",pattern:/\+/}),fp=Zt({name:"minus",pattern:/-/}),xE=Zt({name:"power",pattern:/\*\*/}),AE=Zt({name:"multiply",pattern:/\*/}),hp=Zt({name:"divide",pattern:/\//}),TE=Zt({name:"moddivide",pattern:/%/}),SE=Zt({name:"floordivide",pattern:/%%/}),RE=Zt({name:"query",pattern:/\?/}),OE=Zt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),IE=Zt({name:"rparen",pattern:/\)/,pop_mode:!0}),NE=Zt({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:nc,longer_alt:qe}),CE=Zt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:nc,longer_alt:qe}),LE=Zt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:nc,longer_alt:qe}),dp=Zt({name:"if",pattern:/if|try|take|give/i,longer_alt:qe}),Eu=Zt({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:qe}),pp=ht("done"),mp=ht("else"),ME=ht("while"),UE=ht("repeat"),PE=ht("waitfor"),FE=Zt({name:"foreach",pattern:/foreach|for/i,longer_alt:qe}),$E=ht("break"),BE=ht("continue");function DE(e,t){return[...e,bv,...t,op,dw,pw,mw,vw,ww,gw,kw,Ew,yw,_w,bw,xw,Aw,Tw,Sw,Rw,Ow,Iw,Nw,Cw,Lw,Mw,Uw,Pw,Fw,$w,Bw,Dw,jw,zw,Ww,Hw,Gw,Kw,Yw,qw,Vw,Xw,Jw,Zw,Qw,tv,ev,rv,nv,iv,sv,ov,av,cv,lv,uv,fv,hv,dv,pv,mv,gv,yv,_v,wv,vv,Ev,kv,xv,Av,Cv,Tv,Sv,Rv,Ov,Iv,Nv,Lv,Mv,Uv,Pv,Fv,Dv,Wv,Kv,Vv,Jv,Zv,Qv,tE,eE,rE,nE,iE,sE,oE,aE,cE,lE,uE,hE,fE,pE,dE,gE,mE,yE,_E,bE,EE,wE,kE,vE,ap,cp,lp,up,fp,xE,AE,hp,SE,TE,RE,OE,IE,$v,Bv,jv,zv,Hv,Gv,Yv,qv,Xv,vu,qe]}const jE=DE([lw,ip,NE,CE,LE,Fo,uw,sp,fw,hw,wu,fF],[$E,BE,pp,Eu,mp,FE,dp,UE,PE,ME]),yF=new mr({defaultMode:"use_newlines",modes:{use_newlines:jE,ignore_newlines:DE([hF],[])}},{skipValidations:!ni,ensureOptimizations:ni,positionTracking:"full"});function zE(e){cw=!0;const t=yF.tokenize(e||` 
`),[r]=(pe(t.tokens)?t.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&t.tokens.push(cu(wu,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),t}function _F(e,t,r=!0){if(r){const[n,...i]=t;switch(Dt(n??"")){default:return{type:Ut.OBJECT,values:t};case"loader":return{type:Ut.LOADER,values:i};case"board":return{type:Ut.BOARD,values:i};case"object":return{type:Ut.OBJECT,values:i};case"terrain":return{type:Ut.TERRAIN,values:i};case"charset":return{type:Ut.CHARSET,values:i};case"palette":return{type:Ut.PALETTE,values:i}}}else{const[n,i,...s]=t,o=Dt(i??""),a=[n,e,...s];switch(o){default:return{type:Ut.CONST,values:t};case"rn":case"range":return{type:Ut.RANGE,values:a};case"sl":case"select":return{type:Ut.SELECT,values:a};case"nm":case"number":return{type:Ut.NUMBER,values:a};case"tx":case"text":return{type:Ut.TEXT,values:a};case"hk":case"hotkey":return{type:Ut.HOTKEY,values:a};case"copyit":return{type:Ut.COPYIT,values:a};case"openit":return{type:Ut.OPENIT,values:a};case"zssedit":return{type:Ut.ZSSEDIT,values:a};case"charedit":return{type:Ut.CHAREDIT,values:a};case"coloredit":return{type:Ut.COLOREDIT,values:a}}}}function fn(e){switch(e){case Ut.LOADER:return"loader";case Ut.BOARD:return"board";case Ut.OBJECT:return"object";case Ut.TERRAIN:return"terrain";case Ut.CHARSET:return"charset";case Ut.PALETTE:return"palette";case Ut.CONST:return"const";case Ut.RANGE:return"range";case Ut.SELECT:return"select";case Ut.NUMBER:return"number";case Ut.TEXT:return"text";case Ut.HOTKEY:return"hotkey";case Ut.COPYIT:return"copyit";case Ut.OPENIT:return"openit";case Ut.VIEWIT:return"viewit";case Ut.ZSSEDIT:return"zssedit";case Ut.CHAREDIT:return"charedit";case Ut.COLOREDIT:return"coloredit"}}var gp=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(gp||{});function WE(e){return Oo(e,gp,{bits:t=>Array.from(t)})}function HE(e){return Ua(e,gp,{bits:t=>new Uint8Array(t)})}function ku(e,t){return{id:We(),code:e,...t}}var yp=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(yp||{});function bF(e){return Oo(e,yp,{board:e7,object:Il,terrain:Il,charset:WE,palette:WE,stats:Ne})}function wF(e){return Ua(e,yp,{board:r7,object:Nl,terrain:Nl,charset:HE,palette:HE})}function ic(e){const t={...Bs(e)};return Object.keys(t).forEach(r=>{switch(r){case"type":case"name":delete t[r];break}}),t}function vF(e){return w(e)?(e.stats=void 0,Bs(e)):{}}function _p(e){const t=zE(e),r={};let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===ip){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=_F(yt(c)?c:"",l,n),h=u.values.join(" ");switch(n=!1,u.type){case Ut.LOADER:r.type=vt.LOADER,r.name=h;break;case Ut.BOARD:r.type=vt.BOARD,r.name=h;break;case Ut.OBJECT:r.type=vt.OBJECT,r.name=h||"object";break;case Ut.TERRAIN:r.type=vt.TERRAIN,r.name=h;break;case Ut.CHARSET:r.type=vt.CHARSET,r.name=h;break;case Ut.PALETTE:r.type=vt.PALETTE,r.name=h;break;case Ut.CONST:{const[d,...f]=u.values;if(yt(d)){const p=Dt(d),m=f.join(" ");if(yt(m)){const g=parseFloat(m);r[p]=Et(g)?g:m}else r[p]=1}break}case Ut.RANGE:case Ut.SELECT:case Ut.NUMBER:case Ut.TEXT:case Ut.HOTKEY:case Ut.ZSSEDIT:case Ut.CHAREDIT:case Ut.COLOREDIT:{const[d,...f]=u.values;if(yt(d)){const p=Dt(d);r[p]=[fn(u.type),...f]}break}}}}return r}function Bs(e){var t;return w(e)?(w((t=e.stats)==null?void 0:t.type)||(e.stats=_p(e.code),w(e.stats.type)||(e.stats.type=vt.OBJECT)),e.stats):{}}function GE(e){switch(e){default:case vt.ERROR:return"error";case vt.LOADER:return fn(Ut.LOADER);case vt.BOARD:return fn(Ut.BOARD);case vt.OBJECT:return fn(Ut.OBJECT);case vt.TERRAIN:return fn(Ut.TERRAIN);case vt.CHARSET:return fn(Ut.CHARSET);case vt.PALETTE:return fn(Ut.PALETTE)}}function pi(e){return Bs(e).type??vt.ERROR}function mi(e){return GE(pi(e))}function be(e){return Bs(e).name??""}function EF(e,t){return Bs(e)[t]}const xu=new Rh;function kF(e){if(!yt(e))return;const t=xa(e);if(w(t)&&w(zt[t]))return zt[t];const r=Dt(e),n=bt[r];if(w(n))return n}function Au(e,t){const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n],s=e[i];if(pe(s)){const[o,...a]=s;switch(o){case"text":w(t[i])||(t[i]="");break;case"range":w(t[i])||(t[i]=4);break;case"number":w(t[i])||(t[i]=0);break;case"select":if(!w(t[i])){const[,c]=a;t[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":t[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=kF(s)??s;break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=s===""?1:s;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Wt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Wt.ISSWIM;break;case"issolid":t.collision=Wt.ISSOLID;break;case"isbullet":t.collision=Wt.ISBULLET;break;case"isghost":t.collision=Wt.ISGHOST;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Ce(e){var t;if(w(e))switch(pi(e)){default:return;case vt.ERROR:return e.code??"";case vt.LOADER:return e.code??"";case vt.BOARD:{w(e.board)||(e.board=Qu()),e.board.id=e.id;const r=ic(e);return r.isdark&&(e.board.isdark=1),r.notdark&&(e.board.isdark=0),Et(r.startx)&&(e.board.startx=r.startx),Et(r.starty)&&(e.board.starty=r.starty),yt(r.over)&&(Dt(r.over)==="empty"?e.board.over=void 0:e.board.over=r.over,e.board.overboard=void 0),yt(r.under)&&(Dt(r.under)==="empty"?e.board.under=void 0:e.board.under=r.under,e.board.underboard=void 0),yt(r.camera)&&(Dt(r.camera)==="empty"?e.board.camera=void 0:e.board.camera=r.camera),yt(r.graphics)&&(Dt(r.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=r.graphics),Et(r.facing)&&(e.board.facing=r.facing),yt(r.facing)&&Dt(r.facing)==="empty"&&(e.board.facing=void 0),yt(r.exitnorth)&&(e.board.exitnorth=r.exitnorth),yt(r.exitsouth)&&(e.board.exitsouth=r.exitsouth),yt(r.exitwest)&&(e.board.exitwest=r.exitwest),yt(r.exiteast)&&(e.board.exiteast=r.exiteast),Et(r.timelimit)&&(e.board.timelimit=r.timelimit),r.restartonzap&&(e.board.restartonzap=1),r.norestartonzap&&(e.board.restartonzap=0),Et(r.maxplayershots)&&(e.board.maxplayershots=r.maxplayershots),e.board}case vt.OBJECT:return w(e.object)||(e.object=P_()),e.object.id=e.id,e.object.code=e.code,e.object.name=be(e),e.object.category=Nr.ISOBJECT,Au(ic(e),e.object),e.object;case vt.TERRAIN:return w(e.terrain)||(e.terrain=P_()),e.terrain.id=e.id,e.terrain.name=be(e),e.terrain.category=Nr.ISTERRAIN,Au(ic(e),e.terrain),e.terrain;case vt.PALETTE:{if(w(e.palette)||(e.palette=$_(jC)),w((t=e.palette)==null?void 0:t.bits)){const r=ic(e),n=jr(r);for(let i=0;i<n.length;++i){const s=n[i].toLowerCase(),o=r[s];if(s.startsWith("color")&&yt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){xu.set(o);const c=a*fl,l=xu.r*63,u=xu.g*63,h=xu.b*63;e.palette.bits[c+0]=Ge(l,0,63),e.palette.bits[c+1]=Ge(u,0,63),e.palette.bits[c+2]=Ge(h,0,63)}}}}return e.palette}case vt.CHARSET:return w(e.charset)||(e.charset=B_(DC)),e.charset}}function bp(e){return{id:We(),name:$A(),timestamp:0,activelist:[],pages:e,flags:{}}}var wp=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(wp||{});function xF(e){return Oo(e,wp,{pages:t=>t.map(bF),flags:t=>{const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function KE(e){return Ua(e,wp,{pages:t=>t.map(wF)})}function YE(e){w(e)&&(e.token=`${BA()}${_n(1111,9999)}`)}function Ds(e,t){if(!w(e))return;const r=Dt(t);return e.pages.find(i=>i.id===t||r===be(i))}function ar(e,t,r){if(!w(e))return;const n=Dt(r);return e.pages.find(s=>pi(s)===t&&(s.id===r||n===be(s)))}function vp(e,t,r){let n=ar(e,t,r);if(!w(n)){const i=GE(t);return n=ku(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),oc(e,n),[n,!0]}return[n,!1]}function js(e,t){return w(e)?e.pages.filter(r=>pi(r)===t):[]}function qE(e,t,r){if(!w(e))return[];const n=Dt(r);return e.pages.filter(s=>pi(s)===t).filter(s=>{const o=Bs(s),a=Dt(be(s));return s.id===r||n===a||w(o[r])})}function sc(e){return w(e)?Yn(e.pages).sort((r,n)=>{const i=pi(r),s=pi(n);return i===s?be(r).localeCompare(be(n)):s-i}):[]}function VE(e,t){if(w(t)){const r=ar(e,vt.TERRAIN,t.kind??"");if(w(r))return r;const n=ar(e,vt.OBJECT,t.kind??"");if(w(n))return n}}function oc(e,t){if(!w(e)||!w(t))return!1;const r=Ds(e,t.id);return w(r)?!1:(e.pages.push(t),YE(e),!0)}function XE(e,t){const r=Ds(e,t);if(w(e)&&w(r)){const n=Dt(t);return e.pages=e.pages.filter(i=>i.id!==t&&n!==be(i)),YE(e),r}}function gr(e,t=1,r=zt.WHITE,n=zt.BLACK){const i=e==null?void 0:e.kinddata;return{name:Dt((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??r,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??n,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function AF(e,t){return!!(e!=null&&e.flags[t])}function Mi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function JE(e,t){e&&delete e.flags[t]}function ZE(e,t,r){const n=Mi(e,t);return n==null?void 0:n[r]}function TF(e,t,r,n){const i=Mi(e,t);return i&&(i[r]=n),n}function Le(e){if(!w(e)||w(e.lookup)&&w(e.named))return;const t=new Array(Ct*te).fill(void 0),r={},n=Object.values(e.objects);for(let o=0;o<n.length;++o){const a=n[o];if(w(a.x)&&w(a.y)&&w(a.id)&&!w(a.removed)){a.category=Nr.ISOBJECT,t[a.x+a.y*Ct]=a.id,yt(a.code)&&!w(a.name)&&Au(_p(a.code),a);const c=gr(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(w(a)){a.x=i,a.y=s,a.category=Nr.ISTERRAIN;const c=gr(Rn(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Ct&&(i=0,++s)}e.lookup=t,e.named=r}function ac(e){w(e)&&(delete e.named,delete e.lookup,Le(e))}function Ep(e,t,r){var i;if(!w(e)||!w(e.named)||!w(t))return;const n=Dt(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[n]||(e.named[n]=new Set),e.named[n].add((t==null?void 0:t.id)??r??"")}function QE(e,t){if(!(!w(e)||!w(e.lookup)||!w(t==null?void 0:t.id))&&!w(t.removed)&&Jt(t,"collision")!==Wt.ISGHOST){const r=t.x??0,n=t.y??0;e.lookup[r+n*Ct]=t.id}}function SF(e,t){var r;if(w(e)&&w(t==null?void 0:t.x)&&w(t.y)){const n=gr(t),i=Di(e,t);w((r=e.named)==null?void 0:r[n.name])&&e.named[n.name].delete(i)}}function Tu(e,t){var r;if(w(e)&&w(t==null?void 0:t.id)){if(w(e.lookup)&&w(t.x)&&w(t.y)){const i=t.x+t.y*Ct;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const n=gr(t);w((r=e.named)==null?void 0:r[n.name])&&w(t.id)&&e.named[n.name].delete(t.id)}}function kp(e,t,r,n=!1){if(!w(e)||!w(e.lookup)||r.x<0||r.x>=Ct||r.y<0||r.y>=te)return;const i=r.x+r.y*Ct,s=Br(e,e.lookup[i]??"404");if(w(s))return n&&xr(s.id)?void 0:s;const o=e.terrain[i];if(w(o)&&_c(t,Jt(o,"collision")))return o}function RF(e,t,r){const n=Br(e,(t==null?void 0:t.id)??""),i=(n==null?void 0:n.x)??-1,s=(n==null?void 0:n.y)??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=Jt(n,"collision");return w(kp(e,o,r))}function xp(e,t,r){var d;const n=Br(e,(t==null?void 0:t.id)??"");if(!w(e)||!w(n)||!w(n.x)||!w(n.y)||!w(e.lookup)||r.x<0||r.x>=Ct||r.y<0||r.y>=te)return{name:"edge",kind:"edge",collision:Wt.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=Di(e,n),s=Di(e,r),o=Jt(n,"collision");if(o===Wt.ISGHOST)return;const a=xr(n==null?void 0:n.id),c=o===Wt.ISBULLET,l=Br(e,e.lookup[s]??"");if(Jt(l,"collision")===Wt.ISGHOST)return;const u=xr((l==null?void 0:l.id)??"");if(w(l)&&(!a||!u)){const f=Jt(n,"group"),p=Jt(l,"group");if((f||p)&&f!=p)return{...l};const m=!!Jt(l,"breakable");if(c&&m)return n.x=r.x,n.y=r.y,{...l};if(o===Wt.ISBULLET)return{...l};const g=!!Jt(l,"item");if(y0(n,l)&&(!a||!g)){const b=$n({x:n.x,y:n.y},r),A=De({x:l.x??0,y:l.y??0},b),T=xp(e,l,A);if(w(T))return{...l}}else return{...l}}const h=e.terrain[s];if(w(h)){const f=h.collision??((d=h==null?void 0:h.kinddata)==null?void 0:d.collision)??Wt.ISWALK;if(_c(o,f))return{...h,x:r.x,y:r.y}}n.x=r.x,n.y=r.y,w(n.removed)||(e.lookup[i]=void 0,e.lookup[s]=n.id??"")}function OF(e,t){const r=[];if(!w(e))return r;const n=Object.values(e.objects);for(let i=0;i<n.length;++i){const s=n[i];w(s.id)&&w(s.removed)&&t-s.removed>Rc*5&&(r.push(s.id),Yx(e,s.id))}return r}function IF(e,t){const r=[];if(!w(e))return r;e.lookup=void 0,Le(e);const n=Object.values(e.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Rn(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Jt(o,"cycle");if(l>u)continue}r.push({id:o.id,type:vt.OBJECT,code:c,object:o,terrain:void 0})}}const i=OF(e,t);for(let s=0;s<i.length;++s)r.push({id:i[s],type:vt.ERROR,code:"",object:void 0,terrain:void 0});return r}function tk(e,t,r){const n=[],i=[];if(!w(e))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Jt(a,r);return w(l)||gr(a).name===r||Jt(a,"group")===r}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<Lh;++a){const c=e.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function ek(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=fe(t,{x:s,y:i});Ye(o)&&Ir(t,o,e.timestamp),Ue(t,{x:s,y:i})}}function NF(e,t,r){for(let n=t.y;n<=r.y;++n)for(let i=t.x;i<=r.x;++i)Ue(e,{x:i,y:n})}function rk(e,t,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=fe(t,{x:s,y:i});Ye(o)&&Ir(t,o,e.timestamp),Ue(t,{x:s,y:i})}}function $o(e,t){w(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.displaychar=t.displaychar,e.displaycolor=t.displaycolor,e.displaybg=t.displaybg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.p4=t.p4,e.p5=t.p5,e.p6=t.p6,e.code=t.code,e.item=t.item,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.lightdir=t.lightdir,e.stepx=t.stepx,e.stepy=t.stepy,e.shootx=t.shootx,e.shooty=t.shooty,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Su(e,t,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return CF(e,t,r,"",i)}if(!w(x.book))return;const s=x.book,o=ar(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=ar(s,vt.BOARD,t),l=Ce(c);if(!w(l))return;Le(a),Le(l);let u=!1;if(w(a)&&w(l)){switch(i){case"all":ek(s,l,r,n);break;case"object":rk(s,l,r,n);break;case"terrain":NF(l,r,n);break;default:u=!0;break}for(let h=r.y;h<=n.y;++h)for(let d=r.x;d<=n.x;++d){let f=!1,p=!1;switch(i){case"all":f=!0,p=!0;break;case"object":f=!0;break;case"terrain":p=!0;break}const m={x:d,y:h};let g,y=fe(a,m);if(Ye(y)?(g=us(a,d,h),xr(y==null?void 0:y.id)&&(y=void 0)):(g=y,y=void 0),w(g)&&(p||u&&Jt(g,"group")===i)){u&&ek(s,l,m,m);const b=On(l,[g.kind??""],m);$o(b,g)}if(w(y)&&(f||u&&Jt(y,"group")===i)){u&&rk(s,l,m,m);const b=On(l,[y.kind??""],m);$o(b,y)}}ac(l)}}function CF(e,t,r,n,i){if(!w(x.book))return;const s=x.book,o=ar(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=ar(s,vt.BOARD,t),l=Ce(c);if(w(l)&&(Le(a),Le(l),w(a)&&w(l))){const{terrainelements:u,objectelements:h}=tk(a,n,i);if(u.length===0&&h.length===0)return;const d={x:Ct,y:te};for(let f=0;f<u.length;++f){const p=u[f];Et(p.x)&&(d.x=Math.min(d.x,p.x)),Et(p.y)&&(d.y=Math.min(d.y,p.y))}for(let f=0;f<h.length;++f){const p=h[f];Et(p.x)&&(d.x=Math.min(d.x,p.x)),Et(p.y)&&(d.y=Math.min(d.y,p.y))}for(let f=0;f<u.length;++f){const p=u[f],m={x:r.x+(p.x??0)-d.x,y:r.y+(p.y??0)-d.y},g=fe(l,m);w(g)&&(Ye(g)&&Ir(l,g,s.timestamp),Ue(l,m));const y=On(l,[p.kind??""],m);$o(y,p)}for(let f=0;f<h.length;++f){const p=h[f],m={x:r.x+(p.x??0)-d.x,y:r.y+(p.y??0)-d.y},g=On(l,[p.kind??""],m);$o(g,p)}ac(l)}}function LF(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Ru(e,t,r){if(!w(e))return;TF(e,t,"board",r);const n=br(r);w(n)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function Bo(e,t,r,n,i=!1){const s=Ve(t);if(!w(e)||!w(s))return;const o=Br(s,t);if(!Ye(o)||!(o!=null&&o.id))return;const a=br(r);if(!w(a))return;Le(a);const c=kp(a,Wt.ISWALK,n,!0);if(i===!1&&w(c))if(Jt(c,"item"))Xe(t,o,c,"touch");else return;Tu(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,Ep(a,o),QE(a,o),Ru(e,t,a.id)}function MF(e){const r=((e==null?void 0:e.activelist)??[]).map(n=>{const i=ZE(e,n,"board");return yt(i)?i:""});return hI(r)}function Do(e){const t=MF(e),r=new Set,n=[];for(let i=0;i<t.length;++i){const s=br(t[i]);if(w(s)&&!r.has(s.id)){if(yt(s.over))if(yt(s.overboard)){const o=br(s.overboard);w(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=br(s.over);w(o)&&(s.overboard=o.id)}else yt(s.overboard)&&delete s.overboard;if(n.push(s),yt(s.under))if(yt(s.underboard)){const o=br(s.underboard);w(o)||delete s.underboard}else{const o=br(s.under);w(o)&&(s.underboard=o.id)}else yt(s.underboard)&&delete s.underboard}}return n}const UF=my(32,126).map(e=>String.fromCharCode(e)),PF=un({name:"Whitespace",pattern:/ +/}),FF=un({name:"WhitespaceSkipped",pattern:/ +/,group:mr.SKIPPED}),Ap=un({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),nk=un({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:UF}),Tp=un({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Sp=un({name:"EscapedDollar",pattern:"$$"}),Rp=un({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Op=un({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),ik=un({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function $F(e,t=""){return un({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const sk=Object.keys(ka).map(e=>$F(`\\$(${e})`,e)),BF=[PF,Ap,...sk,Tp,nk,Op,Sp,ik,Rp],DF=new mr(BF,{skipValidations:!ni,ensureOptimizations:ni}),jF=new mr([FF,Ap,...sk,Tp,nk,Op,Sp,ik,Rp],{skipValidations:!ni,ensureOptimizations:ni}),ok=/\$CENTER/i;function zF(e){if(ok.test(e))return e.replace(ok,"")}function Ip(e,t=!1){return t?jF.tokenize(e):DF.tokenize(e)}function Np(e,t,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function ak(e){e.active={...e.reset}}function ck(e,t){const r=t.y;function n(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}n()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Sp:s("$");break;case Op:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}n();break;case Tp:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Ap:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=ka[l],h=pI(zt[u]),d=Nh(zt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):w(h)?t.active.color=h:w(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(w(t.writefullwidth)&&(t.x>o||t.y===r)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){ak(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;HF(u,u+l.length,t.active.color,t.active.bg,t),WF(u,l,t)}}}function lk(e,t,r){const n=Ip(e);n.tokens&&(ck(n.tokens,t),r&&ak(t),t.changed())}function uk(e,t,r){const n=Ip(e);if(!n.tokens)return;const i=Np(t,r,zt.WHITE,zt.BLACK);return i.measureonly=!0,ck(n.tokens,i),i.x>0&&++i.y,i}function WF(e,t,r){let n=0;const i=e+t.length;for(let s=e;s<i;++s)r.char[s]=t.charCodeAt(n++);r.changed()}function HF(e,t,r,n,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function Ou(e,t,r){var a;if(!w((a=x.element)==null?void 0:a.x)||!w(x.element.y))return 0;const[n,i]=ut(t,0,[V.DIR,V.MAYBE_KIND]);x.element.shootx=Ge(n.destpt.x-n.startpt.x,-1,1),x.element.shooty=Ge(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Fz(x.board,s,{x:x.element.x,y:x.element.y});if(w(o)){w(r)&&(o.arg=r),o.cycle=1,o.party=x.elementid,o.collision=Wt.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-x.element.x,o.stepy=n.destpt.y-x.element.y,o.bg=zt.ONCLEAR;const c=Rn(o),l=o.code??(c==null?void 0:c.code)??"";Fx(x.book,x.board,o,l)}return e.yield(),0}function Iu(e,t,r){var i,s;if(!Ea(x.element)||!w(x.book)||!w(x.board)||!w(x.element))return 0;Le(x.board);const[n]=ut(x.words,0,[V.ANY]);if(Hr(n)){const[o,a]=ut(e,0,[V.DIR,V.KIND]),{destpt:c}=o;if(c.x<0||c.x>=Ct||c.y<0||c.y>=te)return 0;const[l]=a,u=Rn({kind:l}),h=Jt(u,"collision");if(h===Wt.ISGHOST)return On(x.board,a,o.destpt,t),0;const d=fe(x.board,o.destpt);if((d==null?void 0:d.category)===Nr.ISOBJECT&&(d!=null&&d.pushable)){const f={x:((i=x.element)==null?void 0:i.x)??0,y:((s=x.element)==null?void 0:s.y)??0},p=De(o.destpt,$n(f,o.destpt));xp(x.board,d,p)}if(Ye(u)||On(x.board,a,o.destpt,t),Ye(u)){const f=kp(x.board,h,o.destpt);if(!w(f)){const p=On(x.board,a,o.destpt,t);w(p)&&w(r)&&(p.arg=r)}}}return 0}function GF(e,t,r){if(!w(x.book)||!w(x.board))return 0;Le(x.board);const[n,i]=ut(t,0,[V.DIR,V.DIR]),s=fe(x.board,n.destpt);return Ye(s),0}const KF={x:0,y:0},YF={x:Ct-1,y:te-1},qF="all",VF=Ti().command("goto",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ut(t,0,[V.STRING]),[i,s]=ut(t,n,[V.MAYBE_NUMBER,V.MAYBE_NUMBER]),o=br(r);if(!w(o))return 0;Le(o);const a={x:i??o.startx??Math.round(Ct*.5),y:s??o.starty??Math.round(te*.5)},c=gr(x.element);if(c.name!=="player"){const l=Jt(x.element,"color"),u=Jt(x.element,"bg"),h=Aa(l,u),d=Zu(o,[c.name,h]),[f]=d.sort((p,m)=>{const g=p.y??1e4,y=m.y??1e4,b=g-y;if(b!==0)return b;const A=p.x??1e4,T=m.x??1e4;return A-T});w(f)&&Et(f.x)&&Et(f.y)&&(a.x=f.x,a.y=f.y)}return Bo(x.book,x.elementfocus,o.id,a,!0),0}).command("build",(e,t)=>{if(!w(x.book)||!w(x.board)||!w(x.element))return 0;const[r,n]=ut(t,0,[V.NAME,V.MAYBE_STRING]),i=Qu();if(w(i)){if(yt(n)){const s=br(n);w(s)&&Su(s.id,i.id,KF,YF,qF)}e.set(r,i.id)}return 0}).command("shove",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;Le(x.board);const[r,n]=ut(t,0,[V.DIR,V.DIR]),i=fe(x.board,r.destpt);return Ye(i)&&ls(x.book,x.board,i,n.destpt),0}).command("duplicate",GF).command("write",(e,t)=>{var d;if(!w(x.book)||!w(x.board))return 0;Le(x.board);const[r,n,i]=ut(t,0,[V.DIR,V.COLOR]),s=t.slice(i).map(Ie).join(" "),{color:o,bg:a}=Ey(n),c=((d=uk(s,256,1))==null?void 0:d.measuredwidth)??1,l=Np(256,1,o??zt.WHITE,a??zt.BLACK);lk(s,l,!1);const u=c-1;switch($n(r.startpt,r.destpt)){case bt.EAST:for(let f=0;f<c;++f)Ue(x.board,{x:r.destpt.x+f,y:r.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case bt.WEST:for(let f=0;f<c;++f)Ue(x.board,{x:r.destpt.x+f-u,y:r.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case bt.NORTH:for(let f=0;f<c;++f)Ue(x.board,{x:r.destpt.x,y:r.destpt.y+f-u,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case bt.SOUTH:for(let f=0;f<c;++f)Ue(x.board,{x:r.destpt.x,y:r.destpt.y+f,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break}return 0}).command("change",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;Le(x.board);const[r,n]=ut(t,0,[V.KIND,V.KIND]);(yc(r)??"")==="empty"&&Zz(x.board).forEach(c=>{On(x.board,n,c)});const s=yc(n),o=Ju(n),a=Bx(n);return Zu(x.board,r).forEach(c=>{if(w(o)&&(c.color=o),w(a)&&(c.bg=a),gr(c).name!==s){const u=Jt(c,"color"),h=Jt(c,"bg");if(Ir(x.board,c,x.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},f=On(x.board,n,d);w(f)&&(f.color=u,f.bg=h)}}}),0}).command("put",(e,t)=>Iu(t)).command("putwith",(e,t)=>{const[r,n]=ut(t,0,[V.ANY]);return Iu(t.slice(n),void 0,r)}).command("oneof",(e,t)=>{const[r,n]=ut(t,0,[V.ANY]);return w(x.board)&&Br(x.board,r)?0:Iu(t.slice(n),r)}).command("oneofwith",(e,t)=>{const[r,n,i]=ut(t,0,[V.ANY,V.ANY]);return w(x.board)&&Br(x.board,n)?0:Iu(t.slice(i),n,r)}).command("shoot",Ou).command("shootwith",(e,t)=>{const[r,n]=ut(t,0,[V.ANY]);return Ou(e,t.slice(n),r)}).command("throwstar",(e,t)=>Ou(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[r,n]=ut(t,0,[V.ANY]);return Ou(e,[...t.slice(n),"star"],r)});var zs=(e=>(e[e.Border=-1]="Border",e[e.Data=0]="Data",e[e.Function=1]="Function",e[e.Position=2]="Position",e[e.Timing=3]="Timing",e[e.Alignment=4]="Alignment",e))(zs||{}),XF=Object.defineProperty,JF=(e,t,r)=>t in e?XF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nu=(e,t,r)=>(JF(e,typeof t!="symbol"?t+"":t,r),r);const ZF=[0,1],fk=[1,0],hk=[2,3],dk=[3,2],QF={L:ZF,M:fk,Q:hk,H:dk},t$=/^[0-9]*$/,e$=/^[A-Z0-9 $%*+.\/:-]*$/,Cp="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Lp=1,Mp=40,pk=3,r$=3,Cu=40,n$=10,mk=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],gk=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class i${constructor(t,r,n,i){if(this.version=t,this.ecc=r,Nu(this,"size"),Nu(this,"mask"),Nu(this,"modules",[]),Nu(this,"types",[]),t<Lp||t>Mp)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=t*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(t,r){return t>=0&&t<this.size&&r>=0&&r<this.size&&this.modules[r][t]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,zs.Timing),this.setFunctionModule(n,6,n%2===0,zs.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),r=t.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(t[n],t[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const r=this.ecc[1]<<3|t;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Pi(i,s));this.setFunctionModule(8,7,Pi(i,6)),this.setFunctionModule(8,8,Pi(i,7)),this.setFunctionModule(7,8,Pi(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Pi(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Pi(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Pi(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let n=0;n<12;n++)t=t<<1^(t>>>11)*7973;const r=this.version<<12|t;for(let n=0;n<18;n++){const i=Pi(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(t,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=t+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,zs.Position)}}drawAlignmentPattern(t,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(t+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,zs.Alignment)}setFunctionModule(t,r,n,i=zs.Function){this.modules[r][t]=n,this.types[r][t]=i}addEccAndInterleave(t){const r=this.version,n=this.ecc;if(t.length!==Lu(r,n))throw new RangeError("Invalid argument");const i=gk[n[0]][r],s=mk[n[0]][r],o=Math.floor(Pp(r)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=d$(s);for(let d=0,f=0;d<i;d++){const p=t.slice(f,f+c-s+(d<a?0:1));f+=p.length;const m=p$(p,u);d<a&&p.push(0),l.push(p.concat(m))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((f,p)=>{(d!==c-s||p>=a)&&h.push(f[d])});return h}drawCodewords(t){if(t.length!==Math.floor(Pp(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<t.length*8&&(this.modules[c][o]=Pi(t[r>>>3],7-(r&7)),r++)}}}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(t){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let t=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?t+=pk:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Cu),o=this.modules[s][l],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Cu}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?t+=pk:a>5&&t++):(this.finderPenaltyAddHistory(a,c),o||(t+=this.finderPenaltyCountPatterns(c)*Cu),o=this.modules[l][s],a=1);t+=this.finderPenaltyTerminateAndCount(o,a,c)*Cu}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(t+=r$)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return t+=i*n$,t}getAlignmentPatternPositions(){if(this.version===1)return[];{const t=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(t*2-2))*2,n=[6];for(let i=this.size-7;n.length<t;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(t){const r=t[1],n=r>0&&t[2]===r&&t[3]===r*3&&t[4]===r&&t[5]===r;return(n&&t[0]>=r*4&&t[6]>=r?1:0)+(n&&t[6]>=r*4&&t[0]>=r?1:0)}finderPenaltyTerminateAndCount(t,r,n){return t&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(t,r){r[0]===0&&(t+=this.size),r.pop(),r.unshift(t)}}function Ui(e,t,r){if(t<0||t>31||e>>>t)throw new RangeError("Value out of range");for(let n=t-1;n>=0;n--)r.push(e>>>n&1)}function Pi(e,t){return(e>>>t&1)!==0}class Up{constructor(t,r,n){if(this.mode=t,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const s$=[1,10,12,14],o$=[2,9,11,13],a$=[4,8,16,16];function yk(e,t){return e[Math.floor((t+7)/17)+1]}function _k(e){const t=[];for(const r of e)Ui(r,8,t);return new Up(a$,e.length,t)}function c$(e){if(!bk(e))throw new RangeError("String contains non-numeric characters");const t=[];for(let r=0;r<e.length;){const n=Math.min(e.length-r,3);Ui(Number.parseInt(e.substring(r,r+n),10),n*3+1,t),r+=n}return new Up(s$,e.length,t)}function l$(e){if(!wk(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");const t=[];let r;for(r=0;r+2<=e.length;r+=2){let n=Cp.indexOf(e.charAt(r))*45;n+=Cp.indexOf(e.charAt(r+1)),Ui(n,11,t)}return r<e.length&&Ui(Cp.indexOf(e.charAt(r)),6,t),new Up(o$,e.length,t)}function u$(e){return e===""?[]:bk(e)?[c$(e)]:wk(e)?[l$(e)]:[_k(h$(e))]}function bk(e){return t$.test(e)}function wk(e){return e$.test(e)}function f$(e,t){let r=0;for(const n of e){const i=yk(n.mode,t);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function h$(e){e=encodeURI(e);const t=[];for(let r=0;r<e.length;r++)e.charAt(r)!=="%"?t.push(e.charCodeAt(r)):(t.push(Number.parseInt(e.substring(r+1,r+3),16)),r+=2);return t}function Pp(e){if(e<Lp||e>Mp)throw new RangeError("Version number out of range");let t=(16*e+128)*e+64;if(e>=2){const r=Math.floor(e/7)+2;t-=(25*r-10)*r-55,e>=7&&(t-=36)}return t}function Lu(e,t){return Math.floor(Pp(e)/8)-mk[t[0]][e]*gk[t[0]][e]}function d$(e){if(e<1||e>255)throw new RangeError("Degree out of range");const t=[];for(let n=0;n<e-1;n++)t.push(0);t.push(1);let r=1;for(let n=0;n<e;n++){for(let i=0;i<t.length;i++)t[i]=Fp(t[i],r),i+1<t.length&&(t[i]^=t[i+1]);r=Fp(r,2)}return t}function p$(e,t){const r=t.map(n=>0);for(const n of e){const i=n^r.shift();r.push(0),t.forEach((s,o)=>r[o]^=Fp(s,i))}return r}function Fp(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(t>>>n&1)*e;return r}function m$(e,t,r=1,n=40,i=-1,s=!0){if(!(Lp<=r&&r<=n&&n<=Mp)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const h=Lu(o,t)*8,d=f$(e,o);if(d<=h){a=d;break}if(o>=n)throw new RangeError("Data too long")}for(const h of[fk,hk,dk])s&&a<=Lu(o,h)*8&&(t=h);const c=[];for(const h of e){Ui(h.mode[0],4,c),Ui(h.numChars,yk(h.mode,o),c);for(const d of h.getData())c.push(d)}const l=Lu(o,t)*8;Ui(0,Math.min(4,l-c.length),c),Ui(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)Ui(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new i$(o,t,u,i)}function g$(e,t){var h;const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=t||{},c=typeof e=="string"?u$(e):Array.isArray(e)?[_k(e)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof e}`);const l=m$(c,QF[r],i,s,o,n),u=y$({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return t!=null&&t.invert&&(u.data=u.data.map(d=>d.map(f=>!f))),(h=t==null?void 0:t.onEncoded)==null||h.call(t,u),u}function y$(e,t=1){if(!t)return e;const{size:r}=e,n=r+t*2;e.size=n,e.data.forEach(s=>{for(let o=0;o<t;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<t;s++)e.data.unshift(Array.from({length:n},o=>!1)),e.data.push(Array.from({length:n},o=>!1));const i=zs.Border;e.types.forEach(s=>{for(let o=0;o<t;o++)s.unshift(i),s.push(i)});for(let s=0;s<t;s++)e.types.unshift(Array.from({length:n},o=>i)),e.types.push(Array.from({length:n},o=>i));return e}function _$(e,t,r,n=!1){return t<0||r<0||t>=e.length||r>=e.length?n:e[r][t]}function b$(e,t={}){const r={WHITE_ALL:"â",WHITE_BLACK:"â",BLACK_WHITE:"â",BLACK_ALL:" "},n=g$(e,t),i=!1,s=!0,o=(l,u)=>_$(n.data,l,u,!0),a=[];let c="";for(let l=0;l<n.size;l+=2){for(let u=0;u<n.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=r.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=r.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const rs="$dkpurple",w$="$196",v$="$205",Ze="$yellow$205$205$205$196";function we(e,t,r){lT(e,t,r)}function E$(e,t,r){const n=w$.repeat(r);we(e,t,`${rs}${n}`)}function $p(e,t,r){const n=v$.repeat(r);we(e,t,`${rs}${n}`)}function Bp(e,t,r){we(e,t,`${rs} ${" ".repeat(r.length)} `),E$(e,t,r.length+2),we(e,t,`${rs} $white${r} `),$p(e,t,r.length+2)}function Ws(e,t,r){we(e,t,`${rs} ${" ".repeat(r.length)} `),we(e,t,`${rs} $gray${r} `),$p(e,t,r.length+2)}function Hs(e,t,r,n){we(e,t,`${rs} $white${r} $blue${n}`)}function jo(e,t,r){we(e,t,`${rs}$blue${r}`)}function k$(e,t,r,n){we(e,t,`!${r};${n}`)}function x$(e,t,r,n,i=!0){if(i){const s=b$(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(l=>`$${o[l.charCodeAt(0)]}`).join("");we(e,t,c)}}we(e,t,`!copyit ${r};${n}`),WT(e,t)}var A$=`desc;$DKGRAYname and type of codepage
`,T$=Object.freeze({__proto__:null,default:A$}),S$="desc;changes object into specified element",R$=Object.freeze({__proto__:null,default:S$}),O$="desc;like #play but for sound effects",I$=Object.freeze({__proto__:null,default:O$}),N$="",C$=Object.freeze({__proto__:null,default:N$}),L$="",M$=Object.freeze({__proto__:null,default:L$}),U$="",P$=Object.freeze({__proto__:null,default:U$}),F$="",$$=Object.freeze({__proto__:null,default:F$}),B$="",D$=Object.freeze({__proto__:null,default:B$}),j$="",z$=Object.freeze({__proto__:null,default:j$}),W$="",H$=Object.freeze({__proto__:null,default:W$}),G$="",K$=Object.freeze({__proto__:null,default:G$}),Y$="",q$=Object.freeze({__proto__:null,default:Y$}),V$="",X$=Object.freeze({__proto__:null,default:V$}),J$="",Z$=Object.freeze({__proto__:null,default:J$}),Q$="",tB=Object.freeze({__proto__:null,default:Q$}),eB="",rB=Object.freeze({__proto__:null,default:eB}),nB="",iB=Object.freeze({__proto__:null,default:nB}),sB="",oB=Object.freeze({__proto__:null,default:sB}),aB=`desc;$DKGRAYstarts a section of an if-do-done block
`,cB=Object.freeze({__proto__:null,default:aB}),lB=`desc;$DKGRAYcompletes an if-do-done block
`,uB=Object.freeze({__proto__:null,default:lB}),fB="",hB=Object.freeze({__proto__:null,default:fB}),dB="",pB=Object.freeze({__proto__:null,default:dB}),mB="",gB=Object.freeze({__proto__:null,default:mB}),yB=`desc;$DKGRAYelse logic in an if-do-done block
`,_B=Object.freeze({__proto__:null,default:yB}),bB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,wB=Object.freeze({__proto__:null,default:bB}),vB="",EB=Object.freeze({__proto__:null,default:vB}),kB="",xB=Object.freeze({__proto__:null,default:kB}),AB="",TB=Object.freeze({__proto__:null,default:AB}),SB="",RB=Object.freeze({__proto__:null,default:SB}),OB="",IB=Object.freeze({__proto__:null,default:OB}),NB="",CB=Object.freeze({__proto__:null,default:NB}),LB="",MB=Object.freeze({__proto__:null,default:LB}),UB="",PB=Object.freeze({__proto__:null,default:UB}),FB=`desc;$DKGRAYhalt until the next cycle
`,$B=Object.freeze({__proto__:null,default:FB}),BB=`desc;$DKGRAYevals condition for true or false
`,DB=Object.freeze({__proto__:null,default:BB}),jB="",zB=Object.freeze({__proto__:null,default:jB}),WB="",HB=Object.freeze({__proto__:null,default:WB}),GB="",KB=Object.freeze({__proto__:null,default:GB}),YB="",qB=Object.freeze({__proto__:null,default:YB}),VB="",XB=Object.freeze({__proto__:null,default:VB}),JB="",ZB=Object.freeze({__proto__:null,default:JB}),QB="",tD=Object.freeze({__proto__:null,default:QB}),eD="",rD=Object.freeze({__proto__:null,default:eD}),nD="",iD=Object.freeze({__proto__:null,default:nD}),sD="",oD=Object.freeze({__proto__:null,default:sD}),aD="",cD=Object.freeze({__proto__:null,default:aD}),lD="",uD=Object.freeze({__proto__:null,default:lD}),fD="",hD=Object.freeze({__proto__:null,default:fD}),dD="",pD=Object.freeze({__proto__:null,default:dD}),mD="",gD=Object.freeze({__proto__:null,default:mD}),yD="",_D=Object.freeze({__proto__:null,default:yD}),bD="",wD=Object.freeze({__proto__:null,default:bD}),vD="",ED=Object.freeze({__proto__:null,default:vD}),kD="",xD=Object.freeze({__proto__:null,default:kD}),AD="",TD=Object.freeze({__proto__:null,default:AD}),SD="",RD=Object.freeze({__proto__:null,default:SD}),OD=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,ID=Object.freeze({__proto__:null,default:OD}),ND="",CD=Object.freeze({__proto__:null,default:ND}),LD="",MD=Object.freeze({__proto__:null,default:LD}),UD="",PD=Object.freeze({__proto__:null,default:UD}),FD="",$D=Object.freeze({__proto__:null,default:FD}),BD="",DD=Object.freeze({__proto__:null,default:BD}),jD="",zD=Object.freeze({__proto__:null,default:jD}),WD="",HD=Object.freeze({__proto__:null,default:WD}),GD="",KD=Object.freeze({__proto__:null,default:GD}),YD="",qD=Object.freeze({__proto__:null,default:YD}),VD="",XD=Object.freeze({__proto__:null,default:VD}),JD="",ZD=Object.freeze({__proto__:null,default:JD}),QD="",t4=Object.freeze({__proto__:null,default:QD}),e4="",r4=Object.freeze({__proto__:null,default:e4}),n4="",i4=Object.freeze({__proto__:null,default:n4}),s4="",o4=Object.freeze({__proto__:null,default:s4}),a4="",c4=Object.freeze({__proto__:null,default:a4}),l4="",u4=Object.freeze({__proto__:null,default:l4}),f4="",h4=Object.freeze({__proto__:null,default:f4}),d4="",p4=Object.freeze({__proto__:null,default:d4}),m4=`desc;$DKGRAYdesignates an inactive label or comment
`,g4=Object.freeze({__proto__:null,default:m4}),y4=`desc;$DKGRAYadds hyperlink text

`,_4=Object.freeze({__proto__:null,default:y4}),b4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,w4=Object.freeze({__proto__:null,default:b4}),v4=`desc;$DKGRAYread number input into given stat/flag
`,E4=Object.freeze({__proto__:null,default:v4}),k4=`desc;$DKGRAYa slider input from 1 to 9 

`,x4=Object.freeze({__proto__:null,default:k4}),A4=`desc;$DKGRAYlist with label value pairs to pick from
`,T4=Object.freeze({__proto__:null,default:A4}),S4=`desc;$DKGRAYread text input into given stat/flag
`,R4=Object.freeze({__proto__:null,default:S4}),O4=`desc;$DKGRAYdesignates a starting point for running code
`,I4=Object.freeze({__proto__:null,default:O4}),N4=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,C4=Object.freeze({__proto__:null,default:N4}),L4=`desc;$DKGRAYwill move the object in the given direction
`,M4=Object.freeze({__proto__:null,default:L4}),U4=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,P4=Object.freeze({__proto__:null,default:U4}),F4=`desc;$DKGRAYcustom 8x14 charset
`,$4=Object.freeze({__proto__:null,default:F4}),B4=`desc;$DKGRAYsets stat to given value

`,D4=Object.freeze({__proto__:null,default:B4}),j4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,z4=Object.freeze({__proto__:null,default:j4}),W4=`desc;$DKGRAYread external content and/or handle events
`,H4=Object.freeze({__proto__:null,default:W4}),G4=`desc;$DKGRAYread number input into given stat/flag
`,K4=Object.freeze({__proto__:null,default:G4}),Y4=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,q4=Object.freeze({__proto__:null,default:Y4}),V4=`desc;$DKGRAYcustom palette colors
`,X4=Object.freeze({__proto__:null,default:V4}),J4=`desc;$DKGRAYa slider input from 1 to 9 

`,Z4=Object.freeze({__proto__:null,default:J4}),Q4=`desc;$DKGRAYlist with label value pairs to pick from
`,t5=Object.freeze({__proto__:null,default:Q4}),e5=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,r5=Object.freeze({__proto__:null,default:e5}),n5=`desc;$DKGRAYread text input into given stat/flag
`,i5=Object.freeze({__proto__:null,default:n5}),s5=`desc;$DKGRAYadds text
`,o5=Object.freeze({__proto__:null,default:s5}),a5=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,c5=Object.freeze({__proto__:null,default:a5}),l5=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,u5=Object.freeze({__proto__:null,default:l5}),f5=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,h5=Object.freeze({__proto__:null,default:f5}),d5=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,p5=Object.freeze({__proto__:null,default:d5}),m5=`header;player settings
#set user "name goes here"
`,g5=Object.freeze({__proto__:null,default:m5}),y5=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,_5=Object.freeze({__proto__:null,default:y5});const vk=Object.assign({"./editor/codepagename.txt":T$,"./editor/command/become.txt":R$,"./editor/command/bgplay.txt":I$,"./editor/command/bgvol.txt":C$,"./editor/command/bind.txt":M$,"./editor/command/board.txt":P$,"./editor/command/bpm.txt":$$,"./editor/command/break.txt":D$,"./editor/command/change.txt":z$,"./editor/command/char.txt":H$,"./editor/command/charset.txt":K$,"./editor/command/clear.txt":q$,"./editor/command/color.txt":X$,"./editor/command/continue.txt":Z$,"./editor/command/copy.txt":tB,"./editor/command/cycle.txt":rB,"./editor/command/die.txt":iB,"./editor/command/distort.txt":oB,"./editor/command/do.txt":cB,"./editor/command/done.txt":uB,"./editor/command/duplicate.txt":hB,"./editor/command/echo.txt":pB,"./editor/command/edge.txt":gB,"./editor/command/else.txt":_B,"./editor/command/elseif.txt":wB,"./editor/command/end.txt":EB,"./editor/command/endgame.txt":xB,"./editor/command/endwith.txt":TB,"./editor/command/fcrush.txt":RB,"./editor/command/fetch.txt":IB,"./editor/command/fetchwith.txt":CB,"./editor/command/foreach.txt":MB,"./editor/command/go.txt":PB,"./editor/command/idle.txt":$B,"./editor/command/if.txt":DB,"./editor/command/lock.txt":zB,"./editor/command/oneof.txt":HB,"./editor/command/oneofwith.txt":KB,"./editor/command/palette.txt":qB,"./editor/command/phaser.txt":XB,"./editor/command/pivot.txt":ZB,"./editor/command/play.txt":tD,"./editor/command/put.txt":rD,"./editor/command/putwith.txt":iD,"./editor/command/readbin.txt":oD,"./editor/command/readjson.txt":cD,"./editor/command/readline.txt":uD,"./editor/command/readrexpaint.txt":hD,"./editor/command/remix.txt":pD,"./editor/command/repeat.txt":gD,"./editor/command/restore.txt":_D,"./editor/command/reverb.txt":wD,"./editor/command/revert.txt":ED,"./editor/command/run.txt":xD,"./editor/command/runwith.txt":TD,"./editor/command/set.txt":RD,"./editor/command/shoot.txt":ID,"./editor/command/shootwith.txt":CD,"./editor/command/shove.txt":MD,"./editor/command/snapshot.txt":PD,"./editor/command/synth.txt":$D,"./editor/command/toast.txt":DD,"./editor/command/tts.txt":zD,"./editor/command/ttsvol.txt":HD,"./editor/command/twitchbroadcast.txt":KD,"./editor/command/twitchchat.txt":qD,"./editor/command/unlock.txt":XD,"./editor/command/vibrato.txt":ZD,"./editor/command/vol.txt":t4,"./editor/command/waitfor.txt":r4,"./editor/command/walk.txt":i4,"./editor/command/weave.txt":o4,"./editor/command/while.txt":c4,"./editor/command/with.txt":u4,"./editor/command/write.txt":h4,"./editor/command/zap.txt":p4,"./editor/comment.txt":g4,"./editor/hyperlink.txt":_4,"./editor/hyperlink/hotkey.txt":w4,"./editor/hyperlink/number.txt":E4,"./editor/hyperlink/range.txt":x4,"./editor/hyperlink/select.txt":T4,"./editor/hyperlink/text.txt":R4,"./editor/label.txt":I4,"./editor/shortgo.txt":C4,"./editor/shorttry.txt":M4,"./editor/stat/board.txt":P4,"./editor/stat/charset.txt":$4,"./editor/stat/const.txt":D4,"./editor/stat/hotkey.txt":z4,"./editor/stat/loader.txt":H4,"./editor/stat/number.txt":K4,"./editor/stat/object.txt":q4,"./editor/stat/palette.txt":X4,"./editor/stat/range.txt":Z4,"./editor/stat/select.txt":t5,"./editor/stat/terrain.txt":r5,"./editor/stat/text.txt":i5,"./editor/text.txt":o5,"./help/controls.txt":c5,"./help/developer.txt":u5,"./help/menu.txt":h5,"./help/nopages.txt":p5,"./help/player.txt":g5,"./help/text.txt":_5}),Ek={};jr(vk).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Ek[t]=vk[e].default});function b5(e){const t=Dt(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=Ek[t];if(w(r))return r;const{target:n,path:i}=zr(t);switch(n){case"editor":{const s=zr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function w5(e,t){const r=(e??"").split(`
`);for(let n=0;n<r.length;++n)t(r[n].split(";"))}function v5(e,t){const[r,...n]=t,i=n[0]??"",s=n[1]??"";switch(Dt(r.trim())){case"header":Bp(lt,e,i);break;case"section":Ws(lt,e,i);break;case"option":Hs(lt,e,i,s);break;default:r.trimStart().startsWith("!")?k$(lt,e,r.trimStart().slice(1),i):we(lt,e,r);break}}function Fi(e,t=!1){const[r]=ut(e,0,[V.ANY]);if(t&&Hr(r)){const[,n,i,s]=ut(e,0,[V.NAME,V.DIR,V.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:n,label:e.slice(s-1).join(" ")}}else if(yt(r)){const[n,i,s]=ut(e,0,[V.NAME,V.MAYBE_NAME]);if(yt(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...e.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Gs(){am(lt,$r())}function zo(e){w5(b5(`help:${e}`),t=>v5(x.elementfocus,t))}function kk(e){switch(e.label){case"helpmenu":zo("menu");break;case"helpcontrols":zo("controls");break;case"helptext":zo("text");break;case"helpdeveloper":zo("developer");break;case"helpplayer":zo("player");break;default:{const t=ge(Vt.MAIN),r=Do(t);w(e.targetname)?Jo(e.targetname,e.label,void 0,r):w(e.targetdir)&&Jo(e.targetdir.destpt,e.label,void 0,r);break}}}const E5=Ti().command("shortsend",(e,t)=>{const r=Fi(t);return kk(r),0}).command("send",(e,t)=>{const r=Fi(t,!0);return kk(r),0}).command("stat",(e,t)=>{const[r,...n]=t.map(Ie),i=n.join(" ");function s(o,a){if(w(o)&&(e.command("pageopen",o.id),a)){const c=be(o),l=mi(o);we(lt,x.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Dt(r)){case fn(Ut.LOADER):{const[o,a]=cs(Vt.MAIN,i,vt.LOADER);s(o,a);break}default:{const[o,a]=cs(Vt.MAIN,[r,...n].join(" "),vt.OBJECT);s(o,a);break}case fn(Ut.BOARD):{const[o,a]=cs(Vt.MAIN,i,vt.BOARD);s(o,a);break}case fn(Ut.OBJECT):{const[o,a]=cs(Vt.MAIN,i,vt.OBJECT);s(o,a);break}case fn(Ut.TERRAIN):{const[o,a]=cs(Vt.MAIN,i,vt.TERRAIN);s(o,a);break}case fn(Ut.CHARSET):{const[o,a]=cs(Vt.MAIN,i,vt.CHARSET);s(o,a);break}case fn(Ut.PALETTE):{const[o,a]=cs(Vt.MAIN,i,vt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const r=t.map(Ie).join(" ");if(w(x.element)&&x.elementisplayer){const{user:n}=In(x.elementid),i=yt(n)?n:"player";x.element.tickertext=`${i}: ${r}`,x.element.tickertime=x.timestamp;const s=gr(x.element);Re(lt,x.elementid,`$${zt[s.color]}$ON${zt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${r}`),Tf(lt,x.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=Fi(n);if(w(s.targetname)){const{user:o}=In(x.elementid),a=yt(o)?o:"player",c=gr(x.element),l=`$${zt[c.color]}$ON${zt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Re(lt,x.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[r,n]=ut(t,0,[V.MAYBE_NAME,V.MAYBE_STRING]);return yt(r)&&yt(n)?im(lt,x.elementfocus,r,n):jT(lt,x.elementfocus),0}).command("bookcreate",(e,t)=>{const[r]=ut(t,0,[V.MAYBE_NAME]),n=Cx(r);return w(n)&&e.command("bookopen",n.id),0}).command("bookopen",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=Gn(r);return w(n)?(im(lt,x.elementfocus,"selected",n.id),Gs()):_e(lt,x.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=ge(Vt.MAIN),i=Gn(r);return w(i)&&(n===i&&Nx(Vt.MAIN,""),Dz(r),Re(lt,x.elementfocus,`trashed [book] ${i.name}`),Gs(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=br(r);return w(n)&&Bo(x.book,x.elementfocus,n.id,{x:_n(0,Ct-1),y:_n(0,te-1)},!0),0}).command("pageopen",(e,t)=>{const[r,n]=ut(t,0,[V.NAME,V.MAYBE_NAME]);let i,s;const o=Sn();for(let a=0;a<o.length&&(s=o[a],i=Ds(s,r),!w(i));++a);if(w(i)&&w(s)){const a=be(i),c=mi(i);Re(lt,x.elementfocus,`opened [${c}] ${a}`);const l=[i.id,n];Eh(Sc(s.id,l),i.code);const u=mi(i);sm(lt,x.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else _e(lt,"pageopen",`page ${r} not found`,x.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=_r(Vt.MAIN),i=XE(n,r);if(w(r)){const s=be(i),o=mi(i);Re(lt,x.elementfocus,`trashed [${o}] ${s}`),Gs(),e.command("pages")}return 0}).command("help",(e,t)=>{const r=t.map(Ie).join(" ")||"menu";return e.command(`help${r}`),0}).command("books",()=>{Ws(lt,x.elementfocus,"books");const e=ge(Vt.MAIN);Hs(lt,x.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ge(Vt.MAIN);Hs(lt,x.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),$p(lt,x.elementfocus,7);const r=Sn();return r.length?r.forEach(n=>{we(lt,x.elementfocus,`!bookopen ${n.id};${n.name}`)}):jo(lt,x.elementfocus,"no books found"),we(lt,x.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=_r(Vt.MAIN);if(!w(e))return 0;Ws(lt,x.elementfocus,"pages"),Hs(lt,x.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?sc(e).forEach(n=>{const i=be(n),s=mi(n);we(lt,x.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(we(lt,x.elementfocus,""),zo("nopages"));const t=Sn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(Hs(lt,x.elementfocus,"content",`${n.name} $GREEN${n.id}`),sc(n).forEach(s=>{const o=be(s),a=mi(s);we(lt,x.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Ws(lt,x.elementfocus,"boards");const e=_r(Vt.MAIN);if(w(e)){Hs(lt,x.elementfocus,"main",`${e.name} $GREEN${e.id}`);const r=sc(e);r.filter(n=>pi(n)===vt.BOARD).forEach(n=>{const i=be(n);we(lt,x.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(we(lt,x.elementfocus,""),jo(lt,x.elementfocus,"$white no boards found"),jo(lt,x.elementfocus,"$white use @ to create a board"),jo(lt,x.elementfocus,"$white @board name of board"))}const t=Sn();for(let r=0;r<t.length;++r){const n=t[r];n.id!==e.id&&(Hs(lt,x.elementfocus,"content",`${n.name} $GREEN${n.id}`),sc(n).filter(s=>pi(s)===vt.BOARD).forEach(s=>{const o=be(s);we(lt,x.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Ws(lt,x.elementfocus,"$REDTRASH"),jo(lt,x.elementfocus,"books");const e=Sn();e.length&&(e.forEach(r=>{we(lt,x.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),we(lt,x.elementfocus,""));const t=ge(Vt.MAIN);return w(t)&&(jo(lt,x.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(r=>{const n=be(r);we(lt,x.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),we(lt,x.elementfocus,"")),0}).command("dev",()=>(Gs(),IT(lt,x.elementfocus),0)).command("share",()=>(Gs(),NT(lt,x.elementfocus),0)).command("save",()=>(Gs(),0)).command("fork",()=>(XT(lt,x.elementfocus),0)).command("itchiopublish",()=>(JT(lt,x.elementfocus),0)).command("nuke",()=>(CT(lt,x.elementfocus),0)).command("restart",()=>(VT(lt,x.elementfocus),Gs(),0)).command("export",()=>{Bp(lt,x.elementfocus,"E X P O R T"),Ws(lt,x.elementfocus,"books");const e=Sn();return e.length&&e.forEach(t=>we(lt,x.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=Gn(r);return w(n)&&(Bp(lt,x.elementfocus,"E X P O R T"),Ws(lt,x.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=sc(n);we(lt,x.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=be(s),a=mi(s);we(lt,x.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=Gn(r);return w(n)&&rm(lt,x.elementfocus,Yn(n),`${n.name}.book.json`),0}).command("pageexport",(e,t)=>{const[r]=ut(t,0,[V.NAME]),{target:n,path:i}=zr(r),s=Gn(n),o=Ds(s,i);return w(o)&&rm(lt,x.elementfocus,Yn(o),`${be(o)}.${mi(o)}.json`),0}).command("gadget",()=>(zT(lt,x.elementfocus),0)).command("zztsearch",(e,t)=>{const[r,n]=ut(t,0,[V.NAME,V.MAYBE_NAME]),i=w(n)?r:"title",s=w(n)?n:r;return HT(lt,x.elementfocus,i,s),0}).command("zztrandom",()=>(GT(lt,x.elementfocus),0)).command("joincode",(e,t)=>{const[r]=ut(t,0,[V.MAYBE_NAME]);return bT(lt,x.elementfocus,!!r),0}).command("jointab",(e,t)=>{const[r]=ut(t,0,[V.MAYBE_NAME]);return wT(lt,x.elementfocus,!!r),0}).command("startlookingglass",()=>(LT(lt,x.elementfocus),0)),k5=Ti().command("toast",(e,t)=>{const r=t.map(Ie).join("");return Tc(lt,x.elementfocus,r),0}).command("ticker",(e,t)=>{const r=t.map(Ie).join("");return w(x.element)&&(x.element.tickertext=r,x.element.tickertime=x.timestamp),0}).command("palette",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=Mx(),i=ar(x.book,vt.PALETTE,r);return w(i)?(n.palette=i.id,Re(lt,x.elementfocus,`loaded palette ${r}`)):_e(lt,x.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(e,t)=>{const[r]=ut(t,0,[V.NAME]),n=Mx(),i=ar(x.book,vt.CHARSET,r);return w(i)?(n.charset=i.id,Re(lt,x.elementfocus,`loaded charset ${r}`)):_e(lt,x.elementfocus,"not-found",`unabled to find charset ${r}`),0}),Dp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Wt.ISSOLID,Wt.ISWALK,Wt.ISSWIM,Wt.ISBULLET,Wt.ISGHOST,Wt.ISWALK,Wt.ISSWIM;function Mu(e){return pe(e)&&jp(e[0])}function jp(e){return w(Wt[e])&&yt(e)}function x5(e){if(yt(e))return Dp[Dt(e)]}function A5(e){const t=x.words[e];if(Mu(t))return[t,e+1];if(jp(t))return[[t],e+1];const[r,n]=Pr(e);return Mu(r)?[r,n]:jp(r)?[[r],n]:[void 0,e]}function Wo(e,t=0){const r=[];let n=e;for(;n<x.words.length;){const[i,s]=Pr(n);if(pe(i)&&!Hr(i)&&!cc(i)&&!Mu(i)&&!Cr(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),t>0&&r.length>=t)return[r,n]}return[r,n]}function Pr(e){var n,i,s,o,a,c,l,u,h;const t=x.words[e],r=e+1;if(Ak(t)){const[d,f]=T5(e);if(w(d))return[d,f]}if(x5(t)){const[d,f]=A5(e);if(w(d))return[d,f]}if(xa(t)){const[d,f]=ul(e);if(w(d))return[d,f]}if(yt(t)&&Dt(t)==="rnd"){const[d,f]=Pr(r),[p,m]=Pr(f);return Et(d)&&Et(p)?[_n(d,p),m]:Et(d)?[_n(0,d),f]:[_n(0,1),r]}if(al(t)){const[d,f]=by(e);if(w(d))return[d,f]}if(!w(t))return[void 0,e];if(Et(t)||pe(t))return[t,r];if(yt(t)){const d=Dt(t),f=(n=x.get)==null?void 0:n.call(x,t);if(w(f))return[f,r];switch(d){case"aligned":case"alligned":{const p=bc(x.board,{x:((i=x.element)==null?void 0:i.x)??-1,y:((s=x.element)==null?void 0:s.y)??-1},x.elementfocus);return!w(x.element)||!w(p)?[0,r]:[x.element.x===p.x||x.element.y===p.y?1:0,r]}case"contact":{const p=bc(x.board,{x:((o=x.element)==null?void 0:o.x)??-1,y:((a=x.element)==null?void 0:a.y)??-1},x.elementfocus);if(!w(x.element)||!w(p))return[0,r];const m=(p.x??0)-(((c=x.element)==null?void 0:c.x)??0),g=(p.y??0)-(((l=x.element)==null?void 0:l.y)??0);return[m===0&&Math.abs(g)<2||g===0&&Math.abs(m)<2?1:0,r]}case"blocked":{const[p,m]=ut(x.words,r,[V.DIR]);return[RF(x.board,x.element,p.destpt)?1:0,m]}case"any":{const[p]=ut(x.words,r,[V.ANY]);if(Hr(p)){const[b,A,T]=ut(x.words,r,[V.DIR,V.COLOR_OR_KIND]),k=b.layer===bt.MID?fe(x.board,b.destpt):us(x.board,b.destpt.x,b.destpt.y);if(w(k)){const I=gr(k);if(Cr(A))return[cl(A)===I.color||ll(A)===I.bg?[k]:[],T];const R=Dt(yc(A)),$=Ju(A);if((R.length&&R!==I.name||w($)&&$!==I.color)===!1)return[[k],T]}return[[],T]}const[m,g]=ut(x.words,r,[V.COLOR_OR_KIND]);return Cr(m)?[Dx(x.board,m),g]:[Zu(x.board,m),g]}case"countof":{const[p]=ut(x.words,r,[V.ANY]);if(Hr(p)){const[b,A,T]=ut(x.words,r,[V.DIR,V.COLOR_OR_KIND]),k=b.layer===bt.MID?fe(x.board,b.destpt):us(x.board,b.destpt.x,b.destpt.y);if(w(k)){const I=gr(k);if(Cr(A))return[cl(A)===I.color||ll(A)===I.bg?1:0,T];const R=Dt(yc(A)),$=Ju(A),M=R.length?R===I.name:!0,H=w($)?$===I.color:!0;if(M&&H)return[1,T]}return[0,T]}const[m,g]=ut(x.words,r,[V.COLOR_OR_KIND]);return Cr(m)?[Dx(x.board,m).length,g]:[Zu(x.board,m).length,g]}case"rnd":return[_n(0,1),r];case"abs":{const[p,m]=ut(x.words,r,[V.NUMBER]);return[Math.abs(p),m]}case"intceil":{const[p,m]=ut(x.words,r,[V.NUMBER]);return[Math.ceil(p),m]}case"intfloor":{const[p,m]=ut(x.words,r,[V.NUMBER]);return[Math.floor(p),m]}case"intround":{const[p,m]=ut(x.words,r,[V.NUMBER]);return[Math.round(p),m]}case"clamp":{const[p,m,g,y]=ut(x.words,r,[V.NUMBER,V.NUMBER,V.NUMBER]);return[Ge(p,m,g),y]}case"min":{const[p,m]=Wo(r);return[Math.min(...p),m]}case"max":{const[p,m]=Wo(r);return[Math.max(...p),m]}case"pick":{const[p,m]=Wo(r);return[bn(p),m]}case"pickwith":{const[p,m]=ut(x.words,r,[V.NUMBER_OR_STRING]),[g,y]=Wo(m);return[fI(`${p}`,g),y]}case"random":{const[p,m]=Wo(r,2),[g,y]=p;return[_n(g,y??0),m]}case"randomwith":{const[p,m]=ut(x.words,r,[V.NUMBER_OR_STRING]),[g,y]=Wo(m,2),[b,A]=g;return[py(`${p}`,b,A??0),y]}case"run":{const[p,m]=ut(x.words,r,[V.NAME]);return Xu(p),[(u=x.get)==null?void 0:u.call(x,"arg"),m]}case"runwith":{const[p,m,g]=ut(x.words,r,[V.ANY,V.NAME]);return w(x.element)&&(x.element.arg=p),Xu(m),[(h=x.get)==null?void 0:h.call(x,"arg"),g]}}}return[t,r]}const zp={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function cc(e){return pe(e)&&xk(e[0])}function xk(e){return w(Nr[e])&&yt(e)}function Ak(e){if(yt(e))return zp[Dt(e)]}function Tk(e){if(cc(e))return e;if(xk(e))return[e];const t=Ak(e);if(w(t))return[t]}function T5(e){const t=x.words[e],r=Tk(t);if(cc(r))return[r,e+1];const[n,i]=Pr(e),s=Tk(n);return cc(s)?[s,i]:[void 0,e]}const S5=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Sk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),R5=["NORTH","SOUTH","WEST","EAST"];function O5(e){const t=In(e);if(Et(t.inputcurrent)||(t.inputcurrent=0),pe(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[r]=t.inputqueue,[n=Lr.NONE,i=0]=r??[Lr.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&RI?1:0,t.inputctrl=i&OI?1:0,t.inputshift=i&II?1:0,n){case Lr.MOVE_UP:case Lr.MOVE_DOWN:case Lr.MOVE_LEFT:case Lr.MOVE_RIGHT:t.inputmove=[R5[n-Lr.MOVE_UP]];break;case Lr.OK_BUTTON:t.inputok=1;break;case Lr.CANCEL_BUTTON:t.inputcancel=1;break;case Lr.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=n,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Lr.NONE&&o!==n}),t}function I5(e){const t=zp[e];if(w(t))return t;const r=Dp[e];if(w(r))return r;const n=ka[e];if(w(n))return n;const i=Ih[e];if(w(i))return i}function Rk(){var t,r;if(Ir(x.board,x.element,x.timestamp),!!Jt(x.element,"item")){const n={x:((t=x.element)==null?void 0:t.x)??-1,y:((r=x.element)==null?void 0:r.y)??-1},i=bc(x.board,n,x.elementfocus);w(i)&&(i.x=n.x,i.y=n.y)}}const N5=Ti({get(e,t){var l,u,h,d,f,p,m,g,y,b,A,T,k,I,R,$,M,H,X,O,N,E;const r=I5(t);if(w(r))return[!0,r];if(x.elementisplayer&&S5.has(t)){const L=O5(x.elementid)[t];return[w(L),L]}const n=bc(x.board,{x:((l=x.element)==null?void 0:l.x)??-1,y:((u=x.element)==null?void 0:u.y)??-1},x.elementfocus),i=(n==null?void 0:n.id)??x.elementfocus??$r(),s=(h=x.element)==null?void 0:h.sender,o=Gx(x.board,yt(s)?s:""),a=(o==null?void 0:o.id)??"";switch(t){case"camera":case"graphics":case"facing":if(w((d=x.board)==null?void 0:d[t]))return[!0,(f=x.board)==null?void 0:f[t]];break;case"isdark":return[!0,(p=x.board)!=null&&p.isdark?1:0];case"startx":return[!0,((m=x.board)==null?void 0:m.startx)??0];case"starty":return[!0,((g=x.board)==null?void 0:g.starty)??0];case"over":return[!0,((y=x.board)==null?void 0:y.over)??""];case"under":return[!0,((b=x.board)==null?void 0:b.under)??""];case"exitnorth":return[!0,((A=x.board)==null?void 0:A.exitnorth)??""];case"exitsouth":return[!0,((T=x.board)==null?void 0:T.exitsouth)??""];case"exitwest":return[!0,((k=x.board)==null?void 0:k.exitwest)??""];case"exiteast":return[!0,((I=x.board)==null?void 0:I.exiteast)??""];case"timelimit":return[!0,((R=x.board)==null?void 0:R.timelimit)??0];case"restartonzap":return[!0,(($=x.board)==null?void 0:$.restartonzap)??0];case"maxplayershots":return[!0,((M=x.board)==null?void 0:M.maxplayershots)??0];case"currenttick":return[!0,x.timestamp];case"boardid":return[!0,((H=x.board)==null?void 0:H.id)??""];case"playerid":return[!0,i];case"playerx":return[!0,(n==null?void 0:n.x)??-1];case"playery":return[!0,(n==null?void 0:n.y)??-1];case"thisid":return[!0,((X=x.element)==null?void 0:X.id)??""];case"thisx":return[!0,((O=x.element)==null?void 0:O.x)??-1];case"thisy":return[!0,((N=x.element)==null?void 0:N.y)??-1];case"senderid":return[!0,a];case"senderx":return[!0,(o==null?void 0:o.x)??-1];case"sendery":return[!0,(o==null?void 0:o.y)??-1];default:{if(Sk.has(t))return[!0,((E=x.element)==null?void 0:E[t])??0];break}}const c=In(i)[t];return[w(c),c]},set(e,t,r){var o,a;const n=bc(x.board,{x:((o=x.element)==null?void 0:o.x)??-1,y:((a=x.element)==null?void 0:a.y)??-1},x.elementfocus),i=(n==null?void 0:n.id)??x.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(w(x.board))return x.board.isdark=r?1:0,[!0,x.board.isdark];break;case"startx":if(w(x.board))return x.board.startx=Sa(r,0),[!0,x.board.startx];break;case"starty":if(w(x.board))return x.board.starty=Sa(r,0),[!0,x.board.starty];break;case"over":if(w(x.board))return x.board.over=Ie(r),[!0,x.board.over];break;case"under":if(w(x.board))return[!0,x.board.under=Ie(r)];break;case"exitnorth":if(w(x.board))return[!0,x.board.exitnorth=Ie(r)];break;case"exitsouth":if(w(x.board))return[!0,x.board.exitsouth=Ie(r)];break;case"exitwest":if(w(x.board))return[!0,x.board.exitwest=Ie(r)];break;case"exiteast":if(w(x.board))return[!0,x.board.exiteast=Ie(r)];break;case"timelimit":if(w(x.board))return[!0,x.board.timelimit=Sa(r,0)];break;case"restartonzap":if(w(x.board))return[!0,x.board.restartonzap=r?1:0];break;case"maxplayershots":if(w(x.board))return[!0,x.board.maxplayershots=Sa(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(Sk.has(t))return w(x.element)&&(x.element[t]=r),[!0,r];break}}const s=In(i);return w(s)?(s[t]=r,[!0,r]):[!1,r]},everytick(){var e,t,r,n,i;if(!((e=x.element)!=null&&e.removed)&&(w((t=x.element)==null?void 0:t.stepx)||w((r=x.element)==null?void 0:r.stepy))){const s={x:((n=x.element)==null?void 0:n.x)??0,y:((i=x.element)==null?void 0:i.y)??0};ls(x.book,x.board,x.element,{x:s.x+(x.element.stepx??0),y:s.y+(x.element.stepy??0)})===!1&&Jt(x.element,"breakable")&&Ir(x.board,x.element,x.timestamp)}}}).command("clear",(e,t)=>{for(let r=0;r<t.length;++r)e.set(Ie(t[r]),0);return 0}).command("set",(e,t)=>{const[r,n]=ut(t,0,[V.NAME,V.ANY]);return e.set(r,n??1),0}).command("become",(e,t)=>{var c,l;const[r]=ut(t,0,[V.KIND]);Le(x.board);const n=gr(x.element),[i,s]=r,o=[...Aa(n.color,n.bg),...s??[]],a=[i,o];if(Tu(x.board,x.element),Ir(x.board,x.element,x.timestamp)){const u={x:((c=x.element)==null?void 0:c.x)??0,y:((l=x.element)==null?void 0:l.y)??0};On(x.board,a,u)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[r]=ut(t,0,[V.ANY]);if(Hr(r)){const[n,i]=ut(t,0,[V.DIR,V.NUMBER]),s=fe(x.board,n.destpt);w(s)&&(s.char=i)}else w(x.element)&&Et(r)&&(x.element.char=r);return 0}).command("color",(e,t)=>{const[r]=ut(t,0,[V.ANY]);if(Hr(r)){const[n,i]=ut(t,0,[V.DIR,V.COLOR]),s=fe(x.board,n.destpt);w(s)&&Pa(x.element,i)}else{const[n]=ut(t,0,[V.COLOR]);w(x.element)&&w(n)&&Pa(x.element,n)}return 0}).command("go",(e,t)=>{if(w(x.element)){const[r]=ut(t,0,[V.DIR]);if(ls(x.book,x.board,x.element,r.destpt),e.yield(),x.element.x===r.destpt.x&&x.element.y===r.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!w(x.element))return 0;const[r]=ut(t,0,[V.DIR]),n=x.element.x??0,i=x.element.y??0;return x.element.stepx=r.destpt.x-n,x.element.stepy=r.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[r]=ut(t,0,[V.ANY]);return e.set("arg",r),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Ie(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Ie(t[0])),0)).command("cycle",(e,t)=>{if(w(x.element)){const[r]=ut(t,0,[V.NUMBER]);x.element.cycle=Ge(Math.round(r),1,255)}return 0}).command("die",e=>(Rk(),e.endofprogram(),0)).command("dieonend",()=>(Rk(),0)).command("endgame",()=>(Af(lt,x.elementfocus),0)).command("run",(e,t)=>{const[r]=ut(t,0,[V.NAME]);return Xu(r),0}).command("runwith",(e,t)=>{const[r,n]=ut(t,0,[V.ANY,V.NAME]);return e.set("arg",r),Xu(n),0}),Uu={};function C5(e){var t;return(t=Uu[e])==null?void 0:t.arg}function L5(e){var t;return(t=Uu[e])==null?void 0:t.format}function Ho(e){var t;return(t=Uu[e])==null?void 0:t.content}function Ok(e,t,r,n,i){const s=ge(Vt.MAIN);if(!w(s))return;const o=js(s,vt.LOADER).filter(a=>{const c=Bs(a),l=c.format,u=yt(l)?new RegExp(l).test(t):!1,h=c.event,d=yt(h)?new RegExp(h).test(r):!1;return yt(l)&&yt(h)?u&&d:yt(l)?u:yt(h)?d:!1});for(let a=0;a<o.length;++a){const c=`${We()}_loader`;Uu[c]={arg:e,format:t,content:n,player:i},Gz(c,o[a].code)}}function Ik(e,t){if(!w(e))return;const r=Dt(t),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,n);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,n);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,n);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,n);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,n);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,n);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,n);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,n);return e.cursor+=8,i}}}const M5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[V.NAME]),s=Dt(n);switch(s){case"seek":{const[o]=ut(t,i,[V.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=ut(t,i,[V.NAME]);e.set(o,Ik(r,s));break}case"text":{const[o,a]=ut(t,i,[V.NAME,V.NAME]),c=Ik(r,o);if(Et(c)&&yt(a)){const l=new Uint8Array(r.bytes.buffer,r.cursor,c),h=new TextDecoder("utf-8").decode(l);e.set(a,h),r.cursor+=c}break}case"palette":{const[o]=ut(t,i,[V.NAME]),[a]=vp(x.book,vt.PALETTE,o),c=Ce(a);if(w(c)){const l=vI*fl,u=$_(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}case"charset":{const[o]=ut(t,i,[V.NAME]),[a]=vp(x.book,vt.CHARSET,o),c=Ce(a);if(w(c)){const l=hl*wI*Mh,u=B_(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}}return 0},Go=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Pu=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(!Pu(e[r],t[r]))return!1;return!0}if(Go(e)&&Go(t)){const r=Object.entries(e),n=new Set(Object.keys(t));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!Pu(s,t[i]))return!1;n.delete(i)}return n.size===0}return!1},Fu=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(Go(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},U5=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Nk=e=>e>="0"&&e<="9"||e==="-",P5=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var nt;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(nt||(nt={}));const Ck={"(":nt.TOK_LPAREN,")":nt.TOK_RPAREN,"*":nt.TOK_STAR,",":nt.TOK_COMMA,".":nt.TOK_DOT,":":nt.TOK_COLON,"@":nt.TOK_CURRENT,$:nt.TOK_ROOT,"]":nt.TOK_RBRACKET,"{":nt.TOK_LBRACE,"}":nt.TOK_RBRACE},F5={"!":!0,"<":!0,"=":!0,">":!0},$5={"	":!0,"\n":!0,"\r":!0," ":!0};class B5{constructor(){this._current=0}tokenize(t){const r=[];this._current=0;let n,i,s;for(;this._current<t.length;)if(U5(t[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(t),r.push({start:n,type:nt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Ck[t[this._current]]!==void 0)r.push({start:this._current,type:Ck[t[this._current]],value:t[this._current]}),this._current+=1;else if(Nk(t[this._current]))s=this.consumeNumber(t),r.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),r.push(s);else if(t[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(t),r.push({start:n,type:nt.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(t),r.push({start:n,type:nt.TOK_LITERAL,value:i});else if(t[this._current]==="`"){n=this._current;const o=this.consumeLiteral(t);r.push({start:n,type:nt.TOK_LITERAL,value:o})}else if(F5[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&r.push(s);else if($5[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")n=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,r.push({start:n,type:nt.TOK_AND,value:"&&"})):r.push({start:n,type:nt.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")n=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,r.push({start:n,type:nt.TOK_OR,value:"||"})):r.push({start:n,type:nt.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(t){const r=this._current;for(this._current+=1;this._current<t.length&&P5(t[this._current]);)this._current+=1;return t.slice(r,this._current)}consumeQuotedIdentifier(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=='"'&&this._current<n;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(r,this._current))}consumeRawStringLiteral(t){const r=this._current;this._current+=1;const n=t.length;for(;t[this._current]!=="'"&&this._current<n;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(t){const r=this._current;this._current+=1;const n=t.length;for(;Nk(t[this._current])&&this._current<n;)this._current+=1;const i=parseInt(t.slice(r,this._current),10);return{start:r,value:i,type:nt.TOK_NUMBER}}consumeLBracket(t){const r=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:r,type:nt.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:r,type:nt.TOK_FLATTEN,value:"[]"}):{start:r,type:nt.TOK_LBRACKET,value:"["}}consumeOperator(t){const r=this._current,n=t[r];if(this._current+=1,n==="!")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_NE,value:"!="}):{start:r,type:nt.TOK_NOT,value:"!"};if(n==="<")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_LTE,value:"<="}):{start:r,type:nt.TOK_LT,value:"<"};if(n===">")return t[this._current]==="="?(this._current+=1,{start:r,type:nt.TOK_GTE,value:">="}):{start:r,type:nt.TOK_GT,value:">"};if(n==="="&&t[this._current]==="=")return this._current+=1,{start:r,type:nt.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const r=this._current,n=t.length;for(;t[this._current]!=="`"&&this._current<n;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const r='[{"',n=["true","false","null"],i="-0123456789";if(t==="")return!1;if(r.includes(t[0])||n.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const D5=new B5,Rr={[nt.TOK_EOF]:0,[nt.TOK_UNQUOTEDIDENTIFIER]:0,[nt.TOK_QUOTEDIDENTIFIER]:0,[nt.TOK_RBRACKET]:0,[nt.TOK_RPAREN]:0,[nt.TOK_COMMA]:0,[nt.TOK_RBRACE]:0,[nt.TOK_NUMBER]:0,[nt.TOK_CURRENT]:0,[nt.TOK_EXPREF]:0,[nt.TOK_ROOT]:0,[nt.TOK_PIPE]:1,[nt.TOK_OR]:2,[nt.TOK_AND]:3,[nt.TOK_EQ]:5,[nt.TOK_GT]:5,[nt.TOK_LT]:5,[nt.TOK_GTE]:5,[nt.TOK_LTE]:5,[nt.TOK_NE]:5,[nt.TOK_FLATTEN]:9,[nt.TOK_STAR]:20,[nt.TOK_FILTER]:21,[nt.TOK_DOT]:40,[nt.TOK_NOT]:45,[nt.TOK_LBRACE]:50,[nt.TOK_LBRACKET]:55,[nt.TOK_LPAREN]:60};class j5{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==nt.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(t){this.tokens=[...D5.tokenize(t),{type:nt.TOK_EOF,value:"",start:t.length}]}expression(t){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;t<Rr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let r,n,i;switch(t.type){case nt.TOK_LITERAL:return{type:"Literal",value:t.value};case nt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case nt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===nt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case nt.TOK_NOT:return n=this.expression(Rr.Not),{type:"NotExpression",children:[n]};case nt.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===nt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Rr.Star),{type:"ValueProjection",children:[r,n]};case nt.TOK_FILTER:return this.led(t.type,{type:"Identity"});case nt.TOK_LBRACE:return this.parseMultiselectHash();case nt.TOK_FLATTEN:return r={type:nt.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(Rr.Flatten),{type:"Projection",children:[r,n]};case nt.TOK_LBRACKET:return this.lookahead(0)===nt.TOK_NUMBER||this.lookahead(0)===nt.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===nt.TOK_STAR&&this.lookahead(1)===nt.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(Rr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case nt.TOK_CURRENT:return{type:nt.TOK_CURRENT};case nt.TOK_ROOT:return{type:nt.TOK_ROOT};case nt.TOK_EXPREF:return i=this.expression(Rr.Expref),{type:"ExpressionReference",children:[i]};case nt.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==nt.TOK_RPAREN;)this.lookahead(0)===nt.TOK_CURRENT?(i={type:nt.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(nt.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,r){let n;switch(t){case nt.TOK_DOT:const i=Rr.Dot;return this.lookahead(0)!==nt.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case nt.TOK_PIPE:return n=this.expression(Rr.Pipe),{type:nt.TOK_PIPE,children:[r,n]};case nt.TOK_OR:return n=this.expression(Rr.Or),{type:"OrExpression",children:[r,n]};case nt.TOK_AND:return n=this.expression(Rr.And),{type:"AndExpression",children:[r,n]};case nt.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==nt.TOK_RPAREN;)this.lookahead(0)===nt.TOK_CURRENT?(a={type:nt.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===nt.TOK_COMMA&&this.match(nt.TOK_COMMA),o.push(a);return this.match(nt.TOK_RPAREN),{name:s,type:"Function",children:o};case nt.TOK_FILTER:const l=this.expression(0);return this.match(nt.TOK_RBRACKET),n=this.lookahead(0)===nt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Rr.Filter),{type:"FilterProjection",children:[r,n,l]};case nt.TOK_FLATTEN:const u={type:nt.TOK_FLATTEN,children:[r]},h=this.parseProjectionRHS(Rr.Flatten);return{type:"Projection",children:[u,h]};case nt.TOK_EQ:case nt.TOK_NE:case nt.TOK_GT:case nt.TOK_GTE:case nt.TOK_LT:case nt.TOK_LTE:return this.parseComparator(r,t);case nt.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===nt.TOK_NUMBER||d.type===nt.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(nt.TOK_STAR),this.match(nt.TOK_RBRACKET),n=this.parseProjectionRHS(Rr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${t}, got: ${r.type}`)}}errorToken(t,r=""){const n=new Error(r||`Invalid token (${t.type}): "${t.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===nt.TOK_COLON||this.lookahead(1)===nt.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(nt.TOK_RBRACKET),t}projectIfSlice(t,r){const n={type:"IndexExpression",children:[t,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(Rr.Star)],type:"Projection"}:n}parseSliceExpression(){const t=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==nt.TOK_RBRACKET&&r<3;){if(n===nt.TOK_COLON)r+=1,this.advance();else if(n===nt.TOK_NUMBER)t[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(nt.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,r){const n=this.expression(Rr[r]);return{type:"Comparator",name:r,children:[t,n]}}parseDotRHS(t){const r=this.lookahead(0);if([nt.TOK_UNQUOTEDIDENTIFIER,nt.TOK_QUOTEDIDENTIFIER,nt.TOK_STAR].includes(r))return this.expression(t);if(r===nt.TOK_LBRACKET)return this.match(nt.TOK_LBRACKET),this.parseMultiselectList();if(r===nt.TOK_LBRACE)return this.match(nt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(Rr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===nt.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===nt.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===nt.TOK_DOT)return this.match(nt.TOK_DOT),this.parseDotRHS(t);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==nt.TOK_RBRACKET;){const r=this.expression(0);if(t.push(r),this.lookahead(0)===nt.TOK_COMMA&&(this.match(nt.TOK_COMMA),this.lookahead(0)===nt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(nt.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],r=[nt.TOK_UNQUOTEDIDENTIFIER,nt.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(nt.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===nt.TOK_COMMA)this.match(nt.TOK_COMMA);else if(this.lookahead(0)===nt.TOK_RBRACE){this.match(nt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const z5=new j5;var mt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(mt||(mt={}));class W5{constructor(t){this.TYPE_NAME_TABLE={[mt.TYPE_NUMBER]:"number",[mt.TYPE_ANY]:"any",[mt.TYPE_STRING]:"string",[mt.TYPE_ARRAY]:"array",[mt.TYPE_OBJECT]:"object",[mt.TYPE_BOOLEAN]:"boolean",[mt.TYPE_EXPREF]:"expression",[mt.TYPE_NULL]:"null",[mt.TYPE_ARRAY_NUMBER]:"Array<number>",[mt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Go(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===mt.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[mt.TYPE_NUMBER,mt.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==mt.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===mt.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![mt.TYPE_NUMBER,mt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===mt.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===mt.TYPE_NUMBER?r:n===mt.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===mt.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case mt.TYPE_NUMBER:return"number";case mt.TYPE_STRING:return"string";case mt.TYPE_ARRAY:return"array";case mt.TYPE_OBJECT:return"object";case mt.TYPE_BOOLEAN:return"boolean";case mt.TYPE_EXPREF:return"expref";case mt.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[mt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[mt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]},{types:[mt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[mt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[mt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY,mt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[mt.TYPE_EXPREF]},{types:[mt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[mt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[mt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[mt.TYPE_STRING,mt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[mt.TYPE_ARRAY_STRING,mt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[mt.TYPE_ARRAY]},{types:[mt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[mt.TYPE_STRING]},{types:[mt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[mt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[mt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[mt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[mt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[mt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[mt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,r,n){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:r.bind(this),_signature:n}}callFunction(t,r){const n=this.functionTable[t];if(n===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,r,n._signature),n._func.call(this,r)}validateInputSignatures(t,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${n+1} must occur last`)}validateArgs(t,r,n){var i,s;let o;this.validateInputSignatures(t,n);const a=n.filter(m=>{var g;return(g=!m.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=r.length<a,u=r.length>n.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=n.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${r.length}`);let d,f,p;for(let m=0;m<n.length;m+=1){p=!1,d=n[m].types,f=this.getTypeName(r[m]);let g;for(g=0;g<d.length;g+=1)if(f!==void 0&&this.typeMatches(f,d[g],r[m])){p=!0;break}if(!p&&f!==void 0){const y=d.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${m+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(t,r,n){if(r===mt.TYPE_ANY)return!0;if(r===mt.TYPE_ARRAY_STRING||r===mt.TYPE_ARRAY_NUMBER||r===mt.TYPE_ARRAY){if(r===mt.TYPE_ARRAY)return t===mt.TYPE_ARRAY;if(t===mt.TYPE_ARRAY){let i;r===mt.TYPE_ARRAY_NUMBER?i=mt.TYPE_NUMBER:r===mt.TYPE_ARRAY_STRING&&(i=mt.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return t===r;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return mt.TYPE_STRING;case"[object Number]":return mt.TYPE_NUMBER;case"[object Array]":return mt.TYPE_ARRAY;case"[object Boolean]":return mt.TYPE_BOOLEAN;case"[object Null]":return mt.TYPE_NULL;case"[object Object]":return t.jmespathType===nt.TOK_EXPREF?mt.TYPE_EXPREF:mt.TYPE_OBJECT;default:return}}createKeyFunction(t,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(t,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class H5{constructor(){this._rootValue=null,this.runtime=new W5(this)}search(t,r){return this._rootValue=r,this.visit(t,r)}visit(t,r){let n,i,s,o,a,c,l,u,h,d,f;switch(t.type){case"Field":return r===null?null:Go(r)?(c=r[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],r),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],r),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(r))return null;let p=t.value;return p<0&&(p=r.length+p),s=r[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const m=[...t.children],g=this.computeSliceParams(r.length,m),[y,b,A]=g;if(s=[],A>0)for(d=y;d<b;d+=A)s.push(r[d]);else for(d=y;d>b;d+=A)s.push(r[d]);return s;case"Projection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(t.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(t.children[0],r),!Go(f))return null;h=[];const T=Object.values(f);for(d=0;d<T.length;d+=1)i=this.visit(t.children[1],T[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(t.children[0],r),!Array.isArray(f))return null;const k=[],I=[];for(d=0;d<f.length;d+=1)n=this.visit(t.children[2],f[d]),Fu(n)||k.push(f[d]);for(let O=0;O<k.length;O+=1)i=this.visit(t.children[1],k[O]),i!==null&&I.push(i);return I;case"Comparator":switch(o=this.visit(t.children[0],r),a=this.visit(t.children[1],r),t.name){case nt.TOK_EQ:s=Pu(o,a);break;case nt.TOK_NE:s=!Pu(o,a);break;case nt.TOK_GT:s=o>a;break;case nt.TOK_GTE:s=o>=a;break;case nt.TOK_LT:s=o<a;break;case nt.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case nt.TOK_FLATTEN:const R=this.visit(t.children[0],r);if(!Array.isArray(R))return null;let $=[];for(d=0;d<R.length;d+=1)i=R[d],Array.isArray(i)?$=[...$,...i]:$.push(i);return $;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(h=[],d=0;d<t.children.length;d+=1)h.push(this.visit(t.children[d],r));return h;case"MultiSelectHash":if(r===null)return null;h={};let M;for(d=0;d<t.children.length;d+=1)M=t.children[d],h[M.name]=this.visit(M.value,r);return h;case"OrExpression":return n=this.visit(t.children[0],r),Fu(n)&&(n=this.visit(t.children[1],r)),n;case"AndExpression":return o=this.visit(t.children[0],r),Fu(o)?o:this.visit(t.children[1],r);case"NotExpression":return o=this.visit(t.children[0],r),Fu(o);case"Literal":return t.value;case nt.TOK_PIPE:return l=this.visit(t.children[0],r),this.visit(t.children[1],l);case nt.TOK_CURRENT:return r;case nt.TOK_ROOT:return this._rootValue;case"Function":const H=[];for(let O=0;O<t.children.length;O+=1)H.push(this.visit(t.children[O],r));return this.runtime.callFunction(t.name,H);case"ExpressionReference":const X=t.children[0];return X.jmespathType=nt.TOK_EXPREF,X;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?t-1:0:this.capSliceRange(t,n,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[n,i,s]}capSliceRange(t,r,n){let i=r;return i<0?(i+=t,i<0&&(i=n<0?-1:0)):i>=t&&(i=n<0?t-1:t),i}}const G5=new H5;mt.TYPE_ANY,mt.TYPE_ARRAY,mt.TYPE_ARRAY_NUMBER,mt.TYPE_ARRAY_STRING,mt.TYPE_BOOLEAN,mt.TYPE_EXPREF,mt.TYPE_NULL,mt.TYPE_NUMBER,mt.TYPE_OBJECT,mt.TYPE_STRING;function K5(e,t){const r=z5.parse(t);return G5.search(r,e)}const Y5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[V.NAME,V.NAME]),s=K5(r.json,n);return e.set(i,s),0},q5=(e,t)=>{const r=Ho(e.id());if(!w(r))return 0;const[n,i]=ut(t,0,[V.NAME]);switch(Dt(n)){case"seek":{const[o]=ut(t,i,[V.NUMBER]);r.cursor=Ge(o,0,r.lines.length-1);break}case"line":r.cursor=Ge(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[h,d]=ut(t,u,[V.NAME]);e.set(h,c[l]??0),++l,u=d}break}}return 0};function Lk(e){const t=ge(Vt.MAIN),r=Do(t);w(e.targetdir)?Jo(e.targetdir.destpt,e.label,void 0,r):w(e.targetname)&&Jo(e.targetname,e.label,void 0,r)}const V5=Ti({get(e,t){const r=L5(e.id());if(t==="format")return[!0,r];switch(r){case"text":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"lines":return[!0,n.lines.length]}break}case"json":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename]}break}case"binary":{const n=Ho(e.id());switch(t){case"filename":return[!0,n.filename];case"cursor":return[!0,n.cursor];case"bytes":return[!0,n.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const r=Fi(t);return Lk(r),0}).command("send",(e,t)=>{const r=Fi(t,!0);return Lk(r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Ie).join(" ");return Re(lt,x.elementfocus,"$175",r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=Fi(n);return w(s.targetname)&&Re(lt,x.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",q5).command("readjson",Y5).command("readbin",M5).command("withboard",(e,t)=>{const[r]=ut(t,0,[V.STRING]),n=br(r);return w(n)&&(x.board=n,x.element={x:-1,y:-1}),0});function Mk(e,t,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=ut(i,a,[V.ANY]);pe(c)&&!Hr(c)&&!cc(c)&&!Mu(c)&&!Cr(c)?o.push(...c):o.push(c),a=l}switch(Dt(n)){case"get":case"post:json":pT(lt,x.elementfocus,e,t,r,n,o);break}return 0}const X5=Ti().command("fetch",(e,t)=>{const[r,n,i="get",s]=ut(t,0,[V.NAME,V.NAME,V.MAYBE_STRING]);return Mk(void 0,r,n,i,t,s),0}).command("fetchwith",(e,t)=>{const[r,n,i,s="get",o]=ut(t,0,[V.ANY,V.NAME,V.NAME,V.MAYBE_STRING]);return Mk(r,n,i,s,t,o),0}).command("chat",(e,t)=>{const[r]=ut(t,0,[V.MAYBE_NAME]);return r?hT(lt,x.elementfocus,r):dT(lt,x.elementfocus),0}).command("broadcast",(e,t)=>{const[r]=ut(t,0,[V.MAYBE_NAME]);return r?uT(lt,x.elementfocus,r):fT(lt,x.elementfocus),0});function Uk(e,t){var r;if(w(t.targetname)){const n=Object.keys(((r=x.board)==null?void 0:r.objects)??{});switch(t.targetname){case"all":for(let i=0;i<n.length;++i){const s=n[i];e.send(x.elementfocus,s,t.label)}break;case"others":for(let i=0;i<n.length;++i){const s=n[i];s!==e.id()&&e.send(x.elementfocus,s,t.label)}break;case"self":x.elementid!==e.id()?e.send(x.elementfocus,x.elementid,t.label):e.message({session:lt.session(),player:x.elementfocus,id:We(),sender:x.elementid,target:t.label});break;default:{const i=jx(x.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];w(o.id)&&e.send(x.elementfocus,o.id,t.label)}break}}}else if(w(t.targetdir)){const n=fe(x.board,t.targetdir.destpt);w(n==null?void 0:n.id)&&e.send(x.elementfocus,n.id,t.label)}}const J5=Ti({set(e,t,r){return u7(e,t,r),[!1,void 0]},everytick(){var r,n,i;const e=lr(x.elementid),[t]=e;if(e.length===1&&yt(t)){if(w(x.element))if(t.trim().length===0){const s=Pe(x.elementid);s.sidebar=[]}else x.element.tickertext=t,x.element.tickertime=x.timestamp}else if(e.length>1)if(x.elementisplayer){const s=Pe(x.elementid);s.sidebar=Jx(e)}else{const s=Pe(x.elementfocus);s.scrollname=((r=x.element)==null?void 0:r.name)??((i=(n=x.element)==null?void 0:n.kinddata)==null?void 0:i.name)??"",s.scroll=Jx(e)}}}).command("shortsend",(e,t)=>{const r=Fi(t);return Uk(e,r),0}).command("send",(e,t)=>{const r=Fi(t,!0);return Uk(e,r),0}).command("stat",()=>0).command("text",(e,t)=>{const r=t.map(Ie).join("");return Nt(x.elementid,r),0}).command("hyperlink",(e,t)=>{const[r,...n]=t,i=Ie(r),s=Fi(n);return w(s.targetname)&&$t(x.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function Z5(e,t,r,n,i){if(!w(x.book))return;const s=x.book,o=ar(s,vt.BOARD,e),a=Ce(o);if(!w(a))return;const c=Qu(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Le(a),Le(c);const h=-Math.tan(t*.5),d=Math.sin(t),f=Math.round(12.5*h),p=Math.round(12.5*d),m=new Array(te).fill(0);sy(f,0,-f,te-1).forEach(T=>{T.x<0?m[T.y]=Math.min(m[T.y],T.x):m[T.y]=Math.max(m[T.y],T.x)});const y=new Array(Ct).fill(0);sy(0,p,Ct-1,-p).forEach(T=>{T.y<0?y[T.x]=Math.min(y[T.x],T.y):y[T.x]=Math.max(y[T.x],T.y)});const A=[m,y,m];for(let T=0;T<A.length;++T){const k=A[T];if(T!==1){for(let I=0;I<te;++I){const R=k[I],$=I*Ct;for(let M=0;M<Ct;M++){const H=(M+R+Ct)%Ct;u&&(c.terrain[H+$]=a.terrain[M+$])}}if(l){const I=Object.keys(a.objects);for(let R=0;R<I.length;++R){const $=I[R],{x:M,y:H}=a.objects[$];if(w(M)&&w(H)){const X=k[H];a.objects[$].x=(M+X+Ct)%Ct,a.objects[$].lx=a.objects[$].x}}}}if(T===1){for(let I=0;I<Ct;++I){const R=k[I];for(let $=0;$<te;++$){const M=($+R+te)%te;u&&(c.terrain[I+M*Ct]=a.terrain[I+$*Ct])}}if(l){const I=Object.keys(a.objects);for(let R=0;R<I.length;++R){const $=I[R],{x:M,y:H}=a.objects[$];if(w(M)&&w(H)){const X=k[M];a.objects[$].y=(H+X+te)%te,a.objects[$].ly=a.objects[$].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Le(c),Le(a)}}function Q5(e,t){let r=0,n=0,i=0;for(;i<e.length;i++)r+=e[i];for(i=0,t*=r;t&&i<e.length;){if(n+=e[i],t<=n)return i;i++}return 0}var tj=Q5;const ej=tj,le=function(){};le.prototype.FMX=0,le.prototype.FMY=0,le.prototype.FMXxFMY=0,le.prototype.T=0,le.prototype.N=0,le.prototype.initiliazedField=!1,le.prototype.generationComplete=!1,le.prototype.wave=null,le.prototype.compatible=null,le.prototype.weightLogWeights=null,le.prototype.sumOfWeights=0,le.prototype.sumOfWeightLogWeights=0,le.prototype.startingEntropy=0,le.prototype.sumsOfOnes=null,le.prototype.sumsOfWeights=null,le.prototype.sumsOfWeightLogWeights=null,le.prototype.entropies=null,le.prototype.propagator=null,le.prototype.observed=null,le.prototype.distribution=null,le.prototype.stack=null,le.prototype.stackSize=0,le.prototype.DX=[-1,0,1,0],le.prototype.DY=[0,1,0,-1],le.prototype.opposite=[2,3,0,1],le.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},le.prototype.observe=function(e){let t=1e3,r=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,r=s)}}if(r===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[r][s]?this.weights[s]:0;const n=ej(this.distribution,e()),i=this.wave[r];for(let s=0;s<this.T;s++)i[s]!==(s===n)&&this.ban(r,s);return null},le.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],r=t%this.FMX,n=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=r+s,c=n+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],h=this.compatible[l];for(let d=0;d<u.length;d++){const f=u[d],p=h[f];p[i]--,p[i]==0&&this.ban(l,f)}}}},le.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},le.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let r=0;r<e||e===0;r++){const n=this.singleIteration(t);if(n!==null)return!!n}return!0},le.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},le.prototype.isGenerationComplete=function(){return this.generationComplete},le.prototype.ban=function(e,t){const r=this.compatible[e][t];for(let i=0;i<4;i++)r[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const n=this.sumsOfWeights[e];this.entropies[e]=Math.log(n)-this.sumsOfWeightLogWeights[e]/n},le.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let r=0;r<4;r++)this.compatible[e][t][r]=this.propagator[this.opposite[r]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Pk=le;const Fk=Pk,$i=function(t,r,n,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const h=r,d=new Array(h);for(let M=0;M<h;M++)d[M]=new Array(n);this.colors=[];const f={};for(let M=0;M<n;M++)for(let H=0;H<r;H++){const X=(M*r+H)*4,O=[t[X],t[X+1],t[X+2],t[X+3]],N=O.join("-");f.hasOwnProperty(N)||(f[N]=this.colors.length,this.colors.push(O)),d[H][M]=f[N]}const p=this.colors.length,m=Math.pow(p,i*i),g=function(H){let X=new Array(i*i);for(let O=0;O<i;O++)for(let N=0;N<i;N++)X[N+O*i]=H(N,O);return X},y=function(H,X){return g(function(O,N){return d[(H+O)%r][(X+N)%n]})},b=function(H){return g(function(X,O){return H[i-1-O+X*i]})},A=function(H){return g(function(X,O){return H[i-1-X+O*i]})},T=function(H){let X=0,O=1;for(let N=0;N<H.length;N++)X+=H[H.length-1-N]*O,O*=p;return X},k=function(H){let X=H,O=m;const N=new Array(i*i);for(let E=0;E<N.length;E++){O/=p;let L=0;for(;X>=O;)X-=O,L++;N[E]=L}return N},I={},R=[];for(let M=0;M<(a?n:n-i+1);M++)for(let H=0;H<(a?r:r-i+1);H++){const X=new Array(8);X[0]=y(H,M),X[1]=A(X[0]),X[2]=b(X[0]),X[3]=A(X[2]),X[4]=b(X[2]),X[5]=A(X[4]),X[6]=b(X[4]),X[7]=A(X[6]);for(let O=0;O<l;O++){const N=T(X[O]);I[N]?I[N]++:(R.push(N),I[N]=1)}}this.T=R.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let M=0;M<this.T;M++){const H=parseInt(R[M],10);this.patterns[M]=k(H),this.weights[M]=I[H]}const $=function(H,X,O,N){const E=O<0?0:O,L=O<0?O+i:i,j=N<0?0:N,U=N<0?N+i:i;for(let q=j;q<U;q++)for(let Q=E;Q<L;Q++)if(H[Q+i*q]!=X[Q-O+i*(q-N)])return!1;return!0};this.propagator=new Array(4);for(let M=0;M<4;M++){this.propagator[M]=new Array(this.T);for(let H=0;H<this.T;H++){const X=[];for(let O=0;O<this.T;O++)$(this.patterns[H],this.patterns[O],this.DX[M],this.DY[M])&&X.push(O);this.propagator[M][H]=X}}};$i.prototype=Object.create(Fk.prototype),$i.prototype.constructor=$i,$i.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},$i.prototype.clear=function(){if(Fk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},$i.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},$i.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const r=t<this.FMY-this.N+1?0:this.N-1;for(let n=0;n<this.FMX;n++){const i=n<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+n)*4,o=this.colors[this.patterns[this.observed[n-i+(t-r)*this.FMX]][i+r*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},$i.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const r=t%this.FMX,n=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let h=0;h<this.N;h++){let d=r-h;d<0&&(d+=this.FMX);let f=n-u;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const p=d+f*this.FMX;for(let m=0;m<this.T;m++)if(this.wave[p][m]){i++;const g=this.colors[this.patterns[m][h+u*this.N]];s+=g[0],o+=g[1],a+=g[2],c+=g[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var rj=$i;const nj=Pk,ns=function(t,r,n,i,s){const o=t.tilesize||16;this.FMX=n,this.FMY=i,this.FMXxFMY=n*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;r&&t.subsets&&t.subsets[r]&&(c=t.subsets[r]);const l=function(T){const k=new Array(o*o);for(let I=0;I<o;I++)for(let R=0;R<o;R++)k[R+I*o]=T(R,I);return k},u=function(T){return l(function(k,I){return T[o-1-I+k*o]})},h=function(T){return l(function(k,I){return T[o-1-k+I*o]})};this.tiles=[];const d=[],f=[],p={};let m,g,y;for(let A=0;A<t.tiles.length;A++){const T=t.tiles[A];if(c!==null&&c.indexOf(T.name)===-1)continue;switch(T.symmetry){case"L":y=4,m=function(I){return(I+1)%4},g=function(I){return I%2===0?I+1:I-1};break;case"T":y=4,m=function(I){return(I+1)%4},g=function(I){return I%2===0?I:4-I};break;case"I":y=2,m=function(I){return 1-I},g=function(I){return I};break;case"\\":y=2,m=function(I){return 1-I},g=function(I){return 1-I};break;case"F":y=8,m=function(I){return I<4?(I+1)%4:4+(I-1)%4},g=function(I){return I<4?I+4:I-4};break;default:y=1,m=function(I){return I},g=function(I){return I};break}this.T=f.length,p[T.name]=this.T;for(let I=0;I<y;I++)f.push([this.T+I,this.T+m(I),this.T+m(m(I)),this.T+m(m(m(I))),this.T+g(I),this.T+g(m(I)),this.T+g(m(m(I))),this.T+g(m(m(m(I))))]);let k;if(a)for(let I=0;I<y;I++)k=T.bitmap[I],this.tiles.push(l(function(R,$){return[k[(o*$+R)*4],k[(o*$+R)*4+1],k[(o*$+R)*4+2],k[(o*$+R)*4+3]]}));else{k=T.bitmap,this.tiles.push(l(function(I,R){return[k[(o*R+I)*4],k[(o*R+I)*4+1],k[(o*R+I)*4+2],k[(o*R+I)*4+3]]}));for(let I=1;I<y;I++)this.tiles.push(I<4?u(this.tiles[this.T+I-1]):h(this.tiles[this.T+I-4]))}for(let I=0;I<y;I++)d.push(T.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const b=new Array(4);for(let A=0;A<4;A++){this.propagator[A]=new Array(this.T),b[A]=new Array(this.T);for(let T=0;T<this.T;T++){b[A][T]=new Array(this.T);for(let k=0;k<this.T;k++)b[A][T][k]=!1}}for(let A=0;A<t.neighbors.length;A++){const T=t.neighbors[A],k=T.left.split(" ").filter(function(X){return X.length}),I=T.right.split(" ").filter(function(X){return X.length});if(c!==null&&(c.indexOf(k[0])===-1||c.indexOf(I[0])===-1))continue;const R=f[p[k[0]]][k.length==1?0:parseInt(k[1],10)],$=f[R][1],M=f[p[I[0]]][I.length==1?0:parseInt(I[1],10)],H=f[M][1];b[0][M][R]=!0,b[0][f[M][6]][f[R][6]]=!0,b[0][f[R][4]][f[M][4]]=!0,b[0][f[R][2]][f[M][2]]=!0,b[1][H][$]=!0,b[1][f[$][6]][f[H][6]]=!0,b[1][f[H][4]][f[$][4]]=!0,b[1][f[$][2]][f[H][2]]=!0}for(let A=0;A<this.T;A++)for(let T=0;T<this.T;T++)b[2][A][T]=b[0][T][A],b[3][A][T]=b[1][T][A];for(let A=0;A<4;A++)for(let T=0;T<this.T;T++){const k=[],I=b[A][T];for(let R=0;R<this.T;R++)I[R]&&k.push(R);this.propagator[A][T]=k}};ns.prototype=Object.create(nj.prototype),ns.prototype.constructor=ns,ns.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},ns.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},ns.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let r=0;r<this.FMY;r++){const n=this.tiles[this.observed[t+r*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(r*this.tilesize+i)*this.FMX*this.tilesize)*4,a=n[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},ns.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let r=0;r<this.FMX;r++)for(let n=0;n<this.FMY;n++){const i=this.wave[r+n*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(r*this.tilesize+l+(n*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let h=0,d=0,f=0,p=0;for(let m=0;m<this.T;m++)if(i[m]){const g=this.tiles[m][l+c*this.tilesize],y=this.weights[m]*a;h+=g[0]*y,d+=g[1]*y,f+=g[2]*y,p+=g[3]*y}e[u]=h,e[u+1]=d,e[u+2]=f,e[u+3]=p}}}};var ij=ns,sj={OverlappingModel:rj,SimpleTiledModel:ij},oj=ps(sj);const $k=5;function Bk(e,t,r,n,i,s,o){if(!w(x.book))return!1;const a=x.book,c=ar(a,vt.BOARD,e),l=ar(a,vt.BOARD,t),u=Ce(c),h=Ce(l);if(!w(u)||!w(h))return!1;Le(u),Le(h);let d=0;const f=new Map,p=new Map;let m=0;const g=32,y=new Uint8Array(Lh*4);for(let R=0;R<te;++R)for(let $=0;$<Ct;++$){const M=fe(h,{x:$,y:R}),H=(M==null?void 0:M.char)??0,X=(M==null?void 0:M.color)??g,O=(M==null?void 0:M.bg)??g;y[m++]=H,y[m++]=X,y[m++]=O;const N=Rn(M),E=Dt((N==null?void 0:N.name)??"empty"),L=f.get(E);Et(L)?y[m++]=L:(f.set(E,d),p.set(d,E),y[m++]=d++)}const b=s.x-i.x+1,A=s.y-i.y+1,T=new oj.OverlappingModel(y,Ct,te,r,b,A,!1,!1,n,0);let k=0;for(;k<$k&&!T.generate();++k);if(k===$k)return!1;m=0;const I=T.graphics();for(let R=i.y;R<=s.y;++R)for(let $=i.x;$<=s.x;++$){const M={x:$,y:R},H=I[m++],X=I[m++],O=I[m++];switch(d=I[m++],o){case"all":{const j=fe(u,{x:$,y:R});Ye(j)&&Ir(u,j,a.timestamp),Ue(u,{x:$,y:R});break}case"object":{const j=fe(u,{x:$,y:R});Ye(j)&&Ir(u,j,a.timestamp);break}case"terrain":Ue(u,{x:$,y:R});break}let N=p.get(d)??"";const E=Rn({kind:N});switch(o){case"all":break;case"object":Ye(E)||(N="");break;case"terrain":Ye(E)&&(N="");break;default:if(Jt(E,"group")!==o&&(N=""),N){const j=fe(u,{x:$,y:R});Ye(j)&&Ir(u,j,a.timestamp),Ue(u,{x:$,y:R})}break}const L=N?On(u,[N],M):void 0;if(!(!w(L)||!w(E))&&($o(L,E),H>0&&(L.char=H),X<g&&(L.color=X),O<g&&(L.bg=O),Ye(L))){const j=bn(wc(h,N));w(j)&&(Ue(u,{...us(h,j.x??0,j.y??0),x:$,y:R}),$o(L,j))}}return!0}function Dk(e){return`zss_snapshot_${e}`}const jk={x:0,y:0},zk={x:Ct-1,y:te-1},Wk="all";function aj(e){const t=ar(x.book,vt.BOARD,e),r=Ce(t);if(!w(r))return;const n=Dk(r.id);XE(x.book,n);const[i]=cs(Vt.MAIN,n,vt.BOARD),s=Ce(i);if(w(s))return Su(e,s.id,jk,zk,Wk),s}function cj(e){const t=ar(x.book,vt.BOARD,e),r=Ce(t);if(!w(r))return;const n=Dk(r.id),i=ar(x.book,vt.BOARD,n),s=Ce(i);if(w(s))return Su(s.id,e,jk,zk,Wk),s}function lj(e,t,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return uj(e,t,i,s)}if(!w(x.book))return;const o=x.book,a=ar(o,vt.BOARD,e),c=Ce(a);if(!w(c))return;const l=Qu();Le(c);for(let u=r.y;u<=n.y;++u)for(let h=r.x;h<=n.x;++h){let d=!1,f=!1;switch(s){case"all":d=!0,f=!0;break;case"object":d=!0;break;case"terrain":f=!0;break}const p=(h+t.x+Ct)%Ct,m=(u+t.y+te)%te;if(d){const g=fe(c,{x:h,y:u});Ye(g)&&w(g==null?void 0:g.x)&&w(g==null?void 0:g.y)&&(g.x=p,g.lx=p,g.y=m,g.ly=m)}f&&(l.terrain[p+m*Ct]=c.terrain[h+u*Ct])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),ac(c)}function uj(e,t,r,n){if(!w(x.book))return;const i=x.book,s=ar(i,vt.BOARD,e),o=Ce(s);if(!w(o))return;Le(o);const{terrainelements:a,objectelements:c}=tk(o,r,n);if(a.length===0&&c.length===0)return;const l=c.map(m=>m.id??""),u=a.map(m=>Wr({x:m.x??0,y:m.y??0},Ct)),h=[],d=[];for(let m=0;m<a.length;++m){const g=a[m],y={x:g.x??-1,y:g.y??-1},b=fe(o,y);w(b)&&Ye(b)&&(h.push(b.id??""),h.push(b.id??""),d.push(Wr({x:b.x??0,y:b.y??0},Ct)))}let f=!1;for(let m=0;m<a.length;++m){const g=a[m],y=Jt(g,"collision"),b={x:g.x??-1,y:g.y??-1},A=Wr(b,Ct),T={x:b.x+t.x,y:b.y+t.y};if(tf(T)){const k=fe(o,T),I=(k==null?void 0:k.id)??"",R=Wr({x:(k==null?void 0:k.x)??0,y:(k==null?void 0:k.y)??0},Ct),$=Jt(k,"collision");if(w(k)&&Ye(k)&&h.includes(I)!==!0&&l.includes(I)!==!0){let M=!1;const H=d.includes(A),X=H?fe(o,b):void 0,O=H?Jt(X,"pushable"):!1,N=H&&O;if(y0(g,k)&&(y!==Wt.ISWALK||H)){let E=H;w(X)&&O&&(f=ls(i,o,X,{x:(X.x??0)-t.x,y:(X.y??0)-t.y})!==!0,f||(E=!1)),(E||y!==Wt.ISWALK)&&(f=ls(i,o,k,{x:(k.x??0)+t.x,y:(k.y??0)+t.y})!==!0,f&&(M=N))}else(y!==Wt.ISWALK||N)&&(f=!0,M=N);M&&w(X)&&(f=ls(i,o,X,{x:(X.x??0)-t.x,y:(X.y??0)-t.y})!==!0)}else $===Wt.ISSOLID&&u.includes(R)===!1&&(f=!0)}else f=!0}if(f)return;for(let m=0;m<c.length;++m){const g=c[m],y=Jt(g,"collision"),b={x:g.x??0,y:g.y??0},A={x:b.x+t.x,y:b.y+t.y};if(tf(A)){const T=fe(o,A),k=(T==null?void 0:T.id)??"",I=Jt(T,"collision"),R=Jt(T,"group");w(T)&&Ye(T)&&h.includes(k)&&l.includes(k)!==!0?y0(g,T)?f=ls(i,o,T,A)!==!0:f=!0:_c(y,I)&&n!==R&&(f=!0)}else f=!0}if(f)return;(t.x>0||t.y>0)&&a.reverse();for(let m=0;m<a.length;++m){const g=a[m],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y},A=us(o,b.x,b.y);if(w(g)&&w(A)){Ue(o,{...g,x:b.x,y:b.y}),Ue(o,{...A,x:y.x,y:y.y});const T=fe(o,y);Ye(T)&&w(T)&&(T.x=(T.x??0)+t.x,T.y=(T.y??0)+t.y,T.lx=(T.lx??0)+t.x,T.ly=(T.ly??0)+t.y)}}ac(o);for(let m=0;m<c.length;++m){const g=c[m],y={x:g.x??-1,y:g.y??-1},b={x:y.x+t.x,y:y.y+t.y};if(!ls(i,o,g,b))break}ac(o)}function $u(e,t){let r="all";const n={x:0,y:0},i={x:Ct-1,y:te-1};for(let s=t;s<e.length;){const[o,a]=ut(e,s,[V.MAYBE_NUMBER_OR_STRING]);if(yt(o))r=Dt(o),s=a;else if(Et(o)){const[c,l,u,h]=ut(e,a,[V.NUMBER,V.MAYBE_NUMBER,V.MAYBE_NUMBER]);n.x=Math.min(o,l??o),n.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:r,pt1:n,pt2:i}}const fj=Ti().command("snapshot",()=>(!w(x.book)||!w(x.board)||aj(x.board.id),0)).command("revert",()=>(!w(x.book)||!w(x.board)||cj(x.board.id),0)).command("copy",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ut(t,0,[V.STRING]),i=bookreadcodepagesbytypeandstat(x.book,vt.BOARD,r),s=bn(...i);if(w(s)){const o=$u(t,n);Su(s.id,x.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n,i,s]=ut(t,0,[V.STRING,V.NUMBER,V.NUMBER]),o=bookreadcodepagesbytypeandstat(x.book,vt.BOARD,r),a=bn(...o);if(w(a)){const c=$u(t,s);Bk(x.board.id,a.id,n,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!w(x.book)||!w(x.board))return 0;const[r,n]=ut(t,0,[V.DIR]),i={x:r.destpt.x-(((o=x.element)==null?void 0:o.x)??0),y:r.destpt.y-(((a=x.element)==null?void 0:a.y)??0)},s=$u(t,n);return lj(x.board.id,i,s.pt1,s.pt2,x.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ut(t,0,[V.NUMBER]),i=$u(t,n);return Z5(x.board.id,hy(r),i.pt1,i.pt2,i.targetset),0});var is=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(is||{});const hj={audio:Uh,board:VF,cli:E5,display:k5,element:N5,runtime:J5,loader:V5,network:X5,transform:fj},Wp=["audio","board","display","network","transform","element"],dj={0:[],1:["cli",...Wp],2:["loader",...Wp],3:["runtime",...Wp]},pj={0:new Map,1:new Map,2:new Map,3:new Map};function Ko(e){return(dj[e]??[]).map(r=>hj[r]).filter(w)}function Hp(e){const t=[],r=Ko(e);for(let n=0;n<r.length;++n)t.push(...r[n].listcommands());return t}function mj(e,t){const r=pj[e];if(!r.has(t)){let n;const i=Ko(e);for(let s=0;s<i.length&&(n=i[s].getcommand(t),!w(n));++s);r.set(t,n)}return r.get(t)}function gj(e,t,r){const n=Ko(e);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(t,r);if(o)return[o,a]}}return[!1,void 0]}function yj(e,t,r,n){const i=Ko(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,r,n);if(a)return[a,n]}}return[!1,void 0]}function _j(e,t){const r=Ko(e);for(let n=0;n<r.length;++n)r[n].tick(t)}function Hk(e,t){const r=Ko(e);for(let n=0;n<r.length;++n)r[n].everytick(t)}var Gk={},Kk={},Yk={};const qk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Yk.encode=function(e){if(0<=e&&e<qk.length)return qk[e];throw new TypeError("Must be between 0 and 63: "+e)};const bj=Yk,Vk=5,Xk=1<<Vk,wj=Xk-1,vj=Xk;function Ej(e){return e<0?(-e<<1)+1:(e<<1)+0}Kk.encode=function(t){let r="",n,i=Ej(t);do n=i&wj,i>>>=Vk,i>0&&(n|=vj),r+=bj.encode(n);while(i>0);return r};var hn={},Ks={},lc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */lc.exports;var Jk;function kj(){return Jk||(Jk=1,function(e,t){(function(r){var n=t&&!t.nodeType&&t,i=e&&!e.nodeType&&e,s=typeof er=="object"&&er;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,l=1,u=26,h=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=c-l,k=Math.floor,I=String.fromCharCode,R;function $(K){throw new RangeError(A[K])}function M(K,W){for(var P=K.length,st=[];P--;)st[P]=W(K[P]);return st}function H(K,W){var P=K.split("@"),st="";P.length>1&&(st=P[0]+"@",K=P[1]),K=K.replace(b,".");var G=K.split("."),rt=M(G,W).join(".");return st+rt}function X(K){for(var W=[],P=0,st=K.length,G,rt;P<st;)G=K.charCodeAt(P++),G>=55296&&G<=56319&&P<st?(rt=K.charCodeAt(P++),(rt&64512)==56320?W.push(((G&1023)<<10)+(rt&1023)+65536):(W.push(G),P--)):W.push(G);return W}function O(K){return M(K,function(W){var P="";return W>65535&&(W-=65536,P+=I(W>>>10&1023|55296),W=56320|W&1023),P+=I(W),P}).join("")}function N(K){return K-48<10?K-22:K-65<26?K-65:K-97<26?K-97:c}function E(K,W){return K+22+75*(K<26)-((W!=0)<<5)}function L(K,W,P){var st=0;for(K=P?k(K/d):K>>1,K+=k(K/W);K>T*u>>1;st+=c)K=k(K/T);return k(st+(T+1)*K/(K+h))}function j(K){var W=[],P=K.length,st,G=0,rt=p,wt=f,Tt,It,St,Pt,Mt,qt,ee,S,ft;for(Tt=K.lastIndexOf(m),Tt<0&&(Tt=0),It=0;It<Tt;++It)K.charCodeAt(It)>=128&&$("not-basic"),W.push(K.charCodeAt(It));for(St=Tt>0?Tt+1:0;St<P;){for(Pt=G,Mt=1,qt=c;St>=P&&$("invalid-input"),ee=N(K.charCodeAt(St++)),(ee>=c||ee>k((a-G)/Mt))&&$("overflow"),G+=ee*Mt,S=qt<=wt?l:qt>=wt+u?u:qt-wt,!(ee<S);qt+=c)ft=c-S,Mt>k(a/ft)&&$("overflow"),Mt*=ft;st=W.length+1,wt=L(G-Pt,st,Pt==0),k(G/st)>a-rt&&$("overflow"),rt+=k(G/st),G%=st,W.splice(G++,0,rt)}return O(W)}function U(K){var W,P,st,G,rt,wt,Tt,It,St,Pt,Mt,qt=[],ee,S,ft,ct;for(K=X(K),ee=K.length,W=p,P=0,rt=f,wt=0;wt<ee;++wt)Mt=K[wt],Mt<128&&qt.push(I(Mt));for(st=G=qt.length,G&&qt.push(m);st<ee;){for(Tt=a,wt=0;wt<ee;++wt)Mt=K[wt],Mt>=W&&Mt<Tt&&(Tt=Mt);for(S=st+1,Tt-W>k((a-P)/S)&&$("overflow"),P+=(Tt-W)*S,W=Tt,wt=0;wt<ee;++wt)if(Mt=K[wt],Mt<W&&++P>a&&$("overflow"),Mt==W){for(It=P,St=c;Pt=St<=rt?l:St>=rt+u?u:St-rt,!(It<Pt);St+=c)ct=It-Pt,ft=c-Pt,qt.push(I(E(Pt+ct%ft,0))),It=k(ct/ft);qt.push(I(E(It,0))),rt=L(P,S,st==G),P=0,++st}++P,++W}return qt.join("")}function q(K){return H(K,function(W){return g.test(W)?j(W.slice(4).toLowerCase()):W})}function Q(K){return H(K,function(W){return y.test(W)?"xn--"+U(W):W})}if(o={version:"1.4.1",ucs2:{decode:X,encode:O},decode:j,encode:U,toASCII:Q,toUnicode:q},n&&i)if(e.exports==n)i.exports=o;else for(R in o)o.hasOwnProperty(R)&&(n[R]=o[R]);else r.punycode=o})(er)}(lc,lc.exports)),lc.exports}var xj={},Aj=Object.freeze({__proto__:null,default:xj}),Tj=TA(Aj),Gp,Zk;function Bu(){if(Zk)return Gp;Zk=1;var e=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=e&&t&&typeof t.get=="function"?t.get:null,n=e&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,f=d?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,A=String.prototype.replace,T=String.prototype.toUpperCase,k=String.prototype.toLowerCase,I=RegExp.prototype.test,R=Array.prototype.concat,$=Array.prototype.join,M=Array.prototype.slice,H=Math.floor,X=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,N=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,E=typeof Symbol=="function"&&typeof Symbol.iterator=="object",L=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===E||!0)?Symbol.toStringTag:null,j=Object.prototype.propertyIsEnumerable,U=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(D){return D.__proto__}:null);function q(D,Z){if(D===1/0||D===-1/0||D!==D||D&&D>-1e3&&D<1e3||I.call(/e/,Z))return Z;var Bt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof D=="number"){var jt=D<0?-H(-D):H(D);if(jt!==D){var Gt=String(jt),Ot=b.call(Z,Gt.length+1);return A.call(Gt,Bt,"$&_")+"."+A.call(A.call(Ot,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(Z,Bt,"$&_")}var Q=Tj,K=Q.custom,W=S(K)?K:null,P={__proto__:null,double:'"',single:"'"},st={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Gp=function D(Z,Bt,jt,Gt){var Ot=Bt||{};if(z(Ot,"quoteStyle")&&!z(P,Ot.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(Ot,"maxStringLength")&&(typeof Ot.maxStringLength=="number"?Ot.maxStringLength<0&&Ot.maxStringLength!==1/0:Ot.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var rn=z(Ot,"customInspect")?Ot.customInspect:!0;if(typeof rn!="boolean"&&rn!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(Ot,"indent")&&Ot.indent!==null&&Ot.indent!=="	"&&!(parseInt(Ot.indent,10)===Ot.indent&&Ot.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(Ot,"numericSeparator")&&typeof Ot.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Cn=Ot.numericSeparator;if(typeof Z>"u")return"undefined";if(Z===null)return"null";if(typeof Z=="boolean")return Z?"true":"false";if(typeof Z=="string")return ye(Z,Ot);if(typeof Z=="number"){if(Z===0)return 1/0/Z>0?"0":"-0";var pn=String(Z);return Cn?q(Z,pn):pn}if(typeof Z=="bigint"){var ds=String(Z)+"n";return Cn?q(Z,ds):ds}var M0=typeof Ot.depth>"u"?5:Ot.depth;if(typeof jt>"u"&&(jt=0),jt>=M0&&M0>0&&typeof Z=="object")return Tt(Z)?"[Array]":"[Object]";var na=F(Ot,jt);if(typeof Gt>"u")Gt=[];else if(dt(Gt,Z)>=0)return"[Circular]";function Kn(ia,ff,dW){if(ff&&(Gt=M.call(Gt),Gt.push(ff)),dW){var EA={depth:Ot.depth};return z(Ot,"quoteStyle")&&(EA.quoteStyle=Ot.quoteStyle),D(ia,EA,jt+1,Gt)}return D(ia,Ot,jt+1,Gt)}if(typeof Z=="function"&&!St(Z)){var mA=tt(Z),gA=at(Z,Kn);return"[Function"+(mA?": "+mA:" (anonymous)")+"]"+(gA.length>0?" { "+$.call(gA,", ")+" }":"")}if(S(Z)){var yA=E?A.call(String(Z),/^(Symbol\(.*\))_[^)]*$/,"$1"):N.call(Z);return typeof Z=="object"&&!E?tr(yA):yA}if(Ft(Z)){for(var Ec="<"+k.call(String(Z.nodeName)),U0=Z.attributes||[],uf=0;uf<U0.length;uf++)Ec+=" "+U0[uf].name+"="+G(rt(U0[uf].value),"double",Ot);return Ec+=">",Z.childNodes&&Z.childNodes.length&&(Ec+="..."),Ec+="</"+k.call(String(Z.nodeName))+">",Ec}if(Tt(Z)){if(Z.length===0)return"[]";var P0=at(Z,Kn);return na&&!v(P0)?"["+Y(P0,na)+"]":"[ "+$.call(P0,", ")+" ]"}if(Pt(Z)){var F0=at(Z,Kn);return!("cause"in Error.prototype)&&"cause"in Z&&!j.call(Z,"cause")?"{ ["+String(Z)+"] "+$.call(R.call("[cause]: "+Kn(Z.cause),F0),", ")+" }":F0.length===0?"["+String(Z)+"]":"{ ["+String(Z)+"] "+$.call(F0,", ")+" }"}if(typeof Z=="object"&&rn){if(W&&typeof Z[W]=="function"&&Q)return Q(Z,{depth:M0-jt});if(rn!=="symbol"&&typeof Z.inspect=="function")return Z.inspect()}if(pt(Z)){var _A=[];return n&&n.call(Z,function(ia,ff){_A.push(Kn(ff,Z,!0)+" => "+Kn(ia,Z))}),_("Map",r.call(Z),_A,na)}if(Rt(Z)){var bA=[];return a&&a.call(Z,function(ia){bA.push(Kn(ia,Z))}),_("Set",o.call(Z),bA,na)}if(it(Z))return C("WeakMap");if(gt(Z))return C("WeakSet");if(_t(Z))return C("WeakRef");if(qt(Z))return tr(Kn(Number(Z)));if(ft(Z))return tr(Kn(X.call(Z)));if(ee(Z))return tr(p.call(Z));if(Mt(Z))return tr(Kn(String(Z)));if(typeof window<"u"&&Z===window)return"{ [object Window] }";if(typeof globalThis<"u"&&Z===globalThis||typeof er<"u"&&Z===er)return"{ [object globalThis] }";if(!It(Z)&&!St(Z)){var $0=at(Z,Kn),wA=U?U(Z)===Object.prototype:Z instanceof Object||Z.constructor===Object,B0=Z instanceof Object?"":"null prototype",vA=!wA&&L&&Object(Z)===Z&&L in Z?b.call(B(Z),8,-1):B0?"Object":"",hW=wA||typeof Z.constructor!="function"?"":Z.constructor.name?Z.constructor.name+" ":"",D0=hW+(vA||B0?"["+$.call(R.call([],vA||[],B0||[]),": ")+"] ":"");return $0.length===0?D0+"{}":na?D0+"{"+Y($0,na)+"}":D0+"{ "+$.call($0,", ")+" }"}return String(Z)};function G(D,Z,Bt){var jt=Bt.quoteStyle||Z,Gt=P[jt];return Gt+D+Gt}function rt(D){return A.call(String(D),/"/g,"&quot;")}function wt(D){return!L||!(typeof D=="object"&&(L in D||typeof D[L]<"u"))}function Tt(D){return B(D)==="[object Array]"&&wt(D)}function It(D){return B(D)==="[object Date]"&&wt(D)}function St(D){return B(D)==="[object RegExp]"&&wt(D)}function Pt(D){return B(D)==="[object Error]"&&wt(D)}function Mt(D){return B(D)==="[object String]"&&wt(D)}function qt(D){return B(D)==="[object Number]"&&wt(D)}function ee(D){return B(D)==="[object Boolean]"&&wt(D)}function S(D){if(E)return D&&typeof D=="object"&&D instanceof Symbol;if(typeof D=="symbol")return!0;if(!D||typeof D!="object"||!N)return!1;try{return N.call(D),!0}catch{}return!1}function ft(D){if(!D||typeof D!="object"||!X)return!1;try{return X.call(D),!0}catch{}return!1}var ct=Object.prototype.hasOwnProperty||function(D){return D in this};function z(D,Z){return ct.call(D,Z)}function B(D){return m.call(D)}function tt(D){if(D.name)return D.name;var Z=y.call(g.call(D),/^function\s*([\w$]+)/);return Z?Z[1]:null}function dt(D,Z){if(D.indexOf)return D.indexOf(Z);for(var Bt=0,jt=D.length;Bt<jt;Bt++)if(D[Bt]===Z)return Bt;return-1}function pt(D){if(!r||!D||typeof D!="object")return!1;try{r.call(D);try{o.call(D)}catch{return!0}return D instanceof Map}catch{}return!1}function it(D){if(!l||!D||typeof D!="object")return!1;try{l.call(D,l);try{h.call(D,h)}catch{return!0}return D instanceof WeakMap}catch{}return!1}function _t(D){if(!f||!D||typeof D!="object")return!1;try{return f.call(D),!0}catch{}return!1}function Rt(D){if(!o||!D||typeof D!="object")return!1;try{o.call(D);try{r.call(D)}catch{return!0}return D instanceof Set}catch{}return!1}function gt(D){if(!h||!D||typeof D!="object")return!1;try{h.call(D,h);try{l.call(D,l)}catch{return!0}return D instanceof WeakSet}catch{}return!1}function Ft(D){return!D||typeof D!="object"?!1:typeof HTMLElement<"u"&&D instanceof HTMLElement?!0:typeof D.nodeName=="string"&&typeof D.getAttribute=="function"}function ye(D,Z){if(D.length>Z.maxStringLength){var Bt=D.length-Z.maxStringLength,jt="... "+Bt+" more character"+(Bt>1?"s":"");return ye(b.call(D,0,Z.maxStringLength),Z)+jt}var Gt=st[Z.quoteStyle||"single"];Gt.lastIndex=0;var Ot=A.call(A.call(D,Gt,"\\$1"),/[\x00-\x1f]/g,Xt);return G(Ot,"single",Z)}function Xt(D){var Z=D.charCodeAt(0),Bt={8:"b",9:"t",10:"n",12:"f",13:"r"}[Z];return Bt?"\\"+Bt:"\\x"+(Z<16?"0":"")+T.call(Z.toString(16))}function tr(D){return"Object("+D+")"}function C(D){return D+" { ? }"}function _(D,Z,Bt,jt){var Gt=jt?Y(Bt,jt):$.call(Bt,", ");return D+" ("+Z+") {"+Gt+"}"}function v(D){for(var Z=0;Z<D.length;Z++)if(dt(D[Z],`
`)>=0)return!1;return!0}function F(D,Z){var Bt;if(D.indent==="	")Bt="	";else if(typeof D.indent=="number"&&D.indent>0)Bt=$.call(Array(D.indent+1)," ");else return null;return{base:Bt,prev:$.call(Array(Z+1),Bt)}}function Y(D,Z){if(D.length===0)return"";var Bt=`
`+Z.prev+Z.base;return Bt+$.call(D,","+Bt)+`
`+Z.prev}function at(D,Z){var Bt=Tt(D),jt=[];if(Bt){jt.length=D.length;for(var Gt=0;Gt<D.length;Gt++)jt[Gt]=z(D,Gt)?Z(D[Gt],D):""}var Ot=typeof O=="function"?O(D):[],rn;if(E){rn={};for(var Cn=0;Cn<Ot.length;Cn++)rn["$"+Ot[Cn]]=Ot[Cn]}for(var pn in D)z(D,pn)&&(Bt&&String(Number(pn))===pn&&pn<D.length||E&&rn["$"+pn]instanceof Symbol||(I.call(/[^\w$]/,pn)?jt.push(Z(pn,D)+": "+Z(D[pn],D)):jt.push(pn+": "+Z(D[pn],D))));if(typeof O=="function")for(var ds=0;ds<Ot.length;ds++)j.call(D,Ot[ds])&&jt.push("["+Z(Ot[ds])+"]: "+Z(D[Ot[ds]],D));return jt}return Gp}var Kp,Qk;function Sj(){if(Qk)return Kp;Qk=1;var e=Bu(),t=Vi,r=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},n=function(a,c){if(a){var l=r(a,c);return l&&l.value}},i=function(a,c,l){var u=r(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return Kp=function(){var c,l={assert:function(u){if(!l.has(u))throw new t("Side channel does not contain "+e(u))},delete:function(u){var h=c&&c.next,d=o(c,u);return d&&h&&h===d&&(c=void 0),!!d},get:function(u){return n(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},Kp}var Yp,tx;function ex(){if(tx)return Yp;tx=1;var e=El,t=Zh,r=Bu(),n=Vi,i=e("%Map%",!0),s=t("Map.prototype.get",!0),o=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),c=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return Yp=!!i&&function(){var h,d={assert:function(f){if(!d.has(f))throw new n("Side channel does not contain "+r(f))},delete:function(f){if(h){var p=c(h,f);return l(h)===0&&(h=void 0),p}return!1},get:function(f){if(h)return s(h,f)},has:function(f){return h?a(h,f):!1},set:function(f,p){h||(h=new i),o(h,f,p)}};return d},Yp}var qp,rx;function Rj(){if(rx)return qp;rx=1;var e=El,t=Zh,r=Bu(),n=ex(),i=Vi,s=e("%WeakMap%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),c=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return qp=s?function(){var h,d,f={assert:function(p){if(!f.has(p))throw new i("Side channel does not contain "+r(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return l(h,p)}else if(n&&d)return d.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):d&&d.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?c(h,p):!!d&&d.has(p)},set:function(p,m){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,m)):n&&(d||(d=n()),d.set(p,m))}};return f}:n,qp}var Vp,nx;function Oj(){if(nx)return Vp;nx=1;var e=Vi,t=Bu(),r=Sj(),n=ex(),i=Rj(),s=i||n||r;return Vp=function(){var a,c={assert:function(l){if(!c.has(l))throw new e("Side channel does not contain "+t(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},Vp}var Xp,ix;function Jp(){if(ix)return Xp;ix=1;var e=String.prototype.replace,t=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Xp={default:r.RFC3986,formatters:{RFC1738:function(n){return e.call(n,t,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},Xp}var Zp,sx;function ox(){if(sx)return Zp;sx=1;var e=Jp(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g}(),i=function(y){for(;y.length>1;){var b=y.pop(),A=b.obj[b.prop];if(r(A)){for(var T=[],k=0;k<A.length;++k)typeof A[k]<"u"&&T.push(A[k]);b.obj[b.prop]=T}}},s=function(y,b){for(var A=b&&b.plainObjects?{__proto__:null}:{},T=0;T<y.length;++T)typeof y[T]<"u"&&(A[T]=y[T]);return A},o=function g(y,b,A){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(A&&(A.plainObjects||A.allowPrototypes)||!t.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var T=y;return r(y)&&!r(b)&&(T=s(y,A)),r(y)&&r(b)?(b.forEach(function(k,I){if(t.call(y,I)){var R=y[I];R&&typeof R=="object"&&k&&typeof k=="object"?y[I]=g(R,k,A):y.push(k)}else y[I]=k}),y):Object.keys(b).reduce(function(k,I){var R=b[I];return t.call(k,I)?k[I]=g(k[I],R,A):k[I]=R,k},T)},a=function(y,b){return Object.keys(b).reduce(function(A,T){return A[T]=b[T],A},y)},c=function(g,y,b){var A=g.replace(/\+/g," ");if(b==="iso-8859-1")return A.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(A)}catch{return A}},l=1024,u=function(y,b,A,T,k){if(y.length===0)return y;var I=y;if(typeof y=="symbol"?I=Symbol.prototype.toString.call(y):typeof y!="string"&&(I=String(y)),A==="iso-8859-1")return escape(I).replace(/%u[0-9a-f]{4}/gi,function(N){return"%26%23"+parseInt(N.slice(2),16)+"%3B"});for(var R="",$=0;$<I.length;$+=l){for(var M=I.length>=l?I.slice($,$+l):I,H=[],X=0;X<M.length;++X){var O=M.charCodeAt(X);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||k===e.RFC1738&&(O===40||O===41)){H[H.length]=M.charAt(X);continue}if(O<128){H[H.length]=n[O];continue}if(O<2048){H[H.length]=n[192|O>>6]+n[128|O&63];continue}if(O<55296||O>=57344){H[H.length]=n[224|O>>12]+n[128|O>>6&63]+n[128|O&63];continue}X+=1,O=65536+((O&1023)<<10|M.charCodeAt(X)&1023),H[H.length]=n[240|O>>18]+n[128|O>>12&63]+n[128|O>>6&63]+n[128|O&63]}R+=H.join("")}return R},h=function(y){for(var b=[{obj:{o:y},prop:"o"}],A=[],T=0;T<b.length;++T)for(var k=b[T],I=k.obj[k.prop],R=Object.keys(I),$=0;$<R.length;++$){var M=R[$],H=I[M];typeof H=="object"&&H!==null&&A.indexOf(H)===-1&&(b.push({obj:I,prop:M}),A.push(H))}return i(b),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},f=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},p=function(y,b){return[].concat(y,b)},m=function(y,b){if(r(y)){for(var A=[],T=0;T<y.length;T+=1)A.push(b(y[T]));return A}return b(y)};return Zp={arrayToObject:s,assign:a,combine:p,compact:h,decode:c,encode:u,isBuffer:f,isRegExp:d,maybeMap:m,merge:o},Zp}var Qp,ax;function Ij(){if(ax)return Qp;ax=1;var e=Oj(),t=ox(),r=Jp(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(m,g){o.apply(m,s(g)?g:[g])},c=Date.prototype.toISOString,l=r.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:r.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},h=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},d={},f=function m(g,y,b,A,T,k,I,R,$,M,H,X,O,N,E,L,j,U){for(var q=g,Q=U,K=0,W=!1;(Q=Q.get(d))!==void 0&&!W;){var P=Q.get(g);if(K+=1,typeof P<"u"){if(P===K)throw new RangeError("Cyclic object value");W=!0}typeof Q.get(d)>"u"&&(K=0)}if(typeof M=="function"?q=M(y,q):q instanceof Date?q=O(q):b==="comma"&&s(q)&&(q=t.maybeMap(q,function(ft){return ft instanceof Date?O(ft):ft})),q===null){if(k)return $&&!L?$(y,u.encoder,j,"key",N):y;q=""}if(h(q)||t.isBuffer(q)){if($){var st=L?y:$(y,u.encoder,j,"key",N);return[E(st)+"="+E($(q,u.encoder,j,"value",N))]}return[E(y)+"="+E(String(q))]}var G=[];if(typeof q>"u")return G;var rt;if(b==="comma"&&s(q))L&&$&&(q=t.maybeMap(q,$)),rt=[{value:q.length>0?q.join(",")||null:void 0}];else if(s(M))rt=M;else{var wt=Object.keys(q);rt=H?wt.sort(H):wt}var Tt=R?String(y).replace(/\./g,"%2E"):String(y),It=A&&s(q)&&q.length===1?Tt+"[]":Tt;if(T&&s(q)&&q.length===0)return It+"[]";for(var St=0;St<rt.length;++St){var Pt=rt[St],Mt=typeof Pt=="object"&&Pt&&typeof Pt.value<"u"?Pt.value:q[Pt];if(!(I&&Mt===null)){var qt=X&&R?String(Pt).replace(/\./g,"%2E"):String(Pt),ee=s(q)?typeof b=="function"?b(It,qt):It:It+(X?"."+qt:"["+qt+"]");U.set(g,K);var S=e();S.set(d,U),a(G,m(Mt,ee,b,A,T,k,I,R,b==="comma"&&L&&s(q)?null:$,M,H,X,O,N,E,L,j,S))}}return G},p=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var A=r.formatters[b],T=u.filter;(typeof g.filter=="function"||s(g.filter))&&(T=g.filter);var k;if(g.arrayFormat in i?k=g.arrayFormat:"indices"in g?k=g.indices?"indices":"repeat":k=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var I=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:I,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:k,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:T,format:b,formatter:A,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return Qp=function(m,g){var y=m,b=p(g),A,T;typeof b.filter=="function"?(T=b.filter,y=T("",y)):s(b.filter)&&(T=b.filter,A=T);var k=[];if(typeof y!="object"||y===null)return"";var I=i[b.arrayFormat],R=I==="comma"&&b.commaRoundTrip;A||(A=Object.keys(y)),b.sort&&A.sort(b.sort);for(var $=e(),M=0;M<A.length;++M){var H=A[M],X=y[H];b.skipNulls&&X===null||a(k,f(X,H,I,R,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,$))}var O=k.join(b.delimiter),N=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?N+="utf8=%26%2310003%3B&":N+="utf8=%E2%9C%93&"),O.length>0?N+O:""},Qp}var t0,cx;function Nj(){if(cx)return t0;cx=1;var e=ox(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(f,p){return String.fromCharCode(parseInt(p,10))})},s=function(d,f,p){if(d&&typeof d=="string"&&f.comma&&d.indexOf(",")>-1)return d.split(",");if(f.throwOnLimitExceeded&&p>=f.arrayLimit)throw new RangeError("Array limit exceeded. Only "+f.arrayLimit+" element"+(f.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(f,p){var m={__proto__:null},g=p.ignoreQueryPrefix?f.replace(/^\?/,""):f;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=p.parameterLimit===1/0?void 0:p.parameterLimit,b=g.split(p.delimiter,p.throwOnLimitExceeded?y+1:y);if(p.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var A=-1,T,k=p.charset;if(p.charsetSentinel)for(T=0;T<b.length;++T)b[T].indexOf("utf8=")===0&&(b[T]===a?k="utf-8":b[T]===o&&(k="iso-8859-1"),A=T,T=b.length);for(T=0;T<b.length;++T)if(T!==A){var I=b[T],R=I.indexOf("]="),$=R===-1?I.indexOf("="):R+1,M,H;$===-1?(M=p.decoder(I,n.decoder,k,"key"),H=p.strictNullHandling?null:""):(M=p.decoder(I.slice(0,$),n.decoder,k,"key"),H=e.maybeMap(s(I.slice($+1),p,r(m[M])?m[M].length:0),function(O){return p.decoder(O,n.decoder,k,"value")})),H&&p.interpretNumericEntities&&k==="iso-8859-1"&&(H=i(String(H))),I.indexOf("[]=")>-1&&(H=r(H)?[H]:H);var X=t.call(m,M);X&&p.duplicates==="combine"?m[M]=e.combine(m[M],H):(!X||p.duplicates==="last")&&(m[M]=H)}return m},l=function(d,f,p,m){var g=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");g=Array.isArray(f)&&f[y]?f[y].length:0}for(var b=m?f:s(f,p,g),A=d.length-1;A>=0;--A){var T,k=d[A];if(k==="[]"&&p.parseArrays)T=p.allowEmptyArrays&&(b===""||p.strictNullHandling&&b===null)?[]:e.combine([],b);else{T=p.plainObjects?{__proto__:null}:{};var I=k.charAt(0)==="["&&k.charAt(k.length-1)==="]"?k.slice(1,-1):k,R=p.decodeDotInKeys?I.replace(/%2E/g,"."):I,$=parseInt(R,10);!p.parseArrays&&R===""?T={0:b}:!isNaN($)&&k!==R&&String($)===R&&$>=0&&p.parseArrays&&$<=p.arrayLimit?(T=[],T[$]=b):R!=="__proto__"&&(T[R]=b)}b=T}return b},u=function(f,p,m,g){if(f){var y=m.allowDots?f.replace(/\.([^.[]+)/g,"[$1]"):f,b=/(\[[^[\]]*])/,A=/(\[[^[\]]*])/g,T=m.depth>0&&b.exec(y),k=T?y.slice(0,T.index):y,I=[];if(k){if(!m.plainObjects&&t.call(Object.prototype,k)&&!m.allowPrototypes)return;I.push(k)}for(var R=0;m.depth>0&&(T=A.exec(y))!==null&&R<m.depth;){if(R+=1,!m.plainObjects&&t.call(Object.prototype,T[1].slice(1,-1))&&!m.allowPrototypes)return;I.push(T[1])}if(T){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");I.push("["+y.slice(T.index)+"]")}return l(I,p,m,g)}},h=function(f){if(!f)return n;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.decodeDotInKeys<"u"&&typeof f.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(f.decoder!==null&&typeof f.decoder<"u"&&typeof f.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof f.throwOnLimitExceeded<"u"&&typeof f.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof f.charset>"u"?n.charset:f.charset,m=typeof f.duplicates>"u"?n.duplicates:f.duplicates;if(m!=="combine"&&m!=="first"&&m!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof f.allowDots>"u"?f.decodeDotInKeys===!0?!0:n.allowDots:!!f.allowDots;return{allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof f.allowPrototypes=="boolean"?f.allowPrototypes:n.allowPrototypes,allowSparse:typeof f.allowSparse=="boolean"?f.allowSparse:n.allowSparse,arrayLimit:typeof f.arrayLimit=="number"?f.arrayLimit:n.arrayLimit,charset:p,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:n.charsetSentinel,comma:typeof f.comma=="boolean"?f.comma:n.comma,decodeDotInKeys:typeof f.decodeDotInKeys=="boolean"?f.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof f.decoder=="function"?f.decoder:n.decoder,delimiter:typeof f.delimiter=="string"||e.isRegExp(f.delimiter)?f.delimiter:n.delimiter,depth:typeof f.depth=="number"||f.depth===!1?+f.depth:n.depth,duplicates:m,ignoreQueryPrefix:f.ignoreQueryPrefix===!0,interpretNumericEntities:typeof f.interpretNumericEntities=="boolean"?f.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof f.parameterLimit=="number"?f.parameterLimit:n.parameterLimit,parseArrays:f.parseArrays!==!1,plainObjects:typeof f.plainObjects=="boolean"?f.plainObjects:n.plainObjects,strictDepth:typeof f.strictDepth=="boolean"?!!f.strictDepth:n.strictDepth,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof f.throwOnLimitExceeded=="boolean"?f.throwOnLimitExceeded:!1}};return t0=function(d,f){var p=h(f);if(d===""||d===null||typeof d>"u")return p.plainObjects?{__proto__:null}:{};for(var m=typeof d=="string"?c(d,p):d,g=p.plainObjects?{__proto__:null}:{},y=Object.keys(m),b=0;b<y.length;++b){var A=y[b],T=u(A,m[A],p,typeof d=="string");g=e.merge(g,T,p)}return p.allowSparse===!0?g:e.compact(g)},t0}var e0,lx;function Cj(){if(lx)return e0;lx=1;var e=Ij(),t=Nj(),r=Jp();return e0={formats:r,parse:t,stringify:e},e0}var ux;function Lj(){if(ux)return Ks;ux=1;var e=kj();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=Cj();function y(k,I,R){if(k&&typeof k=="object"&&k instanceof t)return k;var $=new t;return $.parse(k,I,R),$}t.prototype.parse=function(k,I,R){if(typeof k!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof k);var $=k.indexOf("?"),M=$!==-1&&$<k.indexOf("#")?"?":"#",H=k.split(M),X=/\\/g;H[0]=H[0].replace(X,"/"),k=H.join(M);var O=k;if(O=O.trim(),!R&&k.split("#").length===1){var N=i.exec(O);if(N)return this.path=O,this.href=O,this.pathname=N[1],N[2]?(this.search=N[2],I?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):I&&(this.search="",this.query={}),this}var E=r.exec(O);if(E){E=E[0];var L=E.toLowerCase();this.protocol=L,O=O.substr(E.length)}if(R||E||O.match(/^\/\/[^@/]+@[^@/]+/)){var j=O.substr(0,2)==="//";j&&!(E&&p[E])&&(O=O.substr(2),this.slashes=!0)}if(!p[E]&&(j||E&&!m[E])){for(var U=-1,q=0;q<l.length;q++){var Q=O.indexOf(l[q]);Q!==-1&&(U===-1||Q<U)&&(U=Q)}var K,W;U===-1?W=O.lastIndexOf("@"):W=O.lastIndexOf("@",U),W!==-1&&(K=O.slice(0,W),O=O.slice(W+1),this.auth=decodeURIComponent(K)),U=-1;for(var q=0;q<c.length;q++){var Q=O.indexOf(c[q]);Q!==-1&&(U===-1||Q<U)&&(U=Q)}U===-1&&(U=O.length),this.host=O.slice(0,U),O=O.slice(U),this.parseHost(),this.hostname=this.hostname||"";var P=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!P)for(var st=this.hostname.split(/\./),q=0,G=st.length;q<G;q++){var rt=st[q];if(rt&&!rt.match(h)){for(var wt="",Tt=0,It=rt.length;Tt<It;Tt++)rt.charCodeAt(Tt)>127?wt+="x":wt+=rt[Tt];if(!wt.match(h)){var St=st.slice(0,q),Pt=st.slice(q+1),Mt=rt.match(d);Mt&&(St.push(Mt[1]),Pt.unshift(Mt[2])),Pt.length&&(O="/"+Pt.join(".")+O),this.hostname=St.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=e.toASCII(this.hostname));var qt=this.port?":"+this.port:"",ee=this.hostname||"";this.host=ee+qt,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!f[L])for(var q=0,G=a.length;q<G;q++){var S=a[q];if(O.indexOf(S)!==-1){var ft=encodeURIComponent(S);ft===S&&(ft=escape(S)),O=O.split(S).join(ft)}}var ct=O.indexOf("#");ct!==-1&&(this.hash=O.substr(ct),O=O.slice(0,ct));var z=O.indexOf("?");if(z!==-1?(this.search=O.substr(z),this.query=O.substr(z+1),I&&(this.query=g.parse(this.query)),O=O.slice(0,z)):I&&(this.search="",this.query={}),O&&(this.pathname=O),m[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var qt=this.pathname||"",B=this.search||"";this.path=qt+B}return this.href=this.format(),this};function b(k){return typeof k=="string"&&(k=y(k)),k instanceof t?k.format():t.prototype.format.call(k)}t.prototype.format=function(){var k=this.auth||"";k&&(k=encodeURIComponent(k),k=k.replace(/%3A/i,":"),k+="@");var I=this.protocol||"",R=this.pathname||"",$=this.hash||"",M=!1,H="";this.host?M=k+this.host:this.hostname&&(M=k+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(M+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(H=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var X=this.search||H&&"?"+H||"";return I&&I.substr(-1)!==":"&&(I+=":"),this.slashes||(!I||m[I])&&M!==!1?(M="//"+(M||""),R&&R.charAt(0)!=="/"&&(R="/"+R)):M||(M=""),$&&$.charAt(0)!=="#"&&($="#"+$),X&&X.charAt(0)!=="?"&&(X="?"+X),R=R.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),X=X.replace("#","%23"),I+M+R+X+$};function A(k,I){return y(k,!1,!0).resolve(I)}t.prototype.resolve=function(k){return this.resolveObject(y(k,!1,!0)).format()};function T(k,I){return k?y(k,!1,!0).resolveObject(I):I}return t.prototype.resolveObject=function(k){if(typeof k=="string"){var I=new t;I.parse(k,!1,!0),k=I}for(var R=new t,$=Object.keys(this),M=0;M<$.length;M++){var H=$[M];R[H]=this[H]}if(R.hash=k.hash,k.href==="")return R.href=R.format(),R;if(k.slashes&&!k.protocol){for(var X=Object.keys(k),O=0;O<X.length;O++){var N=X[O];N!=="protocol"&&(R[N]=k[N])}return m[R.protocol]&&R.hostname&&!R.pathname&&(R.pathname="/",R.path=R.pathname),R.href=R.format(),R}if(k.protocol&&k.protocol!==R.protocol){if(!m[k.protocol]){for(var E=Object.keys(k),L=0;L<E.length;L++){var j=E[L];R[j]=k[j]}return R.href=R.format(),R}if(R.protocol=k.protocol,!k.host&&!p[k.protocol]){for(var G=(k.pathname||"").split("/");G.length&&!(k.host=G.shift()););k.host||(k.host=""),k.hostname||(k.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),R.pathname=G.join("/")}else R.pathname=k.pathname;if(R.search=k.search,R.query=k.query,R.host=k.host||"",R.auth=k.auth,R.hostname=k.hostname||k.host,R.port=k.port,R.pathname||R.search){var U=R.pathname||"",q=R.search||"";R.path=U+q}return R.slashes=R.slashes||k.slashes,R.href=R.format(),R}var Q=R.pathname&&R.pathname.charAt(0)==="/",K=k.host||k.pathname&&k.pathname.charAt(0)==="/",W=K||Q||R.host&&k.pathname,P=W,st=R.pathname&&R.pathname.split("/")||[],G=k.pathname&&k.pathname.split("/")||[],rt=R.protocol&&!m[R.protocol];if(rt&&(R.hostname="",R.port=null,R.host&&(st[0]===""?st[0]=R.host:st.unshift(R.host)),R.host="",k.protocol&&(k.hostname=null,k.port=null,k.host&&(G[0]===""?G[0]=k.host:G.unshift(k.host)),k.host=null),W=W&&(G[0]===""||st[0]==="")),K)R.host=k.host||k.host===""?k.host:R.host,R.hostname=k.hostname||k.hostname===""?k.hostname:R.hostname,R.search=k.search,R.query=k.query,st=G;else if(G.length)st||(st=[]),st.pop(),st=st.concat(G),R.search=k.search,R.query=k.query;else if(k.search!=null){if(rt){R.host=st.shift(),R.hostname=R.host;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return R.search=k.search,R.query=k.query,(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.href=R.format(),R}if(!st.length)return R.pathname=null,R.search?R.path="/"+R.search:R.path=null,R.href=R.format(),R;for(var Tt=st.slice(-1)[0],It=(R.host||k.host||st.length>1)&&(Tt==="."||Tt==="..")||Tt==="",St=0,Pt=st.length;Pt>=0;Pt--)Tt=st[Pt],Tt==="."?st.splice(Pt,1):Tt===".."?(st.splice(Pt,1),St++):St&&(st.splice(Pt,1),St--);if(!W&&!P)for(;St--;St)st.unshift("..");W&&st[0]!==""&&(!st[0]||st[0].charAt(0)!=="/")&&st.unshift(""),It&&st.join("/").substr(-1)!=="/"&&st.push("");var Mt=st[0]===""||st[0]&&st[0].charAt(0)==="/";if(rt){R.hostname=Mt?"":st.length?st.shift():"",R.host=R.hostname;var wt=R.host&&R.host.indexOf("@")>0?R.host.split("@"):!1;wt&&(R.auth=wt.shift(),R.hostname=wt.shift(),R.host=R.hostname)}return W=W||R.host&&st.length,W&&!Mt&&st.unshift(""),st.length>0?R.pathname=st.join("/"):(R.pathname=null,R.path=null),(R.pathname!==null||R.search!==null)&&(R.path=(R.pathname?R.pathname:"")+(R.search?R.search:"")),R.auth=k.auth||R.auth,R.slashes=R.slashes||k.slashes,R.href=R.format(),R},t.prototype.parseHost=function(){var k=this.host,I=n.exec(k);I&&(I=I[0],I!==":"&&(this.port=I.substr(1)),k=k.substr(0,k.length-I.length)),k&&(this.hostname=k)},Ks.parse=y,Ks.resolve=A,Ks.resolveObject=T,Ks.format=b,Ks.Url=t,Ks}var Mj=typeof URL=="function"?URL:Lj().URL;const ss=Mj;function Uj(e,t,r){if(t in e)return e[t];if(arguments.length===3)return r;throw new Error('"'+t+'" is a required argument.')}hn.getArg=Uj;const fx=function(){return!("__proto__"in Object.create(null))}();function hx(e){return e}function Pj(e){return dx(e)?"$"+e:e}hn.toSetString=fx?hx:Pj;function Fj(e){return dx(e)?e.slice(1):e}hn.fromSetString=fx?hx:Fj;function dx(e){if(!e)return!1;const t=e.length;if(t<9||e.charCodeAt(t-1)!==95||e.charCodeAt(t-2)!==95||e.charCodeAt(t-3)!==111||e.charCodeAt(t-4)!==116||e.charCodeAt(t-5)!==111||e.charCodeAt(t-6)!==114||e.charCodeAt(t-7)!==112||e.charCodeAt(t-8)!==95||e.charCodeAt(t-9)!==95)return!1;for(let r=t-10;r>=0;r--)if(e.charCodeAt(r)!==36)return!1;return!0}function px(e,t){return e===t?0:e===null?1:t===null?-1:e>t?1:-1}function $j(e,t){let r=e.generatedLine-t.generatedLine;return r!==0||(r=e.generatedColumn-t.generatedColumn,r!==0)||(r=px(e.source,t.source),r!==0)||(r=e.originalLine-t.originalLine,r!==0)||(r=e.originalColumn-t.originalColumn,r!==0)?r:px(e.name,t.name)}hn.compareByGeneratedPositionsInflated=$j;function Bj(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}hn.parseSourceMapInput=Bj;const r0="http:",uc=`${r0}//host`;function n0(e){return t=>{const r=Yo(t),n=i0(t),i=new ss(t,n);e(i);const s=i.toString();return r==="absolute"?s:r==="scheme-relative"?s.slice(r0.length):r==="path-absolute"?s.slice(uc.length):s0(n,s)}}function os(e,t){return new ss(e,t).toString()}function Dj(e,t){let r=0;do{const n=e+r++;if(t.indexOf(n)===-1)return n}while(!0)}function i0(e){const t=e.split("..").length-1,r=Dj("p",e);let n=`${uc}/`;for(let i=0;i<t;i++)n+=`${r}/`;return n}const jj=/^[A-Za-z0-9\+\-\.]+:/;function Yo(e){return e[0]==="/"?e[1]==="/"?"scheme-relative":"path-absolute":jj.test(e)?"absolute":"path-relative"}function s0(e,t){typeof e=="string"&&(e=new ss(e)),typeof t=="string"&&(t=new ss(t));const r=t.pathname.split("/"),n=e.pathname.split("/");for(n.length>0&&!n[n.length-1]&&n.pop();r.length>0&&n.length>0&&r[0]===n[0];)r.shift(),n.shift();return n.map(()=>"..").concat(r).join("/")+t.search+t.hash}const zj=n0(e=>{e.pathname=e.pathname.replace(/\/?$/,"/")}),Wj=n0(e=>{e.href=new ss(".",e.toString()).toString()}),fc=n0(e=>{});hn.normalize=fc;function o0(e,t){const r=Yo(t),n=Yo(e);if(e=zj(e),r==="absolute")return os(t,void 0);if(n==="absolute")return os(t,e);if(r==="scheme-relative")return fc(t);if(n==="scheme-relative")return os(t,os(e,uc)).slice(r0.length);if(r==="path-absolute")return fc(t);if(n==="path-absolute")return os(t,os(e,uc)).slice(uc.length);const i=i0(t+e),s=os(t,os(e,i));return s0(i,s)}hn.join=o0;function Hj(e,t){const r=Gj(e,t);return typeof r=="string"?r:fc(t)}hn.relative=Hj;function Gj(e,t){if(Yo(e)!==Yo(t))return null;const n=i0(e+t),i=new ss(e,n),s=new ss(t,n);try{new ss("",s.toString())}catch{return null}return s.protocol!==i.protocol||s.user!==i.user||s.password!==i.password||s.hostname!==i.hostname||s.port!==i.port?null:s0(i,s)}function Kj(e,t,r){e&&Yo(t)==="path-absolute"&&(t=t.replace(/^\//,""));let n=fc(t||"");return e&&(n=o0(e,n)),r&&(n=o0(Wj(r),n)),n}hn.computeSourceURL=Kj;var a0={};let Yj=class xA{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const n=new xA;for(let i=0,s=t.length;i<s;i++)n.add(t[i],r);return n}size(){return this._set.size}add(t,r){const n=this.has(t),i=this._array.length;(!n||r)&&this._array.push(t),n||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};a0.ArraySet=Yj;var mx={};const gx=hn;function qj(e,t){const r=e.generatedLine,n=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return n>r||n==r&&s>=i||gx.compareByGeneratedPositionsInflated(e,t)<=0}let Vj=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,r){this._array.forEach(t,r)}add(t){qj(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(gx.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};mx.MappingList=Vj;const hc=Kk,Qe=hn,Du=a0.ArraySet,Xj=mx.MappingList;let yx=class AA{constructor(t){t||(t={}),this._file=Qe.getArg(t,"file",null),this._sourceRoot=Qe.getArg(t,"sourceRoot",null),this._skipValidation=Qe.getArg(t,"skipValidation",!1),this._sources=new Du,this._names=new Du,this._mappings=new Xj,this._sourcesContents=null}static fromSourceMap(t){const r=t.sourceRoot,n=new AA({file:t.file,sourceRoot:r});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,r!=null&&(s.source=Qe.relative(r,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),n.addMapping(s)}),t.sources.forEach(function(i){let s=i;r!=null&&(s=Qe.relative(r,i)),n._sources.has(s)||n._sources.add(s);const o=t.sourceContentFor(i);o!=null&&n.setSourceContent(i,o)}),n}addMapping(t){const r=Qe.getArg(t,"generated"),n=Qe.getArg(t,"original",null);let i=Qe.getArg(t,"source",null),s=Qe.getArg(t,"name",null);this._skipValidation||this._validateMapping(r,n,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:n&&n.line,originalColumn:n&&n.column,source:i,name:s})}setSourceContent(t,r){let n=t;this._sourceRoot!=null&&(n=Qe.relative(this._sourceRoot,n)),r!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Qe.toSetString(n)]=r):this._sourcesContents&&(delete this._sourcesContents[Qe.toSetString(n)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,r,n){let i=r;if(r==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Qe.relative(s,i));const o=this._mappings.toArray().length>0?new Du:this._sources,a=new Du;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,n!=null&&(c.source=Qe.join(n,c.source)),s!=null&&(c.source=Qe.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(n!=null&&(c=Qe.join(n,c)),s!=null&&(c=Qe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,r,n,i){if(r&&typeof r.line!="number"&&typeof r.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!r&&!n&&!i)){if(!(t&&"line"in t&&"column"in t&&r&&"line"in r&&"column"in r&&t.line>0&&t.column>=0&&r.line>0&&r.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:n,original:r,name:i}))}}_serializeMappings(){let t=0,r=1,n=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==r)for(t=0;l.generatedLine!==r;)c+=";",r++;else if(f>0){if(!Qe.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=hc.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=hc.encode(h-o),o=h,c+=hc.encode(l.originalLine-1-i),i=l.originalLine-1,c+=hc.encode(l.originalColumn-n),n=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=hc.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,r){return t.map(function(n){if(!this._sourcesContents)return null;r!=null&&(n=Qe.relative(r,n));const i=Qe.toSetString(n);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};yx.prototype._version=3,Gk.SourceMapGenerator=yx;var _x={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,l=o(i,s[c],!0);return l===0?c:l>0?n-c>1?t(c,n,i,s,o,a):a===e.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?t(r,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.search=function(n,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,n,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(_x);var c0={exports:{}};let dc=null;c0.exports=function(){if(typeof dc=="string")return fetch(dc).then(t=>t.arrayBuffer());if(dc instanceof ArrayBuffer)return Promise.resolve(dc);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},c0.exports.initialize=e=>{dc=e};var bx=c0.exports;const Jj=bx;function Zj(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let pc=null;var Qj=function(){if(pc)return pc;const t=[];return pc=Jj().then(r=>WebAssembly.instantiate(r,{env:{mapping_callback(n,i,s,o,a,c,l,u,h,d){const f=new Zj;f.generatedLine=n+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(r=>({exports:r.instance.exports,withMappingCallback:(n,i)=>{t.push(n);try{i()}finally{t.pop()}}})).then(null,r=>{throw pc=null,r}),pc};const ne=hn,tz=_x,l0=a0.ArraySet,ez=bx,rz=Qj,u0=Symbol("smcInternal");class yr{constructor(t,r){return t==u0?Promise.resolve(this):iz(t,r)}static initialize(t){ez.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,r){return sz(t,r)}static async with(t,r,n){const i=await new yr(t,r);try{return await n(i)}finally{i.destroy()}}eachMapping(t,r,n){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}yr.prototype._version=3,yr.GENERATED_ORDER=1,yr.ORIGINAL_ORDER=2,yr.GREATEST_LOWER_BOUND=1,yr.LEAST_UPPER_BOUND=2;class mc extends yr{constructor(t,r){return super(u0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sources").map(String),a=ne.getArg(i,"names",[]),c=ne.getArg(i,"sourceRoot",null),l=ne.getArg(i,"sourcesContent",null),u=ne.getArg(i,"mappings"),h=ne.getArg(i,"file",null),d=ne.getArg(i,"x_google_ignoreList",null);if(s!=n._version)throw new Error("Unsupported version: "+s);return n._sourceLookupCache=new Map,n._names=l0.fromArray(a.map(String),!0),n._sources=l0.fromArray(o,!0),n._absoluteSources=l0.fromArray(n._sources.toArray().map(function(f){return ne.computeSourceURL(c,f,r)}),!0),n.sourceRoot=c,n.sourcesContent=l,n._mappings=u,n._sourceMapURL=r,n.file=h,n.x_google_ignoreList=d,n._computedColumnSpans=!1,n._mappingsPtr=0,n._wasm=null,rz().then(f=>(n._wasm=f,n))})}_findSourceIndex(t){const r=this._sourceLookupCache.get(t);if(typeof r=="number")return r;const n=ne.computeSourceURL(null,t,this._sourceMapURL);if(this._absoluteSources.has(n)){const s=this._absoluteSources.indexOf(n);return this._sourceLookupCache.set(t,s),s}const i=ne.computeSourceURL(this.sourceRoot,t,this._sourceMapURL);if(this._absoluteSources.has(i)){const s=this._absoluteSources.indexOf(i);return this._sourceLookupCache.set(t,s),s}return-1}static fromSourceMap(t,r){return new mc(t.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const t=this._mappings,r=t.length,n=this._wasm.exports.allocate_mappings(r)>>>0,i=new Uint8Array(this._wasm.exports.memory.buffer,n,r);for(let o=0;o<r;o++)i[o]=t.charCodeAt(o);const s=this._wasm.exports.parse_mappings(n);if(!s){const o=this._wasm.exports.get_last_error();let a=`Error parsing mappings (code ${o}): `;switch(o){case 1:a+="the mappings contained a negative line, column, source index, or name index";break;case 2:a+="the mappings contained a number larger than 2**32";break;case 3:a+="reached EOF while in the middle of parsing a VLQ";break;case 4:a+="invalid base 64 character while parsing a VLQ";break;default:a+="unknown error code";break}throw new Error(a)}this._mappingsPtr=s}eachMapping(t,r,n){const i=r||null,s=n||yr.GENERATED_ORDER;this._wasm.withMappingCallback(o=>{o.source!==null&&(o.source=this._absoluteSources.at(o.source),o.name!==null&&(o.name=this._names.at(o.name))),this._computedColumnSpans&&o.lastGeneratedColumn===null&&(o.lastGeneratedColumn=1/0),t.call(i,o)},()=>{switch(s){case yr.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case yr.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let r=ne.getArg(t,"source");const n=ne.getArg(t,"line"),i=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(n<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,n-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let n=ne.getArg(t,"bias",yr.GREATEST_LOWER_BOUND);n==null&&(n=yr.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,n)}),i&&i.generatedLine===r.generatedLine){let s=ne.getArg(i,"source",null);s!==null&&(s=this._absoluteSources.at(s));let o=ne.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:ne.getArg(i,"originalLine",null),column:ne.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,r){if(!this.sourcesContent)return null;const n=this._findSourceIndex(t);if(n>=0)return this.sourcesContent[n];if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){let r=ne.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const n={source:r,originalLine:ne.getArg(t,"line"),originalColumn:ne.getArg(t,"column")};if(n.originalLine<1)throw new Error("Line numbers must be >= 1");if(n.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=ne.getArg(t,"bias",yr.GREATEST_LOWER_BOUND);i==null&&(i=yr.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),n.source,n.originalLine-1,n.originalColumn,i)}),s&&s.source===n.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:ne.getArg(s,"generatedLine",null),column:ne.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}mc.prototype.consumer=yr;class nz extends yr{constructor(t,r){return super(u0).then(n=>{let i=t;typeof t=="string"&&(i=ne.parseSourceMapInput(t));const s=ne.getArg(i,"version"),o=ne.getArg(i,"sections");if(s!=n._version)throw new Error("Unsupported version: "+s);let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=ne.getArg(c,"offset"),u=ne.getArg(l,"line"),h=ne.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new yr(ne.getArg(c,"map"),r).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(n._sections=c,n))})}get sources(){const t=[];for(let r=0;r<this._sections.length;r++)for(let n=0;n<this._sections[r].consumer.sources.length;n++)t.push(this._sections[r].consumer.sources[n]);return t}originalPositionFor(t){const r={generatedLine:ne.getArg(t,"line"),generatedColumn:ne.getArg(t,"column")},n=tz.search(r,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-(o.generatedOffset.generatedColumn-1)}),i=this._sections[n];return i?i.consumer.originalPositionFor({line:r.generatedLine-(i.generatedOffset.generatedLine-1),column:r.generatedColumn-(i.generatedOffset.generatedLine===r.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,r){for(let n=0;n<this._sections.length;n++){const s=this._sections[n].consumer.sourceContentFor(t,!0);if(s)return s}if(r)return null;throw new Error('"'+t+'" is not in the SourceMap.')}_findSectionIndex(t){for(let r=0;r<this._sections.length;r++){const{consumer:n}=this._sections[r];if(n._findSourceIndex(t)!==-1)return r}return-1}generatedPositionFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null,s=n&&n.consumer.generatedPositionFor(t);if(s&&s.line!==null){const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(t){const r=this._findSectionIndex(ne.getArg(t,"source")),n=r>=0?this._sections[r]:null,i=r>=0&&r+1<this._sections.length?this._sections[r+1]:null;return n?n.consumer.allGeneratedPositionsFor(t).map(s=>{const o=n.generatedOffset.generatedLine-1,a=n.generatedOffset.generatedColumn-1;return s.line===1&&(s.column+=a,typeof s.lastColumn=="number"&&(s.lastColumn+=a)),s.lastColumn===1/0&&i&&s.line===i.generatedOffset.generatedLine&&(s.lastColumn=i.generatedOffset.generatedColumn-2),s.line+=o,s}):[]}eachMapping(t,r,n){this._sections.forEach((i,s)=>{const o=s+1<this._sections.length?this._sections[s+1]:null,{generatedOffset:a}=i,c=a.generatedLine-1,l=a.generatedColumn-1;i.consumer.eachMapping(function(u){u.generatedLine===1&&(u.generatedColumn+=l,typeof u.lastGeneratedColumn=="number"&&(u.lastGeneratedColumn+=l)),u.lastGeneratedColumn===1/0&&o&&u.generatedLine===o.generatedOffset.generatedLine&&(u.lastGeneratedColumn=o.generatedOffset.generatedColumn-2),u.generatedLine+=c,t.call(this,u)},r,n)})}computeColumnSpans(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.computeColumnSpans()}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function iz(e,t){let r=e;typeof e=="string"&&(r=ne.parseSourceMapInput(e));const n=r.sections!=null?new nz(r,t):new mc(r,t);return Promise.resolve(n)}function sz(e,t){return mc.fromSourceMap(e,t)}var wx={};const oz=Gk.SourceMapGenerator,ju=hn,az=/(\r?\n)/,cz=10,qo="$$$isSourceNode$$$";let lz=class j0{constructor(t,r,n,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=r??null,this.source=n??null,this.name=s??null,this[qo]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,r,n){const i=new j0,s=t.split(az);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return r.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),r.sources.forEach(function(f){const p=r.sourceContentFor(f);p!=null&&(n!=null&&(f=ju.join(n,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=n?ju.join(n,f.source):f.source;i.add(new j0(f.originalLine,f.originalColumn,m,p,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(r){this.add(r)},this);else if(t[qo]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let r=t.length-1;r>=0;r--)this.prepend(t[r]);else if(t[qo]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let r;for(let n=0,i=this.children.length;n<i;n++)r=this.children[n],r[qo]?r.walk(t):r!==""&&t(r,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let r,n;const i=this.children.length;if(i>0){for(r=[],n=0;n<i-1;n++)r.push(this.children[n]),r.push(t);r.push(this.children[n]),this.children=r}return this}replaceRight(t,r){const n=this.children[this.children.length-1];return n[qo]?n.replaceRight(t,r):typeof n=="string"?this.children[this.children.length-1]=n.replace(t,r):this.children.push("".replace(t,r)),this}setSourceContent(t,r){this.sourceContents[ju.toSetString(t)]=r}walkSourceContents(t){for(let n=0,i=this.children.length;n<i;n++)this.children[n][qo]&&this.children[n].walkSourceContents(t);const r=Object.keys(this.sourceContents);for(let n=0,i=r.length;n<i;n++)t(ju.fromSetString(r[n]),this.sourceContents[r[n]])}toString(){let t="";return this.walk(function(r){t+=r}),t}toStringWithSourceMap(t){const r={code:"",line:1,column:0},n=new oz(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){r.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&n.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:r.line,column:r.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(n.addMapping({generated:{line:r.line,column:r.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===cz?(r.line++,r.column=0,h+1===d?(s=null,i=!1):i&&n.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:r.line,column:r.column},name:u.name})):r.column++}),this.walkSourceContents(function(l,u){n.setSourceContent(l,u)}),{code:r.code,map:n}}};wx.SourceNode=lz;var uz=wx.SourceNode;let vx=0;const Ex=ni,fz=["Command","lines"];class hz extends ZP{constructor(){super(jE,{traceInitPerf:ni,skipValidations:!ni,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});At(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));At(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(wu)}])}));At(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));At(this,"inline_go",this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline_try",this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline_command",this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))}));At(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])}));At(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(sp)}));At(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(ip)}));At(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(lw)}])}));At(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(uw)}));At(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(fw),this.CONSUME(hw)}));At(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Fo),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));At(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));At(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(hp),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));At(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(RE),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));At(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(dp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));At(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(wu)),this.CONSUME4(Fo),this.CONSUME4(pp)}}])}));At(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Fo),this.CONSUME(pp)}}])}));At(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Eu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));At(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Fo),this.CONSUME(mp),this.CONSUME(dp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));At(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Fo),this.CONSUME(mp),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));At(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(ME),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(UE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(PE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(FE),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));At(this,"command_break",this.RULED("command_break",()=>{this.CONSUME($E)}));At(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(BE)}));At(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(NE)}));At(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(CE)}));At(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(LE)}));At(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(ap),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})}));At(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(lp),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})}));At(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(cp),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));At(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})}));At(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(_E)},{ALT:()=>this.CONSUME(bE)},{ALT:()=>this.CONSUME(wE)},{ALT:()=>this.CONSUME(vE)},{ALT:()=>this.CONSUME(EE)},{ALT:()=>this.CONSUME(kE)}])}));At(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(ap),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})}));At(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(lp),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})}));At(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(cp),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));At(this,"arith_expr",this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])}));At(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(up)},{ALT:()=>this.CONSUME(fp)}]),this.SUBRULE(this.term)}));At(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));At(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(AE)},{ALT:()=>this.CONSUME(hp)},{ALT:()=>this.CONSUME(TE)},{ALT:()=>this.CONSUME(SE)}]),this.SUBRULE(this.factor)}));At(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(up)},{ALT:()=>this.CONSUME(fp)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])}));At(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(xE),this.SUBRULE(this.factor)})}));At(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));At(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));At(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(dw)},{ALT:()=>this.CONSUME(pw)}])}));At(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(mw)},{ALT:()=>this.CONSUME(gw)},{ALT:()=>this.CONSUME(yw)},{ALT:()=>this.CONSUME(_w)},{ALT:()=>this.CONSUME(bw)},{ALT:()=>this.CONSUME(ww)},{ALT:()=>this.CONSUME(vw)},{ALT:()=>this.CONSUME(Ew)},{ALT:()=>this.CONSUME(kw)}])}));At(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(xw)},{ALT:()=>this.CONSUME(Aw)},{ALT:()=>this.CONSUME(Tw)},{ALT:()=>this.CONSUME(Sw)},{ALT:()=>this.CONSUME(Rw)},{ALT:()=>this.CONSUME(Ow)},{ALT:()=>this.CONSUME(Iw)},{ALT:()=>this.CONSUME(Nw)},{ALT:()=>this.CONSUME(Cw)},{ALT:()=>this.CONSUME(Lw)},{ALT:()=>this.CONSUME(Mw)},{ALT:()=>this.CONSUME(Uw)},{ALT:()=>this.CONSUME(Pw)},{ALT:()=>this.CONSUME(Fw)},{ALT:()=>this.CONSUME($w)},{ALT:()=>this.CONSUME(Bw)},{ALT:()=>this.CONSUME(Dw)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(zw)},{ALT:()=>this.CONSUME(Ww)},{ALT:()=>this.CONSUME(Hw)},{ALT:()=>this.CONSUME(Gw)},{ALT:()=>this.CONSUME(Kw)},{ALT:()=>this.CONSUME(Yw)},{ALT:()=>this.CONSUME(qw)},{ALT:()=>this.CONSUME(Vw)},{ALT:()=>this.CONSUME(Xw)},{ALT:()=>this.CONSUME(Jw)},{ALT:()=>this.CONSUME(Zw)},{ALT:()=>this.CONSUME(Qw)},{ALT:()=>this.CONSUME(tv)},{ALT:()=>this.CONSUME(ev)},{ALT:()=>this.CONSUME(rv)},{ALT:()=>this.CONSUME(nv)},{ALT:()=>this.CONSUME(iv)},{ALT:()=>this.CONSUME(sv)},{ALT:()=>this.CONSUME(ov)},{ALT:()=>this.CONSUME(av)},{ALT:()=>this.CONSUME(cv)},{ALT:()=>this.CONSUME(lv)},{ALT:()=>this.CONSUME(uv)},{ALT:()=>this.CONSUME(fv)},{ALT:()=>this.CONSUME(hv)},{ALT:()=>this.CONSUME(dv)},{ALT:()=>this.CONSUME(pv)},{ALT:()=>this.CONSUME(mv)},{ALT:()=>this.CONSUME(gv)}])}));At(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Ov)},{ALT:()=>this.CONSUME(Iv)},{ALT:()=>this.CONSUME(Nv)},{ALT:()=>this.CONSUME(Cv)},{ALT:()=>this.CONSUME(Jv)},{ALT:()=>this.CONSUME(Zv)}])}));At(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(yv)},{ALT:()=>this.CONSUME(_v)},{ALT:()=>this.CONSUME(bv)},{ALT:()=>this.CONSUME(wv)},{ALT:()=>this.CONSUME(vv)},{ALT:()=>{this.CONSUME(Ev),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(kv),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(Lv),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(Mv),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(xv)},{ALT:()=>this.CONSUME(Av)},{ALT:()=>this.CONSUME(Tv)},{ALT:()=>this.CONSUME(Sv)},{ALT:()=>this.CONSUME(Rv)},{ALT:()=>{this.CONSUME(Uv),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(Pv),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(Fv),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME($v)},{ALT:()=>this.CONSUME(Bv)},{ALT:()=>this.CONSUME(Dv)},{ALT:()=>this.CONSUME(jv)},{ALT:()=>this.CONSUME(zv)},{ALT:()=>this.CONSUME(Wv)},{ALT:()=>this.CONSUME(Hv)},{ALT:()=>this.CONSUME(Gv)},{ALT:()=>this.CONSUME(Kv)},{ALT:()=>this.CONSUME(Yv)},{ALT:()=>this.CONSUME(qv)},{ALT:()=>this.CONSUME(Vv)},{ALT:()=>this.CONSUME(Xv)}])}));At(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));At(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(rE),this.SUBRULE(this.expr_any)}));At(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(nE),this.SUBRULE(this.expr_any)}));At(this,"token_expr_blocked",this.RULED("token_expr_blocked",()=>{this.CONSUME(eE),this.SUBRULE(this.dir)}));At(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(iE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(sE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(oE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(aE),this.SUBRULE(this.simple_token)}));At(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(cE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));At(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(lE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(uE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(fE),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(hE),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));At(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(dE),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));At(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(pE),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));At(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(mE),this.SUBRULE(this.string_token)}));At(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(gE),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));At(this,"token_expr",this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(Qv)},{ALT:()=>this.CONSUME(tE)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])}));At(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(vu)}])}));At(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(vu)}])}));At(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));At(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(sp)},{ALT:()=>this.CONSUME(vu)},{ALT:()=>this.CONSUME(qe)},{ALT:()=>this.CONSUME(op)},{ALT:()=>this.CONSUME(yE)},{ALT:()=>{this.CONSUME(OE),this.SUBRULE(this.expr),this.CONSUME(IE)}}])}));this.performSelfAnalysis()}PEEK(r,n,...i){console.info(r,i.map(s=>[s.image,s.tokenType]),n)}RULED(r,n,i){const s=fz.some(o=>r.includes(o));return this.RULE(r,()=>{const a=(vx++).toString().padStart(3),c=s?"font-weight: bold;":"";if(Ex&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${r} ${l.join(" ")}`,c)}n(),Ex&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${r} `,c),vx--},i)}}const Vo=new hz;if(NI){const e=Vo.getGAstProductions(),t=uF(e);console.info(t)}const dz=Vo.getBaseCstVisitorConstructor();var xt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(xt||{}),Ys=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Ys||{}),gi=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(gi||{}),zu=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(zu||{});function Me(e,t){const[r]=e??[];return((r==null?void 0:r.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class pz extends dz{constructor(){super();At(this,"unique",0);ni&&this.validateVisitor()}visit(r){if(pe(r)&&(r=r[0]),!!w(r))return this[r.name](r.children,r.location)}createcodenode(r,n){return[{...n,...r,lineindex:0}]}createstringnode(r,n){return this.createcodenode(r,{type:12,literal:1,value:n})}createtemplatenode(r,n){return this.createcodenode(r,{type:12,literal:2,value:n})}createmarknode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:3,id:n,comment:i}))}creategotonode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:4,id:n,comment:i}))}createlinenode(r,n){return this.createcodenode(r,{type:2,stmts:n})}createapinode(r,n,i){return this.createlinenode(r,this.createcodenode(r,{type:1,words:i,method:n}))}createlogicnode(r,n,i,s){return this.createlinenode(r,this.createcodenode(r,{type:14,skip:i,words:s,method:n}))}createcountnode(r){return this.createcodenode(r,{type:5,index:this.unique++})}createexprnodeondemand(r,n){return r.length===1?r[0]:this.createcodenode(n,{type:31,words:r})[0]}go(r){return Array.isArray(r)?r.map(n=>this.visit(n)).flat():w(r)?[this.visit(r)].flat():[]}program(r,n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(r.line)].flat()})}line(r){return r.stmt?this.go(r.stmt):[]}stmt(r){return r.stmt_label?this.go(r.stmt_label):r.stmt_stat?this.go(r.stmt_stat):r.stmt_text?this.go(r.stmt_text):r.stmt_comment?this.go(r.stmt_comment):r.stmt_hyperlink?this.go(r.stmt_hyperlink):r.stmt_command?this.go(r.stmt_command):r.short_go?this.go(r.short_go):r.short_try?this.go(r.short_try):[]}inline_go(r){const n=[];return r.short_go&&n.push(...this.go(r.short_go)),r.inline&&n.push(...this.go(r.inline)),n}inline_try(r){const n=[];return r.short_try&&n.push(...this.go(r.short_try)),r.inline&&n.push(...this.go(r.inline)),n}inline_command(r){const n=[];return r.stmt_command&&n.push(...this.go(r.stmt_command)),r.inline&&n.push(...this.go(r.inline)),n}inline(r){const n=[];return r.stmt_stat&&n.push(...this.go(r.stmt_stat)),r.stmt_text&&n.push(...this.go(r.stmt_text)),r.stmt_comment&&n.push(...this.go(r.stmt_comment)),r.stmt_hyperlink&&n.push(...this.go(r.stmt_hyperlink)),r.inline_go&&n.push(...this.go(r.inline_go)),r.inline_try&&n.push(...this.go(r.inline_try)),r.inline_command&&n.push(...this.go(r.inline_command)),r.structured_cmd&&n.push(...this.go(r.structured_cmd)),n}stmt_label(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Me(r.token_label,":").slice(1).trim()}))}stmt_stat(r,n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Me(r.token_stat,"@").slice(1)}))}stmt_text(r,n){const i=Me(r.token_text,"");return this.createlinenode(n,this.createcodenode(n,{type:6,value:i}))}stmt_comment(r,n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Me(r.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(r,n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:Me(r.token_hyperlink,"!").slice(1),text:Me(r.token_hyperlinktext,";").slice(1)}))}stmt_command(r,n){return r.structured_cmd?this.go(r.structured_cmd):this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))}structured_cmd(r){return r.command_if?this.go(r.command_if):r.command_while?this.go(r.command_while):r.command_repeat?this.go(r.command_repeat):r.command_waitfor?this.go(r.command_waitfor):r.command_foreach?this.go(r.command_foreach):r.command_break?this.go(r.command_break):r.command_continue?this.go(r.command_continue):[]}short_go(r,n){return r.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}short_try(r,n){return r.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:[this.go(r.string_token),this.go(r.dir)].flat()})):[]}command_if(r,n){const[i]=this.createlogicnode(n,Me(r.token_if,"if").toLowerCase(),"",this.go(r.words)),[s]=this.go(r.command_if_block)??[];return this.createcodenode(n,{type:13,check:i,block:s})}command_if_block(r,n){const i=We(),s=We();return this.createcodenode(n,{type:15,skip:i,done:s,lines:[this.go(r.inline),this.go(r.line),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"alt logic")].flat(),altlines:[this.go(r.command_else_if),this.go(r.command_else),this.createmarknode(n,s,"end of if")].flat()})}command_block(r){return[this.go(r.inline),this.go(r.line)].flat()}command_fork(r){return[this.go(r.inline),this.go(r.line)].flat()}command_else_if(r,n){const i=We(),s=We();return this.createcodenode(n,{type:16,done:s,lines:[this.createlogicnode(n,Me(r.token_if,"if"),i,this.go(r.words)),this.go(r.command_fork),this.creategotonode(n,s,"end of if"),this.createmarknode(n,i,"skip")].flat()})}command_else(r,n){const i=[];return r.words&&i.push(...this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(r.words)}))),r.command_fork&&i.push(...this.go(r.command_fork)),this.createcodenode(n,{type:17,lines:i})}command_while(r,n){const i=We(),s=We();return this.createcodenode(n,{type:18,loop:i,done:s,lines:[this.createmarknode(n,i,"start of while"),this.createlogicnode(n,"if",s,this.go(r.words)),this.go(r.command_block),this.creategotonode(n,i,"loop of while"),this.createmarknode(n,s,"end of while")].flat()})}command_repeat(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:21,loop:i,done:s,lines:[this.createapinode(n,"repeatstart",a),this.createmarknode(n,i,"start of repeat"),this.createlogicnode(n,"repeat",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of repeat"),this.createmarknode(n,s,"end of repeat")].flat()})}command_foreach(r,n){const i=We(),s=We(),a=[this.createcountnode(n),this.go(r.words)].flat();return this.createcodenode(n,{type:23,loop:i,done:s,lines:[this.createapinode(n,"foreachstart",a),this.createmarknode(n,i,"start of foreach"),this.createlogicnode(n,"foreach",s,a),this.go(r.command_block),this.creategotonode(n,i,"loop of foreach"),this.createmarknode(n,s,"end of foreach")].flat()})}command_waitfor(r,n){const i=We();return this.createcodenode(n,{type:22,loop:i,lines:[this.createmarknode(n,i,"start of waitfor"),this.createlogicnode(n,"waitfor",i,this.go(r.words))].flat()})}command_break(r,n){return this.createcodenode(n,{type:19,goto:0})}command_continue(r,n){return this.createcodenode(n,{type:20,goto:0})}command_play(r,n){const i=Me(r.token_command_play,"").trim(),[s,...o]=i.split(" ");return[this.createstringnode(n,s),this.createstringnode(n,o.join(" "))].flat()}command_toast(r,n){const s=Me(r.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(n,"toast"),this.createtemplatenode(n,s)].flat()}command_ticker(r,n){const s=Me(r.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(n,"ticker"),this.createtemplatenode(n,s)].flat()}expr(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test(r,n){return r.comparison?this.go(r.comparison):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}comparison(r,n){if(r.RHS){const[i]=this.go(r.comp_op);return this.createcodenode(n,{type:27,compare:i,lhs:this.createexprnodeondemand(this.go(r.LHS),n),rhs:this.createexprnodeondemand(this.go(r.RHS),n)})}return this.go(r.LHS)}comp_op(r,n){return r.token_iseq?this.createcodenode(n,{type:28,method:0}):r.token_isnoteq?this.createcodenode(n,{type:28,method:1}):r.token_islessthan?this.createcodenode(n,{type:28,method:2}):r.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):r.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):r.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(r,n){return r.RHS?this.createcodenode(n,{type:24,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}and_test_value(r,n){return r.RHS?this.createcodenode(n,{type:25,items:[this.createexprnodeondemand(this.go(r.LHS),n),this.createexprnodeondemand(this.go(r.RHS),n)]}):this.go(r.LHS)}not_test_value(r,n){return r.arith_expr?this.go(r.arith_expr):r.LHS?this.createcodenode(n,{type:26,items:this.go(r.LHS)}):[]}arith_expr(r,n){if(r.LHS)return this.go(r.LHS);const i=this.go(r.term);return r.RHS?this.createcodenode(n,{type:29,lhs:i[0],items:this.go(r.RHS)}):i}arith_expr_item(r,n){return this.createcodenode(n,{type:30,operator:r.token_plus?1:2,rhs:this.go(r.term)[0]})}term(r,n){return r.term_item?this.createcodenode(n,{type:29,lhs:this.go(r.factor)[0],items:this.go(r.term_item)}):this.go(r.factor)}term_item(r,n){let i=0;return r.token_multiply&&(i=4),r.token_divide&&(i=5),r.token_moddivide&&(i=6),r.token_floordivide&&(i=7),this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.factor)[0]})}factor(r,n){if(r.power)return this.go(r.power);let i=0;return r.token_plus&&(i=8),r.token_minus&&(i=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:i,rhs:this.go(r.LHS)[0]})})}power(r,n){const i=this.go(r.token);return r.factor?this.createcodenode(n,{type:29,lhs:i[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(r.factor)[0]})}):i}words(r){return this.go(r.expr)}kind(r){return[this.go(r.color),this.go(r.string_token)].flat()}category(r,n){return r.token_isterrain?this.createcodenode(n,{type:12,literal:1,value:"isterrain"}):r.token_isobject?this.createcodenode(n,{type:12,literal:1,value:"isobject"}):[]}collision(r,n){return r.token_iswalkable?this.createcodenode(n,{type:12,literal:1,value:"iswalkable"}):r.token_iswalking?this.createcodenode(n,{type:12,literal:1,value:"iswalking"}):r.token_iswalk?this.createcodenode(n,{type:12,literal:1,value:"iswalk"}):r.token_isswimmable?this.createcodenode(n,{type:12,literal:1,value:"isswimmable"}):r.token_isswimming?this.createcodenode(n,{type:12,literal:1,value:"isswimming"}):r.token_isswim?this.createcodenode(n,{type:12,literal:1,value:"isswim"}):r.token_issolid?this.createcodenode(n,{type:12,literal:1,value:"issolid"}):r.token_isbullet?this.createcodenode(n,{type:12,literal:1,value:"isbullet"}):r.token_isghost?this.createcodenode(n,{type:12,literal:1,value:"isghost"}):[]}color(r,n){let i="ERROR";return r.token_black&&(i="black"),r.token_dkblue&&(i="dkblue"),r.token_dkgreen&&(i="dkgreen"),r.token_dkcyan&&(i="dkcyan"),r.token_dkred&&(i="dkred"),r.token_dkpurple&&(i="dkpurple"),r.token_dkyellow&&(i="dkyellow"),r.token_ltgray&&(i="ltgray"),r.token_dkgray&&(i="dkgray"),r.token_blue&&(i="blue"),r.token_green&&(i="green"),r.token_cyan&&(i="cyan"),r.token_red&&(i="red"),r.token_purple&&(i="purple"),r.token_yellow&&(i="yellow"),r.token_white&&(i="white"),r.token_brown&&(i="brown"),r.token_dkwhite&&(i="dkwhite"),r.token_ltgrey&&(i="ltgrey"),r.token_gray&&(i="gray"),r.token_grey&&(i="grey"),r.token_dkgrey&&(i="dkgrey"),r.token_ltblack&&(i="ltblack"),r.token_onblack&&(i="onblack"),r.token_ondkblue&&(i="ondkblue"),r.token_ondkgreen&&(i="ondkgreen"),r.token_ondkcyan&&(i="ondkcyan"),r.token_ondkred&&(i="ondkred"),r.token_ondkpurple&&(i="ondkpurple"),r.token_ondkyellow&&(i="ondkyellow"),r.token_onltgray&&(i="onltgray"),r.token_ondkgray&&(i="ondkgray"),r.token_onblue&&(i="onblue"),r.token_ongreen&&(i="ongreen"),r.token_oncyan&&(i="oncyan"),r.token_onred&&(i="onred"),r.token_onpurple&&(i="onpurple"),r.token_onyellow&&(i="onyellow"),r.token_onwhite&&(i="onwhite"),r.token_onbrown&&(i="onbrown"),r.token_ondkwhite&&(i="ondkwhite"),r.token_onltgrey&&(i="onltgrey"),r.token_ongray&&(i="ongray"),r.token_ongrey&&(i="ongrey"),r.token_ondkgrey&&(i="ondkgrey"),r.token_onltblack&&(i="onltblack"),r.token_onclear&&(i="onclear"),this.createcodenode(n,{type:12,literal:1,value:i})}dir_mod(r,n){let i="ERROR";return r.token_cw&&(i="cw"),r.token_ccw&&(i="ccw"),r.token_opp&&(i="opp"),r.token_rndp&&(i="rndp"),r.token_over&&(i="over"),r.token_under&&(i="under"),this.createcodenode(n,{type:12,literal:1,value:i})}dir(r,n){const i=this.go(r.dir_mod)??[];return r.token_i&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"i"})),r.token_idle&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"idle"})),r.token_n&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"n"})),r.token_u&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"u"})),r.token_north&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"north"})),r.token_up&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"up"})),r.token_s&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"s"})),r.token_d&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"d"})),r.token_south&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"south"})),r.token_down&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"down"})),r.token_w&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"w"})),r.token_l&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"l"})),r.token_west&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"west"})),r.token_left&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"left"})),r.token_e&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"e"})),r.token_r&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"r"})),r.token_east&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"east"})),r.token_right&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"right"})),r.token_rnd&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rnd"})),r.token_rndne&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndne"})),r.token_rndns&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"rndns"})),r.token_flow&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flow"})),r.token_seek&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"seek"})),r.token_by&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"by"}),...this.go(r.simple_token)),r.token_at&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"at"}),...this.go(r.simple_token)),r.token_away&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"away"}),...this.go(r.simple_token)),r.token_toward&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"toward"}),...this.go(r.simple_token)),r.token_find&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"find"}),...this.go(r.kind)),r.token_flee&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"flee"}),...this.go(r.kind)),r.token_to&&i.push(...this.createcodenode(n,{type:12,literal:1,value:"to"}),...this.go(r.dir)),i.flat()}expr_any(r){return[this.go(r.dir),this.go(r.kind),this.go(r.color)].flat()}token_expr_any(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"any"}),this.go(r.expr_any)].flat()}token_expr_count(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"countof"}),this.go(r.expr_any)].flat()}token_expr_blocked(r,n){return[this.createcodenode(n,{type:12,literal:1,value:"blocked"}),this.go(r.dir)].flat()}token_expr_abs(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"abs"}),...this.go(r.simple_token)]}token_expr_intceil(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intceil"}),...this.go(r.simple_token)]}token_expr_intfloor(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intfloor"}),...this.go(r.simple_token)]}token_expr_intround(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"intround"}),...this.go(r.simple_token)]}token_expr_clamp(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"clamp"}),...this.go(r.simple_token)]}token_expr_min(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"min"}),...this.go(r.simple_tokens)]}token_expr_max(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"max"}),...this.go(r.simple_tokens)]}token_expr_pick(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pick"}),...this.go(r.simple_tokens)]}token_expr_pickwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"pickwith"}),...this.go(r.simple_tokens)]}token_expr_random(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"random"}),...this.go(r.simple_token)]}token_expr_randomwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"randomwith"}),...this.go(r.simple_token)]}token_expr_run(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"run"}),...this.go(r.string_token)]}token_expr_runwith(r,n){return[...this.createcodenode(n,{type:12,literal:1,value:"runwith"}),...this.go(r.simple_token),...this.go(r.string_token)]}token_expr(r,n){return r.token_expr_aligned?this.createcodenode(n,{type:12,literal:1,value:"aligned"}):r.token_contact?this.createcodenode(n,{type:12,literal:1,value:"contact"}):r.token_expr_any?this.go(r.token_expr_any):r.token_expr_count?this.go(r.token_expr_count):r.token_expr_blocked?this.go(r.token_expr_blocked):r.token_expr_abs?this.go(r.token_expr_abs):r.token_expr_intceil?this.go(r.token_expr_intceil):r.token_expr_intfloor?this.go(r.token_expr_intfloor):r.token_expr_intround?this.go(r.token_expr_intround):r.token_expr_clamp?this.go(r.token_expr_clamp):r.token_expr_min?this.go(r.token_expr_min):r.token_expr_max?this.go(r.token_expr_max):r.token_expr_pick?this.go(r.token_expr_pick):r.token_expr_pickwith?this.go(r.token_expr_pickwith):r.token_expr_random?this.go(r.token_expr_random):r.token_expr_randomwith?this.go(r.token_expr_randomwith):r.token_expr_run?this.go(r.token_expr_run):r.token_expr_runwith?this.go(r.token_expr_runwith):[]}string_token(r,n){if(r.token_stringliteraldouble){const i=Me(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Me(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}simple_token(r,n){if(r.token_stringliteraldouble){const i=Me(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Me(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Me(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}simple_tokens(r,n){if(r.token_stringliteraldouble){const i=Me(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Me(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Me(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}return[]}token(r,n){if(r.category)return this.go(r.category);if(r.collision)return this.go(r.collision);if(r.color)return this.go(r.color);if(r.dir)return this.go(r.dir);if(r.command_play)return this.go(r.command_play);if(r.command_toast)return this.go(r.command_toast);if(r.command_ticker)return this.go(r.command_ticker);if(r.token_label){const i=Me(r.token_label,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_stringliteraldouble){const i=Me(r.token_stringliteraldouble,"");return this.createcodenode(n,{type:12,literal:2,value:i})}if(r.token_stringliteral){const i=Me(r.token_stringliteral,"");return this.createcodenode(n,{type:12,literal:1,value:i})}if(r.token_numberliteral){const i=parseFloat(Me(r.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:i})}if(r.token_lparen)return[this.createexprnodeondemand(this.go(r.expr),n)];if(r.token_stop){const i=Me(r.token_stop,"");return this.createcodenode(n,{type:12,literal:1,value:i})}return[]}}const mz=new pz,Qr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Wu="zss.js";function ue(e,t){return new uz(e.startLine??1,e.startColumn??1,Wu,t)}function f0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Hu(e){return`'${f0(e)}'`}function h0(e){const t=Ip(e);return t.errors.length?e:`['${t.tokens.map(n=>{if(n.tokenType===Rp){const i=f0(n.image.substring(1));return Dt(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return f0(n.image)}).join("")}'].join('')`}function gc(e){return e.filter(t=>t!==void 0).map(me)}function kx(e){return ue(e,"")}function gz(e,t){const r=[];return e.forEach(n=>{r.push(n,t)}),r.pop(),r}function cr(e,t,r){return ue(e,[`api.${t}(`,...gz(r,", "),")"])}function yz(e){if(e.type===xt.COMPARE&&e.compare.type===xt.COMPARE_ITEM)switch(e.compare.method){case Ys.IS_EQ:return cr(e,"isEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_NOT_EQ:return cr(e,"isNotEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_LESS_THAN:return cr(e,"isLessThan",[me(e.lhs),me(e.rhs)]);case Ys.IS_GREATER_THAN:return cr(e,"isGreaterThan",[me(e.lhs),me(e.rhs)]);case Ys.IS_LESS_THAN_OR_EQ:return cr(e,"isLessThanOrEq",[me(e.lhs),me(e.rhs)]);case Ys.IS_GREATER_THAN_OR_EQ:return cr(e,"isGreaterThanOrEq",[me(e.lhs),me(e.rhs)])}return ue(e,"")}function qs(e,t,r){return e.prepend(`api.${t}(`),e.add([", ",me(r),")"])}function xx(e,t,r){return e.prepend(`api.${t}(`),e.add([me(r),")"])}function _z(e,t){if(e.type===xt.OPERATOR_ITEM)switch(e.operator){case gi.PLUS:return qs(t,"opPlus",e.rhs);case gi.MINUS:return qs(t,"opMinus",e.rhs);case gi.POWER:return qs(t,"opPower",e.rhs);case gi.MULTIPLY:return qs(t,"opMultiply",e.rhs);case gi.DIVIDE:return qs(t,"opDivide",e.rhs);case gi.MOD_DIVIDE:return qs(t,"opModDivide",e.rhs);case gi.FLOOR_DIVIDE:return qs(t,"opFloorDivide",e.rhs);case gi.UNI_PLUS:return xx(t,"opUniPlus",e.rhs);case gi.UNI_MINUS:return xx(t,"opUniMinus",e.rhs)}return ue(e,"")}function bz(e){if(e.type===xt.OPERATOR){const t=e.lhs?me(e.lhs):ue(e,"");return e.items.forEach(r=>_z(r,t)),t}return ue(e,"")}function Gu(e,t){return ue(e,[cr(e,"jump",[`${t}`]),"; continue;"])}function Bi(e){return Qr.linelookup[e??""]??-1}function d0(e,t){Qr.linelookup[e]=t}function Xo(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.ELSE_IF:i.type===t&&(i.done=r);break;case xt.IF_BLOCK:case xt.IF_CHECK:i.type===t&&(i.skip=r);break;case xt.LINE:Xo(i.stmts,t,r);break}}}function Ax(e,t,r){for(let n=0;n<e.length;++n){const i=e[n];switch(i.type){case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.ELSE_IF:i.type===t&&d0(i.done,r);break;case xt.IF_BLOCK:case xt.IF_CHECK:i.type===t&&d0(i.skip,r);break;case xt.LINE:Ax(i.stmts,t,r);break}}}function me(e){var t;switch(e.type){case xt.PROGRAM:return ue(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(me).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Wu}`]);case xt.API:return ue(e,["  ",cr(e,e.method,gc(e.words)),`;
`]);case xt.LINE:return ue(e,[`case ${e.lineindex}:
`,...e.stmts.map(me).flat(),`  break;
`]);case xt.MARK:return ue(e,`  // ${e.comment}
`);case xt.GOTO:{const r=Bi(e.id);return ue(e,["  ",Gu(e,r),`
`])}case xt.COUNT:return ue(e,`${e.index}`);case xt.LITERAL:switch(e.literal){case zu.NUMBER:return ue(e,`${e.value}`);case zu.STRING:return ue(e,Hu(e.value));case zu.TEMPLATE:return ue(e,h0(e.value))}return kx(e);case xt.TEXT:return ue(e,["  ",cr(e,"text",[h0(e.value)]),`;
`]);case xt.STAT:if(Qr.isfirststat){Qr.isfirststat=!1;const r=e.value.trim().split(" ").map(Hu);return ue(e,["  ",cr(e,"stat",r),`;
`])}return ue(e,`  // skipped ${e.value}
`);case xt.LABEL:{const r=Dt(e.name),n=e.active?"label":"comment";Qr.labels[r]||(Qr.labels[r]=[]);const i=(e.active?1:-1)*e.lineindex;return Qr.labels[r].push(i),ue(e,`  // ${i} '${r}' ${n}
`)}case xt.HYPERLINK:return ue(e,["  ",cr(e,"hyperlink",[h0(e.text),...e.link.split(" ").filter(r=>r.length>0).map(Hu)]),`;
`]);case xt.MOVE:{const r=cr(e,"command",[Hu("go"),gc(e.words)].flat());return e.wait?ue(e,["  if (",r,`) { continue; };
`]):ue(e,["  ",r,`;
`])}case xt.COMMAND:return ue(e,["  if (",cr(e,"command",gc(e.words)),`) { continue; };
`]);case xt.IF:{const r=((t=e.block)==null?void 0:t.type)===xt.IF_BLOCK?e.block:void 0;if(w(r)){Xo([e.check],xt.IF_CHECK,r.skip);const n=ue(e,me(e.check));return r.lines.forEach(i=>n.add(me(i))),Ax(r.altlines,xt.ELSE_IF,Bi(r.done)),r.altlines.forEach(i=>n.add(me(i))),n}return ue(e,me(e.check))}case xt.IF_CHECK:{const r=Bi(e.skip);return r===-1?ue(e,["  ",cr(e,e.method,gc(e.words)),`;
`]):ue(e,["  if (!",cr(e,e.method,gc(e.words)),") { ",Gu(e,r),` }
`])}case xt.ELSE_IF:case xt.ELSE:{const r=ue(e,"");return e.lines.forEach(n=>r.add(me(n))),r}case xt.WHILE:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.REPEAT:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.WAITFOR:{const r=ue(e,"");return Xo(e.lines,xt.IF_CHECK,e.loop),e.lines.forEach(n=>{r.add(me(n))}),r}case xt.FOREACH:{const r=Bi(e.loop),n=Bi(e.done),i=ue(e,"");return Xo(e.lines,xt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case xt.BREAK:s.goto=n;break;case xt.CONTINUE:s.goto=r;break}i.add(me(s))}),i}case xt.BREAK:return ue(e,["  ",Gu(e,e.goto),`
`]);case xt.CONTINUE:return ue(e,["  ",Gu(e,e.goto),`
`]);case xt.OR:return cr(e,"or",e.items.map(me));case xt.AND:return cr(e,"and",e.items.map(me));case xt.NOT:return cr(e,"not",e.items.map(me));case xt.COMPARE:return yz(e);case xt.OPERATOR:return bz(e);case xt.EXPR:return cr(e,"expr",e.words.map(me));default:return console.error("<unsupported node>",e.type,e),kx(e)}}function yi(e){if(w(e))switch(e.type===xt.LINE&&++Qr.lineindex,e.lineindex=Qr.lineindex,e.type){case xt.PROGRAM:e.lines.forEach(yi);break;case xt.LINE:e.stmts.forEach(yi);break;case xt.MARK:d0(e.id,e.lineindex);break;case xt.IF:yi(e.check),yi(e.block);break;case xt.IF_BLOCK:e.lines.forEach(yi),e.altlines.forEach(yi);break;case xt.ELSE_IF:e.lines.forEach(yi);break;case xt.ELSE:case xt.WHILE:case xt.REPEAT:case xt.FOREACH:case xt.WAITFOR:e.lines.forEach(yi);break;case xt.MOVE:case xt.COMMAND:case xt.IF_CHECK:e.words.forEach(yi);break}}function wz(e){Qr.labels={},Qr.internal=1,Qr.lineindex=0,Qr.isfirststat=!0,yi(e)}function vz(e){return wz(e),{...me(e).toStringWithSourceMap({file:`${Wu}.map`}),...Qr}}function Tx(e){return pe(e)?e.length>0?1:0:e??0}function Ez(e){return`${e}_chip`}function Sx(e=""){return`vm:${e??""}`}function kz(e,t,r){var l,u;const n=Ez(e),i=In(n);let s;const o=Yn(Object.entries(r.labels??{}));(!pe(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=r.errors)==null?void 0:l.length)??0)!==0?1:0);function a(h,d){x.words=d;const f=mj(t,h);return w(f)?f(c,d):h!=="send"?a("shortsend",[h,...d]):0}const c={halt(){$z(n)},id(){return e},set(h,d){const[f,p]=yj(t,c,h,d);if(f)return p},get(h){const[d,f]=gj(t,c,h);if(d)return f},tick(h){const d=Et(i.ps)?i.ps:0,f=d%h===0;if(i.ps=d+1,f===!1)return!1;if(c.shouldtick()===!1)return Hk(t,c),!1;i.lc=0,i.ys=0,x.get=c.get,_j(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){_e(lt,x.elementfocus,"crash",p.message),i.es=1}return Hk(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Et(i.lc)?++i.lc>Rs.HALT_AT_COUNT:!0},haslabel(h){if(pe(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return(p.find(g=>Et(g)&&g>0)??0)>0}return!1},hm(){if(pe(i.mg)&&pe(i.lb)){const[h]=i.mg;if(w(h))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return p.find(m=>Et(m)&&m>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,d,f,p){lt.emit(h,`${Sx(d)}:${f}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||c.haslabel(h.target)&&(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(pe(i.lb))for(let d=0;d<i.lb.length;++d){const f=i.lb[d];if(f[0]===h){const p=f[1].findIndex(m=>m>0);if(p>=0&&w(f[1])){f[1][p]*=-1;break}}}},restore(h){if(pe(i.lb))for(let d=0;d<i.lb.length;++d){const f=i.lb[d];if(f[0]===h)for(let p=0;p<f[1].length;p++)f[1][p]=Math.abs(f[1][p])}},getcase(){i.ec=Et(i.ec)?i.ec:1;const h=c.hm();if(h&&pe(i.mg)){const[,d,f,p]=i.mg;c.set("sender",f),w(d)&&c.set("arg",d),p&&(c.set("player",p),x.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Et(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const d=bI.parse(h),[f]=d.filter(p=>p.fileName===Wu);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[d,...f]=h;return a(Dt(Ie(d)),f)},if(...h){const[d,f]=ut(h,0,[V.ANY]),p=Tx(d);return p&&f<h.length&&c.command(...h.slice(f)),p?1:0},try(...h){const[,d]=ut(h,0,[V.DIR]),f=c.command("go",...h);return f&&d<h.length&&c.command(...h.slice(d)),f?1:0},take(...h){const[d,f,p]=ut(h,0,[V.NAME,V.ANY]),m=Et(f),g=m?p:1,y=c.get(d),b=m?f:1;if(!Et(y))return g<h.length&&c.command(...h.slice(g)),1;const A=y-b;return A<0?(g<h.length&&c.command(...h.slice(g)),1):(c.set(d,A),0)},give(...h){const[d,f,p]=ut(h,0,[V.NAME,V.ANY]),m=Et(f),g=m?p:1,y=c.get(d),b=m?f:1,A=y===void 0?1:0;return A&&g<h.length&&c.command(...h.slice(g)),c.set(d,Sa(y,0)+b),A},repeatstart(h,...d){const[f,p]=ut(d,0,[V.NUMBER]),m=`repeatcount${h}`,g=`repeatwords${h}`;i[m]=f,i[g]=p<d.length?d.slice(p):void 0},repeat(h){const d=`repeatcount${h}`,f=`repeatwords${h}`;if(!Et(i[d]))return 0;const p=i[d];i[d]=p-1;const m=p>0,g=i[f];return m&&pe(g)&&c.command(...g),m?1:0},foreachstart(h,...d){const[f,p,m,g]=ut(d,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let y=Math.min(p,m),b=Math.max(p,m);const A=(g??0)||1;if(A<0){const T=y;y=b,b=T}return c.set(f,y-A),0},foreach(h,...d){const[f,p,m,g,y]=ut(d,0,[V.NAME,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let b=Math.min(p,m),A=Math.max(p,m);const T=(g??0)||1;if(T<0){const R=b;b=A,A=R}let k=c.get(f);!Et(k)||k<b||k>A?k=b:k+=T;const I=k<=A?1:0;return I&&(c.set(f,k),y<d.length&&c.command(...d.slice(y))),I},waitfor(...h){const[d]=ut(h,0,[V.ANY]),f=Tx(d);return f||c.yield(),f?1:0},or(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=ut(h,f,[V.ANY]);if(d=p,d)break;f=m}return d},and(...h){let d=0;for(let f=0;f<h.length;){const[p,m]=ut(h,f,[V.ANY]);if(d=p,!d)break;f=m}return d},not(...h){const[d]=ut(h,0,[V.ANY]);return d?0:1},expr(...h){const[d]=ut(h,0,[V.ANY]);return d},isEq(h,d){const[f]=ut([h],0,[V.ANY]),[p]=ut([d],0,[V.ANY]);return typeof f=="object"||typeof p=="object"?sT(f,p)?1:0:f===p?1:0},isNotEq(h,d){return this.isEq(h,d)?0:1},isLessThan(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f<p?1:0},isGreaterThan(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f>p?1:0},isLessThanOrEq(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f>=p?1:0},opPlus(h,d){const[f]=ut([h],0,[V.ANY]),[p]=ut([d],0,[V.ANY]);return f+p},opMinus(h,d){const[f]=ut([h],0,[V.ANY]),[p]=ut([d],0,[V.ANY]);return f-p},opPower(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return Math.pow(f,p)},opMultiply(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f*p},opDivide(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f/p},opModDivide(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return f%p},opFloorDivide(h,d){const[f]=ut([h],0,[V.NUMBER]),[p]=ut([d],0,[V.NUMBER]);return Math.floor(f/p)},opUniPlus(h){const[d]=ut([h],0,[V.NUMBER]);return+d},opUniMinus(h){const[d]=ut([h],0,[V.NUMBER]);return-d}};return s=(u=r.code)==null?void 0:u.call(r,c),c}function p0(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(r=>{if(r!=="parent"){const n=e[r];pe(n)?n.forEach(i=>{t.push(p0(i))}):t.push(p0(n))}}),e.range={start:Math.min(...t.filter(r=>r).map(r=>(r==null?void 0:r.start)??0)),end:Math.max(...t.filter(r=>r).map(r=>(r==null?void 0:r.end)??0))},e.range}function xz(e){const t=zE(`${e}
`);if(t.errors.length>0)return t;Vo.input=t.tokens;const r=Vo.program();if(Vo.errors.length>0)return{tokens:t.tokens,errors:Vo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=mz.go(r);return n?(p0(n),{tokens:t.tokens,cst:r,ast:n}):{tokens:t.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const m0=Object.getPrototypeOf(function*(){}).constructor;function Az(e,t){const r=`compile-${e}`;console.time(r);const n=xz(t);if(console.timeEnd(r),Ty&&console.info(t,n.errors),n.errors&&n.errors.length>0)return console.info(t,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=vz(n.ast);if(i.code){Ty&&console.info(i.code);try{return{...n,...i,source:i.code,code:new m0("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new m0("api"," ")}}}return{...n,...i,source:"",code:new m0("api"," ")}}function Tz(){const e={},t={};function r(i,s){const o=e[s];if(o)return o;const a=Az(i,s);return e[s]=a,a}const n={ids(){return Object.keys(t)},isended(i){const s=t[i];return w(s)?s.isended():!0},halt(i){const s=t[i];return w(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=t[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!w(t[i])){const h=r(a,c);if(l=t[i]=kz(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((T,k)=>[T,k]),m=p.slice(f-2,f);for(let T=0;T<m.length;++T){const[k,I]=m[T];_e(lt,$r(),"build",`$grey${I+1} $grey${k}`)}const[g,y]=p[f]??[];if(yt(g)&&w(y)){const T=(d.column??1)-1,k=T+d.length,I=T<g.length?g:`${g}*`,R=I.substring(0,T),$=I.substring(T,k),M=I.substring(k);_e(lt,$r(),"build",`$red${y+1} $grey${R}$red${$}$grey${M}`)}const b=p.slice(f+1,f+3);for(let T=0;T<b.length;++T){const[k,I]=b[T];_e(lt,$r(),"build",`$grey${I+1} $grey${k}`)}const A=d.message.split(`
`).slice(0,4).join(" ");return _e(lt,$r(),"build",A),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=zr(i.target),a=t[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return n}const Or=new wa,Fr={},Ku={};function Rx(e,t,r,n,i,s=0){const o=`tiles:${e}:${t}`;return w(Fr[o])||(Fr[o]=EI(e,t,r,n,i,s)),Fr[o]}function Sz(e,t,r,n){const i=`sprites:${e}:${t}:${r}`,s=`sprite:${e}:${t}:${n}`;return w(Ku[s])||(Ku[s]=kI(e,t,r)),Ku[s].id=i,Ku[s]}function Rz(e,t){const r=`sprites:${e}:${t}`;return w(Fr[r])||(Fr[r]=xI(e,t)),Fr[r]}function Oz(e,t,r,n,i=0){const s=`dither:${e}:${t}`;return w(Fr[s])||(Fr[s]=AI(e,t,r,n,i)),Fr[s]}function Yu(e,t,r,n){const i=`media:${e}:${t}`;w(Fr[i])||(Fr[i]=TI(e,t,r,n));const s=Fr[i];return s.mime=r,s.media=n,s}function Iz(e,t){const r=`control:${e}:${t}`;return w(Fr[r])||(Fr[r]=SI(e,t)),Fr[r]}const as=3;function Ox(e,t){const r=[],n=(e.x+.5)*Ts,i=(e.y+.5)*Ss,s=t.x*Ts,o=t.y*Ss,a=s-n,c=o-i;Or.x=a-as,Or.y=c-as,r.push(Or.angle()),Or.x=a+Ts+as,Or.y=c-as,r.push(Or.angle()),Or.x=a-as,Or.y=c+Ss+as,r.push(Or.angle()),Or.x=a+Ts+as,Or.y=c+Ss+as,r.push(Or.angle());const l=r.map(f=>Math.round(dy(f))),u=Math.min(...l),h=Math.max(...l);if(h-u>180){const f=l.filter(y=>y<180),p=l.filter(y=>y>180),m=Math.max(...f);return[Math.min(...p),m]}return[u,h]}function qu(e,t,r,n,i,s,o,a,c){var A;const l={x:a,y:c},u=Di(e,l);if(u===-1)return;Or.x=a-i.x,Or.y=Math.round((c-i.y)*1.333);const h=Or.length();if(h>s)return;const d=Math.round(dy(Or.angle()));let f=0;for(let T=0;T<r.length;++T){const[k,I,R]=r[T];k>I?(d>=k||d<=I)&&(f=Math.max(f,R)):d>=k&&d<=I&&(f=Math.max(f,R))}const p=s*.5;t[u]=Math.min(t[u],f+(h<p?0:(h-p)*o)),t[u]=Ge(t[u],0,1);const m=Br(e,((A=e.lookup)==null?void 0:A[u])??"");if(w(m)){const T=[...Ox(i,l),.25];n.push(T)}const g=e.terrain[u],y=Rn(g),b=(g==null?void 0:g.collision)??(y==null?void 0:y.collision);if(_c(Wt.ISBULLET,b)){const T=[...Ox(i,l),1];n.push(T)}}function g0(e,t,r,n,i,s){if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const o=[];let a=t;const c=Ct,l=te,u=s?zt.BLACK:zt.ONCLEAR,h=Rx(e,a++,"terrain",c,l,u);o.push(h);const d=a++,f=Rz(e,d);f.sprites=[],o.push(f);const p=r.isdark?1:0,m=Oz(e,a++,c,l,p);o.push(m),m.alphas.fill(p);const g=Rx(e,a++,"tickers",c,l,zt.ONCLEAR);o.push(g),g.char.fill(0);const y={...Np(Ct,te,n,zt.ONCLEAR),...g},b=Iz(e,a++);if(i){o.push(b);const{graphics:$,camera:M,facing:H}=In(e),X=r.graphics??$??"",O=r.camera??M??"",N=r.facing??H??"";if(yt(X)){const E=Dt(X);switch(E){case"fpv":case"iso":case"flat":case"mode7":b.graphics=E;break;default:b.graphics="flat";break}}if(yt(O))switch(Dt(O)){default:case"mid":b.viewscale=dl.MID;break;case"near":b.viewscale=dl.NEAR;break;case"far":b.viewscale=dl.FAR;break}Et(N)&&(b.facing=hy(N%360))}for(let $=0;$<r.terrain.length;++$){const M=r.terrain[$],H=gr(M,0,zt.WHITE,s?zt.BLACK:zt.ONCLEAR),X=Jt(M,"collision");h.char[$]=H.char,h.color[$]=H.color,h.bg[$]=H.bg,h.wall[$]=X===Wt.ISSOLID?1:0}const A=Object.values(r.objects??{}),T=new Set;for(let $=0;$<A.length;++$){const M=A[$];xr(M.id)&&Et(M.x)&&Et(M.y)&&T.add(Wr(M,Ct))}for(let $=0;$<A.length;++$){const M=A[$];if(w(M.removed))continue;const H=M.id??"";if(xr(H)===!1&&Et(M.x)&&Et(M.y)&&T.has(Wr(M,Ct))===!0)continue;const X=gr(M),O=Sz(e,d,H,$);if(O.x=M.x??0,O.y=M.y??0,O.char=X.char,O.color=X.color,O.bg=X.bg,f.sprites.push(O),p){if(X.light>0){const N=Di(r,O),E=Ge(Math.round(X.light),1,te),L=1/(E*.5);if(m.alphas[N]=0,E>1){const j=[];for(let U=1;U<=E;++U){if(U===2){const K=Jt(M,"lightdir");if(Hr(K)){const W=ef(r,M,"",K,O);switch($n(O,W.destpt)){case bt.EAST:j.push([45,315,1]);break;case bt.WEST:j.push([225,135,1]);break;case bt.NORTH:j.push([315,225,1]);break;case bt.SOUTH:j.push([135,45,1]);break}}}const q=[];for(let K=O.y-U;K<=O.y+U;++K)qu(r,m.alphas,j,q,O,E,L,O.x-U,K),qu(r,m.alphas,j,q,O,E,L,O.x+U,K);const Q=U-1;for(let K=O.x-Q;K<=O.x+Q;++K)qu(r,m.alphas,j,q,O,E,L,K,O.y-U),qu(r,m.alphas,j,q,O,E,L,K,O.y+U);for(let K=0;K<q.length;++K){const W=q[K];let P=0;for(P=0;P<j.length;++P){const st=j[P];if(st[1]>st[0]&&W[1]>=st[0]&&W[0]<=st[1]&&W[2]>=1&&st[2]>=1){j[P]=[Math.min(W[0],st[0]),Math.max(W[1],st[1]),1];break}}P===j.length&&j.push(W)}}}}else if(xr(H)){const N=Di(r,O);m.alphas[N]=0}}H===e&&(b.focusx=O.x,b.focusy=O.y,b.focusid=H)}for(let $=0;$<A.length;++$){const M=A[$];if(yt(M.tickertext)&&Et(M.tickertime)&&M.tickertext.length){const H=Ct,X=uk(M.tickertext,H,te-1),O=(X==null?void 0:X.measuredwidth)??1,N=M.x??0,E=M.y??0,L=E<te*.5;y.x=N-Math.floor(O*.5),y.y=E+(L?2:-2),y.x+O>Ct&&(y.x=Ct-O),y.x<0&&(y.x=0);const j={x:y.x,y:y.y};lk(M.tickertext,y,!0);for(let U=0;U<O;++U){const q=Wr({x:j.x+U,y:j.y},Ct);m.alphas[q]=Math.max(m.alphas[q],.666)}}}o.push(Yu(e,a++,"text/mood",p?"dark":"bright"));const k=ge(Vt.MAIN),I=Mi(k,Vt.MAIN);if(yt(I.palette)){const $=ar(k,vt.PALETTE,I.palette),M=Ce($);w(M==null?void 0:M.bits)&&o.push(Yu(e,a++,"image/palette",Array.from(M.bits)))}if(yt(I.charset)){const $=ar(k,vt.CHARSET,I.charset),M=Ce($);w(M==null?void 0:M.bits)&&o.push(Yu(e,a++,"image/charset",Array.from(M.bits)))}const R=Object.keys(r.objects).filter(xr);return o.push(Yu(e,a++,"text/players",R.join(","))),o}const dn=Tz();var Vt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(Vt||{});const Te={halt:!1,session:We(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Nz(){return Te.session}function $r(){return Te.operator}function Cz(e){Te.operator=e}function Lz(e){Te.halt=e}function Mz(){return Te.halt}function Sn(){return[...Te.books.values()]}function Uz(){const[e]=Te.books.values();return e}function Ix(){const e=Sn(),t=ge("main"),[r]=e.filter(n=>n.id!==(t==null?void 0:t.id));return r??t}function Gn(e){const t=Dt(e);return Te.books.get(e)??Sn().find(r=>r.name===t)}function Nx(e,t){w(Gn(t))&&(Te.software[e]=t)}function ge(e){return Gn(Te.software[e])}function Cx(e){const t=bp([]);return yt(e)&&(t.name=e),Vu(t),Re(lt,Te.operator,`created [book] ${t.name}`),t}function Pz(e){let t=Gn(e);return w(t)||(t=bp([]),t.name=e),Vu(t),Re(lt,Te.operator,`created [book] ${t.name}`),t}function _r(e,t){let r=w(t)?Pz(t):ge(e);return w(r)||(w(r)||(r=Uz()),w(r)||(r=Cx(t)),w(r)&&Re(lt,Te.operator,`opened [book] ${r.name} for ${e}`)),Nx(e,r.id),r}function cs(e,t,r){return vp(_r(e),r,t)}function tn(e,t){const r=ge("main"),n=bn(qE(r,e,t));if(w(n))return n;const i=Sn();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(r==null?void 0:r.id)){const a=bn(qE(o,e,t));if(w(a))return a}}}function Rn(e){if(w(e==null?void 0:e.kinddata))return e.kinddata;if(!yt(e==null?void 0:e.kind)||!e.kind)return;const t=tn(vt.OBJECT,e.kind);if(w(t))return e.kinddata=Ce(t),e.kinddata;const r=tn(vt.TERRAIN,e.kind);if(w(r))return e.kinddata=Ce(r),e.kinddata}function Jt(e,t){const r=e==null?void 0:e.kinddata,n=(r==null?void 0:r.id)??"",i=e==null?void 0:e[t];if(w(i))return i;const s=r==null?void 0:r[t];if(w(s))return s;const o=tn(vt.OBJECT,n)??tn(vt.TERRAIN,n),a=EF(o,t);if(w(a))return a;switch(t){case"group":return"";case"cycle":return cm;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"item":case"pushable":case"breakable":return 0;case"collision":return Wt.ISWALK;default:return}}function y0(e,t){const r={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},n={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=$n(r,n),s=Jt(t,"pushable");return Et(s)?s!==0:yt(s)?s.trim().split(" ").map(o=>yy(al(o))).some(o=>o===i):!1}function On(e,t,r,n){if(!w(e)||!w(t))return;const[i,s]=t,o=tn(vt.OBJECT,i);if(w(o)){const c=E0(e,r,i,n);if(w(c))return Pa(c,s),QE(e,c),Rn(c),Ep(e,c),c}const a=tn(vt.TERRAIN,i);if(w(a)){const c=n7(e,r,i);if(w(c)){Pa(c,s);const l=Wr(r,Ct);return Rn(c),Ep(e,c,l),c}}}function Fz(e,t,r){if(!w(e)||!w(t))return;const[n,i]=t,s=tn(vt.OBJECT,n);if(w(s)){const o=E0(e,r,n);return Pa(o,i),o}}function br(e){const t=tn(vt.BOARD,e);return Ce(t)}function In(e){const t=_r("main");return Mi(t,e)}function Lx(e){const t=_r("main");return AF(t,e)}function Mx(){const e=_r("main");return Mi(e,"main")}function $z(e){const t=_r("main");return JE(t,e)}function Bz(e,t){Te.books.clear(),e.forEach(n=>{Te.books.set(n.id,n),n.name==="main"&&(Te.software.main=n.id)});const r=Gn(t);if(w(r)&&(Te.software.main=r.id),!Te.software.main){const n=Te.books.values().next();n.value&&(Te.software.main=n.value.id)}}function Vu(e){return Te.books.set(e.id,e),e.id}function Dz(e){const t=Gn(e);t&&Te.books.delete(t.id)}function Ux(e){if(!yt(e)||!e)return _e(lt,e,"login",`failed for playerid ==>${e}<==`);const t=ge("main");if(!w(t))return _e(lt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);let r=Ve(e);if(w(r==null?void 0:r.objects[e]))return!0;if(!w(r)){const l=tn(vt.BOARD,"title");r=Ce(l)}if(!w(r))return _e(lt,e,"login:title","login failed to find board with 'title' stat");const n=tn(vt.OBJECT,"player");if(!w(n))return _e(lt,e,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=Et(i)?i:Math.round(Ct*.5),a=Et(s)?s:Math.round(te*.5),c=E0(r,{x:o,y:a},"player",e);return w(c==null?void 0:c.id)?(c.player=e,Ru(t,e,r.id),!0):!1}function jz(e){const t=ge("main");if(!w(t))return;const r=[];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}const n=Ve(e);for(let i=0;i<r.length;++i){const s=r[i];Ru(t,s,""),Tu(n,Br(n,s)),Yx(n,s),dn.halt(s),JE(t,s)}}function Ve(e){const t=ge("main"),r=ZE(t,e,"board"),n=tn(vt.BOARD,r);return Ce(n)}function zz(e){const t=ge("main"),r=LF(t,e),n=Ve(e),i=Br(n,e);return r&&w(i)}function Wz(e){const t=ge("main"),r=Do(t);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;xr(c)&&(Ru(t,c,i.id),w(e[c])||(e[c]=0))}}}function Px(e){dn.message(e)}function Xe(e,t,r,n){if(yt(r.id))if(yt(t.id))om(lt,e,t.id,r.id,n);else{const i=`${Wr({x:t.x??0,y:t.y??0},Ct)}`;om(lt,e,i,r.id,n)}}function Hz(e,t,r,n){const i=r.id??"";if(n.x<0){const s=br((t==null?void 0:t.exitwest)??"");w(s)&&Bo(e,i,s.id,{x:Ct-1,y:n.y})}else if(n.x>=Ct){const s=br((t==null?void 0:t.exiteast)??"");w(s)&&Bo(e,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=br((t==null?void 0:t.exitnorth)??"");w(s)&&Bo(e,i,s.id,{x:n.x,y:te-1})}else if(n.y>=te){const s=br((t==null?void 0:t.exitsouth)??"");w(s)&&Bo(e,i,s.id,{x:n.x,y:0})}}function ls(e,t,r,n){if(!w(r==null?void 0:r.id))return!1;const i=xp(t,r,n);if(w(i)){const s=xr(r.id),o=xr(r.party??r.id),a=Jt(r,"collision")===Wt.ISBULLET,c=r.kind??"";let l="";r.party&&o&&(l=r.party),s&&(l=r.id);const u=xr(i.id),h=xr(i.party??i.id),d=Jt(i,"collision")===Wt.ISBULLET,f=i.kind??"",p=o===h;let m="";if(i.party&&h&&(m=i.party),u&&(m=i.id??""),s&&f==="edge")Hz(e,t,r,n);else if(s)u?(Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,"bump")):d?(Xe(p?"":m,i,r,p?"partyshot":"shot"),Xe(l,r,i,"thud")):(Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,"touch"));else if(a)if(u)Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,p?"partyshot":"shot");else if(d)Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,"thud");else switch(Xe(p?"":m,i,r,"thud"),f){case"object":case"scroll":Xe(p?"":l,r,i,"shot");break;default:Xe(p?"":l,r,i,p?"partyshot":"shot");break}else if(u)Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,"bump");else if(d){switch(c){case"object":case"scroll":Xe(p?"":l,r,i,"shot");break;default:Xe(p?"":l,r,i,p?"partyshot":"shot");break}Xe(p?"":l,r,i,"thud")}else Xe(p?"":m,i,r,"thud"),Xe(p?"":l,r,i,"bump");if(a&&Jt(i,"breakable")){if(w(i==null?void 0:i.id)){const g=fe(t,{x:i.x??-1,y:i.y??-1});w(g)&&Ir(x.board,g,x.timestamp)}else Ue(t,{x:n.x,y:n.y});return!0}return!1}return!0}function Fx(e,t,r,n){var l;if(!w(e)||!w(t)||!w(r))return;const i={...x};x.book=e,x.board=t,x.element=r,x.elementid=r.id??"",x.elementisplayer=xr(x.elementid);const s=x.element.player??Te.operator;x.elementfocus=x.elementisplayer?x.elementid:s;const o=Jt(r,"cycle"),a=r.id??"",c=Dt(r.name??((l=r.kinddata)==null?void 0:l.name)??"");if(dn.tick(a,is.RUNTIME,o,c,n),Et(r==null?void 0:r.tickertime)&&x.timestamp-r.tickertime>Rc*5&&(r.tickertime=0,r.tickertext=""),x.elementisplayer){const u=In(x.elementid);Et(u.inputcurrent)&&(u.inputcurrent=0)}jr(i).forEach(u=>{x[u]=i[u]})}function Gz(e,t){Te.loaders.set(e,t)}function Kz(e){dn.halt(e)}function Yz(){const e=dn.ids();for(let r=0;r<e.length;++r)dn.halt(e[r]);const t=ge("main");w(t)&&(t.flags={})}function qz(e=!1){const t=ge("main");if(!w(t))return;const r=t.timestamp+1,n=Rs.HALT_AT_COUNT;Rs.HALT_AT_COUNT=n*2,Te.loaders.forEach((s,o)=>{const a={...x};x.timestamp=t.timestamp,x.book=t,x.board=void 0,x.element=void 0,x.elementid=o,x.elementisplayer=!1,x.elementfocus=$r();const c=C5(o);w(c)&&dn.arg(o,c),dn.tick(o,is.LOADER,1,"loader",s),dn.isended(o)&&(dn.halt(o),Te.loaders.delete(o)),jr(a).forEach(l=>{x[l]=a[l]})}),Rs.HALT_AT_COUNT=n,t.timestamp=r,x.timestamp=r;const i=Do(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)Rn(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];Rn(o.objects[u])}const c=IF(o,r);for(let l=0;l<c.length;++l){const{id:u,type:h,code:d,object:f}=c[l];h===vt.ERROR?dn.halt(u):(!e||xr((f==null?void 0:f.id)??""))&&Fx(t,o,f,d)}}}function Jo(e,t,r,n){const i=ge("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const l=`${Sx(c.id)}:${t}`;lt.emit("",l,r)}}}if(Ea(e)){for(let o=0;o<n.length;++o){const a=n[o],c=fe(a,e);w(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(Dt(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(jx(a,[e]));break}}}}function Vz(e){const t=In(e),r=t.playbuffer=yt(t.playbuffer)?t.playbuffer:"";r&&$x(e,r,!1)}function $x(e,t,r=!0){var o;const n=_r("main");if(!w(n))return;const i=`${e}_cli`;x.timestamp=n.timestamp,x.book=n,x.board=Ve(e),x.element=Br(x.board,e),x.elementid=((o=x.element)==null?void 0:o.id)??"",x.elementisplayer=!0,x.elementfocus=x.elementid||e;const s=Rs.HALT_AT_COUNT;if(Rs.HALT_AT_COUNT=s*8,dn.once(i,is.CLI,"cli",t),r){const a=In(e);a.playbuffer=t}Rs.HALT_AT_COUNT=s}function Xu(e){var a;const t=_r("main"),r=Ds(t,e);if(!w(t)||!w(r)||!w(x.element))return;const n={...x},i=`${e}_run`,s=Dt(x.element.name??((a=x.element.kinddata)==null?void 0:a.name)??""),o=(r==null?void 0:r.code)??"";dn.once(i,is.RUNTIME,s,o),jr(n).forEach(c=>{x[c]=n[c]})}function Xz(e,t){const r=ge("main"),n=Ve(e),i=[],s=[],o=[];if(!w(r)||!w(n))return{board:"",over:i,under:s,layers:o};const a=n.graphics??"flat",c=br(n.overboard??""),l=br(n.underboard??"");return s.push(...g0(e,0,l,t,!1,!0)),o.push(...g0(e,s.length,n,t,!0,a!=="flat")),i.push(...g0(e,s.length+o.length,c,t,!1,!1)),{board:n.id,over:i,under:s,layers:o}}function Vs(e){return pe(e)&&typeof e[0]=="string"}function Jz(e){const t=x.words[e];return yt(t)?[t,e+1]:[void 0,e]}function _0(e){const t=x.words[e];if(Vs(t))return[t,e+1];const[r,n]=ul(e),[i,s]=Jz(n);return yt(i)&&(i==="empty"||Rn({kind:i}))?[[i,r],s]:[void 0,e]}function yc(e){if(!Vs(e))return;const[t]=e;return t}function Ju(e){if(!Vs(e))return;const[,t]=e,r=w(t)?cl(t):void 0;return w(r)?r:void 0}function Bx(e){if(!Vs(e))return;const[,t]=e,r=w(t)?ll(t):void 0;return w(r)?Nh(r):void 0}function _c(e,t){const r=e??Wt.ISWALK,n=t??Wt.ISWALK;if(r===Wt.ISGHOST||n===Wt.ISGHOST)return!1;switch(r){case Wt.ISWALK:return n!==Wt.ISWALK;case Wt.ISSWIM:return n!==Wt.ISSWIM;case Wt.ISSOLID:return!0;case Wt.ISBULLET:return n!==Wt.ISWALK&&n!==Wt.ISSWIM}}function bc(e,t,r){const n=e==null?void 0:e.objects[r];if(w(n))return n;const i=wc(e,"player");return w(t)?(t.x<0&&(t.x=_n(0,Ct-1)),t.y<0&&(t.y=_n(0,te-1)),zx(t,i)):bn(...i)}function wc(e,t){var i;const r=(i=e==null?void 0:e.named)==null?void 0:i[t];return w(r)?[...r.values()].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(w):[]}function Zz(e){const t=[];for(let r=0;r<te;++r)for(let n=0;n<Ct;++n){const i={x:n,y:r},s=fe(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function b0(e,t,r,n){if(!w(e))return!1;const i=gr(e);return!(w(t)&&t!==i.name||w(r)&&r!==i.color||w(n)&&n!==i.bg)}function Zu(e,t){const r=yc(t),n=Ju(t),i=Bx(t);return wc(e,r??"").filter(s=>b0(s,r,n,i))}function Dx(e,t){const r=w(t)?cl(t):void 0,n=w(t)?ll(t):void 0,i=[];if(w(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];w(a)&&b0(a,void 0,r,n)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];b0(a,void 0,r,n)&&i.push(a)}}return i}function jx(e,t){return w(e)?t.map(r=>{var n;if(typeof r=="string"){const i=e.objects[r];if(w(i))return i;const s=wc(e,Dt(r));if(s.length)return s}else if(Ea(r)&&r.x>=0&&r.x<Ct&&r.y>=0&&r.y<te){const i=r.x+r.y*Ct,s=(n=e.lookup)==null?void 0:n[i];return w(s)?e.objects[s]:e.terrain[i]}}).flat().filter(w):[]}function zx(e,t){let r=0,n;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function Qz(e,t,r,n){if(!w(e))return;w(e.distmaps)||(e.distmaps={});const i=`${t}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=e.distmaps[i];if(!w(s)){s=new Array(Lh).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&tf(c)){const l=Wr(c,Ct);if(s[l]===-2){const u=us(e,c.x,c.y);_c(t,Jt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function Wx(e,t){return tf(e)?t[Wr(e,Ct)]:-1}function Hx(e,t,r,n,i){if(!w(e))return;const s=Qz(e,t,r,n);if(!w(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Wx(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Wx(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function t7(){return new Array(Ct*te).map(()=>{})}function Qu(e=vf){const t={terrain:t7(),objects:{},id:""};return e(t)}var w0=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(w0||{});function e7(e){return Oo(e,w0,{terrain:t=>t.map(Il),objects:t=>Object.values(t).filter(r=>!r.removed).map(Il),id:Ne,named:Ne,lookup:Ne,codepage:Ne,distmaps:Ne,overboard:Ne,underboard:Ne})}function r7(e){return Ua(e,w0,{terrain:t=>t.map(Nl),objects:t=>{const r={};for(let n=0;n<t.length;++n){const i=Nl(t[n]);w(i==null?void 0:i.id)&&(r[i.id]=i)}return r}})}function tf(e){return kh(e.x,e.y,0,Ct-1,te-1,0)}function Di(e,t){return!w(e)||!w(t==null?void 0:t.x)||!w(t==null?void 0:t.y)||t.x<0||t.x>=Ct||t.y<0||t.y>=te?-1:t.x+t.y*Ct}function fe(e,t){const r=Di(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Br(e,e.lookup[r]??"");return w(n)?n:e.terrain[r]}function Gx(e,t){const r=Br(e,t);if(w(r))return r;const n=parseFloat(t),i=rI(isNaN(n)?-1:n,Ct);return us(e,i.x,i.y)}function us(e,t,r){return(t>=0&&t<Ct)??(r>=0&&r<te)?e==null?void 0:e.terrain[t+r*Ct]:void 0}function Ue(e,t){if(!w(e)||!w(t)||!w(t.x)||!w(t.y)||t.x<0||t.x>=Ct||t.y<0||t.y>=te)return;const r=Yn(t),n=t.x+t.y*Ct;return e.terrain[n]=r,delete e.distmaps,e.terrain[n]}function v0(e,t){if(!w(e)||!w(t))return;const r=Yn(t);return r.id=r.id??We(),e.objects[r.id]=r,e.objects[r.id]}function n7(e,t,r){return Ue(e,{...t,kind:r})}function E0(e,t,r,n){return v0(e,{...t,kind:r,id:n})}function Br(e,t){if(e)return e.objects[t]}function Kx(e,t){const r=Di(e,t);if(r<0||!w(e==null?void 0:e.lookup))return;const n=Br(e,e.lookup[r]??"");if(w(n))return n}function Ir(e,t,r){return!w(t)||gr(t).name==="player"?!1:(t.id?(t.removed=r,Tu(e,t)):(Ue(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),SF(e,t)),!0)}function Yx(e,t){return w(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function i7(e,t,r){if(!w(e)||!w(t))return;const n=e.objects[r];if(w(n))return n;if(Ea(t))return zx(t,wc(e,"player"))}function ef(e,t,r,n,i){const s=bt.MID;if(!w(e)||!w(t))return{dir:n,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=$n(o,a),l=Ct-1,u=te-1;for(let h=0;h<n.length;++h){const d=yy(n[h]);switch(d){case bt.IDLE:break;case bt.NORTH:case bt.SOUTH:case bt.WEST:case bt.EAST:De(o,d);break;case bt.BY:{const[f,p]=n.slice(h+1);Et(f)&&Et(p)&&(o.x=Ge(o.x+f,0,l),o.y=Ge(o.y+p,0,u)),h+=2;break}case bt.TO:{const[f,p]=n.slice(h+1);Et(f)&&Et(p)&&(o.x=Ge(f,0,l),o.y=Ge(p,0,u)),h+=2;break}case bt.AT:{const[f,p]=n.slice(h+1);Et(f)&&Et(p)&&(o.x=Ge(f,0,l),o.y=Ge(p,0,u)),h+=2;break}case bt.FLOW:De(o,c);break;case bt.SEEK:{const f=i7(e,t,r);Ea(f)&&De(o,$n(i,f));break}case bt.RNDNS:De(o,bn(bt.NORTH,bt.SOUTH));break;case bt.RNDNE:De(o,bn(bt.NORTH,bt.EAST));break;case bt.RND:De(o,bn(bt.NORTH,bt.SOUTH,bt.WEST,bt.EAST));break;case bt.CW:case bt.CCW:case bt.OPP:case bt.RNDP:{const f=ef(e,t,r,n.slice(h+1),i);switch(o.x=i.x,o.y=i.y,d){case bt.CW:switch($n(i,f.destpt)){case bt.NORTH:De(o,bt.EAST);break;case bt.SOUTH:De(o,bt.WEST);break;case bt.EAST:De(o,bt.SOUTH);break;case bt.WEST:De(o,bt.NORTH);break}break;case bt.CCW:switch($n(i,f.destpt)){case bt.NORTH:De(o,bt.WEST);break;case bt.SOUTH:De(o,bt.EAST);break;case bt.EAST:De(o,bt.NORTH);break;case bt.WEST:De(o,bt.SOUTH);break}break;case bt.OPP:switch($n(i,f.destpt)){case bt.NORTH:De(o,bt.SOUTH);break;case bt.SOUTH:De(o,bt.NORTH);break;case bt.EAST:De(o,bt.WEST);break;case bt.WEST:De(o,bt.EAST);break}break;case bt.RNDP:switch($n(i,f.destpt)){case bt.NORTH:case bt.SOUTH:o.x+=bn(-1,1);break;case bt.WEST:case bt.EAST:o.y+=bn(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s}}case bt.FLEE:break;case bt.AWAY:{const[f,p]=n.slice(h+1);if(Et(f)&&Et(p)){const m={x:Ge(f,0,l),y:Ge(p,0,u)},g=m.x-o.x,y=m.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Jt(t,"collision"),A=Hx(e,b,o,m,!0);w(A)&&A.x!==f&&A.y!==p&&!Kx(e,A)&&(o.x=A.x,o.y=A.y)}else{const b=Oh(-g,-y);De(o,b)}}h+=2;break}case bt.FIND:break;case bt.TOWARD:{const[f,p]=n.slice(h+1);if(Et(f)&&Et(p)){const m={x:Ge(f,0,l),y:Ge(p,0,u)},g=m.x-o.x,y=m.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=Jt(t,"collision"),A=Hx(e,b,o,m,!1);w(A)&&A.x!==f&&A.y!==p&&!Kx(e,A)&&(o.x=A.x,o.y=A.y)}else{const b=Oh(g,y);De(o,b)}}h+=2;break}case bt.OVER:case bt.UNDER:{const f=ef(e,t,r,n.slice(h+1),i);return f.layer=d,f}}}return{dir:n,startpt:i,destpt:o,layer:s}}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var V=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(V||{});function wr(e,t,r){throw console.info(r,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function qx(e){var r,n;const t={x:((r=x.element)==null?void 0:r.x)??0,y:((n=x.element)==null?void 0:n.y)??0};return ef(x.board,x.element,x.elementfocus,e,t)}function ut(e,t,r){const n=x.words;x.words=e;const i=[];let s=t;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=_0(s);Vs(a)?(s=c,i.push(a)):wr("kind",a,e);break}case 0:{if(xa(e[s])===void 0){const[a,c]=Pr(s);Cr(a)?(s=c,i.push(a)):wr("color",a,e)}else{const[a,c]=ul(s);Cr(a)?(s=c,i.push(a)):wr("color",a,e)}break}case 2:{if(al(e[s])===void 0){const[a,c]=Pr(s);Hr(a)?(s=c,i.push(qx(a))):wr("direction",a,e)}else{const[a,c]=by(s);Hr(a)?(s=c,i.push(qx(a))):wr("direction",a,e)}break}case 3:{const a=x.words[s];yt(a)||wr("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Pr(s);if(yt(a)){const l=parseFloat(a);Et(l)?i.push(l):wr("number",a,e)}else Et(a)?i.push(a):wr("number",a,e);s=c;break}case 5:{const[a,c]=Pr(s);yt(a)||wr("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Pr(s);let l=a;if(yt(l)){const u=parseFloat(l);Et(u)&&(l=u)}else Et(l)||wr("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=_0(s);if(Vs(a))s=c,i.push(a);else if(xa(e[s])===void 0){const[l,u]=Pr(s);Cr(l)?(s=u,i.push(l)):wr("color",l,e)}else{const[l,u]=ul(s);Cr(l)?(s=u,i.push(l)):wr("color or kind",l,e)}break}case 8:{const[a,c]=_0(s);a!==void 0&&!Vs(a)&&wr("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=x.words[s];a!==void 0&&!yt(a)&&wr("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Pr(s);if(yt(a)){const l=parseFloat(a);Et(l)?i.push(l):wr("optional number",a,e)}else Et(a)||a===void 0?i.push(a):wr("optional number",a,e);s=c;break}case 11:{const[a,c]=Pr(s);a!==void 0&&!yt(a)&&wr("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Pr(s);let l=a;if(yt(l)){const u=parseFloat(l);Et(u)&&(l=u)}else l!==void 0&&!Et(l)&&wr("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=Pr(s);s=c,i.push(a);break}}return x.words=n,[...i,s]}const rf={},Zo={};function k0(){return{id:We(),board:"",layers:[],scroll:[],sidebar:[]}}const s7=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),o7=new Set(["tx","text"]),a7={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Vx={};let Xx=e=>{let t=Vx[e];return w(t)||(Vx[e]=t=k0()),t};function c7(e){Xx=e}function Pe(e){return Xx(e)}function x0(e){return w(rf[e])||(rf[e]=[]),rf[e]}function l7(e){const t=Pe(e);t.scrollname="",t.scroll=[]}function u7(e,t,r){Object.values(Zo).forEach(n=>{if(n[t]!==void 0){const i=Ay(e.id(),t);Et(r)&&QO(i,r),yt(r)&&tI(i,r)}})}function lr(e){const t=x0(e);return rf[e]=[],t}function Jx(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];yt(n)&&w(zF(n))?t.push(" ",n," "):t.push(n)}return t}function Nt(e,t){x0(e).push(t)}function $t(e,t,r,n,i=()=>0,s=vf){const o=[t,r,...n],a=Dt(`${o[3]}`),c={...x};function l(u,h){w(h)&&h!==i(u)&&(x.board=c.board,x.element=c.element,x.elementfocus=c.elementfocus,s(u,h))}if(s7.has(a)){const u=`${o[2]}`;Zo[t]=Zo[t]??{};const h=i(u)??a7[a];if(Zo[t][u]===void 0){const d=Ay(t,u);Et(h)&&ZO(d,h),yt(h)&&Eh(d,h),o7.has(a)?Zo[t][u]=ty(d,f=>{l(u,f)}):Zo[t][u]=eI(d,f=>{l(u,f)})}}x0(e).push(o)}c7(e=>{if(xr(e)){const t=ge(Vt.MAIN),r=Mi(t,Vt.GADGETSTORE);let n=r[e];return w(n)||(r[e]=n=k0()),n}return k0()});let Zx=0;function f7(){switch(Zx++){case 0:return zt.BLUE;case 1:return zt.BLACK;case 2:return zt.GREEN;case 3:return zt.BLACK;case 4:return zt.CYAN;case 5:return zt.BLACK;case 6:return zt.RED;case 7:return zt.BLACK;case 8:return zt.PURPLE;case 9:return zt.BLACK;case 10:return zt.YELLOW;case 11:return zt.BLACK;case 12:return zt.WHITE;default:return Zx=0,zt.BLACK}}const A0=Zs("gadgetserver",["tock"],e=>{if(!A0.session(e))return;const t=ge(Vt.MAIN),r=[...(t==null?void 0:t.activelist)??[],$r()],n=[...new Set(r.values())],i=Mi(t,Vt.GADGETSYNC);switch(e.target){case"tock":{const s=f7();for(let o=0;o<n.length;++o){const a=n[o],{board:c,over:l,under:u,layers:h}=Xz(a,s),d=Pe(a);d.board=c,d.over=l,d.under=u,d.layers=h;const f=i[a]??{},p=tm(f,d);p.length&&(i[a]=Yn(d),ET(A0,a,p))}break}case"desync":vT(A0,e.player,Pe(e.player));break;case"clearscroll":l7(e.player);break;case"clearplayer":{const s=Mi(t,Vt.GADGETSTORE);delete s[e.player];const o=Mi(t,Vt.GADGETSYNC);delete o[e.player];break}}});function nf(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qx={exports:{}};(function(e,t){(function(r){e.exports=r()})(function(){return function r(n,i,s){function o(l,u){if(!i[l]){if(!n[l]){var h=typeof nf=="function"&&nf;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};n[l][0].call(f.exports,function(p){var m=n[l][1][p];return o(m||p)},f,f.exports,r,n,i,s)}return i[l].exports}for(var a=typeof nf=="function"&&nf,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,g=[],y=0,b=c.length,A=b,T=s.getTypeOf(c)!=="string";y<c.length;)A=b-y,h=T?(l=c[y++],u=y<b?c[y++]:0,y<b?c[y++]:0):(l=c.charCodeAt(y++),u=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<A?(15&u)<<2|h>>6:64,m=2<A?63&h:64,g.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return g.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|A):new Array(0|A);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),b[g++]=l,f!==64&&(b[g++]=u),p!==64&&(b[g++]=h);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(f,p){var m,g="";for(m=0;m<p;m++)g+=String.fromCharCode(255&f),f>>>=8;return g}function o(f,p,m,g,y,b){var A,T,k=f.file,I=f.compression,R=b!==l.utf8encode,$=a.transformTo("string",b(k.name)),M=a.transformTo("string",l.utf8encode(k.name)),H=k.comment,X=a.transformTo("string",b(H)),O=a.transformTo("string",l.utf8encode(H)),N=M.length!==k.name.length,E=O.length!==H.length,L="",j="",U="",q=k.dir,Q=k.date,K={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(K.crc32=f.crc32,K.compressedSize=f.compressedSize,K.uncompressedSize=f.uncompressedSize);var W=0;p&&(W|=8),R||!N&&!E||(W|=2048);var P=0,st=0;q&&(P|=16),y==="UNIX"?(st=798,P|=function(rt,wt){var Tt=rt;return rt||(Tt=wt?16893:33204),(65535&Tt)<<16}(k.unixPermissions,q)):(st=20,P|=function(rt){return 63&(rt||0)}(k.dosPermissions)),A=Q.getUTCHours(),A<<=6,A|=Q.getUTCMinutes(),A<<=5,A|=Q.getUTCSeconds()/2,T=Q.getUTCFullYear()-1980,T<<=4,T|=Q.getUTCMonth()+1,T<<=5,T|=Q.getUTCDate(),N&&(j=s(1,1)+s(u($),4)+M,L+="up"+s(j.length,2)+j),E&&(U=s(1,1)+s(u(X),4)+O,L+="uc"+s(U.length,2)+U);var G="";return G+=`
\0`,G+=s(W,2),G+=I.magic,G+=s(A,2),G+=s(T,2),G+=s(K.crc32,4),G+=s(K.compressedSize,4),G+=s(K.uncompressedSize,4),G+=s($.length,2),G+=s(L.length,2),{fileRecord:h.LOCAL_FILE_HEADER+G+$+L,dirRecord:h.CENTRAL_FILE_HEADER+s(st,2)+G+s(X.length,2)+"\0\0\0\0"+s(P,4)+s(g,4)+$+L+X}}var a=r("../utils"),c=r("../stream/GenericWorker"),l=r("../utf8"),u=r("../crc32"),h=r("../signature");function d(f,p,m,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-g-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(g){return h.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,g=function(y,b,A,T,k){var I=a.transformTo("string",k(T));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(A,4)+s(I.length,2)+I}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},n.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(b,A){var T=b||A,k=s[T];if(!k)throw new Error(T+" is not a valid compression method !");return k}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},g=f.dir,y=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:g,date:y,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),l=r("./stream/Crc32Probe"),u=r("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(g){p(g)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}n.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var g=new c(f);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],y=m.files;if(f.checkCRC32)for(var b=0;b<y.length;b++)g.push(h(y[b]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),y=g.files,b=0;b<y.length;b++){var A=y[b],T=A.fileNameStr,k=s.resolve(A.fileNameStr);p.file(k,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(p.file(k).unsafeOriginalName=T)}return g.zipComment.length&&(p.comment=g.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof rr<"u",newBufferFrom:function(s,o){if(rr.from&&rr.from!==Uint8Array.from)return rr.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new rr(s,o)},allocBuffer:function(s){if(rr.alloc)return rr.alloc(s);var o=new rr(s);return o.fill(0),o},isBuffer:function(s){return rr.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(k,I,R){var $,M=a.getTypeOf(I),H=a.extend(R||{},u);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(k=y(k)),H.createFolders&&($=g(k))&&b.call(this,$,!0);var X=M==="string"&&H.binary===!1&&H.base64===!1;R&&R.binary!==void 0||(H.binary=!X),(I instanceof h&&I.uncompressedSize===0||H.dir||!I||I.length===0)&&(H.base64=!1,H.binary=!0,I="",H.compression="STORE",M="string");var O=null;O=I instanceof h||I instanceof c?I:p.isNode&&p.isStream(I)?new m(k,I):a.prepareContent(k,I,H.binary,H.optimizedBinaryString,H.base64);var N=new d(k,O,H);this.files[k]=N}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),l=r("./stream/StreamHelper"),u=r("./defaults"),h=r("./compressedObject"),d=r("./zipObject"),f=r("./generate"),p=r("./nodejsUtils"),m=r("./nodejs/NodejsStreamInputAdapter"),g=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var I=k.lastIndexOf("/");return 0<I?k.substring(0,I):""},y=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},b=function(k,I){return I=I!==void 0?I:u.createFolders,k=y(k),this.files[k]||s.call(this,k,null,{dir:!0,createFolders:I}),this.files[k]};function A(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var I,R,$;for(I in this.files)$=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&k(R,$)},filter:function(k){var I=[];return this.forEach(function(R,$){k(R,$)&&I.push($)}),I},file:function(k,I,R){if(arguments.length!==1)return k=this.root+k,s.call(this,k,I,R),this;if(A(k)){var $=k;return this.filter(function(H,X){return!X.dir&&$.test(H)})}var M=this.files[this.root+k];return M&&!M.dir?M:null},folder:function(k){if(!k)return this;if(A(k))return this.filter(function(M,H){return H.dir&&k.test(M)});var I=this.root+k,R=b.call(this,I),$=this.clone();return $.root=R.name,$},remove:function(k){k=this.root+k;var I=this.files[k];if(I||(k.slice(-1)!=="/"&&(k+="/"),I=this.files[k]),I&&!I.dir)delete this.files[k];else for(var R=this.filter(function(M,H){return H.name.slice(0,k.length)===k}),$=0;$<R.length;$++)delete this.files[R[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var I,R={};try{if((R=a.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var $=R.comment||this.comment||"";I=f.generateWorker(this,R,$)}catch(M){(I=new c("error")).error(M)}return new l(I,R.type||"string",R.mimeType)},generateAsync:function(k,I){return this.generateInternalStream(k).accumulate(I)},generateNodeStream:function(k,I){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(I)}};n.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),l=r("./NodeBufferReader"),u=r("./Uint8ArrayReader");n.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),l=r("../support"),u=r("../external"),h=null;if(l.nodestream)try{h=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(g,y){var b=[],A=p._internalType,T=p._outputType,k=p._mimeType;p.on("data",function(I,R){b.push(I),m&&m(R)}).on("error",function(I){b=[],y(I)}).on("end",function(){try{var I=function(R,$,M){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),M);case"base64":return c.encode($);default:return s.transformTo(R,$)}}(T,function(R,$){var M,H=0,X=null,O=0;for(M=0;M<$.length;M++)O+=$[M].length;switch(R){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(X=new Uint8Array(O),M=0;M<$.length;M++)X.set($[M],H),H+=$[M].length;return X;case"nodebuffer":return rr.concat($);default:throw new Error("concat : unsupported type '"+R+"'")}}(A,b),k);g(I)}catch(R){y(R)}b=[]}).resume()})}function f(p,m,g){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=g,s.checkSupport(y),this._worker=p.pipe(new o(y)),p.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var g=this;return p==="data"?this._worker.on(p,function(y){m.call(g,y.data,y.meta)}):this._worker.on(p,function(){s.delay(m,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof rr<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,g,y,b,A,T=p.length,k=0;for(b=0;b<T;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<T&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),k+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(k):new Array(k),b=A=0;A<k;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<T&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?m[A++]=g:(g<2048?m[A++]=192|g>>>6:(g<65536?m[A++]=224|g>>>12:(m[A++]=240|g>>>18,m[A++]=128|g>>>12&63),m[A++]=128|g>>>6&63),m[A++]=128|63&g);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,g,y,b,A=p.length,T=new Array(2*A);for(m=g=0;m<A;)if((y=p[m++])<128)T[g++]=y;else if(4<(b=l[y]))T[g++]=65533,m+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&m<A;)y=y<<6|63&p[m++],b--;1<b?T[g++]=65533:y<65536?T[g++]=y:(y-=65536,T[g++]=55296|y>>10&1023,T[g++]=56320|1023&y)}return T.length!==g&&(T.subarray?T=T.subarray(0,g):T.length=g),s.applyFromCharCode(T)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var g=function(b,A){var T;for((A=A||b.length)>b.length&&(A=b.length),T=A-1;0<=T&&(192&b[T])==128;)T--;return T<0||T===0?A:T+l[b[T]]>A?T:A}(p),y=p;g!==p.length&&(o.uint8array?(y=p.subarray(0,g),this.leftOver=p.subarray(g,p.length)):(y=p.slice(0,g),this.leftOver=p.slice(g,p.length))),this.push({data:i.utf8decode(y),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function l(m){return m}function u(m,g){for(var y=0;y<m.length;++y)g[y]=255&m.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(m,g){i.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,g,y){var b=[],A=0,T=m.length;if(T<=y)return String.fromCharCode.apply(null,m);for(;A<T;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(A,Math.min(A+y,T)))):b.push(String.fromCharCode.apply(null,m.subarray(A,Math.min(A+y,T)))),A+=y;return b.join("")},stringifyByChar:function(m){for(var g="",y=0;y<m.length;y++)g+=String.fromCharCode(m[y]);return g},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var g=65536,y=i.getTypeOf(m),b=!0;if(y==="uint8array"?b=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return h.stringifyByChunk(m,y,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(m)}function f(m,g){for(var y=0;y<m.length;y++)g[y]=m[y];return g}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,g){if(g=g||"",!m)return g;i.checkSupport(m);var y=i.getTypeOf(g);return p[y][m](g)},i.resolve=function(m){for(var g=m.split("/"),y=[],b=0;b<g.length;b++){var A=g[b];A==="."||A===""&&b!==0&&b!==g.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var g,y,b="";for(y=0;y<(m||"").length;y++)b+="\\x"+((g=m.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(m,g,y){setImmediate(function(){m.apply(y||null,g||[])})},i.inherits=function(m,g){function y(){}y.prototype=g.prototype,m.prototype=new y},i.extend=function(){var m,g,y={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&y[g]===void 0&&(y[g]=arguments[m][g]);return y},i.prepareContent=function(m,g,y,b,A){return c.Promise.resolve(g).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new c.Promise(function(k,I){var R=new FileReader;R.onload=function($){k($.target.result)},R.onerror=function($){I($.target.error)},R.readAsArrayBuffer(T)}):T}).then(function(T){var k=i.getTypeOf(T);return k?(k==="arraybuffer"?T=i.transformTo("uint8array",T):k==="string"&&(A?T=o.decode(T):y&&b!==!0&&(T=function(I){return u(I,s.uint8array?new Uint8Array(I.length):new Array(I.length))}(T))),T):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),l=r("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),l=r("./utf8"),u=r("./compressions"),h=r("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(g){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===g)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,g,y=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<y;)p=f.readInt(2),m=f.readInt(2),g=f.readData(m),this.extraFields[p]={id:p,length:m,value:g};f.setIndex(y)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},n.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(p,m,g){this.name=p,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),l=r("./compressedObject"),u=r("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,g="string";try{if(!p)throw new Error("No output type specified.");var y=(g=p.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(m=m.pipe(new c.Utf8EncodeWorker)),!b&&y&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(A){(m=new u("error")).error(A)}return new o(m,g,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,g;a=!0;for(var y=f.length;y;){for(g=f,f=[],m=-1;++m<y;)g[m]();y=f.length}a=!1}n.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof er<"u"?er:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}function d(y,b,A){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(y,b,A){s(function(){var T;try{T=b(A)}catch(k){return a.reject(y,k)}T===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,T)})}function p(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function m(y,b){var A=!1;function T(R){A||(A=!0,a.reject(y,R))}function k(R){A||(A=!0,a.resolve(y,R))}var I=g(function(){b(k,T)});I.status==="error"&&T(I.value)}function g(y,b){var A={};try{A.value=y(b),A.status="success"}catch(T){A.status="error",A.value=T}return A}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(A){return b.resolve(y()).then(function(){return A})},function(A){return b.resolve(y()).then(function(){throw A})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,b){if(typeof y!="function"&&this.state===l||typeof b!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?f(A,this.state===l?y:b,this.outcome):this.queue.push(new d(A,y,b)),A},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){f(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){f(this.promise,this.onRejected,y)},a.resolve=function(y,b){var A=g(p,b);if(A.status==="error")return a.reject(y,A.value);var T=A.value;if(T)m(y,T);else{y.state=l,y.outcome=b;for(var k=-1,I=y.queue.length;++k<I;)y.queue[k].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var A=-1,T=y.queue.length;++A<T;)y.queue[A].callRejected(b);return y},h.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},h.reject=function(y){var b=new this(o);return a.reject(b,y)},h.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,T=!1;if(!A)return this.resolve([]);for(var k=new Array(A),I=0,R=-1,$=new this(o);++R<A;)M(y[R],R);return $;function M(H,X){b.resolve(H).then(function(O){k[X]=O,++I!==A||T||(T=!0,a.resolve($,k))},function(O){T||(T=!0,a.reject($,O))})}},h.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,T=!1;if(!A)return this.resolve([]);for(var k=-1,I=new this(o);++k<A;)R=y[k],b.resolve(R).then(function($){T||(T=!0,a.resolve(I,$))},function($){T||(T=!0,a.reject(I,$))});var R;return I}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),l=r("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(A!==h)throw new Error(c[A]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var T;if(T=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(A=s.deflateSetDictionary(this.strm,T))!==h)throw new Error(c[A]);this._dict_set=!0}}function g(y,b){var A=new m(b);if(A.push(y,!0),A.err)throw A.msg||c[A.err];return A.result}m.prototype.push=function(y,b){var A,T,k=this.strm,I=this.options.chunkSize;if(this.ended)return!1;T=b===~~b?b:b===!0?4:0,typeof y=="string"?k.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?k.input=new Uint8Array(y):k.input=y,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new o.Buf8(I),k.next_out=0,k.avail_out=I),(A=s.deflate(k,T))!==1&&A!==h)return this.onEnd(A),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(k.output,k.next_out))):this.onData(o.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&A!==1);return T===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===h):T!==2||(this.onEnd(h),!(k.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=m,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),l=r("./zlib/messages"),u=r("./zlib/zstream"),h=r("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,g){var y=new f(g);if(y.push(m,!0),y.err)throw y.msg||l[y.err];return y.result}f.prototype.push=function(m,g){var y,b,A,T,k,I,R=this.strm,$=this.options.chunkSize,M=this.options.dictionary,H=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8($),R.next_out=0,R.avail_out=$),(y=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&M&&(I=typeof M=="string"?a.string2buf(M):d.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,y=s.inflateSetDictionary(this.strm,I)),y===c.Z_BUF_ERROR&&H===!0&&(y=c.Z_OK,H=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&y!==c.Z_STREAM_END&&(R.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(R.output,R.next_out),T=R.next_out-A,k=a.buf2string(R.output,A),R.next_out=T,R.avail_out=$-T,T&&o.arraySet(R.output,R.output,A,T,0),this.onData(k)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(H=!0)}while((0<R.avail_in||R.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,g){return(g=g||{}).raw=!0,p(m,g)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,g,y=h.length,b=0;for(m=0;m<y;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),b+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(b),m=g=0;g<b;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<y&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[g++]=f:(f<2048?d[g++]=192|f>>>6:(f<65536?d[g++]=224|f>>>12:(d[g++]=240|f>>>18,d[g++]=128|f>>>12&63),d[g++]=128|f>>>6&63),d[g++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,g,y=d||h.length,b=new Array(2*y);for(f=p=0;f<y;)if((m=h[f++])<128)b[p++]=m;else if(4<(g=c[m]))b[p++]=65533,f+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&f<y;)m=m<<6|63&h[f++],g--;1<g?b[p++]=65533:m<65536?b[p++]=m:(m-=65536,b[p++]=55296|m>>10&1023,b[p++]=56320|1023&m)}return u(b,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();n.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),l=r("./crc32"),u=r("./messages"),h=0,d=4,f=0,p=-2,m=-1,g=4,y=2,b=8,A=9,T=286,k=30,I=19,R=2*T+1,$=15,M=3,H=258,X=H+M+1,O=42,N=113,E=1,L=2,j=3,U=4;function q(S,ft){return S.msg=u[ft],ft}function Q(S){return(S<<1)-(4<S?9:0)}function K(S){for(var ft=S.length;0<=--ft;)S[ft]=0}function W(S){var ft=S.state,ct=ft.pending;ct>S.avail_out&&(ct=S.avail_out),ct!==0&&(o.arraySet(S.output,ft.pending_buf,ft.pending_out,ct,S.next_out),S.next_out+=ct,ft.pending_out+=ct,S.total_out+=ct,S.avail_out-=ct,ft.pending-=ct,ft.pending===0&&(ft.pending_out=0))}function P(S,ft){a._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,ft),S.block_start=S.strstart,W(S.strm)}function st(S,ft){S.pending_buf[S.pending++]=ft}function G(S,ft){S.pending_buf[S.pending++]=ft>>>8&255,S.pending_buf[S.pending++]=255&ft}function rt(S,ft){var ct,z,B=S.max_chain_length,tt=S.strstart,dt=S.prev_length,pt=S.nice_match,it=S.strstart>S.w_size-X?S.strstart-(S.w_size-X):0,_t=S.window,Rt=S.w_mask,gt=S.prev,Ft=S.strstart+H,ye=_t[tt+dt-1],Xt=_t[tt+dt];S.prev_length>=S.good_match&&(B>>=2),pt>S.lookahead&&(pt=S.lookahead);do if(_t[(ct=ft)+dt]===Xt&&_t[ct+dt-1]===ye&&_t[ct]===_t[tt]&&_t[++ct]===_t[tt+1]){tt+=2,ct++;do;while(_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&_t[++tt]===_t[++ct]&&tt<Ft);if(z=H-(Ft-tt),tt=Ft-H,dt<z){if(S.match_start=ft,pt<=(dt=z))break;ye=_t[tt+dt-1],Xt=_t[tt+dt]}}while((ft=gt[ft&Rt])>it&&--B!=0);return dt<=S.lookahead?dt:S.lookahead}function wt(S){var ft,ct,z,B,tt,dt,pt,it,_t,Rt,gt=S.w_size;do{if(B=S.window_size-S.lookahead-S.strstart,S.strstart>=gt+(gt-X)){for(o.arraySet(S.window,S.window,gt,gt,0),S.match_start-=gt,S.strstart-=gt,S.block_start-=gt,ft=ct=S.hash_size;z=S.head[--ft],S.head[ft]=gt<=z?z-gt:0,--ct;);for(ft=ct=gt;z=S.prev[--ft],S.prev[ft]=gt<=z?z-gt:0,--ct;);B+=gt}if(S.strm.avail_in===0)break;if(dt=S.strm,pt=S.window,it=S.strstart+S.lookahead,_t=B,Rt=void 0,Rt=dt.avail_in,_t<Rt&&(Rt=_t),ct=Rt===0?0:(dt.avail_in-=Rt,o.arraySet(pt,dt.input,dt.next_in,Rt,it),dt.state.wrap===1?dt.adler=c(dt.adler,pt,Rt,it):dt.state.wrap===2&&(dt.adler=l(dt.adler,pt,Rt,it)),dt.next_in+=Rt,dt.total_in+=Rt,Rt),S.lookahead+=ct,S.lookahead+S.insert>=M)for(tt=S.strstart-S.insert,S.ins_h=S.window[tt],S.ins_h=(S.ins_h<<S.hash_shift^S.window[tt+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[tt+M-1])&S.hash_mask,S.prev[tt&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=tt,tt++,S.insert--,!(S.lookahead+S.insert<M)););}while(S.lookahead<X&&S.strm.avail_in!==0)}function Tt(S,ft){for(var ct,z;;){if(S.lookahead<X){if(wt(S),S.lookahead<X&&ft===h)return E;if(S.lookahead===0)break}if(ct=0,S.lookahead>=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),ct!==0&&S.strstart-ct<=S.w_size-X&&(S.match_length=rt(S,ct)),S.match_length>=M)if(z=a._tr_tally(S,S.strstart-S.match_start,S.match_length-M),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=M){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else z=a._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(z&&(P(S,!1),S.strm.avail_out===0))return E}return S.insert=S.strstart<M-1?S.strstart:M-1,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):S.last_lit&&(P(S,!1),S.strm.avail_out===0)?E:L}function It(S,ft){for(var ct,z,B;;){if(S.lookahead<X){if(wt(S),S.lookahead<X&&ft===h)return E;if(S.lookahead===0)break}if(ct=0,S.lookahead>=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=M-1,ct!==0&&S.prev_length<S.max_lazy_match&&S.strstart-ct<=S.w_size-X&&(S.match_length=rt(S,ct),S.match_length<=5&&(S.strategy===1||S.match_length===M&&4096<S.strstart-S.match_start)&&(S.match_length=M-1)),S.prev_length>=M&&S.match_length<=S.prev_length){for(B=S.strstart+S.lookahead-M,z=a._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-M),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=B&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+M-1])&S.hash_mask,ct=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=M-1,S.strstart++,z&&(P(S,!1),S.strm.avail_out===0))return E}else if(S.match_available){if((z=a._tr_tally(S,0,S.window[S.strstart-1]))&&P(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return E}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(z=a._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<M-1?S.strstart:M-1,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):S.last_lit&&(P(S,!1),S.strm.avail_out===0)?E:L}function St(S,ft,ct,z,B){this.good_length=S,this.max_lazy=ft,this.nice_length=ct,this.max_chain=z,this.func=B}function Pt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*k+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*T+1),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Mt(S){var ft;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=y,(ft=S.state).pending=0,ft.pending_out=0,ft.wrap<0&&(ft.wrap=-ft.wrap),ft.status=ft.wrap?O:N,S.adler=ft.wrap===2?0:1,ft.last_flush=h,a._tr_init(ft),f):q(S,p)}function qt(S){var ft=Mt(S);return ft===f&&function(ct){ct.window_size=2*ct.w_size,K(ct.head),ct.max_lazy_match=s[ct.level].max_lazy,ct.good_match=s[ct.level].good_length,ct.nice_match=s[ct.level].nice_length,ct.max_chain_length=s[ct.level].max_chain,ct.strstart=0,ct.block_start=0,ct.lookahead=0,ct.insert=0,ct.match_length=ct.prev_length=M-1,ct.match_available=0,ct.ins_h=0}(S.state),ft}function ee(S,ft,ct,z,B,tt){if(!S)return p;var dt=1;if(ft===m&&(ft=6),z<0?(dt=0,z=-z):15<z&&(dt=2,z-=16),B<1||A<B||ct!==b||z<8||15<z||ft<0||9<ft||tt<0||g<tt)return q(S,p);z===8&&(z=9);var pt=new Pt;return(S.state=pt).strm=S,pt.wrap=dt,pt.gzhead=null,pt.w_bits=z,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=B+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+M-1)/M),pt.window=new o.Buf8(2*pt.w_size),pt.head=new o.Buf16(pt.hash_size),pt.prev=new o.Buf16(pt.w_size),pt.lit_bufsize=1<<B+6,pt.pending_buf_size=4*pt.lit_bufsize,pt.pending_buf=new o.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=ft,pt.strategy=tt,pt.method=ct,qt(S)}s=[new St(0,0,0,0,function(S,ft){var ct=65535;for(ct>S.pending_buf_size-5&&(ct=S.pending_buf_size-5);;){if(S.lookahead<=1){if(wt(S),S.lookahead===0&&ft===h)return E;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var z=S.block_start+ct;if((S.strstart===0||S.strstart>=z)&&(S.lookahead=S.strstart-z,S.strstart=z,P(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-X&&(P(S,!1),S.strm.avail_out===0))return E}return S.insert=0,ft===d?(P(S,!0),S.strm.avail_out===0?j:U):(S.strstart>S.block_start&&(P(S,!1),S.strm.avail_out),E)}),new St(4,4,8,4,Tt),new St(4,5,16,8,Tt),new St(4,6,32,32,Tt),new St(4,4,16,16,It),new St(8,16,32,32,It),new St(8,16,128,128,It),new St(8,32,128,256,It),new St(32,128,258,1024,It),new St(32,258,258,4096,It)],i.deflateInit=function(S,ft){return ee(S,ft,b,15,8,0)},i.deflateInit2=ee,i.deflateReset=qt,i.deflateResetKeep=Mt,i.deflateSetHeader=function(S,ft){return S&&S.state?S.state.wrap!==2?p:(S.state.gzhead=ft,f):p},i.deflate=function(S,ft){var ct,z,B,tt;if(!S||!S.state||5<ft||ft<0)return S?q(S,p):p;if(z=S.state,!S.output||!S.input&&S.avail_in!==0||z.status===666&&ft!==d)return q(S,S.avail_out===0?-5:p);if(z.strm=S,ct=z.last_flush,z.last_flush=ft,z.status===O)if(z.wrap===2)S.adler=0,st(z,31),st(z,139),st(z,8),z.gzhead?(st(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),st(z,255&z.gzhead.time),st(z,z.gzhead.time>>8&255),st(z,z.gzhead.time>>16&255),st(z,z.gzhead.time>>24&255),st(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),st(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(st(z,255&z.gzhead.extra.length),st(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(S.adler=l(S.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(st(z,0),st(z,0),st(z,0),st(z,0),st(z,0),st(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),st(z,3),z.status=N);else{var dt=b+(z.w_bits-8<<4)<<8;dt|=(2<=z.strategy||z.level<2?0:z.level<6?1:z.level===6?2:3)<<6,z.strstart!==0&&(dt|=32),dt+=31-dt%31,z.status=N,G(z,dt),z.strstart!==0&&(G(z,S.adler>>>16),G(z,65535&S.adler)),S.adler=1}if(z.status===69)if(z.gzhead.extra){for(B=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending!==z.pending_buf_size));)st(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(z.status===73)if(z.gzhead.name){B=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending===z.pending_buf_size)){tt=1;break}tt=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,st(z,tt)}while(tt!==0);z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),tt===0&&(z.gzindex=0,z.status=91)}else z.status=91;if(z.status===91)if(z.gzhead.comment){B=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),W(S),B=z.pending,z.pending===z.pending_buf_size)){tt=1;break}tt=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,st(z,tt)}while(tt!==0);z.gzhead.hcrc&&z.pending>B&&(S.adler=l(S.adler,z.pending_buf,z.pending-B,B)),tt===0&&(z.status=103)}else z.status=103;if(z.status===103&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&W(S),z.pending+2<=z.pending_buf_size&&(st(z,255&S.adler),st(z,S.adler>>8&255),S.adler=0,z.status=N)):z.status=N),z.pending!==0){if(W(S),S.avail_out===0)return z.last_flush=-1,f}else if(S.avail_in===0&&Q(ft)<=Q(ct)&&ft!==d)return q(S,-5);if(z.status===666&&S.avail_in!==0)return q(S,-5);if(S.avail_in!==0||z.lookahead!==0||ft!==h&&z.status!==666){var pt=z.strategy===2?function(it,_t){for(var Rt;;){if(it.lookahead===0&&(wt(it),it.lookahead===0)){if(_t===h)return E;break}if(it.match_length=0,Rt=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++,Rt&&(P(it,!1),it.strm.avail_out===0))return E}return it.insert=0,_t===d?(P(it,!0),it.strm.avail_out===0?j:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?E:L}(z,ft):z.strategy===3?function(it,_t){for(var Rt,gt,Ft,ye,Xt=it.window;;){if(it.lookahead<=H){if(wt(it),it.lookahead<=H&&_t===h)return E;if(it.lookahead===0)break}if(it.match_length=0,it.lookahead>=M&&0<it.strstart&&(gt=Xt[Ft=it.strstart-1])===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]){ye=it.strstart+H;do;while(gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&gt===Xt[++Ft]&&Ft<ye);it.match_length=H-(ye-Ft),it.match_length>it.lookahead&&(it.match_length=it.lookahead)}if(it.match_length>=M?(Rt=a._tr_tally(it,1,it.match_length-M),it.lookahead-=it.match_length,it.strstart+=it.match_length,it.match_length=0):(Rt=a._tr_tally(it,0,it.window[it.strstart]),it.lookahead--,it.strstart++),Rt&&(P(it,!1),it.strm.avail_out===0))return E}return it.insert=0,_t===d?(P(it,!0),it.strm.avail_out===0?j:U):it.last_lit&&(P(it,!1),it.strm.avail_out===0)?E:L}(z,ft):s[z.level].func(z,ft);if(pt!==j&&pt!==U||(z.status=666),pt===E||pt===j)return S.avail_out===0&&(z.last_flush=-1),f;if(pt===L&&(ft===1?a._tr_align(z):ft!==5&&(a._tr_stored_block(z,0,0,!1),ft===3&&(K(z.head),z.lookahead===0&&(z.strstart=0,z.block_start=0,z.insert=0))),W(S),S.avail_out===0))return z.last_flush=-1,f}return ft!==d?f:z.wrap<=0?1:(z.wrap===2?(st(z,255&S.adler),st(z,S.adler>>8&255),st(z,S.adler>>16&255),st(z,S.adler>>24&255),st(z,255&S.total_in),st(z,S.total_in>>8&255),st(z,S.total_in>>16&255),st(z,S.total_in>>24&255)):(G(z,S.adler>>>16),G(z,65535&S.adler)),W(S),0<z.wrap&&(z.wrap=-z.wrap),z.pending!==0?f:1)},i.deflateEnd=function(S){var ft;return S&&S.state?(ft=S.state.status)!==O&&ft!==69&&ft!==73&&ft!==91&&ft!==103&&ft!==N&&ft!==666?q(S,p):(S.state=null,ft===N?q(S,-3):f):p},i.deflateSetDictionary=function(S,ft){var ct,z,B,tt,dt,pt,it,_t,Rt=ft.length;if(!S||!S.state||(tt=(ct=S.state).wrap)===2||tt===1&&ct.status!==O||ct.lookahead)return p;for(tt===1&&(S.adler=c(S.adler,ft,Rt,0)),ct.wrap=0,Rt>=ct.w_size&&(tt===0&&(K(ct.head),ct.strstart=0,ct.block_start=0,ct.insert=0),_t=new o.Buf8(ct.w_size),o.arraySet(_t,ft,Rt-ct.w_size,ct.w_size,0),ft=_t,Rt=ct.w_size),dt=S.avail_in,pt=S.next_in,it=S.input,S.avail_in=Rt,S.next_in=0,S.input=ft,wt(ct);ct.lookahead>=M;){for(z=ct.strstart,B=ct.lookahead-(M-1);ct.ins_h=(ct.ins_h<<ct.hash_shift^ct.window[z+M-1])&ct.hash_mask,ct.prev[z&ct.w_mask]=ct.head[ct.ins_h],ct.head[ct.ins_h]=z,z++,--B;);ct.strstart=z,ct.lookahead=M-1,wt(ct)}return ct.strstart+=ct.lookahead,ct.block_start=ct.strstart,ct.insert=ct.lookahead,ct.lookahead=0,ct.match_length=ct.prev_length=M-1,ct.match_available=0,S.next_in=pt,S.input=it,S.avail_in=dt,ct.wrap=tt,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,l,u,h,d,f,p,m,g,y,b,A,T,k,I,R,$,M,H,X,O,N,E,L;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,L=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,g=a.wnext,y=a.window,b=a.hold,A=a.bits,T=a.lencode,k=a.distcode,I=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;t:do{A<15&&(b+=E[c++]<<A,A+=8,b+=E[c++]<<A,A+=8),$=T[b&I];e:for(;;){if(b>>>=M=$>>>24,A-=M,(M=$>>>16&255)===0)L[u++]=65535&$;else{if(!(16&M)){if(!(64&M)){$=T[(65535&$)+(b&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}H=65535&$,(M&=15)&&(A<M&&(b+=E[c++]<<A,A+=8),H+=b&(1<<M)-1,b>>>=M,A-=M),A<15&&(b+=E[c++]<<A,A+=8,b+=E[c++]<<A,A+=8),$=k[b&R];r:for(;;){if(b>>>=M=$>>>24,A-=M,!(16&(M=$>>>16&255))){if(!(64&M)){$=k[(65535&$)+(b&(1<<M)-1)];continue r}s.msg="invalid distance code",a.mode=30;break t}if(X=65535&$,A<(M&=15)&&(b+=E[c++]<<A,(A+=8)<M&&(b+=E[c++]<<A,A+=8)),f<(X+=b&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=M,A-=M,(M=u-h)<X){if(m<(M=X-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(N=y,(O=0)===g){if(O+=p-M,M<H){for(H-=M;L[u++]=y[O++],--M;);O=u-X,N=L}}else if(g<M){if(O+=p+g-M,(M-=g)<H){for(H-=M;L[u++]=y[O++],--M;);if(O=0,g<H){for(H-=M=g;L[u++]=y[O++],--M;);O=u-X,N=L}}}else if(O+=g-M,M<H){for(H-=M;L[u++]=y[O++],--M;);O=u-X,N=L}for(;2<H;)L[u++]=N[O++],L[u++]=N[O++],L[u++]=N[O++],H-=3;H&&(L[u++]=N[O++],1<H&&(L[u++]=N[O++]))}else{for(O=u-X;L[u++]=L[O++],L[u++]=L[O++],L[u++]=L[O++],2<(H-=3););H&&(L[u++]=L[O++],1<H&&(L[u++]=L[O++]))}break}}break}}while(c<l&&u<d);c-=H=A>>3,b&=(1<<(A-=H<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=b,a.bits=A}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),l=r("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,g=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(O){var N;return O&&O.state?(N=O.state,O.total_in=O.total_out=N.total=0,O.msg="",N.wrap&&(O.adler=1&N.wrap),N.mode=p,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(m),N.distcode=N.distdyn=new s.Buf32(g),N.sane=1,N.back=-1,d):f}function T(O){var N;return O&&O.state?((N=O.state).wsize=0,N.whave=0,N.wnext=0,A(O)):f}function k(O,N){var E,L;return O&&O.state?(L=O.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?f:(L.window!==null&&L.wbits!==N&&(L.window=null),L.wrap=E,L.wbits=N,T(O))):f}function I(O,N){var E,L;return O?(L=new b,(O.state=L).window=null,(E=k(O,N))!==d&&(O.state=null),E):f}var R,$,M=!0;function H(O){if(M){var N;for(R=new s.Buf32(512),$=new s.Buf32(32),N=0;N<144;)O.lens[N++]=8;for(;N<256;)O.lens[N++]=9;for(;N<280;)O.lens[N++]=7;for(;N<288;)O.lens[N++]=8;for(l(u,O.lens,0,288,R,0,O.work,{bits:9}),N=0;N<32;)O.lens[N++]=5;l(h,O.lens,0,32,$,0,O.work,{bits:5}),M=!1}O.lencode=R,O.lenbits=9,O.distcode=$,O.distbits=5}function X(O,N,E,L){var j,U=O.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),L>=U.wsize?(s.arraySet(U.window,N,E-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(L<(j=U.wsize-U.wnext)&&(j=L),s.arraySet(U.window,N,E-L,j,U.wnext),(L-=j)?(s.arraySet(U.window,N,E-L,L,0),U.wnext=L,U.whave=U.wsize):(U.wnext+=j,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=j))),0}i.inflateReset=T,i.inflateReset2=k,i.inflateResetKeep=A,i.inflateInit=function(O){return I(O,15)},i.inflateInit2=I,i.inflate=function(O,N){var E,L,j,U,q,Q,K,W,P,st,G,rt,wt,Tt,It,St,Pt,Mt,qt,ee,S,ft,ct,z,B=0,tt=new s.Buf8(4),dt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(E=O.state).mode===12&&(E.mode=13),q=O.next_out,j=O.output,K=O.avail_out,U=O.next_in,L=O.input,Q=O.avail_in,W=E.hold,P=E.bits,st=Q,G=K,ft=d;t:for(;;)switch(E.mode){case p:if(E.wrap===0){E.mode=13;break}for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(2&E.wrap&&W===35615){tt[E.check=0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0),P=W=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&W)<<8)+(W>>8))%31){O.msg="incorrect header check",E.mode=30;break}if((15&W)!=8){O.msg="unknown compression method",E.mode=30;break}if(P-=4,S=8+(15&(W>>>=4)),E.wbits===0)E.wbits=S;else if(S>E.wbits){O.msg="invalid window size",E.mode=30;break}E.dmax=1<<S,O.adler=E.check=1,E.mode=512&W?10:12,P=W=0;break;case 2:for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(E.flags=W,(255&E.flags)!=8){O.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){O.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=W>>8&1),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0,E.mode=3;case 3:for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.head&&(E.head.time=W),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,tt[2]=W>>>16&255,tt[3]=W>>>24&255,E.check=a(E.check,tt,4,0)),P=W=0,E.mode=4;case 4:for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.head&&(E.head.xflags=255&W,E.head.os=W>>8),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0,E.mode=5;case 5:if(1024&E.flags){for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.length=W,E.head&&(E.head.extra_len=W),512&E.flags&&(tt[0]=255&W,tt[1]=W>>>8&255,E.check=a(E.check,tt,2,0)),P=W=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(Q<(rt=E.length)&&(rt=Q),rt&&(E.head&&(S=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,L,U,rt,S)),512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,E.length-=rt),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(Q===0)break t;for(rt=0;S=L[U+rt++],E.head&&S&&E.length<65536&&(E.head.name+=String.fromCharCode(S)),S&&rt<Q;);if(512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,S)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(Q===0)break t;for(rt=0;S=L[U+rt++],E.head&&S&&E.length<65536&&(E.head.comment+=String.fromCharCode(S)),S&&rt<Q;);if(512&E.flags&&(E.check=a(E.check,L,rt,U)),Q-=rt,U+=rt,S)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;P<16;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W!==(65535&E.check)){O.msg="header crc mismatch",E.mode=30;break}P=W=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),O.adler=E.check=0,E.mode=12;break;case 10:for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}O.adler=E.check=y(W),P=W=0,E.mode=11;case 11:if(E.havedict===0)return O.next_out=q,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,2;O.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break t;case 13:if(E.last){W>>>=7&P,P-=7&P,E.mode=27;break}for(;P<3;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}switch(E.last=1&W,P-=1,3&(W>>>=1)){case 0:E.mode=14;break;case 1:if(H(E),E.mode=20,N!==6)break;W>>>=2,P-=2;break t;case 2:E.mode=17;break;case 3:O.msg="invalid block type",E.mode=30}W>>>=2,P-=2;break;case 14:for(W>>>=7&P,P-=7&P;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if((65535&W)!=(W>>>16^65535)){O.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&W,P=W=0,E.mode=15,N===6)break t;case 15:E.mode=16;case 16:if(rt=E.length){if(Q<rt&&(rt=Q),K<rt&&(rt=K),rt===0)break t;s.arraySet(j,L,U,rt,q),Q-=rt,U+=rt,K-=rt,q+=rt,E.length-=rt;break}E.mode=12;break;case 17:for(;P<14;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(E.nlen=257+(31&W),W>>>=5,P-=5,E.ndist=1+(31&W),W>>>=5,P-=5,E.ncode=4+(15&W),W>>>=4,P-=4,286<E.nlen||30<E.ndist){O.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;P<3;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.lens[dt[E.have++]]=7&W,W>>>=3,P-=3}for(;E.have<19;)E.lens[dt[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,ct={bits:E.lenbits},ft=l(0,E.lens,0,19,E.lencode,0,E.work,ct),E.lenbits=ct.bits,ft){O.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;St=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(Pt<16)W>>>=It,P-=It,E.lens[E.have++]=Pt;else{if(Pt===16){for(z=It+2;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W>>>=It,P-=It,E.have===0){O.msg="invalid bit length repeat",E.mode=30;break}S=E.lens[E.have-1],rt=3+(3&W),W>>>=2,P-=2}else if(Pt===17){for(z=It+3;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}P-=It,S=0,rt=3+(7&(W>>>=It)),W>>>=3,P-=3}else{for(z=It+7;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}P-=It,S=0,rt=11+(127&(W>>>=It)),W>>>=7,P-=7}if(E.have+rt>E.nlen+E.ndist){O.msg="invalid bit length repeat",E.mode=30;break}for(;rt--;)E.lens[E.have++]=S}}if(E.mode===30)break;if(E.lens[256]===0){O.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,ct={bits:E.lenbits},ft=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,ct),E.lenbits=ct.bits,ft){O.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,ct={bits:E.distbits},ft=l(h,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,ct),E.distbits=ct.bits,ft){O.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break t;case 20:E.mode=21;case 21:if(6<=Q&&258<=K){O.next_out=q,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,c(O,G),q=O.next_out,j=O.output,K=O.avail_out,U=O.next_in,L=O.input,Q=O.avail_in,W=E.hold,P=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;St=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(St&&!(240&St)){for(Mt=It,qt=St,ee=Pt;St=(B=E.lencode[ee+((W&(1<<Mt+qt)-1)>>Mt)])>>>16&255,Pt=65535&B,!(Mt+(It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}W>>>=Mt,P-=Mt,E.back+=Mt}if(W>>>=It,P-=It,E.back+=It,E.length=Pt,St===0){E.mode=26;break}if(32&St){E.back=-1,E.mode=12;break}if(64&St){O.msg="invalid literal/length code",E.mode=30;break}E.extra=15&St,E.mode=22;case 22:if(E.extra){for(z=E.extra;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.length+=W&(1<<E.extra)-1,W>>>=E.extra,P-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;St=(B=E.distcode[W&(1<<E.distbits)-1])>>>16&255,Pt=65535&B,!((It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(!(240&St)){for(Mt=It,qt=St,ee=Pt;St=(B=E.distcode[ee+((W&(1<<Mt+qt)-1)>>Mt)])>>>16&255,Pt=65535&B,!(Mt+(It=B>>>24)<=P);){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}W>>>=Mt,P-=Mt,E.back+=Mt}if(W>>>=It,P-=It,E.back+=It,64&St){O.msg="invalid distance code",E.mode=30;break}E.offset=Pt,E.extra=15&St,E.mode=24;case 24:if(E.extra){for(z=E.extra;P<z;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}E.offset+=W&(1<<E.extra)-1,W>>>=E.extra,P-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){O.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(K===0)break t;if(rt=G-K,E.offset>rt){if((rt=E.offset-rt)>E.whave&&E.sane){O.msg="invalid distance too far back",E.mode=30;break}wt=rt>E.wnext?(rt-=E.wnext,E.wsize-rt):E.wnext-rt,rt>E.length&&(rt=E.length),Tt=E.window}else Tt=j,wt=q-E.offset,rt=E.length;for(K<rt&&(rt=K),K-=rt,E.length-=rt;j[q++]=Tt[wt++],--rt;);E.length===0&&(E.mode=21);break;case 26:if(K===0)break t;j[q++]=E.length,K--,E.mode=21;break;case 27:if(E.wrap){for(;P<32;){if(Q===0)break t;Q--,W|=L[U++]<<P,P+=8}if(G-=K,O.total_out+=G,E.total+=G,G&&(O.adler=E.check=E.flags?a(E.check,j,G,q-G):o(E.check,j,G,q-G)),G=K,(E.flags?W:y(W))!==E.check){O.msg="incorrect data check",E.mode=30;break}P=W=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;P<32;){if(Q===0)break t;Q--,W+=L[U++]<<P,P+=8}if(W!==(4294967295&E.total)){O.msg="incorrect length check",E.mode=30;break}P=W=0}E.mode=29;case 29:ft=1;break t;case 30:ft=-3;break t;case 31:return-4;case 32:default:return f}return O.next_out=q,O.avail_out=K,O.next_in=U,O.avail_in=Q,E.hold=W,E.bits=P,(E.wsize||G!==O.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&X(O,O.output,O.next_out,G-O.avail_out)?(E.mode=31,-4):(st-=O.avail_in,G-=O.avail_out,O.total_in+=st,O.total_out+=G,E.total+=G,E.wrap&&G&&(O.adler=E.check=E.flags?a(E.check,j,G,O.next_out-G):o(E.check,j,G,O.next_out-G)),O.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(st==0&&G===0||N===4)&&ft===d&&(ft=-5),ft)},i.inflateEnd=function(O){if(!O||!O.state)return f;var N=O.state;return N.window&&(N.window=null),O.state=null,d},i.inflateGetHeader=function(O,N){var E;return O&&O.state&&2&(E=O.state).wrap?((E.head=N).done=!1,d):f},i.inflateSetDictionary=function(O,N){var E,L=N.length;return O&&O.state?(E=O.state).wrap!==0&&E.mode!==11?f:E.mode===11&&o(1,N,L,0)!==E.check?-3:X(O,N,L,L)?(E.mode=31,-4):(E.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,h,d,f,p,m,g,y){var b,A,T,k,I,R,$,M,H,X=y.bits,O=0,N=0,E=0,L=0,j=0,U=0,q=0,Q=0,K=0,W=0,P=null,st=0,G=new s.Buf16(16),rt=new s.Buf16(16),wt=null,Tt=0;for(O=0;O<=15;O++)G[O]=0;for(N=0;N<f;N++)G[h[d+N]]++;for(j=X,L=15;1<=L&&G[L]===0;L--);if(L<j&&(j=L),L===0)return p[m++]=20971520,p[m++]=20971520,y.bits=1,0;for(E=1;E<L&&G[E]===0;E++);for(j<E&&(j=E),O=Q=1;O<=15;O++)if(Q<<=1,(Q-=G[O])<0)return-1;if(0<Q&&(u===0||L!==1))return-1;for(rt[1]=0,O=1;O<15;O++)rt[O+1]=rt[O]+G[O];for(N=0;N<f;N++)h[d+N]!==0&&(g[rt[h[d+N]]++]=N);if(R=u===0?(P=wt=g,19):u===1?(P=o,st-=257,wt=a,Tt-=257,256):(P=c,wt=l,-1),O=E,I=m,q=N=W=0,T=-1,k=(K=1<<(U=j))-1,u===1&&852<K||u===2&&592<K)return 1;for(;;){for($=O-q,H=g[N]<R?(M=0,g[N]):g[N]>R?(M=wt[Tt+g[N]],P[st+g[N]]):(M=96,0),b=1<<O-q,E=A=1<<U;p[I+(W>>q)+(A-=b)]=$<<24|M<<16|H|0,A!==0;);for(b=1<<O-1;W&b;)b>>=1;if(b!==0?(W&=b-1,W+=b):W=0,N++,--G[O]==0){if(O===L)break;O=h[d+g[N]]}if(j<O&&(W&k)!==T){for(q===0&&(q=j),I+=E,Q=1<<(U=O-q);U+q<L&&!((Q-=G[U+q])<=0);)U++,Q<<=1;if(K+=1<<U,u===1&&852<K||u===2&&592<K)return 1;p[T=W&k]=j<<24|U<<16|I-m|0}}return W!==0&&(p[I+W]=O-q<<24|64<<16|0),y.bits=j,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(B){for(var tt=B.length;0<=--tt;)B[tt]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,g=15,y=16,b=7,A=256,T=16,k=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(d+2));c(X);var O=new Array(2*f);c(O);var N=new Array(512);c(N);var E=new Array(256);c(E);var L=new Array(u);c(L);var j,U,q,Q=new Array(f);function K(B,tt,dt,pt,it){this.static_tree=B,this.extra_bits=tt,this.extra_base=dt,this.elems=pt,this.max_length=it,this.has_stree=B&&B.length}function W(B,tt){this.dyn_tree=B,this.max_code=0,this.stat_desc=tt}function P(B){return B<256?N[B]:N[256+(B>>>7)]}function st(B,tt){B.pending_buf[B.pending++]=255&tt,B.pending_buf[B.pending++]=tt>>>8&255}function G(B,tt,dt){B.bi_valid>y-dt?(B.bi_buf|=tt<<B.bi_valid&65535,st(B,B.bi_buf),B.bi_buf=tt>>y-B.bi_valid,B.bi_valid+=dt-y):(B.bi_buf|=tt<<B.bi_valid&65535,B.bi_valid+=dt)}function rt(B,tt,dt){G(B,dt[2*tt],dt[2*tt+1])}function wt(B,tt){for(var dt=0;dt|=1&B,B>>>=1,dt<<=1,0<--tt;);return dt>>>1}function Tt(B,tt,dt){var pt,it,_t=new Array(g+1),Rt=0;for(pt=1;pt<=g;pt++)_t[pt]=Rt=Rt+dt[pt-1]<<1;for(it=0;it<=tt;it++){var gt=B[2*it+1];gt!==0&&(B[2*it]=wt(_t[gt]++,gt))}}function It(B){var tt;for(tt=0;tt<d;tt++)B.dyn_ltree[2*tt]=0;for(tt=0;tt<f;tt++)B.dyn_dtree[2*tt]=0;for(tt=0;tt<p;tt++)B.bl_tree[2*tt]=0;B.dyn_ltree[2*A]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function St(B){8<B.bi_valid?st(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function Pt(B,tt,dt,pt){var it=2*tt,_t=2*dt;return B[it]<B[_t]||B[it]===B[_t]&&pt[tt]<=pt[dt]}function Mt(B,tt,dt){for(var pt=B.heap[dt],it=dt<<1;it<=B.heap_len&&(it<B.heap_len&&Pt(tt,B.heap[it+1],B.heap[it],B.depth)&&it++,!Pt(tt,pt,B.heap[it],B.depth));)B.heap[dt]=B.heap[it],dt=it,it<<=1;B.heap[dt]=pt}function qt(B,tt,dt){var pt,it,_t,Rt,gt=0;if(B.last_lit!==0)for(;pt=B.pending_buf[B.d_buf+2*gt]<<8|B.pending_buf[B.d_buf+2*gt+1],it=B.pending_buf[B.l_buf+gt],gt++,pt===0?rt(B,it,tt):(rt(B,(_t=E[it])+h+1,tt),(Rt=R[_t])!==0&&G(B,it-=L[_t],Rt),rt(B,_t=P(--pt),dt),(Rt=$[_t])!==0&&G(B,pt-=Q[_t],Rt)),gt<B.last_lit;);rt(B,A,tt)}function ee(B,tt){var dt,pt,it,_t=tt.dyn_tree,Rt=tt.stat_desc.static_tree,gt=tt.stat_desc.has_stree,Ft=tt.stat_desc.elems,ye=-1;for(B.heap_len=0,B.heap_max=m,dt=0;dt<Ft;dt++)_t[2*dt]!==0?(B.heap[++B.heap_len]=ye=dt,B.depth[dt]=0):_t[2*dt+1]=0;for(;B.heap_len<2;)_t[2*(it=B.heap[++B.heap_len]=ye<2?++ye:0)]=1,B.depth[it]=0,B.opt_len--,gt&&(B.static_len-=Rt[2*it+1]);for(tt.max_code=ye,dt=B.heap_len>>1;1<=dt;dt--)Mt(B,_t,dt);for(it=Ft;dt=B.heap[1],B.heap[1]=B.heap[B.heap_len--],Mt(B,_t,1),pt=B.heap[1],B.heap[--B.heap_max]=dt,B.heap[--B.heap_max]=pt,_t[2*it]=_t[2*dt]+_t[2*pt],B.depth[it]=(B.depth[dt]>=B.depth[pt]?B.depth[dt]:B.depth[pt])+1,_t[2*dt+1]=_t[2*pt+1]=it,B.heap[1]=it++,Mt(B,_t,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1],function(Xt,tr){var C,_,v,F,Y,at,D=tr.dyn_tree,Z=tr.max_code,Bt=tr.stat_desc.static_tree,jt=tr.stat_desc.has_stree,Gt=tr.stat_desc.extra_bits,Ot=tr.stat_desc.extra_base,rn=tr.stat_desc.max_length,Cn=0;for(F=0;F<=g;F++)Xt.bl_count[F]=0;for(D[2*Xt.heap[Xt.heap_max]+1]=0,C=Xt.heap_max+1;C<m;C++)rn<(F=D[2*D[2*(_=Xt.heap[C])+1]+1]+1)&&(F=rn,Cn++),D[2*_+1]=F,Z<_||(Xt.bl_count[F]++,Y=0,Ot<=_&&(Y=Gt[_-Ot]),at=D[2*_],Xt.opt_len+=at*(F+Y),jt&&(Xt.static_len+=at*(Bt[2*_+1]+Y)));if(Cn!==0){do{for(F=rn-1;Xt.bl_count[F]===0;)F--;Xt.bl_count[F]--,Xt.bl_count[F+1]+=2,Xt.bl_count[rn]--,Cn-=2}while(0<Cn);for(F=rn;F!==0;F--)for(_=Xt.bl_count[F];_!==0;)Z<(v=Xt.heap[--C])||(D[2*v+1]!==F&&(Xt.opt_len+=(F-D[2*v+1])*D[2*v],D[2*v+1]=F),_--)}}(B,tt),Tt(_t,ye,B.bl_count)}function S(B,tt,dt){var pt,it,_t=-1,Rt=tt[1],gt=0,Ft=7,ye=4;for(Rt===0&&(Ft=138,ye=3),tt[2*(dt+1)+1]=65535,pt=0;pt<=dt;pt++)it=Rt,Rt=tt[2*(pt+1)+1],++gt<Ft&&it===Rt||(gt<ye?B.bl_tree[2*it]+=gt:it!==0?(it!==_t&&B.bl_tree[2*it]++,B.bl_tree[2*T]++):gt<=10?B.bl_tree[2*k]++:B.bl_tree[2*I]++,_t=it,ye=(gt=0)===Rt?(Ft=138,3):it===Rt?(Ft=6,3):(Ft=7,4))}function ft(B,tt,dt){var pt,it,_t=-1,Rt=tt[1],gt=0,Ft=7,ye=4;for(Rt===0&&(Ft=138,ye=3),pt=0;pt<=dt;pt++)if(it=Rt,Rt=tt[2*(pt+1)+1],!(++gt<Ft&&it===Rt)){if(gt<ye)for(;rt(B,it,B.bl_tree),--gt!=0;);else it!==0?(it!==_t&&(rt(B,it,B.bl_tree),gt--),rt(B,T,B.bl_tree),G(B,gt-3,2)):gt<=10?(rt(B,k,B.bl_tree),G(B,gt-3,3)):(rt(B,I,B.bl_tree),G(B,gt-11,7));_t=it,ye=(gt=0)===Rt?(Ft=138,3):it===Rt?(Ft=6,3):(Ft=7,4)}}c(Q);var ct=!1;function z(B,tt,dt,pt){G(B,(l<<1)+(pt?1:0),3),function(it,_t,Rt,gt){St(it),st(it,Rt),st(it,~Rt),s.arraySet(it.pending_buf,it.window,_t,Rt,it.pending),it.pending+=Rt}(B,tt,dt)}i._tr_init=function(B){ct||(function(){var tt,dt,pt,it,_t,Rt=new Array(g+1);for(it=pt=0;it<u-1;it++)for(L[it]=pt,tt=0;tt<1<<R[it];tt++)E[pt++]=it;for(E[pt-1]=it,it=_t=0;it<16;it++)for(Q[it]=_t,tt=0;tt<1<<$[it];tt++)N[_t++]=it;for(_t>>=7;it<f;it++)for(Q[it]=_t<<7,tt=0;tt<1<<$[it]-7;tt++)N[256+_t++]=it;for(dt=0;dt<=g;dt++)Rt[dt]=0;for(tt=0;tt<=143;)X[2*tt+1]=8,tt++,Rt[8]++;for(;tt<=255;)X[2*tt+1]=9,tt++,Rt[9]++;for(;tt<=279;)X[2*tt+1]=7,tt++,Rt[7]++;for(;tt<=287;)X[2*tt+1]=8,tt++,Rt[8]++;for(Tt(X,d+1,Rt),tt=0;tt<f;tt++)O[2*tt+1]=5,O[2*tt]=wt(tt,5);j=new K(X,R,h+1,d,g),U=new K(O,$,0,f,g),q=new K(new Array(0),M,0,p,b)}(),ct=!0),B.l_desc=new W(B.dyn_ltree,j),B.d_desc=new W(B.dyn_dtree,U),B.bl_desc=new W(B.bl_tree,q),B.bi_buf=0,B.bi_valid=0,It(B)},i._tr_stored_block=z,i._tr_flush_block=function(B,tt,dt,pt){var it,_t,Rt=0;0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(gt){var Ft,ye=4093624447;for(Ft=0;Ft<=31;Ft++,ye>>>=1)if(1&ye&&gt.dyn_ltree[2*Ft]!==0)return o;if(gt.dyn_ltree[18]!==0||gt.dyn_ltree[20]!==0||gt.dyn_ltree[26]!==0)return a;for(Ft=32;Ft<h;Ft++)if(gt.dyn_ltree[2*Ft]!==0)return a;return o}(B)),ee(B,B.l_desc),ee(B,B.d_desc),Rt=function(gt){var Ft;for(S(gt,gt.dyn_ltree,gt.l_desc.max_code),S(gt,gt.dyn_dtree,gt.d_desc.max_code),ee(gt,gt.bl_desc),Ft=p-1;3<=Ft&&gt.bl_tree[2*H[Ft]+1]===0;Ft--);return gt.opt_len+=3*(Ft+1)+5+5+4,Ft}(B),it=B.opt_len+3+7>>>3,(_t=B.static_len+3+7>>>3)<=it&&(it=_t)):it=_t=dt+5,dt+4<=it&&tt!==-1?z(B,tt,dt,pt):B.strategy===4||_t===it?(G(B,2+(pt?1:0),3),qt(B,X,O)):(G(B,4+(pt?1:0),3),function(gt,Ft,ye,Xt){var tr;for(G(gt,Ft-257,5),G(gt,ye-1,5),G(gt,Xt-4,4),tr=0;tr<Xt;tr++)G(gt,gt.bl_tree[2*H[tr]+1],3);ft(gt,gt.dyn_ltree,Ft-1),ft(gt,gt.dyn_dtree,ye-1)}(B,B.l_desc.max_code+1,B.d_desc.max_code+1,Rt+1),qt(B,B.dyn_ltree,B.dyn_dtree)),It(B),pt&&St(B)},i._tr_tally=function(B,tt,dt){return B.pending_buf[B.d_buf+2*B.last_lit]=tt>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&tt,B.pending_buf[B.l_buf+B.last_lit]=255&dt,B.last_lit++,tt===0?B.dyn_ltree[2*dt]++:(B.matches++,tt--,B.dyn_ltree[2*(E[dt]+h+1)]++,B.dyn_dtree[2*P(tt)]++),B.last_lit===B.lit_bufsize-1},i._tr_align=function(B){G(B,2,3),rt(B,A,X),function(tt){tt.bi_valid===16?(st(tt,tt.bi_buf),tt.bi_buf=0,tt.bi_valid=0):8<=tt.bi_valid&&(tt.pending_buf[tt.pending++]=255&tt.bi_buf,tt.bi_buf>>=8,tt.bi_valid-=8)}(B)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(T){Ln.nextTick(function(){b(T)})}:function(){if(o.postMessage&&!o.importScripts){var T=!0,k=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=k,T}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(T){o.postMessage(h+T,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(T){b(T.data)},function(T){u.port2.postMessage(T)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(T){var k=m.createElement("script");k.onreadystatechange=function(){b(T),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(T){setTimeout(b,0,T)},g.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var k=new Array(arguments.length-1),I=0;I<k.length;I++)k[I]=arguments[I+1];var R={callback:T,args:k};return f[d]=R,c(d),d++},g.clearImmediate=y}function y(T){delete f[T]}function b(T){if(p)setTimeout(b,0,T);else{var k=f[T];if(k){p=!0;try{(function(I){var R=I.callback,$=I.args;switch($.length){case 0:R();break;case 1:R($[0]);break;case 2:R($[0],$[1]);break;case 3:R($[0],$[1],$[2]);break;default:R.apply(a,$)}})(k)}finally{y(T),p=!1}}}}function A(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(h)===0&&b(+T.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof er<"u"?er:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Qx);var h7=Qx.exports,T0=ps(h7);const tA={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(tA);var Nn=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Qo,vc,Xs;class d7{constructor(...t){Qo.set(this,new Map),vc.set(this,new Map),Xs.set(this,new Map);for(const r of t)this.define(r)}define(t,r=!1){for(let[n,i]of Object.entries(t)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),Nn(this,Xs,"f").has(n)||Nn(this,Xs,"f").set(n,new Set);const s=Nn(this,Xs,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Nn(this,vc,"f").set(n,a),o=!1,c)continue;const l=Nn(this,Qo,"f").get(a);if(l&&l!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Nn(this,Qo,"f").set(a,n)}}return this}getType(t){if(typeof t!="string")return null;const r=t.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<t.length;return!(n.length<r.length-1)&&i?null:Nn(this,Qo,"f").get(n)??null}getExtension(t){var r;return typeof t!="string"?null:(t=(r=t==null?void 0:t.split)==null?void 0:r.call(t,";")[0],(t&&Nn(this,vc,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Nn(this,Xs,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Nn(this,Xs,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Nn(this,Qo,"f"),extensions:Nn(this,vc,"f")}}}Qo=new WeakMap,vc=new WeakMap,Xs=new WeakMap;var p7=new d7(tA)._freeze();function m7(e,t){console.info(t)}const g7=/; \$(\w+) ?(.*)/,y7=/title (.+?) (.*)/i;function S0(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function _7(e,t){const r=Ix();if(!w(r))return;const n=t.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(p){return i.songs.find(m=>m.order===p)}function o(p,m){return{order:p,title:m,lines:[]}}for(let p=0;p<n.length;++p){const m=n[p],g=g7.exec(m);if(w(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const A=y7.exec(b);if(w(A)){const T=parseFloat(A[1]),k=A[2],I=s(T);w(I)?I.title=k:i.songs.push(o(T,k))}else{const T=parseFloat(b);if(Et(T)){const k=s(T);w(k)||i.songs.push(o(T,""))}}break}}}else{const y=i.songs[i.songs.length-1];w(y)&&m.trim().length&&y.lines.push(m)}}i.songs.sort((p,m)=>p.order-m.order);const a=i.songs.map(p=>p.title),c=`@play_${Dt(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${S0(i.title)}"
"$purple  ${S0(i.gendate)}"
"$purple  ${S0(i.gentime)}"
${a.map((p,m)=>`!song_${m};${m+1} ${p||"untitled"}`).join(`
`)}
#end

${i.songs.map((p,m)=>`:song_${m}
${p.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,l=ku(c,{}),u=be(l);oc(r,l),Tc(lt,e,`imported zzt zzm file ${u} into ${r.name} book`);const h=be(l),d=mi(l);we(lt,e,`!pageopen ${l.id};$blue[${d}]$white ${h}`);const f=`#put n ${u}`;x$(lt,e,f,f,!1)}const sf=60,b7=sf*25;function w7(e,t){let r=0;const n=new DataView(t.buffer);function i(){const L=n.getUint8(r);return r++,L}function s(){const L=n.getInt16(r,!0);return r+=2,L}function o(){const L=n.getInt32(r,!0);return r+=4,L}function a(L){let j="";const U=t.subarray(r,r+L);for(let q=0;q<U.length;++q)j+=String.fromCharCode(U[q]);return r+=L,j.replace("\r",`
`)}function c(L,j,U,q){const Q=On(L,j,U);if(w(Q)&&w(q)){const K=jr(q);for(let W=0;W<K.length;++W){const P=K[W];Q[P]=q[P]}}}function l(L){let j="";for(let U=0;U<L.length;++U){const q=L.charCodeAt(U);q<32||q>127?j+=`$${q}`:j+=L[U]}return j}function u(L){return L.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(j=>j.replace("$","$CENTER ")).map(l).join(`
`)}function h(L,j,U,q,Q){const K=q.color%16,W=Math.floor(q.color/16)%8,P=Aa(K,W),st=Aa((W+8)%16,K),G={},rt=Q.find(wt=>wt.x===j&&wt.y===U);switch(w(rt)&&(Et(rt.cycle)&&rt.cycle>0&&(G.cycle=rt.cycle),w(rt.p1)&&(G.p1=rt.p1),w(rt.p2)&&(G.p2=rt.p2),w(rt.p3)&&(G.p3=rt.p3),w(rt.code)&&rt.code&&(G.code=u(rt.code)),w(rt.stepx)&&(G.stepx=rt.stepx),w(rt.stepy)&&(G.stepy=rt.stepy)),q.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(L,["ammo",P],{x:j,y:U},G);break;case 6:c(L,["torch",P],{x:j,y:U},G);break;case 7:c(L,["gem",P],{x:j,y:U},G);break;case 8:c(L,["key",P],{x:j,y:U},G);break;case 9:c(L,["door",st],{x:j,y:U},G);break;case 10:c(L,["scroll",P],{x:j,y:U},G);break;case 11:{G.p3=d(rt==null?void 0:rt.p3)??"",c(L,["passage",P],{x:j,y:U},G);break}case 12:c(L,["duplicator",P],{x:j,y:U},G);break;case 13:c(L,["bomb",P],{x:j,y:U},G);break;case 14:c(L,["energize",P],{x:j,y:U},G);break;case 15:c(L,["star",P],{x:j,y:U},G);break;case 16:c(L,["clockwise",P],{x:j,y:U},G);break;case 17:c(L,["counter",P],{x:j,y:U},G);break;case 18:c(L,["bullet",P],{x:j,y:U},G);break;case 19:c(L,["water",P],{x:j,y:U},G);break;case 20:c(L,["forest",P],{x:j,y:U},G);break;case 21:c(L,["solid",P],{x:j,y:U},G);break;case 22:c(L,["normal",P],{x:j,y:U},G);break;case 23:c(L,["breakable",P],{x:j,y:U},G);break;case 24:c(L,["boulder",P],{x:j,y:U},G);break;case 25:c(L,["sliderns",P],{x:j,y:U},G);break;case 26:c(L,["sliderew",P],{x:j,y:U},G);break;case 27:c(L,["fake",P],{x:j,y:U},G);break;case 28:c(L,["invisible",P],{x:j,y:U},G);break;case 29:c(L,["blinkwall",P],{x:j,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepx??0});break;case 30:c(L,["transporter",P],{x:j,y:U},{...G,stepx:0,stepy:0,shootx:G.stepx??0,shooty:G.stepx??0});break;case 31:c(L,["line",P],{x:j,y:U},G);break;case 32:c(L,["ricochet",P],{x:j,y:U},G);break;case 33:c(L,["blinkns",P],{x:j,y:U},G);break;case 34:c(L,["bear",P],{x:j,y:U},G);break;case 35:c(L,["ruffian",P],{x:j,y:U},G);break;case 36:c(L,["object",P],{x:j,y:U},{...G,char:(rt==null?void 0:rt.p1)??1});break;case 37:c(L,["slime",P],{x:j,y:U},G);break;case 38:c(L,["shark",P],{x:j,y:U},G);break;case 39:c(L,["spinninggun",P],{x:j,y:U},G);break;case 40:c(L,["pusher",P],{x:j,y:U},G);break;case 41:c(L,["lion",P],{x:j,y:U},G);break;case 42:c(L,["tiger",P],{x:j,y:U},G);break;case 43:c(L,["blinkns",P],{x:j,y:U},G);break;case 44:c(L,["head",P],{x:j,y:U},G);break;case 45:c(L,["segment",P],{x:j,y:U},G);break;case 46:break;case 47:c(L,["text",["WHITE","ONDKBLUE"]],{x:j,y:U},{...G,char:q.color});break;case 48:c(L,["text",["WHITE","ONDKGREEN"]],{x:j,y:U},{...G,char:q.color});break;case 49:c(L,["text",["WHITE","ONDKCYAN"]],{x:j,y:U},{...G,char:q.color});break;case 50:c(L,["text",["WHITE","ONDKRED"]],{x:j,y:U},{...G,char:q.color});break;case 51:c(L,["text",["WHITE","ONDKPURPLE"]],{x:j,y:U},{...G,char:q.color});break;case 52:c(L,["text",["WHITE","ONDKYELLOW"]],{x:j,y:U},{...G,char:q.color});break;case 53:c(L,["text",["WHITE","ONBLACK"]],{x:j,y:U},{...G,char:q.color});break}}function d(L){if(Et(L)&&L>0)return`zztboard${L}`}if(s()!=-1)return;const p=s(),m=s(),g=s(),y=a(7),b=s(),A=s(),T=s(),k=s(),I=s();s();const R=s(),$=i(),M=a(20).slice(0,$);for(let L=0;L<9;L++){const j=i();a(20).slice(0,j)}const H=s(),X=s(),O=i();console.info(m,g,y,b,A,T,k,I,R,H,X,O),r=512;const N=[];for(let L=0;L<p;++L){const j=s(),U=r,q=i(),K={boardname:a(50).slice(0,q),elements:[],stats:[]};for(;K.elements.length<b7;){let P=i();P===0&&(P=255);const st=i(),G=i();for(let rt=0;rt<P;++rt)K.elements.push({element:st,color:G})}K.maxplayershots=i(),K.isdark=i(),K.exitnorth=i(),K.exitsouth=i(),K.exitwest=i(),K.exiteast=i(),K.restartonzap=i(),K.messagelength=i(),K.message=a(58).slice(0,K.messagelength),K.playerenterx=i(),K.playerentery=i(),K.timelimit=s(),r+=16;const W=s()+1;for(;K.stats.length<W;){const P={};P.x=i()-1,P.y=i()-1,P.stepx=s(),P.stepy=s(),P.cycle=s(),P.p1=i(),P.p2=i(),P.p3=i(),P.follower=s(),P.leader=s(),P.underelement=i(),P.undercolor=i(),P.pointer=o(),P.currentinstruction=s();const st=s();r+=8,st<0?P.bind=Math.abs(st):P.code=a(st),K.stats.push(P)}N.push(K),r=U+j}const E=bp([]);E.name=M;for(let L=0;L<N.length;++L){const j=N[L],U=[`@zztboard${L}`,""];L===0?U.push("@title"):L===A&&U.push("@zztstartboard");for(let Tt=0;Tt<j.elements.length;++Tt)j.elements[Tt].element===4&&(U.push(`@startx ${ry(Tt,sf)}`),U.push(`@starty ${ny(Tt,sf)}`));Et(j.maxplayershots)&&U.push(`@maxplayershots ${j.maxplayershots}`),Et(j.isdark)&&U.push(`@isdark ${j.isdark}`),Et(j.restartonzap)&&U.push(`@restartonzap ${j.restartonzap}`),Et(j.timelimit)&&U.push(`@timelimit ${j.timelimit}`);const q=d(j.exitnorth);yt(q)&&U.push(`@exitnorth ${q}`);const Q=d(j.exitsouth);yt(Q)&&U.push(`@exitsouth ${Q}`);const K=d(j.exitwest);yt(K)&&U.push(`@exitwest ${K}`);const W=d(j.exiteast);yt(W)&&U.push(`@exiteast ${W}`);const P=`@board ${String(L).padStart(3,"0")}. ${j.boardname}
${U.join(`
`)}`,st=ku(P,{});oc(E,st);const G=Ce(st);if(!w(G))continue;let rt=0,wt=0;for(let Tt=0;Tt<j.elements.length;++Tt){const It=j.elements[Tt];h(G,rt,wt,It,j.stats),++rt,rt===sf&&(rt=0,++wt)}Le(G)}Vu(E),Tc(lt,e,`imported zzt file into ${E.name} book`)}function v7(e,t){const r=Ix();if(!w(r))return;const n=ku(t,{}),i=be(n);oc(r,n),Tc(lt,e,`imported zzt obj file ${i} into ${r.name} book`)}function eA(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return p7.getType(e)??"application/octet-stream"}function rA(e,t){if(!w(t))return"";switch(e){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(t.name))return"zzt";if(/.brd$/i.test(t.name))return"brd";if(/.zzl$/i.test(t.name))return"zzl";if(/.zzm$/i.test(t.name))return"zzm";break}return""}let ta=[],of={};async function E7(e,t){try{Re(lt,e,"parsezipfile",t.name);const r=await t.arrayBuffer(),i=await new T0().loadAsync(r);ta=[],of={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],l=await c.async("uint8array"),u=eA(a,l),h=new File([l],c.name,{type:u});ta.push(h)}YT(lt,e)}catch(r){_e(lt,e,"crash",r.message)}}function k7(){const e=[];for(let t=0;t<ta.length;++t){const r=ta[t];e.push([rA(r.type,r),r.name])}return e}function x7(e,t){of[e.toLowerCase()]=t}function A7(e){return of[e.toLowerCase()]}async function T7(e){for(let t=0;t<ta.length;++t){const r=ta[t];of[r.name.toLowerCase()]&&(R0(e,r),await Oc(2e3))}await Oc(2e3),Af(lt,e)}function nA(e,t,r){if(!w(r))return;switch(rA(t,r)){case"obj":r.text().then(i=>v7(e,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"txt":r.text().then(i=>Tf(lt,e,void 0,"text",`file:${r.name}`,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"json":r.text().then(i=>Tf(lt,e,void 0,"json",`file:${r.name}`,i)).catch(i=>_e(lt,e,"crash",i.message));break;case"zip":E7(e,r).catch(i=>_e(lt,e,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{w7(e,new Uint8Array(i))}).catch(i=>_e(lt,e,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>_e(lt,e,"crash",i.message));break;case"zzl":r.text().then(i=>{m7(e,i)}).catch(i=>_e(lt,e,"crash",i.message));break;case"zzm":r.text().then(i=>{_7(e,i)}).catch(i=>_e(lt,e,"crash",i.message));break;default:t||r.arrayBuffer().then(i=>{const s=eA(r.name,new Uint8Array(i));if(s)nA(e,s,r);else return _e(lt,e,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>_e(lt,e,"crash",i.message));return}}function R0(e,t){nA(e,(t==null?void 0:t.type)??"",t)}const af="https://bridge.zed.cafe";async function S7(e,t,r){const n=`offset=${r}&${e}=${t}`,i=new Request(`${af}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function R7(){const e=new Request(`${af}/api/v1/get/random-file/`);return[(await(await fetch(e)).json()).data]}function O7(e){return`${af}/static/${e}`}async function I7(e,t){const n=await(await fetch(`${af}/zgames/${t}`)).arrayBuffer(),i=new File([n],t);R0(e,i)}function en(e,t,r){r().catch(n=>{console.error(n),_e(e,t,"crash",n==null?void 0:n.message)})}function N7(e){const[t,r]=e.split(":"),n=w(r);return[n?t:"self",n?r:e]}function C7(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-t.length%4)%4);return t+r}function L7(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const M7=new Date("1980/09/02");async function O0(e){return console.info("saved",e),new Promise((t,r)=>{const n=new T0;for(let i=0;i<e.length;++i){const s=e[i],o=xF(s);if(o){const a=$C(o);w(a)&&n.file(s.id,a,{date:M7})}}n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(L7(i))}).catch(r)})}async function U7(e){return new Promise((t,r)=>{const n=new T0,i=C7(e);n.loadAsync(i,{base64:!0}).then(async()=>{const s=[],o=[];n.forEach((a,c)=>o.push(c));for(let a=0;a<o.length;++a){const c=o[a],l=await c.async("uint8array"),u=U_(l);if(w(u)){const h=KE(u);w(h)&&s.push(h)}else{const h=await c.async("string"),d=U_(h);if(w(d)){const f=KE(d);w(f)&&s.push(f)}}}t(s)}).catch(r)})}function P7(e,t,r,n){const i=Ve(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Et(u)&&(s=u,iy(t.x,t.y,r.x,r.y).forEach(h=>{const d=fe(i,h);w(d)&&(d[l]=u)}))}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,`batch:${bo(t,r)}`,"char",[n,"charedit"],o,a);const c=Pe(e);c.scrollname="bulk set char",c.scroll=lr(e)}function F7(e,t,r,n){const i=Ve(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){if(Et(u)){s=u;for(let h=t.y;h<=r.y;++h)for(let d=t.x;d<=r.x;++d){const f=fe(i,{x:d,y:h});w(f)&&(f[l]=u)}}}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,`batch:${bo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Pe(e);c.scrollname="bulk set color",c.scroll=lr(e)}function $7(e,t,r,n){const i=Ve(e);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Et(u)&&(s=u,iy(t.x,t.y,r.x,r.y).forEach(h=>{const d=fe(i,h);w(d)&&(d[l]=u)}))}Nt(e,`batch chars: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,`batch:${bo(t,r)}`,"color",[n,"coloredit"],o,a);const c=Pe(e);c.scrollname="bulk set bg",c.scroll=lr(e)}function B7(e,t,r,n){const i=_r(Vt.MAIN);if(!w(i))return;const s=Ve(e);if(!w(s))return;const o=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),$t(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&$t(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),$t(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),$t(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Nt(e,Ze),$t(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),$t(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),$t(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Nt(e,Ze),$t(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Nt(e,Ze),Nt(e,"codepages:");const a=Math.min(t.x,r.x),c=Math.min(t.y,r.y),l=Math.max(t.x,r.x),u=Math.max(t.y,r.y),h=new Set;for(let f=c;f<=u;++f)for(let p=a;p<=l;++p){const m=fe(s,{x:p,y:f}),g=VE(i,m);w(g)&&!h.has(g.id)&&(h.add(g.id),$t(e,"batch",`edit @${be(g)}`,[`pageopen:${g.id}`]))}const d=tn(vt.BOARD,s.id);Nt(e,be(d)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}function I0(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function D7(e,t){let r;const n=()=>{if(r)return r;const i=indexedDB.open(e);return i.onupgradeneeded=()=>i.result.createObjectStore(t),r=I0(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(t,i).objectStore(t)))}let N0;function iA(){return N0||(N0=D7("keyval-store","keyval")),N0}function sA(e,t=iA()){return t("readonly",r=>I0(r.get(e)))}function oA(e,t,r=iA()){return r("readwrite",n=>new Promise((i,s)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),i(I0(n.transaction))}catch(o){s(o)}}}))}function C0(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function aA(){return sA("secretheap")}async function cA(e){return oA("secretheap",e)}async function j7(){return!!await aA()}function lA(e,t,r){const n=Math.min(t.x,r.x),i=Math.min(t.y,r.y),s=Math.max(t.x,r.x),o=Math.max(t.y,r.y),a=s-n+1,c=o-i+1,l=[],u=[];for(let h=i;h<=o;++h)for(let d=n;d<=s;++d){const f={x:d-n,y:h-i},p=fe(e,{x:d,y:h});(p==null?void 0:p.category)===Nr.ISOBJECT?(l.push(Yn(us(e,d,h))),gr(p).name!=="player"&&u.push({...Yn(p),...f,id:"blank"})):l.push({...Yn(p),...f})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function z7(e,t,r,n){const i=Ve(e);if(!w(i))return;const s=lA(i,t,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await cA(()=>s)}function W7(e,t,r){const n=C0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),$t(e,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),$t(e,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Pe(e);i.scrollname="copy",i.scroll=lr(e)}async function H7(e,t,r,n){const i=_r(Vt.MAIN);if(!w(i))return;const s=Ve(e);if(!w(s))return;const o=lA(s,t,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const l=fe(s,{x:c,y:a});(l==null?void 0:l.category)===Nr.ISOBJECT&&Ir(s,l,i.timestamp),Ue(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c){const l=fe(s,{x:c,y:a});(l==null?void 0:l.category)===Nr.ISOBJECT&&Ir(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=r.y;++a)for(let c=t.x;c<=r.x;++c)Ue(s,{x:c,y:a});break}}await cA(()=>o)}function G7(e,t,r){const n=C0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),$t(e,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),$t(e,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Pe(e);i.scrollname="cut",i.scroll=lr(e)}async function K7(e,t,r,n){const i=Ve(e),s=await aA();if(!w(i)||!w(s))return;const o=Math.min(t.x,r.x),a=Math.min(t.y,r.y),c=Math.max(t.x,r.x),l=Math.max(t.y,r.y),u=c-o+1,h=l-a+1,d=Math.min(s.width,u),f=Math.min(s.height,h);switch(n){case"pasteall":{for(let p=0;p<f;++p)for(let m=0;m<d;++m){const g=Wr({x:m,y:p},s.width);Ue(i,{...s.terrain[g],x:o+m,y:a+p})}for(let p=0;p<s.objects.length;++p){const m=s.objects[p];w(m.x)&&w(m.y)&&kh(m.x,m.y,0,u-1,h-1,0)&&v0(i,{...m,id:void 0,x:o+m.x,y:a+m.y})}break}case"pasteobjects":for(let p=0;p<s.objects.length;++p){const m=s.objects[p];w(m.x)&&w(m.y)&&kh(m.x,m.y,0,u-1,h-1,0)&&v0(i,{...m,id:void 0,x:o+m.x,y:a+m.y})}break;case"pasteterrain":for(let p=0;p<f;++p)for(let m=0;m<d;++m){const g=Wr({x:m,y:p},s.width);Ue(i,{...s.terrain[g],x:o+m,y:a+p})}break;case"pasteterraintiled":for(let p=a;p<=l;++p)for(let m=o;m<=c;++m){const g=(m-o)%s.width,y=(p-a)%s.height,b=Wr({x:g,y},s.width);Ue(i,{...s.terrain[b],x:m,y:p})}break}}function Y7(e,t,r){const n=C0(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),$t(e,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),$t(e,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),$t(e,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Pe(e);i.scrollname="paste",i.scroll=lr(e)}function L0(e,t){return`inspect:${t!=null&&t.id?t.id:Di(e,t)}`}function q7(e,t,r){const n=_r(Vt.MAIN);if(!w(n))return;const i=Ve(e);if(!w(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===Nr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=L0(i,t);Nt(e,`${a}: ${c} ${l}`),Nt(e,Ze),$t(e,u,"color",[r,"coloredit"],s,o);const h=Pe(e);h.scrollname="color",h.scroll=lr(e)}function V7(e,t,r){const n=_r(Vt.MAIN);if(!w(n))return;const i=Ve(e);if(!w(i))return;function s(d){var p;return(t==null?void 0:t[d])??((p=t==null?void 0:t.kinddata)==null?void 0:p[d])??0}function o(d,f){w(t)&&(t[d]=f)}const a=t.category===Nr.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=L0(i,t);Nt(e,`${a}: ${c} ${l}`),Nt(e,Ze),$t(e,u,"char",[r,"charedit"],s,o);const h=Pe(e);h.scrollname="char",h.scroll=lr(e)}function X7(e,t,r,n,i,s){var p,m,g;const o=_r(Vt.MAIN);if(!w(o))return;function a(y){var A;const b=(n==null?void 0:n[y])??((A=n==null?void 0:n.kinddata)==null?void 0:A[y]);if(!w(b))switch(y){case"color":return 15;case"bg":return 0;case"cycle":return cm;case"collision":return Wt.ISWALK;case"pushable":return 0;case"breakable":return 0}return b}function c(y,b){w(n)&&(n[y]=b)}s?Nt(e,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Nt(e,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const l=L0(t,n);switch(s&&Nt(e,`cycle: ${Jt(n,"cycle")}`),Jt(n,"collision")){case Wt.ISWALK:Nt(e,"collision: iswalk");break;case Wt.ISSWIM:Nt(e,"collision: isswim");break;case Wt.ISSOLID:Nt(e,"collision: issolid");break;case Wt.ISBULLET:Nt(e,"collision: isbullet");break;case Wt.ISGHOST:Nt(e,"collision: isghost");break}if(s){const y=Jt(n,"pushable");Nt(e,`ispushable: ${y||"no"}`)}Nt(e,`isbreakable: ${Jt(n,"breakable")?"yes":"no"}`),Nt(e,Ze);const h=ic(r),d=jr(h);for(let y=0;y<d.length;++y){const b=d[y];switch(b){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(pe(h[b])){const[A,T,...k]=h[b];yt(T)&&$t(e,l,T||b,[b,A,...k],a,c)}break}}$t(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Nt(e,Ze),$t(e,l,`char: ${n.char??((p=n.kinddata)==null?void 0:p.char)??1}`,["char","hk","a"," A ","next"],a,c),$t(e,l,`color: ${n.color??((m=n.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),$t(e,l,`bg: ${n.bg??((g=n.kinddata)==null?void 0:g.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Nt(e,Ze),$t(e,l,"make empty",["empty","hk","0"],a,c),Nt(e,Ze),$t(e,"batch",`edit @${be(r)}`,[`pageopen:${r.id}`]);const f=tn(vt.BOARD,t.id);Nt(e,be(f)),$t(e,"batch",`id ${t.id}`,["","copyit",t.id]),$t(e,"batch","edit @board codepage",[`pageopen:${t.id}`])}function J7(e,t,r,n){const i=_r(Vt.MAIN);if(!w(i))return;const s=Ve(e);if(w(s))switch(n){case"emptyall":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=fe(s,{x:a,y:o});(c==null?void 0:c.category)===Nr.ISOBJECT&&Ir(s,c,i.timestamp),Ue(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a){const c=fe(s,{x:a,y:o});(c==null?void 0:c.category)===Nr.ISOBJECT&&Ir(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=r.y;++o)for(let a=t.x;a<=r.x;++a)Ue(s,{x:a,y:o});break}}}function Z7(e,t,r){const n=_r(Vt.MAIN);if(!w(n))return;const i=Ve(e);if(!w(i))return;const s=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze),$t(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),$t(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),$t(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Pe(e);o.scrollname="empty",o.scroll=lr(e)}async function Q7(e,t,r){const n=_r(Vt.MAIN),i=await j7();if(!w(n))return;const s=Ve(e);if(!w(s))return;if(Le(s),t.x===r.x&&t.y===r.y){const a=fe(s,t),c=VE(n,a);if(w(a)&&w(c)&&X7(e,s,c,a,t,Ye(a)),!(a!=null&&a.kind)){Nt(e,`empty: ${t.x}, ${t.y}`),Nt(e,Ze),$t(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]);const l=tn(vt.BOARD,s.id);Nt(e,be(l)),$t(e,"batch",`id ${s.id}`,["","copyit",s.id]),$t(e,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else B7(e,t,r,i);const o=Pe(e);o.scrollname="inspect",o.scroll=lr(e)}function tW(e,t){const r=ge(Vt.MAIN);if(!w(r))return;const n=Ve(t);if(!w(n))return;const i=zr(e),s=Gx(n,i.target);if(w(s))switch(i.path){case"copycoords":kf(lt,$r(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":q7(t,s,i.path);break;case"char":V7(t,s,i.path);break;case"empty":Ir(n,s,r.timestamp);break;case"code":en(lt,t,async()=>{const o=gr(s),a="object";Re(lt,t,`opened [${a}] ${o.name}`);const c=[n.id,s.id];Eh(Sc(r.id,c),s.code??""),kT(lt,t),await Oc(800),sm(lt,t,r.id,c,a,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function eW(e,t){const r=Ve(t);if(!w(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":W7(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await z7(t,c,l,n.target);break;case"cut":G7(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await H7(t,c,l,n.target);break;case"paste":Y7(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await K7(t,c,l,n.target);break;case"empty":Z7(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":J7(t,c,l,n.target);break;case"chars":P7(t,c,l,"char");break;case"colors":F7(t,c,l,"color");break;case"bgs":$7(t,c,l,"bg");break;case"copycoords":kf(lt,t,[i,s,o,a].join(" "));break;case"pageopen":en(lt,t,async()=>{await Oc(800),qT(lt,t,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function rW(){return sA("remixconfig")}async function nW(e){return oA("remixconfig",e)}let fs={stat:"",patternsize:2,mirror:1};async function iW(e,t){const r=Ve(t);if(!w(r))return;const n=zr(e),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await sW(t,c,l);break}case"remixrun":{const u=br(fs.stat);w(u)&&Bk(r.id,u.id,fs.patternsize,fs.mirror,c,l,"all"),await nW(()=>fs);break}default:console.info("unknown remix",n);break}}async function sW(e,t,r){const n=await rW();fs={...fs,...n};const i=bo(t,r);Nt(e,`selected: ${t.x},${t.y} - ${r.x},${r.y}`),Nt(e,Ze);function s(c){const{target:l}=zr(c);return fs[l]}function o(c,l){if(Et(l)||yt(l)){const{target:u}=zr(c);fs[u]=l}}$t(e,"remix","source board",[`stat:${i}`,"text"],s,o),$t(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),$t(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Nt(e,Ze),$t(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Pe(e);a.scrollname="remix",a.scroll=lr(e)}const oW=16,hs={},cf={},aW=60;let uA=0;const ea={},ra={};async function fA(e){const t=Sn(),r=ge(Vt.MAIN);if(t.length&&w(r)){const n=await O0(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;TT(Qt,$r(),i,n)}}async function cW(){const e=Sn(),t=ge(Vt.MAIN);if(e.length&&w(t)){const r=await O0(e);ST(Qt,$r(),r)}}async function lW(){const e=Sn(),t=ge(Vt.MAIN);return e.length&&w(t)?O0(e):""}const hA="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function dA(e){Nt(e,`Searching ${"$6".repeat(_n(1,6))}`);const t=Pe(e);t.scrollname=hA,t.scroll=lr(e)}function pA(e,t){for(let n=0;n<e.length;++n){const i=e[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Nt(t,`$white${i.title}`),Nt(t,`$yellow  ${i.author.join(", ")}`),Nt(t,`$dkgreen  ${i.genres.join(", ")}`),Nt(t,`$purple  ${s}`),i.screenshot&&$t(t,"zztbridge",i.screenshot,["screenshot","viewit",O7(i.screenshot)]),$t(t,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Nt(t," ")}const r=Pe(t);r.scrollname=hA,r.scroll=lr(t)}const lf={},Qt=Zs("vm",["tick","second"],e=>{var r;if(!Qt.session(e))return;const t=$r();switch(e.target){case"operator":Cz(e.player),Re(Qt,e.player,`operator set to ${e.player}`),Qt.replynext(e,"ackoperator",!0);break;case"zsswords":{const n=ge(Vt.MAIN);Qt.replynext(e,"ackzsswords",{cli:Hp(is.CLI),loader:Hp(is.LOADER),runtime:Hp(is.RUNTIME),flags:[...jr(In(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...js(n,vt.OBJECT).map(i=>be(i)),...jr(zp)],altkinds:[...js(n,vt.TERRAIN),...js(n,vt.BOARD),...js(n,vt.PALETTE),...js(n,vt.CHARSET),...js(n,vt.LOADER)].map(i=>be(i)),colors:[...jr(ka)],dirs:[...jr(Ih).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...jr(Dp)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&en(Qt,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data,s=await U7(n),o=s.map(a=>a.name);Bz(s,i),Re(Qt,e.player,`loading ${o.join(", ")}`),Ef(Qt,e.player)}});break;case"search":zz(e.player)||Ef(Qt,e.player);break;case"logout":jz(e.player),delete hs[e.player],Re(Qt,t,`player ${e.player} logout`),Ef(Qt,e.player);break;case"login":Ux(e.player)?(xT(Qt,e.player),hs[e.player]=0,Re(Qt,$r(),`login from ${e.player}`),Qt.replynext(e,"acklogin",!0)):em(Qt,e.player);break;case"local":Ux(e.player)?(hs[e.player]=0,Re(Qt,$r(),`login from ${e.player}`)):em(Qt,e.player);break;case"doot":hs[e.player]=0,cf[e.player]=cf[e.player]??0,cf[e.player]%32===0&&Re(Qt,e.player,`$whiteactive $blue${e.player}`),++cf[e.player];break;case"input":{if(e.player.includes("local")&&!Lx(e.player)&&KT(Qt,e.player),!e.player.includes("local")||Lx(e.player)){const n=In(e.player),[i=Lr.NONE,s=0]=e.data??[Lr.NONE,0];pe(n.inputqueue)||(n.inputqueue=[]),i!==Lr.NONE&&n.inputqueue.push([i,s])}break}case"codewatch":if(pe(e.data)){const[n,i]=e.data,s=Sc(n,i);w(ra[s])||(ra[s]=ty(s,o=>{const[a,c]=i,l=Gn(n),u=Ds(l,a);if(w(u))if(pi(u)===vt.BOARD&&w(c)){const h=Ce(u),d=Br(h,c);w(d)&&(d.code=o,Au(_p(o),d))}else u.code=o,vF(u)})),ea[s]=ea[s]??new Set,ea[s].add(e.player)}break;case"coderelease":if(pe(e.data)){const[n,i]=e.data,[,s]=i,o=Sc(n,i);w(ea[o])&&(ea[o].delete(e.player),ea[o].size===0&&((r=ra[o])==null||r.call(ra),ra[o]=void 0,yt(s)&&Kz(s)))}break;case"halt":e.player===t&&oT(e.data)&&Lz(e.data);break;case"tick":{qz(Mz());const n=jr(lf);for(let i=0;i<n.length;++i){const s=n[i];--lf[s]}break}case"synthsend":if(yt(e.data)){const n=e.data,[i,s]=N7(n),o=lf[n];if(!w(o)||o<=0){lf[n]=2;const a=ge(Vt.MAIN);Jo(i,s,void 0,Do(a))}}break;case"second":{Wz(hs);const n=Object.keys(hs);for(let i=0;i<n.length;++i)++hs[n[i]];for(let i=0;i<n.length;++i){const s=n[i];hs[s]>=oW&&Af(Qt,s)}++uA>=aW&&(uA=0,en(Qt,e.player,async()=>{await fA(!0)}));break}case"copyjsonfile":if(e.player===t){const n=ge(Vt.MAIN);if(w(n)&&pe(e.data)){const[i]=e.data,s=Ds(n,i);w(s)&&OT(Qt,t,s,`${be(s)}.${mi(s)}.json`)}}break;case"refscroll":{$t(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),$t(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),$t(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const n=Pe(e.player);n.scrollname="refscroll",n.scroll=lr(e.player);break}case"readzipfilelist":{const n=k7();Nt(e.player,"$CENTER Select Files"),$t(e.player,"zipfilelist","import selected",["importfiles"]);for(let s=0;s<n.length;++s){const[o,a]=n[s];$t(e.player,"zipfilelist",`[${o}] ${a}`,[Dt(a),"select","NO","0","YES","1"],c=>A7(c)?1:0,(c,l)=>{x7(c,!!l)})}const i=Pe(e.player);i.scrollname="zipfilelist",i.scroll=lr(e.player);break}case"fork":e.player===t&&en(Qt,e.player,async()=>{await cW()});break;case"zztsearch":en(Qt,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data;let s=0;const o=[];for(;o.length<256;){dA(e.player);const a=await S7(n,i,s);if(s+=a.length,o.push(...a),a.length<25)break}pA(o,e.player)}});break;case"zztrandom":en(Qt,e.player,async()=>{dA(e.player);const n=await R7();pA(n,e.player)});break;case"itchiopublish":en(Qt,e.player,async()=>{if(e.player===t){const n=ge(Vt.MAIN);if(w(n)){const i=await lW();RT(Qt,e.player,n.name,i)}}});break;case"flush":e.player===t&&en(Qt,e.player,async()=>{await fA()});break;case"cli":$x(e.player,e.data);break;case"clirepeatlast":Vz(e.player);break;case"restart":e.player===t&&(Yz(),am(Qt,e.player));break;case"inspect":en(Qt,e.player,async()=>{if(pe(e.data)){const[n,i]=e.data;await Q7(e.player,n,i)}});break;case"loader":if(pe(e.data)){const[n,i,s,o]=e.data;switch(i){case"file":R0(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){Re(Qt,e.player,`loading ${s}`);const a=JSON.parse(o.json);w(a.data)&&yt(a.exported)&&(Vu(a.data),Re(Qt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){Re(Qt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ge(Vt.MAIN);w(c)&&w(a.data)&&yt(a.exported)&&(oc(c,a.data),Re(Qt,e.player,`loaded ${a.exported}`))}else Ok(n,i,s,o,e.player);break;default:Ok(n,i,s,o,e.player);break}}break;default:{const{target:n,path:i}=zr(e.target);switch(Dt(n)){case"refscroll":switch(i){case"charscroll":{$t(e.player,"refscroll","char",["char","charedit"]);const s=Pe(e.player);s.scrollname="chars",s.scroll=lr(e.player);break}case"colorscroll":{$t(e.player,"refscroll","color",["color","coloredit"]);const s=Pe(e.player);s.scrollname="colors",s.scroll=lr(e.player);break}case"notesscroll":{Nt(e.player,"duration             cdefgab - notes "),Nt(e.player,"y - 64th note        x - rest"),Nt(e.player,"t - 32nd note        "),Nt(e.player,"s - 16th note.       drums"),Nt(e.player,"i - eight note.      0 - tick"),Nt(e.player,"q - quarter note     1 - tweet"),Nt(e.player,"h - half note        2 - cowbell"),Nt(e.player,"w - whole note       p - clap"),Nt(e.player,"                     4 - high snare"),Nt(e.player,"mods                 5 - high woodblock"),Nt(e.player,"3 - triplet          6 - low snare"),Nt(e.player,". - time and a half  7 - low tom"),Nt(e.player,"# - sharp            8 - low woodblock"),Nt(e.player,"! - flat             9 - bass drum");const s=Pe(e.player);s.scrollname="music notation",s.scroll=lr(e.player);break}}break;case"batch":en(Qt,e.player,async()=>{await eW(i,e.player)});break;case"remix":en(Qt,e.player,async()=>{await iW(i,e.player)});break;case"empty":{const s=zr(i);switch(s.target){case"copycoords":kf(Qt,$r(),s.path.split(",").join(" "));break}break}case"inspect":tW(i,e.player);break;case"touched":if(pe(e.data)){const[s,o,a]=e.data;Px({...e,target:`${o}:${a}`,data:void 0,sender:s})}break;case"zztbridge":en(Qt,e.player,async()=>{yt(e.data)&&await I7(e.player,e.data)});break;case"zipfilelist":en(Qt,e.player,async()=>{await T7(e.player)});break;default:{const s=zr(i);if(Dt(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Px(e);else{const o=ge(Vt.MAIN);Jo(s.target,s.path,void 0,Do(o))}break}}break}}},Nz());function uW(){AT(Qt)}const{forward:fW}=eS(e=>{rS(e)&&postMessage(e)});onmessage=function(t){fW(t.data)},setTimeout(uW,100)})();

var qEe=Object.defineProperty;var $Ee=t=>{throw TypeError(t)};var WEe=(t,e,n)=>e in t?qEe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Qn=(t,e,n)=>WEe(t,typeof e!="symbol"?e+"":e,n);var RR=(t,e,n)=>e.has(t)?$Ee("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function YEe(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Ll=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Xie(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Kie={exports:{}},KU={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XEe=Symbol.for("react.transitional.element"),KEe=Symbol.for("react.fragment");function Jie(t,e,n){var r=null;if(n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),"key"in e){n={};for(var i in e)i!=="key"&&(n[i]=e[i])}else n=e;return e=n.ref,{$$typeof:XEe,type:t,key:r,ref:e!==void 0?e:null,props:n}}KU.Fragment=KEe;KU.jsx=Jie;KU.jsxs=Jie;Kie.exports=KU;var Ae=Kie.exports;function JEe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zie={exports:{}},Fo=Zie.exports={},lg,ug;function Oj(){throw new Error("setTimeout has not been defined")}function Nj(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?lg=setTimeout:lg=Oj}catch{lg=Oj}try{typeof clearTimeout=="function"?ug=clearTimeout:ug=Nj}catch{ug=Nj}})();function Qie(t){if(lg===setTimeout)return setTimeout(t,0);if((lg===Oj||!lg)&&setTimeout)return lg=setTimeout,setTimeout(t,0);try{return lg(t,0)}catch{try{return lg.call(null,t,0)}catch{return lg.call(this,t,0)}}}function ZEe(t){if(ug===clearTimeout)return clearTimeout(t);if((ug===Nj||!ug)&&clearTimeout)return ug=clearTimeout,clearTimeout(t);try{return ug(t)}catch{try{return ug.call(null,t)}catch{return ug.call(this,t)}}}var Nv=[],sw=!1,NS,LD=-1;function QEe(){!sw||!NS||(sw=!1,NS.length?Nv=NS.concat(Nv):LD=-1,Nv.length&&ese())}function ese(){if(!sw){var t=Qie(QEe);sw=!0;for(var e=Nv.length;e;){for(NS=Nv,Nv=[];++LD<e;)NS&&NS[LD].run();LD=-1,e=Nv.length}NS=null,sw=!1,ZEe(t)}}Fo.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Nv.push(new tse(t,e)),Nv.length===1&&!sw&&Qie(ese)};function tse(t,e){this.fun=t,this.array=e}tse.prototype.run=function(){this.fun.apply(null,this.array)};Fo.title="browser";Fo.browser=!0;Fo.env={};Fo.argv=[];Fo.version="";Fo.versions={};function dy(){}Fo.on=dy;Fo.addListener=dy;Fo.once=dy;Fo.off=dy;Fo.removeListener=dy;Fo.removeAllListeners=dy;Fo.emit=dy;Fo.prependListener=dy;Fo.prependOnceListener=dy;Fo.listeners=function(t){return[]};Fo.binding=function(t){throw new Error("process.binding is not supported")};Fo.cwd=function(){return"/"};Fo.chdir=function(t){throw new Error("process.chdir is not supported")};Fo.umask=function(){return 0};var eSe=Zie.exports;const zn=JEe(eSe);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const XO="176",tSe={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},nSe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},nse=0,Ij=1,rse=2,rSe=3,ise=0,JU=1,AA=2,jp=3,Lg=0,Pc=1,ll=2,Zf=0,FS=1,kj=2,Dj=3,Pj=4,sse=5,B_=100,ase=101,ose=102,cse=103,lse=104,use=200,hse=201,dse=202,fse=203,XP=204,KP=205,pse=206,mse=207,gse=208,vse=209,yse=210,_se=211,bse=212,Ese=213,Sse=214,JP=0,ZP=1,QP=2,nT=3,eL=4,tL=5,nL=6,rL=7,KO=0,Tse=1,xse=2,em=0,wse=1,Cse=2,Rse=3,fq=4,Ase=5,Mse=6,Ose=7,Lj="attached",Nse="detached",ZU=300,Jv=301,_b=302,vM=303,yM=304,DC=306,_M=1e3,qf=1001,bM=1002,Ja=1003,pq=1004,iSe=1004,N1=1005,sSe=1005,_a=1006,MA=1007,aSe=1007,_g=1008,oSe=1008,gl=1009,mq=1010,gq=1011,Lw=1012,QU=1013,Ug=1014,ru=1015,Bb=1016,e3=1017,t3=1018,rT=1020,vq=35902,yq=1021,_q=1022,iu=1023,Uw=1026,iT=1027,n3=1028,JO=1029,bq=1030,r3=1031,cSe=1032,ZO=1033,OA=33776,NA=33777,IA=33778,kA=33779,iL=35840,sL=35841,aL=35842,oL=35843,cL=36196,lL=37492,uL=37496,hL=37808,dL=37809,fL=37810,pL=37811,mL=37812,gL=37813,vL=37814,yL=37815,_L=37816,bL=37817,EL=37818,SL=37819,TL=37820,xL=37821,DA=36492,wL=36494,CL=36495,Eq=36283,RL=36284,AL=36285,ML=36286,Ise=2200,kse=2201,Dse=2202,EM=2300,OL=2301,UD=2302,IS=2400,kS=2401,SM=2402,i3=2500,Sq=2501,lSe=0,uSe=1,hSe=2,Fb=3200,Pse=3201,dSe=3202,fSe=3203,zb=0,Lse=1,Kp="",ya="srgb",Bg="srgb-linear",TM="linear",ws="srgb",pSe=0,mS=7680,mSe=7681,gSe=7682,vSe=7683,ySe=34055,_Se=34056,bSe=5386,ESe=512,SSe=513,TSe=514,xSe=515,wSe=516,CSe=517,RSe=518,Uj=519,Use=512,Bse=513,Fse=514,Tq=515,zse=516,Hse=517,jse=518,Vse=519,xM=35044,ASe=35048,MSe=35040,OSe=35045,NSe=35049,ISe=35041,kSe=35046,DSe=35050,PSe=35042,LSe="100",Bj="300 es",$f=2e3,wM=2001,USe={COMPUTE:"compute",RENDER:"render"},BSe={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},FSe={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FLAT_FIRST:"flat first",FLAT_EITHER:"flat either"};class Zd{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const r=n[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const Xl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let pX=1234567;const zS=Math.PI/180,Bw=180/Math.PI;function Gd(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Xl[t&255]+Xl[t>>8&255]+Xl[t>>16&255]+Xl[t>>24&255]+"-"+Xl[e&255]+Xl[e>>8&255]+"-"+Xl[e>>16&15|64]+Xl[e>>24&255]+"-"+Xl[n&63|128]+Xl[n>>8&255]+"-"+Xl[n>>16&255]+Xl[n>>24&255]+Xl[r&255]+Xl[r>>8&255]+Xl[r>>16&255]+Xl[r>>24&255]).toLowerCase()}function Xr(t,e,n){return Math.max(e,Math.min(n,t))}function xq(t,e){return(t%e+e)%e}function zSe(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function HSe(t,e,n){return t!==e?(n-t)/(e-t):0}function PA(t,e,n){return(1-n)*t+n*e}function jSe(t,e,n,r){return PA(t,e,1-Math.exp(-n*r))}function VSe(t,e=1){return e-Math.abs(xq(t,e*2)-e)}function GSe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function qSe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function $Se(t,e){return t+Math.floor(Math.random()*(e-t+1))}function WSe(t,e){return t+Math.random()*(e-t)}function YSe(t){return t*(.5-Math.random())}function XSe(t){t!==void 0&&(pX=t);let e=pX+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function KSe(t){return t*zS}function JSe(t){return t*Bw}function ZSe(t){return(t&t-1)===0&&t!==0}function QSe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function eTe(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function tTe(t,e,n,r,i){const s=Math.cos,a=Math.sin,o=s(n/2),c=a(n/2),l=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),p=a((r-e)/2);switch(i){case"XYX":t.set(o*u,c*h,c*d,o*l);break;case"YZY":t.set(c*d,o*u,c*h,o*l);break;case"ZXZ":t.set(c*h,c*d,o*u,o*l);break;case"XZX":t.set(o*u,c*p,c*f,o*l);break;case"YXY":t.set(c*f,o*u,c*p,o*l);break;case"ZYZ":t.set(c*p,c*f,o*u,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Yu(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ti(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const Gse={DEG2RAD:zS,RAD2DEG:Bw,generateUUID:Gd,clamp:Xr,euclideanModulo:xq,mapLinear:zSe,inverseLerp:HSe,lerp:PA,damp:jSe,pingpong:VSe,smoothstep:GSe,smootherstep:qSe,randInt:$Se,randFloat:WSe,randFloatSpread:YSe,seededRandom:XSe,degToRad:KSe,radToDeg:JSe,isPowerOfTwo:ZSe,ceilPowerOfTwo:QSe,floorPowerOfTwo:eTe,setQuaternionFromProperEuler:tTe,normalize:ti,denormalize:Yu};class Rt{constructor(e=0,n=0){Rt.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Xr(this.x,e.x,n.x),this.y=Xr(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Xr(this.x,e,n),this.y=Xr(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Xr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Xr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*i+e.x,this.y=s*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Zr{constructor(e,n,r,i,s,a,o,c,l){Zr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,a,o,c,l)}set(e,n,r,i,s,a,o,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,a=r[0],o=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],g=i[0],_=i[3],v=i[6],E=i[1],T=i[4],x=i[7],N=i[2],A=i[5],I=i[8];return s[0]=a*g+o*E+c*N,s[3]=a*_+o*T+c*A,s[6]=a*v+o*x+c*I,s[1]=l*g+u*E+h*N,s[4]=l*_+u*T+h*A,s[7]=l*v+u*x+h*I,s[2]=d*g+f*E+p*N,s[5]=d*_+f*T+p*A,s[8]=d*v+f*x+p*I,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],u=e[8];return n*a*u-n*o*l-r*s*u+r*o*c+i*s*l-i*a*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],u=e[8],h=u*a-o*l,d=o*c-u*s,f=l*s-a*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=h*g,e[1]=(i*l-u*r)*g,e[2]=(o*r-i*a)*g,e[3]=d*g,e[4]=(u*n-i*c)*g,e[5]=(i*s-o*n)*g,e[6]=f*g,e[7]=(r*c-l*n)*g,e[8]=(a*n-r*s)*g,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,a,o){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*a+l*o)+a+e,-i*l,i*c,-i*(-l*a+c*o)+o+n,0,0,1),this}scale(e,n){return this.premultiply(mz.makeScale(e,n)),this}rotate(e){return this.premultiply(mz.makeRotation(-e)),this}translate(e,n){return this.premultiply(mz.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const mz=new Zr;function qse(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const nTe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function I1(t,e){return new nTe[t](e)}function CM(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function $se(){const t=CM("canvas");return t.style.display="block",t}const mX={};function BD(t){t in mX||(mX[t]=!0,console.warn(t))}function rTe(t,e,n){return new Promise(function(r,i){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}setTimeout(s,n)})}function iTe(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function sTe(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const gX=new Zr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),vX=new Zr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function aTe(){const t={enabled:!0,workingColorSpace:Bg,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===ws&&(i.r=jv(i.r),i.g=jv(i.g),i.b=jv(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===ws&&(i.r=aw(i.r),i.g=aw(i.g),i.b=aw(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Kp?TM:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[Bg]:{primaries:e,whitePoint:r,transfer:TM,toXYZ:gX,fromXYZ:vX,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:ya},outputColorSpaceConfig:{drawingBufferColorSpace:ya}},[ya]:{primaries:e,whitePoint:r,transfer:ws,toXYZ:gX,fromXYZ:vX,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:ya}}}),t}const Li=aTe();function jv(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function aw(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let Px;class Wse{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{Px===void 0&&(Px=CM("canvas")),Px.width=e.width,Px.height=e.height;const i=Px.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=Px}return r.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=CM("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=jv(s[a]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(jv(n[r]/255)*255):n[r]=jv(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let oTe=0,q_=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:oTe++}),this.uuid=Gd(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(gz(i[a].image)):s.push(gz(i[a]))}else s=gz(i);r.url=s}return n||(e.images[this.uuid]=r),r}};function gz(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?Wse.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let cTe=0;class Pa extends Zd{constructor(e=Pa.DEFAULT_IMAGE,n=Pa.DEFAULT_MAPPING,r=qf,i=qf,s=_a,a=_g,o=iu,c=gl,l=Pa.DEFAULT_ANISOTROPY,u=Kp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cTe++}),this.uuid=Gd(),this.name="",this.source=new q_(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=c,this.offset=new Rt(0,0),this.repeat=new Rt(1,1),this.center=new Rt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ZU)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _M:e.x=e.x-Math.floor(e.x);break;case qf:e.x=e.x<0?0:1;break;case bM:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case _M:e.y=e.y-Math.floor(e.y);break;case qf:e.y=e.y<0?0:1;break;case bM:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Pa.DEFAULT_IMAGE=null;Pa.DEFAULT_MAPPING=ZU;Pa.DEFAULT_ANISOTROPY=1;class Ki{constructor(e=0,n=0,r=0,i=1){Ki.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*n+a[4]*r+a[8]*i+a[12]*s,this.y=a[1]*n+a[5]*r+a[9]*i+a[13]*s,this.z=a[2]*n+a[6]*r+a[10]*i+a[14]*s,this.w=a[3]*n+a[7]*r+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],f=c[5],p=c[9],g=c[2],_=c[6],v=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-_)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+_)<.1&&Math.abs(l+f+v-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const T=(l+1)/2,x=(f+1)/2,N=(v+1)/2,A=(u+d)/4,I=(h+g)/4,k=(p+_)/4;return T>x&&T>N?T<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(T),i=A/r,s=I/r):x>N?x<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(x),r=A/i,s=k/i):N<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(N),r=I/s,i=k/s),this.set(r,i,s,n),this}let E=Math.sqrt((_-p)*(_-p)+(h-g)*(h-g)+(d-u)*(d-u));return Math.abs(E)<.001&&(E=1),this.x=(_-p)/E,this.y=(h-g)/E,this.z=(d-u)/E,this.w=Math.acos((l+f+v-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Xr(this.x,e.x,n.x),this.y=Xr(this.y,e.y,n.y),this.z=Xr(this.z,e.z,n.z),this.w=Xr(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=Xr(this.x,e,n),this.y=Xr(this.y,e,n),this.z=Xr(this.z,e,n),this.w=Xr(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Xr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class s3 extends Zd{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=r.depth?r.depth:1,this.scissor=new Ki(0,0,e,n),this.scissorTest=!1,this.viewport=new Ki(0,0,e,n);const i={width:e,height:n,depth:this.depth};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:_a,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},r);const s=new Pa(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const i=Object.assign({},e.textures[n].image);this.textures[n].source=new q_(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ul extends s3{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class QO extends Pa{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Ja,this.minFilter=Ja,this.wrapR=qf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class lTe extends Ul{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new QO(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class a3 extends Pa{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Ja,this.minFilter=Ja,this.wrapR=qf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class uTe extends Ul{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new a3(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class qh{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,s,a,o){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const d=s[a+0],f=s[a+1],p=s[a+2],g=s[a+3];if(o===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h;return}if(o===1){e[n+0]=d,e[n+1]=f,e[n+2]=p,e[n+3]=g;return}if(h!==g||c!==d||l!==f||u!==p){let _=1-o;const v=c*d+l*f+u*p+h*g,E=v>=0?1:-1,T=1-v*v;if(T>Number.EPSILON){const N=Math.sqrt(T),A=Math.atan2(N,v*E);_=Math.sin(_*A)/N,o=Math.sin(o*A)/N}const x=o*E;if(c=c*_+d*x,l=l*_+f*x,u=u*_+p*x,h=h*_+g*x,_===1-o){const N=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=N,l*=N,u*=N,h*=N}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=h}static multiplyQuaternionsFlat(e,n,r,i,s,a){const o=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[a],d=s[a+1],f=s[a+2],p=s[a+3];return e[n]=o*p+u*h+c*f-l*d,e[n+1]=c*p+u*d+l*h-o*f,e[n+2]=l*p+u*f+o*d-c*h,e[n+3]=u*p-o*h-c*d-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,c=Math.sin,l=o(r/2),u=o(i/2),h=o(s/2),d=c(r/2),f=c(i/2),p=c(s/2);switch(a){case"XYZ":this._x=d*u*h+l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h+d*f*p;break;case"YZX":this._x=d*u*h+l*f*p,this._y=l*f*h+d*u*p,this._z=l*u*p-d*f*h,this._w=l*u*h-d*f*p;break;case"XZY":this._x=d*u*h-l*f*p,this._y=l*f*h-d*u*p,this._z=l*u*p+d*f*h,this._w=l*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],s=n[8],a=n[1],o=n[5],c=n[9],l=n[2],u=n[6],h=n[10],d=r+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(a-i)*f}else if(r>o&&r>h){const f=2*Math.sqrt(1+r-o-h);this._w=(u-c)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(s+l)/f}else if(o>h){const f=2*Math.sqrt(1+o-r-h);this._w=(s-l)/f,this._x=(i+a)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+h-r-o);this._w=(a-i)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Xr(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,s=e._z,a=e._w,o=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+a*o+i*l-s*c,this._y=i*u+a*c+s*o-r*l,this._z=s*u+a*l+r*c-i*o,this._w=a*u-r*o-i*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+i*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=i,this._z=s,this;const c=1-o*o;if(c<=Number.EPSILON){const f=1-n;return this._w=f*a+n*this._w,this._x=f*r+n*this._x,this._y=f*i+n*this._y,this._z=f*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,o),h=Math.sin((1-n)*u)/l,d=Math.sin(n*u)/l;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=i*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Re{constructor(e=0,n=0,r=0){Re.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(yX.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(yX.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=e.elements,a=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*a,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*a,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*a,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,s=e.x,a=e.y,o=e.z,c=e.w,l=2*(a*i-o*r),u=2*(o*n-s*i),h=2*(s*r-a*n);return this.x=n+c*l+a*h-o*u,this.y=r+c*u+o*l-s*h,this.z=i+c*h+s*u-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Xr(this.x,e.x,n.x),this.y=Xr(this.y,e.y,n.y),this.z=Xr(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=Xr(this.x,e,n),this.y=Xr(this.y,e,n),this.z=Xr(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Xr(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,s=e.z,a=n.x,o=n.y,c=n.z;return this.x=i*c-s*o,this.y=s*a-r*c,this.z=r*o-i*a,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return vz.copy(this).projectOnVector(e),this.sub(vz)}reflect(e){return this.sub(vz.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Xr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const vz=new Re,yX=new qh;class cu{constructor(e=new Re(1/0,1/0,1/0),n=new Re(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Up.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Up.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Up.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Up):Up.fromBufferAttribute(s,a),Up.applyMatrix4(e.matrixWorld),this.expandByPoint(Up);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),FI.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),FI.copy(r.boundingBox)),FI.applyMatrix4(e.matrixWorld),this.union(FI)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Up),Up.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(AR),zI.subVectors(this.max,AR),Lx.subVectors(e.a,AR),Ux.subVectors(e.b,AR),Bx.subVectors(e.c,AR),n_.subVectors(Ux,Lx),r_.subVectors(Bx,Ux),qE.subVectors(Lx,Bx);let n=[0,-n_.z,n_.y,0,-r_.z,r_.y,0,-qE.z,qE.y,n_.z,0,-n_.x,r_.z,0,-r_.x,qE.z,0,-qE.x,-n_.y,n_.x,0,-r_.y,r_.x,0,-qE.y,qE.x,0];return!yz(n,Lx,Ux,Bx,zI)||(n=[1,0,0,0,1,0,0,0,1],!yz(n,Lx,Ux,Bx,zI))?!1:(HI.crossVectors(n_,r_),n=[HI.x,HI.y,HI.z],yz(n,Lx,Ux,Bx,zI))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Up).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Up).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(iv[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),iv[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),iv[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),iv[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),iv[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),iv[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),iv[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),iv[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(iv),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const iv=[new Re,new Re,new Re,new Re,new Re,new Re,new Re,new Re],Up=new Re,FI=new cu,Lx=new Re,Ux=new Re,Bx=new Re,n_=new Re,r_=new Re,qE=new Re,AR=new Re,zI=new Re,HI=new Re,$E=new Re;function yz(t,e,n,r,i){for(let s=0,a=t.length-3;s<=a;s+=3){$E.fromArray(t,s);const o=i.x*Math.abs($E.x)+i.y*Math.abs($E.y)+i.z*Math.abs($E.z),c=e.dot($E),l=n.dot($E),u=r.dot($E);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>o)return!1}return!0}const hTe=new cu,MR=new Re,_z=new Re;class Dl{constructor(e=new Re,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):hTe.setFromPoints(e).getCenter(r);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;MR.subVectors(e,this.center);const n=MR.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(MR,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(_z.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(MR.copy(e.center).add(_z)),this.expandByPoint(MR.copy(e.center).sub(_z))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const sv=new Re,bz=new Re,jI=new Re,i_=new Re,Ez=new Re,VI=new Re,Sz=new Re;class PC{constructor(e=new Re,n=new Re(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,sv)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=sv.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(sv.copy(this.origin).addScaledVector(this.direction,n),sv.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){bz.copy(e).add(n).multiplyScalar(.5),jI.copy(n).sub(e).normalize(),i_.copy(this.origin).sub(bz);const s=e.distanceTo(n)*.5,a=-this.direction.dot(jI),o=i_.dot(this.direction),c=-i_.dot(jI),l=i_.lengthSq(),u=Math.abs(1-a*a);let h,d,f,p;if(u>0)if(h=a*c-o,d=a*o-c,p=s*u,h>=0)if(d>=-p)if(d<=p){const g=1/u;h*=g,d*=g,f=h*(h+a*d+2*o)+d*(a*h+d+2*c)+l}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*c)+l;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*c)+l;else d<=-p?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-c),s),f=-h*h+d*(d+2*c)+l):d<=p?(h=0,d=Math.min(Math.max(-s,-c),s),f=d*(d+2*c)+l):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-c),s),f=-h*h+d*(d+2*c)+l);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(bz).addScaledVector(jI,d),f}intersectSphere(e,n){sv.subVectors(e.center,this.origin);const r=sv.dot(this.direction),i=sv.dot(sv)-r*r,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=r-a,c=r+a;return c<0?null:o<0?this.at(c,n):this.at(o,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,s,a,o,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(r=(e.min.x-d.x)*l,i=(e.max.x-d.x)*l):(r=(e.max.x-d.x)*l,i=(e.min.x-d.x)*l),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),r>a||s>i||((s>r||isNaN(r))&&(r=s),(a<i||isNaN(i))&&(i=a),h>=0?(o=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),r>c||o>i)||((o>r||r!==r)&&(r=o),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,sv)!==null}intersectTriangle(e,n,r,i,s){Ez.subVectors(n,e),VI.subVectors(r,e),Sz.crossVectors(Ez,VI);let a=this.direction.dot(Sz),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;i_.subVectors(this.origin,e);const c=o*this.direction.dot(VI.crossVectors(i_,VI));if(c<0)return null;const l=o*this.direction.dot(Ez.cross(i_));if(l<0||c+l>a)return null;const u=-o*i_.dot(Sz);return u<0?null:this.at(u/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Nr{constructor(e,n,r,i,s,a,o,c,l,u,h,d,f,p,g,_){Nr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,a,o,c,l,u,h,d,f,p,g,_)}set(e,n,r,i,s,a,o,c,l,u,h,d,f,p,g,_){const v=this.elements;return v[0]=e,v[4]=n,v[8]=r,v[12]=i,v[1]=s,v[5]=a,v[9]=o,v[13]=c,v[2]=l,v[6]=u,v[10]=h,v[14]=d,v[3]=f,v[7]=p,v[11]=g,v[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Nr().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,i=1/Fx.setFromMatrixColumn(e,0).length(),s=1/Fx.setFromMatrixColumn(e,1).length(),a=1/Fx.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*a,n[9]=r[9]*a,n[10]=r[10]*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*u,f=a*h,p=o*u,g=o*h;n[0]=c*u,n[4]=-c*h,n[8]=l,n[1]=f+p*l,n[5]=d-g*l,n[9]=-o*c,n[2]=g-d*l,n[6]=p+f*l,n[10]=a*c}else if(e.order==="YXZ"){const d=c*u,f=c*h,p=l*u,g=l*h;n[0]=d+g*o,n[4]=p*o-f,n[8]=a*l,n[1]=a*h,n[5]=a*u,n[9]=-o,n[2]=f*o-p,n[6]=g+d*o,n[10]=a*c}else if(e.order==="ZXY"){const d=c*u,f=c*h,p=l*u,g=l*h;n[0]=d-g*o,n[4]=-a*h,n[8]=p+f*o,n[1]=f+p*o,n[5]=a*u,n[9]=g-d*o,n[2]=-a*l,n[6]=o,n[10]=a*c}else if(e.order==="ZYX"){const d=a*u,f=a*h,p=o*u,g=o*h;n[0]=c*u,n[4]=p*l-f,n[8]=d*l+g,n[1]=c*h,n[5]=g*l+d,n[9]=f*l-p,n[2]=-l,n[6]=o*c,n[10]=a*c}else if(e.order==="YZX"){const d=a*c,f=a*l,p=o*c,g=o*l;n[0]=c*u,n[4]=g-d*h,n[8]=p*h+f,n[1]=h,n[5]=a*u,n[9]=-o*u,n[2]=-l*u,n[6]=f*h+p,n[10]=d-g*h}else if(e.order==="XZY"){const d=a*c,f=a*l,p=o*c,g=o*l;n[0]=c*u,n[4]=-h,n[8]=l*u,n[1]=d*h+g,n[5]=a*u,n[9]=f*h-p,n[2]=p*h-f,n[6]=o*u,n[10]=g*h+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(dTe,e,fTe)}lookAt(e,n,r){const i=this.elements;return xd.subVectors(e,n),xd.lengthSq()===0&&(xd.z=1),xd.normalize(),s_.crossVectors(r,xd),s_.lengthSq()===0&&(Math.abs(r.z)===1?xd.x+=1e-4:xd.z+=1e-4,xd.normalize(),s_.crossVectors(r,xd)),s_.normalize(),GI.crossVectors(xd,s_),i[0]=s_.x,i[4]=GI.x,i[8]=xd.x,i[1]=s_.y,i[5]=GI.y,i[9]=xd.y,i[2]=s_.z,i[6]=GI.z,i[10]=xd.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,a=r[0],o=r[4],c=r[8],l=r[12],u=r[1],h=r[5],d=r[9],f=r[13],p=r[2],g=r[6],_=r[10],v=r[14],E=r[3],T=r[7],x=r[11],N=r[15],A=i[0],I=i[4],k=i[8],L=i[12],U=i[1],$=i[5],q=i[9],G=i[13],X=i[2],re=i[6],V=i[10],Z=i[14],Y=i[3],ee=i[7],oe=i[11],de=i[15];return s[0]=a*A+o*U+c*X+l*Y,s[4]=a*I+o*$+c*re+l*ee,s[8]=a*k+o*q+c*V+l*oe,s[12]=a*L+o*G+c*Z+l*de,s[1]=u*A+h*U+d*X+f*Y,s[5]=u*I+h*$+d*re+f*ee,s[9]=u*k+h*q+d*V+f*oe,s[13]=u*L+h*G+d*Z+f*de,s[2]=p*A+g*U+_*X+v*Y,s[6]=p*I+g*$+_*re+v*ee,s[10]=p*k+g*q+_*V+v*oe,s[14]=p*L+g*G+_*Z+v*de,s[3]=E*A+T*U+x*X+N*Y,s[7]=E*I+T*$+x*re+N*ee,s[11]=E*k+T*q+x*V+N*oe,s[15]=E*L+T*G+x*Z+N*de,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],s=e[12],a=e[1],o=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],f=e[14],p=e[3],g=e[7],_=e[11],v=e[15];return p*(+s*c*h-i*l*h-s*o*d+r*l*d+i*o*f-r*c*f)+g*(+n*c*f-n*l*d+s*a*d-i*a*f+i*l*u-s*c*u)+_*(+n*l*h-n*o*f-s*a*h+r*a*f+s*o*u-r*l*u)+v*(-i*o*u-n*c*h+n*o*d+i*a*h-r*a*d+r*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],_=e[14],v=e[15],E=h*_*l-g*d*l+g*c*f-o*_*f-h*c*v+o*d*v,T=p*d*l-u*_*l-p*c*f+a*_*f+u*c*v-a*d*v,x=u*g*l-p*h*l+p*o*f-a*g*f-u*o*v+a*h*v,N=p*h*c-u*g*c-p*o*d+a*g*d+u*o*_-a*h*_,A=n*E+r*T+i*x+s*N;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/A;return e[0]=E*I,e[1]=(g*d*s-h*_*s-g*i*f+r*_*f+h*i*v-r*d*v)*I,e[2]=(o*_*s-g*c*s+g*i*l-r*_*l-o*i*v+r*c*v)*I,e[3]=(h*c*s-o*d*s-h*i*l+r*d*l+o*i*f-r*c*f)*I,e[4]=T*I,e[5]=(u*_*s-p*d*s+p*i*f-n*_*f-u*i*v+n*d*v)*I,e[6]=(p*c*s-a*_*s-p*i*l+n*_*l+a*i*v-n*c*v)*I,e[7]=(a*d*s-u*c*s+u*i*l-n*d*l-a*i*f+n*c*f)*I,e[8]=x*I,e[9]=(p*h*s-u*g*s-p*r*f+n*g*f+u*r*v-n*h*v)*I,e[10]=(a*g*s-p*o*s+p*r*l-n*g*l-a*r*v+n*o*v)*I,e[11]=(u*o*s-a*h*s-u*r*l+n*h*l+a*r*f-n*o*f)*I,e[12]=N*I,e[13]=(u*g*i-p*h*i+p*r*d-n*g*d-u*r*_+n*h*_)*I,e[14]=(p*o*i-a*g*i-p*r*c+n*g*c+a*r*_-n*o*_)*I,e[15]=(a*h*i-u*o*i+u*r*c-n*h*c-a*r*d+n*o*d)*I,this}scale(e){const n=this.elements,r=e.x,i=e.y,s=e.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,a=e.x,o=e.y,c=e.z,l=s*a,u=s*o;return this.set(l*a+r,l*o-i*c,l*c+i*o,0,l*o+i*c,u*o+r,u*c-i*a,0,l*c-i*o,u*c+i*a,s*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,s,a){return this.set(1,r,s,0,e,1,a,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,s=n._x,a=n._y,o=n._z,c=n._w,l=s+s,u=a+a,h=o+o,d=s*l,f=s*u,p=s*h,g=a*u,_=a*h,v=o*h,E=c*l,T=c*u,x=c*h,N=r.x,A=r.y,I=r.z;return i[0]=(1-(g+v))*N,i[1]=(f+x)*N,i[2]=(p-T)*N,i[3]=0,i[4]=(f-x)*A,i[5]=(1-(d+v))*A,i[6]=(_+E)*A,i[7]=0,i[8]=(p+T)*I,i[9]=(_-E)*I,i[10]=(1-(d+g))*I,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;let s=Fx.set(i[0],i[1],i[2]).length();const a=Fx.set(i[4],i[5],i[6]).length(),o=Fx.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Bp.copy(this);const l=1/s,u=1/a,h=1/o;return Bp.elements[0]*=l,Bp.elements[1]*=l,Bp.elements[2]*=l,Bp.elements[4]*=u,Bp.elements[5]*=u,Bp.elements[6]*=u,Bp.elements[8]*=h,Bp.elements[9]*=h,Bp.elements[10]*=h,n.setFromRotationMatrix(Bp),r.x=s,r.y=a,r.z=o,this}makePerspective(e,n,r,i,s,a,o=$f){const c=this.elements,l=2*s/(n-e),u=2*s/(r-i),h=(n+e)/(n-e),d=(r+i)/(r-i);let f,p;if(o===$f)f=-(a+s)/(a-s),p=-2*a*s/(a-s);else if(o===wM)f=-a/(a-s),p=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,i,s,a,o=$f){const c=this.elements,l=1/(n-e),u=1/(r-i),h=1/(a-s),d=(n+e)*l,f=(r+i)*u;let p,g;if(o===$f)p=(a+s)*h,g=-2*h;else if(o===wM)p=s*h,g=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=g,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const Fx=new Re,Bp=new Nr,dTe=new Re(0,0,0),fTe=new Re(1,1,1),s_=new Re,GI=new Re,xd=new Re,_X=new Nr,bX=new qh;class Xh{constructor(e=0,n=0,r=0,i=Xh.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],f=i[10];switch(n){case"XYZ":this._y=Math.asin(Xr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Xr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Xr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Xr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Xr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Xr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return _X.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_X,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return bX.setFromEuler(this),this.setFromQuaternion(bX,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Xh.DEFAULT_ORDER="XYZ";class Fw{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let pTe=0;const EX=new Re,zx=new qh,av=new Nr,qI=new Re,OR=new Re,mTe=new Re,gTe=new qh,SX=new Re(1,0,0),TX=new Re(0,1,0),xX=new Re(0,0,1),wX={type:"added"},vTe={type:"removed"},Hx={type:"childadded",child:null},Tz={type:"childremoved",child:null};class Gi extends Zd{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:pTe++}),this.uuid=Gd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Gi.DEFAULT_UP.clone();const e=new Re,n=new Xh,r=new qh,i=new Re(1,1,1);function s(){r.setFromEuler(n,!1)}function a(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Nr},normalMatrix:{value:new Zr}}),this.matrix=new Nr,this.matrixWorld=new Nr,this.matrixAutoUpdate=Gi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Fw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return zx.setFromAxisAngle(e,n),this.quaternion.multiply(zx),this}rotateOnWorldAxis(e,n){return zx.setFromAxisAngle(e,n),this.quaternion.premultiply(zx),this}rotateX(e){return this.rotateOnAxis(SX,e)}rotateY(e){return this.rotateOnAxis(TX,e)}rotateZ(e){return this.rotateOnAxis(xX,e)}translateOnAxis(e,n){return EX.copy(e).applyQuaternion(this.quaternion),this.position.add(EX.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(SX,e)}translateY(e){return this.translateOnAxis(TX,e)}translateZ(e){return this.translateOnAxis(xX,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(av.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?qI.copy(e):qI.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),OR.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?av.lookAt(OR,qI,this.up):av.lookAt(qI,OR,this.up),this.quaternion.setFromRotationMatrix(av),i&&(av.extractRotation(i.matrixWorld),zx.setFromRotationMatrix(av),this.quaternion.premultiply(zx.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(wX),Hx.child=e,this.dispatchEvent(Hx),Hx.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(vTe),Tz.child=e,this.dispatchEvent(Tz),Tz.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),av.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),av.multiply(e.parent.matrixWorld)),e.applyMatrix4(av),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(wX),Hx.child=e,this.dispatchEvent(Hx),Hx.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,n);if(a!==void 0)return a}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(OR,e,mTe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(OR,gTe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?{min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}:void 0,boundingSphere:o.boundingSphere?{radius:o.boundingSphere.radius,center:o.boundingSphere.center.toArray()}:void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function s(o,c){return o[c.uuid]===void 0&&(o[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const c=o.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let c=0,l=this.material.length;c<l;c++)o.push(s(e.materials,this.material[c]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const c=this.animations[o];i.animations.push(s(e.animations,c))}}if(n){const o=a(e.geometries),c=a(e.materials),l=a(e.textures),u=a(e.images),h=a(e.shapes),d=a(e.skeletons),f=a(e.animations),p=a(e.nodes);o.length>0&&(r.geometries=o),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=i,r;function a(o){const c=[];for(const l in o){const u=o[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Gi.DEFAULT_UP=new Re(0,1,0);Gi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Gi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Fp=new Re,ov=new Re,xz=new Re,cv=new Re,jx=new Re,Vx=new Re,CX=new Re,wz=new Re,Cz=new Re,Rz=new Re,Az=new Ki,Mz=new Ki,Oz=new Ki;class Lh{constructor(e=new Re,n=new Re,r=new Re){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),Fp.subVectors(e,n),i.cross(Fp);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,n,r,i,s){Fp.subVectors(i,n),ov.subVectors(r,n),xz.subVectors(e,n);const a=Fp.dot(Fp),o=Fp.dot(ov),c=Fp.dot(xz),l=ov.dot(ov),u=ov.dot(xz),h=a*l-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(l*c-o*u)*d,p=(a*u-o*c)*d;return s.set(1-f-p,p,f)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,cv)===null?!1:cv.x>=0&&cv.y>=0&&cv.x+cv.y<=1}static getInterpolation(e,n,r,i,s,a,o,c){return this.getBarycoord(e,n,r,i,cv)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,cv.x),c.addScaledVector(a,cv.y),c.addScaledVector(o,cv.z),c)}static getInterpolatedAttribute(e,n,r,i,s,a){return Az.setScalar(0),Mz.setScalar(0),Oz.setScalar(0),Az.fromBufferAttribute(e,n),Mz.fromBufferAttribute(e,r),Oz.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(Az,s.x),a.addScaledVector(Mz,s.y),a.addScaledVector(Oz,s.z),a}static isFrontFacing(e,n,r,i){return Fp.subVectors(r,n),ov.subVectors(e,n),Fp.cross(ov).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fp.subVectors(this.c,this.b),ov.subVectors(this.a,this.b),Fp.cross(ov).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Lh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Lh.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return Lh.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return Lh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Lh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,s=this.c;let a,o;jx.subVectors(i,r),Vx.subVectors(s,r),wz.subVectors(e,r);const c=jx.dot(wz),l=Vx.dot(wz);if(c<=0&&l<=0)return n.copy(r);Cz.subVectors(e,i);const u=jx.dot(Cz),h=Vx.dot(Cz);if(u>=0&&h<=u)return n.copy(i);const d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return a=c/(c-u),n.copy(r).addScaledVector(jx,a);Rz.subVectors(e,s);const f=jx.dot(Rz),p=Vx.dot(Rz);if(p>=0&&f<=p)return n.copy(s);const g=f*l-c*p;if(g<=0&&l>=0&&p<=0)return o=l/(l-p),n.copy(r).addScaledVector(Vx,o);const _=u*p-f*h;if(_<=0&&h-u>=0&&f-p>=0)return CX.subVectors(s,i),o=(h-u)/(h-u+(f-p)),n.copy(i).addScaledVector(CX,o);const v=1/(_+g+d);return a=g*v,o=d*v,n.copy(r).addScaledVector(jx,a).addScaledVector(Vx,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Yse={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},a_={h:0,s:0,l:0},$I={h:0,s:0,l:0};function Nz(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class _n{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=ya){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Li.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=Li.workingColorSpace){return this.r=e,this.g=n,this.b=r,Li.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=Li.workingColorSpace){if(e=xq(e,1),n=Xr(n,0,1),r=Xr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,a=2*r-s;this.r=Nz(a,s,e+1/3),this.g=Nz(a,s,e),this.b=Nz(a,s,e-1/3)}return Li.toWorkingColorSpace(this,i),this}setStyle(e,n=ya){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(a===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=ya){const r=Yse[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=jv(e.r),this.g=jv(e.g),this.b=jv(e.b),this}copyLinearToSRGB(e){return this.r=aw(e.r),this.g=aw(e.g),this.b=aw(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ya){return Li.fromWorkingColorSpace(Kl.copy(this),e),Math.round(Xr(Kl.r*255,0,255))*65536+Math.round(Xr(Kl.g*255,0,255))*256+Math.round(Xr(Kl.b*255,0,255))}getHexString(e=ya){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Li.workingColorSpace){Li.fromWorkingColorSpace(Kl.copy(this),n);const r=Kl.r,i=Kl.g,s=Kl.b,a=Math.max(r,i,s),o=Math.min(r,i,s);let c,l;const u=(o+a)/2;if(o===a)c=0,l=0;else{const h=a-o;switch(l=u<=.5?h/(a+o):h/(2-a-o),a){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=Li.workingColorSpace){return Li.fromWorkingColorSpace(Kl.copy(this),n),e.r=Kl.r,e.g=Kl.g,e.b=Kl.b,e}getStyle(e=ya){Li.fromWorkingColorSpace(Kl.copy(this),e);const n=Kl.r,r=Kl.g,i=Kl.b;return e!==ya?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(a_),this.setHSL(a_.h+e,a_.s+n,a_.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(a_),e.getHSL($I);const r=PA(a_.h,$I.h,n),i=PA(a_.s,$I.s,n),s=PA(a_.l,$I.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Kl=new _n;_n.NAMES=Yse;let yTe=0;class yl extends Zd{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:yTe++}),this.uuid=Gd(),this.name="",this.type="Material",this.blending=FS,this.side=Lg,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=XP,this.blendDst=KP,this.blendEquation=B_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new _n(0,0,0),this.blendAlpha=0,this.depthFunc=nT,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Uj,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=mS,this.stencilZFail=mS,this.stencilZPass=mS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==FS&&(r.blending=this.blending),this.side!==Lg&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==XP&&(r.blendSrc=this.blendSrc),this.blendDst!==KP&&(r.blendDst=this.blendDst),this.blendEquation!==B_&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==nT&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Uj&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==mS&&(r.stencilFail=this.stencilFail),this.stencilZFail!==mS&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==mS&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const a=[];for(const o in s){const c=s[o];delete c.metadata,a.push(c)}return a}if(n){const s=i(e.textures),a=i(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=n[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Hb extends yl{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _n(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xh,this.combine=KO,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cv=_Te();function _Te(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(r[c]=0,r[c|256]=32768,i[c]=24,i[c|256]=24):l<-14?(r[c]=1024>>-l-14,r[c|256]=1024>>-l-14|32768,i[c]=-l-1,i[c|256]=-l-1):l<=15?(r[c]=l+15<<10,r[c|256]=l+15<<10|32768,i[c]=13,i[c|256]=13):l<128?(r[c]=31744,r[c|256]=64512,i[c]=24,i[c|256]=24):(r[c]=31744,r[c|256]=64512,i[c]=13,i[c|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,u=0;for(;!(l&8388608);)l<<=1,u-=8388608;l&=-8388609,u+=947912704,s[c]=l|u}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(o[c]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function Rh(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Xr(t,-65504,65504),Cv.floatView[0]=t;const e=Cv.uint32View[0],n=e>>23&511;return Cv.baseTable[n]+((e&8388607)>>Cv.shiftTable[n])}function dA(t){const e=t>>10;return Cv.uint32View[0]=Cv.mantissaTable[Cv.offsetTable[e]+(t&1023)]+Cv.exponentTable[e],Cv.floatView[0]}class bTe{static toHalfFloat(e){return Rh(e)}static fromHalfFloat(e){return dA(e)}}const ec=new Re,WI=new Rt;let ETe=0;class ii{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:ETe++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=xM,this.updateRanges=[],this.gpuType=ru,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)WI.fromBufferAttribute(this,n),WI.applyMatrix3(e),this.setXY(n,WI.x,WI.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)ec.fromBufferAttribute(this,n),ec.applyMatrix3(e),this.setXYZ(n,ec.x,ec.y,ec.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)ec.fromBufferAttribute(this,n),ec.applyMatrix4(e),this.setXYZ(n,ec.x,ec.y,ec.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)ec.fromBufferAttribute(this,n),ec.applyNormalMatrix(e),this.setXYZ(n,ec.x,ec.y,ec.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)ec.fromBufferAttribute(this,n),ec.transformDirection(e),this.setXYZ(n,ec.x,ec.y,ec.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=Yu(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=ti(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Yu(n,this.array)),n}setX(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Yu(n,this.array)),n}setY(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Yu(n,this.array)),n}setZ(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Yu(n,this.array)),n}setW(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array),s=ti(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==xM&&(e.usage=this.usage),e}}class STe extends ii{constructor(e,n,r){super(new Int8Array(e),n,r)}}class TTe extends ii{constructor(e,n,r){super(new Uint8Array(e),n,r)}}class xTe extends ii{constructor(e,n,r){super(new Uint8ClampedArray(e),n,r)}}class wTe extends ii{constructor(e,n,r){super(new Int16Array(e),n,r)}}class wq extends ii{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class CTe extends ii{constructor(e,n,r){super(new Int32Array(e),n,r)}}class Cq extends ii{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class RTe extends ii{constructor(e,n,r){super(new Uint16Array(e),n,r),this.isFloat16BufferAttribute=!0}getX(e){let n=dA(this.array[e*this.itemSize]);return this.normalized&&(n=Yu(n,this.array)),n}setX(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize]=Rh(n),this}getY(e){let n=dA(this.array[e*this.itemSize+1]);return this.normalized&&(n=Yu(n,this.array)),n}setY(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+1]=Rh(n),this}getZ(e){let n=dA(this.array[e*this.itemSize+2]);return this.normalized&&(n=Yu(n,this.array)),n}setZ(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+2]=Rh(n),this}getW(e){let n=dA(this.array[e*this.itemSize+3]);return this.normalized&&(n=Yu(n,this.array)),n}setW(e,n){return this.normalized&&(n=ti(n,this.array)),this.array[e*this.itemSize+3]=Rh(n),this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array)),this.array[e+0]=Rh(n),this.array[e+1]=Rh(r),this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array)),this.array[e+0]=Rh(n),this.array[e+1]=Rh(r),this.array[e+2]=Rh(i),this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array),s=ti(s,this.array)),this.array[e+0]=Rh(n),this.array[e+1]=Rh(r),this.array[e+2]=Rh(i),this.array[e+3]=Rh(s),this}}class Hn extends ii{constructor(e,n,r){super(new Float32Array(e),n,r)}}let ATe=0;const xf=new Nr,Iz=new Gi,Gx=new Re,wd=new cu,NR=new cu,tl=new Re;class Qr extends Zd{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ATe++}),this.uuid=Gd(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qse(e)?Cq:wq)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Zr().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return xf.makeRotationFromQuaternion(e),this.applyMatrix4(xf),this}rotateX(e){return xf.makeRotationX(e),this.applyMatrix4(xf),this}rotateY(e){return xf.makeRotationY(e),this.applyMatrix4(xf),this}rotateZ(e){return xf.makeRotationZ(e),this.applyMatrix4(xf),this}translate(e,n,r){return xf.makeTranslation(e,n,r),this.applyMatrix4(xf),this}scale(e,n,r){return xf.makeScale(e,n,r),this.applyMatrix4(xf),this}lookAt(e){return Iz.lookAt(e),Iz.updateMatrix(),this.applyMatrix4(Iz.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gx).negate(),this.translate(Gx.x,Gx.y,Gx.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Hn(r,3))}else{const r=Math.min(e.length,n.count);for(let i=0;i<r;i++){const s=e[i];n.setXYZ(i,s.x,s.y,s.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cu);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Re(-1/0,-1/0,-1/0),new Re(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const s=n[r];wd.setFromBufferAttribute(s),this.morphTargetsRelative?(tl.addVectors(this.boundingBox.min,wd.min),this.boundingBox.expandByPoint(tl),tl.addVectors(this.boundingBox.max,wd.max),this.boundingBox.expandByPoint(tl)):(this.boundingBox.expandByPoint(wd.min),this.boundingBox.expandByPoint(wd.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dl);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Re,1/0);return}if(e){const r=this.boundingSphere.center;if(wd.setFromBufferAttribute(e),n)for(let s=0,a=n.length;s<a;s++){const o=n[s];NR.setFromBufferAttribute(o),this.morphTargetsRelative?(tl.addVectors(wd.min,NR.min),wd.expandByPoint(tl),tl.addVectors(wd.max,NR.max),wd.expandByPoint(tl)):(wd.expandByPoint(NR.min),wd.expandByPoint(NR.max))}wd.getCenter(r);let i=0;for(let s=0,a=e.count;s<a;s++)tl.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(tl));if(n)for(let s=0,a=n.length;s<a;s++){const o=n[s],c=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)tl.fromBufferAttribute(o,l),c&&(Gx.fromBufferAttribute(e,l),tl.add(Gx)),i=Math.max(i,r.distanceToSquared(tl))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ii(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],c=[];for(let k=0;k<r.count;k++)o[k]=new Re,c[k]=new Re;const l=new Re,u=new Re,h=new Re,d=new Rt,f=new Rt,p=new Rt,g=new Re,_=new Re;function v(k,L,U){l.fromBufferAttribute(r,k),u.fromBufferAttribute(r,L),h.fromBufferAttribute(r,U),d.fromBufferAttribute(s,k),f.fromBufferAttribute(s,L),p.fromBufferAttribute(s,U),u.sub(l),h.sub(l),f.sub(d),p.sub(d);const $=1/(f.x*p.y-p.x*f.y);isFinite($)&&(g.copy(u).multiplyScalar(p.y).addScaledVector(h,-f.y).multiplyScalar($),_.copy(h).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar($),o[k].add(g),o[L].add(g),o[U].add(g),c[k].add(_),c[L].add(_),c[U].add(_))}let E=this.groups;E.length===0&&(E=[{start:0,count:e.count}]);for(let k=0,L=E.length;k<L;++k){const U=E[k],$=U.start,q=U.count;for(let G=$,X=$+q;G<X;G+=3)v(e.getX(G+0),e.getX(G+1),e.getX(G+2))}const T=new Re,x=new Re,N=new Re,A=new Re;function I(k){N.fromBufferAttribute(i,k),A.copy(N);const L=o[k];T.copy(L),T.sub(N.multiplyScalar(N.dot(L))).normalize(),x.crossVectors(A,L);const $=x.dot(c[k])<0?-1:1;a.setXYZW(k,T.x,T.y,T.z,$)}for(let k=0,L=E.length;k<L;++k){const U=E[k],$=U.start,q=U.count;for(let G=$,X=$+q;G<X;G+=3)I(e.getX(G+0)),I(e.getX(G+1)),I(e.getX(G+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new ii(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const i=new Re,s=new Re,a=new Re,o=new Re,c=new Re,l=new Re,u=new Re,h=new Re;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),g=e.getX(d+1),_=e.getX(d+2);i.fromBufferAttribute(n,p),s.fromBufferAttribute(n,g),a.fromBufferAttribute(n,_),u.subVectors(a,s),h.subVectors(i,s),u.cross(h),o.fromBufferAttribute(r,p),c.fromBufferAttribute(r,g),l.fromBufferAttribute(r,_),o.add(u),c.add(u),l.add(u),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(g,c.x,c.y,c.z),r.setXYZ(_,l.x,l.y,l.z)}else for(let d=0,f=n.count;d<f;d+=3)i.fromBufferAttribute(n,d+0),s.fromBufferAttribute(n,d+1),a.fromBufferAttribute(n,d+2),u.subVectors(a,s),h.subVectors(i,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)tl.fromBufferAttribute(e,n),tl.normalize(),e.setXYZ(n,tl.x,tl.y,tl.z)}toNonIndexed(){function e(o,c){const l=o.array,u=o.itemSize,h=o.normalized,d=new l.constructor(c.length*u);let f=0,p=0;for(let g=0,_=c.length;g<_;g++){o.isInterleavedBufferAttribute?f=c[g]*o.data.stride+o.offset:f=c[g]*u;for(let v=0;v<u;v++)d[p++]=l[f++]}return new ii(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Qr,r=this.index.array,i=this.attributes;for(const o in i){const c=i[o],l=e(c,r);n.setAttribute(o,l)}const s=this.morphAttributes;for(const o in s){const c=[],l=s[o];for(let u=0,h=l.length;u<h;u++){const d=l[u],f=e(d,r);c.push(f)}n.morphAttributes[o]=c}n.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,c=a.length;o<c;o++){const l=a[o];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++){const f=l[h];u.push(f.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,u=a.length;l<u;l++){const h=a[l];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const RX=new Nr,WE=new PC,YI=new Dl,AX=new Re,XI=new Re,KI=new Re,JI=new Re,kz=new Re,ZI=new Re,MX=new Re,QI=new Re;class Bo extends Gi{constructor(e=new Qr,n=new Hb){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){ZI.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=o[c],h=s[c];u!==0&&(kz.fromBufferAttribute(h,e),a?ZI.addScaledVector(kz,u):ZI.addScaledVector(kz.sub(n),u))}n.add(ZI)}return n}raycast(e,n){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),YI.copy(r.boundingSphere),YI.applyMatrix4(s),WE.copy(e.ray).recast(e.near),!(YI.containsPoint(WE.origin)===!1&&(WE.intersectSphere(YI,AX)===null||WE.origin.distanceToSquared(AX)>(e.far-e.near)**2))&&(RX.copy(s).invert(),WE.copy(e.ray).applyMatrix4(RX),!(r.boundingBox!==null&&WE.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,WE)))}_computeIntersections(e,n,r){let i;const s=this.geometry,a=this.material,o=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let p=0,g=d.length;p<g;p++){const _=d[p],v=a[_.materialIndex],E=Math.max(_.start,f.start),T=Math.min(o.count,Math.min(_.start+_.count,f.start+f.count));for(let x=E,N=T;x<N;x+=3){const A=o.getX(x),I=o.getX(x+1),k=o.getX(x+2);i=ek(this,v,e,r,l,u,h,A,I,k),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=_.materialIndex,n.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(o.count,f.start+f.count);for(let _=p,v=g;_<v;_+=3){const E=o.getX(_),T=o.getX(_+1),x=o.getX(_+2);i=ek(this,a,e,r,l,u,h,E,T,x),i&&(i.faceIndex=Math.floor(_/3),n.push(i))}}else if(c!==void 0)if(Array.isArray(a))for(let p=0,g=d.length;p<g;p++){const _=d[p],v=a[_.materialIndex],E=Math.max(_.start,f.start),T=Math.min(c.count,Math.min(_.start+_.count,f.start+f.count));for(let x=E,N=T;x<N;x+=3){const A=x,I=x+1,k=x+2;i=ek(this,v,e,r,l,u,h,A,I,k),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=_.materialIndex,n.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);for(let _=p,v=g;_<v;_+=3){const E=_,T=_+1,x=_+2;i=ek(this,a,e,r,l,u,h,E,T,x),i&&(i.faceIndex=Math.floor(_/3),n.push(i))}}}}function MTe(t,e,n,r,i,s,a,o){let c;if(e.side===Pc?c=r.intersectTriangle(a,s,i,!0,o):c=r.intersectTriangle(i,s,a,e.side===Lg,o),c===null)return null;QI.copy(o),QI.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(QI);return l<n.near||l>n.far?null:{distance:l,point:QI.clone(),object:t}}function ek(t,e,n,r,i,s,a,o,c,l){t.getVertexPosition(o,XI),t.getVertexPosition(c,KI),t.getVertexPosition(l,JI);const u=MTe(t,e,n,r,XI,KI,JI,MX);if(u){const h=new Re;Lh.getBarycoord(MX,XI,KI,JI,h),i&&(u.uv=Lh.getInterpolatedAttribute(i,o,c,l,h,new Rt)),s&&(u.uv1=Lh.getInterpolatedAttribute(s,o,c,l,h,new Rt)),a&&(u.normal=Lh.getInterpolatedAttribute(a,o,c,l,h,new Re),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:c,c:l,normal:new Re,materialIndex:0};Lh.getNormal(XI,KI,JI,d.normal),u.face=d,u.barycoord=h}return u}class UT extends Qr{constructor(e=1,n=1,r=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const c=[],l=[],u=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,r,n,e,a,s,0),p("z","y","x",1,-1,r,n,-e,a,s,1),p("x","z","y",1,1,e,r,n,i,a,2),p("x","z","y",1,-1,e,r,-n,i,a,3),p("x","y","z",1,-1,e,n,r,i,s,4),p("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new Hn(l,3)),this.setAttribute("normal",new Hn(u,3)),this.setAttribute("uv",new Hn(h,2));function p(g,_,v,E,T,x,N,A,I,k,L){const U=x/I,$=N/k,q=x/2,G=N/2,X=A/2,re=I+1,V=k+1;let Z=0,Y=0;const ee=new Re;for(let oe=0;oe<V;oe++){const de=oe*$-G;for(let Me=0;Me<re;Me++){const He=Me*U-q;ee[g]=He*E,ee[_]=de*T,ee[v]=X,l.push(ee.x,ee.y,ee.z),ee[g]=0,ee[_]=0,ee[v]=A>0?1:-1,u.push(ee.x,ee.y,ee.z),h.push(Me/I),h.push(1-oe/k),Z+=1}}for(let oe=0;oe<k;oe++)for(let de=0;de<I;de++){const Me=d+de+re*oe,He=d+de+re*(oe+1),Te=d+(de+1)+re*(oe+1),Le=d+(de+1)+re*oe;c.push(Me,He,Le),c.push(He,Te,Le),Y+=6}o.addGroup(f,Y,L),f+=Y,d+=Z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new UT(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zw(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function zu(t){const e={};for(let n=0;n<t.length;n++){const r=zw(t[n]);for(const i in r)e[i]=r[i]}return e}function OTe(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function Xse(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Li.workingColorSpace}const Kse={clone:zw,merge:zu};var NTe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ITe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bc extends yl{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=NTe,this.fragmentShader=ITe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zw(e.uniforms),this.uniformsGroups=OTe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?n.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?n.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?n.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?n.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?n.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?n.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?n.uniforms[i]={type:"m4",value:a.toArray()}:n.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class eN extends Gi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Nr,this.projectionMatrix=new Nr,this.projectionMatrixInverse=new Nr,this.coordinateSystem=$f}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const o_=new Re,OX=new Rt,NX=new Rt;let Ic=class extends eN{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Bw*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(zS*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Bw*2*Math.atan(Math.tan(zS*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){o_.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(o_.x,o_.y).multiplyScalar(-e/o_.z),o_.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(o_.x,o_.y).multiplyScalar(-e/o_.z)}getViewSize(e,n){return this.getViewBounds(e,OX,NX),n.subVectors(NX,OX)}setViewOffset(e,n,r,i,s,a){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(zS*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,l=a.fullHeight;s+=a.offsetX*i/c,n-=a.offsetY*r/l,i*=a.width/c,r*=a.height/l}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}};const qx=-90,$x=1;class Jse extends Gi{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ic(qx,$x,e,n);i.layers=this.layers,this.add(i);const s=new Ic(qx,$x,e,n);s.layers=this.layers,this.add(s);const a=new Ic(qx,$x,e,n);a.layers=this.layers,this.add(a);const o=new Ic(qx,$x,e,n);o.layers=this.layers,this.add(o);const c=new Ic(qx,$x,e,n);c.layers=this.layers,this.add(c);const l=new Ic(qx,$x,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,s,a,o,c]=n;for(const l of n)this.remove(l);if(e===$f)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===wM)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,c,l,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,s),e.setRenderTarget(r,1,i),e.render(n,a),e.setRenderTarget(r,2,i),e.render(n,o),e.setRenderTarget(r,3,i),e.render(n,c),e.setRenderTarget(r,4,i),e.render(n,l),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,i),e.render(n,u),e.setRenderTarget(h,d,f),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class tN extends Pa{constructor(e=[],n=Jv,r,i,s,a,o,c,l,u){super(e,n,r,i,s,a,o,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Zse extends Ul{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new tN(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:_a}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new UT(5,5,5),s=new Bc({name:"CubemapFromEquirect",uniforms:zw(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Pc,blending:Zf});s.uniforms.tEquirect.value=n;const a=new Bo(i,s),o=n.minFilter;return n.minFilter===_g&&(n.minFilter=_a),new Jse(1,10,this).update(e,a),n.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,n=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(n,r,i);e.setRenderTarget(s)}}class k1 extends Gi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const kTe={type:"move"};class FD{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new k1,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new k1,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new k1,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Re),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,s=null,a=null;const o=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){a=!0;for(const g of e.hand.values()){const _=n.getJointPose(g,r),v=this._getHandJoint(l,g);_!==null&&(v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=_.radius),v.visible=_!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,p=.005;l.inputState.pinching&&d>f+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=f-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));o!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(kTe)))}return o!==null&&(o.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new k1;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}class o3{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new _n(e),this.density=n}clone(){return new o3(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class c3{constructor(e,n=1,r=1e3){this.isFog=!0,this.name="",this.color=new _n(e),this.near=n,this.far=r}clone(){return new c3(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Hw extends Gi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Xh,this.environmentIntensity=1,this.environmentRotation=new Xh,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class l3{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=xM,this.updateRanges=[],this.version=0,this.uuid=Gd()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,r){e*=this.stride,r*=n.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=n.array[r+i];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(n,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gd()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Bu=new Re;class sT{constructor(e,n,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,r=this.data.count;n<r;n++)Bu.fromBufferAttribute(this,n),Bu.applyMatrix4(e),this.setXYZ(n,Bu.x,Bu.y,Bu.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Bu.fromBufferAttribute(this,n),Bu.applyNormalMatrix(e),this.setXYZ(n,Bu.x,Bu.y,Bu.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Bu.fromBufferAttribute(this,n),Bu.transformDirection(e),this.setXYZ(n,Bu.x,Bu.y,Bu.z);return this}getComponent(e,n){let r=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(r=Yu(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=ti(r,this.array)),this.data.array[e*this.data.stride+this.offset+n]=r,this}setX(e,n){return this.normalized&&(n=ti(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=ti(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=ti(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=ti(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=Yu(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=Yu(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=Yu(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=Yu(n,this.array)),n}setXY(e,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this}setXYZ(e,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=ti(n,this.array),r=ti(r,this.array),i=ti(i,this.array),s=ti(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[i+s])}return new ii(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sT(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)n.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Rq extends yl{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new _n(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Wx;const IR=new Re,Yx=new Re,Xx=new Re,Kx=new Rt,kR=new Rt,Qse=new Nr,tk=new Re,DR=new Re,nk=new Re,IX=new Rt,Dz=new Rt,kX=new Rt;class eae extends Gi{constructor(e=new Rq){if(super(),this.isSprite=!0,this.type="Sprite",Wx===void 0){Wx=new Qr;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new l3(n,5);Wx.setIndex([0,1,2,0,2,3]),Wx.setAttribute("position",new sT(r,3,0,!1)),Wx.setAttribute("uv",new sT(r,2,3,!1))}this.geometry=Wx,this.material=e,this.center=new Rt(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Yx.setFromMatrixScale(this.matrixWorld),Qse.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Xx.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Yx.multiplyScalar(-Xx.z);const r=this.material.rotation;let i,s;r!==0&&(s=Math.cos(r),i=Math.sin(r));const a=this.center;rk(tk.set(-.5,-.5,0),Xx,a,Yx,i,s),rk(DR.set(.5,-.5,0),Xx,a,Yx,i,s),rk(nk.set(.5,.5,0),Xx,a,Yx,i,s),IX.set(0,0),Dz.set(1,0),kX.set(1,1);let o=e.ray.intersectTriangle(tk,DR,nk,!1,IR);if(o===null&&(rk(DR.set(-.5,.5,0),Xx,a,Yx,i,s),Dz.set(0,1),o=e.ray.intersectTriangle(tk,nk,DR,!1,IR),o===null))return;const c=e.ray.origin.distanceTo(IR);c<e.near||c>e.far||n.push({distance:c,point:IR.clone(),uv:Lh.getInterpolation(IR,tk,DR,nk,IX,Dz,kX,new Rt),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function rk(t,e,n,r,i,s){Kx.subVectors(t,n).addScalar(.5).multiply(r),i!==void 0?(kR.x=s*Kx.x-i*Kx.y,kR.y=i*Kx.x+s*Kx.y):kR.copy(Kx),t.copy(e),t.x+=kR.x,t.y+=kR.y,t.applyMatrix4(Qse)}const ik=new Re,DX=new Re;class tae extends Gi{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let r=0,i=n.length;r<i;r++){const s=n[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,r=0){n=Math.abs(n);const i=this.levels;let s;for(s=0;s<i.length&&!(n<i[s].distance);s++);return i.splice(s,0,{distance:n,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){const n=this.levels;for(let r=0;r<n.length;r++)if(n[r].distance===e){const i=n.splice(r,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let r,i;for(r=1,i=n.length;r<i;r++){let s=n[r].distance;if(n[r].object.visible&&(s-=s*n[r].hysteresis),e<s)break}return n[r-1].object}return null}raycast(e,n){if(this.levels.length>0){ik.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(ik);this.getObjectForDistance(i).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){ik.setFromMatrixPosition(e.matrixWorld),DX.setFromMatrixPosition(this.matrixWorld);const r=ik.distanceTo(DX)/e.zoom;n[0].object.visible=!0;let i,s;for(i=1,s=n.length;i<s;i++){let a=n[i].distance;if(n[i].object.visible&&(a-=a*n[i].hysteresis),r>=a)n[i-1].object.visible=!1,n[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)n[i].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const r=this.levels;for(let i=0,s=r.length;i<s;i++){const a=r[i];n.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return n}}const PX=new Re,LX=new Ki,UX=new Ki,DTe=new Re,BX=new Nr,sk=new Re,Pz=new Dl,FX=new Nr,Lz=new PC;class nae extends Bo{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Lj,this.bindMatrix=new Nr,this.bindMatrixInverse=new Nr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new cu),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,sk),this.boundingBox.expandByPoint(sk)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Dl),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,sk),this.boundingSphere.expandByPoint(sk)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const r=this.material,i=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Pz.copy(this.boundingSphere),Pz.applyMatrix4(i),e.ray.intersectsSphere(Pz)!==!1&&(FX.copy(i).invert(),Lz.copy(e.ray).applyMatrix4(FX),!(this.boundingBox!==null&&Lz.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,Lz)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ki,n=this.geometry.attributes.skinWeight;for(let r=0,i=n.count;r<i;r++){e.fromBufferAttribute(n,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),n.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Lj?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Nse?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const r=this.skeleton,i=this.geometry;LX.fromBufferAttribute(i.attributes.skinIndex,e),UX.fromBufferAttribute(i.attributes.skinWeight,e),PX.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let s=0;s<4;s++){const a=UX.getComponent(s);if(a!==0){const o=LX.getComponent(s);BX.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),n.addScaledVector(DTe.copy(PX).applyMatrix4(BX),a)}}return n.applyMatrix4(this.bindMatrixInverse)}}class Aq extends Gi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Qf extends Pa{constructor(e=null,n=1,r=1,i,s,a,o,c,l=Ja,u=Ja,h,d){super(null,a,o,c,l,u,i,s,h,d),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const zX=new Nr,PTe=new Nr;class u3{constructor(e=[],n=[]){this.uuid=Gd(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new Nr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const r=new Nr;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,n=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:PTe;zX.multiplyMatrices(o,n[s]),zX.toArray(r,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new u3(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const r=new Qf(n,e,e,iu,ru);return r.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=r,this}getBoneByName(e){for(let n=0,r=this.bones.length;n<r;n++){const i=this.bones[n];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const s=e.bones[r];let a=n[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new Aq),this.bones.push(a),this.boneInverses.push(new Nr().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,r=this.boneInverses;for(let i=0,s=n.length;i<s;i++){const a=n[i];e.bones.push(a.uuid);const o=r[i];e.boneInverses.push(o.toArray())}return e}}class jw extends ii{constructor(e,n,r,i=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Jx=new Nr,HX=new Nr,ak=[],jX=new cu,LTe=new Nr,PR=new Bo,LR=new Dl;class rae extends Bo{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new jw(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,LTe)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new cu),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Jx),jX.copy(e.boundingBox).applyMatrix4(Jx),this.boundingBox.union(jX)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Dl),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Jx),LR.copy(e.boundingSphere).applyMatrix4(Jx),this.boundingSphere.union(LR)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,a=e*s+1;for(let o=0;o<r.length;o++)r[o]=i[a+o]}raycast(e,n){const r=this.matrixWorld,i=this.count;if(PR.geometry=this.geometry,PR.material=this.material,PR.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),LR.copy(this.boundingSphere),LR.applyMatrix4(r),e.ray.intersectsSphere(LR)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,Jx),HX.multiplyMatrices(r,Jx),PR.matrixWorld=HX,PR.raycast(e,ak);for(let a=0,o=ak.length;a<o;a++){const c=ak[a];c.instanceId=s,c.object=this,n.push(c)}ak.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new jw(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new Qf(new Float32Array(i*this.count),i,this.count,n3,ru));const s=this.morphTexture.source.data.data;let a=0;for(let l=0;l<r.length;l++)a+=r[l];const o=this.geometry.morphTargetsRelative?1:1-a,c=i*e;s[c]=o,s.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Uz=new Re,UTe=new Re,BTe=new Zr;class Nf{constructor(e=new Re(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=Uz.subVectors(r,n).cross(UTe.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(Uz),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:n.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||BTe.getNormalMatrix(e),i=this.coplanarPoint(Uz).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const YE=new Dl,ok=new Re;class LC{constructor(e=new Nf,n=new Nf,r=new Nf,i=new Nf,s=new Nf,a=new Nf){this.planes=[e,n,r,i,s,a]}set(e,n,r,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(n),o[2].copy(r),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=$f){const r=this.planes,i=e.elements,s=i[0],a=i[1],o=i[2],c=i[3],l=i[4],u=i[5],h=i[6],d=i[7],f=i[8],p=i[9],g=i[10],_=i[11],v=i[12],E=i[13],T=i[14],x=i[15];if(r[0].setComponents(c-s,d-l,_-f,x-v).normalize(),r[1].setComponents(c+s,d+l,_+f,x+v).normalize(),r[2].setComponents(c+a,d+u,_+p,x+E).normalize(),r[3].setComponents(c-a,d-u,_-p,x-E).normalize(),r[4].setComponents(c-o,d-h,_-g,x-T).normalize(),n===$f)r[5].setComponents(c+o,d+h,_+g,x+T).normalize();else if(n===wM)r[5].setComponents(o,h,g,T).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),YE.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),YE.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(YE)}intersectsSprite(e){return YE.center.set(0,0,0),YE.radius=.7071067811865476,YE.applyMatrix4(e.matrixWorld),this.intersectsSphere(YE)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(ok.x=i.normal.x>0?e.max.x:e.min.x,ok.y=i.normal.y>0?e.max.y:e.min.y,ok.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ok)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Km=new Nr,Jm=new LC;class h3{constructor(){this.coordinateSystem=$f}intersectsObject(e,n){if(!n.isArrayCamera||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(Km.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jm.setFromProjectionMatrix(Km,this.coordinateSystem),Jm.intersectsObject(e))return!0}return!1}intersectsSprite(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(Km.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jm.setFromProjectionMatrix(Km,this.coordinateSystem),Jm.intersectsSprite(e))return!0}return!1}intersectsSphere(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(Km.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jm.setFromProjectionMatrix(Km,this.coordinateSystem),Jm.intersectsSphere(e))return!0}return!1}intersectsBox(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(Km.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jm.setFromProjectionMatrix(Km,this.coordinateSystem),Jm.intersectsBox(e))return!0}return!1}containsPoint(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(Km.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Jm.setFromProjectionMatrix(Km,this.coordinateSystem),Jm.containsPoint(e))return!0}return!1}clone(){return new h3}}function Bz(t,e){return t-e}function FTe(t,e){return t.z-e.z}function zTe(t,e){return e.z-t.z}class HTe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,n,r,i){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=n,o.z=r,o.index=i}reset(){this.list.length=0,this.index=0}}const Ch=new Nr,jTe=new _n(1,1,1),VX=new LC,VTe=new h3,ck=new cu,XE=new Dl,UR=new Re,GX=new Re,GTe=new Re,Fz=new HTe,Jl=new Bo,lk=[];function qTe(t,e,n=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const i=t.count;for(let s=0;s<i;s++)for(let a=0;a<r;a++)e.setComponent(s+n,a,t.getComponent(s,a))}else e.array.set(t.array,n*r);e.needsUpdate=!0}function KE(t,e){if(t.constructor!==e.constructor){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++)e[r]=t[r]}else{const n=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,n))}}class iae extends Bo{constructor(e,n,r=n*2,i){super(new Qr,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=n,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4),r=new Qf(n,e,e,iu,ru);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Uint32Array(e*e),r=new Qf(n,e,e,JO,Ug);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Float32Array(e*e*4).fill(1),r=new Qf(n,e,e,iu,ru);r.colorSpace=Li.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const n=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:c,normalized:l}=a,u=new o.constructor(r*c),h=new ii(u,c,l);n.setAttribute(s,h)}if(e.getIndex()!==null){const s=r>65535?new Uint32Array(i):new Uint16Array(i);n.setIndex(new ii(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const n=this.geometry;if(!!e.getIndex()!=!!n.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in n.attributes){if(!e.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=e.getAttribute(r),s=n.getAttribute(r);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const n=this._instanceInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const n=this._geometryInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cu);const e=this.boundingBox,n=this._instanceInfo;e.makeEmpty();for(let r=0,i=n.length;r<i;r++){if(n[r].active===!1)continue;const s=n[r].geometryIndex;this.getMatrixAt(r,Ch),this.getBoundingBoxAt(s,ck).applyMatrix4(Ch),e.union(ck)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dl);const e=this.boundingSphere,n=this._instanceInfo;e.makeEmpty();for(let r=0,i=n.length;r<i;r++){if(n[r].active===!1)continue;const s=n[r].geometryIndex;this.getMatrixAt(r,Ch),this.getBoundingSphereAt(s,XE).applyMatrix4(Ch),e.union(XE)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Bz),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=r):(i=this._instanceInfo.length,this._instanceInfo.push(r));const s=this._matricesTexture;Ch.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(jTe.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,n=-1,r=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=n===-1?e.getAttribute("position").count:n;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=r===-1?a.count:r),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Bz),c=this._availableGeometryIds.shift(),s[c]=i):(c=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(c,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,c}setGeometryAt(e,n){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(n);const r=this.geometry,i=r.getIndex()!==null,s=r.getIndex(),a=n.getIndex(),o=this._geometryInfo[e];if(i&&a.count>o.reservedIndexCount||n.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const c=o.vertexStart,l=o.reservedVertexCount;o.vertexCount=n.getAttribute("position").count;for(const u in r.attributes){const h=n.getAttribute(u),d=r.getAttribute(u);qTe(h,d,c);const f=h.itemSize;for(let p=h.count,g=l;p<g;p++){const _=c+p;for(let v=0;v<f;v++)d.setComponent(_,v,0)}d.needsUpdate=!0,d.addUpdateRange(c*f,l*f)}if(i){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=n.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,c+a.getX(d));for(let d=a.count,f=h;d<f;d++)s.setX(u+d,c);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,n.boundingBox!==null&&(o.boundingBox=n.boundingBox.clone()),o.boundingSphere=null,n.boundingSphere!==null&&(o.boundingSphere=n.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const n=this._geometryInfo;if(e>=n.length||n[e].active===!1)return this;const r=this._instanceInfo;for(let i=0,s=r.length;i<s;i++)r[i].active&&r[i].geometryIndex===e&&this.deleteInstance(i);return n[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,n=0;const r=this._geometryInfo,i=r.map((a,o)=>o).sort((a,o)=>r[a].vertexStart-r[o].vertexStart),s=this.geometry;for(let a=0,o=r.length;a<o;a++){const c=i[a],l=r[c];if(l.active!==!1){if(s.index!==null){if(l.indexStart!==n){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=l,f=s.index,p=f.array,g=e-h;for(let _=u;_<u+d;_++)p[_]=p[_]+g;f.array.copyWithin(n,u,u+d),f.addUpdateRange(n,d),l.indexStart=n}n+=l.reservedIndexCount}if(l.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=l,d=s.attributes;for(const f in d){const p=d[f],{array:g,itemSize:_}=p;g.copyWithin(e*_,u*_,(u+h)*_),p.addUpdateRange(e*_,h*_)}l.vertexStart=e}e+=l.reservedVertexCount,l.start=s.index?l.indexStart:l.vertexStart,this._nextIndexStart=s.index?l.indexStart+l.reservedIndexCount:0,this._nextVertexStart=l.vertexStart+l.reservedVertexCount}}return this}getBoundingBoxAt(e,n){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new cu,a=r.index,o=r.attributes.position;for(let c=i.start,l=i.start+i.count;c<l;c++){let u=c;a&&(u=a.getX(u)),s.expandByPoint(UR.fromBufferAttribute(o,u))}i.boundingBox=s}return n.copy(i.boundingBox),n}getBoundingSphereAt(e,n){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Dl;this.getBoundingBoxAt(e,ck),ck.getCenter(s.center);const a=r.index,o=r.attributes.position;let c=0;for(let l=i.start,u=i.start+i.count;l<u;l++){let h=l;a&&(h=a.getX(h)),UR.fromBufferAttribute(o,h),c=Math.max(c,s.center.distanceToSquared(UR))}s.radius=Math.sqrt(c),i.boundingSphere=s}return n.copy(i.boundingSphere),n}setMatrixAt(e,n){this.validateInstanceId(e);const r=this._matricesTexture,i=this._matricesTexture.image.data;return n.toArray(i,e*16),r.needsUpdate=!0,this}getMatrixAt(e,n){return this.validateInstanceId(e),n.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,n){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),n.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,n){return this.validateInstanceId(e),n.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,n){return this.validateInstanceId(e),this._instanceInfo[e].visible===n?this:(this._instanceInfo[e].visible=n,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,n){return this.validateInstanceId(e),this.validateGeometryId(n),this._instanceInfo[e].geometryIndex=n,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,n={}){this.validateGeometryId(e);const r=this._geometryInfo[e];return n.vertexStart=r.vertexStart,n.vertexCount=r.vertexCount,n.reservedVertexCount=r.reservedVertexCount,n.indexStart=r.indexStart,n.indexCount=r.indexCount,n.reservedIndexCount=r.reservedIndexCount,n.start=r.start,n.count=r.count,n}setInstanceCount(e){const n=this._availableInstanceIds,r=this._instanceInfo;for(n.sort(Bz);n[n.length-1]===r.length;)r.pop(),n.pop();if(e<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);KE(this._multiDrawCounts,i),KE(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,c=this._colorsTexture;a.dispose(),this._initIndirectTexture(),KE(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),KE(o.image.data,this._matricesTexture.image.data),c&&(c.dispose(),this._initColorsTexture(),KE(c.image.data,this._colorsTexture.image.data))}setGeometrySize(e,n){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${n}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(c=>c.indexStart+c.reservedIndexCount))>n)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${n}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Qr,this._initializeGeometry(s));const a=this.geometry;s.index&&KE(s.index.array,a.index.array);for(const o in s.attributes)KE(s.attributes[o].array,a.attributes[o].array)}raycast(e,n){const r=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,a=this.geometry;Jl.material=this.material,Jl.geometry.index=a.index,Jl.geometry.attributes=a.attributes,Jl.geometry.boundingBox===null&&(Jl.geometry.boundingBox=new cu),Jl.geometry.boundingSphere===null&&(Jl.geometry.boundingSphere=new Dl);for(let o=0,c=r.length;o<c;o++){if(!r[o].visible||!r[o].active)continue;const l=r[o].geometryIndex,u=i[l];Jl.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,Jl.matrixWorld).premultiply(s),this.getBoundingBoxAt(l,Jl.geometry.boundingBox),this.getBoundingSphereAt(l,Jl.geometry.boundingSphere),Jl.raycast(e,lk);for(let h=0,d=lk.length;h<d;h++){const f=lk[h];f.object=this,f.batchId=o,n.push(f)}lk.length=0}Jl.material=null,Jl.geometry.index=null,Jl.geometry.attributes={},Jl.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(n=>({...n,boundingBox:n.boundingBox!==null?n.boundingBox.clone():null,boundingSphere:n.boundingSphere!==null?n.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(n=>({...n})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,n,r,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._instanceInfo,l=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,f=this._indirectTexture,p=f.image.data,g=r.isArrayCamera?VTe:VX;d&&!r.isArrayCamera&&(Ch.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),VX.setFromProjectionMatrix(Ch,e.coordinateSystem));let _=0;if(this.sortObjects){Ch.copy(this.matrixWorld).invert(),UR.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Ch),GX.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Ch);for(let T=0,x=c.length;T<x;T++)if(c[T].visible&&c[T].active){const N=c[T].geometryIndex;this.getMatrixAt(T,Ch),this.getBoundingSphereAt(N,XE).applyMatrix4(Ch);let A=!1;if(d&&(A=!g.intersectsSphere(XE,r)),!A){const I=h[N],k=GTe.subVectors(XE.center,UR).dot(GX);Fz.push(I.start,I.count,k,T)}}const v=Fz.list,E=this.customSort;E===null?v.sort(s.transparent?zTe:FTe):E.call(this,v,r);for(let T=0,x=v.length;T<x;T++){const N=v[T];l[_]=N.start*o,u[_]=N.count,p[_]=N.index,_++}Fz.reset()}else for(let v=0,E=c.length;v<E;v++)if(c[v].visible&&c[v].active){const T=c[v].geometryIndex;let x=!1;if(d&&(this.getMatrixAt(v,Ch),this.getBoundingSphereAt(T,XE).applyMatrix4(Ch),x=!g.intersectsSphere(XE,r)),!x){const N=h[T];l[_]=N.start*o,u[_]=N.count,p[_]=v,_++}}f.needsUpdate=!0,this._multiDrawCount=_,this._visibilityChanged=!1}onBeforeShadow(e,n,r,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class nh extends yl{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new _n(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const NL=new Re,IL=new Re,qX=new Nr,BR=new PC,uk=new Dl,zz=new Re,$X=new Re;class bb extends Gi{constructor(e=new Qr,n=new nh){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[0];for(let i=1,s=n.count;i<s;i++)NL.fromBufferAttribute(n,i-1),IL.fromBufferAttribute(n,i),r[i]=r[i-1],r[i]+=NL.distanceTo(IL);e.setAttribute("lineDistance",new Hn(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),uk.copy(r.boundingSphere),uk.applyMatrix4(i),uk.radius+=s,e.ray.intersectsSphere(uk)===!1)return;qX.copy(i).invert(),BR.copy(e.ray).applyMatrix4(qX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,l=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const f=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let g=f,_=p-1;g<_;g+=l){const v=u.getX(g),E=u.getX(g+1),T=hk(this,e,BR,c,v,E,g);T&&n.push(T)}if(this.isLineLoop){const g=u.getX(p-1),_=u.getX(f),v=hk(this,e,BR,c,g,_,p-1);v&&n.push(v)}}else{const f=Math.max(0,a.start),p=Math.min(d.count,a.start+a.count);for(let g=f,_=p-1;g<_;g+=l){const v=hk(this,e,BR,c,g,g+1,g);v&&n.push(v)}if(this.isLineLoop){const g=hk(this,e,BR,c,p-1,f,p-1);g&&n.push(g)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function hk(t,e,n,r,i,s,a){const o=t.geometry.attributes.position;if(NL.fromBufferAttribute(o,i),IL.fromBufferAttribute(o,s),n.distanceSqToSegment(NL,IL,zz,$X)>r)return;zz.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(zz);if(!(l<e.near||l>e.far))return{distance:l,point:$X.clone().applyMatrix4(t.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:t}}const WX=new Re,YX=new Re;class Kg extends bb{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[];for(let i=0,s=n.count;i<s;i+=2)WX.fromBufferAttribute(n,i),YX.fromBufferAttribute(n,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+WX.distanceTo(YX);e.setAttribute("lineDistance",new Hn(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class sae extends bb{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class Mq extends yl{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new _n(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const XX=new Nr,Fj=new PC,dk=new Dl,fk=new Re;class aae extends Gi{constructor(e=new Qr,n=new Mq){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),dk.copy(r.boundingSphere),dk.applyMatrix4(i),dk.radius+=s,e.ray.intersectsSphere(dk)===!1)return;XX.copy(i).invert(),Fj.copy(e.ray).applyMatrix4(XX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,l=r.index,h=r.attributes.position;if(l!==null){const d=Math.max(0,a.start),f=Math.min(l.count,a.start+a.count);for(let p=d,g=f;p<g;p++){const _=l.getX(p);fk.fromBufferAttribute(h,_),KX(fk,_,c,i,e,n,this)}}else{const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let p=d,g=f;p<g;p++)fk.fromBufferAttribute(h,p),KX(fk,p,c,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function KX(t,e,n,r,i,s,a){const o=Fj.distanceSqToPoint(t);if(o<n){const c=new Re;Fj.closestPointToPoint(t,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class oae extends Pa{constructor(e,n,r,i,s=_a,a=_a,o,c,l){super(e,n,r,i,s,a,o,c,l),this.isVideoTexture=!0,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class $Te extends oae{constructor(e,n,r,i,s,a,o,c){super({},e,n,r,i,s,a,o,c),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class WTe extends Pa{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=Ja,this.minFilter=Ja,this.generateMipmaps=!1,this.needsUpdate=!0}}class d3 extends Pa{constructor(e,n,r,i,s,a,o,c,l,u,h,d){super(null,a,o,c,l,u,i,s,h,d),this.isCompressedTexture=!0,this.image={width:n,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class YTe extends d3{constructor(e,n,r,i,s,a){super(e,n,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=qf,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class XTe extends d3{constructor(e,n,r){super(void 0,e[0].width,e[0].height,n,r,Jv),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class cae extends Pa{constructor(e,n,r,i,s,a,o,c,l){super(e,n,r,i,s,a,o,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class UC extends Pa{constructor(e,n,r=Ug,i,s,a,o=Ja,c=Ja,l,u=Uw){if(u!==Uw&&u!==iT)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,a,o,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new q_(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class KTe extends UC{constructor(e=1,n=1,r=1){super(e,n),this.isDepthArrayTexture=!0,this.image={width:e,height:n,depth:r},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class f3 extends Qr{constructor(e=1,n=1,r=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:n,capSegments:r,radialSegments:i,heightSegments:s},n=Math.max(0,n),r=Math.max(1,Math.floor(r)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const a=[],o=[],c=[],l=[],u=n/2,h=Math.PI/2*e,d=n,f=2*h+d,p=r*2+s,g=i+1,_=new Re,v=new Re;for(let E=0;E<=p;E++){let T=0,x=0,N=0,A=0;if(E<=r){const L=E/r,U=L*Math.PI/2;x=-u-e*Math.cos(U),N=e*Math.sin(U),A=-e*Math.cos(U),T=L*h}else if(E<=r+s){const L=(E-r)/s;x=-u+L*n,N=e,A=0,T=h+L*d}else{const L=(E-r-s)/r,U=L*Math.PI/2;x=u+e*Math.sin(U),N=e*Math.cos(U),A=e*Math.sin(U),T=h+d+L*h}const I=Math.max(0,Math.min(1,T/f));let k=0;E===0?k=.5/i:E===p&&(k=-.5/i);for(let L=0;L<=i;L++){const U=L/i,$=U*Math.PI*2,q=Math.sin($),G=Math.cos($);v.x=-N*G,v.y=x,v.z=N*q,o.push(v.x,v.y,v.z),_.set(-N*G,A,N*q),_.normalize(),c.push(_.x,_.y,_.z),l.push(U+k,I)}if(E>0){const L=(E-1)*g;for(let U=0;U<i;U++){const $=L+U,q=L+U+1,G=E*g+U,X=E*g+U+1;a.push($,q,G),a.push(q,X,G)}}}this.setIndex(a),this.setAttribute("position",new Hn(o,3)),this.setAttribute("normal",new Hn(c,3)),this.setAttribute("uv",new Hn(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new f3(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class p3 extends Qr{constructor(e=1,n=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:r,thetaLength:i},n=Math.max(3,n);const s=[],a=[],o=[],c=[],l=new Re,u=new Rt;a.push(0,0,0),o.push(0,0,1),c.push(.5,.5);for(let h=0,d=3;h<=n;h++,d+=3){const f=r+h/n*i;l.x=e*Math.cos(f),l.y=e*Math.sin(f),a.push(l.x,l.y,l.z),o.push(0,0,1),u.x=(a[d]/e+1)/2,u.y=(a[d+1]/e+1)/2,c.push(u.x,u.y)}for(let h=1;h<=n;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Hn(a,3)),this.setAttribute("normal",new Hn(o,3)),this.setAttribute("uv",new Hn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new p3(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class nN extends Qr{constructor(e=1,n=1,r=1,i=32,s=1,a=!1,o=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:c};const l=this;i=Math.floor(i),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const g=[],_=r/2;let v=0;E(),a===!1&&(e>0&&T(!0),n>0&&T(!1)),this.setIndex(u),this.setAttribute("position",new Hn(h,3)),this.setAttribute("normal",new Hn(d,3)),this.setAttribute("uv",new Hn(f,2));function E(){const x=new Re,N=new Re;let A=0;const I=(n-e)/r;for(let k=0;k<=s;k++){const L=[],U=k/s,$=U*(n-e)+e;for(let q=0;q<=i;q++){const G=q/i,X=G*c+o,re=Math.sin(X),V=Math.cos(X);N.x=$*re,N.y=-U*r+_,N.z=$*V,h.push(N.x,N.y,N.z),x.set(re,I,V).normalize(),d.push(x.x,x.y,x.z),f.push(G,1-U),L.push(p++)}g.push(L)}for(let k=0;k<i;k++)for(let L=0;L<s;L++){const U=g[L][k],$=g[L+1][k],q=g[L+1][k+1],G=g[L][k+1];(e>0||L!==0)&&(u.push(U,$,G),A+=3),(n>0||L!==s-1)&&(u.push($,q,G),A+=3)}l.addGroup(v,A,0),v+=A}function T(x){const N=p,A=new Rt,I=new Re;let k=0;const L=x===!0?e:n,U=x===!0?1:-1;for(let q=1;q<=i;q++)h.push(0,_*U,0),d.push(0,U,0),f.push(.5,.5),p++;const $=p;for(let q=0;q<=i;q++){const X=q/i*c+o,re=Math.cos(X),V=Math.sin(X);I.x=L*V,I.y=_*U,I.z=L*re,h.push(I.x,I.y,I.z),d.push(0,U,0),A.x=re*.5+.5,A.y=V*.5*U+.5,f.push(A.x,A.y),p++}for(let q=0;q<i;q++){const G=N+q,X=$+q;x===!0?u.push(X,X+1,G):u.push(X+1,X,G),k+=3}l.addGroup(v,k,x===!0?1:2),v+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nN(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class rN extends nN{constructor(e=1,n=1,r=32,i=1,s=!1,a=0,o=Math.PI*2){super(0,e,n,r,i,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new rN(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class jb extends Qr{constructor(e=[],n=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:r,detail:i};const s=[],a=[];o(i),l(r),u(),this.setAttribute("position",new Hn(s,3)),this.setAttribute("normal",new Hn(s.slice(),3)),this.setAttribute("uv",new Hn(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(E){const T=new Re,x=new Re,N=new Re;for(let A=0;A<n.length;A+=3)f(n[A+0],T),f(n[A+1],x),f(n[A+2],N),c(T,x,N,E)}function c(E,T,x,N){const A=N+1,I=[];for(let k=0;k<=A;k++){I[k]=[];const L=E.clone().lerp(x,k/A),U=T.clone().lerp(x,k/A),$=A-k;for(let q=0;q<=$;q++)q===0&&k===A?I[k][q]=L:I[k][q]=L.clone().lerp(U,q/$)}for(let k=0;k<A;k++)for(let L=0;L<2*(A-k)-1;L++){const U=Math.floor(L/2);L%2===0?(d(I[k][U+1]),d(I[k+1][U]),d(I[k][U])):(d(I[k][U+1]),d(I[k+1][U+1]),d(I[k+1][U]))}}function l(E){const T=new Re;for(let x=0;x<s.length;x+=3)T.x=s[x+0],T.y=s[x+1],T.z=s[x+2],T.normalize().multiplyScalar(E),s[x+0]=T.x,s[x+1]=T.y,s[x+2]=T.z}function u(){const E=new Re;for(let T=0;T<s.length;T+=3){E.x=s[T+0],E.y=s[T+1],E.z=s[T+2];const x=_(E)/2/Math.PI+.5,N=v(E)/Math.PI+.5;a.push(x,1-N)}p(),h()}function h(){for(let E=0;E<a.length;E+=6){const T=a[E+0],x=a[E+2],N=a[E+4],A=Math.max(T,x,N),I=Math.min(T,x,N);A>.9&&I<.1&&(T<.2&&(a[E+0]+=1),x<.2&&(a[E+2]+=1),N<.2&&(a[E+4]+=1))}}function d(E){s.push(E.x,E.y,E.z)}function f(E,T){const x=E*3;T.x=e[x+0],T.y=e[x+1],T.z=e[x+2]}function p(){const E=new Re,T=new Re,x=new Re,N=new Re,A=new Rt,I=new Rt,k=new Rt;for(let L=0,U=0;L<s.length;L+=9,U+=6){E.set(s[L+0],s[L+1],s[L+2]),T.set(s[L+3],s[L+4],s[L+5]),x.set(s[L+6],s[L+7],s[L+8]),A.set(a[U+0],a[U+1]),I.set(a[U+2],a[U+3]),k.set(a[U+4],a[U+5]),N.copy(E).add(T).add(x).divideScalar(3);const $=_(N);g(A,U+0,E,$),g(I,U+2,T,$),g(k,U+4,x,$)}}function g(E,T,x,N){N<0&&E.x===1&&(a[T]=E.x-1),x.x===0&&x.z===0&&(a[T]=N/2/Math.PI+.5)}function _(E){return Math.atan2(E.z,-E.x)}function v(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jb(e.vertices,e.indices,e.radius,e.details)}}class m3 extends jb{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,i=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new m3(e.radius,e.detail)}}const pk=new Re,mk=new Re,Hz=new Re,gk=new Lh;class lae extends Qr{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const i=Math.pow(10,4),s=Math.cos(zS*n),a=e.getIndex(),o=e.getAttribute("position"),c=a?a.count:o.count,l=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let p=0;p<c;p+=3){a?(l[0]=a.getX(p),l[1]=a.getX(p+1),l[2]=a.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:g,b:_,c:v}=gk;if(g.fromBufferAttribute(o,l[0]),_.fromBufferAttribute(o,l[1]),v.fromBufferAttribute(o,l[2]),gk.getNormal(Hz),h[0]=`${Math.round(g.x*i)},${Math.round(g.y*i)},${Math.round(g.z*i)}`,h[1]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,h[2]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let E=0;E<3;E++){const T=(E+1)%3,x=h[E],N=h[T],A=gk[u[E]],I=gk[u[T]],k=`${x}_${N}`,L=`${N}_${x}`;L in d&&d[L]?(Hz.dot(d[L].normal)<=s&&(f.push(A.x,A.y,A.z),f.push(I.x,I.y,I.z)),d[L]=null):k in d||(d[k]={index0:l[E],index1:l[T],normal:Hz.clone()})}}for(const p in d)if(d[p]){const{index0:g,index1:_}=d[p];pk.fromBufferAttribute(o,g),mk.fromBufferAttribute(o,_),f.push(pk.x,pk.y,pk.z),f.push(mk.x,mk.y,mk.z)}this.setAttribute("position",new Hn(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class lm{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,n){const r=this.getUtoTmapping(e);return this.getPoint(r,n)}getPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return n}getSpacedPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPointAt(r/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let r,i=this.getPoint(0),s=0;n.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(i),n.push(s),i=r;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n=null){const r=this.getLengths();let i=0;const s=r.length;let a;n?a=n:a=e*r[s-1];let o=0,c=s-1,l;for(;o<=c;)if(i=Math.floor(o+(c-o)/2),l=r[i]-a,l<0)o=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,r[i]===a)return i/(s-1);const u=r[i],d=r[i+1]-u,f=(a-u)/d;return(i+f)/(s-1)}getTangent(e,n){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),c=n||(a.isVector2?new Rt:new Re);return c.copy(o).sub(a).normalize(),c}getTangentAt(e,n){const r=this.getUtoTmapping(e);return this.getTangent(r,n)}computeFrenetFrames(e,n=!1){const r=new Re,i=[],s=[],a=[],o=new Re,c=new Nr;for(let f=0;f<=e;f++){const p=f/e;i[f]=this.getTangentAt(p,new Re)}s[0]=new Re,a[0]=new Re;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),h=Math.abs(i[0].y),d=Math.abs(i[0].z);u<=l&&(l=u,r.set(1,0,0)),h<=l&&(l=h,r.set(0,1,0)),d<=l&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();const p=Math.acos(Xr(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(c.makeRotationAxis(o,p))}a[f].crossVectors(i[f],s[f])}if(n===!0){let f=Math.acos(Xr(s[0].dot(s[e]),-1,1));f/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(c.makeRotationAxis(i[p],f*p)),a[p].crossVectors(i[p],s[p])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class g3 extends lm{constructor(e=0,n=0,r=1,i=1,s=0,a=Math.PI*2,o=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=c}getPoint(e,n=new Rt){const r=n,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=c-this.aX,f=l-this.aY;c=d*u-f*h+this.aX,l=d*h+f*u+this.aY}return r.set(c,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class uae extends g3{constructor(e,n,r,i,s,a){super(e,n,r,r,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Oq(){let t=0,e=0,n=0,r=0;function i(s,a,o,c){t=s,e=o,n=-3*s+3*a-2*o-c,r=2*s-2*a+o+c}return{initCatmullRom:function(s,a,o,c,l){i(a,o,l*(o-s),l*(c-a))},initNonuniformCatmullRom:function(s,a,o,c,l,u,h){let d=(a-s)/l-(o-s)/(l+u)+(o-a)/u,f=(o-a)/u-(c-a)/(u+h)+(c-o)/h;d*=u,f*=u,i(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return t+e*s+n*a+r*o}}}const vk=new Re,jz=new Oq,Vz=new Oq,Gz=new Oq;class hae extends lm{constructor(e=[],n=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=r,this.tension=i}getPoint(e,n=new Re){const r=n,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),c=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:c===0&&o===s-1&&(o=s-2,c=1);let l,u;this.closed||o>0?l=i[(o-1)%s]:(vk.subVectors(i[0],i[1]).add(i[0]),l=vk);const h=i[o%s],d=i[(o+1)%s];if(this.closed||o+2<s?u=i[(o+2)%s]:(vk.subVectors(i[s-1],i[s-2]).add(i[s-1]),u=vk),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(l.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),_=Math.pow(d.distanceToSquared(u),f);g<1e-4&&(g=1),p<1e-4&&(p=g),_<1e-4&&(_=g),jz.initNonuniformCatmullRom(l.x,h.x,d.x,u.x,p,g,_),Vz.initNonuniformCatmullRom(l.y,h.y,d.y,u.y,p,g,_),Gz.initNonuniformCatmullRom(l.z,h.z,d.z,u.z,p,g,_)}else this.curveType==="catmullrom"&&(jz.initCatmullRom(l.x,h.x,d.x,u.x,this.tension),Vz.initCatmullRom(l.y,h.y,d.y,u.y,this.tension),Gz.initCatmullRom(l.z,h.z,d.z,u.z,this.tension));return r.set(jz.calc(c),Vz.calc(c),Gz.calc(c)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const i=this.points[n];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(new Re().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function JX(t,e,n,r,i){const s=(r-e)*.5,a=(i-n)*.5,o=t*t,c=t*o;return(2*n-2*r+s+a)*c+(-3*n+3*r-2*s-a)*o+s*t+n}function JTe(t,e){const n=1-t;return n*n*e}function ZTe(t,e){return 2*(1-t)*t*e}function QTe(t,e){return t*t*e}function LA(t,e,n,r){return JTe(t,e)+ZTe(t,n)+QTe(t,r)}function exe(t,e){const n=1-t;return n*n*n*e}function txe(t,e){const n=1-t;return 3*n*n*t*e}function nxe(t,e){return 3*(1-t)*t*t*e}function rxe(t,e){return t*t*t*e}function UA(t,e,n,r,i){return exe(t,e)+txe(t,n)+nxe(t,r)+rxe(t,i)}class Nq extends lm{constructor(e=new Rt,n=new Rt,r=new Rt,i=new Rt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=r,this.v3=i}getPoint(e,n=new Rt){const r=n,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(UA(e,i.x,s.x,a.x,o.x),UA(e,i.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class dae extends lm{constructor(e=new Re,n=new Re,r=new Re,i=new Re){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=r,this.v3=i}getPoint(e,n=new Re){const r=n,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(UA(e,i.x,s.x,a.x,o.x),UA(e,i.y,s.y,a.y,o.y),UA(e,i.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Iq extends lm{constructor(e=new Rt,n=new Rt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new Rt){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new Rt){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class fae extends lm{constructor(e=new Re,n=new Re){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new Re){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new Re){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kq extends lm{constructor(e=new Rt,n=new Rt,r=new Rt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new Rt){const r=n,i=this.v0,s=this.v1,a=this.v2;return r.set(LA(e,i.x,s.x,a.x),LA(e,i.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dq extends lm{constructor(e=new Re,n=new Re,r=new Re){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new Re){const r=n,i=this.v0,s=this.v1,a=this.v2;return r.set(LA(e,i.x,s.x,a.x),LA(e,i.y,s.y,a.y),LA(e,i.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Pq extends lm{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new Rt){const r=n,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,c=i[a===0?a:a-1],l=i[a],u=i[a>i.length-2?i.length-1:a+1],h=i[a>i.length-3?i.length-1:a+2];return r.set(JX(o,c.x,l.x,u.x,h.x),JX(o,c.y,l.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const i=this.points[n];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(new Rt().fromArray(i))}return this}}var kL=Object.freeze({__proto__:null,ArcCurve:uae,CatmullRomCurve3:hae,CubicBezierCurve:Nq,CubicBezierCurve3:dae,EllipseCurve:g3,LineCurve:Iq,LineCurve3:fae,QuadraticBezierCurve:kq,QuadraticBezierCurve3:Dq,SplineCurve:Pq});class pae extends lm{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(n)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new kL[r](n,e))}return this}getPoint(e,n){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const a=i[s]-r,o=this.curves[s],c=o.getLength(),l=c===0?0:1-a/c;return o.getPointAt(l,n)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let r=0,i=this.curves.length;r<i;r++)n+=this.curves[r].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(o);for(let l=0;l<c.length;l++){const u=c[l];r&&r.equals(u)||(n.push(u),r=u)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const i=e.curves[n];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,r=this.curves.length;n<r;n++){const i=this.curves[n];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const i=e.curves[n];this.curves.push(new kL[i.type]().fromJSON(i))}return this}}class DL extends pae{constructor(e){super(),this.type="Path",this.currentPoint=new Rt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,r=e.length;n<r;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const r=new Iq(this.currentPoint.clone(),new Rt(e,n));return this.curves.push(r),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,r,i){const s=new kq(this.currentPoint.clone(),new Rt(e,n),new Rt(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,n,r,i,s,a){const o=new Nq(this.currentPoint.clone(),new Rt(e,n),new Rt(r,i),new Rt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),r=new Pq(n);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,r,i,s,a){const o=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+o,n+c,r,i,s,a),this}absarc(e,n,r,i,s,a){return this.absellipse(e,n,r,r,i,s,a),this}ellipse(e,n,r,i,s,a,o,c){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,n+u,r,i,s,a,o,c),this}absellipse(e,n,r,i,s,a,o,c){const l=new g3(e,n,r,i,s,a,o,c);if(this.curves.length>0){const h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class HS extends DL{constructor(e){super(e),this.uuid=Gd(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let r=0,i=this.holes.length;r<i;r++)n[r]=this.holes[r].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const i=e.holes[n];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,r=this.holes.length;n<r;n++){const i=this.holes[n];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const i=e.holes[n];this.holes.push(new DL().fromJSON(i))}return this}}function ixe(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let s=mae(t,0,i,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,c,l;if(r&&(s=lxe(t,e,s,n)),t.length>80*n){o=1/0,c=1/0;let u=-1/0,h=-1/0;for(let d=n;d<i;d+=n){const f=t[d],p=t[d+1];f<o&&(o=f),p<c&&(c=p),f>u&&(u=f),p>h&&(h=p)}l=Math.max(u-o,h-c),l=l!==0?32767/l:0}return RM(s,a,n,o,c,l,0),a}function mae(t,e,n,r,i){let s;if(i===bxe(t,e,n,r)>0)for(let a=e;a<n;a+=r)s=ZX(a/r|0,t[a],t[a+1],s);else for(let a=n-r;a>=e;a-=r)s=ZX(a/r|0,t[a],t[a+1],s);return s&&Vw(s,s.next)&&(MM(s),s=s.next),s}function aT(t,e){if(!t)return t;e||(e=t);let n=t,r;do if(r=!1,!n.steiner&&(Vw(n,n.next)||Xa(n.prev,n,n.next)===0)){if(MM(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function RM(t,e,n,r,i,s,a){if(!t)return;!a&&s&&pxe(t,r,i,s);let o=t;for(;t.prev!==t.next;){const c=t.prev,l=t.next;if(s?axe(t,r,i,s):sxe(t)){e.push(c.i,t.i,l.i),MM(t),t=l.next,o=l.next;continue}if(t=l,t===o){a?a===1?(t=oxe(aT(t),e),RM(t,e,n,r,i,s,2)):a===2&&cxe(t,e,n,r,i,s):RM(aT(t),e,n,r,i,s,1);break}}}function sxe(t){const e=t.prev,n=t,r=t.next;if(Xa(e,n,r)>=0)return!1;const i=e.x,s=n.x,a=r.x,o=e.y,c=n.y,l=r.y,u=Math.min(i,s,a),h=Math.min(o,c,l),d=Math.max(i,s,a),f=Math.max(o,c,l);let p=r.next;for(;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&fA(i,o,s,c,a,l,p.x,p.y)&&Xa(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function axe(t,e,n,r){const i=t.prev,s=t,a=t.next;if(Xa(i,s,a)>=0)return!1;const o=i.x,c=s.x,l=a.x,u=i.y,h=s.y,d=a.y,f=Math.min(o,c,l),p=Math.min(u,h,d),g=Math.max(o,c,l),_=Math.max(u,h,d),v=zj(f,p,e,n,r),E=zj(g,_,e,n,r);let T=t.prevZ,x=t.nextZ;for(;T&&T.z>=v&&x&&x.z<=E;){if(T.x>=f&&T.x<=g&&T.y>=p&&T.y<=_&&T!==i&&T!==a&&fA(o,u,c,h,l,d,T.x,T.y)&&Xa(T.prev,T,T.next)>=0||(T=T.prevZ,x.x>=f&&x.x<=g&&x.y>=p&&x.y<=_&&x!==i&&x!==a&&fA(o,u,c,h,l,d,x.x,x.y)&&Xa(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;T&&T.z>=v;){if(T.x>=f&&T.x<=g&&T.y>=p&&T.y<=_&&T!==i&&T!==a&&fA(o,u,c,h,l,d,T.x,T.y)&&Xa(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;x&&x.z<=E;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=_&&x!==i&&x!==a&&fA(o,u,c,h,l,d,x.x,x.y)&&Xa(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function oxe(t,e){let n=t;do{const r=n.prev,i=n.next.next;!Vw(r,i)&&vae(r,n,n.next,i)&&AM(r,i)&&AM(i,r)&&(e.push(r.i,n.i,i.i),MM(n),MM(n.next),n=t=i),n=n.next}while(n!==t);return aT(n)}function cxe(t,e,n,r,i,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&vxe(a,o)){let c=yae(a,o);a=aT(a,a.next),c=aT(c,c.next),RM(a,e,n,r,i,s,0),RM(c,e,n,r,i,s,0);return}o=o.next}a=a.next}while(a!==t)}function lxe(t,e,n,r){const i=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*r,c=s<a-1?e[s+1]*r:t.length,l=mae(t,o,c,r,!1);l===l.next&&(l.steiner=!0),i.push(gxe(l))}i.sort(uxe);for(let s=0;s<i.length;s++)n=hxe(i[s],n);return n}function uxe(t,e){let n=t.x-e.x;if(n===0&&(n=t.y-e.y,n===0)){const r=(t.next.y-t.y)/(t.next.x-t.x),i=(e.next.y-e.y)/(e.next.x-e.x);n=r-i}return n}function hxe(t,e){const n=dxe(t,e);if(!n)return e;const r=yae(n,t);return aT(r,r.next),aT(n,n.next)}function dxe(t,e){let n=e;const r=t.x,i=t.y;let s=-1/0,a;if(Vw(t,n))return n;do{if(Vw(t,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const h=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=r&&h>s&&(s=h,a=n.x<n.next.x?n:n.next,h===r))return a}n=n.next}while(n!==e);if(!a)return null;const o=a,c=a.x,l=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=c&&r!==n.x&&gae(i<l?r:s,i,c,l,i<l?s:r,i,n.x,n.y)){const h=Math.abs(i-n.y)/(r-n.x);AM(n,t)&&(h<u||h===u&&(n.x>a.x||n.x===a.x&&fxe(a,n)))&&(a=n,u=h)}n=n.next}while(n!==o);return a}function fxe(t,e){return Xa(t.prev,t,e.prev)<0&&Xa(e.next,t,t.next)<0}function pxe(t,e,n,r){let i=t;do i.z===0&&(i.z=zj(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,mxe(i)}function mxe(t){let e,n=1;do{let r=t,i;t=null;let s=null;for(e=0;r;){e++;let a=r,o=0;for(let l=0;l<n&&(o++,a=a.nextZ,!!a);l++);let c=n;for(;o>0||c>0&&a;)o!==0&&(c===0||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,c--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(e>1);return t}function zj(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function gxe(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function gae(t,e,n,r,i,s,a,o){return(i-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(i-a)*(r-o)}function fA(t,e,n,r,i,s,a,o){return!(t===a&&e===o)&&gae(t,e,n,r,i,s,a,o)}function vxe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!yxe(t,e)&&(AM(t,e)&&AM(e,t)&&_xe(t,e)&&(Xa(t.prev,t,e.prev)||Xa(t,e.prev,e))||Vw(t,e)&&Xa(t.prev,t,t.next)>0&&Xa(e.prev,e,e.next)>0)}function Xa(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Vw(t,e){return t.x===e.x&&t.y===e.y}function vae(t,e,n,r){const i=_k(Xa(t,e,n)),s=_k(Xa(t,e,r)),a=_k(Xa(n,r,t)),o=_k(Xa(n,r,e));return!!(i!==s&&a!==o||i===0&&yk(t,n,e)||s===0&&yk(t,r,e)||a===0&&yk(n,t,r)||o===0&&yk(n,e,r))}function yk(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function _k(t){return t>0?1:t<0?-1:0}function yxe(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&vae(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function AM(t,e){return Xa(t.prev,t,t.next)<0?Xa(t,e,t.next)>=0&&Xa(t,t.prev,e)>=0:Xa(t,e,t.prev)<0||Xa(t,t.next,e)<0}function _xe(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function yae(t,e){const n=Hj(t.i,t.x,t.y),r=Hj(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function ZX(t,e,n,r){const i=Hj(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function MM(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hj(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function bxe(t,e,n,r){let i=0;for(let s=e,a=n-r;s<n;s+=r)i+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return i}class Exe{static triangulate(e,n,r=2){return ixe(e,n,r)}}class Zp{static area(e){const n=e.length;let r=0;for(let i=n-1,s=0;s<n;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return r*.5}static isClockWise(e){return Zp.area(e)<0}static triangulateShape(e,n){const r=[],i=[],s=[];QX(e),eK(r,e);let a=e.length;n.forEach(QX);for(let c=0;c<n.length;c++)i.push(a),a+=n[c].length,eK(r,n[c]);const o=Exe.triangulate(r,i);for(let c=0;c<o.length;c+=3)s.push(o.slice(c,c+3));return s}}function QX(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function eK(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class v3 extends Qr{constructor(e=new HS([new Rt(.5,.5),new Rt(-.5,.5),new Rt(-.5,-.5),new Rt(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let o=0,c=e.length;o<c;o++){const l=e[o];a(l)}this.setAttribute("position",new Hn(i,3)),this.setAttribute("uv",new Hn(s,2)),this.computeVertexNormals();function a(o){const c=[],l=n.curveSegments!==void 0?n.curveSegments:12,u=n.steps!==void 0?n.steps:1,h=n.depth!==void 0?n.depth:1;let d=n.bevelEnabled!==void 0?n.bevelEnabled:!0,f=n.bevelThickness!==void 0?n.bevelThickness:.2,p=n.bevelSize!==void 0?n.bevelSize:f-.1,g=n.bevelOffset!==void 0?n.bevelOffset:0,_=n.bevelSegments!==void 0?n.bevelSegments:3;const v=n.extrudePath,E=n.UVGenerator!==void 0?n.UVGenerator:Sxe;let T,x=!1,N,A,I,k;v&&(T=v.getSpacedPoints(u),x=!0,d=!1,N=v.computeFrenetFrames(u,!1),A=new Re,I=new Re,k=new Re),d||(_=0,f=0,p=0,g=0);const L=o.extractPoints(l);let U=L.shape;const $=L.holes;if(!Zp.isClockWise(U)){U=U.reverse();for(let fe=0,Fe=$.length;fe<Fe;fe++){const Ie=$[fe];Zp.isClockWise(Ie)&&($[fe]=Ie.reverse())}}function G(fe){const Ie=10000000000000001e-36;let rt=fe[0];for(let dt=1;dt<=fe.length;dt++){const gt=dt%fe.length,bt=fe[gt],be=bt.x-rt.x,ue=bt.y-rt.y,Xe=be*be+ue*ue,nt=Math.max(Math.abs(bt.x),Math.abs(bt.y),Math.abs(rt.x),Math.abs(rt.y)),$e=Ie*nt*nt;if(Xe<=$e){fe.splice(gt,1),dt--;continue}rt=bt}}G(U),$.forEach(G);const X=$.length,re=U;for(let fe=0;fe<X;fe++){const Fe=$[fe];U=U.concat(Fe)}function V(fe,Fe,Ie){return Fe||console.error("THREE.ExtrudeGeometry: vec does not exist"),fe.clone().addScaledVector(Fe,Ie)}const Z=U.length;function Y(fe,Fe,Ie){let rt,dt,gt;const bt=fe.x-Fe.x,be=fe.y-Fe.y,ue=Ie.x-fe.x,Xe=Ie.y-fe.y,nt=bt*bt+be*be,$e=bt*Xe-be*ue;if(Math.abs($e)>Number.EPSILON){const Ue=Math.sqrt(nt),qt=Math.sqrt(ue*ue+Xe*Xe),Mt=Fe.x-be/Ue,Yt=Fe.y+bt/Ue,ce=Ie.x-Xe/qt,j=Ie.y+ue/qt,W=((ce-Mt)*Xe-(j-Yt)*ue)/(bt*Xe-be*ue);rt=Mt+bt*W-fe.x,dt=Yt+be*W-fe.y;const me=rt*rt+dt*dt;if(me<=2)return new Rt(rt,dt);gt=Math.sqrt(me/2)}else{let Ue=!1;bt>Number.EPSILON?ue>Number.EPSILON&&(Ue=!0):bt<-Number.EPSILON?ue<-Number.EPSILON&&(Ue=!0):Math.sign(be)===Math.sign(Xe)&&(Ue=!0),Ue?(rt=-be,dt=bt,gt=Math.sqrt(nt)):(rt=bt,dt=be,gt=Math.sqrt(nt/2))}return new Rt(rt/gt,dt/gt)}const ee=[];for(let fe=0,Fe=re.length,Ie=Fe-1,rt=fe+1;fe<Fe;fe++,Ie++,rt++)Ie===Fe&&(Ie=0),rt===Fe&&(rt=0),ee[fe]=Y(re[fe],re[Ie],re[rt]);const oe=[];let de,Me=ee.concat();for(let fe=0,Fe=X;fe<Fe;fe++){const Ie=$[fe];de=[];for(let rt=0,dt=Ie.length,gt=dt-1,bt=rt+1;rt<dt;rt++,gt++,bt++)gt===dt&&(gt=0),bt===dt&&(bt=0),de[rt]=Y(Ie[rt],Ie[gt],Ie[bt]);oe.push(de),Me=Me.concat(de)}let He;if(_===0)He=Zp.triangulateShape(re,$);else{const fe=[],Fe=[];for(let Ie=0;Ie<_;Ie++){const rt=Ie/_,dt=f*Math.cos(rt*Math.PI/2),gt=p*Math.sin(rt*Math.PI/2)+g;for(let bt=0,be=re.length;bt<be;bt++){const ue=V(re[bt],ee[bt],gt);St(ue.x,ue.y,-dt),rt===0&&fe.push(ue)}for(let bt=0,be=X;bt<be;bt++){const ue=$[bt];de=oe[bt];const Xe=[];for(let nt=0,$e=ue.length;nt<$e;nt++){const Ue=V(ue[nt],de[nt],gt);St(Ue.x,Ue.y,-dt),rt===0&&Xe.push(Ue)}rt===0&&Fe.push(Xe)}}He=Zp.triangulateShape(fe,Fe)}const Te=He.length,Le=p+g;for(let fe=0;fe<Z;fe++){const Fe=d?V(U[fe],Me[fe],Le):U[fe];x?(I.copy(N.normals[0]).multiplyScalar(Fe.x),A.copy(N.binormals[0]).multiplyScalar(Fe.y),k.copy(T[0]).add(I).add(A),St(k.x,k.y,k.z)):St(Fe.x,Fe.y,0)}for(let fe=1;fe<=u;fe++)for(let Fe=0;Fe<Z;Fe++){const Ie=d?V(U[Fe],Me[Fe],Le):U[Fe];x?(I.copy(N.normals[fe]).multiplyScalar(Ie.x),A.copy(N.binormals[fe]).multiplyScalar(Ie.y),k.copy(T[fe]).add(I).add(A),St(k.x,k.y,k.z)):St(Ie.x,Ie.y,h/u*fe)}for(let fe=_-1;fe>=0;fe--){const Fe=fe/_,Ie=f*Math.cos(Fe*Math.PI/2),rt=p*Math.sin(Fe*Math.PI/2)+g;for(let dt=0,gt=re.length;dt<gt;dt++){const bt=V(re[dt],ee[dt],rt);St(bt.x,bt.y,h+Ie)}for(let dt=0,gt=$.length;dt<gt;dt++){const bt=$[dt];de=oe[dt];for(let be=0,ue=bt.length;be<ue;be++){const Xe=V(bt[be],de[be],rt);x?St(Xe.x,Xe.y+T[u-1].y,T[u-1].x+Ie):St(Xe.x,Xe.y,h+Ie)}}}we(),Ce();function we(){const fe=i.length/3;if(d){let Fe=0,Ie=Z*Fe;for(let rt=0;rt<Te;rt++){const dt=He[rt];At(dt[2]+Ie,dt[1]+Ie,dt[0]+Ie)}Fe=u+_*2,Ie=Z*Fe;for(let rt=0;rt<Te;rt++){const dt=He[rt];At(dt[0]+Ie,dt[1]+Ie,dt[2]+Ie)}}else{for(let Fe=0;Fe<Te;Fe++){const Ie=He[Fe];At(Ie[2],Ie[1],Ie[0])}for(let Fe=0;Fe<Te;Fe++){const Ie=He[Fe];At(Ie[0]+Z*u,Ie[1]+Z*u,Ie[2]+Z*u)}}r.addGroup(fe,i.length/3-fe,0)}function Ce(){const fe=i.length/3;let Fe=0;ke(re,Fe),Fe+=re.length;for(let Ie=0,rt=$.length;Ie<rt;Ie++){const dt=$[Ie];ke(dt,Fe),Fe+=dt.length}r.addGroup(fe,i.length/3-fe,1)}function ke(fe,Fe){let Ie=fe.length;for(;--Ie>=0;){const rt=Ie;let dt=Ie-1;dt<0&&(dt=fe.length-1);for(let gt=0,bt=u+_*2;gt<bt;gt++){const be=Z*gt,ue=Z*(gt+1),Xe=Fe+rt+be,nt=Fe+dt+be,$e=Fe+dt+ue,Ue=Fe+rt+ue;Ee(Xe,nt,$e,Ue)}}}function St(fe,Fe,Ie){c.push(fe),c.push(Fe),c.push(Ie)}function At(fe,Fe,Ie){ye(fe),ye(Fe),ye(Ie);const rt=i.length/3,dt=E.generateTopUV(r,i,rt-3,rt-2,rt-1);et(dt[0]),et(dt[1]),et(dt[2])}function Ee(fe,Fe,Ie,rt){ye(fe),ye(Fe),ye(rt),ye(Fe),ye(Ie),ye(rt);const dt=i.length/3,gt=E.generateSideWallUV(r,i,dt-6,dt-3,dt-2,dt-1);et(gt[0]),et(gt[1]),et(gt[3]),et(gt[1]),et(gt[2]),et(gt[3])}function ye(fe){i.push(c[fe*3+0]),i.push(c[fe*3+1]),i.push(c[fe*3+2])}function et(fe){s.push(fe.x),s.push(fe.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,r=this.parameters.options;return Txe(n,r,e)}static fromJSON(e,n){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=n[e.shapes[s]];r.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new kL[i.type]().fromJSON(i)),new v3(r,e.options)}}const Sxe={generateTopUV:function(t,e,n,r,i){const s=e[n*3],a=e[n*3+1],o=e[r*3],c=e[r*3+1],l=e[i*3],u=e[i*3+1];return[new Rt(s,a),new Rt(o,c),new Rt(l,u)]},generateSideWallUV:function(t,e,n,r,i,s){const a=e[n*3],o=e[n*3+1],c=e[n*3+2],l=e[r*3],u=e[r*3+1],h=e[r*3+2],d=e[i*3],f=e[i*3+1],p=e[i*3+2],g=e[s*3],_=e[s*3+1],v=e[s*3+2];return Math.abs(o-u)<Math.abs(a-l)?[new Rt(a,1-c),new Rt(l,1-h),new Rt(d,1-p),new Rt(g,1-v)]:[new Rt(o,1-c),new Rt(u,1-h),new Rt(f,1-p),new Rt(_,1-v)]}};function Txe(t,e,n){if(n.shapes=[],Array.isArray(t))for(let r=0,i=t.length;r<i;r++){const s=t[r];n.shapes.push(s.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class y3 extends jb{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new y3(e.radius,e.detail)}}class _3 extends Qr{constructor(e=[new Rt(0,-.5),new Rt(.5,0),new Rt(0,.5)],n=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:r,phiLength:i},n=Math.floor(n),i=Xr(i,0,Math.PI*2);const s=[],a=[],o=[],c=[],l=[],u=1/n,h=new Re,d=new Rt,f=new Re,p=new Re,g=new Re;let _=0,v=0;for(let E=0;E<=e.length-1;E++)switch(E){case 0:_=e[E+1].x-e[E].x,v=e[E+1].y-e[E].y,f.x=v*1,f.y=-_,f.z=v*0,g.copy(f),f.normalize(),c.push(f.x,f.y,f.z);break;case e.length-1:c.push(g.x,g.y,g.z);break;default:_=e[E+1].x-e[E].x,v=e[E+1].y-e[E].y,f.x=v*1,f.y=-_,f.z=v*0,p.copy(f),f.x+=g.x,f.y+=g.y,f.z+=g.z,f.normalize(),c.push(f.x,f.y,f.z),g.copy(p)}for(let E=0;E<=n;E++){const T=r+E*u*i,x=Math.sin(T),N=Math.cos(T);for(let A=0;A<=e.length-1;A++){h.x=e[A].x*x,h.y=e[A].y,h.z=e[A].x*N,a.push(h.x,h.y,h.z),d.x=E/n,d.y=A/(e.length-1),o.push(d.x,d.y);const I=c[3*A+0]*x,k=c[3*A+1],L=c[3*A+0]*N;l.push(I,k,L)}}for(let E=0;E<n;E++)for(let T=0;T<e.length-1;T++){const x=T+E*e.length,N=x,A=x+e.length,I=x+e.length+1,k=x+1;s.push(N,A,k),s.push(I,k,A)}this.setIndex(s),this.setAttribute("position",new Hn(a,3)),this.setAttribute("uv",new Hn(o,2)),this.setAttribute("normal",new Hn(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _3(e.points,e.segments,e.phiStart,e.phiLength)}}class iN extends jb{constructor(e=1,n=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new iN(e.radius,e.detail)}}class BC extends Qr{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const s=e/2,a=n/2,o=Math.floor(r),c=Math.floor(i),l=o+1,u=c+1,h=e/o,d=n/c,f=[],p=[],g=[],_=[];for(let v=0;v<u;v++){const E=v*d-a;for(let T=0;T<l;T++){const x=T*h-s;p.push(x,-E,0),g.push(0,0,1),_.push(T/o),_.push(1-v/c)}}for(let v=0;v<c;v++)for(let E=0;E<o;E++){const T=E+l*v,x=E+l*(v+1),N=E+1+l*(v+1),A=E+1+l*v;f.push(T,x,A),f.push(x,N,A)}this.setIndex(f),this.setAttribute("position",new Hn(p,3)),this.setAttribute("normal",new Hn(g,3)),this.setAttribute("uv",new Hn(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BC(e.width,e.height,e.widthSegments,e.heightSegments)}}class b3 extends Qr{constructor(e=.5,n=1,r=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:i,thetaStart:s,thetaLength:a},r=Math.max(3,r),i=Math.max(1,i);const o=[],c=[],l=[],u=[];let h=e;const d=(n-e)/i,f=new Re,p=new Rt;for(let g=0;g<=i;g++){for(let _=0;_<=r;_++){const v=s+_/r*a;f.x=h*Math.cos(v),f.y=h*Math.sin(v),c.push(f.x,f.y,f.z),l.push(0,0,1),p.x=(f.x/n+1)/2,p.y=(f.y/n+1)/2,u.push(p.x,p.y)}h+=d}for(let g=0;g<i;g++){const _=g*(r+1);for(let v=0;v<r;v++){const E=v+_,T=E,x=E+r+1,N=E+r+2,A=E+1;o.push(T,x,A),o.push(x,N,A)}}this.setIndex(o),this.setAttribute("position",new Hn(c,3)),this.setAttribute("normal",new Hn(l,3)),this.setAttribute("uv",new Hn(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new b3(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class E3 extends Qr{constructor(e=new HS([new Rt(0,.5),new Rt(-.5,-.5),new Rt(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const r=[],i=[],s=[],a=[];let o=0,c=0;if(Array.isArray(e)===!1)l(e);else for(let u=0;u<e.length;u++)l(e[u]),this.addGroup(o,c,u),o+=c,c=0;this.setIndex(r),this.setAttribute("position",new Hn(i,3)),this.setAttribute("normal",new Hn(s,3)),this.setAttribute("uv",new Hn(a,2));function l(u){const h=i.length/3,d=u.extractPoints(n);let f=d.shape;const p=d.holes;Zp.isClockWise(f)===!1&&(f=f.reverse());for(let _=0,v=p.length;_<v;_++){const E=p[_];Zp.isClockWise(E)===!0&&(p[_]=E.reverse())}const g=Zp.triangulateShape(f,p);for(let _=0,v=p.length;_<v;_++){const E=p[_];f=f.concat(E)}for(let _=0,v=f.length;_<v;_++){const E=f[_];i.push(E.x,E.y,0),s.push(0,0,1),a.push(E.x,E.y)}for(let _=0,v=g.length;_<v;_++){const E=g[_],T=E[0]+h,x=E[1]+h,N=E[2]+h;r.push(T,x,N),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return xxe(n,e)}static fromJSON(e,n){const r=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=n[e.shapes[i]];r.push(a)}return new E3(r,e.curveSegments)}}function xxe(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}class sN extends Qr{constructor(e=1,n=32,r=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));const c=Math.min(a+o,Math.PI);let l=0;const u=[],h=new Re,d=new Re,f=[],p=[],g=[],_=[];for(let v=0;v<=r;v++){const E=[],T=v/r;let x=0;v===0&&a===0?x=.5/n:v===r&&c===Math.PI&&(x=-.5/n);for(let N=0;N<=n;N++){const A=N/n;h.x=-e*Math.cos(i+A*s)*Math.sin(a+T*o),h.y=e*Math.cos(a+T*o),h.z=e*Math.sin(i+A*s)*Math.sin(a+T*o),p.push(h.x,h.y,h.z),d.copy(h).normalize(),g.push(d.x,d.y,d.z),_.push(A+x,1-T),E.push(l++)}u.push(E)}for(let v=0;v<r;v++)for(let E=0;E<n;E++){const T=u[v][E+1],x=u[v][E],N=u[v+1][E],A=u[v+1][E+1];(v!==0||a>0)&&f.push(T,x,A),(v!==r-1||c<Math.PI)&&f.push(x,N,A)}this.setIndex(f),this.setAttribute("position",new Hn(p,3)),this.setAttribute("normal",new Hn(g,3)),this.setAttribute("uv",new Hn(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sN(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class S3 extends jb{constructor(e=1,n=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new S3(e.radius,e.detail)}}class T3 extends Qr{constructor(e=1,n=.4,r=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const a=[],o=[],c=[],l=[],u=new Re,h=new Re,d=new Re;for(let f=0;f<=r;f++)for(let p=0;p<=i;p++){const g=p/i*s,_=f/r*Math.PI*2;h.x=(e+n*Math.cos(_))*Math.cos(g),h.y=(e+n*Math.cos(_))*Math.sin(g),h.z=n*Math.sin(_),o.push(h.x,h.y,h.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),d.subVectors(h,u).normalize(),c.push(d.x,d.y,d.z),l.push(p/i),l.push(f/r)}for(let f=1;f<=r;f++)for(let p=1;p<=i;p++){const g=(i+1)*f+p-1,_=(i+1)*(f-1)+p-1,v=(i+1)*(f-1)+p,E=(i+1)*f+p;a.push(g,_,E),a.push(_,v,E)}this.setIndex(a),this.setAttribute("position",new Hn(o,3)),this.setAttribute("normal",new Hn(c,3)),this.setAttribute("uv",new Hn(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new T3(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class x3 extends Qr{constructor(e=1,n=.4,r=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:s,q:a},r=Math.floor(r),i=Math.floor(i);const o=[],c=[],l=[],u=[],h=new Re,d=new Re,f=new Re,p=new Re,g=new Re,_=new Re,v=new Re;for(let T=0;T<=r;++T){const x=T/r*s*Math.PI*2;E(x,s,a,e,f),E(x+.01,s,a,e,p),_.subVectors(p,f),v.addVectors(p,f),g.crossVectors(_,v),v.crossVectors(g,_),g.normalize(),v.normalize();for(let N=0;N<=i;++N){const A=N/i*Math.PI*2,I=-n*Math.cos(A),k=n*Math.sin(A);h.x=f.x+(I*v.x+k*g.x),h.y=f.y+(I*v.y+k*g.y),h.z=f.z+(I*v.z+k*g.z),c.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),l.push(d.x,d.y,d.z),u.push(T/r),u.push(N/i)}}for(let T=1;T<=r;T++)for(let x=1;x<=i;x++){const N=(i+1)*(T-1)+(x-1),A=(i+1)*T+(x-1),I=(i+1)*T+x,k=(i+1)*(T-1)+x;o.push(N,A,k),o.push(A,I,k)}this.setIndex(o),this.setAttribute("position",new Hn(c,3)),this.setAttribute("normal",new Hn(l,3)),this.setAttribute("uv",new Hn(u,2));function E(T,x,N,A,I){const k=Math.cos(T),L=Math.sin(T),U=N/x*T,$=Math.cos(U);I.x=A*(2+$)*.5*k,I.y=A*(2+$)*L*.5,I.z=A*Math.sin(U)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new x3(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class w3 extends Qr{constructor(e=new Dq(new Re(-1,-1,0),new Re(-1,1,0),new Re(1,1,0)),n=64,r=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:r,radialSegments:i,closed:s};const a=e.computeFrenetFrames(n,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Re,c=new Re,l=new Rt;let u=new Re;const h=[],d=[],f=[],p=[];g(),this.setIndex(p),this.setAttribute("position",new Hn(h,3)),this.setAttribute("normal",new Hn(d,3)),this.setAttribute("uv",new Hn(f,2));function g(){for(let T=0;T<n;T++)_(T);_(s===!1?n:0),E(),v()}function _(T){u=e.getPointAt(T/n,u);const x=a.normals[T],N=a.binormals[T];for(let A=0;A<=i;A++){const I=A/i*Math.PI*2,k=Math.sin(I),L=-Math.cos(I);c.x=L*x.x+k*N.x,c.y=L*x.y+k*N.y,c.z=L*x.z+k*N.z,c.normalize(),d.push(c.x,c.y,c.z),o.x=u.x+r*c.x,o.y=u.y+r*c.y,o.z=u.z+r*c.z,h.push(o.x,o.y,o.z)}}function v(){for(let T=1;T<=n;T++)for(let x=1;x<=i;x++){const N=(i+1)*(T-1)+(x-1),A=(i+1)*T+(x-1),I=(i+1)*T+x,k=(i+1)*(T-1)+x;p.push(N,A,k),p.push(A,I,k)}}function E(){for(let T=0;T<=n;T++)for(let x=0;x<=i;x++)l.x=T/n,l.y=x/i,f.push(l.x,l.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new w3(new kL[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class _ae extends Qr{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],r=new Set,i=new Re,s=new Re;if(e.index!==null){const a=e.attributes.position,o=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:o.count,materialIndex:0}]);for(let l=0,u=c.length;l<u;++l){const h=c[l],d=h.start,f=h.count;for(let p=d,g=d+f;p<g;p+=3)for(let _=0;_<3;_++){const v=o.getX(p+_),E=o.getX(p+(_+1)%3);i.fromBufferAttribute(a,v),s.fromBufferAttribute(a,E),tK(i,s,r)===!0&&(n.push(i.x,i.y,i.z),n.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,c=a.count/3;o<c;o++)for(let l=0;l<3;l++){const u=3*o+l,h=3*o+(l+1)%3;i.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),tK(i,s,r)===!0&&(n.push(i.x,i.y,i.z),n.push(s.x,s.y,s.z))}}this.setAttribute("position",new Hn(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function tK(t,e,n){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return n.has(r)===!0||n.has(i)===!0?!1:(n.add(r),n.add(i),!0)}var nK=Object.freeze({__proto__:null,BoxGeometry:UT,CapsuleGeometry:f3,CircleGeometry:p3,ConeGeometry:rN,CylinderGeometry:nN,DodecahedronGeometry:m3,EdgesGeometry:lae,ExtrudeGeometry:v3,IcosahedronGeometry:y3,LatheGeometry:_3,OctahedronGeometry:iN,PlaneGeometry:BC,PolyhedronGeometry:jb,RingGeometry:b3,ShapeGeometry:E3,SphereGeometry:sN,TetrahedronGeometry:S3,TorusGeometry:T3,TorusKnotGeometry:x3,TubeGeometry:w3,WireframeGeometry:_ae});class bae extends yl{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new _n(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Eae extends Bc{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Lq extends yl{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new _n(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xh,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Sae extends Lq{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Rt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Xr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new _n(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new _n(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new _n(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Tae extends yl{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new _n(16777215),this.specular=new _n(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xh,this.combine=KO,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class xae extends yl{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new _n(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Uq extends yl{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class wae extends yl{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new _n(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xh,this.combine=KO,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Bq extends yl{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Fb,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Fq extends yl{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Cae extends yl{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new _n(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zb,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Rae extends nh{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function DS(t,e){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function Aae(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Mae(t){function e(i,s){return t[i]-t[s]}const n=t.length,r=new Array(n);for(let i=0;i!==n;++i)r[i]=i;return r.sort(e),r}function jj(t,e,n){const r=t.length,i=new t.constructor(r);for(let s=0,a=0;a!==r;++s){const o=n[s]*e;for(let c=0;c!==e;++c)i[a++]=t[o+c]}return i}function zq(t,e,n,r){let i=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[i++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),n.push(...a)),s=t[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(n,n.length)),s=t[i++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),n.push(a)),s=t[i++];while(s!==void 0)}function wxe(t,e,n,r,i=30){const s=t.clone();s.name=e;const a=[];for(let c=0;c<s.tracks.length;++c){const l=s.tracks[c],u=l.getValueSize(),h=[],d=[];for(let f=0;f<l.times.length;++f){const p=l.times[f]*i;if(!(p<n||p>=r)){h.push(l.times[f]);for(let g=0;g<u;++g)d.push(l.values[f*u+g])}}h.length!==0&&(l.times=DS(h,l.times.constructor),l.values=DS(d,l.values.constructor),a.push(l))}s.tracks=a;let o=1/0;for(let c=0;c<s.tracks.length;++c)o>s.tracks[c].times[0]&&(o=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*o);return s.resetDuration(),s}function Cxe(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,s=e/r;for(let a=0;a<i;++a){const o=n.tracks[a],c=o.ValueTypeName;if(c==="bool"||c==="string")continue;const l=t.tracks.find(function(v){return v.name===o.name&&v.ValueTypeName===c});if(l===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=o.times.length-1;let g;if(s<=o.times[0]){const v=u,E=h-u;g=o.values.slice(v,E)}else if(s>=o.times[p]){const v=p*h+u,E=v+h-u;g=o.values.slice(v,E)}else{const v=o.createInterpolant(),E=u,T=h-u;v.evaluate(s),g=v.resultBuffer.slice(E,T)}c==="quaternion"&&new qh().fromArray(g).normalize().conjugate().toArray(g);const _=l.times.length;for(let v=0;v<_;++v){const E=v*f+d;if(c==="quaternion")qh.multiplyQuaternionsFlat(l.values,E,g,0,l.values,E);else{const T=f-d*2;for(let x=0;x<T;++x)l.values[E+x]-=g[x]}}}return t.blendMode=Sq,t}class Rxe{static convertArray(e,n){return DS(e,n)}static isTypedArray(e){return Aae(e)}static getKeyframeOrder(e){return Mae(e)}static sortedArray(e,n,r){return jj(e,n,r)}static flattenJSON(e,n,r,i){zq(e,n,r,i)}static subclip(e,n,r,i,s=30){return wxe(e,n,r,i,s)}static makeClipAdditive(e,n=0,r=e,i=30){return Cxe(e,n,r,i)}}class aN{constructor(e,n,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let r=this._cachedIndex,i=n[r],s=n[r-1];e:{t:{let a;n:{r:if(!(e<i)){for(let o=r+2;;){if(i===void 0){if(e<s)break r;return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=i,i=n[++r],e<i)break t}a=n.length;break n}if(!(e>=s)){const o=n[1];e<o&&(r=2,s=o);for(let c=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===c)break;if(i=s,s=n[--r-1],e>=s)break t}a=r,r=0;break n}break e}for(;r<a;){const o=r+a>>>1;e<n[o]?a=o:r=o+1}if(i=n[r],s=n[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)n[a]=r[s+a];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Oae extends aN{constructor(e,n,r,i){super(e,n,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:IS,endingEnd:IS}}intervalChanged_(e,n,r){const i=this.parameterPositions;let s=e-2,a=e+1,o=i[s],c=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case kS:s=e,o=2*n-r;break;case SM:s=i.length-2,o=n+i[s]-i[s+1];break;default:s=e,o=r}if(c===void 0)switch(this.getSettings_().endingEnd){case kS:a=e,c=2*r-n;break;case SM:a=1,c=r+i[1]-i[0];break;default:a=e-1,c=n}const l=(r-n)*.5,u=this.valueSize;this._weightPrev=l/(n-o),this._weightNext=l/(c-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,n,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,l=c-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(r-n)/(i-n),g=p*p,_=g*p,v=-d*_+2*d*g-d*p,E=(1+d)*_+(-1.5-2*d)*g+(-.5+d)*p+1,T=(-1-f)*_+(1.5+f)*g+.5*p,x=f*_-f*g;for(let N=0;N!==o;++N)s[N]=v*a[u+N]+E*a[l+N]+T*a[c+N]+x*a[h+N];return s}}class Hq extends aN{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e,n,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,l=c-o,u=(r-n)/(i-n),h=1-u;for(let d=0;d!==o;++d)s[d]=a[l+d]*h+a[c+d]*u;return s}}class Nae extends aN{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class dp{constructor(e,n,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=DS(n,this.TimeBufferType),this.values=DS(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let r;if(n.toJSON!==this.toJSON)r=n.toJSON(e);else{r={name:e.name,times:DS(e.times,Array),values:DS(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Nae(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Hq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Oae(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case EM:n=this.InterpolantFactoryMethodDiscrete;break;case OL:n=this.InterpolantFactoryMethodLinear;break;case UD:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return EM;case this.InterpolantFactoryMethodLinear:return OL;case this.InterpolantFactoryMethodSmooth:return UD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let r=0,i=n.length;r!==i;++r)n[r]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let r=0,i=n.length;r!==i;++r)n[r]*=e}return this}trim(e,n){const r=this.times,i=r.length;let s=0,a=i-1;for(;s!==i&&r[s]<e;)++s;for(;a!==-1&&r[a]>n;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const c=r[o];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,c,a),e=!1;break}a=c}if(i!==void 0&&Aae(i))for(let o=0,c=i.length;o!==c;++o){const l=i[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===UD,s=e.length-1;let a=1;for(let o=1;o<s;++o){let c=!1;const l=e[o],u=e[o+1];if(l!==u&&(o!==1||l!==e[0]))if(i)c=!0;else{const h=o*r,d=h-r,f=h+r;for(let p=0;p!==r;++p){const g=n[h+p];if(g!==n[d+p]||g!==n[f+p]){c=!0;break}}}if(c){if(o!==a){e[a]=e[o];const h=o*r,d=a*r;for(let f=0;f!==r;++f)n[d+f]=n[h+f]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,c=a*r,l=0;l!==r;++l)n[c+l]=n[o+l];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=n.slice(0,a*r)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),r=this.constructor,i=new r(this.name,e,n);return i.createInterpolant=this.createInterpolant,i}}dp.prototype.ValueTypeName="";dp.prototype.TimeBufferType=Float32Array;dp.prototype.ValueBufferType=Float32Array;dp.prototype.DefaultInterpolation=OL;class BT extends dp{constructor(e,n,r){super(e,n,r)}}BT.prototype.ValueTypeName="bool";BT.prototype.ValueBufferType=Array;BT.prototype.DefaultInterpolation=EM;BT.prototype.InterpolantFactoryMethodLinear=void 0;BT.prototype.InterpolantFactoryMethodSmooth=void 0;class jq extends dp{constructor(e,n,r,i){super(e,n,r,i)}}jq.prototype.ValueTypeName="color";class OM extends dp{constructor(e,n,r,i){super(e,n,r,i)}}OM.prototype.ValueTypeName="number";class Iae extends aN{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e,n,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=(r-n)/(i-n);let l=e*o;for(let u=l+o;l!==u;l+=4)qh.slerpFlat(s,0,a,l-o,a,l,c);return s}}class oN extends dp{constructor(e,n,r,i){super(e,n,r,i)}InterpolantFactoryMethodLinear(e){return new Iae(this.times,this.values,this.getValueSize(),e)}}oN.prototype.ValueTypeName="quaternion";oN.prototype.InterpolantFactoryMethodSmooth=void 0;class FT extends dp{constructor(e,n,r){super(e,n,r)}}FT.prototype.ValueTypeName="string";FT.prototype.ValueBufferType=Array;FT.prototype.DefaultInterpolation=EM;FT.prototype.InterpolantFactoryMethodLinear=void 0;FT.prototype.InterpolantFactoryMethodSmooth=void 0;class NM extends dp{constructor(e,n,r,i){super(e,n,r,i)}}NM.prototype.ValueTypeName="vector";class IM{constructor(e="",n=-1,r=[],i=i3){this.name=e,this.tracks=r,this.duration=n,this.blendMode=i,this.uuid=Gd(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,i=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)n.push(Mxe(r[a]).scale(i));const s=new this(e.name,e.duration,n,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const n=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=r.length;s!==a;++s)n.push(dp.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,n,r,i){const s=n.length,a=[];for(let o=0;o<s;o++){let c=[],l=[];c.push((o+s-1)%s,o,(o+1)%s),l.push(0,1,0);const u=Mae(c);c=jj(c,1,u),l=jj(l,1,u),!i&&c[0]===0&&(c.push(s),l.push(l[0])),a.push(new OM(".morphTargetInfluences["+n[o].name+"]",c,l).scale(1/r))}return new this(e,-1,a)}static findByName(e,n){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===n)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,n,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,c=e.length;o<c;o++){const l=e[o],u=l.name.match(s);if(u&&u.length>1){const h=u[1];let d=i[h];d||(i[h]=d=[]),d.push(l)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],n,r));return a}static parseAnimation(e,n){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,p,g){if(f.length!==0){const _=[],v=[];zq(f,_,v,p),_.length!==0&&g.push(new h(d,_,v))}},i=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let c=e.length||-1;const l=e.hierarchy||[];for(let h=0;h<l.length;h++){const d=l[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let g=0;g<d[p].morphTargets.length;g++)f[d[p].morphTargets[g]]=-1;for(const g in f){const _=[],v=[];for(let E=0;E!==d[p].morphTargets.length;++E){const T=d[p];_.push(T.time),v.push(T.morphTarget===g?1:0)}i.push(new OM(".morphTargetInfluence["+g+"]",_,v))}c=f.length*a}else{const f=".bones["+n[h].name+"]";r(NM,f+".position",d,"pos",i),r(oN,f+".quaternion",d,"rot",i),r(NM,f+".scale",d,"scl",i)}}return i.length===0?null:new this(s,c,i,o)}resetDuration(){const e=this.tracks;let n=0;for(let r=0,i=e.length;r!==i;++r){const s=this.tracks[r];n=Math.max(n,s.times[s.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Axe(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return OM;case"vector":case"vector2":case"vector3":case"vector4":return NM;case"color":return jq;case"quaternion":return oN;case"bool":case"boolean":return BT;case"string":return FT}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Mxe(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Axe(t.type);if(t.times===void 0){const n=[],r=[];zq(t.keys,n,r,"value"),t.times=n,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Iv={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Vq{constructor(e,n,r){const i=this;let s=!1,a=0,o=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(u){o++,s===!1&&i.onStart!==void 0&&i.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,i.onProgress!==void 0&&i.onProgress(u,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){const f=l[h],p=l[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const kae=new Vq;class id{constructor(e){this.manager=e!==void 0?e:kae,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,s){r.load(e,i,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}id.DEFAULT_MATERIAL_NAME="__DEFAULT";const lv={};class Oxe extends Error{constructor(e,n){super(e),this.response=n}}class Zv extends id{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,n,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Iv.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(s),this.manager.itemEnd(e)},0),s;if(lv[e]!==void 0){lv[e].push({onLoad:n,onProgress:r,onError:i});return}lv[e]=[],lv[e].push({onLoad:n,onProgress:r,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,c=this.responseType;fetch(a).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=lv[e],h=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let g=0;const _=new ReadableStream({start(v){E();function E(){h.read().then(({done:T,value:x})=>{if(T)v.close();else{g+=x.byteLength;const N=new ProgressEvent("progress",{lengthComputable:p,loaded:g,total:f});for(let A=0,I=u.length;A<I;A++){const k=u[A];k.onProgress&&k.onProgress(N)}v.enqueue(x),E()}},T=>{v.error(T)})}}});return new Response(_)}else throw new Oxe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return l.json();default:if(o==="")return l.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return l.arrayBuffer().then(p=>f.decode(p))}}}).then(l=>{Iv.add(e,l);const u=lv[e];delete lv[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(l)}}).catch(l=>{const u=lv[e];if(u===void 0)throw this.manager.itemError(e),l;delete lv[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Nxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=new Zv(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{n(s.parse(JSON.parse(o)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},r,i)}parse(e){const n=[];for(let r=0;r<e.length;r++){const i=IM.parse(e[r]);n.push(i)}return n}}class Ixe extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=[],o=new d3,c=new Zv(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let l=0;function u(h){c.load(e[h],function(d){const f=s.parse(d,!0);a[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},l+=1,l===6&&(f.mipmapCount===1&&(o.minFilter=_a),o.image=a,o.format=f.format,o.needsUpdate=!0,n&&n(o))},r,i)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else c.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let p=0;p<f;p++){a[p]={mipmaps:[]};for(let g=0;g<d.mipmapCount;g++)a[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+g]),a[p].format=d.format,a[p].width=d.width,a[p].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=_a),o.format=d.format,o.needsUpdate=!0,n&&n(o)},r,i);return o}}class kM extends id{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Iv.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(a),s.manager.itemEnd(e)},0),a;const o=CM("img");function c(){u(),Iv.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",c,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",c,!1),o.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class kxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=new tN;s.colorSpace=ya;const a=new kM(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function c(l){a.load(e[l],function(u){s.images[l]=u,o++,o===6&&(s.needsUpdate=!0,n&&n(s))},void 0,i)}for(let l=0;l<e.length;++l)c(l);return s}}class Dxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=new Qf,o=new Zv(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(c){let l;try{l=s.parse(c)}catch(u){if(i!==void 0)i(u);else{console.error(u);return}}l.image!==void 0?a.image=l.image:l.data!==void 0&&(a.image.width=l.width,a.image.height=l.height,a.image.data=l.data),a.wrapS=l.wrapS!==void 0?l.wrapS:qf,a.wrapT=l.wrapT!==void 0?l.wrapT:qf,a.magFilter=l.magFilter!==void 0?l.magFilter:_a,a.minFilter=l.minFilter!==void 0?l.minFilter:_a,a.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0&&(a.colorSpace=l.colorSpace),l.flipY!==void 0&&(a.flipY=l.flipY),l.format!==void 0&&(a.format=l.format),l.type!==void 0&&(a.type=l.type),l.mipmaps!==void 0&&(a.mipmaps=l.mipmaps,a.minFilter=_g),l.mipmapCount===1&&(a.minFilter=_a),l.generateMipmaps!==void 0&&(a.generateMipmaps=l.generateMipmaps),a.needsUpdate=!0,n&&n(a,l)},r,i),a}}class Pxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=new Pa,a=new kM(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,n!==void 0&&n(s)},r,i),s}}class Vb extends Gi{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new _n(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}class Dae extends Vb{constructor(e,n,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new _n(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const qz=new Nr,rK=new Re,iK=new Re;class Gq{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Rt(512,512),this.mapType=gl,this.map=null,this.mapPass=null,this.matrix=new Nr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new LC,this._frameExtents=new Rt(1,1),this._viewportCount=1,this._viewports=[new Ki(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,r=this.matrix;rK.setFromMatrixPosition(e.matrixWorld),n.position.copy(rK),iK.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(iK),n.updateMatrixWorld(),qz.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qz),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(qz)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Lxe extends Gq{constructor(){super(new Ic(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,r=Bw*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||n.far;(r!==n.fov||i!==n.aspect||s!==n.far)&&(n.fov=r,n.aspect=i,n.far=s,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Pae extends Vb{constructor(e,n,r=0,i=Math.PI/3,s=0,a=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gi.DEFAULT_UP),this.updateMatrix(),this.target=new Gi,this.distance=r,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Lxe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const sK=new Nr,FR=new Re,$z=new Re;class Uxe extends Gq{constructor(){super(new Ic(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Rt(4,2),this._viewportCount=6,this._viewports=[new Ki(2,1,1,1),new Ki(0,1,1,1),new Ki(3,1,1,1),new Ki(1,1,1,1),new Ki(3,0,1,1),new Ki(1,0,1,1)],this._cubeDirections=[new Re(1,0,0),new Re(-1,0,0),new Re(0,0,1),new Re(0,0,-1),new Re(0,1,0),new Re(0,-1,0)],this._cubeUps=[new Re(0,1,0),new Re(0,1,0),new Re(0,1,0),new Re(0,1,0),new Re(0,0,1),new Re(0,0,-1)]}updateMatrices(e,n=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),FR.setFromMatrixPosition(e.matrixWorld),r.position.copy(FR),$z.copy(r.position),$z.add(this._cubeDirections[n]),r.up.copy(this._cubeUps[n]),r.lookAt($z),r.updateMatrixWorld(),i.makeTranslation(-FR.x,-FR.y,-FR.z),sK.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sK)}}class Lae extends Vb{constructor(e,n,r=0,i=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new Uxe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}let cN=class extends eN{constructor(e=-1,n=1,r=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=i+n,c=i-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,a=s+l*this.view.width,o-=u*this.view.offsetY,c=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}};class Bxe extends Gq{constructor(){super(new cN(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Uae extends Vb{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gi.DEFAULT_UP),this.updateMatrix(),this.target=new Gi,this.shadow=new Bxe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Bae extends Vb{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class Fae extends Vb{constructor(e,n,r=10,i=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class zae{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Re)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return n.copy(a[0]).multiplyScalar(.282095),n.addScaledVector(a[1],.488603*i),n.addScaledVector(a[2],.488603*s),n.addScaledVector(a[3],.488603*r),n.addScaledVector(a[4],1.092548*(r*i)),n.addScaledVector(a[5],1.092548*(i*s)),n.addScaledVector(a[6],.315392*(3*s*s-1)),n.addScaledVector(a[7],1.092548*(r*s)),n.addScaledVector(a[8],.546274*(r*r-i*i)),n}getIrradianceAt(e,n){const r=e.x,i=e.y,s=e.z,a=this.coefficients;return n.copy(a[0]).multiplyScalar(.886227),n.addScaledVector(a[1],2*.511664*i),n.addScaledVector(a[2],2*.511664*s),n.addScaledVector(a[3],2*.511664*r),n.addScaledVector(a[4],2*.429043*r*i),n.addScaledVector(a[5],2*.429043*i*s),n.addScaledVector(a[6],.743125*s*s-.247708),n.addScaledVector(a[7],2*.429043*r*s),n.addScaledVector(a[8],.429043*(r*r-i*i)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,n+i*3);return this}toArray(e=[],n=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,n+i*3);return e}static getBasisAt(e,n){const r=e.x,i=e.y,s=e.z;n[0]=.282095,n[1]=.488603*i,n[2]=.488603*s,n[3]=.488603*r,n[4]=1.092548*r*i,n[5]=1.092548*i*s,n[6]=.315392*(3*s*s-1),n[7]=1.092548*r*s,n[8]=.546274*(r*r-i*i)}}class Hae extends Vb{constructor(e=new zae,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class C3 extends id{constructor(e){super(e),this.textures={}}load(e,n,r,i){const s=this,a=new Zv(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{n(s.parse(JSON.parse(o)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},r,i)}parse(e){const n=this.textures;function r(s){return n[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),n[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new _n().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=r(a.value);break;case"c":i.uniforms[s].value=new _n().setHex(a.value);break;case"v2":i.uniforms[s].value=new Rt().fromArray(a.value);break;case"v3":i.uniforms[s].value=new Re().fromArray(a.value);break;case"v4":i.uniforms[s].value=new Ki().fromArray(a.value);break;case"m3":i.uniforms[s].value=new Zr().fromArray(a.value);break;case"m4":i.uniforms[s].value=new Nr().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new Rt().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Rt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return C3.createMaterialFromType(e)}static createMaterialFromType(e){const n={ShadowMaterial:bae,SpriteMaterial:Rq,RawShaderMaterial:Eae,ShaderMaterial:Bc,PointsMaterial:Mq,MeshPhysicalMaterial:Sae,MeshStandardMaterial:Lq,MeshPhongMaterial:Tae,MeshToonMaterial:xae,MeshNormalMaterial:Uq,MeshLambertMaterial:wae,MeshDepthMaterial:Bq,MeshDistanceMaterial:Fq,MeshBasicMaterial:Hb,MeshMatcapMaterial:Cae,LineDashedMaterial:Rae,LineBasicMaterial:nh,Material:yl};return new n[e]}}class Vj{static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class jae extends Qr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Vae extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=new Zv(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{n(s.parse(JSON.parse(o)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},r,i)}parse(e){const n={},r={};function i(f,p){if(n[p]!==void 0)return n[p];const _=f.interleavedBuffers[p],v=s(f,_.buffer),E=I1(_.type,v),T=new l3(E,_.stride);return T.uuid=_.uuid,n[p]=T,T}function s(f,p){if(r[p]!==void 0)return r[p];const _=f.arrayBuffers[p],v=new Uint32Array(_).buffer;return r[p]=v,v}const a=e.isInstancedBufferGeometry?new jae:new Qr,o=e.data.index;if(o!==void 0){const f=I1(o.type,o.array);a.setIndex(new ii(f,1))}const c=e.data.attributes;for(const f in c){const p=c[f];let g;if(p.isInterleavedBufferAttribute){const _=i(e.data,p.data);g=new sT(_,p.itemSize,p.offset,p.normalized)}else{const _=I1(p.type,p.array),v=p.isInstancedBufferAttribute?jw:ii;g=new v(_,p.itemSize,p.normalized)}p.name!==void 0&&(g.name=p.name),p.usage!==void 0&&g.setUsage(p.usage),a.setAttribute(f,g)}const l=e.data.morphAttributes;if(l)for(const f in l){const p=l[f],g=[];for(let _=0,v=p.length;_<v;_++){const E=p[_];let T;if(E.isInterleavedBufferAttribute){const x=i(e.data,E.data);T=new sT(x,E.itemSize,E.offset,E.normalized)}else{const x=I1(E.type,E.array);T=new ii(x,E.itemSize,E.normalized)}E.name!==void 0&&(T.name=E.name),g.push(T)}a.morphAttributes[f]=g}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let f=0,p=h.length;f!==p;++f){const g=h[f];a.addGroup(g.start,g.count,g.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const f=new Re;d.center!==void 0&&f.fromArray(d.center),a.boundingSphere=new Dl(f,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class Fxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=this.path===""?Vj.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Zv(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){let l=null;try{l=JSON.parse(c)}catch(h){i!==void 0&&i(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=l.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(l,n)},r,i)}async loadAsync(e,n){const r=this,i=this.path===""?Vj.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new Zv(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,n),o=JSON.parse(a),c=o.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,n){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){n!==void 0&&n(l)}),o=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,s,c,o,r),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),this.bindLightTargets(l),n!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&n(l)}return l}async parseAsync(e){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,i,o,a,n),l=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,l),this.bindLightTargets(c),c}parseShapes(e){const n={};if(e!==void 0)for(let r=0,i=e.length;r<i;r++){const s=new HS().fromJSON(e[r]);n[s.uuid]=s}return n}parseSkeletons(e,n){const r={},i={};if(n.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new u3().fromJSON(e[s],i);r[o.uuid]=o}return r}parseGeometries(e,n){const r={};if(e!==void 0){const i=new Vae;for(let s=0,a=e.length;s<a;s++){let o;const c=e[s];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(c);break;default:c.type in nK?o=nK[c.type].fromJSON(c,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}o.uuid=c.uuid,c.name!==void 0&&(o.name=c.name),c.userData!==void 0&&(o.userData=c.userData),r[c.uuid]=o}}return r}parseMaterials(e,n){const r={},i={};if(e!==void 0){const s=new C3;s.setTextures(n);for(let a=0,o=e.length;a<o;a++){const c=e[a];r[c.uuid]===void 0&&(r[c.uuid]=s.parse(c)),i[c.uuid]=r[c.uuid]}}return i}parseAnimations(e){const n={};if(e!==void 0)for(let r=0;r<e.length;r++){const i=e[r],s=IM.parse(i);n[s.uuid]=s}return n}parseImages(e,n){const r=this,i={};let s;function a(c){return r.manager.itemStart(c),s.load(c,function(){r.manager.itemEnd(c)},void 0,function(){r.manager.itemError(c),r.manager.itemEnd(c)})}function o(c){if(typeof c=="string"){const l=c,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:r.resourcePath+l;return a(u)}else return c.data?{data:I1(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new Vq(n);s=new kM(c),s.setCrossOrigin(this.crossOrigin);for(let l=0,u=e.length;l<u;l++){const h=e[l],d=h.url;if(Array.isArray(d)){const f=[];for(let p=0,g=d.length;p<g;p++){const _=d[p],v=o(_);v!==null&&(v instanceof HTMLImageElement?f.push(v):f.push(new Qf(v.data,v.width,v.height)))}i[h.uuid]=new q_(f)}else{const f=o(h.url);i[h.uuid]=new q_(f)}}}return i}async parseImagesAsync(e){const n=this,r={};let i;async function s(a){if(typeof a=="string"){const o=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:n.resourcePath+o;return await i.loadAsync(c)}else return a.data?{data:I1(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new kM(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const c=e[a],l=c.url;if(Array.isArray(l)){const u=[];for(let h=0,d=l.length;h<d;h++){const f=l[h],p=await s(f);p!==null&&(p instanceof HTMLImageElement?u.push(p):u.push(new Qf(p.data,p.width,p.height)))}r[c.uuid]=new q_(u)}else{const u=await s(c.url);r[c.uuid]=new q_(u)}}}return r}parseTextures(e,n){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),n[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const c=n[o.image],l=c.data;let u;Array.isArray(l)?(u=new tN,l.length===6&&(u.needsUpdate=!0)):(l&&l.data?u=new Qf:u=new Pa,l&&(u.needsUpdate=!0)),u.source=c,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,zxe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],aK),u.wrapT=r(o.wrap[1],aK)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,oK)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,oK)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),i[o.uuid]=u}return i}parseObject(e,n,r,i,s){let a;function o(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),n[d]}function c(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let p=0,g=d.length;p<g;p++){const _=d[p];r[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_),f.push(r[_])}return f}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function l(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),i[d]}let u,h;switch(e.type){case"Scene":a=new Hw,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new _n(e.background):a.background=l(e.background)),e.environment!==void 0&&(a.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new c3(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new o3(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Ic(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new cN(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Bae(e.color,e.intensity);break;case"DirectionalLight":a=new Uae(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Lae(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Fae(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Pae(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new Dae(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Hae().fromJSON(e);break;case"SkinnedMesh":u=o(e.geometry),h=c(e.material),a=new nae(u,h),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),h=c(e.material),a=new Bo(u,h);break;case"InstancedMesh":u=o(e.geometry),h=c(e.material);const d=e.count,f=e.instanceMatrix,p=e.instanceColor;a=new rae(u,h,d),a.instanceMatrix=new jw(new Float32Array(f.array),16),p!==void 0&&(a.instanceColor=new jw(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":u=o(e.geometry),h=c(e.material),a=new iae(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(g=>{let _=null,v=null;return g.boundingBox!==void 0&&(_=new cu,_.min.fromArray(g.boundingBox.min),_.max.fromArray(g.boundingBox.max)),g.boundingSphere!==void 0&&(v=new Dl,v.radius=g.boundingSphere.radius,v.center.fromArray(g.boundingSphere.center)),{...g,boundingBox:_,boundingSphere:v}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=l(e.matricesTexture.uuid),a._indirectTexture=l(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=l(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Dl,a.boundingSphere.center.fromArray(e.boundingSphere.center),a.boundingSphere.radius=e.boundingSphere.radius),e.boundingBox!==void 0&&(a.boundingBox=new cu,a.boundingBox.min.fromArray(e.boundingBox.min),a.boundingBox.max.fromArray(e.boundingBox.max));break;case"LOD":a=new tae;break;case"Line":a=new bb(o(e.geometry),c(e.material));break;case"LineLoop":a=new sae(o(e.geometry),c(e.material));break;case"LineSegments":a=new Kg(o(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new aae(o(e.geometry),c(e.material));break;case"Sprite":a=new eae(c(e.material));break;case"Group":a=new k1;break;case"Bone":a=new Aq;break;default:a=new Gi}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let f=0;f<d.length;f++)a.add(this.parseObject(d[f],n,r,i,s))}if(e.animations!==void 0){const d=e.animations;for(let f=0;f<d.length;f++){const p=d[f];a.animations.push(s[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const d=e.levels;for(let f=0;f<d.length;f++){const p=d[f],g=a.getObjectByProperty("uuid",p.object);g!==void 0&&a.addLevel(g,p.distance,p.hysteresis)}}return a}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const i=n[r.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(i,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(n){if(n.isDirectionalLight||n.isSpotLight){const r=n.target,i=e.getObjectByProperty("uuid",r);i!==void 0?n.target=i:n.target=new Gi}})}}const zxe={UVMapping:ZU,CubeReflectionMapping:Jv,CubeRefractionMapping:_b,EquirectangularReflectionMapping:vM,EquirectangularRefractionMapping:yM,CubeUVReflectionMapping:DC},aK={RepeatWrapping:_M,ClampToEdgeWrapping:qf,MirroredRepeatWrapping:bM},oK={NearestFilter:Ja,NearestMipmapNearestFilter:pq,NearestMipmapLinearFilter:N1,LinearFilter:_a,LinearMipmapNearestFilter:MA,LinearMipmapLinearFilter:_g};class Hxe extends id{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Iv.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(l=>{n&&n(l),s.manager.itemEnd(e)}).catch(l=>{i&&i(l)});return}return setTimeout(function(){n&&n(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const c=fetch(e,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){return Iv.add(e,l),n&&n(l),s.manager.itemEnd(e),l}).catch(function(l){i&&i(l),Iv.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Iv.add(e,c),s.manager.itemStart(e)}}let bk,qq=class{static getContext(){return bk===void 0&&(bk=new(window.AudioContext||window.webkitAudioContext)),bk}static setContext(e){bk=e}};class jxe extends id{constructor(e){super(e)}load(e,n,r,i){const s=this,a=new Zv(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const l=c.slice(0);qq.getContext().decodeAudioData(l,function(h){n(h)}).catch(o)}catch(l){o(l)}},r,i);function o(c){i?i(c):console.error(c),s.manager.itemError(e)}}}const cK=new Nr,lK=new Nr,JE=new Nr;class Vxe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ic,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ic,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,JE.copy(e.projectionMatrix);const i=n.eyeSep/2,s=i*n.near/n.focus,a=n.near*Math.tan(zS*n.fov*.5)/n.zoom;let o,c;lK.elements[12]=-i,cK.elements[12]=i,o=-a*n.aspect+s,c=a*n.aspect+s,JE.elements[0]=2*n.near/(c-o),JE.elements[8]=(c+o)/(c-o),this.cameraL.projectionMatrix.copy(JE),o=-a*n.aspect-s,c=a*n.aspect-s,JE.elements[0]=2*n.near/(c-o),JE.elements[8]=(c+o)/(c-o),this.cameraR.projectionMatrix.copy(JE)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(lK),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(cK)}}class Gae extends Ic{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let $q=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=uK(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=uK();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}};function uK(){return performance.now()}const ZE=new Re,hK=new qh,Gxe=new Re,QE=new Re;class qxe extends Gi{constructor(){super(),this.type="AudioListener",this.context=qq.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $q}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ZE,hK,Gxe),QE.set(0,0,-1).applyQuaternion(hK),n.positionX){const i=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(ZE.x,i),n.positionY.linearRampToValueAtTime(ZE.y,i),n.positionZ.linearRampToValueAtTime(ZE.z,i),n.forwardX.linearRampToValueAtTime(QE.x,i),n.forwardY.linearRampToValueAtTime(QE.y,i),n.forwardZ.linearRampToValueAtTime(QE.z,i),n.upX.linearRampToValueAtTime(r.x,i),n.upY.linearRampToValueAtTime(r.y,i),n.upZ.linearRampToValueAtTime(r.z,i)}else n.setPosition(ZE.x,ZE.y,ZE.z),n.setOrientation(QE.x,QE.y,QE.z,r.x,r.y,r.z)}}class qae extends Gi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,n){return super.copy(e,n),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const eS=new Re,dK=new qh,$xe=new Re,tS=new Re;class Wxe extends qae{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(eS,dK,$xe),tS.set(0,0,1).applyQuaternion(dK);const n=this.panner;if(n.positionX){const r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(eS.x,r),n.positionY.linearRampToValueAtTime(eS.y,r),n.positionZ.linearRampToValueAtTime(eS.z,r),n.orientationX.linearRampToValueAtTime(tS.x,r),n.orientationY.linearRampToValueAtTime(tS.y,r),n.orientationZ.linearRampToValueAtTime(tS.z,r)}else n.setPosition(eS.x,eS.y,eS.z),n.setOrientation(tS.x,tS.y,tS.z)}}class Yxe{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let r=0;r<n.length;r++)e+=n[r];return e/n.length}}class $ae{constructor(e,n,r){this.binding=e,this.valueSize=r;let i,s,a;switch(n){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const r=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)r[s+o]=r[o];a=n}else{a+=n;const o=n/a;this._mixBufferRegion(r,s,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const n=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,r=this.buffer,i=e*n+n,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=n*this._origIndex;this._mixBufferRegion(r,i,c,1-s,n)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*n,1,n);for(let c=n,l=n+n;c!==l;++c)if(r[c]!==r[c+n]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,n=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(n,i);for(let s=r,a=i;s!==a;++s)n[s]=n[i+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let r=e;r<n;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[n+r]=this.buffer[e+r]}_select(e,n,r,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[n+a]=e[r+a]}_slerp(e,n,r,i){qh.slerpFlat(e,n,e,n,e,r,i)}_slerpAdditive(e,n,r,i,s){const a=this._workIndex*s;qh.multiplyQuaternionsFlat(e,a,e,n,e,r),qh.slerpFlat(e,n,e,n,e,a,i)}_lerp(e,n,r,i,s){const a=1-i;for(let o=0;o!==s;++o){const c=n+o;e[c]=e[c]*a+e[r+o]*i}}_lerpAdditive(e,n,r,i,s){for(let a=0;a!==s;++a){const o=n+a;e[o]=e[o]+e[r+a]*i}}}const Wq="\\[\\]\\.:\\/",Xxe=new RegExp("["+Wq+"]","g"),Yq="[^"+Wq+"]",Kxe="[^"+Wq.replace("\\.","")+"]",Jxe=/((?:WC+[\/:])*)/.source.replace("WC",Yq),Zxe=/(WCOD+)?/.source.replace("WCOD",Kxe),Qxe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yq),e1e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yq),t1e=new RegExp("^"+Jxe+Zxe+Qxe+e1e+"$"),n1e=["material","materials","bones","map"];class r1e{constructor(e,n,r){const i=r||Yi.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,i)}getValue(e,n){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,n)}setValue(e,n){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].unbind()}}class Yi{constructor(e,n,r){this.path=n,this.parsedPath=r||Yi.parseTrackName(n),this.node=Yi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new Yi.Composite(e,n,r):new Yi(e,n,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Xxe,"")}static parseTrackName(e){const n=t1e.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=r.nodeName.substring(i+1);n1e.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(n);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===n||o.uuid===n)return o;const c=r(o.children);if(c)return c}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)e[n++]=r[i]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,r=n.objectName,i=n.propertyName;let s=n.propertyIndex;if(e||(e=Yi.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let l=n.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const a=e[i];if(a===void 0){const l=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Yi.Composite=r1e;Yi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Yi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Yi.prototype.GetterByBindingType=[Yi.prototype._getValue_direct,Yi.prototype._getValue_array,Yi.prototype._getValue_arrayElement,Yi.prototype._getValue_toArray];Yi.prototype.SetterByBindingTypeAndVersioning=[[Yi.prototype._setValue_direct,Yi.prototype._setValue_direct_setNeedsUpdate,Yi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Yi.prototype._setValue_array,Yi.prototype._setValue_array_setNeedsUpdate,Yi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Yi.prototype._setValue_arrayElement,Yi.prototype._setValue_arrayElement_setNeedsUpdate,Yi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Yi.prototype._setValue_fromArray,Yi.prototype._setValue_fromArray_setNeedsUpdate,Yi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class i1e{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Gd(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,r=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let o,c=e.length,l=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let p=n[f];if(p===void 0){p=c++,n[f]=p,e.push(d);for(let g=0,_=a;g!==_;++g)s[g].push(new Yi(d,r[g],i[g]))}else if(p<l){o=e[p];const g=--l,_=e[g];n[_.uuid]=p,e[p]=_,n[f]=g,e[g]=d;for(let v=0,E=a;v!==E;++v){const T=s[v],x=T[g];let N=T[p];T[p]=x,N===void 0&&(N=new Yi(d,r[v],i[v])),T[g]=N}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const c=arguments[a],l=c.uuid,u=n[l];if(u!==void 0&&u>=s){const h=s++,d=e[h];n[d.uuid]=u,e[u]=d,n[l]=h,e[h]=c;for(let f=0,p=i;f!==p;++f){const g=r[f],_=g[h],v=g[u];g[u]=_,g[h]=v}}}this.nCachedObjects_=s}uncache(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,c=arguments.length;o!==c;++o){const l=arguments[o],u=l.uuid,h=n[u];if(h!==void 0)if(delete n[u],h<s){const d=--s,f=e[d],p=--a,g=e[p];n[f.uuid]=h,e[h]=f,n[g.uuid]=d,e[d]=g,e.pop();for(let _=0,v=i;_!==v;++_){const E=r[_],T=E[d],x=E[p];E[h]=T,E[d]=x,E.pop()}}else{const d=--a,f=e[d];d>0&&(n[f.uuid]=h),e[h]=f,e.pop();for(let p=0,g=i;p!==g;++p){const _=r[p];_[h]=_[d],_.pop()}}}this.nCachedObjects_=s}subscribe_(e,n){const r=this._bindingsIndicesByPath;let i=r[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,o=this._parsedPaths,c=this._objects,l=c.length,u=this.nCachedObjects_,h=new Array(l);i=s.length,r[e]=i,a.push(e),o.push(n),s.push(h);for(let d=u,f=c.length;d!==f;++d){const p=c[d];h[d]=new Yi(p,e,n)}return h}unsubscribe_(e){const n=this._bindingsIndicesByPath,r=n[e];if(r!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,c=a[o],l=e[o];n[l]=r,a[r]=c,a.pop(),s[r]=s[o],s.pop(),i[r]=i[o],i.pop()}}}class Wae{constructor(e,n,r=null,i=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=r,this.blendMode=i;const s=n.tracks,a=s.length,o=new Array(a),c={endingStart:IS,endingEnd:IS};for(let l=0;l!==a;++l){const u=s[l].createInterpolant(null);o[l]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=kse,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,r=!1){if(e.fadeOut(n),this.fadeIn(n),r===!0){const i=this._clip.duration,s=e._clip.duration,a=s/i,o=i/s;e.warp(1,a,n),this.warp(o,1,n)}return this}crossFadeTo(e,n,r=!1){return e.crossFadeFrom(this,n,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,r){const i=this._mixer,s=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const c=o.parameterPositions,l=o.sampleValues;return c[0]=s,c[1]=s+r,l[0]=e/a,l[1]=n/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,r,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*r;c<0||r===0?n=0:(this._startTime=null,n=r*c)}n*=this._updateTimeScale(e);const a=this._updateTime(n),o=this._updateWeight(e);if(o>0){const c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Sq:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(a),l[u].accumulateAdditive(o);break;case i3:default:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(a),l[u].accumulate(i,o)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];n*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const i=r.evaluate(e)[0];n*=i,e>r.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,r=this.loop;let i=this.time+e,s=this._loopCount;const a=r===Dse;if(e===0)return s===-1?i:a&&(s&1)===1?n-i:i;if(r===Ise){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=n)i=n;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=n||i<0){const o=Math.floor(i/n);i-=n*o,s+=Math.abs(o);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?n:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(s&1)===1)return n-i}return i}_setEndings(e,n,r){const i=this._interpolantSettings;r?(i.endingStart=kS,i.endingEnd=kS):(e?i.endingStart=this.zeroSlopeAtStart?kS:IS:i.endingStart=SM,n?i.endingEnd=this.zeroSlopeAtEnd?kS:IS:i.endingEnd=SM)}_scheduleFading(e,n,r){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,c=a.sampleValues;return o[0]=s,c[0]=n,o[1]=s+e,c[1]=r,this}}const s1e=new Float32Array(1);class a1e extends Zd{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const r=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,o=e._interpolants,c=r.uuid,l=this._bindingsByRootAndName;let u=l[c];u===void 0&&(u={},l[c]=u);for(let h=0;h!==s;++h){const d=i[h],f=d.name;let p=u[f];if(p!==void 0)++p.referenceCount,a[h]=p;else{if(p=a[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,c,f));continue}const g=n&&n._propertyBindings[h].binding.parsedPath;p=new $ae(Yi.create(r,f,g),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,c,f),a[h]=p}o[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,r)}const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const s=n[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const s=n[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,r){const i=this._actions,s=this._actionsByClip;let a=s[n];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[n]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const n=this._actions,r=n[n.length-1],i=e._cacheIndex;r._cacheIndex=i,n[i]=r,n.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],c=o.knownActions,l=c[c.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,c[u]=l,c.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],c.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const s=n[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const n=this._actions,r=e._cacheIndex,i=this._nActiveActions++,s=n[i];e._cacheIndex=i,n[i]=e,s._cacheIndex=r,n[r]=s}_takeBackAction(e){const n=this._actions,r=e._cacheIndex,i=--this._nActiveActions,s=n[i];e._cacheIndex=i,n[i]=e,s._cacheIndex=r,n[r]=s}_addInactiveBinding(e,n,r){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[n];a===void 0&&(a={},i[n]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const n=this._bindings,r=e.binding,i=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[i],c=n[n.length-1],l=e._cacheIndex;c._cacheIndex=l,n[l]=c,n.pop(),delete o[s],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const n=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,s=n[i];e._cacheIndex=i,n[i]=e,s._cacheIndex=r,n[r]=s}_takeBackBinding(e){const n=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,s=n[i];e._cacheIndex=i,n[i]=e,s._cacheIndex=r,n[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let r=e[n];return r===void 0&&(r=new Hq(new Float32Array(2),new Float32Array(2),1,s1e),r.__cacheIndex=n,e[n]=r),r}_takeBackControlInterpolant(e){const n=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=n[i];e.__cacheIndex=i,n[i]=e,s.__cacheIndex=r,n[r]=s}clipAction(e,n,r){const i=n||this._root,s=i.uuid;let a=typeof e=="string"?IM.findByName(i,e):e;const o=a!==null?a.uuid:e,c=this._actionsByClip[o];let l=null;if(r===void 0&&(a!==null?r=a.blendMode:r=i3),c!==void 0){const h=c.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;l=c.knownActions[0],a===null&&(a=l._clip)}if(a===null)return null;const u=new Wae(this,a,n,r);return this._bindAction(u,l),this._addInactiveAction(u,o,s),u}existingAction(e,n){const r=n||this._root,i=r.uuid,s=typeof e=="string"?IM.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let r=n-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const n=this._actions,r=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let l=0;l!==r;++l)n[l]._update(i,e,s,a);const o=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)o[l].apply(a);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,r=e.uuid,i=this._actionsByClip,s=i[r];if(s!==void 0){const a=s.knownActions;for(let o=0,c=a.length;o!==c;++o){const l=a[o];this._deactivateAction(l);const u=l._cacheIndex,h=n[n.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,n[u]=h,n.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}}uncacheRoot(e){const n=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,c=o[n];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const i=this._bindingsByRootAndName,s=i[n];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,n){const r=this.existingAction(e,n);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class o1e extends s3{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isRenderTarget3D=!0,this.depth=r,this.texture=new a3(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class c1e extends s3{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isRenderTargetArray=!0,this.depth=r,this.texture=new QO(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class Yr{constructor(e){this.value=e}clone(){return new Yr(this.value.clone===void 0?this.value:this.value.clone())}}let l1e=0;class u1e extends Zd{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:l1e++}),this.name="",this.usage=xM,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let r=0,i=n.length;r<i;r++){const s=Array.isArray(n[r])?n[r]:[n[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class h1e extends l3{constructor(e,n,r=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class d1e{constructor(e,n,r,i,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=r,this.elementSize=i,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const fK=new Nr;class Xq{constructor(e,n,r=0,i=1/0){this.ray=new PC(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new Fw,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return fK.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(fK),this}intersectObject(e,n=!0,r=[]){return Gj(e,this,r,n),r.sort(pK),r}intersectObjects(e,n=!0,r=[]){for(let i=0,s=e.length;i<s;i++)Gj(e[i],this,r,n);return r.sort(pK),r}}function pK(t,e){return t.distance-e.distance}function Gj(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const s=t.children;for(let a=0,o=s.length;a<o;a++)Gj(s[a],e,n,!0)}}class f1e{constructor(e=1,n=0,r=0){this.radius=e,this.phi=n,this.theta=r}set(e,n,r){return this.radius=e,this.phi=n,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Xr(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+n*n+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Xr(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class p1e{constructor(e=1,n=0,r=0){this.radius=e,this.theta=n,this.y=r}set(e,n,r){return this.radius=e,this.theta=n,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=n,this}clone(){return new this.constructor().copy(this)}}class Kq{constructor(e,n,r,i){Kq.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,n,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,n=0){for(let r=0;r<4;r++)this.elements[r]=e[r+n];return this}set(e,n,r,i){const s=this.elements;return s[0]=e,s[2]=n,s[1]=r,s[3]=i,this}}const mK=new Rt;class Yae{constructor(e=new Rt(1/0,1/0),n=new Rt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=mK.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,mK).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const gK=new Re,Ek=new Re;class m1e{constructor(e=new Re,n=new Re){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){gK.subVectors(e,this.start),Ek.subVectors(this.end,this.start);const r=Ek.dot(Ek);let s=Ek.dot(gK)/r;return n&&(s=Xr(s,0,1)),s}closestPointToPoint(e,n,r){const i=this.closestPointToPointParameter(e,n);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const vK=new Re;class g1e extends Gi{constructor(e,n){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const r=new Qr,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,c=32;a<c;a++,o++){const l=a/c*Math.PI*2,u=o/c*Math.PI*2;i.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new Hn(i,3));const s=new nh({fog:!1,toneMapped:!1});this.cone=new Kg(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),vK.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vK),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const c_=new Re,Sk=new Nr,Wz=new Nr;class v1e extends Kg{constructor(e){const n=Xae(e),r=new Qr,i=[],s=[],a=new _n(0,0,1),o=new _n(0,1,0);for(let l=0;l<n.length;l++){const u=n[l];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Hn(i,3)),r.setAttribute("color",new Hn(s,3));const c=new nh({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,r=this.geometry,i=r.getAttribute("position");Wz.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<n.length;s++){const o=n[s];o.parent&&o.parent.isBone&&(Sk.multiplyMatrices(Wz,o.matrixWorld),c_.setFromMatrixPosition(Sk),i.setXYZ(a,c_.x,c_.y,c_.z),Sk.multiplyMatrices(Wz,o.parent.matrixWorld),c_.setFromMatrixPosition(Sk),i.setXYZ(a+1,c_.x,c_.y,c_.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Xae(t){const e=[];t.isBone===!0&&e.push(t);for(let n=0;n<t.children.length;n++)e.push(...Xae(t.children[n]));return e}class y1e extends Bo{constructor(e,n,r){const i=new sN(n,4,2),s=new Hb({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _1e=new Re,yK=new _n,_K=new _n;class b1e extends Gi{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new iN(n);i.rotateY(Math.PI*.5),this.material=new Hb({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new ii(a,3)),this.add(new Bo(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");yK.copy(this.light.color),_K.copy(this.light.groundColor);for(let r=0,i=n.count;r<i;r++){const s=r<i/2?yK:_K;n.setXYZ(r,s.r,s.g,s.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(_1e.setFromMatrixPosition(this.light.matrixWorld).negate())}}class E1e extends Kg{constructor(e=10,n=10,r=4473924,i=8947848){r=new _n(r),i=new _n(i);const s=n/2,a=e/n,o=e/2,c=[],l=[];for(let d=0,f=0,p=-o;d<=n;d++,p+=a){c.push(-o,0,p,o,0,p),c.push(p,0,-o,p,0,o);const g=d===s?r:i;g.toArray(l,f),f+=3,g.toArray(l,f),f+=3,g.toArray(l,f),f+=3,g.toArray(l,f),f+=3}const u=new Qr;u.setAttribute("position",new Hn(c,3)),u.setAttribute("color",new Hn(l,3));const h=new nh({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class S1e extends Kg{constructor(e=10,n=16,r=8,i=64,s=4473924,a=8947848){s=new _n(s),a=new _n(a);const o=[],c=[];if(n>1)for(let h=0;h<n;h++){const d=h/n*(Math.PI*2),f=Math.sin(d)*e,p=Math.cos(d)*e;o.push(0,0,0),o.push(f,0,p);const g=h&1?s:a;c.push(g.r,g.g,g.b),c.push(g.r,g.g,g.b)}for(let h=0;h<r;h++){const d=h&1?s:a,f=e-e/r*h;for(let p=0;p<i;p++){let g=p/i*(Math.PI*2),_=Math.sin(g)*f,v=Math.cos(g)*f;o.push(_,0,v),c.push(d.r,d.g,d.b),g=(p+1)/i*(Math.PI*2),_=Math.sin(g)*f,v=Math.cos(g)*f,o.push(_,0,v),c.push(d.r,d.g,d.b)}}const l=new Qr;l.setAttribute("position",new Hn(o,3)),l.setAttribute("color",new Hn(c,3));const u=new nh({vertexColors:!0,toneMapped:!1});super(l,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const bK=new Re,Tk=new Re,EK=new Re;class T1e extends Gi{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",n===void 0&&(n=1);let i=new Qr;i.setAttribute("position",new Hn([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const s=new nh({fog:!1,toneMapped:!1});this.lightPlane=new bb(i,s),this.add(this.lightPlane),i=new Qr,i.setAttribute("position",new Hn([0,0,0,0,0,1],3)),this.targetLine=new bb(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),bK.setFromMatrixPosition(this.light.matrixWorld),Tk.setFromMatrixPosition(this.light.target.matrixWorld),EK.subVectors(Tk,bK),this.lightPlane.lookAt(Tk),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tk),this.targetLine.scale.z=EK.length()}}const xk=new Re,lo=new eN;class x1e extends Kg{constructor(e){const n=new Qr,r=new nh({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(p,g){c(p),c(g)}function c(p){i.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(i.length/3-1)}n.setAttribute("position",new Hn(i,3)),n.setAttribute("color",new Hn(s,3)),super(n,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new _n(16755200),u=new _n(16711680),h=new _n(43775),d=new _n(16777215),f=new _n(3355443);this.setColors(l,u,h,d,f)}setColors(e,n,r,i,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,n.r,n.g,n.b),o.setXYZ(25,n.r,n.g,n.b),o.setXYZ(26,n.r,n.g,n.b),o.setXYZ(27,n.r,n.g,n.b),o.setXYZ(28,n.r,n.g,n.b),o.setXYZ(29,n.r,n.g,n.b),o.setXYZ(30,n.r,n.g,n.b),o.setXYZ(31,n.r,n.g,n.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap,r=1,i=1;lo.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===$f?-1:0;No("c",n,e,lo,0,0,s),No("t",n,e,lo,0,0,1),No("n1",n,e,lo,-1,-1,s),No("n2",n,e,lo,r,-1,s),No("n3",n,e,lo,-1,i,s),No("n4",n,e,lo,r,i,s),No("f1",n,e,lo,-1,-1,1),No("f2",n,e,lo,r,-1,1),No("f3",n,e,lo,-1,i,1),No("f4",n,e,lo,r,i,1),No("u1",n,e,lo,r*.7,i*1.1,s),No("u2",n,e,lo,-1*.7,i*1.1,s),No("u3",n,e,lo,0,i*2,s),No("cf1",n,e,lo,-1,0,1),No("cf2",n,e,lo,r,0,1),No("cf3",n,e,lo,0,-1,1),No("cf4",n,e,lo,0,i,1),No("cn1",n,e,lo,-1,0,s),No("cn2",n,e,lo,r,0,s),No("cn3",n,e,lo,0,-1,s),No("cn4",n,e,lo,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function No(t,e,n,r,i,s,a){xk.set(i,s,a).unproject(r);const o=e[t];if(o!==void 0){const c=n.getAttribute("position");for(let l=0,u=o.length;l<u;l++)c.setXYZ(o[l],xk.x,xk.y,xk.z)}}const wk=new cu;class w1e extends Kg{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),s=new Qr;s.setIndex(new ii(r,1)),s.setAttribute("position",new ii(i,3)),super(s,new nh({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&wk.setFromObject(this.object),wk.isEmpty())return;const e=wk.min,n=wk.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class C1e extends Kg{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Qr;s.setIndex(new ii(r,1)),s.setAttribute("position",new Hn(i,3)),super(s,new nh({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class R1e extends bb{constructor(e,n=1,r=16776960){const i=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Qr;a.setAttribute("position",new Hn(s,3)),a.computeBoundingSphere(),super(a,new nh({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new Qr;c.setAttribute("position",new Hn(o,3)),c.computeBoundingSphere(),this.add(new Bo(c,new Hb({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const SK=new Re;let Ck,Yz;class A1e extends Gi{constructor(e=new Re(0,0,1),n=new Re(0,0,0),r=1,i=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",Ck===void 0&&(Ck=new Qr,Ck.setAttribute("position",new Hn([0,0,0,0,1,0],3)),Yz=new rN(.5,1,5,1),Yz.translate(0,-.5,0)),this.position.copy(n),this.line=new bb(Ck,new nh({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Bo(Yz,new Hb({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{SK.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(SK,n)}}setLength(e,n=e*.2,r=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(r,n,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class M1e extends Kg{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Qr;i.setAttribute("position",new Hn(n,3)),i.setAttribute("color",new Hn(r,3));const s=new nh({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,n,r){const i=new _n,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(n),i.toArray(s,6),i.toArray(s,9),i.set(r),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class O1e{constructor(){this.type="ShapePath",this.color=new _n,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new DL,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,r,i){return this.currentPath.quadraticCurveTo(e,n,r,i),this}bezierCurveTo(e,n,r,i,s,a){return this.currentPath.bezierCurveTo(e,n,r,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(v){const E=[];for(let T=0,x=v.length;T<x;T++){const N=v[T],A=new HS;A.curves=N.curves,E.push(A)}return E}function r(v,E){const T=E.length;let x=!1;for(let N=T-1,A=0;A<T;N=A++){let I=E[N],k=E[A],L=k.x-I.x,U=k.y-I.y;if(Math.abs(U)>Number.EPSILON){if(U<0&&(I=E[A],L=-L,k=E[N],U=-U),v.y<I.y||v.y>k.y)continue;if(v.y===I.y){if(v.x===I.x)return!0}else{const $=U*(v.x-I.x)-L*(v.y-I.y);if($===0)return!0;if($<0)continue;x=!x}}else{if(v.y!==I.y)continue;if(k.x<=v.x&&v.x<=I.x||I.x<=v.x&&v.x<=k.x)return!0}}return x}const i=Zp.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,c;const l=[];if(s.length===1)return o=s[0],c=new HS,c.curves=o.curves,l.push(c),l;let u=!i(s[0].getPoints());u=e?!u:u;const h=[],d=[];let f=[],p=0,g;d[p]=void 0,f[p]=[];for(let v=0,E=s.length;v<E;v++)o=s[v],g=o.getPoints(),a=i(g),a=e?!a:a,a?(!u&&d[p]&&p++,d[p]={s:new HS,p:g},d[p].s.curves=o.curves,u&&p++,f[p]=[]):f[p].push({h:o,p:g[0]});if(!d[0])return n(s);if(d.length>1){let v=!1,E=0;for(let T=0,x=d.length;T<x;T++)h[T]=[];for(let T=0,x=d.length;T<x;T++){const N=f[T];for(let A=0;A<N.length;A++){const I=N[A];let k=!0;for(let L=0;L<d.length;L++)r(I.p,d[L].p)&&(T!==L&&E++,k?(k=!1,h[L].push(I)):v=!0);k&&h[T].push(I)}}E>0&&v===!1&&(f=h)}let _;for(let v=0,E=d.length;v<E;v++){c=d[v].s,l.push(c),_=f[v];for(let T=0,x=_.length;T<x;T++)c.holes.push(_[T].h)}return l}}let N1e=class extends Zd{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}};function I1e(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function k1e(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function D1e(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function qj(t,e,n,r){const i=P1e(r);switch(n){case yq:return t*e;case n3:return t*e/i.components*i.byteLength;case JO:return t*e/i.components*i.byteLength;case bq:return t*e*2/i.components*i.byteLength;case r3:return t*e*2/i.components*i.byteLength;case _q:return t*e*3/i.components*i.byteLength;case iu:return t*e*4/i.components*i.byteLength;case ZO:return t*e*4/i.components*i.byteLength;case OA:case NA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case IA:case kA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case sL:case oL:return Math.max(t,16)*Math.max(e,8)/4;case iL:case aL:return Math.max(t,8)*Math.max(e,8)/2;case cL:case lL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case uL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case hL:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case dL:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case fL:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case pL:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case mL:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case gL:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case vL:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case yL:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case _L:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case bL:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case EL:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case SL:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case TL:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case xL:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case DA:case wL:case CL:return Math.ceil(t/4)*Math.ceil(e/4)*16;case Eq:case RL:return Math.ceil(t/4)*Math.ceil(e/4)*8;case AL:case ML:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function P1e(t){switch(t){case gl:case mq:return{byteLength:1,components:1};case Lw:case gq:case Bb:return{byteLength:2,components:1};case e3:case t3:return{byteLength:2,components:4};case Ug:case QU:case ru:return{byteLength:4,components:1};case vq:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class L1e{static contain(e,n){return I1e(e,n)}static cover(e,n){return k1e(e,n)}static fill(e){return D1e(e)}static getByteLength(e,n,r,i){return qj(e,n,r,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:XO}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=XO);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Kae(){let t=null,e=!1,n=null,r=null;function i(s,a){n(s,a),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function U1e(t){const e=new WeakMap;function n(o,c){const l=o.array,u=o.usage,h=l.byteLength,d=t.createBuffer();t.bindBuffer(c,d),t.bufferData(c,l,u),o.onUploadCallback();let f;if(l instanceof Float32Array)f=t.FLOAT;else if(l instanceof Uint16Array)o.isFloat16BufferAttribute?f=t.HALF_FLOAT:f=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)f=t.SHORT;else if(l instanceof Uint32Array)f=t.UNSIGNED_INT;else if(l instanceof Int32Array)f=t.INT;else if(l instanceof Int8Array)f=t.BYTE;else if(l instanceof Uint8Array)f=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)f=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:f,bytesPerElement:l.BYTES_PER_ELEMENT,version:o.version,size:h}}function r(o,c,l){const u=c.array,h=c.updateRanges;if(t.bindBuffer(l,o),h.length===0)t.bufferSubData(l,0,u);else{h.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<h.length;f++){const p=h[d],g=h[f];g.start<=p.start+p.count+1?p.count=Math.max(p.count,g.start+g.count-p.start):(++d,h[d]=g)}h.length=d+1;for(let f=0,p=h.length;f<p;f++){const g=h[f];t.bufferSubData(l,g.start*u.BYTES_PER_ELEMENT,u,g.start,g.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const c=e.get(o);c&&(t.deleteBuffer(c.buffer),e.delete(o))}function a(o,c){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const l=e.get(o);if(l===void 0)e.set(o,n(o,c));else if(l.version<o.version){if(l.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,o,c),l.version=o.version}}return{get:i,remove:s,update:a}}var B1e=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,F1e=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,z1e=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,H1e=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,j1e=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,V1e=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,G1e=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,q1e=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$1e=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,W1e=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Y1e=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,X1e=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,K1e=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,J1e=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Z1e=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Q1e=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,ewe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,twe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,nwe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,rwe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,iwe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,swe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,awe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,owe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cwe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,lwe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,uwe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,hwe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,dwe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,fwe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,pwe="gl_FragColor = linearToOutputTexel( gl_FragColor );",mwe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,gwe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,vwe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,ywe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,_we=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,bwe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Ewe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Swe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Twe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,xwe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,wwe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Cwe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Rwe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Awe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Mwe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Owe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Nwe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Iwe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,kwe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Dwe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Pwe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Lwe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Uwe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Bwe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Fwe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,zwe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Hwe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,jwe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Vwe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Gwe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,qwe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$we=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Wwe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ywe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Xwe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Kwe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Jwe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Zwe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Qwe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,eCe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,tCe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,nCe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,rCe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,iCe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,sCe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,aCe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,oCe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,cCe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,lCe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,uCe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,hCe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,dCe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,fCe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,pCe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,mCe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,gCe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,vCe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,yCe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,_Ce=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,bCe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,ECe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,SCe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,TCe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,xCe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,wCe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,CCe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,RCe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ACe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,MCe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,OCe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NCe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,ICe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,kCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,DCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,PCe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,LCe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const UCe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,BCe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,FCe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,zCe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,HCe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,jCe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,VCe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,GCe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,qCe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,$Ce=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,WCe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,YCe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XCe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,KCe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,JCe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ZCe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QCe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,eRe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tRe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,nRe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rRe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,iRe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,sRe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,aRe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oRe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,cRe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lRe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uRe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hRe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,dRe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fRe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pRe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,mRe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gRe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ri={alphahash_fragment:B1e,alphahash_pars_fragment:F1e,alphamap_fragment:z1e,alphamap_pars_fragment:H1e,alphatest_fragment:j1e,alphatest_pars_fragment:V1e,aomap_fragment:G1e,aomap_pars_fragment:q1e,batching_pars_vertex:$1e,batching_vertex:W1e,begin_vertex:Y1e,beginnormal_vertex:X1e,bsdfs:K1e,iridescence_fragment:J1e,bumpmap_pars_fragment:Z1e,clipping_planes_fragment:Q1e,clipping_planes_pars_fragment:ewe,clipping_planes_pars_vertex:twe,clipping_planes_vertex:nwe,color_fragment:rwe,color_pars_fragment:iwe,color_pars_vertex:swe,color_vertex:awe,common:owe,cube_uv_reflection_fragment:cwe,defaultnormal_vertex:lwe,displacementmap_pars_vertex:uwe,displacementmap_vertex:hwe,emissivemap_fragment:dwe,emissivemap_pars_fragment:fwe,colorspace_fragment:pwe,colorspace_pars_fragment:mwe,envmap_fragment:gwe,envmap_common_pars_fragment:vwe,envmap_pars_fragment:ywe,envmap_pars_vertex:_we,envmap_physical_pars_fragment:Owe,envmap_vertex:bwe,fog_vertex:Ewe,fog_pars_vertex:Swe,fog_fragment:Twe,fog_pars_fragment:xwe,gradientmap_pars_fragment:wwe,lightmap_pars_fragment:Cwe,lights_lambert_fragment:Rwe,lights_lambert_pars_fragment:Awe,lights_pars_begin:Mwe,lights_toon_fragment:Nwe,lights_toon_pars_fragment:Iwe,lights_phong_fragment:kwe,lights_phong_pars_fragment:Dwe,lights_physical_fragment:Pwe,lights_physical_pars_fragment:Lwe,lights_fragment_begin:Uwe,lights_fragment_maps:Bwe,lights_fragment_end:Fwe,logdepthbuf_fragment:zwe,logdepthbuf_pars_fragment:Hwe,logdepthbuf_pars_vertex:jwe,logdepthbuf_vertex:Vwe,map_fragment:Gwe,map_pars_fragment:qwe,map_particle_fragment:$we,map_particle_pars_fragment:Wwe,metalnessmap_fragment:Ywe,metalnessmap_pars_fragment:Xwe,morphinstance_vertex:Kwe,morphcolor_vertex:Jwe,morphnormal_vertex:Zwe,morphtarget_pars_vertex:Qwe,morphtarget_vertex:eCe,normal_fragment_begin:tCe,normal_fragment_maps:nCe,normal_pars_fragment:rCe,normal_pars_vertex:iCe,normal_vertex:sCe,normalmap_pars_fragment:aCe,clearcoat_normal_fragment_begin:oCe,clearcoat_normal_fragment_maps:cCe,clearcoat_pars_fragment:lCe,iridescence_pars_fragment:uCe,opaque_fragment:hCe,packing:dCe,premultiplied_alpha_fragment:fCe,project_vertex:pCe,dithering_fragment:mCe,dithering_pars_fragment:gCe,roughnessmap_fragment:vCe,roughnessmap_pars_fragment:yCe,shadowmap_pars_fragment:_Ce,shadowmap_pars_vertex:bCe,shadowmap_vertex:ECe,shadowmask_pars_fragment:SCe,skinbase_vertex:TCe,skinning_pars_vertex:xCe,skinning_vertex:wCe,skinnormal_vertex:CCe,specularmap_fragment:RCe,specularmap_pars_fragment:ACe,tonemapping_fragment:MCe,tonemapping_pars_fragment:OCe,transmission_fragment:NCe,transmission_pars_fragment:ICe,uv_pars_fragment:kCe,uv_pars_vertex:DCe,uv_vertex:PCe,worldpos_vertex:LCe,background_vert:UCe,background_frag:BCe,backgroundCube_vert:FCe,backgroundCube_frag:zCe,cube_vert:HCe,cube_frag:jCe,depth_vert:VCe,depth_frag:GCe,distanceRGBA_vert:qCe,distanceRGBA_frag:$Ce,equirect_vert:WCe,equirect_frag:YCe,linedashed_vert:XCe,linedashed_frag:KCe,meshbasic_vert:JCe,meshbasic_frag:ZCe,meshlambert_vert:QCe,meshlambert_frag:eRe,meshmatcap_vert:tRe,meshmatcap_frag:nRe,meshnormal_vert:rRe,meshnormal_frag:iRe,meshphong_vert:sRe,meshphong_frag:aRe,meshphysical_vert:oRe,meshphysical_frag:cRe,meshtoon_vert:lRe,meshtoon_frag:uRe,points_vert:hRe,points_frag:dRe,shadow_vert:fRe,shadow_frag:pRe,sprite_vert:mRe,sprite_frag:gRe},vn={common:{diffuse:{value:new _n(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Zr},alphaMap:{value:null},alphaMapTransform:{value:new Zr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Zr}},envmap:{envMap:{value:null},envMapRotation:{value:new Zr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Zr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Zr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Zr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Zr},normalScale:{value:new Rt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Zr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Zr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Zr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Zr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _n(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _n(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Zr},alphaTest:{value:0},uvTransform:{value:new Zr}},sprite:{diffuse:{value:new _n(16777215)},opacity:{value:1},center:{value:new Rt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Zr},alphaMap:{value:null},alphaMapTransform:{value:new Zr},alphaTest:{value:0}}},qp={basic:{uniforms:zu([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.fog]),vertexShader:ri.meshbasic_vert,fragmentShader:ri.meshbasic_frag},lambert:{uniforms:zu([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,vn.lights,{emissive:{value:new _n(0)}}]),vertexShader:ri.meshlambert_vert,fragmentShader:ri.meshlambert_frag},phong:{uniforms:zu([vn.common,vn.specularmap,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,vn.lights,{emissive:{value:new _n(0)},specular:{value:new _n(1118481)},shininess:{value:30}}]),vertexShader:ri.meshphong_vert,fragmentShader:ri.meshphong_frag},standard:{uniforms:zu([vn.common,vn.envmap,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.roughnessmap,vn.metalnessmap,vn.fog,vn.lights,{emissive:{value:new _n(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ri.meshphysical_vert,fragmentShader:ri.meshphysical_frag},toon:{uniforms:zu([vn.common,vn.aomap,vn.lightmap,vn.emissivemap,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.gradientmap,vn.fog,vn.lights,{emissive:{value:new _n(0)}}]),vertexShader:ri.meshtoon_vert,fragmentShader:ri.meshtoon_frag},matcap:{uniforms:zu([vn.common,vn.bumpmap,vn.normalmap,vn.displacementmap,vn.fog,{matcap:{value:null}}]),vertexShader:ri.meshmatcap_vert,fragmentShader:ri.meshmatcap_frag},points:{uniforms:zu([vn.points,vn.fog]),vertexShader:ri.points_vert,fragmentShader:ri.points_frag},dashed:{uniforms:zu([vn.common,vn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ri.linedashed_vert,fragmentShader:ri.linedashed_frag},depth:{uniforms:zu([vn.common,vn.displacementmap]),vertexShader:ri.depth_vert,fragmentShader:ri.depth_frag},normal:{uniforms:zu([vn.common,vn.bumpmap,vn.normalmap,vn.displacementmap,{opacity:{value:1}}]),vertexShader:ri.meshnormal_vert,fragmentShader:ri.meshnormal_frag},sprite:{uniforms:zu([vn.sprite,vn.fog]),vertexShader:ri.sprite_vert,fragmentShader:ri.sprite_frag},background:{uniforms:{uvTransform:{value:new Zr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ri.background_vert,fragmentShader:ri.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Zr}},vertexShader:ri.backgroundCube_vert,fragmentShader:ri.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ri.cube_vert,fragmentShader:ri.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ri.equirect_vert,fragmentShader:ri.equirect_frag},distanceRGBA:{uniforms:zu([vn.common,vn.displacementmap,{referencePosition:{value:new Re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ri.distanceRGBA_vert,fragmentShader:ri.distanceRGBA_frag},shadow:{uniforms:zu([vn.lights,vn.fog,{color:{value:new _n(0)},opacity:{value:1}}]),vertexShader:ri.shadow_vert,fragmentShader:ri.shadow_frag}};qp.physical={uniforms:zu([qp.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Zr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Zr},clearcoatNormalScale:{value:new Rt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Zr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Zr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Zr},sheen:{value:0},sheenColor:{value:new _n(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Zr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Zr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Zr},transmissionSamplerSize:{value:new Rt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Zr},attenuationDistance:{value:0},attenuationColor:{value:new _n(0)},specularColor:{value:new _n(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Zr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Zr},anisotropyVector:{value:new Rt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Zr}}]),vertexShader:ri.meshphysical_vert,fragmentShader:ri.meshphysical_frag};const Rk={r:0,b:0,g:0},nS=new Xh,vRe=new Nr;function yRe(t,e,n,r,i,s,a){const o=new _n(0);let c=s===!0?0:1,l,u,h=null,d=0,f=null;function p(T){let x=T.isScene===!0?T.background:null;return x&&x.isTexture&&(x=(T.backgroundBlurriness>0?n:e).get(x)),x}function g(T){let x=!1;const N=p(T);N===null?v(o,c):N&&N.isColor&&(v(N,1),x=!0);const A=t.xr.getEnvironmentBlendMode();A==="additive"?r.buffers.color.setClear(0,0,0,1,a):A==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(t.autoClear||x)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function _(T,x){const N=p(x);N&&(N.isCubeTexture||N.mapping===DC)?(u===void 0&&(u=new Bo(new UT(1,1,1),new Bc({name:"BackgroundCubeMaterial",uniforms:zw(qp.backgroundCube.uniforms),vertexShader:qp.backgroundCube.vertexShader,fragmentShader:qp.backgroundCube.fragmentShader,side:Pc,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,I,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),nS.copy(x.backgroundRotation),nS.x*=-1,nS.y*=-1,nS.z*=-1,N.isCubeTexture&&N.isRenderTargetTexture===!1&&(nS.y*=-1,nS.z*=-1),u.material.uniforms.envMap.value=N,u.material.uniforms.flipEnvMap.value=N.isCubeTexture&&N.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(vRe.makeRotationFromEuler(nS)),u.material.toneMapped=Li.getTransfer(N.colorSpace)!==ws,(h!==N||d!==N.version||f!==t.toneMapping)&&(u.material.needsUpdate=!0,h=N,d=N.version,f=t.toneMapping),u.layers.enableAll(),T.unshift(u,u.geometry,u.material,0,0,null)):N&&N.isTexture&&(l===void 0&&(l=new Bo(new BC(2,2),new Bc({name:"BackgroundMaterial",uniforms:zw(qp.background.uniforms),vertexShader:qp.background.vertexShader,fragmentShader:qp.background.fragmentShader,side:Lg,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=N,l.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,l.material.toneMapped=Li.getTransfer(N.colorSpace)!==ws,N.matrixAutoUpdate===!0&&N.updateMatrix(),l.material.uniforms.uvTransform.value.copy(N.matrix),(h!==N||d!==N.version||f!==t.toneMapping)&&(l.material.needsUpdate=!0,h=N,d=N.version,f=t.toneMapping),l.layers.enableAll(),T.unshift(l,l.geometry,l.material,0,0,null))}function v(T,x){T.getRGB(Rk,Xse(t)),r.buffers.color.setClear(Rk.r,Rk.g,Rk.b,x,a)}function E(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return o},setClearColor:function(T,x=1){o.set(T),c=x,v(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(T){c=T,v(o,c)},render:g,addToRenderList:_,dispose:E}}function _Re(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=d(null);let s=i,a=!1;function o(U,$,q,G,X){let re=!1;const V=h(G,q,$);s!==V&&(s=V,l(s.object)),re=f(U,G,q,X),re&&p(U,G,q,X),X!==null&&e.update(X,t.ELEMENT_ARRAY_BUFFER),(re||a)&&(a=!1,x(U,$,q,G),X!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(X).buffer))}function c(){return t.createVertexArray()}function l(U){return t.bindVertexArray(U)}function u(U){return t.deleteVertexArray(U)}function h(U,$,q){const G=q.wireframe===!0;let X=r[U.id];X===void 0&&(X={},r[U.id]=X);let re=X[$.id];re===void 0&&(re={},X[$.id]=re);let V=re[G];return V===void 0&&(V=d(c()),re[G]=V),V}function d(U){const $=[],q=[],G=[];for(let X=0;X<n;X++)$[X]=0,q[X]=0,G[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:$,enabledAttributes:q,attributeDivisors:G,object:U,attributes:{},index:null}}function f(U,$,q,G){const X=s.attributes,re=$.attributes;let V=0;const Z=q.getAttributes();for(const Y in Z)if(Z[Y].location>=0){const oe=X[Y];let de=re[Y];if(de===void 0&&(Y==="instanceMatrix"&&U.instanceMatrix&&(de=U.instanceMatrix),Y==="instanceColor"&&U.instanceColor&&(de=U.instanceColor)),oe===void 0||oe.attribute!==de||de&&oe.data!==de.data)return!0;V++}return s.attributesNum!==V||s.index!==G}function p(U,$,q,G){const X={},re=$.attributes;let V=0;const Z=q.getAttributes();for(const Y in Z)if(Z[Y].location>=0){let oe=re[Y];oe===void 0&&(Y==="instanceMatrix"&&U.instanceMatrix&&(oe=U.instanceMatrix),Y==="instanceColor"&&U.instanceColor&&(oe=U.instanceColor));const de={};de.attribute=oe,oe&&oe.data&&(de.data=oe.data),X[Y]=de,V++}s.attributes=X,s.attributesNum=V,s.index=G}function g(){const U=s.newAttributes;for(let $=0,q=U.length;$<q;$++)U[$]=0}function _(U){v(U,0)}function v(U,$){const q=s.newAttributes,G=s.enabledAttributes,X=s.attributeDivisors;q[U]=1,G[U]===0&&(t.enableVertexAttribArray(U),G[U]=1),X[U]!==$&&(t.vertexAttribDivisor(U,$),X[U]=$)}function E(){const U=s.newAttributes,$=s.enabledAttributes;for(let q=0,G=$.length;q<G;q++)$[q]!==U[q]&&(t.disableVertexAttribArray(q),$[q]=0)}function T(U,$,q,G,X,re,V){V===!0?t.vertexAttribIPointer(U,$,q,X,re):t.vertexAttribPointer(U,$,q,G,X,re)}function x(U,$,q,G){g();const X=G.attributes,re=q.getAttributes(),V=$.defaultAttributeValues;for(const Z in re){const Y=re[Z];if(Y.location>=0){let ee=X[Z];if(ee===void 0&&(Z==="instanceMatrix"&&U.instanceMatrix&&(ee=U.instanceMatrix),Z==="instanceColor"&&U.instanceColor&&(ee=U.instanceColor)),ee!==void 0){const oe=ee.normalized,de=ee.itemSize,Me=e.get(ee);if(Me===void 0)continue;const He=Me.buffer,Te=Me.type,Le=Me.bytesPerElement,we=Te===t.INT||Te===t.UNSIGNED_INT||ee.gpuType===QU;if(ee.isInterleavedBufferAttribute){const Ce=ee.data,ke=Ce.stride,St=ee.offset;if(Ce.isInstancedInterleavedBuffer){for(let At=0;At<Y.locationSize;At++)v(Y.location+At,Ce.meshPerAttribute);U.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=Ce.meshPerAttribute*Ce.count)}else for(let At=0;At<Y.locationSize;At++)_(Y.location+At);t.bindBuffer(t.ARRAY_BUFFER,He);for(let At=0;At<Y.locationSize;At++)T(Y.location+At,de/Y.locationSize,Te,oe,ke*Le,(St+de/Y.locationSize*At)*Le,we)}else{if(ee.isInstancedBufferAttribute){for(let Ce=0;Ce<Y.locationSize;Ce++)v(Y.location+Ce,ee.meshPerAttribute);U.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=ee.meshPerAttribute*ee.count)}else for(let Ce=0;Ce<Y.locationSize;Ce++)_(Y.location+Ce);t.bindBuffer(t.ARRAY_BUFFER,He);for(let Ce=0;Ce<Y.locationSize;Ce++)T(Y.location+Ce,de/Y.locationSize,Te,oe,de*Le,de/Y.locationSize*Ce*Le,we)}}else if(V!==void 0){const oe=V[Z];if(oe!==void 0)switch(oe.length){case 2:t.vertexAttrib2fv(Y.location,oe);break;case 3:t.vertexAttrib3fv(Y.location,oe);break;case 4:t.vertexAttrib4fv(Y.location,oe);break;default:t.vertexAttrib1fv(Y.location,oe)}}}}E()}function N(){k();for(const U in r){const $=r[U];for(const q in $){const G=$[q];for(const X in G)u(G[X].object),delete G[X];delete $[q]}delete r[U]}}function A(U){if(r[U.id]===void 0)return;const $=r[U.id];for(const q in $){const G=$[q];for(const X in G)u(G[X].object),delete G[X];delete $[q]}delete r[U.id]}function I(U){for(const $ in r){const q=r[$];if(q[U.id]===void 0)continue;const G=q[U.id];for(const X in G)u(G[X].object),delete G[X];delete q[U.id]}}function k(){L(),a=!0,s!==i&&(s=i,l(s.object))}function L(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:k,resetDefaultState:L,dispose:N,releaseStatesOfGeometry:A,releaseStatesOfProgram:I,initAttributes:g,enableAttribute:_,disableUnusedAttributes:E}}function bRe(t,e,n){let r;function i(l){r=l}function s(l,u){t.drawArrays(r,l,u),n.update(u,r,1)}function a(l,u,h){h!==0&&(t.drawArraysInstanced(r,l,u,h),n.update(u,r,h))}function o(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let f=0;for(let p=0;p<h;p++)f+=u[p];n.update(f,r,1)}function c(l,u,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<l.length;p++)a(l[p],u[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(r,l,0,u,0,d,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g]*d[g];n.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=c}function ERe(t,e,n,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const I=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(I){return!(I!==iu&&r.convert(I)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(I){const k=I===Bb&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(I!==gl&&r.convert(I)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==ru&&!k)}function c(I){if(I==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=n.logarithmicDepthBuffer===!0,d=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_TEXTURE_SIZE),_=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),v=t.getParameter(t.MAX_VERTEX_ATTRIBS),E=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),T=t.getParameter(t.MAX_VARYING_VECTORS),x=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),N=p>0,A=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:a,textureTypeReadable:o,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:g,maxCubemapSize:_,maxAttributes:v,maxVertexUniforms:E,maxVaryings:T,maxFragmentUniforms:x,vertexTextures:N,maxSamples:A}}function SRe(t){const e=this;let n=null,r=0,i=!1,s=!1;const a=new Nf,o=new Zr,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||r!==0||i;return i=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){n=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,g=h.clipIntersection,_=h.clipShadows,v=t.get(h);if(!i||p===null||p.length===0||s&&!_)s?u(null):l();else{const E=s?0:r,T=E*4;let x=v.clippingState||null;c.value=x,x=u(p,d,T,f);for(let N=0;N!==T;++N)x[N]=n[N];v.clippingState=x,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=E}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,f,p){const g=h!==null?h.length:0;let _=null;if(g!==0){if(_=c.value,p!==!0||_===null){const v=f+g*4,E=d.matrixWorldInverse;o.getNormalMatrix(E),(_===null||_.length<v)&&(_=new Float32Array(v));for(let T=0,x=f;T!==g;++T,x+=4)a.copy(h[T]).applyMatrix4(E,o),a.normal.toArray(_,x),_[x+3]=a.constant}c.value=_,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,_}}function TRe(t){let e=new WeakMap;function n(a,o){return o===vM?a.mapping=Jv:o===yM&&(a.mapping=_b),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===vM||o===yM)if(e.has(a)){const c=e.get(a).texture;return n(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const l=new Zse(c.height);return l.fromEquirectangularTexture(t,a),e.set(a,l),a.addEventListener("dispose",i),n(l.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const c=e.get(o);c!==void 0&&(e.delete(o),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const D1=4,TK=[.125,.215,.35,.446,.526,.582],CS=20,Xz=new cN,xK=new _n;let Kz=null,Jz=0,Zz=0,Qz=!1;const gS=(1+Math.sqrt(5))/2,Zx=1/gS,wK=[new Re(-gS,Zx,0),new Re(gS,Zx,0),new Re(-Zx,0,gS),new Re(Zx,0,gS),new Re(0,gS,-Zx),new Re(0,gS,Zx),new Re(-1,1,-1),new Re(1,1,-1),new Re(-1,1,1),new Re(1,1,1)],xRe=new Re;class $j{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,i=100,s={}){const{size:a=256,position:o=xRe}=s;Kz=this._renderer.getRenderTarget(),Jz=this._renderer.getActiveCubeFace(),Zz=this._renderer.getActiveMipmapLevel(),Qz=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,i,c,o),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=AK(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=RK(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Kz,Jz,Zz),this._renderer.xr.enabled=Qz,e.scissorTest=!1,Ak(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Jv||e.mapping===_b?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Kz=this._renderer.getRenderTarget(),Jz=this._renderer.getActiveCubeFace(),Zz=this._renderer.getActiveMipmapLevel(),Qz=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:_a,minFilter:_a,generateMipmaps:!1,type:Bb,format:iu,colorSpace:Bg,depthBuffer:!1},i=CK(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=CK(e,n,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=wRe(s)),this._blurMaterial=CRe(s,e,n)}return i}_compileMaterial(e){const n=new Bo(this._lodPlanes[0],e);this._renderer.compile(n,Xz)}_sceneToCubeUV(e,n,r,i,s){const c=new Ic(90,1,n,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(xK),h.toneMapping=em,h.autoClear=!1;const p=new Hb({name:"PMREM.Background",side:Pc,depthWrite:!1,depthTest:!1}),g=new Bo(new UT,p);let _=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,_=!0):(p.color.copy(xK),_=!0);for(let E=0;E<6;E++){const T=E%3;T===0?(c.up.set(0,l[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[E],s.y,s.z)):T===1?(c.up.set(0,0,l[E]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[E],s.z)):(c.up.set(0,l[E],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[E]));const x=this._cubeSize;Ak(i,T*x,E>2?x:0,x,x),h.setRenderTarget(i),_&&h.render(g,c),h.render(e,c)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=v}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===Jv||e.mapping===_b;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=AK()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=RK());const s=i?this._cubemapMaterial:this._equirectMaterial,a=new Bo(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const c=this._cubeSize;Ak(n,0,0,3*c,2*c),r.setRenderTarget(n),r.render(a,Xz)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=wK[(i-s-1)%wK.length];this._blur(e,s-1,s,a,o)}n.autoClear=r}_blur(e,n,r,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,n,r,i,"latitudinal",s),this._halfBlur(a,e,r,r,i,"longitudinal",s)}_halfBlur(e,n,r,i,s,a,o){const c=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Bo(this._lodPlanes[i],l),d=l.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*CS-1),g=s/p,_=isFinite(s)?1+Math.floor(u*g):CS;_>CS&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${CS}`);const v=[];let E=0;for(let I=0;I<CS;++I){const k=I/g,L=Math.exp(-k*k/2);v.push(L),I===0?E+=L:I<_&&(E+=2*L)}for(let I=0;I<v.length;I++)v[I]=v[I]/E;d.envMap.value=e.texture,d.samples.value=_,d.weights.value=v,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:T}=this;d.dTheta.value=p,d.mipInt.value=T-r;const x=this._sizeLods[i],N=3*x*(i>T-D1?i-T+D1:0),A=4*(this._cubeSize-x);Ak(n,N,A,3*x,2*x),c.setRenderTarget(n),c.render(h,Xz)}}function wRe(t){const e=[],n=[],r=[];let i=t;const s=t-D1+1+TK.length;for(let a=0;a<s;a++){const o=Math.pow(2,i);n.push(o);let c=1/o;a>t-D1?c=TK[a-t+D1-1]:a===0&&(c=0),r.push(c);const l=1/(o-2),u=-l,h=1+l,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,g=3,_=2,v=1,E=new Float32Array(g*p*f),T=new Float32Array(_*p*f),x=new Float32Array(v*p*f);for(let A=0;A<f;A++){const I=A%3*2/3-1,k=A>2?0:-1,L=[I,k,0,I+2/3,k,0,I+2/3,k+1,0,I,k,0,I+2/3,k+1,0,I,k+1,0];E.set(L,g*p*A),T.set(d,_*p*A);const U=[A,A,A,A,A,A];x.set(U,v*p*A)}const N=new Qr;N.setAttribute("position",new ii(E,g)),N.setAttribute("uv",new ii(T,_)),N.setAttribute("faceIndex",new ii(x,v)),e.push(N),i>D1&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function CK(t,e,n){const r=new Ul(t,e,n);return r.texture.mapping=DC,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Ak(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function CRe(t,e,n){const r=new Float32Array(CS),i=new Re(0,1,0);return new Bc({name:"SphericalGaussianBlur",defines:{n:CS,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Jq(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Zf,depthTest:!1,depthWrite:!1})}function RK(){return new Bc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jq(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Zf,depthTest:!1,depthWrite:!1})}function AK(){return new Bc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jq(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Zf,depthTest:!1,depthWrite:!1})}function Jq(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function RRe(t){let e=new WeakMap,n=null;function r(o){if(o&&o.isTexture){const c=o.mapping,l=c===vM||c===yM,u=c===Jv||c===_b;if(l||u){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return n===null&&(n=new $j(t)),h=l?n.fromEquirectangular(o,h):n.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const f=o.image;return l&&f&&f.height>0||u&&f&&i(f)?(n===null&&(n=new $j(t)),h=l?n.fromEquirectangular(o):n.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function i(o){let c=0;const l=6;for(let u=0;u<l;u++)o[u]!==void 0&&c++;return c===l}function s(o){const c=o.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function a(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:a}}function ARe(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&BD("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function MRe(t,e,n,r){const i={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete i[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,n.memory.geometries--}function o(h,d){return i[d.id]===!0||(d.addEventListener("dispose",a),i[d.id]=!0,n.memory.geometries++),d}function c(h){const d=h.attributes;for(const f in d)e.update(d[f],t.ARRAY_BUFFER)}function l(h){const d=[],f=h.index,p=h.attributes.position;let g=0;if(f!==null){const E=f.array;g=f.version;for(let T=0,x=E.length;T<x;T+=3){const N=E[T+0],A=E[T+1],I=E[T+2];d.push(N,A,A,I,I,N)}}else if(p!==void 0){const E=p.array;g=p.version;for(let T=0,x=E.length/3-1;T<x;T+=3){const N=T+0,A=T+1,I=T+2;d.push(N,A,A,I,I,N)}}else return;const _=new(qse(d)?Cq:wq)(d,1);_.version=g;const v=s.get(h);v&&e.remove(v),s.set(h,_)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&l(h)}else l(h);return s.get(h)}return{get:o,update:c,getWireframeAttribute:u}}function ORe(t,e,n){let r;function i(d){r=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function c(d,f){t.drawElements(r,f,s,d*a),n.update(f,r,1)}function l(d,f,p){p!==0&&(t.drawElementsInstanced(r,f,s,d*a,p),n.update(f,r,p))}function u(d,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,f,0,s,d,0,p);let _=0;for(let v=0;v<p;v++)_+=f[v];n.update(_,r,1)}function h(d,f,p,g){if(p===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let v=0;v<d.length;v++)l(d[v]/a,f[v],g[v]);else{_.multiDrawElementsInstancedWEBGL(r,f,0,s,d,0,g,0,p);let v=0;for(let E=0;E<p;E++)v+=f[E]*g[E];n.update(v,r,1)}}this.setMode=i,this.setIndex=o,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function NRe(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(n.calls++,a){case t.TRIANGLES:n.triangles+=o*(s/3);break;case t.LINES:n.lines+=o*(s/2);break;case t.LINE_STRIP:n.lines+=o*(s-1);break;case t.LINE_LOOP:n.lines+=o*s;break;case t.POINTS:n.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function IRe(t,e,n){const r=new WeakMap,i=new Ki;function s(a,o,c){const l=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(o);if(d===void 0||d.count!==h){let L=function(){I.dispose(),r.delete(o),o.removeEventListener("dispose",L)};d!==void 0&&d.texture.dispose();const f=o.morphAttributes.position!==void 0,p=o.morphAttributes.normal!==void 0,g=o.morphAttributes.color!==void 0,_=o.morphAttributes.position||[],v=o.morphAttributes.normal||[],E=o.morphAttributes.color||[];let T=0;f===!0&&(T=1),p===!0&&(T=2),g===!0&&(T=3);let x=o.attributes.position.count*T,N=1;x>e.maxTextureSize&&(N=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const A=new Float32Array(x*N*4*h),I=new QO(A,x,N,h);I.type=ru,I.needsUpdate=!0;const k=T*4;for(let U=0;U<h;U++){const $=_[U],q=v[U],G=E[U],X=x*N*4*U;for(let re=0;re<$.count;re++){const V=re*k;f===!0&&(i.fromBufferAttribute($,re),A[X+V+0]=i.x,A[X+V+1]=i.y,A[X+V+2]=i.z,A[X+V+3]=0),p===!0&&(i.fromBufferAttribute(q,re),A[X+V+4]=i.x,A[X+V+5]=i.y,A[X+V+6]=i.z,A[X+V+7]=0),g===!0&&(i.fromBufferAttribute(G,re),A[X+V+8]=i.x,A[X+V+9]=i.y,A[X+V+10]=i.z,A[X+V+11]=G.itemSize===4?i.w:1)}}d={count:h,texture:I,size:new Rt(x,N)},r.set(o,d),o.addEventListener("dispose",L)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",a.morphTexture,n);else{let f=0;for(let g=0;g<l.length;g++)f+=l[g];const p=o.morphTargetsRelative?1:1-f;c.getUniforms().setValue(t,"morphTargetBaseInfluence",p),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",d.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function kRe(t,e,n,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",o)===!1&&c.addEventListener("dispose",o),i.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return h}function a(){i=new WeakMap}function o(c){const l=c.target;l.removeEventListener("dispose",o),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:a}}const Jae=new Pa,MK=new UC(1,1),Zae=new QO,Qae=new a3,eoe=new tN,OK=[],NK=[],IK=new Float32Array(16),kK=new Float32Array(9),DK=new Float32Array(4);function FC(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=OK[i];if(s===void 0&&(s=new Float32Array(i),OK[i]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=n,t[a].toArray(s,o)}return s}function Fc(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function zc(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function R3(t,e){let n=NK[e];n===void 0&&(n=new Int32Array(e),NK[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function DRe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function PRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Fc(n,e))return;t.uniform2fv(this.addr,e),zc(n,e)}}function LRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Fc(n,e))return;t.uniform3fv(this.addr,e),zc(n,e)}}function URe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Fc(n,e))return;t.uniform4fv(this.addr,e),zc(n,e)}}function BRe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Fc(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),zc(n,e)}else{if(Fc(n,r))return;DK.set(r),t.uniformMatrix2fv(this.addr,!1,DK),zc(n,r)}}function FRe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Fc(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),zc(n,e)}else{if(Fc(n,r))return;kK.set(r),t.uniformMatrix3fv(this.addr,!1,kK),zc(n,r)}}function zRe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Fc(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),zc(n,e)}else{if(Fc(n,r))return;IK.set(r),t.uniformMatrix4fv(this.addr,!1,IK),zc(n,r)}}function HRe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function jRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Fc(n,e))return;t.uniform2iv(this.addr,e),zc(n,e)}}function VRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Fc(n,e))return;t.uniform3iv(this.addr,e),zc(n,e)}}function GRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Fc(n,e))return;t.uniform4iv(this.addr,e),zc(n,e)}}function qRe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function $Re(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Fc(n,e))return;t.uniform2uiv(this.addr,e),zc(n,e)}}function WRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Fc(n,e))return;t.uniform3uiv(this.addr,e),zc(n,e)}}function YRe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Fc(n,e))return;t.uniform4uiv(this.addr,e),zc(n,e)}}function XRe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let s;this.type===t.SAMPLER_2D_SHADOW?(MK.compareFunction=Tq,s=MK):s=Jae,n.setTexture2D(e||s,i)}function KRe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Qae,i)}function JRe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||eoe,i)}function ZRe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Zae,i)}function QRe(t){switch(t){case 5126:return DRe;case 35664:return PRe;case 35665:return LRe;case 35666:return URe;case 35674:return BRe;case 35675:return FRe;case 35676:return zRe;case 5124:case 35670:return HRe;case 35667:case 35671:return jRe;case 35668:case 35672:return VRe;case 35669:case 35673:return GRe;case 5125:return qRe;case 36294:return $Re;case 36295:return WRe;case 36296:return YRe;case 35678:case 36198:case 36298:case 36306:case 35682:return XRe;case 35679:case 36299:case 36307:return KRe;case 35680:case 36300:case 36308:case 36293:return JRe;case 36289:case 36303:case 36311:case 36292:return ZRe}}function eAe(t,e){t.uniform1fv(this.addr,e)}function tAe(t,e){const n=FC(e,this.size,2);t.uniform2fv(this.addr,n)}function nAe(t,e){const n=FC(e,this.size,3);t.uniform3fv(this.addr,n)}function rAe(t,e){const n=FC(e,this.size,4);t.uniform4fv(this.addr,n)}function iAe(t,e){const n=FC(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function sAe(t,e){const n=FC(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function aAe(t,e){const n=FC(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function oAe(t,e){t.uniform1iv(this.addr,e)}function cAe(t,e){t.uniform2iv(this.addr,e)}function lAe(t,e){t.uniform3iv(this.addr,e)}function uAe(t,e){t.uniform4iv(this.addr,e)}function hAe(t,e){t.uniform1uiv(this.addr,e)}function dAe(t,e){t.uniform2uiv(this.addr,e)}function fAe(t,e){t.uniform3uiv(this.addr,e)}function pAe(t,e){t.uniform4uiv(this.addr,e)}function mAe(t,e,n){const r=this.cache,i=e.length,s=R3(n,i);Fc(r,s)||(t.uniform1iv(this.addr,s),zc(r,s));for(let a=0;a!==i;++a)n.setTexture2D(e[a]||Jae,s[a])}function gAe(t,e,n){const r=this.cache,i=e.length,s=R3(n,i);Fc(r,s)||(t.uniform1iv(this.addr,s),zc(r,s));for(let a=0;a!==i;++a)n.setTexture3D(e[a]||Qae,s[a])}function vAe(t,e,n){const r=this.cache,i=e.length,s=R3(n,i);Fc(r,s)||(t.uniform1iv(this.addr,s),zc(r,s));for(let a=0;a!==i;++a)n.setTextureCube(e[a]||eoe,s[a])}function yAe(t,e,n){const r=this.cache,i=e.length,s=R3(n,i);Fc(r,s)||(t.uniform1iv(this.addr,s),zc(r,s));for(let a=0;a!==i;++a)n.setTexture2DArray(e[a]||Zae,s[a])}function _Ae(t){switch(t){case 5126:return eAe;case 35664:return tAe;case 35665:return nAe;case 35666:return rAe;case 35674:return iAe;case 35675:return sAe;case 35676:return aAe;case 5124:case 35670:return oAe;case 35667:case 35671:return cAe;case 35668:case 35672:return lAe;case 35669:case 35673:return uAe;case 5125:return hAe;case 36294:return dAe;case 36295:return fAe;case 36296:return pAe;case 35678:case 36198:case 36298:case 36306:case 35682:return mAe;case 35679:case 36299:case 36307:return gAe;case 35680:case 36300:case 36308:case 36293:return vAe;case 36289:case 36303:case 36311:case 36292:return yAe}}class bAe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=QRe(n.type)}}class EAe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=_Ae(n.type)}}class SAe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const o=i[s];o.setValue(e,n[o.id],r)}}}const e8=/(\w+)(\])?(\[|\.)?/g;function PK(t,e){t.seq.push(e),t.map[e.id]=e}function TAe(t,e,n){const r=t.name,i=r.length;for(e8.lastIndex=0;;){const s=e8.exec(r),a=e8.lastIndex;let o=s[1];const c=s[2]==="]",l=s[3];if(c&&(o=o|0),l===void 0||l==="["&&a+2===i){PK(n,l===void 0?new bAe(o,t,e):new EAe(o,t,e));break}else{let h=n.map[o];h===void 0&&(h=new SAe(o),PK(n,h)),n=h}}}class zD{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(n,i),a=e.getUniformLocation(n,s.name);TAe(s,a,this)}}setValue(e,n,r,i){const s=this.map[n];s!==void 0&&s.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let s=0,a=n.length;s!==a;++s){const o=n[s],c=r[o.id];c.needsUpdate!==!1&&o.setValue(e,c.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in n&&r.push(a)}return r}}function LK(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const xAe=37297;let wAe=0;function CAe(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let a=i;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${n[a]}`)}return r.join(`
`)}const UK=new Zr;function RAe(t){Li._getMatrix(UK,Li.workingColorSpace,t);const e=`mat3( ${UK.elements.map(n=>n.toFixed(4))} )`;switch(Li.getTransfer(t)){case TM:return[e,"LinearTransferOETF"];case ws:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function BK(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const a=parseInt(s[1]);return n.toUpperCase()+`

`+i+`

`+CAe(t.getShaderSource(e),a)}else return i}function AAe(t,e){const n=RAe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function MAe(t,e){let n;switch(e){case wse:n="Linear";break;case Cse:n="Reinhard";break;case Rse:n="Cineon";break;case fq:n="ACESFilmic";break;case Mse:n="AgX";break;case Ose:n="Neutral";break;case Ase:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Mk=new Re;function OAe(){Li.getLuminanceCoefficients(Mk);const t=Mk.x.toFixed(4),e=Mk.y.toFixed(4),n=Mk.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function NAe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(pA).join(`
`)}function IAe(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function kAe(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i),a=s.name;let o=1;s.type===t.FLOAT_MAT2&&(o=2),s.type===t.FLOAT_MAT3&&(o=3),s.type===t.FLOAT_MAT4&&(o=4),n[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return n}function pA(t){return t!==""}function FK(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function zK(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const DAe=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wj(t){return t.replace(DAe,LAe)}const PAe=new Map;function LAe(t,e){let n=ri[e];if(n===void 0){const r=PAe.get(e);if(r!==void 0)n=ri[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return Wj(n)}const UAe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function HK(t){return t.replace(UAe,BAe)}function BAe(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function jK(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function FAe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===JU?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===AA?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===jp&&(e="SHADOWMAP_TYPE_VSM"),e}function zAe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Jv:case _b:e="ENVMAP_TYPE_CUBE";break;case DC:e="ENVMAP_TYPE_CUBE_UV";break}return e}function HAe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case _b:e="ENVMAP_MODE_REFRACTION";break}return e}function jAe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case KO:e="ENVMAP_BLENDING_MULTIPLY";break;case Tse:e="ENVMAP_BLENDING_MIX";break;case xse:e="ENVMAP_BLENDING_ADD";break}return e}function VAe(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function GAe(t,e,n,r){const i=t.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const c=FAe(n),l=zAe(n),u=HAe(n),h=jAe(n),d=VAe(n),f=NAe(n),p=IAe(s),g=i.createProgram();let _,v,E=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(_=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(pA).join(`
`),_.length>0&&(_+=`
`),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(pA).join(`
`),v.length>0&&(v+=`
`)):(_=[jK(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(pA).join(`
`),v=[jK(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==em?"#define TONE_MAPPING":"",n.toneMapping!==em?ri.tonemapping_pars_fragment:"",n.toneMapping!==em?MAe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ri.colorspace_pars_fragment,AAe("linearToOutputTexel",n.outputColorSpace),OAe(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(pA).join(`
`)),a=Wj(a),a=FK(a,n),a=zK(a,n),o=Wj(o),o=FK(o,n),o=zK(o,n),a=HK(a),o=HK(o),n.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,_=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,v=["#define varying in",n.glslVersion===Bj?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Bj?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const T=E+_+a,x=E+v+o,N=LK(i,i.VERTEX_SHADER,T),A=LK(i,i.FRAGMENT_SHADER,x);i.attachShader(g,N),i.attachShader(g,A),n.index0AttributeName!==void 0?i.bindAttribLocation(g,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function I($){if(t.debug.checkShaderErrors){const q=i.getProgramInfoLog(g).trim(),G=i.getShaderInfoLog(N).trim(),X=i.getShaderInfoLog(A).trim();let re=!0,V=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(re=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,g,N,A);else{const Z=BK(i,N,"vertex"),Y=BK(i,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+$.name+`
Material Type: `+$.type+`

Program Info Log: `+q+`
`+Z+`
`+Y)}else q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",q):(G===""||X==="")&&(V=!1);V&&($.diagnostics={runnable:re,programLog:q,vertexShader:{log:G,prefix:_},fragmentShader:{log:X,prefix:v}})}i.deleteShader(N),i.deleteShader(A),k=new zD(i,g),L=kAe(i,g)}let k;this.getUniforms=function(){return k===void 0&&I(this),k};let L;this.getAttributes=function(){return L===void 0&&I(this),L};let U=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return U===!1&&(U=i.getProgramParameter(g,xAe)),U},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=wAe++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=N,this.fragmentShader=A,this}let qAe=0;class $Ae{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new WAe(e),n.set(e,r)),r}}class WAe{constructor(e){this.id=qAe++,this.code=e,this.usedTimes=0}}function YAe(t,e,n,r,i,s,a){const o=new Fw,c=new $Ae,l=new Set,u=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(L){return l.add(L),L===0?"uv":`uv${L}`}function _(L,U,$,q,G){const X=q.fog,re=G.geometry,V=L.isMeshStandardMaterial?q.environment:null,Z=(L.isMeshStandardMaterial?n:e).get(L.envMap||V),Y=Z&&Z.mapping===DC?Z.image.height:null,ee=p[L.type];L.precision!==null&&(f=i.getMaxPrecision(L.precision),f!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",f,"instead."));const oe=re.morphAttributes.position||re.morphAttributes.normal||re.morphAttributes.color,de=oe!==void 0?oe.length:0;let Me=0;re.morphAttributes.position!==void 0&&(Me=1),re.morphAttributes.normal!==void 0&&(Me=2),re.morphAttributes.color!==void 0&&(Me=3);let He,Te,Le,we;if(ee){const Nt=qp[ee];He=Nt.vertexShader,Te=Nt.fragmentShader}else He=L.vertexShader,Te=L.fragmentShader,c.update(L),Le=c.getVertexShaderID(L),we=c.getFragmentShaderID(L);const Ce=t.getRenderTarget(),ke=t.state.buffers.depth.getReversed(),St=G.isInstancedMesh===!0,At=G.isBatchedMesh===!0,Ee=!!L.map,ye=!!L.matcap,et=!!Z,fe=!!L.aoMap,Fe=!!L.lightMap,Ie=!!L.bumpMap,rt=!!L.normalMap,dt=!!L.displacementMap,gt=!!L.emissiveMap,bt=!!L.metalnessMap,be=!!L.roughnessMap,ue=L.anisotropy>0,Xe=L.clearcoat>0,nt=L.dispersion>0,$e=L.iridescence>0,Ue=L.sheen>0,qt=L.transmission>0,Mt=ue&&!!L.anisotropyMap,Yt=Xe&&!!L.clearcoatMap,ce=Xe&&!!L.clearcoatNormalMap,j=Xe&&!!L.clearcoatRoughnessMap,W=$e&&!!L.iridescenceMap,me=$e&&!!L.iridescenceThicknessMap,De=Ue&&!!L.sheenColorMap,je=Ue&&!!L.sheenRoughnessMap,mt=!!L.specularMap,xt=!!L.specularColorMap,Vn=!!L.specularIntensityMap,qe=qt&&!!L.transmissionMap,Vt=qt&&!!L.thicknessMap,ht=!!L.gradientMap,Pt=!!L.alphaMap,hn=L.alphaTest>0,an=!!L.alphaHash,Ve=!!L.extensions;let ot=em;L.toneMapped&&(Ce===null||Ce.isXRRenderTarget===!0)&&(ot=t.toneMapping);const Ct={shaderID:ee,shaderType:L.type,shaderName:L.name,vertexShader:He,fragmentShader:Te,defines:L.defines,customVertexShaderID:Le,customFragmentShaderID:we,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:f,batching:At,batchingColor:At&&G._colorsTexture!==null,instancing:St,instancingColor:St&&G.instanceColor!==null,instancingMorph:St&&G.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:Ce===null?t.outputColorSpace:Ce.isXRRenderTarget===!0?Ce.texture.colorSpace:Bg,alphaToCoverage:!!L.alphaToCoverage,map:Ee,matcap:ye,envMap:et,envMapMode:et&&Z.mapping,envMapCubeUVHeight:Y,aoMap:fe,lightMap:Fe,bumpMap:Ie,normalMap:rt,displacementMap:d&&dt,emissiveMap:gt,normalMapObjectSpace:rt&&L.normalMapType===Lse,normalMapTangentSpace:rt&&L.normalMapType===zb,metalnessMap:bt,roughnessMap:be,anisotropy:ue,anisotropyMap:Mt,clearcoat:Xe,clearcoatMap:Yt,clearcoatNormalMap:ce,clearcoatRoughnessMap:j,dispersion:nt,iridescence:$e,iridescenceMap:W,iridescenceThicknessMap:me,sheen:Ue,sheenColorMap:De,sheenRoughnessMap:je,specularMap:mt,specularColorMap:xt,specularIntensityMap:Vn,transmission:qt,transmissionMap:qe,thicknessMap:Vt,gradientMap:ht,opaque:L.transparent===!1&&L.blending===FS&&L.alphaToCoverage===!1,alphaMap:Pt,alphaTest:hn,alphaHash:an,combine:L.combine,mapUv:Ee&&g(L.map.channel),aoMapUv:fe&&g(L.aoMap.channel),lightMapUv:Fe&&g(L.lightMap.channel),bumpMapUv:Ie&&g(L.bumpMap.channel),normalMapUv:rt&&g(L.normalMap.channel),displacementMapUv:dt&&g(L.displacementMap.channel),emissiveMapUv:gt&&g(L.emissiveMap.channel),metalnessMapUv:bt&&g(L.metalnessMap.channel),roughnessMapUv:be&&g(L.roughnessMap.channel),anisotropyMapUv:Mt&&g(L.anisotropyMap.channel),clearcoatMapUv:Yt&&g(L.clearcoatMap.channel),clearcoatNormalMapUv:ce&&g(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:j&&g(L.clearcoatRoughnessMap.channel),iridescenceMapUv:W&&g(L.iridescenceMap.channel),iridescenceThicknessMapUv:me&&g(L.iridescenceThicknessMap.channel),sheenColorMapUv:De&&g(L.sheenColorMap.channel),sheenRoughnessMapUv:je&&g(L.sheenRoughnessMap.channel),specularMapUv:mt&&g(L.specularMap.channel),specularColorMapUv:xt&&g(L.specularColorMap.channel),specularIntensityMapUv:Vn&&g(L.specularIntensityMap.channel),transmissionMapUv:qe&&g(L.transmissionMap.channel),thicknessMapUv:Vt&&g(L.thicknessMap.channel),alphaMapUv:Pt&&g(L.alphaMap.channel),vertexTangents:!!re.attributes.tangent&&(rt||ue),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!re.attributes.color&&re.attributes.color.itemSize===4,pointsUvs:G.isPoints===!0&&!!re.attributes.uv&&(Ee||Pt),fog:!!X,useFog:L.fog===!0,fogExp2:!!X&&X.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:ke,skinning:G.isSkinnedMesh===!0,morphTargets:re.morphAttributes.position!==void 0,morphNormals:re.morphAttributes.normal!==void 0,morphColors:re.morphAttributes.color!==void 0,morphTargetsCount:de,morphTextureStride:Me,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numLightProbes:U.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:L.dithering,shadowMapEnabled:t.shadowMap.enabled&&$.length>0,shadowMapType:t.shadowMap.type,toneMapping:ot,decodeVideoTexture:Ee&&L.map.isVideoTexture===!0&&Li.getTransfer(L.map.colorSpace)===ws,decodeVideoTextureEmissive:gt&&L.emissiveMap.isVideoTexture===!0&&Li.getTransfer(L.emissiveMap.colorSpace)===ws,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===ll,flipSided:L.side===Pc,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:Ve&&L.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Ve&&L.extensions.multiDraw===!0||At)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return Ct.vertexUv1s=l.has(1),Ct.vertexUv2s=l.has(2),Ct.vertexUv3s=l.has(3),l.clear(),Ct}function v(L){const U=[];if(L.shaderID?U.push(L.shaderID):(U.push(L.customVertexShaderID),U.push(L.customFragmentShaderID)),L.defines!==void 0)for(const $ in L.defines)U.push($),U.push(L.defines[$]);return L.isRawShaderMaterial===!1&&(E(U,L),T(U,L),U.push(t.outputColorSpace)),U.push(L.customProgramCacheKey),U.join()}function E(L,U){L.push(U.precision),L.push(U.outputColorSpace),L.push(U.envMapMode),L.push(U.envMapCubeUVHeight),L.push(U.mapUv),L.push(U.alphaMapUv),L.push(U.lightMapUv),L.push(U.aoMapUv),L.push(U.bumpMapUv),L.push(U.normalMapUv),L.push(U.displacementMapUv),L.push(U.emissiveMapUv),L.push(U.metalnessMapUv),L.push(U.roughnessMapUv),L.push(U.anisotropyMapUv),L.push(U.clearcoatMapUv),L.push(U.clearcoatNormalMapUv),L.push(U.clearcoatRoughnessMapUv),L.push(U.iridescenceMapUv),L.push(U.iridescenceThicknessMapUv),L.push(U.sheenColorMapUv),L.push(U.sheenRoughnessMapUv),L.push(U.specularMapUv),L.push(U.specularColorMapUv),L.push(U.specularIntensityMapUv),L.push(U.transmissionMapUv),L.push(U.thicknessMapUv),L.push(U.combine),L.push(U.fogExp2),L.push(U.sizeAttenuation),L.push(U.morphTargetsCount),L.push(U.morphAttributeCount),L.push(U.numDirLights),L.push(U.numPointLights),L.push(U.numSpotLights),L.push(U.numSpotLightMaps),L.push(U.numHemiLights),L.push(U.numRectAreaLights),L.push(U.numDirLightShadows),L.push(U.numPointLightShadows),L.push(U.numSpotLightShadows),L.push(U.numSpotLightShadowsWithMaps),L.push(U.numLightProbes),L.push(U.shadowMapType),L.push(U.toneMapping),L.push(U.numClippingPlanes),L.push(U.numClipIntersection),L.push(U.depthPacking)}function T(L,U){o.disableAll(),U.supportsVertexTextures&&o.enable(0),U.instancing&&o.enable(1),U.instancingColor&&o.enable(2),U.instancingMorph&&o.enable(3),U.matcap&&o.enable(4),U.envMap&&o.enable(5),U.normalMapObjectSpace&&o.enable(6),U.normalMapTangentSpace&&o.enable(7),U.clearcoat&&o.enable(8),U.iridescence&&o.enable(9),U.alphaTest&&o.enable(10),U.vertexColors&&o.enable(11),U.vertexAlphas&&o.enable(12),U.vertexUv1s&&o.enable(13),U.vertexUv2s&&o.enable(14),U.vertexUv3s&&o.enable(15),U.vertexTangents&&o.enable(16),U.anisotropy&&o.enable(17),U.alphaHash&&o.enable(18),U.batching&&o.enable(19),U.dispersion&&o.enable(20),U.batchingColor&&o.enable(21),L.push(o.mask),o.disableAll(),U.fog&&o.enable(0),U.useFog&&o.enable(1),U.flatShading&&o.enable(2),U.logarithmicDepthBuffer&&o.enable(3),U.reverseDepthBuffer&&o.enable(4),U.skinning&&o.enable(5),U.morphTargets&&o.enable(6),U.morphNormals&&o.enable(7),U.morphColors&&o.enable(8),U.premultipliedAlpha&&o.enable(9),U.shadowMapEnabled&&o.enable(10),U.doubleSided&&o.enable(11),U.flipSided&&o.enable(12),U.useDepthPacking&&o.enable(13),U.dithering&&o.enable(14),U.transmission&&o.enable(15),U.sheen&&o.enable(16),U.opaque&&o.enable(17),U.pointsUvs&&o.enable(18),U.decodeVideoTexture&&o.enable(19),U.decodeVideoTextureEmissive&&o.enable(20),U.alphaToCoverage&&o.enable(21),L.push(o.mask)}function x(L){const U=p[L.type];let $;if(U){const q=qp[U];$=Kse.clone(q.uniforms)}else $=L.uniforms;return $}function N(L,U){let $;for(let q=0,G=u.length;q<G;q++){const X=u[q];if(X.cacheKey===U){$=X,++$.usedTimes;break}}return $===void 0&&($=new GAe(t,U,L,s),u.push($)),$}function A(L){if(--L.usedTimes===0){const U=u.indexOf(L);u[U]=u[u.length-1],u.pop(),L.destroy()}}function I(L){c.remove(L)}function k(){c.dispose()}return{getParameters:_,getProgramCacheKey:v,getUniforms:x,acquireProgram:N,releaseProgram:A,releaseShaderCache:I,programs:u,dispose:k}}function XAe(){let t=new WeakMap;function e(a){return t.has(a)}function n(a){let o=t.get(a);return o===void 0&&(o={},t.set(a,o)),o}function r(a){t.delete(a)}function i(a,o,c){t.get(a)[o]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:s}}function KAe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function VK(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function GK(){const t=[];let e=0;const n=[],r=[],i=[];function s(){e=0,n.length=0,r.length=0,i.length=0}function a(h,d,f,p,g,_){let v=t[e];return v===void 0?(v={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:g,group:_},t[e]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=f,v.groupOrder=p,v.renderOrder=h.renderOrder,v.z=g,v.group=_),e++,v}function o(h,d,f,p,g,_){const v=a(h,d,f,p,g,_);f.transmission>0?r.push(v):f.transparent===!0?i.push(v):n.push(v)}function c(h,d,f,p,g,_){const v=a(h,d,f,p,g,_);f.transmission>0?r.unshift(v):f.transparent===!0?i.unshift(v):n.unshift(v)}function l(h,d){n.length>1&&n.sort(h||KAe),r.length>1&&r.sort(d||VK),i.length>1&&i.sort(d||VK)}function u(){for(let h=e,d=t.length;h<d;h++){const f=t[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:n,transmissive:r,transparent:i,init:s,push:o,unshift:c,finish:u,sort:l}}function JAe(){let t=new WeakMap;function e(r,i){const s=t.get(r);let a;return s===void 0?(a=new GK,t.set(r,[a])):i>=s.length?(a=new GK,s.push(a)):a=s[i],a}function n(){t=new WeakMap}return{get:e,dispose:n}}function ZAe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Re,color:new _n};break;case"SpotLight":n={position:new Re,direction:new Re,color:new _n,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Re,color:new _n,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Re,skyColor:new _n,groundColor:new _n};break;case"RectAreaLight":n={color:new _n,position:new Re,halfWidth:new Re,halfHeight:new Re};break}return t[e.id]=n,n}}}function QAe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rt};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let eMe=0;function tMe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function nMe(t){const e=new ZAe,n=QAe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new Re);const i=new Re,s=new Nr,a=new Nr;function o(l){let u=0,h=0,d=0;for(let L=0;L<9;L++)r.probe[L].set(0,0,0);let f=0,p=0,g=0,_=0,v=0,E=0,T=0,x=0,N=0,A=0,I=0;l.sort(tMe);for(let L=0,U=l.length;L<U;L++){const $=l[L],q=$.color,G=$.intensity,X=$.distance,re=$.shadow&&$.shadow.map?$.shadow.map.texture:null;if($.isAmbientLight)u+=q.r*G,h+=q.g*G,d+=q.b*G;else if($.isLightProbe){for(let V=0;V<9;V++)r.probe[V].addScaledVector($.sh.coefficients[V],G);I++}else if($.isDirectionalLight){const V=e.get($);if(V.color.copy($.color).multiplyScalar($.intensity),$.castShadow){const Z=$.shadow,Y=n.get($);Y.shadowIntensity=Z.intensity,Y.shadowBias=Z.bias,Y.shadowNormalBias=Z.normalBias,Y.shadowRadius=Z.radius,Y.shadowMapSize=Z.mapSize,r.directionalShadow[f]=Y,r.directionalShadowMap[f]=re,r.directionalShadowMatrix[f]=$.shadow.matrix,E++}r.directional[f]=V,f++}else if($.isSpotLight){const V=e.get($);V.position.setFromMatrixPosition($.matrixWorld),V.color.copy(q).multiplyScalar(G),V.distance=X,V.coneCos=Math.cos($.angle),V.penumbraCos=Math.cos($.angle*(1-$.penumbra)),V.decay=$.decay,r.spot[g]=V;const Z=$.shadow;if($.map&&(r.spotLightMap[N]=$.map,N++,Z.updateMatrices($),$.castShadow&&A++),r.spotLightMatrix[g]=Z.matrix,$.castShadow){const Y=n.get($);Y.shadowIntensity=Z.intensity,Y.shadowBias=Z.bias,Y.shadowNormalBias=Z.normalBias,Y.shadowRadius=Z.radius,Y.shadowMapSize=Z.mapSize,r.spotShadow[g]=Y,r.spotShadowMap[g]=re,x++}g++}else if($.isRectAreaLight){const V=e.get($);V.color.copy(q).multiplyScalar(G),V.halfWidth.set($.width*.5,0,0),V.halfHeight.set(0,$.height*.5,0),r.rectArea[_]=V,_++}else if($.isPointLight){const V=e.get($);if(V.color.copy($.color).multiplyScalar($.intensity),V.distance=$.distance,V.decay=$.decay,$.castShadow){const Z=$.shadow,Y=n.get($);Y.shadowIntensity=Z.intensity,Y.shadowBias=Z.bias,Y.shadowNormalBias=Z.normalBias,Y.shadowRadius=Z.radius,Y.shadowMapSize=Z.mapSize,Y.shadowCameraNear=Z.camera.near,Y.shadowCameraFar=Z.camera.far,r.pointShadow[p]=Y,r.pointShadowMap[p]=re,r.pointShadowMatrix[p]=$.shadow.matrix,T++}r.point[p]=V,p++}else if($.isHemisphereLight){const V=e.get($);V.skyColor.copy($.color).multiplyScalar(G),V.groundColor.copy($.groundColor).multiplyScalar(G),r.hemi[v]=V,v++}}_>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=vn.LTC_FLOAT_1,r.rectAreaLTC2=vn.LTC_FLOAT_2):(r.rectAreaLTC1=vn.LTC_HALF_1,r.rectAreaLTC2=vn.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const k=r.hash;(k.directionalLength!==f||k.pointLength!==p||k.spotLength!==g||k.rectAreaLength!==_||k.hemiLength!==v||k.numDirectionalShadows!==E||k.numPointShadows!==T||k.numSpotShadows!==x||k.numSpotMaps!==N||k.numLightProbes!==I)&&(r.directional.length=f,r.spot.length=g,r.rectArea.length=_,r.point.length=p,r.hemi.length=v,r.directionalShadow.length=E,r.directionalShadowMap.length=E,r.pointShadow.length=T,r.pointShadowMap.length=T,r.spotShadow.length=x,r.spotShadowMap.length=x,r.directionalShadowMatrix.length=E,r.pointShadowMatrix.length=T,r.spotLightMatrix.length=x+N-A,r.spotLightMap.length=N,r.numSpotLightShadowsWithMaps=A,r.numLightProbes=I,k.directionalLength=f,k.pointLength=p,k.spotLength=g,k.rectAreaLength=_,k.hemiLength=v,k.numDirectionalShadows=E,k.numPointShadows=T,k.numSpotShadows=x,k.numSpotMaps=N,k.numLightProbes=I,r.version=eMe++)}function c(l,u){let h=0,d=0,f=0,p=0,g=0;const _=u.matrixWorldInverse;for(let v=0,E=l.length;v<E;v++){const T=l[v];if(T.isDirectionalLight){const x=r.directional[h];x.direction.setFromMatrixPosition(T.matrixWorld),i.setFromMatrixPosition(T.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(_),h++}else if(T.isSpotLight){const x=r.spot[f];x.position.setFromMatrixPosition(T.matrixWorld),x.position.applyMatrix4(_),x.direction.setFromMatrixPosition(T.matrixWorld),i.setFromMatrixPosition(T.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(_),f++}else if(T.isRectAreaLight){const x=r.rectArea[p];x.position.setFromMatrixPosition(T.matrixWorld),x.position.applyMatrix4(_),a.identity(),s.copy(T.matrixWorld),s.premultiply(_),a.extractRotation(s),x.halfWidth.set(T.width*.5,0,0),x.halfHeight.set(0,T.height*.5,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),p++}else if(T.isPointLight){const x=r.point[d];x.position.setFromMatrixPosition(T.matrixWorld),x.position.applyMatrix4(_),d++}else if(T.isHemisphereLight){const x=r.hemi[g];x.direction.setFromMatrixPosition(T.matrixWorld),x.direction.transformDirection(_),g++}}}return{setup:o,setupView:c,state:r}}function qK(t){const e=new nMe(t),n=[],r=[];function i(u){l.camera=u,n.length=0,r.length=0}function s(u){n.push(u)}function a(u){r.push(u)}function o(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:o,setupLightsView:c,pushLight:s,pushShadow:a}}function rMe(t){let e=new WeakMap;function n(i,s=0){const a=e.get(i);let o;return a===void 0?(o=new qK(t),e.set(i,[o])):s>=a.length?(o=new qK(t),a.push(o)):o=a[s],o}function r(){e=new WeakMap}return{get:n,dispose:r}}const iMe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,sMe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function aMe(t,e,n){let r=new LC;const i=new Rt,s=new Rt,a=new Ki,o=new Bq({depthPacking:Pse}),c=new Fq,l={},u=n.maxTextureSize,h={[Lg]:Pc,[Pc]:Lg,[ll]:ll},d=new Bc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Rt},radius:{value:4}},vertexShader:iMe,fragmentShader:sMe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Qr;p.setAttribute("position",new ii(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Bo(p,d),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=JU;let v=this.type;this.render=function(A,I,k){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||A.length===0)return;const L=t.getRenderTarget(),U=t.getActiveCubeFace(),$=t.getActiveMipmapLevel(),q=t.state;q.setBlending(Zf),q.buffers.color.setClear(1,1,1,1),q.buffers.depth.setTest(!0),q.setScissorTest(!1);const G=v!==jp&&this.type===jp,X=v===jp&&this.type!==jp;for(let re=0,V=A.length;re<V;re++){const Z=A[re],Y=Z.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",Z,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const ee=Y.getFrameExtents();if(i.multiply(ee),s.copy(Y.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/ee.x),i.x=s.x*ee.x,Y.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/ee.y),i.y=s.y*ee.y,Y.mapSize.y=s.y)),Y.map===null||G===!0||X===!0){const de=this.type!==jp?{minFilter:Ja,magFilter:Ja}:{};Y.map!==null&&Y.map.dispose(),Y.map=new Ul(i.x,i.y,de),Y.map.texture.name=Z.name+".shadowMap",Y.camera.updateProjectionMatrix()}t.setRenderTarget(Y.map),t.clear();const oe=Y.getViewportCount();for(let de=0;de<oe;de++){const Me=Y.getViewport(de);a.set(s.x*Me.x,s.y*Me.y,s.x*Me.z,s.y*Me.w),q.viewport(a),Y.updateMatrices(Z,de),r=Y.getFrustum(),x(I,k,Y.camera,Z,this.type)}Y.isPointLightShadow!==!0&&this.type===jp&&E(Y,k),Y.needsUpdate=!1}v=this.type,_.needsUpdate=!1,t.setRenderTarget(L,U,$)};function E(A,I){const k=e.update(g);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,f.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Ul(i.x,i.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,t.setRenderTarget(A.mapPass),t.clear(),t.renderBufferDirect(I,null,k,d,g,null),f.uniforms.shadow_pass.value=A.mapPass.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,t.setRenderTarget(A.map),t.clear(),t.renderBufferDirect(I,null,k,f,g,null)}function T(A,I,k,L){let U=null;const $=k.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if($!==void 0)U=$;else if(U=k.isPointLight===!0?c:o,t.localClippingEnabled&&I.clipShadows===!0&&Array.isArray(I.clippingPlanes)&&I.clippingPlanes.length!==0||I.displacementMap&&I.displacementScale!==0||I.alphaMap&&I.alphaTest>0||I.map&&I.alphaTest>0||I.alphaToCoverage===!0){const q=U.uuid,G=I.uuid;let X=l[q];X===void 0&&(X={},l[q]=X);let re=X[G];re===void 0&&(re=U.clone(),X[G]=re,I.addEventListener("dispose",N)),U=re}if(U.visible=I.visible,U.wireframe=I.wireframe,L===jp?U.side=I.shadowSide!==null?I.shadowSide:I.side:U.side=I.shadowSide!==null?I.shadowSide:h[I.side],U.alphaMap=I.alphaMap,U.alphaTest=I.alphaToCoverage===!0?.5:I.alphaTest,U.map=I.map,U.clipShadows=I.clipShadows,U.clippingPlanes=I.clippingPlanes,U.clipIntersection=I.clipIntersection,U.displacementMap=I.displacementMap,U.displacementScale=I.displacementScale,U.displacementBias=I.displacementBias,U.wireframeLinewidth=I.wireframeLinewidth,U.linewidth=I.linewidth,k.isPointLight===!0&&U.isMeshDistanceMaterial===!0){const q=t.properties.get(U);q.light=k}return U}function x(A,I,k,L,U){if(A.visible===!1)return;if(A.layers.test(I.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&U===jp)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,A.matrixWorld);const G=e.update(A),X=A.material;if(Array.isArray(X)){const re=G.groups;for(let V=0,Z=re.length;V<Z;V++){const Y=re[V],ee=X[Y.materialIndex];if(ee&&ee.visible){const oe=T(A,ee,L,U);A.onBeforeShadow(t,A,I,k,G,oe,Y),t.renderBufferDirect(k,null,G,oe,A,Y),A.onAfterShadow(t,A,I,k,G,oe,Y)}}}else if(X.visible){const re=T(A,X,L,U);A.onBeforeShadow(t,A,I,k,G,re,null),t.renderBufferDirect(k,null,G,re,A,null),A.onAfterShadow(t,A,I,k,G,re,null)}}const q=A.children;for(let G=0,X=q.length;G<X;G++)x(q[G],I,k,L,U)}function N(A){A.target.removeEventListener("dispose",N);for(const k in l){const L=l[k],U=A.target.uuid;U in L&&(L[U].dispose(),delete L[U])}}}const oMe={[JP]:ZP,[QP]:nL,[eL]:rL,[nT]:tL,[ZP]:JP,[nL]:QP,[rL]:eL,[tL]:nT};function cMe(t,e){function n(){let qe=!1;const Vt=new Ki;let ht=null;const Pt=new Ki(0,0,0,0);return{setMask:function(hn){ht!==hn&&!qe&&(t.colorMask(hn,hn,hn,hn),ht=hn)},setLocked:function(hn){qe=hn},setClear:function(hn,an,Ve,ot,Ct){Ct===!0&&(hn*=ot,an*=ot,Ve*=ot),Vt.set(hn,an,Ve,ot),Pt.equals(Vt)===!1&&(t.clearColor(hn,an,Ve,ot),Pt.copy(Vt))},reset:function(){qe=!1,ht=null,Pt.set(-1,0,0,0)}}}function r(){let qe=!1,Vt=!1,ht=null,Pt=null,hn=null;return{setReversed:function(an){if(Vt!==an){const Ve=e.get("EXT_clip_control");an?Ve.clipControlEXT(Ve.LOWER_LEFT_EXT,Ve.ZERO_TO_ONE_EXT):Ve.clipControlEXT(Ve.LOWER_LEFT_EXT,Ve.NEGATIVE_ONE_TO_ONE_EXT),Vt=an;const ot=hn;hn=null,this.setClear(ot)}},getReversed:function(){return Vt},setTest:function(an){an?Ce(t.DEPTH_TEST):ke(t.DEPTH_TEST)},setMask:function(an){ht!==an&&!qe&&(t.depthMask(an),ht=an)},setFunc:function(an){if(Vt&&(an=oMe[an]),Pt!==an){switch(an){case JP:t.depthFunc(t.NEVER);break;case ZP:t.depthFunc(t.ALWAYS);break;case QP:t.depthFunc(t.LESS);break;case nT:t.depthFunc(t.LEQUAL);break;case eL:t.depthFunc(t.EQUAL);break;case tL:t.depthFunc(t.GEQUAL);break;case nL:t.depthFunc(t.GREATER);break;case rL:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Pt=an}},setLocked:function(an){qe=an},setClear:function(an){hn!==an&&(Vt&&(an=1-an),t.clearDepth(an),hn=an)},reset:function(){qe=!1,ht=null,Pt=null,hn=null,Vt=!1}}}function i(){let qe=!1,Vt=null,ht=null,Pt=null,hn=null,an=null,Ve=null,ot=null,Ct=null;return{setTest:function(Nt){qe||(Nt?Ce(t.STENCIL_TEST):ke(t.STENCIL_TEST))},setMask:function(Nt){Vt!==Nt&&!qe&&(t.stencilMask(Nt),Vt=Nt)},setFunc:function(Nt,Yn,si){(ht!==Nt||Pt!==Yn||hn!==si)&&(t.stencilFunc(Nt,Yn,si),ht=Nt,Pt=Yn,hn=si)},setOp:function(Nt,Yn,si){(an!==Nt||Ve!==Yn||ot!==si)&&(t.stencilOp(Nt,Yn,si),an=Nt,Ve=Yn,ot=si)},setLocked:function(Nt){qe=Nt},setClear:function(Nt){Ct!==Nt&&(t.clearStencil(Nt),Ct=Nt)},reset:function(){qe=!1,Vt=null,ht=null,Pt=null,hn=null,an=null,Ve=null,ot=null,Ct=null}}}const s=new n,a=new r,o=new i,c=new WeakMap,l=new WeakMap;let u={},h={},d=new WeakMap,f=[],p=null,g=!1,_=null,v=null,E=null,T=null,x=null,N=null,A=null,I=new _n(0,0,0),k=0,L=!1,U=null,$=null,q=null,G=null,X=null;const re=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let V=!1,Z=0;const Y=t.getParameter(t.VERSION);Y.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(Y)[1]),V=Z>=1):Y.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),V=Z>=2);let ee=null,oe={};const de=t.getParameter(t.SCISSOR_BOX),Me=t.getParameter(t.VIEWPORT),He=new Ki().fromArray(de),Te=new Ki().fromArray(Me);function Le(qe,Vt,ht,Pt){const hn=new Uint8Array(4),an=t.createTexture();t.bindTexture(qe,an),t.texParameteri(qe,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(qe,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Ve=0;Ve<ht;Ve++)qe===t.TEXTURE_3D||qe===t.TEXTURE_2D_ARRAY?t.texImage3D(Vt,0,t.RGBA,1,1,Pt,0,t.RGBA,t.UNSIGNED_BYTE,hn):t.texImage2D(Vt+Ve,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,hn);return an}const we={};we[t.TEXTURE_2D]=Le(t.TEXTURE_2D,t.TEXTURE_2D,1),we[t.TEXTURE_CUBE_MAP]=Le(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),we[t.TEXTURE_2D_ARRAY]=Le(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),we[t.TEXTURE_3D]=Le(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),Ce(t.DEPTH_TEST),a.setFunc(nT),Ie(!1),rt(Ij),Ce(t.CULL_FACE),fe(Zf);function Ce(qe){u[qe]!==!0&&(t.enable(qe),u[qe]=!0)}function ke(qe){u[qe]!==!1&&(t.disable(qe),u[qe]=!1)}function St(qe,Vt){return h[qe]!==Vt?(t.bindFramebuffer(qe,Vt),h[qe]=Vt,qe===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=Vt),qe===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=Vt),!0):!1}function At(qe,Vt){let ht=f,Pt=!1;if(qe){ht=d.get(Vt),ht===void 0&&(ht=[],d.set(Vt,ht));const hn=qe.textures;if(ht.length!==hn.length||ht[0]!==t.COLOR_ATTACHMENT0){for(let an=0,Ve=hn.length;an<Ve;an++)ht[an]=t.COLOR_ATTACHMENT0+an;ht.length=hn.length,Pt=!0}}else ht[0]!==t.BACK&&(ht[0]=t.BACK,Pt=!0);Pt&&t.drawBuffers(ht)}function Ee(qe){return p!==qe?(t.useProgram(qe),p=qe,!0):!1}const ye={[B_]:t.FUNC_ADD,[ase]:t.FUNC_SUBTRACT,[ose]:t.FUNC_REVERSE_SUBTRACT};ye[cse]=t.MIN,ye[lse]=t.MAX;const et={[use]:t.ZERO,[hse]:t.ONE,[dse]:t.SRC_COLOR,[XP]:t.SRC_ALPHA,[yse]:t.SRC_ALPHA_SATURATE,[gse]:t.DST_COLOR,[pse]:t.DST_ALPHA,[fse]:t.ONE_MINUS_SRC_COLOR,[KP]:t.ONE_MINUS_SRC_ALPHA,[vse]:t.ONE_MINUS_DST_COLOR,[mse]:t.ONE_MINUS_DST_ALPHA,[_se]:t.CONSTANT_COLOR,[bse]:t.ONE_MINUS_CONSTANT_COLOR,[Ese]:t.CONSTANT_ALPHA,[Sse]:t.ONE_MINUS_CONSTANT_ALPHA};function fe(qe,Vt,ht,Pt,hn,an,Ve,ot,Ct,Nt){if(qe===Zf){g===!0&&(ke(t.BLEND),g=!1);return}if(g===!1&&(Ce(t.BLEND),g=!0),qe!==sse){if(qe!==_||Nt!==L){if((v!==B_||x!==B_)&&(t.blendEquation(t.FUNC_ADD),v=B_,x=B_),Nt)switch(qe){case FS:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case kj:t.blendFunc(t.ONE,t.ONE);break;case Dj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Pj:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",qe);break}else switch(qe){case FS:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case kj:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case Dj:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Pj:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",qe);break}E=null,T=null,N=null,A=null,I.set(0,0,0),k=0,_=qe,L=Nt}return}hn=hn||Vt,an=an||ht,Ve=Ve||Pt,(Vt!==v||hn!==x)&&(t.blendEquationSeparate(ye[Vt],ye[hn]),v=Vt,x=hn),(ht!==E||Pt!==T||an!==N||Ve!==A)&&(t.blendFuncSeparate(et[ht],et[Pt],et[an],et[Ve]),E=ht,T=Pt,N=an,A=Ve),(ot.equals(I)===!1||Ct!==k)&&(t.blendColor(ot.r,ot.g,ot.b,Ct),I.copy(ot),k=Ct),_=qe,L=!1}function Fe(qe,Vt){qe.side===ll?ke(t.CULL_FACE):Ce(t.CULL_FACE);let ht=qe.side===Pc;Vt&&(ht=!ht),Ie(ht),qe.blending===FS&&qe.transparent===!1?fe(Zf):fe(qe.blending,qe.blendEquation,qe.blendSrc,qe.blendDst,qe.blendEquationAlpha,qe.blendSrcAlpha,qe.blendDstAlpha,qe.blendColor,qe.blendAlpha,qe.premultipliedAlpha),a.setFunc(qe.depthFunc),a.setTest(qe.depthTest),a.setMask(qe.depthWrite),s.setMask(qe.colorWrite);const Pt=qe.stencilWrite;o.setTest(Pt),Pt&&(o.setMask(qe.stencilWriteMask),o.setFunc(qe.stencilFunc,qe.stencilRef,qe.stencilFuncMask),o.setOp(qe.stencilFail,qe.stencilZFail,qe.stencilZPass)),gt(qe.polygonOffset,qe.polygonOffsetFactor,qe.polygonOffsetUnits),qe.alphaToCoverage===!0?Ce(t.SAMPLE_ALPHA_TO_COVERAGE):ke(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ie(qe){U!==qe&&(qe?t.frontFace(t.CW):t.frontFace(t.CCW),U=qe)}function rt(qe){qe!==nse?(Ce(t.CULL_FACE),qe!==$&&(qe===Ij?t.cullFace(t.BACK):qe===rse?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):ke(t.CULL_FACE),$=qe}function dt(qe){qe!==q&&(V&&t.lineWidth(qe),q=qe)}function gt(qe,Vt,ht){qe?(Ce(t.POLYGON_OFFSET_FILL),(G!==Vt||X!==ht)&&(t.polygonOffset(Vt,ht),G=Vt,X=ht)):ke(t.POLYGON_OFFSET_FILL)}function bt(qe){qe?Ce(t.SCISSOR_TEST):ke(t.SCISSOR_TEST)}function be(qe){qe===void 0&&(qe=t.TEXTURE0+re-1),ee!==qe&&(t.activeTexture(qe),ee=qe)}function ue(qe,Vt,ht){ht===void 0&&(ee===null?ht=t.TEXTURE0+re-1:ht=ee);let Pt=oe[ht];Pt===void 0&&(Pt={type:void 0,texture:void 0},oe[ht]=Pt),(Pt.type!==qe||Pt.texture!==Vt)&&(ee!==ht&&(t.activeTexture(ht),ee=ht),t.bindTexture(qe,Vt||we[qe]),Pt.type=qe,Pt.texture=Vt)}function Xe(){const qe=oe[ee];qe!==void 0&&qe.type!==void 0&&(t.bindTexture(qe.type,null),qe.type=void 0,qe.texture=void 0)}function nt(){try{t.compressedTexImage2D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function $e(){try{t.compressedTexImage3D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function Ue(){try{t.texSubImage2D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function qt(){try{t.texSubImage3D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function Mt(){try{t.compressedTexSubImage2D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function Yt(){try{t.compressedTexSubImage3D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function ce(){try{t.texStorage2D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function j(){try{t.texStorage3D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function W(){try{t.texImage2D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function me(){try{t.texImage3D(...arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}}function De(qe){He.equals(qe)===!1&&(t.scissor(qe.x,qe.y,qe.z,qe.w),He.copy(qe))}function je(qe){Te.equals(qe)===!1&&(t.viewport(qe.x,qe.y,qe.z,qe.w),Te.copy(qe))}function mt(qe,Vt){let ht=l.get(Vt);ht===void 0&&(ht=new WeakMap,l.set(Vt,ht));let Pt=ht.get(qe);Pt===void 0&&(Pt=t.getUniformBlockIndex(Vt,qe.name),ht.set(qe,Pt))}function xt(qe,Vt){const Pt=l.get(Vt).get(qe);c.get(Vt)!==Pt&&(t.uniformBlockBinding(Vt,Pt,qe.__bindingPointIndex),c.set(Vt,Pt))}function Vn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),a.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},ee=null,oe={},h={},d=new WeakMap,f=[],p=null,g=!1,_=null,v=null,E=null,T=null,x=null,N=null,A=null,I=new _n(0,0,0),k=0,L=!1,U=null,$=null,q=null,G=null,X=null,He.set(0,0,t.canvas.width,t.canvas.height),Te.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:Ce,disable:ke,bindFramebuffer:St,drawBuffers:At,useProgram:Ee,setBlending:fe,setMaterial:Fe,setFlipSided:Ie,setCullFace:rt,setLineWidth:dt,setPolygonOffset:gt,setScissorTest:bt,activeTexture:be,bindTexture:ue,unbindTexture:Xe,compressedTexImage2D:nt,compressedTexImage3D:$e,texImage2D:W,texImage3D:me,updateUBOMapping:mt,uniformBlockBinding:xt,texStorage2D:ce,texStorage3D:j,texSubImage2D:Ue,texSubImage3D:qt,compressedTexSubImage2D:Mt,compressedTexSubImage3D:Yt,scissor:De,viewport:je,reset:Vn}}function lMe(t,e,n,r,i,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Rt,u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(be,ue){return f?new OffscreenCanvas(be,ue):CM("canvas")}function g(be,ue,Xe){let nt=1;const $e=bt(be);if(($e.width>Xe||$e.height>Xe)&&(nt=Xe/Math.max($e.width,$e.height)),nt<1)if(typeof HTMLImageElement<"u"&&be instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&be instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&be instanceof ImageBitmap||typeof VideoFrame<"u"&&be instanceof VideoFrame){const Ue=Math.floor(nt*$e.width),qt=Math.floor(nt*$e.height);h===void 0&&(h=p(Ue,qt));const Mt=ue?p(Ue,qt):h;return Mt.width=Ue,Mt.height=qt,Mt.getContext("2d").drawImage(be,0,0,Ue,qt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$e.width+"x"+$e.height+") to ("+Ue+"x"+qt+")."),Mt}else return"data"in be&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$e.width+"x"+$e.height+")."),be;return be}function _(be){return be.generateMipmaps}function v(be){t.generateMipmap(be)}function E(be){return be.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:be.isWebGL3DRenderTarget?t.TEXTURE_3D:be.isWebGLArrayRenderTarget||be.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function T(be,ue,Xe,nt,$e=!1){if(be!==null){if(t[be]!==void 0)return t[be];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+be+"'")}let Ue=ue;if(ue===t.RED&&(Xe===t.FLOAT&&(Ue=t.R32F),Xe===t.HALF_FLOAT&&(Ue=t.R16F),Xe===t.UNSIGNED_BYTE&&(Ue=t.R8)),ue===t.RED_INTEGER&&(Xe===t.UNSIGNED_BYTE&&(Ue=t.R8UI),Xe===t.UNSIGNED_SHORT&&(Ue=t.R16UI),Xe===t.UNSIGNED_INT&&(Ue=t.R32UI),Xe===t.BYTE&&(Ue=t.R8I),Xe===t.SHORT&&(Ue=t.R16I),Xe===t.INT&&(Ue=t.R32I)),ue===t.RG&&(Xe===t.FLOAT&&(Ue=t.RG32F),Xe===t.HALF_FLOAT&&(Ue=t.RG16F),Xe===t.UNSIGNED_BYTE&&(Ue=t.RG8)),ue===t.RG_INTEGER&&(Xe===t.UNSIGNED_BYTE&&(Ue=t.RG8UI),Xe===t.UNSIGNED_SHORT&&(Ue=t.RG16UI),Xe===t.UNSIGNED_INT&&(Ue=t.RG32UI),Xe===t.BYTE&&(Ue=t.RG8I),Xe===t.SHORT&&(Ue=t.RG16I),Xe===t.INT&&(Ue=t.RG32I)),ue===t.RGB_INTEGER&&(Xe===t.UNSIGNED_BYTE&&(Ue=t.RGB8UI),Xe===t.UNSIGNED_SHORT&&(Ue=t.RGB16UI),Xe===t.UNSIGNED_INT&&(Ue=t.RGB32UI),Xe===t.BYTE&&(Ue=t.RGB8I),Xe===t.SHORT&&(Ue=t.RGB16I),Xe===t.INT&&(Ue=t.RGB32I)),ue===t.RGBA_INTEGER&&(Xe===t.UNSIGNED_BYTE&&(Ue=t.RGBA8UI),Xe===t.UNSIGNED_SHORT&&(Ue=t.RGBA16UI),Xe===t.UNSIGNED_INT&&(Ue=t.RGBA32UI),Xe===t.BYTE&&(Ue=t.RGBA8I),Xe===t.SHORT&&(Ue=t.RGBA16I),Xe===t.INT&&(Ue=t.RGBA32I)),ue===t.RGB&&Xe===t.UNSIGNED_INT_5_9_9_9_REV&&(Ue=t.RGB9_E5),ue===t.RGBA){const qt=$e?TM:Li.getTransfer(nt);Xe===t.FLOAT&&(Ue=t.RGBA32F),Xe===t.HALF_FLOAT&&(Ue=t.RGBA16F),Xe===t.UNSIGNED_BYTE&&(Ue=qt===ws?t.SRGB8_ALPHA8:t.RGBA8),Xe===t.UNSIGNED_SHORT_4_4_4_4&&(Ue=t.RGBA4),Xe===t.UNSIGNED_SHORT_5_5_5_1&&(Ue=t.RGB5_A1)}return(Ue===t.R16F||Ue===t.R32F||Ue===t.RG16F||Ue===t.RG32F||Ue===t.RGBA16F||Ue===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Ue}function x(be,ue){let Xe;return be?ue===null||ue===Ug||ue===rT?Xe=t.DEPTH24_STENCIL8:ue===ru?Xe=t.DEPTH32F_STENCIL8:ue===Lw&&(Xe=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ue===null||ue===Ug||ue===rT?Xe=t.DEPTH_COMPONENT24:ue===ru?Xe=t.DEPTH_COMPONENT32F:ue===Lw&&(Xe=t.DEPTH_COMPONENT16),Xe}function N(be,ue){return _(be)===!0||be.isFramebufferTexture&&be.minFilter!==Ja&&be.minFilter!==_a?Math.log2(Math.max(ue.width,ue.height))+1:be.mipmaps!==void 0&&be.mipmaps.length>0?be.mipmaps.length:be.isCompressedTexture&&Array.isArray(be.image)?ue.mipmaps.length:1}function A(be){const ue=be.target;ue.removeEventListener("dispose",A),k(ue),ue.isVideoTexture&&u.delete(ue)}function I(be){const ue=be.target;ue.removeEventListener("dispose",I),U(ue)}function k(be){const ue=r.get(be);if(ue.__webglInit===void 0)return;const Xe=be.source,nt=d.get(Xe);if(nt){const $e=nt[ue.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&L(be),Object.keys(nt).length===0&&d.delete(Xe)}r.remove(be)}function L(be){const ue=r.get(be);t.deleteTexture(ue.__webglTexture);const Xe=be.source,nt=d.get(Xe);delete nt[ue.__cacheKey],a.memory.textures--}function U(be){const ue=r.get(be);if(be.depthTexture&&(be.depthTexture.dispose(),r.remove(be.depthTexture)),be.isWebGLCubeRenderTarget)for(let nt=0;nt<6;nt++){if(Array.isArray(ue.__webglFramebuffer[nt]))for(let $e=0;$e<ue.__webglFramebuffer[nt].length;$e++)t.deleteFramebuffer(ue.__webglFramebuffer[nt][$e]);else t.deleteFramebuffer(ue.__webglFramebuffer[nt]);ue.__webglDepthbuffer&&t.deleteRenderbuffer(ue.__webglDepthbuffer[nt])}else{if(Array.isArray(ue.__webglFramebuffer))for(let nt=0;nt<ue.__webglFramebuffer.length;nt++)t.deleteFramebuffer(ue.__webglFramebuffer[nt]);else t.deleteFramebuffer(ue.__webglFramebuffer);if(ue.__webglDepthbuffer&&t.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&t.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer)for(let nt=0;nt<ue.__webglColorRenderbuffer.length;nt++)ue.__webglColorRenderbuffer[nt]&&t.deleteRenderbuffer(ue.__webglColorRenderbuffer[nt]);ue.__webglDepthRenderbuffer&&t.deleteRenderbuffer(ue.__webglDepthRenderbuffer)}const Xe=be.textures;for(let nt=0,$e=Xe.length;nt<$e;nt++){const Ue=r.get(Xe[nt]);Ue.__webglTexture&&(t.deleteTexture(Ue.__webglTexture),a.memory.textures--),r.remove(Xe[nt])}r.remove(be)}let $=0;function q(){$=0}function G(){const be=$;return be>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+be+" texture units while this GPU supports only "+i.maxTextures),$+=1,be}function X(be){const ue=[];return ue.push(be.wrapS),ue.push(be.wrapT),ue.push(be.wrapR||0),ue.push(be.magFilter),ue.push(be.minFilter),ue.push(be.anisotropy),ue.push(be.internalFormat),ue.push(be.format),ue.push(be.type),ue.push(be.generateMipmaps),ue.push(be.premultiplyAlpha),ue.push(be.flipY),ue.push(be.unpackAlignment),ue.push(be.colorSpace),ue.join()}function re(be,ue){const Xe=r.get(be);if(be.isVideoTexture&&dt(be),be.isRenderTargetTexture===!1&&be.version>0&&Xe.__version!==be.version){const nt=be.image;if(nt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(nt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Te(Xe,be,ue);return}}n.bindTexture(t.TEXTURE_2D,Xe.__webglTexture,t.TEXTURE0+ue)}function V(be,ue){const Xe=r.get(be);if(be.version>0&&Xe.__version!==be.version){Te(Xe,be,ue);return}n.bindTexture(t.TEXTURE_2D_ARRAY,Xe.__webglTexture,t.TEXTURE0+ue)}function Z(be,ue){const Xe=r.get(be);if(be.version>0&&Xe.__version!==be.version){Te(Xe,be,ue);return}n.bindTexture(t.TEXTURE_3D,Xe.__webglTexture,t.TEXTURE0+ue)}function Y(be,ue){const Xe=r.get(be);if(be.version>0&&Xe.__version!==be.version){Le(Xe,be,ue);return}n.bindTexture(t.TEXTURE_CUBE_MAP,Xe.__webglTexture,t.TEXTURE0+ue)}const ee={[_M]:t.REPEAT,[qf]:t.CLAMP_TO_EDGE,[bM]:t.MIRRORED_REPEAT},oe={[Ja]:t.NEAREST,[pq]:t.NEAREST_MIPMAP_NEAREST,[N1]:t.NEAREST_MIPMAP_LINEAR,[_a]:t.LINEAR,[MA]:t.LINEAR_MIPMAP_NEAREST,[_g]:t.LINEAR_MIPMAP_LINEAR},de={[Use]:t.NEVER,[Vse]:t.ALWAYS,[Bse]:t.LESS,[Tq]:t.LEQUAL,[Fse]:t.EQUAL,[jse]:t.GEQUAL,[zse]:t.GREATER,[Hse]:t.NOTEQUAL};function Me(be,ue){if(ue.type===ru&&e.has("OES_texture_float_linear")===!1&&(ue.magFilter===_a||ue.magFilter===MA||ue.magFilter===N1||ue.magFilter===_g||ue.minFilter===_a||ue.minFilter===MA||ue.minFilter===N1||ue.minFilter===_g)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(be,t.TEXTURE_WRAP_S,ee[ue.wrapS]),t.texParameteri(be,t.TEXTURE_WRAP_T,ee[ue.wrapT]),(be===t.TEXTURE_3D||be===t.TEXTURE_2D_ARRAY)&&t.texParameteri(be,t.TEXTURE_WRAP_R,ee[ue.wrapR]),t.texParameteri(be,t.TEXTURE_MAG_FILTER,oe[ue.magFilter]),t.texParameteri(be,t.TEXTURE_MIN_FILTER,oe[ue.minFilter]),ue.compareFunction&&(t.texParameteri(be,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(be,t.TEXTURE_COMPARE_FUNC,de[ue.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ue.magFilter===Ja||ue.minFilter!==N1&&ue.minFilter!==_g||ue.type===ru&&e.has("OES_texture_float_linear")===!1)return;if(ue.anisotropy>1||r.get(ue).__currentAnisotropy){const Xe=e.get("EXT_texture_filter_anisotropic");t.texParameterf(be,Xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ue.anisotropy,i.getMaxAnisotropy())),r.get(ue).__currentAnisotropy=ue.anisotropy}}}function He(be,ue){let Xe=!1;be.__webglInit===void 0&&(be.__webglInit=!0,ue.addEventListener("dispose",A));const nt=ue.source;let $e=d.get(nt);$e===void 0&&($e={},d.set(nt,$e));const Ue=X(ue);if(Ue!==be.__cacheKey){$e[Ue]===void 0&&($e[Ue]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,Xe=!0),$e[Ue].usedTimes++;const qt=$e[be.__cacheKey];qt!==void 0&&($e[be.__cacheKey].usedTimes--,qt.usedTimes===0&&L(ue)),be.__cacheKey=Ue,be.__webglTexture=$e[Ue].texture}return Xe}function Te(be,ue,Xe){let nt=t.TEXTURE_2D;(ue.isDataArrayTexture||ue.isCompressedArrayTexture)&&(nt=t.TEXTURE_2D_ARRAY),ue.isData3DTexture&&(nt=t.TEXTURE_3D);const $e=He(be,ue),Ue=ue.source;n.bindTexture(nt,be.__webglTexture,t.TEXTURE0+Xe);const qt=r.get(Ue);if(Ue.version!==qt.__version||$e===!0){n.activeTexture(t.TEXTURE0+Xe);const Mt=Li.getPrimaries(Li.workingColorSpace),Yt=ue.colorSpace===Kp?null:Li.getPrimaries(ue.colorSpace),ce=ue.colorSpace===Kp||Mt===Yt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,ce);let j=g(ue.image,!1,i.maxTextureSize);j=gt(ue,j);const W=s.convert(ue.format,ue.colorSpace),me=s.convert(ue.type);let De=T(ue.internalFormat,W,me,ue.colorSpace,ue.isVideoTexture);Me(nt,ue);let je;const mt=ue.mipmaps,xt=ue.isVideoTexture!==!0,Vn=qt.__version===void 0||$e===!0,qe=Ue.dataReady,Vt=N(ue,j);if(ue.isDepthTexture)De=x(ue.format===iT,ue.type),Vn&&(xt?n.texStorage2D(t.TEXTURE_2D,1,De,j.width,j.height):n.texImage2D(t.TEXTURE_2D,0,De,j.width,j.height,0,W,me,null));else if(ue.isDataTexture)if(mt.length>0){xt&&Vn&&n.texStorage2D(t.TEXTURE_2D,Vt,De,mt[0].width,mt[0].height);for(let ht=0,Pt=mt.length;ht<Pt;ht++)je=mt[ht],xt?qe&&n.texSubImage2D(t.TEXTURE_2D,ht,0,0,je.width,je.height,W,me,je.data):n.texImage2D(t.TEXTURE_2D,ht,De,je.width,je.height,0,W,me,je.data);ue.generateMipmaps=!1}else xt?(Vn&&n.texStorage2D(t.TEXTURE_2D,Vt,De,j.width,j.height),qe&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,j.width,j.height,W,me,j.data)):n.texImage2D(t.TEXTURE_2D,0,De,j.width,j.height,0,W,me,j.data);else if(ue.isCompressedTexture)if(ue.isCompressedArrayTexture){xt&&Vn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Vt,De,mt[0].width,mt[0].height,j.depth);for(let ht=0,Pt=mt.length;ht<Pt;ht++)if(je=mt[ht],ue.format!==iu)if(W!==null)if(xt){if(qe)if(ue.layerUpdates.size>0){const hn=qj(je.width,je.height,ue.format,ue.type);for(const an of ue.layerUpdates){const Ve=je.data.subarray(an*hn/je.data.BYTES_PER_ELEMENT,(an+1)*hn/je.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ht,0,0,an,je.width,je.height,1,W,Ve)}ue.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ht,0,0,0,je.width,je.height,j.depth,W,je.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,ht,De,je.width,je.height,j.depth,0,je.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else xt?qe&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,ht,0,0,0,je.width,je.height,j.depth,W,me,je.data):n.texImage3D(t.TEXTURE_2D_ARRAY,ht,De,je.width,je.height,j.depth,0,W,me,je.data)}else{xt&&Vn&&n.texStorage2D(t.TEXTURE_2D,Vt,De,mt[0].width,mt[0].height);for(let ht=0,Pt=mt.length;ht<Pt;ht++)je=mt[ht],ue.format!==iu?W!==null?xt?qe&&n.compressedTexSubImage2D(t.TEXTURE_2D,ht,0,0,je.width,je.height,W,je.data):n.compressedTexImage2D(t.TEXTURE_2D,ht,De,je.width,je.height,0,je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):xt?qe&&n.texSubImage2D(t.TEXTURE_2D,ht,0,0,je.width,je.height,W,me,je.data):n.texImage2D(t.TEXTURE_2D,ht,De,je.width,je.height,0,W,me,je.data)}else if(ue.isDataArrayTexture)if(xt){if(Vn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Vt,De,j.width,j.height,j.depth),qe)if(ue.layerUpdates.size>0){const ht=qj(j.width,j.height,ue.format,ue.type);for(const Pt of ue.layerUpdates){const hn=j.data.subarray(Pt*ht/j.data.BYTES_PER_ELEMENT,(Pt+1)*ht/j.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Pt,j.width,j.height,1,W,me,hn)}ue.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,W,me,j.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,De,j.width,j.height,j.depth,0,W,me,j.data);else if(ue.isData3DTexture)xt?(Vn&&n.texStorage3D(t.TEXTURE_3D,Vt,De,j.width,j.height,j.depth),qe&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,W,me,j.data)):n.texImage3D(t.TEXTURE_3D,0,De,j.width,j.height,j.depth,0,W,me,j.data);else if(ue.isFramebufferTexture){if(Vn)if(xt)n.texStorage2D(t.TEXTURE_2D,Vt,De,j.width,j.height);else{let ht=j.width,Pt=j.height;for(let hn=0;hn<Vt;hn++)n.texImage2D(t.TEXTURE_2D,hn,De,ht,Pt,0,W,me,null),ht>>=1,Pt>>=1}}else if(mt.length>0){if(xt&&Vn){const ht=bt(mt[0]);n.texStorage2D(t.TEXTURE_2D,Vt,De,ht.width,ht.height)}for(let ht=0,Pt=mt.length;ht<Pt;ht++)je=mt[ht],xt?qe&&n.texSubImage2D(t.TEXTURE_2D,ht,0,0,W,me,je):n.texImage2D(t.TEXTURE_2D,ht,De,W,me,je);ue.generateMipmaps=!1}else if(xt){if(Vn){const ht=bt(j);n.texStorage2D(t.TEXTURE_2D,Vt,De,ht.width,ht.height)}qe&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,W,me,j)}else n.texImage2D(t.TEXTURE_2D,0,De,W,me,j);_(ue)&&v(nt),qt.__version=Ue.version,ue.onUpdate&&ue.onUpdate(ue)}be.__version=ue.version}function Le(be,ue,Xe){if(ue.image.length!==6)return;const nt=He(be,ue),$e=ue.source;n.bindTexture(t.TEXTURE_CUBE_MAP,be.__webglTexture,t.TEXTURE0+Xe);const Ue=r.get($e);if($e.version!==Ue.__version||nt===!0){n.activeTexture(t.TEXTURE0+Xe);const qt=Li.getPrimaries(Li.workingColorSpace),Mt=ue.colorSpace===Kp?null:Li.getPrimaries(ue.colorSpace),Yt=ue.colorSpace===Kp||qt===Mt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,ue.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,ue.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Yt);const ce=ue.isCompressedTexture||ue.image[0].isCompressedTexture,j=ue.image[0]&&ue.image[0].isDataTexture,W=[];for(let Pt=0;Pt<6;Pt++)!ce&&!j?W[Pt]=g(ue.image[Pt],!0,i.maxCubemapSize):W[Pt]=j?ue.image[Pt].image:ue.image[Pt],W[Pt]=gt(ue,W[Pt]);const me=W[0],De=s.convert(ue.format,ue.colorSpace),je=s.convert(ue.type),mt=T(ue.internalFormat,De,je,ue.colorSpace),xt=ue.isVideoTexture!==!0,Vn=Ue.__version===void 0||nt===!0,qe=$e.dataReady;let Vt=N(ue,me);Me(t.TEXTURE_CUBE_MAP,ue);let ht;if(ce){xt&&Vn&&n.texStorage2D(t.TEXTURE_CUBE_MAP,Vt,mt,me.width,me.height);for(let Pt=0;Pt<6;Pt++){ht=W[Pt].mipmaps;for(let hn=0;hn<ht.length;hn++){const an=ht[hn];ue.format!==iu?De!==null?xt?qe&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn,0,0,an.width,an.height,De,an.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn,mt,an.width,an.height,0,an.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):xt?qe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn,0,0,an.width,an.height,De,je,an.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn,mt,an.width,an.height,0,De,je,an.data)}}}else{if(ht=ue.mipmaps,xt&&Vn){ht.length>0&&Vt++;const Pt=bt(W[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,Vt,mt,Pt.width,Pt.height)}for(let Pt=0;Pt<6;Pt++)if(j){xt?qe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,0,0,0,W[Pt].width,W[Pt].height,De,je,W[Pt].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,0,mt,W[Pt].width,W[Pt].height,0,De,je,W[Pt].data);for(let hn=0;hn<ht.length;hn++){const Ve=ht[hn].image[Pt].image;xt?qe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn+1,0,0,Ve.width,Ve.height,De,je,Ve.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn+1,mt,Ve.width,Ve.height,0,De,je,Ve.data)}}else{xt?qe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,0,0,0,De,je,W[Pt]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,0,mt,De,je,W[Pt]);for(let hn=0;hn<ht.length;hn++){const an=ht[hn];xt?qe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn+1,0,0,De,je,an.image[Pt]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Pt,hn+1,mt,De,je,an.image[Pt])}}}_(ue)&&v(t.TEXTURE_CUBE_MAP),Ue.__version=$e.version,ue.onUpdate&&ue.onUpdate(ue)}be.__version=ue.version}function we(be,ue,Xe,nt,$e,Ue){const qt=s.convert(Xe.format,Xe.colorSpace),Mt=s.convert(Xe.type),Yt=T(Xe.internalFormat,qt,Mt,Xe.colorSpace),ce=r.get(ue),j=r.get(Xe);if(j.__renderTarget=ue,!ce.__hasExternalTextures){const W=Math.max(1,ue.width>>Ue),me=Math.max(1,ue.height>>Ue);$e===t.TEXTURE_3D||$e===t.TEXTURE_2D_ARRAY?n.texImage3D($e,Ue,Yt,W,me,ue.depth,0,qt,Mt,null):n.texImage2D($e,Ue,Yt,W,me,0,qt,Mt,null)}n.bindFramebuffer(t.FRAMEBUFFER,be),rt(ue)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,nt,$e,j.__webglTexture,0,Ie(ue)):($e===t.TEXTURE_2D||$e>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,nt,$e,j.__webglTexture,Ue),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Ce(be,ue,Xe){if(t.bindRenderbuffer(t.RENDERBUFFER,be),ue.depthBuffer){const nt=ue.depthTexture,$e=nt&&nt.isDepthTexture?nt.type:null,Ue=x(ue.stencilBuffer,$e),qt=ue.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Mt=Ie(ue);rt(ue)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Mt,Ue,ue.width,ue.height):Xe?t.renderbufferStorageMultisample(t.RENDERBUFFER,Mt,Ue,ue.width,ue.height):t.renderbufferStorage(t.RENDERBUFFER,Ue,ue.width,ue.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,qt,t.RENDERBUFFER,be)}else{const nt=ue.textures;for(let $e=0;$e<nt.length;$e++){const Ue=nt[$e],qt=s.convert(Ue.format,Ue.colorSpace),Mt=s.convert(Ue.type),Yt=T(Ue.internalFormat,qt,Mt,Ue.colorSpace),ce=Ie(ue);Xe&&rt(ue)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ce,Yt,ue.width,ue.height):rt(ue)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ce,Yt,ue.width,ue.height):t.renderbufferStorage(t.RENDERBUFFER,Yt,ue.width,ue.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function ke(be,ue){if(ue&&ue.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,be),!(ue.depthTexture&&ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const nt=r.get(ue.depthTexture);nt.__renderTarget=ue,(!nt.__webglTexture||ue.depthTexture.image.width!==ue.width||ue.depthTexture.image.height!==ue.height)&&(ue.depthTexture.image.width=ue.width,ue.depthTexture.image.height=ue.height,ue.depthTexture.needsUpdate=!0),re(ue.depthTexture,0);const $e=nt.__webglTexture,Ue=Ie(ue);if(ue.depthTexture.format===Uw)rt(ue)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,$e,0,Ue):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,$e,0);else if(ue.depthTexture.format===iT)rt(ue)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,$e,0,Ue):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,$e,0);else throw new Error("Unknown depthTexture format")}function St(be){const ue=r.get(be),Xe=be.isWebGLCubeRenderTarget===!0;if(ue.__boundDepthTexture!==be.depthTexture){const nt=be.depthTexture;if(ue.__depthDisposeCallback&&ue.__depthDisposeCallback(),nt){const $e=()=>{delete ue.__boundDepthTexture,delete ue.__depthDisposeCallback,nt.removeEventListener("dispose",$e)};nt.addEventListener("dispose",$e),ue.__depthDisposeCallback=$e}ue.__boundDepthTexture=nt}if(be.depthTexture&&!ue.__autoAllocateDepthBuffer){if(Xe)throw new Error("target.depthTexture not supported in Cube render targets");const nt=be.texture.mipmaps;nt&&nt.length>0?ke(ue.__webglFramebuffer[0],be):ke(ue.__webglFramebuffer,be)}else if(Xe){ue.__webglDepthbuffer=[];for(let nt=0;nt<6;nt++)if(n.bindFramebuffer(t.FRAMEBUFFER,ue.__webglFramebuffer[nt]),ue.__webglDepthbuffer[nt]===void 0)ue.__webglDepthbuffer[nt]=t.createRenderbuffer(),Ce(ue.__webglDepthbuffer[nt],be,!1);else{const $e=be.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ue=ue.__webglDepthbuffer[nt];t.bindRenderbuffer(t.RENDERBUFFER,Ue),t.framebufferRenderbuffer(t.FRAMEBUFFER,$e,t.RENDERBUFFER,Ue)}}else{const nt=be.texture.mipmaps;if(nt&&nt.length>0?n.bindFramebuffer(t.FRAMEBUFFER,ue.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,ue.__webglFramebuffer),ue.__webglDepthbuffer===void 0)ue.__webglDepthbuffer=t.createRenderbuffer(),Ce(ue.__webglDepthbuffer,be,!1);else{const $e=be.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ue=ue.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,Ue),t.framebufferRenderbuffer(t.FRAMEBUFFER,$e,t.RENDERBUFFER,Ue)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function At(be,ue,Xe){const nt=r.get(be);ue!==void 0&&we(nt.__webglFramebuffer,be,be.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),Xe!==void 0&&St(be)}function Ee(be){const ue=be.texture,Xe=r.get(be),nt=r.get(ue);be.addEventListener("dispose",I);const $e=be.textures,Ue=be.isWebGLCubeRenderTarget===!0,qt=$e.length>1;if(qt||(nt.__webglTexture===void 0&&(nt.__webglTexture=t.createTexture()),nt.__version=ue.version,a.memory.textures++),Ue){Xe.__webglFramebuffer=[];for(let Mt=0;Mt<6;Mt++)if(ue.mipmaps&&ue.mipmaps.length>0){Xe.__webglFramebuffer[Mt]=[];for(let Yt=0;Yt<ue.mipmaps.length;Yt++)Xe.__webglFramebuffer[Mt][Yt]=t.createFramebuffer()}else Xe.__webglFramebuffer[Mt]=t.createFramebuffer()}else{if(ue.mipmaps&&ue.mipmaps.length>0){Xe.__webglFramebuffer=[];for(let Mt=0;Mt<ue.mipmaps.length;Mt++)Xe.__webglFramebuffer[Mt]=t.createFramebuffer()}else Xe.__webglFramebuffer=t.createFramebuffer();if(qt)for(let Mt=0,Yt=$e.length;Mt<Yt;Mt++){const ce=r.get($e[Mt]);ce.__webglTexture===void 0&&(ce.__webglTexture=t.createTexture(),a.memory.textures++)}if(be.samples>0&&rt(be)===!1){Xe.__webglMultisampledFramebuffer=t.createFramebuffer(),Xe.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,Xe.__webglMultisampledFramebuffer);for(let Mt=0;Mt<$e.length;Mt++){const Yt=$e[Mt];Xe.__webglColorRenderbuffer[Mt]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,Xe.__webglColorRenderbuffer[Mt]);const ce=s.convert(Yt.format,Yt.colorSpace),j=s.convert(Yt.type),W=T(Yt.internalFormat,ce,j,Yt.colorSpace,be.isXRRenderTarget===!0),me=Ie(be);t.renderbufferStorageMultisample(t.RENDERBUFFER,me,W,be.width,be.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Mt,t.RENDERBUFFER,Xe.__webglColorRenderbuffer[Mt])}t.bindRenderbuffer(t.RENDERBUFFER,null),be.depthBuffer&&(Xe.__webglDepthRenderbuffer=t.createRenderbuffer(),Ce(Xe.__webglDepthRenderbuffer,be,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Ue){n.bindTexture(t.TEXTURE_CUBE_MAP,nt.__webglTexture),Me(t.TEXTURE_CUBE_MAP,ue);for(let Mt=0;Mt<6;Mt++)if(ue.mipmaps&&ue.mipmaps.length>0)for(let Yt=0;Yt<ue.mipmaps.length;Yt++)we(Xe.__webglFramebuffer[Mt][Yt],be,ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,Yt);else we(Xe.__webglFramebuffer[Mt],be,ue,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0);_(ue)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(qt){for(let Mt=0,Yt=$e.length;Mt<Yt;Mt++){const ce=$e[Mt],j=r.get(ce);n.bindTexture(t.TEXTURE_2D,j.__webglTexture),Me(t.TEXTURE_2D,ce),we(Xe.__webglFramebuffer,be,ce,t.COLOR_ATTACHMENT0+Mt,t.TEXTURE_2D,0),_(ce)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let Mt=t.TEXTURE_2D;if((be.isWebGL3DRenderTarget||be.isWebGLArrayRenderTarget)&&(Mt=be.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Mt,nt.__webglTexture),Me(Mt,ue),ue.mipmaps&&ue.mipmaps.length>0)for(let Yt=0;Yt<ue.mipmaps.length;Yt++)we(Xe.__webglFramebuffer[Yt],be,ue,t.COLOR_ATTACHMENT0,Mt,Yt);else we(Xe.__webglFramebuffer,be,ue,t.COLOR_ATTACHMENT0,Mt,0);_(ue)&&v(Mt),n.unbindTexture()}be.depthBuffer&&St(be)}function ye(be){const ue=be.textures;for(let Xe=0,nt=ue.length;Xe<nt;Xe++){const $e=ue[Xe];if(_($e)){const Ue=E(be),qt=r.get($e).__webglTexture;n.bindTexture(Ue,qt),v(Ue),n.unbindTexture()}}}const et=[],fe=[];function Fe(be){if(be.samples>0){if(rt(be)===!1){const ue=be.textures,Xe=be.width,nt=be.height;let $e=t.COLOR_BUFFER_BIT;const Ue=be.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,qt=r.get(be),Mt=ue.length>1;if(Mt)for(let ce=0;ce<ue.length;ce++)n.bindFramebuffer(t.FRAMEBUFFER,qt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ce,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,qt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ce,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,qt.__webglMultisampledFramebuffer);const Yt=be.texture.mipmaps;Yt&&Yt.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,qt.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,qt.__webglFramebuffer);for(let ce=0;ce<ue.length;ce++){if(be.resolveDepthBuffer&&(be.depthBuffer&&($e|=t.DEPTH_BUFFER_BIT),be.stencilBuffer&&be.resolveStencilBuffer&&($e|=t.STENCIL_BUFFER_BIT)),Mt){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,qt.__webglColorRenderbuffer[ce]);const j=r.get(ue[ce]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,j,0)}t.blitFramebuffer(0,0,Xe,nt,0,0,Xe,nt,$e,t.NEAREST),c===!0&&(et.length=0,fe.length=0,et.push(t.COLOR_ATTACHMENT0+ce),be.depthBuffer&&be.resolveDepthBuffer===!1&&(et.push(Ue),fe.push(Ue),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,fe)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,et))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Mt)for(let ce=0;ce<ue.length;ce++){n.bindFramebuffer(t.FRAMEBUFFER,qt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ce,t.RENDERBUFFER,qt.__webglColorRenderbuffer[ce]);const j=r.get(ue[ce]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,qt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ce,t.TEXTURE_2D,j,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,qt.__webglMultisampledFramebuffer)}else if(be.depthBuffer&&be.resolveDepthBuffer===!1&&c){const ue=be.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[ue])}}}function Ie(be){return Math.min(i.maxSamples,be.samples)}function rt(be){const ue=r.get(be);return be.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ue.__useRenderToTexture!==!1}function dt(be){const ue=a.render.frame;u.get(be)!==ue&&(u.set(be,ue),be.update())}function gt(be,ue){const Xe=be.colorSpace,nt=be.format,$e=be.type;return be.isCompressedTexture===!0||be.isVideoTexture===!0||Xe!==Bg&&Xe!==Kp&&(Li.getTransfer(Xe)===ws?(nt!==iu||$e!==gl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Xe)),ue}function bt(be){return typeof HTMLImageElement<"u"&&be instanceof HTMLImageElement?(l.width=be.naturalWidth||be.width,l.height=be.naturalHeight||be.height):typeof VideoFrame<"u"&&be instanceof VideoFrame?(l.width=be.displayWidth,l.height=be.displayHeight):(l.width=be.width,l.height=be.height),l}this.allocateTextureUnit=G,this.resetTextureUnits=q,this.setTexture2D=re,this.setTexture2DArray=V,this.setTexture3D=Z,this.setTextureCube=Y,this.rebindTextures=At,this.setupRenderTarget=Ee,this.updateRenderTargetMipmap=ye,this.updateMultisampleRenderTarget=Fe,this.setupDepthRenderbuffer=St,this.setupFrameBufferTexture=we,this.useMultisampledRTT=rt}function toe(t,e){function n(r,i=Kp){let s;const a=Li.getTransfer(i);if(r===gl)return t.UNSIGNED_BYTE;if(r===e3)return t.UNSIGNED_SHORT_4_4_4_4;if(r===t3)return t.UNSIGNED_SHORT_5_5_5_1;if(r===vq)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===mq)return t.BYTE;if(r===gq)return t.SHORT;if(r===Lw)return t.UNSIGNED_SHORT;if(r===QU)return t.INT;if(r===Ug)return t.UNSIGNED_INT;if(r===ru)return t.FLOAT;if(r===Bb)return t.HALF_FLOAT;if(r===yq)return t.ALPHA;if(r===_q)return t.RGB;if(r===iu)return t.RGBA;if(r===Uw)return t.DEPTH_COMPONENT;if(r===iT)return t.DEPTH_STENCIL;if(r===n3)return t.RED;if(r===JO)return t.RED_INTEGER;if(r===bq)return t.RG;if(r===r3)return t.RG_INTEGER;if(r===ZO)return t.RGBA_INTEGER;if(r===OA||r===NA||r===IA||r===kA)if(a===ws)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===OA)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===NA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===IA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===kA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===OA)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===NA)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===IA)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===kA)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===iL||r===sL||r===aL||r===oL)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===iL)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===sL)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===aL)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===oL)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===cL||r===lL||r===uL)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===cL||r===lL)return a===ws?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===uL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===hL||r===dL||r===fL||r===pL||r===mL||r===gL||r===vL||r===yL||r===_L||r===bL||r===EL||r===SL||r===TL||r===xL)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===hL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===dL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===fL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===pL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===mL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===gL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===vL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===yL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===_L)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===bL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===EL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===SL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===TL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===xL)return a===ws?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===DA||r===wL||r===CL)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===DA)return a===ws?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===wL)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===CL)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===Eq||r===RL||r===AL||r===ML)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===DA)return s.COMPRESSED_RED_RGTC1_EXT;if(r===RL)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===AL)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===ML)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===rT?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}const uMe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,hMe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class dMe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const i=new Pa,s=e.properties.get(i);s.__webglTexture=n.texture,(n.depthNear!==r.depthNear||n.depthFar!==r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new Bc({vertexShader:uMe,fragmentShader:hMe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Bo(new BC(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class fMe extends Zd{constructor(e,n){super();const r=this;let i=null,s=1,a=null,o="local-floor",c=1,l=null,u=null,h=null,d=null,f=null,p=null;const g=new dMe,_=n.getContextAttributes();let v=null,E=null;const T=[],x=[],N=new Rt;let A=null;const I=new Ic;I.viewport=new Ki;const k=new Ic;k.viewport=new Ki;const L=[I,k],U=new Gae;let $=null,q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Te){let Le=T[Te];return Le===void 0&&(Le=new FD,T[Te]=Le),Le.getTargetRaySpace()},this.getControllerGrip=function(Te){let Le=T[Te];return Le===void 0&&(Le=new FD,T[Te]=Le),Le.getGripSpace()},this.getHand=function(Te){let Le=T[Te];return Le===void 0&&(Le=new FD,T[Te]=Le),Le.getHandSpace()};function G(Te){const Le=x.indexOf(Te.inputSource);if(Le===-1)return;const we=T[Le];we!==void 0&&(we.update(Te.inputSource,Te.frame,l||a),we.dispatchEvent({type:Te.type,data:Te.inputSource}))}function X(){i.removeEventListener("select",G),i.removeEventListener("selectstart",G),i.removeEventListener("selectend",G),i.removeEventListener("squeeze",G),i.removeEventListener("squeezestart",G),i.removeEventListener("squeezeend",G),i.removeEventListener("end",X),i.removeEventListener("inputsourceschange",re);for(let Te=0;Te<T.length;Te++){const Le=x[Te];Le!==null&&(x[Te]=null,T[Te].disconnect(Le))}$=null,q=null,g.reset(),e.setRenderTarget(v),f=null,d=null,h=null,i=null,E=null,He.stop(),r.isPresenting=!1,e.setPixelRatio(A),e.setSize(N.width,N.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Te){s=Te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Te){o=Te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(Te){l=Te},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(Te){if(i=Te,i!==null){if(v=e.getRenderTarget(),i.addEventListener("select",G),i.addEventListener("selectstart",G),i.addEventListener("selectend",G),i.addEventListener("squeeze",G),i.addEventListener("squeezestart",G),i.addEventListener("squeezeend",G),i.addEventListener("end",X),i.addEventListener("inputsourceschange",re),_.xrCompatible!==!0&&await n.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(N),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let we=null,Ce=null,ke=null;_.depth&&(ke=_.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,we=_.stencil?iT:Uw,Ce=_.stencil?rT:Ug);const St={colorFormat:n.RGBA8,depthFormat:ke,scaleFactor:s};h=new XRWebGLBinding(i,n),d=h.createProjectionLayer(St),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),E=new Ul(d.textureWidth,d.textureHeight,{format:iu,type:gl,depthTexture:new UC(d.textureWidth,d.textureHeight,Ce,void 0,void 0,void 0,void 0,void 0,void 0,we),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const we={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(i,n,we),i.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),E=new Ul(f.framebufferWidth,f.framebufferHeight,{format:iu,type:gl,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}E.isXRRenderTarget=!0,this.setFoveation(c),l=null,a=await i.requestReferenceSpace(o),He.setContext(i),He.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function re(Te){for(let Le=0;Le<Te.removed.length;Le++){const we=Te.removed[Le],Ce=x.indexOf(we);Ce>=0&&(x[Ce]=null,T[Ce].disconnect(we))}for(let Le=0;Le<Te.added.length;Le++){const we=Te.added[Le];let Ce=x.indexOf(we);if(Ce===-1){for(let St=0;St<T.length;St++)if(St>=x.length){x.push(we),Ce=St;break}else if(x[St]===null){x[St]=we,Ce=St;break}if(Ce===-1)break}const ke=T[Ce];ke&&ke.connect(we)}}const V=new Re,Z=new Re;function Y(Te,Le,we){V.setFromMatrixPosition(Le.matrixWorld),Z.setFromMatrixPosition(we.matrixWorld);const Ce=V.distanceTo(Z),ke=Le.projectionMatrix.elements,St=we.projectionMatrix.elements,At=ke[14]/(ke[10]-1),Ee=ke[14]/(ke[10]+1),ye=(ke[9]+1)/ke[5],et=(ke[9]-1)/ke[5],fe=(ke[8]-1)/ke[0],Fe=(St[8]+1)/St[0],Ie=At*fe,rt=At*Fe,dt=Ce/(-fe+Fe),gt=dt*-fe;if(Le.matrixWorld.decompose(Te.position,Te.quaternion,Te.scale),Te.translateX(gt),Te.translateZ(dt),Te.matrixWorld.compose(Te.position,Te.quaternion,Te.scale),Te.matrixWorldInverse.copy(Te.matrixWorld).invert(),ke[10]===-1)Te.projectionMatrix.copy(Le.projectionMatrix),Te.projectionMatrixInverse.copy(Le.projectionMatrixInverse);else{const bt=At+dt,be=Ee+dt,ue=Ie-gt,Xe=rt+(Ce-gt),nt=ye*Ee/be*bt,$e=et*Ee/be*bt;Te.projectionMatrix.makePerspective(ue,Xe,nt,$e,bt,be),Te.projectionMatrixInverse.copy(Te.projectionMatrix).invert()}}function ee(Te,Le){Le===null?Te.matrixWorld.copy(Te.matrix):Te.matrixWorld.multiplyMatrices(Le.matrixWorld,Te.matrix),Te.matrixWorldInverse.copy(Te.matrixWorld).invert()}this.updateCamera=function(Te){if(i===null)return;let Le=Te.near,we=Te.far;g.texture!==null&&(g.depthNear>0&&(Le=g.depthNear),g.depthFar>0&&(we=g.depthFar)),U.near=k.near=I.near=Le,U.far=k.far=I.far=we,($!==U.near||q!==U.far)&&(i.updateRenderState({depthNear:U.near,depthFar:U.far}),$=U.near,q=U.far),I.layers.mask=Te.layers.mask|2,k.layers.mask=Te.layers.mask|4,U.layers.mask=I.layers.mask|k.layers.mask;const Ce=Te.parent,ke=U.cameras;ee(U,Ce);for(let St=0;St<ke.length;St++)ee(ke[St],Ce);ke.length===2?Y(U,I,k):U.projectionMatrix.copy(I.projectionMatrix),oe(Te,U,Ce)};function oe(Te,Le,we){we===null?Te.matrix.copy(Le.matrixWorld):(Te.matrix.copy(we.matrixWorld),Te.matrix.invert(),Te.matrix.multiply(Le.matrixWorld)),Te.matrix.decompose(Te.position,Te.quaternion,Te.scale),Te.updateMatrixWorld(!0),Te.projectionMatrix.copy(Le.projectionMatrix),Te.projectionMatrixInverse.copy(Le.projectionMatrixInverse),Te.isPerspectiveCamera&&(Te.fov=Bw*2*Math.atan(1/Te.projectionMatrix.elements[5]),Te.zoom=1)}this.getCamera=function(){return U},this.getFoveation=function(){if(!(d===null&&f===null))return c},this.setFoveation=function(Te){c=Te,d!==null&&(d.fixedFoveation=Te),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=Te)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(U)};let de=null;function Me(Te,Le){if(u=Le.getViewerPose(l||a),p=Le,u!==null){const we=u.views;f!==null&&(e.setRenderTargetFramebuffer(E,f.framebuffer),e.setRenderTarget(E));let Ce=!1;we.length!==U.cameras.length&&(U.cameras.length=0,Ce=!0);for(let At=0;At<we.length;At++){const Ee=we[At];let ye=null;if(f!==null)ye=f.getViewport(Ee);else{const fe=h.getViewSubImage(d,Ee);ye=fe.viewport,At===0&&(e.setRenderTargetTextures(E,fe.colorTexture,fe.depthStencilTexture),e.setRenderTarget(E))}let et=L[At];et===void 0&&(et=new Ic,et.layers.enable(At),et.viewport=new Ki,L[At]=et),et.matrix.fromArray(Ee.transform.matrix),et.matrix.decompose(et.position,et.quaternion,et.scale),et.projectionMatrix.fromArray(Ee.projectionMatrix),et.projectionMatrixInverse.copy(et.projectionMatrix).invert(),et.viewport.set(ye.x,ye.y,ye.width,ye.height),At===0&&(U.matrix.copy(et.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),Ce===!0&&U.cameras.push(et)}const ke=i.enabledFeatures;if(ke&&ke.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const At=h.getDepthInformation(we[0]);At&&At.isValid&&At.texture&&g.init(e,At,i.renderState)}}for(let we=0;we<T.length;we++){const Ce=x[we],ke=T[we];Ce!==null&&ke!==void 0&&ke.update(Ce,Le,l||a)}de&&de(Te,Le),Le.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Le}),p=null}const He=new Kae;He.setAnimationLoop(Me),this.setAnimationLoop=function(Te){de=Te},this.dispose=function(){}}}const rS=new Xh,pMe=new Nr;function mMe(t,e){function n(_,v){_.matrixAutoUpdate===!0&&_.updateMatrix(),v.value.copy(_.matrix)}function r(_,v){v.color.getRGB(_.fogColor.value,Xse(t)),v.isFog?(_.fogNear.value=v.near,_.fogFar.value=v.far):v.isFogExp2&&(_.fogDensity.value=v.density)}function i(_,v,E,T,x){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(_,v):v.isMeshToonMaterial?(s(_,v),h(_,v)):v.isMeshPhongMaterial?(s(_,v),u(_,v)):v.isMeshStandardMaterial?(s(_,v),d(_,v),v.isMeshPhysicalMaterial&&f(_,v,x)):v.isMeshMatcapMaterial?(s(_,v),p(_,v)):v.isMeshDepthMaterial?s(_,v):v.isMeshDistanceMaterial?(s(_,v),g(_,v)):v.isMeshNormalMaterial?s(_,v):v.isLineBasicMaterial?(a(_,v),v.isLineDashedMaterial&&o(_,v)):v.isPointsMaterial?c(_,v,E,T):v.isSpriteMaterial?l(_,v):v.isShadowMaterial?(_.color.value.copy(v.color),_.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(_,v){_.opacity.value=v.opacity,v.color&&_.diffuse.value.copy(v.color),v.emissive&&_.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(_.map.value=v.map,n(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,n(v.alphaMap,_.alphaMapTransform)),v.bumpMap&&(_.bumpMap.value=v.bumpMap,n(v.bumpMap,_.bumpMapTransform),_.bumpScale.value=v.bumpScale,v.side===Pc&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,n(v.normalMap,_.normalMapTransform),_.normalScale.value.copy(v.normalScale),v.side===Pc&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,n(v.displacementMap,_.displacementMapTransform),_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap,n(v.emissiveMap,_.emissiveMapTransform)),v.specularMap&&(_.specularMap.value=v.specularMap,n(v.specularMap,_.specularMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);const E=e.get(v),T=E.envMap,x=E.envMapRotation;T&&(_.envMap.value=T,rS.copy(x),rS.x*=-1,rS.y*=-1,rS.z*=-1,T.isCubeTexture&&T.isRenderTargetTexture===!1&&(rS.y*=-1,rS.z*=-1),_.envMapRotation.value.setFromMatrix4(pMe.makeRotationFromEuler(rS)),_.flipEnvMap.value=T.isCubeTexture&&T.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=v.reflectivity,_.ior.value=v.ior,_.refractionRatio.value=v.refractionRatio),v.lightMap&&(_.lightMap.value=v.lightMap,_.lightMapIntensity.value=v.lightMapIntensity,n(v.lightMap,_.lightMapTransform)),v.aoMap&&(_.aoMap.value=v.aoMap,_.aoMapIntensity.value=v.aoMapIntensity,n(v.aoMap,_.aoMapTransform))}function a(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,v.map&&(_.map.value=v.map,n(v.map,_.mapTransform))}function o(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}function c(_,v,E,T){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*E,_.scale.value=T*.5,v.map&&(_.map.value=v.map,n(v.map,_.uvTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,n(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function l(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map,n(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,n(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function u(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4)}function h(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap)}function d(_,v){_.metalness.value=v.metalness,v.metalnessMap&&(_.metalnessMap.value=v.metalnessMap,n(v.metalnessMap,_.metalnessMapTransform)),_.roughness.value=v.roughness,v.roughnessMap&&(_.roughnessMap.value=v.roughnessMap,n(v.roughnessMap,_.roughnessMapTransform)),v.envMap&&(_.envMapIntensity.value=v.envMapIntensity)}function f(_,v,E){_.ior.value=v.ior,v.sheen>0&&(_.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),_.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(_.sheenColorMap.value=v.sheenColorMap,n(v.sheenColorMap,_.sheenColorMapTransform)),v.sheenRoughnessMap&&(_.sheenRoughnessMap.value=v.sheenRoughnessMap,n(v.sheenRoughnessMap,_.sheenRoughnessMapTransform))),v.clearcoat>0&&(_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap,n(v.clearcoatMap,_.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,n(v.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(_.clearcoatNormalMap.value=v.clearcoatNormalMap,n(v.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Pc&&_.clearcoatNormalScale.value.negate())),v.dispersion>0&&(_.dispersion.value=v.dispersion),v.iridescence>0&&(_.iridescence.value=v.iridescence,_.iridescenceIOR.value=v.iridescenceIOR,_.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(_.iridescenceMap.value=v.iridescenceMap,n(v.iridescenceMap,_.iridescenceMapTransform)),v.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=v.iridescenceThicknessMap,n(v.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),v.transmission>0&&(_.transmission.value=v.transmission,_.transmissionSamplerMap.value=E.texture,_.transmissionSamplerSize.value.set(E.width,E.height),v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap,n(v.transmissionMap,_.transmissionMapTransform)),_.thickness.value=v.thickness,v.thicknessMap&&(_.thicknessMap.value=v.thicknessMap,n(v.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=v.attenuationDistance,_.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(_.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(_.anisotropyMap.value=v.anisotropyMap,n(v.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=v.specularIntensity,_.specularColor.value.copy(v.specularColor),v.specularColorMap&&(_.specularColorMap.value=v.specularColorMap,n(v.specularColorMap,_.specularColorMapTransform)),v.specularIntensityMap&&(_.specularIntensityMap.value=v.specularIntensityMap,n(v.specularIntensityMap,_.specularIntensityMapTransform))}function p(_,v){v.matcap&&(_.matcap.value=v.matcap)}function g(_,v){const E=e.get(v).light;_.referencePosition.value.setFromMatrixPosition(E.matrixWorld),_.nearDistance.value=E.shadow.camera.near,_.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function gMe(t,e,n,r){let i={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(E,T){const x=T.program;r.uniformBlockBinding(E,x)}function l(E,T){let x=i[E.id];x===void 0&&(p(E),x=u(E),i[E.id]=x,E.addEventListener("dispose",_));const N=T.program;r.updateUBOMapping(E,N);const A=e.render.frame;s[E.id]!==A&&(d(E),s[E.id]=A)}function u(E){const T=h();E.__bindingPointIndex=T;const x=t.createBuffer(),N=E.__size,A=E.usage;return t.bindBuffer(t.UNIFORM_BUFFER,x),t.bufferData(t.UNIFORM_BUFFER,N,A),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,T,x),x}function h(){for(let E=0;E<o;E++)if(a.indexOf(E)===-1)return a.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(E){const T=i[E.id],x=E.uniforms,N=E.__cache;t.bindBuffer(t.UNIFORM_BUFFER,T);for(let A=0,I=x.length;A<I;A++){const k=Array.isArray(x[A])?x[A]:[x[A]];for(let L=0,U=k.length;L<U;L++){const $=k[L];if(f($,A,L,N)===!0){const q=$.__offset,G=Array.isArray($.value)?$.value:[$.value];let X=0;for(let re=0;re<G.length;re++){const V=G[re],Z=g(V);typeof V=="number"||typeof V=="boolean"?($.__data[0]=V,t.bufferSubData(t.UNIFORM_BUFFER,q+X,$.__data)):V.isMatrix3?($.__data[0]=V.elements[0],$.__data[1]=V.elements[1],$.__data[2]=V.elements[2],$.__data[3]=0,$.__data[4]=V.elements[3],$.__data[5]=V.elements[4],$.__data[6]=V.elements[5],$.__data[7]=0,$.__data[8]=V.elements[6],$.__data[9]=V.elements[7],$.__data[10]=V.elements[8],$.__data[11]=0):(V.toArray($.__data,X),X+=Z.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,q,$.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function f(E,T,x,N){const A=E.value,I=T+"_"+x;if(N[I]===void 0)return typeof A=="number"||typeof A=="boolean"?N[I]=A:N[I]=A.clone(),!0;{const k=N[I];if(typeof A=="number"||typeof A=="boolean"){if(k!==A)return N[I]=A,!0}else if(k.equals(A)===!1)return k.copy(A),!0}return!1}function p(E){const T=E.uniforms;let x=0;const N=16;for(let I=0,k=T.length;I<k;I++){const L=Array.isArray(T[I])?T[I]:[T[I]];for(let U=0,$=L.length;U<$;U++){const q=L[U],G=Array.isArray(q.value)?q.value:[q.value];for(let X=0,re=G.length;X<re;X++){const V=G[X],Z=g(V),Y=x%N,ee=Y%Z.boundary,oe=Y+ee;x+=ee,oe!==0&&N-oe<Z.storage&&(x+=N-oe),q.__data=new Float32Array(Z.storage/Float32Array.BYTES_PER_ELEMENT),q.__offset=x,x+=Z.storage}}}const A=x%N;return A>0&&(x+=N-A),E.__size=x,E.__cache={},this}function g(E){const T={boundary:0,storage:0};return typeof E=="number"||typeof E=="boolean"?(T.boundary=4,T.storage=4):E.isVector2?(T.boundary=8,T.storage=8):E.isVector3||E.isColor?(T.boundary=16,T.storage=12):E.isVector4?(T.boundary=16,T.storage=16):E.isMatrix3?(T.boundary=48,T.storage=48):E.isMatrix4?(T.boundary=64,T.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),T}function _(E){const T=E.target;T.removeEventListener("dispose",_);const x=a.indexOf(T.__bindingPointIndex);a.splice(x,1),t.deleteBuffer(i[T.id]),delete i[T.id],delete s[T.id]}function v(){for(const E in i)t.deleteBuffer(i[E]);a=[],i={},s={}}return{bind:c,update:l,dispose:v}}class noe{constructor(e={}){const{canvas:n=$se(),context:r=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=r.getContextAttributes().alpha}else f=a;const p=new Uint32Array(4),g=new Int32Array(4);let _=null,v=null;const E=[],T=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=em,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const x=this;let N=!1;this._outputColorSpace=ya;let A=0,I=0,k=null,L=-1,U=null;const $=new Ki,q=new Ki;let G=null;const X=new _n(0);let re=0,V=n.width,Z=n.height,Y=1,ee=null,oe=null;const de=new Ki(0,0,V,Z),Me=new Ki(0,0,V,Z);let He=!1;const Te=new LC;let Le=!1,we=!1;const Ce=new Nr,ke=new Nr,St=new Re,At=new Ki,Ee={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ye=!1;function et(){return k===null?Y:1}let fe=r;function Fe(ve,Ke){return n.getContext(ve,Ke)}try{const ve={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${XO}`),n.addEventListener("webglcontextlost",Pt,!1),n.addEventListener("webglcontextrestored",hn,!1),n.addEventListener("webglcontextcreationerror",an,!1),fe===null){const Ke="webgl2";if(fe=Fe(Ke,ve),fe===null)throw Fe(Ke)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ve){throw console.error("THREE.WebGLRenderer: "+ve.message),ve}let Ie,rt,dt,gt,bt,be,ue,Xe,nt,$e,Ue,qt,Mt,Yt,ce,j,W,me,De,je,mt,xt,Vn,qe;function Vt(){Ie=new ARe(fe),Ie.init(),xt=new toe(fe,Ie),rt=new ERe(fe,Ie,e,xt),dt=new cMe(fe,Ie),rt.reverseDepthBuffer&&d&&dt.buffers.depth.setReversed(!0),gt=new NRe(fe),bt=new XAe,be=new lMe(fe,Ie,dt,bt,rt,xt,gt),ue=new TRe(x),Xe=new RRe(x),nt=new U1e(fe),Vn=new _Re(fe,nt),$e=new MRe(fe,nt,gt,Vn),Ue=new kRe(fe,$e,nt,gt),De=new IRe(fe,rt,be),j=new SRe(bt),qt=new YAe(x,ue,Xe,Ie,rt,Vn,j),Mt=new mMe(x,bt),Yt=new JAe,ce=new rMe(Ie),me=new yRe(x,ue,Xe,dt,Ue,f,c),W=new aMe(x,Ue,rt),qe=new gMe(fe,gt,rt,dt),je=new bRe(fe,Ie,gt),mt=new ORe(fe,Ie,gt),gt.programs=qt.programs,x.capabilities=rt,x.extensions=Ie,x.properties=bt,x.renderLists=Yt,x.shadowMap=W,x.state=dt,x.info=gt}Vt();const ht=new fMe(x,fe);this.xr=ht,this.getContext=function(){return fe},this.getContextAttributes=function(){return fe.getContextAttributes()},this.forceContextLoss=function(){const ve=Ie.get("WEBGL_lose_context");ve&&ve.loseContext()},this.forceContextRestore=function(){const ve=Ie.get("WEBGL_lose_context");ve&&ve.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(ve){ve!==void 0&&(Y=ve,this.setSize(V,Z,!1))},this.getSize=function(ve){return ve.set(V,Z)},this.setSize=function(ve,Ke,vt=!0){if(ht.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=ve,Z=Ke,n.width=Math.floor(ve*Y),n.height=Math.floor(Ke*Y),vt===!0&&(n.style.width=ve+"px",n.style.height=Ke+"px"),this.setViewport(0,0,ve,Ke)},this.getDrawingBufferSize=function(ve){return ve.set(V*Y,Z*Y).floor()},this.setDrawingBufferSize=function(ve,Ke,vt){V=ve,Z=Ke,Y=vt,n.width=Math.floor(ve*vt),n.height=Math.floor(Ke*vt),this.setViewport(0,0,ve,Ke)},this.getCurrentViewport=function(ve){return ve.copy($)},this.getViewport=function(ve){return ve.copy(de)},this.setViewport=function(ve,Ke,vt,yt){ve.isVector4?de.set(ve.x,ve.y,ve.z,ve.w):de.set(ve,Ke,vt,yt),dt.viewport($.copy(de).multiplyScalar(Y).round())},this.getScissor=function(ve){return ve.copy(Me)},this.setScissor=function(ve,Ke,vt,yt){ve.isVector4?Me.set(ve.x,ve.y,ve.z,ve.w):Me.set(ve,Ke,vt,yt),dt.scissor(q.copy(Me).multiplyScalar(Y).round())},this.getScissorTest=function(){return He},this.setScissorTest=function(ve){dt.setScissorTest(He=ve)},this.setOpaqueSort=function(ve){ee=ve},this.setTransparentSort=function(ve){oe=ve},this.getClearColor=function(ve){return ve.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor(...arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha(...arguments)},this.clear=function(ve=!0,Ke=!0,vt=!0){let yt=0;if(ve){let Ze=!1;if(k!==null){const Ht=k.texture.format;Ze=Ht===ZO||Ht===r3||Ht===JO}if(Ze){const Ht=k.texture.type,nn=Ht===gl||Ht===Ug||Ht===Lw||Ht===rT||Ht===e3||Ht===t3,mn=me.getClearColor(),Sn=me.getClearAlpha(),or=mn.r,cr=mn.g,Cn=mn.b;nn?(p[0]=or,p[1]=cr,p[2]=Cn,p[3]=Sn,fe.clearBufferuiv(fe.COLOR,0,p)):(g[0]=or,g[1]=cr,g[2]=Cn,g[3]=Sn,fe.clearBufferiv(fe.COLOR,0,g))}else yt|=fe.COLOR_BUFFER_BIT}Ke&&(yt|=fe.DEPTH_BUFFER_BIT),vt&&(yt|=fe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),fe.clear(yt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Pt,!1),n.removeEventListener("webglcontextrestored",hn,!1),n.removeEventListener("webglcontextcreationerror",an,!1),me.dispose(),Yt.dispose(),ce.dispose(),bt.dispose(),ue.dispose(),Xe.dispose(),Ue.dispose(),Vn.dispose(),qe.dispose(),qt.dispose(),ht.dispose(),ht.removeEventListener("sessionstart",Sr),ht.removeEventListener("sessionend",sr),En.stop()};function Pt(ve){ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),N=!0}function hn(){console.log("THREE.WebGLRenderer: Context Restored."),N=!1;const ve=gt.autoReset,Ke=W.enabled,vt=W.autoUpdate,yt=W.needsUpdate,Ze=W.type;Vt(),gt.autoReset=ve,W.enabled=Ke,W.autoUpdate=vt,W.needsUpdate=yt,W.type=Ze}function an(ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ve.statusMessage)}function Ve(ve){const Ke=ve.target;Ke.removeEventListener("dispose",Ve),ot(Ke)}function ot(ve){Ct(ve),bt.remove(ve)}function Ct(ve){const Ke=bt.get(ve).programs;Ke!==void 0&&(Ke.forEach(function(vt){qt.releaseProgram(vt)}),ve.isShaderMaterial&&qt.releaseShaderCache(ve))}this.renderBufferDirect=function(ve,Ke,vt,yt,Ze,Ht){Ke===null&&(Ke=Ee);const nn=Ze.isMesh&&Ze.matrixWorld.determinant()<0,mn=nf(ve,Ke,vt,yt,Ze);dt.setMaterial(yt,nn);let Sn=vt.index,or=1;if(yt.wireframe===!0){if(Sn=$e.getWireframeAttribute(vt),Sn===void 0)return;or=2}const cr=vt.drawRange,Cn=vt.attributes.position;let gr=cr.start*or,ai=(cr.start+cr.count)*or;Ht!==null&&(gr=Math.max(gr,Ht.start*or),ai=Math.min(ai,(Ht.start+Ht.count)*or)),Sn!==null?(gr=Math.max(gr,0),ai=Math.min(ai,Sn.count)):Cn!=null&&(gr=Math.max(gr,0),ai=Math.min(ai,Cn.count));const As=ai-gr;if(As<0||As===1/0)return;Vn.setup(Ze,yt,mn,vt,Sn);let vs,Kr=je;if(Sn!==null&&(vs=nt.get(Sn),Kr=mt,Kr.setIndex(vs)),Ze.isMesh)yt.wireframe===!0?(dt.setLineWidth(yt.wireframeLinewidth*et()),Kr.setMode(fe.LINES)):Kr.setMode(fe.TRIANGLES);else if(Ze.isLine){let Xn=yt.linewidth;Xn===void 0&&(Xn=1),dt.setLineWidth(Xn*et()),Ze.isLineSegments?Kr.setMode(fe.LINES):Ze.isLineLoop?Kr.setMode(fe.LINE_LOOP):Kr.setMode(fe.LINE_STRIP)}else Ze.isPoints?Kr.setMode(fe.POINTS):Ze.isSprite&&Kr.setMode(fe.TRIANGLES);if(Ze.isBatchedMesh)if(Ze._multiDrawInstances!==null)BD("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Kr.renderMultiDrawInstances(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount,Ze._multiDrawInstances);else if(Ie.get("WEBGL_multi_draw"))Kr.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else{const Xn=Ze._multiDrawStarts,Tr=Ze._multiDrawCounts,Bn=Ze._multiDrawCount,Ho=Sn?nt.get(Sn).bytesPerElement:1,zl=bt.get(yt).currentProgram.getUniforms();for(let Qa=0;Qa<Bn;Qa++)zl.setValue(fe,"_gl_DrawID",Qa),Kr.render(Xn[Qa]/Ho,Tr[Qa])}else if(Ze.isInstancedMesh)Kr.renderInstances(gr,As,Ze.count);else if(vt.isInstancedBufferGeometry){const Xn=vt._maxInstanceCount!==void 0?vt._maxInstanceCount:1/0,Tr=Math.min(vt.instanceCount,Xn);Kr.renderInstances(gr,As,Tr)}else Kr.render(gr,As)};function Nt(ve,Ke,vt){ve.transparent===!0&&ve.side===ll&&ve.forceSinglePass===!1?(ve.side=Pc,ve.needsUpdate=!0,er(ve,Ke,vt),ve.side=Lg,ve.needsUpdate=!0,er(ve,Ke,vt),ve.side=ll):er(ve,Ke,vt)}this.compile=function(ve,Ke,vt=null){vt===null&&(vt=ve),v=ce.get(vt),v.init(Ke),T.push(v),vt.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Ke.layers)&&(v.pushLight(Ze),Ze.castShadow&&v.pushShadow(Ze))}),ve!==vt&&ve.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Ke.layers)&&(v.pushLight(Ze),Ze.castShadow&&v.pushShadow(Ze))}),v.setupLights();const yt=new Set;return ve.traverse(function(Ze){if(!(Ze.isMesh||Ze.isPoints||Ze.isLine||Ze.isSprite))return;const Ht=Ze.material;if(Ht)if(Array.isArray(Ht))for(let nn=0;nn<Ht.length;nn++){const mn=Ht[nn];Nt(mn,vt,Ze),yt.add(mn)}else Nt(Ht,vt,Ze),yt.add(Ht)}),v=T.pop(),yt},this.compileAsync=function(ve,Ke,vt=null){const yt=this.compile(ve,Ke,vt);return new Promise(Ze=>{function Ht(){if(yt.forEach(function(nn){bt.get(nn).currentProgram.isReady()&&yt.delete(nn)}),yt.size===0){Ze(ve);return}setTimeout(Ht,10)}Ie.get("KHR_parallel_shader_compile")!==null?Ht():setTimeout(Ht,10)})};let Yn=null;function si(ve){Yn&&Yn(ve)}function Sr(){En.stop()}function sr(){En.start()}const En=new Kae;En.setAnimationLoop(si),typeof self<"u"&&En.setContext(self),this.setAnimationLoop=function(ve){Yn=ve,ht.setAnimationLoop(ve),ve===null?En.stop():En.start()},ht.addEventListener("sessionstart",Sr),ht.addEventListener("sessionend",sr),this.render=function(ve,Ke){if(Ke!==void 0&&Ke.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(N===!0)return;if(ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),Ke.parent===null&&Ke.matrixWorldAutoUpdate===!0&&Ke.updateMatrixWorld(),ht.enabled===!0&&ht.isPresenting===!0&&(ht.cameraAutoUpdate===!0&&ht.updateCamera(Ke),Ke=ht.getCamera()),ve.isScene===!0&&ve.onBeforeRender(x,ve,Ke,k),v=ce.get(ve,T.length),v.init(Ke),T.push(v),ke.multiplyMatrices(Ke.projectionMatrix,Ke.matrixWorldInverse),Te.setFromProjectionMatrix(ke),we=this.localClippingEnabled,Le=j.init(this.clippingPlanes,we),_=Yt.get(ve,E.length),_.init(),E.push(_),ht.enabled===!0&&ht.isPresenting===!0){const Ht=x.xr.getDepthSensingMesh();Ht!==null&&sn(Ht,Ke,-1/0,x.sortObjects)}sn(ve,Ke,0,x.sortObjects),_.finish(),x.sortObjects===!0&&_.sort(ee,oe),ye=ht.enabled===!1||ht.isPresenting===!1||ht.hasDepthSensing()===!1,ye&&me.addToRenderList(_,ve),this.info.render.frame++,Le===!0&&j.beginShadows();const vt=v.state.shadowsArray;W.render(vt,ve,Ke),Le===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset();const yt=_.opaque,Ze=_.transmissive;if(v.setupLights(),Ke.isArrayCamera){const Ht=Ke.cameras;if(Ze.length>0)for(let nn=0,mn=Ht.length;nn<mn;nn++){const Sn=Ht[nn];Nn(yt,Ze,ve,Sn)}ye&&me.render(ve);for(let nn=0,mn=Ht.length;nn<mn;nn++){const Sn=Ht[nn];Ln(_,ve,Sn,Sn.viewport)}}else Ze.length>0&&Nn(yt,Ze,ve,Ke),ye&&me.render(ve),Ln(_,ve,Ke);k!==null&&I===0&&(be.updateMultisampleRenderTarget(k),be.updateRenderTargetMipmap(k)),ve.isScene===!0&&ve.onAfterRender(x,ve,Ke),Vn.resetDefaultState(),L=-1,U=null,T.pop(),T.length>0?(v=T[T.length-1],Le===!0&&j.setGlobalState(x.clippingPlanes,v.state.camera)):v=null,E.pop(),E.length>0?_=E[E.length-1]:_=null};function sn(ve,Ke,vt,yt){if(ve.visible===!1)return;if(ve.layers.test(Ke.layers)){if(ve.isGroup)vt=ve.renderOrder;else if(ve.isLOD)ve.autoUpdate===!0&&ve.update(Ke);else if(ve.isLight)v.pushLight(ve),ve.castShadow&&v.pushShadow(ve);else if(ve.isSprite){if(!ve.frustumCulled||Te.intersectsSprite(ve)){yt&&At.setFromMatrixPosition(ve.matrixWorld).applyMatrix4(ke);const nn=Ue.update(ve),mn=ve.material;mn.visible&&_.push(ve,nn,mn,vt,At.z,null)}}else if((ve.isMesh||ve.isLine||ve.isPoints)&&(!ve.frustumCulled||Te.intersectsObject(ve))){const nn=Ue.update(ve),mn=ve.material;if(yt&&(ve.boundingSphere!==void 0?(ve.boundingSphere===null&&ve.computeBoundingSphere(),At.copy(ve.boundingSphere.center)):(nn.boundingSphere===null&&nn.computeBoundingSphere(),At.copy(nn.boundingSphere.center)),At.applyMatrix4(ve.matrixWorld).applyMatrix4(ke)),Array.isArray(mn)){const Sn=nn.groups;for(let or=0,cr=Sn.length;or<cr;or++){const Cn=Sn[or],gr=mn[Cn.materialIndex];gr&&gr.visible&&_.push(ve,nn,gr,vt,At.z,Cn)}}else mn.visible&&_.push(ve,nn,mn,vt,At.z,null)}}const Ht=ve.children;for(let nn=0,mn=Ht.length;nn<mn;nn++)sn(Ht[nn],Ke,vt,yt)}function Ln(ve,Ke,vt,yt){const Ze=ve.opaque,Ht=ve.transmissive,nn=ve.transparent;v.setupLightsView(vt),Le===!0&&j.setGlobalState(x.clippingPlanes,vt),yt&&dt.viewport($.copy(yt)),Ze.length>0&&dr(Ze,Ke,vt),Ht.length>0&&dr(Ht,Ke,vt),nn.length>0&&dr(nn,Ke,vt),dt.buffers.depth.setTest(!0),dt.buffers.depth.setMask(!0),dt.buffers.color.setMask(!0),dt.setPolygonOffset(!1)}function Nn(ve,Ke,vt,yt){if((vt.isScene===!0?vt.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[yt.id]===void 0&&(v.state.transmissionRenderTarget[yt.id]=new Ul(1,1,{generateMipmaps:!0,type:Ie.has("EXT_color_buffer_half_float")||Ie.has("EXT_color_buffer_float")?Bb:gl,minFilter:_g,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Li.workingColorSpace}));const Ht=v.state.transmissionRenderTarget[yt.id],nn=yt.viewport||$;Ht.setSize(nn.z*x.transmissionResolutionScale,nn.w*x.transmissionResolutionScale);const mn=x.getRenderTarget();x.setRenderTarget(Ht),x.getClearColor(X),re=x.getClearAlpha(),re<1&&x.setClearColor(16777215,.5),x.clear(),ye&&me.render(vt);const Sn=x.toneMapping;x.toneMapping=em;const or=yt.viewport;if(yt.viewport!==void 0&&(yt.viewport=void 0),v.setupLightsView(yt),Le===!0&&j.setGlobalState(x.clippingPlanes,yt),dr(ve,vt,yt),be.updateMultisampleRenderTarget(Ht),be.updateRenderTargetMipmap(Ht),Ie.has("WEBGL_multisampled_render_to_texture")===!1){let cr=!1;for(let Cn=0,gr=Ke.length;Cn<gr;Cn++){const ai=Ke[Cn],As=ai.object,vs=ai.geometry,Kr=ai.material,Xn=ai.group;if(Kr.side===ll&&As.layers.test(yt.layers)){const Tr=Kr.side;Kr.side=Pc,Kr.needsUpdate=!0,ui(As,vt,yt,vs,Kr,Xn),Kr.side=Tr,Kr.needsUpdate=!0,cr=!0}}cr===!0&&(be.updateMultisampleRenderTarget(Ht),be.updateRenderTargetMipmap(Ht))}x.setRenderTarget(mn),x.setClearColor(X,re),or!==void 0&&(yt.viewport=or),x.toneMapping=Sn}function dr(ve,Ke,vt){const yt=Ke.isScene===!0?Ke.overrideMaterial:null;for(let Ze=0,Ht=ve.length;Ze<Ht;Ze++){const nn=ve[Ze],mn=nn.object,Sn=nn.geometry,or=nn.group;let cr=nn.material;cr.allowOverride===!0&&yt!==null&&(cr=yt),mn.layers.test(vt.layers)&&ui(mn,Ke,vt,Sn,cr,or)}}function ui(ve,Ke,vt,yt,Ze,Ht){ve.onBeforeRender(x,Ke,vt,yt,Ze,Ht),ve.modelViewMatrix.multiplyMatrices(vt.matrixWorldInverse,ve.matrixWorld),ve.normalMatrix.getNormalMatrix(ve.modelViewMatrix),Ze.onBeforeRender(x,Ke,vt,yt,ve,Ht),Ze.transparent===!0&&Ze.side===ll&&Ze.forceSinglePass===!1?(Ze.side=Pc,Ze.needsUpdate=!0,x.renderBufferDirect(vt,Ke,yt,Ze,ve,Ht),Ze.side=Lg,Ze.needsUpdate=!0,x.renderBufferDirect(vt,Ke,yt,Ze,ve,Ht),Ze.side=ll):x.renderBufferDirect(vt,Ke,yt,Ze,ve,Ht),ve.onAfterRender(x,Ke,vt,yt,Ze,Ht)}function er(ve,Ke,vt){Ke.isScene!==!0&&(Ke=Ee);const yt=bt.get(ve),Ze=v.state.lights,Ht=v.state.shadowsArray,nn=Ze.state.version,mn=qt.getParameters(ve,Ze.state,Ht,Ke,vt),Sn=qt.getProgramCacheKey(mn);let or=yt.programs;yt.environment=ve.isMeshStandardMaterial?Ke.environment:null,yt.fog=Ke.fog,yt.envMap=(ve.isMeshStandardMaterial?Xe:ue).get(ve.envMap||yt.environment),yt.envMapRotation=yt.environment!==null&&ve.envMap===null?Ke.environmentRotation:ve.envMapRotation,or===void 0&&(ve.addEventListener("dispose",Ve),or=new Map,yt.programs=or);let cr=or.get(Sn);if(cr!==void 0){if(yt.currentProgram===cr&&yt.lightsStateVersion===nn)return gu(ve,mn),cr}else mn.uniforms=qt.getUniforms(ve),ve.onBeforeCompile(mn,x),cr=qt.acquireProgram(mn,Sn),or.set(Sn,cr),yt.uniforms=mn.uniforms;const Cn=yt.uniforms;return(!ve.isShaderMaterial&&!ve.isRawShaderMaterial||ve.clipping===!0)&&(Cn.clippingPlanes=j.uniform),gu(ve,mn),yt.needsLights=d0(ve),yt.lightsStateVersion=nn,yt.needsLights&&(Cn.ambientLightColor.value=Ze.state.ambient,Cn.lightProbe.value=Ze.state.probe,Cn.directionalLights.value=Ze.state.directional,Cn.directionalLightShadows.value=Ze.state.directionalShadow,Cn.spotLights.value=Ze.state.spot,Cn.spotLightShadows.value=Ze.state.spotShadow,Cn.rectAreaLights.value=Ze.state.rectArea,Cn.ltc_1.value=Ze.state.rectAreaLTC1,Cn.ltc_2.value=Ze.state.rectAreaLTC2,Cn.pointLights.value=Ze.state.point,Cn.pointLightShadows.value=Ze.state.pointShadow,Cn.hemisphereLights.value=Ze.state.hemi,Cn.directionalShadowMap.value=Ze.state.directionalShadowMap,Cn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Cn.spotShadowMap.value=Ze.state.spotShadowMap,Cn.spotLightMatrix.value=Ze.state.spotLightMatrix,Cn.spotLightMap.value=Ze.state.spotLightMap,Cn.pointShadowMap.value=Ze.state.pointShadowMap,Cn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),yt.currentProgram=cr,yt.uniformsList=null,cr}function La(ve){if(ve.uniformsList===null){const Ke=ve.currentProgram.getUniforms();ve.uniformsList=zD.seqWithValue(Ke.seq,ve.uniforms)}return ve.uniformsList}function gu(ve,Ke){const vt=bt.get(ve);vt.outputColorSpace=Ke.outputColorSpace,vt.batching=Ke.batching,vt.batchingColor=Ke.batchingColor,vt.instancing=Ke.instancing,vt.instancingColor=Ke.instancingColor,vt.instancingMorph=Ke.instancingMorph,vt.skinning=Ke.skinning,vt.morphTargets=Ke.morphTargets,vt.morphNormals=Ke.morphNormals,vt.morphColors=Ke.morphColors,vt.morphTargetsCount=Ke.morphTargetsCount,vt.numClippingPlanes=Ke.numClippingPlanes,vt.numIntersection=Ke.numClipIntersection,vt.vertexAlphas=Ke.vertexAlphas,vt.vertexTangents=Ke.vertexTangents,vt.toneMapping=Ke.toneMapping}function nf(ve,Ke,vt,yt,Ze){Ke.isScene!==!0&&(Ke=Ee),be.resetTextureUnits();const Ht=Ke.fog,nn=yt.isMeshStandardMaterial?Ke.environment:null,mn=k===null?x.outputColorSpace:k.isXRRenderTarget===!0?k.texture.colorSpace:Bg,Sn=(yt.isMeshStandardMaterial?Xe:ue).get(yt.envMap||nn),or=yt.vertexColors===!0&&!!vt.attributes.color&&vt.attributes.color.itemSize===4,cr=!!vt.attributes.tangent&&(!!yt.normalMap||yt.anisotropy>0),Cn=!!vt.morphAttributes.position,gr=!!vt.morphAttributes.normal,ai=!!vt.morphAttributes.color;let As=em;yt.toneMapped&&(k===null||k.isXRRenderTarget===!0)&&(As=x.toneMapping);const vs=vt.morphAttributes.position||vt.morphAttributes.normal||vt.morphAttributes.color,Kr=vs!==void 0?vs.length:0,Xn=bt.get(yt),Tr=v.state.lights;if(Le===!0&&(we===!0||ve!==U)){const Hs=ve===U&&yt.id===L;j.setState(yt,ve,Hs)}let Bn=!1;yt.version===Xn.__version?(Xn.needsLights&&Xn.lightsStateVersion!==Tr.state.version||Xn.outputColorSpace!==mn||Ze.isBatchedMesh&&Xn.batching===!1||!Ze.isBatchedMesh&&Xn.batching===!0||Ze.isBatchedMesh&&Xn.batchingColor===!0&&Ze.colorTexture===null||Ze.isBatchedMesh&&Xn.batchingColor===!1&&Ze.colorTexture!==null||Ze.isInstancedMesh&&Xn.instancing===!1||!Ze.isInstancedMesh&&Xn.instancing===!0||Ze.isSkinnedMesh&&Xn.skinning===!1||!Ze.isSkinnedMesh&&Xn.skinning===!0||Ze.isInstancedMesh&&Xn.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&Xn.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&Xn.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&Xn.instancingMorph===!1&&Ze.morphTexture!==null||Xn.envMap!==Sn||yt.fog===!0&&Xn.fog!==Ht||Xn.numClippingPlanes!==void 0&&(Xn.numClippingPlanes!==j.numPlanes||Xn.numIntersection!==j.numIntersection)||Xn.vertexAlphas!==or||Xn.vertexTangents!==cr||Xn.morphTargets!==Cn||Xn.morphNormals!==gr||Xn.morphColors!==ai||Xn.toneMapping!==As||Xn.morphTargetsCount!==Kr)&&(Bn=!0):(Bn=!0,Xn.__version=yt.version);let Ho=Xn.currentProgram;Bn===!0&&(Ho=er(yt,Ke,Ze));let zl=!1,Qa=!1,ah=!1;const cs=Ho.getUniforms(),bn=Xn.uniforms;if(dt.useProgram(Ho.program)&&(zl=!0,Qa=!0,ah=!0),yt.id!==L&&(L=yt.id,Qa=!0),zl||U!==ve){dt.buffers.depth.getReversed()?(Ce.copy(ve.projectionMatrix),iTe(Ce),sTe(Ce),cs.setValue(fe,"projectionMatrix",Ce)):cs.setValue(fe,"projectionMatrix",ve.projectionMatrix),cs.setValue(fe,"viewMatrix",ve.matrixWorldInverse);const qn=cs.map.cameraPosition;qn!==void 0&&qn.setValue(fe,St.setFromMatrixPosition(ve.matrixWorld)),rt.logarithmicDepthBuffer&&cs.setValue(fe,"logDepthBufFC",2/(Math.log(ve.far+1)/Math.LN2)),(yt.isMeshPhongMaterial||yt.isMeshToonMaterial||yt.isMeshLambertMaterial||yt.isMeshBasicMaterial||yt.isMeshStandardMaterial||yt.isShaderMaterial)&&cs.setValue(fe,"isOrthographic",ve.isOrthographicCamera===!0),U!==ve&&(U=ve,Qa=!0,ah=!0)}if(Ze.isSkinnedMesh){cs.setOptional(fe,Ze,"bindMatrix"),cs.setOptional(fe,Ze,"bindMatrixInverse");const Hs=Ze.skeleton;Hs&&(Hs.boneTexture===null&&Hs.computeBoneTexture(),cs.setValue(fe,"boneTexture",Hs.boneTexture,be))}Ze.isBatchedMesh&&(cs.setOptional(fe,Ze,"batchingTexture"),cs.setValue(fe,"batchingTexture",Ze._matricesTexture,be),cs.setOptional(fe,Ze,"batchingIdTexture"),cs.setValue(fe,"batchingIdTexture",Ze._indirectTexture,be),cs.setOptional(fe,Ze,"batchingColorTexture"),Ze._colorsTexture!==null&&cs.setValue(fe,"batchingColorTexture",Ze._colorsTexture,be));const eo=vt.morphAttributes;if((eo.position!==void 0||eo.normal!==void 0||eo.color!==void 0)&&De.update(Ze,vt,Ho),(Qa||Xn.receiveShadow!==Ze.receiveShadow)&&(Xn.receiveShadow=Ze.receiveShadow,cs.setValue(fe,"receiveShadow",Ze.receiveShadow)),yt.isMeshGouraudMaterial&&yt.envMap!==null&&(bn.envMap.value=Sn,bn.flipEnvMap.value=Sn.isCubeTexture&&Sn.isRenderTargetTexture===!1?-1:1),yt.isMeshStandardMaterial&&yt.envMap===null&&Ke.environment!==null&&(bn.envMapIntensity.value=Ke.environmentIntensity),Qa&&(cs.setValue(fe,"toneMappingExposure",x.toneMappingExposure),Xn.needsLights&&_p(bn,ah),Ht&&yt.fog===!0&&Mt.refreshFogUniforms(bn,Ht),Mt.refreshMaterialUniforms(bn,yt,Y,Z,v.state.transmissionRenderTarget[ve.id]),zD.upload(fe,La(Xn),bn,be)),yt.isShaderMaterial&&yt.uniformsNeedUpdate===!0&&(zD.upload(fe,La(Xn),bn,be),yt.uniformsNeedUpdate=!1),yt.isSpriteMaterial&&cs.setValue(fe,"center",Ze.center),cs.setValue(fe,"modelViewMatrix",Ze.modelViewMatrix),cs.setValue(fe,"normalMatrix",Ze.normalMatrix),cs.setValue(fe,"modelMatrix",Ze.matrixWorld),yt.isShaderMaterial||yt.isRawShaderMaterial){const Hs=yt.uniformsGroups;for(let qn=0,_l=Hs.length;qn<_l;qn++){const oa=Hs[qn];qe.update(oa,Ho),qe.bind(oa,Ho)}}return Ho}function _p(ve,Ke){ve.ambientLightColor.needsUpdate=Ke,ve.lightProbe.needsUpdate=Ke,ve.directionalLights.needsUpdate=Ke,ve.directionalLightShadows.needsUpdate=Ke,ve.pointLights.needsUpdate=Ke,ve.pointLightShadows.needsUpdate=Ke,ve.spotLights.needsUpdate=Ke,ve.spotLightShadows.needsUpdate=Ke,ve.rectAreaLights.needsUpdate=Ke,ve.hemisphereLights.needsUpdate=Ke}function d0(ve){return ve.isMeshLambertMaterial||ve.isMeshToonMaterial||ve.isMeshPhongMaterial||ve.isMeshStandardMaterial||ve.isShadowMaterial||ve.isShaderMaterial&&ve.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return k},this.setRenderTargetTextures=function(ve,Ke,vt){const yt=bt.get(ve);yt.__autoAllocateDepthBuffer=ve.resolveDepthBuffer===!1,yt.__autoAllocateDepthBuffer===!1&&(yt.__useRenderToTexture=!1),bt.get(ve.texture).__webglTexture=Ke,bt.get(ve.depthTexture).__webglTexture=yt.__autoAllocateDepthBuffer?void 0:vt,yt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ve,Ke){const vt=bt.get(ve);vt.__webglFramebuffer=Ke,vt.__useDefaultFramebuffer=Ke===void 0};const rf=fe.createFramebuffer();this.setRenderTarget=function(ve,Ke=0,vt=0){k=ve,A=Ke,I=vt;let yt=!0,Ze=null,Ht=!1,nn=!1;if(ve){const Sn=bt.get(ve);if(Sn.__useDefaultFramebuffer!==void 0)dt.bindFramebuffer(fe.FRAMEBUFFER,null),yt=!1;else if(Sn.__webglFramebuffer===void 0)be.setupRenderTarget(ve);else if(Sn.__hasExternalTextures)be.rebindTextures(ve,bt.get(ve.texture).__webglTexture,bt.get(ve.depthTexture).__webglTexture);else if(ve.depthBuffer){const Cn=ve.depthTexture;if(Sn.__boundDepthTexture!==Cn){if(Cn!==null&&bt.has(Cn)&&(ve.width!==Cn.image.width||ve.height!==Cn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");be.setupDepthRenderbuffer(ve)}}const or=ve.texture;(or.isData3DTexture||or.isDataArrayTexture||or.isCompressedArrayTexture)&&(nn=!0);const cr=bt.get(ve).__webglFramebuffer;ve.isWebGLCubeRenderTarget?(Array.isArray(cr[Ke])?Ze=cr[Ke][vt]:Ze=cr[Ke],Ht=!0):ve.samples>0&&be.useMultisampledRTT(ve)===!1?Ze=bt.get(ve).__webglMultisampledFramebuffer:Array.isArray(cr)?Ze=cr[vt]:Ze=cr,$.copy(ve.viewport),q.copy(ve.scissor),G=ve.scissorTest}else $.copy(de).multiplyScalar(Y).floor(),q.copy(Me).multiplyScalar(Y).floor(),G=He;if(vt!==0&&(Ze=rf),dt.bindFramebuffer(fe.FRAMEBUFFER,Ze)&&yt&&dt.drawBuffers(ve,Ze),dt.viewport($),dt.scissor(q),dt.setScissorTest(G),Ht){const Sn=bt.get(ve.texture);fe.framebufferTexture2D(fe.FRAMEBUFFER,fe.COLOR_ATTACHMENT0,fe.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,Sn.__webglTexture,vt)}else if(nn){const Sn=bt.get(ve.texture),or=Ke;fe.framebufferTextureLayer(fe.FRAMEBUFFER,fe.COLOR_ATTACHMENT0,Sn.__webglTexture,vt,or)}else if(ve!==null&&vt!==0){const Sn=bt.get(ve.texture);fe.framebufferTexture2D(fe.FRAMEBUFFER,fe.COLOR_ATTACHMENT0,fe.TEXTURE_2D,Sn.__webglTexture,vt)}L=-1},this.readRenderTargetPixels=function(ve,Ke,vt,yt,Ze,Ht,nn){if(!(ve&&ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let mn=bt.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&nn!==void 0&&(mn=mn[nn]),mn){dt.bindFramebuffer(fe.FRAMEBUFFER,mn);try{const Sn=ve.texture,or=Sn.format,cr=Sn.type;if(!rt.textureFormatReadable(or)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!rt.textureTypeReadable(cr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ke>=0&&Ke<=ve.width-yt&&vt>=0&&vt<=ve.height-Ze&&fe.readPixels(Ke,vt,yt,Ze,xt.convert(or),xt.convert(cr),Ht)}finally{const Sn=k!==null?bt.get(k).__webglFramebuffer:null;dt.bindFramebuffer(fe.FRAMEBUFFER,Sn)}}},this.readRenderTargetPixelsAsync=async function(ve,Ke,vt,yt,Ze,Ht,nn){if(!(ve&&ve.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let mn=bt.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&nn!==void 0&&(mn=mn[nn]),mn)if(Ke>=0&&Ke<=ve.width-yt&&vt>=0&&vt<=ve.height-Ze){dt.bindFramebuffer(fe.FRAMEBUFFER,mn);const Sn=ve.texture,or=Sn.format,cr=Sn.type;if(!rt.textureFormatReadable(or))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!rt.textureTypeReadable(cr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Cn=fe.createBuffer();fe.bindBuffer(fe.PIXEL_PACK_BUFFER,Cn),fe.bufferData(fe.PIXEL_PACK_BUFFER,Ht.byteLength,fe.STREAM_READ),fe.readPixels(Ke,vt,yt,Ze,xt.convert(or),xt.convert(cr),0);const gr=k!==null?bt.get(k).__webglFramebuffer:null;dt.bindFramebuffer(fe.FRAMEBUFFER,gr);const ai=fe.fenceSync(fe.SYNC_GPU_COMMANDS_COMPLETE,0);return fe.flush(),await rTe(fe,ai,4),fe.bindBuffer(fe.PIXEL_PACK_BUFFER,Cn),fe.getBufferSubData(fe.PIXEL_PACK_BUFFER,0,Ht),fe.deleteBuffer(Cn),fe.deleteSync(ai),Ht}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ve,Ke=null,vt=0){const yt=Math.pow(2,-vt),Ze=Math.floor(ve.image.width*yt),Ht=Math.floor(ve.image.height*yt),nn=Ke!==null?Ke.x:0,mn=Ke!==null?Ke.y:0;be.setTexture2D(ve,0),fe.copyTexSubImage2D(fe.TEXTURE_2D,vt,0,0,nn,mn,Ze,Ht),dt.unbindTexture()};const sf=fe.createFramebuffer(),vu=fe.createFramebuffer();this.copyTextureToTexture=function(ve,Ke,vt=null,yt=null,Ze=0,Ht=null){Ht===null&&(Ze!==0?(BD("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ht=Ze,Ze=0):Ht=0);let nn,mn,Sn,or,cr,Cn,gr,ai,As;const vs=ve.isCompressedTexture?ve.mipmaps[Ht]:ve.image;if(vt!==null)nn=vt.max.x-vt.min.x,mn=vt.max.y-vt.min.y,Sn=vt.isBox3?vt.max.z-vt.min.z:1,or=vt.min.x,cr=vt.min.y,Cn=vt.isBox3?vt.min.z:0;else{const eo=Math.pow(2,-Ze);nn=Math.floor(vs.width*eo),mn=Math.floor(vs.height*eo),ve.isDataArrayTexture?Sn=vs.depth:ve.isData3DTexture?Sn=Math.floor(vs.depth*eo):Sn=1,or=0,cr=0,Cn=0}yt!==null?(gr=yt.x,ai=yt.y,As=yt.z):(gr=0,ai=0,As=0);const Kr=xt.convert(Ke.format),Xn=xt.convert(Ke.type);let Tr;Ke.isData3DTexture?(be.setTexture3D(Ke,0),Tr=fe.TEXTURE_3D):Ke.isDataArrayTexture||Ke.isCompressedArrayTexture?(be.setTexture2DArray(Ke,0),Tr=fe.TEXTURE_2D_ARRAY):(be.setTexture2D(Ke,0),Tr=fe.TEXTURE_2D),fe.pixelStorei(fe.UNPACK_FLIP_Y_WEBGL,Ke.flipY),fe.pixelStorei(fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),fe.pixelStorei(fe.UNPACK_ALIGNMENT,Ke.unpackAlignment);const Bn=fe.getParameter(fe.UNPACK_ROW_LENGTH),Ho=fe.getParameter(fe.UNPACK_IMAGE_HEIGHT),zl=fe.getParameter(fe.UNPACK_SKIP_PIXELS),Qa=fe.getParameter(fe.UNPACK_SKIP_ROWS),ah=fe.getParameter(fe.UNPACK_SKIP_IMAGES);fe.pixelStorei(fe.UNPACK_ROW_LENGTH,vs.width),fe.pixelStorei(fe.UNPACK_IMAGE_HEIGHT,vs.height),fe.pixelStorei(fe.UNPACK_SKIP_PIXELS,or),fe.pixelStorei(fe.UNPACK_SKIP_ROWS,cr),fe.pixelStorei(fe.UNPACK_SKIP_IMAGES,Cn);const cs=ve.isDataArrayTexture||ve.isData3DTexture,bn=Ke.isDataArrayTexture||Ke.isData3DTexture;if(ve.isDepthTexture){const eo=bt.get(ve),Hs=bt.get(Ke),qn=bt.get(eo.__renderTarget),_l=bt.get(Hs.__renderTarget);dt.bindFramebuffer(fe.READ_FRAMEBUFFER,qn.__webglFramebuffer),dt.bindFramebuffer(fe.DRAW_FRAMEBUFFER,_l.__webglFramebuffer);for(let oa=0;oa<Sn;oa++)cs&&(fe.framebufferTextureLayer(fe.READ_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,bt.get(ve).__webglTexture,Ze,Cn+oa),fe.framebufferTextureLayer(fe.DRAW_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,bt.get(Ke).__webglTexture,Ht,As+oa)),fe.blitFramebuffer(or,cr,nn,mn,gr,ai,nn,mn,fe.DEPTH_BUFFER_BIT,fe.NEAREST);dt.bindFramebuffer(fe.READ_FRAMEBUFFER,null),dt.bindFramebuffer(fe.DRAW_FRAMEBUFFER,null)}else if(Ze!==0||ve.isRenderTargetTexture||bt.has(ve)){const eo=bt.get(ve),Hs=bt.get(Ke);dt.bindFramebuffer(fe.READ_FRAMEBUFFER,sf),dt.bindFramebuffer(fe.DRAW_FRAMEBUFFER,vu);for(let qn=0;qn<Sn;qn++)cs?fe.framebufferTextureLayer(fe.READ_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,eo.__webglTexture,Ze,Cn+qn):fe.framebufferTexture2D(fe.READ_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,fe.TEXTURE_2D,eo.__webglTexture,Ze),bn?fe.framebufferTextureLayer(fe.DRAW_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,Hs.__webglTexture,Ht,As+qn):fe.framebufferTexture2D(fe.DRAW_FRAMEBUFFER,fe.COLOR_ATTACHMENT0,fe.TEXTURE_2D,Hs.__webglTexture,Ht),Ze!==0?fe.blitFramebuffer(or,cr,nn,mn,gr,ai,nn,mn,fe.COLOR_BUFFER_BIT,fe.NEAREST):bn?fe.copyTexSubImage3D(Tr,Ht,gr,ai,As+qn,or,cr,nn,mn):fe.copyTexSubImage2D(Tr,Ht,gr,ai,or,cr,nn,mn);dt.bindFramebuffer(fe.READ_FRAMEBUFFER,null),dt.bindFramebuffer(fe.DRAW_FRAMEBUFFER,null)}else bn?ve.isDataTexture||ve.isData3DTexture?fe.texSubImage3D(Tr,Ht,gr,ai,As,nn,mn,Sn,Kr,Xn,vs.data):Ke.isCompressedArrayTexture?fe.compressedTexSubImage3D(Tr,Ht,gr,ai,As,nn,mn,Sn,Kr,vs.data):fe.texSubImage3D(Tr,Ht,gr,ai,As,nn,mn,Sn,Kr,Xn,vs):ve.isDataTexture?fe.texSubImage2D(fe.TEXTURE_2D,Ht,gr,ai,nn,mn,Kr,Xn,vs.data):ve.isCompressedTexture?fe.compressedTexSubImage2D(fe.TEXTURE_2D,Ht,gr,ai,vs.width,vs.height,Kr,vs.data):fe.texSubImage2D(fe.TEXTURE_2D,Ht,gr,ai,nn,mn,Kr,Xn,vs);fe.pixelStorei(fe.UNPACK_ROW_LENGTH,Bn),fe.pixelStorei(fe.UNPACK_IMAGE_HEIGHT,Ho),fe.pixelStorei(fe.UNPACK_SKIP_PIXELS,zl),fe.pixelStorei(fe.UNPACK_SKIP_ROWS,Qa),fe.pixelStorei(fe.UNPACK_SKIP_IMAGES,ah),Ht===0&&Ke.generateMipmaps&&fe.generateMipmap(Tr),dt.unbindTexture()},this.copyTextureToTexture3D=function(ve,Ke,vt=null,yt=null,Ze=0){return BD('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(ve,Ke,vt,yt,Ze)},this.initRenderTarget=function(ve){bt.get(ve).__webglFramebuffer===void 0&&be.setupRenderTarget(ve)},this.initTexture=function(ve){ve.isCubeTexture?be.setTextureCube(ve,0):ve.isData3DTexture?be.setTexture3D(ve,0):ve.isDataArrayTexture||ve.isCompressedArrayTexture?be.setTexture2DArray(ve,0):be.setTexture2D(ve,0),dt.unbindTexture()},this.resetState=function(){A=0,I=0,k=null,dt.reset(),Vn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $f}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=Li._getDrawingBufferColorSpace(e),n.unpackColorSpace=Li._getUnpackColorSpace()}}const vMe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:fq,AddEquation:B_,AddOperation:xse,AdditiveAnimationBlendMode:Sq,AdditiveBlending:kj,AgXToneMapping:Mse,AlphaFormat:yq,AlwaysCompare:Vse,AlwaysDepth:ZP,AlwaysStencilFunc:Uj,AmbientLight:Bae,AnimationAction:Wae,AnimationClip:IM,AnimationLoader:Nxe,AnimationMixer:a1e,AnimationObjectGroup:i1e,AnimationUtils:Rxe,ArcCurve:uae,ArrayCamera:Gae,ArrowHelper:A1e,AttachedBindMode:Lj,Audio:qae,AudioAnalyser:Yxe,AudioContext:qq,AudioListener:qxe,AudioLoader:jxe,AxesHelper:M1e,BackSide:Pc,BasicDepthPacking:Fb,BasicShadowMap:ise,BatchedMesh:iae,Bone:Aq,BooleanKeyframeTrack:BT,Box2:Yae,Box3:cu,Box3Helper:C1e,BoxGeometry:UT,BoxHelper:w1e,BufferAttribute:ii,BufferGeometry:Qr,BufferGeometryLoader:Vae,ByteType:mq,Cache:Iv,Camera:eN,CameraHelper:x1e,CanvasTexture:cae,CapsuleGeometry:f3,CatmullRomCurve3:hae,CineonToneMapping:Rse,CircleGeometry:p3,ClampToEdgeWrapping:qf,Clock:$q,Color:_n,ColorKeyframeTrack:jq,ColorManagement:Li,CompressedArrayTexture:YTe,CompressedCubeTexture:XTe,CompressedTexture:d3,CompressedTextureLoader:Ixe,ConeGeometry:rN,ConstantAlphaFactor:Ese,ConstantColorFactor:_se,Controls:N1e,CubeCamera:Jse,CubeReflectionMapping:Jv,CubeRefractionMapping:_b,CubeTexture:tN,CubeTextureLoader:kxe,CubeUVReflectionMapping:DC,CubicBezierCurve:Nq,CubicBezierCurve3:dae,CubicInterpolant:Oae,CullFaceBack:Ij,CullFaceFront:rse,CullFaceFrontBack:rSe,CullFaceNone:nse,Curve:lm,CurvePath:pae,CustomBlending:sse,CustomToneMapping:Ase,CylinderGeometry:nN,Cylindrical:p1e,Data3DTexture:a3,DataArrayTexture:QO,DataTexture:Qf,DataTextureLoader:Dxe,DataUtils:bTe,DecrementStencilOp:vSe,DecrementWrapStencilOp:_Se,DefaultLoadingManager:kae,DepthArrayTexture:KTe,DepthFormat:Uw,DepthStencilFormat:iT,DepthTexture:UC,DetachedBindMode:Nse,DirectionalLight:Uae,DirectionalLightHelper:T1e,DiscreteInterpolant:Nae,DodecahedronGeometry:m3,DoubleSide:ll,DstAlphaFactor:pse,DstColorFactor:gse,DynamicCopyUsage:DSe,DynamicDrawUsage:ASe,DynamicReadUsage:NSe,EdgesGeometry:lae,EllipseCurve:g3,EqualCompare:Fse,EqualDepth:eL,EqualStencilFunc:TSe,EquirectangularReflectionMapping:vM,EquirectangularRefractionMapping:yM,Euler:Xh,EventDispatcher:Zd,ExtrudeGeometry:v3,FileLoader:Zv,Float16BufferAttribute:RTe,Float32BufferAttribute:Hn,FloatType:ru,Fog:c3,FogExp2:o3,FramebufferTexture:WTe,FrontSide:Lg,Frustum:LC,FrustumArray:h3,GLBufferAttribute:d1e,GLSL1:LSe,GLSL3:Bj,GreaterCompare:zse,GreaterDepth:nL,GreaterEqualCompare:jse,GreaterEqualDepth:tL,GreaterEqualStencilFunc:RSe,GreaterStencilFunc:wSe,GridHelper:E1e,Group:k1,HalfFloatType:Bb,HemisphereLight:Dae,HemisphereLightHelper:b1e,IcosahedronGeometry:y3,ImageBitmapLoader:Hxe,ImageLoader:kM,ImageUtils:Wse,IncrementStencilOp:gSe,IncrementWrapStencilOp:ySe,InstancedBufferAttribute:jw,InstancedBufferGeometry:jae,InstancedInterleavedBuffer:h1e,InstancedMesh:rae,Int16BufferAttribute:wTe,Int32BufferAttribute:CTe,Int8BufferAttribute:STe,IntType:QU,InterleavedBuffer:l3,InterleavedBufferAttribute:sT,Interpolant:aN,InterpolateDiscrete:EM,InterpolateLinear:OL,InterpolateSmooth:UD,InterpolationSamplingMode:FSe,InterpolationSamplingType:BSe,InvertStencilOp:bSe,KeepStencilOp:mS,KeyframeTrack:dp,LOD:tae,LatheGeometry:_3,Layers:Fw,LessCompare:Bse,LessDepth:QP,LessEqualCompare:Tq,LessEqualDepth:nT,LessEqualStencilFunc:xSe,LessStencilFunc:SSe,Light:Vb,LightProbe:Hae,Line:bb,Line3:m1e,LineBasicMaterial:nh,LineCurve:Iq,LineCurve3:fae,LineDashedMaterial:Rae,LineLoop:sae,LineSegments:Kg,LinearFilter:_a,LinearInterpolant:Hq,LinearMipMapLinearFilter:oSe,LinearMipMapNearestFilter:aSe,LinearMipmapLinearFilter:_g,LinearMipmapNearestFilter:MA,LinearSRGBColorSpace:Bg,LinearToneMapping:wse,LinearTransfer:TM,Loader:id,LoaderUtils:Vj,LoadingManager:Vq,LoopOnce:Ise,LoopPingPong:Dse,LoopRepeat:kse,MOUSE:tSe,Material:yl,MaterialLoader:C3,MathUtils:Gse,Matrix2:Kq,Matrix3:Zr,Matrix4:Nr,MaxEquation:lse,Mesh:Bo,MeshBasicMaterial:Hb,MeshDepthMaterial:Bq,MeshDistanceMaterial:Fq,MeshLambertMaterial:wae,MeshMatcapMaterial:Cae,MeshNormalMaterial:Uq,MeshPhongMaterial:Tae,MeshPhysicalMaterial:Sae,MeshStandardMaterial:Lq,MeshToonMaterial:xae,MinEquation:cse,MirroredRepeatWrapping:bM,MixOperation:Tse,MultiplyBlending:Pj,MultiplyOperation:KO,NearestFilter:Ja,NearestMipMapLinearFilter:sSe,NearestMipMapNearestFilter:iSe,NearestMipmapLinearFilter:N1,NearestMipmapNearestFilter:pq,NeutralToneMapping:Ose,NeverCompare:Use,NeverDepth:JP,NeverStencilFunc:ESe,NoBlending:Zf,NoColorSpace:Kp,NoToneMapping:em,NormalAnimationBlendMode:i3,NormalBlending:FS,NotEqualCompare:Hse,NotEqualDepth:rL,NotEqualStencilFunc:CSe,NumberKeyframeTrack:OM,Object3D:Gi,ObjectLoader:Fxe,ObjectSpaceNormalMap:Lse,OctahedronGeometry:iN,OneFactor:hse,OneMinusConstantAlphaFactor:Sse,OneMinusConstantColorFactor:bse,OneMinusDstAlphaFactor:mse,OneMinusDstColorFactor:vse,OneMinusSrcAlphaFactor:KP,OneMinusSrcColorFactor:fse,OrthographicCamera:cN,PCFShadowMap:JU,PCFSoftShadowMap:AA,PMREMGenerator:$j,Path:DL,PerspectiveCamera:Ic,Plane:Nf,PlaneGeometry:BC,PlaneHelper:R1e,PointLight:Lae,PointLightHelper:y1e,Points:aae,PointsMaterial:Mq,PolarGridHelper:S1e,PolyhedronGeometry:jb,PositionalAudio:Wxe,PropertyBinding:Yi,PropertyMixer:$ae,QuadraticBezierCurve:kq,QuadraticBezierCurve3:Dq,Quaternion:qh,QuaternionKeyframeTrack:oN,QuaternionLinearInterpolant:Iae,RED_GREEN_RGTC2_Format:AL,RED_RGTC1_Format:Eq,REVISION:XO,RGBADepthPacking:Pse,RGBAFormat:iu,RGBAIntegerFormat:ZO,RGBA_ASTC_10x10_Format:SL,RGBA_ASTC_10x5_Format:_L,RGBA_ASTC_10x6_Format:bL,RGBA_ASTC_10x8_Format:EL,RGBA_ASTC_12x10_Format:TL,RGBA_ASTC_12x12_Format:xL,RGBA_ASTC_4x4_Format:hL,RGBA_ASTC_5x4_Format:dL,RGBA_ASTC_5x5_Format:fL,RGBA_ASTC_6x5_Format:pL,RGBA_ASTC_6x6_Format:mL,RGBA_ASTC_8x5_Format:gL,RGBA_ASTC_8x6_Format:vL,RGBA_ASTC_8x8_Format:yL,RGBA_BPTC_Format:DA,RGBA_ETC2_EAC_Format:uL,RGBA_PVRTC_2BPPV1_Format:oL,RGBA_PVRTC_4BPPV1_Format:aL,RGBA_S3TC_DXT1_Format:NA,RGBA_S3TC_DXT3_Format:IA,RGBA_S3TC_DXT5_Format:kA,RGBDepthPacking:dSe,RGBFormat:_q,RGBIntegerFormat:cSe,RGB_BPTC_SIGNED_Format:wL,RGB_BPTC_UNSIGNED_Format:CL,RGB_ETC1_Format:cL,RGB_ETC2_Format:lL,RGB_PVRTC_2BPPV1_Format:sL,RGB_PVRTC_4BPPV1_Format:iL,RGB_S3TC_DXT1_Format:OA,RGDepthPacking:fSe,RGFormat:bq,RGIntegerFormat:r3,RawShaderMaterial:Eae,Ray:PC,Raycaster:Xq,RectAreaLight:Fae,RedFormat:n3,RedIntegerFormat:JO,ReinhardToneMapping:Cse,RenderTarget:s3,RenderTarget3D:o1e,RenderTargetArray:c1e,RepeatWrapping:_M,ReplaceStencilOp:mSe,ReverseSubtractEquation:ose,RingGeometry:b3,SIGNED_RED_GREEN_RGTC2_Format:ML,SIGNED_RED_RGTC1_Format:RL,SRGBColorSpace:ya,SRGBTransfer:ws,Scene:Hw,ShaderChunk:ri,ShaderLib:qp,ShaderMaterial:Bc,ShadowMaterial:bae,Shape:HS,ShapeGeometry:E3,ShapePath:O1e,ShapeUtils:Zp,ShortType:gq,Skeleton:u3,SkeletonHelper:v1e,SkinnedMesh:nae,Source:q_,Sphere:Dl,SphereGeometry:sN,Spherical:f1e,SphericalHarmonics3:zae,SplineCurve:Pq,SpotLight:Pae,SpotLightHelper:g1e,Sprite:eae,SpriteMaterial:Rq,SrcAlphaFactor:XP,SrcAlphaSaturateFactor:yse,SrcColorFactor:dse,StaticCopyUsage:kSe,StaticDrawUsage:xM,StaticReadUsage:OSe,StereoCamera:Vxe,StreamCopyUsage:PSe,StreamDrawUsage:MSe,StreamReadUsage:ISe,StringKeyframeTrack:FT,SubtractEquation:ase,SubtractiveBlending:Dj,TOUCH:nSe,TangentSpaceNormalMap:zb,TetrahedronGeometry:S3,Texture:Pa,TextureLoader:Pxe,TextureUtils:L1e,TimestampQuery:USe,TorusGeometry:T3,TorusKnotGeometry:x3,Triangle:Lh,TriangleFanDrawMode:hSe,TriangleStripDrawMode:uSe,TrianglesDrawMode:lSe,TubeGeometry:w3,UVMapping:ZU,Uint16BufferAttribute:wq,Uint32BufferAttribute:Cq,Uint8BufferAttribute:TTe,Uint8ClampedBufferAttribute:xTe,Uniform:Yr,UniformsGroup:u1e,UniformsLib:vn,UniformsUtils:Kse,UnsignedByteType:gl,UnsignedInt248Type:rT,UnsignedInt5999Type:vq,UnsignedIntType:Ug,UnsignedShort4444Type:e3,UnsignedShort5551Type:t3,UnsignedShortType:Lw,VSMShadowMap:jp,Vector2:Rt,Vector3:Re,Vector4:Ki,VectorKeyframeTrack:NM,VideoFrameTexture:$Te,VideoTexture:oae,WebGL3DRenderTarget:uTe,WebGLArrayRenderTarget:lTe,WebGLCoordinateSystem:$f,WebGLCubeRenderTarget:Zse,WebGLRenderTarget:Ul,WebGLRenderer:noe,WebGLUtils:toe,WebGPUCoordinateSystem:wM,WebXRController:FD,WireframeGeometry:_ae,WrapAroundEnding:SM,ZeroCurvatureEnding:IS,ZeroFactor:use,ZeroSlopeEnding:kS,ZeroStencilOp:pSe,createCanvasElement:$se},Symbol.toStringTag,{value:"Module"}));var roe={exports:{}},li={},Zq=Symbol.for("react.transitional.element"),yMe=Symbol.for("react.portal"),_Me=Symbol.for("react.fragment"),bMe=Symbol.for("react.strict_mode"),EMe=Symbol.for("react.profiler"),SMe=Symbol.for("react.consumer"),TMe=Symbol.for("react.context"),xMe=Symbol.for("react.forward_ref"),wMe=Symbol.for("react.suspense"),CMe=Symbol.for("react.memo"),ioe=Symbol.for("react.lazy"),$K=Symbol.iterator;function RMe(t){return t===null||typeof t!="object"?null:(t=$K&&t[$K]||t["@@iterator"],typeof t=="function"?t:null)}var soe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},aoe=Object.assign,ooe={};function zC(t,e,n){this.props=t,this.context=e,this.refs=ooe,this.updater=n||soe}zC.prototype.isReactComponent={};zC.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zC.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function coe(){}coe.prototype=zC.prototype;function Qq(t,e,n){this.props=t,this.context=e,this.refs=ooe,this.updater=n||soe}var e$=Qq.prototype=new coe;e$.constructor=Qq;aoe(e$,zC.prototype);e$.isPureReactComponent=!0;var WK=Array.isArray,ka={H:null,A:null,T:null,S:null,V:null},loe=Object.prototype.hasOwnProperty;function t$(t,e,n,r,i,s){return n=s.ref,{$$typeof:Zq,type:t,key:e,ref:n!==void 0?n:null,props:s}}function AMe(t,e){return t$(t.type,e,void 0,void 0,void 0,t.props)}function n$(t){return typeof t=="object"&&t!==null&&t.$$typeof===Zq}function MMe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var YK=/\/+/g;function t8(t,e){return typeof t=="object"&&t!==null&&t.key!=null?MMe(""+t.key):e.toString(36)}function XK(){}function OMe(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(XK,XK):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function b1(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"bigint":case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Zq:case yMe:a=!0;break;case ioe:return a=t._init,b1(a(t._payload),e,n,r,i)}}if(a)return i=i(t),a=r===""?"."+t8(t,0):r,WK(i)?(n="",a!=null&&(n=a.replace(YK,"$&/")+"/"),b1(i,e,n,"",function(l){return l})):i!=null&&(n$(i)&&(i=AMe(i,n+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(YK,"$&/")+"/")+a)),e.push(i)),1;a=0;var o=r===""?".":r+":";if(WK(t))for(var c=0;c<t.length;c++)r=t[c],s=o+t8(r,c),a+=b1(r,e,n,s,i);else if(c=RMe(t),typeof c=="function")for(t=c.call(t),c=0;!(r=t.next()).done;)r=r.value,s=o+t8(r,c++),a+=b1(r,e,n,s,i);else if(s==="object"){if(typeof t.then=="function")return b1(OMe(t),e,n,r,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function Ok(t,e,n){if(t==null)return t;var r=[],i=0;return b1(t,r,"","",function(s){return e.call(n,s,i++)}),r}function NMe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var KK=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof zn=="object"&&typeof zn.emit=="function"){zn.emit("uncaughtException",t);return}console.error(t)};function IMe(){}li.Children={map:Ok,forEach:function(t,e,n){Ok(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ok(t,function(){e++}),e},toArray:function(t){return Ok(t,function(e){return e})||[]},only:function(t){if(!n$(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};li.Component=zC;li.Fragment=_Me;li.Profiler=EMe;li.PureComponent=Qq;li.StrictMode=bMe;li.Suspense=wMe;li.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ka;li.__COMPILER_RUNTIME={__proto__:null,c:function(t){return ka.H.useMemoCache(t)}};li.cache=function(t){return function(){return t.apply(null,arguments)}};li.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var r=aoe({},t.props),i=t.key,s=void 0;if(e!=null)for(a in e.ref!==void 0&&(s=void 0),e.key!==void 0&&(i=""+e.key),e)!loe.call(e,a)||a==="key"||a==="__self"||a==="__source"||a==="ref"&&e.ref===void 0||(r[a]=e[a]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var o=Array(a),c=0;c<a;c++)o[c]=arguments[c+2];r.children=o}return t$(t.type,i,void 0,void 0,s,r)};li.createContext=function(t){return t={$$typeof:TMe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:SMe,_context:t},t};li.createElement=function(t,e,n){var r,i={},s=null;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)loe.call(e,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var o=Array(a),c=0;c<a;c++)o[c]=arguments[c+2];i.children=o}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return t$(t,s,void 0,void 0,null,i)};li.createRef=function(){return{current:null}};li.forwardRef=function(t){return{$$typeof:xMe,render:t}};li.isValidElement=n$;li.lazy=function(t){return{$$typeof:ioe,_payload:{_status:-1,_result:t},_init:NMe}};li.memo=function(t,e){return{$$typeof:CMe,type:t,compare:e===void 0?null:e}};li.startTransition=function(t){var e=ka.T,n={};ka.T=n;try{var r=t(),i=ka.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(IMe,KK)}catch(s){KK(s)}finally{ka.T=e}};li.unstable_useCacheRefresh=function(){return ka.H.useCacheRefresh()};li.use=function(t){return ka.H.use(t)};li.useActionState=function(t,e,n){return ka.H.useActionState(t,e,n)};li.useCallback=function(t,e){return ka.H.useCallback(t,e)};li.useContext=function(t){return ka.H.useContext(t)};li.useDebugValue=function(){};li.useDeferredValue=function(t,e){return ka.H.useDeferredValue(t,e)};li.useEffect=function(t,e,n){var r=ka.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(t,e)};li.useId=function(){return ka.H.useId()};li.useImperativeHandle=function(t,e,n){return ka.H.useImperativeHandle(t,e,n)};li.useInsertionEffect=function(t,e){return ka.H.useInsertionEffect(t,e)};li.useLayoutEffect=function(t,e){return ka.H.useLayoutEffect(t,e)};li.useMemo=function(t,e){return ka.H.useMemo(t,e)};li.useOptimistic=function(t,e){return ka.H.useOptimistic(t,e)};li.useReducer=function(t,e,n){return ka.H.useReducer(t,e,n)};li.useRef=function(t){return ka.H.useRef(t)};li.useState=function(t){return ka.H.useState(t)};li.useSyncExternalStore=function(t,e,n){return ka.H.useSyncExternalStore(t,e,n)};li.useTransition=function(){return ka.H.useTransition()};li.version="19.1.0";roe.exports=li;var Be=roe.exports;const xg=qc(Be);var uoe={exports:{}},Gb={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Gb.ConcurrentRoot=1;Gb.ContinuousEventPriority=8;Gb.DefaultEventPriority=32;Gb.DiscreteEventPriority=2;Gb.IdleEventPriority=268435456;Gb.LegacyRoot=0;Gb.NoEventPriority=0;uoe.exports=Gb;var HD=uoe.exports,hoe={exports:{}},doe={},foe={exports:{}},poe={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gw=Be;function kMe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var DMe=typeof Object.is=="function"?Object.is:kMe,PMe=Gw.useState,LMe=Gw.useEffect,UMe=Gw.useLayoutEffect,BMe=Gw.useDebugValue;function FMe(t,e){var n=e(),r=PMe({inst:{value:n,getSnapshot:e}}),i=r[0].inst,s=r[1];return UMe(function(){i.value=n,i.getSnapshot=e,n8(i)&&s({inst:i})},[t,n,e]),LMe(function(){return n8(i)&&s({inst:i}),t(function(){n8(i)&&s({inst:i})})},[t]),BMe(n),n}function n8(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!DMe(t,n)}catch{return!0}}function zMe(t,e){return e()}var HMe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?zMe:FMe;poe.useSyncExternalStore=Gw.useSyncExternalStore!==void 0?Gw.useSyncExternalStore:HMe;foe.exports=poe;var jMe=foe.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A3=Be,VMe=jMe;function GMe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var qMe=typeof Object.is=="function"?Object.is:GMe,$Me=VMe.useSyncExternalStore,WMe=A3.useRef,YMe=A3.useEffect,XMe=A3.useMemo,KMe=A3.useDebugValue;doe.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var s=WMe(null);if(s.current===null){var a={hasValue:!1,value:null};s.current=a}else a=s.current;s=XMe(function(){function c(f){if(!l){if(l=!0,u=f,f=r(f),i!==void 0&&a.hasValue){var p=a.value;if(i(p,f))return h=p}return h=f}if(p=h,qMe(u,f))return p;var g=r(f);return i!==void 0&&i(p,g)?(u=f,p):(u=f,h=g)}var l=!1,u,h,d=n===void 0?null:n;return[function(){return c(e())},d===null?void 0:function(){return c(d())}]},[e,n,r,i]);var o=$Me(t,s[0],s[1]);return YMe(function(){a.hasValue=!0,a.value=o},[o]),KMe(o),o};hoe.exports=doe;var JMe=hoe.exports;const ZMe=qc(JMe),JK=t=>{let e;const n=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const d=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(f=>f(e,d))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,o);return o},QMe=t=>t?JK(t):JK,{useSyncExternalStoreWithSelector:eOe}=ZMe,tOe=t=>t;function nOe(t,e=tOe,n){const r=eOe(t.subscribe,t.getState,t.getInitialState,e,n);return xg.useDebugValue(r),r}const ZK=(t,e)=>{const n=QMe(t),r=(i,s=e)=>nOe(n,i,s);return Object.assign(r,n),r},moe=(t,e)=>t?ZK(t,e):ZK;var goe={exports:{}},voe={exports:{}},yoe={exports:{}},_oe={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,Z){var Y=V.length;V.push(Z);e:for(;0<Y;){var ee=Y-1>>>1,oe=V[ee];if(0<i(oe,Z))V[ee]=Z,V[Y]=oe,Y=ee;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var Z=V[0],Y=V.pop();if(Y!==Z){V[0]=Y;e:for(var ee=0,oe=V.length,de=oe>>>1;ee<de;){var Me=2*(ee+1)-1,He=V[Me],Te=Me+1,Le=V[Te];if(0>i(He,Y))Te<oe&&0>i(Le,He)?(V[ee]=Le,V[Te]=Y,ee=Te):(V[ee]=He,V[Me]=Y,ee=Me);else if(Te<oe&&0>i(Le,Y))V[ee]=Le,V[Te]=Y,ee=Te;else break e}}return Z}function i(V,Z){var Y=V.sortIndex-Z.sortIndex;return Y!==0?Y:V.id-Z.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var c=[],l=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,_=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function T(V){for(var Z=n(l);Z!==null;){if(Z.callback===null)r(l);else if(Z.startTime<=V)r(l),Z.sortIndex=Z.expirationTime,e(c,Z);else break;Z=n(l)}}function x(V){if(g=!1,T(V),!p)if(n(c)!==null)p=!0,X();else{var Z=n(l);Z!==null&&re(x,Z.startTime-V)}}var N=!1,A=-1,I=5,k=-1;function L(){return!(t.unstable_now()-k<I)}function U(){if(N){var V=t.unstable_now();k=V;var Z=!0;try{e:{p=!1,g&&(g=!1,v(A),A=-1),f=!0;var Y=d;try{t:{for(T(V),h=n(c);h!==null&&!(h.expirationTime>V&&L());){var ee=h.callback;if(typeof ee=="function"){h.callback=null,d=h.priorityLevel;var oe=ee(h.expirationTime<=V);if(V=t.unstable_now(),typeof oe=="function"){h.callback=oe,T(V),Z=!0;break t}h===n(c)&&r(c),T(V)}else r(c);h=n(c)}if(h!==null)Z=!0;else{var de=n(l);de!==null&&re(x,de.startTime-V),Z=!1}}break e}finally{h=null,d=Y,f=!1}Z=void 0}}finally{Z?$():N=!1}}}var $;if(typeof E=="function")$=function(){E(U)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,G=q.port2;q.port1.onmessage=U,$=function(){G.postMessage(null)}}else $=function(){_(U,0)};function X(){N||(N=!0,$())}function re(V,Z){A=_(function(){V(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,X())},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(V){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var Y=d;d=Z;try{return V()}finally{d=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,Z){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Y=d;d=V;try{return Z()}finally{d=Y}},t.unstable_scheduleCallback=function(V,Z,Y){var ee=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ee+Y:ee):Y=ee,V){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Y+oe,V={id:u++,callback:Z,priorityLevel:V,startTime:Y,expirationTime:oe,sortIndex:-1},Y>ee?(V.sortIndex=Y,e(l,V),n(c)===null&&V===n(l)&&(g?(v(A),A=-1):g=!0,re(x,Y-ee))):(V.sortIndex=oe,e(c,V),p||f||(p=!0,X())),V},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(V){var Z=d;return function(){var Y=d;d=Z;try{return V.apply(this,arguments)}finally{d=Y}}}})(_oe);yoe.exports=_oe;var Yj=yoe.exports;(function(t){t.exports=function(e){function n(m,y,C,D){return new Ru(m,y,C,D)}function r(){}function i(m){var y="https://react.dev/errors/"+m;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)y+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+m+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(m){return m===null||typeof m!="object"?null:(m=ro&&m[ro]||m["@@iterator"],typeof m=="function"?m:null)}function a(m){if(m==null)return null;if(typeof m=="function")return m.$$typeof===wE?null:m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case gh:return"Fragment";case Rp:return"Portal";case vh:return"Profiler";case Jc:return"StrictMode";case z0:return"Suspense";case Mp:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case Au:return(m.displayName||"Context")+".Provider";case xE:return(m._context.displayName||"Context")+".Consumer";case Pm:var y=m.render;return m=m.displayName,m||(m=y.displayName||y.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case H0:return y=m.displayName||null,y!==null?y:a(m.type)||"Memo";case Mu:y=m._payload,m=m._init;try{return a(m(y))}catch{}}return null}function o(m){if(Lm===void 0)try{throw Error()}catch(C){var y=C.stack.trim().match(/\n( *(at )?)/);Lm=y&&y[1]||"",Hy=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Lm+m+Hy}function c(m,y){if(!m||Op)return"";Op=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(y){var xn=function(){throw Error()};if(Object.defineProperty(xn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xn,[])}catch(ei){var Rn=ei}Reflect.construct(m,[],xn)}else{try{xn.call()}catch(ei){Rn=ei}m.call(xn.prototype)}}else{try{throw Error()}catch(ei){Rn=ei}(xn=m())&&typeof xn.catch=="function"&&xn.catch(function(){})}}catch(ei){if(ei&&Rn&&typeof ei.stack=="string")return[ei.stack,Rn.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var J=D.DetermineComponentFrameRoot(),Se=J[0],ze=J[1];if(Se&&ze){var ut=Se.split(`
`),Dt=ze.split(`
`);for(z=D=0;D<ut.length&&!ut[D].includes("DetermineComponentFrameRoot");)D++;for(;z<Dt.length&&!Dt[z].includes("DetermineComponentFrameRoot");)z++;if(D===ut.length||z===Dt.length)for(D=ut.length-1,z=Dt.length-1;1<=D&&0<=z&&ut[D]!==Dt[z];)z--;for(;1<=D&&0<=z;D--,z--)if(ut[D]!==Dt[z]){if(D!==1||z!==1)do if(D--,z--,0>z||ut[D]!==Dt[z]){var en=`
`+ut[D].replace(" at new "," at ");return m.displayName&&en.includes("<anonymous>")&&(en=en.replace("<anonymous>",m.displayName)),en}while(1<=D&&0<=z);break}}}finally{Op=!1,Error.prepareStackTrace=C}return(C=m?m.displayName||m.name:"")?o(C):""}function l(m){switch(m.tag){case 26:case 27:case 5:return o(m.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return m=c(m.type,!1),m;case 11:return m=c(m.type.render,!1),m;case 1:return m=c(m.type,!0),m;default:return""}}function u(m){try{var y="";do y+=l(m),m=m.return;while(m);return y}catch(C){return`
Error generating stack: `+C.message+`
`+C.stack}}function h(m){var y=m,C=m;if(m.alternate)for(;y.return;)y=y.return;else{m=y;do y=m,y.flags&4098&&(C=y.return),m=y.return;while(m)}return y.tag===3?C:null}function d(m){if(h(m)!==m)throw Error(i(188))}function f(m){var y=m.alternate;if(!y){if(y=h(m),y===null)throw Error(i(188));return y!==m?null:m}for(var C=m,D=y;;){var z=C.return;if(z===null)break;var J=z.alternate;if(J===null){if(D=z.return,D!==null){C=D;continue}break}if(z.child===J.child){for(J=z.child;J;){if(J===C)return d(z),m;if(J===D)return d(z),y;J=J.sibling}throw Error(i(188))}if(C.return!==D.return)C=z,D=J;else{for(var Se=!1,ze=z.child;ze;){if(ze===C){Se=!0,C=z,D=J;break}if(ze===D){Se=!0,D=z,C=J;break}ze=ze.sibling}if(!Se){for(ze=J.child;ze;){if(ze===C){Se=!0,C=J,D=z;break}if(ze===D){Se=!0,D=J,C=z;break}ze=ze.sibling}if(!Se)throw Error(i(189))}}if(C.alternate!==D)throw Error(i(190))}if(C.tag!==3)throw Error(i(188));return C.stateNode.current===C?m:y}function p(m){var y=m.tag;if(y===5||y===26||y===27||y===6)return m;for(m=m.child;m!==null;){if(y=p(m),y!==null)return y;m=m.sibling}return null}function g(m){var y=m.tag;if(y===5||y===26||y===27||y===6)return m;for(m=m.child;m!==null;){if(m.tag!==4&&(y=g(m),y!==null))return y;m=m.sibling}return null}function _(m){return{current:m}}function v(m){0>yf||(m.current=ao[yf],ao[yf]=null,yf--)}function E(m,y){yf++,ao[yf]=m.current,m.current=y}function T(m){return m>>>=0,m===0?32:31-(TR(m)/Jy|0)|0}function x(m){var y=m&42;if(y!==0)return y;switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return m&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return m}}function N(m,y){var C=m.pendingLanes;if(C===0)return 0;var D=0,z=m.suspendedLanes,J=m.pingedLanes,Se=m.warmLanes;m=m.finishedLanes!==0;var ze=C&134217727;return ze!==0?(C=ze&~z,C!==0?D=x(C):(J&=ze,J!==0?D=x(J):m||(Se=ze&~Se,Se!==0&&(D=x(Se))))):(ze=C&~z,ze!==0?D=x(ze):J!==0?D=x(J):m||(Se=C&~Se,Se!==0&&(D=x(Se)))),D===0?0:y!==0&&y!==D&&!(y&z)&&(z=D&-D,Se=y&-y,z>=Se||z===32&&(Se&4194176)!==0)?y:D}function A(m,y){return(m.pendingLanes&~(m.suspendedLanes&~m.pingedLanes)&y)===0}function I(m,y){switch(m){case 1:case 2:case 4:case 8:return y+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k(){var m=Z0;return Z0<<=1,!(Z0&4194176)&&(Z0=128),m}function L(){var m=ja;return ja<<=1,!(ja&62914560)&&(ja=4194304),m}function U(m){for(var y=[],C=0;31>C;C++)y.push(m);return y}function $(m,y){m.pendingLanes|=y,y!==268435456&&(m.suspendedLanes=0,m.pingedLanes=0,m.warmLanes=0)}function q(m,y,C,D,z,J){var Se=m.pendingLanes;m.pendingLanes=C,m.suspendedLanes=0,m.pingedLanes=0,m.warmLanes=0,m.expiredLanes&=C,m.entangledLanes&=C,m.errorRecoveryDisabledLanes&=C,m.shellSuspendCounter=0;var ze=m.entanglements,ut=m.expirationTimes,Dt=m.hiddenUpdates;for(C=Se&~C;0<C;){var en=31-Jo(C),xn=1<<en;ze[en]=0,ut[en]=-1;var Rn=Dt[en];if(Rn!==null)for(Dt[en]=null,en=0;en<Rn.length;en++){var ei=Rn[en];ei!==null&&(ei.lane&=-536870913)}C&=~xn}D!==0&&G(m,D,0),J!==0&&z===0&&m.tag!==0&&(m.suspendedLanes|=J&~(Se&~y))}function G(m,y,C){m.pendingLanes|=y,m.suspendedLanes&=~y;var D=31-Jo(y);m.entangledLanes|=y,m.entanglements[D]=m.entanglements[D]|1073741824|C&4194218}function X(m,y){var C=m.entangledLanes|=y;for(m=m.entanglements;C;){var D=31-Jo(C),z=1<<D;z&y|m[D]&y&&(m[D]|=y),C&=~z}}function re(m){return m&=-m,2<m?8<m?m&134217727?32:268435456:8:2}function V(m){if(S&&typeof S.onCommitFiberRoot=="function")try{S.onCommitFiberRoot(O,m,void 0,(m.current.flags&128)===128)}catch{}}function Z(m){if(typeof Ym=="function"&&jE(m),S&&typeof S.setStrictMode=="function")try{S.setStrictMode(O,m)}catch{}}function Y(m,y){return m===y&&(m!==0||1/m===1/y)||m!==m&&y!==y}function ee(m,y){if(typeof m=="object"&&m!==null){var C=M.get(m);return C!==void 0?C:(y={value:m,source:y,stack:u(y)},M.set(m,y),y)}return{value:m,source:y,stack:u(y)}}function oe(m,y){P[B++]=te,P[B++]=H,H=m,te=y}function de(m,y,C){ie[K++]=he,ie[K++]=pe,ie[K++]=se,se=m;var D=he;m=pe;var z=32-Jo(D)-1;D&=~(1<<z),C+=1;var J=32-Jo(y)+z;if(30<J){var Se=z-z%5;J=(D&(1<<Se)-1).toString(32),D>>=Se,z-=Se,he=1<<32-Jo(y)+z|C<<z|D,pe=J+m}else he=1<<J|C<<z|D,pe=m}function Me(m){m.return!==null&&(oe(m,1),de(m,1,0))}function He(m){for(;m===H;)H=P[--B],P[B]=null,te=P[--B],P[B]=null;for(;m===se;)se=ie[--K],ie[K]=null,pe=ie[--K],ie[K]=null,he=ie[--K],ie[K]=null}function Te(m,y){E(Ye,y),E(Je,m),E(Ne,null),m=Um(y),v(Ne),E(Ne,m)}function Le(){v(Ne),v(Je),v(Ye)}function we(m){m.memoizedState!==null&&E(Oe,m);var y=Ne.current,C=Sx(y,m.type);y!==C&&(E(Je,m),E(Ne,C))}function Ce(m){Je.current===m&&(v(Ne),v(Je)),Oe.current===m&&(v(Oe),ql?xl._currentValue=vd:xl._currentValue2=vd)}function ke(m){var y=Error(i(418,""));throw et(ee(y,m)),Kn}function St(m,y){if(!Sl)throw Error(i(175));gR(m.stateNode,m.type,m.memoizedProps,y,m)||ke(m)}function At(m){for(_e=m.return;_e;)switch(_e.tag){case 3:case 27:It=!0;return;case 5:case 13:It=!1;return;default:_e=_e.return}}function Ee(m){if(!Sl||m!==_e)return!1;if(!wt)return At(m),wt=!0,!1;var y=!1;if(Ca?m.tag!==3&&m.tag!==27&&(m.tag!==5||Nx(m.type)&&!Bm(m.type,m.memoizedProps))&&(y=!0):m.tag!==3&&(m.tag!==5||Nx(m.type)&&!Bm(m.type,m.memoizedProps))&&(y=!0),y&&lt&&ke(m),At(m),m.tag===13){if(!Sl)throw Error(i(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));lt=qm(m)}else lt=_e?Yo(m.stateNode):null;return!0}function ye(){Sl&&(lt=_e=null,wt=!1)}function et(m){Kt===null?Kt=[m]:Kt.push(m)}function fe(){for(var m=yr,y=Fr=yr=0;y<m;){var C=wn[y];wn[y++]=null;var D=wn[y];wn[y++]=null;var z=wn[y];wn[y++]=null;var J=wn[y];if(wn[y++]=null,D!==null&&z!==null){var Se=D.pending;Se===null?z.next=z:(z.next=Se.next,Se.next=z),D.pending=z}J!==0&&dt(C,z,J)}}function Fe(m,y,C,D){wn[yr++]=m,wn[yr++]=y,wn[yr++]=C,wn[yr++]=D,Fr|=D,m.lanes|=D,m=m.alternate,m!==null&&(m.lanes|=D)}function Ie(m,y,C,D){return Fe(m,y,C,D),gt(m)}function rt(m,y){return Fe(m,null,null,y),gt(m)}function dt(m,y,C){m.lanes|=C;var D=m.alternate;D!==null&&(D.lanes|=C);for(var z=!1,J=m.return;J!==null;)J.childLanes|=C,D=J.alternate,D!==null&&(D.childLanes|=C),J.tag===22&&(m=J.stateNode,m===null||m._visibility&1||(z=!0)),m=J,J=J.return;z&&y!==null&&m.tag===3&&(J=m.stateNode,z=31-Jo(C),J=J.hiddenUpdates,m=J[z],m===null?J[z]=[y]:m.push(y),y.lane=C|536870912)}function gt(m){if(50<wR)throw wR=0,pz=null,Error(i(185));for(var y=m.return;y!==null;)m=y,y=m.return;return m.tag===3?m.stateNode:null}function bt(m){m!==xr&&m.next===null&&(xr===null?kr=xr=m:xr=xr.next=m),Rr=!0,_r||(_r=!0,Ue(ue))}function be(m,y){if(!Dr&&Rr){Dr=!0;do for(var C=!1,D=kr;D!==null;){if(m!==0){var z=D.pendingLanes;if(z===0)var J=0;else{var Se=D.suspendedLanes,ze=D.pingedLanes;J=(1<<31-Jo(42|m)+1)-1,J&=z&~(Se&~ze),J=J&201326677?J&201326677|1:J?J|2:0}J!==0&&(C=!0,$e(D,J))}else J=In,J=N(D,D===Mn?J:0),!(J&3)||A(D,J)||(C=!0,$e(D,J));D=D.next}while(C);Dr=!1}}function ue(){Rr=_r=!1;var m=0;br!==0&&(Tl()&&(m=br),br=0);for(var y=Jn(),C=null,D=kr;D!==null;){var z=D.next,J=Xe(D,y);J===0?(D.next=null,C===null?kr=z:C.next=z,z===null&&(xr=C)):(C=D,(m!==0||J&3)&&(Rr=!0)),D=z}be(m)}function Xe(m,y){for(var C=m.suspendedLanes,D=m.pingedLanes,z=m.expirationTimes,J=m.pendingLanes&-62914561;0<J;){var Se=31-Jo(J),ze=1<<Se,ut=z[Se];ut===-1?(!(ze&C)||ze&D)&&(z[Se]=I(ze,y)):ut<=y&&(m.expiredLanes|=ze),J&=~ze}if(y=Mn,C=In,C=N(m,m===y?C:0),D=m.callbackNode,C===0||m===y&&ln===2||m.cancelPendingCommit!==null)return D!==null&&D!==null&&Sh(D),m.callbackNode=null,m.callbackPriority=0;if(!(C&3)||A(m,C)){if(y=C&-C,y===m.callbackPriority)return y;switch(D!==null&&Sh(D),re(C)){case 2:case 8:C=oo;break;case 32:C=Is;break;case 268435456:C=_f;break;default:C=Is}return D=nt.bind(null,m),C=Ns(C,D),m.callbackPriority=y,m.callbackNode=C,y}return D!==null&&D!==null&&Sh(D),m.callbackPriority=2,m.callbackNode=null,2}function nt(m,y){var C=m.callbackNode;if(yc()&&m.callbackNode!==C)return null;var D=In;return D=N(m,m===Mn?D:0),D===0?null:(xu(m,D,y),Xe(m,Jn()),m.callbackNode!=null&&m.callbackNode===C?nt.bind(null,m):null)}function $e(m,y){if(yc())return null;xu(m,y,!0)}function Ue(m){Gy?tr(function(){Gt&6?Ns(kx,m):m()}):Ns(kx,m)}function qt(){return br===0&&(br=k()),br}function Mt(m,y){if(Ar===null){var C=Ar=[];ur=0,Tn=qt(),$n={status:"pending",value:void 0,then:function(D){C.push(D)}}}return ur++,y.then(Yt,Yt),y}function Yt(){if(--ur===0&&Ar!==null){$n!==null&&($n.status="fulfilled");var m=Ar;Ar=null,Tn=0,$n=null;for(var y=0;y<m.length;y++)(0,m[y])()}}function ce(m,y){var C=[],D={status:"pending",value:null,reason:null,then:function(z){C.push(z)}};return m.then(function(){D.status="fulfilled",D.value=y;for(var z=0;z<C.length;z++)(0,C[z])(y)},function(z){for(D.status="rejected",D.reason=z,z=0;z<C.length;z++)(0,C[z])(void 0)}),D}function j(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function W(m,y){m=m.updateQueue,y.updateQueue===m&&(y.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,callbacks:null})}function me(m){return{lane:m,tag:0,payload:null,callback:null,next:null}}function De(m,y,C){var D=m.updateQueue;if(D===null)return null;if(D=D.shared,Gt&2){var z=D.pending;return z===null?y.next=y:(y.next=z.next,z.next=y),D.pending=y,y=gt(m),dt(m,null,C),y}return Fe(m,D,y,C),gt(m)}function je(m,y,C){if(y=y.updateQueue,y!==null&&(y=y.shared,(C&4194176)!==0)){var D=y.lanes;D&=m.pendingLanes,C|=D,y.lanes=C,X(m,C)}}function mt(m,y){var C=m.updateQueue,D=m.alternate;if(D!==null&&(D=D.updateQueue,C===D)){var z=null,J=null;if(C=C.firstBaseUpdate,C!==null){do{var Se={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};J===null?z=J=Se:J=J.next=Se,C=C.next}while(C!==null);J===null?z=J=y:J=J.next=y}else z=J=y;C={baseState:D.baseState,firstBaseUpdate:z,lastBaseUpdate:J,shared:D.shared,callbacks:D.callbacks},m.updateQueue=C;return}m=C.lastBaseUpdate,m===null?C.firstBaseUpdate=y:m.next=y,C.lastBaseUpdate=y}function xt(){if(Ji){var m=$n;if(m!==null)throw m}}function Vn(m,y,C,D){Ji=!1;var z=m.updateQueue;$r=!1;var J=z.firstBaseUpdate,Se=z.lastBaseUpdate,ze=z.shared.pending;if(ze!==null){z.shared.pending=null;var ut=ze,Dt=ut.next;ut.next=null,Se===null?J=Dt:Se.next=Dt,Se=ut;var en=m.alternate;en!==null&&(en=en.updateQueue,ze=en.lastBaseUpdate,ze!==Se&&(ze===null?en.firstBaseUpdate=Dt:ze.next=Dt,en.lastBaseUpdate=ut))}if(J!==null){var xn=z.baseState;Se=0,en=Dt=ut=null,ze=J;do{var Rn=ze.lane&-536870913,ei=Rn!==ze.lane;if(ei?(In&Rn)===Rn:(D&Rn)===Rn){Rn!==0&&Rn===Tn&&(Ji=!0),en!==null&&(en=en.next={lane:0,tag:ze.tag,payload:ze.payload,callback:null,next:null});e:{var Tf=m,CR=ze;Rn=y;var GE=C;switch(CR.tag){case 1:if(Tf=CR.payload,typeof Tf=="function"){xn=Tf.call(GE,xn,Rn);break e}xn=Tf;break e;case 3:Tf.flags=Tf.flags&-65537|128;case 0:if(Tf=CR.payload,Rn=typeof Tf=="function"?Tf.call(GE,xn,Rn):Tf,Rn==null)break e;xn=mh({},xn,Rn);break e;case 2:$r=!0}}Rn=ze.callback,Rn!==null&&(m.flags|=64,ei&&(m.flags|=8192),ei=z.callbacks,ei===null?z.callbacks=[Rn]:ei.push(Rn))}else ei={lane:Rn,tag:ze.tag,payload:ze.payload,callback:ze.callback,next:null},en===null?(Dt=en=ei,ut=xn):en=en.next=ei,Se|=Rn;if(ze=ze.next,ze===null){if(ze=z.shared.pending,ze===null)break;ei=ze,ze=ei.next,ei.next=null,z.lastBaseUpdate=ei,z.shared.pending=null}}while(!0);en===null&&(ut=xn),z.baseState=ut,z.firstBaseUpdate=Dt,z.lastBaseUpdate=en,J===null&&(z.shared.lanes=0),Sc|=Se,m.lanes=Se,m.memoizedState=xn}}function qe(m,y){if(typeof m!="function")throw Error(i(191,m));m.call(y)}function Vt(m,y){var C=m.callbacks;if(C!==null)for(m.callbacks=null,m=0;m<C.length;m++)qe(C[m],y)}function ht(m,y){if(R(m,y))return!0;if(typeof m!="object"||m===null||typeof y!="object"||y===null)return!1;var C=Object.keys(m),D=Object.keys(y);if(C.length!==D.length)return!1;for(D=0;D<C.length;D++){var z=C[D];if(!ys.call(y,z)||!R(m[z],y[z]))return!1}return!0}function Pt(m){return m=m.status,m==="fulfilled"||m==="rejected"}function hn(){}function an(m,y,C){switch(C=m[C],C===void 0?m.push(y):C!==y&&(y.then(hn,hn),y=C),y.status){case"fulfilled":return y.value;case"rejected":throw m=y.reason,m===Zi?Error(i(483)):m;default:if(typeof y.status=="string")y.then(hn,hn);else{if(m=Mn,m!==null&&100<m.shellSuspendCounter)throw Error(i(482));m=y,m.status="pending",m.then(function(D){if(y.status==="pending"){var z=y;z.status="fulfilled",z.value=D}},function(D){if(y.status==="pending"){var z=y;z.status="rejected",z.reason=D}})}switch(y.status){case"fulfilled":return y.value;case"rejected":throw m=y.reason,m===Zi?Error(i(483)):m}throw Ii=y,Zi}}function Ve(){if(Ii===null)throw Error(i(459));var m=Ii;return Ii=null,m}function ot(m){var y=$i;return $i+=1,hi===null&&(hi=[]),an(hi,m,y)}function Ct(m,y){y=y.props.ref,m.ref=y!==void 0?y:null}function Nt(m,y){throw y.$$typeof===Cp?Error(i(525)):(m=Object.prototype.toString.call(y),Error(i(31,m==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":m)))}function Yn(m){var y=m._init;return y(m._payload)}function si(m){function y(Et,it){if(m){var Tt=Et.deletions;Tt===null?(Et.deletions=[it],Et.flags|=16):Tt.push(it)}}function C(Et,it){if(!m)return null;for(;it!==null;)y(Et,it),it=it.sibling;return null}function D(Et){for(var it=new Map;Et!==null;)Et.key!==null?it.set(Et.key,Et):it.set(Et.index,Et),Et=Et.sibling;return it}function z(Et,it){return Et=ph(Et,it),Et.index=0,Et.sibling=null,Et}function J(Et,it,Tt){return Et.index=Tt,m?(Tt=Et.alternate,Tt!==null?(Tt=Tt.index,Tt<it?(Et.flags|=33554434,it):Tt):(Et.flags|=33554434,it)):(Et.flags|=1048576,it)}function Se(Et){return m&&Et.alternate===null&&(Et.flags|=33554434),Et}function ze(Et,it,Tt,Jt){return it===null||it.tag!==6?(it=B0(Tt,Et.mode,Jt),it.return=Et,it):(it=z(it,Tt),it.return=Et,it)}function ut(Et,it,Tt,Jt){var hr=Tt.type;return hr===gh?en(Et,it,Tt.props.children,Jt,Tt.key):it!==null&&(it.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===Mu&&Yn(hr)===it.type)?(it=z(it,Tt.props),Ct(it,Tt),it.return=Et,it):(it=U0(Tt.type,Tt.key,Tt.props,null,Et.mode,Jt),Ct(it,Tt),it.return=Et,it)}function Dt(Et,it,Tt,Jt){return it===null||it.tag!==4||it.stateNode.containerInfo!==Tt.containerInfo||it.stateNode.implementation!==Tt.implementation?(it=Fy(Tt,Et.mode,Jt),it.return=Et,it):(it=z(it,Tt.children||[]),it.return=Et,it)}function en(Et,it,Tt,Jt,hr){return it===null||it.tag!==7?(it=gf(Tt,Et.mode,Jt,hr),it.return=Et,it):(it=z(it,Tt),it.return=Et,it)}function xn(Et,it,Tt){if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return it=B0(""+it,Et.mode,Tt),it.return=Et,it;if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Dm:return Tt=U0(it.type,it.key,it.props,null,Et.mode,Tt),Ct(Tt,it),Tt.return=Et,Tt;case Rp:return it=Fy(it,Et.mode,Tt),it.return=Et,it;case Mu:var Jt=it._init;return it=Jt(it._payload),xn(Et,it,Tt)}if(gd(it)||s(it))return it=gf(it,Et.mode,Tt,null),it.return=Et,it;if(typeof it.then=="function")return xn(Et,ot(it),Tt);if(it.$$typeof===Au)return xn(Et,Ai(Et,it),Tt);Nt(Et,it)}return null}function Rn(Et,it,Tt,Jt){var hr=it!==null?it.key:null;if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number"||typeof Tt=="bigint")return hr!==null?null:ze(Et,it,""+Tt,Jt);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case Dm:return Tt.key===hr?ut(Et,it,Tt,Jt):null;case Rp:return Tt.key===hr?Dt(Et,it,Tt,Jt):null;case Mu:return hr=Tt._init,Tt=hr(Tt._payload),Rn(Et,it,Tt,Jt)}if(gd(Tt)||s(Tt))return hr!==null?null:en(Et,it,Tt,Jt,null);if(typeof Tt.then=="function")return Rn(Et,it,ot(Tt),Jt);if(Tt.$$typeof===Au)return Rn(Et,it,Ai(Et,Tt),Jt);Nt(Et,Tt)}return null}function ei(Et,it,Tt,Jt,hr){if(typeof Jt=="string"&&Jt!==""||typeof Jt=="number"||typeof Jt=="bigint")return Et=Et.get(Tt)||null,ze(it,Et,""+Jt,hr);if(typeof Jt=="object"&&Jt!==null){switch(Jt.$$typeof){case Dm:return Et=Et.get(Jt.key===null?Tt:Jt.key)||null,ut(it,Et,Jt,hr);case Rp:return Et=Et.get(Jt.key===null?Tt:Jt.key)||null,Dt(it,Et,Jt,hr);case Mu:var ma=Jt._init;return Jt=ma(Jt._payload),ei(Et,it,Tt,Jt,hr)}if(gd(Jt)||s(Jt))return Et=Et.get(Tt)||null,en(it,Et,Jt,hr,null);if(typeof Jt.then=="function")return ei(Et,it,Tt,ot(Jt),hr);if(Jt.$$typeof===Au)return ei(Et,it,Tt,Ai(it,Jt),hr);Nt(it,Jt)}return null}function Tf(Et,it,Tt,Jt){for(var hr=null,ma=null,zr=it,ts=it=0,el=null;zr!==null&&ts<Tt.length;ts++){zr.index>ts?(el=zr,zr=null):el=zr.sibling;var ns=Rn(Et,zr,Tt[ts],Jt);if(ns===null){zr===null&&(zr=el);break}m&&zr&&ns.alternate===null&&y(Et,zr),it=J(ns,it,ts),ma===null?hr=ns:ma.sibling=ns,ma=ns,zr=el}if(ts===Tt.length)return C(Et,zr),wt&&oe(Et,ts),hr;if(zr===null){for(;ts<Tt.length;ts++)zr=xn(Et,Tt[ts],Jt),zr!==null&&(it=J(zr,it,ts),ma===null?hr=zr:ma.sibling=zr,ma=zr);return wt&&oe(Et,ts),hr}for(zr=D(zr);ts<Tt.length;ts++)el=ei(zr,Et,ts,Tt[ts],Jt),el!==null&&(m&&el.alternate!==null&&zr.delete(el.key===null?ts:el.key),it=J(el,it,ts),ma===null?hr=el:ma.sibling=el,ma=el);return m&&zr.forEach(function(t_){return y(Et,t_)}),wt&&oe(Et,ts),hr}function CR(Et,it,Tt,Jt){if(Tt==null)throw Error(i(151));for(var hr=null,ma=null,zr=it,ts=it=0,el=null,ns=Tt.next();zr!==null&&!ns.done;ts++,ns=Tt.next()){zr.index>ts?(el=zr,zr=null):el=zr.sibling;var t_=Rn(Et,zr,ns.value,Jt);if(t_===null){zr===null&&(zr=el);break}m&&zr&&t_.alternate===null&&y(Et,zr),it=J(t_,it,ts),ma===null?hr=t_:ma.sibling=t_,ma=t_,zr=el}if(ns.done)return C(Et,zr),wt&&oe(Et,ts),hr;if(zr===null){for(;!ns.done;ts++,ns=Tt.next())ns=xn(Et,ns.value,Jt),ns!==null&&(it=J(ns,it,ts),ma===null?hr=ns:ma.sibling=ns,ma=ns);return wt&&oe(Et,ts),hr}for(zr=D(zr);!ns.done;ts++,ns=Tt.next())ns=ei(zr,Et,ts,ns.value,Jt),ns!==null&&(m&&ns.alternate!==null&&zr.delete(ns.key===null?ts:ns.key),it=J(ns,it,ts),ma===null?hr=ns:ma.sibling=ns,ma=ns);return m&&zr.forEach(function(GEe){return y(Et,GEe)}),wt&&oe(Et,ts),hr}function GE(Et,it,Tt,Jt){if(typeof Tt=="object"&&Tt!==null&&Tt.type===gh&&Tt.key===null&&(Tt=Tt.props.children),typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case Dm:e:{for(var hr=Tt.key;it!==null;){if(it.key===hr){if(hr=Tt.type,hr===gh){if(it.tag===7){C(Et,it.sibling),Jt=z(it,Tt.props.children),Jt.return=Et,Et=Jt;break e}}else if(it.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===Mu&&Yn(hr)===it.type){C(Et,it.sibling),Jt=z(it,Tt.props),Ct(Jt,Tt),Jt.return=Et,Et=Jt;break e}C(Et,it);break}else y(Et,it);it=it.sibling}Tt.type===gh?(Jt=gf(Tt.props.children,Et.mode,Jt,Tt.key),Jt.return=Et,Et=Jt):(Jt=U0(Tt.type,Tt.key,Tt.props,null,Et.mode,Jt),Ct(Jt,Tt),Jt.return=Et,Et=Jt)}return Se(Et);case Rp:e:{for(hr=Tt.key;it!==null;){if(it.key===hr)if(it.tag===4&&it.stateNode.containerInfo===Tt.containerInfo&&it.stateNode.implementation===Tt.implementation){C(Et,it.sibling),Jt=z(it,Tt.children||[]),Jt.return=Et,Et=Jt;break e}else{C(Et,it);break}else y(Et,it);it=it.sibling}Jt=Fy(Tt,Et.mode,Jt),Jt.return=Et,Et=Jt}return Se(Et);case Mu:return hr=Tt._init,Tt=hr(Tt._payload),GE(Et,it,Tt,Jt)}if(gd(Tt))return Tf(Et,it,Tt,Jt);if(s(Tt)){if(hr=s(Tt),typeof hr!="function")throw Error(i(150));return Tt=hr.call(Tt),CR(Et,it,Tt,Jt)}if(typeof Tt.then=="function")return GE(Et,it,ot(Tt),Jt);if(Tt.$$typeof===Au)return GE(Et,it,Ai(Et,Tt),Jt);Nt(Et,Tt)}return typeof Tt=="string"&&Tt!==""||typeof Tt=="number"||typeof Tt=="bigint"?(Tt=""+Tt,it!==null&&it.tag===6?(C(Et,it.sibling),Jt=z(it,Tt),Jt.return=Et,Et=Jt):(C(Et,it),Jt=B0(Tt,Et.mode,Jt),Jt.return=Et,Et=Jt),Se(Et)):C(Et,it)}return function(Et,it,Tt,Jt){try{$i=0;var hr=GE(Et,it,Tt,Jt);return hi=null,hr}catch(zr){if(zr===Zi)throw zr;var ma=n(29,zr,null,Et.mode);return ma.lanes=Jt,ma.return=Et,ma}finally{}}}function Sr(m,y){m=ki,E(pa,m),E(Js,y),ki=m|y.baseLanes}function sr(){E(pa,ki),E(Js,Js.current)}function En(){ki=pa.current,v(Js),v(pa)}function sn(m){var y=m.alternate;E(di,di.current&1),E(_s,m),ks===null&&(y===null||Js.current!==null||y.memoizedState!==null)&&(ks=m)}function Ln(m){if(m.tag===22){if(E(di,di.current),E(_s,m),ks===null){var y=m.alternate;y!==null&&y.memoizedState!==null&&(ks=m)}}else Nn()}function Nn(){E(di,di.current),E(_s,_s.current)}function dr(m){v(_s),ks===m&&(ks=null),v(di)}function ui(m){for(var y=m;y!==null;){if(y.tag===13){var C=y.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||Vm(C)||fa(C)))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if(y.flags&128)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}function er(){throw Error(i(321))}function La(m,y){if(y===null)return!1;for(var C=0;C<y.length&&C<m.length;C++)if(!R(m[C],y[C]))return!1;return!0}function gu(m,y,C,D,z,J){return Ra=J,Zn=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,vr.H=m===null||m.memoizedState===null?co:Oo,bc=!1,J=C(D,z),bc=!1,Mo&&(J=_p(y,C,D,z)),nf(m),J}function nf(m){vr.H=Aa;var y=Gr!==null&&Gr.next!==null;if(Ra=0,Mi=Gr=Zn=null,Va=!1,ps=0,Zo=null,y)throw Error(i(300));m===null||Gs||(m=m.dependencies,m!==null&&_u(m)&&(Gs=!0))}function _p(m,y,C,D){Zn=m;var z=0;do{if(Mo&&(Zo=null),ps=0,Mo=!1,25<=z)throw Error(i(301));if(z+=1,Mi=Gr=null,m.updateQueue!=null){var J=m.updateQueue;J.lastEffect=null,J.events=null,J.stores=null,J.memoCache!=null&&(J.memoCache.index=0)}vr.H=Qo,J=y(C,D)}while(Mo);return J}function d0(){var m=vr.H,y=m.useState()[0];return y=typeof y.then=="function"?vt(y):y,m=m.useState()[0],(Gr!==null?Gr.memoizedState:null)!==m&&(Zn.flags|=1024),y}function rf(){var m=Qc!==0;return Qc=0,m}function sf(m,y,C){y.updateQueue=m.updateQueue,y.flags&=-2053,m.lanes&=~C}function vu(m){if(Va){for(m=m.memoizedState;m!==null;){var y=m.queue;y!==null&&(y.pending=null),m=m.next}Va=!1}Ra=0,Mi=Gr=Zn=null,Mo=!1,ps=Qc=0,Zo=null}function ve(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mi===null?Zn.memoizedState=Mi=m:Mi=Mi.next=m,Mi}function Ke(){if(Gr===null){var m=Zn.alternate;m=m!==null?m.memoizedState:null}else m=Gr.next;var y=Mi===null?Zn.memoizedState:Mi.next;if(y!==null)Mi=y,Gr=m;else{if(m===null)throw Zn.alternate===null?Error(i(467)):Error(i(310));Gr=m,m={memoizedState:Gr.memoizedState,baseState:Gr.baseState,baseQueue:Gr.baseQueue,queue:Gr.queue,next:null},Mi===null?Zn.memoizedState=Mi=m:Mi=Mi.next=m}return Mi}function vt(m){var y=ps;return ps+=1,Zo===null&&(Zo=[]),m=an(Zo,m,y),y=Zn,(Mi===null?y.memoizedState:Mi.next)===null&&(y=y.alternate,vr.H=y===null||y.memoizedState===null?co:Oo),m}function yt(m){if(m!==null&&typeof m=="object"){if(typeof m.then=="function")return vt(m);if(m.$$typeof===Au)return Ua(m)}throw Error(i(438,String(m)))}function Ze(m){var y=null,C=Zn.updateQueue;if(C!==null&&(y=C.memoCache),y==null){var D=Zn.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(y={data:D.data.map(function(z){return z.slice()}),index:0})))}if(y==null&&(y={data:[],index:0}),C===null&&(C=$l(),Zn.updateQueue=C),C.memoCache=y,C=y.data[y.index],C===void 0)for(C=y.data[y.index]=Array(m),D=0;D<m;D++)C[D]=fR;return y.index++,C}function Ht(m,y){return typeof y=="function"?y(m):y}function nn(m){var y=Ke();return mn(y,Gr,m)}function mn(m,y,C){var D=m.queue;if(D===null)throw Error(i(311));D.lastRenderedReducer=C;var z=m.baseQueue,J=D.pending;if(J!==null){if(z!==null){var Se=z.next;z.next=J.next,J.next=Se}y.baseQueue=z=J,D.pending=null}if(J=m.baseState,z===null)m.memoizedState=J;else{y=z.next;var ze=Se=null,ut=null,Dt=y,en=!1;do{var xn=Dt.lane&-536870913;if(xn!==Dt.lane?(In&xn)===xn:(Ra&xn)===xn){var Rn=Dt.revertLane;if(Rn===0)ut!==null&&(ut=ut.next={lane:0,revertLane:0,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null}),xn===Tn&&(en=!0);else if((Ra&Rn)===Rn){Dt=Dt.next,Rn===Tn&&(en=!0);continue}else xn={lane:0,revertLane:Dt.revertLane,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null},ut===null?(ze=ut=xn,Se=J):ut=ut.next=xn,Zn.lanes|=Rn,Sc|=Rn;xn=Dt.action,bc&&C(J,xn),J=Dt.hasEagerState?Dt.eagerState:C(J,xn)}else Rn={lane:xn,revertLane:Dt.revertLane,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null},ut===null?(ze=ut=Rn,Se=J):ut=ut.next=Rn,Zn.lanes|=xn,Sc|=xn;Dt=Dt.next}while(Dt!==null&&Dt!==y);if(ut===null?Se=J:ut.next=ze,!R(J,m.memoizedState)&&(Gs=!0,en&&(C=$n,C!==null)))throw C;m.memoizedState=J,m.baseState=Se,m.baseQueue=ut,D.lastRenderedState=J}return z===null&&(D.lanes=0),[m.memoizedState,D.dispatch]}function Sn(m){var y=Ke(),C=y.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=m;var D=C.dispatch,z=C.pending,J=y.memoizedState;if(z!==null){C.pending=null;var Se=z=z.next;do J=m(J,Se.action),Se=Se.next;while(Se!==z);R(J,y.memoizedState)||(Gs=!0),y.memoizedState=J,y.baseQueue===null&&(y.baseState=J),C.lastRenderedState=J}return[J,D]}function or(m,y,C){var D=Zn,z=Ke(),J=wt;if(J){if(C===void 0)throw Error(i(407));C=C()}else C=y();var Se=!R((Gr||z).memoizedState,C);if(Se&&(z.memoizedState=C,Gs=!0),z=z.queue,f0(gr.bind(null,D,z,m),[m]),z.getSnapshot!==y||Se||Mi!==null&&Mi.memoizedState.tag&1){if(D.flags|=2048,_l(9,Cn.bind(null,D,z,C,y),{destroy:void 0},null),Mn===null)throw Error(i(349));J||Ra&60||cr(D,y,C)}return C}function cr(m,y,C){m.flags|=16384,m={getSnapshot:y,value:C},y=Zn.updateQueue,y===null?(y=$l(),Zn.updateQueue=y,y.stores=[m]):(C=y.stores,C===null?y.stores=[m]:C.push(m))}function Cn(m,y,C,D){y.value=C,y.getSnapshot=D,ai(y)&&As(m)}function gr(m,y,C){return C(function(){ai(y)&&As(m)})}function ai(m){var y=m.getSnapshot;m=m.value;try{var C=y();return!R(m,C)}catch{return!0}}function As(m){var y=rt(m,2);y!==null&&qo(y,m,2)}function vs(m){var y=ve();if(typeof m=="function"){var C=m;if(m=C(),bc){Z(!0);try{C()}finally{Z(!1)}}}return y.memoizedState=y.baseState=m,y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ht,lastRenderedState:m},y}function Kr(m,y,C,D){return m.baseState=C,mn(m,Gr,typeof D=="function"?D:Ht)}function Xn(m,y,C,D,z){if(Oy(m))throw Error(i(485));if(m=y.action,m!==null){var J={payload:z,action:m,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Se){J.listeners.push(Se)}};vr.T!==null?C(!0):J.isTransition=!1,D(J),C=y.pending,C===null?(J.next=y.pending=J,Tr(y,J)):(J.next=C.next,y.pending=C.next=J)}}function Tr(m,y){var C=y.action,D=y.payload,z=m.state;if(y.isTransition){var J=vr.T,Se={};vr.T=Se;try{var ze=C(z,D),ut=vr.S;ut!==null&&ut(Se,ze),Bn(m,y,ze)}catch(Dt){zl(m,y,Dt)}finally{vr.T=J}}else try{J=C(z,D),Bn(m,y,J)}catch(Dt){zl(m,y,Dt)}}function Bn(m,y,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(D){Ho(m,y,D)},function(D){return zl(m,y,D)}):Ho(m,y,C)}function Ho(m,y,C){y.status="fulfilled",y.value=C,Qa(y),m.state=C,y=m.pending,y!==null&&(C=y.next,C===y?m.pending=null:(C=C.next,y.next=C,Tr(m,C)))}function zl(m,y,C){var D=m.pending;if(m.pending=null,D!==null){D=D.next;do y.status="rejected",y.reason=C,Qa(y),y=y.next;while(y!==D)}m.action=null}function Qa(m){m=m.listeners;for(var y=0;y<m.length;y++)(0,m[y])()}function ah(m,y){return y}function cs(m,y){if(wt){var C=Mn.formState;if(C!==null){e:{var D=Zn;if(wt){if(lt){var z=Gm(lt,It);if(z){lt=Yo(z),D=Yy(z);break e}}ke(D)}D=!1}D&&(y=C[0])}}C=ve(),C.memoizedState=C.baseState=y,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ah,lastRenderedState:y},C.queue=D,C=lE.bind(null,Zn,D),D.dispatch=C,D=vs(!1);var J=of.bind(null,Zn,!1,D.queue);return D=ve(),z={state:y,dispatch:null,action:m,pending:null},D.queue=z,C=Xn.bind(null,Zn,z,J,C),z.dispatch=C,D.memoizedState=m,[y,C,!1]}function bn(m){var y=Ke();return eo(y,Gr,m)}function eo(m,y,C){y=mn(m,y,ah)[0],m=nn(Ht)[0],y=typeof y=="object"&&y!==null&&typeof y.then=="function"?vt(y):y;var D=Ke(),z=D.queue,J=z.dispatch;return C!==D.memoizedState&&(Zn.flags|=2048,_l(9,Hs.bind(null,z,C),{destroy:void 0},null)),[y,J,m]}function Hs(m,y){m.action=y}function qn(m){var y=Ke(),C=Gr;if(C!==null)return eo(y,C,m);Ke(),y=y.memoizedState,C=Ke();var D=C.queue.dispatch;return C.memoizedState=m,[y,D,!1]}function _l(m,y,C,D){return m={tag:m,create:y,inst:C,deps:D,next:null},y=Zn.updateQueue,y===null&&(y=$l(),Zn.updateQueue=y),C=y.lastEffect,C===null?y.lastEffect=m.next=m:(D=C.next,C.next=m,m.next=D,y.lastEffect=m),m}function oa(){return Ke().memoizedState}function bp(m,y,C,D){var z=ve();Zn.flags|=m,z.memoizedState=_l(1|y,C,{destroy:void 0},D===void 0?null:D)}function ad(m,y,C,D){var z=Ke();D=D===void 0?null:D;var J=z.memoizedState.inst;Gr!==null&&D!==null&&La(D,Gr.memoizedState.deps)?z.memoizedState=_l(y,C,J,D):(Zn.flags|=m,z.memoizedState=_l(1|y,C,J,D))}function oh(m,y){bp(8390656,8,m,y)}function f0(m,y){ad(2048,8,m,y)}function Ry(m,y){return ad(4,2,m,y)}function p0(m,y){return ad(4,4,m,y)}function jo(m,y){if(typeof y=="function"){m=m();var C=y(m);return function(){typeof C=="function"?C():y(null)}}if(y!=null)return m=m(),y.current=m,function(){y.current=null}}function m0(m,y,C){C=C!=null?C.concat([m]):null,ad(4,4,jo.bind(null,y,m),C)}function Vo(){}function hx(m,y){var C=Ke();y=y===void 0?null:y;var D=C.memoizedState;return y!==null&&La(y,D[1])?D[0]:(C.memoizedState=[m,y],m)}function oE(m,y){var C=Ke();y=y===void 0?null:y;var D=C.memoizedState;if(y!==null&&La(y,D[1]))return D[0];if(D=m(),bc){Z(!0);try{m()}finally{Z(!1)}}return C.memoizedState=[D,y],D}function yu(m,y,C){return C===void 0||Ra&1073741824?m.memoizedState=y:(m.memoizedState=C,m=gE(),Zn.lanes|=m,Sc|=m,C)}function bm(m,y,C,D){return R(C,y)?C:Js.current!==null?(m=yu(m,C,D),R(m,y)||(Gs=!0),m):Ra&42?(m=gE(),Zn.lanes|=m,Sc|=m,y):(Gs=!0,m.memoizedState=C)}function od(m,y,C,D,z){var J=io();$o(J!==0&&8>J?J:8);var Se=vr.T,ze={};vr.T=ze,of(m,!1,y,C);try{var ut=z(),Dt=vr.S;if(Dt!==null&&Dt(ze,ut),ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var en=ce(ut,D);af(m,y,en,wo(m))}else af(m,y,D,wo(m))}catch(xn){af(m,y,{then:function(){},status:"rejected",reason:xn},wo())}finally{$o(J),vr.T=Se}}function Ss(m){var y=m.memoizedState;if(y!==null)return y;y={memoizedState:vd,baseState:vd,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ht,lastRenderedState:vd},next:null};var C={};return y.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ht,lastRenderedState:C},next:null},m.memoizedState=y,m=m.alternate,m!==null&&(m.memoizedState=y),y}function ch(){return Ua(xl)}function Ay(){return Ke().memoizedState}function cE(){return Ke().memoizedState}function My(m){for(var y=m.return;y!==null;){switch(y.tag){case 24:case 3:var C=wo();m=me(C);var D=De(y,m,C);D!==null&&(qo(D,y,C),je(D,y,C)),y={cache:Iy()},m.payload=y;return}y=y.return}}function dx(m,y,C){var D=wo();C={lane:D,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null},Oy(m)?uE(y,C):(C=Ie(m,y,C,D),C!==null&&(qo(C,m,D),hE(C,y,D)))}function lE(m,y,C){var D=wo();af(m,y,C,D)}function af(m,y,C,D){var z={lane:D,revertLane:0,action:C,hasEagerState:!1,eagerState:null,next:null};if(Oy(m))uE(y,z);else{var J=m.alternate;if(m.lanes===0&&(J===null||J.lanes===0)&&(J=y.lastRenderedReducer,J!==null))try{var Se=y.lastRenderedState,ze=J(Se,C);if(z.hasEagerState=!0,z.eagerState=ze,R(ze,Se))return Fe(m,y,z,0),Mn===null&&fe(),!1}catch{}finally{}if(C=Ie(m,y,z,D),C!==null)return qo(C,m,D),hE(C,y,D),!0}return!1}function of(m,y,C,D){if(D={lane:2,revertLane:qt(),action:D,hasEagerState:!1,eagerState:null,next:null},Oy(m)){if(y)throw Error(i(479))}else y=Ie(m,C,D,2),y!==null&&qo(y,m,2)}function Oy(m){var y=m.alternate;return m===Zn||y!==null&&y===Zn}function uE(m,y){Mo=Va=!0;var C=m.pending;C===null?y.next=y:(y.next=C.next,C.next=y),m.pending=y}function hE(m,y,C){if(C&4194176){var D=y.lanes;D&=m.pendingLanes,C|=D,y.lanes=C,X(m,C)}}function g0(m,y,C,D){y=m.memoizedState,C=C(D,y),C=C==null?y:mh({},y,C),m.memoizedState=C,m.lanes===0&&(m.updateQueue.baseState=C)}function Ny(m,y,C,D,z,J,Se){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(D,J,Se):y.prototype&&y.prototype.isPureReactComponent?!ht(C,D)||!ht(z,J):!0}function dE(m,y,C,D){m=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(C,D),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(C,D),y.state!==m&&bf.enqueueReplaceState(y,y.state,null)}function lh(m,y){var C=y;if("ref"in y){C={};for(var D in y)D!=="ref"&&(C[D]=y[D])}if(m=m.defaultProps){C===y&&(C=mh({},C));for(var z in m)C[z]===void 0&&(C[z]=m[z])}return C}function Em(m,y){try{var C=m.onUncaughtError;C(y.value,{componentStack:y.stack})}catch(D){setTimeout(function(){throw D})}}function fE(m,y,C){try{var D=m.onCaughtError;D(C.value,{componentStack:C.stack,errorBoundary:y.tag===1?y.stateNode:null})}catch(z){setTimeout(function(){throw z})}}function hc(m,y,C){return C=me(C),C.tag=3,C.payload={element:null},C.callback=function(){Em(m,y)},C}function Ms(m){return m=me(m),m.tag=3,m}function cd(m,y,C,D){var z=C.type.getDerivedStateFromError;if(typeof z=="function"){var J=D.value;m.payload=function(){return z(J)},m.callback=function(){fE(y,C,D)}}var Se=C.stateNode;Se!==null&&typeof Se.componentDidCatch=="function"&&(m.callback=function(){fE(y,C,D),typeof z!="function"&&(Td===null?Td=new Set([this]):Td.add(this));var ze=D.stack;this.componentDidCatch(D.value,{componentStack:ze!==null?ze:""})})}function fx(m,y,C,D,z){if(C.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(y=C.alternate,y!==null&&_0(y,C,z,!0),C=_s.current,C!==null){switch(C.tag){case 13:return ks===null?Ba():C.alternate===null&&fi===0&&(fi=3),C.flags&=-257,C.flags|=65536,C.lanes=z,D===Qi?C.flags|=16384:(y=C.updateQueue,y===null?C.updateQueue=new Set([D]):y.add(D),D0(m,D,z)),!1;case 22:return C.flags|=65536,D===Qi?C.flags|=16384:(y=C.updateQueue,y===null?(y={transitions:null,markerInstances:null,retryQueue:new Set([D])},C.updateQueue=y):(C=y.retryQueue,C===null?y.retryQueue=new Set([D]):C.add(D)),D0(m,D,z)),!1}throw Error(i(435,C.tag))}return D0(m,D,z),Ba(),!1}if(wt)return y=_s.current,y!==null?(!(y.flags&65536)&&(y.flags|=256),y.flags|=65536,y.lanes=z,D!==Kn&&(m=Error(i(422),{cause:D}),et(ee(m,C)))):(D!==Kn&&(y=Error(i(423),{cause:D}),et(ee(y,C))),m=m.current.alternate,m.flags|=65536,z&=-z,m.lanes|=z,D=ee(D,C),z=hc(m.stateNode,D,z),mt(m,z),fi!==4&&(fi=2)),!1;var J=Error(i(520),{cause:D});if(J=ee(J,C),Ed===null?Ed=[J]:Ed.push(J),fi!==4&&(fi=2),y===null)return!0;D=ee(D,C),C=y;do{switch(C.tag){case 3:return C.flags|=65536,m=z&-z,C.lanes|=m,m=hc(C.stateNode,D,m),mt(C,m),!1;case 1:if(y=C.type,J=C.stateNode,(C.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(Td===null||!Td.has(J))))return C.flags|=65536,z&=-z,C.lanes|=z,z=Ms(z),cd(z,m,C,D),mt(C,z),!1}C=C.return}while(C!==null);return!1}function ca(m,y,C,D){y.child=m===null?fs(y,null,C,D):es(y,m.child,C,D)}function px(m,y,C,D,z){C=C.render;var J=y.ref;if("ref"in D){var Se={};for(var ze in D)ze!=="ref"&&(Se[ze]=D[ze])}else Se=D;return Yc(y),D=gu(m,y,C,Se,J,z),ze=rf(),m!==null&&!Gs?(sf(m,y,z),jr(m,y,z)):(wt&&ze&&Me(y),y.flags|=1,ca(m,y,D,z),y.child)}function v0(m,y,C,D,z){if(m===null){var J=C.type;return typeof J=="function"&&!P0(J)&&J.defaultProps===void 0&&C.compare===null?(y.tag=15,y.type=J,mx(m,y,J,D,z)):(m=U0(C.type,null,D,y,y.mode,z),m.ref=y.ref,m.return=y,y.child=m)}if(J=m.child,!la(m,z)){var Se=J.memoizedProps;if(C=C.compare,C=C!==null?C:ht,C(Se,D)&&m.ref===y.ref)return jr(m,y,z)}return y.flags|=1,m=ph(J,D),m.ref=y.ref,m.return=y,y.child=m}function mx(m,y,C,D,z){if(m!==null){var J=m.memoizedProps;if(ht(J,D)&&m.ref===y.ref)if(Gs=!1,y.pendingProps=D=J,la(m,z))m.flags&131072&&(Gs=!0);else return y.lanes=m.lanes,jr(m,y,z)}return dc(m,y,C,D,z)}function cf(m,y,C){var D=y.pendingProps,z=D.children,J=(y.stateNode._pendingVisibility&2)!==0,Se=m!==null?m.memoizedState:null;if(to(m,y),D.mode==="hidden"||J){if(y.flags&128){if(D=Se!==null?Se.baseLanes|C:C,m!==null){for(z=y.child=m.child,J=0;z!==null;)J=J|z.lanes|z.childLanes,z=z.sibling;y.childLanes=J&~D}else y.childLanes=0,y.child=null;return Sm(m,y,D,C)}if(C&536870912)y.memoizedState={baseLanes:0,cachePool:null},m!==null&&ky(y,Se!==null?Se.cachePool:null),Se!==null?Sr(y,Se):sr(),Ln(y);else return y.lanes=y.childLanes=536870912,Sm(m,y,Se!==null?Se.baseLanes|C:C,C)}else Se!==null?(ky(y,Se.cachePool),Sr(y,Se),Nn(),y.memoizedState=null):(m!==null&&ky(y,null),sr(),Nn());return ca(m,y,z,C),y.child}function Sm(m,y,C,D){var z=uf();return z=z===null?null:{parent:ql?Wi._currentValue:Wi._currentValue2,pool:z},y.memoizedState={baseLanes:C,cachePool:z},m!==null&&ky(y,null),sr(),Ln(y),m!==null&&_0(m,y,D,!0),null}function to(m,y){var C=y.ref;if(C===null)m!==null&&m.ref!==null&&(y.flags|=2097664);else{if(typeof C!="function"&&typeof C!="object")throw Error(i(284));(m===null||m.ref!==C)&&(y.flags|=2097664)}}function dc(m,y,C,D,z){return Yc(y),C=gu(m,y,C,D,void 0,z),D=rf(),m!==null&&!Gs?(sf(m,y,z),jr(m,y,z)):(wt&&D&&Me(y),y.flags|=1,ca(m,y,C,z),y.child)}function Tm(m,y,C,D,z,J){return Yc(y),y.updateQueue=null,C=_p(y,D,C,z),nf(m),D=rf(),m!==null&&!Gs?(sf(m,y,J),jr(m,y,J)):(wt&&D&&Me(y),y.flags|=1,ca(m,y,C,J),y.child)}function gx(m,y,C,D,z){if(Yc(y),y.stateNode===null){var J=Ko,Se=C.contextType;typeof Se=="object"&&Se!==null&&(J=Ua(Se)),J=new C(D,J),y.memoizedState=J.state!==null&&J.state!==void 0?J.state:null,J.updater=bf,y.stateNode=J,J._reactInternals=y,J=y.stateNode,J.props=D,J.state=y.memoizedState,J.refs={},j(y),Se=C.contextType,J.context=typeof Se=="object"&&Se!==null?Ua(Se):Ko,J.state=y.memoizedState,Se=C.getDerivedStateFromProps,typeof Se=="function"&&(g0(y,C,Se,D),J.state=y.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof J.getSnapshotBeforeUpdate=="function"||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(Se=J.state,typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount(),Se!==J.state&&bf.enqueueReplaceState(J,J.state,null),Vn(y,D,J,z),xt(),J.state=y.memoizedState),typeof J.componentDidMount=="function"&&(y.flags|=4194308),D=!0}else if(m===null){J=y.stateNode;var ze=y.memoizedProps,ut=lh(C,ze);J.props=ut;var Dt=J.context,en=C.contextType;Se=Ko,typeof en=="object"&&en!==null&&(Se=Ua(en));var xn=C.getDerivedStateFromProps;en=typeof xn=="function"||typeof J.getSnapshotBeforeUpdate=="function",ze=y.pendingProps!==ze,en||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(ze||Dt!==Se)&&dE(y,J,D,Se),$r=!1;var Rn=y.memoizedState;J.state=Rn,Vn(y,D,J,z),xt(),Dt=y.memoizedState,ze||Rn!==Dt||$r?(typeof xn=="function"&&(g0(y,C,xn,D),Dt=y.memoizedState),(ut=$r||Ny(y,C,ut,D,Rn,Dt,Se))?(en||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount()),typeof J.componentDidMount=="function"&&(y.flags|=4194308)):(typeof J.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=D,y.memoizedState=Dt),J.props=D,J.state=Dt,J.context=Se,D=ut):(typeof J.componentDidMount=="function"&&(y.flags|=4194308),D=!1)}else{J=y.stateNode,W(m,y),Se=y.memoizedProps,en=lh(C,Se),J.props=en,xn=y.pendingProps,Rn=J.context,Dt=C.contextType,ut=Ko,typeof Dt=="object"&&Dt!==null&&(ut=Ua(Dt)),ze=C.getDerivedStateFromProps,(Dt=typeof ze=="function"||typeof J.getSnapshotBeforeUpdate=="function")||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(Se!==xn||Rn!==ut)&&dE(y,J,D,ut),$r=!1,Rn=y.memoizedState,J.state=Rn,Vn(y,D,J,z),xt();var ei=y.memoizedState;Se!==xn||Rn!==ei||$r||m!==null&&m.dependencies!==null&&_u(m.dependencies)?(typeof ze=="function"&&(g0(y,C,ze,D),ei=y.memoizedState),(en=$r||Ny(y,C,en,D,Rn,ei,ut)||m!==null&&m.dependencies!==null&&_u(m.dependencies))?(Dt||typeof J.UNSAFE_componentWillUpdate!="function"&&typeof J.componentWillUpdate!="function"||(typeof J.componentWillUpdate=="function"&&J.componentWillUpdate(D,ei,ut),typeof J.UNSAFE_componentWillUpdate=="function"&&J.UNSAFE_componentWillUpdate(D,ei,ut)),typeof J.componentDidUpdate=="function"&&(y.flags|=4),typeof J.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof J.componentDidUpdate!="function"||Se===m.memoizedProps&&Rn===m.memoizedState||(y.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||Se===m.memoizedProps&&Rn===m.memoizedState||(y.flags|=1024),y.memoizedProps=D,y.memoizedState=ei),J.props=D,J.state=ei,J.context=ut,D=en):(typeof J.componentDidUpdate!="function"||Se===m.memoizedProps&&Rn===m.memoizedState||(y.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||Se===m.memoizedProps&&Rn===m.memoizedState||(y.flags|=1024),D=!1)}return J=D,to(m,y),D=(y.flags&128)!==0,J||D?(J=y.stateNode,C=D&&typeof C.getDerivedStateFromError!="function"?null:J.render(),y.flags|=1,m!==null&&D?(y.child=es(y,m.child,null,z),y.child=es(y,null,C,z)):ca(m,y,C,z),y.memoizedState=J.state,m=y.child):m=jr(m,y,z),m}function Ta(m,y,C,D){return ye(),y.flags|=256,ca(m,y,C,D),y.child}function Xs(m){return{baseLanes:m,cachePool:vx()}}function y0(m,y,C){return m=m!==null?m.childLanes&~C:0,y&&(m|=Yl),m}function ld(m,y,C){var D=y.pendingProps,z=!1,J=(y.flags&128)!==0,Se;if((Se=J)||(Se=m!==null&&m.memoizedState===null?!1:(di.current&2)!==0),Se&&(z=!0,y.flags&=-129),Se=(y.flags&32)!==0,y.flags&=-33,m===null){if(wt){if(z?sn(y):Nn(),wt){var ze=lt,ut;(ut=ze)&&(ze=bi(ze,It),ze!==null?(y.memoizedState={dehydrated:ze,treeContext:se!==null?{id:he,overflow:pe}:null,retryLane:536870912},ut=n(18,null,null,0),ut.stateNode=ze,ut.return=y,y.child=ut,_e=y,lt=null,ut=!0):ut=!1),ut||ke(y)}if(ze=y.memoizedState,ze!==null&&(ze=ze.dehydrated,ze!==null))return fa(ze)?y.lanes=16:y.lanes=536870912,null;dr(y)}return ze=D.children,D=D.fallback,z?(Nn(),z=y.mode,ze=ft({mode:"hidden",children:ze},z),D=gf(D,z,C,null),ze.return=y,D.return=y,ze.sibling=D,y.child=ze,z=y.child,z.memoizedState=Xs(C),z.childLanes=y0(m,Se,C),y.memoizedState=bd,D):(sn(y),Ep(y,ze))}if(ut=m.memoizedState,ut!==null&&(ze=ut.dehydrated,ze!==null)){if(J)y.flags&256?(sn(y),y.flags&=-257,y=at(m,y,C)):y.memoizedState!==null?(Nn(),y.child=m.child,y.flags|=128,y=null):(Nn(),z=D.fallback,ze=y.mode,D=ft({mode:"visible",children:D.children},ze),z=gf(z,ze,C,null),z.flags|=2,D.return=y,z.return=y,D.sibling=z,y.child=D,es(y,m.child,null,C),D=y.child,D.memoizedState=Xs(C),D.childLanes=y0(m,Se,C),y.memoizedState=bd,y=z);else if(sn(y),fa(ze))Se=_h(ze).digest,D=Error(i(419)),D.stack="",D.digest=Se,et({value:D,source:null,stack:null}),y=at(m,y,C);else if(Gs||_0(m,y,C,!1),Se=(C&m.childLanes)!==0,Gs||Se){if(Se=Mn,Se!==null){if(D=C&-C,D&42)D=1;else switch(D){case 2:D=1;break;case 8:D=4;break;case 32:D=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:D=64;break;case 268435456:D=134217728;break;default:D=0}if(D=D&(Se.suspendedLanes|C)?0:D,D!==0&&D!==ut.retryLane)throw ut.retryLane=D,rt(m,D),qo(Se,m,D),Pp}Vm(ze)||Ba(),y=at(m,y,C)}else Vm(ze)?(y.flags|=128,y.child=m.child,y=EE.bind(null,m),Mx(ze,y),y=null):(m=ut.treeContext,Sl&&(lt=PE(ze),_e=y,wt=!0,Kt=null,It=!1,m!==null&&(ie[K++]=he,ie[K++]=pe,ie[K++]=se,he=m.id,pe=m.overflow,se=y)),y=Ep(y,D.children),y.flags|=4096);return y}return z?(Nn(),z=D.fallback,ze=y.mode,ut=m.child,J=ut.sibling,D=ph(ut,{mode:"hidden",children:D.children}),D.subtreeFlags=ut.subtreeFlags&31457280,J!==null?z=ph(J,z):(z=gf(z,ze,C,null),z.flags|=2),z.return=y,D.return=y,D.sibling=z,y.child=D,D=z,z=y.child,ze=m.child.memoizedState,ze===null?ze=Xs(C):(ut=ze.cachePool,ut!==null?(J=ql?Wi._currentValue:Wi._currentValue2,ut=ut.parent!==J?{parent:J,pool:J}:ut):ut=vx(),ze={baseLanes:ze.baseLanes|C,cachePool:ut}),z.memoizedState=ze,z.childLanes=y0(m,Se,C),y.memoizedState=bd,D):(sn(y),C=m.child,m=C.sibling,C=ph(C,{mode:"visible",children:D.children}),C.return=y,C.sibling=null,m!==null&&(Se=y.deletions,Se===null?(y.deletions=[m],y.flags|=16):Se.push(m)),y.child=C,y.memoizedState=null,C)}function Ep(m,y){return y=ft({mode:"visible",children:y},m.mode),y.return=m,m.child=y}function ft(m,y){return SE(m,y,0,null)}function at(m,y,C){return es(y,m.child,null,C),m=Ep(y,y.pendingProps.children),m.flags|=2,y.memoizedState=null,m}function Ft(m,y,C){m.lanes|=y;var D=m.alternate;D!==null&&(D.lanes|=y),Wc(m.return,y,C)}function fn(m,y,C,D,z){var J=m.memoizedState;J===null?m.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:D,tail:C,tailMode:z}:(J.isBackwards=y,J.rendering=null,J.renderingStartTime=0,J.last=D,J.tail=C,J.tailMode=z)}function Xt(m,y,C){var D=y.pendingProps,z=D.revealOrder,J=D.tail;if(ca(m,y,D.children,C),D=di.current,D&2)D=D&1|2,y.flags|=128;else{if(m!==null&&m.flags&128)e:for(m=y.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&Ft(m,C,y);else if(m.tag===19)Ft(m,C,y);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===y)break e;for(;m.sibling===null;){if(m.return===null||m.return===y)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}D&=1}switch(E(di,D),z){case"forwards":for(C=y.child,z=null;C!==null;)m=C.alternate,m!==null&&ui(m)===null&&(z=C),C=C.sibling;C=z,C===null?(z=y.child,y.child=null):(z=C.sibling,C.sibling=null),fn(y,!1,z,C,J);break;case"backwards":for(C=null,z=y.child,y.child=null;z!==null;){if(m=z.alternate,m!==null&&ui(m)===null){y.child=z;break}m=z.sibling,z.sibling=C,C=z,z=m}fn(y,!0,C,null,J);break;case"together":fn(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function jr(m,y,C){if(m!==null&&(y.dependencies=m.dependencies),Sc|=y.lanes,!(C&y.childLanes))if(m!==null){if(_0(m,y,C,!1),(C&y.childLanes)===0)return null}else return null;if(m!==null&&y.child!==m.child)throw Error(i(153));if(y.child!==null){for(m=y.child,C=ph(m,m.pendingProps),y.child=C,C.return=y;m.sibling!==null;)m=m.sibling,C=C.sibling=ph(m,m.pendingProps),C.return=y;C.sibling=null}return y.child}function la(m,y){return m.lanes&y?!0:(m=m.dependencies,!!(m!==null&&_u(m)))}function uh(m,y,C){switch(y.tag){case 3:Te(y,y.stateNode.containerInfo),Hl(y,Wi,m.memoizedState.cache),ye();break;case 27:case 5:we(y);break;case 4:Te(y,y.stateNode.containerInfo);break;case 10:Hl(y,y.type,y.memoizedProps.value);break;case 13:var D=y.memoizedState;if(D!==null)return D.dehydrated!==null?(sn(y),y.flags|=128,null):C&y.child.childLanes?ld(m,y,C):(sn(y),m=jr(m,y,C),m!==null?m.sibling:null);sn(y);break;case 19:var z=(m.flags&128)!==0;if(D=(C&y.childLanes)!==0,D||(_0(m,y,C,!1),D=(C&y.childLanes)!==0),z){if(D)return Xt(m,y,C);y.flags|=128}if(z=y.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),E(di,di.current),D)break;return null;case 22:case 23:return y.lanes=0,cf(m,y,C);case 24:Hl(y,Wi,m.memoizedState.cache)}return jr(m,y,C)}function Jr(m,y,C){if(m!==null)if(m.memoizedProps!==y.pendingProps)Gs=!0;else{if(!la(m,C)&&!(y.flags&128))return Gs=!1,uh(m,y,C);Gs=!!(m.flags&131072)}else Gs=!1,wt&&y.flags&1048576&&de(y,te,y.index);switch(y.lanes=0,y.tag){case 16:e:{m=y.pendingProps;var D=y.elementType,z=D._init;if(D=z(D._payload),y.type=D,typeof D=="function")P0(D)?(m=lh(D,m),y.tag=1,y=gx(null,y,D,m,C)):(y.tag=0,y=dc(null,y,D,m,C));else{if(D!=null){if(z=D.$$typeof,z===Pm){y.tag=11,y=px(null,y,D,m,C);break e}else if(z===H0){y.tag=14,y=v0(null,y,D,m,C);break e}}throw y=a(D)||D,Error(i(306,y,""))}}return y;case 0:return dc(m,y,y.type,y.pendingProps,C);case 1:return D=y.type,z=lh(D,y.pendingProps),gx(m,y,D,z,C);case 3:e:{if(Te(y,y.stateNode.containerInfo),m===null)throw Error(i(387));var J=y.pendingProps;z=y.memoizedState,D=z.element,W(m,y),Vn(y,J,null,C);var Se=y.memoizedState;if(J=Se.cache,Hl(y,Wi,J),J!==z.cache&&xm(y,[Wi],C,!0),xt(),J=Se.element,Sl&&z.isDehydrated)if(z={element:J,isDehydrated:!1,cache:Se.cache},y.updateQueue.baseState=z,y.memoizedState=z,y.flags&256){y=Ta(m,y,J,C);break e}else if(J!==D){D=ee(Error(i(424)),y),et(D),y=Ta(m,y,J,C);break e}else for(Sl&&(lt=Ao(y.stateNode.containerInfo),_e=y,wt=!0,Kt=null,It=!0),C=fs(y,null,J,C),y.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(ye(),J===D){y=jr(m,y,C);break e}ca(m,y,J,C)}y=y.child}return y;case 26:if(so)return to(m,y),m===null?(C=Eh(y.type,null,y.pendingProps,null))?y.memoizedState=C:wt||(y.stateNode=ER(y.type,y.pendingProps,Ye.current,y)):y.memoizedState=Eh(y.type,m.memoizedProps,y.pendingProps,m.memoizedState),null;case 27:if(Ca)return we(y),m===null&&Ca&&wt&&(D=y.stateNode=Wm(y.type,y.pendingProps,Ye.current,Ne.current,!1),_e=y,It=!0,lt=Ro(D)),D=y.pendingProps.children,m!==null||wt?ca(m,y,D,C):y.child=es(y,null,D,C),to(m,y),y.child;case 5:return m===null&&wt&&(Pu(y.type,y.pendingProps,Ne.current),(z=D=lt)&&(D=Ox(D,y.type,y.pendingProps,It),D!==null?(y.stateNode=D,_e=y,lt=Ro(D),It=!1,z=!0):z=!1),z||ke(y)),we(y),z=y.type,J=y.pendingProps,Se=m!==null?m.memoizedProps:null,D=J.children,Bm(z,J)?D=null:Se!==null&&Bm(z,Se)&&(y.flags|=32),y.memoizedState!==null&&(z=gu(m,y,d0,null,null,C),ql?xl._currentValue=z:xl._currentValue2=z),to(m,y),ca(m,y,D,C),y.child;case 6:return m===null&&wt&&(Lu(y.pendingProps,Ne.current),(m=C=lt)&&(C=yd(C,y.pendingProps,It),C!==null?(y.stateNode=C,_e=y,lt=null,m=!0):m=!1),m||ke(y)),null;case 13:return ld(m,y,C);case 4:return Te(y,y.stateNode.containerInfo),D=y.pendingProps,m===null?y.child=es(y,null,D,C):ca(m,y,D,C),y.child;case 11:return px(m,y,y.type,y.pendingProps,C);case 7:return ca(m,y,y.pendingProps,C),y.child;case 8:return ca(m,y,y.pendingProps.children,C),y.child;case 12:return ca(m,y,y.pendingProps.children,C),y.child;case 10:return D=y.pendingProps,Hl(y,y.type,D.value),ca(m,y,D.children,C),y.child;case 9:return z=y.type._context,D=y.pendingProps.children,Yc(y),z=Ua(z),D=D(z),y.flags|=1,ca(m,y,D,C),y.child;case 14:return v0(m,y,y.type,y.pendingProps,C);case 15:return mx(m,y,y.type,y.pendingProps,C);case 19:return Xt(m,y,C);case 22:return cf(m,y,C);case 24:return Yc(y),D=Ua(Wi),m===null?(z=uf(),z===null&&(z=Mn,J=Iy(),z.pooledCache=J,J.refCount++,J!==null&&(z.pooledCacheLanes|=C),z=J),y.memoizedState={parent:D,cache:z},j(y),Hl(y,Wi,z)):(m.lanes&C&&(W(m,y),Vn(y,null,null,C),xt()),z=m.memoizedState,J=y.memoizedState,z.parent!==D?(z={parent:D,cache:D},y.memoizedState=z,y.lanes===0&&(y.memoizedState=y.updateQueue.baseState=z),Hl(y,Wi,D)):(D=J.cache,Hl(y,Wi,D),D!==z.cache&&xm(y,[Wi],C,!0))),ca(m,y,y.pendingProps.children,C),y.child;case 29:throw y.pendingProps}throw Error(i(156,y.tag))}function Hl(m,y,C){ql?(E(xh,y._currentValue),y._currentValue=C):(E(xh,y._currentValue2),y._currentValue2=C)}function hh(m){var y=xh.current;ql?m._currentValue=y:m._currentValue2=y,v(xh)}function Wc(m,y,C){for(;m!==null;){var D=m.alternate;if((m.childLanes&y)!==y?(m.childLanes|=y,D!==null&&(D.childLanes|=y)):D!==null&&(D.childLanes&y)!==y&&(D.childLanes|=y),m===C)break;m=m.return}}function xm(m,y,C,D){var z=m.child;for(z!==null&&(z.return=m);z!==null;){var J=z.dependencies;if(J!==null){var Se=z.child;J=J.firstContext;e:for(;J!==null;){var ze=J;J=z;for(var ut=0;ut<y.length;ut++)if(ze.context===y[ut]){J.lanes|=C,ze=J.alternate,ze!==null&&(ze.lanes|=C),Wc(J.return,C,m),D||(Se=null);break e}J=ze.next}}else if(z.tag===18){if(Se=z.return,Se===null)throw Error(i(341));Se.lanes|=C,J=Se.alternate,J!==null&&(J.lanes|=C),Wc(Se,C,m),Se=null}else Se=z.child;if(Se!==null)Se.return=z;else for(Se=z;Se!==null;){if(Se===m){Se=null;break}if(z=Se.sibling,z!==null){z.return=Se.return,Se=z;break}Se=Se.return}z=Se}}function _0(m,y,C,D){m=null;for(var z=y,J=!1;z!==null;){if(!J){if(z.flags&524288)J=!0;else if(z.flags&262144)break}if(z.tag===10){var Se=z.alternate;if(Se===null)throw Error(i(387));if(Se=Se.memoizedProps,Se!==null){var ze=z.type;R(z.pendingProps.value,Se.value)||(m!==null?m.push(ze):m=[ze])}}else if(z===Oe.current){if(Se=z.alternate,Se===null)throw Error(i(387));Se.memoizedState.memoizedState!==z.memoizedState.memoizedState&&(m!==null?m.push(xl):m=[xl])}z=z.return}m!==null&&xm(y,m,C,D),y.flags|=262144}function _u(m){for(m=m.firstContext;m!==null;){var y=m.context;if(!R(ql?y._currentValue:y._currentValue2,m.memoizedValue))return!0;m=m.next}return!1}function Yc(m){Uu=m,Cl=null,m=m.dependencies,m!==null&&(m.firstContext=null)}function Ua(m){return b0(Uu,m)}function Ai(m,y){return Uu===null&&Yc(m),b0(m,y)}function b0(m,y){var C=ql?y._currentValue:y._currentValue2;if(y={context:y,memoizedValue:C,next:null},Cl===null){if(m===null)throw Error(i(308));Cl=y,m.dependencies={lanes:0,firstContext:y},m.flags|=524288}else Cl=Cl.next=y;return C}function Iy(){return{controller:new Q0,data:new Map,refCount:0}}function lf(m){m.refCount--,m.refCount===0&&Zy(ev,function(){m.controller.abort()})}function uf(){var m=wh.current;return m!==null?m:Mn.pooledCache}function ky(m,y){y===null?E(wh,wh.current):E(wh,y.pool)}function vx(){var m=uf();return m===null?null:{parent:ql?Wi._currentValue:Wi._currentValue2,pool:m}}function Go(m){m.flags|=4}function ud(m,y){if(m!==null&&m.child===y.child)return!1;if(y.flags&16)return!0;for(m=y.child;m!==null;){if(m.flags&13878||m.subtreeFlags&13878)return!0;m=m.sibling}return!1}function dh(m,y,C,D){if(Co)for(C=y.child;C!==null;){if(C.tag===5||C.tag===6)Ip(m,C.stateNode);else if(!(C.tag===4||Ca&&C.tag===27)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===y)break;for(;C.sibling===null;){if(C.return===null||C.return===y)return;C=C.return}C.sibling.return=C.return,C=C.sibling}else if(Nu)for(var z=y.child;z!==null;){if(z.tag===5){var J=z.stateNode;C&&D&&(J=jm(J,z.type,z.memoizedProps)),Ip(m,J)}else if(z.tag===6)J=z.stateNode,C&&D&&(J=Ha(J,z.memoizedProps)),Ip(m,J);else if(z.tag!==4){if(z.tag===22&&z.memoizedState!==null)J=z.child,J!==null&&(J.return=z),dh(m,z,!0,!0);else if(z.child!==null){z.child.return=z,z=z.child;continue}}if(z===y)break;for(;z.sibling===null;){if(z.return===null||z.return===y)return;z=z.return}z.sibling.return=z.return,z=z.sibling}}function pE(m,y,C,D){if(Nu)for(var z=y.child;z!==null;){if(z.tag===5){var J=z.stateNode;C&&D&&(J=jm(J,z.type,z.memoizedProps)),Du(m,J)}else if(z.tag===6)J=z.stateNode,C&&D&&(J=Ha(J,z.memoizedProps)),Du(m,J);else if(z.tag!==4){if(z.tag===22&&z.memoizedState!==null)J=z.child,J!==null&&(J.return=z),pE(m,z,!(z.memoizedProps!==null&&z.memoizedProps.mode==="manual"),!0);else if(z.child!==null){z.child.return=z,z=z.child;continue}}if(z===y)break;for(;z.sibling===null;){if(z.return===null||z.return===y)return;z=z.return}z.sibling.return=z.return,z=z.sibling}}function wm(m,y){if(Nu&&ud(m,y)){m=y.stateNode;var C=m.containerInfo,D=Wy();pE(D,y,!1,!1),m.pendingChildren=D,Go(y),Dp(C,D)}}function Cm(m,y,C,D){if(Co)m.memoizedProps!==D&&Go(y);else if(Nu){var z=m.stateNode,J=m.memoizedProps;if((m=ud(m,y))||J!==D){var Se=Ne.current;J=X0(z,C,J,D,!m,null),J===z?y.stateNode=z:(CE(J,C,D,Se)&&Go(y),y.stateNode=J,m?dh(J,y,!1,!1):Go(y))}else y.stateNode=z}}function E0(m,y,C){if(RE(y,C)){if(m.flags|=16777216,!ku(y,C))if(vE())m.flags|=8192;else throw Ii=Qi,ds}else m.flags&=-16777217}function hf(m,y){if(Xy(y)){if(m.flags|=16777216,!BE(y))if(vE())m.flags|=8192;else throw Ii=Qi,ds}else m.flags&=-16777217}function S0(m,y){y!==null&&(m.flags|=4),m.flags&16384&&(y=m.tag!==22?L():536870912,m.lanes|=y,Lp|=y)}function bu(m,y){if(!wt)switch(m.tailMode){case"hidden":y=m.tail;for(var C=null;y!==null;)y.alternate!==null&&(C=y),y=y.sibling;C===null?m.tail=null:C.sibling=null;break;case"collapsed":C=m.tail;for(var D=null;C!==null;)C.alternate!==null&&(D=C),C=C.sibling;D===null?y||m.tail===null?m.tail=null:m.tail.sibling=null:D.sibling=null}}function Fi(m){var y=m.alternate!==null&&m.alternate.child===m.child,C=0,D=0;if(y)for(var z=m.child;z!==null;)C|=z.lanes|z.childLanes,D|=z.subtreeFlags&31457280,D|=z.flags&31457280,z.return=m,z=z.sibling;else for(z=m.child;z!==null;)C|=z.lanes|z.childLanes,D|=z.subtreeFlags,D|=z.flags,z.return=m,z=z.sibling;return m.subtreeFlags|=D,m.childLanes=C,y}function T0(m,y,C){var D=y.pendingProps;switch(He(y),y.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(y),null;case 1:return Fi(y),null;case 3:return C=y.stateNode,D=null,m!==null&&(D=m.memoizedState.cache),y.memoizedState.cache!==D&&(y.flags|=2048),hh(Wi),Le(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(m===null||m.child===null)&&(Ee(y)?Go(y):m===null||m.memoizedState.isDehydrated&&!(y.flags&256)||(y.flags|=1024,Kt!==null&&(O0(Kt),Kt=null))),wm(m,y),Fi(y),null;case 26:if(so){C=y.type;var z=y.memoizedState;return m===null?(Go(y),z!==null?(Fi(y),hf(y,z)):(Fi(y),E0(y,C,D))):z?z!==m.memoizedState?(Go(y),Fi(y),hf(y,z)):(Fi(y),y.flags&=-16777217):(Co?m.memoizedProps!==D&&Go(y):Cm(m,y,C,D),Fi(y),E0(y,C,D)),null}case 27:if(Ca){if(Ce(y),C=Ye.current,z=y.type,m!==null&&y.stateNode!=null)Co?m.memoizedProps!==D&&Go(y):Cm(m,y,z,D);else{if(!D){if(y.stateNode===null)throw Error(i(166));return Fi(y),null}m=Ne.current,Ee(y)?St(y,m):(m=Wm(z,D,C,m,!0),y.stateNode=m,Go(y))}return Fi(y),null}case 5:if(Ce(y),C=y.type,m!==null&&y.stateNode!=null)Cm(m,y,C,D);else{if(!D){if(y.stateNode===null)throw Error(i(166));return Fi(y),null}m=Ne.current,Ee(y)?St(y,m):(z=Np(C,D,Ye.current,m,y),dh(z,y,!1,!1),y.stateNode=z,CE(z,C,D,m)&&Go(y))}return Fi(y),E0(y,y.type,y.pendingProps),null;case 6:if(m&&y.stateNode!=null)C=m.memoizedProps,Co?C!==D&&Go(y):Nu&&(C!==D?(y.stateNode=V0(D,Ye.current,Ne.current,y),Go(y)):y.stateNode=m.stateNode);else{if(typeof D!="string"&&y.stateNode===null)throw Error(i(166));if(m=Ye.current,C=Ne.current,Ee(y)){if(!Sl)throw Error(i(176));if(m=y.stateNode,C=y.memoizedProps,D=null,z=_e,z!==null)switch(z.tag){case 27:case 5:D=z.memoizedProps}vR(m,C,y,D)||ke(y)}else y.stateNode=V0(D,m,C,y)}return Fi(y),null;case 13:if(D=y.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(z=Ee(y),D!==null&&D.dehydrated!==null){if(m===null){if(!z)throw Error(i(318));if(!Sl)throw Error(i(344));if(z=y.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(i(317));yR(z,y)}else ye(),!(y.flags&128)&&(y.memoizedState=null),y.flags|=4;Fi(y),z=!1}else Kt!==null&&(O0(Kt),Kt=null),z=!0;if(!z)return y.flags&256?(dr(y),y):(dr(y),null)}if(dr(y),y.flags&128)return y.lanes=C,y;if(C=D!==null,m=m!==null&&m.memoizedState!==null,C){D=y.child,z=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(z=D.alternate.memoizedState.cachePool.pool);var J=null;D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(J=D.memoizedState.cachePool.pool),J!==z&&(D.flags|=2048)}return C!==m&&C&&(y.child.flags|=8192),S0(y,y.updateQueue),Fi(y),null;case 4:return Le(),wm(m,y),m===null&&pR(y.stateNode.containerInfo),Fi(y),null;case 10:return hh(y.type),Fi(y),null;case 19:if(v(di),z=y.memoizedState,z===null)return Fi(y),null;if(D=(y.flags&128)!==0,J=z.rendering,J===null)if(D)bu(z,!1);else{if(fi!==0||m!==null&&m.flags&128)for(m=y.child;m!==null;){if(J=ui(m),J!==null){for(y.flags|=128,bu(z,!1),m=J.updateQueue,y.updateQueue=m,S0(y,m),y.subtreeFlags=0,m=C,C=y.child;C!==null;)L0(C,m),C=C.sibling;return E(di,di.current&1|2),y.child}m=m.sibling}z.tail!==null&&Jn()>nv&&(y.flags|=128,D=!0,bu(z,!1),y.lanes=4194304)}else{if(!D)if(m=ui(J),m!==null){if(y.flags|=128,D=!0,m=m.updateQueue,y.updateQueue=m,S0(y,m),bu(z,!0),z.tail===null&&z.tailMode==="hidden"&&!J.alternate&&!wt)return Fi(y),null}else 2*Jn()-z.renderingStartTime>nv&&C!==536870912&&(y.flags|=128,D=!0,bu(z,!1),y.lanes=4194304);z.isBackwards?(J.sibling=y.child,y.child=J):(m=z.last,m!==null?m.sibling=J:y.child=J,z.last=J)}return z.tail!==null?(y=z.tail,z.rendering=y,z.tail=y.sibling,z.renderingStartTime=Jn(),y.sibling=null,m=di.current,E(di,D?m&1|2:m&1),y):(Fi(y),null);case 22:case 23:return dr(y),En(),D=y.memoizedState!==null,m!==null?m.memoizedState!==null!==D&&(y.flags|=8192):D&&(y.flags|=8192),D?C&536870912&&!(y.flags&128)&&(Fi(y),y.subtreeFlags&6&&(y.flags|=8192)):Fi(y),C=y.updateQueue,C!==null&&S0(y,C.retryQueue),C=null,m!==null&&m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),D=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(D=y.memoizedState.cachePool.pool),D!==C&&(y.flags|=2048),m!==null&&v(wh),null;case 24:return C=null,m!==null&&(C=m.memoizedState.cache),y.memoizedState.cache!==C&&(y.flags|=2048),hh(Wi),Fi(y),null;case 25:return null}throw Error(i(156,y.tag))}function dn(m,y){switch(He(y),y.tag){case 1:return m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 3:return hh(Wi),Le(),m=y.flags,m&65536&&!(m&128)?(y.flags=m&-65537|128,y):null;case 26:case 27:case 5:return Ce(y),null;case 13:if(dr(y),m=y.memoizedState,m!==null&&m.dehydrated!==null){if(y.alternate===null)throw Error(i(340));ye()}return m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 19:return v(di),null;case 4:return Le(),null;case 10:return hh(y.type),null;case 22:case 23:return dr(y),En(),m!==null&&v(wh),m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 24:return hh(Wi),null;case 25:return null;default:return null}}function ua(m,y){switch(He(y),y.tag){case 3:hh(Wi),Le();break;case 26:case 27:case 5:Ce(y);break;case 4:Le();break;case 13:dr(y);break;case 19:v(di);break;case 10:hh(y.type);break;case 22:case 23:dr(y),En(),m!==null&&v(wh);break;case 24:hh(Wi)}}function x0(m,y){try{var C=y.updateQueue,D=C!==null?C.lastEffect:null;if(D!==null){var z=D.next;C=z;do{if((C.tag&m)===m){D=void 0;var J=C.create,Se=C.inst;D=J(),Se.destroy=D}C=C.next}while(C!==z)}}catch(ze){oi(y,y.return,ze)}}function Eu(m,y,C){try{var D=y.updateQueue,z=D!==null?D.lastEffect:null;if(z!==null){var J=z.next;D=J;do{if((D.tag&m)===m){var Se=D.inst,ze=Se.destroy;if(ze!==void 0){Se.destroy=void 0,z=y;var ut=C;try{ze()}catch(Dt){oi(z,ut,Dt)}}}D=D.next}while(D!==J)}}catch(Dt){oi(y,y.return,Dt)}}function Xc(m){var y=m.updateQueue;if(y!==null){var C=m.stateNode;try{Vt(y,C)}catch(D){oi(m,m.return,D)}}}function w0(m,y,C){C.props=lh(m.type,m.memoizedProps),C.state=m.memoizedState;try{C.componentWillUnmount()}catch(D){oi(m,y,D)}}function Sp(m,y){try{var C=m.ref;if(C!==null){var D=m.stateNode;switch(m.tag){case 26:case 27:case 5:var z=vf(D);break;default:z=D}typeof C=="function"?m.refCleanup=C(z):C.current=z}}catch(J){oi(m,y,J)}}function xa(m,y){var C=m.ref,D=m.refCleanup;if(C!==null)if(typeof D=="function")try{D()}catch(z){oi(m,y,z)}finally{m.refCleanup=null,m=m.alternate,m!=null&&(m.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(z){oi(m,y,z)}else C.current=null}function mE(m){var y=m.type,C=m.memoizedProps,D=m.stateNode;try{mR(D,y,C,m)}catch(z){oi(m,m.return,z)}}function fc(m,y,C){try{W0(m.stateNode,m.type,C,y,m)}catch(D){oi(m,m.return,D)}}function Ts(m){return m.tag===5||m.tag===3||(so?m.tag===26:!1)||(Ca?m.tag===27:!1)||m.tag===4}function Ks(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||Ts(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&(!Ca||m.tag!==27)&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function Ir(m,y,C){var D=m.tag;if(D===5||D===6)m=m.stateNode,y?Ax(C,m,y):qy(C,m);else if(!(D===4||Ca&&D===27)&&(m=m.child,m!==null))for(Ir(m,y,C),m=m.sibling;m!==null;)Ir(m,y,C),m=m.sibling}function pc(m,y,C){var D=m.tag;if(D===5||D===6)m=m.stateNode,y?Rx(C,m,y):Wo(C,m);else if(!(D===4||Ca&&D===27)&&(m=m.child,m!==null))for(pc(m,y,C),m=m.sibling;m!==null;)pc(m,y,C),m=m.sibling}function To(m,y,C){m=m.containerInfo;try{DE(m,C)}catch(D){oi(y,y.return,D)}}function Tp(m,y){for(Tx(m.containerInfo),le=y;le!==null;)if(m=le,y=m.child,(m.subtreeFlags&1028)!==0&&y!==null)y.return=m,le=y;else for(;le!==null;){m=le;var C=m.alternate;switch(y=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if(y&1024&&C!==null){y=void 0;var D=m,z=C.memoizedProps;C=C.memoizedState;var J=D.stateNode;try{var Se=lh(D.type,z,D.elementType===D.type);y=J.getSnapshotBeforeUpdate(Se,C),J.__reactInternalSnapshotBeforeUpdate=y}catch(ze){oi(D,D.return,ze)}}break;case 3:y&1024&&Co&&Hm(m.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(y&1024)throw Error(i(163))}if(y=m.sibling,y!==null){y.return=m.return,le=y;break}le=m.return}return Se=xe,xe=!1,Se}function C0(m,y,C){var D=C.flags;switch(C.tag){case 0:case 11:case 15:bl(m,C),D&4&&x0(5,C);break;case 1:if(bl(m,C),D&4)if(m=C.stateNode,y===null)try{m.componentDidMount()}catch(ze){oi(C,C.return,ze)}else{var z=lh(C.type,y.memoizedProps);y=y.memoizedState;try{m.componentDidUpdate(z,y,m.__reactInternalSnapshotBeforeUpdate)}catch(ze){oi(C,C.return,ze)}}D&64&&Xc(C),D&512&&Sp(C,C.return);break;case 3:if(bl(m,C),D&64&&(D=C.updateQueue,D!==null)){if(m=null,C.child!==null)switch(C.child.tag){case 27:case 5:m=vf(C.child.stateNode);break;case 1:m=C.child.stateNode}try{Vt(D,m)}catch(ze){oi(C,C.return,ze)}}break;case 26:if(so){bl(m,C),D&512&&Sp(C,C.return);break}case 27:case 5:bl(m,C),y===null&&D&4&&mE(C),D&512&&Sp(C,C.return);break;case 12:bl(m,C);break;case 13:bl(m,C),D&4&&Rm(m,C);break;case 22:if(z=C.memoizedState!==null||b,!z){y=y!==null&&y.memoizedState!==null||w;var J=b,Se=w;b=z,(w=y)&&!Se?jl(m,C,(C.subtreeFlags&8772)!==0):bl(m,C),b=J,w=Se}D&512&&(C.memoizedProps.mode==="manual"?Sp(C,C.return):xa(C,C.return));break;default:bl(m,C)}}function xo(m){var y=m.alternate;y!==null&&(m.alternate=null,xo(y)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(y=m.stateNode,y!==null&&hs(y)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function Bt(m,y,C){for(C=C.child;C!==null;)wa(m,y,C),C=C.sibling}function wa(m,y,C){if(S&&typeof S.onCommitFiberUnmount=="function")try{S.onCommitFiberUnmount(O,C)}catch{}switch(C.tag){case 26:if(so){w||xa(C,y),Bt(m,y,C),C.memoizedState?Xo(C.memoizedState):C.stateNode&&UE(C.stateNode);break}case 27:if(Ca){w||xa(C,y);var D=Pe,z=We;Pe=C.stateNode,Bt(m,y,C),zE(C.stateNode),Pe=D,We=z;break}case 5:w||xa(C,y);case 6:if(Co){if(D=Pe,z=We,Pe=null,Bt(m,y,C),Pe=D,We=z,Pe!==null)if(We)try{kE(Pe,C.stateNode)}catch(J){oi(C,y,J)}else try{Fm(Pe,C.stateNode)}catch(J){oi(C,y,J)}}else Bt(m,y,C);break;case 18:Co&&Pe!==null&&(We?bR(Pe,C.stateNode):_R(Pe,C.stateNode));break;case 4:Co?(D=Pe,z=We,Pe=C.stateNode.containerInfo,We=!0,Bt(m,y,C),Pe=D,We=z):(Nu&&To(C.stateNode,C,Wy()),Bt(m,y,C));break;case 0:case 11:case 14:case 15:w||Eu(2,C,y),w||Eu(4,C,y),Bt(m,y,C);break;case 1:w||(xa(C,y),D=C.stateNode,typeof D.componentWillUnmount=="function"&&w0(C,y,D)),Bt(m,y,C);break;case 21:Bt(m,y,C);break;case 22:w||xa(C,y),w=(D=w)||C.memoizedState!==null,Bt(m,y,C),w=D;break;default:Bt(m,y,C)}}function Rm(m,y){if(Sl&&y.memoizedState===null&&(m=y.alternate,m!==null&&(m=m.memoizedState,m!==null&&(m=m.dehydrated,m!==null))))try{K0(m)}catch(C){oi(y,y.return,C)}}function df(m){switch(m.tag){case 13:case 19:var y=m.stateNode;return y===null&&(y=m.stateNode=new Q),y;case 22:return m=m.stateNode,y=m._retryCache,y===null&&(y=m._retryCache=new Q),y;default:throw Error(i(435,m.tag))}}function hd(m,y){var C=df(m);y.forEach(function(D){var z=bx.bind(null,m,D);C.has(D)||(C.add(D),D.then(z,z))})}function ha(m,y){var C=y.deletions;if(C!==null)for(var D=0;D<C.length;D++){var z=C[D],J=m,Se=y;if(Co){var ze=Se;e:for(;ze!==null;){switch(ze.tag){case 27:case 5:Pe=ze.stateNode,We=!1;break e;case 3:Pe=ze.stateNode.containerInfo,We=!0;break e;case 4:Pe=ze.stateNode.containerInfo,We=!0;break e}ze=ze.return}if(Pe===null)throw Error(i(160));wa(J,Se,z),Pe=null,We=!1}else wa(J,Se,z);J=z.alternate,J!==null&&(J.return=null),z.return=null}if(y.subtreeFlags&13878)for(y=y.child;y!==null;)R0(y,m),y=y.sibling}function R0(m,y){var C=m.alternate,D=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:ha(y,m),mc(m),D&4&&(Eu(3,m,m.return),x0(3,m),Eu(5,m,m.return));break;case 1:ha(y,m),mc(m),D&512&&(w||C===null||xa(C,C.return)),D&64&&b&&(m=m.updateQueue,m!==null&&(D=m.callbacks,D!==null&&(C=m.shared.hiddenCallbacks,m.shared.hiddenCallbacks=C===null?D:C.concat(D))));break;case 26:if(so){var z=ct;ha(y,m),mc(m),D&512&&(w||C===null||xa(C,C.return)),D&4&&(D=C!==null?C.memoizedState:null,y=m.memoizedState,C===null?y===null?m.stateNode===null?m.stateNode=LE(z,m.type,m.memoizedProps,m):J0(z,m.type,m.stateNode):m.stateNode=Vs(z,y,m.memoizedProps):D!==y?(D===null?C.stateNode!==null&&UE(C.stateNode):Xo(D),y===null?J0(z,m.type,m.stateNode):Vs(z,y,m.memoizedProps)):y===null&&m.stateNode!==null&&fc(m,m.memoizedProps,C.memoizedProps));break}case 27:if(Ca&&D&4&&m.alternate===null){z=m.stateNode;var J=m.memoizedProps;try{Ky(z),FE(m.type,J,z,m)}catch(en){oi(m,m.return,en)}}case 5:if(ha(y,m),mc(m),D&512&&(w||C===null||xa(C,C.return)),Co){if(m.flags&32){y=m.stateNode;try{Y0(y)}catch(en){oi(m,m.return,en)}}D&4&&m.stateNode!=null&&(y=m.memoizedProps,fc(m,y,C!==null?C.memoizedProps:y)),D&1024&&(F=!0)}break;case 6:if(ha(y,m),mc(m),D&4&&Co){if(m.stateNode===null)throw Error(i(162));D=m.memoizedProps,C=C!==null?C.memoizedProps:D,y=m.stateNode;try{IE(y,C,D)}catch(en){oi(m,m.return,en)}}break;case 3:if(so?(Ix(),z=ct,ct=_d(y.containerInfo),ha(y,m),ct=z):ha(y,m),mc(m),D&4){if(Co&&Sl&&C!==null&&C.memoizedState.isDehydrated)try{$m(y.containerInfo)}catch(en){oi(m,m.return,en)}if(Nu){D=y.containerInfo,C=y.pendingChildren;try{DE(D,C)}catch(en){oi(m,m.return,en)}}}F&&(F=!1,yx(m));break;case 4:so?(C=ct,ct=_d(m.stateNode.containerInfo),ha(y,m),mc(m),ct=C):(ha(y,m),mc(m)),D&4&&Nu&&To(m.stateNode,m,m.stateNode.pendingChildren);break;case 12:ha(y,m),mc(m);break;case 13:ha(y,m),mc(m),m.child.flags&8192&&m.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(e_=Jn()),D&4&&(D=m.updateQueue,D!==null&&(m.updateQueue=null,hd(m,D)));break;case 22:D&512&&(w||C===null||xa(C,C.return)),z=m.memoizedState!==null;var Se=C!==null&&C.memoizedState!==null,ze=b,ut=w;if(b=ze||z,w=ut||Se,ha(y,m),w=ut,b=ze,mc(m),y=m.stateNode,y._current=m,y._visibility&=-3,y._visibility|=y._pendingVisibility&2,D&8192&&(y._visibility=z?y._visibility&-2:y._visibility|1,z&&(y=b||w,C===null||Se||y||xp(m)),Co&&(m.memoizedProps===null||m.memoizedProps.mode!=="manual"))){e:if(C=null,Co)for(y=m;;){if(y.tag===5||so&&y.tag===26||Ca&&y.tag===27){if(C===null){Se=C=y;try{J=Se.stateNode,z?Zc(J):$y(Se.stateNode,Se.memoizedProps)}catch(en){oi(Se,Se.return,en)}}}else if(y.tag===6){if(C===null){Se=y;try{var Dt=Se.stateNode;z?zm(Dt):za(Dt,Se.memoizedProps)}catch(en){oi(Se,Se.return,en)}}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===m)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===m)break e;for(;y.sibling===null;){if(y.return===null||y.return===m)break e;C===y&&(C=null),y=y.return}C===y&&(C=null),y.sibling.return=y.return,y=y.sibling}}D&4&&(D=m.updateQueue,D!==null&&(C=D.retryQueue,C!==null&&(D.retryQueue=null,hd(m,C))));break;case 19:ha(y,m),mc(m),D&4&&(D=m.updateQueue,D!==null&&(m.updateQueue=null,hd(m,D)));break;case 21:break;default:ha(y,m),mc(m)}}function mc(m){var y=m.flags;if(y&2){try{if(Co&&(!Ca||m.tag!==27)){e:{for(var C=m.return;C!==null;){if(Ts(C)){var D=C;break e}C=C.return}throw Error(i(160))}switch(D.tag){case 27:if(Ca){var z=D.stateNode,J=Ks(m);pc(m,J,z);break}case 5:var Se=D.stateNode;D.flags&32&&(Y0(Se),D.flags&=-33);var ze=Ks(m);pc(m,ze,Se);break;case 3:case 4:var ut=D.stateNode.containerInfo,Dt=Ks(m);Ir(m,Dt,ut);break;default:throw Error(i(161))}}}catch(en){oi(m,m.return,en)}m.flags&=-3}y&4096&&(m.flags&=-4097)}function yx(m){if(m.subtreeFlags&1024)for(m=m.child;m!==null;){var y=m;yx(y),y.tag===5&&y.flags&1024&&lr(y.stateNode),m=m.sibling}}function bl(m,y){if(y.subtreeFlags&8772)for(y=y.child;y!==null;)C0(m,y.alternate,y),y=y.sibling}function xp(m){for(m=m.child;m!==null;){var y=m;switch(y.tag){case 0:case 11:case 14:case 15:Eu(4,y,y.return),xp(y);break;case 1:xa(y,y.return);var C=y.stateNode;typeof C.componentWillUnmount=="function"&&w0(y,y.return,C),xp(y);break;case 26:case 27:case 5:xa(y,y.return),xp(y);break;case 22:xa(y,y.return),y.memoizedState===null&&xp(y);break;default:xp(y)}m=m.sibling}}function jl(m,y,C){for(C=C&&(y.subtreeFlags&8772)!==0,y=y.child;y!==null;){var D=y.alternate,z=m,J=y,Se=J.flags;switch(J.tag){case 0:case 11:case 15:jl(z,J,C),x0(4,J);break;case 1:if(jl(z,J,C),D=J,z=D.stateNode,typeof z.componentDidMount=="function")try{z.componentDidMount()}catch(Dt){oi(D,D.return,Dt)}if(D=J,z=D.updateQueue,z!==null){var ze=D.stateNode;try{var ut=z.shared.hiddenCallbacks;if(ut!==null)for(z.shared.hiddenCallbacks=null,z=0;z<ut.length;z++)qe(ut[z],ze)}catch(Dt){oi(D,D.return,Dt)}}C&&Se&64&&Xc(J),Sp(J,J.return);break;case 26:case 27:case 5:jl(z,J,C),C&&D===null&&Se&4&&mE(J),Sp(J,J.return);break;case 12:jl(z,J,C);break;case 13:jl(z,J,C),C&&Se&4&&Rm(z,J);break;case 22:J.memoizedState===null&&jl(z,J,C),Sp(J,J.return);break;default:jl(z,J,C)}y=y.sibling}}function ff(m,y){var C=null;m!==null&&m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),m=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(m=y.memoizedState.cachePool.pool),m!==C&&(m!=null&&m.refCount++,C!=null&&lf(C))}function Am(m,y){m=null,y.alternate!==null&&(m=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==m&&(y.refCount++,m!=null&&lf(m))}function ge(m,y,C,D){if(y.subtreeFlags&10256)for(y=y.child;y!==null;)dd(m,y,C,D),y=y.sibling}function dd(m,y,C,D){var z=y.flags;switch(y.tag){case 0:case 11:case 15:ge(m,y,C,D),z&2048&&x0(9,y);break;case 3:ge(m,y,C,D),z&2048&&(m=null,y.alternate!==null&&(m=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==m&&(y.refCount++,m!=null&&lf(m)));break;case 12:if(z&2048){ge(m,y,C,D),m=y.stateNode;try{var J=y.memoizedProps,Se=J.id,ze=J.onPostCommit;typeof ze=="function"&&ze(Se,y.alternate===null?"mount":"update",m.passiveEffectDuration,-0)}catch(ut){oi(y,y.return,ut)}}else ge(m,y,C,D);break;case 23:break;case 22:J=y.stateNode,y.memoizedState!==null?J._visibility&4?ge(m,y,C,D):no(m,y):J._visibility&4?ge(m,y,C,D):(J._visibility|=4,fh(m,y,C,D,(y.subtreeFlags&10256)!==0)),z&2048&&ff(y.alternate,y);break;case 24:ge(m,y,C,D),z&2048&&Am(y.alternate,y);break;default:ge(m,y,C,D)}}function fh(m,y,C,D,z){for(z=z&&(y.subtreeFlags&10256)!==0,y=y.child;y!==null;){var J=m,Se=y,ze=C,ut=D,Dt=Se.flags;switch(Se.tag){case 0:case 11:case 15:fh(J,Se,ze,ut,z),x0(8,Se);break;case 23:break;case 22:var en=Se.stateNode;Se.memoizedState!==null?en._visibility&4?fh(J,Se,ze,ut,z):no(J,Se):(en._visibility|=4,fh(J,Se,ze,ut,z)),z&&Dt&2048&&ff(Se.alternate,Se);break;case 24:fh(J,Se,ze,ut,z),z&&Dt&2048&&Am(Se.alternate,Se);break;default:fh(J,Se,ze,ut,z)}y=y.sibling}}function no(m,y){if(y.subtreeFlags&10256)for(y=y.child;y!==null;){var C=m,D=y,z=D.flags;switch(D.tag){case 22:no(C,D),z&2048&&ff(D.alternate,D);break;case 24:no(C,D),z&2048&&Am(D.alternate,D);break;default:no(C,D)}y=y.sibling}}function Br(m){if(m.subtreeFlags&kt)for(m=m.child;m!==null;)fd(m),m=m.sibling}function fd(m){switch(m.tag){case 26:Br(m),m.flags&kt&&(m.memoizedState!==null?SR(ct,m.memoizedState,m.memoizedProps):Vy(m.type,m.memoizedProps));break;case 5:Br(m),m.flags&kt&&Vy(m.type,m.memoizedProps);break;case 3:case 4:if(so){var y=ct;ct=_d(m.stateNode.containerInfo),Br(m),ct=y}else Br(m);break;case 22:m.memoizedState===null&&(y=m.alternate,y!==null&&y.memoizedState!==null?(y=kt,kt=16777216,Br(m),kt=y):Br(m));break;default:Br(m)}}function Su(m){var y=m.alternate;if(y!==null&&(m=y.child,m!==null)){y.child=null;do y=m.sibling,m.sibling=null,m=y;while(m!==null)}}function Kc(m){var y=m.deletions;if(m.flags&16){if(y!==null)for(var C=0;C<y.length;C++){var D=y[C];le=D,Dy(D,m)}Su(m)}if(m.subtreeFlags&10256)for(m=m.child;m!==null;)Tu(m),m=m.sibling}function Tu(m){switch(m.tag){case 0:case 11:case 15:Kc(m),m.flags&2048&&Eu(9,m,m.return);break;case 3:Kc(m);break;case 12:Kc(m);break;case 22:var y=m.stateNode;m.memoizedState!==null&&y._visibility&4&&(m.return===null||m.return.tag!==13)?(y._visibility&=-5,gc(m)):Kc(m);break;default:Kc(m)}}function gc(m){var y=m.deletions;if(m.flags&16){if(y!==null)for(var C=0;C<y.length;C++){var D=y[C];le=D,Dy(D,m)}Su(m)}for(m=m.child;m!==null;){switch(y=m,y.tag){case 0:case 11:case 15:Eu(8,y,y.return),gc(y);break;case 22:C=y.stateNode,C._visibility&4&&(C._visibility&=-5,gc(y));break;default:gc(y)}m=m.sibling}}function Dy(m,y){for(;le!==null;){var C=le;switch(C.tag){case 0:case 11:case 15:Eu(8,C,y);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var D=C.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:lf(C.memoizedState.cache)}if(D=C.child,D!==null)D.return=C,le=D;else e:for(C=m;le!==null;){D=le;var z=D.sibling,J=D.return;if(xo(D),D===C){le=null;break e}if(z!==null){z.return=J,le=z;break e}le=J}}}function Vl(m){var y=q0(m);if(y!=null){if(typeof y.memoizedProps["data-testname"]!="string")throw Error(i(364));return y}if(m=$0(m),m===null)throw Error(i(362));return m.stateNode.current}function Py(m,y){var C=m.tag;switch(y.$$typeof){case Wt:if(m.type===y.value)return!0;break;case An:e:{for(y=y.value,m=[m,0],C=0;C<m.length;){var D=m[C++],z=D.tag,J=m[C++],Se=y[J];if(z!==5&&z!==26&&z!==27||!kp(D)){for(;Se!=null&&Py(D,Se);)J++,Se=y[J];if(J===y.length){y=!0;break e}else for(D=D.child;D!==null;)m.push(D,J),D=D.sibling}}y=!1}return y;case Un:if((C===5||C===26||C===27)&&Cx(m.stateNode,y.value))return!0;break;case Ut:if((C===5||C===6||C===26||C===27)&&(m=Fa(m),m!==null&&0<=m.indexOf(y.value)))return!0;break;case nr:if((C===5||C===26||C===27)&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===y.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function A0(m){switch(m.$$typeof){case Wt:return"<"+(a(m.value)||"Unknown")+">";case An:return":has("+(A0(m)||"")+")";case Un:return'[role="'+m.value+'"]';case Ut:return'"'+m.value+'"';case nr:return'[data-testname="'+m.value+'"]';default:throw Error(i(365))}}function M0(m,y){var C=[];m=[m,0];for(var D=0;D<m.length;){var z=m[D++],J=z.tag,Se=m[D++],ze=y[Se];if(J!==5&&J!==26&&J!==27||!kp(z)){for(;ze!=null&&Py(z,ze);)Se++,ze=y[Se];if(Se===y.length)C.push(z);else for(z=z.child;z!==null;)m.push(z,Se),z=z.sibling}}return C}function pf(m,y){if(!wl)throw Error(i(363));m=Vl(m),m=M0(m,y),y=[],m=Array.from(m);for(var C=0;C<m.length;){var D=m[C++],z=D.tag;if(z===5||z===26||z===27)kp(D)||y.push(D.stateNode);else for(D=D.child;D!==null;)m.push(D),D=D.sibling}return y}function wo(){if(Gt&2&&In!==0)return In&-In;if(vr.T!==null){var m=Tn;return m!==0?m:qt()}return Iu()}function gE(){Yl===0&&(Yl=!(In&536870912)||wt?k():536870912);var m=_s.current;return m!==null&&(m.flags|=32),Yl}function qo(m,y,C){(m===Mn&&ln===2||m.cancelPendingCommit!==null)&&(El(m,0),ls(m,In,Yl,!1)),$(m,C),(!(Gt&2)||m!==Mn)&&(m===Mn&&(!(Gt&2)&&(Wl|=C),fi===4&&ls(m,In,Yl,!1)),bt(m))}function xu(m,y,C){if(Gt&6)throw Error(i(327));var D=!C&&(y&60)===0&&(y&m.expiredLanes)===0||A(m,y),z=D?wu(m,y):I0(m,y,!0),J=D;do{if(z===0){Ds&&!D&&ls(m,y,0,!1);break}else if(z===6)ls(m,y,0,!xs);else{if(C=m.current.alternate,J&&!vc(C)){z=I0(m,y,!1),J=!1;continue}if(z===2){if(J=y,m.errorRecoveryDisabledLanes&J)var Se=0;else Se=m.pendingLanes&-536870913,Se=Se!==0?Se:Se&536870912?536870912:0;if(Se!==0){y=Se;e:{var ze=m;z=Ed;var ut=Sl&&ze.current.memoizedState.isDehydrated;if(ut&&(El(ze,Se).flags|=256),Se=I0(ze,Se,!1),Se!==2){if(Ec&&!ut){ze.errorRecoveryDisabledLanes|=J,Wl|=J,z=4;break e}J=Sd,Sd=z,J!==null&&O0(J)}z=Se}if(J=!1,z!==2)continue}}if(z===1){El(m,0),ls(m,y,0,!0);break}e:{switch(D=m,z){case 0:case 1:throw Error(i(345));case 4:if((y&4194176)===y){ls(D,y,Yl,!xs);break e}break;case 2:Sd=null;break;case 3:case 5:break;default:throw Error(i(329))}if(D.finishedWork=C,D.finishedLanes=y,(y&62914560)===y&&(J=e_+300-Jn(),10<J)){if(ls(D,y,Yl,!xs),N(D,0)!==0)break e;D.timeoutHandle=wx(pd.bind(null,D,C,Sd,rv,Dx,y,Yl,Wl,Lp,xs,2,-0,0),J);break e}pd(D,C,Sd,rv,Dx,y,Yl,Wl,Lp,xs,0,-0,0)}}break}while(!0);bt(m)}function O0(m){Sd===null?Sd=m:Sd.push.apply(Sd,m)}function pd(m,y,C,D,z,J,Se,ze,ut,Dt,en,xn,Rn){var ei=y.subtreeFlags;if((ei&8192||(ei&16785408)===16785408)&&(AE(),fd(y),y=ME(),y!==null)){m.cancelPendingCommit=y(Nm.bind(null,m,C,D,z,Se,ze,ut,1,xn,Rn)),ls(m,J,Se,!Dt);return}Nm(m,C,D,z,Se,ze,ut,en,xn,Rn)}function vc(m){for(var y=m;;){var C=y.tag;if((C===0||C===11||C===15)&&y.flags&16384&&(C=y.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var D=0;D<C.length;D++){var z=C[D],J=z.getSnapshot;z=z.value;try{if(!R(J(),z))return!1}catch{return!1}}if(C=y.child,y.subtreeFlags&16384&&C!==null)C.return=y,y=C;else{if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function ls(m,y,C,D){y&=~Qy,y&=~Wl,m.suspendedLanes|=y,m.pingedLanes&=~y,D&&(m.warmLanes|=y),D=m.expirationTimes;for(var z=y;0<z;){var J=31-Jo(z),Se=1<<J;D[J]=-1,z&=~Se}C!==0&&G(m,C,y)}function Ly(){return Gt&6?!0:(be(0),!1)}function mf(){if(on!==null){if(ln===0)var m=on.return;else m=on,Cl=Uu=null,vu(m),hi=null,$i=0,m=on;for(;m!==null;)ua(m.alternate,m),m=m.return;on=null}}function El(m,y){m.finishedWork=null,m.finishedLanes=0;var C=m.timeoutHandle;C!==G0&&(m.timeoutHandle=G0,jy(C)),C=m.cancelPendingCommit,C!==null&&(m.cancelPendingCommit=null,C()),mf(),Mn=m,on=C=ph(m.current,null),In=y,ln=0,Fn=null,xs=!1,Ds=A(m,y),Ec=!1,Lp=Yl=Qy=Wl=Sc=fi=0,Sd=Ed=null,Dx=!1,y&8&&(y|=y&32);var D=m.entangledLanes;if(D!==0)for(m=m.entanglements,D&=y;0<D;){var z=31-Jo(D),J=1<<z;y|=m[z],D&=~J}return ki=y,fe(),C}function N0(m,y){Zn=null,vr.H=Aa,y===Zi?(y=Ve(),ln=3):y===ds?(y=Ve(),ln=4):ln=y===Pp?8:y!==null&&typeof y=="object"&&typeof y.then=="function"?6:1,Fn=y,on===null&&(fi=1,Em(m,ee(y,m.current)))}function vE(){var m=_s.current;return m===null?!0:(In&4194176)===In?ks===null:(In&62914560)===In||In&536870912?m===ks:!1}function Mm(){var m=vr.H;return vr.H=Aa,m===null?Aa:m}function Om(){var m=vr.A;return vr.A=Lt,m}function Ba(){fi=4,xs||(In&4194176)!==In&&_s.current!==null||(Ds=!0),!(Sc&134217727)&&!(Wl&134217727)||Mn===null||ls(Mn,In,Yl,!1)}function I0(m,y,C){var D=Gt;Gt|=2;var z=Mm(),J=Om();(Mn!==m||In!==y)&&(rv=null,El(m,y)),y=!1;var Se=fi;e:do try{if(ln!==0&&on!==null){var ze=on,ut=Fn;switch(ln){case 8:mf(),Se=6;break e;case 3:case 2:case 6:_s.current===null&&(y=!0);var Dt=ln;if(ln=0,Fn=null,Gl(m,ze,ut,Dt),C&&Ds){Se=0;break e}break;default:Dt=ln,ln=0,Fn=null,Gl(m,ze,ut,Dt)}}yE(),Se=fi;break}catch(en){N0(m,en)}while(!0);return y&&m.shellSuspendCounter++,Cl=Uu=null,Gt=D,vr.H=z,vr.A=J,on===null&&(Mn=null,In=0,fe()),Se}function yE(){for(;on!==null;)Cu(on)}function wu(m,y){var C=Gt;Gt|=2;var D=Mm(),z=Om();Mn!==m||In!==y?(rv=null,nv=Jn()+500,El(m,y)):Ds=A(m,y);e:do try{if(ln!==0&&on!==null){y=on;var J=Fn;t:switch(ln){case 1:ln=0,Fn=null,Gl(m,y,J,1);break;case 2:if(Pt(J)){ln=0,Fn=null,js(y);break}y=function(){ln===2&&Mn===m&&(ln=7),bt(m)},J.then(y,y);break e;case 3:ln=7;break e;case 4:ln=5;break e;case 7:Pt(J)?(ln=0,Fn=null,js(y)):(ln=0,Fn=null,Gl(m,y,J,7));break;case 5:var Se=null;switch(on.tag){case 26:Se=on.memoizedState;case 5:case 27:var ze=on,ut=ze.type,Dt=ze.pendingProps;if(Se?BE(Se):ku(ut,Dt)){ln=0,Fn=null;var en=ze.sibling;if(en!==null)on=en;else{var xn=ze.return;xn!==null?(on=xn,da(xn)):on=null}break t}}ln=0,Fn=null,Gl(m,y,J,5);break;case 6:ln=0,Fn=null,Gl(m,y,J,6);break;case 8:mf(),fi=6;break e;default:throw Error(i(462))}}_E();break}catch(Rn){N0(m,Rn)}while(!0);return Cl=Uu=null,vr.H=D,vr.A=z,Gt=C,on!==null?0:(Mn=null,In=0,fe(),fi)}function _E(){for(;on!==null&&!xR();)Cu(on)}function Cu(m){var y=Jr(m.alternate,m,ki);m.memoizedProps=m.pendingProps,y===null?da(m):on=y}function js(m){var y=m,C=y.alternate;switch(y.tag){case 15:case 0:y=Tm(C,y,y.pendingProps,y.type,void 0,In);break;case 11:y=Tm(C,y,y.pendingProps,y.type.render,y.ref,In);break;case 5:vu(y);default:ua(C,y),y=on=L0(y,ki),y=Jr(C,y,ki)}m.memoizedProps=m.pendingProps,y===null?da(m):on=y}function Gl(m,y,C,D){Cl=Uu=null,vu(y),hi=null,$i=0;var z=y.return;try{if(fx(m,z,y,C,In)){fi=1,Em(m,ee(C,m.current)),on=null;return}}catch(J){if(z!==null)throw on=z,J;fi=1,Em(m,ee(C,m.current)),on=null;return}y.flags&32768?(wt||D===1?m=!0:Ds||In&536870912?m=!1:(xs=m=!0,(D===2||D===3||D===6)&&(D=_s.current,D!==null&&D.tag===13&&(D.flags|=16384))),zi(y,m)):da(y)}function da(m){var y=m;do{if(y.flags&32768){zi(y,xs);return}m=y.return;var C=T0(y.alternate,y,ki);if(C!==null){on=C;return}if(y=y.sibling,y!==null){on=y;return}on=y=m}while(y!==null);fi===0&&(fi=5)}function zi(m,y){do{var C=dn(m.alternate,m);if(C!==null){C.flags&=32767,on=C;return}if(C=m.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!y&&(m=m.sibling,m!==null)){on=m;return}on=m=C}while(m!==null);fi=6,on=null}function Nm(m,y,C,D,z,J,Se,ze,ut,Dt){var en=vr.T,xn=io();try{$o(2),vr.T=null,Im(m,y,C,D,xn,z,J,Se,ze,ut,Dt)}finally{vr.T=en,$o(xn)}}function Im(m,y,C,D,z,J,Se,ze){do yc();while(Sf!==null);if(Gt&6)throw Error(i(327));var ut=m.finishedWork;if(D=m.finishedLanes,ut===null)return null;if(m.finishedWork=null,m.finishedLanes=0,ut===m.current)throw Error(i(177));m.callbackNode=null,m.callbackPriority=0,m.cancelPendingCommit=null;var Dt=ut.lanes|ut.childLanes;if(Dt|=Fr,q(m,D,Dt,J,Se,ze),m===Mn&&(on=Mn=null,In=0),!(ut.subtreeFlags&10256)&&!(ut.flags&10256)||VE||(VE=!0,dz=Dt,fz=C,By(Is,function(){return yc(),null})),C=(ut.flags&15990)!==0,ut.subtreeFlags&15990||C?(C=vr.T,vr.T=null,J=io(),$o(2),Se=Gt,Gt|=4,Tp(m,ut),R0(ut,m),xx(m.containerInfo),m.current=ut,C0(m,ut.alternate,ut),Hi(),Gt=Se,$o(J),vr.T=C):m.current=ut,VE?(VE=!1,Sf=m,Xm=D):Uy(m,Dt),Dt=m.pendingLanes,Dt===0&&(Td=null),V(ut.stateNode),bt(m),y!==null)for(z=m.onRecoverableError,ut=0;ut<y.length;ut++)Dt=y[ut],z(Dt.value,{componentStack:Dt.stack});return Xm&3&&yc(),Dt=m.pendingLanes,D&4194218&&Dt&42?m===pz?wR++:(wR=0,pz=m):wR=0,be(0),null}function Uy(m,y){(m.pooledCacheLanes&=y)===0&&(y=m.pooledCache,y!=null&&(m.pooledCache=null,lf(y)))}function yc(){if(Sf!==null){var m=Sf,y=dz;dz=0;var C=re(Xm),D=32>C?32:C;C=vr.T;var z=io();try{if($o(D),vr.T=null,Sf===null)var J=!1;else{D=fz,fz=null;var Se=Sf,ze=Xm;if(Sf=null,Xm=0,Gt&6)throw Error(i(331));var ut=Gt;if(Gt|=4,Tu(Se.current),dd(Se,Se.current,ze,D),Gt=ut,be(0,!1),S&&typeof S.onPostCommitFiberRoot=="function")try{S.onPostCommitFiberRoot(O,Se)}catch{}J=!0}return J}finally{$o(z),vr.T=C,Uy(m,y)}}return!1}function k0(m,y,C){y=ee(C,y),y=hc(m.stateNode,y,2),m=De(m,y,2),m!==null&&($(m,2),bt(m))}function oi(m,y,C){if(m.tag===3)k0(m,m,C);else for(;y!==null;){if(y.tag===3){k0(y,m,C);break}else if(y.tag===1){var D=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Td===null||!Td.has(D))){m=ee(C,m),C=Ms(2),D=De(y,C,2),D!==null&&(cd(C,D,y,m),$(D,2),bt(D));break}}y=y.return}}function D0(m,y,C){var D=m.pingCache;if(D===null){D=m.pingCache=new mr;var z=new Set;D.set(y,z)}else z=D.get(y),z===void 0&&(z=new Set,D.set(y,z));z.has(C)||(Ec=!0,z.add(C),m=_x.bind(null,m,y,C),y.then(m,m))}function _x(m,y,C){var D=m.pingCache;D!==null&&D.delete(y),m.pingedLanes|=m.suspendedLanes&C,m.warmLanes&=~C,Mn===m&&(In&C)===C&&(fi===4||fi===3&&(In&62914560)===In&&300>Jn()-e_?!(Gt&2)&&El(m,0):Qy|=C,Lp===In&&(Lp=0)),bt(m)}function bE(m,y){y===0&&(y=L()),m=rt(m,y),m!==null&&($(m,y),bt(m))}function EE(m){var y=m.memoizedState,C=0;y!==null&&(C=y.retryLane),bE(m,C)}function bx(m,y){var C=0;switch(m.tag){case 13:var D=m.stateNode,z=m.memoizedState;z!==null&&(C=z.retryLane);break;case 19:D=m.stateNode;break;case 22:D=m.stateNode._retryCache;break;default:throw Error(i(314))}D!==null&&D.delete(y),bE(m,C)}function By(m,y){return Ns(m,y)}function Ru(m,y,C,D){this.tag=m,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function P0(m){return m=m.prototype,!(!m||!m.isReactComponent)}function ph(m,y){var C=m.alternate;return C===null?(C=n(m.tag,y,m.key,m.mode),C.elementType=m.elementType,C.type=m.type,C.stateNode=m.stateNode,C.alternate=m,m.alternate=C):(C.pendingProps=y,C.type=m.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=m.flags&31457280,C.childLanes=m.childLanes,C.lanes=m.lanes,C.child=m.child,C.memoizedProps=m.memoizedProps,C.memoizedState=m.memoizedState,C.updateQueue=m.updateQueue,y=m.dependencies,C.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},C.sibling=m.sibling,C.index=m.index,C.ref=m.ref,C.refCleanup=m.refCleanup,C}function L0(m,y){m.flags&=31457282;var C=m.alternate;return C===null?(m.childLanes=0,m.lanes=y,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=C.childLanes,m.lanes=C.lanes,m.child=C.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=C.memoizedProps,m.memoizedState=C.memoizedState,m.updateQueue=C.updateQueue,m.type=C.type,y=C.dependencies,m.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),m}function U0(m,y,C,D,z,J){var Se=0;if(D=m,typeof m=="function")P0(m)&&(Se=1);else if(typeof m=="string")Se=so&&Ca?bh(m,C,Ne.current)?26:HE(m)?27:5:so?bh(m,C,Ne.current)?26:5:Ca&&HE(m)?27:5;else e:switch(m){case gh:return gf(C.children,z,J,y);case Jc:Se=8,z|=24;break;case vh:return m=n(12,C,y,z|2),m.elementType=vh,m.lanes=J,m;case z0:return m=n(13,C,y,z),m.elementType=z0,m.lanes=J,m;case Mp:return m=n(19,C,y,z),m.elementType=Mp,m.lanes=J,m;case yh:return SE(C,z,J,y);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case Ap:case Au:Se=10;break e;case xE:Se=9;break e;case Pm:Se=11;break e;case H0:Se=14;break e;case Mu:Se=16,D=null;break e}Se=29,C=Error(i(130,m===null?"null":typeof m,"")),D=null}return y=n(Se,C,y,z),y.elementType=m,y.type=D,y.lanes=J,y}function gf(m,y,C,D){return m=n(7,m,D,y),m.lanes=C,m}function SE(m,y,C,D){m=n(22,m,D,y),m.elementType=yh,m.lanes=C;var z={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var J=z._current;if(J===null)throw Error(i(456));if(!(z._pendingVisibility&2)){var Se=rt(J,2);Se!==null&&(z._pendingVisibility|=2,qo(Se,J,2))}},attach:function(){var J=z._current;if(J===null)throw Error(i(456));if(z._pendingVisibility&2){var Se=rt(J,2);Se!==null&&(z._pendingVisibility&=-3,qo(Se,J,2))}}};return m.stateNode=z,m}function B0(m,y,C){return m=n(6,m,null,y),m.lanes=C,m}function Fy(m,y,C){return y=n(4,m.children!==null?m.children:[],m.key,y),y.lanes=C,y.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},y}function TE(m,y,C,D,z,J,Se,ze){this.tag=1,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=G0,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=U(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=U(0),this.hiddenUpdates=U(null),this.identifierPrefix=D,this.onUncaughtError=z,this.onCaughtError=J,this.onRecoverableError=Se,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ze,this.incompleteTransitions=new Map}function zy(m,y,C,D,z,J,Se,ze,ut,Dt,en,xn){return m=new TE(m,y,C,Se,ze,ut,Dt,xn),y=1,J===!0&&(y|=24),J=n(3,null,null,y),m.current=J,J.stateNode=m,y=Iy(),y.refCount++,m.pooledCache=y,y.refCount++,J.memoizedState={element:D,isDehydrated:C,cache:y},j(J),m}function qr(m){return m?(m=Ko,m):Ko}function F0(m){var y=m._reactInternals;if(y===void 0)throw typeof m.render=="function"?Error(i(188)):(m=Object.keys(m).join(","),Error(i(268,m)));return m=f(y),m=m!==null?p(m):null,m===null?null:vf(m.stateNode)}function Ex(m,y,C,D,z,J){z=qr(z),D.context===null?D.context=z:D.pendingContext=z,D=me(y),D.payload={element:C},J=J===void 0?null:J,J!==null&&(D.callback=J),C=De(m,D,y),C!==null&&(qo(C,m,y),je(C,m,y))}function km(m,y){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var C=m.retryLane;m.retryLane=C!==0&&C<y?C:y}}function md(m,y){km(m,y),(m=m.alternate)&&km(m,y)}var Vr={},wp=Be,us=Yj,mh=Object.assign,Cp=Symbol.for("react.element"),Dm=Symbol.for("react.transitional.element"),Rp=Symbol.for("react.portal"),gh=Symbol.for("react.fragment"),Jc=Symbol.for("react.strict_mode"),vh=Symbol.for("react.profiler"),Ap=Symbol.for("react.provider"),xE=Symbol.for("react.consumer"),Au=Symbol.for("react.context"),Pm=Symbol.for("react.forward_ref"),z0=Symbol.for("react.suspense"),Mp=Symbol.for("react.suspense_list"),H0=Symbol.for("react.memo"),Mu=Symbol.for("react.lazy"),yh=Symbol.for("react.offscreen"),fR=Symbol.for("react.memo_cache_sentinel"),ro=Symbol.iterator,wE=Symbol.for("react.client.reference"),vr=wp.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Lm,Hy,Op=!1,gd=Array.isArray,j0=e.rendererVersion,_c=e.rendererPackageName,Ou=e.extraDevToolsConfig,vf=e.getPublicInstance,Um=e.getRootHostContext,Sx=e.getChildHostContext,Tx=e.prepareForCommit,xx=e.resetAfterCommit,Np=e.createInstance,Ip=e.appendInitialChild,CE=e.finalizeInitialChildren,Bm=e.shouldSetTextContent,V0=e.createTextInstance,wx=e.scheduleTimeout,jy=e.cancelTimeout,G0=e.noTimeout,ql=e.isPrimaryRenderer;e.warnsIfNotActing;var Co=e.supportsMutation,Nu=e.supportsPersistence,Sl=e.supportsHydration,q0=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var pR=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var $o=e.setCurrentUpdatePriority,io=e.getCurrentUpdatePriority,Iu=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Tl=e.shouldAttemptEagerTransition,hs=e.detachDeletedInstance;e.requestPostPaintCallback;var RE=e.maySuspendCommit,ku=e.preloadInstance,AE=e.startSuspendingCommit,Vy=e.suspendInstance,ME=e.waitForCommitToBeReady,vd=e.NotPendingTransition,xl=e.HostTransitionContext,lr=e.resetFormInstance;e.bindToConsole;var Gy=e.supportsMicrotasks,tr=e.scheduleMicrotask,wl=e.supportsTestSelectors,$0=e.findFiberRoot,OE=e.getBoundingRect,Fa=e.getTextContent,kp=e.isHiddenSubtree,Cx=e.matchAccessibilityRole,NE=e.setFocusIfFocusable,Os=e.setupIntersectionObserver,Wo=e.appendChild,qy=e.appendChildToContainer,IE=e.commitTextUpdate,mR=e.commitMount,W0=e.commitUpdate,Rx=e.insertBefore,Ax=e.insertInContainerBefore,Fm=e.removeChild,kE=e.removeChildFromContainer,Y0=e.resetTextContent,Zc=e.hideInstance,zm=e.hideTextInstance,$y=e.unhideInstance,za=e.unhideTextInstance,Hm=e.clearContainer,X0=e.cloneInstance,Wy=e.createContainerChildSet,Du=e.appendChildToContainerChildSet,Dp=e.finalizeContainerChildren,DE=e.replaceContainerChildren,jm=e.cloneHiddenInstance,Ha=e.cloneHiddenTextInstance,Vm=e.isSuspenseInstancePending,fa=e.isSuspenseInstanceFallback,_h=e.getSuspenseInstanceFallbackErrorDetails,Mx=e.registerSuspenseInstanceRetry,Gm=e.canHydrateFormStateMarker,Yy=e.isFormStateMarkerMatching,Yo=e.getNextHydratableSibling,Ro=e.getFirstHydratableChild,Ao=e.getFirstHydratableChildWithinContainer,PE=e.getFirstHydratableChildWithinSuspenseInstance,Ox=e.canHydrateInstance,yd=e.canHydrateTextInstance,bi=e.canHydrateSuspenseInstance,gR=e.hydrateInstance,vR=e.hydrateTextInstance,yR=e.hydrateSuspenseInstance,qm=e.getNextHydratableInstanceAfterSuspenseInstance,$m=e.commitHydratedContainer,K0=e.commitHydratedSuspenseInstance,_R=e.clearSuspenseBoundary,bR=e.clearSuspenseBoundaryFromContainer,Nx=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var Pu=e.validateHydratableInstance,Lu=e.validateHydratableTextInstance,so=e.supportsResources,bh=e.isHostHoistableType,_d=e.getHoistableRoot,Eh=e.getResource,Vs=e.acquireResource,Xo=e.releaseResource,LE=e.hydrateHoistable,J0=e.mountHoistable,UE=e.unmountHoistable,ER=e.createHoistableInstance,Ix=e.prepareToCommitHoistables,Xy=e.mayResourceSuspendCommit,BE=e.preloadResource,SR=e.suspendResource,Ca=e.supportsSingletons,Wm=e.resolveSingletonInstance,Ky=e.clearSingleton,FE=e.acquireSingletonInstance,zE=e.releaseSingletonInstance,HE=e.isHostSingletonType,ao=[],yf=-1,Ko={},Jo=Math.clz32?Math.clz32:T,TR=Math.log,Jy=Math.LN2,Z0=128,ja=4194304,Ns=us.unstable_scheduleCallback,Sh=us.unstable_cancelCallback,xR=us.unstable_shouldYield,Hi=us.unstable_requestPaint,Jn=us.unstable_now,kx=us.unstable_ImmediatePriority,oo=us.unstable_UserBlockingPriority,Is=us.unstable_NormalPriority,_f=us.unstable_IdlePriority,Ym=us.log,jE=us.unstable_setDisableYieldValue,O=null,S=null,R=typeof Object.is=="function"?Object.is:Y,M=new WeakMap,P=[],B=0,H=null,te=0,ie=[],K=0,se=null,he=1,pe="",Ne=_(null),Je=_(null),Ye=_(null),Oe=_(null),_e=null,lt=null,wt=!1,Kt=null,It=!1,Kn=Error(i(519)),wn=[],yr=0,Fr=0,kr=null,xr=null,_r=!1,Rr=!1,Dr=!1,br=0,Ar=null,ur=0,Tn=0,$n=null,$r=!1,Ji=!1,ys=Object.prototype.hasOwnProperty,Zi=Error(i(460)),ds=Error(i(474)),Qi={then:function(){}},Ii=null,hi=null,$i=0,es=si(!0),fs=si(!1),Js=_(null),pa=_(0),_s=_(null),ks=null,di=_(0),Ra=0,Zn=null,Gr=null,Mi=null,Va=!1,Mo=!1,bc=!1,Qc=0,ps=0,Zo=null,Th=0,$l=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Aa={readContext:Ua,use:yt,useCallback:er,useContext:er,useEffect:er,useImperativeHandle:er,useLayoutEffect:er,useInsertionEffect:er,useMemo:er,useReducer:er,useRef:er,useState:er,useDebugValue:er,useDeferredValue:er,useTransition:er,useSyncExternalStore:er,useId:er};Aa.useCacheRefresh=er,Aa.useMemoCache=er,Aa.useHostTransitionStatus=er,Aa.useFormState=er,Aa.useActionState=er,Aa.useOptimistic=er;var co={readContext:Ua,use:yt,useCallback:function(m,y){return ve().memoizedState=[m,y===void 0?null:y],m},useContext:Ua,useEffect:oh,useImperativeHandle:function(m,y,C){C=C!=null?C.concat([m]):null,bp(4194308,4,jo.bind(null,y,m),C)},useLayoutEffect:function(m,y){return bp(4194308,4,m,y)},useInsertionEffect:function(m,y){bp(4,2,m,y)},useMemo:function(m,y){var C=ve();y=y===void 0?null:y;var D=m();if(bc){Z(!0);try{m()}finally{Z(!1)}}return C.memoizedState=[D,y],D},useReducer:function(m,y,C){var D=ve();if(C!==void 0){var z=C(y);if(bc){Z(!0);try{C(y)}finally{Z(!1)}}}else z=y;return D.memoizedState=D.baseState=z,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:z},D.queue=m,m=m.dispatch=dx.bind(null,Zn,m),[D.memoizedState,m]},useRef:function(m){var y=ve();return m={current:m},y.memoizedState=m},useState:function(m){m=vs(m);var y=m.queue,C=lE.bind(null,Zn,y);return y.dispatch=C,[m.memoizedState,C]},useDebugValue:Vo,useDeferredValue:function(m,y){var C=ve();return yu(C,m,y)},useTransition:function(){var m=vs(!1);return m=od.bind(null,Zn,m.queue,!0,!1),ve().memoizedState=m,[!1,m]},useSyncExternalStore:function(m,y,C){var D=Zn,z=ve();if(wt){if(C===void 0)throw Error(i(407));C=C()}else{if(C=y(),Mn===null)throw Error(i(349));In&60||cr(D,y,C)}z.memoizedState=C;var J={value:C,getSnapshot:y};return z.queue=J,oh(gr.bind(null,D,J,m),[m]),D.flags|=2048,_l(9,Cn.bind(null,D,J,C,y),{destroy:void 0},null),C},useId:function(){var m=ve(),y=Mn.identifierPrefix;if(wt){var C=pe,D=he;C=(D&~(1<<32-Jo(D)-1)).toString(32)+C,y=":"+y+"R"+C,C=Qc++,0<C&&(y+="H"+C.toString(32)),y+=":"}else C=Th++,y=":"+y+"r"+C.toString(32)+":";return m.memoizedState=y},useCacheRefresh:function(){return ve().memoizedState=My.bind(null,Zn)}};co.useMemoCache=Ze,co.useHostTransitionStatus=ch,co.useFormState=cs,co.useActionState=cs,co.useOptimistic=function(m){var y=ve();y.memoizedState=y.baseState=m;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return y.queue=C,y=of.bind(null,Zn,!0,C),C.dispatch=y,[m,y]};var Oo={readContext:Ua,use:yt,useCallback:hx,useContext:Ua,useEffect:f0,useImperativeHandle:m0,useInsertionEffect:Ry,useLayoutEffect:p0,useMemo:oE,useReducer:nn,useRef:oa,useState:function(){return nn(Ht)},useDebugValue:Vo,useDeferredValue:function(m,y){var C=Ke();return bm(C,Gr.memoizedState,m,y)},useTransition:function(){var m=nn(Ht)[0],y=Ke().memoizedState;return[typeof m=="boolean"?m:vt(m),y]},useSyncExternalStore:or,useId:Ay};Oo.useCacheRefresh=cE,Oo.useMemoCache=Ze,Oo.useHostTransitionStatus=ch,Oo.useFormState=bn,Oo.useActionState=bn,Oo.useOptimistic=function(m,y){var C=Ke();return Kr(C,Gr,m,y)};var Qo={readContext:Ua,use:yt,useCallback:hx,useContext:Ua,useEffect:f0,useImperativeHandle:m0,useInsertionEffect:Ry,useLayoutEffect:p0,useMemo:oE,useReducer:Sn,useRef:oa,useState:function(){return Sn(Ht)},useDebugValue:Vo,useDeferredValue:function(m,y){var C=Ke();return Gr===null?yu(C,m,y):bm(C,Gr.memoizedState,m,y)},useTransition:function(){var m=Sn(Ht)[0],y=Ke().memoizedState;return[typeof m=="boolean"?m:vt(m),y]},useSyncExternalStore:or,useId:Ay};Qo.useCacheRefresh=cE,Qo.useMemoCache=Ze,Qo.useHostTransitionStatus=ch,Qo.useFormState=qn,Qo.useActionState=qn,Qo.useOptimistic=function(m,y){var C=Ke();return Gr!==null?Kr(C,Gr,m,y):(C.baseState=m,[m,C.queue.dispatch])};var bf={isMounted:function(m){return(m=m._reactInternals)?h(m)===m:!1},enqueueSetState:function(m,y,C){m=m._reactInternals;var D=wo(),z=me(D);z.payload=y,C!=null&&(z.callback=C),y=De(m,z,D),y!==null&&(qo(y,m,D),je(y,m,D))},enqueueReplaceState:function(m,y,C){m=m._reactInternals;var D=wo(),z=me(D);z.tag=1,z.payload=y,C!=null&&(z.callback=C),y=De(m,z,D),y!==null&&(qo(y,m,D),je(y,m,D))},enqueueForceUpdate:function(m,y){m=m._reactInternals;var C=wo(),D=me(C);D.tag=2,y!=null&&(D.callback=y),y=De(m,D,C),y!==null&&(qo(y,m,C),je(y,m,C))}},Ef=typeof reportError=="function"?reportError:function(m){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof m=="object"&&m!==null&&typeof m.message=="string"?String(m.message):String(m),error:m});if(!window.dispatchEvent(y))return}else if(typeof zn=="object"&&typeof zn.emit=="function"){zn.emit("uncaughtException",m);return}console.error(m)},Pp=Error(i(461)),Gs=!1,bd={dehydrated:null,treeContext:null,retryLane:0},xh=_(null),Uu=null,Cl=null,Q0=typeof AbortController<"u"?AbortController:function(){var m=[],y=this.signal={aborted:!1,addEventListener:function(C,D){m.push(D)}};this.abort=function(){y.aborted=!0,m.forEach(function(C){return C()})}},Zy=us.unstable_scheduleCallback,ev=us.unstable_NormalPriority,Wi={$$typeof:Au,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},tv=vr.S;vr.S=function(m,y){typeof y=="object"&&y!==null&&typeof y.then=="function"&&Mt(m,y),tv!==null&&tv(m,y)};var wh=_(null),b=!1,w=!1,F=!1,Q=typeof WeakSet=="function"?WeakSet:Set,le=null,xe=!1,Pe=null,We=!1,ct=null,kt=8192,Lt={getCacheForType:function(m){var y=Ua(Wi),C=y.data.get(m);return C===void 0&&(C=m(),y.data.set(m,C)),C}},Wt=0,An=1,Un=2,nr=3,Ut=4;if(typeof Symbol=="function"&&Symbol.for){var Zt=Symbol.for;Wt=Zt("selector.component"),An=Zt("selector.has_pseudo_class"),Un=Zt("selector.role"),nr=Zt("selector.test_id"),Ut=Zt("selector.text")}var mr=typeof WeakMap=="function"?WeakMap:Map,Gt=0,Mn=null,on=null,In=0,ln=0,Fn=null,xs=!1,Ds=!1,Ec=!1,ki=0,fi=0,Sc=0,Wl=0,Qy=0,Yl=0,Lp=0,Ed=null,Sd=null,Dx=!1,e_=0,nv=1/0,rv=null,Td=null,VE=!1,Sf=null,Xm=0,dz=0,fz=null,wR=0,pz=null;return Vr.attemptContinuousHydration=function(m){if(m.tag===13){var y=rt(m,67108864);y!==null&&qo(y,m,67108864),md(m,67108864)}},Vr.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var y=wo(),C=rt(m,y);C!==null&&qo(C,m,y),md(m,y)}},Vr.attemptSynchronousHydration=function(m){switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var y=x(m.pendingLanes);if(y!==0){for(m.pendingLanes|=2,m.entangledLanes|=2;y;){var C=1<<31-Jo(y);m.entanglements[1]|=C,y&=~C}bt(m),!(Gt&6)&&(nv=Jn()+500,be(0))}}break;case 13:y=rt(m,2),y!==null&&qo(y,m,2),Ly(),md(m,2)}},Vr.batchedUpdates=function(m,y){return m(y)},Vr.createComponentSelector=function(m){return{$$typeof:Wt,value:m}},Vr.createContainer=function(m,y,C,D,z,J,Se,ze,ut,Dt){return zy(m,y,!1,null,C,D,J,Se,ze,ut,Dt,null)},Vr.createHasPseudoClassSelector=function(m){return{$$typeof:An,value:m}},Vr.createHydrationContainer=function(m,y,C,D,z,J,Se,ze,ut,Dt,en,xn,Rn){return m=zy(C,D,!0,m,z,J,ze,ut,Dt,en,xn,Rn),m.context=qr(null),C=m.current,D=wo(),z=me(D),z.callback=y??null,De(C,z,D),m.current.lanes=D,$(m,D),bt(m),m},Vr.createPortal=function(m,y,C){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rp,key:D==null?null:""+D,children:m,containerInfo:y,implementation:C}},Vr.createRoleSelector=function(m){return{$$typeof:Un,value:m}},Vr.createTestNameSelector=function(m){return{$$typeof:nr,value:m}},Vr.createTextSelector=function(m){return{$$typeof:Ut,value:m}},Vr.defaultOnCaughtError=function(m){console.error(m)},Vr.defaultOnRecoverableError=function(m){Ef(m)},Vr.defaultOnUncaughtError=function(m){Ef(m)},Vr.deferredUpdates=function(m){var y=vr.T,C=io();try{return $o(32),vr.T=null,m()}finally{$o(C),vr.T=y}},Vr.discreteUpdates=function(m,y,C,D,z){var J=vr.T,Se=io();try{return $o(2),vr.T=null,m(y,C,D,z)}finally{$o(Se),vr.T=J,Gt===0&&(nv=Jn()+500)}},Vr.findAllNodes=pf,Vr.findBoundingRects=function(m,y){if(!wl)throw Error(i(363));y=pf(m,y),m=[];for(var C=0;C<y.length;C++)m.push(OE(y[C]));for(y=m.length-1;0<y;y--){C=m[y];for(var D=C.x,z=D+C.width,J=C.y,Se=J+C.height,ze=y-1;0<=ze;ze--)if(y!==ze){var ut=m[ze],Dt=ut.x,en=Dt+ut.width,xn=ut.y,Rn=xn+ut.height;if(D>=Dt&&J>=xn&&z<=en&&Se<=Rn){m.splice(y,1);break}else if(D!==Dt||C.width!==ut.width||Rn<J||xn>Se){if(!(J!==xn||C.height!==ut.height||en<D||Dt>z)){Dt>D&&(ut.width+=Dt-D,ut.x=D),en<z&&(ut.width=z-Dt),m.splice(y,1);break}}else{xn>J&&(ut.height+=xn-J,ut.y=J),Rn<Se&&(ut.height=Se-xn),m.splice(y,1);break}}}return m},Vr.findHostInstance=F0,Vr.findHostInstanceWithNoPortals=function(m){return m=f(m),m=m!==null?g(m):null,m===null?null:vf(m.stateNode)},Vr.findHostInstanceWithWarning=function(m){return F0(m)},Vr.flushPassiveEffects=yc,Vr.flushSyncFromReconciler=function(m){var y=Gt;Gt|=1;var C=vr.T,D=io();try{if($o(2),vr.T=null,m)return m()}finally{$o(D),vr.T=C,Gt=y,!(Gt&6)&&be(0)}},Vr.flushSyncWork=Ly,Vr.focusWithin=function(m,y){if(!wl)throw Error(i(363));for(m=Vl(m),y=M0(m,y),y=Array.from(y),m=0;m<y.length;){var C=y[m++],D=C.tag;if(!kp(C)){if((D===5||D===26||D===27)&&NE(C.stateNode))return!0;for(C=C.child;C!==null;)y.push(C),C=C.sibling}}return!1},Vr.getFindAllNodesFailureDescription=function(m,y){if(!wl)throw Error(i(363));var C=0,D=[];m=[Vl(m),0];for(var z=0;z<m.length;){var J=m[z++],Se=J.tag,ze=m[z++],ut=y[ze];if((Se!==5&&Se!==26&&Se!==27||!kp(J))&&(Py(J,ut)&&(D.push(A0(ut)),ze++,ze>C&&(C=ze)),ze<y.length))for(J=J.child;J!==null;)m.push(J,ze),J=J.sibling}if(C<y.length){for(m=[];C<y.length;C++)m.push(A0(y[C]));return`findAllNodes was able to match part of the selector:
  `+(D.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},Vr.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 27:case 5:return vf(m.child.stateNode);default:return m.child.stateNode}},Vr.injectIntoDevTools=function(){var m={bundleType:0,version:j0,rendererPackageName:_c,currentDispatcherRef:vr,findFiberByHostInstance:q0,reconcilerVersion:"19.0.0"};if(Ou!==null&&(m.rendererConfig=Ou),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var y=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(y.isDisabled||!y.supportsFiber)m=!0;else{try{O=y.inject(m),S=y}catch{}m=!!y.checkDCE}}return m},Vr.isAlreadyRendering=function(){return!1},Vr.observeVisibleRects=function(m,y,C,D){if(!wl)throw Error(i(363));m=pf(m,y);var z=Os(m,C,D).disconnect;return{disconnect:function(){z()}}},Vr.shouldError=function(){return null},Vr.shouldSuspend=function(){return!1},Vr.startHostTransition=function(m,y,C,D){if(m.tag!==5)throw Error(i(476));var z=Ss(m).queue;od(m,z,y,vd,C===null?r:function(){var J=Ss(m).next.queue;return af(m,J,{},wo()),C(D)})},Vr.updateContainer=function(m,y,C,D){var z=y.current,J=wo();return Ex(z,J,m,y,C,D),J},Vr.updateContainerSync=function(m,y,C,D){return y.tag===0&&yc(),Ex(y.current,2,m,y,C,D),2},Vr},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})})(voe);var rOe=voe.exports;goe.exports=rOe;var iOe=goe.exports;const sOe=qc(iOe),aOe=t=>typeof t=="object"&&typeof t.then=="function",Nk=[];function oOe(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function cOe(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const s of Nk)if(oOe(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=Nk.indexOf(i);s!==-1&&Nk.splice(s,1)},promise:(aOe(t)?t:t(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(Nk.push(i),!n)throw i.promise}const lOe=(t,e,n)=>cOe(t,e,!1,n);function r$(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const i=r$(r,e,n);if(i)return i;r=e?null:r.sibling}}function boe(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const i$=boe(Be.createContext(null));let Eoe=class extends Be.Component{render(){return Be.createElement(i$.Provider,{value:this._reactInternals},this.props.children)}};function Soe(){const t=Be.useContext(i$);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Be.useId();return Be.useMemo(()=>{for(const n of[t,t==null?void 0:t.alternate]){if(!n)continue;const r=r$(n,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(r)return r}},[t,e])}const uOe=Symbol.for("react.context"),hOe=t=>t!==null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===uOe;function dOe(){const t=Soe(),[e]=Be.useState(()=>new Map);e.clear();let n=t;for(;n;){const r=n.type;hOe(r)&&r!==i$&&!e.has(r)&&e.set(r,Be.use(boe(r))),n=n.return}return e}function fOe(){const t=dOe();return Be.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>Be.createElement(e,null,Be.createElement(n.Provider,{...r,value:t.get(n)})),e=>Be.createElement(Eoe,{...e})),[t])}function Toe(t){let e=t.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const xoe=t=>t&&t.isOrthographicCamera,pOe=t=>t&&t.hasOwnProperty("current"),mOe=t=>t!=null&&(typeof t=="string"||typeof t=="number"||t.isColor),lN=((t,e)=>typeof window<"u"&&(((t=window.document)==null?void 0:t.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Be.useLayoutEffect:Be.useEffect;function s$(t){const e=Be.useRef(t);return lN(()=>void(e.current=t),[t]),e}function gOe(){const t=Soe(),e=fOe();return Be.useMemo(()=>({children:n})=>{const i=!!r$(t,!0,s=>s.type===Be.StrictMode)?Be.StrictMode:Be.Fragment;return Ae.jsx(i,{children:Ae.jsx(e,{children:n})})},[t,e])}function vOe({set:t}){return lN(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}const yOe=(t=>(t=class extends Be.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},t.getDerivedStateFromError=()=>({error:!0}),t))();function woe(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}function Qx(t){var e;return(e=t.__r3f)==null?void 0:e.root.getState()}const Wa={obj:t=>t===Object(t)&&!Wa.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,nul:t=>t===null,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Wa.str(t)||Wa.num(t)||Wa.boo(t))return t===e;const s=Wa.obj(t);if(s&&r==="reference")return t===e;const a=Wa.arr(t);if(a&&n==="reference")return t===e;if((a||s)&&t===e)return!0;let o;for(o in t)if(!(o in e))return!1;if(s&&n==="shallow"&&r==="shallow"){for(o in i?e:t)if(!Wa.equ(t[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:t)if(t[o]!==e[o])return!1;if(Wa.und(o)){if(a&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function _Oe(t){t.type!=="Scene"&&(t.dispose==null||t.dispose());for(const e in t){const n=t[e];(n==null?void 0:n.type)!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const Coe=["children","key","ref"];function bOe(t){const e={};for(const n in t)Coe.includes(n)||(e[n]=t[n]);return e}function PL(t,e,n,r){const i=t;let s=i==null?void 0:i.__r3f;return s||(s={root:e,type:n,parent:null,children:[],props:bOe(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function DM(t,e){let n=t[e];if(!e.includes("-"))return{root:t,key:e,target:n};n=t;for(const i of e.split("-")){var r;e=i,t=n,n=(r=n)==null?void 0:r[e]}return{root:t,key:e,target:n}}const QK=/-\d+$/;function LL(t,e){if(Wa.str(e.props.attach)){if(QK.test(e.props.attach)){const i=e.props.attach.replace(QK,""),{root:s,key:a}=DM(t.object,i);Array.isArray(s[a])||(s[a]=[])}const{root:n,key:r}=DM(t.object,e.props.attach);e.previousAttach=n[r],n[r]=e.object}else Wa.fun(e.props.attach)&&(e.previousAttach=e.props.attach(t.object,e.object))}function UL(t,e){if(Wa.str(e.props.attach)){const{root:n,key:r}=DM(t.object,e.props.attach),i=e.previousAttach;i===void 0?delete n[r]:n[r]=i}else e.previousAttach==null||e.previousAttach(t.object,e.object);delete e.previousAttach}const Xj=[...Coe,"args","dispose","attach","object","onUpdate","dispose"],eJ=new Map;function EOe(t){let e=eJ.get(t.constructor);try{e||(e=new t.constructor,eJ.set(t.constructor,e))}catch{}return e}function SOe(t,e){const n={};for(const r in e)if(!Xj.includes(r)&&!Wa.equ(e[r],t.props[r])){n[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(n[i]=e[i])}for(const r in t.props){if(Xj.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:s}=DM(t.object,r);if(i.constructor&&i.constructor.length===0){const a=EOe(i);Wa.und(a)||(n[s]=a[s])}else n[s]=0}return n}const TOe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],xOe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function F_(t,e){var n;const r=t.__r3f,i=r&&Toe(r).getState(),s=r==null?void 0:r.eventCount;for(const o in e){let c=e[o];if(Xj.includes(o))continue;if(r&&xOe.test(o)){typeof c=="function"?r.handlers[o]=c:delete r.handlers[o],r.eventCount=Object.keys(r.handlers).length;continue}if(c===void 0)continue;let{root:l,key:u,target:h}=DM(t,o);if(h instanceof Fw&&c instanceof Fw)h.mask=c.mask;else if(h instanceof _n&&mOe(c))h.set(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&c!=null&&c.constructor&&h.constructor===c.constructor)h.copy(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(c))typeof h.fromArray=="function"?h.fromArray(c):h.set(...c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof c=="number")typeof h.setScalar=="function"?h.setScalar(c):h.set(c);else{var a;l[u]=c,i&&!i.linear&&TOe.includes(u)&&(a=l[u])!=null&&a.isTexture&&l[u].format===iu&&l[u].type===gl&&(l[u].colorSpace=ya)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(n=r.object)!=null&&n.isObject3D&&s!==r.eventCount){const o=r.object,c=i.internal.interaction.indexOf(o);c>-1&&i.internal.interaction.splice(c,1),r.eventCount&&o.raycast!==null&&i.internal.interaction.push(o)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&HC(r),t}function HC(t){var e;if(!t.parent)return;t.props.onUpdate==null||t.props.onUpdate(t.object);const n=(e=t.root)==null||e.getState==null?void 0:e.getState();n&&n.internal.frames===0&&n.invalidate()}function Roe(t,e){t.manual||(xoe(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix())}const kh=t=>t==null?void 0:t.isObject3D;function Ik(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function Aoe(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function wOe(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{Aoe(n.capturedMap,e,r,i)})}function COe(t){function e(c){const{internal:l}=t.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function n(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=t.getState(),h=new Set,d=[],f=l?l(u.internal.interaction):u.internal.interaction;for(let v=0;v<f.length;v++){const E=Qx(f[v]);E&&(E.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(v){const E=Qx(v);if(!E||!E.events.enabled||E.raycaster.camera===null)return[];if(E.raycaster.camera===void 0){var T;E.events.compute==null||E.events.compute(c,E,(T=E.previousRoot)==null?void 0:T.getState()),E.raycaster.camera===void 0&&(E.raycaster.camera=null)}return E.raycaster.camera?E.raycaster.intersectObject(v,!0):[]}let g=f.flatMap(p).sort((v,E)=>{const T=Qx(v.object),x=Qx(E.object);return!T||!x?v.distance-E.distance:x.events.priority-T.events.priority||v.distance-E.distance}).filter(v=>{const E=Ik(v);return h.has(E)?!1:(h.add(E),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const v of g){let E=v.object;for(;E;){var _;(_=E.__r3f)!=null&&_.eventCount&&d.push({...v,eventObject:E}),E=E.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let v of u.internal.capturedMap.get(c.pointerId).values())h.has(Ik(v.intersection))||d.push(v.intersection);return d}function i(c,l,u,h){if(c.length){const d={stopped:!1};for(const f of c){let p=Qx(f.object);if(p||f.object.traverseAncestors(g=>{const _=Qx(g);if(_)return p=_,!1}),p){const{raycaster:g,pointer:_,camera:v,internal:E}=p,T=new Re(_.x,_.y,0).unproject(v),x=L=>{var U,$;return(U=($=E.capturedMap.get(L))==null?void 0:$.has(f.eventObject))!=null?U:!1},N=L=>{const U={intersection:f,target:l.target};E.capturedMap.has(L)?E.capturedMap.get(L).set(f.eventObject,U):E.capturedMap.set(L,new Map([[f.eventObject,U]])),l.target.setPointerCapture(L)},A=L=>{const U=E.capturedMap.get(L);U&&Aoe(E.capturedMap,f.eventObject,U,L)};let I={};for(let L in l){let U=l[L];typeof U!="function"&&(I[L]=U)}let k={...f,...I,pointer:_,intersections:c,stopped:d.stopped,delta:u,unprojectedPoint:T,ray:g.ray,camera:v,stopPropagation(){const L="pointerId"in l&&E.capturedMap.get(l.pointerId);if((!L||L.has(f.eventObject))&&(k.stopped=d.stopped=!0,E.hovered.size&&Array.from(E.hovered.values()).find(U=>U.eventObject===f.eventObject))){const U=c.slice(0,c.indexOf(f));s([...U,f])}},target:{hasPointerCapture:x,setPointerCapture:N,releasePointerCapture:A},currentTarget:{hasPointerCapture:x,setPointerCapture:N,releasePointerCapture:A},nativeEvent:l};if(h(k),d.stopped===!0)break}}}return c}function s(c){const{internal:l}=t.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f;if(l.hovered.delete(Ik(u)),d!=null&&d.eventCount){const f=d.handlers,p={...u,intersections:c};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function a(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function o(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=t.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=t.getState();d.lastEvent.current=u;const f=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",_=r(u,f?n:void 0),v=p?e(u):0;c==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=_.map(T=>T.eventObject)),p&&!_.length&&v<=2&&(a(u,d.interaction),h&&h(u)),f&&s(_);function E(T){const x=T.eventObject,N=x.__r3f;if(!(N!=null&&N.eventCount))return;const A=N.handlers;if(f){if(A.onPointerOver||A.onPointerEnter||A.onPointerOut||A.onPointerLeave){const I=Ik(T),k=d.hovered.get(I);k?k.stopped&&T.stopPropagation():(d.hovered.set(I,T),A.onPointerOver==null||A.onPointerOver(T),A.onPointerEnter==null||A.onPointerEnter(T))}A.onPointerMove==null||A.onPointerMove(T)}else{const I=A[c];I?(!p||d.initialHits.includes(x))&&(a(u,d.interaction.filter(k=>!d.initialHits.includes(k))),I(T)):p&&d.initialHits.includes(x)&&a(u,d.interaction.filter(k=>!d.initialHits.includes(k)))}}i(_,u,v,E)}}return{handlePointer:o}}const tJ=t=>!!(t!=null&&t.render),a$=Be.createContext(null),ROe=(t,e)=>{const n=moe((o,c)=>{const l=new Re,u=new Re,h=new Re;function d(v=c().camera,E=u,T=c().size){const{width:x,height:N,top:A,left:I}=T,k=x/N;E.isVector3?h.copy(E):h.set(...E);const L=v.getWorldPosition(l).distanceTo(h);if(xoe(v))return{width:x/v.zoom,height:N/v.zoom,top:A,left:I,factor:1,distance:L,aspect:k};{const U=v.fov*Math.PI/180,$=2*Math.tan(U/2)*L,q=$*(x/N);return{width:q,height:$,top:A,left:I,factor:x/q,distance:L,aspect:k}}}let f;const p=v=>o(E=>({performance:{...E.performance,current:v}})),g=new Rt;return{set:o,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(v=1)=>t(c(),v),advance:(v,E)=>e(v,E,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $q,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=c();f&&clearTimeout(f),v.performance.current!==v.performance.min&&p(v.performance.min),f=setTimeout(()=>p(c().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:v=>o(E=>({...E,events:{...E.events,...v}})),setSize:(v,E,T=0,x=0)=>{const N=c().camera,A={width:v,height:E,top:T,left:x};o(I=>({size:A,viewport:{...I.viewport,...d(N,u,A)}}))},setDpr:v=>o(E=>{const T=woe(v);return{viewport:{...E.viewport,dpr:T,initialDpr:E.viewport.initialDpr||T}}}),setFrameloop:(v="always")=>{const E=c().clock;E.stop(),E.elapsedTime=0,v!=="never"&&(E.start(),E.elapsedTime=0),o(()=>({frameloop:v}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Be.createRef(),active:!1,frames:0,priority:0,subscribe:(v,E,T)=>{const x=c().internal;return x.priority=x.priority+(E>0?1:0),x.subscribers.push({ref:v,priority:E,store:T}),x.subscribers=x.subscribers.sort((N,A)=>N.priority-A.priority),()=>{const N=c().internal;N!=null&&N.subscribers&&(N.priority=N.priority-(E>0?1:0),N.subscribers=N.subscribers.filter(A=>A.ref!==v))}}}}}),r=n.getState();let i=r.size,s=r.viewport.dpr,a=r.camera;return n.subscribe(()=>{const{camera:o,size:c,viewport:l,gl:u,set:h}=n.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){i=c,s=l.dpr,Roe(o,c),l.dpr>0&&u.setPixelRatio(l.dpr);const d=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,d)}o!==a&&(a=o,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(o)}})))}),n.subscribe(o=>t(o)),n};function o$(){const t=Be.useContext(a$);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Zu(t=n=>n,e){return o$()(t,e)}function fy(t,e=0){const n=o$(),r=n.getState().internal.subscribe,i=s$(t);return lN(()=>r(i,e,n),[e,r,n]),null}function AOe(t){const e=sOe(t);return e.injectIntoDevTools({bundleType:(typeof zn<"u",0),rendererPackageName:"@react-three/fiber",version:Be.version}),e}const Moe=0,qw={},MOe=/^three(?=[A-Z])/,M3=t=>`${t[0].toUpperCase()}${t.slice(1)}`;let OOe=0;const NOe=t=>typeof t=="function";function Ooe(t){if(NOe(t)){const e=`${OOe++}`;return qw[e]=t,e}else Object.assign(qw,t)}function Noe(t,e){const n=M3(t),r=qw[n];if(t!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(t==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function IOe(t,e,n){var r;return t=M3(t)in qw?t:t.replace(MOe,""),Noe(t,e),t==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,PL(e.object,n,t,e)}function kOe(t){if(!t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?UL(t.parent,t):kh(t.object)&&(t.object.visible=!1),t.isHidden=!0,HC(t)}}function Ioe(t){if(t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?LL(t.parent,t):kh(t.object)&&t.props.visible!==!1&&(t.object.visible=!0),t.isHidden=!1,HC(t)}}function c$(t,e,n){const r=e.root.getState();if(!(!t.parent&&t.object!==r.scene)){if(!e.object){var i,s;const a=qw[M3(e.type)];e.object=(i=e.props.object)!=null?i:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(F_(e.object,e.props),e.props.attach)LL(t,e);else if(kh(e.object)&&kh(t.object)){const a=t.object.children.indexOf(n==null?void 0:n.object);if(n&&a!==-1){const o=t.object.children.indexOf(e.object);if(o!==-1){t.object.children.splice(o,1);const c=o<a?a-1:a;t.object.children.splice(c,0,e.object)}else e.object.parent=t.object,t.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),t.object.dispatchEvent({type:"childadded",child:e.object})}else t.object.add(e.object)}for(const a of e.children)c$(e,a);HC(e)}}function r8(t,e){e&&(e.parent=t,t.children.push(e),c$(t,e))}function nJ(t,e,n){if(!e||!n)return;e.parent=t;const r=t.children.indexOf(n);r!==-1?t.children.splice(r,0,e):t.children.push(e),c$(t,e,n)}function koe(t){if(typeof t.dispose=="function"){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():Yj.unstable_scheduleCallback(Yj.unstable_IdlePriority,e)}}function Kj(t,e,n){if(!e)return;e.parent=null;const r=t.children.indexOf(e);r!==-1&&t.children.splice(r,1),e.props.attach?UL(t,e):kh(e.object)&&kh(t.object)&&(t.object.remove(e.object),wOe(Toe(e),e.object));const i=e.props.dispose!==null&&n!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];Kj(e,a,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&koe(e.object),n===void 0&&HC(e)}function DOe(t,e){for(const n of[t,t.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(e);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=e)}const jD=[];function POe(){for(const[n]of jD){const r=n.parent;if(r){n.props.attach?UL(r,n):kh(n.object)&&kh(r.object)&&r.object.remove(n.object);for(const i of n.children)i.props.attach?UL(n,i):kh(i.object)&&kh(n.object)&&n.object.remove(i.object)}n.isHidden&&Ioe(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&koe(n.object)}for(const[n,r,i]of jD){n.props=r;const s=n.parent;if(s){var t,e;const a=qw[M3(n.type)];n.object=(t=n.props.object)!=null?t:new a(...(e=n.props.args)!=null?e:[]),n.object.__r3f=n,DOe(i,n.object),F_(n.object,n.props),n.props.attach?LL(s,n):kh(n.object)&&kh(s.object)&&s.object.add(n.object);for(const o of n.children)o.props.attach?LL(n,o):kh(o.object)&&kh(n.object)&&n.object.add(o.object);HC(n)}}jD.length=0}const i8=()=>{},rJ={};let kk=Moe;const LOe=0,UOe=4,BL=AOe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:IOe,removeChild:Kj,appendChild:r8,appendInitialChild:r8,insertBefore:nJ,appendChildToContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||r8(n,e)},removeChildFromContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||Kj(n,e)},insertInContainerBefore(t,e,n){const r=t.getState().scene.__r3f;!e||!n||!r||nJ(r,e,n)},getRootHostContext:()=>rJ,getChildHostContext:()=>rJ,commitUpdate(t,e,n,r,i){var s,a,o;Noe(e,r);let c=!1;if((t.type==="primitive"&&n.object!==r.object||((s=r.args)==null?void 0:s.length)!==((a=n.args)==null?void 0:a.length)||(o=r.args)!=null&&o.some((u,h)=>{var d;return u!==((d=n.args)==null?void 0:d[h])}))&&(c=!0),c)jD.push([t,{...r},i]);else{const u=SOe(t,r);Object.keys(u).length&&(Object.assign(t.props,u),F_(t.object,u))}(i.sibling===null||(i.flags&UOe)===LOe)&&POe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:t=>t==null?void 0:t.object,prepareForCommit:()=>null,preparePortalMount:t=>PL(t.getState().scene,t,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:kOe,unhideInstance:Ioe,createTextInstance:i8,hideTextInstance:i8,unhideTextInstance:i8,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Be.createContext(null),setCurrentUpdatePriority(t){kk=t},getCurrentUpdatePriority(){return kk},resolveUpdatePriority(){var t;if(kk!==Moe)return kk;switch(typeof window<"u"&&((t=window.event)==null?void 0:t.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return HD.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return HD.ContinuousEventPriority;default:return HD.DefaultEventPriority}},resetFormInstance(){}}),oT=new Map,e1={objects:"shallow",strict:!1};function BOe(t,e){if(!e&&typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:r,top:i,left:s}=t.parentElement.getBoundingClientRect();return{width:n,height:r,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function FOe(t){const e=oT.get(t),n=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||ROe(Qj,sJ),a=n||BL.createContainer(s,HD.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||oT.set(t,{fiber:a,store:s});let o,c,l=!1,u=null;return{async configure(h={}){let d;u=new Promise(de=>d=de);let{gl:f,size:p,scene:g,events:_,onCreated:v,shadows:E=!1,linear:T=!1,flat:x=!1,legacy:N=!1,orthographic:A=!1,frameloop:I="always",dpr:k=[1,2],performance:L,raycaster:U,camera:$,onPointerMissed:q}=h,G=s.getState(),X=G.gl;if(!G.gl){const de={canvas:t,powerPreference:"high-performance",antialias:!0,alpha:!0},Me=typeof f=="function"?await f(de):f;tJ(Me)?X=Me:X=new noe({...de,...f}),G.set({gl:X})}let re=G.raycaster;re||G.set({raycaster:re=new Xq});const{params:V,...Z}=U||{};if(Wa.equ(Z,re,e1)||F_(re,{...Z}),Wa.equ(V,re.params,e1)||F_(re,{params:{...re.params,...V}}),!G.camera||G.camera===c&&!Wa.equ(c,$,e1)){c=$;const de=$==null?void 0:$.isCamera,Me=de?$:A?new cN(0,0,0,0,.1,1e3):new Ic(75,0,.1,1e3);de||(Me.position.z=5,$&&(F_(Me,$),Me.manual||("aspect"in $||"left"in $||"right"in $||"bottom"in $||"top"in $)&&(Me.manual=!0,Me.updateProjectionMatrix())),!G.camera&&!($!=null&&$.rotation)&&Me.lookAt(0,0,0)),G.set({camera:Me}),re.camera=Me}if(!G.scene){let de;g!=null&&g.isScene?(de=g,PL(de,s,"",{})):(de=new Hw,PL(de,s,"",{}),g&&F_(de,g)),G.set({scene:de})}_&&!G.events.handlers&&G.set({events:_(s)});const Y=BOe(t,p);if(Wa.equ(Y,G.size,e1)||G.setSize(Y.width,Y.height,Y.top,Y.left),k&&G.viewport.dpr!==woe(k)&&G.setDpr(k),G.frameloop!==I&&G.setFrameloop(I),G.onPointerMissed||G.set({onPointerMissed:q}),L&&!Wa.equ(L,G.performance,e1)&&G.set(de=>({performance:{...de.performance,...L}})),!G.xr){var ee;const de=(Te,Le)=>{const we=s.getState();we.frameloop!=="never"&&sJ(Te,!0,we,Le)},Me=()=>{const Te=s.getState();Te.gl.xr.enabled=Te.gl.xr.isPresenting,Te.gl.xr.setAnimationLoop(Te.gl.xr.isPresenting?de:null),Te.gl.xr.isPresenting||Qj(Te)},He={connect(){const Te=s.getState().gl;Te.xr.addEventListener("sessionstart",Me),Te.xr.addEventListener("sessionend",Me)},disconnect(){const Te=s.getState().gl;Te.xr.removeEventListener("sessionstart",Me),Te.xr.removeEventListener("sessionend",Me)}};typeof((ee=X.xr)==null?void 0:ee.addEventListener)=="function"&&He.connect(),G.set({xr:He})}if(X.shadowMap){const de=X.shadowMap.enabled,Me=X.shadowMap.type;if(X.shadowMap.enabled=!!E,Wa.boo(E))X.shadowMap.type=AA;else if(Wa.str(E)){var oe;const He={basic:ise,percentage:JU,soft:AA,variance:jp};X.shadowMap.type=(oe=He[E])!=null?oe:AA}else Wa.obj(E)&&Object.assign(X.shadowMap,E);(de!==X.shadowMap.enabled||Me!==X.shadowMap.type)&&(X.shadowMap.needsUpdate=!0)}return Li.enabled=!N,l||(X.outputColorSpace=T?Bg:ya,X.toneMapping=x?em:fq),G.legacy!==N&&G.set(()=>({legacy:N})),G.linear!==T&&G.set(()=>({linear:T})),G.flat!==x&&G.set(()=>({flat:x})),f&&!Wa.fun(f)&&!tJ(f)&&!Wa.equ(f,X,e1)&&F_(X,f),o=v,l=!0,d(),this},render(h){return!l&&!u&&this.configure(),u.then(()=>{BL.updateContainer(Ae.jsx(zOe,{store:s,children:h,onCreated:o,rootElement:t}),a,null,()=>{})}),s},unmount(){Doe(t)}}}function zOe({store:t,children:e,onCreated:n,rootElement:r}){return lN(()=>{const i=t.getState();i.set(s=>({internal:{...s.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),Ae.jsx(a$.Provider,{value:t,children:e})}function Doe(t,e){const n=oT.get(t),r=n==null?void 0:n.fiber;if(r){const i=n==null?void 0:n.store.getState();i&&(i.internal.active=!1),BL.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,a,o,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),_Oe(i.scene),oT.delete(t)}catch{}},500)})}}function HOe(t,e,n){return Ae.jsx(jOe,{children:t,container:e,state:n})}function jOe({state:t={},children:e,container:n}){const{events:r,size:i,...s}=t,a=o$(),[o]=Be.useState(()=>new Xq),[c]=Be.useState(()=>new Rt),l=s$((h,d)=>{let f;if(d.camera&&i){const p=d.camera;f=h.viewport.getCurrentViewport(p,new Re,i),p!==h.camera&&Roe(p,i)}return{...h,...d,scene:n,raycaster:o,pointer:c,mouse:c,previousRoot:a,events:{...h.events,...d.events,...r},size:{...h.size,...i},viewport:{...h.viewport,...f},setEvents:p=>d.set(g=>({...g,events:{...g.events,...p}}))}}),u=Be.useMemo(()=>{const h=moe((f,p)=>({...s,set:f,get:p})),d=f=>h.setState(p=>l.current(f,p));return d(a.getState()),a.subscribe(d),h},[a,n]);return Ae.jsx(Ae.Fragment,{children:BL.createPortal(Ae.jsx(a$.Provider,{value:u,children:e}),u,null)})}function Poe(t,e){const n={callback:t};return e.add(n),()=>void e.delete(n)}const Loe=new Set,Uoe=new Set,VOe=new Set,GOe=t=>Poe(t,Loe),qOe=t=>Poe(t,Uoe);function s8(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function BA(t,e){switch(t){case"before":return s8(Loe,e);case"after":return s8(Uoe,e);case"tail":return s8(VOe,e)}}let a8,o8;function Jj(t,e,n){let r=e.clock.getDelta();e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),a8=e.internal.subscribers;for(let i=0;i<a8.length;i++)o8=a8[i],o8.ref.current(o8.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let FL=!1,Zj=!1,c8,iJ,t1;function Boe(t){iJ=requestAnimationFrame(Boe),FL=!0,c8=0,BA("before",t),Zj=!0;for(const n of oT.values()){var e;t1=n.store.getState(),t1.internal.active&&(t1.frameloop==="always"||t1.internal.frames>0)&&!((e=t1.gl.xr)!=null&&e.isPresenting)&&(c8+=Jj(t,t1))}if(Zj=!1,BA("after",t),c8===0)return BA("tail",t),FL=!1,cancelAnimationFrame(iJ)}function Qj(t,e=1){var n;if(!t)return oT.forEach(r=>Qj(r.store.getState(),e));(n=t.gl.xr)!=null&&n.isPresenting||!t.internal.active||t.frameloop==="never"||(e>1?t.internal.frames=Math.min(60,t.internal.frames+e):Zj?t.internal.frames=2:t.internal.frames=1,FL||(FL=!0,requestAnimationFrame(Boe)))}function sJ(t,e=!0,n,r){if(e&&BA("before",t),n)Jj(t,n,r);else for(const i of oT.values())Jj(t,i.store.getState());e&&BA("after",t)}const l8={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Foe(t){const{handlePointer:e}=COe(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(l8).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{const{set:r,events:i}=t.getState();if(i.disconnect==null||i.disconnect(),r(s=>({events:{...s.events,connected:n}})),i.handlers)for(const s in i.handlers){const a=i.handlers[s],[o,c]=l8[s];n.addEventListener(o,a,{passive:c})}},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const s=r.handlers[i],[a]=l8[i];r.connected.removeEventListener(a,s)}n(i=>({events:{...i.events,connected:void 0}}))}}}}function aJ(t,e){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function $Oe({debounce:t,scroll:e,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Be.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Be.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=t?typeof t=="number"?t:t.scroll:null,l=t?typeof t=="number"?t:t.resize:null,u=Be.useRef(!1);Be.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=Be.useMemo(()=>{const v=()=>{if(!o.current.element)return;const{left:E,top:T,width:x,height:N,bottom:A,right:I,x:k,y:L}=o.current.element.getBoundingClientRect(),U={left:E,top:T,width:x,height:N,bottom:A,right:I,x:k,y:L};o.current.element instanceof HTMLElement&&r&&(U.height=o.current.element.offsetHeight,U.width=o.current.element.offsetWidth),Object.freeze(U),u.current&&!KOe(o.current.lastBounds,U)&&a(o.current.lastBounds=U)};return[v,l?aJ(v,l):v,c?aJ(v,c):v]},[a,r,c,l]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(v=>v.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function g(){o.current.element&&(o.current.resizeObserver=new i(f),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(v=>v.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const _=v=>{!v||v===o.current.element||(p(),o.current.element=v,o.current.scrollContainers=zoe(v),g())};return YOe(f,!!e),WOe(d),Be.useEffect(()=>{p(),g()},[e,f,d]),Be.useEffect(()=>p,[]),[_,s,h]}function WOe(t){Be.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function YOe(t,e){Be.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function zoe(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...zoe(t.parentElement)]}const XOe=["x","y","top","bottom","left","right","width","height"],KOe=(t,e)=>XOe.every(n=>t[n]===e[n]);function JOe({ref:t,children:e,fallback:n,resize:r,style:i,gl:s,events:a=Foe,eventSource:o,eventPrefix:c,shadows:l,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:g,performance:_,raycaster:v,camera:E,scene:T,onPointerMissed:x,onCreated:N,...A}){Be.useMemo(()=>Ooe(vMe),[]);const I=gOe(),[k,L]=$Oe({scroll:!0,debounce:{scroll:50,resize:0},...r}),U=Be.useRef(null),$=Be.useRef(null);Be.useImperativeHandle(t,()=>U.current);const q=s$(x),[G,X]=Be.useState(!1),[re,V]=Be.useState(!1);if(G)throw G;if(re)throw re;const Z=Be.useRef(null);lN(()=>{const ee=U.current;if(L.width>0&&L.height>0&&ee){Z.current||(Z.current=FOe(ee));async function oe(){await Z.current.configure({gl:s,scene:T,events:a,shadows:l,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:g,performance:_,raycaster:v,camera:E,size:L,onPointerMissed:(...de)=>q.current==null?void 0:q.current(...de),onCreated:de=>{de.events.connect==null||de.events.connect(o?pOe(o)?o.current:o:$.current),c&&de.setEvents({compute:(Me,He)=>{const Te=Me[c+"X"],Le=Me[c+"Y"];He.pointer.set(Te/He.size.width*2-1,-(Le/He.size.height)*2+1),He.raycaster.setFromCamera(He.pointer,He.camera)}}),N==null||N(de)}}),Z.current.render(Ae.jsx(I,{children:Ae.jsx(yOe,{set:V,children:Ae.jsx(Be.Suspense,{fallback:Ae.jsx(vOe,{set:X}),children:e??null})})}))}oe()}}),Be.useEffect(()=>{const ee=U.current;if(ee)return()=>Doe(ee)},[]);const Y=o?"none":"auto";return Ae.jsx("div",{ref:$,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...i},...A,children:Ae.jsx("div",{ref:k,style:{width:"100%",height:"100%"},children:Ae.jsx("canvas",{ref:U,style:{display:"block"},children:n})})})}function ZOe(t){return Ae.jsx(Eoe,{children:Ae.jsx(JOe,{...t})})}var l$={exports:{}};function Hoe(t,e=100,n={}){if(typeof t!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:r}=typeof n=="boolean"?{immediate:n}:n;let i,s,a,o,c;function l(){const d=i,f=s;return i=void 0,s=void 0,c=t.apply(d,f),c}function u(){const d=Date.now()-o;d<e&&d>=0?a=setTimeout(u,e-d):(a=void 0,r||(c=l()))}const h=function(...d){if(i&&this!==i&&Object.getPrototypeOf(this)===Object.getPrototypeOf(i))throw new Error("Debounced method called with different contexts of the same prototype.");i=this,s=d,o=Date.now();const f=r&&!a;return a||(a=setTimeout(u,e)),f&&(c=l()),c};return Object.defineProperty(h,"isPending",{get(){return a!==void 0}}),h.clear=()=>{a&&(clearTimeout(a),a=void 0)},h.flush=()=>{a&&h.trigger()},h.trigger=()=>{c=l(),h.clear()},h}l$.exports.debounce=Hoe;l$.exports=Hoe;var QOe=l$.exports;const eNe=qc(QOe);var joe={exports:{}},O3={},Voe={exports:{}},Goe={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,Z){var Y=V.length;V.push(Z);e:for(;0<Y;){var ee=Y-1>>>1,oe=V[ee];if(0<i(oe,Z))V[ee]=Z,V[Y]=oe,Y=ee;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var Z=V[0],Y=V.pop();if(Y!==Z){V[0]=Y;e:for(var ee=0,oe=V.length,de=oe>>>1;ee<de;){var Me=2*(ee+1)-1,He=V[Me],Te=Me+1,Le=V[Te];if(0>i(He,Y))Te<oe&&0>i(Le,He)?(V[ee]=Le,V[Te]=Y,ee=Te):(V[ee]=He,V[Me]=Y,ee=Me);else if(Te<oe&&0>i(Le,Y))V[ee]=Le,V[Te]=Y,ee=Te;else break e}}return Z}function i(V,Z){var Y=V.sortIndex-Z.sortIndex;return Y!==0?Y:V.id-Z.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var c=[],l=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function x(V){for(var Z=n(l);Z!==null;){if(Z.callback===null)r(l);else if(Z.startTime<=V)r(l),Z.sortIndex=Z.expirationTime,e(c,Z);else break;Z=n(l)}}function N(V){if(g=!1,x(V),!p)if(n(c)!==null)p=!0,A||(A=!0,q());else{var Z=n(l);Z!==null&&re(N,Z.startTime-V)}}var A=!1,I=-1,k=5,L=-1;function U(){return _?!0:!(t.unstable_now()-L<k)}function $(){if(_=!1,A){var V=t.unstable_now();L=V;var Z=!0;try{e:{p=!1,g&&(g=!1,E(I),I=-1),f=!0;var Y=d;try{t:{for(x(V),h=n(c);h!==null&&!(h.expirationTime>V&&U());){var ee=h.callback;if(typeof ee=="function"){h.callback=null,d=h.priorityLevel;var oe=ee(h.expirationTime<=V);if(V=t.unstable_now(),typeof oe=="function"){h.callback=oe,x(V),Z=!0;break t}h===n(c)&&r(c),x(V)}else r(c);h=n(c)}if(h!==null)Z=!0;else{var de=n(l);de!==null&&re(N,de.startTime-V),Z=!1}}break e}finally{h=null,d=Y,f=!1}Z=void 0}}finally{Z?q():A=!1}}}var q;if(typeof T=="function")q=function(){T($)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,X=G.port2;G.port1.onmessage=$,q=function(){X.postMessage(null)}}else q=function(){v($,0)};function re(V,Z){I=v(function(){V(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_next=function(V){switch(d){case 1:case 2:case 3:var Z=3;break;default:Z=d}var Y=d;d=Z;try{return V()}finally{d=Y}},t.unstable_requestPaint=function(){_=!0},t.unstable_runWithPriority=function(V,Z){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Y=d;d=V;try{return Z()}finally{d=Y}},t.unstable_scheduleCallback=function(V,Z,Y){var ee=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ee+Y:ee):Y=ee,V){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Y+oe,V={id:u++,callback:Z,priorityLevel:V,startTime:Y,expirationTime:oe,sortIndex:-1},Y>ee?(V.sortIndex=Y,e(l,V),n(c)===null&&V===n(l)&&(g?(E(I),I=-1):g=!0,re(N,Y-ee))):(V.sortIndex=oe,e(c,V),p||f||(p=!0,A||(A=!0,q()))),V},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(V){var Z=d;return function(){var Y=d;d=Z;try{return V.apply(this,arguments)}finally{d=Y}}}})(Goe);Voe.exports=Goe;var tNe=Voe.exports,qoe={exports:{}},rh={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nNe=Be;function $oe(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l_(){}var Ku={d:{f:l_,r:function(){throw Error($oe(522))},D:l_,C:l_,L:l_,m:l_,X:l_,S:l_,M:l_},p:0,findDOMNode:null},rNe=Symbol.for("react.portal");function iNe(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rNe,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}var FA=nNe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function N3(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}rh.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ku;rh.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error($oe(299));return iNe(t,e,null,n)};rh.flushSync=function(t){var e=FA.T,n=Ku.p;try{if(FA.T=null,Ku.p=2,t)return t()}finally{FA.T=e,Ku.p=n,Ku.d.f()}};rh.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Ku.d.C(t,e))};rh.prefetchDNS=function(t){typeof t=="string"&&Ku.d.D(t)};rh.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,r=N3(n,e.crossOrigin),i=typeof e.integrity=="string"?e.integrity:void 0,s=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Ku.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:s}):n==="script"&&Ku.d.X(t,{crossOrigin:r,integrity:i,fetchPriority:s,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};rh.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=N3(e.as,e.crossOrigin);Ku.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Ku.d.M(t)};rh.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,r=N3(n,e.crossOrigin);Ku.d.L(t,n,{crossOrigin:r,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};rh.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=N3(e.as,e.crossOrigin);Ku.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Ku.d.m(t)};rh.requestFormReset=function(t){Ku.d.r(t)};rh.unstable_batchedUpdates=function(t,e){return t(e)};rh.useFormState=function(t,e,n){return FA.H.useFormState(t,e,n)};rh.useFormStatus=function(){return FA.H.useHostTransitionStatus()};rh.version="19.1.0";function Woe(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Woe)}catch(t){console.error(t)}}Woe(),qoe.exports=rh;var sNe=qoe.exports,Hc=tNe,Yoe=Be,aNe=sNe;function jt(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Xoe(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function uN(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Koe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function oJ(t){if(uN(t)!==t)throw Error(jt(188))}function oNe(t){var e=t.alternate;if(!e){if(e=uN(t),e===null)throw Error(jt(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return oJ(i),t;if(s===r)return oJ(i),e;s=s.sibling}throw Error(jt(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===n){a=!0,n=i,r=s;break}if(o===r){a=!0,r=i,n=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===n){a=!0,n=s,r=i;break}if(o===r){a=!0,r=s,n=i;break}o=o.sibling}if(!a)throw Error(jt(189))}}if(n.alternate!==r)throw Error(jt(190))}if(n.tag!==3)throw Error(jt(188));return n.stateNode.current===n?t:e}function Joe(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=Joe(t),e!==null)return e;t=t.sibling}return null}var Sa=Object.assign,cNe=Symbol.for("react.element"),Dk=Symbol.for("react.transitional.element"),mA=Symbol.for("react.portal"),P1=Symbol.for("react.fragment"),Zoe=Symbol.for("react.strict_mode"),e5=Symbol.for("react.profiler"),lNe=Symbol.for("react.provider"),Qoe=Symbol.for("react.consumer"),kv=Symbol.for("react.context"),u$=Symbol.for("react.forward_ref"),t5=Symbol.for("react.suspense"),n5=Symbol.for("react.suspense_list"),h$=Symbol.for("react.memo"),A_=Symbol.for("react.lazy"),r5=Symbol.for("react.activity"),uNe=Symbol.for("react.memo_cache_sentinel"),cJ=Symbol.iterator;function zR(t){return t===null||typeof t!="object"?null:(t=cJ&&t[cJ]||t["@@iterator"],typeof t=="function"?t:null)}var hNe=Symbol.for("react.client.reference");function i5(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===hNe?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case P1:return"Fragment";case e5:return"Profiler";case Zoe:return"StrictMode";case t5:return"Suspense";case n5:return"SuspenseList";case r5:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case mA:return"Portal";case kv:return(t.displayName||"Context")+".Provider";case Qoe:return(t._context.displayName||"Context")+".Consumer";case u$:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case h$:return e=t.displayName||null,e!==null?e:i5(t.type)||"Memo";case A_:e=t._payload,t=t._init;try{return i5(t(e))}catch{}}return null}var gA=Array.isArray,Ur=Yoe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,gs=aNe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,jS={pending:!1,data:null,method:null,action:null},s5=[],L1=-1;function Jg(t){return{current:t}}function fl(t){0>L1||(t.current=s5[L1],s5[L1]=null,L1--)}function Da(t,e){L1++,s5[L1]=t.current,t.current=e}var wg=Jg(null),PM=Jg(null),Q_=Jg(null),zL=Jg(null);function HL(t,e){switch(Da(Q_,e),Da(PM,t),Da(wg,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?fZ(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=fZ(e),t=gue(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}fl(wg),Da(wg,t)}function $w(){fl(wg),fl(PM),fl(Q_)}function a5(t){t.memoizedState!==null&&Da(zL,t);var e=wg.current,n=gue(e,t.type);e!==n&&(Da(PM,t),Da(wg,n))}function jL(t){PM.current===t&&(fl(wg),fl(PM)),zL.current===t&&(fl(zL),qM._currentValue=jS)}var o5=Object.prototype.hasOwnProperty,d$=Hc.unstable_scheduleCallback,u8=Hc.unstable_cancelCallback,dNe=Hc.unstable_shouldYield,fNe=Hc.unstable_requestPaint,Cg=Hc.unstable_now,pNe=Hc.unstable_getCurrentPriorityLevel,ece=Hc.unstable_ImmediatePriority,tce=Hc.unstable_UserBlockingPriority,VL=Hc.unstable_NormalPriority,mNe=Hc.unstable_LowPriority,nce=Hc.unstable_IdlePriority,gNe=Hc.log,vNe=Hc.unstable_setDisableYieldValue,hN=null,qd=null;function $_(t){if(typeof gNe=="function"&&vNe(t),qd&&typeof qd.setStrictMode=="function")try{qd.setStrictMode(hN,t)}catch{}}var $d=Math.clz32?Math.clz32:bNe,yNe=Math.log,_Ne=Math.LN2;function bNe(t){return t>>>=0,t===0?32:31-(yNe(t)/_Ne|0)|0}var Pk=256,Lk=4194304;function vS(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function I3(t,e,n){var r=t.pendingLanes;if(r===0)return 0;var i=0,s=t.suspendedLanes,a=t.pingedLanes;t=t.warmLanes;var o=r&134217727;return o!==0?(r=o&~s,r!==0?i=vS(r):(a&=o,a!==0?i=vS(a):n||(n=o&~t,n!==0&&(i=vS(n))))):(o=r&~s,o!==0?i=vS(o):a!==0?i=vS(a):n||(n=r&~t,n!==0&&(i=vS(n)))),i===0?0:e!==0&&e!==i&&!(e&s)&&(s=i&-i,n=e&-e,s>=n||s===32&&(n&4194048)!==0)?e:i}function dN(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function ENe(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rce(){var t=Pk;return Pk<<=1,!(Pk&4194048)&&(Pk=256),t}function ice(){var t=Lk;return Lk<<=1,!(Lk&62914560)&&(Lk=4194304),t}function h8(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function fN(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function SNe(t,e,n,r,i,s){var a=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var o=t.entanglements,c=t.expirationTimes,l=t.hiddenUpdates;for(n=a&~n;0<n;){var u=31-$d(n),h=1<<u;o[u]=0,c[u]=-1;var d=l[u];if(d!==null)for(l[u]=null,u=0;u<d.length;u++){var f=d[u];f!==null&&(f.lane&=-536870913)}n&=~h}r!==0&&sce(t,r,0),s!==0&&i===0&&t.tag!==0&&(t.suspendedLanes|=s&~(a&~e))}function sce(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var r=31-$d(e);t.entangledLanes|=e,t.entanglements[r]=t.entanglements[r]|1073741824|n&4194090}function ace(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-$d(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}function f$(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function p$(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function oce(){var t=gs.p;return t!==0?t:(t=window.event,t===void 0?32:Cue(t.type))}function TNe(t,e){var n=gs.p;try{return gs.p=t,e()}finally{gs.p=n}}var qb=Math.random().toString(36).slice(2),su="__reactFiber$"+qb,Kh="__reactProps$"+qb,jC="__reactContainer$"+qb,c5="__reactEvents$"+qb,xNe="__reactListeners$"+qb,wNe="__reactHandles$"+qb,lJ="__reactResources$"+qb,pN="__reactMarker$"+qb;function m$(t){delete t[su],delete t[Kh],delete t[c5],delete t[xNe],delete t[wNe]}function U1(t){var e=t[su];if(e)return e;for(var n=t.parentNode;n;){if(e=n[jC]||n[su]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=gZ(t);t!==null;){if(n=t[su])return n;t=gZ(t)}return e}t=n,n=t.parentNode}return null}function VC(t){if(t=t[su]||t[jC]){var e=t.tag;if(e===5||e===6||e===13||e===26||e===27||e===3)return t}return null}function vA(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(jt(33))}function ow(t){var e=t[lJ];return e||(e=t[lJ]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function ol(t){t[pN]=!0}var cce=new Set,lce={};function zT(t,e){Ww(t,e),Ww(t+"Capture",e)}function Ww(t,e){for(lce[t]=e,t=0;t<e.length;t++)cce.add(e[t])}var CNe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),uJ={},hJ={};function RNe(t){return o5.call(hJ,t)?!0:o5.call(uJ,t)?!1:CNe.test(t)?hJ[t]=!0:(uJ[t]=!0,!1)}function VD(t,e,n){if(RNe(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var r=e.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function Uk(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function uv(t,e,n,r){if(r===null)t.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+r)}}var d8,dJ;function E1(t){if(d8===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);d8=e&&e[1]||"",dJ=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+d8+t+dJ}var f8=!1;function p8(t,e){if(!t||f8)return"";f8=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(e){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(f){var d=f}Reflect.construct(t,[],h)}else{try{h.call()}catch(f){d=f}t.call(h.prototype)}}else{try{throw Error()}catch(f){d=f}(h=t())&&typeof h.catch=="function"&&h.catch(function(){})}}catch(f){if(f&&d&&typeof f.stack=="string")return[f.stack,d.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=r.DetermineComponentFrameRoot(),a=s[0],o=s[1];if(a&&o){var c=a.split(`
`),l=o.split(`
`);for(i=r=0;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;for(;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;if(r===c.length||i===l.length)for(r=c.length-1,i=l.length-1;1<=r&&0<=i&&c[r]!==l[i];)i--;for(;1<=r&&0<=i;r--,i--)if(c[r]!==l[i]){if(r!==1||i!==1)do if(r--,i--,0>i||c[r]!==l[i]){var u=`
`+c[r].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=r&&0<=i);break}}}finally{f8=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?E1(n):""}function ANe(t){switch(t.tag){case 26:case 27:case 5:return E1(t.type);case 16:return E1("Lazy");case 13:return E1("Suspense");case 19:return E1("SuspenseList");case 0:case 15:return p8(t.type,!1);case 11:return p8(t.type.render,!1);case 1:return p8(t.type,!0);case 31:return E1("Activity");default:return""}}function fJ(t){try{var e="";do e+=ANe(t),t=t.return;while(t);return e}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}function If(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uce(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function MNe(t){var e=uce(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function GL(t){t._valueTracker||(t._valueTracker=MNe(t))}function hce(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=uce(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function qL(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var ONe=/[\n"\\]/g;function Ff(t){return t.replace(ONe,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function l5(t,e,n,r,i,s,a,o){t.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?t.type=a:t.removeAttribute("type"),e!=null?a==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+If(e)):t.value!==""+If(e)&&(t.value=""+If(e)):a!=="submit"&&a!=="reset"||t.removeAttribute("value"),e!=null?u5(t,a,If(e)):n!=null?u5(t,a,If(n)):r!=null&&t.removeAttribute("value"),i==null&&s!=null&&(t.defaultChecked=!!s),i!=null&&(t.checked=i&&typeof i!="function"&&typeof i!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?t.name=""+If(o):t.removeAttribute("name")}function dce(t,e,n,r,i,s,a,o){if(s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(t.type=s),e!=null||n!=null){if(!(s!=="submit"&&s!=="reset"||e!=null))return;n=n!=null?""+If(n):"",e=e!=null?""+If(e):n,o||e===t.value||(t.value=e),t.defaultValue=e}r=r??i,r=typeof r!="function"&&typeof r!="symbol"&&!!r,t.checked=o?t.checked:!!r,t.defaultChecked=!!r,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(t.name=a)}function u5(t,e,n){e==="number"&&qL(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function cw(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+If(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function fce(t,e,n){if(e!=null&&(e=""+If(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+If(n):""}function pce(t,e,n,r){if(e==null){if(r!=null){if(n!=null)throw Error(jt(92));if(gA(r)){if(1<r.length)throw Error(jt(93));r=r[0]}n=r}n==null&&(n=""),e=n}n=If(e),t.defaultValue=n,r=t.textContent,r===n&&r!==""&&r!==null&&(t.value=r)}function Yw(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var NNe=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function pJ(t,e,n){var r=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?r?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":r?t.setProperty(e,n):typeof n!="number"||n===0||NNe.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function mce(t,e,n){if(e!=null&&typeof e!="object")throw Error(jt(62));if(t=t.style,n!=null){for(var r in n)!n.hasOwnProperty(r)||e!=null&&e.hasOwnProperty(r)||(r.indexOf("--")===0?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="");for(var i in e)r=e[i],e.hasOwnProperty(i)&&n[i]!==r&&pJ(t,i,r)}else for(var s in e)e.hasOwnProperty(s)&&pJ(t,s,e[s])}function g$(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var INe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kNe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function GD(t){return kNe.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}var h5=null;function v$(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var B1=null,lw=null;function mJ(t){var e=VC(t);if(e&&(t=e.stateNode)){var n=t[Kh]||null;e:switch(t=e.stateNode,e.type){case"input":if(l5(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Ff(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=r[Kh]||null;if(!i)throw Error(jt(90));l5(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(e=0;e<n.length;e++)r=n[e],r.form===t.form&&hce(r)}break e;case"textarea":fce(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&cw(t,!!n.multiple,e,!1)}}}var m8=!1;function gce(t,e,n){if(m8)return t(e,n);m8=!0;try{var r=t(e);return r}finally{if(m8=!1,(B1!==null||lw!==null)&&(j3(),B1&&(e=B1,t=lw,lw=B1=null,mJ(e),t)))for(e=0;e<t.length;e++)mJ(t[e])}}function LM(t,e){var n=t.stateNode;if(n===null)return null;var r=n[Kh]||null;if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(jt(231,e,typeof n));return n}var Qv=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d5=!1;if(Qv)try{var HR={};Object.defineProperty(HR,"passive",{get:function(){d5=!0}}),window.addEventListener("test",HR,HR),window.removeEventListener("test",HR,HR)}catch{d5=!1}var W_=null,y$=null,qD=null;function vce(){if(qD)return qD;var t,e=y$,n=e.length,r,i="value"in W_?W_.value:W_.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[s-r];r++);return qD=i.slice(t,1<r?1-r:void 0)}function $D(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Bk(){return!0}function gJ(){return!1}function sd(t){function e(n,r,i,s,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bk:gJ,this.isPropagationStopped=gJ,this}return Sa(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bk)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bk)},persist:function(){},isPersistent:Bk}),e}var HT={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},k3=sd(HT),mN=Sa({},HT,{view:0,detail:0}),DNe=sd(mN),g8,v8,jR,D3=Sa({},mN,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_$,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==jR&&(jR&&t.type==="mousemove"?(g8=t.screenX-jR.screenX,v8=t.screenY-jR.screenY):v8=g8=0,jR=t),g8)},movementY:function(t){return"movementY"in t?t.movementY:v8}}),vJ=sd(D3),PNe=Sa({},D3,{dataTransfer:0}),LNe=sd(PNe),UNe=Sa({},mN,{relatedTarget:0}),y8=sd(UNe),BNe=Sa({},HT,{animationName:0,elapsedTime:0,pseudoElement:0}),FNe=sd(BNe),zNe=Sa({},HT,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),HNe=sd(zNe),jNe=Sa({},HT,{data:0}),yJ=sd(jNe),VNe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},GNe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qNe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $Ne(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qNe[t])?!!e[t]:!1}function _$(){return $Ne}var WNe=Sa({},mN,{key:function(t){if(t.key){var e=VNe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=$D(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?GNe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_$,charCode:function(t){return t.type==="keypress"?$D(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?$D(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),YNe=sd(WNe),XNe=Sa({},D3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_J=sd(XNe),KNe=Sa({},mN,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_$}),JNe=sd(KNe),ZNe=Sa({},HT,{propertyName:0,elapsedTime:0,pseudoElement:0}),QNe=sd(ZNe),eIe=Sa({},D3,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),tIe=sd(eIe),nIe=Sa({},HT,{newState:0,oldState:0}),rIe=sd(nIe),iIe=[9,13,27,32],b$=Qv&&"CompositionEvent"in window,zA=null;Qv&&"documentMode"in document&&(zA=document.documentMode);var sIe=Qv&&"TextEvent"in window&&!zA,yce=Qv&&(!b$||zA&&8<zA&&11>=zA),bJ=" ",EJ=!1;function _ce(t,e){switch(t){case"keyup":return iIe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bce(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var F1=!1;function aIe(t,e){switch(t){case"compositionend":return bce(e);case"keypress":return e.which!==32?null:(EJ=!0,bJ);case"textInput":return t=e.data,t===bJ&&EJ?null:t;default:return null}}function oIe(t,e){if(F1)return t==="compositionend"||!b$&&_ce(t,e)?(t=vce(),qD=y$=W_=null,F1=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yce&&e.locale!=="ko"?null:e.data;default:return null}}var cIe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function SJ(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!cIe[t.type]:e==="textarea"}function Ece(t,e,n,r){B1?lw?lw.push(r):lw=[r]:B1=r,e=l2(e,"onChange"),0<e.length&&(n=new k3("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var HA=null,UM=null;function lIe(t){fue(t,0)}function P3(t){var e=vA(t);if(hce(e))return t}function TJ(t,e){if(t==="change")return e}var Sce=!1;if(Qv){var _8;if(Qv){var b8="oninput"in document;if(!b8){var xJ=document.createElement("div");xJ.setAttribute("oninput","return;"),b8=typeof xJ.oninput=="function"}_8=b8}else _8=!1;Sce=_8&&(!document.documentMode||9<document.documentMode)}function wJ(){HA&&(HA.detachEvent("onpropertychange",Tce),UM=HA=null)}function Tce(t){if(t.propertyName==="value"&&P3(UM)){var e=[];Ece(e,UM,t,v$(t)),gce(lIe,e)}}function uIe(t,e,n){t==="focusin"?(wJ(),HA=e,UM=n,HA.attachEvent("onpropertychange",Tce)):t==="focusout"&&wJ()}function hIe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return P3(UM)}function dIe(t,e){if(t==="click")return P3(e)}function fIe(t,e){if(t==="input"||t==="change")return P3(e)}function pIe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Jd=typeof Object.is=="function"?Object.is:pIe;function BM(t,e){if(Jd(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!o5.call(e,i)||!Jd(t[i],e[i]))return!1}return!0}function CJ(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function RJ(t,e){var n=CJ(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=CJ(n)}}function xce(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xce(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function wce(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=qL(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=qL(t.document)}return e}function E$(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var mIe=Qv&&"documentMode"in document&&11>=document.documentMode,z1=null,f5=null,jA=null,p5=!1;function AJ(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;p5||z1==null||z1!==qL(r)||(r=z1,"selectionStart"in r&&E$(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),jA&&BM(jA,r)||(jA=r,r=l2(f5,"onSelect"),0<r.length&&(e=new k3("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=z1)))}function iS(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var H1={animationend:iS("Animation","AnimationEnd"),animationiteration:iS("Animation","AnimationIteration"),animationstart:iS("Animation","AnimationStart"),transitionrun:iS("Transition","TransitionRun"),transitionstart:iS("Transition","TransitionStart"),transitioncancel:iS("Transition","TransitionCancel"),transitionend:iS("Transition","TransitionEnd")},E8={},Cce={};Qv&&(Cce=document.createElement("div").style,"AnimationEvent"in window||(delete H1.animationend.animation,delete H1.animationiteration.animation,delete H1.animationstart.animation),"TransitionEvent"in window||delete H1.transitionend.transition);function jT(t){if(E8[t])return E8[t];if(!H1[t])return t;var e=H1[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Cce)return E8[t]=e[n];return t}var Rce=jT("animationend"),Ace=jT("animationiteration"),Mce=jT("animationstart"),gIe=jT("transitionrun"),vIe=jT("transitionstart"),yIe=jT("transitioncancel"),Oce=jT("transitionend"),Nce=new Map,m5="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");m5.push("scrollEnd");function um(t,e){Nce.set(t,e),zT(e,[t])}var MJ=new WeakMap;function zf(t,e){if(typeof t=="object"&&t!==null){var n=MJ.get(t);return n!==void 0?n:(e={value:t,source:e,stack:fJ(e)},MJ.set(t,e),e)}return{value:t,source:e,stack:fJ(e)}}var Af=[],j1=0,S$=0;function L3(){for(var t=j1,e=S$=j1=0;e<t;){var n=Af[e];Af[e++]=null;var r=Af[e];Af[e++]=null;var i=Af[e];Af[e++]=null;var s=Af[e];if(Af[e++]=null,r!==null&&i!==null){var a=r.pending;a===null?i.next=i:(i.next=a.next,a.next=i),r.pending=i}s!==0&&Ice(n,i,s)}}function U3(t,e,n,r){Af[j1++]=t,Af[j1++]=e,Af[j1++]=n,Af[j1++]=r,S$|=r,t.lanes|=r,t=t.alternate,t!==null&&(t.lanes|=r)}function T$(t,e,n,r){return U3(t,e,n,r),$L(t)}function GC(t,e){return U3(t,null,null,e),$L(t)}function Ice(t,e,n){t.lanes|=n;var r=t.alternate;r!==null&&(r.lanes|=n);for(var i=!1,s=t.return;s!==null;)s.childLanes|=n,r=s.alternate,r!==null&&(r.childLanes|=n),s.tag===22&&(t=s.stateNode,t===null||t._visibility&1||(i=!0)),t=s,s=s.return;return t.tag===3?(s=t.stateNode,i&&e!==null&&(i=31-$d(n),t=s.hiddenUpdates,r=t[i],r===null?t[i]=[e]:r.push(e),e.lane=n|536870912),s):null}function $L(t){if(50<ZA)throw ZA=0,L5=null,Error(jt(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var V1={};function _Ie(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zd(t,e,n,r){return new _Ie(t,e,n,r)}function x$(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Vv(t,e){var n=t.alternate;return n===null?(n=zd(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function kce(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function WD(t,e,n,r,i,s){var a=0;if(r=t,typeof t=="function")x$(t)&&(a=1);else if(typeof t=="string")a=Eke(t,n,wg.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case r5:return t=zd(31,n,e,i),t.elementType=r5,t.lanes=s,t;case P1:return VS(n.children,i,s,e);case Zoe:a=8,i|=24;break;case e5:return t=zd(12,n,e,i|2),t.elementType=e5,t.lanes=s,t;case t5:return t=zd(13,n,e,i),t.elementType=t5,t.lanes=s,t;case n5:return t=zd(19,n,e,i),t.elementType=n5,t.lanes=s,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case lNe:case kv:a=10;break e;case Qoe:a=9;break e;case u$:a=11;break e;case h$:a=14;break e;case A_:a=16,r=null;break e}a=29,n=Error(jt(130,t===null?"null":typeof t,"")),r=null}return e=zd(a,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function VS(t,e,n,r){return t=zd(7,t,r,e),t.lanes=n,t}function S8(t,e,n){return t=zd(6,t,null,e),t.lanes=n,t}function T8(t,e,n){return e=zd(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var G1=[],q1=0,WL=null,YL=0,kf=[],Df=0,GS=null,Dv=1,Pv="";function yS(t,e){G1[q1++]=YL,G1[q1++]=WL,WL=t,YL=e}function Dce(t,e,n){kf[Df++]=Dv,kf[Df++]=Pv,kf[Df++]=GS,GS=t;var r=Dv;t=Pv;var i=32-$d(r)-1;r&=~(1<<i),n+=1;var s=32-$d(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Dv=1<<32-$d(e)+i|n<<i|r,Pv=s+t}else Dv=1<<s|n<<i|r,Pv=t}function w$(t){t.return!==null&&(yS(t,1),Dce(t,1,0))}function C$(t){for(;t===WL;)WL=G1[--q1],G1[q1]=null,YL=G1[--q1],G1[q1]=null;for(;t===GS;)GS=kf[--Df],kf[Df]=null,Pv=kf[--Df],kf[Df]=null,Dv=kf[--Df],kf[Df]=null}var Xu=null,go=null,ms=!1,qS=null,pg=!1,g5=Error(jt(519));function cT(t){var e=Error(jt(418,""));throw FM(zf(e,t)),g5}function OJ(t){var e=t.stateNode,n=t.type,r=t.memoizedProps;switch(e[su]=t,e[Kh]=r,n){case"dialog":wi("cancel",e),wi("close",e);break;case"iframe":case"object":case"embed":wi("load",e);break;case"video":case"audio":for(n=0;n<jM.length;n++)wi(jM[n],e);break;case"source":wi("error",e);break;case"img":case"image":case"link":wi("error",e),wi("load",e);break;case"details":wi("toggle",e);break;case"input":wi("invalid",e),dce(e,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),GL(e);break;case"select":wi("invalid",e);break;case"textarea":wi("invalid",e),pce(e,r.value,r.defaultValue,r.children),GL(e)}n=r.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||r.suppressHydrationWarning===!0||mue(e.textContent,n)?(r.popover!=null&&(wi("beforetoggle",e),wi("toggle",e)),r.onScroll!=null&&wi("scroll",e),r.onScrollEnd!=null&&wi("scrollend",e),r.onClick!=null&&(e.onclick=q3),e=!0):e=!1,e||cT(t)}function NJ(t){for(Xu=t.return;Xu;)switch(Xu.tag){case 5:case 13:pg=!1;return;case 27:case 3:pg=!0;return;default:Xu=Xu.return}}function VR(t){if(t!==Xu)return!1;if(!ms)return NJ(t),ms=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||j5(t.type,t.memoizedProps)),n=!n),n&&go&&cT(t),NJ(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(jt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8)if(n=t.data,n==="/$"){if(e===0){go=tm(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++;t=t.nextSibling}go=null}}else e===27?(e=go,$b(t.type)?(t=q5,q5=null,go=t):go=e):go=Xu?tm(t.stateNode.nextSibling):null;return!0}function gN(){go=Xu=null,ms=!1}function IJ(){var t=qS;return t!==null&&(Nh===null?Nh=t:Nh.push.apply(Nh,t),qS=null),t}function FM(t){qS===null?qS=[t]:qS.push(t)}var v5=Jg(null),VT=null,Lv=null;function z_(t,e,n){Da(v5,e._currentValue),e._currentValue=n}function Gv(t){t._currentValue=v5.current,fl(v5)}function y5(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function _5(t,e,n,r){var i=t.child;for(i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){var a=i.child;s=s.firstContext;e:for(;s!==null;){var o=s;s=i;for(var c=0;c<e.length;c++)if(o.context===e[c]){s.lanes|=n,o=s.alternate,o!==null&&(o.lanes|=n),y5(s.return,n,t),r||(a=null);break e}s=o.next}}else if(i.tag===18){if(a=i.return,a===null)throw Error(jt(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),y5(a,n,t),a=null}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}}function vN(t,e,n,r){t=null;for(var i=e,s=!1;i!==null;){if(!s){if(i.flags&524288)s=!0;else if(i.flags&262144)break}if(i.tag===10){var a=i.alternate;if(a===null)throw Error(jt(387));if(a=a.memoizedProps,a!==null){var o=i.type;Jd(i.pendingProps.value,a.value)||(t!==null?t.push(o):t=[o])}}else if(i===zL.current){if(a=i.alternate,a===null)throw Error(jt(387));a.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(t!==null?t.push(qM):t=[qM])}i=i.return}t!==null&&_5(e,t,n,r),e.flags|=262144}function XL(t){for(t=t.firstContext;t!==null;){if(!Jd(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function lT(t){VT=t,Lv=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function au(t){return Pce(VT,t)}function Fk(t,e){return VT===null&&lT(t),Pce(t,e)}function Pce(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},Lv===null){if(t===null)throw Error(jt(308));Lv=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else Lv=Lv.next=e;return n}var bIe=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,r){t.push(r)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},EIe=Hc.unstable_scheduleCallback,SIe=Hc.unstable_NormalPriority,Oc={$$typeof:kv,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function R$(){return{controller:new bIe,data:new Map,refCount:0}}function yN(t){t.refCount--,t.refCount===0&&EIe(SIe,function(){t.controller.abort()})}var VA=null,b5=0,Xw=0,uw=null;function TIe(t,e){if(VA===null){var n=VA=[];b5=0,Xw=K$(),uw={status:"pending",value:void 0,then:function(r){n.push(r)}}}return b5++,e.then(kJ,kJ),e}function kJ(){if(--b5===0&&VA!==null){uw!==null&&(uw.status="fulfilled");var t=VA;VA=null,Xw=0,uw=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function xIe(t,e){var n=[],r={status:"pending",value:null,reason:null,then:function(i){n.push(i)}};return t.then(function(){r.status="fulfilled",r.value=e;for(var i=0;i<n.length;i++)(0,n[i])(e)},function(i){for(r.status="rejected",r.reason=i,i=0;i<n.length;i++)(0,n[i])(void 0)}),r}var DJ=Ur.S;Ur.S=function(t,e){typeof e=="object"&&e!==null&&typeof e.then=="function"&&TIe(t,e),DJ!==null&&DJ(t,e)};var $S=Jg(null);function A$(){var t=$S.current;return t!==null?t:ia.pooledCache}function YD(t,e){e===null?Da($S,$S.current):Da($S,e.pool)}function Lce(){var t=A$();return t===null?null:{parent:Oc._currentValue,pool:t}}var _N=Error(jt(460)),Uce=Error(jt(474)),B3=Error(jt(542)),E5={then:function(){}};function PJ(t){return t=t.status,t==="fulfilled"||t==="rejected"}function zk(){}function Bce(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(zk,zk),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,UJ(t),t;default:if(typeof e.status=="string")e.then(zk,zk);else{if(t=ia,t!==null&&100<t.shellSuspendCounter)throw Error(jt(482));t=e,t.status="pending",t.then(function(r){if(e.status==="pending"){var i=e;i.status="fulfilled",i.value=r}},function(r){if(e.status==="pending"){var i=e;i.status="rejected",i.reason=r}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,UJ(t),t}throw GA=e,_N}}var GA=null;function LJ(){if(GA===null)throw Error(jt(459));var t=GA;return GA=null,t}function UJ(t){if(t===_N||t===B3)throw Error(jt(483))}var M_=!1;function M$(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function S5(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function eb(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function tb(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Rs&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,e=$L(t),Ice(t,null,n),e}return U3(t,r,e,n),$L(t)}function qA(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ace(t,n)}}function x8(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};s===null?i=s=a:s=s.next=a,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,callbacks:r.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var T5=!1;function $A(){if(T5){var t=uw;if(t!==null)throw t}}function WA(t,e,n,r){T5=!1;var i=t.updateQueue;M_=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var c=o,l=c.next;c.next=null,a===null?s=l:a.next=l,a=c;var u=t.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=l:o.next=l,u.lastBaseUpdate=c))}if(s!==null){var h=i.baseState;a=0,u=l=c=null,o=s;do{var d=o.lane&-536870913,f=d!==o.lane;if(f?(Vi&d)===d:(r&d)===d){d!==0&&d===Xw&&(T5=!0),u!==null&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var p=t,g=o;d=e;var _=n;switch(g.tag){case 1:if(p=g.payload,typeof p=="function"){h=p.call(_,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,d=typeof p=="function"?p.call(_,h,d):p,d==null)break e;h=Sa({},h,d);break e;case 2:M_=!0}}d=o.callback,d!==null&&(t.flags|=64,f&&(t.flags|=8192),f=i.callbacks,f===null?i.callbacks=[d]:f.push(d))}else f={lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(l=u=f,c=h):u=u.next=f,a|=d;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;f=o,o=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);u===null&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,s===null&&(i.shared.lanes=0),Tb|=a,t.lanes=a,t.memoizedState=h}}function Fce(t,e){if(typeof t!="function")throw Error(jt(191,t));t.call(e)}function zce(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)Fce(n[t],e)}var Kw=Jg(null),KL=Jg(0);function BJ(t,e){t=ny,Da(KL,t),Da(Kw,e),ny=t|e.baseLanes}function x5(){Da(KL,ny),Da(Kw,Kw.current)}function O$(){ny=KL.current,fl(Kw),fl(KL)}var Eb=0,vi=null,Bs=null,ac=null,JL=!1,hw=!1,uT=!1,ZL=0,zM=0,dw=null,wIe=0;function Io(){throw Error(jt(321))}function N$(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Jd(t[n],e[n]))return!1;return!0}function I$(t,e,n,r,i,s){return Eb=s,vi=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ur.H=t===null||t.memoizedState===null?vle:yle,uT=!1,s=n(r,i),uT=!1,hw&&(s=jce(e,n,r,i)),Hce(t),s}function Hce(t){Ur.H=QL;var e=Bs!==null&&Bs.next!==null;if(Eb=0,ac=Bs=vi=null,JL=!1,zM=0,dw=null,e)throw Error(jt(300));t===null||hl||(t=t.dependencies,t!==null&&XL(t)&&(hl=!0))}function jce(t,e,n,r){vi=t;var i=0;do{if(hw&&(dw=null),zM=0,hw=!1,25<=i)throw Error(jt(301));if(i+=1,ac=Bs=null,t.updateQueue!=null){var s=t.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,s.memoCache!=null&&(s.memoCache.index=0)}Ur.H=IIe,s=e(n,r)}while(hw);return s}function CIe(){var t=Ur.H,e=t.useState()[0];return e=typeof e.then=="function"?bN(e):e,t=t.useState()[0],(Bs!==null?Bs.memoizedState:null)!==t&&(vi.flags|=1024),e}function k$(){var t=ZL!==0;return ZL=0,t}function D$(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function P$(t){if(JL){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}JL=!1}Eb=0,ac=Bs=vi=null,hw=!1,zM=ZL=0,dw=null}function Ah(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ac===null?vi.memoizedState=ac=t:ac=ac.next=t,ac}function lc(){if(Bs===null){var t=vi.alternate;t=t!==null?t.memoizedState:null}else t=Bs.next;var e=ac===null?vi.memoizedState:ac.next;if(e!==null)ac=e,Bs=t;else{if(t===null)throw vi.alternate===null?Error(jt(467)):Error(jt(310));Bs=t,t={memoizedState:Bs.memoizedState,baseState:Bs.baseState,baseQueue:Bs.baseQueue,queue:Bs.queue,next:null},ac===null?vi.memoizedState=ac=t:ac=ac.next=t}return ac}function L$(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function bN(t){var e=zM;return zM+=1,dw===null&&(dw=[]),t=Bce(dw,t,e),e=vi,(ac===null?e.memoizedState:ac.next)===null&&(e=e.alternate,Ur.H=e===null||e.memoizedState===null?vle:yle),t}function F3(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return bN(t);if(t.$$typeof===kv)return au(t)}throw Error(jt(438,String(t)))}function U$(t){var e=null,n=vi.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var r=vi.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(e={data:r.data.map(function(i){return i.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=L$(),vi.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),r=0;r<t;r++)n[r]=uNe;return e.index++,n}function ey(t,e){return typeof e=="function"?e(t):e}function XD(t){var e=lc();return B$(e,Bs,t)}function B$(t,e,n){var r=t.queue;if(r===null)throw Error(jt(311));r.lastRenderedReducer=n;var i=t.baseQueue,s=r.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}e.baseQueue=i=s,r.pending=null}if(s=t.baseState,i===null)t.memoizedState=s;else{e=i.next;var o=a=null,c=null,l=e,u=!1;do{var h=l.lane&-536870913;if(h!==l.lane?(Vi&h)===h:(Eb&h)===h){var d=l.revertLane;if(d===0)c!==null&&(c=c.next={lane:0,revertLane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),h===Xw&&(u=!0);else if((Eb&d)===d){l=l.next,d===Xw&&(u=!0);continue}else h={lane:0,revertLane:l.revertLane,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null},c===null?(o=c=h,a=s):c=c.next=h,vi.lanes|=d,Tb|=d;h=l.action,uT&&n(s,h),s=l.hasEagerState?l.eagerState:n(s,h)}else d={lane:h,revertLane:l.revertLane,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null},c===null?(o=c=d,a=s):c=c.next=d,vi.lanes|=h,Tb|=h;l=l.next}while(l!==null&&l!==e);if(c===null?a=s:c.next=o,!Jd(s,t.memoizedState)&&(hl=!0,u&&(n=uw,n!==null)))throw n;t.memoizedState=s,t.baseState=a,t.baseQueue=c,r.lastRenderedState=s}return i===null&&(r.lanes=0),[t.memoizedState,r.dispatch]}function w8(t){var e=lc(),n=e.queue;if(n===null)throw Error(jt(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do s=t(s,a.action),a=a.next;while(a!==i);Jd(s,e.memoizedState)||(hl=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Vce(t,e,n){var r=vi,i=lc(),s=ms;if(s){if(n===void 0)throw Error(jt(407));n=n()}else n=e();var a=!Jd((Bs||i).memoizedState,n);a&&(i.memoizedState=n,hl=!0),i=i.queue;var o=$ce.bind(null,r,i,t);if(EN(2048,8,o,[t]),i.getSnapshot!==e||a||ac!==null&&ac.memoizedState.tag&1){if(r.flags|=2048,Jw(9,z3(),qce.bind(null,r,i,n,e),null),ia===null)throw Error(jt(349));s||Eb&124||Gce(r,e,n)}return n}function Gce(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=vi.updateQueue,e===null?(e=L$(),vi.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function qce(t,e,n,r){e.value=n,e.getSnapshot=r,Wce(e)&&Yce(t)}function $ce(t,e,n){return n(function(){Wce(e)&&Yce(t)})}function Wce(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Jd(t,n)}catch{return!0}}function Yce(t){var e=GC(t,2);e!==null&&Yd(e,t,2)}function w5(t){var e=Ah();if(typeof t=="function"){var n=t;if(t=n(),uT){$_(!0);try{n()}finally{$_(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ey,lastRenderedState:t},e}function Xce(t,e,n,r){return t.baseState=n,B$(t,Bs,typeof r=="function"?r:ey)}function RIe(t,e,n,r,i){if(H3(t))throw Error(jt(485));if(t=e.action,t!==null){var s={payload:i,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){s.listeners.push(a)}};Ur.T!==null?n(!0):s.isTransition=!1,r(s),n=e.pending,n===null?(s.next=e.pending=s,Kce(e,s)):(s.next=n.next,e.pending=n.next=s)}}function Kce(t,e){var n=e.action,r=e.payload,i=t.state;if(e.isTransition){var s=Ur.T,a={};Ur.T=a;try{var o=n(i,r),c=Ur.S;c!==null&&c(a,o),FJ(t,e,o)}catch(l){C5(t,e,l)}finally{Ur.T=s}}else try{s=n(i,r),FJ(t,e,s)}catch(l){C5(t,e,l)}}function FJ(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(r){zJ(t,e,r)},function(r){return C5(t,e,r)}):zJ(t,e,n)}function zJ(t,e,n){e.status="fulfilled",e.value=n,Jce(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,Kce(t,n)))}function C5(t,e,n){var r=t.pending;if(t.pending=null,r!==null){r=r.next;do e.status="rejected",e.reason=n,Jce(e),e=e.next;while(e!==r)}t.action=null}function Jce(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function Zce(t,e){return e}function HJ(t,e){if(ms){var n=ia.formState;if(n!==null){e:{var r=vi;if(ms){if(go){t:{for(var i=go,s=pg;i.nodeType!==8;){if(!s){i=null;break t}if(i=tm(i.nextSibling),i===null){i=null;break t}}s=i.data,i=s==="F!"||s==="F"?i:null}if(i){go=tm(i.nextSibling),r=i.data==="F!";break e}}cT(r)}r=!1}r&&(e=n[0])}}return n=Ah(),n.memoizedState=n.baseState=e,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zce,lastRenderedState:e},n.queue=r,n=ple.bind(null,vi,r),r.dispatch=n,r=w5(!1),s=j$.bind(null,vi,!1,r.queue),r=Ah(),i={state:e,dispatch:null,action:t,pending:null},r.queue=i,n=RIe.bind(null,vi,i,s,n),i.dispatch=n,r.memoizedState=t,[e,n,!1]}function jJ(t){var e=lc();return Qce(e,Bs,t)}function Qce(t,e,n){if(e=B$(t,e,Zce)[0],t=XD(ey)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var r=bN(e)}catch(a){throw a===_N?B3:a}else r=e;e=lc();var i=e.queue,s=i.dispatch;return n!==e.memoizedState&&(vi.flags|=2048,Jw(9,z3(),AIe.bind(null,i,n),null)),[r,s,t]}function AIe(t,e){t.action=e}function VJ(t){var e=lc(),n=Bs;if(n!==null)return Qce(e,n,t);lc(),e=e.memoizedState,n=lc();var r=n.queue.dispatch;return n.memoizedState=t,[e,r,!1]}function Jw(t,e,n,r){return t={tag:t,create:n,deps:r,inst:e,next:null},e=vi.updateQueue,e===null&&(e=L$(),vi.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function z3(){return{destroy:void 0,resource:void 0}}function ele(){return lc().memoizedState}function KD(t,e,n,r){var i=Ah();r=r===void 0?null:r,vi.flags|=t,i.memoizedState=Jw(1|e,z3(),n,r)}function EN(t,e,n,r){var i=lc();r=r===void 0?null:r;var s=i.memoizedState.inst;Bs!==null&&r!==null&&N$(r,Bs.memoizedState.deps)?i.memoizedState=Jw(e,s,n,r):(vi.flags|=t,i.memoizedState=Jw(1|e,s,n,r))}function GJ(t,e){KD(8390656,8,t,e)}function tle(t,e){EN(2048,8,t,e)}function nle(t,e){return EN(4,2,t,e)}function rle(t,e){return EN(4,4,t,e)}function ile(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function sle(t,e,n){n=n!=null?n.concat([t]):null,EN(4,4,ile.bind(null,e,t),n)}function F$(){}function ale(t,e){var n=lc();e=e===void 0?null:e;var r=n.memoizedState;return e!==null&&N$(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ole(t,e){var n=lc();e=e===void 0?null:e;var r=n.memoizedState;if(e!==null&&N$(e,r[1]))return r[0];if(r=t(),uT){$_(!0);try{t()}finally{$_(!1)}}return n.memoizedState=[r,e],r}function z$(t,e,n){return n===void 0||Eb&1073741824?t.memoizedState=e:(t.memoizedState=n,t=Jle(),vi.lanes|=t,Tb|=t,n)}function cle(t,e,n,r){return Jd(n,e)?n:Kw.current!==null?(t=z$(t,n,r),Jd(t,e)||(hl=!0),t):Eb&42?(t=Jle(),vi.lanes|=t,Tb|=t,e):(hl=!0,t.memoizedState=n)}function lle(t,e,n,r,i){var s=gs.p;gs.p=s!==0&&8>s?s:8;var a=Ur.T,o={};Ur.T=o,j$(t,!1,e,n);try{var c=i(),l=Ur.S;if(l!==null&&l(o,c),c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=xIe(c,r);YA(t,e,u,Wd(t))}else YA(t,e,r,Wd(t))}catch(h){YA(t,e,{then:function(){},status:"rejected",reason:h},Wd())}finally{gs.p=s,Ur.T=a}}function MIe(){}function R5(t,e,n,r){if(t.tag!==5)throw Error(jt(476));var i=ule(t).queue;lle(t,i,e,jS,n===null?MIe:function(){return hle(t),n(r)})}function ule(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:jS,baseState:jS,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ey,lastRenderedState:jS},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ey,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function hle(t){var e=ule(t).next.queue;YA(t,e,{},Wd())}function H$(){return au(qM)}function dle(){return lc().memoizedState}function fle(){return lc().memoizedState}function OIe(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=Wd();t=eb(n);var r=tb(e,t,n);r!==null&&(Yd(r,e,n),qA(r,e,n)),e={cache:R$()},t.payload=e;return}e=e.return}}function NIe(t,e,n){var r=Wd();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},H3(t)?mle(e,n):(n=T$(t,e,n,r),n!==null&&(Yd(n,t,r),gle(n,e,r)))}function ple(t,e,n){var r=Wd();YA(t,e,n,r)}function YA(t,e,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(H3(t))mle(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,Jd(o,a))return U3(t,e,i,0),ia===null&&L3(),!1}catch{}finally{}if(n=T$(t,e,i,r),n!==null)return Yd(n,t,r),gle(n,e,r),!0}return!1}function j$(t,e,n,r){if(r={lane:2,revertLane:K$(),action:r,hasEagerState:!1,eagerState:null,next:null},H3(t)){if(e)throw Error(jt(479))}else e=T$(t,n,r,2),e!==null&&Yd(e,t,2)}function H3(t){var e=t.alternate;return t===vi||e!==null&&e===vi}function mle(t,e){hw=JL=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function gle(t,e,n){if(n&4194048){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ace(t,n)}}var QL={readContext:au,use:F3,useCallback:Io,useContext:Io,useEffect:Io,useImperativeHandle:Io,useLayoutEffect:Io,useInsertionEffect:Io,useMemo:Io,useReducer:Io,useRef:Io,useState:Io,useDebugValue:Io,useDeferredValue:Io,useTransition:Io,useSyncExternalStore:Io,useId:Io,useHostTransitionStatus:Io,useFormState:Io,useActionState:Io,useOptimistic:Io,useMemoCache:Io,useCacheRefresh:Io},vle={readContext:au,use:F3,useCallback:function(t,e){return Ah().memoizedState=[t,e===void 0?null:e],t},useContext:au,useEffect:GJ,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,KD(4194308,4,ile.bind(null,e,t),n)},useLayoutEffect:function(t,e){return KD(4194308,4,t,e)},useInsertionEffect:function(t,e){KD(4,2,t,e)},useMemo:function(t,e){var n=Ah();e=e===void 0?null:e;var r=t();if(uT){$_(!0);try{t()}finally{$_(!1)}}return n.memoizedState=[r,e],r},useReducer:function(t,e,n){var r=Ah();if(n!==void 0){var i=n(e);if(uT){$_(!0);try{n(e)}finally{$_(!1)}}}else i=e;return r.memoizedState=r.baseState=i,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},r.queue=t,t=t.dispatch=NIe.bind(null,vi,t),[r.memoizedState,t]},useRef:function(t){var e=Ah();return t={current:t},e.memoizedState=t},useState:function(t){t=w5(t);var e=t.queue,n=ple.bind(null,vi,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:F$,useDeferredValue:function(t,e){var n=Ah();return z$(n,t,e)},useTransition:function(){var t=w5(!1);return t=lle.bind(null,vi,t.queue,!0,!1),Ah().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var r=vi,i=Ah();if(ms){if(n===void 0)throw Error(jt(407));n=n()}else{if(n=e(),ia===null)throw Error(jt(349));Vi&124||Gce(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,GJ($ce.bind(null,r,s,t),[t]),r.flags|=2048,Jw(9,z3(),qce.bind(null,r,s,n,e),null),n},useId:function(){var t=Ah(),e=ia.identifierPrefix;if(ms){var n=Pv,r=Dv;n=(r&~(1<<32-$d(r)-1)).toString(32)+n,e="«"+e+"R"+n,n=ZL++,0<n&&(e+="H"+n.toString(32)),e+="»"}else n=wIe++,e="«"+e+"r"+n.toString(32)+"»";return t.memoizedState=e},useHostTransitionStatus:H$,useFormState:HJ,useActionState:HJ,useOptimistic:function(t){var e=Ah();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=j$.bind(null,vi,!0,n),n.dispatch=e,[t,e]},useMemoCache:U$,useCacheRefresh:function(){return Ah().memoizedState=OIe.bind(null,vi)}},yle={readContext:au,use:F3,useCallback:ale,useContext:au,useEffect:tle,useImperativeHandle:sle,useInsertionEffect:nle,useLayoutEffect:rle,useMemo:ole,useReducer:XD,useRef:ele,useState:function(){return XD(ey)},useDebugValue:F$,useDeferredValue:function(t,e){var n=lc();return cle(n,Bs.memoizedState,t,e)},useTransition:function(){var t=XD(ey)[0],e=lc().memoizedState;return[typeof t=="boolean"?t:bN(t),e]},useSyncExternalStore:Vce,useId:dle,useHostTransitionStatus:H$,useFormState:jJ,useActionState:jJ,useOptimistic:function(t,e){var n=lc();return Xce(n,Bs,t,e)},useMemoCache:U$,useCacheRefresh:fle},IIe={readContext:au,use:F3,useCallback:ale,useContext:au,useEffect:tle,useImperativeHandle:sle,useInsertionEffect:nle,useLayoutEffect:rle,useMemo:ole,useReducer:w8,useRef:ele,useState:function(){return w8(ey)},useDebugValue:F$,useDeferredValue:function(t,e){var n=lc();return Bs===null?z$(n,t,e):cle(n,Bs.memoizedState,t,e)},useTransition:function(){var t=w8(ey)[0],e=lc().memoizedState;return[typeof t=="boolean"?t:bN(t),e]},useSyncExternalStore:Vce,useId:dle,useHostTransitionStatus:H$,useFormState:VJ,useActionState:VJ,useOptimistic:function(t,e){var n=lc();return Bs!==null?Xce(n,Bs,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:U$,useCacheRefresh:fle},fw=null,HM=0;function Hk(t){var e=HM;return HM+=1,fw===null&&(fw=[]),Bce(fw,t,e)}function GR(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function jk(t,e){throw e.$$typeof===cNe?Error(jt(525)):(t=Object.prototype.toString.call(e),Error(jt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function qJ(t){var e=t._init;return e(t._payload)}function _le(t){function e(v,E){if(t){var T=v.deletions;T===null?(v.deletions=[E],v.flags|=16):T.push(E)}}function n(v,E){if(!t)return null;for(;E!==null;)e(v,E),E=E.sibling;return null}function r(v){for(var E=new Map;v!==null;)v.key!==null?E.set(v.key,v):E.set(v.index,v),v=v.sibling;return E}function i(v,E){return v=Vv(v,E),v.index=0,v.sibling=null,v}function s(v,E,T){return v.index=T,t?(T=v.alternate,T!==null?(T=T.index,T<E?(v.flags|=67108866,E):T):(v.flags|=67108866,E)):(v.flags|=1048576,E)}function a(v){return t&&v.alternate===null&&(v.flags|=67108866),v}function o(v,E,T,x){return E===null||E.tag!==6?(E=S8(T,v.mode,x),E.return=v,E):(E=i(E,T),E.return=v,E)}function c(v,E,T,x){var N=T.type;return N===P1?u(v,E,T.props.children,x,T.key):E!==null&&(E.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===A_&&qJ(N)===E.type)?(E=i(E,T.props),GR(E,T),E.return=v,E):(E=WD(T.type,T.key,T.props,null,v.mode,x),GR(E,T),E.return=v,E)}function l(v,E,T,x){return E===null||E.tag!==4||E.stateNode.containerInfo!==T.containerInfo||E.stateNode.implementation!==T.implementation?(E=T8(T,v.mode,x),E.return=v,E):(E=i(E,T.children||[]),E.return=v,E)}function u(v,E,T,x,N){return E===null||E.tag!==7?(E=VS(T,v.mode,x,N),E.return=v,E):(E=i(E,T),E.return=v,E)}function h(v,E,T){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return E=S8(""+E,v.mode,T),E.return=v,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Dk:return T=WD(E.type,E.key,E.props,null,v.mode,T),GR(T,E),T.return=v,T;case mA:return E=T8(E,v.mode,T),E.return=v,E;case A_:var x=E._init;return E=x(E._payload),h(v,E,T)}if(gA(E)||zR(E))return E=VS(E,v.mode,T,null),E.return=v,E;if(typeof E.then=="function")return h(v,Hk(E),T);if(E.$$typeof===kv)return h(v,Fk(v,E),T);jk(v,E)}return null}function d(v,E,T,x){var N=E!==null?E.key:null;if(typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint")return N!==null?null:o(v,E,""+T,x);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Dk:return T.key===N?c(v,E,T,x):null;case mA:return T.key===N?l(v,E,T,x):null;case A_:return N=T._init,T=N(T._payload),d(v,E,T,x)}if(gA(T)||zR(T))return N!==null?null:u(v,E,T,x,null);if(typeof T.then=="function")return d(v,E,Hk(T),x);if(T.$$typeof===kv)return d(v,E,Fk(v,T),x);jk(v,T)}return null}function f(v,E,T,x,N){if(typeof x=="string"&&x!==""||typeof x=="number"||typeof x=="bigint")return v=v.get(T)||null,o(E,v,""+x,N);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Dk:return v=v.get(x.key===null?T:x.key)||null,c(E,v,x,N);case mA:return v=v.get(x.key===null?T:x.key)||null,l(E,v,x,N);case A_:var A=x._init;return x=A(x._payload),f(v,E,T,x,N)}if(gA(x)||zR(x))return v=v.get(T)||null,u(E,v,x,N,null);if(typeof x.then=="function")return f(v,E,T,Hk(x),N);if(x.$$typeof===kv)return f(v,E,T,Fk(E,x),N);jk(E,x)}return null}function p(v,E,T,x){for(var N=null,A=null,I=E,k=E=0,L=null;I!==null&&k<T.length;k++){I.index>k?(L=I,I=null):L=I.sibling;var U=d(v,I,T[k],x);if(U===null){I===null&&(I=L);break}t&&I&&U.alternate===null&&e(v,I),E=s(U,E,k),A===null?N=U:A.sibling=U,A=U,I=L}if(k===T.length)return n(v,I),ms&&yS(v,k),N;if(I===null){for(;k<T.length;k++)I=h(v,T[k],x),I!==null&&(E=s(I,E,k),A===null?N=I:A.sibling=I,A=I);return ms&&yS(v,k),N}for(I=r(I);k<T.length;k++)L=f(I,v,k,T[k],x),L!==null&&(t&&L.alternate!==null&&I.delete(L.key===null?k:L.key),E=s(L,E,k),A===null?N=L:A.sibling=L,A=L);return t&&I.forEach(function($){return e(v,$)}),ms&&yS(v,k),N}function g(v,E,T,x){if(T==null)throw Error(jt(151));for(var N=null,A=null,I=E,k=E=0,L=null,U=T.next();I!==null&&!U.done;k++,U=T.next()){I.index>k?(L=I,I=null):L=I.sibling;var $=d(v,I,U.value,x);if($===null){I===null&&(I=L);break}t&&I&&$.alternate===null&&e(v,I),E=s($,E,k),A===null?N=$:A.sibling=$,A=$,I=L}if(U.done)return n(v,I),ms&&yS(v,k),N;if(I===null){for(;!U.done;k++,U=T.next())U=h(v,U.value,x),U!==null&&(E=s(U,E,k),A===null?N=U:A.sibling=U,A=U);return ms&&yS(v,k),N}for(I=r(I);!U.done;k++,U=T.next())U=f(I,v,k,U.value,x),U!==null&&(t&&U.alternate!==null&&I.delete(U.key===null?k:U.key),E=s(U,E,k),A===null?N=U:A.sibling=U,A=U);return t&&I.forEach(function(q){return e(v,q)}),ms&&yS(v,k),N}function _(v,E,T,x){if(typeof T=="object"&&T!==null&&T.type===P1&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Dk:e:{for(var N=T.key;E!==null;){if(E.key===N){if(N=T.type,N===P1){if(E.tag===7){n(v,E.sibling),x=i(E,T.props.children),x.return=v,v=x;break e}}else if(E.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===A_&&qJ(N)===E.type){n(v,E.sibling),x=i(E,T.props),GR(x,T),x.return=v,v=x;break e}n(v,E);break}else e(v,E);E=E.sibling}T.type===P1?(x=VS(T.props.children,v.mode,x,T.key),x.return=v,v=x):(x=WD(T.type,T.key,T.props,null,v.mode,x),GR(x,T),x.return=v,v=x)}return a(v);case mA:e:{for(N=T.key;E!==null;){if(E.key===N)if(E.tag===4&&E.stateNode.containerInfo===T.containerInfo&&E.stateNode.implementation===T.implementation){n(v,E.sibling),x=i(E,T.children||[]),x.return=v,v=x;break e}else{n(v,E);break}else e(v,E);E=E.sibling}x=T8(T,v.mode,x),x.return=v,v=x}return a(v);case A_:return N=T._init,T=N(T._payload),_(v,E,T,x)}if(gA(T))return p(v,E,T,x);if(zR(T)){if(N=zR(T),typeof N!="function")throw Error(jt(150));return T=N.call(T),g(v,E,T,x)}if(typeof T.then=="function")return _(v,E,Hk(T),x);if(T.$$typeof===kv)return _(v,E,Fk(v,T),x);jk(v,T)}return typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint"?(T=""+T,E!==null&&E.tag===6?(n(v,E.sibling),x=i(E,T),x.return=v,v=x):(n(v,E),x=S8(T,v.mode,x),x.return=v,v=x),a(v)):n(v,E)}return function(v,E,T,x){try{HM=0;var N=_(v,E,T,x);return fw=null,N}catch(I){if(I===_N||I===B3)throw I;var A=zd(29,I,null,v.mode);return A.lanes=x,A.return=v,A}finally{}}}var Zw=_le(!0),ble=_le(!1),rp=Jg(null),Rg=null;function H_(t){var e=t.alternate;Da(kc,kc.current&1),Da(rp,t),Rg===null&&(e===null||Kw.current!==null||e.memoizedState!==null)&&(Rg=t)}function Ele(t){if(t.tag===22){if(Da(kc,kc.current),Da(rp,t),Rg===null){var e=t.alternate;e!==null&&e.memoizedState!==null&&(Rg=t)}}else j_()}function j_(){Da(kc,kc.current),Da(rp,rp.current)}function Uv(t){fl(rp),Rg===t&&(Rg=null),fl(kc)}var kc=Jg(0);function e2(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||G5(n)))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}function C8(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Sa({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var A5={enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Wd(),i=eb(r);i.payload=e,n!=null&&(i.callback=n),e=tb(t,i,r),e!==null&&(Yd(e,t,r),qA(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Wd(),i=eb(r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=tb(t,i,r),e!==null&&(Yd(e,t,r),qA(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Wd(),r=eb(n);r.tag=2,e!=null&&(r.callback=e),e=tb(t,r,n),e!==null&&(Yd(e,t,n),qA(e,t,n))}};function $J(t,e,n,r,i,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!BM(n,r)||!BM(i,s):!0}function WJ(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&A5.enqueueReplaceState(e,e.state,null)}function hT(t,e){var n=e;if("ref"in e){n={};for(var r in e)r!=="ref"&&(n[r]=e[r])}if(t=t.defaultProps){n===e&&(n=Sa({},n));for(var i in t)n[i]===void 0&&(n[i]=t[i])}return n}var t2=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof zn=="object"&&typeof zn.emit=="function"){zn.emit("uncaughtException",t);return}console.error(t)};function Sle(t){t2(t)}function Tle(t){console.error(t)}function xle(t){t2(t)}function n2(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(r){setTimeout(function(){throw r})}}function YJ(t,e,n){try{var r=t.onCaughtError;r(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function M5(t,e,n){return n=eb(n),n.tag=3,n.payload={element:null},n.callback=function(){n2(t,e)},n}function wle(t){return t=eb(t),t.tag=3,t}function Cle(t,e,n,r){var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var s=r.value;t.payload=function(){return i(s)},t.callback=function(){YJ(e,n,r)}}var a=n.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){YJ(e,n,r),typeof i!="function"&&(nb===null?nb=new Set([this]):nb.add(this));var o=r.stack;this.componentDidCatch(r.value,{componentStack:o!==null?o:""})})}function kIe(t,e,n,r,i){if(n.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(e=n.alternate,e!==null&&vN(e,n,i,!0),n=rp.current,n!==null){switch(n.tag){case 13:return Rg===null?U5():n.alternate===null&&vo===0&&(vo=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===E5?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([r]):e.add(r),U8(t,r,i)),!1;case 22:return n.flags|=65536,r===E5?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([r]):n.add(r)),U8(t,r,i)),!1}throw Error(jt(435,n.tag))}return U8(t,r,i),U5(),!1}if(ms)return e=rp.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=i,r!==g5&&(t=Error(jt(422),{cause:r}),FM(zf(t,n)))):(r!==g5&&(e=Error(jt(423),{cause:r}),FM(zf(e,n))),t=t.current.alternate,t.flags|=65536,i&=-i,t.lanes|=i,r=zf(r,n),i=M5(t.stateNode,r,i),x8(t,i),vo!==4&&(vo=2)),!1;var s=Error(jt(520),{cause:r});if(s=zf(s,n),JA===null?JA=[s]:JA.push(s),vo!==4&&(vo=2),e===null)return!0;r=zf(r,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=i&-i,n.lanes|=t,t=M5(n.stateNode,r,t),x8(n,t),!1;case 1:if(e=n.type,s=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||s!==null&&typeof s.componentDidCatch=="function"&&(nb===null||!nb.has(s))))return n.flags|=65536,i&=-i,n.lanes|=i,i=wle(i),Cle(i,t,n,r),x8(n,i),!1}n=n.return}while(n!==null);return!1}var Rle=Error(jt(461)),hl=!1;function Ol(t,e,n,r){e.child=t===null?ble(e,null,n,r):Zw(e,t.child,n,r)}function XJ(t,e,n,r,i){n=n.render;var s=e.ref;if("ref"in r){var a={};for(var o in r)o!=="ref"&&(a[o]=r[o])}else a=r;return lT(e),r=I$(t,e,n,a,s,i),o=k$(),t!==null&&!hl?(D$(t,e,i),ty(t,e,i)):(ms&&o&&w$(e),e.flags|=1,Ol(t,e,r,i),e.child)}function KJ(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!x$(s)&&s.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=s,Ale(t,e,s,r,i)):(t=WD(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!V$(t,i)){var a=s.memoizedProps;if(n=n.compare,n=n!==null?n:BM,n(a,r)&&t.ref===e.ref)return ty(t,e,i)}return e.flags|=1,t=Vv(s,r),t.ref=e.ref,t.return=e,e.child=t}function Ale(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(BM(s,r)&&t.ref===e.ref)if(hl=!1,e.pendingProps=r=s,V$(t,i))t.flags&131072&&(hl=!0);else return e.lanes=t.lanes,ty(t,e,i)}return O5(t,e,n,r,i)}function Mle(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden"){if(e.flags&128){if(r=s!==null?s.baseLanes|n:n,t!==null){for(i=e.child=t.child,s=0;i!==null;)s=s|i.lanes|i.childLanes,i=i.sibling;e.childLanes=s&~r}else e.childLanes=0,e.child=null;return JJ(t,e,r,n)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&YD(e,s!==null?s.cachePool:null),s!==null?BJ(e,s):x5(),Ele(e);else return e.lanes=e.childLanes=536870912,JJ(t,e,s!==null?s.baseLanes|n:n,n)}else s!==null?(YD(e,s.cachePool),BJ(e,s),j_(),e.memoizedState=null):(t!==null&&YD(e,null),x5(),j_());return Ol(t,e,i,n),e.child}function JJ(t,e,n,r){var i=A$();return i=i===null?null:{parent:Oc._currentValue,pool:i},e.memoizedState={baseLanes:n,cachePool:i},t!==null&&YD(e,null),x5(),Ele(e),t!==null&&vN(t,e,r,!0),null}function JD(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(jt(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function O5(t,e,n,r,i){return lT(e),n=I$(t,e,n,r,void 0,i),r=k$(),t!==null&&!hl?(D$(t,e,i),ty(t,e,i)):(ms&&r&&w$(e),e.flags|=1,Ol(t,e,n,i),e.child)}function ZJ(t,e,n,r,i,s){return lT(e),e.updateQueue=null,n=jce(e,r,n,i),Hce(t),r=k$(),t!==null&&!hl?(D$(t,e,s),ty(t,e,s)):(ms&&r&&w$(e),e.flags|=1,Ol(t,e,n,s),e.child)}function QJ(t,e,n,r,i){if(lT(e),e.stateNode===null){var s=V1,a=n.contextType;typeof a=="object"&&a!==null&&(s=au(a)),s=new n(r,s),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=A5,e.stateNode=s,s._reactInternals=e,s=e.stateNode,s.props=r,s.state=e.memoizedState,s.refs={},M$(e),a=n.contextType,s.context=typeof a=="object"&&a!==null?au(a):V1,s.state=e.memoizedState,a=n.getDerivedStateFromProps,typeof a=="function"&&(C8(e,n,a,r),s.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(a=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),a!==s.state&&A5.enqueueReplaceState(s,s.state,null),WA(e,r,s,i),$A(),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!0}else if(t===null){s=e.stateNode;var o=e.memoizedProps,c=hT(n,o);s.props=c;var l=s.context,u=n.contextType;a=V1,typeof u=="object"&&u!==null&&(a=au(u));var h=n.getDerivedStateFromProps;u=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o||l!==a)&&WJ(e,s,r,a),M_=!1;var d=e.memoizedState;s.state=d,WA(e,r,s,i),$A(),l=e.memoizedState,o||d!==l||M_?(typeof h=="function"&&(C8(e,n,h,r),l=e.memoizedState),(c=M_||$J(e,n,c,r,d,l,a))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=a,r=c):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,S5(t,e),a=e.memoizedProps,u=hT(n,a),s.props=u,h=e.pendingProps,d=s.context,l=n.contextType,c=V1,typeof l=="object"&&l!==null&&(c=au(l)),o=n.getDerivedStateFromProps,(l=typeof o=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||d!==c)&&WJ(e,s,r,c),M_=!1,d=e.memoizedState,s.state=d,WA(e,r,s,i),$A();var f=e.memoizedState;a!==h||d!==f||M_||t!==null&&t.dependencies!==null&&XL(t.dependencies)?(typeof o=="function"&&(C8(e,n,o,r),f=e.memoizedState),(u=M_||$J(e,n,u,r,d,f,c)||t!==null&&t.dependencies!==null&&XL(t.dependencies))?(l||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,f,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,f,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=f),s.props=r,s.state=f,s.context=c,r=u):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return s=r,JD(t,e),r=(e.flags&128)!==0,s||r?(s=e.stateNode,n=r&&typeof n.getDerivedStateFromError!="function"?null:s.render(),e.flags|=1,t!==null&&r?(e.child=Zw(e,t.child,null,i),e.child=Zw(e,null,n,i)):Ol(t,e,n,i),e.memoizedState=s.state,t=e.child):t=ty(t,e,i),t}function eZ(t,e,n,r){return gN(),e.flags|=256,Ol(t,e,n,r),e.child}var R8={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function A8(t){return{baseLanes:t,cachePool:Lce()}}function M8(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=Wf),t}function Ole(t,e,n){var r=e.pendingProps,i=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(kc.current&2)!==0),a&&(i=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,t===null){if(ms){if(i?H_(e):j_(),ms){var o=go,c;if(c=o){e:{for(c=o,o=pg;c.nodeType!==8;){if(!o){o=null;break e}if(c=tm(c.nextSibling),c===null){o=null;break e}}o=c}o!==null?(e.memoizedState={dehydrated:o,treeContext:GS!==null?{id:Dv,overflow:Pv}:null,retryLane:536870912,hydrationErrors:null},c=zd(18,null,null,0),c.stateNode=o,c.return=e,e.child=c,Xu=e,go=null,c=!0):c=!1}c||cT(e)}if(o=e.memoizedState,o!==null&&(o=o.dehydrated,o!==null))return G5(o)?e.lanes=32:e.lanes=536870912,null;Uv(e)}return o=r.children,r=r.fallback,i?(j_(),i=e.mode,o=r2({mode:"hidden",children:o},i),r=VS(r,i,n,null),o.return=e,r.return=e,o.sibling=r,e.child=o,i=e.child,i.memoizedState=A8(n),i.childLanes=M8(t,a,n),e.memoizedState=R8,r):(H_(e),N5(e,o))}if(c=t.memoizedState,c!==null&&(o=c.dehydrated,o!==null)){if(s)e.flags&256?(H_(e),e.flags&=-257,e=O8(t,e,n)):e.memoizedState!==null?(j_(),e.child=t.child,e.flags|=128,e=null):(j_(),i=r.fallback,o=e.mode,r=r2({mode:"visible",children:r.children},o),i=VS(i,o,n,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,Zw(e,t.child,null,n),r=e.child,r.memoizedState=A8(n),r.childLanes=M8(t,a,n),e.memoizedState=R8,e=i);else if(H_(e),G5(o)){if(a=o.nextSibling&&o.nextSibling.dataset,a)var l=a.dgst;a=l,r=Error(jt(419)),r.stack="",r.digest=a,FM({value:r,source:null,stack:null}),e=O8(t,e,n)}else if(hl||vN(t,e,n,!1),a=(n&t.childLanes)!==0,hl||a){if(a=ia,a!==null&&(r=n&-n,r=r&42?1:f$(r),r=r&(a.suspendedLanes|n)?0:r,r!==0&&r!==c.retryLane))throw c.retryLane=r,GC(t,r),Yd(a,t,r),Rle;o.data==="$?"||U5(),e=O8(t,e,n)}else o.data==="$?"?(e.flags|=192,e.child=t.child,e=null):(t=c.treeContext,go=tm(o.nextSibling),Xu=e,ms=!0,qS=null,pg=!1,t!==null&&(kf[Df++]=Dv,kf[Df++]=Pv,kf[Df++]=GS,Dv=t.id,Pv=t.overflow,GS=e),e=N5(e,r.children),e.flags|=4096);return e}return i?(j_(),i=r.fallback,o=e.mode,c=t.child,l=c.sibling,r=Vv(c,{mode:"hidden",children:r.children}),r.subtreeFlags=c.subtreeFlags&65011712,l!==null?i=Vv(l,i):(i=VS(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o===null?o=A8(n):(c=o.cachePool,c!==null?(l=Oc._currentValue,c=c.parent!==l?{parent:l,pool:l}:c):c=Lce(),o={baseLanes:o.baseLanes|n,cachePool:c}),i.memoizedState=o,i.childLanes=M8(t,a,n),e.memoizedState=R8,r):(H_(e),n=t.child,t=n.sibling,n=Vv(n,{mode:"visible",children:r.children}),n.return=e,n.sibling=null,t!==null&&(a=e.deletions,a===null?(e.deletions=[t],e.flags|=16):a.push(t)),e.child=n,e.memoizedState=null,n)}function N5(t,e){return e=r2({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function r2(t,e){return t=zd(22,t,null,e),t.lanes=0,t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},t}function O8(t,e,n){return Zw(e,t.child,null,n),t=N5(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function tZ(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),y5(t.return,e,n)}function N8(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Nle(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ol(t,e,r.children,n),r=kc.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&tZ(t,n,e);else if(t.tag===19)tZ(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}switch(Da(kc,r),i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&e2(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),N8(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&e2(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}N8(e,!0,n,null,s);break;case"together":N8(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ty(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Tb|=e.lanes,!(n&e.childLanes))if(t!==null){if(vN(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(jt(153));if(e.child!==null){for(t=e.child,n=Vv(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Vv(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function V$(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&XL(t)))}function DIe(t,e,n){switch(e.tag){case 3:HL(e,e.stateNode.containerInfo),z_(e,Oc,t.memoizedState.cache),gN();break;case 27:case 5:a5(e);break;case 4:HL(e,e.stateNode.containerInfo);break;case 10:z_(e,e.type,e.memoizedProps.value);break;case 13:var r=e.memoizedState;if(r!==null)return r.dehydrated!==null?(H_(e),e.flags|=128,null):n&e.child.childLanes?Ole(t,e,n):(H_(e),t=ty(t,e,n),t!==null?t.sibling:null);H_(e);break;case 19:var i=(t.flags&128)!==0;if(r=(n&e.childLanes)!==0,r||(vN(t,e,n,!1),r=(n&e.childLanes)!==0),i){if(r)return Nle(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Da(kc,kc.current),r)break;return null;case 22:case 23:return e.lanes=0,Mle(t,e,n);case 24:z_(e,Oc,t.memoizedState.cache)}return ty(t,e,n)}function Ile(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)hl=!0;else{if(!V$(t,n)&&!(e.flags&128))return hl=!1,DIe(t,e,n);hl=!!(t.flags&131072)}else hl=!1,ms&&e.flags&1048576&&Dce(e,YL,e.index);switch(e.lanes=0,e.tag){case 16:e:{t=e.pendingProps;var r=e.elementType,i=r._init;if(r=i(r._payload),e.type=r,typeof r=="function")x$(r)?(t=hT(r,t),e.tag=1,e=QJ(null,e,r,t,n)):(e.tag=0,e=O5(null,e,r,t,n));else{if(r!=null){if(i=r.$$typeof,i===u$){e.tag=11,e=XJ(null,e,r,t,n);break e}else if(i===h$){e.tag=14,e=KJ(null,e,r,t,n);break e}}throw e=i5(r)||r,Error(jt(306,e,""))}}return e;case 0:return O5(t,e,e.type,e.pendingProps,n);case 1:return r=e.type,i=hT(r,e.pendingProps),QJ(t,e,r,i,n);case 3:e:{if(HL(e,e.stateNode.containerInfo),t===null)throw Error(jt(387));r=e.pendingProps;var s=e.memoizedState;i=s.element,S5(t,e),WA(e,r,null,n);var a=e.memoizedState;if(r=a.cache,z_(e,Oc,r),r!==s.cache&&_5(e,[Oc],n,!0),$A(),r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){e=eZ(t,e,r,n);break e}else if(r!==i){i=zf(Error(jt(424)),e),FM(i),e=eZ(t,e,r,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(go=tm(t.firstChild),Xu=e,ms=!0,qS=null,pg=!0,n=ble(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(gN(),r===i){e=ty(t,e,n);break e}Ol(t,e,r,n)}e=e.child}return e;case 26:return JD(t,e),t===null?(n=yZ(e.type,null,e.pendingProps,null))?e.memoizedState=n:ms||(n=e.type,t=e.pendingProps,r=u2(Q_.current).createElement(n),r[su]=e,r[Kh]=t,Pl(r,n,t),ol(r),e.stateNode=r):e.memoizedState=yZ(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return a5(e),t===null&&ms&&(r=e.stateNode=yue(e.type,e.pendingProps,Q_.current),Xu=e,pg=!0,i=go,$b(e.type)?(q5=i,go=tm(r.firstChild)):go=i),Ol(t,e,e.pendingProps.children,n),JD(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&ms&&((i=r=go)&&(r=cke(r,e.type,e.pendingProps,pg),r!==null?(e.stateNode=r,Xu=e,go=tm(r.firstChild),pg=!1,i=!0):i=!1),i||cT(e)),a5(e),i=e.type,s=e.pendingProps,a=t!==null?t.memoizedProps:null,r=s.children,j5(i,s)?r=null:a!==null&&j5(i,a)&&(e.flags|=32),e.memoizedState!==null&&(i=I$(t,e,CIe,null,null,n),qM._currentValue=i),JD(t,e),Ol(t,e,r,n),e.child;case 6:return t===null&&ms&&((t=n=go)&&(n=lke(n,e.pendingProps,pg),n!==null?(e.stateNode=n,Xu=e,go=null,t=!0):t=!1),t||cT(e)),null;case 13:return Ole(t,e,n);case 4:return HL(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Zw(e,null,r,n):Ol(t,e,r,n),e.child;case 11:return XJ(t,e,e.type,e.pendingProps,n);case 7:return Ol(t,e,e.pendingProps,n),e.child;case 8:return Ol(t,e,e.pendingProps.children,n),e.child;case 12:return Ol(t,e,e.pendingProps.children,n),e.child;case 10:return r=e.pendingProps,z_(e,e.type,r.value),Ol(t,e,r.children,n),e.child;case 9:return i=e.type._context,r=e.pendingProps.children,lT(e),i=au(i),r=r(i),e.flags|=1,Ol(t,e,r,n),e.child;case 14:return KJ(t,e,e.type,e.pendingProps,n);case 15:return Ale(t,e,e.type,e.pendingProps,n);case 19:return Nle(t,e,n);case 31:return r=e.pendingProps,n=e.mode,r={mode:r.mode,children:r.children},t===null?(n=r2(r,n),n.ref=e.ref,e.child=n,n.return=e,e=n):(n=Vv(t.child,r),n.ref=e.ref,e.child=n,n.return=e,e=n),e;case 22:return Mle(t,e,n);case 24:return lT(e),r=au(Oc),t===null?(i=A$(),i===null&&(i=ia,s=R$(),i.pooledCache=s,s.refCount++,s!==null&&(i.pooledCacheLanes|=n),i=s),e.memoizedState={parent:r,cache:i},M$(e),z_(e,Oc,i)):(t.lanes&n&&(S5(t,e),WA(e,null,null,n),$A()),i=t.memoizedState,s=e.memoizedState,i.parent!==r?(i={parent:r,cache:r},e.memoizedState=i,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=i),z_(e,Oc,r)):(r=s.cache,z_(e,Oc,r),r!==i.cache&&_5(e,[Oc],n,!0))),Ol(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(jt(156,e.tag))}function hv(t){t.flags|=4}function nZ(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!Eue(e)){if(e=rp.current,e!==null&&((Vi&4194048)===Vi?Rg!==null:(Vi&62914560)!==Vi&&!(Vi&536870912)||e!==Rg))throw GA=E5,Uce;t.flags|=8192}}function Vk(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?ice():536870912,t.lanes|=e,Qw|=e)}function qR(t,e){if(!ms)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ga(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&65011712,r|=i.flags&65011712,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function PIe(t,e,n){var r=e.pendingProps;switch(C$(e),e.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ga(e),null;case 1:return Ga(e),null;case 3:return n=e.stateNode,r=null,t!==null&&(r=t.memoizedState.cache),e.memoizedState.cache!==r&&(e.flags|=2048),Gv(Oc),$w(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(VR(e)?hv(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,IJ())),Ga(e),null;case 26:return n=e.memoizedState,t===null?(hv(e),n!==null?(Ga(e),nZ(e,n)):(Ga(e),e.flags&=-16777217)):n?n!==t.memoizedState?(hv(e),Ga(e),nZ(e,n)):(Ga(e),e.flags&=-16777217):(t.memoizedProps!==r&&hv(e),Ga(e),e.flags&=-16777217),null;case 27:jL(e),n=Q_.current;var i=e.type;if(t!==null&&e.stateNode!=null)t.memoizedProps!==r&&hv(e);else{if(!r){if(e.stateNode===null)throw Error(jt(166));return Ga(e),null}t=wg.current,VR(e)?OJ(e):(t=yue(i,r,n),e.stateNode=t,hv(e))}return Ga(e),null;case 5:if(jL(e),n=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==r&&hv(e);else{if(!r){if(e.stateNode===null)throw Error(jt(166));return Ga(e),null}if(t=wg.current,VR(e))OJ(e);else{switch(i=u2(Q_.current),t){case 1:t=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:t=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":t=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":t=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild);break;case"select":t=typeof r.is=="string"?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?t.multiple=!0:r.size&&(t.size=r.size);break;default:t=typeof r.is=="string"?i.createElement(n,{is:r.is}):i.createElement(n)}}t[su]=e,t[Kh]=r;e:for(i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.tag!==27&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}e.stateNode=t;e:switch(Pl(t,n,r),n){case"button":case"input":case"select":case"textarea":t=!!r.autoFocus;break e;case"img":t=!0;break e;default:t=!1}t&&hv(e)}}return Ga(e),e.flags&=-16777217,null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==r&&hv(e);else{if(typeof r!="string"&&e.stateNode===null)throw Error(jt(166));if(t=Q_.current,VR(e)){if(t=e.stateNode,n=e.memoizedProps,r=null,i=Xu,i!==null)switch(i.tag){case 27:case 5:r=i.memoizedProps}t[su]=e,t=!!(t.nodeValue===n||r!==null&&r.suppressHydrationWarning===!0||mue(t.nodeValue,n)),t||cT(e)}else t=u2(t).createTextNode(r),t[su]=e,e.stateNode=t}return Ga(e),null;case 13:if(r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(i=VR(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(jt(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(jt(317));i[su]=e}else gN(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ga(e),i=!1}else i=IJ(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=i),i=!0;if(!i)return e.flags&256?(Uv(e),e):(Uv(e),null)}if(Uv(e),e.flags&128)return e.lanes=n,e;if(n=r!==null,t=t!==null&&t.memoizedState!==null,n){r=e.child,i=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(i=r.alternate.memoizedState.cachePool.pool);var s=null;r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==i&&(r.flags|=2048)}return n!==t&&n&&(e.child.flags|=8192),Vk(e,e.updateQueue),Ga(e),null;case 4:return $w(),t===null&&J$(e.stateNode.containerInfo),Ga(e),null;case 10:return Gv(e.type),Ga(e),null;case 19:if(fl(kc),i=e.memoizedState,i===null)return Ga(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)qR(i,!1);else{if(vo!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=e2(t),s!==null){for(e.flags|=128,qR(i,!1),t=s.updateQueue,e.updateQueue=t,Vk(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)kce(n,t),n=n.sibling;return Da(kc,kc.current&1|2),e.child}t=t.sibling}i.tail!==null&&Cg()>s2&&(e.flags|=128,r=!0,qR(i,!1),e.lanes=4194304)}else{if(!r)if(t=e2(s),t!==null){if(e.flags|=128,r=!0,t=t.updateQueue,e.updateQueue=t,Vk(e,t),qR(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!ms)return Ga(e),null}else 2*Cg()-i.renderingStartTime>s2&&n!==536870912&&(e.flags|=128,r=!0,qR(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(t=i.last,t!==null?t.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Cg(),e.sibling=null,t=kc.current,Da(kc,r?t&1|2:t&1),e):(Ga(e),null);case 22:case 23:return Uv(e),O$(),r=e.memoizedState!==null,t!==null?t.memoizedState!==null!==r&&(e.flags|=8192):r&&(e.flags|=8192),r?n&536870912&&!(e.flags&128)&&(Ga(e),e.subtreeFlags&6&&(e.flags|=8192)):Ga(e),n=e.updateQueue,n!==null&&Vk(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),r=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(r=e.memoizedState.cachePool.pool),r!==n&&(e.flags|=2048),t!==null&&fl($S),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),Gv(Oc),Ga(e),null;case 25:return null;case 30:return null}throw Error(jt(156,e.tag))}function LIe(t,e){switch(C$(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Gv(Oc),$w(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return jL(e),null;case 13:if(Uv(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(jt(340));gN()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return fl(kc),null;case 4:return $w(),null;case 10:return Gv(e.type),null;case 22:case 23:return Uv(e),O$(),t!==null&&fl($S),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return Gv(Oc),null;case 25:return null;default:return null}}function kle(t,e){switch(C$(e),e.tag){case 3:Gv(Oc),$w();break;case 26:case 27:case 5:jL(e);break;case 4:$w();break;case 13:Uv(e);break;case 19:fl(kc);break;case 10:Gv(e.type);break;case 22:case 23:Uv(e),O$(),t!==null&&fl($S);break;case 24:Gv(Oc)}}function SN(t,e){try{var n=e.updateQueue,r=n!==null?n.lastEffect:null;if(r!==null){var i=r.next;n=i;do{if((n.tag&t)===t){r=void 0;var s=n.create,a=n.inst;r=s(),a.destroy=r}n=n.next}while(n!==i)}}catch(o){Ws(e,e.return,o)}}function Sb(t,e,n){try{var r=e.updateQueue,i=r!==null?r.lastEffect:null;if(i!==null){var s=i.next;r=s;do{if((r.tag&t)===t){var a=r.inst,o=a.destroy;if(o!==void 0){a.destroy=void 0,i=e;var c=n,l=o;try{l()}catch(u){Ws(i,c,u)}}}r=r.next}while(r!==s)}}catch(u){Ws(e,e.return,u)}}function Dle(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{zce(e,n)}catch(r){Ws(t,t.return,r)}}}function Ple(t,e,n){n.props=hT(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(r){Ws(t,e,r)}}function XA(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var r=t.stateNode;break;case 30:r=t.stateNode;break;default:r=t.stateNode}typeof n=="function"?t.refCleanup=n(r):n.current=r}}catch(i){Ws(t,e,i)}}function bg(t,e){var n=t.ref,r=t.refCleanup;if(n!==null)if(typeof r=="function")try{r()}catch(i){Ws(t,e,i)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(i){Ws(t,e,i)}else n.current=null}function Lle(t){var e=t.type,n=t.memoizedProps,r=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){Ws(t,t.return,i)}}function I8(t,e,n){try{var r=t.stateNode;rke(r,t.type,n,e),r[Kh]=e}catch(i){Ws(t,t.return,i)}}function Ule(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&$b(t.type)||t.tag===4}function k8(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ule(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&$b(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function I5(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=q3));else if(r!==4&&(r===27&&$b(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(I5(t,e,n),t=t.sibling;t!==null;)I5(t,e,n),t=t.sibling}function i2(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(r===27&&$b(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(i2(t,e,n),t=t.sibling;t!==null;)i2(t,e,n),t=t.sibling}function Ble(t){var e=t.stateNode,n=t.memoizedProps;try{for(var r=t.type,i=e.attributes;i.length;)e.removeAttributeNode(i[0]);Pl(e,r,n),e[su]=t,e[Kh]=n}catch(s){Ws(t,t.return,s)}}var Rv=!1,Po=!1,D8=!1,rZ=typeof WeakSet=="function"?WeakSet:Set,il=null;function UIe(t,e){if(t=t.containerInfo,z5=p2,t=wce(t),E$(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,o=-1,c=-1,l=0,u=0,h=t,d=null;t:for(;;){for(var f;h!==n||i!==0&&h.nodeType!==3||(o=a+i),h!==s||r!==0&&h.nodeType!==3||(c=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===t)break t;if(d===n&&++l===i&&(o=a),d===s&&++u===r&&(c=a),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}n=o===-1||c===-1?null:{start:o,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(H5={focusedElem:t,selectionRange:n},p2=!1,il=e;il!==null;)if(e=il,t=e.child,(e.subtreeFlags&1024)!==0&&t!==null)t.return=e,il=t;else for(;il!==null;){switch(e=il,s=e.alternate,t=e.flags,e.tag){case 0:break;case 11:case 15:break;case 1:if(t&1024&&s!==null){t=void 0,n=e,i=s.memoizedProps,s=s.memoizedState,r=n.stateNode;try{var p=hT(n.type,i,n.elementType===n.type);t=r.getSnapshotBeforeUpdate(p,s),r.__reactInternalSnapshotBeforeUpdate=t}catch(g){Ws(n,n.return,g)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)V5(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":V5(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(jt(163))}if(t=e.sibling,t!==null){t.return=e.return,il=t;break}il=e.return}}function Fle(t,e,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:u_(t,n),r&4&&SN(5,n);break;case 1:if(u_(t,n),r&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(a){Ws(n,n.return,a)}else{var i=hT(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(i,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){Ws(n,n.return,a)}}r&64&&Dle(n),r&512&&XA(n,n.return);break;case 3:if(u_(t,n),r&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{zce(t,e)}catch(a){Ws(n,n.return,a)}}break;case 27:e===null&&r&4&&Ble(n);case 26:case 5:u_(t,n),e===null&&r&4&&Lle(n),r&512&&XA(n,n.return);break;case 12:u_(t,n);break;case 13:u_(t,n),r&4&&jle(t,n),r&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=$Ie.bind(null,n),uke(t,n))));break;case 22:if(r=n.memoizedState!==null||Rv,!r){e=e!==null&&e.memoizedState!==null||Po,i=Rv;var s=Po;Rv=r,(Po=e)&&!s?E_(t,n,(n.subtreeFlags&8772)!==0):u_(t,n),Rv=i,Po=s}break;case 30:break;default:u_(t,n)}}function zle(t){var e=t.alternate;e!==null&&(t.alternate=null,zle(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&m$(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Ma=null,Mh=!1;function dv(t,e,n){for(n=n.child;n!==null;)Hle(t,e,n),n=n.sibling}function Hle(t,e,n){if(qd&&typeof qd.onCommitFiberUnmount=="function")try{qd.onCommitFiberUnmount(hN,n)}catch{}switch(n.tag){case 26:Po||bg(n,e),dv(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:Po||bg(n,e);var r=Ma,i=Mh;$b(n.type)&&(Ma=n.stateNode,Mh=!1),dv(t,e,n),QA(n.stateNode),Ma=r,Mh=i;break;case 5:Po||bg(n,e);case 6:if(r=Ma,i=Mh,Ma=null,dv(t,e,n),Ma=r,Mh=i,Ma!==null)if(Mh)try{(Ma.nodeType===9?Ma.body:Ma.nodeName==="HTML"?Ma.ownerDocument.body:Ma).removeChild(n.stateNode)}catch(s){Ws(n,e,s)}else try{Ma.removeChild(n.stateNode)}catch(s){Ws(n,e,s)}break;case 18:Ma!==null&&(Mh?(t=Ma,mZ(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),YM(t)):mZ(Ma,n.stateNode));break;case 4:r=Ma,i=Mh,Ma=n.stateNode.containerInfo,Mh=!0,dv(t,e,n),Ma=r,Mh=i;break;case 0:case 11:case 14:case 15:Po||Sb(2,n,e),Po||Sb(4,n,e),dv(t,e,n);break;case 1:Po||(bg(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"&&Ple(n,e,r)),dv(t,e,n);break;case 21:dv(t,e,n);break;case 22:Po=(r=Po)||n.memoizedState!==null,dv(t,e,n),Po=r;break;default:dv(t,e,n)}}function jle(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{YM(t)}catch(n){Ws(e,e.return,n)}}function BIe(t){switch(t.tag){case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new rZ),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new rZ),e;default:throw Error(jt(435,t.tag))}}function P8(t,e){var n=BIe(t);e.forEach(function(r){var i=WIe.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}function Cd(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r],s=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 27:if($b(o.type)){Ma=o.stateNode,Mh=!1;break e}break;case 5:Ma=o.stateNode,Mh=!1;break e;case 3:case 4:Ma=o.stateNode.containerInfo,Mh=!0;break e}o=o.return}if(Ma===null)throw Error(jt(160));Hle(s,a,i),Ma=null,Mh=!1,s=i.alternate,s!==null&&(s.return=null),i.return=null}if(e.subtreeFlags&13878)for(e=e.child;e!==null;)Vle(e,t),e=e.sibling}var Vp=null;function Vle(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Cd(e,t),Rd(t),r&4&&(Sb(3,t,t.return),SN(3,t),Sb(5,t,t.return));break;case 1:Cd(e,t),Rd(t),r&512&&(Po||n===null||bg(n,n.return)),r&64&&Rv&&(t=t.updateQueue,t!==null&&(r=t.callbacks,r!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?r:n.concat(r))));break;case 26:var i=Vp;if(Cd(e,t),Rd(t),r&512&&(Po||n===null||bg(n,n.return)),r&4){var s=n!==null?n.memoizedState:null;if(r=t.memoizedState,n===null)if(r===null)if(t.stateNode===null){e:{r=t.type,n=t.memoizedProps,i=i.ownerDocument||i;t:switch(r){case"title":s=i.getElementsByTagName("title")[0],(!s||s[pN]||s[su]||s.namespaceURI==="http://www.w3.org/2000/svg"||s.hasAttribute("itemprop"))&&(s=i.createElement(r),i.head.insertBefore(s,i.querySelector("head > title"))),Pl(s,r,n),s[su]=t,ol(s),r=s;break e;case"link":var a=bZ("link","href",i).get(r+(n.href||""));if(a){for(var o=0;o<a.length;o++)if(s=a[o],s.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&s.getAttribute("rel")===(n.rel==null?null:n.rel)&&s.getAttribute("title")===(n.title==null?null:n.title)&&s.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){a.splice(o,1);break t}}s=i.createElement(r),Pl(s,r,n),i.head.appendChild(s);break;case"meta":if(a=bZ("meta","content",i).get(r+(n.content||""))){for(o=0;o<a.length;o++)if(s=a[o],s.getAttribute("content")===(n.content==null?null:""+n.content)&&s.getAttribute("name")===(n.name==null?null:n.name)&&s.getAttribute("property")===(n.property==null?null:n.property)&&s.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&s.getAttribute("charset")===(n.charSet==null?null:n.charSet)){a.splice(o,1);break t}}s=i.createElement(r),Pl(s,r,n),i.head.appendChild(s);break;default:throw Error(jt(468,r))}s[su]=t,ol(s),r=s}t.stateNode=r}else EZ(i,t.type,t.stateNode);else t.stateNode=_Z(i,r,t.memoizedProps);else s!==r?(s===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):s.count--,r===null?EZ(i,t.type,t.stateNode):_Z(i,r,t.memoizedProps)):r===null&&t.stateNode!==null&&I8(t,t.memoizedProps,n.memoizedProps)}break;case 27:Cd(e,t),Rd(t),r&512&&(Po||n===null||bg(n,n.return)),n!==null&&r&4&&I8(t,t.memoizedProps,n.memoizedProps);break;case 5:if(Cd(e,t),Rd(t),r&512&&(Po||n===null||bg(n,n.return)),t.flags&32){i=t.stateNode;try{Yw(i,"")}catch(f){Ws(t,t.return,f)}}r&4&&t.stateNode!=null&&(i=t.memoizedProps,I8(t,i,n!==null?n.memoizedProps:i)),r&1024&&(D8=!0);break;case 6:if(Cd(e,t),Rd(t),r&4){if(t.stateNode===null)throw Error(jt(162));r=t.memoizedProps,n=t.stateNode;try{n.nodeValue=r}catch(f){Ws(t,t.return,f)}}break;case 3:if(eP=null,i=Vp,Vp=h2(e.containerInfo),Cd(e,t),Vp=i,Rd(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{YM(e.containerInfo)}catch(f){Ws(t,t.return,f)}D8&&(D8=!1,Gle(t));break;case 4:r=Vp,Vp=h2(t.stateNode.containerInfo),Cd(e,t),Rd(t),Vp=r;break;case 12:Cd(e,t),Rd(t);break;case 13:Cd(e,t),Rd(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(Y$=Cg()),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,P8(t,r)));break;case 22:i=t.memoizedState!==null;var c=n!==null&&n.memoizedState!==null,l=Rv,u=Po;if(Rv=l||i,Po=u||c,Cd(e,t),Po=u,Rv=l,Rd(t),r&8192)e:for(e=t.stateNode,e._visibility=i?e._visibility&-2:e._visibility|1,i&&(n===null||c||Rv||Po||_S(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){c=n=e;try{if(s=c.stateNode,i)a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{o=c.stateNode;var h=c.memoizedProps.style,d=h!=null&&h.hasOwnProperty("display")?h.display:null;o.style.display=d==null||typeof d=="boolean"?"":(""+d).trim()}}catch(f){Ws(c,c.return,f)}}}else if(e.tag===6){if(n===null){c=e;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(f){Ws(c,c.return,f)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}r&4&&(r=t.updateQueue,r!==null&&(n=r.retryQueue,n!==null&&(r.retryQueue=null,P8(t,n))));break;case 19:Cd(e,t),Rd(t),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,P8(t,r)));break;case 30:break;case 21:break;default:Cd(e,t),Rd(t)}}function Rd(t){var e=t.flags;if(e&2){try{for(var n,r=t.return;r!==null;){if(Ule(r)){n=r;break}r=r.return}if(n==null)throw Error(jt(160));switch(n.tag){case 27:var i=n.stateNode,s=k8(t);i2(t,s,i);break;case 5:var a=n.stateNode;n.flags&32&&(Yw(a,""),n.flags&=-33);var o=k8(t);i2(t,o,a);break;case 3:case 4:var c=n.stateNode.containerInfo,l=k8(t);I5(t,l,c);break;default:throw Error(jt(161))}}catch(u){Ws(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Gle(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;Gle(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function u_(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)Fle(t,e.alternate,e),e=e.sibling}function _S(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Sb(4,e,e.return),_S(e);break;case 1:bg(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&Ple(e,e.return,n),_S(e);break;case 27:QA(e.stateNode);case 26:case 5:bg(e,e.return),_S(e);break;case 22:e.memoizedState===null&&_S(e);break;case 30:_S(e);break;default:_S(e)}t=t.sibling}}function E_(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var r=e.alternate,i=t,s=e,a=s.flags;switch(s.tag){case 0:case 11:case 15:E_(i,s,n),SN(4,s);break;case 1:if(E_(i,s,n),r=s,i=r.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(l){Ws(r,r.return,l)}if(r=s,i=r.updateQueue,i!==null){var o=r.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)Fce(c[i],o)}catch(l){Ws(r,r.return,l)}}n&&a&64&&Dle(s),XA(s,s.return);break;case 27:Ble(s);case 26:case 5:E_(i,s,n),n&&r===null&&a&4&&Lle(s),XA(s,s.return);break;case 12:E_(i,s,n);break;case 13:E_(i,s,n),n&&a&4&&jle(i,s);break;case 22:s.memoizedState===null&&E_(i,s,n),XA(s,s.return);break;case 30:break;default:E_(i,s,n)}e=e.sibling}}function G$(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&yN(n))}function q$(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&yN(t))}function Zm(t,e,n,r){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)qle(t,e,n,r),e=e.sibling}function qle(t,e,n,r){var i=e.flags;switch(e.tag){case 0:case 11:case 15:Zm(t,e,n,r),i&2048&&SN(9,e);break;case 1:Zm(t,e,n,r);break;case 3:Zm(t,e,n,r),i&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&yN(t)));break;case 12:if(i&2048){Zm(t,e,n,r),t=e.stateNode;try{var s=e.memoizedProps,a=s.id,o=s.onPostCommit;typeof o=="function"&&o(a,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(c){Ws(e,e.return,c)}}else Zm(t,e,n,r);break;case 13:Zm(t,e,n,r);break;case 23:break;case 22:s=e.stateNode,a=e.alternate,e.memoizedState!==null?s._visibility&2?Zm(t,e,n,r):KA(t,e):s._visibility&2?Zm(t,e,n,r):(s._visibility|=2,S1(t,e,n,r,(e.subtreeFlags&10256)!==0)),i&2048&&G$(a,e);break;case 24:Zm(t,e,n,r),i&2048&&q$(e.alternate,e);break;default:Zm(t,e,n,r)}}function S1(t,e,n,r,i){for(i=i&&(e.subtreeFlags&10256)!==0,e=e.child;e!==null;){var s=t,a=e,o=n,c=r,l=a.flags;switch(a.tag){case 0:case 11:case 15:S1(s,a,o,c,i),SN(8,a);break;case 23:break;case 22:var u=a.stateNode;a.memoizedState!==null?u._visibility&2?S1(s,a,o,c,i):KA(s,a):(u._visibility|=2,S1(s,a,o,c,i)),i&&l&2048&&G$(a.alternate,a);break;case 24:S1(s,a,o,c,i),i&&l&2048&&q$(a.alternate,a);break;default:S1(s,a,o,c,i)}e=e.sibling}}function KA(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,r=e,i=r.flags;switch(r.tag){case 22:KA(n,r),i&2048&&G$(r.alternate,r);break;case 24:KA(n,r),i&2048&&q$(r.alternate,r);break;default:KA(n,r)}e=e.sibling}}var yA=8192;function n1(t){if(t.subtreeFlags&yA)for(t=t.child;t!==null;)$le(t),t=t.sibling}function $le(t){switch(t.tag){case 26:n1(t),t.flags&yA&&t.memoizedState!==null&&Tke(Vp,t.memoizedState,t.memoizedProps);break;case 5:n1(t);break;case 3:case 4:var e=Vp;Vp=h2(t.stateNode.containerInfo),n1(t),Vp=e;break;case 22:t.memoizedState===null&&(e=t.alternate,e!==null&&e.memoizedState!==null?(e=yA,yA=16777216,n1(t),yA=e):n1(t));break;default:n1(t)}}function Wle(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function $R(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var r=e[n];il=r,Xle(r,t)}Wle(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Yle(t),t=t.sibling}function Yle(t){switch(t.tag){case 0:case 11:case 15:$R(t),t.flags&2048&&Sb(9,t,t.return);break;case 3:$R(t);break;case 12:$R(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,ZD(t)):$R(t);break;default:$R(t)}}function ZD(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var r=e[n];il=r,Xle(r,t)}Wle(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:Sb(8,e,e.return),ZD(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,ZD(e));break;default:ZD(e)}t=t.sibling}}function Xle(t,e){for(;il!==null;){var n=il;switch(n.tag){case 0:case 11:case 15:Sb(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var r=n.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:yN(n.memoizedState.cache)}if(r=n.child,r!==null)r.return=n,il=r;else e:for(n=t;il!==null;){r=il;var i=r.sibling,s=r.return;if(zle(r),r===n){il=null;break e}if(i!==null){i.return=s,il=i;break e}il=s}}}var FIe={getCacheForType:function(t){var e=au(Oc),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n}},zIe=typeof WeakMap=="function"?WeakMap:Map,Rs=0,ia=null,Ci=null,Vi=0,Cs=0,Id=null,Y_=!1,qC=!1,$$=!1,ny=0,vo=0,Tb=0,WS=0,W$=0,Wf=0,Qw=0,JA=null,Nh=null,k5=!1,Y$=0,s2=1/0,a2=null,nb=null,Il=0,rb=null,eC=null,pw=0,D5=0,P5=null,Kle=null,ZA=0,L5=null;function Wd(){if(Rs&2&&Vi!==0)return Vi&-Vi;if(Ur.T!==null){var t=Xw;return t!==0?t:K$()}return oce()}function Jle(){Wf===0&&(Wf=!(Vi&536870912)||ms?rce():536870912);var t=rp.current;return t!==null&&(t.flags|=32),Wf}function Yd(t,e,n){(t===ia&&(Cs===2||Cs===9)||t.cancelPendingCommit!==null)&&(tC(t,0),X_(t,Vi,Wf,!1)),fN(t,n),(!(Rs&2)||t!==ia)&&(t===ia&&(!(Rs&2)&&(WS|=n),vo===4&&X_(t,Vi,Wf,!1)),Zg(t))}function Zle(t,e,n){if(Rs&6)throw Error(jt(327));var r=!n&&(e&124)===0&&(e&t.expiredLanes)===0||dN(t,e),i=r?VIe(t,e):L8(t,e,!0),s=r;do{if(i===0){qC&&!r&&X_(t,e,0,!1);break}else{if(n=t.current.alternate,s&&!HIe(n)){i=L8(t,e,!1),s=!1;continue}if(i===2){if(s=e,t.errorRecoveryDisabledLanes&s)var a=0;else a=t.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var o=t;i=JA;var c=o.current.memoizedState.isDehydrated;if(c&&(tC(o,a).flags|=256),a=L8(o,a,!1),a!==2){if($$&&!c){o.errorRecoveryDisabledLanes|=s,WS|=s,i=4;break e}s=Nh,Nh=i,s!==null&&(Nh===null?Nh=s:Nh.push.apply(Nh,s))}i=a}if(s=!1,i!==2)continue}}if(i===1){tC(t,0),X_(t,e,0,!0);break}e:{switch(r=t,s=i,s){case 0:case 1:throw Error(jt(345));case 4:if((e&4194048)!==e)break;case 6:X_(r,e,Wf,!Y_);break e;case 2:Nh=null;break;case 3:case 5:break;default:throw Error(jt(329))}if((e&62914560)===e&&(i=Y$+300-Cg(),10<i)){if(X_(r,e,Wf,!Y_),I3(r,0,!0)!==0)break e;r.timeoutHandle=vue(iZ.bind(null,r,n,Nh,a2,k5,e,Wf,WS,Qw,Y_,s,2,-0,0),i);break e}iZ(r,n,Nh,a2,k5,e,Wf,WS,Qw,Y_,s,0,-0,0)}}break}while(!0);Zg(t)}function iZ(t,e,n,r,i,s,a,o,c,l,u,h,d,f){if(t.timeoutHandle=-1,h=e.subtreeFlags,(h&8192||(h&16785408)===16785408)&&(GM={stylesheets:null,count:0,unsuspend:Ske},$le(e),h=xke(),h!==null)){t.cancelPendingCommit=h(aZ.bind(null,t,e,s,n,r,i,a,o,c,u,1,d,f)),X_(t,s,a,!l);return}aZ(t,e,s,n,r,i,a,o,c)}function HIe(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Jd(s(),i))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function X_(t,e,n,r){e&=~W$,e&=~WS,t.suspendedLanes|=e,t.pingedLanes&=~e,r&&(t.warmLanes|=e),r=t.expirationTimes;for(var i=e;0<i;){var s=31-$d(i),a=1<<s;r[s]=-1,i&=~a}n!==0&&sce(t,n,e)}function j3(){return Rs&6?!0:(TN(0),!1)}function X$(){if(Ci!==null){if(Cs===0)var t=Ci.return;else t=Ci,Lv=VT=null,P$(t),fw=null,HM=0,t=Ci;for(;t!==null;)kle(t.alternate,t),t=t.return;Ci=null}}function tC(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,ske(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),X$(),ia=t,Ci=n=Vv(t.current,null),Vi=e,Cs=0,Id=null,Y_=!1,qC=dN(t,e),$$=!1,Qw=Wf=W$=WS=Tb=vo=0,Nh=JA=null,k5=!1,e&8&&(e|=e&32);var r=t.entangledLanes;if(r!==0)for(t=t.entanglements,r&=e;0<r;){var i=31-$d(r),s=1<<i;e|=t[i],r&=~s}return ny=e,L3(),n}function Qle(t,e){vi=null,Ur.H=QL,e===_N||e===B3?(e=LJ(),Cs=3):e===Uce?(e=LJ(),Cs=4):Cs=e===Rle?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Id=e,Ci===null&&(vo=1,n2(t,zf(e,t.current)))}function eue(){var t=Ur.H;return Ur.H=QL,t===null?QL:t}function tue(){var t=Ur.A;return Ur.A=FIe,t}function U5(){vo=4,Y_||(Vi&4194048)!==Vi&&rp.current!==null||(qC=!0),!(Tb&134217727)&&!(WS&134217727)||ia===null||X_(ia,Vi,Wf,!1)}function L8(t,e,n){var r=Rs;Rs|=2;var i=eue(),s=tue();(ia!==t||Vi!==e)&&(a2=null,tC(t,e)),e=!1;var a=vo;e:do try{if(Cs!==0&&Ci!==null){var o=Ci,c=Id;switch(Cs){case 8:X$(),a=6;break e;case 3:case 2:case 9:case 6:rp.current===null&&(e=!0);var l=Cs;if(Cs=0,Id=null,$1(t,o,c,l),n&&qC){a=0;break e}break;default:l=Cs,Cs=0,Id=null,$1(t,o,c,l)}}jIe(),a=vo;break}catch(u){Qle(t,u)}while(!0);return e&&t.shellSuspendCounter++,Lv=VT=null,Rs=r,Ur.H=i,Ur.A=s,Ci===null&&(ia=null,Vi=0,L3()),a}function jIe(){for(;Ci!==null;)nue(Ci)}function VIe(t,e){var n=Rs;Rs|=2;var r=eue(),i=tue();ia!==t||Vi!==e?(a2=null,s2=Cg()+500,tC(t,e)):qC=dN(t,e);e:do try{if(Cs!==0&&Ci!==null){e=Ci;var s=Id;t:switch(Cs){case 1:Cs=0,Id=null,$1(t,e,s,1);break;case 2:case 9:if(PJ(s)){Cs=0,Id=null,sZ(e);break}e=function(){Cs!==2&&Cs!==9||ia!==t||(Cs=7),Zg(t)},s.then(e,e);break e;case 3:Cs=7;break e;case 4:Cs=5;break e;case 7:PJ(s)?(Cs=0,Id=null,sZ(e)):(Cs=0,Id=null,$1(t,e,s,7));break;case 5:var a=null;switch(Ci.tag){case 26:a=Ci.memoizedState;case 5:case 27:var o=Ci;if(!a||Eue(a)){Cs=0,Id=null;var c=o.sibling;if(c!==null)Ci=c;else{var l=o.return;l!==null?(Ci=l,V3(l)):Ci=null}break t}}Cs=0,Id=null,$1(t,e,s,5);break;case 6:Cs=0,Id=null,$1(t,e,s,6);break;case 8:X$(),vo=6;break e;default:throw Error(jt(462))}}GIe();break}catch(u){Qle(t,u)}while(!0);return Lv=VT=null,Ur.H=r,Ur.A=i,Rs=n,Ci!==null?0:(ia=null,Vi=0,L3(),vo)}function GIe(){for(;Ci!==null&&!dNe();)nue(Ci)}function nue(t){var e=Ile(t.alternate,t,ny);t.memoizedProps=t.pendingProps,e===null?V3(t):Ci=e}function sZ(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=ZJ(n,e,e.pendingProps,e.type,void 0,Vi);break;case 11:e=ZJ(n,e,e.pendingProps,e.type.render,e.ref,Vi);break;case 5:P$(e);default:kle(n,e),e=Ci=kce(e,ny),e=Ile(n,e,ny)}t.memoizedProps=t.pendingProps,e===null?V3(t):Ci=e}function $1(t,e,n,r){Lv=VT=null,P$(e),fw=null,HM=0;var i=e.return;try{if(kIe(t,i,e,n,Vi)){vo=1,n2(t,zf(n,t.current)),Ci=null;return}}catch(s){if(i!==null)throw Ci=i,s;vo=1,n2(t,zf(n,t.current)),Ci=null;return}e.flags&32768?(ms||r===1?t=!0:qC||Vi&536870912?t=!1:(Y_=t=!0,(r===2||r===9||r===3||r===6)&&(r=rp.current,r!==null&&r.tag===13&&(r.flags|=16384))),rue(e,t)):V3(e)}function V3(t){var e=t;do{if(e.flags&32768){rue(e,Y_);return}t=e.return;var n=PIe(e.alternate,e,ny);if(n!==null){Ci=n;return}if(e=e.sibling,e!==null){Ci=e;return}Ci=e=t}while(e!==null);vo===0&&(vo=5)}function rue(t,e){do{var n=LIe(t.alternate,t);if(n!==null){n.flags&=32767,Ci=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){Ci=t;return}Ci=t=n}while(t!==null);vo=6,Ci=null}function aZ(t,e,n,r,i,s,a,o,c){t.cancelPendingCommit=null;do G3();while(Il!==0);if(Rs&6)throw Error(jt(327));if(e!==null){if(e===t.current)throw Error(jt(177));if(s=e.lanes|e.childLanes,s|=S$,SNe(t,n,s,a,o,c),t===ia&&(Ci=ia=null,Vi=0),eC=e,rb=t,pw=n,D5=s,P5=i,Kle=r,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,YIe(VL,function(){return cue(),null})):(t.callbackNode=null,t.callbackPriority=0),r=(e.flags&13878)!==0,e.subtreeFlags&13878||r){r=Ur.T,Ur.T=null,i=gs.p,gs.p=2,a=Rs,Rs|=4;try{UIe(t,e,n)}finally{Rs=a,gs.p=i,Ur.T=r}}Il=1,iue(),sue(),aue()}}function iue(){if(Il===1){Il=0;var t=rb,e=eC,n=(e.flags&13878)!==0;if(e.subtreeFlags&13878||n){n=Ur.T,Ur.T=null;var r=gs.p;gs.p=2;var i=Rs;Rs|=4;try{Vle(e,t);var s=H5,a=wce(t.containerInfo),o=s.focusedElem,c=s.selectionRange;if(a!==o&&o&&o.ownerDocument&&xce(o.ownerDocument.documentElement,o)){if(c!==null&&E$(o)){var l=c.start,u=c.end;if(u===void 0&&(u=l),"selectionStart"in o)o.selectionStart=l,o.selectionEnd=Math.min(u,o.value.length);else{var h=o.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var f=d.getSelection(),p=o.textContent.length,g=Math.min(c.start,p),_=c.end===void 0?g:Math.min(c.end,p);!f.extend&&g>_&&(a=_,_=g,g=a);var v=RJ(o,g),E=RJ(o,_);if(v&&E&&(f.rangeCount!==1||f.anchorNode!==v.node||f.anchorOffset!==v.offset||f.focusNode!==E.node||f.focusOffset!==E.offset)){var T=h.createRange();T.setStart(v.node,v.offset),f.removeAllRanges(),g>_?(f.addRange(T),f.extend(E.node,E.offset)):(T.setEnd(E.node,E.offset),f.addRange(T))}}}}for(h=[],f=o;f=f.parentNode;)f.nodeType===1&&h.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<h.length;o++){var x=h[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}p2=!!z5,H5=z5=null}finally{Rs=i,gs.p=r,Ur.T=n}}t.current=e,Il=2}}function sue(){if(Il===2){Il=0;var t=rb,e=eC,n=(e.flags&8772)!==0;if(e.subtreeFlags&8772||n){n=Ur.T,Ur.T=null;var r=gs.p;gs.p=2;var i=Rs;Rs|=4;try{Fle(t,e.alternate,e)}finally{Rs=i,gs.p=r,Ur.T=n}}Il=3}}function aue(){if(Il===4||Il===3){Il=0,fNe();var t=rb,e=eC,n=pw,r=Kle;e.subtreeFlags&10256||e.flags&10256?Il=5:(Il=0,eC=rb=null,oue(t,t.pendingLanes));var i=t.pendingLanes;if(i===0&&(nb=null),p$(n),e=e.stateNode,qd&&typeof qd.onCommitFiberRoot=="function")try{qd.onCommitFiberRoot(hN,e,void 0,(e.current.flags&128)===128)}catch{}if(r!==null){e=Ur.T,i=gs.p,gs.p=2,Ur.T=null;try{for(var s=t.onRecoverableError,a=0;a<r.length;a++){var o=r[a];s(o.value,{componentStack:o.stack})}}finally{Ur.T=e,gs.p=i}}pw&3&&G3(),Zg(t),i=t.pendingLanes,n&4194090&&i&42?t===L5?ZA++:(ZA=0,L5=t):ZA=0,TN(0)}}function oue(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,yN(e)))}function G3(t){return iue(),sue(),aue(),cue()}function cue(){if(Il!==5)return!1;var t=rb,e=D5;D5=0;var n=p$(pw),r=Ur.T,i=gs.p;try{gs.p=32>n?32:n,Ur.T=null,n=P5,P5=null;var s=rb,a=pw;if(Il=0,eC=rb=null,pw=0,Rs&6)throw Error(jt(331));var o=Rs;if(Rs|=4,Yle(s.current),qle(s,s.current,a,n),Rs=o,TN(0,!1),qd&&typeof qd.onPostCommitFiberRoot=="function")try{qd.onPostCommitFiberRoot(hN,s)}catch{}return!0}finally{gs.p=i,Ur.T=r,oue(t,e)}}function oZ(t,e,n){e=zf(n,e),e=M5(t.stateNode,e,2),t=tb(t,e,2),t!==null&&(fN(t,2),Zg(t))}function Ws(t,e,n){if(t.tag===3)oZ(t,t,n);else for(;e!==null;){if(e.tag===3){oZ(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(nb===null||!nb.has(r))){t=zf(n,t),n=wle(2),r=tb(e,n,2),r!==null&&(Cle(n,r,e,t),fN(r,2),Zg(r));break}}e=e.return}}function U8(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new zIe;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||($$=!0,i.add(n),t=qIe.bind(null,t,e,n),e.then(t,t))}function qIe(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,ia===t&&(Vi&n)===n&&(vo===4||vo===3&&(Vi&62914560)===Vi&&300>Cg()-Y$?!(Rs&2)&&tC(t,0):W$|=n,Qw===Vi&&(Qw=0)),Zg(t)}function lue(t,e){e===0&&(e=ice()),t=GC(t,e),t!==null&&(fN(t,e),Zg(t))}function $Ie(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),lue(t,n)}function WIe(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;case 22:r=t.stateNode._retryCache;break;default:throw Error(jt(314))}r!==null&&r.delete(e),lue(t,n)}function YIe(t,e){return d$(t,e)}var o2=null,T1=null,B5=!1,c2=!1,B8=!1,YS=0;function Zg(t){t!==T1&&t.next===null&&(T1===null?o2=T1=t:T1=T1.next=t),c2=!0,B5||(B5=!0,KIe())}function TN(t,e){if(!B8&&c2){B8=!0;do for(var n=!1,r=o2;r!==null;){if(t!==0){var i=r.pendingLanes;if(i===0)var s=0;else{var a=r.suspendedLanes,o=r.pingedLanes;s=(1<<31-$d(42|t)+1)-1,s&=i&~(a&~o),s=s&201326741?s&201326741|1:s?s|2:0}s!==0&&(n=!0,cZ(r,s))}else s=Vi,s=I3(r,r===ia?s:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),!(s&3)||dN(r,s)||(n=!0,cZ(r,s));r=r.next}while(n);B8=!1}}function XIe(){uue()}function uue(){c2=B5=!1;var t=0;YS!==0&&(ike()&&(t=YS),YS=0);for(var e=Cg(),n=null,r=o2;r!==null;){var i=r.next,s=hue(r,e);s===0?(r.next=null,n===null?o2=i:n.next=i,i===null&&(T1=n)):(n=r,(t!==0||s&3)&&(c2=!0)),r=i}TN(t)}function hue(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes&-62914561;0<s;){var a=31-$d(s),o=1<<a,c=i[a];c===-1?(!(o&n)||o&r)&&(i[a]=ENe(o,e)):c<=e&&(t.expiredLanes|=o),s&=~o}if(e=ia,n=Vi,n=I3(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r=t.callbackNode,n===0||t===e&&(Cs===2||Cs===9)||t.cancelPendingCommit!==null)return r!==null&&r!==null&&u8(r),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||dN(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(r!==null&&u8(r),p$(n)){case 2:case 8:n=tce;break;case 32:n=VL;break;case 268435456:n=nce;break;default:n=VL}return r=due.bind(null,t),n=d$(n,r),t.callbackPriority=e,t.callbackNode=n,e}return r!==null&&r!==null&&u8(r),t.callbackPriority=2,t.callbackNode=null,2}function due(t,e){if(Il!==0&&Il!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(G3()&&t.callbackNode!==n)return null;var r=Vi;return r=I3(t,t===ia?r:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r===0?null:(Zle(t,r,e),hue(t,Cg()),t.callbackNode!=null&&t.callbackNode===n?due.bind(null,t):null)}function cZ(t,e){if(G3())return null;Zle(t,e,!0)}function KIe(){ake(function(){Rs&6?d$(ece,XIe):uue()})}function K$(){return YS===0&&(YS=rce()),YS}function lZ(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:GD(""+t)}function uZ(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function JIe(t,e,n,r,i){if(e==="submit"&&n&&n.stateNode===i){var s=lZ((i[Kh]||null).action),a=r.submitter;a&&(e=(e=a[Kh]||null)?lZ(e.formAction):a.getAttribute("formAction"),e!==null&&(s=e,a=null));var o=new k3("action","action",null,r,i);t.push({event:o,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(YS!==0){var c=a?uZ(i,a):new FormData(i);R5(n,{pending:!0,data:c,method:i.method,action:s},null,c)}}else typeof s=="function"&&(o.preventDefault(),c=a?uZ(i,a):new FormData(i),R5(n,{pending:!0,data:c,method:i.method,action:s},s,c))},currentTarget:i}]})}}for(var F8=0;F8<m5.length;F8++){var z8=m5[F8],ZIe=z8.toLowerCase(),QIe=z8[0].toUpperCase()+z8.slice(1);um(ZIe,"on"+QIe)}um(Rce,"onAnimationEnd");um(Ace,"onAnimationIteration");um(Mce,"onAnimationStart");um("dblclick","onDoubleClick");um("focusin","onFocus");um("focusout","onBlur");um(gIe,"onTransitionRun");um(vIe,"onTransitionStart");um(yIe,"onTransitionCancel");um(Oce,"onTransitionEnd");Ww("onMouseEnter",["mouseout","mouseover"]);Ww("onMouseLeave",["mouseout","mouseover"]);Ww("onPointerEnter",["pointerout","pointerover"]);Ww("onPointerLeave",["pointerout","pointerover"]);zT("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zT("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zT("onBeforeInput",["compositionend","keypress","textInput","paste"]);zT("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zT("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zT("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jM="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eke=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jM));function fue(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==s&&i.isPropagationStopped())break e;s=o,i.currentTarget=l;try{s(i)}catch(u){t2(u)}i.currentTarget=null,s=c}else for(a=0;a<r.length;a++){if(o=r[a],c=o.instance,l=o.currentTarget,o=o.listener,c!==s&&i.isPropagationStopped())break e;s=o,i.currentTarget=l;try{s(i)}catch(u){t2(u)}i.currentTarget=null,s=c}}}}function wi(t,e){var n=e[c5];n===void 0&&(n=e[c5]=new Set);var r=t+"__bubble";n.has(r)||(pue(e,t,2,!1),n.add(r))}function H8(t,e,n){var r=0;e&&(r|=4),pue(n,t,r,e)}var Gk="_reactListening"+Math.random().toString(36).slice(2);function J$(t){if(!t[Gk]){t[Gk]=!0,cce.forEach(function(n){n!=="selectionchange"&&(eke.has(n)||H8(n,!1,t),H8(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Gk]||(e[Gk]=!0,H8("selectionchange",!1,e))}}function pue(t,e,n,r){switch(Cue(e)){case 2:var i=Rke;break;case 8:i=Ake;break;default:i=t7}n=i.bind(null,e,n,t),i=void 0,!d5||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function j8(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&a.stateNode.containerInfo===i)return;a=a.return}for(;o!==null;){if(a=U1(o),a===null)return;if(c=a.tag,c===5||c===6||c===26||c===27){r=s=a;continue e}o=o.parentNode}}r=r.return}gce(function(){var l=s,u=v$(n),h=[];e:{var d=Nce.get(t);if(d!==void 0){var f=k3,p=t;switch(t){case"keypress":if($D(n)===0)break e;case"keydown":case"keyup":f=YNe;break;case"focusin":p="focus",f=y8;break;case"focusout":p="blur",f=y8;break;case"beforeblur":case"afterblur":f=y8;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=vJ;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=LNe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=JNe;break;case Rce:case Ace:case Mce:f=FNe;break;case Oce:f=QNe;break;case"scroll":case"scrollend":f=DNe;break;case"wheel":f=tIe;break;case"copy":case"cut":case"paste":f=HNe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=_J;break;case"toggle":case"beforetoggle":f=rIe}var g=(e&4)!==0,_=!g&&(t==="scroll"||t==="scrollend"),v=g?d!==null?d+"Capture":null:d;g=[];for(var E=l,T;E!==null;){var x=E;if(T=x.stateNode,x=x.tag,x!==5&&x!==26&&x!==27||T===null||v===null||(x=LM(E,v),x!=null&&g.push(VM(E,x,T))),_)break;E=E.return}0<g.length&&(d=new f(d,p,null,n,u),h.push({event:d,listeners:g}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&n!==h5&&(p=n.relatedTarget||n.fromElement)&&(U1(p)||p[jC]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=l,p=p?U1(p):null,p!==null&&(_=uN(p),g=p.tag,p!==_||g!==5&&g!==27&&g!==6)&&(p=null)):(f=null,p=l),f!==p)){if(g=vJ,x="onMouseLeave",v="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(g=_J,x="onPointerLeave",v="onPointerEnter",E="pointer"),_=f==null?d:vA(f),T=p==null?d:vA(p),d=new g(x,E+"leave",f,n,u),d.target=_,d.relatedTarget=T,x=null,U1(u)===l&&(g=new g(v,E+"enter",p,n,u),g.target=T,g.relatedTarget=_,x=g),_=x,f&&p)t:{for(g=f,v=p,E=0,T=g;T;T=r1(T))E++;for(T=0,x=v;x;x=r1(x))T++;for(;0<E-T;)g=r1(g),E--;for(;0<T-E;)v=r1(v),T--;for(;E--;){if(g===v||v!==null&&g===v.alternate)break t;g=r1(g),v=r1(v)}g=null}else g=null;f!==null&&hZ(h,d,f,g,!1),p!==null&&_!==null&&hZ(h,_,p,g,!0)}}e:{if(d=l?vA(l):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var N=TJ;else if(SJ(d))if(Sce)N=fIe;else{N=hIe;var A=uIe}else f=d.nodeName,!f||f.toLowerCase()!=="input"||d.type!=="checkbox"&&d.type!=="radio"?l&&g$(l.elementType)&&(N=TJ):N=dIe;if(N&&(N=N(t,l))){Ece(h,N,n,u);break e}A&&A(t,d,l),t==="focusout"&&l&&d.type==="number"&&l.memoizedProps.value!=null&&u5(d,"number",d.value)}switch(A=l?vA(l):window,t){case"focusin":(SJ(A)||A.contentEditable==="true")&&(z1=A,f5=l,jA=null);break;case"focusout":jA=f5=z1=null;break;case"mousedown":p5=!0;break;case"contextmenu":case"mouseup":case"dragend":p5=!1,AJ(h,n,u);break;case"selectionchange":if(mIe)break;case"keydown":case"keyup":AJ(h,n,u)}var I;if(b$)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else F1?_ce(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(yce&&n.locale!=="ko"&&(F1||k!=="onCompositionStart"?k==="onCompositionEnd"&&F1&&(I=vce()):(W_=u,y$="value"in W_?W_.value:W_.textContent,F1=!0)),A=l2(l,k),0<A.length&&(k=new yJ(k,t,null,n,u),h.push({event:k,listeners:A}),I?k.data=I:(I=bce(n),I!==null&&(k.data=I)))),(I=sIe?aIe(t,n):oIe(t,n))&&(k=l2(l,"onBeforeInput"),0<k.length&&(A=new yJ("onBeforeInput","beforeinput",null,n,u),h.push({event:A,listeners:k}),A.data=I)),JIe(h,t,l,n,u)}fue(h,e)})}function VM(t,e,n){return{instance:t,listener:e,currentTarget:n}}function l2(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||s===null||(i=LM(t,n),i!=null&&r.unshift(VM(t,i,s)),i=LM(t,e),i!=null&&r.push(VM(t,i,s))),t.tag===3)return r;t=t.return}return[]}function r1(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function hZ(t,e,n,r,i){for(var s=e._reactName,a=[];n!==null&&n!==r;){var o=n,c=o.alternate,l=o.stateNode;if(o=o.tag,c!==null&&c===r)break;o!==5&&o!==26&&o!==27||l===null||(c=l,i?(l=LM(n,s),l!=null&&a.unshift(VM(n,l,c))):i||(l=LM(n,s),l!=null&&a.push(VM(n,l,c)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var tke=/\r\n?/g,nke=/\u0000|\uFFFD/g;function dZ(t){return(typeof t=="string"?t:""+t).replace(tke,`
`).replace(nke,"")}function mue(t,e){return e=dZ(e),dZ(t)===e}function q3(){}function Ls(t,e,n,r,i,s){switch(n){case"children":typeof r=="string"?e==="body"||e==="textarea"&&r===""||Yw(t,r):(typeof r=="number"||typeof r=="bigint")&&e!=="body"&&Yw(t,""+r);break;case"className":Uk(t,"class",r);break;case"tabIndex":Uk(t,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Uk(t,n,r);break;case"style":mce(t,r,s);break;case"data":if(e!=="object"){Uk(t,"data",r);break}case"src":case"href":if(r===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(n);break}r=GD(""+r),t.setAttribute(n,r);break;case"action":case"formAction":if(typeof r=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof s=="function"&&(n==="formAction"?(e!=="input"&&Ls(t,e,"name",i.name,i,null),Ls(t,e,"formEncType",i.formEncType,i,null),Ls(t,e,"formMethod",i.formMethod,i,null),Ls(t,e,"formTarget",i.formTarget,i,null)):(Ls(t,e,"encType",i.encType,i,null),Ls(t,e,"method",i.method,i,null),Ls(t,e,"target",i.target,i,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(n);break}r=GD(""+r),t.setAttribute(n,r);break;case"onClick":r!=null&&(t.onclick=q3);break;case"onScroll":r!=null&&wi("scroll",t);break;case"onScrollEnd":r!=null&&wi("scrollend",t);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(jt(61));if(n=r.__html,n!=null){if(i.children!=null)throw Error(jt(60));t.innerHTML=n}}break;case"multiple":t.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":t.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){t.removeAttribute("xlink:href");break}n=GD(""+r),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,""+r):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":r===!0?t.setAttribute(n,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(n,r):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?t.setAttribute(n,r):t.removeAttribute(n);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?t.removeAttribute(n):t.setAttribute(n,r);break;case"popover":wi("beforetoggle",t),wi("toggle",t),VD(t,"popover",r);break;case"xlinkActuate":uv(t,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":uv(t,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":uv(t,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":uv(t,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":uv(t,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":uv(t,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":uv(t,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":uv(t,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":uv(t,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":VD(t,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=INe.get(n)||n,VD(t,n,r))}}function F5(t,e,n,r,i,s){switch(n){case"style":mce(t,r,s);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(jt(61));if(n=r.__html,n!=null){if(i.children!=null)throw Error(jt(60));t.innerHTML=n}}break;case"children":typeof r=="string"?Yw(t,r):(typeof r=="number"||typeof r=="bigint")&&Yw(t,""+r);break;case"onScroll":r!=null&&wi("scroll",t);break;case"onScrollEnd":r!=null&&wi("scrollend",t);break;case"onClick":r!=null&&(t.onclick=q3);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!lce.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(i=n.endsWith("Capture"),e=n.slice(2,i?n.length-7:void 0),s=t[Kh]||null,s=s!=null?s[n]:null,typeof s=="function"&&t.removeEventListener(e,s,i),typeof r=="function")){typeof s!="function"&&s!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,r,i);break e}n in t?t[n]=r:r===!0?t.setAttribute(n,""):VD(t,n,r)}}}function Pl(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":wi("error",t),wi("load",t);var r=!1,i=!1,s;for(s in n)if(n.hasOwnProperty(s)){var a=n[s];if(a!=null)switch(s){case"src":r=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(jt(137,e));default:Ls(t,e,s,a,n,null)}}i&&Ls(t,e,"srcSet",n.srcSet,n,null),r&&Ls(t,e,"src",n.src,n,null);return;case"input":wi("invalid",t);var o=s=a=i=null,c=null,l=null;for(r in n)if(n.hasOwnProperty(r)){var u=n[r];if(u!=null)switch(r){case"name":i=u;break;case"type":a=u;break;case"checked":c=u;break;case"defaultChecked":l=u;break;case"value":s=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(u!=null)throw Error(jt(137,e));break;default:Ls(t,e,r,u,n,null)}}dce(t,s,o,c,l,a,i,!1),GL(t);return;case"select":wi("invalid",t),r=a=s=null;for(i in n)if(n.hasOwnProperty(i)&&(o=n[i],o!=null))switch(i){case"value":s=o;break;case"defaultValue":a=o;break;case"multiple":r=o;default:Ls(t,e,i,o,n,null)}e=s,n=a,t.multiple=!!r,e!=null?cw(t,!!r,e,!1):n!=null&&cw(t,!!r,n,!0);return;case"textarea":wi("invalid",t),s=i=r=null;for(a in n)if(n.hasOwnProperty(a)&&(o=n[a],o!=null))switch(a){case"value":r=o;break;case"defaultValue":i=o;break;case"children":s=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(jt(91));break;default:Ls(t,e,a,o,n,null)}pce(t,r,i,s),GL(t);return;case"option":for(c in n)if(n.hasOwnProperty(c)&&(r=n[c],r!=null))switch(c){case"selected":t.selected=r&&typeof r!="function"&&typeof r!="symbol";break;default:Ls(t,e,c,r,n,null)}return;case"dialog":wi("beforetoggle",t),wi("toggle",t),wi("cancel",t),wi("close",t);break;case"iframe":case"object":wi("load",t);break;case"video":case"audio":for(r=0;r<jM.length;r++)wi(jM[r],t);break;case"image":wi("error",t),wi("load",t);break;case"details":wi("toggle",t);break;case"embed":case"source":case"link":wi("error",t),wi("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(l in n)if(n.hasOwnProperty(l)&&(r=n[l],r!=null))switch(l){case"children":case"dangerouslySetInnerHTML":throw Error(jt(137,e));default:Ls(t,e,l,r,n,null)}return;default:if(g$(e)){for(u in n)n.hasOwnProperty(u)&&(r=n[u],r!==void 0&&F5(t,e,u,r,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(r=n[o],r!=null&&Ls(t,e,o,r,n,null))}function rke(t,e,n,r){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,s=null,a=null,o=null,c=null,l=null,u=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&h!=null)switch(f){case"checked":break;case"value":break;case"defaultValue":c=h;default:r.hasOwnProperty(f)||Ls(t,e,f,null,r,h)}}for(var d in r){var f=r[d];if(h=n[d],r.hasOwnProperty(d)&&(f!=null||h!=null))switch(d){case"type":s=f;break;case"name":i=f;break;case"checked":l=f;break;case"defaultChecked":u=f;break;case"value":a=f;break;case"defaultValue":o=f;break;case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(jt(137,e));break;default:f!==h&&Ls(t,e,d,f,r,h)}}l5(t,a,o,c,l,u,s,i);return;case"select":f=a=o=d=null;for(s in n)if(c=n[s],n.hasOwnProperty(s)&&c!=null)switch(s){case"value":break;case"multiple":f=c;default:r.hasOwnProperty(s)||Ls(t,e,s,null,r,c)}for(i in r)if(s=r[i],c=n[i],r.hasOwnProperty(i)&&(s!=null||c!=null))switch(i){case"value":d=s;break;case"defaultValue":o=s;break;case"multiple":a=s;default:s!==c&&Ls(t,e,i,s,r,c)}e=o,n=a,r=f,d!=null?cw(t,!!n,d,!1):!!r!=!!n&&(e!=null?cw(t,!!n,e,!0):cw(t,!!n,n?[]:"",!1));return;case"textarea":f=d=null;for(o in n)if(i=n[o],n.hasOwnProperty(o)&&i!=null&&!r.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:Ls(t,e,o,null,r,i)}for(a in r)if(i=r[a],s=n[a],r.hasOwnProperty(a)&&(i!=null||s!=null))switch(a){case"value":d=i;break;case"defaultValue":f=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(jt(91));break;default:i!==s&&Ls(t,e,a,i,r,s)}fce(t,d,f);return;case"option":for(var p in n)if(d=n[p],n.hasOwnProperty(p)&&d!=null&&!r.hasOwnProperty(p))switch(p){case"selected":t.selected=!1;break;default:Ls(t,e,p,null,r,d)}for(c in r)if(d=r[c],f=n[c],r.hasOwnProperty(c)&&d!==f&&(d!=null||f!=null))switch(c){case"selected":t.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:Ls(t,e,c,d,r,f)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)d=n[g],n.hasOwnProperty(g)&&d!=null&&!r.hasOwnProperty(g)&&Ls(t,e,g,null,r,d);for(l in r)if(d=r[l],f=n[l],r.hasOwnProperty(l)&&d!==f&&(d!=null||f!=null))switch(l){case"children":case"dangerouslySetInnerHTML":if(d!=null)throw Error(jt(137,e));break;default:Ls(t,e,l,d,r,f)}return;default:if(g$(e)){for(var _ in n)d=n[_],n.hasOwnProperty(_)&&d!==void 0&&!r.hasOwnProperty(_)&&F5(t,e,_,void 0,r,d);for(u in r)d=r[u],f=n[u],!r.hasOwnProperty(u)||d===f||d===void 0&&f===void 0||F5(t,e,u,d,r,f);return}}for(var v in n)d=n[v],n.hasOwnProperty(v)&&d!=null&&!r.hasOwnProperty(v)&&Ls(t,e,v,null,r,d);for(h in r)d=r[h],f=n[h],!r.hasOwnProperty(h)||d===f||d==null&&f==null||Ls(t,e,h,d,r,f)}var z5=null,H5=null;function u2(t){return t.nodeType===9?t:t.ownerDocument}function fZ(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function gue(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function j5(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var V8=null;function ike(){var t=window.event;return t&&t.type==="popstate"?t===V8?!1:(V8=t,!0):(V8=null,!1)}var vue=typeof setTimeout=="function"?setTimeout:void 0,ske=typeof clearTimeout=="function"?clearTimeout:void 0,pZ=typeof Promise=="function"?Promise:void 0,ake=typeof queueMicrotask=="function"?queueMicrotask:typeof pZ<"u"?function(t){return pZ.resolve(null).then(t).catch(oke)}:vue;function oke(t){setTimeout(function(){throw t})}function $b(t){return t==="head"}function mZ(t,e){var n=e,r=0,i=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(0<r&&8>r){n=r;var a=t.ownerDocument;if(n&1&&QA(a.documentElement),n&2&&QA(a.body),n&4)for(n=a.head,QA(n),a=n.firstChild;a;){var o=a.nextSibling,c=a.nodeName;a[pN]||c==="SCRIPT"||c==="STYLE"||c==="LINK"&&a.rel.toLowerCase()==="stylesheet"||n.removeChild(a),a=o}}if(i===0){t.removeChild(s),YM(e);return}i--}else n==="$"||n==="$?"||n==="$!"?i++:r=n.charCodeAt(0)-48;else r=0;n=s}while(n);YM(e)}function V5(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":V5(n),m$(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function cke(t,e,n,r){for(;t.nodeType===1;){var i=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!r&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(r){if(!t[pN])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(s=t.getAttribute("rel"),s==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(s!==i.rel||t.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||t.getAttribute("title")!==(i.title==null?null:i.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(s=t.getAttribute("src"),(s!==(i.src==null?null:i.src)||t.getAttribute("type")!==(i.type==null?null:i.type)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&s&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var s=i.name==null?null:""+i.name;if(i.type==="hidden"&&t.getAttribute("name")===s)return t}else return t;if(t=tm(t.nextSibling),t===null)break}return null}function lke(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=tm(t.nextSibling),t===null))return null;return t}function G5(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState==="complete"}function uke(t,e){var n=t.ownerDocument;if(t.data!=="$?"||n.readyState==="complete")e();else{var r=function(){e(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),t._reactRetry=r}}function tm(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="F!"||e==="F")break;if(e==="/$")return null}}return t}var q5=null;function gZ(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}function yue(t,e,n){switch(e=u2(n),t){case"html":if(t=e.documentElement,!t)throw Error(jt(452));return t;case"head":if(t=e.head,!t)throw Error(jt(453));return t;case"body":if(t=e.body,!t)throw Error(jt(454));return t;default:throw Error(jt(451))}}function QA(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);m$(t)}var ip=new Map,vZ=new Set;function h2(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var py=gs.d;gs.d={f:hke,r:dke,D:fke,C:pke,L:mke,m:gke,X:yke,S:vke,M:_ke};function hke(){var t=py.f(),e=j3();return t||e}function dke(t){var e=VC(t);e!==null&&e.tag===5&&e.type==="form"?hle(e):py.r(t)}var $C=typeof document>"u"?null:document;function _ue(t,e,n){var r=$C;if(r&&typeof e=="string"&&e){var i=Ff(e);i='link[rel="'+t+'"][href="'+i+'"]',typeof n=="string"&&(i+='[crossorigin="'+n+'"]'),vZ.has(i)||(vZ.add(i),t={rel:t,crossOrigin:n,href:e},r.querySelector(i)===null&&(e=r.createElement("link"),Pl(e,"link",t),ol(e),r.head.appendChild(e)))}}function fke(t){py.D(t),_ue("dns-prefetch",t,null)}function pke(t,e){py.C(t,e),_ue("preconnect",t,e)}function mke(t,e,n){py.L(t,e,n);var r=$C;if(r&&t&&e){var i='link[rel="preload"][as="'+Ff(e)+'"]';e==="image"&&n&&n.imageSrcSet?(i+='[imagesrcset="'+Ff(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(i+='[imagesizes="'+Ff(n.imageSizes)+'"]')):i+='[href="'+Ff(t)+'"]';var s=i;switch(e){case"style":s=nC(t);break;case"script":s=WC(t)}ip.has(s)||(t=Sa({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),ip.set(s,t),r.querySelector(i)!==null||e==="style"&&r.querySelector(xN(s))||e==="script"&&r.querySelector(wN(s))||(e=r.createElement("link"),Pl(e,"link",t),ol(e),r.head.appendChild(e)))}}function gke(t,e){py.m(t,e);var n=$C;if(n&&t){var r=e&&typeof e.as=="string"?e.as:"script",i='link[rel="modulepreload"][as="'+Ff(r)+'"][href="'+Ff(t)+'"]',s=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=WC(t)}if(!ip.has(s)&&(t=Sa({rel:"modulepreload",href:t},e),ip.set(s,t),n.querySelector(i)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(wN(s)))return}r=n.createElement("link"),Pl(r,"link",t),ol(r),n.head.appendChild(r)}}}function vke(t,e,n){py.S(t,e,n);var r=$C;if(r&&t){var i=ow(r).hoistableStyles,s=nC(t);e=e||"default";var a=i.get(s);if(!a){var o={loading:0,preload:null};if(a=r.querySelector(xN(s)))o.loading=5;else{t=Sa({rel:"stylesheet",href:t,"data-precedence":e},n),(n=ip.get(s))&&Z$(t,n);var c=a=r.createElement("link");ol(c),Pl(c,"link",t),c._p=new Promise(function(l,u){c.onload=l,c.onerror=u}),c.addEventListener("load",function(){o.loading|=1}),c.addEventListener("error",function(){o.loading|=2}),o.loading|=4,QD(a,e,r)}a={type:"stylesheet",instance:a,count:1,state:o},i.set(s,a)}}}function yke(t,e){py.X(t,e);var n=$C;if(n&&t){var r=ow(n).hoistableScripts,i=WC(t),s=r.get(i);s||(s=n.querySelector(wN(i)),s||(t=Sa({src:t,async:!0},e),(e=ip.get(i))&&Q$(t,e),s=n.createElement("script"),ol(s),Pl(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(i,s))}}function _ke(t,e){py.M(t,e);var n=$C;if(n&&t){var r=ow(n).hoistableScripts,i=WC(t),s=r.get(i);s||(s=n.querySelector(wN(i)),s||(t=Sa({src:t,async:!0,type:"module"},e),(e=ip.get(i))&&Q$(t,e),s=n.createElement("script"),ol(s),Pl(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},r.set(i,s))}}function yZ(t,e,n,r){var i=(i=Q_.current)?h2(i):null;if(!i)throw Error(jt(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=nC(n.href),n=ow(i).hoistableStyles,r=n.get(e),r||(r={type:"style",instance:null,count:0,state:null},n.set(e,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=nC(n.href);var s=ow(i).hoistableStyles,a=s.get(t);if(a||(i=i.ownerDocument||i,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(t,a),(s=i.querySelector(xN(t)))&&!s._p&&(a.instance=s,a.state.loading=5),ip.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},ip.set(t,n),s||bke(i,t,n,a.state))),e&&r===null)throw Error(jt(528,""));return a}if(e&&r!==null)throw Error(jt(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=WC(n),n=ow(i).hoistableScripts,r=n.get(e),r||(r={type:"script",instance:null,count:0,state:null},n.set(e,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(jt(444,t))}}function nC(t){return'href="'+Ff(t)+'"'}function xN(t){return'link[rel="stylesheet"]['+t+"]"}function bue(t){return Sa({},t,{"data-precedence":t.precedence,precedence:null})}function bke(t,e,n,r){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?r.loading=1:(e=t.createElement("link"),r.preload=e,e.addEventListener("load",function(){return r.loading|=1}),e.addEventListener("error",function(){return r.loading|=2}),Pl(e,"link",n),ol(e),t.head.appendChild(e))}function WC(t){return'[src="'+Ff(t)+'"]'}function wN(t){return"script[async]"+t}function _Z(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var r=t.querySelector('style[data-href~="'+Ff(n.href)+'"]');if(r)return e.instance=r,ol(r),r;var i=Sa({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return r=(t.ownerDocument||t).createElement("style"),ol(r),Pl(r,"style",i),QD(r,n.precedence,t),e.instance=r;case"stylesheet":i=nC(n.href);var s=t.querySelector(xN(i));if(s)return e.state.loading|=4,e.instance=s,ol(s),s;r=bue(n),(i=ip.get(i))&&Z$(r,i),s=(t.ownerDocument||t).createElement("link"),ol(s);var a=s;return a._p=new Promise(function(o,c){a.onload=o,a.onerror=c}),Pl(s,"link",r),e.state.loading|=4,QD(s,n.precedence,t),e.instance=s;case"script":return s=WC(n.src),(i=t.querySelector(wN(s)))?(e.instance=i,ol(i),i):(r=n,(i=ip.get(s))&&(r=Sa({},n),Q$(r,i)),t=t.ownerDocument||t,i=t.createElement("script"),ol(i),Pl(i,"link",r),t.head.appendChild(i),e.instance=i);case"void":return null;default:throw Error(jt(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(r=e.instance,e.state.loading|=4,QD(r,n.precedence,t));return e.instance}function QD(t,e,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,s=i,a=0;a<r.length;a++){var o=r[a];if(o.dataset.precedence===e)s=o;else if(s!==i)break}s?s.parentNode.insertBefore(t,s.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function Z$(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function Q$(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var eP=null;function bZ(t,e,n){if(eP===null){var r=new Map,i=eP=new Map;i.set(n,r)}else i=eP,r=i.get(n),r||(r=new Map,i.set(n,r));if(r.has(t))return r;for(r.set(t,null),n=n.getElementsByTagName(t),i=0;i<n.length;i++){var s=n[i];if(!(s[pN]||s[su]||t==="link"&&s.getAttribute("rel")==="stylesheet")&&s.namespaceURI!=="http://www.w3.org/2000/svg"){var a=s.getAttribute(e)||"";a=t+a;var o=r.get(a);o?o.push(s):r.set(a,[s])}}return r}function EZ(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function Eke(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function Eue(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}var GM=null;function Ske(){}function Tke(t,e,n){if(GM===null)throw Error(jt(475));var r=GM;if(e.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&!(e.state.loading&4)){if(e.instance===null){var i=nC(n.href),s=t.querySelector(xN(i));if(s){t=s._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(r.count++,r=d2.bind(r),t.then(r,r)),e.state.loading|=4,e.instance=s,ol(s);return}s=t.ownerDocument||t,n=bue(n),(i=ip.get(i))&&Z$(n,i),s=s.createElement("link"),ol(s);var a=s;a._p=new Promise(function(o,c){a.onload=o,a.onerror=c}),Pl(s,"link",n),e.instance=s}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(e,t),(t=e.state.preload)&&!(e.state.loading&3)&&(r.count++,e=d2.bind(r),t.addEventListener("load",e),t.addEventListener("error",e))}}function xke(){if(GM===null)throw Error(jt(475));var t=GM;return t.stylesheets&&t.count===0&&$5(t,t.stylesheets),0<t.count?function(e){var n=setTimeout(function(){if(t.stylesheets&&$5(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4);return t.unsuspend=e,function(){t.unsuspend=null,clearTimeout(n)}}:null}function d2(){if(this.count--,this.count===0){if(this.stylesheets)$5(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var f2=null;function $5(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,f2=new Map,e.forEach(wke,t),f2=null,d2.call(t))}function wke(t,e){if(!(e.state.loading&4)){var n=f2.get(t);if(n)var r=n.get(null);else{n=new Map,f2.set(t,n);for(var i=t.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<i.length;s++){var a=i[s];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(n.set(a.dataset.precedence,a),r=a)}r&&n.set(null,r)}i=e.instance,a=i.getAttribute("data-precedence"),s=n.get(a)||r,s===r&&n.set(null,i),n.set(a,i),this.count++,r=d2.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),s?s.parentNode.insertBefore(i,s.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(i,t.firstChild)),e.state.loading|=4}}var qM={$$typeof:kv,Provider:null,Consumer:null,_currentValue:jS,_currentValue2:jS,_threadCount:0};function Cke(t,e,n,r,i,s,a,o){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=h8(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=h8(0),this.hiddenUpdates=h8(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=s,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Sue(t,e,n,r,i,s,a,o,c,l,u,h){return t=new Cke(t,e,n,a,o,c,l,h),e=1,s===!0&&(e|=24),s=zd(3,null,null,e),t.current=s,s.stateNode=t,e=R$(),e.refCount++,t.pooledCache=e,e.refCount++,s.memoizedState={element:r,isDehydrated:n,cache:e},M$(s),t}function Tue(t){return t?(t=V1,t):V1}function xue(t,e,n,r,i,s){i=Tue(i),r.context===null?r.context=i:r.pendingContext=i,r=eb(e),r.payload={element:n},s=s===void 0?null:s,s!==null&&(r.callback=s),n=tb(t,r,e),n!==null&&(Yd(n,t,e),qA(n,t,e))}function SZ(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function e7(t,e){SZ(t,e),(t=t.alternate)&&SZ(t,e)}function wue(t){if(t.tag===13){var e=GC(t,67108864);e!==null&&Yd(e,t,67108864),e7(t,67108864)}}var p2=!0;function Rke(t,e,n,r){var i=Ur.T;Ur.T=null;var s=gs.p;try{gs.p=2,t7(t,e,n,r)}finally{gs.p=s,Ur.T=i}}function Ake(t,e,n,r){var i=Ur.T;Ur.T=null;var s=gs.p;try{gs.p=8,t7(t,e,n,r)}finally{gs.p=s,Ur.T=i}}function t7(t,e,n,r){if(p2){var i=W5(r);if(i===null)j8(t,e,r,m2,n),TZ(t,r);else if(Oke(i,t,e,n,r))r.stopPropagation();else if(TZ(t,r),e&4&&-1<Mke.indexOf(t)){for(;i!==null;){var s=VC(i);if(s!==null)switch(s.tag){case 3:if(s=s.stateNode,s.current.memoizedState.isDehydrated){var a=vS(s.pendingLanes);if(a!==0){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var c=1<<31-$d(a);o.entanglements[1]|=c,a&=~c}Zg(s),!(Rs&6)&&(s2=Cg()+500,TN(0))}}break;case 13:o=GC(s,2),o!==null&&Yd(o,s,2),j3(),e7(s,2)}if(s=W5(r),s===null&&j8(t,e,r,m2,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else j8(t,e,r,null,n)}}function W5(t){return t=v$(t),n7(t)}var m2=null;function n7(t){if(m2=null,t=U1(t),t!==null){var e=uN(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=Koe(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return m2=t,null}function Cue(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pNe()){case ece:return 2;case tce:return 8;case VL:case mNe:return 32;case nce:return 268435456;default:return 32}default:return 32}}var Y5=!1,ib=null,sb=null,ab=null,$M=new Map,WM=new Map,V_=[],Mke="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function TZ(t,e){switch(t){case"focusin":case"focusout":ib=null;break;case"dragenter":case"dragleave":sb=null;break;case"mouseover":case"mouseout":ab=null;break;case"pointerover":case"pointerout":$M.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":WM.delete(e.pointerId)}}function WR(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=VC(e),e!==null&&wue(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Oke(t,e,n,r,i){switch(e){case"focusin":return ib=WR(ib,t,e,n,r,i),!0;case"dragenter":return sb=WR(sb,t,e,n,r,i),!0;case"mouseover":return ab=WR(ab,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return $M.set(s,WR($M.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,WM.set(s,WR(WM.get(s)||null,t,e,n,r,i)),!0}return!1}function Rue(t){var e=U1(t.target);if(e!==null){var n=uN(e);if(n!==null){if(e=n.tag,e===13){if(e=Koe(n),e!==null){t.blockedOn=e,TNe(t.priority,function(){if(n.tag===13){var r=Wd();r=f$(r);var i=GC(n,r);i!==null&&Yd(i,n,r),e7(n,r)}});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function tP(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=W5(t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);h5=r,n.target.dispatchEvent(r),h5=null}else return e=VC(n),e!==null&&wue(e),t.blockedOn=n,!1;e.shift()}return!0}function xZ(t,e,n){tP(t)&&n.delete(e)}function Nke(){Y5=!1,ib!==null&&tP(ib)&&(ib=null),sb!==null&&tP(sb)&&(sb=null),ab!==null&&tP(ab)&&(ab=null),$M.forEach(xZ),WM.forEach(xZ)}function qk(t,e){t.blockedOn===e&&(t.blockedOn=null,Y5||(Y5=!0,Hc.unstable_scheduleCallback(Hc.unstable_NormalPriority,Nke)))}var $k=null;function wZ(t){$k!==t&&($k=t,Hc.unstable_scheduleCallback(Hc.unstable_NormalPriority,function(){$k===t&&($k=null);for(var e=0;e<t.length;e+=3){var n=t[e],r=t[e+1],i=t[e+2];if(typeof r!="function"){if(n7(r||n)===null)continue;break}var s=VC(n);s!==null&&(t.splice(e,3),e-=3,R5(s,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function YM(t){function e(c){return qk(c,t)}ib!==null&&qk(ib,t),sb!==null&&qk(sb,t),ab!==null&&qk(ab,t),$M.forEach(e),WM.forEach(e);for(var n=0;n<V_.length;n++){var r=V_[n];r.blockedOn===t&&(r.blockedOn=null)}for(;0<V_.length&&(n=V_[0],n.blockedOn===null);)Rue(n),n.blockedOn===null&&V_.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(r=0;r<n.length;r+=3){var i=n[r],s=n[r+1],a=i[Kh]||null;if(typeof s=="function")a||wZ(n);else if(a){var o=null;if(s&&s.hasAttribute("formAction")){if(i=s,a=s[Kh]||null)o=a.formAction;else if(n7(i)!==null)continue}else o=a.action;typeof o=="function"?n[r+1]=o:(n.splice(r,3),r-=3),wZ(n)}}}function r7(t){this._internalRoot=t}$3.prototype.render=r7.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(jt(409));var n=e.current,r=Wd();xue(n,r,t,e,null,null)};$3.prototype.unmount=r7.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;xue(t.current,2,null,t,null,null),j3(),e[jC]=null}};function $3(t){this._internalRoot=t}$3.prototype.unstable_scheduleHydration=function(t){if(t){var e=oce();t={blockedOn:null,target:t,priority:e};for(var n=0;n<V_.length&&e!==0&&e<V_[n].priority;n++);V_.splice(n,0,t),n===0&&Rue(t)}};var CZ=Yoe.version;if(CZ!=="19.1.0")throw Error(jt(527,CZ,"19.1.0"));gs.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(jt(188)):(t=Object.keys(t).join(","),Error(jt(268,t)));return t=oNe(e),t=t!==null?Joe(t):null,t=t===null?null:t.stateNode,t};var Ike={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Ur,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wk=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wk.isDisabled&&Wk.supportsFiber)try{hN=Wk.inject(Ike),qd=Wk}catch{}}O3.createRoot=function(t,e){if(!Xoe(t))throw Error(jt(299));var n=!1,r="",i=Sle,s=Tle,a=xle,o=null;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onUncaughtError!==void 0&&(i=e.onUncaughtError),e.onCaughtError!==void 0&&(s=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError),e.unstable_transitionCallbacks!==void 0&&(o=e.unstable_transitionCallbacks)),e=Sue(t,1,!1,null,null,n,r,i,s,a,o,null),t[jC]=e.current,J$(t),new r7(e)};O3.hydrateRoot=function(t,e,n){if(!Xoe(t))throw Error(jt(299));var r=!1,i="",s=Sle,a=Tle,o=xle,c=null,l=null;return n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onUncaughtError!==void 0&&(s=n.onUncaughtError),n.onCaughtError!==void 0&&(a=n.onCaughtError),n.onRecoverableError!==void 0&&(o=n.onRecoverableError),n.unstable_transitionCallbacks!==void 0&&(c=n.unstable_transitionCallbacks),n.formState!==void 0&&(l=n.formState)),e=Sue(t,1,!0,e,n??null,r,i,s,a,o,c,l),e.context=Tue(null),n=e.current,r=Wd(),r=f$(r),i=eb(r),i.callback=null,tb(n,i,r),n=r,e.current.lanes=n,fN(e,n),Zg(e),t[jC]=e.current,J$(t),new $3(e)};O3.version="19.1.0";function Aue(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Aue)}catch(t){console.error(t)}}Aue(),joe.exports=O3;var kke=joe.exports;/*! unmute-ios-audio. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Dke=Pke;const RZ=["auxclick","click","contextmenu","dblclick","keydown","keyup","mousedown","mouseup","touchend"];function Pke(){const t=window.webkitAudioContext;if(!(navigator.maxTouchPoints>0&&t!=null))return;let n="blocked",r="blocked",i,s,a;const o=new t().sampleRate,c=l(o);RZ.forEach(p=>{window.addEventListener(p,u,{capture:!0,passive:!0})});function l(p){const g=new ArrayBuffer(10),_=new DataView(g);return _.setUint32(0,p,!0),_.setUint32(4,p,!0),_.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array(g))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}function u(p){n==="blocked"&&(n="pending",h()),r==="blocked"&&(r="pending",d())}function h(){i=document.createElement("audio"),i.setAttribute("x-webkit-airplay","deny"),i.preload="auto",i.loop=!0,i.src=c,i.load(),i.play().then(()=>{n="allowed",f()},()=>{n="blocked",i.pause(),i.removeAttribute("src"),i.load(),i=null})}function d(){s=new t,a=s.createBufferSource(),a.buffer=s.createBuffer(1,1,22050),a.connect(s.destination),a.start(),s.state==="running"?(r="allowed",f()):(r="blocked",a.disconnect(s.destination),a=null,s.close(),s=null)}function f(){n!=="allowed"||r!=="allowed"||RZ.forEach(p=>{window.removeEventListener(p,u,{capture:!0,passive:!0})})}}const Lke=qc(Dke);var Mue={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ll,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,a=0,o=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),a=l(" "),o=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),a-=l(i[u]),a<0&&(a+=1),o-=l(i[u]),o<0&&(o+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=a,a=o,o=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,a,o,c]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){i+=a.charCodeAt(o);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Mue);var Uke=Mue.exports;const i7=qc(Uke);new Rt;new Rt;function Ei(t,e,n){return Math.max(e,Math.min(n,t))}function Bke(t,e){return Ei(t-Math.floor(t/e)*e,0,e)}function Fke(t,e){var n=Bke(e-t,Math.PI*2);return n>Math.PI&&(n-=Math.PI*2),n}function Oue(t){return t/180*Math.PI}function Nue(t){return t*180/Math.PI}const zke=i7("089fad0j9awfem09wavefc09uwaef");function AZ(t){return 2*Math.floor(t/2)}function W3(t,e){return Math.round(t/e)*e}function Hke(){return zke()}function jke(t){return i7(t)()}function Hf(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(Hke()*i)}function Iue(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(jke(t)*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Vke=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gke=Object.prototype.hasOwnProperty;function X5(t,e){return Gke.call(t,e)}function K5(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)X5(t,i)&&r.push(i);return r}function zh(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function J5(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function bS(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function kue(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Z5(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Z5(t[e]))return!0}else if(typeof t=="object"){for(var r=K5(t),i=r.length,s=0;s<i;s++)if(Z5(t[r[s]]))return!0}}return!1}function MZ(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Due=function(t){Vke(e,t);function e(n,r,i,s,a){var o=this.constructor,c=t.call(this,MZ(n,{name:r,index:i,operation:s,tree:a}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=a,Object.setPrototypeOf(c,o.prototype),c.message=MZ(n,{name:r,index:i,operation:s,tree:a}),c}return e}(Error),mo=Due,qke=zh,W1={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=g2(n,this.path);r&&(r=zh(r));var i=XS(n,{op:"remove",path:this.from}).removed;return XS(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=g2(n,this.from);return XS(n,{op:"add",path:this.path,value:zh(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:XM(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},$ke={add:function(t,e,n){return J5(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:W1.move,copy:W1.copy,test:W1.test,_get:W1._get};function g2(t,e){if(e=="")return t;var n={op:"_get",path:e};return XS(t,n),n.value}function XS(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):v2(e,0)),e.path===""){var a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=g2(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=XM(t,e.value),a.test===!1)throw new mo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(n)throw new mo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return a}}else{r||(t=zh(t));var o=e.path||"",c=o.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=v2;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=kue(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!J5(f))throw new mo("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);J5(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new mo("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var a=$ke[e.op].call(e,l,f,t);if(a.test===!1)throw new mo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return a}}else if(u>=h){var a=W1[e.op].call(e,l,f,t);if(a.test===!1)throw new mo("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return a}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new mo("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Y3(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new mo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=zh(t));for(var s=new Array(e.length),a=0,o=e.length;a<o;a++)s[a]=XS(t,e[a],n,!0,i,a),t=s[a].newDocument;return s.newDocument=t,s}function Wke(t,e,n){var r=XS(t,e);if(r.test===!1)throw new mo("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function v2(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new mo("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(W1[t.op]){if(typeof t.path!="string")throw new mo("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new mo('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new mo("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new mo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Z5(t.value))throw new mo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new mo("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new mo("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},o=s7([a],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new mo("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new mo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function s7(t,e,n){try{if(!Array.isArray(t))throw new mo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Y3(zh(e),zh(t),n||!0);else{n=n||v2;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof mo)return i;throw i}}function XM(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,a;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!XM(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!XM(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}const Yke=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:mo,_areEquals:XM,applyOperation:XS,applyPatch:Y3,applyReducer:Wke,deepClone:qke,getValueByPointer:g2,validate:s7,validator:v2},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var a7=new WeakMap,Xke=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),Kke=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function Jke(t){return a7.get(t)}function Zke(t,e){return t.observers.get(e)}function Qke(t,e){t.observers.delete(e.callback)}function eDe(t,e){e.unobserve()}function tDe(t,e){var n=[],r,i=Jke(t);if(!i)i=new Xke(t),a7.set(t,i);else{var s=Zke(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=zh(t),e){r.callback=e,r.next=null;var a=function(){Q5(r)},o=function(){clearTimeout(r.next),r.next=setTimeout(a)};typeof window<"u"&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return r.patches=n,r.object=t,r.unobserve=function(){Q5(r),clearTimeout(r.next),Qke(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},i.observers.set(e,new Kke(e,r)),r}function Q5(t,e){e===void 0&&(e=!1);var n=a7.get(t.object);o7(n.value,t.object,t.patches,"",e),t.patches.length&&Y3(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function o7(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=K5(e),a=K5(t),o=!1,c=a.length-1;c>=0;c--){var l=a[c],u=t[l];if(X5(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?o7(u,h,n,r+"/"+bS(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+bS(l),value:zh(u)}),n.push({op:"replace",path:r+"/"+bS(l),value:zh(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+bS(l),value:zh(u)}),n.push({op:"remove",path:r+"/"+bS(l)}),o=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!o&&s.length==a.length))for(var c=0;c<s.length;c++){var l=s[c];!X5(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+bS(l),value:zh(e[l])})}}}function nDe(t,e,n){n===void 0&&(n=!1);var r=[];return o7(t,e,r,"",n),r}const rDe=Object.freeze(Object.defineProperty({__proto__:null,compare:nDe,generate:Q5,observe:tDe,unobserve:eDe},Symbol.toStringTag,{value:"Module"}));Object.assign({},Yke,rDe,{JsonPatchError:Due,deepClone:zh,escapePathComponent:bS,unescapePathComponent:kue});var iDe=typeof Element<"u",sDe=typeof Map=="function",aDe=typeof Set=="function",oDe=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function nP(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!nP(t[r],e[r]))return!1;return!0}var s;if(sDe&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!nP(r.value[1],e.get(r.value[0])))return!1;return!0}if(aDe&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(oDe&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(iDe&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!nP(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var cDe=function(e,n){try{return nP(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const Y1=qc(cDe);function ae(t){return t!=null}const lDe=Object.fromEntries,X3=Object.keys;function cl(t){return zh(t)}function uDe(t){return typeof t=="boolean"}function pn(t){return typeof t=="number"&&isNaN(t)===!1}function On(t){return typeof t=="string"}function Lr(t){return Array.isArray(t)}function Vu(t){return t}function hDe(t){return typeof t=="object"&&On(t.session)&&On(t.player)&&On(t.id)&&On(t.sender)&&On(t.target)}function Hr(t,e,n,...r){return t.emit(e,"error",[`$red${n}$blue>>`,...r]),!1}function Fg(t,e,...n){return t.emit(e,"info",n),!0}function dDe(t,e,...n){return t.emit(e,"debug",n),!0}function fDe(t,e,n){t.emit(e,"toast",n)}function pDe(t,e,n){t.emit(e,"bridge:streamstart",n)}function mDe(t,e){t.emit(e,"bridge:streamstop",void 0)}function gDe(t,e,n){t.emit(e,"bridge:chatstart",n)}function vDe(t,e){t.emit(e,"bridge:chatstop")}function yDe(t,e,n,r,i,s,a){t.emit(e,"bridge:fetch",[n,r,i,s,a])}function _De(t,e){t.emit(e,"bridge:talkstart",e)}function bDe(t,e){t.emit(e,"bridge:talkstop",e)}function EDe(t,e){t.emit(e,"bridge:mediastart",e)}function SDe(t,e){t.emit(e,"bridge:mediastop",e)}function TDe(t,e,n){t.emit(e,"bridge:join",n)}function xDe(t,e,n){t.emit(e,"bridge:start",n)}function wDe(t,e,n){t.emit(e,"bridge:tab",n)}function CDe(t,e,n){t.emit(e,"bridge:tabopen",n)}function RDe(t,e,n,r){t.emit(e,"bridge:showjoincode",[n,r])}function ADe(t,e){t.emit(e,"gadgetserver:desync")}function MDe(t,e){t.emit(e,"gadgetserver:clearscroll")}function OZ(t,e,n,r){t.emit(e,"register:downloadjsonfile",[n,r])}function ODe(t,e){t.emit(e,"register:dev",void 0)}function NDe(t,e){t.emit(e,"register:share",void 0)}function IDe(t,e){t.emit(e,"register:nuke",void 0)}function kDe(t,e){t.emit(e,"synth:audioenabled",void 0)}function DDe(t,e,n,r){t.emit(e,"synth:tts",[n,r])}function PDe(t,e,n){t.emit(e,"synth:tta",[n])}function S_(t,e,n,r,i){t.emit(e,"synth:play",[n,r,i])}function LDe(t,e,n){t.emit(e,"synth:bpm",n)}function UDe(t,e,n){t.emit(e,"synth:playvolume",n)}function BDe(t,e,n){t.emit(e,"synth:bgplayvolume",n)}function FDe(t,e,n){t.emit(e,"synth:ttsvolume",n)}function G8(t,e,n,r,i){t.emit(e,"synth:voice",[n,r,i])}function Pue(t,e,n,r,i,s){t.emit(e,"synth:voicefx",[n,r,i,s])}function zDe(t,e){t.emit(e,"register:inspector")}function HDe(t,e){t.emit(e,"register:terminal:open")}function jDe(t,e){t.emit(e,"register:terminal:quickopen")}function y2(t,e){t.emit(e,"register:terminal:close")}function VDe(t,e){t.emit(e,"register:terminal:toggle")}function Lue(t,e,n){t.emit(e,"register:terminal:inclayout",n)}function c7(t,e){t.emit(e,"register:terminal:full")}function GDe(t,e,n,r,i,s,a){t.emit(e,"register:editor:open",[n,r,i,s,a])}function qDe(t,e){t.emit(e,"register:editor:close")}function $De(t,e){t.emit(e,"vm:operator")}function WDe(t,e){t.emit(e,"vm:zsswords")}function YDe(t,e,n){t.emit(e,"vm:halt",n)}function XDe(t,e,n,r){t.emit(e,"vm:books",[n,r])}function KDe(t,e){t.emit(e,"vm:search")}function JDe(t,e){t.emit(e,"vm:login")}function ZDe(t,e){t.emit(e,"vm:logout")}function QDe(t,e){t.emit(e,"vm:doot")}function ePe(t,e,n,r){t.emit(e,"vm:input",[n,r])}function tPe(t,e,n){t.emit(e,"vm:copyjsonfile",n)}function nPe(t,e,n){t.emit(e,"vm:refsheet",n)}function rPe(t,e,n,r){t.emit(e,"vm:inspect",[n,r])}function Uue(t,e){const[n,r]=e;return`${t}:${[n,r].filter(ae).join(":")}`}function iPe(t,e,n,r){t.emit(e,"vm:codewatch",[n,r])}function sPe(t,e,n,r){t.emit(e,"vm:coderelease",[n,r])}function Bv(t,e,n){t.emit(e,"vm:cli",n)}function aPe(t,e){t.emit(e,"vm:clirepeatlast")}function oPe(t,e){t.emit(e,"vm:restart")}function cPe(t,e,n){t.emit(e,"vm:synthsend",n)}function lPe(t,e){t.emit(e,"vm:flush")}function uPe(t,e){t.emit(e,"vm:fork")}function hPe(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function dPe(t,e){return{filename:t,json:e}}function fPe(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function Ag(t,e,n,r,i,s){let a;switch(r){case"file":a=s;break;case"text":a=hPe(i,s);break;case"json":a=dPe(i,s);break;case"binary":a=fPe(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[n,r,i,a])},1)}function l7(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function pPe(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=l7(n);return(i,s)=>r.then(a=>s(a.transaction(e,i).objectStore(e)))}let q8;function Bue(){return q8||(q8=pPe("keyval-store","keyval")),q8}function mPe(t,e=Bue()){return e("readonly",n=>l7(n.get(t)))}function gPe(t,e,n=Bue()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(l7(r.transaction))}catch(a){s(a)}}}))}const $8=new Set,KM={emit(t,e,n,r,i){KM.invoke(DPe(t,e,n,r,i))},invoke(t){$8.forEach(e=>e.handle(t))},connect(t){$8.add(t)},disconnect(t){$8.delete(t)}};var Fue={};(function(t){var e=Ll&&Ll.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,g=p===void 0?1:p,_=l.addAdverb,v=_===void 0?!1:_,E=e(e(e([],e([],Array(g),!0).map(function(T){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),v?[n(t.adverbs)]:[],!0);return f&&(E=E.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),E.join(h)}t.humanId=s;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=a;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,g=p===void 0?"":p;return r(t.adjectives).length*h+h*g.length+r(t.nouns).length+g.length+r(t.verbs).length+(f?r(t.adverbs).length+g.length:0)}t.maxLength=o;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,g=p===void 0?"":p;return i(t.adjectives).length*h+h*g.length+i(t.nouns).length+g.length+i(t.verbs).length+(f?i(t.adverbs).length+g.length:0)}t.minLength=c,t.default=s})(Fue);const zue=qc(Fue),vPe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let yPe=t=>crypto.getRandomValues(new Uint8Array(t)),_Pe=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let a="";for(;;){let o=n(i),c=i;for(;c--;)if(a+=t[o[c]&r]||"",a.length===s)return a}}},Hue=(t,e=21)=>_Pe(t,e,yPe),bPe=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=vPe[n[t]&63];return e};var jue="abcdefghijklmnopqrstuvwxyz",Vue="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Gue="0123456789",EPe="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",SPe="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const TPe=Gue,xPe=jue,wPe=Vue;var CPe=TPe+xPe+wPe,eV={lowercase:jue,uppercase:Vue,numbers:Gue,nolookalikes:EPe,nolookalikesSafe:SPe,alphanumeric:CPe};function Do(){return`sid_${bPe(12).replaceAll("-",".")}`}const RPe=Hue(eV.numbers,4),APe=Hue(`${eV.numbers}${eV.lowercase}`,16);function MPe(){return`pid_${RPe()}_${APe()}`}function ob(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function OPe(){return zue({capitalize:!1,adjectiveCount:1})}function NPe(){return zue({addAdverb:!1,capitalize:!1,adjectiveCount:0})}const IPe=20,NZ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function kPe(t){const e=i7(t),n=[];for(let r=0;r<IPe;++r)n.push(NZ[Math.floor(e()*NZ.length)]);return n.join("")}var Qt=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Qt||{}),bs=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(bs||{}),dT=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(dT||{}),rn=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.PLAYER=18]="PLAYER",t[t.FIND=19]="FIND",t[t.FLEE=20]="FLEE",t[t.TO=21]="TO",t))(rn||{}),cn=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.COPYIT=13]="COPYIT",t[t.OPENIT=14]="OPENIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(cn||{});function ar(t){return(t==null?void 0:t.toLowerCase().trim())??""}function DPe(t,e,n,r,i){return{session:t,player:e,id:Do(),sender:n,target:r,data:i}}function GT(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function Wb(t,e=[],n=Vu,r=""){const i=Do(),s=ar(t),a=e.map(ar);let o=r;const c={id(){return i},name(){return t},session(l){return ae(l)?l.session===o?l.session:"":o},topics(){return e},emit(l,u,h){KM.emit(o,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=GT(l.target),d=ar(u);!o&&d==="ready"&&(o=l.session),d==="bridge"&&ae(l.session)&&(o=l.session),a.findIndex(f=>f==="all"||f===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:h})}};return KM.connect(c),c}var RS=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(RS||{}),PPe=Object.defineProperty,LPe=(t,e,n)=>e in t?PPe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yk=(t,e,n)=>(LPe(t,typeof e!="symbol"?e+"":e,n),n);const UPe=[0,1],que=[1,0],$ue=[2,3],Wue=[3,2],BPe={L:UPe,M:que,Q:$ue,H:Wue},FPe=/^[0-9]*$/,zPe=/^[A-Z0-9 $%*+.\/:-]*$/,W8="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",u7=1,h7=40,IZ=3,HPe=3,Xk=40,jPe=10,Yue=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],Xue=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class VPe{constructor(e,n,r,i){if(this.version=e,this.ecc=n,Yk(this,"size"),Yk(this,"mask"),Yk(this,"modules",[]),Yk(this,"types",[]),e<u7||e>h7)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let o=0;o<this.size;o++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const a=this.addEccAndInterleave(r);if(this.drawCodewords(a),i===-1){let o=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<o&&(i=c,o=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,n){return e>=0&&e<this.size&&n>=0&&n<this.size&&this.modules[n][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,RS.Timing),this.setFunctionModule(r,6,r%2===0,RS.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),n=e.length;for(let r=0;r<n;r++)for(let i=0;i<n;i++)r===0&&i===0||r===0&&i===n-1||r===n-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const n=this.ecc[1]<<3|e;let r=n;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(n<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,fv(i,s));this.setFunctionModule(8,7,fv(i,6)),this.setFunctionModule(8,8,fv(i,7)),this.setFunctionModule(7,8,fv(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,fv(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,fv(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,fv(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const n=this.version<<12|e;for(let r=0;r<18;r++){const i=fv(n,r),s=this.size-11+r%3,a=Math.floor(r/3);this.setFunctionModule(s,a,i),this.setFunctionModule(a,s,i)}}drawFinderPattern(e,n){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),a=e+i,o=n+r;a>=0&&a<this.size&&o>=0&&o<this.size&&this.setFunctionModule(a,o,s!==2&&s!==4,RS.Position)}}drawAlignmentPattern(e,n){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,n+r,Math.max(Math.abs(i),Math.abs(r))!==1,RS.Alignment)}setFunctionModule(e,n,r,i=RS.Function){this.modules[n][e]=r,this.types[n][e]=i}addEccAndInterleave(e){const n=this.version,r=this.ecc;if(e.length!==rP(n,r))throw new RangeError("Invalid argument");const i=Xue[r[0]][n],s=Yue[r[0]][n],a=Math.floor(tV(n)/8),o=i-a%i,c=Math.floor(a/i),l=[],u=ZPe(s);for(let d=0,f=0;d<i;d++){const p=e.slice(f,f+c-s+(d<o?0:1));f+=p.length;const g=QPe(p,u);d<o&&p.push(0),l.push(p.concat(g))}const h=[];for(let d=0;d<l[0].length;d++)l.forEach((f,p)=>{(d!==c-s||p>=o)&&h.push(f[d])});return h}drawCodewords(e){if(e.length!==Math.floor(tV(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const a=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][a]&&n<e.length*8&&(this.modules[c][a]=fv(e[n>>>3],7-(n&7)),n++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let n=0;n<this.size;n++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+n)%2===0;break;case 1:i=n%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+n)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(n/2))%2===0;break;case 5:i=r*n%2+r*n%3===0;break;case 6:i=(r*n%2+r*n%3)%2===0;break;case 7:i=((r+n)%2+r*n%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[n][r]&&i&&(this.modules[n][r]=!this.modules[n][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let a=!1,o=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===a?(o++,o===5?e+=IZ:o>5&&e++):(this.finderPenaltyAddHistory(o,c),a||(e+=this.finderPenaltyCountPatterns(c)*Xk),a=this.modules[s][l],o=1);e+=this.finderPenaltyTerminateAndCount(a,o,c)*Xk}for(let s=0;s<this.size;s++){let a=!1,o=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===a?(o++,o===5?e+=IZ:o>5&&e++):(this.finderPenaltyAddHistory(o,c),a||(e+=this.finderPenaltyCountPatterns(c)*Xk),a=this.modules[l][s],o=1);e+=this.finderPenaltyTerminateAndCount(a,o,c)*Xk}for(let s=0;s<this.size-1;s++)for(let a=0;a<this.size-1;a++){const o=this.modules[s][a];o===this.modules[s][a+1]&&o===this.modules[s+1][a]&&o===this.modules[s+1][a+1]&&(e+=HPe)}let n=0;for(const s of this.modules)n=s.reduce((a,o)=>a+(o?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(n*20-r*10)/r)-1;return e+=i*jPe,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,n=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=n)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const n=e[1],r=n>0&&e[2]===n&&e[3]===n*3&&e[4]===n&&e[5]===n;return(r&&e[0]>=n*4&&e[6]>=n?1:0)+(r&&e[6]>=n*4&&e[0]>=n?1:0)}finderPenaltyTerminateAndCount(e,n,r){return e&&(this.finderPenaltyAddHistory(n,r),n=0),n+=this.size,this.finderPenaltyAddHistory(n,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,n){n[0]===0&&(e+=this.size),n.pop(),n.unshift(e)}}function Av(t,e,n){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)n.push(t>>>r&1)}function fv(t,e){return(t>>>e&1)!==0}class d7{constructor(e,n,r){if(this.mode=e,this.numChars=n,this.bitData=r,n<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const GPe=[1,10,12,14],qPe=[2,9,11,13],$Pe=[4,8,16,16];function Kue(t,e){return t[Math.floor((e+7)/17)+1]}function Jue(t){const e=[];for(const n of t)Av(n,8,e);return new d7($Pe,t.length,e)}function WPe(t){if(!Zue(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let n=0;n<t.length;){const r=Math.min(t.length-n,3);Av(Number.parseInt(t.substring(n,n+r),10),r*3+1,e),n+=r}return new d7(GPe,t.length,e)}function YPe(t){if(!Que(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let n;for(n=0;n+2<=t.length;n+=2){let r=W8.indexOf(t.charAt(n))*45;r+=W8.indexOf(t.charAt(n+1)),Av(r,11,e)}return n<t.length&&Av(W8.indexOf(t.charAt(n)),6,e),new d7(qPe,t.length,e)}function XPe(t){return t===""?[]:Zue(t)?[WPe(t)]:Que(t)?[YPe(t)]:[Jue(JPe(t))]}function Zue(t){return FPe.test(t)}function Que(t){return zPe.test(t)}function KPe(t,e){let n=0;for(const r of t){const i=Kue(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;n+=4+i+r.bitData.length}return n}function JPe(t){t=encodeURI(t);const e=[];for(let n=0;n<t.length;n++)t.charAt(n)!=="%"?e.push(t.charCodeAt(n)):(e.push(Number.parseInt(t.substring(n+1,n+3),16)),n+=2);return e}function tV(t){if(t<u7||t>h7)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const n=Math.floor(t/7)+2;e-=(25*n-10)*n-55,t>=7&&(e-=36)}return e}function rP(t,e){return Math.floor(tV(t)/8)-Yue[e[0]][t]*Xue[e[0]][t]}function ZPe(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<t-1;r++)e.push(0);e.push(1);let n=1;for(let r=0;r<t;r++){for(let i=0;i<e.length;i++)e[i]=nV(e[i],n),i+1<e.length&&(e[i]^=e[i+1]);n=nV(n,2)}return e}function QPe(t,e){const n=e.map(r=>0);for(const r of t){const i=r^n.shift();n.push(0),e.forEach((s,a)=>n[a]^=nV(s,i))}return n}function nV(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(e>>>r&1)*t;return n}function eLe(t,e,n=1,r=40,i=-1,s=!0){if(!(u7<=n&&n<=r&&r<=h7)||i<-1||i>7)throw new RangeError("Invalid value");let a,o;for(a=n;;a++){const h=rP(a,e)*8,d=KPe(t,a);if(d<=h){o=d;break}if(a>=r)throw new RangeError("Data too long")}for(const h of[que,$ue,Wue])s&&o<=rP(a,h)*8&&(e=h);const c=[];for(const h of t){Av(h.mode[0],4,c),Av(h.numChars,Kue(h.mode,a),c);for(const d of h.getData())c.push(d)}const l=rP(a,e)*8;Av(0,Math.min(4,l-c.length),c),Av(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)Av(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,d)=>u[d>>>3]|=h<<7-(d&7)),new VPe(a,e,u,i)}function tLe(t,e){var h;const{ecc:n="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:a=-1,border:o=1}=e||{},c=typeof t=="string"?XPe(t):Array.isArray(t)?[Jue(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=eLe(c,BPe[n],i,s,a,r),u=nLe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},o);return e!=null&&e.invert&&(u.data=u.data.map(d=>d.map(f=>!f))),(h=e==null?void 0:e.onEncoded)==null||h.call(e,u),u}function nLe(t,e=1){if(!e)return t;const{size:n}=t,r=n+e*2;t.size=r,t.data.forEach(s=>{for(let a=0;a<e;a++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:r},a=>!1)),t.data.push(Array.from({length:r},a=>!1));const i=RS.Border;t.types.forEach(s=>{for(let a=0;a<e;a++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:r},a=>i)),t.types.push(Array.from({length:r},a=>i));return t}function rLe(t,e,n,r=!1){return e<0||n<0||e>=t.length||n>=t.length?r:t[n][e]}function iLe(t,e={}){const n={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},r=tLe(t,e),i=!1,s=!0,a=(l,u)=>rLe(r.data,l,u,!0),o=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)a(u,l)===i&&a(u,l+1)===i?c+=n.WHITE_ALL:a(u,l)===i&&a(u,l+1)===s?c+=n.WHITE_BLACK:a(u,l)===s&&a(u,l+1)===i?c+=n.BLACK_WHITE:c+=n.BLACK_ALL;o.push(c),c=""}return o.join(`
`)}const xb="$dkpurple",sLe="$196",aLe="$205";function wr(t,e,n){Fg(t,e,n)}function oLe(t,e,n){const r=sLe.repeat(n);wr(t,e,`${xb}${r}`)}function f7(t,e,n){const r=aLe.repeat(n);wr(t,e,`${xb}${r}`)}function $p(t,e,n){wr(t,e,`${xb} ${" ".repeat(n.length)} `),oLe(t,e,n.length+2),wr(t,e,`${xb} $white${n} `),f7(t,e,n.length+2)}function pv(t,e,n){wr(t,e,`${xb} ${" ".repeat(n.length)} `),wr(t,e,`${xb} $gray${n} `),f7(t,e,n.length+2)}function ci(t,e,n,r){wr(t,e,`${xb} $white${n} $blue${r}`)}function uo(t,e,n){wr(t,e,`${xb}$blue${n}`)}function _2(t,e,n,r,i=!0){if(i){const s=iLe(n).split(`
`),a={32:32,9600:223,9604:220,9608:219};for(let o=0;o<s.length;o++){const c=[...s[o]].map(l=>`$${a[l.charCodeAt(0)]}`).join("");wr(t,e,c)}}wr(t,e,`!copyit ${n};${r}`),c7(t,e)}function cLe(t,e,n,r){wr(t,e,`!openit ${n};${r}`)}async function rV(t){const e=new FormData;e.append("url",t);const n=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(n)).text()}function ehe(){return window.location.href.includes("/join/")}function iV(){return window.location.href.includes("/locked/")}const kZ=t=>{let e;const n=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const d=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(f=>f(e,d))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,o);return o},p7=t=>t?kZ(t):kZ,lLe=t=>t;function m7(t,e=lLe){const n=xg.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return xg.useDebugValue(n),n}const DZ=t=>{const e=p7(t),n=r=>m7(e,r);return Object.assign(n,e),n},Yb=t=>t?DZ(t):DZ;function PZ(t){const e=Be.useRef();return n=>{const r=t(n);return(e.current===void 0||r===void 0?e.current===r:Y1(e.current,r))?e.current:e.current=r}}const Eo=Yb(()=>({desync:!1,zsswords:{cli:[],loader:[],runtime:[],flags:[],stats:[],kinds:[],altkinds:[],colors:[],dirs:[],dirmods:[]},gadget:{id:"",layers:[],scroll:[],sidebar:[]}}));var iP=(t=>(t[t.OFF=0]="OFF",t[t.INFO=1]="INFO",t[t.DEBUG=2]="DEBUG",t))(iP||{});const LZ=128;var Pd=(t=>(t[t.TOP=0]="TOP",t[t.FULL=1]="FULL",t[t.BOTTOM=2]="BOTTOM",t[t.SPLIT_Y=3]="SPLIT_Y",t[t.SPLIT_Y_ALT=4]="SPLIT_Y_ALT",t[t.MAX=5]="MAX",t))(Pd||{});const Us=Yb(()=>({layout:0,inspector:iV(),quickterminal:!1,toast:"",terminal:{open:!0,level:1,logs:[]},editor:{open:!1,book:"",path:[],type:"",title:"",refsheet:[]}})),nc=Yb(()=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})),ho=Yb(()=>({id:"",xscroll:0,yscroll:0,cursor:0,select:void 0})),i1=Yb(()=>({cursor:void 0,select:void 0}));function uLe(t){const e=document.createElement("canvas");if(e.width=(t==null?void 0:t.width)||1,e.height=(t==null?void 0:t.height)||1,t){const n=e.getContext("2d"),r=n==null?void 0:n.getImageData(0,0,t.width,t.height);if(r&&n){let i=0;const{data:s}=r;for(let a=0;a<s.length;a+=4){const o=t.bits[i];s[a]=o,s[a+1]=o,s[a+2]=o,s[a+3]=255,i+=1}n.putImageData(r,0,0)}}return e}function the(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function mw(t,e,n){return{width:t,height:e,size:t*e,bits:new Uint8Array(n)}}const sV=14,fT=3,Mg=8,Og=14,Hh=16,JM=16,g7=16;var Ld=(t=>(t[t.BLANK=0]="BLANK",t[t.TILES=1]="TILES",t[t.SPRITES=2]="SPRITES",t[t.DITHER=3]="DITHER",t[t.MEDIA=4]="MEDIA",t[t.CONTROL=5]="CONTROL",t))(Ld||{}),nm=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(nm||{});function b2(t){let e=0,n=0,r=727,i=-1e3,s=1.5,a="flat",o=0;return t.forEach(c=>{switch(c.type){case 1:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 3:e=Math.max(e,c.width),n=Math.max(n,c.height);break;case 5:r=c.focusx,i=c.focusy,s=c.viewscale,a=c.graphics,o=c.facing;break}}),{width:e,height:n,focusx:r,focusy:i,viewscale:s,graphics:a,facing:o}}function Xb(t,e){return`${t}:${e}`}const nhe=1,rhe=16,ihe=256;var tn=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(tn||{});function YC(t){const e=Math.floor(t.length/fT);if(e*fT!==t.length)return;const n=the(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function hLe(t,e){return t&1<<e?255:0}function XC(t){const e=Math.floor(t.length/sV);if(e*sV!==t.length)return;const n=Math.ceil(e/Hh),r=Mg*Hh,i=the(r,Og*n);let s=0,a=0,o=0;for(let c=0;c<t.length;++c){const l=a*Og+o,u=t[c];for(let h=0;h<Mg;++h){const d=s*Mg+h;i.bits[d+l*r]=hLe(u,7-h)}++o,o===Og&&(o=0,++s,s===Hh&&(s=0,++a))}return i}/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const UZ="0123456789abcdef",she=[],E2=[];for(let t=0;t<256;t++)she[t]=UZ[t>>4&15]+UZ[t&15],t<16&&(t<10?E2[48+t]=t:E2[87+t]=t);const ahe=t=>{const e=t.length;let n="",r=0;for(;r<e;)n+=she[t[r++]];return n},ZM=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=E2[t.charCodeAt(s++)]<<4|E2[t.charCodeAt(s++)];return r};var BZ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dLe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Kk=0;Kk<BZ.length;Kk++)dLe[BZ.charCodeAt(Kk)]=Kk;new TextDecoder;new TextEncoder;const FZ=typeof window<"u"?window:self,zZ=FZ.crypto||FZ.msCrypto||{};zZ.subtle||zZ.webkitSubtle;const CN=ZM("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),RN=ZM("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f"),Qp=globalThis||void 0||self;var ohe=typeof Qp=="object"&&Qp&&Qp.Object===Object&&Qp,fLe=typeof self=="object"&&self&&self.Object===Object&&self,Qg=ohe||fLe||Function("return this")(),sp=Qg.Symbol,che=Object.prototype,pLe=che.hasOwnProperty,mLe=che.toString,YR=sp?sp.toStringTag:void 0;function gLe(t){var e=pLe.call(t,YR),n=t[YR];try{t[YR]=void 0;var r=!0}catch{}var i=mLe.call(t);return r&&(e?t[YR]=n:delete t[YR]),i}var vLe=Object.prototype,yLe=vLe.toString;function _Le(t){return yLe.call(t)}var bLe="[object Null]",ELe="[object Undefined]",HZ=sp?sp.toStringTag:void 0;function Kb(t){return t==null?t===void 0?ELe:bLe:HZ&&HZ in Object(t)?gLe(t):_Le(t)}function sm(t){return t!=null&&typeof t=="object"}var SLe="[object Symbol]";function K3(t){return typeof t=="symbol"||sm(t)&&Kb(t)==SLe}function J3(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var qi=Array.isArray,TLe=1/0,jZ=sp?sp.prototype:void 0,VZ=jZ?jZ.toString:void 0;function lhe(t){if(typeof t=="string")return t;if(qi(t))return J3(t,lhe)+"";if(K3(t))return VZ?VZ.call(t):"";var e=t+"";return e=="0"&&1/t==-TLe?"-0":e}var xLe=/\s/;function wLe(t){for(var e=t.length;e--&&xLe.test(t.charAt(e)););return e}var CLe=/^\s+/;function RLe(t){return t&&t.slice(0,wLe(t)+1).replace(CLe,"")}function ap(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var GZ=NaN,ALe=/^[-+]0x[0-9a-f]+$/i,MLe=/^0b[01]+$/i,OLe=/^0o[0-7]+$/i,NLe=parseInt;function ILe(t){if(typeof t=="number")return t;if(K3(t))return GZ;if(ap(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=ap(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=RLe(t);var n=MLe.test(t);return n||OLe.test(t)?NLe(t.slice(2),n?2:8):ALe.test(t)?GZ:+t}var qZ=1/0,kLe=17976931348623157e292;function DLe(t){if(!t)return t===0?t:0;if(t=ILe(t),t===qZ||t===-qZ){var e=t<0?-1:1;return e*kLe}return t===t?t:0}function Z3(t){var e=DLe(t),n=e%1;return e===e?n?e-n:e:0}function rC(t){return t}var PLe="[object AsyncFunction]",LLe="[object Function]",ULe="[object GeneratorFunction]",BLe="[object Proxy]";function my(t){if(!ap(t))return!1;var e=Kb(t);return e==LLe||e==ULe||e==PLe||e==BLe}var Y8=Qg["__core-js_shared__"],$Z=function(){var t=/[^.]+$/.exec(Y8&&Y8.keys&&Y8.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function FLe(t){return!!$Z&&$Z in t}var zLe=Function.prototype,HLe=zLe.toString;function qT(t){if(t!=null){try{return HLe.call(t)}catch{}try{return t+""}catch{}}return""}var jLe=/[\\^$.*+?()[\]{}|]/g,VLe=/^\[object .+?Constructor\]$/,GLe=Function.prototype,qLe=Object.prototype,$Le=GLe.toString,WLe=qLe.hasOwnProperty,YLe=RegExp("^"+$Le.call(WLe).replace(jLe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function XLe(t){if(!ap(t)||FLe(t))return!1;var e=my(t)?YLe:VLe;return e.test(qT(t))}function KLe(t,e){return t==null?void 0:t[e]}function $T(t,e){var n=KLe(t,e);return XLe(n)?n:void 0}var aV=$T(Qg,"WeakMap"),WZ=Object.create,JLe=function(){function t(){}return function(e){if(!ap(e))return{};if(WZ)return WZ(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function ZLe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Rc(){}function QLe(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var e2e=800,t2e=16,n2e=Date.now;function r2e(t){var e=0,n=0;return function(){var r=n2e(),i=t2e-(r-n);if(n=r,i>0){if(++e>=e2e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function i2e(t){return function(){return t}}var S2=function(){try{var t=$T(Object,"defineProperty");return t({},"",{}),t}catch{}}(),s2e=S2?function(t,e){return S2(t,"toString",{configurable:!0,enumerable:!1,value:i2e(e),writable:!0})}:rC,a2e=r2e(s2e);function uhe(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function hhe(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function o2e(t){return t!==t}function c2e(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function v7(t,e,n){return e===e?c2e(t,e,n):hhe(t,o2e,n)}function dhe(t,e){var n=t==null?0:t.length;return!!n&&v7(t,e,0)>-1}var l2e=9007199254740991,u2e=/^(?:0|[1-9]\d*)$/;function Q3(t,e){var n=typeof t;return e=e??l2e,!!e&&(n=="number"||n!="symbol"&&u2e.test(t))&&t>-1&&t%1==0&&t<e}function y7(t,e,n){e=="__proto__"&&S2?S2(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function AN(t,e){return t===e||t!==t&&e!==e}var h2e=Object.prototype,d2e=h2e.hasOwnProperty;function eB(t,e,n){var r=t[e];(!(d2e.call(t,e)&&AN(r,n))||n===void 0&&!(e in t))&&y7(t,e,n)}function _7(t,e,n,r){var i=!n;n||(n={});for(var s=-1,a=e.length;++s<a;){var o=e[s],c=void 0;c===void 0&&(c=t[o]),i?y7(n,o,c):eB(n,o,c)}return n}var YZ=Math.max;function f2e(t,e,n){return e=YZ(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=YZ(r.length-e,0),a=Array(s);++i<s;)a[i]=r[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=r[i];return o[e]=n(a),ZLe(t,this,o)}}function b7(t,e){return a2e(f2e(t,e,rC),t+"")}var p2e=9007199254740991;function E7(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=p2e}function e0(t){return t!=null&&E7(t.length)&&!my(t)}function fhe(t,e,n){if(!ap(n))return!1;var r=typeof e;return(r=="number"?e0(n)&&Q3(e,n.length):r=="string"&&e in n)?AN(n[e],t):!1}function m2e(t){return b7(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,a&&fhe(n[0],n[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var o=n[r];o&&t(e,o,r,s)}return e})}var g2e=Object.prototype;function MN(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||g2e;return t===n}function v2e(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var y2e="[object Arguments]";function XZ(t){return sm(t)&&Kb(t)==y2e}var phe=Object.prototype,_2e=phe.hasOwnProperty,b2e=phe.propertyIsEnumerable,tB=XZ(function(){return arguments}())?XZ:function(t){return sm(t)&&_2e.call(t,"callee")&&!b2e.call(t,"callee")};function E2e(){return!1}var mhe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,KZ=mhe&&typeof module=="object"&&module&&!module.nodeType&&module,S2e=KZ&&KZ.exports===mhe,JZ=S2e?Qg.Buffer:void 0,T2e=JZ?JZ.isBuffer:void 0,QM=T2e||E2e,x2e="[object Arguments]",w2e="[object Array]",C2e="[object Boolean]",R2e="[object Date]",A2e="[object Error]",M2e="[object Function]",O2e="[object Map]",N2e="[object Number]",I2e="[object Object]",k2e="[object RegExp]",D2e="[object Set]",P2e="[object String]",L2e="[object WeakMap]",U2e="[object ArrayBuffer]",B2e="[object DataView]",F2e="[object Float32Array]",z2e="[object Float64Array]",H2e="[object Int8Array]",j2e="[object Int16Array]",V2e="[object Int32Array]",G2e="[object Uint8Array]",q2e="[object Uint8ClampedArray]",$2e="[object Uint16Array]",W2e="[object Uint32Array]",ga={};ga[F2e]=ga[z2e]=ga[H2e]=ga[j2e]=ga[V2e]=ga[G2e]=ga[q2e]=ga[$2e]=ga[W2e]=!0;ga[x2e]=ga[w2e]=ga[U2e]=ga[C2e]=ga[B2e]=ga[R2e]=ga[A2e]=ga[M2e]=ga[O2e]=ga[N2e]=ga[I2e]=ga[k2e]=ga[D2e]=ga[P2e]=ga[L2e]=!1;function Y2e(t){return sm(t)&&E7(t.length)&&!!ga[Kb(t)]}function nB(t){return function(e){return t(e)}}var ghe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,eM=ghe&&typeof module=="object"&&module&&!module.nodeType&&module,X2e=eM&&eM.exports===ghe,X8=X2e&&ohe.process,wb=function(){try{var t=eM&&eM.require&&eM.require("util").types;return t||X8&&X8.binding&&X8.binding("util")}catch{}}(),ZZ=wb&&wb.isTypedArray,S7=ZZ?nB(ZZ):Y2e,K2e=Object.prototype,J2e=K2e.hasOwnProperty;function vhe(t,e){var n=qi(t),r=!n&&tB(t),i=!n&&!r&&QM(t),s=!n&&!r&&!i&&S7(t),a=n||r||i||s,o=a?v2e(t.length,String):[],c=o.length;for(var l in t)(e||J2e.call(t,l))&&!(a&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Q3(l,c)))&&o.push(l);return o}function yhe(t,e){return function(n){return t(e(n))}}var Z2e=yhe(Object.keys,Object),Q2e=Object.prototype,eUe=Q2e.hasOwnProperty;function _he(t){if(!MN(t))return Z2e(t);var e=[];for(var n in Object(t))eUe.call(t,n)&&n!="constructor"&&e.push(n);return e}function op(t){return e0(t)?vhe(t):_he(t)}var tUe=Object.prototype,nUe=tUe.hasOwnProperty,Jh=m2e(function(t,e){if(MN(e)||e0(e)){_7(e,op(e),t);return}for(var n in e)nUe.call(e,n)&&eB(t,n,e[n])});function rUe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var iUe=Object.prototype,sUe=iUe.hasOwnProperty;function aUe(t){if(!ap(t))return rUe(t);var e=MN(t),n=[];for(var r in t)r=="constructor"&&(e||!sUe.call(t,r))||n.push(r);return n}function bhe(t){return e0(t)?vhe(t,!0):aUe(t)}var oUe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cUe=/^\w*$/;function T7(t,e){if(qi(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||K3(t)?!0:cUe.test(t)||!oUe.test(t)||e!=null&&t in Object(e)}var eO=$T(Object,"create");function lUe(){this.__data__=eO?eO(null):{},this.size=0}function uUe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var hUe="__lodash_hash_undefined__",dUe=Object.prototype,fUe=dUe.hasOwnProperty;function pUe(t){var e=this.__data__;if(eO){var n=e[t];return n===hUe?void 0:n}return fUe.call(e,t)?e[t]:void 0}var mUe=Object.prototype,gUe=mUe.hasOwnProperty;function vUe(t){var e=this.__data__;return eO?e[t]!==void 0:gUe.call(e,t)}var yUe="__lodash_hash_undefined__";function _Ue(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=eO&&e===void 0?yUe:e,this}function pT(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pT.prototype.clear=lUe;pT.prototype.delete=uUe;pT.prototype.get=pUe;pT.prototype.has=vUe;pT.prototype.set=_Ue;function bUe(){this.__data__=[],this.size=0}function rB(t,e){for(var n=t.length;n--;)if(AN(t[n][0],e))return n;return-1}var EUe=Array.prototype,SUe=EUe.splice;function TUe(t){var e=this.__data__,n=rB(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():SUe.call(e,n,1),--this.size,!0}function xUe(t){var e=this.__data__,n=rB(e,t);return n<0?void 0:e[n][1]}function wUe(t){return rB(this.__data__,t)>-1}function CUe(t,e){var n=this.__data__,r=rB(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function gy(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}gy.prototype.clear=bUe;gy.prototype.delete=TUe;gy.prototype.get=xUe;gy.prototype.has=wUe;gy.prototype.set=CUe;var tO=$T(Qg,"Map");function RUe(){this.size=0,this.__data__={hash:new pT,map:new(tO||gy),string:new pT}}function AUe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iB(t,e){var n=t.__data__;return AUe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function MUe(t){var e=iB(this,t).delete(t);return this.size-=e?1:0,e}function OUe(t){return iB(this,t).get(t)}function NUe(t){return iB(this,t).has(t)}function IUe(t,e){var n=iB(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function vy(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}vy.prototype.clear=RUe;vy.prototype.delete=MUe;vy.prototype.get=OUe;vy.prototype.has=NUe;vy.prototype.set=IUe;var kUe="Expected a function";function x7(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(kUe);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var a=t.apply(this,r);return n.cache=s.set(i,a)||s,a};return n.cache=new(x7.Cache||vy),n}x7.Cache=vy;var DUe=500;function PUe(t){var e=x7(t,function(r){return n.size===DUe&&n.clear(),r}),n=e.cache;return e}var LUe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,UUe=/\\(\\)?/g,BUe=PUe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(LUe,function(n,r,i,s){e.push(i?s.replace(UUe,"$1"):r||n)}),e});function Ehe(t){return t==null?"":lhe(t)}function sB(t,e){return qi(t)?t:T7(t,e)?[t]:BUe(Ehe(t))}var FUe=1/0;function ON(t){if(typeof t=="string"||K3(t))return t;var e=t+"";return e=="0"&&1/t==-FUe?"-0":e}function w7(t,e){e=sB(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[ON(e[n++])];return n&&n==r?t:void 0}function zUe(t,e,n){var r=t==null?void 0:w7(t,e);return r===void 0?n:r}function C7(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var QZ=sp?sp.isConcatSpreadable:void 0;function HUe(t){return qi(t)||tB(t)||!!(QZ&&t&&t[QZ])}function R7(t,e,n,r,i){var s=-1,a=t.length;for(n||(n=HUe),i||(i=[]);++s<a;){var o=t[s];n(o)?C7(i,o):r||(i[i.length]=o)}return i}function $h(t){var e=t==null?0:t.length;return e?R7(t):[]}var She=yhe(Object.getPrototypeOf,Object);function A7(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function jUe(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:A7(t,e,n)}var VUe="\\ud800-\\udfff",GUe="\\u0300-\\u036f",qUe="\\ufe20-\\ufe2f",$Ue="\\u20d0-\\u20ff",WUe=GUe+qUe+$Ue,YUe="\\ufe0e\\ufe0f",XUe="\\u200d",KUe=RegExp("["+XUe+VUe+WUe+YUe+"]");function The(t){return KUe.test(t)}function JUe(t){return t.split("")}var xhe="\\ud800-\\udfff",ZUe="\\u0300-\\u036f",QUe="\\ufe20-\\ufe2f",e3e="\\u20d0-\\u20ff",t3e=ZUe+QUe+e3e,n3e="\\ufe0e\\ufe0f",r3e="["+xhe+"]",oV="["+t3e+"]",cV="\\ud83c[\\udffb-\\udfff]",i3e="(?:"+oV+"|"+cV+")",whe="[^"+xhe+"]",Che="(?:\\ud83c[\\udde6-\\uddff]){2}",Rhe="[\\ud800-\\udbff][\\udc00-\\udfff]",s3e="\\u200d",Ahe=i3e+"?",Mhe="["+n3e+"]?",a3e="(?:"+s3e+"(?:"+[whe,Che,Rhe].join("|")+")"+Mhe+Ahe+")*",o3e=Mhe+Ahe+a3e,c3e="(?:"+[whe+oV+"?",oV,Che,Rhe,r3e].join("|")+")",l3e=RegExp(cV+"(?="+cV+")|"+c3e+o3e,"g");function u3e(t){return t.match(l3e)||[]}function h3e(t){return The(t)?u3e(t):JUe(t)}function d3e(t){return function(e){e=Ehe(e);var n=The(e)?h3e(e):void 0,r=n?n[0]:e.charAt(0),i=n?jUe(n,1).join(""):e.slice(1);return r[t]()+i}}var Ohe=d3e("toUpperCase");function f3e(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function p3e(){this.__data__=new gy,this.size=0}function m3e(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function g3e(t){return this.__data__.get(t)}function v3e(t){return this.__data__.has(t)}var y3e=200;function _3e(t,e){var n=this.__data__;if(n instanceof gy){var r=n.__data__;if(!tO||r.length<y3e-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new vy(r)}return n.set(t,e),this.size=n.size,this}function Ng(t){var e=this.__data__=new gy(t);this.size=e.size}Ng.prototype.clear=p3e;Ng.prototype.delete=m3e;Ng.prototype.get=g3e;Ng.prototype.has=v3e;Ng.prototype.set=_3e;function b3e(t,e){return t&&_7(e,op(e),t)}var Nhe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,eQ=Nhe&&typeof module=="object"&&module&&!module.nodeType&&module,E3e=eQ&&eQ.exports===Nhe,tQ=E3e?Qg.Buffer:void 0,nQ=tQ?tQ.allocUnsafe:void 0;function S3e(t,e){var n=t.length,r=nQ?nQ(n):new t.constructor(n);return t.copy(r),r}function M7(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var a=t[n];e(a,n,t)&&(s[i++]=a)}return s}function Ihe(){return[]}var T3e=Object.prototype,x3e=T3e.propertyIsEnumerable,rQ=Object.getOwnPropertySymbols,O7=rQ?function(t){return t==null?[]:(t=Object(t),M7(rQ(t),function(e){return x3e.call(t,e)}))}:Ihe;function w3e(t,e){return _7(t,O7(t),e)}var C3e=Object.getOwnPropertySymbols,R3e=C3e?function(t){for(var e=[];t;)C7(e,O7(t)),t=She(t);return e}:Ihe;function khe(t,e,n){var r=e(t);return qi(t)?r:C7(r,n(t))}function lV(t){return khe(t,op,O7)}function A3e(t){return khe(t,bhe,R3e)}var uV=$T(Qg,"DataView"),hV=$T(Qg,"Promise"),gw=$T(Qg,"Set"),iQ="[object Map]",M3e="[object Object]",sQ="[object Promise]",aQ="[object Set]",oQ="[object WeakMap]",cQ="[object DataView]",O3e=qT(uV),N3e=qT(tO),I3e=qT(hV),k3e=qT(gw),D3e=qT(aV),Pf=Kb;(uV&&Pf(new uV(new ArrayBuffer(1)))!=cQ||tO&&Pf(new tO)!=iQ||hV&&Pf(hV.resolve())!=sQ||gw&&Pf(new gw)!=aQ||aV&&Pf(new aV)!=oQ)&&(Pf=function(t){var e=Kb(t),n=e==M3e?t.constructor:void 0,r=n?qT(n):"";if(r)switch(r){case O3e:return cQ;case N3e:return iQ;case I3e:return sQ;case k3e:return aQ;case D3e:return oQ}return e});var P3e=Object.prototype,L3e=P3e.hasOwnProperty;function U3e(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&L3e.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var T2=Qg.Uint8Array;function B3e(t){var e=new t.constructor(t.byteLength);return new T2(e).set(new T2(t)),e}function F3e(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var z3e=/\w*$/;function H3e(t){var e=new t.constructor(t.source,z3e.exec(t));return e.lastIndex=t.lastIndex,e}var lQ=sp?sp.prototype:void 0,uQ=lQ?lQ.valueOf:void 0;function j3e(t){return uQ?Object(uQ.call(t)):{}}function V3e(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var G3e="[object Boolean]",q3e="[object Date]",$3e="[object Map]",W3e="[object Number]",Y3e="[object RegExp]",X3e="[object Set]",K3e="[object String]",J3e="[object Symbol]",Z3e="[object ArrayBuffer]",Q3e="[object DataView]",eBe="[object Float32Array]",tBe="[object Float64Array]",nBe="[object Int8Array]",rBe="[object Int16Array]",iBe="[object Int32Array]",sBe="[object Uint8Array]",aBe="[object Uint8ClampedArray]",oBe="[object Uint16Array]",cBe="[object Uint32Array]";function lBe(t,e,n){var r=t.constructor;switch(e){case Z3e:return B3e(t);case G3e:case q3e:return new r(+t);case Q3e:return F3e(t);case eBe:case tBe:case nBe:case rBe:case iBe:case sBe:case aBe:case oBe:case cBe:return V3e(t);case $3e:return new r;case W3e:case K3e:return new r(t);case Y3e:return H3e(t);case X3e:return new r;case J3e:return j3e(t)}}function uBe(t){return typeof t.constructor=="function"&&!MN(t)?JLe(She(t)):{}}var hBe="[object Map]";function dBe(t){return sm(t)&&Pf(t)==hBe}var hQ=wb&&wb.isMap,fBe=hQ?nB(hQ):dBe,pBe="[object Set]";function mBe(t){return sm(t)&&Pf(t)==pBe}var dQ=wb&&wb.isSet,gBe=dQ?nB(dQ):mBe,Dhe="[object Arguments]",vBe="[object Array]",yBe="[object Boolean]",_Be="[object Date]",bBe="[object Error]",Phe="[object Function]",EBe="[object GeneratorFunction]",SBe="[object Map]",TBe="[object Number]",Lhe="[object Object]",xBe="[object RegExp]",wBe="[object Set]",CBe="[object String]",RBe="[object Symbol]",ABe="[object WeakMap]",MBe="[object ArrayBuffer]",OBe="[object DataView]",NBe="[object Float32Array]",IBe="[object Float64Array]",kBe="[object Int8Array]",DBe="[object Int16Array]",PBe="[object Int32Array]",LBe="[object Uint8Array]",UBe="[object Uint8ClampedArray]",BBe="[object Uint16Array]",FBe="[object Uint32Array]",ta={};ta[Dhe]=ta[vBe]=ta[MBe]=ta[OBe]=ta[yBe]=ta[_Be]=ta[NBe]=ta[IBe]=ta[kBe]=ta[DBe]=ta[PBe]=ta[SBe]=ta[TBe]=ta[Lhe]=ta[xBe]=ta[wBe]=ta[CBe]=ta[RBe]=ta[LBe]=ta[UBe]=ta[BBe]=ta[FBe]=!0;ta[bBe]=ta[Phe]=ta[ABe]=!1;function sP(t,e,n,r,i,s){var a;if(a!==void 0)return a;if(!ap(t))return t;var o=qi(t);if(o)return a=U3e(t),QLe(t,a);var c=Pf(t),l=c==Phe||c==EBe;if(QM(t))return S3e(t);if(c==Lhe||c==Dhe||l&&!i)return a=l?{}:uBe(t),w3e(t,b3e(a,t));if(!ta[c])return i?t:{};a=lBe(t,c),s||(s=new Ng);var u=s.get(t);if(u)return u;s.set(t,a),gBe(t)?t.forEach(function(f){a.add(sP(f,e,n,f,t,s))}):fBe(t)&&t.forEach(function(f,p){a.set(p,sP(f,e,n,p,t,s))});var h=lV,d=o?void 0:h(t);return uhe(d||t,function(f,p){d&&(p=f,f=t[p]),eB(a,p,sP(f,e,n,p,t,s))}),a}var zBe=4;function Bl(t){return sP(t,zBe)}function NN(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var HBe="__lodash_hash_undefined__";function jBe(t){return this.__data__.set(t,HBe),this}function VBe(t){return this.__data__.has(t)}function iC(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new vy;++e<n;)this.add(t[e])}iC.prototype.add=iC.prototype.push=jBe;iC.prototype.has=VBe;function Uhe(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function N7(t,e){return t.has(e)}var GBe=1,qBe=2;function Bhe(t,e,n,r,i,s){var a=n&GBe,o=t.length,c=e.length;if(o!=c&&!(a&&c>o))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&qBe?new iC:void 0;for(s.set(t,e),s.set(e,t);++h<o;){var p=t[h],g=e[h];if(r)var _=a?r(g,p,h,e,t,s):r(p,g,h,t,e,s);if(_!==void 0){if(_)continue;d=!1;break}if(f){if(!Uhe(e,function(v,E){if(!N7(f,E)&&(p===v||i(p,v,n,r,s)))return f.push(E)})){d=!1;break}}else if(!(p===g||i(p,g,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function $Be(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function I7(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var WBe=1,YBe=2,XBe="[object Boolean]",KBe="[object Date]",JBe="[object Error]",ZBe="[object Map]",QBe="[object Number]",eFe="[object RegExp]",tFe="[object Set]",nFe="[object String]",rFe="[object Symbol]",iFe="[object ArrayBuffer]",sFe="[object DataView]",fQ=sp?sp.prototype:void 0,K8=fQ?fQ.valueOf:void 0;function aFe(t,e,n,r,i,s,a){switch(n){case sFe:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case iFe:return!(t.byteLength!=e.byteLength||!s(new T2(t),new T2(e)));case XBe:case KBe:case QBe:return AN(+t,+e);case JBe:return t.name==e.name&&t.message==e.message;case eFe:case nFe:return t==e+"";case ZBe:var o=$Be;case tFe:var c=r&WBe;if(o||(o=I7),t.size!=e.size&&!c)return!1;var l=a.get(t);if(l)return l==e;r|=YBe,a.set(t,e);var u=Bhe(o(t),o(e),r,i,s,a);return a.delete(t),u;case rFe:if(K8)return K8.call(t)==K8.call(e)}return!1}var oFe=1,cFe=Object.prototype,lFe=cFe.hasOwnProperty;function uFe(t,e,n,r,i,s){var a=n&oFe,o=lV(t),c=o.length,l=lV(e),u=l.length;if(c!=u&&!a)return!1;for(var h=c;h--;){var d=o[h];if(!(a?d in e:lFe.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var g=!0;s.set(t,e),s.set(e,t);for(var _=a;++h<c;){d=o[h];var v=t[d],E=e[d];if(r)var T=a?r(E,v,d,e,t,s):r(v,E,d,t,e,s);if(!(T===void 0?v===E||i(v,E,n,r,s):T)){g=!1;break}_||(_=d=="constructor")}if(g&&!_){var x=t.constructor,N=e.constructor;x!=N&&"constructor"in t&&"constructor"in e&&!(typeof x=="function"&&x instanceof x&&typeof N=="function"&&N instanceof N)&&(g=!1)}return s.delete(t),s.delete(e),g}var hFe=1,pQ="[object Arguments]",mQ="[object Array]",Jk="[object Object]",dFe=Object.prototype,gQ=dFe.hasOwnProperty;function fFe(t,e,n,r,i,s){var a=qi(t),o=qi(e),c=a?mQ:Pf(t),l=o?mQ:Pf(e);c=c==pQ?Jk:c,l=l==pQ?Jk:l;var u=c==Jk,h=l==Jk,d=c==l;if(d&&QM(t)){if(!QM(e))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new Ng),a||S7(t)?Bhe(t,e,n,r,i,s):aFe(t,e,c,n,r,i,s);if(!(n&hFe)){var f=u&&gQ.call(t,"__wrapped__"),p=h&&gQ.call(e,"__wrapped__");if(f||p){var g=f?t.value():t,_=p?e.value():e;return s||(s=new Ng),i(g,_,n,r,s)}}return d?(s||(s=new Ng),uFe(t,e,n,r,i,s)):!1}function k7(t,e,n,r,i){return t===e?!0:t==null||e==null||!sm(t)&&!sm(e)?t!==t&&e!==e:fFe(t,e,n,r,k7,i)}var pFe=1,mFe=2;function gFe(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var a=n[i];if(a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){a=n[i];var o=a[0],c=t[o],l=a[1];if(a[2]){if(c===void 0&&!(o in t))return!1}else{var u=new Ng,h;if(!(h===void 0?k7(l,c,pFe|mFe,r,u):h))return!1}}return!0}function Fhe(t){return t===t&&!ap(t)}function vFe(t){for(var e=op(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Fhe(i)]}return e}function zhe(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function yFe(t){var e=vFe(t);return e.length==1&&e[0][2]?zhe(e[0][0],e[0][1]):function(n){return n===t||gFe(n,t,e)}}function _Fe(t,e){return t!=null&&e in Object(t)}function Hhe(t,e,n){e=sB(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var a=ON(e[r]);if(!(s=t!=null&&n(t,a)))break;t=t[a]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&E7(i)&&Q3(a,i)&&(qi(t)||tB(t)))}function bFe(t,e){return t!=null&&Hhe(t,e,_Fe)}var EFe=1,SFe=2;function TFe(t,e){return T7(t)&&Fhe(e)?zhe(ON(t),e):function(n){var r=zUe(n,t);return r===void 0&&r===e?bFe(n,t):k7(e,r,EFe|SFe)}}function xFe(t){return function(e){return e==null?void 0:e[t]}}function wFe(t){return function(e){return w7(e,t)}}function CFe(t){return T7(t)?xFe(ON(t)):wFe(t)}function t0(t){return typeof t=="function"?t:t==null?rC:typeof t=="object"?qi(t)?TFe(t[0],t[1]):yFe(t):CFe(t)}function RFe(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var a=t[i];e(r,a,n(a),t)}return r}function AFe(t){return function(e,n,r){for(var i=-1,s=Object(e),a=r(e),o=a.length;o--;){var c=a[++i];if(n(s[c],c,s)===!1)break}return e}}var MFe=AFe();function OFe(t,e){return t&&MFe(t,e,op)}function NFe(t,e){return function(n,r){if(n==null)return n;if(!e0(n))return t(n,r);for(var i=n.length,s=-1,a=Object(n);++s<i&&r(a[s],s,a)!==!1;);return n}}var WT=NFe(OFe);function IFe(t,e,n,r){return WT(t,function(i,s,a){e(r,i,n(i),a)}),r}function kFe(t,e){return function(n,r){var i=qi(n)?RFe:IFe,s=e?e():{};return i(n,t,t0(r),s)}}var jhe=Object.prototype,DFe=jhe.hasOwnProperty,D7=b7(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&fhe(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],a=bhe(s),o=-1,c=a.length;++o<c;){var l=a[o],u=t[l];(u===void 0||AN(u,jhe[l])&&!DFe.call(t,l))&&(t[l]=s[l])}return t});function vQ(t){return sm(t)&&e0(t)}var PFe=200;function LFe(t,e,n,r){var i=-1,s=dhe,a=!0,o=t.length,c=[],l=e.length;if(!o)return c;e.length>=PFe&&(s=N7,a=!1,e=new iC(e));e:for(;++i<o;){var u=t[i],h=u;if(u=u!==0?u:0,a&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var aB=b7(function(t,e){return vQ(t)?LFe(t,R7(e,1,vQ,!0)):[]});function sC(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ml(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Z3(e),A7(t,e<0?0:e,r)):[]}function nO(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:Z3(e),e=r-e,A7(t,0,e<0?0:e)):[]}function UFe(t){return typeof t=="function"?t:rC}function Or(t,e){var n=qi(t)?uhe:WT;return n(t,UFe(e))}function BFe(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function FFe(t,e){var n=!0;return WT(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function rm(t,e,n){var r=qi(t)?BFe:FFe;return r(t,t0(e))}function Vhe(t,e){var n=[];return WT(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function fp(t,e){var n=qi(t)?M7:Vhe;return n(t,t0(e))}function zFe(t){return function(e,n,r){var i=Object(e);if(!e0(e)){var s=t0(n);e=op(e),n=function(o){return s(i[o],o,i)}}var a=t(e,n,r);return a>-1?i[s?e[a]:a]:void 0}}var HFe=Math.max;function jFe(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:Z3(n);return i<0&&(i=HFe(r+i,0)),hhe(t,t0(e),i)}var aC=zFe(jFe);function am(t){return t&&t.length?t[0]:void 0}function VFe(t,e){var n=-1,r=e0(t)?Array(t.length):[];return WT(t,function(i,s,a){r[++n]=e(i,s,a)}),r}function Dn(t,e){var n=qi(t)?J3:VFe;return n(t,t0(e))}function ep(t,e){return R7(Dn(t,e))}var GFe=Object.prototype,qFe=GFe.hasOwnProperty,Ghe=kFe(function(t,e,n){qFe.call(t,n)?t[n].push(e):y7(t,n,[e])}),$Fe=Object.prototype,WFe=$Fe.hasOwnProperty;function YFe(t,e){return t!=null&&WFe.call(t,e)}function Er(t,e){return t!=null&&Hhe(t,e,YFe)}var XFe="[object String]";function Zh(t){return typeof t=="string"||!qi(t)&&sm(t)&&Kb(t)==XFe}function KFe(t,e){return J3(e,function(n){return t[n]})}function oc(t){return t==null?[]:KFe(t,op(t))}var JFe=Math.max;function ih(t,e,n,r){t=e0(t)?t:oc(t),n=n&&!r?Z3(n):0;var i=t.length;return n<0&&(n=JFe(i+n,0)),Zh(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&v7(t,e,n)>-1}function yQ(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return v7(t,e,i)}var ZFe="[object Map]",QFe="[object Set]",e4e=Object.prototype,t4e=e4e.hasOwnProperty;function ra(t){if(t==null)return!0;if(e0(t)&&(qi(t)||typeof t=="string"||typeof t.splice=="function"||QM(t)||S7(t)||tB(t)))return!t.length;var e=Pf(t);if(e==ZFe||e==QFe)return!t.size;if(MN(t))return!_he(t).length;for(var n in t)if(t4e.call(t,n))return!1;return!0}var n4e="[object RegExp]";function r4e(t){return sm(t)&&Kb(t)==n4e}var _Q=wb&&wb.isRegExp,ry=_Q?nB(_Q):r4e;function iy(t){return t===void 0}var i4e="Expected a function";function s4e(t){if(typeof t!="function")throw new TypeError(i4e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function a4e(t,e,n,r){if(!ap(t))return t;e=sB(e,t);for(var i=-1,s=e.length,a=s-1,o=t;o!=null&&++i<s;){var c=ON(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=a){var u=o[c];l=void 0,l===void 0&&(l=ap(u)?u:Q3(e[i+1])?[]:{})}eB(o,c,l),o=o[c]}return t}function o4e(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var a=e[r],o=w7(t,a);n(o,a)&&a4e(s,sB(a,t),o)}return s}function hm(t,e){if(t==null)return{};var n=J3(A3e(t),function(r){return[r]});return e=t0(e),o4e(t,n,function(r,i){return e(r,i[0])})}function c4e(t,e,n,r,i){return i(t,function(s,a,o){n=r?(r=!1,s):e(n,s,a,o)}),n}function Qh(t,e,n){var r=qi(t)?f3e:c4e,i=arguments.length<3;return r(t,t0(e),n,i,WT)}function oB(t,e){var n=qi(t)?M7:Vhe;return n(t,s4e(t0(e)))}function l4e(t,e){var n;return WT(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function P7(t,e,n){var r=qi(t)?Uhe:l4e;return r(t,t0(e))}var u4e=1/0,h4e=gw&&1/I7(new gw([,-0]))[1]==u4e?function(t){return new gw(t)}:Rc,d4e=200;function f4e(t,e,n){var r=-1,i=dhe,s=t.length,a=!0,o=[],c=o;if(s>=d4e){var l=h4e(t);if(l)return I7(l);a=!1,i=N7,c=new iC}else c=o;e:for(;++r<s;){var u=t[r],h=u;if(u=u!==0?u:0,a&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;o.push(u)}else i(c,h,n)||(c!==o&&c.push(h),o.push(u))}return o}function cB(t){return t&&t.length?f4e(t):[]}function dV(t){console&&console.error&&console.error(`Error: ${t}`)}function qhe(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function $he(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function Whe(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function p4e(t){return m4e(t)?t.LABEL:t.name}function m4e(t){return Zh(t.LABEL)&&t.LABEL!==""}class n0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Or(this.definition,n=>{n.accept(e)})}}class ed extends n0{constructor(e){super([]),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class KC extends n0{constructor(e){super(e.definition),this.orgText="",Jh(this,hm(e,n=>n!==void 0))}}class td extends n0{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Jh(this,hm(e,n=>n!==void 0))}}class Wh extends n0{constructor(e){super(e.definition),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}}class r0 extends n0{constructor(e){super(e.definition),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}}class i0 extends n0{constructor(e){super(e.definition),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}}class Dc extends n0{constructor(e){super(e.definition),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}}class dm extends n0{constructor(e){super(e.definition),this.idx=1,Jh(this,hm(e,n=>n!==void 0))}}class fm extends n0{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Jh(this,hm(e,n=>n!==void 0))}}class Za{constructor(e){this.idx=1,Jh(this,hm(e,n=>n!==void 0))}accept(e){e.visit(this)}}function g4e(t){return Dn(t,aP)}function aP(t){function e(n){return Dn(n,aP)}if(t instanceof ed){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Zh(t.label)&&(n.label=t.label),n}else{if(t instanceof td)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Wh)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof r0)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof i0)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:aP(new Za({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof dm)return{type:"RepetitionWithSeparator",idx:t.idx,separator:aP(new Za({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Dc)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof fm)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Za){const n={type:"Terminal",name:t.terminalType.name,label:p4e(t.terminalType),idx:t.idx};Zh(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=ry(r)?r.source:r),n}else{if(t instanceof KC)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class YT{visit(e){const n=e;switch(n.constructor){case ed:return this.visitNonTerminal(n);case td:return this.visitAlternative(n);case Wh:return this.visitOption(n);case r0:return this.visitRepetitionMandatory(n);case i0:return this.visitRepetitionMandatoryWithSeparator(n);case dm:return this.visitRepetitionWithSeparator(n);case Dc:return this.visitRepetition(n);case fm:return this.visitAlternation(n);case Za:return this.visitTerminal(n);case KC:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function v4e(t){return t instanceof td||t instanceof Wh||t instanceof Dc||t instanceof r0||t instanceof i0||t instanceof dm||t instanceof Za||t instanceof KC}function x2(t,e=[]){return t instanceof Wh||t instanceof Dc||t instanceof dm?!0:t instanceof fm?P7(t.definition,r=>x2(r,e)):t instanceof ed&&ih(e,t)?!1:t instanceof n0?(t instanceof ed&&e.push(t),rm(t.definition,r=>x2(r,e))):!1}function y4e(t){return t instanceof fm}function hg(t){if(t instanceof ed)return"SUBRULE";if(t instanceof Wh)return"OPTION";if(t instanceof fm)return"OR";if(t instanceof r0)return"AT_LEAST_ONE";if(t instanceof i0)return"AT_LEAST_ONE_SEP";if(t instanceof dm)return"MANY_SEP";if(t instanceof Dc)return"MANY";if(t instanceof Za)return"CONSUME";throw Error("non exhaustive match")}class lB{walk(e,n=[]){Or(e.definition,(r,i)=>{const s=Ml(e.definition,i+1);if(r instanceof ed)this.walkProdRef(r,s,n);else if(r instanceof Za)this.walkTerminal(r,s,n);else if(r instanceof td)this.walkFlat(r,s,n);else if(r instanceof Wh)this.walkOption(r,s,n);else if(r instanceof r0)this.walkAtLeastOne(r,s,n);else if(r instanceof i0)this.walkAtLeastOneSep(r,s,n);else if(r instanceof dm)this.walkManySep(r,s,n);else if(r instanceof Dc)this.walkMany(r,s,n);else if(r instanceof fm)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Wh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=bQ(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Wh({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=bQ(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);Or(e.definition,s=>{const a=new td({definition:[s]});this.walk(a,i)})}}function bQ(t,e,n){return[new Wh({definition:[new Za({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function IN(t){if(t instanceof ed)return IN(t.referencedRule);if(t instanceof Za)return E4e(t);if(v4e(t))return _4e(t);if(y4e(t))return b4e(t);throw Error("non exhaustive match")}function _4e(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,a=!0;for(;i&&a;)s=n[r],a=x2(s),e=e.concat(IN(s)),r=r+1,i=n.length>r;return cB(e)}function b4e(t){const e=Dn(t.definition,n=>IN(n));return cB($h(e))}function E4e(t){return[t.terminalType]}const Yhe="_~IN~_";class S4e extends lB{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=x4e(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),a=new td({definition:s}),o=IN(a);this.follows[i]=o}}function T4e(t){const e={};return Or(t,n=>{const r=new S4e(n).startWalking();Jh(e,r)}),e}function x4e(t,e){return t.name+e+Yhe}function Pr(t){return t.charCodeAt(0)}function J8(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function XR(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function s1(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function w4e(){throw Error("Internal Error - Should never get here!")}function EQ(t){return t.type==="Character"}const w2=[];for(let t=Pr("0");t<=Pr("9");t++)w2.push(t);const C2=[Pr("_")].concat(w2);for(let t=Pr("a");t<=Pr("z");t++)C2.push(t);for(let t=Pr("A");t<=Pr("Z");t++)C2.push(t);const SQ=[Pr(" "),Pr("\f"),Pr(`
`),Pr("\r"),Pr("	"),Pr("\v"),Pr("	"),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr(" "),Pr("\u2028"),Pr("\u2029"),Pr(" "),Pr(" "),Pr("　"),Pr("\uFEFF")],C4e=/[0-9a-fA-F]/,Zk=/[0-9]/,R4e=/[1-9]/;class A4e{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":XR(r,"global");break;case"i":XR(r,"ignoreCase");break;case"m":XR(r,"multiLine");break;case"u":XR(r,"unicode");break;case"y":XR(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}s1(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return w4e()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;s1(n);break}if(!(e===!0&&n===void 0)&&s1(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),s1(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Pr(`
`),Pr("\r"),Pr("\u2028"),Pr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=w2;break;case"D":e=w2,n=!0;break;case"s":e=SQ;break;case"S":e=SQ,n=!0;break;case"w":e=C2;break;case"W":e=C2,n=!0;break}if(s1(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Pr("\f");break;case"n":e=Pr(`
`);break;case"r":e=Pr("\r");break;case"t":e=Pr("	");break;case"v":e=Pr("\v");break}if(s1(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Pr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Pr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Pr(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,EQ(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,EQ(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else J8(r.value,e),e.push(Pr("-")),J8(i.value,e)}else J8(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Pr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(R4e.test(e)===!1)throw Error("Expecting a positive integer");for(;Zk.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Zk.test(e)===!1)throw Error("Expecting an integer");for(;Zk.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Pr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Zk.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(C4e.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class L7{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let oP={};const M4e=new A4e;function uB(t){const e=t.toString();if(oP.hasOwnProperty(e))return oP[e];{const n=M4e.pattern(e);return oP[e]=n,n}}function O4e(){oP={}}const Xhe="Complement Sets are not supported for first char optimization",R2=`Unable to use "first char" lexer optimizations:
`;function N4e(t,e=!1){try{const n=uB(t);return fV(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Xhe)e&&qhe(`${R2}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),dV(`${R2}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function fV(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)fV(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const a=s;switch(a.type){case"Character":Qk(a.value,e,n);break;case"Set":if(a.complement===!0)throw Error(Xhe);Or(a.value,c=>{if(typeof c=="number")Qk(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Qk(u,e,n);else{for(let u=l.from;u<=l.to&&u<bA;u++)Qk(u,e,n);if(l.to>=bA){const u=l.from>=bA?l.from:bA,h=l.to,d=Cb(u),f=Cb(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":fV(a.value,e,n);break;default:throw Error("Non Exhaustive Match")}const o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&pV(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return oc(e)}function Qk(t,e,n){const r=Cb(t);e[r]=r,n===!0&&I4e(t,e)}function I4e(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Cb(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Cb(i.charCodeAt(0));e[s]=s}}}function TQ(t,e){return aC(t.value,n=>{if(typeof n=="number")return ih(e,n);{const r=n;return aC(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function pV(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?qi(t.value)?rm(t.value,pV):pV(t.value):!1}class k4e extends L7{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){ih(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?TQ(e,this.targetCharCodes)===void 0&&(this.found=!0):TQ(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function U7(t,e){if(e instanceof RegExp){const n=uB(e),r=new k4e(t);return r.visit(n),r.found}else return aC(e,n=>ih(t,n.charCodeAt(0)))!==void 0}const mT="PATTERN",_A="defaultMode",eD="modes";let Khe=typeof new RegExp("(?:)").sticky=="boolean";function D4e(t,e){e=D7(e,{useSticky:Khe,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(E,T)=>T()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{r6e()});let r;n("Reject Lexer.NA",()=>{r=oB(t,E=>E[mT]===Uc.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Dn(r,E=>{const T=E[mT];if(ry(T)){const x=T.source;return x.length===1&&x!=="^"&&x!=="$"&&x!=="."&&!T.ignoreCase?x:x.length===2&&x[0]==="\\"&&!ih(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],x[1])?x[1]:e.useSticky?wQ(T):xQ(T)}else{if(my(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const x=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),N=new RegExp(x);return e.useSticky?wQ(N):xQ(N)}}else throw Error("non exhaustive match")}})});let a,o,c,l,u;n("misc mapping",()=>{a=Dn(r,E=>E.tokenTypeIdx),o=Dn(r,E=>{const T=E.GROUP;if(T!==Uc.SKIPPED){if(Zh(T))return T;if(iy(T))return!1;throw Error("non exhaustive match")}}),c=Dn(r,E=>{const T=E.LONGER_ALT;if(T)return qi(T)?Dn(T,N=>yQ(r,N)):[yQ(r,T)]}),l=Dn(r,E=>E.PUSH_MODE),u=Dn(r,E=>Er(E,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const E=Qhe(e.lineTerminatorCharacters);h=Dn(r,T=>!1),e.positionTracking!=="onlyOffset"&&(h=Dn(r,T=>Er(T,"LINE_BREAKS")?!!T.LINE_BREAKS:Zhe(T,E)===!1&&U7(E,T.PATTERN)))});let d,f,p,g;n("Misc Mapping #2",()=>{d=Dn(r,Jhe),f=Dn(s,e6e),p=Qh(r,(E,T)=>{const x=T.GROUP;return Zh(x)&&x!==Uc.SKIPPED&&(E[x]=[]),E},{}),g=Dn(s,(E,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:h[T],isCustom:d[T],short:f[T],group:o[T],push:l[T],pop:u[T],tokenTypeIdx:a[T],tokenType:r[T]}))});let _=!0,v=[];return e.safeMode||n("First Char Optimization",()=>{v=Qh(r,(E,T,x)=>{if(typeof T.PATTERN=="string"){const N=T.PATTERN.charCodeAt(0),A=Cb(N);Z8(E,A,g[x])}else if(qi(T.START_CHARS_HINT)){let N;Or(T.START_CHARS_HINT,A=>{const I=typeof A=="string"?A.charCodeAt(0):A,k=Cb(I);N!==k&&(N=k,Z8(E,k,g[x]))})}else if(ry(T.PATTERN))if(T.PATTERN.unicode)_=!1,e.ensureOptimizations&&dV(`${R2}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const N=N4e(T.PATTERN,e.ensureOptimizations);ra(N)&&(_=!1),Or(N,A=>{Z8(E,A,g[x])})}else e.ensureOptimizations&&dV(`${R2}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),_=!1;return E},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:v,hasCustom:i,canBeOptimized:_}}function P4e(t,e){let n=[];const r=U4e(t);n=n.concat(r.errors);const i=B4e(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(L4e(s)),n=n.concat($4e(s)),n=n.concat(W4e(s,e)),n=n.concat(Y4e(s)),n}function L4e(t){let e=[];const n=fp(t,r=>ry(r[mT]));return e=e.concat(z4e(n)),e=e.concat(V4e(n)),e=e.concat(G4e(n)),e=e.concat(q4e(n)),e=e.concat(H4e(n)),e}function U4e(t){const e=fp(t,i=>!Er(i,mT)),n=Dn(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:So.MISSING_PATTERN,tokenTypes:[i]})),r=aB(t,e);return{errors:n,valid:r}}function B4e(t){const e=fp(t,i=>{const s=i[mT];return!ry(s)&&!my(s)&&!Er(s,"exec")&&!Zh(s)}),n=Dn(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:So.INVALID_PATTERN,tokenTypes:[i]})),r=aB(t,e);return{errors:n,valid:r}}const F4e=/[^\\][$]/;function z4e(t){class e extends L7{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=fp(t,i=>{const s=i.PATTERN;try{const a=uB(s),o=new e;return o.visit(a),o.found}catch{return F4e.test(s.source)}});return Dn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:So.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function H4e(t){const e=fp(t,r=>r.PATTERN.test(""));return Dn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:So.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const j4e=/[^\\[][\^]|^\^/;function V4e(t){class e extends L7{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=fp(t,i=>{const s=i.PATTERN;try{const a=uB(s),o=new e;return o.visit(a),o.found}catch{return j4e.test(s.source)}});return Dn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:So.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function G4e(t){const e=fp(t,r=>{const i=r[mT];return i instanceof RegExp&&(i.multiline||i.global)});return Dn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:So.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function q4e(t){const e=[];let n=Dn(t,s=>Qh(t,(a,o)=>(s.PATTERN.source===o.PATTERN.source&&!ih(e,o)&&o.PATTERN!==Uc.NA&&(e.push(o),a.push(o)),a),[]));n=NN(n);const r=fp(n,s=>s.length>1);return Dn(r,s=>{const a=Dn(s,c=>c.name);return{message:`The same RegExp pattern ->${am(s).PATTERN}<-has been used in all of the following Token Types: ${a.join(", ")} <-`,type:So.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function $4e(t){const e=fp(t,r=>{if(!Er(r,"GROUP"))return!1;const i=r.GROUP;return i!==Uc.SKIPPED&&i!==Uc.NA&&!Zh(i)});return Dn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:So.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function W4e(t,e){const n=fp(t,i=>i.PUSH_MODE!==void 0&&!ih(e,i.PUSH_MODE));return Dn(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:So.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Y4e(t){const e=[],n=Qh(t,(r,i,s)=>{const a=i.PATTERN;return a===Uc.NA||(Zh(a)?r.push({str:a,idx:s,tokenType:i}):ry(a)&&K4e(a)&&r.push({str:a.source,idx:s,tokenType:i})),r},[]);return Or(t,(r,i)=>{Or(n,({str:s,idx:a,tokenType:o})=>{if(i<a&&X4e(s,r.PATTERN)){const c=`Token: ->${o.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:So.UNREACHABLE_PATTERN,tokenTypes:[r,o]})}})}),e}function X4e(t,e){if(ry(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(my(e))return e(t,0,[],{});if(Er(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function K4e(t){return aC([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function xQ(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function wQ(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function J4e(t,e,n){const r=[];return Er(t,_A)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+_A+`> property in its definition
`,type:So.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Er(t,eD)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+eD+`> property in its definition
`,type:So.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Er(t,eD)&&Er(t,_A)&&!Er(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${_A}: <${t.defaultMode}>which does not exist
`,type:So.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Er(t,eD)&&Or(t.modes,(i,s)=>{Or(i,(a,o)=>{if(iy(a))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${o}>
`,type:So.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Er(a,"LONGER_ALT")){const c=qi(a.LONGER_ALT)?a.LONGER_ALT:[a.LONGER_ALT];Or(c,l=>{!iy(l)&&!ih(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${a.name}> outside of mode <${s}>
`,type:So.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Z4e(t,e,n){const r=[];let i=!1;const s=NN($h(oc(t.modes))),a=oB(s,c=>c[mT]===Uc.NA),o=Qhe(n);return e&&Or(a,c=>{const l=Zhe(c,o);if(l!==!1){const h={message:n6e(c,l),type:l.issue,tokenType:c};r.push(h)}else Er(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):U7(o,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:So.NO_LINE_BREAKS_FLAGS}),r}function Q4e(t){const e={},n=op(t);return Or(n,r=>{const i=t[r];if(qi(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Jhe(t){const e=t.PATTERN;if(ry(e))return!1;if(my(e))return!0;if(Er(e,"exec"))return!0;if(Zh(e))return!1;throw Error("non exhaustive match")}function e6e(t){return Zh(t)&&t.length===1?t.charCodeAt(0):!1}const t6e={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Zhe(t,e){if(Er(t,"LINE_BREAKS"))return!1;if(ry(t.PATTERN)){try{U7(e,t.PATTERN)}catch(n){return{issue:So.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Zh(t.PATTERN))return!1;if(Jhe(t))return{issue:So.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function n6e(t,e){if(e.issue===So.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===So.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Qhe(t){return Dn(t,n=>Zh(n)?n.charCodeAt(0):n)}function Z8(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const bA=256;let cP=[];function Cb(t){return t<bA?t:cP[t]}function r6e(){if(ra(cP)){cP=new Array(65536);for(let t=0;t<65536;t++)cP[t]=t>255?255+~~(t/255):t}}function kN(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function A2(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let CQ=1;const ede={};function DN(t){const e=i6e(t);s6e(e),o6e(e),a6e(e),Or(e,n=>{n.isParent=n.categoryMatches.length>0})}function i6e(t){let e=Bl(t),n=t,r=!0;for(;r;){n=NN($h(Dn(n,s=>s.CATEGORIES)));const i=aB(n,e);e=e.concat(i),ra(i)?r=!1:n=i}return e}function s6e(t){Or(t,e=>{nde(e)||(ede[CQ]=e,e.tokenTypeIdx=CQ++),RQ(e)&&!qi(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),RQ(e)||(e.CATEGORIES=[]),c6e(e)||(e.categoryMatches=[]),l6e(e)||(e.categoryMatchesMap={})})}function a6e(t){Or(t,e=>{e.categoryMatches=[],Or(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(ede[r].tokenTypeIdx)})})}function o6e(t){Or(t,e=>{tde([],e)})}function tde(t,e){Or(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),Or(e.CATEGORIES,n=>{const r=t.concat(e);ih(r,n)||tde(r,n)})}function nde(t){return Er(t,"tokenTypeIdx")}function RQ(t){return Er(t,"CATEGORIES")}function c6e(t){return Er(t,"categoryMatches")}function l6e(t){return Er(t,"categoryMatchesMap")}function u6e(t){return Er(t,"tokenTypeIdx")}const h6e={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var So;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(So||(So={}));const EA={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:h6e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(EA);let Uc=class{constructor(e,n=EA){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const a=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${a}--> <${i}>`);const{time:o,value:c}=$he(s),l=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${a}<-- <${i}> time: ${o}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Jh({},EA,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===EA.lineTerminatorsPattern)this.config.lineTerminatorsPattern=t6e;else if(this.config.lineTerminatorCharacters===EA.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),qi(e)?i={modes:{defaultMode:Bl(e)},defaultMode:_A}:(s=!1,i=Bl(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(J4e(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Z4e(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Or(i.modes,(o,c)=>{i.modes[c]=oB(o,l=>iy(l))});const a=op(i.modes);if(Or(i.modes,(o,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(P4e(o,a))}),ra(this.lexerDefinitionErrors)){DN(o);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=D4e(o,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Jh({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ra(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Dn(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Or(this.lexerDefinitionWarning,o=>{qhe(o.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Khe?(this.chopInput=rC,this.match=this.matchWithTest):(this.updateLastIndex=Rc,this.match=this.matchWithExec),s&&(this.handleModes=Rc),this.trackStartLines===!1&&(this.computeNewColumn=rC),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Rc),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const o=Qh(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ra(o))throw Error(`Lexer Modes: < ${o.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{O4e()}),this.TRACE_INIT("toFastProperties",()=>{Whe(this)})})}tokenize(e,n=this.defaultMode){if(!ra(this.lexerDefinitionErrors)){const i=Dn(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,a,o,c,l,u,h,d,f,p,g,_,v;const E=e,T=E.length;let x=0,N=0;const A=this.hasCustom?0:Math.floor(e.length/10),I=new Array(A),k=[];let L=this.trackStartLines?1:void 0,U=this.trackStartLines?1:void 0;const $=Q4e(this.emptyGroups),q=this.trackStartLines,G=this.config.lineTerminatorsPattern;let X=0,re=[],V=[];const Z=[],Y=[];Object.freeze(Y);let ee;function oe(){return re}function de(we){const Ce=Cb(we),ke=V[Ce];return ke===void 0?Y:ke}const Me=we=>{if(Z.length===1&&we.tokenType.PUSH_MODE===void 0){const Ce=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(we);k.push({offset:we.startOffset,line:we.startLine,column:we.startColumn,length:we.image.length,message:Ce})}else{Z.pop();const Ce=sC(Z);re=this.patternIdxToConfig[Ce],V=this.charCodeToPatternIdxToConfig[Ce],X=re.length;const ke=this.canModeBeOptimized[Ce]&&this.config.safeMode===!1;V&&ke?ee=de:ee=oe}};function He(we){Z.push(we),V=this.charCodeToPatternIdxToConfig[we],re=this.patternIdxToConfig[we],X=re.length,X=re.length;const Ce=this.canModeBeOptimized[we]&&this.config.safeMode===!1;V&&Ce?ee=de:ee=oe}He.call(this,n);let Te;const Le=this.config.recoveryEnabled;for(;x<T;){c=null;const we=E.charCodeAt(x),Ce=ee(we),ke=Ce.length;for(r=0;r<ke;r++){Te=Ce[r];const St=Te.pattern;l=null;const At=Te.short;if(At!==!1?we===At&&(c=St):Te.isCustom===!0?(v=St.exec(E,x,I,$),v!==null?(c=v[0],v.payload!==void 0&&(l=v.payload)):c=null):(this.updateLastIndex(St,x),c=this.match(St,e,x)),c!==null){if(o=Te.longerAlt,o!==void 0){const Ee=o.length;for(s=0;s<Ee;s++){const ye=re[o[s]],et=ye.pattern;if(u=null,ye.isCustom===!0?(v=et.exec(E,x,I,$),v!==null?(a=v[0],v.payload!==void 0&&(u=v.payload)):a=null):(this.updateLastIndex(et,x),a=this.match(et,e,x)),a&&a.length>c.length){c=a,l=u,Te=ye;break}}}break}}if(c!==null){if(h=c.length,d=Te.group,d!==void 0&&(f=Te.tokenTypeIdx,p=this.createTokenInstance(c,x,f,Te.tokenType,L,U,h),this.handlePayload(p,l),d===!1?N=this.addToken(I,N,p):$[d].push(p)),e=this.chopInput(e,h),x=x+h,U=this.computeNewColumn(U,h),q===!0&&Te.canLineTerminator===!0){let St=0,At,Ee;G.lastIndex=0;do At=G.test(c),At===!0&&(Ee=G.lastIndex-1,St++);while(At===!0);St!==0&&(L=L+St,U=h-Ee,this.updateTokenEndLineColumnLocation(p,d,Ee,St,L,U,h))}this.handleModes(Te,Me,He,p)}else{const St=x,At=L,Ee=U;let ye=Le===!1;for(;ye===!1&&x<T;)for(e=this.chopInput(e,1),x++,i=0;i<X;i++){const et=re[i],fe=et.pattern,Fe=et.short;if(Fe!==!1?E.charCodeAt(x)===Fe&&(ye=!0):et.isCustom===!0?ye=fe.exec(E,x,I,$)!==null:(this.updateLastIndex(fe,x),ye=fe.exec(e)!==null),ye===!0)break}if(g=x-St,U=this.computeNewColumn(U,g),_=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(E,St,g,At,Ee),k.push({offset:St,line:At,column:Ee,length:g,message:_}),Le===!1)break}}return this.hasCustom||(I.length=N),{tokens:I,groups:$,errors:k}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,a,o){let c,l;n!==void 0&&(c=r===o-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=a-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,a){return{image:e,startOffset:n,startLine:s,startColumn:a,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,a,o){return{image:e,startOffset:n,endOffset:n+o-1,startLine:s,endLine:s,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Uc.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Uc.NA=/NOT_APPLICABLE/;function tM(t){return rde(t)?t.LABEL:t.name}function rde(t){return Zh(t.LABEL)&&t.LABEL!==""}const d6e="parent",AQ="categories",MQ="label",OQ="group",NQ="push_mode",IQ="pop_mode",kQ="longer_alt",DQ="line_breaks",PQ="start_chars_hint";function Qd(t){return f6e(t)}function f6e(t){const e=t.pattern,n={};if(n.name=t.name,iy(e)||(n.PATTERN=e),Er(t,d6e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Er(t,AQ)&&(n.CATEGORIES=t[AQ]),DN([n]),Er(t,MQ)&&(n.LABEL=t[MQ]),Er(t,OQ)&&(n.GROUP=t[OQ]),Er(t,IQ)&&(n.POP_MODE=t[IQ]),Er(t,NQ)&&(n.PUSH_MODE=t[NQ]),Er(t,kQ)&&(n.LONGER_ALT=t[kQ]),Er(t,DQ)&&(n.LINE_BREAKS=t[DQ]),Er(t,PQ)&&(n.START_CHARS_HINT=t[PQ]),n}const gT=Qd({name:"EOF",pattern:Uc.NA});DN([gT]);function PN(t,e,n,r,i,s,a,o){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:a,endColumn:o,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function p6e(t,e){return kN(t,e)}const ide={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${rde(t)?`--> ${tM(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",o=`
but found: '`+am(e).image+"'";if(r)return s+r+o;{const c=Qh(t,(d,f)=>d.concat(f),[]),l=Dn(c,d=>`[${Dn(d,f=>tM(f)).join(", ")}]`),h=`one of these possible Token sequences:
${Dn(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+o}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",a=`
but found: '`+am(e).image+"'";if(n)return i+n+a;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Dn(t,l=>`[${Dn(l,u=>tM(u)).join(",")}]`).join(" ,")}>`;return i+c+a}}};Object.freeze(ide);const m6e={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},PS={buildDuplicateFoundError(t,e){function n(u){return u instanceof Za?u.terminalType.name:u instanceof ed?u.nonTerminalName:""}const r=t.name,i=am(e),s=i.idx,a=hg(i),o=n(i),c=s>0;let l=`->${a}${c?s:""}<- ${o?`with argument: ->${o}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Dn(t.prefixPath,i=>tM(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Dn(t.prefixPath,i=>tM(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=hg(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Dn(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof KC?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function g6e(t,e){const n=new v6e(t,e);return n.resolveRefs(),n.errors}class v6e extends YT{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Or(oc(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Qu.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class y6e extends lB{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Bl(this.path.ruleStack).reverse(),this.occurrenceStack=Bl(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ra(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class _6e extends y6e{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new td({definition:i});this.possibleTokTypes=IN(s),this.found=!0}}}class hB extends lB{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class b6e extends hB{walkMany(e,n,r){if(e.idx===this.occurrence){const i=am(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Za&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class LQ extends hB{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=am(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Za&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class E6e extends hB{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=am(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Za&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class UQ extends hB{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=am(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Za&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function mV(t,e,n=[]){n=Bl(n);let r=[],i=0;function s(o){return o.concat(Ml(t,i+1))}function a(o){const c=mV(s(o),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const o=t[i];if(o instanceof td)return a(o.definition);if(o instanceof ed)return a(o.definition);if(o instanceof Wh)r=a(o.definition);else if(o instanceof r0){const c=o.definition.concat([new Dc({definition:o.definition})]);return a(c)}else if(o instanceof i0){const c=[new td({definition:o.definition}),new Dc({definition:[new Za({terminalType:o.separator})].concat(o.definition)})];return a(c)}else if(o instanceof dm){const c=o.definition.concat([new Dc({definition:[new Za({terminalType:o.separator})].concat(o.definition)})]);r=a(c)}else if(o instanceof Dc){const c=o.definition.concat([new Dc({definition:o.definition})]);r=a(c)}else{if(o instanceof fm)return Or(o.definition,c=>{ra(c.definition)===!1&&(r=a(c.definition))}),r;if(o instanceof Za)n.push(o.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ml(t,i)}),r}function sde(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],a="EXIT_ALTERNATIVE";let o=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!ra(h);){const d=h.pop();if(d===a){o&&sC(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,g=d.ruleStack,_=d.occurrenceStack;if(ra(f))continue;const v=f[0];if(v===i){const E={idx:p,def:Ml(f),ruleStack:nO(g),occurrenceStack:nO(_)};h.push(E)}else if(v instanceof Za)if(p<c-1){const E=p+1,T=e[E];if(n(T,v.terminalType)){const x={idx:E,def:Ml(f),ruleStack:g,occurrenceStack:_};h.push(x)}}else if(p===c-1)u.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:g,occurrenceStack:_}),o=!0;else throw Error("non exhaustive match");else if(v instanceof ed){const E=Bl(g);E.push(v.nonTerminalName);const T=Bl(_);T.push(v.idx);const x={idx:p,def:v.definition.concat(s,Ml(f)),ruleStack:E,occurrenceStack:T};h.push(x)}else if(v instanceof Wh){const E={idx:p,def:Ml(f),ruleStack:g,occurrenceStack:_};h.push(E),h.push(a);const T={idx:p,def:v.definition.concat(Ml(f)),ruleStack:g,occurrenceStack:_};h.push(T)}else if(v instanceof r0){const E=new Dc({definition:v.definition,idx:v.idx}),T=v.definition.concat([E],Ml(f)),x={idx:p,def:T,ruleStack:g,occurrenceStack:_};h.push(x)}else if(v instanceof i0){const E=new Za({terminalType:v.separator}),T=new Dc({definition:[E].concat(v.definition),idx:v.idx}),x=v.definition.concat([T],Ml(f)),N={idx:p,def:x,ruleStack:g,occurrenceStack:_};h.push(N)}else if(v instanceof dm){const E={idx:p,def:Ml(f),ruleStack:g,occurrenceStack:_};h.push(E),h.push(a);const T=new Za({terminalType:v.separator}),x=new Dc({definition:[T].concat(v.definition),idx:v.idx}),N=v.definition.concat([x],Ml(f)),A={idx:p,def:N,ruleStack:g,occurrenceStack:_};h.push(A)}else if(v instanceof Dc){const E={idx:p,def:Ml(f),ruleStack:g,occurrenceStack:_};h.push(E),h.push(a);const T=new Dc({definition:v.definition,idx:v.idx}),x=v.definition.concat([T],Ml(f)),N={idx:p,def:x,ruleStack:g,occurrenceStack:_};h.push(N)}else if(v instanceof fm)for(let E=v.definition.length-1;E>=0;E--){const T=v.definition[E],x={idx:p,def:T.definition.concat(Ml(f)),ruleStack:g,occurrenceStack:_};h.push(x),h.push(a)}else if(v instanceof td)h.push({idx:p,def:v.definition.concat(Ml(f)),ruleStack:g,occurrenceStack:_});else if(v instanceof KC)h.push(S6e(v,p,g,_));else throw Error("non exhaustive match")}return u}function S6e(t,e,n,r){const i=Bl(n);i.push(t.name);const s=Bl(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var yo;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(yo||(yo={}));function ade(t){if(t instanceof Wh||t==="Option")return yo.OPTION;if(t instanceof Dc||t==="Repetition")return yo.REPETITION;if(t instanceof r0||t==="RepetitionMandatory")return yo.REPETITION_MANDATORY;if(t instanceof i0||t==="RepetitionMandatoryWithSeparator")return yo.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof dm||t==="RepetitionWithSeparator")return yo.REPETITION_WITH_SEPARATOR;if(t instanceof fm||t==="Alternation")return yo.ALTERNATION;throw Error("non exhaustive match")}function T6e(t,e,n,r,i,s){const a=B7(t,e,n),o=lde(a)?A2:kN;return s(a,r,o,i)}function x6e(t,e,n,r,i,s){const a=F7(t,e,i,n),o=lde(a)?A2:kN;return s(a[0],o,r)}function w6e(t,e,n,r){const i=t.length,s=rm(t,a=>rm(a,o=>o.length===1));if(e)return function(a){const o=Dn(a,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=o[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let g=0;g<p;g++){const _=this.LA(g+1);if(n(_,f[g])===!1)continue e}return c}}};if(s&&!r){const a=Dn(t,c=>$h(c)),o=Qh(a,(c,l,u)=>(Or(l,h=>{Er(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Or(h.categoryMatches,d=>{Er(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return o[c.tokenTypeIdx]}}else return function(){for(let a=0;a<i;a++){const o=t[a],c=o.length;e:for(let l=0;l<c;l++){const u=o[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return a}}}}function C6e(t,e,n){const r=rm(t,s=>s.length===1),i=t.length;if(r&&!n){const s=$h(t);if(s.length===1&&ra(s[0].categoryMatches)){const o=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{const a=Qh(s,(o,c,l)=>(o[c.tokenTypeIdx]=!0,Or(c.categoryMatches,u=>{o[u]=!0}),o),[]);return function(){const o=this.LA(1);return a[o.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const a=t[s],o=a.length;for(let c=0;c<o;c++){const l=this.LA(c+1);if(e(l,a[c])===!1)continue e}return!0}return!1}}class R6e extends lB{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,yo.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,yo.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,yo.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,yo.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class ode extends YT{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,yo.OPTION)}visitRepetition(e){this.checkIsTarget(e,yo.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,yo.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,yo.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,yo.ALTERNATION)}}function BQ(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Q8(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const a=e[s];i.push(a+"_"+r.tokenTypeIdx);for(let o=0;o<r.categoryMatches.length;o++){const c="_"+r.categoryMatches[o];i.push(a+c)}}e=i}return e}function A6e(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const a=e[s];if(i[a]===!0)return!1}}return!0}function cde(t,e){const n=Dn(t,a=>mV([a],1)),r=BQ(n.length),i=Dn(n,a=>{const o={};return Or(a,c=>{const l=Q8(c.partialPath);Or(l,u=>{o[u]=!0})}),o});let s=n;for(let a=1;a<=e;a++){const o=s;s=BQ(o.length);for(let c=0;c<o.length;c++){const l=o[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=Q8(h);if(A6e(i,f,c)||ra(d)||h.length===e){const g=r[c];if(gV(g,h)===!1){g.push(h);for(let _=0;_<f.length;_++){const v=f[_];i[c][v]=!0}}}else{const g=mV(d,a+1,h);s[c]=s[c].concat(g),Or(g,_=>{const v=Q8(_.partialPath);Or(v,E=>{i[c][E]=!0})})}}}}return r}function B7(t,e,n,r){const i=new ode(t,yo.ALTERNATION,r);return e.accept(i),cde(i.result,n)}function F7(t,e,n,r){const i=new ode(t,n);e.accept(i);const s=i.result,o=new R6e(e,t,n).startWalking(),c=new td({definition:s}),l=new td({definition:o});return cde([c,l],r)}function gV(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],a=r[i];if((s===a||a.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function M6e(t,e){return t.length<e.length&&rm(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function lde(t){return rm(t,e=>rm(e,n=>rm(n,r=>ra(r.categoryMatches))))}function O6e(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Dn(e,n=>Object.assign({type:Qu.CUSTOM_LOOKAHEAD_VALIDATION},n))}function N6e(t,e,n,r){const i=ep(t,c=>I6e(c,n)),s=G6e(t,e,n),a=ep(t,c=>z6e(c,n)),o=ep(t,c=>P6e(c,t,r,n));return i.concat(s,a,o)}function I6e(t,e){const n=new D6e;t.accept(n);const r=n.allProductions,i=Ghe(r,k6e),s=hm(i,o=>o.length>1);return Dn(oc(s),o=>{const c=am(o),l=e.buildDuplicateFoundError(t,o),u=hg(c),h={message:l,type:Qu.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=ude(c);return d&&(h.parameter=d),h})}function k6e(t){return`${hg(t)}_#_${t.idx}_#_${ude(t)}`}function ude(t){return t instanceof Za?t.terminalType.name:t instanceof ed?t.nonTerminalName:""}class D6e extends YT{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function P6e(t,e,n,r){const i=[];if(Qh(e,(a,o)=>o.name===t.name?a+1:a,0)>1){const a=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:a,type:Qu.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function L6e(t,e,n){const r=[];let i;return ih(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Qu.INVALID_RULE_OVERRIDE,ruleName:t})),r}function hde(t,e,n,r=[]){const i=[],s=lP(e.definition);if(ra(s))return[];{const a=t.name;ih(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Qu.LEFT_RECURSION,ruleName:a});const c=aB(s,r.concat([t])),l=ep(c,u=>{const h=Bl(r);return h.push(u),hde(t,u,n,h)});return i.concat(l)}}function lP(t){let e=[];if(ra(t))return e;const n=am(t);if(n instanceof ed)e.push(n.referencedRule);else if(n instanceof td||n instanceof Wh||n instanceof r0||n instanceof i0||n instanceof dm||n instanceof Dc)e=e.concat(lP(n.definition));else if(n instanceof fm)e=$h(Dn(n.definition,s=>lP(s.definition)));else if(!(n instanceof Za))throw Error("non exhaustive match");const r=x2(n),i=t.length>1;if(r&&i){const s=Ml(t);return e.concat(lP(s))}else return e}class z7 extends YT{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function U6e(t,e){const n=new z7;t.accept(n);const r=n.alternations;return ep(r,s=>{const a=nO(s.definition);return ep(a,(o,c)=>{const l=sde([o],[],kN,1);return ra(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Qu.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function B6e(t,e,n){const r=new z7;t.accept(r);let i=r.alternations;return i=oB(i,a=>a.ignoreAmbiguities===!0),ep(i,a=>{const o=a.idx,c=a.maxLookahead||e,l=B7(o,t,c,a),u=j6e(l,a,t,n),h=V6e(l,a,t,n);return u.concat(h)})}class F6e extends YT{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function z6e(t,e){const n=new z7;t.accept(n);const r=n.alternations;return ep(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Qu.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function H6e(t,e,n){const r=[];return Or(t,i=>{const s=new F6e;i.accept(s);const a=s.allProductions;Or(a,o=>{const c=ade(o),l=o.maxLookahead||e,u=o.idx,d=F7(u,i,c,l)[0];if(ra($h(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:o});r.push({message:f,type:Qu.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function j6e(t,e,n,r){const i=[],s=Qh(t,(o,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Or(c,u=>{const h=[l];Or(t,(d,f)=>{l!==f&&gV(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!gV(i,u)&&(i.push(u),o.push({alts:h,path:u}))}),o),[]);return Dn(s,o=>{const c=Dn(o.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:o.path}),type:Qu.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:o.alts}})}function V6e(t,e,n,r){const i=Qh(t,(a,o,c)=>{const l=Dn(o,u=>({idx:c,path:u}));return a.concat(l)},[]);return NN(ep(i,a=>{if(e.definition[a.idx].ignoreAmbiguities===!0)return[];const c=a.idx,l=a.path,u=fp(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&M6e(d.path,l));return Dn(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:Qu.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function G6e(t,e,n){const r=[],i=Dn(e,s=>s.name);return Or(t,s=>{const a=s.name;if(ih(i,a)){const o=n.buildNamespaceConflictError(s);r.push({message:o,type:Qu.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function q6e(t){const e=D7(t,{errMsgProvider:m6e}),n={};return Or(t.rules,r=>{n[r.name]=r}),g6e(n,e.errMsgProvider)}function $6e(t){return t=D7(t,{errMsgProvider:PS}),N6e(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const dde="MismatchedTokenException",fde="NoViableAltException",pde="EarlyExitException",mde="NotAllInputParsedException",gde=[dde,fde,pde,mde];Object.freeze(gde);function M2(t){return ih(gde,t.name)}class dB extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class vde extends dB{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=dde}}class W6e extends dB{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=fde}}class Y6e extends dB{constructor(e,n){super(e,n),this.name=mde}}class X6e extends dB{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=pde}}const eH={},yde="InRuleRecoveryException";class K6e extends Error{constructor(e){super(e),this.name=yde}}class J6e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Er(e,"recoveryEnabled")?e.recoveryEnabled:sy.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Z6e)}getTokenToInsert(e){const n=PN(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),a=this.exportLexerState(),o=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new vde(f,l,this.LA(0));p.resyncedTokens=nO(o),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,o));this.importLexerState(a)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new K6e("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||ra(n))return!1;const r=this.LA(1);return aC(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return ih(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=aC(e,s=>p6e(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return eH;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Dn(e,(r,i)=>i===0?eH:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Dn(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return $h(e)}getFollowSetFromFollowKey(e){if(e===eH)return[gT];const n=e.ruleName+e.idxInCallingRule+Yhe+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,gT)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return nO(n)}attemptInRepetitionRecovery(e,n,r,i,s,a,o){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Bl(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Dn(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Z6e(t,e,n,r,i,s,a){const o=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[o];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[o]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=gT,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,a)&&this.tryInRepetitionRecovery(t,e,n,l)}const Q6e=4,Jb=8,_de=1<<Jb,bde=2<<Jb,vV=3<<Jb,yV=4<<Jb,_V=5<<Jb,uP=6<<Jb;function tH(t,e,n){return n|e|t}class eze{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:sy.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(ra(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return ep(e,n=>hde(n,n,PS))}validateEmptyOrAlternatives(e){return ep(e,n=>U6e(n,PS))}validateAmbiguousAlternationAlternatives(e,n){return ep(e,r=>B6e(r,n,PS))}validateSomeNonEmptyLookaheadPath(e,n){return H6e(e,n,PS)}buildLookaheadForAlternation(e){return T6e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,w6e)}buildLookaheadForOptional(e){return x6e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,ade(e.prodType),C6e)}}class tze{initLooksAhead(e){this.dynamicTokensEnabled=Er(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:sy.dynamicTokensEnabled,this.maxLookahead=Er(e,"maxLookahead")?e.maxLookahead:sy.maxLookahead,this.lookaheadStrategy=Er(e,"lookaheadStrategy")?e.lookaheadStrategy:new eze({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Or(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:a,repetitionMandatoryWithSeparator:o,repetitionWithSeparator:c}=rze(n);Or(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${hg(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=tH(this.fullRuleNameToShort[n.name],_de,l.idx);this.setLaFuncCache(d,h)})}),Or(i,l=>{this.computeLookaheadFunc(n,l.idx,vV,"Repetition",l.maxLookahead,hg(l))}),Or(s,l=>{this.computeLookaheadFunc(n,l.idx,bde,"Option",l.maxLookahead,hg(l))}),Or(a,l=>{this.computeLookaheadFunc(n,l.idx,yV,"RepetitionMandatory",l.maxLookahead,hg(l))}),Or(o,l=>{this.computeLookaheadFunc(n,l.idx,uP,"RepetitionMandatoryWithSeparator",l.maxLookahead,hg(l))}),Or(c,l=>{this.computeLookaheadFunc(n,l.idx,_V,"RepetitionWithSeparator",l.maxLookahead,hg(l))})})})}computeLookaheadFunc(e,n,r,i,s,a){this.TRACE_INIT(`${a}${n===0?"":n}`,()=>{const o=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=tH(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,o)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return tH(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class nze extends YT{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const tD=new nze;function rze(t){tD.reset(),t.accept(tD);const e=tD.dslMethods;return tD.reset(),e}function FQ(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function zQ(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function ize(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function sze(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const aze="name";function Ede(t,e){Object.defineProperty(t,aze,{enumerable:!1,configurable:!0,writable:!1,value:e})}function oze(t,e){const n=op(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],a=t[s],o=a.length;for(let c=0;c<o;c++){const l=a[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function cze(t,e){const n=function(){};Ede(n,t+"BaseSemantics");const r={visit:function(i,s){if(qi(i)&&(i=i[0]),!iy(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=uze(this,e);if(!ra(i)){const s=Dn(i,a=>a.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function lze(t,e,n){const r=function(){};Ede(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Or(e,s=>{i[s]=oze}),r.prototype=i,r.prototype.constructor=r,r}var bV;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(bV||(bV={}));function uze(t,e){return hze(t,e)}function hze(t,e){const n=fp(e,i=>my(t[i])===!1),r=Dn(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:bV.MISSING_METHOD,methodName:i}));return NN(r)}class dze{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Er(e,"nodeLocationTracking")?e.nodeLocationTracking:sy.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Rc,this.cstFinallyStateUpdate=Rc,this.cstPostTerminal=Rc,this.cstPostNonTerminal=Rc,this.cstPostRule=Rc;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=zQ,this.setNodeLocationFromNode=zQ,this.cstPostRule=Rc,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Rc,this.setNodeLocationFromNode=Rc,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=FQ,this.setNodeLocationFromNode=FQ,this.cstPostRule=Rc,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Rc,this.setNodeLocationFromNode=Rc,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Rc,this.setNodeLocationFromNode=Rc,this.cstPostRule=Rc,this.setInitialNodeLocation=Rc;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];ize(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];sze(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(iy(this.baseCstVisitorConstructor)){const e=cze(this.className,op(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(iy(this.baseCstVisitorWithDefaultsConstructor)){const e=lze(this.className,op(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class fze{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):N2}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?N2:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class pze{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=I2){if(ih(this.definedRulesNames,e)){const a={message:PS.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Qu.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(a)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=I2){const i=L6e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(M2(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return g4e(oc(this.gastProductionsCache))}}class mze{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=A2,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Er(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(qi(e)){if(ra(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(qi(e))this.tokensMap=Qh(e,(s,a)=>(s[a.name]=a,s),{});else if(Er(e,"modes")&&rm($h(oc(e.modes)),u6e)){const s=$h(oc(e.modes)),a=cB(s);this.tokensMap=Qh(a,(o,c)=>(o[c.name]=c,o),{})}else if(ap(e))this.tokensMap=Bl(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=gT;const r=Er(e,"modes")?$h(oc(e.modes)):oc(e),i=rm(r,s=>ra(s.categoryMatches));this.tokenMatcher=i?A2:kN,DN(oc(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Er(r,"resyncEnabled")?r.resyncEnabled:I2.resyncEnabled,s=Er(r,"recoveryValueFunc")?r.recoveryValueFunc:I2.recoveryValueFunc,a=this.ruleShortNameIdx<<Q6e+Jb;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;let o;return this.outputCst===!0?o=function(...u){try{this.ruleInvocationStateUpdate(a,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:o=function(...u){try{return this.ruleInvocationStateUpdate(a,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(o,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(M2(e)){const a=e;if(s){const o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,a.partialCstResult=c}throw a}}else{if(i)return this.moveToTerminatedState(),r(e);throw a}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(bde,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const a=e.GATE;if(a!==void 0){const o=i;i=()=>a.call(this)&&o.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(yV,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const o=i;i=()=>a.call(this)&&o.call(this)}}else s=n;if(i.call(this)===!0){let a=this.doSingleRepetition(s);for(;i.call(this)===!0&&a===!0;)a=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,yo.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,yV,e,E6e)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(uP,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const o=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,o,i,UQ],o,uP,e,UQ)}else throw this.raiseEarlyExitException(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(vV,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const c=i;i=()=>o.call(this)&&c.call(this)}}else s=n;let a=!0;for(;i.call(this)===!0&&a===!0;)a=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,vV,e,b6e,a)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(_V,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const o=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,o,i,LQ],o,_V,e,LQ)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,uP,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(_de,n),i=qi(e)?e:e.DEF,a=this.getLaFuncFromCache(r).call(this,i);if(a!==void 0)return i[a].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Y6e(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw M2(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new vde(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===yde?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Bl(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),gT)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class gze{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Er(e,"errorMessageProvider")?e.errorMessageProvider:sy.errorMessageProvider}SAVE_ERROR(e){if(M2(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Bl(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Bl(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],o=F7(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new X6e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=B7(e,i,this.maxLookahead),a=[];for(let l=1;l<=this.maxLookahead;l++)a.push(this.LA(l));const o=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:a,previous:o,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new W6e(c,this.LA(1),o))}}class vze{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(iy(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return sde([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=am(e.ruleStack),i=this.getGAstProductions()[n];return new _6e(i,e).startWalking()}}const fB={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(fB);const HQ=!0,jQ=Math.pow(2,Jb)-1,Sde=Qd({name:"RECORDING_PHASE_TOKEN",pattern:Uc.NA});DN([Sde]);const Tde=PN(Sde,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Tde);const yze={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class _ze{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return N2}topLevelRuleRecord(e,n){try{const r=new KC({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return KR.call(this,Wh,e,n)}atLeastOneInternalRecord(e,n){KR.call(this,r0,n,e)}atLeastOneSepFirstInternalRecord(e,n){KR.call(this,i0,n,e,HQ)}manyInternalRecord(e,n){KR.call(this,Dc,n,e)}manySepFirstInternalRecord(e,n){KR.call(this,dm,n,e,HQ)}orInternalRecord(e,n){return bze.call(this,e,n)}subruleInternalRecord(e,n,r){if(O2(n),!e||Er(e,"ruleName")===!1){const o=new Error(`<SUBRULE${VQ(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=sC(this.recordingProdStack),s=e.ruleName,a=new ed({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(a),this.outputCst?yze:fB}consumeInternalRecord(e,n,r){if(O2(n),!nde(e)){const a=new Error(`<CONSUME${VQ(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=sC(this.recordingProdStack),s=new Za({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),Tde}}function KR(t,e,n,r=!1){O2(n);const i=sC(this.recordingProdStack),s=my(e)?e:e.DEF,a=new t({definition:[],idx:n});return r&&(a.separator=e.SEP),Er(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),s.call(this),i.definition.push(a),this.recordingProdStack.pop(),fB}function bze(t,e){O2(e);const n=sC(this.recordingProdStack),r=qi(t)===!1,i=r===!1?t:t.DEF,s=new fm({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});Er(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const a=P7(i,o=>my(o.GATE));return s.hasPredicates=a,n.definition.push(s),Or(i,o=>{const c=new td({definition:[]});s.definition.push(c),Er(o,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=o.IGNORE_AMBIGUITIES:Er(o,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),o.ALT.call(this),this.recordingProdStack.pop()}),fB}function VQ(t){return t===0?"":`${t}`}function O2(t){if(t<0||t>jQ){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${jQ+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class Eze{initPerformanceTracer(e){if(Er(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=sy.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=$he(n),a=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&a(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function Sze(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const N2=PN(gT,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(N2);const sy=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:ide,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),I2=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Qu;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Qu||(Qu={}));let H7=class xde{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Whe(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Or(this.definedRulesNames,i=>{const a=this[i].originalGrammarAction;let o;this.TRACE_INIT(`${i} Rule`,()=>{o=this.topLevelRuleRecord(i,a)}),this.gastProductionsCache[i]=o})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=q6e({rules:oc(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ra(r)&&this.skipValidations===!1){const i=$6e({rules:oc(this.gastProductionsCache),tokenTypes:oc(this.tokensMap),errMsgProvider:PS,grammarName:n}),s=O6e({lookaheadStrategy:this.lookaheadStrategy,rules:oc(this.gastProductionsCache),tokenTypes:oc(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ra(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=T4e(oc(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:oc(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(oc(this.gastProductionsCache))})),!xde.DEFER_DEFINITION_ERRORS_HANDLING&&!ra(this.definitionErrors))throw e=Dn(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Er(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Er(n,"skipValidations")?n.skipValidations:sy.skipValidations}};H7.DEFER_DEFINITION_ERRORS_HANDLING=!1;Sze(H7,[J6e,tze,dze,fze,mze,pze,gze,vze,_ze,Eze]);class Tze extends H7{constructor(e,n=sy){const r=Bl(n);r.outputCst=!0,super(e,r)}}function xze(t){const e=new wze,n=oc(t);return Dn(n,r=>e.visitRule(r))}class wze extends YT{visitRule(e){const n=this.visitEach(e.definition),r=Ghe(n,s=>s.propertyName),i=Dn(r,(s,a)=>{const o=!P7(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Dn(s,l=>l.type)),{name:a,type:c,optional:o}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:nD(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:nD(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:nD(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:nD(e)}]}visitEachAndOverrideWith(e,n){return Dn(this.visitEach(e),r=>Jh({},r,n))}visitEach(e){return $h(Dn(e,n=>this.visit(n)))}}function nD(t){return t instanceof ed?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function Cze(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat($h(Dn(t,r=>Rze(r)))),e.includeVisitorInterface&&(n=n.concat(Nze(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function Rze(t){const e=Aze(t),n=Mze(t);return[e,n]}function Aze(t){const e=wde(t.name),n=j7(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function Mze(t){return`export type ${j7(t.name)} = {
  ${Dn(t.properties,n=>Oze(n)).join(`
  `)}
};`}function Oze(t){const e=kze(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function Nze(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Dn(e,n=>Ize(n)).join(`
  `)}
}`}function Ize(t){const e=j7(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function kze(t){if(qi(t)){const e=cB(Dn(t,r=>GQ(r)));return"("+Qh(e,(r,i)=>r+" | "+i)+")"}else return GQ(t)}function GQ(t){return t.kind==="token"?"IToken":wde(t.name)}function wde(t){return Ohe(t)+"CstNode"}function j7(t){return Ohe(t)+"CstChildren"}const Dze={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function Pze(t,e){const n=Object.assign(Object.assign({},Dze),e),r=xze(t);return Cze(r,n)}const zg=!!JSON.parse("false"),Lze=!!JSON.parse("false"),Uze=!!JSON.parse("false"),Bze=!!JSON.parse("false");JSON.parse("false");const Fze=!!JSON.parse("false"),zze=!!JSON.parse("false"),Hze=!!JSON.parse("false"),kn={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Mg*kn.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Og*kn.DRAW_CHAR_SCALE}};function V7(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let a=i;a<=s;a+=n)r.push(a);return r}function jze(t){return t[Hf(0,t.length-1)]}function Vze(t,e){return e[Iue(t,0,e.length-1)]}function Ya(...t){return jze(t.flat())}function Cde(t,...e){return Vze(t,e.flat())}function Gze(t){return[...new Set(t)].filter(ae)}function qze(t,e){return t%e}function $ze(t,e){return Math.floor(t/e)}function qQ(t,e){return{x:qze(t,e),y:$ze(t,e)}}function vT(t,e){return t.x+t.y*e}function T_(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function $Q(t,e,n,r){const i=[],s=Math.abs(n-t),a=Math.abs(r-e),o=t<n?1:-1,c=e<r?1:-1;let l=s-a;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-a&&(l-=a,t+=o),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}const Wze=66.666,G7=Math.round(1e3/Wze),Yze=3;function Gp(t){return new Promise(e=>setTimeout(e,t))}function oC(t){return ae(t)&&ae(t.x)&&ae(t.y)}function rc(t,e){switch(e){case rn.NORTH:--t.y;break;case rn.SOUTH:++t.y;break;case rn.WEST:--t.x;break;case rn.EAST:++t.x;break}return t}function Tv(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return rn.WEST;if(n>0)return rn.EAST;if(r<0)return rn.NORTH;if(r>0)return rn.SOUTH}const Rde={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function yT(t){return Lr(t)&&Ade(t[0])}function Ade(t){return ae(rn[t])&&On(t)}function Xze(t){const e=rn[t];return ae(e)?e:rn.IDLE}function q7(t){if(On(t))return Rde[ar(t)]}function Kze(t){if(yT(t))return t;if(Ade(t))return[t];const e=q7(t);if(ae(e))return[e]}function WQ(t){const e=ne.words[t],n=Kze(e);return yT(n)?[n,t+1]:[void 0,t]}function Mde(t){var i,s;const e=[];let[n,r]=WQ(t);for(;yT(n);){switch(e.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=Ot(ne.words,r,[st.NUMBER,st.NUMBER]);e.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=Ot(ne.words,r,[st.DIR]);e.push(c.x,c.y),r=l;break}case"TO":{const[c,l,u]=Ot(ne.words,r,[st.DIR,st.DIR]),h=((i=ne.element)==null?void 0:i.x)??0,d=((s=ne.element)==null?void 0:s.y)??0;c.x-=h,c.y-=d,l.x-=h,l.y-=d,e.push(h+c.x+l.x,d+c.y+l.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":break;default:return[e,r]}const[a,o]=WQ(r);n=a,r=o}return e.length?[e,r]:[void 0,t]}function cC(t){return Lr(t)&&typeof t[0]=="string"}function Jze(t){const e=ne.words[t];return On(e)?[e,t+1]:[void 0,t]}function YQ(t){const e=ne.words[t];if(cC(e))return[e,t+1];const[n,r]=e9(t),[i,s]=Jze(r);return On(i)?[[i,n],s]:[void 0,t]}function EV(t){if(!cC(t))return;const[e]=t;return e}function Ode(t){if(!cC(t))return;const[,e]=t,n=ae(e)?JGe(e):void 0;return ae(n)?n:void 0}function Nde(t){if(!cC(t))return;const[,e]=t,n=ae(e)?ZGe(e):void 0;return ae(n)?n:void 0}var $c={},pB={};pB.byteLength=e8e;pB.toByteArray=n8e;pB.fromByteArray=s8e;var mg=[],Rf=[],Zze=typeof Uint8Array<"u"?Uint8Array:Array,nH="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var a1=0,Qze=nH.length;a1<Qze;++a1)mg[a1]=nH[a1],Rf[nH.charCodeAt(a1)]=a1;Rf[45]=62;Rf[95]=63;function Ide(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function e8e(t){var e=Ide(t),n=e[0],r=e[1];return(n+r)*3/4-r}function t8e(t,e,n){return(e+n)*3/4-n}function n8e(t){var e,n=Ide(t),r=n[0],i=n[1],s=new Zze(t8e(t,r,i)),a=0,o=i>0?r-4:r,c;for(c=0;c<o;c+=4)e=Rf[t.charCodeAt(c)]<<18|Rf[t.charCodeAt(c+1)]<<12|Rf[t.charCodeAt(c+2)]<<6|Rf[t.charCodeAt(c+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=e&255;return i===2&&(e=Rf[t.charCodeAt(c)]<<2|Rf[t.charCodeAt(c+1)]>>4,s[a++]=e&255),i===1&&(e=Rf[t.charCodeAt(c)]<<10|Rf[t.charCodeAt(c+1)]<<4|Rf[t.charCodeAt(c+2)]>>2,s[a++]=e>>8&255,s[a++]=e&255),s}function r8e(t){return mg[t>>18&63]+mg[t>>12&63]+mg[t>>6&63]+mg[t&63]}function i8e(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(r8e(r));return i.join("")}function s8e(t){for(var e,n=t.length,r=n%3,i=[],s=16383,a=0,o=n-r;a<o;a+=s)i.push(i8e(t,a,a+s>o?o:a+s));return r===1?(e=t[n-1],i.push(mg[e>>2]+mg[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(mg[e>>10]+mg[e>>4&63]+mg[e<<2&63]+"=")),i.join("")}var $7={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */$7.read=function(t,e,n,r,i){var s,a,o=i*8-r-1,c=(1<<o)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=s*256+t[e+h],h+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=r;u>0;a=a*256+t[e+h],h+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return a?NaN:(f?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-l}return(f?-1:1)*a*Math.pow(2,s-r)};$7.write=function(t,e,n,r,i,s){var a,o,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+h>=1?e+=d/c:e+=d*Math.pow(2,1-h),e*c>=2&&(a++,c/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(e*c-1)*Math.pow(2,i),a=a+h):(o=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=o&255,f+=p,o/=256,i-=8);for(a=a<<i|o,l+=i;l>0;t[n+f]=a&255,f+=p,a/=256,l-=8);t[n+f-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=pB,n=$7,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=N,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:a,SharedArrayBuffer:o}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const ce=new s(1),j={foo:function(){return 42}};return Object.setPrototypeOf(j,s.prototype),Object.setPrototypeOf(ce,j),ce.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(ce){if(ce>i)throw new RangeError('The value "'+ce+'" is invalid for option "size"');const j=new s(ce);return Object.setPrototypeOf(j,u.prototype),j}function u(ce,j,W){if(typeof ce=="number"){if(typeof j=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(ce)}return h(ce,j,W)}u.poolSize=8192;function h(ce,j,W){if(typeof ce=="string")return g(ce,j);if(a.isView(ce))return v(ce);if(ce==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ce);if($e(ce,a)||ce&&$e(ce.buffer,a)||typeof o<"u"&&($e(ce,o)||ce&&$e(ce.buffer,o)))return E(ce,j,W);if(typeof ce=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const me=ce.valueOf&&ce.valueOf();if(me!=null&&me!==ce)return u.from(me,j,W);const De=T(ce);if(De)return De;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ce[Symbol.toPrimitive]=="function")return u.from(ce[Symbol.toPrimitive]("string"),j,W);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ce)}u.from=function(ce,j,W){return h(ce,j,W)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(ce){if(typeof ce!="number")throw new TypeError('"size" argument must be of type number');if(ce<0)throw new RangeError('The value "'+ce+'" is invalid for option "size"')}function f(ce,j,W){return d(ce),ce<=0?l(ce):j!==void 0?typeof W=="string"?l(ce).fill(j,W):l(ce).fill(j):l(ce)}u.alloc=function(ce,j,W){return f(ce,j,W)};function p(ce){return d(ce),l(ce<0?0:x(ce)|0)}u.allocUnsafe=function(ce){return p(ce)},u.allocUnsafeSlow=function(ce){return p(ce)};function g(ce,j){if((typeof j!="string"||j==="")&&(j="utf8"),!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);const W=A(ce,j)|0;let me=l(W);const De=me.write(ce,j);return De!==W&&(me=me.slice(0,De)),me}function _(ce){const j=ce.length<0?0:x(ce.length)|0,W=l(j);for(let me=0;me<j;me+=1)W[me]=ce[me]&255;return W}function v(ce){if($e(ce,s)){const j=new s(ce);return E(j.buffer,j.byteOffset,j.byteLength)}return _(ce)}function E(ce,j,W){if(j<0||ce.byteLength<j)throw new RangeError('"offset" is outside of buffer bounds');if(ce.byteLength<j+(W||0))throw new RangeError('"length" is outside of buffer bounds');let me;return j===void 0&&W===void 0?me=new s(ce):W===void 0?me=new s(ce,j):me=new s(ce,j,W),Object.setPrototypeOf(me,u.prototype),me}function T(ce){if(u.isBuffer(ce)){const j=x(ce.length)|0,W=l(j);return W.length===0||ce.copy(W,0,0,j),W}if(ce.length!==void 0)return typeof ce.length!="number"||Ue(ce.length)?l(0):_(ce);if(ce.type==="Buffer"&&Array.isArray(ce.data))return _(ce.data)}function x(ce){if(ce>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return ce|0}function N(ce){return+ce!=ce&&(ce=0),u.alloc(+ce)}u.isBuffer=function(j){return j!=null&&j._isBuffer===!0&&j!==u.prototype},u.compare=function(j,W){if($e(j,s)&&(j=u.from(j,j.offset,j.byteLength)),$e(W,s)&&(W=u.from(W,W.offset,W.byteLength)),!u.isBuffer(j)||!u.isBuffer(W))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(j===W)return 0;let me=j.length,De=W.length;for(let je=0,mt=Math.min(me,De);je<mt;++je)if(j[je]!==W[je]){me=j[je],De=W[je];break}return me<De?-1:De<me?1:0},u.isEncoding=function(j){switch(String(j).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(j,W){if(!Array.isArray(j))throw new TypeError('"list" argument must be an Array of Buffers');if(j.length===0)return u.alloc(0);let me;if(W===void 0)for(W=0,me=0;me<j.length;++me)W+=j[me].length;const De=u.allocUnsafe(W);let je=0;for(me=0;me<j.length;++me){let mt=j[me];if($e(mt,s))je+mt.length>De.length?(u.isBuffer(mt)||(mt=u.from(mt)),mt.copy(De,je)):s.prototype.set.call(De,mt,je);else if(u.isBuffer(mt))mt.copy(De,je);else throw new TypeError('"list" argument must be an Array of Buffers');je+=mt.length}return De};function A(ce,j){if(u.isBuffer(ce))return ce.length;if(a.isView(ce)||$e(ce,a))return ce.byteLength;if(typeof ce!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ce);const W=ce.length,me=arguments.length>2&&arguments[2]===!0;if(!me&&W===0)return 0;let De=!1;for(;;)switch(j){case"ascii":case"latin1":case"binary":return W;case"utf8":case"utf-8":return bt(ce).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W*2;case"hex":return W>>>1;case"base64":return Xe(ce).length;default:if(De)return me?-1:bt(ce).length;j=(""+j).toLowerCase(),De=!0}}u.byteLength=A;function I(ce,j,W){let me=!1;if((j===void 0||j<0)&&(j=0),j>this.length||((W===void 0||W>this.length)&&(W=this.length),W<=0)||(W>>>=0,j>>>=0,W<=j))return"";for(ce||(ce="utf8");;)switch(ce){case"hex":return Me(this,j,W);case"utf8":case"utf-8":return Z(this,j,W);case"ascii":return oe(this,j,W);case"latin1":case"binary":return de(this,j,W);case"base64":return V(this,j,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return He(this,j,W);default:if(me)throw new TypeError("Unknown encoding: "+ce);ce=(ce+"").toLowerCase(),me=!0}}u.prototype._isBuffer=!0;function k(ce,j,W){const me=ce[j];ce[j]=ce[W],ce[W]=me}u.prototype.swap16=function(){const j=this.length;if(j%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let W=0;W<j;W+=2)k(this,W,W+1);return this},u.prototype.swap32=function(){const j=this.length;if(j%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let W=0;W<j;W+=4)k(this,W,W+3),k(this,W+1,W+2);return this},u.prototype.swap64=function(){const j=this.length;if(j%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let W=0;W<j;W+=8)k(this,W,W+7),k(this,W+1,W+6),k(this,W+2,W+5),k(this,W+3,W+4);return this},u.prototype.toString=function(){const j=this.length;return j===0?"":arguments.length===0?Z(this,0,j):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(j){if(!u.isBuffer(j))throw new TypeError("Argument must be a Buffer");return this===j?!0:u.compare(this,j)===0},u.prototype.inspect=function(){let j="";const W=t.INSPECT_MAX_BYTES;return j=this.toString("hex",0,W).replace(/(.{2})/g,"$1 ").trim(),this.length>W&&(j+=" ... "),"<Buffer "+j+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(j,W,me,De,je){if($e(j,s)&&(j=u.from(j,j.offset,j.byteLength)),!u.isBuffer(j))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof j);if(W===void 0&&(W=0),me===void 0&&(me=j?j.length:0),De===void 0&&(De=0),je===void 0&&(je=this.length),W<0||me>j.length||De<0||je>this.length)throw new RangeError("out of range index");if(De>=je&&W>=me)return 0;if(De>=je)return-1;if(W>=me)return 1;if(W>>>=0,me>>>=0,De>>>=0,je>>>=0,this===j)return 0;let mt=je-De,xt=me-W;const Vn=Math.min(mt,xt),qe=this.slice(De,je),Vt=j.slice(W,me);for(let ht=0;ht<Vn;++ht)if(qe[ht]!==Vt[ht]){mt=qe[ht],xt=Vt[ht];break}return mt<xt?-1:xt<mt?1:0};function L(ce,j,W,me,De){if(ce.length===0)return-1;if(typeof W=="string"?(me=W,W=0):W>2147483647?W=2147483647:W<-2147483648&&(W=-2147483648),W=+W,Ue(W)&&(W=De?0:ce.length-1),W<0&&(W=ce.length+W),W>=ce.length){if(De)return-1;W=ce.length-1}else if(W<0)if(De)W=0;else return-1;if(typeof j=="string"&&(j=u.from(j,me)),u.isBuffer(j))return j.length===0?-1:U(ce,j,W,me,De);if(typeof j=="number")return j=j&255,typeof s.prototype.indexOf=="function"?De?s.prototype.indexOf.call(ce,j,W):s.prototype.lastIndexOf.call(ce,j,W):U(ce,[j],W,me,De);throw new TypeError("val must be string, number or Buffer")}function U(ce,j,W,me,De){let je=1,mt=ce.length,xt=j.length;if(me!==void 0&&(me=String(me).toLowerCase(),me==="ucs2"||me==="ucs-2"||me==="utf16le"||me==="utf-16le")){if(ce.length<2||j.length<2)return-1;je=2,mt/=2,xt/=2,W/=2}function Vn(Vt,ht){return je===1?Vt[ht]:Vt.readUInt16BE(ht*je)}let qe;if(De){let Vt=-1;for(qe=W;qe<mt;qe++)if(Vn(ce,qe)===Vn(j,Vt===-1?0:qe-Vt)){if(Vt===-1&&(Vt=qe),qe-Vt+1===xt)return Vt*je}else Vt!==-1&&(qe-=qe-Vt),Vt=-1}else for(W+xt>mt&&(W=mt-xt),qe=W;qe>=0;qe--){let Vt=!0;for(let ht=0;ht<xt;ht++)if(Vn(ce,qe+ht)!==Vn(j,ht)){Vt=!1;break}if(Vt)return qe}return-1}u.prototype.includes=function(j,W,me){return this.indexOf(j,W,me)!==-1},u.prototype.indexOf=function(j,W,me){return L(this,j,W,me,!0)},u.prototype.lastIndexOf=function(j,W,me){return L(this,j,W,me,!1)};function $(ce,j,W,me){W=Number(W)||0;const De=ce.length-W;me?(me=Number(me),me>De&&(me=De)):me=De;const je=j.length;me>je/2&&(me=je/2);let mt;for(mt=0;mt<me;++mt){const xt=parseInt(j.substr(mt*2,2),16);if(Ue(xt))return mt;ce[W+mt]=xt}return mt}function q(ce,j,W,me){return nt(bt(j,ce.length-W),ce,W,me)}function G(ce,j,W,me){return nt(be(j),ce,W,me)}function X(ce,j,W,me){return nt(Xe(j),ce,W,me)}function re(ce,j,W,me){return nt(ue(j,ce.length-W),ce,W,me)}u.prototype.write=function(j,W,me,De){if(W===void 0)De="utf8",me=this.length,W=0;else if(me===void 0&&typeof W=="string")De=W,me=this.length,W=0;else if(isFinite(W))W=W>>>0,isFinite(me)?(me=me>>>0,De===void 0&&(De="utf8")):(De=me,me=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const je=this.length-W;if((me===void 0||me>je)&&(me=je),j.length>0&&(me<0||W<0)||W>this.length)throw new RangeError("Attempt to write outside buffer bounds");De||(De="utf8");let mt=!1;for(;;)switch(De){case"hex":return $(this,j,W,me);case"utf8":case"utf-8":return q(this,j,W,me);case"ascii":case"latin1":case"binary":return G(this,j,W,me);case"base64":return X(this,j,W,me);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re(this,j,W,me);default:if(mt)throw new TypeError("Unknown encoding: "+De);De=(""+De).toLowerCase(),mt=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function V(ce,j,W){return j===0&&W===ce.length?e.fromByteArray(ce):e.fromByteArray(ce.slice(j,W))}function Z(ce,j,W){W=Math.min(ce.length,W);const me=[];let De=j;for(;De<W;){const je=ce[De];let mt=null,xt=je>239?4:je>223?3:je>191?2:1;if(De+xt<=W){let Vn,qe,Vt,ht;switch(xt){case 1:je<128&&(mt=je);break;case 2:Vn=ce[De+1],(Vn&192)===128&&(ht=(je&31)<<6|Vn&63,ht>127&&(mt=ht));break;case 3:Vn=ce[De+1],qe=ce[De+2],(Vn&192)===128&&(qe&192)===128&&(ht=(je&15)<<12|(Vn&63)<<6|qe&63,ht>2047&&(ht<55296||ht>57343)&&(mt=ht));break;case 4:Vn=ce[De+1],qe=ce[De+2],Vt=ce[De+3],(Vn&192)===128&&(qe&192)===128&&(Vt&192)===128&&(ht=(je&15)<<18|(Vn&63)<<12|(qe&63)<<6|Vt&63,ht>65535&&ht<1114112&&(mt=ht))}}mt===null?(mt=65533,xt=1):mt>65535&&(mt-=65536,me.push(mt>>>10&1023|55296),mt=56320|mt&1023),me.push(mt),De+=xt}return ee(me)}const Y=4096;function ee(ce){const j=ce.length;if(j<=Y)return String.fromCharCode.apply(String,ce);let W="",me=0;for(;me<j;)W+=String.fromCharCode.apply(String,ce.slice(me,me+=Y));return W}function oe(ce,j,W){let me="";W=Math.min(ce.length,W);for(let De=j;De<W;++De)me+=String.fromCharCode(ce[De]&127);return me}function de(ce,j,W){let me="";W=Math.min(ce.length,W);for(let De=j;De<W;++De)me+=String.fromCharCode(ce[De]);return me}function Me(ce,j,W){const me=ce.length;(!j||j<0)&&(j=0),(!W||W<0||W>me)&&(W=me);let De="";for(let je=j;je<W;++je)De+=qt[ce[je]];return De}function He(ce,j,W){const me=ce.slice(j,W);let De="";for(let je=0;je<me.length-1;je+=2)De+=String.fromCharCode(me[je]+me[je+1]*256);return De}u.prototype.slice=function(j,W){const me=this.length;j=~~j,W=W===void 0?me:~~W,j<0?(j+=me,j<0&&(j=0)):j>me&&(j=me),W<0?(W+=me,W<0&&(W=0)):W>me&&(W=me),W<j&&(W=j);const De=this.subarray(j,W);return Object.setPrototypeOf(De,u.prototype),De};function Te(ce,j,W){if(ce%1!==0||ce<0)throw new RangeError("offset is not uint");if(ce+j>W)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(j,W,me){j=j>>>0,W=W>>>0,me||Te(j,W,this.length);let De=this[j],je=1,mt=0;for(;++mt<W&&(je*=256);)De+=this[j+mt]*je;return De},u.prototype.readUintBE=u.prototype.readUIntBE=function(j,W,me){j=j>>>0,W=W>>>0,me||Te(j,W,this.length);let De=this[j+--W],je=1;for(;W>0&&(je*=256);)De+=this[j+--W]*je;return De},u.prototype.readUint8=u.prototype.readUInt8=function(j,W){return j=j>>>0,W||Te(j,1,this.length),this[j]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(j,W){return j=j>>>0,W||Te(j,2,this.length),this[j]|this[j+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(j,W){return j=j>>>0,W||Te(j,2,this.length),this[j]<<8|this[j+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),(this[j]|this[j+1]<<8|this[j+2]<<16)+this[j+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),this[j]*16777216+(this[j+1]<<16|this[j+2]<<8|this[j+3])},u.prototype.readBigUInt64LE=Mt(function(j){j=j>>>0,Ie(j,"offset");const W=this[j],me=this[j+7];(W===void 0||me===void 0)&&rt(j,this.length-8);const De=W+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24,je=this[++j]+this[++j]*2**8+this[++j]*2**16+me*2**24;return BigInt(De)+(BigInt(je)<<BigInt(32))}),u.prototype.readBigUInt64BE=Mt(function(j){j=j>>>0,Ie(j,"offset");const W=this[j],me=this[j+7];(W===void 0||me===void 0)&&rt(j,this.length-8);const De=W*2**24+this[++j]*2**16+this[++j]*2**8+this[++j],je=this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+me;return(BigInt(De)<<BigInt(32))+BigInt(je)}),u.prototype.readIntLE=function(j,W,me){j=j>>>0,W=W>>>0,me||Te(j,W,this.length);let De=this[j],je=1,mt=0;for(;++mt<W&&(je*=256);)De+=this[j+mt]*je;return je*=128,De>=je&&(De-=Math.pow(2,8*W)),De},u.prototype.readIntBE=function(j,W,me){j=j>>>0,W=W>>>0,me||Te(j,W,this.length);let De=W,je=1,mt=this[j+--De];for(;De>0&&(je*=256);)mt+=this[j+--De]*je;return je*=128,mt>=je&&(mt-=Math.pow(2,8*W)),mt},u.prototype.readInt8=function(j,W){return j=j>>>0,W||Te(j,1,this.length),this[j]&128?(255-this[j]+1)*-1:this[j]},u.prototype.readInt16LE=function(j,W){j=j>>>0,W||Te(j,2,this.length);const me=this[j]|this[j+1]<<8;return me&32768?me|4294901760:me},u.prototype.readInt16BE=function(j,W){j=j>>>0,W||Te(j,2,this.length);const me=this[j+1]|this[j]<<8;return me&32768?me|4294901760:me},u.prototype.readInt32LE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),this[j]|this[j+1]<<8|this[j+2]<<16|this[j+3]<<24},u.prototype.readInt32BE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),this[j]<<24|this[j+1]<<16|this[j+2]<<8|this[j+3]},u.prototype.readBigInt64LE=Mt(function(j){j=j>>>0,Ie(j,"offset");const W=this[j],me=this[j+7];(W===void 0||me===void 0)&&rt(j,this.length-8);const De=this[j+4]+this[j+5]*2**8+this[j+6]*2**16+(me<<24);return(BigInt(De)<<BigInt(32))+BigInt(W+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24)}),u.prototype.readBigInt64BE=Mt(function(j){j=j>>>0,Ie(j,"offset");const W=this[j],me=this[j+7];(W===void 0||me===void 0)&&rt(j,this.length-8);const De=(W<<24)+this[++j]*2**16+this[++j]*2**8+this[++j];return(BigInt(De)<<BigInt(32))+BigInt(this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+me)}),u.prototype.readFloatLE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),n.read(this,j,!0,23,4)},u.prototype.readFloatBE=function(j,W){return j=j>>>0,W||Te(j,4,this.length),n.read(this,j,!1,23,4)},u.prototype.readDoubleLE=function(j,W){return j=j>>>0,W||Te(j,8,this.length),n.read(this,j,!0,52,8)},u.prototype.readDoubleBE=function(j,W){return j=j>>>0,W||Te(j,8,this.length),n.read(this,j,!1,52,8)};function Le(ce,j,W,me,De,je){if(!u.isBuffer(ce))throw new TypeError('"buffer" argument must be a Buffer instance');if(j>De||j<je)throw new RangeError('"value" argument is out of bounds');if(W+me>ce.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(j,W,me,De){if(j=+j,W=W>>>0,me=me>>>0,!De){const xt=Math.pow(2,8*me)-1;Le(this,j,W,me,xt,0)}let je=1,mt=0;for(this[W]=j&255;++mt<me&&(je*=256);)this[W+mt]=j/je&255;return W+me},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(j,W,me,De){if(j=+j,W=W>>>0,me=me>>>0,!De){const xt=Math.pow(2,8*me)-1;Le(this,j,W,me,xt,0)}let je=me-1,mt=1;for(this[W+je]=j&255;--je>=0&&(mt*=256);)this[W+je]=j/mt&255;return W+me},u.prototype.writeUint8=u.prototype.writeUInt8=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,1,255,0),this[W]=j&255,W+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,2,65535,0),this[W]=j&255,this[W+1]=j>>>8,W+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,2,65535,0),this[W]=j>>>8,this[W+1]=j&255,W+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,4,4294967295,0),this[W+3]=j>>>24,this[W+2]=j>>>16,this[W+1]=j>>>8,this[W]=j&255,W+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,4,4294967295,0),this[W]=j>>>24,this[W+1]=j>>>16,this[W+2]=j>>>8,this[W+3]=j&255,W+4};function we(ce,j,W,me,De){Fe(j,me,De,ce,W,7);let je=Number(j&BigInt(4294967295));ce[W++]=je,je=je>>8,ce[W++]=je,je=je>>8,ce[W++]=je,je=je>>8,ce[W++]=je;let mt=Number(j>>BigInt(32)&BigInt(4294967295));return ce[W++]=mt,mt=mt>>8,ce[W++]=mt,mt=mt>>8,ce[W++]=mt,mt=mt>>8,ce[W++]=mt,W}function Ce(ce,j,W,me,De){Fe(j,me,De,ce,W,7);let je=Number(j&BigInt(4294967295));ce[W+7]=je,je=je>>8,ce[W+6]=je,je=je>>8,ce[W+5]=je,je=je>>8,ce[W+4]=je;let mt=Number(j>>BigInt(32)&BigInt(4294967295));return ce[W+3]=mt,mt=mt>>8,ce[W+2]=mt,mt=mt>>8,ce[W+1]=mt,mt=mt>>8,ce[W]=mt,W+8}u.prototype.writeBigUInt64LE=Mt(function(j,W=0){return we(this,j,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Mt(function(j,W=0){return Ce(this,j,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(j,W,me,De){if(j=+j,W=W>>>0,!De){const Vn=Math.pow(2,8*me-1);Le(this,j,W,me,Vn-1,-Vn)}let je=0,mt=1,xt=0;for(this[W]=j&255;++je<me&&(mt*=256);)j<0&&xt===0&&this[W+je-1]!==0&&(xt=1),this[W+je]=(j/mt>>0)-xt&255;return W+me},u.prototype.writeIntBE=function(j,W,me,De){if(j=+j,W=W>>>0,!De){const Vn=Math.pow(2,8*me-1);Le(this,j,W,me,Vn-1,-Vn)}let je=me-1,mt=1,xt=0;for(this[W+je]=j&255;--je>=0&&(mt*=256);)j<0&&xt===0&&this[W+je+1]!==0&&(xt=1),this[W+je]=(j/mt>>0)-xt&255;return W+me},u.prototype.writeInt8=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,1,127,-128),j<0&&(j=255+j+1),this[W]=j&255,W+1},u.prototype.writeInt16LE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,2,32767,-32768),this[W]=j&255,this[W+1]=j>>>8,W+2},u.prototype.writeInt16BE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,2,32767,-32768),this[W]=j>>>8,this[W+1]=j&255,W+2},u.prototype.writeInt32LE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,4,2147483647,-2147483648),this[W]=j&255,this[W+1]=j>>>8,this[W+2]=j>>>16,this[W+3]=j>>>24,W+4},u.prototype.writeInt32BE=function(j,W,me){return j=+j,W=W>>>0,me||Le(this,j,W,4,2147483647,-2147483648),j<0&&(j=4294967295+j+1),this[W]=j>>>24,this[W+1]=j>>>16,this[W+2]=j>>>8,this[W+3]=j&255,W+4},u.prototype.writeBigInt64LE=Mt(function(j,W=0){return we(this,j,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Mt(function(j,W=0){return Ce(this,j,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ke(ce,j,W,me,De,je){if(W+me>ce.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("Index out of range")}function St(ce,j,W,me,De){return j=+j,W=W>>>0,De||ke(ce,j,W,4),n.write(ce,j,W,me,23,4),W+4}u.prototype.writeFloatLE=function(j,W,me){return St(this,j,W,!0,me)},u.prototype.writeFloatBE=function(j,W,me){return St(this,j,W,!1,me)};function At(ce,j,W,me,De){return j=+j,W=W>>>0,De||ke(ce,j,W,8),n.write(ce,j,W,me,52,8),W+8}u.prototype.writeDoubleLE=function(j,W,me){return At(this,j,W,!0,me)},u.prototype.writeDoubleBE=function(j,W,me){return At(this,j,W,!1,me)},u.prototype.copy=function(j,W,me,De){if(!u.isBuffer(j))throw new TypeError("argument should be a Buffer");if(me||(me=0),!De&&De!==0&&(De=this.length),W>=j.length&&(W=j.length),W||(W=0),De>0&&De<me&&(De=me),De===me||j.length===0||this.length===0)return 0;if(W<0)throw new RangeError("targetStart out of bounds");if(me<0||me>=this.length)throw new RangeError("Index out of range");if(De<0)throw new RangeError("sourceEnd out of bounds");De>this.length&&(De=this.length),j.length-W<De-me&&(De=j.length-W+me);const je=De-me;return this===j&&typeof s.prototype.copyWithin=="function"?this.copyWithin(W,me,De):s.prototype.set.call(j,this.subarray(me,De),W),je},u.prototype.fill=function(j,W,me,De){if(typeof j=="string"){if(typeof W=="string"?(De=W,W=0,me=this.length):typeof me=="string"&&(De=me,me=this.length),De!==void 0&&typeof De!="string")throw new TypeError("encoding must be a string");if(typeof De=="string"&&!u.isEncoding(De))throw new TypeError("Unknown encoding: "+De);if(j.length===1){const mt=j.charCodeAt(0);(De==="utf8"&&mt<128||De==="latin1")&&(j=mt)}}else typeof j=="number"?j=j&255:typeof j=="boolean"&&(j=Number(j));if(W<0||this.length<W||this.length<me)throw new RangeError("Out of range index");if(me<=W)return this;W=W>>>0,me=me===void 0?this.length:me>>>0,j||(j=0);let je;if(typeof j=="number")for(je=W;je<me;++je)this[je]=j;else{const mt=u.isBuffer(j)?j:u.from(j,De),xt=mt.length;if(xt===0)throw new TypeError('The value "'+j+'" is invalid for argument "value"');for(je=0;je<me-W;++je)this[je+W]=mt[je%xt]}return this};const Ee={};function ye(ce,j,W){Ee[ce]=class extends W{constructor(){super(),Object.defineProperty(this,"message",{value:j.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${ce}]`,this.stack,delete this.name}get code(){return ce}set code(De){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:De,writable:!0})}toString(){return`${this.name} [${ce}]: ${this.message}`}}}ye("ERR_BUFFER_OUT_OF_BOUNDS",function(ce){return ce?`${ce} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ye("ERR_INVALID_ARG_TYPE",function(ce,j){return`The "${ce}" argument must be of type number. Received type ${typeof j}`},TypeError),ye("ERR_OUT_OF_RANGE",function(ce,j,W){let me=`The value of "${ce}" is out of range.`,De=W;return Number.isInteger(W)&&Math.abs(W)>2**32?De=et(String(W)):typeof W=="bigint"&&(De=String(W),(W>BigInt(2)**BigInt(32)||W<-(BigInt(2)**BigInt(32)))&&(De=et(De)),De+="n"),me+=` It must be ${j}. Received ${De}`,me},RangeError);function et(ce){let j="",W=ce.length;const me=ce[0]==="-"?1:0;for(;W>=me+4;W-=3)j=`_${ce.slice(W-3,W)}${j}`;return`${ce.slice(0,W)}${j}`}function fe(ce,j,W){Ie(j,"offset"),(ce[j]===void 0||ce[j+W]===void 0)&&rt(j,ce.length-(W+1))}function Fe(ce,j,W,me,De,je){if(ce>W||ce<j){const mt=typeof j=="bigint"?"n":"";let xt;throw j===0||j===BigInt(0)?xt=`>= 0${mt} and < 2${mt} ** ${(je+1)*8}${mt}`:xt=`>= -(2${mt} ** ${(je+1)*8-1}${mt}) and < 2 ** ${(je+1)*8-1}${mt}`,new Ee.ERR_OUT_OF_RANGE("value",xt,ce)}fe(me,De,je)}function Ie(ce,j){if(typeof ce!="number")throw new Ee.ERR_INVALID_ARG_TYPE(j,"number",ce)}function rt(ce,j,W){throw Math.floor(ce)!==ce?(Ie(ce,W),new Ee.ERR_OUT_OF_RANGE("offset","an integer",ce)):j<0?new Ee.ERR_BUFFER_OUT_OF_BOUNDS:new Ee.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${j}`,ce)}const dt=/[^+/0-9A-Za-z-_]/g;function gt(ce){if(ce=ce.split("=")[0],ce=ce.trim().replace(dt,""),ce.length<2)return"";for(;ce.length%4!==0;)ce=ce+"=";return ce}function bt(ce,j){j=j||1/0;let W;const me=ce.length;let De=null;const je=[];for(let mt=0;mt<me;++mt){if(W=ce.charCodeAt(mt),W>55295&&W<57344){if(!De){if(W>56319){(j-=3)>-1&&je.push(239,191,189);continue}else if(mt+1===me){(j-=3)>-1&&je.push(239,191,189);continue}De=W;continue}if(W<56320){(j-=3)>-1&&je.push(239,191,189),De=W;continue}W=(De-55296<<10|W-56320)+65536}else De&&(j-=3)>-1&&je.push(239,191,189);if(De=null,W<128){if((j-=1)<0)break;je.push(W)}else if(W<2048){if((j-=2)<0)break;je.push(W>>6|192,W&63|128)}else if(W<65536){if((j-=3)<0)break;je.push(W>>12|224,W>>6&63|128,W&63|128)}else if(W<1114112){if((j-=4)<0)break;je.push(W>>18|240,W>>12&63|128,W>>6&63|128,W&63|128)}else throw new Error("Invalid code point")}return je}function be(ce){const j=[];for(let W=0;W<ce.length;++W)j.push(ce.charCodeAt(W)&255);return j}function ue(ce,j){let W,me,De;const je=[];for(let mt=0;mt<ce.length&&!((j-=2)<0);++mt)W=ce.charCodeAt(mt),me=W>>8,De=W%256,je.push(De),je.push(me);return je}function Xe(ce){return e.toByteArray(gt(ce))}function nt(ce,j,W,me){let De;for(De=0;De<me&&!(De+W>=j.length||De>=ce.length);++De)j[De+W]=ce[De];return De}function $e(ce,j){return ce instanceof j||ce!=null&&ce.constructor!=null&&ce.constructor.name!=null&&ce.constructor.name===j.name}function Ue(ce){return ce!==ce}const qt=function(){const ce="0123456789abcdef",j=new Array(256);for(let W=0;W<16;++W){const me=W*16;for(let De=0;De<16;++De)j[me+De]=ce[W]+ce[De]}return j}();function Mt(ce){return typeof BigInt>"u"?Yt:ce}function Yt(){throw new Error("BigInt not supported")}})($c);const kl=$c.Buffer,a8e=$c.Blob,o8e=$c.BlobOptions,c8e=$c.Buffer,l8e=$c.File,u8e=$c.FileOptions,h8e=$c.INSPECT_MAX_BYTES,d8e=$c.SlowBuffer,f8e=$c.TranscodeEncoding,p8e=$c.atob,m8e=$c.btoa,g8e=$c.constants,v8e=$c.isAscii,y8e=$c.isUtf8,_8e=$c.kMaxLength,b8e=$c.kStringMaxLength,E8e=$c.resolveObjectURL,S8e=$c.transcode,T8e=Object.freeze(Object.defineProperty({__proto__:null,Blob:a8e,BlobOptions:o8e,Buffer:c8e,File:l8e,FileOptions:u8e,INSPECT_MAX_BYTES:h8e,SlowBuffer:d8e,TranscodeEncoding:f8e,atob:p8e,btoa:m8e,constants:g8e,default:kl,isAscii:v8e,isUtf8:y8e,kMaxLength:_8e,kStringMaxLength:b8e,resolveObjectURL:E8e,transcode:S8e},Symbol.toStringTag,{value:"Module"}));var SV;try{SV=new TextDecoder}catch{}var gn,jf,Qe=0,na={},Ui,K_,Mf=0,gg=0,sl,qv,nd=[],Ni,XQ={useRecords:!1,mapsAsObjects:!0};class kde{}const Dde=new kde;Dde.name="MessagePack 0xC1";var cb=!1,Pde=2,KQ;try{new Function("")}catch{Pde=1/0}class rO{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(gn)return Hde(()=>(xV(),this?this.unpack(e,n):rO.prototype.unpack.call(XQ,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof kl<"u"?kl.from(e):new Uint8Array(e)),typeof n=="object"?(jf=n.end||e.length,Qe=n.start||0):(Qe=0,jf=n>-1?n:e.length),gg=0,K_=null,sl=null,gn=e;try{Ni=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw gn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof rO){if(na=this,this.structures)return Ui=this.structures,rD(n);(!Ui||Ui.length>0)&&(Ui=[])}else na=XQ,(!Ui||Ui.length>0)&&(Ui=[]);return rD(n)}unpackMultiple(e,n){let r,i=0;try{cb=!0;let s=e.length,a=this?this.unpack(e,s):mB.unpack(e,s);if(n){if(n(a,i,Qe)===!1)return;for(;Qe<s;)if(i=Qe,n(rD(),i,Qe)===!1)return}else{for(r=[a];Qe<s;)i=Qe,r.push(rD());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{cb=!1,xV()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function rD(t){try{if(!na.trusted&&!cb){let n=Ui.sharedLength||0;n<Ui.length&&(Ui.length=n)}let e;if(na.randomAccessStructure&&gn[Qe]<64&&gn[Qe]>=32&&KQ?(e=KQ(gn,Qe,jf,na),gn=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),Qe=jf):e=Uo(),sl&&(Qe=sl.postBundlePosition,sl=null),cb&&(Ui.restoreStructures=null),Qe==jf)Ui&&Ui.restoreStructures&&JQ(),Ui=null,gn=null,qv&&(qv=null);else{if(Qe>jf)throw new Error("Unexpected end of MessagePack data");if(!cb){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ui&&Ui.restoreStructures&&JQ(),xV(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Qe>jf)&&(e.incomplete=!0),e}}function JQ(){for(let t in Ui.restoreStructures)Ui[t]=Ui.restoreStructures[t];Ui.restoreStructures=null}function Uo(){let t=gn[Qe++];if(t<160)if(t<128){if(t<64)return t;{let e=Ui[t&63]||na.getStructures&&Lde()[t&63];return e?(e.read||(e.read=W7(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,na.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Bde();r==="__proto__"&&(r="__proto_"),e[r]=Uo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Uo(),Uo());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=Uo();return na.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(gg>=Qe)return K_.slice(Qe-Mf,(Qe+=e)-Mf);if(gg==0&&jf<140){let n=e<16?Y7(e):Ude(e);if(n!=null)return n}return TV(e)}else{let e;switch(t){case 192:return null;case 193:return sl?(e=Uo(),e>0?sl[1].slice(sl.position1,sl.position1+=e):sl[0].slice(sl.position0,sl.position0-=e)):Dde;case 194:return!1;case 195:return!0;case 196:if(e=gn[Qe++],e===void 0)throw new Error("Unexpected end of buffer");return rH(e);case 197:return e=Ni.getUint16(Qe),Qe+=2,rH(e);case 198:return e=Ni.getUint32(Qe),Qe+=4,rH(e);case 199:return sS(gn[Qe++]);case 200:return e=Ni.getUint16(Qe),Qe+=2,sS(e);case 201:return e=Ni.getUint32(Qe),Qe+=4,sS(e);case 202:if(e=Ni.getFloat32(Qe),na.useFloat32>2){let n=X7[(gn[Qe]&127)<<1|gn[Qe+1]>>7];return Qe+=4,(n*e+(e>0?.5:-.5)>>0)/n}return Qe+=4,e;case 203:return e=Ni.getFloat64(Qe),Qe+=8,e;case 204:return gn[Qe++];case 205:return e=Ni.getUint16(Qe),Qe+=2,e;case 206:return e=Ni.getUint32(Qe),Qe+=4,e;case 207:return na.int64AsType==="number"?(e=Ni.getUint32(Qe)*4294967296,e+=Ni.getUint32(Qe+4)):na.int64AsType==="string"?e=Ni.getBigUint64(Qe).toString():na.int64AsType==="auto"?(e=Ni.getBigUint64(Qe),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ni.getBigUint64(Qe),Qe+=8,e;case 208:return Ni.getInt8(Qe++);case 209:return e=Ni.getInt16(Qe),Qe+=2,e;case 210:return e=Ni.getInt32(Qe),Qe+=4,e;case 211:return na.int64AsType==="number"?(e=Ni.getInt32(Qe)*4294967296,e+=Ni.getUint32(Qe+4)):na.int64AsType==="string"?e=Ni.getBigInt64(Qe).toString():na.int64AsType==="auto"?(e=Ni.getBigInt64(Qe),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Ni.getBigInt64(Qe),Qe+=8,e;case 212:if(e=gn[Qe++],e==114)return ree(gn[Qe++]&63);{let n=nd[e];if(n)return n.read?(Qe++,n.read(Uo())):n.noBuffer?(Qe++,n()):n(gn.subarray(Qe,++Qe));throw new Error("Unknown extension "+e)}case 213:return e=gn[Qe],e==114?(Qe++,ree(gn[Qe++]&63,gn[Qe++])):sS(2);case 214:return sS(4);case 215:return sS(8);case 216:return sS(16);case 217:return e=gn[Qe++],gg>=Qe?K_.slice(Qe-Mf,(Qe+=e)-Mf):w8e(e);case 218:return e=Ni.getUint16(Qe),Qe+=2,gg>=Qe?K_.slice(Qe-Mf,(Qe+=e)-Mf):C8e(e);case 219:return e=Ni.getUint32(Qe),Qe+=4,gg>=Qe?K_.slice(Qe-Mf,(Qe+=e)-Mf):R8e(e);case 220:return e=Ni.getUint16(Qe),Qe+=2,QQ(e);case 221:return e=Ni.getUint32(Qe),Qe+=4,QQ(e);case 222:return e=Ni.getUint16(Qe),Qe+=2,eee(e);case 223:return e=Ni.getUint32(Qe),Qe+=4,eee(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const x8e=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function W7(t,e){function n(){if(n.count++>Pde){let i=t.read=new Function("r","return function(){return "+(na.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":x8e.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Uo);return t.highByte===0&&(t.read=ZQ(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let a=t[i];a==="__proto__"&&(a="__proto_"),r[a]=Uo()}return na.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?ZQ(e,n):n}const ZQ=(t,e)=>function(){let n=gn[Qe++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ui[r]||Lde()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=W7(i,t)),i.read()};function Lde(){let t=Hde(()=>(gn=null,na.getStructures()));return Ui=na._mergeStructures(t,Ui)}var TV=LN,w8e=LN,C8e=LN,R8e=LN;function LN(t){let e;if(t<16&&(e=Y7(t)))return e;if(t>64&&SV)return SV.decode(gn.subarray(Qe,Qe+=t));const n=Qe+t,r=[];for(e="";Qe<n;){const i=gn[Qe++];if(!(i&128))r.push(i);else if((i&224)===192){const s=gn[Qe++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=gn[Qe++]&63,a=gn[Qe++]&63;r.push((i&31)<<12|s<<6|a)}else if((i&248)===240){const s=gn[Qe++]&63,a=gn[Qe++]&63,o=gn[Qe++]&63;let c=(i&7)<<18|s<<12|a<<6|o;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=nl.apply(String,r),r.length=0)}return r.length>0&&(e+=nl.apply(String,r)),e}function QQ(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=Uo();return na.freezeData?Object.freeze(e):e}function eee(t){if(na.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=Bde();r==="__proto__"&&(r="__proto_"),e[r]=Uo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Uo(),Uo());return e}}var nl=String.fromCharCode;function Ude(t){let e=Qe,n=new Array(t);for(let r=0;r<t;r++){const i=gn[Qe++];if((i&128)>0){Qe=e;return}n[r]=i}return nl.apply(String,n)}function Y7(t){if(t<4)if(t<2){if(t===0)return"";{let e=gn[Qe++];if((e&128)>1){Qe-=1;return}return nl(e)}}else{let e=gn[Qe++],n=gn[Qe++];if((e&128)>0||(n&128)>0){Qe-=2;return}if(t<3)return nl(e,n);let r=gn[Qe++];if((r&128)>0){Qe-=3;return}return nl(e,n,r)}else{let e=gn[Qe++],n=gn[Qe++],r=gn[Qe++],i=gn[Qe++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){Qe-=4;return}if(t<6){if(t===4)return nl(e,n,r,i);{let s=gn[Qe++];if((s&128)>0){Qe-=5;return}return nl(e,n,r,i,s)}}else if(t<8){let s=gn[Qe++],a=gn[Qe++];if((s&128)>0||(a&128)>0){Qe-=6;return}if(t<7)return nl(e,n,r,i,s,a);let o=gn[Qe++];if((o&128)>0){Qe-=7;return}return nl(e,n,r,i,s,a,o)}else{let s=gn[Qe++],a=gn[Qe++],o=gn[Qe++],c=gn[Qe++];if((s&128)>0||(a&128)>0||(o&128)>0||(c&128)>0){Qe-=8;return}if(t<10){if(t===8)return nl(e,n,r,i,s,a,o,c);{let l=gn[Qe++];if((l&128)>0){Qe-=9;return}return nl(e,n,r,i,s,a,o,c,l)}}else if(t<12){let l=gn[Qe++],u=gn[Qe++];if((l&128)>0||(u&128)>0){Qe-=10;return}if(t<11)return nl(e,n,r,i,s,a,o,c,l,u);let h=gn[Qe++];if((h&128)>0){Qe-=11;return}return nl(e,n,r,i,s,a,o,c,l,u,h)}else{let l=gn[Qe++],u=gn[Qe++],h=gn[Qe++],d=gn[Qe++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){Qe-=12;return}if(t<14){if(t===12)return nl(e,n,r,i,s,a,o,c,l,u,h,d);{let f=gn[Qe++];if((f&128)>0){Qe-=13;return}return nl(e,n,r,i,s,a,o,c,l,u,h,d,f)}}else{let f=gn[Qe++],p=gn[Qe++];if((f&128)>0||(p&128)>0){Qe-=14;return}if(t<15)return nl(e,n,r,i,s,a,o,c,l,u,h,d,f,p);let g=gn[Qe++];if((g&128)>0){Qe-=15;return}return nl(e,n,r,i,s,a,o,c,l,u,h,d,f,p,g)}}}}}function tee(){let t=gn[Qe++],e;if(t<192)e=t-160;else switch(t){case 217:e=gn[Qe++];break;case 218:e=Ni.getUint16(Qe),Qe+=2;break;case 219:e=Ni.getUint32(Qe),Qe+=4;break;default:throw new Error("Expected string")}return LN(e)}function rH(t){return na.copyBuffers?Uint8Array.prototype.slice.call(gn,Qe,Qe+=t):gn.subarray(Qe,Qe+=t)}function sS(t){let e=gn[Qe++];if(nd[e]){let n;return nd[e](gn.subarray(Qe,n=Qe+=t),r=>{Qe=r;try{return Uo()}finally{Qe=n}})}else throw new Error("Unknown extension type "+e)}var nee=new Array(4096);function Bde(){let t=gn[Qe++];if(t>=160&&t<192){if(t=t-160,gg>=Qe)return K_.slice(Qe-Mf,(Qe+=t)-Mf);if(!(gg==0&&jf<180))return TV(t)}else return Qe--,Fde(Uo());let e=(t<<5^(t>1?Ni.getUint16(Qe):t>0?gn[Qe]:0))&4095,n=nee[e],r=Qe,i=Qe+t-3,s,a=0;if(n&&n.bytes==t){for(;r<i;){if(s=Ni.getUint32(r),s!=n[a++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=gn[r++],s!=n[a++]){r=1879048192;break}if(r===i)return Qe=r,n.string;i-=3,r=Qe}for(n=[],nee[e]=n,n.bytes=t;r<i;)s=Ni.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=gn[r++],n.push(s);let o=t<16?Y7(t):Ude(t);return o!=null?n.string=o:n.string=TV(t)}function Fde(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const ree=(t,e)=>{let n=Uo().map(Fde),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ui[t];return i&&(i.isShared||cb)&&((Ui.restoreStructures||(Ui.restoreStructures=[]))[t]=i),Ui[t]=n,n.read=W7(n,r),n.read()};nd[0]=()=>{};nd[0].noBuffer=!0;nd[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let A8e={Error,TypeError,ReferenceError};nd[101]=()=>{let t=Uo();return(A8e[t[0]]||Error)(t[1],{cause:t[2]})};nd[105]=t=>{if(na.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ni.getUint32(Qe-4);qv||(qv=new Map);let n=gn[Qe],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};qv.set(e,i);let s=Uo();return i.used?Object.assign(r,s):(i.target=s,s)};nd[112]=t=>{if(na.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Ni.getUint32(Qe-4),n=qv.get(e);return n.used=!0,n.target};nd[115]=()=>new Set(Uo());const zde=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let M8e=typeof globalThis=="object"?globalThis:window;nd[116]=t=>{let e=t[0],n=zde[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new M8e[n](Uint8Array.prototype.slice.call(t,1).buffer)};nd[120]=()=>{let t=Uo();return new RegExp(t[0],t[1])};const O8e=[];nd[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=Qe;return Qe+=e-t.length,sl=O8e,sl=[tee(),tee()],sl.position0=0,sl.position1=0,sl.postBundlePosition=Qe,Qe=n,Uo()};nd[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function Hde(t){let e=jf,n=Qe,r=Mf,i=gg,s=K_,a=qv,o=sl,c=new Uint8Array(gn.slice(0,jf)),l=Ui,u=Ui.slice(0,Ui.length),h=na,d=cb,f=t();return jf=e,Qe=n,Mf=r,gg=i,K_=s,qv=a,sl=o,gn=c,cb=d,Ui=l,Ui.splice(0,Ui.length,...u),na=h,Ni=new DataView(gn.buffer,gn.byteOffset,gn.byteLength),f}function xV(){gn=null,qv=null,Ui=null}const X7=new Array(147);for(let t=0;t<256;t++)X7[t]=+("1e"+Math.floor(45.15-t*.30103));var mB=new rO({useRecords:!1});mB.unpack;mB.unpackMultiple;mB.unpack;let N8e=new Float32Array(1);new Uint8Array(N8e.buffer,0,4);let hP;try{hP=new TextEncoder}catch{}let wV,jde;const gB=typeof kl<"u",iD=gB?function(t){return kl.allocUnsafeSlow(t)}:Uint8Array,Vde=gB?kl:Uint8Array,iee=gB?4294967296:2144337920;let _t,JR,ea,tt=0,Fu,$a=null,I8e;const k8e=21760,D8e=/[\u0080-\uFFFF]/,o1=Symbol("record-id");class P8e extends rO{constructor(e){super(e),this.offset=0;let n,r,i,s,a=Vde.prototype.utf8Write?function(G,X){return _t.utf8Write(G,X,_t.byteLength-X)}:hP&&hP.encodeInto?function(G,X){return hP.encodeInto(G,_t.subarray(X)).written}:!1,o=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],_=0,v=0;this.pack=this.encode=function(G,X){if(_t||(_t=new iD(8192),ea=_t.dataView||(_t.dataView=new DataView(_t.buffer,0,8192)),tt=0),Fu=_t.length-10,Fu-tt<2048?(_t=new iD(_t.length),ea=_t.dataView||(_t.dataView=new DataView(_t.buffer,0,_t.length)),Fu=_t.length-10,tt=0):tt=tt+7&2147483640,n=tt,X&H8e&&(tt+=X&255),s=o.structuredClone?new Map:null,o.bundleStrings&&typeof G!="string"?($a=[],$a.size=1/0):$a=null,i=o.structures,i){i.uninitialized&&(i=o._mergeStructures(o.getStructures()));let V=i.sharedLength||0;if(V>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let Z=0;Z<V;Z++){let Y=i[Z];if(!Y)continue;let ee,oe=i.transitions;for(let de=0,Me=Y.length;de<Me;de++){let He=Y[de];ee=oe[He],ee||(ee=oe[He]=Object.create(null)),oe=ee}oe[o1]=Z+64}this.lastNamedStructuresLength=V}c||(i.nextId=V+64)}r&&(r=!1);let re;try{o.randomAccessStructure&&G&&G.constructor&&G.constructor===Object?q(G):x(G);let V=$a;if($a&&oee(n,x,0),s&&s.idsToInsert){let Z=s.idsToInsert.sort((de,Me)=>de.offset>Me.offset?1:-1),Y=Z.length,ee=-1;for(;V&&Y>0;){let de=Z[--Y].offset+n;de<V.stringsPosition+n&&ee===-1&&(ee=0),de>V.position+n?ee>=0&&(ee+=6):(ee>=0&&(ea.setUint32(V.position+n,ea.getUint32(V.position+n)+ee),ee=-1),V=V.previous,Y++)}ee>=0&&V&&ea.setUint32(V.position+n,ea.getUint32(V.position+n)+ee),tt+=Z.length*6,tt>Fu&&L(tt),o.offset=tt;let oe=U8e(_t.subarray(n,tt),Z);return s=null,oe}return o.offset=tt,X&F8e?(_t.start=n,_t.end=tt,_t):_t.subarray(n,tt)}catch(V){throw re=V,V}finally{if(i&&(E(),r&&o.saveStructures)){let V=i.sharedLength||0,Z=_t.subarray(n,tt),Y=B8e(i,o);if(!re)return o.saveStructures(Y,Y.isCompatible)===!1?o.pack(G,X):(o.lastNamedStructuresLength=V,_t.length>1073741824&&(_t=null),Z)}_t.length>1073741824&&(_t=null),X&z8e&&(tt=n)}};const E=()=>{v<10&&v++;let G=i.sharedLength||0;if(i.length>G&&!c&&(i.length=G),_>1e4)i.transitions=null,v=0,_=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let X=0,re=g.length;X<re;X++)g[X][o1]=0;g=[]}},T=G=>{var X=G.length;X<16?_t[tt++]=144|X:X<65536?(_t[tt++]=220,_t[tt++]=X>>8,_t[tt++]=X&255):(_t[tt++]=221,ea.setUint32(tt,X),tt+=4);for(let re=0;re<X;re++)x(G[re])},x=G=>{tt>Fu&&(_t=L(tt));var X=typeof G,re;if(X==="string"){let V=G.length;if($a&&V>=4&&V<4096){if(($a.size+=V)>k8e){let oe,de=($a[0]?$a[0].length*3+$a[1].length:0)+10;tt+de>Fu&&(_t=L(tt+de));let Me;$a.position?(Me=$a,_t[tt]=200,tt+=3,_t[tt++]=98,oe=tt-n,tt+=4,oee(n,x,0),ea.setUint16(oe+n-3,tt-n-oe)):(_t[tt++]=214,_t[tt++]=98,oe=tt-n,tt+=4),$a=["",""],$a.previous=Me,$a.size=0,$a.position=oe}let ee=D8e.test(G);$a[ee?0:1]+=G,_t[tt++]=193,x(ee?-V:V);return}let Z;V<32?Z=1:V<256?Z=2:V<65536?Z=3:Z=5;let Y=V*3;if(tt+Y>Fu&&(_t=L(tt+Y)),V<64||!a){let ee,oe,de,Me=tt+Z;for(ee=0;ee<V;ee++)oe=G.charCodeAt(ee),oe<128?_t[Me++]=oe:oe<2048?(_t[Me++]=oe>>6|192,_t[Me++]=oe&63|128):(oe&64512)===55296&&((de=G.charCodeAt(ee+1))&64512)===56320?(oe=65536+((oe&1023)<<10)+(de&1023),ee++,_t[Me++]=oe>>18|240,_t[Me++]=oe>>12&63|128,_t[Me++]=oe>>6&63|128,_t[Me++]=oe&63|128):(_t[Me++]=oe>>12|224,_t[Me++]=oe>>6&63|128,_t[Me++]=oe&63|128);re=Me-tt-Z}else re=a(G,tt+Z);re<32?_t[tt++]=160|re:re<256?(Z<2&&_t.copyWithin(tt+2,tt+1,tt+1+re),_t[tt++]=217,_t[tt++]=re):re<65536?(Z<3&&_t.copyWithin(tt+3,tt+2,tt+2+re),_t[tt++]=218,_t[tt++]=re>>8,_t[tt++]=re&255):(Z<5&&_t.copyWithin(tt+5,tt+3,tt+3+re),_t[tt++]=219,ea.setUint32(tt,re),tt+=4),tt+=re}else if(X==="number")if(G>>>0===G)G<32||G<128&&this.useRecords===!1||G<64&&!this.randomAccessStructure?_t[tt++]=G:G<256?(_t[tt++]=204,_t[tt++]=G):G<65536?(_t[tt++]=205,_t[tt++]=G>>8,_t[tt++]=G&255):(_t[tt++]=206,ea.setUint32(tt,G),tt+=4);else if(G>>0===G)G>=-32?_t[tt++]=256+G:G>=-128?(_t[tt++]=208,_t[tt++]=G+256):G>=-32768?(_t[tt++]=209,ea.setInt16(tt,G),tt+=2):(_t[tt++]=210,ea.setInt32(tt,G),tt+=4);else{let V;if((V=this.useFloat32)>0&&G<4294967296&&G>=-2147483648){_t[tt++]=202,ea.setFloat32(tt,G);let Z;if(V<4||(Z=G*X7[(_t[tt]&127)<<1|_t[tt+1]>>7])>>0===Z){tt+=4;return}else tt--}_t[tt++]=203,ea.setFloat64(tt,G),tt+=8}else if(X==="object"||X==="function")if(!G)_t[tt++]=192;else{if(s){let Z=s.get(G);if(Z){if(!Z.id){let Y=s.idsToInsert||(s.idsToInsert=[]);Z.id=Y.push(Z)}_t[tt++]=214,_t[tt++]=112,ea.setUint32(tt,Z.id),tt+=4;return}else s.set(G,{offset:tt-n})}let V=G.constructor;if(V===Object)k(G);else if(V===Array)T(G);else if(V===Map)if(this.mapAsEmptyObject)_t[tt++]=128;else{re=G.size,re<16?_t[tt++]=128|re:re<65536?(_t[tt++]=222,_t[tt++]=re>>8,_t[tt++]=re&255):(_t[tt++]=223,ea.setUint32(tt,re),tt+=4);for(let[Z,Y]of G)x(Z),x(Y)}else{for(let Z=0,Y=wV.length;Z<Y;Z++){let ee=jde[Z];if(G instanceof ee){let oe=wV[Z];if(oe.write){oe.type&&(_t[tt++]=212,_t[tt++]=oe.type,_t[tt++]=0);let Le=oe.write.call(this,G);Le===G?Array.isArray(G)?T(G):k(G):x(Le);return}let de=_t,Me=ea,He=tt;_t=null;let Te;try{Te=oe.pack.call(this,G,Le=>(_t=de,de=null,tt+=Le,tt>Fu&&L(tt),{target:_t,targetView:ea,position:tt-Le}),x)}finally{de&&(_t=de,ea=Me,tt=He,Fu=_t.length-10)}Te&&(Te.length+tt>Fu&&L(Te.length+tt),tt=L8e(Te,_t,tt,oe.type));return}}if(Array.isArray(G))T(G);else{if(G.toJSON){const Z=G.toJSON();if(Z!==G)return x(Z)}if(X==="function")return x(this.writeFunction&&this.writeFunction(G));k(G)}}}else if(X==="boolean")_t[tt++]=G?195:194;else if(X==="bigint"){if(G<BigInt(1)<<BigInt(63)&&G>=-(BigInt(1)<<BigInt(63)))_t[tt++]=211,ea.setBigInt64(tt,G);else if(G<BigInt(1)<<BigInt(64)&&G>0)_t[tt++]=207,ea.setBigUint64(tt,G);else if(this.largeBigIntToFloat)_t[tt++]=203,ea.setFloat64(tt,Number(G));else{if(this.largeBigIntToString)return x(G.toString());if(this.useBigIntExtension&&G<BigInt(2)**BigInt(1023)&&G>-(BigInt(2)**BigInt(1023))){_t[tt++]=199,tt++,_t[tt++]=66;let V=[],Z;do{let Y=G&BigInt(255);Z=(Y&BigInt(128))===(G<BigInt(0)?BigInt(128):BigInt(0)),V.push(Y),G>>=BigInt(8)}while(!((G===BigInt(0)||G===BigInt(-1))&&Z));_t[tt-2]=V.length;for(let Y=V.length;Y>0;)_t[tt++]=Number(V[--Y]);return}else throw new RangeError(G+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}tt+=8}else if(X==="undefined")this.encodeUndefinedAsNil?_t[tt++]=192:(_t[tt++]=212,_t[tt++]=0,_t[tt++]=0);else throw new Error("Unknown type: "+X)},N=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?G=>{let X;if(this.skipValues){X=[];for(let Z in G)(typeof G.hasOwnProperty!="function"||G.hasOwnProperty(Z))&&!this.skipValues.includes(G[Z])&&X.push(Z)}else X=Object.keys(G);let re=X.length;re<16?_t[tt++]=128|re:re<65536?(_t[tt++]=222,_t[tt++]=re>>8,_t[tt++]=re&255):(_t[tt++]=223,ea.setUint32(tt,re),tt+=4);let V;if(this.coercibleKeyAsNumber)for(let Z=0;Z<re;Z++){V=X[Z];let Y=Number(V);x(isNaN(Y)?V:Y),x(G[V])}else for(let Z=0;Z<re;Z++)x(V=X[Z]),x(G[V])}:G=>{_t[tt++]=222;let X=tt-n;tt+=2;let re=0;for(let V in G)(typeof G.hasOwnProperty!="function"||G.hasOwnProperty(V))&&(x(V),x(G[V]),re++);if(re>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');_t[X+++n]=re>>8,_t[X+n]=re&255},A=this.useRecords===!1?N:e.progressiveRecords&&!d?G=>{let X,re=i.transitions||(i.transitions=Object.create(null)),V=tt++-n,Z;for(let Y in G)if(typeof G.hasOwnProperty!="function"||G.hasOwnProperty(Y)){if(X=re[Y],X)re=X;else{let ee=Object.keys(G),oe=re;re=i.transitions;let de=0;for(let Me=0,He=ee.length;Me<He;Me++){let Te=ee[Me];X=re[Te],X||(X=re[Te]=Object.create(null),de++),re=X}V+n+1==tt?(tt--,U(re,ee,de)):$(re,ee,V,de),Z=!0,re=oe[Y]}x(G[Y])}if(!Z){let Y=re[o1];Y?_t[V+n]=Y:$(re,Object.keys(G),V,0)}}:G=>{let X,re=i.transitions||(i.transitions=Object.create(null)),V=0;for(let Y in G)(typeof G.hasOwnProperty!="function"||G.hasOwnProperty(Y))&&(X=re[Y],X||(X=re[Y]=Object.create(null),V++),re=X);let Z=re[o1];Z?Z>=96&&d?(_t[tt++]=((Z-=96)&31)+96,_t[tt++]=Z>>5):_t[tt++]=Z:U(re,re.__keys__||Object.keys(G),V);for(let Y in G)(typeof G.hasOwnProperty!="function"||G.hasOwnProperty(Y))&&x(G[Y])},I=typeof this.useRecords=="function"&&this.useRecords,k=I?G=>{I(G)?A(G):N(G)}:A,L=G=>{let X;if(G>16777216){if(G-n>iee)throw new Error("Packed buffer would be larger than maximum buffer size");X=Math.min(iee,Math.round(Math.max((G-n)*(G>67108864?1.25:2),4194304)/4096)*4096)}else X=(Math.max(G-n<<2,_t.length-1)>>12)+1<<12;let re=new iD(X);return ea=re.dataView||(re.dataView=new DataView(re.buffer,0,X)),G=Math.min(G,_t.length),_t.copy?_t.copy(re,0,n,G):re.set(_t.slice(n,G)),tt-=n,n=0,Fu=re.length-10,_t=re},U=(G,X,re)=>{let V=i.nextId;V||(V=64),V<f&&this.shouldShareStructure&&!this.shouldShareStructure(X)?(V=i.nextOwnId,V<p||(V=f),i.nextOwnId=V+1):(V>=p&&(V=f),i.nextId=V+1);let Z=X.highByte=V>=96&&d?V-96>>5:-1;G[o1]=V,G.__keys__=X,i[V-64]=X,V<f?(X.isShared=!0,i.sharedLength=V-63,r=!0,Z>=0?(_t[tt++]=(V&31)+96,_t[tt++]=Z):_t[tt++]=V):(Z>=0?(_t[tt++]=213,_t[tt++]=114,_t[tt++]=(V&31)+96,_t[tt++]=Z):(_t[tt++]=212,_t[tt++]=114,_t[tt++]=V),re&&(_+=v*re),g.length>=h&&(g.shift()[o1]=0),g.push(G),x(X))},$=(G,X,re,V)=>{let Z=_t,Y=tt,ee=Fu,oe=n;_t=JR,tt=0,n=0,_t||(JR=_t=new iD(8192)),Fu=_t.length-10,U(G,X,V),JR=_t;let de=tt;if(_t=Z,tt=Y,Fu=ee,n=oe,de>1){let Me=tt+de-1;Me>Fu&&L(Me);let He=re+n;_t.copyWithin(He+de,He+1,tt),_t.set(JR.slice(0,de),He),tt=Me}else _t[re+n]=JR[0]},q=G=>{let X=I8e(G,_t,n,tt,i,L,(re,V,Z)=>{if(Z)return r=!0;tt=V;let Y=_t;return x(re),E(),Y!==_t?{position:tt,targetView:ea,target:_t}:tt},this);if(X===0)return k(G);tt=X}}useBuffer(e){_t=e,_t.dataView||(_t.dataView=new DataView(_t.buffer,_t.byteOffset,_t.byteLength)),tt=0}set position(e){tt=e}get position(){return tt}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}jde=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,kde];wV=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:a}=e(6);i[a++]=214,i[a++]=255,s.setUint32(a,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:a}=e(10);i[a++]=215,i[a++]=255,s.setUint32(a,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:a}=e(3);i[a++]=212,i[a++]=255,i[a++]=255}else{let{target:i,targetView:s,position:a}=e(15);i[a++]=199,i[a++]=12,i[a++]=255,s.setUint32(a,t.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?see(t,16,e):aee(gB?kl.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==Vde&&this.moreTypes?see(t,zde.indexOf(n.name),e):aee(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function see(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:a}=n(4+i);s[a++]=199,s[a++]=i+1}else if(i+1<65536){var{target:s,position:a}=n(5+i);s[a++]=200,s[a++]=i+1>>8,s[a++]=i+1&255}else{var{target:s,position:a,targetView:o}=n(7+i);s[a++]=201,o.setUint32(a,i+1),a+=4}s[a++]=116,s[a++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function aee(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function L8e(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function U8e(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,a=n.id;t.copyWithin(s+r,s,i),r-=6;let o=s+r;t[o++]=214,t[o++]=105,t[o++]=a>>24,t[o++]=a>>16&255,t[o++]=a>>8&255,t[o++]=a&255,i=s}return t}function oee(t,e,n){if($a.length>0){ea.setUint32($a.position+t,tt+n-$a.position-t),$a.stringsPosition=tt-t;let r=$a;$a=null,e(r[0]),e(r[1])}}function B8e(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Gde=new P8e({useRecords:!1});Gde.pack;Gde.pack;const F8e=512,z8e=1024,H8e=2048,Ge=Wb("SOFTWARE");function cee(){return{id:Do()}}function Hd(t){var e;return(((e=t==null?void 0:t.id)==null?void 0:e.length)??0)>0}function k2(t,e){if(!ae(t)||!qg(e))return;const{color:n,bg:r}=Hpe(e);ae(n)&&(t.color=n),ae(r)&&(t.bg=r)}function JC(t){var e;return ar((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}const fr=60,ji=25,K7=fr*ji;var Wn=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Wn||{});function j8e(){return new Array(fr*ji).map(()=>{})}function J7(t=Vu){const e={terrain:j8e(),objects:{},id:""};return t(e)}function D2(t){return T_(t.x,t.y,0,fr-1,ji-1,0)}function _T(t,e){return!ae(t)||!ae(e==null?void 0:e.x)||!ae(e==null?void 0:e.y)||e.x<0||e.x>=fr||e.y<0||e.y>=ji?-1:e.x+e.y*fr}function jh(t,e){const n=_T(t,e);if(n<0||!ae(t==null?void 0:t.lookup))return;const r=ay(t,t.lookup[n]??"");return ae(r)?r:t.terrain[n]}function vB(t,e,n){return(e>=0&&e<fr)??(n>=0&&n<ji)?t==null?void 0:t.terrain[e+n*fr]:void 0}function jd(t,e){if(!ae(t)||!ae(e)||!ae(e.x)||!ae(e.y)||e.x<0||e.x>=fr||e.y<0||e.y>=ji)return;const n=cl(e),r=e.x+e.y*fr;return t.terrain[r]=n,delete t.distmaps,t.terrain[r]}function V8e(t,e){if(!ae(t)||!ae(e))return;const n=cl(e);return n.id=n.id??Do(),t.objects[n.id]=n,t.objects[n.id]}function G8e(t,e,n){return jd(t,{...e,kind:n})}function qde(t,e,n,r){return V8e(t,{...e,kind:n,id:r})}function ay(t,e){if(t)return t.objects[e]}function q8e(t,e){const n=_T(t,e);if(n<0||!ae(t==null?void 0:t.lookup))return;const r=ay(t,t.lookup[n]??"");if(ae(r))return r}function $8e(t,e,n){if(!ae(t)||!ae(e))return;const r=t.objects[n];if(ae(r))return r;if(oC(e))return Yde(e,UN(t,"player"))}function iO(t,e){const n=t??bs.ISWALK,r=e??bs.ISWALK;switch(n){case bs.ISWALK:return r!==bs.ISWALK;case bs.ISSWIM:return r!==bs.ISSWIM;case bs.ISSOLID:return!0;case bs.ISBULLET:return r!==bs.ISWALK&&r!==bs.ISSWIM}}function sO(t,e,n){const r=t==null?void 0:t.objects[n];if(ae(r))return r;const i=UN(t,"player");return ae(e)?(e.x<0&&(e.x=Hf(0,fr-1)),e.y<0&&(e.y=Hf(0,ji-1)),Yde(e,i)):Ya(...i)}function UN(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(ae)}function W8e(t){const e=[];for(let n=0;n<ji;++n)for(let r=0;r<fr;++r){const i={x:r,y:n},s=jh(t,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&e.push(i)}return e}function $de(t,e){const n=EV(e),r=Ode(e),i=Nde(e);return UN(t,n??"").filter(s=>{var a,o,c;return!(ae(n)&&ar((s==null?void 0:s.name)??((a=s==null?void 0:s.kinddata)==null?void 0:a.name)??"")!==n||ae(r)&&((s==null?void 0:s.color)??((o=s==null?void 0:s.kinddata)==null?void 0:o.color)??Qt.WHITE)!==r||ae(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Qt.BLACK)!==i)}).filter(ae)}function Wde(t,e){return ae(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(ae(i))return i;const s=UN(t,ar(n));if(s.length)return s}else if(oC(n)&&n.x>=0&&n.x<fr&&n.y>=0&&n.y<ji){const i=n.x+n.y*fr,s=(r=t.lookup)==null?void 0:r[i];return ae(s)?t.objects[s]:t.terrain[i]}}).flat().filter(ae):[]}function Yde(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const a=t.x-(s.x??0),o=t.y-(s.y??0),c=Math.sqrt(a*a+o*o);(r===void 0||c<n)&&(n=c,r=s)}}return r}function qs(t){return`${t??""}`}function LS(t,e){const n=parseFloat(qs(t));return isNaN(n)?e:n}function ou(t,e){return typeof t==typeof e?t:e}const yB=V7(32,126).map(t=>String.fromCharCode(t));function xi(t){return Qd({...t,name:`token_${t.name}`})}function Zb(t,e=!1){return xi(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:vl,group:Uc.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:vl})}const lC=xi({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Xde=xi({name:"whitespace",pattern:/ +/,group:Uc.SKIPPED}),Kde=xi({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Uc.SKIPPED}),BN=xi({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),AS=xi({name:"command",pattern:/#/,start_chars_hint:["#"]});let Jde=!1;function Y8e(t,e,n){if(!Jde)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==lC)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const a=t.substring(e,s);return a.trim().length===0?null:[a]}const _B=xi({name:"text",pattern:Y8e,line_breaks:!1,start_chars_hint:yB.filter(t=>"@#/?':!".includes(t)===!1)}),Z7=xi({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Q7=xi({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),eW=xi({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),tW=xi({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),vl=xi({name:"stringliteral",pattern:/[^-0-9"!;@#/?()\s]+[^-"!;@#/?()\s]*/,start_chars_hint:yB}),nW=xi({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),rW=xi({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),iW=xi({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:vl}),sW=xi({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:vl}),aW=xi({name:"islessthan",pattern:/<|below/,longer_alt:vl}),oW=xi({name:"isgreaterthan",pattern:/>|above/,longer_alt:vl}),cW=xi({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:vl}),lW=xi({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:vl}),P2=xi({name:"or",pattern:/or/i,longer_alt:vl}),L2=xi({name:"not",pattern:/not/i,longer_alt:vl}),U2=xi({name:"and",pattern:/and/i,longer_alt:vl}),B2=xi({name:"plus",pattern:/\+/}),F2=xi({name:"minus",pattern:/-/}),uW=xi({name:"power",pattern:/\*\*/}),hW=xi({name:"multiply",pattern:/\*/}),z2=xi({name:"divide",pattern:/\//}),dW=xi({name:"moddivide",pattern:/%/}),fW=xi({name:"floordivide",pattern:/%%/}),pW=xi({name:"query",pattern:/\?/}),mW=xi({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),gW=xi({name:"rparen",pattern:/\)/,pop_mode:!0}),vW=xi({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:yB,longer_alt:vl}),Zde=xi({name:"command_toast",pattern:/toast .*/,start_chars_hint:yB,longer_alt:vl}),H2=xi({name:"if",pattern:/if|try|take|give/,longer_alt:vl}),nM=Zb("do"),j2=Zb("done"),V2=Zb("else"),yW=Zb("while"),_W=Zb("repeat"),bW=Zb("waitfor"),EW=xi({name:"foreach",pattern:/foreach|for/,longer_alt:vl}),SW=Zb("break"),TW=Zb("continue");function Qde(t){return[...t,rW,iW,sW,cW,aW,lW,oW,P2,L2,U2,B2,F2,uW,hW,z2,fW,dW,pW,mW,gW,nW,vl]}const efe=Qde([_B,BN,vW,Zde,AS,Z7,Q7,eW,tW,lC,Xde,SW,TW,j2,nM,V2,EW,H2,_W,bW,yW]),X8e=new Uc({defaultMode:"use_newlines",modes:{use_newlines:efe,ignore_newlines:Qde([Kde])}},{skipValidations:!zg,ensureOptimizations:zg});function xW(t){Jde=!0;const e=X8e.tokenize(t||` 
`),[n]=(Lr(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(PN(lC,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function tfe(t,e,n=!0){if(n){const[r,...i]=e;switch(ar(r??"")){default:return{type:cn.OBJECT,values:e};case"loader":return{type:cn.LOADER,values:i};case"board":return{type:cn.BOARD,values:i};case"object":return{type:cn.OBJECT,values:i};case"terrain":return{type:cn.TERRAIN,values:i};case"charset":return{type:cn.CHARSET,values:i};case"palette":return{type:cn.PALETTE,values:i}}}else{const[r,i,...s]=e,a=ar(i??""),o=[r,t,...s];switch(a){default:return{type:cn.CONST,values:e};case"rn":case"range":return{type:cn.RANGE,values:o};case"sl":case"select":return{type:cn.SELECT,values:o};case"nm":case"number":return{type:cn.NUMBER,values:o};case"tx":case"text":return{type:cn.TEXT,values:o};case"ln":case"link":return{type:cn.LINK,values:o};case"hk":case"hotkey":return{type:cn.HOTKEY,values:o};case"copyit":return{type:cn.COPYIT,values:o};case"openit":return{type:cn.OPENIT,values:o};case"zssedit":return{type:cn.ZSSEDIT,values:o};case"charedit":return{type:cn.CHAREDIT,values:o};case"coloredit":return{type:cn.COLOREDIT,values:o}}}}function Ud(t){switch(t){case cn.LOADER:return"loader";case cn.BOARD:return"board";case cn.OBJECT:return"object";case cn.TERRAIN:return"terrain";case cn.CHARSET:return"charset";case cn.PALETTE:return"palette";case cn.CONST:return"const";case cn.RANGE:return"range";case cn.SELECT:return"select";case cn.NUMBER:return"number";case cn.TEXT:return"text";case cn.LINK:return"link";case cn.HOTKEY:return"hotkey";case cn.COPYIT:return"copyit";case cn.OPENIT:return"openit";case cn.ZSSEDIT:return"zssedit";case cn.CHAREDIT:return"charedit";case cn.COLOREDIT:return"coloredit"}}function K8e(t,e){return{id:Do(),code:t,...e}}function sD(t){const e={...bB(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function J8e(t){const e=xW(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===BN){const a=s.image.slice(1),[o,c]=a.split(";").map(d=>d.trim()),l=o.split(" "),u=tfe(On(c)?c:"",l,r),h=ar(u.values.join(" "));switch(r=!1,u.type){case cn.LOADER:n.type=Wn.LOADER,n.name=h;break;case cn.BOARD:n.type=Wn.BOARD,n.name=h;break;case cn.OBJECT:n.type=Wn.OBJECT,n.name=h||"object";break;case cn.TERRAIN:n.type=Wn.TERRAIN,n.name=h;break;case cn.CHARSET:n.type=Wn.CHARSET,n.name=h;break;case cn.PALETTE:n.type=Wn.PALETTE,n.name=h;break;case cn.CONST:{const[d,f]=u.values;if(On(d)){const p=ar(d);if(On(f)){const g=parseFloat(f);n[p]=pn(g)?g:f}else pn(f)?n[p]=f:n[p]=1}break}case cn.RANGE:case cn.SELECT:case cn.NUMBER:case cn.TEXT:case cn.LINK:case cn.HOTKEY:case cn.ZSSEDIT:case cn.CHAREDIT:case cn.COLOREDIT:{const[d,...f]=u.values;if(On(d)){const p=ar(d);n[p]=[Ud(u.type),...f]}break}}}}return n}function bB(t){var e;return ae(t)?(ae((e=t.stats)==null?void 0:e.type)||(t.stats=J8e(t.code),ae(t.stats.type)||(t.stats.type=Wn.OBJECT)),t.stats):{}}function nfe(t){switch(t){default:case Wn.ERROR:return"error";case Wn.LOADER:return Ud(cn.LOADER);case Wn.BOARD:return Ud(cn.BOARD);case Wn.OBJECT:return Ud(cn.OBJECT);case Wn.TERRAIN:return Ud(cn.TERRAIN);case Wn.CHARSET:return Ud(cn.CHARSET);case Wn.PALETTE:return Ud(cn.PALETTE)}}function bT(t){return bB(t).type??Wn.ERROR}function aS(t){return nfe(bT(t))}function $u(t){return bB(t).name??""}const aD=new _n;function lee(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!Lr(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"group":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=bs.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=bs.ISSWIM;break;case"issolid":e.collision=bs.ISSOLID;break;case"isbullet":e.collision=bs.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function jc(t){var e;if(ae(t))switch(bT(t)){default:return;case Wn.ERROR:return t.code??"";case Wn.LOADER:return t.code??"";case Wn.BOARD:{ae(t.board)||(t.board=J7()),t.board.id=t.id;const n=sD(t);return t.board.isdark=n.isdark??t.board.isdark?1:0,t.board.startx=n.startx??t.board.startx,t.board.starty=n.starty??t.board.starty,t.board.over=n.over??t.board.over,t.board.under=n.under??t.board.under,t.board.camera=n.camera??t.board.camera,t.board.graphics=n.graphics??t.board.graphics,t.board.facing=n.facing??t.board.facing,t.board.exitnorth=n.exitnorth??t.board.exitnorth,t.board.exitsouth=n.exitsouth??t.board.exitsouth,t.board.exitwest=n.exitwest??t.board.exitwest,t.board.exiteast=n.exiteast??t.board.exiteast,t.board.timelimit=n.timelimit??t.board.timelimit,t.board.restartonzap=n.restartonzap??t.board.restartonzap,t.board.maxplayershots=n.maxplayershots??t.board.maxplayershots,t.board}case Wn.OBJECT:return ae(t.object)||(t.object=cee()),t.object.name=$u(t),t.object.category=dT.ISOBJECT,lee(sD(t),t.object),t.object;case Wn.TERRAIN:return ae(t.terrain)||(t.terrain=cee()),t.terrain.name=$u(t),t.terrain.category=dT.ISTERRAIN,lee(sD(t),t.terrain),t.terrain;case Wn.PALETTE:{if(ae(t.palette)||(t.palette=YC(RN)),ae((e=t.palette)==null?void 0:e.bits)){const n=sD(t),r=X3(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),a=n[s];if(s.startsWith("color")&&On(a)){const o=parseFloat(s.replace("color",""));if(o>=0&&o<=15){aD.set(a);const c=o*fT,l=aD.r*63,u=aD.g*63,h=aD.b*63;t.palette.bits[c+0]=Ei(l,0,63),t.palette.bits[c+1]=Ei(u,0,63),t.palette.bits[c+2]=Ei(h,0,63)}}}}return t.palette}case Wn.CHARSET:return ae(t.charset)||(t.charset=XC(CN)),t.charset}}function rfe(t){return{id:Do(),name:OPe(),timestamp:0,activelist:[],pages:t,flags:{}}}function ife(t){ae(t)&&(t.token=`${NPe()}${Hf(1111,9999)}`)}function KS(t,e){if(!ae(t))return;const n=ar(e);return t.pages.find(i=>i.id===e||n===$u(i))}function eh(t,e,n){if(!ae(t))return;const r=ar(n);return t.pages.find(s=>bT(s)===e&&(s.id===n||r===$u(s)))}function CV(t,e,n){let r=eh(t,e,n);if(!ae(r)){const i=nfe(e);r=K8e(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Z8e(t,r)}return r}function Yf(t,e,n){if(!ae(t))return[];const r=ar(n);return t.pages.filter(s=>bT(s)===e).filter(s=>{const a=bB(s),o=ar($u(s));return s.id===n||r===o||ae(a[n])})}function iH(t){return ae(t)?cl(t.pages).sort((n,r)=>{const i=bT(n),s=bT(r);return i===s?$u(n).localeCompare($u(r)):s-i}):[]}function Z8e(t,e){if(!ae(t)||!ae(e))return!1;const n=KS(t,e.id);return ae(n)?!1:(t.pages.push(e),ife(t),!0)}function sfe(t,e){const n=KS(t,e);if(ae(t)&&ae(n)){const r=ar(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==$u(i)),ife(t),n}}function Rb(t,e){if(ae(e)&&ae(e.kind))return ae(e.kinddata)||(e.kinddata=ae(e.id)?FN(t,e.kind):EB(t,e.kind)),e.kinddata}function Dh(t,e,n){const r=Rb(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function oy(t,e){return qs(Dh(t,e,"group"))}function FN(t,e){const n=e??"",r=eh(t,Wn.OBJECT,n);if(ae(r)){const i=jc(r);return{...cl(i),name:n,code:r.code}}}function EB(t,e){const n=e??"",r=eh(t,Wn.TERRAIN,n);if(ae(r)){const i=jc(r);return{...cl(i),name:n,code:r.code}}}function vw(t,e){const n=KS(t,e);return jc(n)}function SB(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function Q8e(t,e){t&&delete t.flags[e]}function afe(t,e,n){const r=SB(t,e);return r==null?void 0:r[n]}function eHe(t,e,n,r){const i=SB(t,e);return i&&(i[n]=r),r}function tHe(t,e){const n=afe(t,e,"board");return vw(t,On(n)?n:"")}function nHe(t,e,n){if(!ae(t))return;eHe(t,e,"board",n);const r=vw(t,n);ae(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function X1(t,e,n,r){if(!ae(t))return;const i=tHe(t,e);if(!ae(i))return;const s=ay(i,e);if(!Hd(s)||!(s!=null&&s.id))return;const a=vw(t,n);if(!ae(a)||(dl(t,a),wW(t,a,bs.ISWALK,r)))return;delete i.objects[s.id];const o=_T(i,s);i.lookup&&(i.lookup[o]=void 0),s.x=r.x,s.y=r.y,a.objects[s.id]=s;const c=_T(a,s);a.lookup&&(a.lookup[c]=s.id),nHe(t,e,a.id)}function rHe(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=afe(t,r,"board");return On(i)?i:""});return Gze(n)}function iHe(t){const e=rHe(t),n=new Set,r=[];for(let i=0;i<e.length;++i){const s=vw(t,e[i]);if(ae(s)&&!n.has(s.id)){if(On(s.over))if(On(s.overboard)){const a=vw(t,s.overboard);ae(a)?n.has(a.id)||r.push(a):delete s.overboard}else{const a=Yf(t,Wn.BOARD,s.over);if(a.length){const o=Ya(a),c=jc(o);ae(c)&&(s.overboard=c.id)}}else On(s.overboard)&&delete s.overboard;if(r.push(s),On(s.under))if(On(s.underboard)){const a=vw(t,s.underboard);ae(a)||delete s.underboard}else{const a=Yf(t,Wn.BOARD,s.under);if(a.length){const o=Ya(a),c=jc(o);ae(c)&&(s.underboard=c.id)}}else On(s.underboard)&&delete s.underboard}}return r}function sHe(t,e,n,r,i){if(!ae(e))return;ae(e.distmaps)||(e.distmaps={});const s=`${n}.${r.x}.${r.y}.${i.x}.${i.y}`;let a=e.distmaps[s];if(!ae(a)){a=new Array(K7).fill(-2);const o=[{...i}];let c=0;for(;o.length;){const l=o.shift();if(ae(l)&&D2(l)){const u=vT(l,fr);if(a[u]===-2){const h=vB(e,l.x,l.y);iO(n,Dh(t,h,"collision")??bs.ISWALK)||(a[u]=c,o.push({x:l.x,y:l.y-1},{x:l.x,y:l.y+1},{x:l.x-1,y:l.y},{x:l.x+1,y:l.y})),++c}}}e.distmaps[s]=a}return a}function uee(t,e){return D2(t)?e[vT(t,fr)]:-1}function hee(t,e,n,r,i,s){if(!ae(t)||!ae(e))return;const a=sHe(t,e,n,r,i);if(!ae(a))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let c;if(s){let l=s?0:1e4;for(let u=0;u<o.length;++u){const h=uee(o[u],a);h>=0&&h>l&&(l=h,c=o[u])}}else{let l=1e5;for(let u=0;u<o.length;++u){const h=uee(o[u],a);h>=0&&h<l&&(l=h,c=o[u])}}return c}function dl(t,e){var o;if(!ae(t)||!ae(e)||ae(e.lookup)&&ae(e.named))return;const n=new Array(fr*ji).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(ae(l.x)&&ae(l.y)&&ae(l.id)&&!ae(l.removed)){l.category=dT.ISOBJECT,n[l.x+l.y*fr]=l.id;const u=ar(l.name??((o=l.kinddata)==null?void 0:o.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,a=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(ae(l)){l.x=s,l.y=a,l.category=dT.ISTERRAIN;const u=JC(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=fr&&(s=0,++a)}e.lookup=n,e.named=r}function G2(t,e){ae(e)&&(delete e.named,delete e.lookup,dl(t,e))}function dee(t,e,n,r){var s;if(!ae(t)||!ae(e)||!ae(e.named)||!ae(n))return;const i=ar(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function aHe(t,e,n){if(!(!ae(t)||!ae(e)||!ae(e.lookup)||!ae(n==null?void 0:n.id))&&!ae(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*fr]=n.id}}function oHe(t,e,n){var r;if(ae(t)&&ae(e)&&ae(n==null?void 0:n.x)&&ae(n.y)){const i=JC(n),s=_T(e,n);ae((r=e.named)==null?void 0:r[i])&&e.named[i].delete(s)}}function ofe(t,e,n){var r;if(ae(t)&&ae(e)&&ae(n==null?void 0:n.id)){if(ae(e.lookup)&&ae(n.x)&&ae(n.y)){const s=n.x+n.y*fr;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=JC(n);ae((r=e.named)==null?void 0:r[i])&&ae(n.id)&&e.named[i].delete(n.id)}}function cfe(t,e,n,r,i,s){if(!ae(t)||!ae(e)||!ae(n))return{x:0,y:0};const a={x:n.x??0,y:n.y??0},o={x:n.lx??a.x,y:n.ly??a.y},c=Tv(o,a),l=fr-1,u=ji-1;for(let h=0;h<i.length;++h){const d=Xze(i[h]);switch(d){case rn.IDLE:break;case rn.NORTH:case rn.SOUTH:case rn.WEST:case rn.EAST:rc(a,d);break;case rn.BY:{const[f,p]=i.slice(h+1);pn(f)&&pn(p)&&(a.x=Ei(a.x+f,0,l),a.y=Ei(a.y+p,0,u)),h+=2;break}case rn.TO:case rn.AT:{const[f,p]=i.slice(h+1);pn(f)&&pn(p)&&(a.x=Ei(f,0,l),a.y=Ei(p,0,u)),h+=2;break}case rn.FLOW:rc(a,c);break;case rn.SEEK:{const f=$8e(e,n,r);oC(f)&&rc(a,Tv(s,f));break}case rn.RNDNS:rc(a,Ya(rn.NORTH,rn.SOUTH));break;case rn.RNDNE:rc(a,Ya(rn.NORTH,rn.EAST));break;case rn.RND:rc(a,Ya(rn.NORTH,rn.SOUTH,rn.WEST,rn.EAST));break;case rn.CW:case rn.CCW:case rn.OPP:case rn.RNDP:{const f=cfe(t,e,n,r,i.slice(h+1),s);switch(a.x=s.x,a.y=s.y,d){case rn.CW:switch(Tv(s,f)){case rn.NORTH:rc(a,rn.EAST);break;case rn.SOUTH:rc(a,rn.WEST);break;case rn.EAST:rc(a,rn.SOUTH);break;case rn.WEST:rc(a,rn.NORTH);break}break;case rn.CCW:switch(Tv(s,f)){case rn.NORTH:rc(a,rn.WEST);break;case rn.SOUTH:rc(a,rn.EAST);break;case rn.EAST:rc(a,rn.NORTH);break;case rn.WEST:rc(a,rn.SOUTH);break}break;case rn.OPP:switch(Tv(s,f)){case rn.NORTH:rc(a,rn.SOUTH);break;case rn.SOUTH:rc(a,rn.NORTH);break;case rn.EAST:rc(a,rn.WEST);break;case rn.WEST:rc(a,rn.EAST);break}break;case rn.RNDP:switch(Tv(s,f)){case rn.NORTH:case rn.SOUTH:a.x+=Ya(-1,1);break;case rn.WEST:case rn.EAST:a.y+=Ya(-1,1);break}break}break}case rn.FLEE:case rn.AWAY:{const[f,p]=i.slice(h+1);if(pn(f)&&pn(p)){const g={x:Ei(f,0,l),y:Ei(p,0,u)},_=Dh(t,n,"collision"),v=hee(t,e,_,a,g,!0);ae(v)&&(a.x=v.x,a.y=v.y)}h+=2;break}case rn.FIND:case rn.TOWARD:{const[f,p]=i.slice(h+1);if(pn(f)&&pn(p)){const g={x:Ei(f,0,l),y:Ei(p,0,u)};if(Hf(1,100)<5)rc(a,Ya(rn.NORTH,rn.SOUTH,rn.WEST,rn.EAST));else{const _=Dh(t,n,"collision"),v=hee(t,e,_,a,g,!1);if(ae(v))if(v.x!==f&&v.y!==p&&q8e(e,v))switch(Tv(s,v)){case rn.EAST:case rn.WEST:a.y+=Ya(-1,1);break;case rn.NORTH:case rn.SOUTH:a.x+=Ya(-1,1);break}else a.x=v.x,a.y=v.y}}h+=2;break}case rn.PLAYER:{const f=sO(e,s,r);oC(f)&&(a.x=f.x,a.y=f.y);break}}}return a}function cHe(t,e,n,r){if(ae(t)&&ae(e)&&ae(n)){const[i,s]=n,a=FN(t,i);if(ae(a)&&ae(a.name)){const o=qde(e,r,i);return k2(o,s),o}}}function ET(t,e,n,r,i){if(ae(t)&&ae(e)&&ae(n)){const[s,a]=n,o=EB(t,s);if(ae(o)){const l=G8e(e,r,s);if(ae(l)){k2(l,a);const u=vT(r,fr);return Rb(t,l),dee(t,e,l,u),l}}const c=FN(t,s);if(ae(c)&&ae(c.name)){const l=qde(e,r,s,i);if(ae(l))return k2(l,a),aHe(t,e,l),Rb(t,l),dee(t,e,l),l}}}function Ig(t,e,n,r){return!ae(n)||JC(n)==="player"?!1:(n.id?(n.removed=r,ofe(t,e,n)):(jd(e,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),oHe(t,e,n)),!0)}function wW(t,e,n,r){if(!ae(t)||!ae(e)||!ae(e.lookup)||r.x<0||r.x>=fr||r.y<0||r.y>=ji)return!0;const i=r.x+r.y*fr,s=ay(e,e.lookup[i]??"404");if(ae(s))return!0;const a=e.terrain[i];if(ae(a)){const o=Rb(t,a),c=a.collision??(o==null?void 0:o.collision);return iO(n,c)}return!1}function lHe(t,e,n,r){const i=ay(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,a=(i==null?void 0:i.y)??-1;if(s-r.x===0&&a-r.y===0)return!0;const o=Dh(t,i,"collision");return wW(t,e,o,r)}function CW(t,e,n,r){var d;const i=ay(e,(n==null?void 0:n.id)??"");if(!ae(t)||!ae(e)||!ae(i)||!ae(i.x)||!ae(i.y)||!ae(e.lookup)||!ae(n)||r.x<0||r.x>=fr||r.y<0||r.y>=ji)return{name:"edge",kind:"edge",collision:bs.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=_T(e,i),a=_T(e,r),o=Dh(t,i,"collision")??bs.ISWALK,c=ob(i==null?void 0:i.id),l=ay(e,e.lookup[a]??""),u=ob((l==null?void 0:l.id)??"");if(ae(l)&&(!c||!u)&&oy(t,n)!==oy(t,l)){if(!!Dh(t,l,"pushable")){const p={x:r.x-(n.x??0),y:r.y-(n.y??0)};CW(t,e,l,p)}return{...l}}const h=e.terrain[a];if(ae(h)){const f=h.collision??((d=h==null?void 0:h.kinddata)==null?void 0:d.collision)??bs.ISWALK;if(iO(o,f))return{...h,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,ae(i.removed)||(e.lookup[s]=void 0,e.lookup[a]=i.id??"")}function uHe(t,e,n){const r=[],i=[];if(!ae(t)||!ae(e))return{objectelements:r,terrainelements:i};const s=Object.values(e.objects);for(let a=0;a<s.length;++a){const o=s[a];oy(t,o)===n&&r.push(o)}for(let a=0;a<K7;++a){const o=e.terrain[a];ae(o)&&oy(t,o)===n&&i.push(o)}return{objectelements:r,terrainelements:i}}var lfe={exports:{}},sH={exports:{}},fee;function hHe(){return fee||(fee=1,function(t,e){(function(n,r){t.exports=r()})(Ll,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],a=["columnNumber","lineNumber"],o=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(a,o,c,l);function h(g){if(g)for(var _=0;_<u.length;_++)g[u[_]]!==void 0&&this["set"+r(u[_])](g[u[_]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",_=this.getLineNumber()||"",v=this.getColumnNumber()||"",E=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+_+":"+v+")":"[eval]:"+_+":"+v:E?E+" ("+g+":"+_+":"+v+")":g+":"+_+":"+v}},h.fromString=function(_){var v=_.indexOf("("),E=_.lastIndexOf(")"),T=_.substring(0,v),x=_.substring(v+1,E).split(","),N=_.substring(E+1);if(N.indexOf("@")===0)var A=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(N,""),I=A[1],k=A[2],L=A[3];return new h({functionName:T,args:x||void 0,fileName:I,lineNumber:k||void 0,columnNumber:L||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(g){return function(_){this[g]=!!_}}(s[d]);for(var f=0;f<a.length;f++)h.prototype["get"+r(a[f])]=i(a[f]),h.prototype["set"+r(a[f])]=function(g){return function(_){if(!n(_))throw new TypeError(g+" must be a Number");this[g]=Number(_)}}(a[f]);for(var p=0;p<o.length;p++)h.prototype["get"+r(o[p])]=i(o[p]),h.prototype["set"+r(o[p])]=function(g){return function(_){this[g]=String(_)}}(o[p]);return h})}(sH)),sH.exports}(function(t,e){(function(n,r){t.exports=r(hHe())})(Ll,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,a=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,g=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:g,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(a)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;f.match(/\(([^)]*)\)/)&&(g=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var _=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:_,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(lfe);var dHe=lfe.exports;const fHe=qc(dHe);function s0(t){const e={},n={tick(){},everytick(){},listcommands(){return X3(e)},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function pee(t,e,n){var i;const[r]=Ot(e,0,[st.MAYBE_NAME]);S_(Ge,t,((i=ne.board)==null?void 0:i.id)??"",r??"",n)}function Lf(t,e,n,r){const[i,s]=Ot(r,0,[st.NUMBER_OR_STRING,st.MAYBE_NUMBER_OR_STRING]);Pue(Ge,t,e,n,i,s)}const pHe=["echo","reverb","phaser","distortion","vibrato","fc"];function ufe(t,e,n){const[r,i]=Ot(n,0,[st.NUMBER_OR_STRING]);if(pn(r))G8(Ge,t,e,"volume",r);else if(pHe.includes(ar(r))){const[s,a]=Ot(n,i,[st.NUMBER_OR_STRING,st.MAYBE_NUMBER_OR_STRING]);Pue(Ge,t,e,r,s,a)}else{const[s]=Ot(n,i,[st.MAYBE_NUMBER_OR_STRING]);if(pn(s)){const a=n.length-i,o=new Array(a).fill(st.NUMBER),c=Ot(n,i,o).slice(0,a),l=c.length===1?c[0]:c;G8(Ge,t,e,r,l)}else{const[a]=Ot(n,i,[st.MAYBE_NUMBER_OR_STRING]);G8(Ge,t,e,r,a)}}}const RW=s0().command("talk",(t,e)=>{const[n]=Ot(e,0,[st.ANY]);switch(ar(n)){default:_De(Ge,ne.elementfocus);break;case"stop":bDe(Ge,ne.elementfocus);break}return 0}).command("media",(t,e)=>{const[n]=Ot(e,0,[st.ANY]);switch(ar(n)){default:EDe(Ge,ne.elementfocus);break;case"stop":SDe(Ge,ne.elementfocus);break}return 0}).command("tts",(t,e)=>{const[n,r]=Ot(e,0,[st.STRING]),i=e.slice(r).map(qs).join("");return DDe(Ge,ne.elementfocus,n,i),0}).command("tta",(t,e)=>{const n=e.map(qs).join("");return PDe(Ge,ne.elementfocus,n),0}).command("bpm",(t,e)=>{const[n]=Ot(e,0,[st.NUMBER]);return LDe(Ge,ne.elementfocus,n),0}).command("vol",(t,e)=>{const[n]=Ot(e,0,[st.NUMBER]);return UDe(Ge,ne.elementfocus,n),0}).command("bgvol",(t,e)=>{const[n]=Ot(e,0,[st.NUMBER]);return BDe(Ge,ne.elementfocus,n),0}).command("ttsvol",(t,e)=>{const[n]=Ot(e,0,[st.NUMBER]);return FDe(Ge,ne.elementfocus,n),0}).command("play",(t,e)=>(pee(ne.elementfocus,e,!1),0)).command("bgplay",(t,e)=>(pee(ne.elementfocus,e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)ufe(ne.elementfocus,n,e);return 0}).command("echo",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"fc",e);return 0}).command("phaser",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"reverb",e);return 0}).command("distort",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let n=0;n<3;++n)Lf(ne.elementfocus,n,"vibrato",e);return 0});for(let t=0;t<8;++t)RW.command(`synth${t+1}`,(e,n)=>(ufe(ne.elementfocus,t,n),0));for(let t=0;t<3;++t){const e=t+1;RW.command(`echo${e}`,(n,r)=>(Lf(ne.elementfocus,t,"echo",r),0)).command(`fcrush${e}`,(n,r)=>(Lf(ne.elementfocus,t,"fcrush",r),0)).command(`phaser${e}`,(n,r)=>(Lf(ne.elementfocus,t,"phaser",r),0)).command(`reverb${e}`,(n,r)=>(Lf(ne.elementfocus,t,"reverb",r),0)).command(`distort${e}`,(n,r)=>(Lf(ne.elementfocus,t,"distort",r),0)).command(`vibrato${e}`,(n,r)=>(Lf(ne.elementfocus,t,"vibrato",r),0))}function mee(t,e,n){if(!oC(ne.element))return 0;const[r,i]=Ot(e,0,[st.DIR,st.MAYBE_KIND]),s=i??["bullet"],a=cHe(ne.book,ne.board,s,{x:ne.element.x,y:ne.element.y});if(ae(a)){ae(n)&&(a.arg=n),a.party=ne.elementid,a.collision=bs.ISBULLET,a.destructible=1,a.stepx=r.x-ne.element.x,a.stepy=r.y-ne.element.y,a.bg=Qt.ONCLEAR;const o=Rb(ne.book,a),c=a.code??(o==null?void 0:o.code)??"";YGe(ne.book,ne.board,a,c,1)}return t.yield(),0}function oD(t,e,n,r){var h,d;if(!oC(ne.element)||!ae(ne.book)||!ae(ne.board)||!ae(ne.element))return 0;dl(ne.book,ne.board);const[i,s]=Ot(e,0,[st.DIR,st.KIND]),a=jh(ne.board,i);if((a==null?void 0:a.category)===dT.ISOBJECT&&(a!=null&&a.pushable)){const f={x:((h=ne.element)==null?void 0:h.x)??0,y:((d=ne.element)==null?void 0:d.y)??0},p=rc(i,Tv(f,i));CW(ne.book,ne.board,a,p)}const[o]=s,c=FN(ne.book,o)??EB(ne.book,o),l=(c==null?void 0:c.collision)??bs.ISWALK;if(!wW(ne.book,ne.board,l,i)){const f=ET(ne.book,ne.board,s,i,n);ae(f)&&ae(r)&&(f.arg=r)}return 0}const mHe=s0().command("board",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const[n,r]=Ot(e,0,[st.NAME]),[i,s]=Ot(e,r,[st.MAYBE_NUMBER,st.MAYBE_NUMBER]),a=Yf(ne.book,Wn.BOARD,n);if(a.length){const o=Ya(...a);ae(o)&&X1(ne.book,ne.elementfocus,o.id,{x:i??Math.round(fr*.5),y:s??Math.round(ji*.5)})}return 0}).command("edge",(t,e)=>{var s,a;if(!ae(ne.book)||!ae(ne.board)||!ae(ne.element))return 0;const[n,r]=Ot(e,0,[st.DIR,st.NAME]),i=Yf(ne.book,Wn.BOARD,r);if(i.length){const o={x:((s=ne.element)==null?void 0:s.x)??0,y:((a=ne.element)==null?void 0:a.y)??0},c=Tv(o,n),l=Ya(...i);switch(c){case rn.NORTH:ne.board.exitnorth=l.id;break;case rn.SOUTH:ne.board.exitsouth=l.id;break;case rn.WEST:ne.board.exitwest=l.id;break;case rn.EAST:ne.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;dl(ne.book,ne.board);const[n,r]=Ot(e,0,[st.DIR,st.DIR]),i=jh(ne.board,n);return Hd(i)&&Tw(ne.book,ne.board,i,r),0}).command("duplicate",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;dl(ne.book,ne.board);const[n,r]=Ot(e,0,[st.DIR,st.DIR]),i=jh(ne.board,n);return Hd(i),0}).command("write",(t,e)=>{var l;if(!ae(ne.book)||!ae(ne.board))return 0;dl(ne.book,ne.board);const[n,r,i]=Ot(e,0,[st.DIR,st.COLOR,st.STRING]),{color:s,bg:a}=Hpe(r),o=((l=XN(i,256,1))==null?void 0:l.measuredwidth)??1,c=eE(256,1,s??Qt.WHITE,a??Qt.BLACK);ir(i,c,!1);for(let u=0;u<o;++u)jd(ne.board,{x:n.x+u,y:n.y,name:"text",char:c.char[u],color:c.color[u],bg:c.bg[u]});return 0}).command("change",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;dl(ne.book,ne.board);const[n,r]=Ot(e,0,[st.KIND,st.KIND]);(EV(n)??"")==="empty"&&W8e(ne.board).forEach(c=>{ET(ne.book,ne.board,r,c)});const s=EV(r),a=Ode(r),o=Nde(r);return $de(ne.board,n).forEach(c=>{if(JC(c)===s)ae(a)&&(c.color=a),ae(o)&&(c.bg=o);else if(Ig(ne.book,ne.board,c,ne.timestamp),s!=="empty"){const l={x:c.x??0,y:c.y??0};ET(ne.book,ne.board,r,l)}}),0}).command("put",(t,e)=>oD(t,e)).command("putwith",(t,e)=>{const[n,r]=Ot(e,0,[st.ANY]);return oD(t,e.slice(r),void 0,n)}).command("oneof",(t,e)=>{const[n,r]=Ot(e,0,[st.ANY]);return ae(ne.board)&&ay(ne.board,n)?0:oD(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=Ot(e,0,[st.ANY,st.ANY]);return ae(ne.board)&&ay(ne.board,r)?0:oD(t,e.slice(i),r,n)}).command("shoot",mee).command("shootwith",(t,e)=>{const[n,r]=Ot(e,0,[st.ANY]);return mee(t,e.slice(r),n)}),im=()=>new Map,RV=t=>{const e=im();return t.forEach((n,r)=>{e.set(r,n)}),e},Qb=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},gHe=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},vHe=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},uC=()=>new Set,aH=t=>t[t.length-1],yHe=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},ST=Array.from,_He=(t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1},AV=Array.isArray;class hfe{constructor(){this._observers=im()}on(e,n){return Qb(this._observers,e,uC).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return ST((this._observers.get(e)||im()).values()).forEach(r=>r(...n))}destroy(){this._observers=im()}}const Ab=Math.floor,dP=Math.abs,dfe=(t,e)=>t<e?t:e,XT=(t,e)=>t>e?t:e,ffe=t=>t!==0?t<0:1/t<0,gee=1,vee=2,oH=4,cH=8,aO=32,$v=64,Xd=128,TB=31,MV=63,JS=127,bHe=2147483647,pfe=Number.MAX_SAFE_INTEGER,EHe=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Ab(t)===t),SHe=t=>t.toLowerCase(),THe=/^\s*/g,xHe=t=>t.replace(THe,""),wHe=/([A-Z])/g,yee=(t,e)=>xHe(t.replace(wHe,n=>`${e}${SHe(n)}`)),CHe=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},oO=typeof TextEncoder<"u"?new TextEncoder:null,RHe=t=>oO.encode(t),AHe=oO?RHe:CHe;let rM=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});rM&&rM.decode(new Uint8Array).length===1&&(rM=null);class zN{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const xB=()=>new zN,MHe=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Eg=t=>{const e=new Uint8Array(MHe(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},OHe=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(XT(n,e)*2),t.cpos=0)},rl=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},OV=rl,Xi=(t,e)=>{for(;e>JS;)rl(t,Xd|JS&e),e=Ab(e/128);rl(t,JS&e)},AW=(t,e)=>{const n=ffe(e);for(n&&(e=-e),rl(t,(e>MV?Xd:0)|(n?$v:0)|MV&e),e=Ab(e/64);e>0;)rl(t,(e>JS?Xd:0)|JS&e),e=Ab(e/128)},NV=new Uint8Array(3e4),NHe=NV.length/3,IHe=(t,e)=>{if(e.length<NHe){const n=oO.encodeInto(e,NV).written||0;Xi(t,n);for(let r=0;r<n;r++)rl(t,NV[r])}else Md(t,AHe(e))},kHe=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Xi(t,r);for(let i=0;i<r;i++)rl(t,n.codePointAt(i))},yw=oO&&oO.encodeInto?IHe:kHe,wB=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=dfe(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(XT(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Md=(t,e)=>{Xi(t,e.byteLength),wB(t,e)},MW=(t,e)=>{OHe(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},DHe=(t,e)=>MW(t,4).setFloat32(0,e,!1),PHe=(t,e)=>MW(t,8).setFloat64(0,e,!1),LHe=(t,e)=>MW(t,8).setBigInt64(0,e,!1),_ee=new DataView(new ArrayBuffer(4)),UHe=t=>(_ee.setFloat32(0,t),_ee.getFloat32(0)===t),cO=(t,e)=>{switch(typeof e){case"string":rl(t,119),yw(t,e);break;case"number":EHe(e)&&dP(e)<=bHe?(rl(t,125),AW(t,e)):UHe(e)?(rl(t,124),DHe(t,e)):(rl(t,123),PHe(t,e));break;case"bigint":rl(t,122),LHe(t,e);break;case"object":if(e===null)rl(t,126);else if(AV(e)){rl(t,117),Xi(t,e.length);for(let n=0;n<e.length;n++)cO(t,e[n])}else if(e instanceof Uint8Array)rl(t,116),Md(t,e);else{rl(t,118);const n=Object.keys(e);Xi(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];yw(t,i),cO(t,e[i])}}break;case"boolean":rl(t,e?120:121);break;default:rl(t,127)}};class bee extends zN{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Xi(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Eee=t=>{t.count>0&&(AW(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Xi(t.encoder,t.count-2))};class fP{constructor(){this.encoder=new zN,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Eee(this),this.count=1,this.s=e)}toUint8Array(){return Eee(this),Eg(this.encoder)}}const See=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);AW(t.encoder,e),t.count>1&&Xi(t.encoder,t.count-2)}};class lH{constructor(){this.encoder=new zN,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(See(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return See(this),Eg(this.encoder)}}class BHe{constructor(){this.sarr=[],this.s="",this.lensE=new fP}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new zN;return this.sarr.push(this.s),this.s="",yw(e,this.sarr.join("")),wB(e,this.lensE.toUint8Array()),Eg(e)}}const Mb=t=>new Error(t),kg=()=>{throw Mb("Method unimplemented")},Hg=()=>{throw Mb("Unexpected case")},mfe=Mb("Unexpected end of array"),gfe=Mb("Integer out of Range");class CB{constructor(e){this.arr=e,this.pos=0}}const ZC=t=>new CB(t),FHe=t=>t.pos!==t.arr.length,zHe=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Od=t=>zHe(t,Si(t)),hC=t=>t.arr[t.pos++],Si=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&JS)*n,n*=128,i<Xd)return e;if(e>pfe)throw gfe}throw mfe},OW=t=>{let e=t.arr[t.pos++],n=e&MV,r=64;const i=(e&$v)>0?-1:1;if(!(e&Xd))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&JS)*r,r*=128,e<Xd)return i*n;if(n>pfe)throw gfe}throw mfe},HHe=t=>{let e=Si(t);if(e===0)return"";{let n=String.fromCodePoint(hC(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(hC(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},jHe=t=>rM.decode(Od(t)),_w=rM?jHe:HHe,NW=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},VHe=t=>NW(t,4).getFloat32(0,!1),GHe=t=>NW(t,8).getFloat64(0,!1),qHe=t=>NW(t,8).getBigInt64(0,!1),$He=[t=>{},t=>null,OW,VHe,GHe,qHe,t=>!1,t=>!0,_w,t=>{const e=Si(t),n={};for(let r=0;r<e;r++){const i=_w(t);n[i]=lO(t)}return n},t=>{const e=Si(t),n=[];for(let r=0;r<e;r++)n.push(lO(t));return n},Od],lO=t=>$He[127-hC(t)](t);class Tee extends CB{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),FHe(this)?this.count=Si(this)+1:this.count=-1),this.count--,this.s}}class pP extends CB{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=OW(this);const e=ffe(this.s);this.count=1,e&&(this.s=-this.s,this.count=Si(this)+2)}return this.count--,this.s}}class uH extends CB{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=OW(this),n=e&1;this.diff=Ab(e/2),this.count=1,n&&(this.count=Si(this)+2)}return this.s+=this.diff,this.count--,this.s}}class WHe{constructor(e){this.decoder=new pP(e),this.str=_w(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const YHe=crypto.getRandomValues.bind(crypto),vfe=()=>YHe(new Uint32Array(1))[0],XHe="10000000-1000-4000-8000"+-1e11,KHe=()=>XHe.replace(/[018]/g,t=>(t^vfe()&15>>t/4).toString(16)),JHe=Date.now,xee=t=>new Promise(t);Promise.all.bind(Promise);const wee=t=>t===void 0?null:t;class ZHe{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let yfe=new ZHe,QHe=!0;try{typeof localStorage<"u"&&localStorage&&(yfe=localStorage,QHe=!1)}catch{}const eje=yfe,tje=Object.assign,nje=Object.keys,rje=(t,e)=>{for(const n in t)e(t[n],n)},Cee=t=>nje(t).length,ije=t=>{for(const e in t)return!1;return!0},sje=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},aje=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),oje=(t,e)=>t===e||Cee(t)===Cee(e)&&sje(t,(n,r)=>(n!==void 0||aje(e,r))&&e[r]===n),cje=Object.freeze,_fe=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&_fe(t[e])}return cje(t)},IW=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&IW(t,e,n+1)}},lje=t=>t,uje=(t,e)=>e.includes(t);var bfe={};const uO=typeof zn<"u"&&zn.release&&/node|io\.js/.test(zn.release.name)&&Object.prototype.toString.call(typeof zn<"u"?zn:0)==="[object process]";let Qm;const hje=()=>{if(Qm===void 0)if(uO){Qm=im();const t=zn.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Qm.set(e,""),e=r):e!==null&&(Qm.set(e,r),e=null)}e!==null&&Qm.set(e,"")}else typeof location=="object"?(Qm=im(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Qm.set(`--${yee(e,"-")}`,n),Qm.set(`-${yee(e,"-")}`,n)}})):Qm=im();return Qm},IV=t=>hje().has(t),q2=t=>wee(uO?bfe[t.toUpperCase().replaceAll("-","_")]:eje.getItem(t)),Efe=t=>IV("--"+t)||q2(t)!==null;Efe("production");const dje=uO&&uje(bfe.FORCE_COLOR,["true","1","2"]),fje=dje||!IV("--no-colors")&&!Efe("no-color")&&(!uO||zn.stdout.isTTY)&&(!uO||IV("--color")||q2("COLORTERM")!==null||(q2("TERM")||"").includes("color")),pje=t=>new Uint8Array(t),mje=t=>{const e=pje(t.byteLength);return e.set(t),e};class gje{constructor(e,n){this.left=e,this.right=n}}const mv=(t,e)=>new gje(t,e);typeof DOMParser<"u"&&new DOMParser;const vje=t=>gHe(t,(e,n)=>`${n}:${e};`).join(""),yy=Symbol,Sfe=yy(),Tfe=yy(),yje=yy(),_je=yy(),bje=yy(),xfe=yy(),Eje=yy(),kW=yy(),Sje=yy(),Tje=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},xje={[Sfe]:mv("font-weight","bold"),[Tfe]:mv("font-weight","normal"),[yje]:mv("color","blue"),[bje]:mv("color","green"),[_je]:mv("color","grey"),[xfe]:mv("color","red"),[Eje]:mv("color","purple"),[kW]:mv("color","orange"),[Sje]:mv("color","black")},wje=t=>{var a;t.length===1&&((a=t[0])==null?void 0:a.constructor)===Function&&(t=t[0]());const e=[],n=[],r=im();let i=[],s=0;for(;s<t.length;s++){const o=t[s],c=xje[o];if(c!==void 0)r.set(c.left,c.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const l=vje(r);s>0||l.length>0?(e.push("%c"+o),n.push(l)):e.push(o)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const o=t[s];o instanceof Symbol||i.push(o)}return i},wfe=fje?wje:Tje,Cje=(...t)=>{console.log(...wfe(t)),Rfe.forEach(e=>e.print(t))},Cfe=(...t)=>{console.warn(...wfe(t)),t.unshift(kW),Rfe.forEach(e=>e.print(t))},Rfe=uC(),Afe=t=>({[Symbol.iterator](){return this},next:t}),Rje=(t,e)=>Afe(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),hH=(t,e)=>Afe(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class DW{constructor(e,n){this.clock=e,this.len=n}}class QC{constructor(){this.clients=new Map}}const dC=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let a=0;a<r.length;a++){const o=r[a];Ufe(t,s,o.clock,o.len,n)}}),Aje=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Ab((n+r)/2),s=t[i],a=s.clock;if(a<=e){if(e<a+s.len)return i;n=i+1}else r=i-1}return null},HN=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Aje(n,e.clock)!==null},PW=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=XT(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},kV=t=>{const e=new QC;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let a=n+1;a<t.length;a++)yHe(s,t[a].clients.get(i)||[]);e.clients.set(i,s)}});return PW(e),e},hO=(t,e,n,r)=>{Qb(t.clients,e,()=>[]).push(new DW(n,r))},Mje=()=>new QC,Oje=t=>{const e=Mje();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const a=n[s];if(a.deleted){const o=a.id.clock;let c=a.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new DW(o,c))}}i.length>0&&e.clients.set(r,i)}),e},eR=(t,e)=>{Xi(t.restEncoder,e.clients.size),ST(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Xi(t.restEncoder,n);const i=r.length;Xi(t.restEncoder,i);for(let s=0;s<i;s++){const a=r[s];t.writeDsClock(a.clock),t.writeDsLen(a.len)}})},LW=t=>{const e=new QC,n=Si(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Si(t.restDecoder),s=Si(t.restDecoder);if(s>0){const a=Qb(e.clients,i,()=>[]);for(let o=0;o<s;o++)a.push(new DW(t.readDsClock(),t.readDsLen()))}}return e},Ree=(t,e,n)=>{const r=new QC,i=Si(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const a=Si(t.restDecoder),o=Si(t.restDecoder),c=n.clients.get(a)||[],l=Lc(n,a);for(let u=0;u<o;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&hO(r,a,l,d-l);let f=jg(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Q2(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Q2(e,p,d-p.id.clock)),p.delete(e))}else hO(r,a,h,d-h)}}if(r.clients.size>0){const s=new TT;return Xi(s.restEncoder,0),eR(s,r),s.toUint8Array()}return null},Mfe=vfe;class KT extends hfe{constructor({guid:e=KHe(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:a=!1,shouldLoad:o=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Mfe(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new Pfe,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=a,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=xee(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>xee(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&$s(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ST(this.subdocs).map(e=>e.guid))}transact(e,n=null){return $s(this,e,n)}get(e,n=pl){const r=Qb(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==pl&&i!==n)if(i===pl){const s=new n;s._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=s}),s._start=r._start;for(let a=s._start;a!==null;a=a.right)a.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Ew)}getText(e=""){return this.get(e,Vg)}getMap(e=""){return this.get(e,pC)}getXmlElement(e=""){return this.get(e,mC)}getXmlFragment(e=""){return this.get(e,xT)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,ST(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new KT({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,$s(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ofe{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Si(this.restDecoder)}readDsLen(){return Si(this.restDecoder)}}class Nfe extends Ofe{readLeftID(){return Ti(Si(this.restDecoder),Si(this.restDecoder))}readRightID(){return Ti(Si(this.restDecoder),Si(this.restDecoder))}readClient(){return Si(this.restDecoder)}readInfo(){return hC(this.restDecoder)}readString(){return _w(this.restDecoder)}readParentInfo(){return Si(this.restDecoder)===1}readTypeRef(){return Si(this.restDecoder)}readLen(){return Si(this.restDecoder)}readAny(){return lO(this.restDecoder)}readBuf(){return mje(Od(this.restDecoder))}readJSON(){return JSON.parse(_w(this.restDecoder))}readKey(){return _w(this.restDecoder)}}class Nje{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Si(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Si(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class fC extends Nje{constructor(e){super(e),this.keys=[],Si(e),this.keyClockDecoder=new uH(Od(e)),this.clientDecoder=new pP(Od(e)),this.leftClockDecoder=new uH(Od(e)),this.rightClockDecoder=new uH(Od(e)),this.infoDecoder=new Tee(Od(e),hC),this.stringDecoder=new WHe(Od(e)),this.parentInfoDecoder=new Tee(Od(e),hC),this.typeRefDecoder=new pP(Od(e)),this.lenDecoder=new pP(Od(e))}readLeftID(){return new bw(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new bw(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return lO(this.restDecoder)}readBuf(){return Od(this.restDecoder)}readJSON(){return lO(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Ije{constructor(){this.restEncoder=xB()}toUint8Array(){return Eg(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Xi(this.restEncoder,e)}writeDsLen(e){Xi(this.restEncoder,e)}}class jN extends Ije{writeLeftID(e){Xi(this.restEncoder,e.client),Xi(this.restEncoder,e.clock)}writeRightID(e){Xi(this.restEncoder,e.client),Xi(this.restEncoder,e.clock)}writeClient(e){Xi(this.restEncoder,e)}writeInfo(e){OV(this.restEncoder,e)}writeString(e){yw(this.restEncoder,e)}writeParentInfo(e){Xi(this.restEncoder,e?1:0)}writeTypeRef(e){Xi(this.restEncoder,e)}writeLen(e){Xi(this.restEncoder,e)}writeAny(e){cO(this.restEncoder,e)}writeBuf(e){Md(this.restEncoder,e)}writeJSON(e){yw(this.restEncoder,JSON.stringify(e))}writeKey(e){yw(this.restEncoder,e)}}class kje{constructor(){this.restEncoder=xB(),this.dsCurrVal=0}toUint8Array(){return Eg(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Xi(this.restEncoder,n)}writeDsLen(e){e===0&&Hg(),Xi(this.restEncoder,e-1),this.dsCurrVal+=e}}class TT extends kje{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new lH,this.clientEncoder=new fP,this.leftClockEncoder=new lH,this.rightClockEncoder=new lH,this.infoEncoder=new bee(OV),this.stringEncoder=new BHe,this.parentInfoEncoder=new bee(OV),this.typeRefEncoder=new fP,this.lenEncoder=new fP}toUint8Array(){const e=xB();return Xi(e,0),Md(e,this.keyClockEncoder.toUint8Array()),Md(e,this.clientEncoder.toUint8Array()),Md(e,this.leftClockEncoder.toUint8Array()),Md(e,this.rightClockEncoder.toUint8Array()),Md(e,Eg(this.infoEncoder)),Md(e,this.stringEncoder.toUint8Array()),Md(e,Eg(this.parentInfoEncoder)),Md(e,this.typeRefEncoder.toUint8Array()),Md(e,this.lenEncoder.toUint8Array()),wB(e,Eg(this.restEncoder)),Eg(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){cO(this.restEncoder,e)}writeBuf(e){Md(this.restEncoder,e)}writeJSON(e){cO(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Dje=(t,e,n,r)=>{r=XT(r,e[0].id.clock);const i=jg(e,r);Xi(t.restEncoder,e.length-i),t.writeClient(n),Xi(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let a=i+1;a<e.length;a++)e[a].write(t,0)},UW=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{Lc(e,s)>i&&r.set(s,i)}),BW(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Xi(t.restEncoder,r.size),ST(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Dje(t,e.clients.get(i),i,s)})},Pje=(t,e)=>{const n=im(),r=Si(t.restDecoder);for(let i=0;i<r;i++){const s=Si(t.restDecoder),a=new Array(s),o=t.readClient();let c=Si(t.restDecoder);n.set(o,{i:0,refs:a});for(let l=0;l<s;l++){const u=t.readInfo();switch(TB&u){case 0:{const h=t.readLen();a[l]=new Vf(Ti(o,c),h),c+=h;break}case 10:{const h=Si(t.restDecoder);a[l]=new Gf(Ti(o,c),h),c+=h;break}default:{const h=(u&($v|Xd))===0,d=new ba(Ti(o,c),null,(u&Xd)===Xd?t.readLeftID():null,null,(u&$v)===$v?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&aO)===aO?t.readString():null,rpe(t,u));a[l]=d,c+=d.length}}}}return n},Lje=(t,e,n)=>{const r=[];let i=ST(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let a=s();if(a===null)return null;const o=new Pfe,c=new Map,l=(f,p)=>{const g=c.get(f);(g==null||g>p)&&c.set(f,p)};let u=a.refs[a.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,g=n.get(p);g?(g.i--,o.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):o.clients.set(p,[f]),i=i.filter(_=>_!==p)}r.length=0};for(;;){if(u.constructor!==Gf){const p=Qb(h,u.id.client,()=>Lc(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const g=u.getMissing(t,e);if(g!==null){r.push(u);const _=n.get(g)||{refs:[],i:0};if(_.refs.length===_.i)l(g,Lc(e,g)),d();else{u=_.refs[_.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=s(),a===null)break;u=a.refs[a.i++]}}if(o.clients.size>0){const f=new TT;return UW(f,o,new Map),Xi(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Uje=(t,e)=>UW(t,e.doc.store,e.beforeState),Bje=(t,e,n,r=new fC(t))=>$s(e,i=>{i.local=!1;let s=!1;const a=i.doc,o=a.store,c=Pje(r,a),l=Lje(i,o,c),u=o.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<Lc(o,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=W2([u.update,l.update])}}else o.pendingStructs=l;const h=Ree(r,i,o);if(o.pendingDs){const d=new fC(ZC(o.pendingDs));Si(d.restDecoder);const f=Ree(d,i,o);h&&f?o.pendingDs=W2([h,f]):o.pendingDs=h||f}else o.pendingDs=h;if(s){const d=o.pendingStructs.update;o.pendingStructs=null,Ife(i.doc,d)}},n,!1),Ife=(t,e,n,r=fC)=>{const i=ZC(e);Bje(i,t,n,new r(i))},Aee=(t,e,n)=>Ife(t,e,n,Nfe),Fje=(t,e,n=new Map)=>{UW(t,e.store,n),eR(t,Oje(e.store))},zje=(t,e=new Uint8Array([0]),n=new TT)=>{const r=kfe(e);Fje(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(t5e(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===jN)return Qje(i.map((s,a)=>a===0?s:r5e(s)));if(n.constructor===TT)return W2(i)}return i[0]},Hje=(t,e)=>zje(t,e,new jN),jje=t=>{const e=new Map,n=Si(t.restDecoder);for(let r=0;r<n;r++){const i=Si(t.restDecoder),s=Si(t.restDecoder);e.set(i,s)}return e},kfe=t=>jje(new Ofe(ZC(t)));class Vje{constructor(){this.l=[]}}const Mee=()=>new Vje,Oee=(t,e)=>t.l.push(e),Nee=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Dfe=(t,e,n)=>IW(t.l,[e,n]);class bw{constructor(e,n){this.client=e,this.clock=n}}const cD=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ti=(t,e)=>new bw(t,e),Gje=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Hg()},$2=(t,e)=>{for(;e!==null;){if(e.parent===t)return!0;e=e.parent._item}return!1},x1=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!HN(e.ds,t.id),DV=(t,e)=>{const n=Qb(t.meta,DV,uC),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<Lc(r,s)&&Uh(t,Ti(s,i))}),dC(t,e.ds,i=>{}),n.add(e))};class Pfe{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const BW=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},Lc=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Lfe=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Hg()}n.push(e)},jg=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let a=Ab(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[a],s=i.id.clock,s<=e){if(e<s+i.length)return a;n=a+1}else r=a-1;a=Ab((n+r)/2)}throw Hg()},qje=(t,e)=>{const n=t.clients.get(e.client);return n[jg(n,e.clock)]},mP=qje,PV=(t,e,n)=>{const r=jg(e,n),i=e[r];return i.id.clock<n&&i instanceof ba?(e.splice(r+1,0,Q2(t,i,n-i.id.clock)),r+1):r},Uh=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[PV(t,n,e.clock)]},Iee=(t,e,n)=>{const r=e.clients.get(n.client),i=jg(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Vf&&r.splice(i+1,0,Q2(t,s,n.clock-s.id.clock+1)),s},$je=(t,e,n)=>{const r=t.clients.get(e.id.client);r[jg(r,e.id.clock)]=n},Ufe=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let a=PV(t,e,n),o;do o=e[a++],s<o.id.clock+o.length&&PV(t,e,s),i(o);while(a<e.length&&e[a].id.clock<s)};class Wje{constructor(e,n,r){this.doc=e,this.deleteSet=new QC,this.beforeState=BW(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const kee=(t,e)=>e.deleteSet.clients.size===0&&!vHe(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(PW(e.deleteSet),Uje(t,e),eR(t,e.deleteSet),!0),Dee=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Qb(t.changed,e,uC).add(n)},gP=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ba&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},Yje=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let a=i.length-1;a>=0;a--){const o=i[a],c=o.clock+o.len;for(let l=jg(s,o.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(o.clock+o.len<=h.id.clock)break;h instanceof ba&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},Xje=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const a=n[s],o=dfe(i.length-1,1+jg(i,a.clock+a.len-1));for(let c=o,l=i[c];c>0&&l.id.clock>=a.clock;l=i[c])c-=1+gP(i,c)}})},Bfe=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,a=n._mergeStructs;try{PW(s),n.afterState=BW(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const o=[];n.changed.forEach((c,l)=>o.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),o.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),Dfe(l._dEH,c,n))})}),o.push(()=>r.emit("afterTransaction",[n,r])),IW(o,[]),n._needFormattingCleanup&&v5e(n)}finally{r.gc&&Yje(s,i,r.gcFilter),Xje(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=XT(jg(f,d),1);for(let g=f.length-1;g>=p;)g-=1+gP(f,g)}});for(let u=a.length-1;u>=0;u--){const{client:h,clock:d}=a[u].id,f=i.clients.get(h),p=jg(f,d);p+1<f.length&&gP(f,p+1)>1||p>0&&gP(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Cje(kW,Sfe,"[yjs] ",Tfe,xfe,"Changed the client-id because another client seems to be using it."),r.clientID=Mfe()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new jN;kee(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new TT;kee(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:o,subdocsLoaded:c,subdocsRemoved:l}=n;(o.size>0||l.size>0||c.size>0)&&(o.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:o,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Bfe(t,e+1)}}},$s=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,a=null;t._transaction===null&&(s=!0,t._transaction=new Wje(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{a=e(t._transaction)}finally{if(s){const o=t._transaction===i[0];t._transaction=null,o&&Bfe(i,0)}}return a};class Kje{constructor(e,n){this.insertions=n,this.deletions=e,this.meta=new Map}}const Pee=(t,e,n)=>{dC(t,n.deletions,r=>{r instanceof ba&&e.scope.some(i=>i===t.doc||$2(i,r))&&$W(r,!1)})},Lee=(t,e,n)=>{let r=null;const i=t.doc,s=t.scope;$s(i,o=>{for(;e.length>0&&t.currStackItem===null;){const c=i.store,l=e.pop(),u=new Set,h=[];let d=!1;dC(o,l.insertions,f=>{if(f instanceof ba){if(f.redone!==null){let{item:p,diff:g}=G5e(c,f.id);g>0&&(p=Uh(o,Ti(p.id.client,p.id.clock+g))),f=p}!f.deleted&&s.some(p=>p===o.doc||$2(p,f))&&h.push(f)}}),dC(o,l.deletions,f=>{f instanceof ba&&s.some(p=>p===o.doc||$2(p,f))&&!HN(l.insertions,f.id)&&u.add(f)}),u.forEach(f=>{d=npe(o,f,u,l.insertions,t.ignoreRemoteMapChanges,t)!==null||d});for(let f=h.length-1;f>=0;f--){const p=h[f];t.deleteFilter(p)&&(p.delete(o),d=!0)}t.currStackItem=d?l:null}o.changed.forEach((c,l)=>{c.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=o},t);const a=t.currStackItem;if(a!=null){const o=r.changedParentTypes;t.emit("stack-item-popped",[{stackItem:a,type:n,changedParentTypes:o,origin:t},t]),t.currStackItem=null}return a};class Jje extends hfe{constructor(e,{captureTimeout:n=500,captureTransaction:r=c=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:a=!1,doc:o=AV(e)?e[0].doc:e instanceof KT?e:e.doc}={}){super(),this.scope=[],this.doc=o,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=a,this.captureTimeout=n,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(_=>c.changedParentTypes.has(_)||_===this.doc)||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;const l=this.undoing,u=this.redoing,h=l?this.redoStack:this.undoStack;l?this.stopCapturing():u||this.clear(!1,!0);const d=new QC;c.afterState.forEach((_,v)=>{const E=c.beforeState.get(v)||0,T=_-E;T>0&&hO(d,v,E,T)});const f=JHe();let p=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&h.length>0&&!l&&!u){const _=h[h.length-1];_.deletions=kV([_.deletions,c.deleteSet]),_.insertions=kV([_.insertions,d])}else h.push(new Kje(c.deleteSet,d)),p=!0;!l&&!u&&(this.lastChange=f),dC(c,c.deleteSet,_=>{_ instanceof ba&&this.scope.some(v=>v===c.doc||$2(v,_))&&$W(_,!0)});const g=[{stackItem:h[h.length-1],origin:c.origin,type:l?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",g):this.emit("stack-item-updated",g)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){const n=new Set(this.scope);e=AV(e)?e:[e],e.forEach(r=>{n.has(r)||(n.add(r),(r instanceof pl?r.doc!==this.doc:r!==this.doc)&&Cfe("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,n=!0){(e&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>Pee(r,this,i)),this.undoStack=[]),n&&(this.redoStack.forEach(i=>Pee(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=Lee(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=Lee(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Zje(t){const e=Si(t.restDecoder);for(let n=0;n<e;n++){const r=Si(t.restDecoder),i=t.readClient();let s=Si(t.restDecoder);for(let a=0;a<r;a++){const o=t.readInfo();if(o===10){const c=Si(t.restDecoder);yield new Gf(Ti(i,s),c),s+=c}else if(TB&o){const c=(o&($v|Xd))===0,l=new ba(Ti(i,s),null,(o&Xd)===Xd?t.readLeftID():null,null,(o&$v)===$v?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(o&aO)===aO?t.readString():null,rpe(t,o));yield l,s+=l.length}else{const c=t.readLen();yield new Vf(Ti(i,s),c),s+=c}}}}class FW{constructor(e,n){this.gen=Zje(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Gf);return this.curr}}class zW{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Qje=t=>W2(t,Nfe,jN),e5e=(t,e)=>{if(t.constructor===Vf){const{client:n,clock:r}=t.id;return new Vf(Ti(n,r+e),t.length-e)}else if(t.constructor===Gf){const{client:n,clock:r}=t.id;return new Gf(Ti(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ba(Ti(r,i+e),null,Ti(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},W2=(t,e=fC,n=TT)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(ZC(u)));let i=r.map(u=>new FW(u,!0)),s=null;const a=new n,o=new zW(a);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===Gf?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)G_(o,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Gf)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{G_(o,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Gf(Ti(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Gf?s.struct.length-=p:d=e5e(d,p)),s.struct.mergeWith(d)||(G_(o,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Gf;d=u.next())G_(o,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(G_(o,s.struct,s.offset),s=null),HW(o);const c=r.map(u=>LW(u)),l=kV(c);return eR(a,l),a.toUint8Array()},t5e=(t,e,n=fC,r=TT)=>{const i=kfe(e),s=new r,a=new zW(s),o=new n(ZC(t)),c=new FW(o,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===Gf){c.next();continue}if(u.id.clock+u.length>d)for(G_(a,u,XT(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)G_(a,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}HW(a);const l=LW(o);return eR(s,l),s.toUint8Array()},Ffe=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Eg(t.encoder.restEncoder)}),t.encoder.restEncoder=xB(),t.written=0)},G_=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Ffe(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Xi(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},HW=t=>{Ffe(t);const e=t.encoder.restEncoder;Xi(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Xi(e,r.written),wB(e,r.restEncoder)}},n5e=(t,e,n,r)=>{const i=new n(ZC(t)),s=new FW(i,!1),a=new r,o=new zW(a);for(let l=s.curr;l!==null;l=s.next())G_(o,e(l),0);HW(o);const c=LW(i);return eR(a,c),a.toUint8Array()},r5e=t=>n5e(t,lje,fC,jN),Uee="You must not compute changes after the event-handler fired.";class RB{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=i5e(this.currentTarget,this.target))}deletes(e){return HN(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Mb(Uee);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let a,o;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))a="delete",o=aH(c.content.getContent());else return;else c!==null&&this.deletes(c)?(a="update",o=aH(c.content.getContent())):(a="add",o=void 0)}else if(this.deletes(s))a="delete",o=aH(s.content.getContent());else return;e.set(i,{action:a,oldValue:o})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Mb(Uee);const n=this.target,r=uC(),i=uC(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let o=null;const c=()=>{o&&s.push(o)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((o===null||o.delete===void 0)&&(c(),o={delete:0}),o.delete+=l.length,i.add(l)):this.adds(l)?((o===null||o.insert===void 0)&&(c(),o={insert:[]}),o.insert=o.insert.concat(l.content.getContent()),r.add(l)):((o===null||o.retain===void 0)&&(c(),o={retain:0}),o.retain+=l.length);o!==null&&o.retain===void 0&&c()}this._changes=e}return e}}const i5e=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},lu=()=>{Cfe("Invalid access: Add Yjs type to a document before reading data.")},zfe=80;let jW=0;class s5e{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=jW++}}const a5e=t=>{t.timestamp=jW++},Hfe=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=jW++},o5e=(t,e,n)=>{if(t.length>=zfe){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Hfe(r,e,n),r}else{const r=new s5e(e,n);return t.push(r),r}},AB=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,a)=>dP(e-s.index)<dP(e-a.index)?s:a);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,a5e(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&dP(n.index-i)<r.parent.length/zfe?(Hfe(n,r,i),n):o5e(t._searchMarker,r,i)},dO=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=XT(e,i.index+n))}},MB=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Qb(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;Dfe(r._eH,n,e)};class pl{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Mee(),this._dEH=Mee(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw kg()}clone(){throw kg()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Oee(this._eH,e)}observeDeep(e){Oee(this._dEH,e)}unobserve(e){Nee(this._eH,e)}unobserveDeep(e){Nee(this._dEH,e)}toJSON(){}}const jfe=(t,e,n)=>{t.doc??lu(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const a=s.content.getContent();if(a.length<=e)e-=a.length;else{for(let o=e;o<a.length&&r>0;o++)i.push(a[o]),r--;e=0}}s=s.right}return i},Vfe=t=>{t.doc??lu();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},fO=(t,e)=>{let n=0,r=t._start;for(t.doc??lu();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},Gfe=(t,e)=>{const n=[];return fO(t,(r,i)=>{n.push(e(r,i,t))}),n},c5e=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},qfe=(t,e)=>{t.doc??lu();const n=AB(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Y2=(t,e,n,r)=>{let i=n;const s=t.doc,a=s.clientID,o=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ba(Ti(a,Lc(o,a)),i,i&&i.lastId,c,c&&c.id,e,null,new wT(l)),i.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ba(Ti(a,Lc(o,a)),i,i&&i.lastId,c,c&&c.id,e,null,new VN(new Uint8Array(h))),i.integrate(t,0);break;case KT:i=new ba(Ti(a,Lc(o,a)),i,i&&i.lastId,c,c&&c.id,e,null,new GN(h)),i.integrate(t,0);break;default:if(h instanceof pl)i=new ba(Ti(a,Lc(o,a)),i,i&&i.lastId,c,c&&c.id,e,null,new _y(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},$fe=()=>Mb("Length exceeded!"),Wfe=(t,e,n,r)=>{if(n>e._length)throw $fe();if(n===0)return e._searchMarker&&dO(e._searchMarker,n,r.length),Y2(t,e,null,r);const i=n,s=AB(e,n);let a=e._start;for(s!==null&&(a=s.p,n-=s.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&Uh(t,Ti(a.id.client,a.id.clock+n));break}n-=a.length}return e._searchMarker&&dO(e._searchMarker,i,r.length),Y2(t,e,a,r)},l5e=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,a)=>a.index>s.index?a:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Y2(t,e,i,n)},Yfe=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,a=AB(e,n);let o=e._start;for(a!==null&&(o=a.p,n-=a.index);o!==null&&n>0;o=o.right)!o.deleted&&o.countable&&(n<o.length&&Uh(t,Ti(o.id.client,o.id.clock+n)),n-=o.length);for(;r>0&&o!==null;)o.deleted||(r<o.length&&Uh(t,Ti(o.id.client,o.id.clock+r)),o.delete(t),r-=o.length),o=o.right;if(r>0)throw $fe();e._searchMarker&&dO(e._searchMarker,i,-s+r)},X2=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},VW=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,a=s.clientID;let o;if(r==null)o=new wT([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:o=new wT([r]);break;case Uint8Array:o=new VN(r);break;case KT:o=new GN(r);break;default:if(r instanceof pl)o=new _y(r);else throw new Error("Unexpected content type")}new ba(Ti(a,Lc(s.store,a)),i,i&&i.lastId,null,null,e,n,o).integrate(t,0)},GW=(t,e)=>{t.doc??lu();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Xfe=t=>{const e={};return t.doc??lu(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Kfe=(t,e)=>{t.doc??lu();const n=t._map.get(e);return n!==void 0&&!n.deleted},u5e=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&x1(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},lD=t=>(t.doc??lu(),Rje(t._map.entries(),e=>!e[1].deleted));class h5e extends RB{}class Ew extends pl{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Ew;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ew}clone(){const e=new Ew;return e.insert(0,this.toArray().map(n=>n instanceof pl?n.clone():n)),e}get length(){return this.doc??lu(),this._length}_callObserver(e,n){super._callObserver(e,n),MB(this,e,new h5e(this,e))}insert(e,n){this.doc!==null?$s(this.doc,r=>{Wfe(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?$s(this.doc,n=>{l5e(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?$s(this.doc,r=>{Yfe(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return qfe(this,e)}toArray(){return Vfe(this)}slice(e=0,n=this.length){return jfe(this,e,n)}toJSON(){return this.map(e=>e instanceof pl?e.toJSON():e)}map(e){return Gfe(this,e)}forEach(e){fO(this,e)}[Symbol.iterator](){return c5e(this)}_write(e){e.writeTypeRef(L5e)}}const d5e=t=>new Ew;class f5e extends RB{constructor(e,n,r){super(e,n),this.keysChanged=r}}class pC extends pl{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new pC}clone(){const e=new pC;return this.forEach((n,r)=>{e.set(r,n instanceof pl?n.clone():n)}),e}_callObserver(e,n){MB(this,e,new f5e(this,e,n))}toJSON(){this.doc??lu();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof pl?i.toJSON():i}}),e}get size(){return[...lD(this)].length}keys(){return hH(lD(this),e=>e[0])}values(){return hH(lD(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return hH(lD(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??lu(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?$s(this.doc,n=>{X2(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?$s(this.doc,r=>{VW(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return GW(this,e)}has(e){return Kfe(this,e)}clear(){this.doc!==null?$s(this.doc,e=>{this.forEach(function(n,r,i){X2(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(U5e)}}const p5e=t=>new pC,J_=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&oje(t,e);class LV{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Hg(),this.right.content.constructor){case Vc:this.right.deleted||tR(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Bee=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Vc:e.right.deleted||tR(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Uh(t,Ti(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},uD=(t,e,n,r)=>{const i=new Map,s=r?AB(e,n):null;if(s){const a=new LV(s.p.left,s.p,s.index,i);return Bee(t,a,n-s.index)}else{const a=new LV(null,e._start,0,i);return Bee(t,a,n)}},Jfe=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Vc&&J_(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((a,o)=>{const c=n.left,l=n.right,u=new ba(Ti(s,Lc(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Vc(o,a));u.integrate(t,0),n.right=u,n.forward()})},tR=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Zfe=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Vc&&J_(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Qfe=(t,e,n,r)=>{const i=t.doc,s=i.clientID,a=new Map;for(const o in r){const c=r[o],l=n.currentAttributes.get(o)??null;if(!J_(l,c)){a.set(o,l);const{left:u,right:h}=n;n.right=new ba(Ti(s,Lc(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new Vc(o,c)),n.right.integrate(t,0),n.forward()}}return a},dH=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,a=s.clientID;Zfe(n,i);const o=Qfe(t,e,n,i),c=r.constructor===String?new Gg(r):r instanceof pl?new _y(r):new JT(r);let{left:l,right:u,index:h}=n;e._searchMarker&&dO(e._searchMarker,n.index,c.getLength()),u=new ba(Ti(a,Lc(s.store,a)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Jfe(t,e,n,o)},Fee=(t,e,n,r,i)=>{const s=t.doc,a=s.clientID;Zfe(n,i);const o=Qfe(t,e,n,i);e:for(;n.right!==null&&(r>0||o.size>0&&(n.right.deleted||n.right.content.constructor===Vc));){if(!n.right.deleted)switch(n.right.content.constructor){case Vc:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(J_(u,l))o.delete(c);else{if(r===0)break e;o.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Uh(t,Ti(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ba(Ti(a,Lc(s.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Gg(c)),n.right.integrate(t,0),n.forward()}Jfe(t,e,n,o)},epe=(t,e,n,r,i)=>{let s=e;const a=im();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Vc){const l=s.content;a.set(l.key,l)}s=s.right}let o=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Vc:{const{key:u,value:h}=l,d=r.get(u)??null;(a.get(u)!==l||d===h)&&(e.delete(t),o++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&tR(i,l);break}}}e=e.right}return o},m5e=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Vc){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},g5e=t=>{let e=0;return $s(t.doc,n=>{let r=t._start,i=t._start,s=im();const a=RV(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Vc:tR(a,i.content);break;default:e+=epe(n,r,i,s,a),s=RV(a),r=i;break}i=i.right}}),e},v5e=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&Ufe(t,n.store.clients.get(r),s,i,a=>{!a.deleted&&a.content.constructor===Vc&&a.constructor!==Vf&&e.add(a.parent)})}$s(n,r=>{dC(t,t.deleteSet,i=>{if(i instanceof Vf||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Vc?e.add(s):m5e(r,i)});for(const i of e)g5e(i)})},zee=(t,e,n)=>{const r=n,i=RV(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case _y:case JT:case Gg:n<e.right.length&&Uh(t,Ti(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&epe(t,s,e.right,i,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&dO(a._searchMarker,e.index,-r+n),e};class y5e extends RB{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];$s(e,r=>{const i=new Map,s=new Map;let a=this.target._start,o=null;const c={};let l="",u=0,h=0;const d=()=>{if(o!==null){let f=null;switch(o){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,g)=>{p!==null&&(f.attributes[g]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},ije(c)||(f.attributes=tje({},c))),u=0;break}f&&n.push(f),o=null}};for(;a!==null;){switch(a.content.constructor){case _y:case JT:this.adds(a)?this.deletes(a)||(d(),o="insert",l=a.content.getContent()[0],d()):this.deletes(a)?(o!=="delete"&&(d(),o="delete"),h+=1):a.deleted||(o!=="retain"&&(d(),o="retain"),u+=1);break;case Gg:this.adds(a)?this.deletes(a)||(o!=="insert"&&(d(),o="insert"),l+=a.content.str):this.deletes(a)?(o!=="delete"&&(d(),o="delete"),h+=a.length):a.deleted||(o!=="retain"&&(d(),o="retain"),u+=a.length);break;case Vc:{const{key:f,value:p}=a.content;if(this.adds(a)){if(!this.deletes(a)){const g=i.get(f)??null;J_(g,p)?p!==null&&a.delete(r):(o==="retain"&&d(),J_(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(a)){s.set(f,p);const g=i.get(f)??null;J_(g,p)||(o==="retain"&&d(),c[f]=g)}else if(!a.deleted){s.set(f,p);const g=c[f];g!==void 0&&(J_(g,p)?g!==null&&a.delete(r):(o==="retain"&&d(),p===null?delete c[f]:c[f]=p))}a.deleted||(o==="insert"&&d(),tR(i,a.content));break}}a=a.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Vg extends pl{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??lu(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Vg}clone(){const e=new Vg;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new y5e(this,e,n);MB(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??lu();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Gg&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?$s(this.doc,r=>{const i=new LV(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const a=e[s];if(a.insert!==void 0){const o=!n&&typeof a.insert=="string"&&s===e.length-1&&i.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof o!="string"||o.length>0)&&dH(r,this,i,o,a.attributes||{})}else a.retain!==void 0?Fee(r,this,i,a.retain,a.attributes||{}):a.delete!==void 0&&zee(r,i,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??lu();const i=[],s=new Map,a=this.doc;let o="",c=this._start;function l(){if(o.length>0){const h={};let d=!1;s.forEach((p,g)=>{d=!0,h[g]=p});const f={insert:o};d&&(f.attributes=h),i.push(f),o=""}}const u=()=>{for(;c!==null;){if(x1(c,e)||n!==void 0&&x1(c,n))switch(c.content.constructor){case Gg:{const h=s.get("ychange");e!==void 0&&!x1(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!x1(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),o+=c.content.str;break}case _y:case JT:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case Vc:x1(c,e)&&(l(),tR(s,c.content));break}c=c.right}l()};return e||n?$s(a,h=>{e&&DV(h,e),n&&DV(h,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?$s(i,s=>{const a=uD(s,this,e,!r);r||(r={},a.currentAttributes.forEach((o,c)=>{r[c]=o})),dH(s,this,a,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?$s(i,s=>{const a=uD(s,this,e,!r);dH(s,this,a,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?$s(r,i=>{zee(i,uD(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?$s(i,s=>{const a=uD(s,this,e,!1);a.right!==null&&Fee(s,this,a,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?$s(this.doc,n=>{X2(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?$s(this.doc,r=>{VW(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return GW(this,e)}getAttributes(){return Xfe(this)}_write(e){e.writeTypeRef(B5e)}}const _5e=t=>new Vg;class fH{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??lu()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===mC||n.constructor===xT)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class xT extends pl{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new xT}clone(){const e=new xT;return e.insert(0,this.toArray().map(n=>n instanceof pl?n.clone():n)),e}get length(){return this.doc??lu(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new fH(this,e)}querySelector(e){e=e.toUpperCase();const r=new fH(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),ST(new fH(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){MB(this,e,new S5e(this,n,e))}toString(){return Gfe(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),fO(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?$s(this.doc,r=>{Wfe(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)$s(this.doc,r=>{const i=e&&e instanceof pl?e._item:e;Y2(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Mb("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?$s(this.doc,r=>{Yfe(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Vfe(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return qfe(this,e)}slice(e=0,n=this.length){return jfe(this,e,n)}forEach(e){fO(this,e)}_write(e){e.writeTypeRef(z5e)}}const b5e=t=>new xT;class mC extends xT{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new mC(this.nodeName)}clone(){const e=new mC(this.nodeName),n=this.getAttributes();return rje(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof pl?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const o in e)r.push(o);r.sort();const i=r.length;for(let o=0;o<i;o++){const c=r[o];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${s}${a}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?$s(this.doc,n=>{X2(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?$s(this.doc,r=>{VW(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return GW(this,e)}hasAttribute(e){return Kfe(this,e)}getAttributes(e){return e?u5e(this,e):Xfe(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const a in s){const o=s[a];typeof o=="string"&&i.setAttribute(a,o)}return fO(this,a=>{i.appendChild(a.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(F5e),e.writeKey(this.nodeName)}}const E5e=t=>new mC(t.readKey());class S5e extends RB{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class K2 extends pC{constructor(e){super(),this.hookName=e}_copy(){return new K2(this.hookName)}clone(){const e=new K2(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(H5e),e.writeKey(this.hookName)}}const T5e=t=>new K2(t.readKey());class J2 extends Vg{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new J2}clone(){const e=new J2;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const a in e.attributes[i])s.push({key:a,value:e.attributes[i][a]});s.sort((a,o)=>a.key<o.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let a=0;a<s.attrs.length;a++){const o=s.attrs[a];r+=` ${o.key}="${o.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(j5e)}}const x5e=t=>new J2;class qW{constructor(e,n){this.id=e,this.length=n}get deleted(){throw kg()}mergeWith(e){return!1}write(e,n,r){throw kg()}integrate(e,n){throw kg()}}const w5e=0;class Vf extends qW{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),Lfe(e.doc.store,this)}write(e,n){e.writeInfo(w5e),e.writeLen(this.length-n)}getMissing(e,n){return null}}class VN{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new VN(this.content)}splice(e){throw kg()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const C5e=t=>new VN(t.readBuf());class pO{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new pO(this.len)}splice(e){const n=new pO(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){hO(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const R5e=t=>new pO(t.readLen()),tpe=(t,e)=>new KT({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class GN{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new GN(tpe(this.doc.guid,this.opts))}splice(e){throw kg()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const A5e=t=>new GN(tpe(t.readString(),t.readAny()));class JT{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new JT(this.embed)}splice(e){throw kg()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const M5e=t=>new JT(t.readJSON());class Vc{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Vc(this.key,this.value)}splice(e){throw kg()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const O5e=t=>new Vc(t.readKey(),t.readJSON());class Z2{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Z2(this.arr)}splice(e){const n=new Z2(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const N5e=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Z2(n)},I5e=q2("node_env")==="development";class wT{constructor(e){this.arr=e,I5e&&_fe(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new wT(this.arr)}splice(e){const n=new wT(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const k5e=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new wT(n)};class Gg{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Gg(this.str)}splice(e){const n=new Gg(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const D5e=t=>new Gg(t.readString()),P5e=[d5e,p5e,_5e,E5e,b5e,T5e,x5e],L5e=0,U5e=1,B5e=2,F5e=3,z5e=4,H5e=5,j5e=6;class _y{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new _y(this.type._copy())}splice(e){throw kg()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const V5e=t=>new _y(P5e[t.readTypeRef()](t)),G5e=(t,e)=>{let n=e,r=0,i;do r>0&&(n=Ti(n.client,n.clock+r)),i=mP(t,n),r=n.clock-i.id.clock,n=i.redone;while(n!==null&&i instanceof ba);return{item:i,diff:r}},$W=(t,e)=>{for(;t!==null&&t.keep!==e;)t.keep=e,t=t.parent._item},Q2=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ba(Ti(r,i+n),e,Ti(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ti(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s},Hee=(t,e)=>_He(t,n=>HN(n.deletions,e)),npe=(t,e,n,r,i,s)=>{const a=t.doc,o=a.store,c=a.clientID,l=e.redone;if(l!==null)return Uh(t,l);let u=e.parent._item,h=null,d;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||npe(t,u,n,r,i,s)===null))return null;for(;u.redone!==null;)u=Uh(t,u.redone)}const f=u===null?e.parent:u.content.type;if(e.parentSub===null){for(h=e.left,d=e;h!==null;){let v=h;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:Uh(t,v.redone);if(v!==null&&v.parent._item===u){h=v;break}h=h.left}for(;d!==null;){let v=d;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:Uh(t,v.redone);if(v!==null&&v.parent._item===u){d=v;break}d=d.right}}else if(d=null,e.right&&!i){for(h=e;h!==null&&h.right!==null&&(h.right.redone||HN(r,h.right.id)||Hee(s.undoStack,h.right.id)||Hee(s.redoStack,h.right.id));)for(h=h.right;h.redone;)h=Uh(t,h.redone);if(h&&h.right!==null)return null}else h=f._map.get(e.parentSub)||null;const p=Lc(o,c),g=Ti(c,p),_=new ba(g,h,h&&h.lastId,d,d&&d.id,f,e.parentSub,e.content.copy());return e.redone=g,$W(_,!0),_.integrate(t,0),_};class ba extends qW{constructor(e,n,r,i,s,a,o,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=a,this.parentSub=o,this.redone=null,this.content=c,this.info=this.content.isCountable()?vee:0}set marker(e){(this.info&cH)>0!==e&&(this.info^=cH)}get marker(){return(this.info&cH)>0}get keep(){return(this.info&gee)>0}set keep(e){this.keep!==e&&(this.info^=gee)}get countable(){return(this.info&vee)>0}get deleted(){return(this.info&oH)>0}set deleted(e){this.deleted!==e&&(this.info^=oH)}markDeleted(){this.info|=oH}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Lc(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Lc(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===bw&&this.id.client!==this.parent.client&&this.parent.clock>=Lc(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Iee(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Uh(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vf||this.right&&this.right.constructor===Vf)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ba?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ba&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===bw){const r=mP(n,this.parent);r.constructor===Vf?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Iee(e,e.doc.store,Ti(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,a=new Set;for(;i!==null&&i!==this.right;){if(a.add(i),s.add(i),cD(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(cD(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&a.has(mP(e.doc.store,i.origin)))s.has(mP(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Lfe(e.doc.store,this),this.content.integrate(e,this),Dee(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Vf(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ti(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&cD(e.origin,this.lastId)&&this.right===e&&cD(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),hO(e.deleteSet,this.id.client,this.id.clock,this.length),Dee(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Hg();this.content.gc(e),n?$je(e,this,new Vf(this.id,this.length)):this.content=new pO(this.length)}write(e,n){const r=n>0?Ti(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,a=this.content.getRef()&TB|(r===null?0:Xd)|(i===null?0:$v)|(s===null?0:aO);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const o=this.parent;if(o._item!==void 0){const c=o._item;if(c===null){const l=Gje(o);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else o.constructor===String?(e.writeParentInfo(!0),e.writeString(o)):o.constructor===bw?(e.writeParentInfo(!1),e.writeLeftID(o)):Hg();s!==null&&e.writeString(s)}this.content.write(e,n)}}const rpe=(t,e)=>q5e[e&TB](t),q5e=[()=>{Hg()},R5e,N5e,C5e,D5e,M5e,O5e,V5e,k5e,A5e,()=>{Hg()}],$5e=10;class Gf extends qW{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Hg()}write(e,n){e.writeInfo($5e),Xi(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const ipe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Qp<"u"?Qp:{},spe="__ $YJS$ __";ipe[spe]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ipe[spe]=!0;let jee=!1;const Bh=new KT;function ape(t){const e=Bh.getMap(),[,n]=Be.useState(0);if(Be.useEffect(()=>{function r(){n(i=>1-i)}return e.observe(r),()=>{e.unobserve(r)}},[e,n]),e.has(t))return e.get(t)}function qN(t){const e=ape(t);if(pn(e))return e}function ope(t){const e=ape(t);if(!(!ae(e)||!(e instanceof Vg)))return e}function cpe(t,e,n){const r=Bh.getMap();if(!r.has(t))switch(e){case 0:case 1:r.set(t,n);break}}function W5e(t,e){cpe(t,0,e)}function lpe(t,e){const n=new Vg(e);cpe(t,1,n)}function ul(t,e){Bh.getMap().set(t,e)}function Y5e(t,e){const n=Bh.getMap(),r=new Vg(e);n.set(t,r)}function upe(t,e){const n=Bh.getMap();function r(i){const s=n.get(t);for(let a=0;a<i.length;++a)(i[a].target===n||i[a].target===s)&&e(s)}return n.has(t)&&e(n.get(t)),n.observeDeep(r),()=>{n.observeDeep(r)}}function X5e(t,e){return upe(t,n=>{pn(n)&&e(n)})}function K5e(t,e){return upe(t,n=>{n instanceof Vg&&e(n.toJSON())})}const ES=Wb("modem",["second"],t=>{if(ES.session(t))switch(t.target){case"second":!jee&&t.data%2===0&&ES.emit(t.player,"modem:join");break;case"join":t.sender!==ES.id()&&ES.reply(t,"joinack",ahe(Hje(Bh)));break;case"joinack":t.sender!==ES.id()&&(jee=!0,Aee(Bh,ZM(t.data),Bh));break;case"sync":{t.sender!==ES.id()&&ae(t.data)&&Aee(Bh,ZM(t.data),Bh);break}}});function hpe(t,e){e!==Bh&&ES.emit("","modem:sync",ahe(t))}Bh.on("update",hpe);Bh.on("destroy",()=>{Bh.off("update",hpe)});function J5e(t,e,n,r){const i=t.slice(0,e),s=t.slice(e+n);return`${i}${r??""}${s}`}function WW(t){const[e,n]=t.split(":"),r=ae(n);return[r?e:"self",r?n:t]}const Ob=navigator.userAgent.includes("Mac"),Ad=Ob?"cmd":"ctrl";function c1(){lPe(Ge,iM())}const Z5e=s0().command("send",(t,e)=>{const[n,r]=Ot(e,0,[st.NAME,st.ANY]);switch(ar(n)){case"helpmenu":$p(Ge,ne.elementfocus,"H E L P"),wr(Ge,ne.elementfocus,""),ci(Ge,ne.elementfocus,"#help controls","zss controls and inputs"),wr(Ge,ne.elementfocus,"!helpcontrols;read help controls"),wr(Ge,ne.elementfocus,""),ci(Ge,ne.elementfocus,"#help text","text formatting"),wr(Ge,ne.elementfocus,"!helptext;read help text"),wr(Ge,ne.elementfocus,""),ci(Ge,ne.elementfocus,"#help developer","developer commands"),wr(Ge,ne.elementfocus,"!helpdeveloper;read help developer"),wr(Ge,ne.elementfocus,""),ci(Ge,ne.elementfocus,"#help player","player settings"),wr(Ge,ne.elementfocus,"!helpplayer;read help player"),pv(Ge,ne.elementfocus,"keyboard input"),ci(Ge,ne.elementfocus,"?","open console"),ci(Ge,ne.elementfocus,"esc","close console"),ci(Ge,ne.elementfocus,"tab","move console"),ci(Ge,ne.elementfocus,"up / down arrow keys","navigate console items"),ci(Ge,ne.elementfocus,"left / right arrow keys","change console items"),ci(Ge,ne.elementfocus,"enter","interact with console items"),ci(Ge,ne.elementfocus,"alt + arrow keys","skip words and console lines"),ci(Ge,ne.elementfocus,`${Ad} + up / down arrow keys`,"input history");break;case"helpcontrols":$p(Ge,ne.elementfocus,"zss controls and inputs"),pv(Ge,ne.elementfocus,"keyboard input"),ci(Ge,ne.elementfocus,"arrow keys","move"),ci(Ge,ne.elementfocus,"shift + arrow keys","shoot"),ci(Ge,ne.elementfocus,"enter","ok / accept"),ci(Ge,ne.elementfocus,"escape","cancel / close"),ci(Ge,ne.elementfocus,"tab","menu / action"),pv(Ge,ne.elementfocus,"controller input"),ci(Ge,ne.elementfocus,"left stick","move"),ci(Ge,ne.elementfocus,"right stick","aim"),ci(Ge,ne.elementfocus,"a","ok / accept"),ci(Ge,ne.elementfocus,"b","cancel / close"),ci(Ge,ne.elementfocus,"y","menu / action"),ci(Ge,ne.elementfocus,"x","shoot"),ci(Ge,ne.elementfocus,"triggers","shoot");break;case"helptext":break;case"helpdeveloper":$p(Ge,ne.elementfocus,"developer commands"),ci(Ge,ne.elementfocus,"#books","list books in memory"),ci(Ge,ne.elementfocus,"#pages","list pages in opened book"),ci(Ge,ne.elementfocus,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ci(Ge,ne.elementfocus,"#trash","list books and pages from open book you can delete"),ci(Ge,ne.elementfocus,"#save","flush state to register"),ci(Ge,ne.elementfocus,"#share","creates a click to copy share url and QR code");break;case"helpplayer":$p(Ge,ne.elementfocus,"player settings"),uo(Ge,ne.elementfocus,"todo");break;default:{const[i,s]=WW(n);Fpe(i==="self"&&ne.elementisplayer?`${ne.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(qs),s=i.join(" ");switch(ar(r)){case Ud(cn.LOADER):n=x_(wc.CONTENT,s,Wn.LOADER);break;default:n=x_(wc.CONTENT,[r,...i].join(" "),Wn.OBJECT);break;case Ud(cn.BOARD):n=x_(wc.CONTENT,s,Wn.BOARD);break;case Ud(cn.OBJECT):n=x_(wc.CONTENT,s,Wn.OBJECT);break;case Ud(cn.TERRAIN):n=x_(wc.CONTENT,s,Wn.TERRAIN);break;case Ud(cn.CHARSET):n=x_(wc.CONTENT,s,Wn.CHARSET);break;case Ud(cn.PALETTE):n=x_(wc.CONTENT,s,Wn.PALETTE);break}return ae(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(qs).join(" ");return ae(ne.element)&&(ne.element.tickertext=n,ne.element.tickertime=ne.timestamp),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=qs(n),s=r.map(qs).join(" ");return Fg(Ge,ne.elementfocus,`!${s};${i}`),0}).command("bookcreate",(t,e)=>{const[n]=Ot(e,0,[st.MAYBE_NAME]),r=Upe(n);return ae(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Mv(n);return ae(r)?(uo(Ge,ne.elementfocus,`opened [book] ${r.name}`),VV(wc.MAIN,r.id),t.command("pages")):Hr(Ge,ne.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=J1(wc.MAIN),i=Mv(n);return ae(i)&&(r===i&&VV(wc.MAIN,""),WGe(n),uo(Ge,ne.elementfocus,`trashed [book] ${i.name}`),c1(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Yf(ne.book,Wn.BOARD,n);if(r.length){const i=Ya(...r);ae(i)&&X1(ne.book,ne.elementfocus,i.id,{x:Hf(0,fr-1),y:Hf(0,ji-1)})}return 0}).command("pageopenwith",(t,e)=>{const[n,r,i]=Ot(e,0,[st.NAME,st.MAYBE_NAME,st.MAYBE_NAME]);return t.command("pageopen",r,i,n)}).command("pageopen",(t,e)=>{const[n,r,i]=Ot(e,0,[st.NAME,st.MAYBE_NAME,st.MAYBE_NAME]),s=Fv(wc.MAIN);if(!ae(s))return 0;const a=KS(s,n);if(ae(a)){const o=$u(a),c=aS(a);uo(Ge,ne.elementfocus,`opened [${c}] ${o}`);const l=[],u=KS(s,i??""),h=ae(u)?xW(u.code):void 0;if(ae(h))for(let p=0;p<h.tokens.length;++p){const g=h.tokens[p];g.tokenType===_B&&l.push(g.image.startsWith('"')?g.image.slice(1):g.image)}const d=[a.id,r];lpe(Uue(s.id,d),a.code);const f=aS(a);GDe(Ge,ne.elementfocus,s.id,d,f,`${o} - ${s.name}`,l)}else Hr(Ge,"pageopen",`page ${n} not found`,ne.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Fv(wc.MAIN),i=sfe(r,n);if(ae(n)){const s=$u(i),a=aS(i);uo(Ge,ne.elementfocus,`trashed [${a}] ${s}`),c1(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(qs).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{pv(Ge,ne.elementfocus,"books");const t=J1(wc.MAIN);ci(Ge,ne.elementfocus,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=J1(wc.CONTENT);ci(Ge,ne.elementfocus,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),f7(Ge,ne.elementfocus,7);const n=bP();return n.length?n.forEach(r=>{wr(Ge,ne.elementfocus,`!bookopen ${r.id};${r.name}`)}):uo(Ge,ne.elementfocus,"no books found"),wr(Ge,ne.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=Fv(wc.MAIN);return ae(t)&&(pv(Ge,ne.elementfocus,"pages"),ci(Ge,ne.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?iH(t).forEach(n=>{const r=$u(n),i=aS(n);wr(Ge,ne.elementfocus,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(wr(Ge,ne.elementfocus,""),uo(Ge,ne.elementfocus,"$white no pages found"),uo(Ge,ne.elementfocus,"$white use @ to create a page"),uo(Ge,ne.elementfocus,"$white @board name of board"),uo(Ge,ne.elementfocus,"$white @object name of object"),uo(Ge,ne.elementfocus,"$white @terrain name of terrain"),uo(Ge,ne.elementfocus,"$white You can omit the type and it will default to object"),uo(Ge,ne.elementfocus,"$white @object name of object"),uo(Ge,ne.elementfocus,"$white @name of object"))),0}).command("boards",()=>{pv(Ge,ne.elementfocus,"boards");const t=Fv(wc.MAIN);if(ae(t)){ci(Ge,ne.elementfocus,"main",`${t.name} $GREEN${t.id}`);const e=iH(t);e.filter(n=>bT(n)===Wn.BOARD).forEach(n=>{const r=$u(n),i=aS(n);wr(Ge,ne.elementfocus,`!boardopen ${n.id};$blue[${i}]$white ${r}`)}),e.length===0&&(wr(Ge,ne.elementfocus,""),uo(Ge,ne.elementfocus,"$white no boards found"),uo(Ge,ne.elementfocus,"$white use @ to create a board"),uo(Ge,ne.elementfocus,"$white @board name of board"))}return 0}).command("trash",()=>{pv(Ge,ne.elementfocus,"$REDTRASH"),uo(Ge,ne.elementfocus,"books");const t=bP();t.length&&(t.forEach(n=>{wr(Ge,ne.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),wr(Ge,ne.elementfocus,""));const e=J1(wc.MAIN);return ae(e)&&(uo(Ge,ne.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=$u(n);wr(Ge,ne.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),wr(Ge,ne.elementfocus,"")),0}).command("dev",()=>(c1(),ODe(Ge,ne.elementfocus),0)).command("share",()=>(c1(),NDe(Ge,ne.elementfocus),0)).command("save",()=>(c1(),0)).command("fork",()=>(uPe(Ge,ne.elementfocus),0)).command("nuke",()=>(IDe(Ge,ne.elementfocus),0)).command("restart",()=>(oPe(Ge,ne.elementfocus),c1(),0)).command("export",()=>{$p(Ge,ne.elementfocus,"E X P O R T"),pv(Ge,ne.elementfocus,"books");const t=bP();return t.length&&t.forEach(e=>wr(Ge,ne.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Mv(n);return ae(r)&&($p(Ge,ne.elementfocus,"E X P O R T"),pv(Ge,ne.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=iH(r);wr(Ge,ne.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const a=$u(s),o=aS(s);wr(Ge,ne.elementfocus,`!pageexport ${n}:${s.id};$blue[${o}]$white ${a}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Mv(n);return ae(r)&&OZ(Ge,ne.elementfocus,cl(r),`${r.name}.book.json`),0}).command("pageexport",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),{target:r,path:i}=GT(n),s=Mv(r),a=KS(s,i);return ae(a)&&OZ(Ge,ne.elementfocus,cl(a),`${$u(a)}.${aS(a)}.json`),0}).command("gadget",()=>(zDe(Ge,ne.elementfocus),0)).command("joincode",(t,e)=>{const[n]=Ot(e,0,[st.MAYBE_NAME]);return xDe(Ge,ne.elementfocus,!!n),0}).command("jointab",(t,e)=>{const[n]=Ot(e,0,[st.MAYBE_NAME]);return wDe(Ge,ne.elementfocus,!!n),0}),Q5e=s0().command("toast",(t,e)=>{const n=e.map(qs).join("");return fDe(Ge,ne.elementfocus,n),0}).command("palette",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=ate(),i=eh(ne.book,Wn.PALETTE,n);return ae(i)?(r.palette=i.id,wr(Ge,ne.elementfocus,`loaded palette ${n}`)):Hr(Ge,ne.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=ate(),i=eh(ne.book,Wn.CHARSET,n);return ae(i)?(r.charset=i.id,wr(Ge,ne.elementfocus,`loaded charset ${n}`)):Hr(Ge,ne.elementfocus,"not-found",`unabled to find charset ${n}`),0}),dpe={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function mO(t){return Lr(t)&&fpe(t[0])}function fpe(t){return ae(dT[t])&&On(t)}function ppe(t){if(On(t))return dpe[ar(t)]}function Vee(t){if(mO(t))return t;if(fpe(t))return[t];const e=ppe(t);if(ae(e))return[e]}function eVe(t){const e=ne.words[t],n=Vee(e);if(mO(n))return[n,t+1];const[r,i]=Ih(t),s=Vee(r);return mO(s)?[s,i]:[void 0,t]}const mpe={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};bs.ISSOLID,bs.ISWALK,bs.ISSWIM,bs.ISBULLET,bs.ISWALK,bs.ISSWIM;function eU(t){return Lr(t)&&UV(t[0])}function UV(t){return ae(bs[t])&&On(t)}function tVe(t){if(On(t))return mpe[ar(t)]}function nVe(t){const e=ne.words[t];if(eU(e))return[e,t+1];if(UV(e))return[[e],t+1];const[n,r]=Ih(t);return eU(n)?[n,r]:UV(n)?[[n],r]:[void 0,t]}const rVe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Gee=new Set(["group","party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),iVe=["NORTH","SOUTH","WEST","EAST"];function sVe(t){const e=gO(t);if(pn(e.inputcurrent)||(e.inputcurrent=0),Lr(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=tn.NONE,i=0]=n??[tn.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&nhe?1:0,e.inputctrl=i&rhe?1:0,e.inputshift=i&ihe?1:0,r){case tn.MOVE_UP:case tn.MOVE_DOWN:case tn.MOVE_LEFT:case tn.MOVE_RIGHT:e.inputmove=[iVe[r-tn.MOVE_UP]];break;case tn.OK_BUTTON:e.inputok=1;break;case tn.CANCEL_BUTTON:e.inputcancel=1;break;case tn.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[a]=s;return a!==tn.NONE&&a!==r}),e}function aVe(t){const e=dpe[t];if(ae(e))return e;const n=mpe[t];if(ae(n))return n;const r=NB[t];if(ae(r))return r;const i=Rde[t];if(ae(i))return i}const oVe=s0({get(t,e){var a,o,c,l,u,h,d,f,p,g,_,v,E,T,x,N,A,I,k,L,U;const n=aVe(e);if(ae(n))return[!0,n];if(ne.elementisplayer&&rVe.has(e)){const $=sVe(ne.elementid)[e];return[ae($),$]}const r=sO(ne.board,{x:((a=ne.element)==null?void 0:a.x)??-1,y:((o=ne.element)==null?void 0:o.y)??-1},ne.elementfocus),i=(r==null?void 0:r.id)??ne.elementfocus??iM();switch(e){case"isdark":return[!0,(c=ne.board)!=null&&c.isdark?1:0];case"startx":return[!0,((l=ne.board)==null?void 0:l.startx)??0];case"starty":return[!0,((u=ne.board)==null?void 0:u.starty)??0];case"over":return[!0,((h=ne.board)==null?void 0:h.over)??""];case"under":return[!0,((d=ne.board)==null?void 0:d.under)??""];case"camera":return[!0,((f=ne.board)==null?void 0:f.camera)??""];case"graphics":return[!0,((p=ne.board)==null?void 0:p.graphics)??""];case"facing":break;case"exitnorth":return[!0,((g=ne.board)==null?void 0:g.exitnorth)??""];case"exitsouth":return[!0,((_=ne.board)==null?void 0:_.exitsouth)??""];case"exitwest":return[!0,((v=ne.board)==null?void 0:v.exitwest)??""];case"exiteast":return[!0,((E=ne.board)==null?void 0:E.exiteast)??""];case"timelimit":return[!0,((T=ne.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((x=ne.board)==null?void 0:x.restartonzap)??0];case"maxplayershots":return[!0,((N=ne.board)==null?void 0:N.maxplayershots)??0];case"boardid":return[!0,((A=ne.board)==null?void 0:A.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=ne.element)==null?void 0:I.id)??""];case"thisx":return[!0,((k=ne.element)==null?void 0:k.x)??-1];case"thisy":return[!0,((L=ne.element)==null?void 0:L.y)??-1];default:{const $=(U=ne.element)==null?void 0:U[e];if(Gee.has(e))return[!0,$];break}}const s=gO(i)[e];return[ae(s),s]},set(t,e,n){var a,o;const r=sO(ne.board,{x:((a=ne.element)==null?void 0:a.x)??-1,y:((o=ne.element)==null?void 0:o.y)??-1},ne.elementfocus),i=(r==null?void 0:r.id)??ne.elementfocus;switch(e){case"isdark":if(ae(ne.board))return ne.board.isdark=n?1:0,[!0,ne.board.isdark];break;case"startx":if(ae(ne.board))return ne.board.startx=LS(n,0),[!0,ne.board.startx];break;case"starty":if(ae(ne.board))return ne.board.starty=LS(n,0),[!0,ne.board.starty];break;case"over":if(ae(ne.board))return ne.board.over=pn(n)?n:qs(n),[!0,ne.board.over];break;case"under":if(ae(ne.board))return ne.board.under=pn(n)?n:qs(n),[!0,ne.board.under];break;case"camera":if(ae(ne.board))return[!0,ne.board.camera=qs(n)];break;case"graphics":if(ae(ne.board))return[!0,ne.board.graphics=qs(n)];break;case"facing":break;case"exitnorth":if(ae(ne.board))return ne.board.exitnorth=qs(n),[!0,ne.board.exitnorth];break;case"exitsouth":if(ae(ne.board))return ne.board.exitsouth=qs(n),[!0,ne.board.exitsouth];break;case"exitwest":if(ae(ne.board))return ne.board.exitwest=qs(n),[!0,ne.board.exitwest];break;case"exiteast":if(ae(ne.board))return ne.board.exiteast=qs(n),[!0,ne.board.exiteast];break;case"timelimit":if(ae(ne.board))return ne.board.timelimit=LS(n,0),[!0,ne.board.timelimit];break;case"restartonzap":if(ae(ne.board))return ne.board.restartonzap=n?1:0,[!0,ne.board.restartonzap];break;case"maxplayershots":if(ae(ne.board))return ne.board.maxplayershots=LS(n,0),[!0,ne.board.maxplayershots];break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Gee.has(e))return ae(ne.element)&&(ne.element[e]=n),[!0,n];break}}const s=gO(i);return ae(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n,r,i;if(!((t=ne.element)!=null&&t.removed)&&(ae((e=ne.element)==null?void 0:e.stepx)||ae((n=ne.element)==null?void 0:n.stepy))){const s={x:((r=ne.element)==null?void 0:r.x)??0,y:((i=ne.element)==null?void 0:i.y)??0};Tw(ne.book,ne.board,ne.element,{x:s.x+(ne.element.stepx??0),y:s.y+(ne.element.stepy??0)})===!1&&(ne.element.stepx=0,ne.element.stepy=0,Dh(ne.book,ne.element,"destructible")&&Ig(ne.book,ne.board,ne.element,ne.timestamp))}}}).command("clear",(t,e)=>(e.forEach(n=>t.set(qs(n),0)),0)).command("set",(t,e)=>{const[n,r]=Ot(e,0,[st.NAME,st.ANY]);return t.set(n,r),0}).command("become",(t,e)=>{var r,i;const[n]=Ot(e,0,[st.KIND]);if(dl(ne.book,ne.board),ofe(ne.book,ne.board,ne.element),Ig(ne.book,ne.board,ne.element,ne.timestamp)){const s={x:((r=ne.element)==null?void 0:r.x)??0,y:((i=ne.element)==null?void 0:i.y)??0};ET(ne.book,ne.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=Ot(e,0,[st.NUMBER]);return ae(ne.element)&&(ne.element.char=n),0}).command("color",(t,e)=>{const[n]=Ot(e,0,[st.COLOR]);return ae(ne.element)&&ae(n)&&k2(ne.element,n),0}).command("go",(t,e)=>{if(ae(ne.element)){const[n]=Ot(e,0,[st.DIR]);if(Tw(ne.book,ne.board,ne.element,n),t.yield(),ne.element.x===n.x&&ne.element.y===n.y)return 0}return 1}).command("walk",(t,e)=>{if(!ae(ne.element))return 0;const[n]=Ot(e,0,[st.DIR]),r=ne.element.x??0,i=ne.element.y??0;return ne.element.stepx=n.x-r,ne.element.stepy=n.y-i,0}),cVe=s0().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=Ot(e,0,[st.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(qs(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(qs(e[0])),0)).command("cycle",(t,e)=>{if(ae(ne.element)){const[n]=Ot(e,0,[st.NUMBER]);ne.element.cycle=Ei(Math.round(n),1,255)}return 0}).command("die",t=>(Ig(ne.book,ne.board,ne.element,ne.timestamp),t.endofprogram(),0)).command("endgame",()=>(ZDe(Ge,ne.elementfocus),0)).command("run",(t,e)=>{const[n]=Ot(e,0,[st.NAME]);return iU(n),0}).command("runwith",(t,e)=>{const[n,r]=Ot(e,0,[st.ANY,st.NAME]);return t.set("arg",n),iU(r),0}),gpe={};function lVe(t){var e;return(e=gpe[t])==null?void 0:e.format}function Sw(t){var e;return(e=gpe[t])==null?void 0:e.content}function qee(t,e){if(!ae(t))return;const n=ar(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const uVe=(t,e)=>{const n=Sw(t.id());if(!ae(n))return 0;const[r,i]=Ot(e,0,[st.NAME]),s=ar(r);switch(s){case"seek":{const[a]=Ot(e,i,[st.NUMBER]);n.cursor=a;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[a]=Ot(e,i,[st.NAME]);t.set(a,qee(n,s));break}case"text":{const[a,o]=Ot(e,i,[st.NAME,st.NAME]),c=qee(n,a);if(pn(c)&&On(o)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(o,h),n.cursor+=c}break}case"palette":{const[a]=Ot(e,i,[st.NAME]),o=CV(ne.book,Wn.PALETTE,a),c=jc(o);if(ae(c)){const l=g7*fT,u=YC(new Uint8Array(n.bytes.buffer,n.cursor,l));ae(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[a]=Ot(e,i,[st.NAME]),o=CV(ne.book,Wn.CHARSET,a),c=jc(o);if(ae(c)){const l=Hh*JM*sV,u=XC(new Uint8Array(n.bytes.buffer,n.cursor,l));ae(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},gC=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",tU=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!tU(t[n],e[n]))return!1;return!0}if(gC(t)&&gC(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!tU(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},hD=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(gC(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},hVe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",$ee=t=>t>="0"&&t<="9"||t==="-",dVe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var pt;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(pt||(pt={}));const Wee={"(":pt.TOK_LPAREN,")":pt.TOK_RPAREN,"*":pt.TOK_STAR,",":pt.TOK_COMMA,".":pt.TOK_DOT,":":pt.TOK_COLON,"@":pt.TOK_CURRENT,$:pt.TOK_ROOT,"]":pt.TOK_RBRACKET,"{":pt.TOK_LBRACE,"}":pt.TOK_RBRACE},fVe={"!":!0,"<":!0,"=":!0,">":!0},pVe={"	":!0,"\n":!0,"\r":!0," ":!0};class mVe{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(hVe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:pt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Wee[e[this._current]]!==void 0)n.push({start:this._current,type:Wee[e[this._current]],value:e[this._current]}),this._current+=1;else if($ee(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:pt.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:pt.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const a=this.consumeLiteral(e);n.push({start:r,type:pt.TOK_LITERAL,value:a})}else if(fVe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(pVe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:pt.TOK_AND,value:"&&"})):n.push({start:r,type:pt.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:pt.TOK_OR,value:"||"})):n.push({start:r,type:pt.TOK_PIPE,value:"|"});else{const a=new Error(`Unknown character: ${e[this._current]}`);throw a.name="LexerError",a}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&dVe(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;$ee(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:pt.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:pt.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:pt.TOK_FLATTEN,value:"[]"}):{start:n,type:pt.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:pt.TOK_NE,value:"!="}):{start:n,type:pt.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:pt.TOK_LTE,value:"<="}):{start:n,type:pt.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:pt.TOK_GTE,value:">="}):{start:n,type:pt.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:pt.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let a=this._current;e[a]==="\\"&&(e[a+1]==="\\"||e[a+1]==="`")?a+=2:a+=1,this._current=a}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const gVe=new mVe,Zl={[pt.TOK_EOF]:0,[pt.TOK_UNQUOTEDIDENTIFIER]:0,[pt.TOK_QUOTEDIDENTIFIER]:0,[pt.TOK_RBRACKET]:0,[pt.TOK_RPAREN]:0,[pt.TOK_COMMA]:0,[pt.TOK_RBRACE]:0,[pt.TOK_NUMBER]:0,[pt.TOK_CURRENT]:0,[pt.TOK_EXPREF]:0,[pt.TOK_ROOT]:0,[pt.TOK_PIPE]:1,[pt.TOK_OR]:2,[pt.TOK_AND]:3,[pt.TOK_EQ]:5,[pt.TOK_GT]:5,[pt.TOK_LT]:5,[pt.TOK_GTE]:5,[pt.TOK_LTE]:5,[pt.TOK_NE]:5,[pt.TOK_FLATTEN]:9,[pt.TOK_STAR]:20,[pt.TOK_FILTER]:21,[pt.TOK_DOT]:40,[pt.TOK_NOT]:45,[pt.TOK_LBRACE]:50,[pt.TOK_LBRACKET]:55,[pt.TOK_LPAREN]:60};class vVe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==pt.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...gVe.tokenize(e),{type:pt.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<Zl[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case pt.TOK_LITERAL:return{type:"Literal",value:e.value};case pt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case pt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===pt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case pt.TOK_NOT:return r=this.expression(Zl.Not),{type:"NotExpression",children:[r]};case pt.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===pt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Zl.Star),{type:"ValueProjection",children:[n,r]};case pt.TOK_FILTER:return this.led(e.type,{type:"Identity"});case pt.TOK_LBRACE:return this.parseMultiselectHash();case pt.TOK_FLATTEN:return n={type:pt.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(Zl.Flatten),{type:"Projection",children:[n,r]};case pt.TOK_LBRACKET:return this.lookahead(0)===pt.TOK_NUMBER||this.lookahead(0)===pt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===pt.TOK_STAR&&this.lookahead(1)===pt.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(Zl.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case pt.TOK_CURRENT:return{type:pt.TOK_CURRENT};case pt.TOK_ROOT:return{type:pt.TOK_ROOT};case pt.TOK_EXPREF:return i=this.expression(Zl.Expref),{type:"ExpressionReference",children:[i]};case pt.TOK_LPAREN:const a=[];for(;this.lookahead(0)!==pt.TOK_RPAREN;)this.lookahead(0)===pt.TOK_CURRENT?(i={type:pt.TOK_CURRENT},this.advance()):i=this.expression(0),a.push(i);return this.match(pt.TOK_RPAREN),a[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case pt.TOK_DOT:const i=Zl.Dot;return this.lookahead(0)!==pt.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case pt.TOK_PIPE:return r=this.expression(Zl.Pipe),{type:pt.TOK_PIPE,children:[n,r]};case pt.TOK_OR:return r=this.expression(Zl.Or),{type:"OrExpression",children:[n,r]};case pt.TOK_AND:return r=this.expression(Zl.And),{type:"AndExpression",children:[n,r]};case pt.TOK_LPAREN:const s=n.name,a=[];let o;for(;this.lookahead(0)!==pt.TOK_RPAREN;)this.lookahead(0)===pt.TOK_CURRENT?(o={type:pt.TOK_CURRENT},this.advance()):o=this.expression(0),this.lookahead(0)===pt.TOK_COMMA&&this.match(pt.TOK_COMMA),a.push(o);return this.match(pt.TOK_RPAREN),{name:s,type:"Function",children:a};case pt.TOK_FILTER:const l=this.expression(0);return this.match(pt.TOK_RBRACKET),r=this.lookahead(0)===pt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Zl.Filter),{type:"FilterProjection",children:[n,r,l]};case pt.TOK_FLATTEN:const u={type:pt.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(Zl.Flatten);return{type:"Projection",children:[u,h]};case pt.TOK_EQ:case pt.TOK_NE:case pt.TOK_GT:case pt.TOK_GTE:case pt.TOK_LT:case pt.TOK_LTE:return this.parseComparator(n,e);case pt.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===pt.TOK_NUMBER||d.type===pt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(pt.TOK_STAR),this.match(pt.TOK_RBRACKET),r=this.parseProjectionRHS(Zl.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===pt.TOK_COLON||this.lookahead(1)===pt.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(pt.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(Zl.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==pt.TOK_RBRACKET&&n<3;){if(r===pt.TOK_COLON)n+=1,this.advance();else if(r===pt.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(pt.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(Zl[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([pt.TOK_UNQUOTEDIDENTIFIER,pt.TOK_QUOTEDIDENTIFIER,pt.TOK_STAR].includes(n))return this.expression(e);if(n===pt.TOK_LBRACKET)return this.match(pt.TOK_LBRACKET),this.parseMultiselectList();if(n===pt.TOK_LBRACE)return this.match(pt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Zl[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===pt.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===pt.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===pt.TOK_DOT)return this.match(pt.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==pt.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===pt.TOK_COMMA&&(this.match(pt.TOK_COMMA),this.lookahead(0)===pt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(pt.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[pt.TOK_UNQUOTEDIDENTIFIER,pt.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(pt.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===pt.TOK_COMMA)this.match(pt.TOK_COMMA);else if(this.lookahead(0)===pt.TOK_RBRACE){this.match(pt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const yVe=new vVe;var $t;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})($t||($t={}));class _Ve{constructor(e){this.TYPE_NAME_TABLE={[$t.TYPE_NUMBER]:"number",[$t.TYPE_ANY]:"any",[$t.TYPE_STRING]:"string",[$t.TYPE_ARRAY]:"array",[$t.TYPE_OBJECT]:"object",[$t.TYPE_BOOLEAN]:"boolean",[$t.TYPE_EXPREF]:"expression",[$t.TYPE_NULL]:"null",[$t.TYPE_ARRAY_NUMBER]:"Array<number>",[$t.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>gC(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],a=n[1];for(let o=0;o<a.length;o+=1)r.push(i.visit(s,a[o]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===$t.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let a=1;a<i.length;a+=1)s.localeCompare(i[a])<0&&(s=i[a]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[$t.TYPE_NUMBER,$t.TYPE_STRING]);let a=-1/0,o,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>a&&(a=c,o=i[l]);return o},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===$t.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let a=1;a<i.length;a+=1)i[a].localeCompare(s)<0&&(s=i[a]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[$t.TYPE_NUMBER,$t.TYPE_STRING]);let a=1/0,o,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<a&&(a=c,o=i[l]);return o},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==$t.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===$t.TYPE_STRING){const s=n;let a="";for(let o=s.length-1;o>=0;o-=1)a+=s[o];return a}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],a=this.getTypeName(i.visit(s,r[0]));if(a!==void 0&&![$t.TYPE_NUMBER,$t.TYPE_STRING].includes(a))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[a]})`);const o=[];for(let c=0;c<r.length;c+=1)o.push([c,r[c]]);o.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==a)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[a]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==a)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[a]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<o.length;c+=1)r[c]=o[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===$t.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===$t.TYPE_NUMBER?n:r===$t.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===$t.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case $t.TYPE_NUMBER:return"number";case $t.TYPE_STRING:return"string";case $t.TYPE_ARRAY:return"array";case $t.TYPE_OBJECT:return"object";case $t.TYPE_BOOLEAN:return"boolean";case $t.TYPE_EXPREF:return"expref";case $t.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[$t.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[$t.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[$t.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[$t.TYPE_STRING,$t.TYPE_ARRAY]},{types:[$t.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[$t.TYPE_STRING]},{types:[$t.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[$t.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[$t.TYPE_STRING]},{types:[$t.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[$t.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[$t.TYPE_STRING,$t.TYPE_ARRAY,$t.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[$t.TYPE_EXPREF]},{types:[$t.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[$t.TYPE_ARRAY_NUMBER,$t.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[$t.TYPE_ARRAY]},{types:[$t.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[$t.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[$t.TYPE_ARRAY_NUMBER,$t.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[$t.TYPE_ARRAY]},{types:[$t.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[$t.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[$t.TYPE_STRING,$t.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[$t.TYPE_ARRAY_STRING,$t.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[$t.TYPE_ARRAY]},{types:[$t.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[$t.TYPE_STRING]},{types:[$t.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[$t.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[$t.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[$t.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[$t.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[$t.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[$t.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let a;this.validateInputSignatures(e,r);const o=r.filter(g=>{var _;return(_=!g.optional)!==null&&_!==void 0?_:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<o,u=n.length>r.length,h=l&&(!c&&o>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw a=r.length>1,new Error(`ArgumentError: ${e}() takes ${h}${o} argument${a&&"s"||""} but received ${n.length}`);let d,f,p;for(let g=0;g<r.length;g+=1){p=!1,d=r[g].types,f=this.getTypeName(n[g]);let _;for(_=0;_<d.length;_+=1)if(f!==void 0&&this.typeMatches(f,d[_],n[g])){p=!0;break}if(!p&&f!==void 0){const v=d.map(E=>this.TYPE_NAME_TABLE[E]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${g+1} to be type (${v}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(e,n,r){if(n===$t.TYPE_ANY)return!0;if(n===$t.TYPE_ARRAY_STRING||n===$t.TYPE_ARRAY_NUMBER||n===$t.TYPE_ARRAY){if(n===$t.TYPE_ARRAY)return e===$t.TYPE_ARRAY;if(e===$t.TYPE_ARRAY){let i;n===$t.TYPE_ARRAY_NUMBER?i=$t.TYPE_NUMBER:n===$t.TYPE_ARRAY_STRING&&(i=$t.TYPE_STRING);for(let s=0;s<r.length;s+=1){const a=this.getTypeName(r[s]);if(a!==void 0&&i!==void 0&&!this.typeMatches(a,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return $t.TYPE_STRING;case"[object Number]":return $t.TYPE_NUMBER;case"[object Array]":return $t.TYPE_ARRAY;case"[object Boolean]":return $t.TYPE_BOOLEAN;case"[object Null]":return $t.TYPE_NULL;case"[object Object]":return e.jmespathType===pt.TOK_EXPREF?$t.TYPE_EXPREF:$t.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const a=r.visit(e,s);if(!n.includes(this.getTypeName(a))){const o=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(a)]}`;throw new Error(o)}return a}}}class bVe{constructor(){this._rootValue=null,this.runtime=new _Ve(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,a,o,c,l,u,h,d,f;switch(e.type){case"Field":return n===null?null:gC(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),d=1;d<e.children.length;d+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...e.children],_=this.computeSliceParams(n.length,g),[v,E,T]=_;if(s=[],T>0)for(d=v;d<E;d+=T)s.push(n[d]);else for(d=v;d>E;d+=T)s.push(n[d]);return s;case"Projection":if(f=this.visit(e.children[0],n),!Array.isArray(f))return null;for(h=[],d=0;d<f.length;d+=1)i=this.visit(e.children[1],f[d]),i!==null&&h.push(i);return h;case"ValueProjection":if(f=this.visit(e.children[0],n),!gC(f))return null;h=[];const x=Object.values(f);for(d=0;d<x.length;d+=1)i=this.visit(e.children[1],x[d]),i!==null&&h.push(i);return h;case"FilterProjection":if(f=this.visit(e.children[0],n),!Array.isArray(f))return null;const N=[],A=[];for(d=0;d<f.length;d+=1)r=this.visit(e.children[2],f[d]),hD(r)||N.push(f[d]);for(let q=0;q<N.length;q+=1)i=this.visit(e.children[1],N[q]),i!==null&&A.push(i);return A;case"Comparator":switch(a=this.visit(e.children[0],n),o=this.visit(e.children[1],n),e.name){case pt.TOK_EQ:s=tU(a,o);break;case pt.TOK_NE:s=!tU(a,o);break;case pt.TOK_GT:s=a>o;break;case pt.TOK_GTE:s=a>=o;break;case pt.TOK_LT:s=a<o;break;case pt.TOK_LTE:s=a<=o;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case pt.TOK_FLATTEN:const I=this.visit(e.children[0],n);if(!Array.isArray(I))return null;let k=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?k=[...k,...i]:k.push(i);return k;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],d=0;d<e.children.length;d+=1)h.push(this.visit(e.children[d],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let L;for(d=0;d<e.children.length;d+=1)L=e.children[d],h[L.name]=this.visit(L.value,n);return h;case"OrExpression":return r=this.visit(e.children[0],n),hD(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return a=this.visit(e.children[0],n),hD(a)?a:this.visit(e.children[1],n);case"NotExpression":return a=this.visit(e.children[0],n),hD(a);case"Literal":return e.value;case pt.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case pt.TOK_CURRENT:return n;case pt.TOK_ROOT:return this._rootValue;case"Function":const U=[];for(let q=0;q<e.children.length;q+=1)U.push(this.visit(e.children[q],n));return this.runtime.callFunction(e.name,U);case"ExpressionReference":const $=e.children[0];return $.jmespathType=pt.TOK_EXPREF,$;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const o=new Error("Invalid slice, step cannot be 0");throw o.name="RuntimeError",o}const a=s<0;return r=r===null?a?e-1:0:this.capSliceRange(e,r,s),i=i===null?a?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const EVe=new bVe;$t.TYPE_ANY;$t.TYPE_ARRAY;$t.TYPE_ARRAY_NUMBER;$t.TYPE_ARRAY_STRING;$t.TYPE_BOOLEAN;$t.TYPE_EXPREF;$t.TYPE_NULL;$t.TYPE_NUMBER;$t.TYPE_OBJECT;$t.TYPE_STRING;function SVe(t,e){const n=yVe.parse(e);return EVe.search(n,t)}const TVe=(t,e)=>{const n=Sw(t.id());if(!ae(n))return 0;const[r,i]=Ot(e,0,[st.NAME,st.NAME]),s=SVe(n.json,r);return t.set(i,s),0},xVe=(t,e)=>{const n=Sw(t.id());if(!ae(n))return 0;const[r,i]=Ot(e,0,[st.NAME]);switch(ar(r)){case"seek":{const[a]=Ot(e,i,[st.NUMBER]);n.cursor=Ei(a,0,n.lines.length-1);break}case"line":n.cursor=Ei(n.cursor+1,0,n.lines.length-1);break;default:{const a=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(a)??[];let l=1;for(let u=i;u<e.length;){const[h,d]=Ot(e,u,[st.NAME]);t.set(h,c[l]??0),++l,u=d}break}}return 0},wVe=s0({get(t,e){const n=lVe(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const r=Sw(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Sw(t.id());switch(e){case"filename":return[!0,r.filename]}break}case"binary":{const r=Sw(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=Ot(e,0,[st.NAME,st.ANY]);return Fpe(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(qs).join(" ");return Fg(Ge,ne.elementfocus,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=qs(n),s=r.map(qs).join(" ");return Fg(Ge,ne.elementfocus,"$175",`!${s};${i}`),0}).command("readline",xVe).command("readjson",TVe).command("readbin",uVe).command("with",(t,e)=>{const[n]=Ot(e,0,[st.NAME]),r=Yf(ne.book,Wn.BOARD,n);if(r.length){const i=Ya(...r);ae(i)&&(ne.board=jc(i),ne.element={x:-1,y:-1})}return 0});function Yee(t,e,n,r,i,s){const a=[];for(let o=s;o<i.length;){const[c,l]=Ot(i,o,[st.ANY]);Lr(c)&&!yT(c)&&!mO(c)&&!eU(c)&&!qg(c)?a.push(...c):a.push(c),o=l}switch(ar(r)){case"get":case"post:json":yDe(Ge,ne.elementfocus,t,e,n,r,a);break}return 0}const CVe=s0().command("fetch",(t,e)=>{const[n,r,i="get",s]=Ot(e,0,[st.NAME,st.NAME,st.MAYBE_STRING]);return Yee(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",a]=Ot(e,0,[st.ANY,st.NAME,st.NAME,st.MAYBE_STRING]);return Yee(n,r,i,s,e,a),0}).command("twitchchat",(t,e)=>{const[n]=Ot(e,0,[st.ANY]);switch(ar(n)){default:gDe(Ge,ne.elementfocus,n);break;case"stop":vDe(Ge,ne.elementfocus);break}return 0}).command("twitchbroadcast",(t,e)=>{const[n]=Ot(e,0,[st.NAME]);switch(ar(n)){default:pDe(Ge,ne.elementfocus,n);break;case"stop":mDe(Ge,ne.elementfocus);break}return 0}),vP={},w1={};function RVe(){return{id:Do(),layers:[],scroll:[],sidebar:[]}}const AVe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),MVe=new Set(["tx","text"]),OVe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Xee={};let NVe=t=>{let e=Xee[t];return ae(e)||(Xee[t]=e=RVe()),e};function pH(t){return NVe(t)}function YW(t){return ae(vP[t])||(vP[t]=[]),vP[t]}function IVe(t,e,n){Object.values(w1).forEach(r=>{if(r[e]!==void 0){const i=Xb(t.id(),e);pn(n)&&ul(i,n),On(n)&&Y5e(i,n)}})}function kVe(t){const e=YW(t);return vP[t]=[],e}function DVe(t,e){YW(t).push(e)}function PVe(t,e,n,r,i=()=>0,s=Vu){const a=[e,n,...r],o=ar(`${a[3]}`),c={...ne};function l(u,h){ae(h)&&h!==i(u)&&(ne.board=c.board,ne.element=c.element,ne.elementfocus=c.elementfocus,s(u,h))}if(AVe.has(o)){const u=`${a[2]}`;w1[e]=w1[e]??{};const h=i(u)??OVe[o];if(w1[e][u]===void 0){const d=Xb(e,u);pn(h)&&W5e(d,h),On(h)&&lpe(d,h),MVe.has(o)?w1[e][u]=K5e(d,f=>{l(u,f)}):w1[e][u]=X5e(d,f=>{l(u,f)})}}YW(t).push(a)}const LVe=s0({set(t,e,n){return IVe(t,e,n),[!1,void 0]},everytick(){const t=kVe(ne.elementid),[e]=t;if(t.length===1&&On(e)){if(ae(ne.element))if(e.trim().length===0){const n=pH(ne.elementid);n.sidebar=[]}else ne.element.tickertext=e,ne.element.tickertime=ne.timestamp}else if(t.length>1)if(ne.elementisplayer){const n=pH(ne.elementid);n.sidebar=t}else{const n=pH(ne.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var o,c;const[n,r]=Ot(e,0,[st.NAME,st.ANY]),[i,s]=WW(n);switch(ar(i)){case"all":for(const l of Object.keys(((o=ne.board)==null?void 0:o.objects)??{}))t.send(ne.elementfocus,l,s,r);break;case"self":t.message({session:Ge.session(),player:ne.elementfocus,id:Do(),sender:t.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((c=ne.board)==null?void 0:c.objects)??{}))l!==t.id()&&t.send(ne.elementfocus,l,s,r);break;default:{const l=Wde(ne.board,[i]);for(let u=0;u<l.length;++u){const h=l[u];ae(h.id)&&t.send(ne.elementfocus,h.id,s,r)}break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(qs).join("");return DVe(ne.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=qs(n);return PVe(ne.elementid,t.id(),i,r,t.get,t.set),0});function Kee(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const a=jh(e,{x:s,y:i});Hd(a)&&Ig(t,e,a,t.timestamp),jd(e,{x:s,y:i})}}function UVe(t,e,n){for(let r=e.y;r<=n.y;++r)for(let i=e.x;i<=n.x;++i)jd(t,{x:i,y:r})}function Jee(t,e,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const a=jh(e,{x:s,y:i});Hd(a)&&Ig(t,e,a,t.timestamp),jd(e,{x:s,y:i})}}function nU(t,e){ae(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.code=e.code,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.stepx=e.stepx,t.stepy=e.stepy,t.pushable=e.pushable,t.collision=e.collision,t.destructible=e.destructible,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function XW(t,e,n,r,i){if(!ae(ne.book))return;const s=ne.book,a=eh(s,Wn.BOARD,t),o=jc(a);if(!ae(o))return;const c=eh(s,Wn.BOARD,e),l=jc(c);if(!ae(l))return;dl(s,o),dl(s,l);let u=!1;if(ae(o)&&ae(l)){switch(i){case"all":Kee(s,l,n,r);break;case"object":Jee(s,l,n,r);break;case"terrain":UVe(l,n,r);break;default:u=!0;break}for(let h=n.y;h<=r.y;++h)for(let d=n.x;d<=r.x;++d){let f=!1,p=!1;switch(i){case"all":f=!0,p=!0;break;case"object":f=!0;break;case"terrain":p=!0;break}const g={x:d,y:h};let _,v=jh(o,g);if(Hd(v)?(_=vB(o,d,h),ob(v==null?void 0:v.id)&&(v=void 0)):(_=v,v=void 0),ae(_)&&(p||u&&oy(s,_)===i)){u&&Kee(s,l,g,g);const E=ET(s,l,[_.kind??""],g);nU(E,_)}if(ae(v)&&(f||u&&oy(s,v)===i)){u&&Jee(s,l,g,g);const E=ET(s,l,[v.kind??""],g);nU(E,v)}}G2(s,l)}}function BVe(t,e,n,r,i){if(!ae(ne.book))return;const s=ne.book,a=eh(s,Wn.BOARD,t),o=jc(a);if(!ae(o))return;const c=J7(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";dl(s,o),dl(s,c);const h=-Math.tan(e*.5),d=Math.sin(e),f=Math.round(12.5*h),p=Math.round(12.5*d),g=new Array(ji).fill(0);$Q(f,0,-f,ji-1).forEach(x=>{x.x<0?g[x.y]=Math.min(g[x.y],x.x):g[x.y]=Math.max(g[x.y],x.x)});const v=new Array(fr).fill(0);$Q(0,p,fr-1,-p).forEach(x=>{x.y<0?v[x.x]=Math.min(v[x.x],x.y):v[x.x]=Math.max(v[x.x],x.y)});const T=[g,v,g];for(let x=0;x<T.length;++x){const N=T[x];if(x!==1){for(let A=0;A<ji;++A){const I=N[A],k=A*fr;for(let L=0;L<fr;L++){const U=(L+I+fr)%fr;u&&(c.terrain[U+k]=o.terrain[L+k])}}if(l){const A=Object.keys(o.objects);for(let I=0;I<A.length;++I){const k=A[I],{x:L,y:U}=o.objects[k];if(ae(L)&&ae(U)){const $=N[U];o.objects[k].x=(L+$+fr)%fr,o.objects[k].lx=o.objects[k].x}}}}if(x===1){for(let A=0;A<fr;++A){const I=N[A];for(let k=0;k<ji;++k){const L=(k+I+ji)%ji;u&&(c.terrain[A+L*fr]=o.terrain[A+k*fr])}}if(l){const A=Object.keys(o.objects);for(let I=0;I<A.length;++I){const k=A[I],{x:L,y:U}=o.objects[k];if(ae(L)&&ae(U)){const $=N[L];o.objects[k].y=(U+$+ji)%ji,o.objects[k].ly=o.objects[k].y}}}}u&&(o.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete o.named,delete o.lookup,dl(s,c),dl(s,o)}}function FVe(t,e){let n=0,r=0,i=0;for(;i<t.length;i++)n+=t[i];for(i=0,e*=n;e&&i<t.length;){if(r+=t[i],e<=r)return i;i++}return 0}var zVe=FVe;const HVe=zVe,Bi=function(){};Bi.prototype.FMX=0;Bi.prototype.FMY=0;Bi.prototype.FMXxFMY=0;Bi.prototype.T=0;Bi.prototype.N=0;Bi.prototype.initiliazedField=!1;Bi.prototype.generationComplete=!1;Bi.prototype.wave=null;Bi.prototype.compatible=null;Bi.prototype.weightLogWeights=null;Bi.prototype.sumOfWeights=0;Bi.prototype.sumOfWeightLogWeights=0;Bi.prototype.startingEntropy=0;Bi.prototype.sumsOfOnes=null;Bi.prototype.sumsOfWeights=null;Bi.prototype.sumsOfWeightLogWeights=null;Bi.prototype.entropies=null;Bi.prototype.propagator=null;Bi.prototype.observed=null;Bi.prototype.distribution=null;Bi.prototype.stack=null;Bi.prototype.stackSize=0;Bi.prototype.DX=[-1,0,1,0];Bi.prototype.DY=[0,1,0,-1];Bi.prototype.opposite=[2,3,0,1];Bi.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let e=0;e<this.T;e++)this.compatible[t][e]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0};Bi.prototype.observe=function(t){let e=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const a=this.sumsOfOnes[s];if(a===0)return!1;const o=this.entropies[s];if(a>1&&o<=e){const c=1e-6*t();o+c<e&&(e=o+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let a=0;a<this.T;a++)if(this.wave[s][a]){this.observed[s]=a;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=HVe(this.distribution,t()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null};Bi.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const e=t[0],n=e%this.FMX,r=e/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],a=this.DY[i];let o=n+s,c=r+a;if(this.onBoundary(o,c))continue;o<0?o+=this.FMX:o>=this.FMX&&(o-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=o+c*this.FMX,u=this.propagator[i][t[1]],h=this.compatible[l];for(let d=0;d<u.length;d++){const f=u[d],p=h[f];p[i]--,p[i]==0&&this.ban(l,f)}}}};Bi.prototype.singleIteration=function(t){const e=this.observe(t);return e!==null?(this.generationComplete=e,!!e):(this.propagate(),null)};Bi.prototype.iterate=function(t,e){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,e=e||Math.random;for(let n=0;n<t||t===0;n++){const r=this.singleIteration(e);if(r!==null)return!!r}return!0};Bi.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const e=this.singleIteration(t);if(e!==null)return!!e}};Bi.prototype.isGenerationComplete=function(){return this.generationComplete};Bi.prototype.ban=function(t,e){const n=this.compatible[t][e];for(let i=0;i<4;i++)n[i]=0;this.wave[t][e]=!1,this.stack[this.stackSize]=[t,e],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[e],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[e];const r=this.sumsOfWeights[t];this.entropies[t]=Math.log(r)-this.sumsOfWeightLogWeights[t]/r};Bi.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let e=0;e<this.T;e++){this.wave[t][e]=!0;for(let n=0;n<4;n++)this.compatible[t][e][n]=this.propagator[this.opposite[n]][e].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var vpe=Bi;const ype=vpe,cy=function(e,n,r,i,s,a,o,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=a,this.FMXxFMY=s*a,this.periodic=c;const h=n,d=new Array(h);for(let L=0;L<h;L++)d[L]=new Array(r);this.colors=[];const f={};for(let L=0;L<r;L++)for(let U=0;U<n;U++){const $=(L*n+U)*4,q=[e[$],e[$+1],e[$+2],e[$+3]],G=q.join("-");f.hasOwnProperty(G)||(f[G]=this.colors.length,this.colors.push(q)),d[U][L]=f[G]}const p=this.colors.length,g=Math.pow(p,i*i),_=function(U){let $=new Array(i*i);for(let q=0;q<i;q++)for(let G=0;G<i;G++)$[G+q*i]=U(G,q);return $},v=function(U,$){return _(function(q,G){return d[(U+q)%n][($+G)%r]})},E=function(U){return _(function($,q){return U[i-1-q+$*i]})},T=function(U){return _(function($,q){return U[i-1-$+q*i]})},x=function(U){let $=0,q=1;for(let G=0;G<U.length;G++)$+=U[U.length-1-G]*q,q*=p;return $},N=function(U){let $=U,q=g;const G=new Array(i*i);for(let X=0;X<G.length;X++){q/=p;let re=0;for(;$>=q;)$-=q,re++;G[X]=re}return G},A={},I=[];for(let L=0;L<(o?r:r-i+1);L++)for(let U=0;U<(o?n:n-i+1);U++){const $=new Array(8);$[0]=v(U,L),$[1]=T($[0]),$[2]=E($[0]),$[3]=T($[2]),$[4]=E($[2]),$[5]=T($[4]),$[6]=E($[4]),$[7]=T($[6]);for(let q=0;q<l;q++){const G=x($[q]);A[G]?A[G]++:(I.push(G),A[G]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let L=0;L<this.T;L++){const U=parseInt(I[L],10);this.patterns[L]=N(U),this.weights[L]=A[U]}const k=function(U,$,q,G){const X=q<0?0:q,re=q<0?q+i:i,V=G<0?0:G,Z=G<0?G+i:i;for(let Y=V;Y<Z;Y++)for(let ee=X;ee<re;ee++)if(U[ee+i*Y]!=$[ee-q+i*(Y-G)])return!1;return!0};this.propagator=new Array(4);for(let L=0;L<4;L++){this.propagator[L]=new Array(this.T);for(let U=0;U<this.T;U++){const $=[];for(let q=0;q<this.T;q++)k(this.patterns[U],this.patterns[q],this.DX[L],this.DY[L])&&$.push(q);this.propagator[L][U]=$}}};cy.prototype=Object.create(ype.prototype);cy.prototype.constructor=cy;cy.prototype.onBoundary=function(t,e){return!this.periodic&&(t+this.N>this.FMX||e+this.N>this.FMY||t<0||e<0)};cy.prototype.clear=function(){if(ype.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let e=0;e<this.T;e++)e!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,e);for(let e=0;e<this.FMY-1;e++)this.ban(t+e*this.FMX,this.ground)}this.propagate()}};cy.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t};cy.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMY;e++){const n=e<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(e*this.FMX+r)*4,a=this.colors[this.patterns[this.observed[r-i+(e-n)*this.FMX]][i+n*this.N]];t[s]=a[0],t[s+1]=a[1],t[s+2]=a[2],t[s+3]=a[3]}}};cy.prototype.graphicsIncomplete=function(t){for(let e=0;e<this.FMXxFMY;e++){const n=e%this.FMX,r=e/this.FMX|0;let i=0,s=0,a=0,o=0,c=0;for(let u=0;u<this.N;u++)for(let h=0;h<this.N;h++){let d=n-h;d<0&&(d+=this.FMX);let f=r-u;if(f<0&&(f+=this.FMY),this.onBoundary(d,f))continue;const p=d+f*this.FMX;for(let g=0;g<this.T;g++)if(this.wave[p][g]){i++;const _=this.colors[this.patterns[g][h+u*this.N]];s+=_[0],a+=_[1],o+=_[2],c+=_[3]}}const l=e*4;t[l]=s/i,t[l+1]=a/i,t[l+2]=o/i,t[l+3]=c/i}};var jVe=cy;const VVe=vpe,Nb=function(e,n,r,i,s){const a=e.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=a;const o=!!e.unique;let c=null;n&&e.subsets&&e.subsets[n]&&(c=e.subsets[n]);const l=function(x){const N=new Array(a*a);for(let A=0;A<a;A++)for(let I=0;I<a;I++)N[I+A*a]=x(I,A);return N},u=function(x){return l(function(N,A){return x[a-1-A+N*a]})},h=function(x){return l(function(N,A){return x[a-1-N+A*a]})};this.tiles=[];const d=[],f=[],p={};let g,_,v;for(let T=0;T<e.tiles.length;T++){const x=e.tiles[T];if(c!==null&&c.indexOf(x.name)===-1)continue;switch(x.symmetry){case"L":v=4,g=function(A){return(A+1)%4},_=function(A){return A%2===0?A+1:A-1};break;case"T":v=4,g=function(A){return(A+1)%4},_=function(A){return A%2===0?A:4-A};break;case"I":v=2,g=function(A){return 1-A},_=function(A){return A};break;case"\\":v=2,g=function(A){return 1-A},_=function(A){return 1-A};break;case"F":v=8,g=function(A){return A<4?(A+1)%4:4+(A-1)%4},_=function(A){return A<4?A+4:A-4};break;default:v=1,g=function(A){return A},_=function(A){return A};break}this.T=f.length,p[x.name]=this.T;for(let A=0;A<v;A++)f.push([this.T+A,this.T+g(A),this.T+g(g(A)),this.T+g(g(g(A))),this.T+_(A),this.T+_(g(A)),this.T+_(g(g(A))),this.T+_(g(g(g(A))))]);let N;if(o)for(let A=0;A<v;A++)N=x.bitmap[A],this.tiles.push(l(function(I,k){return[N[(a*k+I)*4],N[(a*k+I)*4+1],N[(a*k+I)*4+2],N[(a*k+I)*4+3]]}));else{N=x.bitmap,this.tiles.push(l(function(A,I){return[N[(a*I+A)*4],N[(a*I+A)*4+1],N[(a*I+A)*4+2],N[(a*I+A)*4+3]]}));for(let A=1;A<v;A++)this.tiles.push(A<4?u(this.tiles[this.T+A-1]):h(this.tiles[this.T+A-4]))}for(let A=0;A<v;A++)d.push(x.weight||1)}this.T=f.length,this.weights=d,this.propagator=new Array(4);const E=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),E[T]=new Array(this.T);for(let x=0;x<this.T;x++){E[T][x]=new Array(this.T);for(let N=0;N<this.T;N++)E[T][x][N]=!1}}for(let T=0;T<e.neighbors.length;T++){const x=e.neighbors[T],N=x.left.split(" ").filter(function($){return $.length}),A=x.right.split(" ").filter(function($){return $.length});if(c!==null&&(c.indexOf(N[0])===-1||c.indexOf(A[0])===-1))continue;const I=f[p[N[0]]][N.length==1?0:parseInt(N[1],10)],k=f[I][1],L=f[p[A[0]]][A.length==1?0:parseInt(A[1],10)],U=f[L][1];E[0][L][I]=!0,E[0][f[L][6]][f[I][6]]=!0,E[0][f[I][4]][f[L][4]]=!0,E[0][f[I][2]][f[L][2]]=!0,E[1][U][k]=!0,E[1][f[k][6]][f[U][6]]=!0,E[1][f[U][4]][f[k][4]]=!0,E[1][f[k][2]][f[U][2]]=!0}for(let T=0;T<this.T;T++)for(let x=0;x<this.T;x++)E[2][T][x]=E[0][x][T],E[3][T][x]=E[1][x][T];for(let T=0;T<4;T++)for(let x=0;x<this.T;x++){const N=[],A=E[T][x];for(let I=0;I<this.T;I++)A[I]&&N.push(I);this.propagator[T][x]=N}};Nb.prototype=Object.create(VVe.prototype);Nb.prototype.constructor=Nb;Nb.prototype.onBoundary=function(t,e){return!this.periodic&&(t<0||e<0||t>=this.FMX||e>=this.FMY)};Nb.prototype.graphics=function(t,e){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,e),t};Nb.prototype.graphicsComplete=function(t){for(let e=0;e<this.FMX;e++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[e+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const a=(e*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,o=r[s+i*this.tilesize];t[a]=o[0],t[a+1]=o[1],t[a+2]=o[2],t[a+3]=o[3]}}};Nb.prototype.graphicsIncomplete=function(t,e){(!e||e.length!==4)&&(e=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,a=0;for(let c=0;c<this.T;c++)i[c]&&(s++,a+=this.weights[c]);const o=1/a;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(e&&s===this.T)t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];else{let h=0,d=0,f=0,p=0;for(let g=0;g<this.T;g++)if(i[g]){const _=this.tiles[g][l+c*this.tilesize],v=this.weights[g]*o;h+=_[0]*v,d+=_[1]*v,f+=_[2]*v,p+=_[3]*v}t[u]=h,t[u+1]=d,t[u+2]=f,t[u+3]=p}}}};var GVe=Nb,qVe={OverlappingModel:jVe,SimpleTiledModel:GVe};const $Ve=qc(qVe),Zee=5;function WVe(t,e,n,r,i,s,a){if(!ae(ne.book))return!1;const o=ne.book,c=eh(o,Wn.BOARD,t),l=eh(o,Wn.BOARD,e),u=jc(c),h=jc(l);if(!ae(u)||!ae(h))return!1;dl(o,u),dl(o,h);let d=0;const f=new Map,p=new Map;let g=0;const _=32,v=new Uint8Array(K7*4);for(let I=0;I<ji;++I)for(let k=0;k<fr;++k){const L=jh(h,{x:k,y:I}),U=(L==null?void 0:L.char)??0,$=(L==null?void 0:L.color)??_,q=(L==null?void 0:L.bg)??_;v[g++]=U,v[g++]=$,v[g++]=q;const G=Rb(o,L),X=ar((G==null?void 0:G.name)??"empty"),re=f.get(X);pn(re)?v[g++]=re:(f.set(X,d),p.set(d,X),v[g++]=d++)}const E=s.x-i.x+1,T=s.y-i.y+1,x=new $Ve.OverlappingModel(v,fr,ji,n,E,T,!1,!1,r,0);let N=0;for(;N<Zee&&!x.generate();++N);if(N===Zee)return!1;g=0;const A=x.graphics();for(let I=i.y;I<=s.y;++I)for(let k=i.x;k<=s.x;++k){const L={x:k,y:I},U=A[g++],$=A[g++],q=A[g++];switch(d=A[g++],a){case"all":{const Y=jh(u,{x:k,y:I});Hd(Y)&&Ig(o,u,Y,o.timestamp),jd(u,{x:k,y:I});break}case"object":{const Y=jh(u,{x:k,y:I});Hd(Y)&&Ig(o,u,Y,o.timestamp);break}case"terrain":jd(u,{x:k,y:I});break}let G=p.get(d)??"";const X=FN(o,G),re=EB(o,G),V=X??re;switch(a){case"all":break;case"object":ae(re)&&(G="");break;case"terrain":ae(X)&&(G="");break;default:if(oy(o,V)!==a&&(G=""),G){const Y=jh(u,{x:k,y:I});Hd(Y)&&Ig(o,u,Y,o.timestamp),jd(u,{x:k,y:I})}break}const Z=G?ET(o,u,[G],L):void 0;if(!(!ae(Z)||!ae(V))&&(nU(Z,V),U>0&&(Z.char=U),$<_&&(Z.color=$),q<_&&(Z.bg=q),Hd(Z))){const Y=Ya(UN(h,G));ae(Y)&&(jd(u,{...vB(h,Y.x??0,Y.y??0),x:k,y:I}),nU(Z,Y))}}return!0}function _pe(t){return`zss_snapshot_${t}`}function YVe(t,e,n,r){const i=eh(ne.book,Wn.BOARD,t),s=jc(i);if(!ae(s))return;const a=_pe(s.id);sfe(ne.book,a);const o=x_(wc.CONTENT,a,Wn.BOARD),c=jc(o);if(ae(c))return XW(t,c.id,e,n,r),c}function XVe(t,e,n,r){const i=eh(ne.book,Wn.BOARD,t),s=jc(i);if(!ae(s))return;const a=_pe(s.id),o=eh(ne.book,Wn.BOARD,a),c=jc(o);if(ae(c))return XW(c.id,t,e,n,r),c}function KVe(t,e,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return JVe(t,e,i)}if(!ae(ne.book))return;const s=ne.book,a=eh(s,Wn.BOARD,t),o=jc(a);if(!ae(o))return;const c=J7();dl(s,o);for(let l=n.y;l<=r.y;++l)for(let u=n.x;u<=r.x;++u){let h=!1,d=!1;switch(i){case"all":h=!0,d=!0;break;case"object":h=!0;break;case"terrain":d=!0;break}const f=(u+e.x+fr)%fr,p=(l+e.y+ji)%ji;if(h){const g=jh(o,{x:u,y:l});Hd(g)&&ae(g==null?void 0:g.x)&&ae(g==null?void 0:g.y)&&(g.x=f,g.lx=f,g.y=p,g.ly=p)}d&&(c.terrain[f+p*fr]=o.terrain[u+l*fr])}(i==="all"||i==="terrain")&&(o.terrain=[...c.terrain]),G2(s,o)}function JVe(t,e,n){if(!ae(ne.book))return;const r=ne.book,i=eh(r,Wn.BOARD,t),s=jc(i);if(!ae(s))return;dl(r,s);const{objectelements:a,terrainelements:o}=uHe(r,s,n);let c=!1;for(let u=0;u<o.length;++u){const h=o[u],d=Dh(r,h,"collision"),f={x:h.x??-1,y:h.y??-1},p={x:f.x+e.x,y:f.y+e.y};if(D2(p)){const g=jh(s,p),_=oy(r,g),v=Dh(r,g,"collision");Hd(g)&&n!==_?Dh(r,g,"pushable")?c=Tw(r,s,g,p)!==!0:c=!0:iO(d,v)&&n!==_&&(c=!0)}else c=!0}if(c)return;for(let u=0;u<a.length;++u){const h=a[u],d=Dh(r,h,"collision"),f={x:h.x??0,y:h.y??0},p={x:f.x+e.x,y:f.y+e.y};if(D2(p)){const g=jh(s,p),_=oy(r,g),v=Dh(r,g,"collision");Hd(g)&&n!==_?Dh(r,g,"pushable")?c=Tw(r,s,g,p)!==!0:c=!0:iO(d,v)&&n!==_&&(c=!0)}else c=!0}if(c)return;(e.x>0||e.y>0)&&o.reverse();for(let u=0;u<o.length;++u){const h=o[u],d={x:h.x??-1,y:h.y??-1},f={x:d.x+e.x,y:d.y+e.y},p=vB(s,f.x,f.y);ae(h)&&ae(p)&&(jd(s,{...h,x:f.x,y:f.y}),jd(s,{...p,x:d.x,y:d.y}))}G2(r,s);for(let u=0;u<a.length;++u){const h=a[u],d={x:h.x??-1,y:h.y??-1},f={x:d.x+e.x,y:d.y+e.y};if(!Tw(r,s,h,f))break}G2(r,s)}function l1(t,e){let n="all";const r={x:0,y:0},i={x:fr-1,y:ji-1};for(let s=e;s<t.length;){const[a,o]=Ot(t,s,[st.MAYBE_NUMBER_OR_STRING]);if(On(a))n=ar(a),s=o;else if(pn(a)){const[c,l,u,h]=Ot(t,o,[st.NUMBER,st.NUMBER,st.NUMBER]);r.x=Math.min(a,l),r.y=Math.min(c,u),i.x=Math.max(a,l),i.y=Math.max(c,u),s=h}else break}return{targetset:n,pt1:r,pt2:i}}const ZVe=s0().command("snapshot",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const n=l1(e,0);return YVe(ne.board.id,n.pt1,n.pt2,n.targetset),0}).command("revert",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const n=l1(e,0);return XVe(ne.board.id,n.pt1,n.pt2,n.targetset),0}).command("copy",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const[n,r]=Ot(e,0,[st.NAME]),i=Yf(ne.book,Wn.BOARD,n),s=Ya(...i);if(ae(s)){const a=l1(e,r);XW(s.id,ne.board.id,a.pt1,a.pt2,a.targetset)}return 0}).command("remix",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const[n,r,i,s]=Ot(e,0,[st.NAME,st.NUMBER,st.NUMBER]),a=Yf(ne.book,Wn.BOARD,n),o=Ya(...a);if(ae(o)){const c=l1(e,s);WVe(ne.board.id,o.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(t,e)=>{var a,o;if(!ae(ne.book)||!ae(ne.board))return 0;const[n,r]=Ot(e,0,[st.DIR]),i={x:n.x-(((a=ne.element)==null?void 0:a.x)??0),y:n.y-(((o=ne.element)==null?void 0:o.y)??0)},s=l1(e,r);return KVe(ne.board.id,i,s.pt1,s.pt2,s.targetset),0}).command("pivot",(t,e)=>{if(!ae(ne.book)||!ae(ne.board))return 0;const[n,r]=Ot(e,0,[st.NUMBER]),i=l1(e,r);return BVe(ne.board.id,Oue(n),i.pt1,i.pt2,i.targetset),0});var KW=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(KW||{});const QVe={audio:RW,board:mHe,cli:Z5e,display:Q5e,element:oVe,runtime:LVe,lifecycle:cVe,loader:wVe,network:CVe,transform:ZVe},mH=["audio","board","display","network","transform","lifecycle","element"],eGe={0:[],1:["cli",...mH],2:["loader",...mH],3:["runtime",...mH]},tGe={0:new Map,1:new Map,2:new Map,3:new Map};function $N(t){return(eGe[t]??[]).map(n=>QVe[n]).filter(ae)}function nGe(t,e){const n=tGe[t];if(!n.has(e)){let r;const i=$N(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!ae(r));++s);n.set(e,r)}return n.get(e)}function rGe(t,e,n){const r=$N(t);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[a,o]=s.get(e,n);if(a)return[a,o]}}return[!1,void 0]}function iGe(t,e,n,r){const i=$N(t);for(let s=0;s<i.length;++s){const a=i[s];if(a.set!==void 0){const[o]=a.set(e,n,r);if(o)return[o,r]}}return[!1,void 0]}function sGe(t,e){const n=$N(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function Qee(t,e){const n=$N(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var bpe={},Epe={},Spe={};const ete="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Spe.encode=function(t){if(0<=t&&t<ete.length)return ete[t];throw new TypeError("Must be between 0 and 63: "+t)};const aGe=Spe,Tpe=5,xpe=1<<Tpe,oGe=xpe-1,cGe=xpe;function lGe(t){return t<0?(-t<<1)+1:(t<<1)+0}Epe.encode=function(e){let n="",r,i=lGe(e);do r=i&oGe,i>>>=Tpe,i>0&&(r|=cGe),n+=aGe.encode(r);while(i>0);return n};var WN={};(function(t){function e(A,I,k){if(I in A)return A[I];if(arguments.length===3)return k;throw new Error('"'+I+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(A){const I=A.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}t.urlParse=i;function s(A){let I="";return A.scheme&&(I+=A.scheme+":"),I+="//",A.auth&&(I+=A.auth+"@"),A.host&&(I+=A.host),A.port&&(I+=":"+A.port),A.path&&(I+=A.path),I}t.urlGenerate=s;const a=32;function o(A){const I=[];return function(k){for(let U=0;U<I.length;U++)if(I[U].input===k){const $=I[0];return I[0]=I[U],I[U]=$,I[0].result}const L=A(k);return I.unshift({input:k,result:L}),I.length>a&&I.pop(),L}}const c=o(function(I){let k=I;const L=i(I);if(L){if(!L.path)return I;k=L.path}const U=t.isAbsolute(k),$=[];let q=0,G=0;for(;;)if(q=G,G=k.indexOf("/",q),G===-1){$.push(k.slice(q));break}else for($.push(k.slice(q,G));G<k.length&&k[G]==="/";)G++;let X=0;for(G=$.length-1;G>=0;G--){const re=$[G];re==="."?$.splice(G,1):re===".."?X++:X>0&&(re===""?($.splice(G+1,X),X=0):($.splice(G,2),X--))}return k=$.join("/"),k===""&&(k=U?"/":"."),L?(L.path=k,s(L)):k});t.normalize=c;function l(A,I){A===""&&(A="."),I===""&&(I=".");const k=i(I),L=i(A);if(L&&(A=L.path||"/"),k&&!k.scheme)return L&&(k.scheme=L.scheme),s(k);if(k||I.match(r))return I;if(L&&!L.host&&!L.path)return L.host=I,s(L);const U=I.charAt(0)==="/"?I:c(A.replace(/\/+$/,"")+"/"+I);return L?(L.path=U,s(L)):U}t.join=l,t.isAbsolute=function(A){return A.charAt(0)==="/"||n.test(A)};function u(A,I){A===""&&(A="."),A=A.replace(/\/$/,"");let k=0;for(;I.indexOf(A+"/")!==0;){const L=A.lastIndexOf("/");if(L<0||(A=A.slice(0,L),A.match(/^([^\/]+:\/)?\/*$/)))return I;++k}return Array(k+1).join("../")+I.substr(A.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(A){return A}function f(A){return g(A)?"$"+A:A}t.toSetString=h?d:f;function p(A){return g(A)?A.slice(1):A}t.fromSetString=h?d:p;function g(A){if(!A)return!1;const I=A.length;if(I<9||A.charCodeAt(I-1)!==95||A.charCodeAt(I-2)!==95||A.charCodeAt(I-3)!==111||A.charCodeAt(I-4)!==116||A.charCodeAt(I-5)!==111||A.charCodeAt(I-6)!==114||A.charCodeAt(I-7)!==112||A.charCodeAt(I-8)!==95||A.charCodeAt(I-9)!==95)return!1;for(let k=I-10;k>=0;k--)if(A.charCodeAt(k)!==36)return!1;return!0}function _(A,I,k){let L=E(A.source,I.source);return L!==0||(L=A.originalLine-I.originalLine,L!==0)||(L=A.originalColumn-I.originalColumn,L!==0||k)||(L=A.generatedColumn-I.generatedColumn,L!==0)||(L=A.generatedLine-I.generatedLine,L!==0)?L:E(A.name,I.name)}t.compareByOriginalPositions=_;function v(A,I,k){let L=A.generatedLine-I.generatedLine;return L!==0||(L=A.generatedColumn-I.generatedColumn,L!==0||k)||(L=E(A.source,I.source),L!==0)||(L=A.originalLine-I.originalLine,L!==0)||(L=A.originalColumn-I.originalColumn,L!==0)?L:E(A.name,I.name)}t.compareByGeneratedPositionsDeflated=v;function E(A,I){return A===I?0:A===null?1:I===null?-1:A>I?1:-1}function T(A,I){let k=A.generatedLine-I.generatedLine;return k!==0||(k=A.generatedColumn-I.generatedColumn,k!==0)||(k=E(A.source,I.source),k!==0)||(k=A.originalLine-I.originalLine,k!==0)||(k=A.originalColumn-I.originalColumn,k!==0)?k:E(A.name,I.name)}t.compareByGeneratedPositionsInflated=T;function x(A){return JSON.parse(A.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=x;function N(A,I,k){if(I=I||"",A&&(A[A.length-1]!=="/"&&I[0]!=="/"&&(A+="/"),I=A+I),k){const L=i(k);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const U=L.path.lastIndexOf("/");U>=0&&(L.path=L.path.substring(0,U+1))}I=l(s(L),I)}return c(I)}t.computeSourceURL=N})(WN);var JW={};let uGe=class wpe{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new wpe;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};JW.ArraySet=uGe;var Cpe={};const Rpe=WN;function hGe(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||Rpe.compareByGeneratedPositionsInflated(t,e)<=0}let dGe=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){hGe(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(Rpe.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Cpe.MappingList=dGe;const ZR=Epe,tc=WN,dD=JW.ArraySet,fGe=Cpe.MappingList;let Ape=class Mpe{constructor(e){e||(e={}),this._file=tc.getArg(e,"file",null),this._sourceRoot=tc.getArg(e,"sourceRoot",null),this._skipValidation=tc.getArg(e,"skipValidation",!1),this._sources=new dD,this._names=new dD,this._mappings=new fGe,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new Mpe({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=tc.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=tc.relative(n,i)),r._sources.has(s)||r._sources.add(s);const a=e.sourceContentFor(i);a!=null&&r.setSourceContent(i,a)}),r}addMapping(e){const n=tc.getArg(e,"generated"),r=tc.getArg(e,"original",null);let i=tc.getArg(e,"source",null),s=tc.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=tc.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[tc.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[tc.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=tc.relative(s,i));const a=this._mappings.toArray().length>0?new dD:this._sources,o=new dD;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=tc.join(r,c.source)),s!=null&&(c.source=tc.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!a.has(l)&&a.add(l);const u=c.name;u!=null&&!o.has(u)&&o.add(u)},this),this._sources=a,this._names=o,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=tc.join(r,c)),s!=null&&(c=tc.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,a=0,o="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!tc.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=ZR.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=ZR.encode(h-a),a=h,c+=ZR.encode(l.originalLine-1-i),i=l.originalLine-1,c+=ZR.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ZR.encode(u-s),s=u)),o+=c}return o}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=tc.relative(n,r));const i=tc.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};Ape.prototype._version=3;bpe.SourceMapGenerator=Ape;var Ope={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,a,o){const c=Math.floor((r-n)/2)+n,l=a(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,a,o):o==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,a,o):o==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,a){if(i.length===0)return-1;let o=e(-1,i.length,r,i,s,a||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&s(i[o],i[o-1],!0)===0;)--o;return o}})(Ope);var SA={exports:{}};const pGe={},BV=Object.freeze(Object.defineProperty({__proto__:null,default:pGe},Symbol.toStringTag,{value:"Module"})),CT=Xie(BV),mGe=(function(){return typeof window<"u"&&this===window}).call();if(mGe){let t=null;SA.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},SA.exports.initialize=e=>t=e}else{const t=CT,e=CT;SA.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(a,o)=>{if(a){i(a);return}r(o.buffer)})})},SA.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Npe=SA.exports;const gGe=Npe;function vGe(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let QR=null;var yGe=function(){if(QR)return QR;const e=[];return QR=gGe().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,a,o,c,l,u,h,d){const f=new vGe;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=a-1),o&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw QR=null,n}),QR};const rr=WN,gH=Ope,rU=JW.ArraySet,_Ge=Npe,bGe=yGe,ZW=Symbol("smcInternal");class Lo{constructor(e,n){return e==ZW?Promise.resolve(this):SGe(e,n)}static initialize(e){_Ge.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return TGe(e,n)}static async with(e,n,r){const i=await new Lo(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Lo.prototype._version=3;Lo.GENERATED_ORDER=1;Lo.ORIGINAL_ORDER=2;Lo.GREATEST_LOWER_BOUND=1;Lo.LEAST_UPPER_BOUND=2;class YN extends Lo{constructor(e,n){return super(ZW).then(r=>{let i=e;typeof e=="string"&&(i=rr.parseSourceMapInput(e));const s=rr.getArg(i,"version");let a=rr.getArg(i,"sources");const o=rr.getArg(i,"names",[]);let c=rr.getArg(i,"sourceRoot",null);const l=rr.getArg(i,"sourcesContent",null),u=rr.getArg(i,"mappings"),h=rr.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=rr.normalize(c)),a=a.map(String).map(rr.normalize).map(function(d){return c&&rr.isAbsolute(c)&&rr.isAbsolute(d)?rr.relative(c,d):d}),r._names=rU.fromArray(o.map(String),!0),r._sources=rU.fromArray(a,!0),r._absoluteSources=r._sources.toArray().map(function(d){return rr.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,bGe().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=rr.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new YN(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let o=0;o<r;o++)s[o]=e.charCodeAt(o);const a=this._wasm.exports.parse_mappings(i);if(!a){const o=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${o}): `;switch(o){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=a}eachMapping(e,n,r){const i=n||null,s=r||Lo.GENERATED_ORDER,a=this.sourceRoot;this._wasm.withMappingCallback(o=>{o.source!==null&&(o.source=this._sources.at(o.source),o.source=rr.computeSourceURL(a,o.source,this._sourceMapURL),o.name!==null&&(o.name=this._names.at(o.name))),e.call(i,o)},()=>{switch(s){case Lo.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Lo.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=rr.getArg(e,"source");const r=rr.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(a=>{let o=a.lastGeneratedColumn;this._computedColumnSpans&&o===null&&(o=1/0),s.push({line:a.generatedLine,column:a.generatedColumn,lastColumn:o})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:rr.getArg(e,"line"),generatedColumn:rr.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=rr.getArg(e,"bias",Lo.GREATEST_LOWER_BOUND);r==null&&(r=Lo.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=rr.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=rr.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let a=rr.getArg(i,"name",null);return a!==null&&(a=this._names.at(a)),{source:s,line:rr.getArg(i,"originalLine",null),column:rr.getArg(i,"originalColumn",null),name:a}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=rr.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=rr.urlParse(this.sourceRoot))){const a=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(a))return this.sourcesContent[this._sources.indexOf(a)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=rr.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:rr.getArg(e,"line"),originalColumn:rr.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=rr.getArg(e,"bias",Lo.GREATEST_LOWER_BOUND);i==null&&(i=Lo.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(a=>s=a,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let a=s.lastGeneratedColumn;return this._computedColumnSpans&&a===null&&(a=1/0),{line:rr.getArg(s,"generatedLine",null),column:rr.getArg(s,"generatedColumn",null),lastColumn:a}}return{line:null,column:null,lastColumn:null}}}YN.prototype.consumer=Lo;class EGe extends Lo{constructor(e,n){return super(ZW).then(r=>{let i=e;typeof e=="string"&&(i=rr.parseSourceMapInput(e));const s=rr.getArg(i,"version"),a=rr.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new rU,r._names=new rU,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let o={line:-1,column:0};return Promise.all(a.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=rr.getArg(c,"offset"),u=rr.getArg(l,"line"),h=rr.getArg(l,"column");if(u<o.line||u===o.line&&h<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=l,new Lo(rr.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(rr.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(rr.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:rr.getArg(e,"line"),generatedColumn:rr.getArg(e,"column")},r=gH.search(n,this._sections,function(s,a){const o=s.generatedLine-a.generatedOffset.generatedLine;return o||s.generatedColumn-a.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(rr.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const a=this._sections[s],o=[];a.consumer.eachMapping(c=>o.push(c));for(let c=0;c<o.length;c++){const l=o[c];let u=rr.computeSourceURL(a.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(a.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(a.generatedOffset.generatedLine===l.generatedLine?a.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||Lo.GENERATED_ORDER;let a;switch(s){case Lo.GENERATED_ORDER:a=this._generatedMappings;break;case Lo.ORIGINAL_ORDER:a=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const o=this.sourceRoot;a.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=rr.computeSourceURL(o,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,a){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return gH.search(e,n,s,a)}allGeneratedPositionsFor(e){const n=rr.getArg(e,"line"),r={source:rr.getArg(e,"source"),originalLine:n,originalColumn:rr.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",rr.compareByOriginalPositions,gH.LEAST_UPPER_BOUND);if(s>=0){let a=this._originalMappings[s];if(e.column===void 0){const o=a.originalLine;for(;a&&a.originalLine===o;){let c=a.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:rr.getArg(a,"generatedLine",null),column:rr.getArg(a,"generatedColumn",null),lastColumn:c}),a=this._originalMappings[++s]}}else{const o=a.originalColumn;for(;a&&a.originalLine===n&&a.originalColumn==o;){let c=a.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:rr.getArg(a,"generatedLine",null),column:rr.getArg(a,"generatedColumn",null),lastColumn:c}),a=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function SGe(t,e){let n=t;typeof t=="string"&&(n=rr.parseSourceMapInput(t));const r=n.sections!=null?new EGe(n,e):new YN(n,e);return Promise.resolve(r)}function TGe(t,e){return YN.fromSourceMap(t,e)}var Ipe={};const xGe=bpe.SourceMapGenerator,fD=WN,wGe=/(\r?\n)/,CGe=10,u1="$$$isSourceNode$$$";let RGe=class FV{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[u1]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new FV,s=e.split(wGe);let a=0;const o=function(){const f=g(),p=g()||"";return f+p;function g(){return a<s.length?s[a++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,o()),c++,l=0;else{h=s[a]||"";const p=h.substr(0,f.generatedColumn-l);s[a]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(o()),c++;l<f.generatedColumn&&(h=s[a]||"",i.add(h.substr(0,f.generatedColumn)),s[a]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),a<s.length&&(u&&d(u,o()),i.add(s.splice(a).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=fD.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const g=r?fD.join(r,f.source):f.source;i.add(new FV(f.originalLine,f.originalColumn,g,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[u1]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[u1]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[u1]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[u1]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[fD.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][u1]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(fD.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new xGe(e);let i=!1,s=null,a=null,o=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||a!==u.line||o!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,a=u.line,o=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===CGe?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};Ipe.SourceNode=RGe;var AGe=Ipe.SourceNode;let tte=0;const nte=zg,MGe=["Command","lines"];class OGe extends Tze{constructor(){super(efe,{traceInitPerf:zg,skipValidations:!zg,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Qn(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Qn(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(lC)}])}));Qn(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Qn(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Qn(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Qn(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Q7)}));Qn(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(BN)}));Qn(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(_B)}])}));Qn(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Z7)}));Qn(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(eW),this.SUBRULE(this.words),this.CONSUME(tW)}));Qn(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(AS),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Qn(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Qn(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Qn(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Qn(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(z2),this.SUBRULE(this.words)}));Qn(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(pW),this.SUBRULE(this.words)}));Qn(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(H2),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Qn(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nM),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(lC)),this.CONSUME4(AS),this.CONSUME4(j2)}}])}));Qn(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nM),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(AS),this.CONSUME(j2)}}])}));Qn(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(nM),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Qn(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(AS),this.CONSUME(V2),this.CONSUME(H2),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Qn(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(AS),this.CONSUME(V2),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Qn(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(yW),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Qn(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(_W),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Qn(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(bW),this.SUBRULE(this.words)}));Qn(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(EW),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Qn(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(SW)}));Qn(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(TW)}));Qn(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(vW)}));Qn(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Zde)}));Qn(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(P2),this.SUBRULE2(this.and_test)})}));Qn(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(U2),this.SUBRULE2(this.not_test)})}));Qn(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(L2),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Qn(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Qn(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(iW)},{ALT:()=>this.CONSUME(sW)},{ALT:()=>this.CONSUME(aW)},{ALT:()=>this.CONSUME(oW)},{ALT:()=>this.CONSUME(cW)},{ALT:()=>this.CONSUME(lW)}])}));Qn(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(P2),this.SUBRULE2(this.and_test_value)})}));Qn(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(U2),this.SUBRULE2(this.not_test_value)})}));Qn(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(L2),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Qn(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Qn(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(B2)},{ALT:()=>this.CONSUME(F2)}]),this.SUBRULE(this.term)}));Qn(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Qn(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(hW)},{ALT:()=>this.CONSUME(z2)},{ALT:()=>this.CONSUME(dW)},{ALT:()=>this.CONSUME(fW)}]),this.SUBRULE(this.factor)}));Qn(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(B2)},{ALT:()=>this.CONSUME(F2)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Qn(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(uW),this.SUBRULE(this.factor)})}));Qn(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Qn(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(nW)},{ALT:()=>this.CONSUME(vl)},{ALT:()=>this.CONSUME(rW)},{ALT:()=>{this.CONSUME(mW),this.SUBRULE(this.words),this.CONSUME(gW)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=MGe.some(a=>n.includes(a));return this.RULE(n,()=>{const o=(tte++).toString().padStart(3),c=s?"font-weight: bold;":"";if(nte&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${n} ${l.join(" ")}`,c)}r(),nte&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${n} `,c),tte--},i)}}const K1=new OGe;if(Lze){const t=K1.getGAstProductions(),e=Pze(t);console.info(e)}const NGe=K1.getBaseCstVisitorConstructor();var yn=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(yn||{}),SS=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(SS||{}),ag=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(ag||{}),yP=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(yP||{});function IGe(t){return!!(t!=null&&t.tokenType)}function wf(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class kGe extends NGe{constructor(){super();Qn(this,"unique",0);zg&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&IGe(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():ae(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:wf(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:wf(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:wf(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:wf(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:wf(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.command_toast?this.go(n.command_toast):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,wf(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Do(),i=Do();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Do(),i=Do();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,wf(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Do(),i=Do();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Do(),i=Do(),a=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",a),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,a),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Do(),i=Do(),a=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",a),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,a),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Do();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=wf(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}command_toast(n){const i=wf(n.token_command_toast,"").replace("toast","").trim();return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,"toast"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=wf(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=wf(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(wf(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.words)}):[]}}const DGe=new kGe,Fh={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},OB="zss.js";function Pi(t,e){return new AGe(t.startLine??1,t.startColumn??1,OB,e)}function zV(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function vH(t){return`'${zV(t)}'`}function _P(t){if(t.startsWith('"'))return _P(t.replaceAll(/(^"|"$)/g,""));const e=IB(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===s9?`', api.get('${zV(r.image.substring(1))}'), '`:zV(r.image)).join("")}'].join('')`}function h1(t){return t.filter(e=>e!==void 0).map(is)}function rte(t){return Pi(t,"")}function PGe(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function Mc(t,e,n){return Pi(t,[`api.${e}(`,...PGe(n,", "),")"])}function LGe(t){if(t.type===yn.COMPARE&&t.compare.type===yn.COMPARE_ITEM)switch(t.compare.method){case SS.IS_EQ:return Mc(t,"isEq",[is(t.lhs),is(t.rhs)]);case SS.IS_NOT_EQ:return Mc(t,"isNotEq",[is(t.lhs),is(t.rhs)]);case SS.IS_LESS_THAN:return Mc(t,"isLessThan",[is(t.lhs),is(t.rhs)]);case SS.IS_GREATER_THAN:return Mc(t,"isGreaterThan",[is(t.lhs),is(t.rhs)]);case SS.IS_LESS_THAN_OR_EQ:return Mc(t,"isLessThanOrEq",[is(t.lhs),is(t.rhs)]);case SS.IS_GREATER_THAN_OR_EQ:return Mc(t,"isGreaterThanOrEq",[is(t.lhs),is(t.rhs)])}return Pi(t,"")}function oS(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",is(n),")"])}function ite(t,e,n){return t.prepend(`api.${e}(`),t.add([is(n),")"])}function UGe(t,e){if(t.type===yn.OPERATOR_ITEM)switch(t.operator){case ag.PLUS:return oS(e,"opPlus",t.rhs);case ag.MINUS:return oS(e,"opMinus",t.rhs);case ag.POWER:return oS(e,"opPower",t.rhs);case ag.MULTIPLY:return oS(e,"opMultiply",t.rhs);case ag.DIVIDE:return oS(e,"opDivide",t.rhs);case ag.MOD_DIVIDE:return oS(e,"opModDivide",t.rhs);case ag.FLOOR_DIVIDE:return oS(e,"opFloorDivide",t.rhs);case ag.UNI_PLUS:return ite(e,"opUniPlus",t.rhs);case ag.UNI_MINUS:return ite(e,"opUniMinus",t.rhs)}return Pi(t,"")}function BGe(t){if(t.type===yn.OPERATOR){const e=t.lhs?is(t.lhs):Pi(t,"");return t.items.forEach(n=>UGe(n,e)),e}return Pi(t,"")}function pD(t,e){return Pi(t,[Mc(t,"jump",[`${e}`]),"; continue;"])}function gv(t){return Fh.linelookup[t??""]??-1}function HV(t,e){Fh.linelookup[t]=e}function C1(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yn.WHILE:case yn.REPEAT:case yn.FOREACH:case yn.ELSE_IF:i.type===e&&(i.done=n);break;case yn.IF_BLOCK:case yn.IF_CHECK:i.type===e&&(i.skip=n);break;case yn.LINE:C1(i.stmts,e,n);break}}}function kpe(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case yn.WHILE:case yn.REPEAT:case yn.FOREACH:case yn.ELSE_IF:i.type===e&&HV(i.done,n);break;case yn.IF_BLOCK:case yn.IF_CHECK:i.type===e&&HV(i.skip,n);break;case yn.LINE:kpe(i.stmts,e,n);break}}}function is(t){var e;switch(t.type){case yn.PROGRAM:return Pi(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(is).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${OB}`]);case yn.API:return Pi(t,["  ",Mc(t,t.method,h1(t.words)),`;
`]);case yn.LINE:return Pi(t,[`case ${t.lineindex}:
`,...t.stmts.map(is).flat(),`  break;
`]);case yn.MARK:return Pi(t,`  // ${t.comment}
`);case yn.GOTO:{const n=gv(t.id);return Pi(t,["  ",pD(t,n),`
`])}case yn.COUNT:return Pi(t,`${t.index}`);case yn.LITERAL:switch(t.literal){case yP.NUMBER:return Pi(t,`${t.value}`);case yP.STRING:return Pi(t,vH(t.value));case yP.TEMPLATE:return Pi(t,_P(t.value))}return rte(t);case yn.TEXT:return Pi(t,["  ",Mc(t,"text",[_P(t.value)]),`;
`]);case yn.STAT:if(Fh.isfirststat){Fh.isfirststat=!1;const n=t.value.trim().split(" ").map(vH);return Pi(t,["  ",Mc(t,"stat",n),`;
`])}return Pi(t,`  // skipped ${t.value}
`);case yn.LABEL:{const n=ar(t.name),r=t.active?"label":"comment";Fh.labels[n]||(Fh.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Fh.labels[n].push(i),Pi(t,`  // ${i} '${n}' ${r}
`)}case yn.HYPERLINK:return Pi(t,["  ",Mc(t,"hyperlink",[_P(t.text),...h1(t.link)]),`;
`]);case yn.MOVE:{const n=Mc(t,"command",[vH("go"),h1(t.words)].flat());return t.wait?Pi(t,["  if (",n,`) { continue; };
`]):Pi(t,["  ",n,`;
`])}case yn.COMMAND:return Pi(t,["  if (",Mc(t,"command",h1(t.words)),`) { continue; };
`]);case yn.IF:{const n=((e=t.block)==null?void 0:e.type)===yn.IF_BLOCK?t.block:void 0;if(ae(n)){C1([t.check],yn.IF_CHECK,n.skip);const r=Pi(t,is(t.check));return n.lines.forEach(i=>r.add(is(i))),kpe(n.altlines,yn.ELSE_IF,gv(n.done)),n.altlines.forEach(i=>r.add(is(i))),r}return Pi(t,is(t.check))}case yn.IF_CHECK:{const n=gv(t.skip);return n===-1?Pi(t,["  ",Mc(t,t.method,h1(t.words)),`;
`]):Pi(t,["  if (!",Mc(t,t.method,h1(t.words)),") { ",pD(t,n),` }
`])}case yn.ELSE_IF:case yn.ELSE:{const n=Pi(t,"");return t.lines.forEach(r=>n.add(is(r))),n}case yn.WHILE:{const n=gv(t.loop),r=gv(t.done),i=Pi(t,"");return C1(t.lines,yn.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yn.BREAK:s.goto=r;break;case yn.CONTINUE:s.goto=n;break}i.add(is(s))}),i}case yn.REPEAT:{const n=gv(t.loop),r=gv(t.done),i=Pi(t,"");return C1(t.lines,yn.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yn.BREAK:s.goto=r;break;case yn.CONTINUE:s.goto=n;break}i.add(is(s))}),i}case yn.WAITFOR:{const n=Pi(t,"");return C1(t.lines,yn.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(is(r))}),n}case yn.FOREACH:{const n=gv(t.loop),r=gv(t.done),i=Pi(t,"");return C1(t.lines,yn.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case yn.BREAK:s.goto=r;break;case yn.CONTINUE:s.goto=n;break}i.add(is(s))}),i}case yn.BREAK:return Pi(t,["  ",pD(t,t.goto),`
`]);case yn.CONTINUE:return Pi(t,["  ",pD(t,t.goto),`
`]);case yn.OR:return Mc(t,"or",t.items.map(is));case yn.AND:return Mc(t,"and",t.items.map(is));case yn.NOT:return Mc(t,"not",t.items.map(is));case yn.COMPARE:return LGe(t);case yn.OPERATOR:return BGe(t);case yn.EXPR:return Mc(t,"expr",t.words.map(is));default:return console.error("<unsupported node>",t.type,t),rte(t)}}function og(t){if(ae(t))switch(t.type===yn.LINE&&++Fh.lineindex,t.lineindex=Fh.lineindex,t.type){case yn.PROGRAM:t.lines.forEach(og);break;case yn.LINE:t.stmts.forEach(og);break;case yn.MARK:HV(t.id,t.lineindex);break;case yn.IF:og(t.check),og(t.block);break;case yn.IF_BLOCK:t.lines.forEach(og),t.altlines.forEach(og);break;case yn.ELSE_IF:t.lines.forEach(og);break;case yn.ELSE:case yn.WHILE:case yn.REPEAT:case yn.FOREACH:case yn.WAITFOR:t.lines.forEach(og);break;case yn.MOVE:case yn.COMMAND:case yn.IF_CHECK:t.words.forEach(og);break}}function FGe(t){return Fh.labels={},Fh.internal=1,Fh.lineindex=0,Fh.isfirststat=!0,og(t),{...is(t).toStringWithSourceMap({file:`${OB}.map`}),...Fh}}function ste(t){return Lr(t)?t.length>0?1:0:t??0}function zGe(t){return`${t}_chip`}function Dpe(t=""){return`vm:${t??""}`}function HGe(t,e,n){var l,u;const r=zGe(t),i=gO(r);let s;const a=cl(Object.entries(n.labels??{}));(!Lr(i.lb)||i.lb.length!==a.length)&&(i.lb=a,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function o(h,d){ne.words=d;const f=nGe(e,h);return ae(f)?f(c,d):h!=="send"?o("send",[h,...d]):0}const c={halt(){$Ge(r)},id(){return t},set(h,d){const[f,p]=iGe(e,c,h,d);if(f)return p},get(h){const[d,f]=rGe(e,c,h);if(d)return f},tick(h){const d=pn(i.ps)?i.ps:0,f=d%h===0;if(i.ps=d+1,f===!1)return!1;if(c.shouldtick()===!1)return Qee(e,c),!1;i.lc=0,i.ys=0,ne.get=c.get,sGe(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){Hr(Ge,ne.elementfocus,"crash",p.message),i.es=1}return Qee(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return pn(i.lc)?++i.lc>kn.HALT_AT_COUNT:!0},hm(){if(Lr(i.mg)&&Lr(i.lb)){const[h]=i.mg;if(ae(h))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)return p.find(g=>pn(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,d,f,p){Ge.emit(h,`${Dpe(d)}:${f}`,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(Lr(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h){const g=p.findIndex(_=>_>0);g>=0&&(p[g]*=-1)}}},restore(h){if(Lr(i.lb))for(let d=0;d<i.lb.length;++d){const[f,p]=i.lb[d];if(f===h)for(let g=0;g<p.length;g++)p[d]=Math.abs(p[d])}},getcase(){i.ec=pn(i.ec)?i.ec:1;const h=c.hm();if(h&&Lr(i.mg)){const[,d,f,p]=i.mg;c.set("sender",f),ae(d)&&c.set("arg",d),p&&(c.set("player",p),ne.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=pn(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const d=fHe.parse(h),[f]=d.filter(p=>p.fileName===OB);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(h){return o("text",[h])},stat(...h){return o("stat",h)},hyperlink(...h){return o("hyperlink",h)},command(...h){if(h.length===0)return 0;const[d,...f]=h;return o(ar(qs(d)),f)},if(...h){const[d,f]=Ot(h,0,[st.ANY]),p=ste(d);return p&&f<h.length&&c.command(...h.slice(f)),p?1:0},try(...h){const[,d]=Ot(h,0,[st.DIR]),f=c.command("go",...h);return f&&d<h.length&&c.command(...h.slice(d)),f?1:0},take(...h){const[d,f,p]=Ot(h,0,[st.NAME,st.ANY]),g=pn(f),_=g?p:1,v=c.get(d),E=g?f:1;if(!pn(v))return _<h.length&&c.command(...h.slice(_)),1;const T=v-E;return T<0?(_<h.length&&c.command(...h.slice(_)),1):(c.set(d,T),0)},give(...h){const[d,f,p]=Ot(h,0,[st.NAME,st.ANY]),g=pn(f),_=g?p:1,v=c.get(d),E=g?f:1,T=v===void 0?1:0;return T&&_<h.length&&c.command(...h.slice(_)),c.set(d,LS(v,0)+E),T},repeatstart(h,...d){const[f,p]=Ot(d,0,[st.NUMBER]),g=`repeatcount${h}`,_=`repeatwords${h}`;i[g]=f,i[_]=p<d.length?d.slice(p):void 0},repeat(h){const d=`repeatcount${h}`,f=`repeatwords${h}`;if(!pn(i[d]))return 0;const p=i[d];i[d]=p-1;const g=p>0,_=i[f];return g&&Lr(_)&&c.command(..._),g?1:0},foreachstart(h,...d){const[f,p,g,_]=Ot(d,0,[st.NAME,st.NUMBER,st.NUMBER,st.MAYBE_NUMBER]);let v=Math.min(p,g),E=Math.max(p,g);const T=(_??0)||1;if(T<0){const x=v;v=E,E=x}return c.set(f,v-T),0},foreach(h,...d){const[f,p,g,_,v]=Ot(d,0,[st.NAME,st.NUMBER,st.NUMBER,st.MAYBE_NUMBER]);let E=Math.min(p,g),T=Math.max(p,g);const x=(_??0)||1;if(x<0){const I=E;E=T,T=I}let N=c.get(f);!pn(N)||N<E||N>T?N=E:N+=x;const A=N<=T?1:0;return A&&(c.set(f,N),v<d.length&&c.command(...d.slice(v))),A},waitfor(...h){const[d]=Ot(h,0,[st.ANY]),f=ste(d);return f||c.yield(),f?1:0},or(...h){let d=0;for(let f=0;f<h.length;){const[p,g]=Ot(h,f,[st.ANY]);if(d=p,d)break;f=g}return d},and(...h){let d=0;for(let f=0;f<h.length;){const[p,g]=Ot(h,f,[st.ANY]);if(d=p,!d)break;f=g}return d},not(...h){const[d]=Ot(h,0,[st.ANY]);return d?0:1},expr(...h){const[d]=Ot(h,0,[st.ANY]);return d},isEq(h,d){const[f]=Ot([h],0,[st.ANY]),[p]=Ot([d],0,[st.ANY]);return typeof f=="object"||typeof p=="object"?Y1(f,p)?1:0:f===p?1:0},isNotEq(h,d){return this.isEq(h,d)?0:1},isLessThan(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f<p?1:0},isGreaterThan(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f>p?1:0},isLessThanOrEq(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f>=p?1:0},opPlus(h,d){const[f]=Ot([h],0,[st.ANY]),[p]=Ot([d],0,[st.ANY]);return f+p},opMinus(h,d){const[f]=Ot([h],0,[st.ANY]),[p]=Ot([d],0,[st.ANY]);return f-p},opPower(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return Math.pow(f,p)},opMultiply(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f*p},opDivide(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f/p},opModDivide(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return f%p},opFloorDivide(h,d){const[f]=Ot([h],0,[st.NUMBER]),[p]=Ot([d],0,[st.NUMBER]);return Math.floor(f/p)},opUniPlus(h){const[d]=Ot([h],0,[st.NUMBER]);return+d},opUniMinus(h){const[d]=Ot([h],0,[st.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function jV(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Lr(r)?r.forEach(i=>{e.push(jV(i))}):e.push(jV(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function Ppe(t){const e=xW(`${t}
`);if(e.errors.length>0)return e;K1.input=e.tokens;const n=K1.program();if(K1.errors.length>0)return{tokens:e.tokens,errors:K1.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=DGe.go(n);return r?(jV(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const yH=Object.getPrototypeOf(function*(){}).constructor;function jGe(t,e){const n=`compile-${t}`;console.time(n);const r=Ppe(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=FGe(r.ast);if(i.code){Bze&&console.info(i.code);try{return{...r,...i,source:i.code,code:new yH("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new yH("api"," ")}}}return{...r,...i,source:"",code:new yH("api"," ")}}function VGe(){const t={},e={};function n(i,s){const a=t[s];if(a)return a;const o=jGe(i,s);return t[s]=o,o}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return ae(s)?s.isended():!0},halt(i){const s=e[i];return ae(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const a=e[i];ae(a)&&a.set("arg",s)},tick(i,s,a,o,c){var u;let l=e[i];if(!ae(e[i])){const h=n(o,c);if(l=e[i]=HGe(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((v,E)=>[v,E]);p.slice(f-5,f).forEach(([v,E])=>{Hr(Ge,iM(),"build",`$grey${E+1} $grey${v}`)});const[g,_]=p[f]??[];if(On(g)&&ae(_)){const v=(d.column??1)-1,E=v+d.length,T=v<g.length?g:`${g}*`,x=T.substring(0,v),N=T.substring(v,E),A=T.substring(E);Hr(Ge,iM(),"build",`$red${_+1} $grey${x}$red${N}$grey${A}`)}return d.message.split(`
`).forEach(v=>{Hr(Ge,iM(),"build",v)}),!1}}return!!(l!=null&&l.tick(a))},once(i,s,a,o){const c=r.tick(i,s,1,a,o);return r.halt(i)&&c},message(i){const{target:s,path:a}=GT(i.target),o=e[s];if(ae(o)){const c={...i,target:a};o.message(c)}}};return r}new Rt;const Lpe=VGe();var wc=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(wc||{});const pp={halt:!1,session:Do(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function iM(){return pp.operator}function bP(){return[...pp.books.values()]}function GGe(){const[t]=pp.books.values();return t}function Mv(t){const e=ar(t);return pp.books.get(t)??bP().find(n=>n.name===e)}function VV(t,e){ae(Mv(e))&&(pp.software[t]=e)}function J1(t){return Mv(pp.software[t])}function Upe(t){const e=rfe([]);return On(t)&&(e.name=t),Bpe(e),Fg(Ge,pp.operator,`created [book] ${e.name}`),e}function qGe(t){let e=Mv(t);return ae(e)||(e=rfe([]),e.name=t),Bpe(e),Fg(Ge,pp.operator,`created [book] ${e.name}`),e}function Fv(t,e){let n=ae(e)?qGe(e):J1(t);return ae(n)||(ae(n)||(n=GGe()),ae(n)||(n=Upe(e)),ae(n)&&Fg(Ge,pp.operator,`opened [book] ${n.name} for ${t}`)),VV(t,n.id),n}function x_(t,e,n){return CV(Fv(t),n,e)}function gO(t){const e=Fv("main");return SB(e,t)}function ate(){const t=Fv("main");return SB(t,"main")}function $Ge(t){const e=Fv("main");return Q8e(e,t)}function Bpe(t){return pp.books.set(t.id,t),t.id}function WGe(t){const e=Mv(t);e&&pp.books.delete(e.id)}function eA(t,e,n,r){const i=JC(e);On(n.id)&&Ge.emit(t,"vm:touched",[n.id,i,r])}function Tw(t,e,n,r){if(!ae(n==null?void 0:n.id))return!1;const i=CW(t,e,n,r);if(ae(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const a=Yf(t,Wn.BOARD,(e==null?void 0:e.exitwest)??"");if(a.length){const o=Ya(a);X1(t,n.id,o.id,{x:fr-1,y:r.y})}}else if(r.x>=fr){const a=Yf(t,Wn.BOARD,(e==null?void 0:e.exiteast)??"");if(a.length){const o=Ya(a);X1(t,n.id,o.id,{x:0,y:r.y})}}else if(r.y<0){const a=Yf(t,Wn.BOARD,(e==null?void 0:e.exitnorth)??"");if(a.length){const o=Ya(a);X1(t,n.id,o.id,{x:r.x,y:ji-1})}}else if(r.y>=ji){const a=Yf(t,Wn.BOARD,(e==null?void 0:e.exitsouth)??"");if(a.length){const o=Ya(a);X1(t,n.id,o.id,{x:r.x,y:0})}}}else eA("",i,n,"thud");if(n.kind==="player"){const a=ob(i.id);eA(n.id,n,i,a?"bump":"touch")}else if(n.collision===bs.ISBULLET){const a=ob(n.party),o=ob(i.id);a!==o?eA(n.party??"",n,i,"shot"):eA("",n,i,"thud")}else eA("",n,i,"bump");const s=Rb(t,i);return i.destructible??(s==null?void 0:s.destructible)?(ae(i==null?void 0:i.id)?Ig(ne.book,ne.board,i,ne.timestamp):jd(e,{x:r.x,y:r.y}),!0):!1}return!0}function YGe(t,e,n,r,i=Yze){var h;if(!ae(t)||!ae(e)||!ae(n))return;const s={...ne};ne.book=t,ne.board=e,ne.element=n,ne.elementid=n.id??"",ne.elementisplayer=ob(ne.elementid);const a=ne.element.player??pp.operator;ne.elementfocus=ne.elementisplayer?ne.elementid:a;const o=Rb(t,n),c=n.cycle??(o==null?void 0:o.cycle)??i,l=n.id??"",u=ar(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Lpe.tick(l,KW.RUNTIME,pn(c)?c:i,u,r),pn(n==null?void 0:n.tickertime)&&ne.timestamp-n.tickertime>G7*5&&(n.tickertime=0,n.tickertext=""),ne.elementisplayer){const d=gO(ne.elementid);pn(d.inputcurrent)&&(d.inputcurrent=0)}X3(s).forEach(d=>{ne[d]=s[d]})}function Fpe(t,e){const n=J1("main");if(!ae(n))return;function r(o,c){for(let l=0;l<o.length;++l){const u=o[l];if(ae(u.id)){const h=`${Dpe(u.id)}:${c}`;Ge.emit("",h,e)}}}const{target:i,path:s}=GT(t),a=iHe(n);for(let o=0;o<a.length;++o){const c=a[o];switch(ar(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(Wde(c,[i]),s);break}}}}function iU(t){var a;const e=Fv("main"),n=KS(e,t);if(!ae(e)||!ae(n)||!ae(ne.element))return;const r=`${t}_run`,i=ar(ne.element.name??((a=ne.element.kinddata)==null?void 0:a.name)??""),s=(n==null?void 0:n.code)??"";Lpe.once(r,KW.RUNTIME,i,s)}function d1(t,e=0){const n=[];let r=t;for(;r<ne.words.length;){const[i,s]=Ih(r);if(Lr(i)&&!yT(i)&&!mO(i)&&!eU(i)&&!qg(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),e>0&&n.length>=e)return[n,r]}return[n,r]}function Ih(t){var r,i,s,a,o,c,l,u,h;const e=ne.words[t],n=t+1;if(ppe(e)){const[d,f]=eVe(t);if(ae(d))return[d,f]}if(tVe(e)){const[d,f]=nVe(t);if(ae(d))return[d,f]}if(QW(e)){const[d,f]=e9(t);if(ae(d))return[d,f]}if(On(e)&&ar(e)==="rnd"){const[d,f]=Ih(n),[p,g]=Ih(f);return pn(d)&&pn(p)?[Hf(d,p),g]:pn(d)?[Hf(0,d),f]:[Hf(0,1),n]}if(q7(e)){const[d,f]=Mde(t);if(ae(d))return[d,f]}if(!ae(e))return[void 0,t];if(pn(e)||Lr(e))return[e,n];if(On(e)){const d=ar(e),f=(r=ne.get)==null?void 0:r.call(ne,e);if(ae(f))return[f,n];switch(d){case"aligned":case"alligned":{const p=sO(ne.board,{x:((i=ne.element)==null?void 0:i.x)??-1,y:((s=ne.element)==null?void 0:s.y)??-1},ne.elementfocus);return!ae(ne.element)||!ae(p)?[0,n]:[ne.element.x===p.x||ne.element.y===p.y?1:0,n]}case"contact":{const p=sO(ne.board,{x:((a=ne.element)==null?void 0:a.x)??-1,y:((o=ne.element)==null?void 0:o.y)??-1},ne.elementfocus);if(!ae(ne.element)||!ae(p))return[0,n];const g=(p.x??0)-(((c=ne.element)==null?void 0:c.x)??0),_=(p.y??0)-(((l=ne.element)==null?void 0:l.y)??0);return[g===0&&Math.abs(_)<2||_===0&&Math.abs(g)<2?1:0,n]}case"blocked":{const[p,g]=Ot(ne.words,n,[st.DIR]);return[lHe(ne.book,ne.board,ne.element,p)?1:0,g]}case"any":{const[p,g]=Ot(ne.words,n,[st.KIND]);return[$de(ne.board,p).length?1:0,g]}case"rnd":return[Hf(0,1),n];case"abs":{const[p,g]=Ot(ne.words,n,[st.NUMBER]);return[Math.abs(p),g]}case"ceil":{const[p,g]=Ot(ne.words,n,[st.NUMBER]);return[Math.ceil(p),g]}case"floor":{const[p,g]=Ot(ne.words,n,[st.NUMBER]);return[Math.floor(p),g]}case"round":{const[p,g]=Ot(ne.words,n,[st.NUMBER]);return[Math.round(p),g]}case"clamp":{const[p,g,_,v]=Ot(ne.words,n,[st.NUMBER,st.NUMBER,st.NUMBER]);return[Ei(p,g,_),v]}case"min":{const[p,g]=d1(n);return[Math.min(...p),g]}case"max":{const[p,g]=d1(n);return[Math.max(...p),g]}case"pick":{const[p,g]=d1(n);return[Ya(p),g]}case"pickwith":{const[p,g]=Ot(ne.words,n,[st.NUMBER_OR_STRING]),[_,v]=d1(g);return[Cde(`${p}`,_),v]}case"random":{const[p,g]=d1(n,2),[_,v]=p;return[Hf(_,v??0),g]}case"randomwith":{const[p,g]=Ot(ne.words,n,[st.NUMBER_OR_STRING]),[_,v]=d1(g,2),[E,T]=_;return[Iue(`${p}`,E,T??0),v]}case"run":{const[p,g]=Ot(ne.words,n,[st.NAME]);return iU(p),[(u=ne.get)==null?void 0:u.call(ne,"arg"),g]}case"runwith":{const[p,g,_]=Ot(ne.words,n,[st.ANY,st.NAME]);return ae(ne.element)&&(ne.element.arg=p),iU(g),[(h=ne.get)==null?void 0:h.call(ne,"arg"),_]}}}return[e,n]}const ne={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var st=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.MAYBE_KIND=7]="MAYBE_KIND",t[t.MAYBE_NAME=8]="MAYBE_NAME",t[t.MAYBE_NUMBER=9]="MAYBE_NUMBER",t[t.MAYBE_STRING=10]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",t[t.ANY=12]="ANY",t))(st||{});function Ql(t,e,n){throw console.info(n,ne.element,ne.elementid,ne.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function ote(t){var r,i;const e={x:((r=ne.element)==null?void 0:r.x)??0,y:((i=ne.element)==null?void 0:i.y)??0};return ae(ne.board)&&ae(ne.element)?cfe(ne.book,ne.board,ne.element,ne.elementfocus,t,e):e}function Ot(t,e,n){const r=ne.words;ne.words=t;const i=[];let s=e;for(let a=0;a<n.length;++a)switch(n[a]){case 1:{const[o,c]=YQ(s);cC(o)?(s=c,i.push(o)):Ql("kind",o,t);break}case 0:{if(QW(t[0])===void 0){const[o,c]=Ih(s);qg(o)?(s=c,i.push(o)):Ql("color",o,t)}else{const[o,c]=e9(s);qg(o)?(s=c,i.push(o)):Ql("color",o,t)}break}case 2:{if(q7(t[0])===void 0){const[o,c]=Ih(s);yT(o)?(s=c,i.push(ote(o))):Ql("direction",o,t)}else{const[o,c]=Mde(s);yT(o)?(s=c,i.push(ote(o))):Ql("direction",o,t)}break}case 3:{const o=ne.words[s];On(o)||Ql("string",o,t),++s,i.push(o);break}case 4:{const[o,c]=Ih(s);if(On(o)){const l=parseFloat(o);pn(l)?i.push(l):Ql("number",o,t)}else pn(o)?i.push(o):Ql("number",o,t);s=c;break}case 5:{const[o,c]=Ih(s);On(o)||Ql("string",o,t),s=c,i.push(o);break}case 6:{const[o,c]=Ih(s);let l=o;if(On(l)){const u=parseFloat(l);pn(u)&&(l=u)}else pn(l)||Ql("number or string",l,t);s=c,i.push(l);break}case 7:{const[o,c]=YQ(s);o!==void 0&&!cC(o)&&Ql("optional kind",o,t),s=c,i.push(o);break}case 8:{const o=ne.words[s];o!==void 0&&!On(o)&&Ql("optional string",o,t),++s,i.push(o);break}case 9:{const[o,c]=Ih(s);if(On(o)){const l=parseFloat(o);pn(l)?i.push(l):Ql("optional number",o,t)}else pn(o)||o===void 0?i.push(o):Ql("optional number",o,t);s=c;break}case 10:{const[o,c]=Ih(s);o!==void 0&&!On(o)&&Ql("optional string",o,t),s=c,i.push(o);break}case 11:{const[o,c]=Ih(s);let l=o;if(On(l)){const u=parseFloat(l);pn(u)&&(l=u)}else l!==void 0&&!pn(l)&&Ql("number or string",l,t);s=c,i.push(l);break}case 12:{const[o,c]=Ih(s);s=c,i.push(o);break}}return ne.words=r,[...i,s]}function XGe(t){return ae(t)&&t<Qt.ONBLACK?t:void 0}function KGe(t){return ae(t)&&t>Qt.WHITE&&t<Qt.ONCLEAR?t-Qt.ONBLACK:void 0}const NB={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function qg(t){return Lr(t)&&zpe(t[0])}function cte(t){return qg(t)&&t[0].startsWith("ON")}function zpe(t){return ae(Qt[t])&&On(t)}function QW(t){if(On(t))return NB[ar(t)]}function JGe(t){return t.map(e=>Qt[e]).find(e=>ae(e)&&e<Qt.ONBLACK)}function ZGe(t){return t.map(e=>Qt[e]).find(e=>ae(e)&&e>=Qt.ONBLACK)}function QGe(t){if(qg(t))return t;if(zpe(t))return[t];const e=QW(t);if(ae(e))return[e]}function lte(t){const e=ne.words[t],n=QGe(e);return qg(n)?[n,t+1]:[void 0,t]}function e9(t){const e=[];let n=t;const[r,i]=lte(t);if(qg(r)&&(e.push(...r),n=i),qg(e)&&!cte(e)){const[s,a]=lte(i);cte(s)&&(n=a)}return e.length?[e,n]:[void 0,t]}function Hpe(t){const e={};return t.every(n=>{const r=Qt[n];ae(r)&&(r<Qt.ONBLACK?e.color=r:e.bg=r-Qt.ONBLACK)}),e}const eqe=V7(32,126).map(t=>String.fromCharCode(t)),tqe=Qd({name:"Whitespace",pattern:/ +/}),nqe=Qd({name:"WhitespaceSkipped",pattern:/ +/,group:Uc.SKIPPED}),t9=Qd({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),n9=Qd({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:eqe}),r9=Qd({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),i9=Qd({name:"EscapedDollar",pattern:"$$"}),s9=Qd({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),a9=Qd({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),o9=Qd({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function rqe(t,e=""){return Qd({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const iqe=Object.keys(NB),jpe=iqe.map(t=>rqe(`\\$(${t})`,t)),sqe=[tqe,t9,...jpe,r9,n9,a9,i9,o9,s9],aqe=new Uc(sqe,{skipValidations:!zg,ensureOptimizations:zg}),oqe=new Uc([nqe,t9,...jpe,r9,n9,a9,i9,o9,s9],{skipValidations:!zg,ensureOptimizations:zg});function IB(t,e=!1){return e?oqe.tokenize(t):aqe.tokenize(t)}function eE(t,e,n,r,i,s,a,o){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:a,bottomedge:o},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:a,bottomedge:o},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function kB(t){t.active={...t.reset}}function c9(t,e){const n=e.y;function r(){++e.x;const o=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>o&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(o){for(let c=0;c<o.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=o.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let o=0;o<t.length;++o){const c=t[o];switch(c.tokenType){case i9:s("$");break;case a9:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case r9:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case t9:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=NB[l],h=XGe(Qt[u]),d=KGe(Qt[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):ae(h)?e.active.color=h:ae(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const a=e.active.leftedge??0;if(ae(e.writefullwidth)&&(e.x>a||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){kB(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;vO(u,u+l.length,e.active.color,e.active.bg,e),DB(u,l,e)}}}function ir(t,e,n){const r=IB(t);r.tokens&&(c9(r.tokens,e),n&&kB(e),e.changed())}function XN(t,e,n){const r=IB(t);if(!r.tokens)return;const i=eE(e,n,Qt.WHITE,Qt.BLACK);return i.measureonly=!0,c9(r.tokens,i),i.x>0&&++i.y,i}function DB(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function vO(t,e,n,r,i){const s=Math.min(t,e),a=Math.max(t,e);for(let o=s;o<=a;++o)i.color[o]=n,i.bg[o]=r;i.changed()}function eg(t,e,n,r,i,s,a){const o=Math.min(n,r),c=Math.max(n,r);if(o>e||c<0)return;const l=Math.max(0,o),u=Math.min(e,c);vO(t+l,t+u,i,s,a)}function Vpe(t,e,n){const r=PN(n9,t,0,0,0,0,0,0);c9([r],e),n&&kB(e),e.changed()}function cqe(t,e,n,r,i){i.active.topedge=t,i.active.leftedge=e,i.active.rightedge=n,i.active.bottomedge=r}function pm(t){const e=t.reset.leftedge??0,n=t.reset.rightedge??t.width-1,r=t.reset.topedge??0,i=t.reset.bottomedge??t.height-1,s=n-e+1,a=i-r+1;return{left:e,right:n,top:r,bottom:i,width:s,height:a}}function yO(t,e=16){return t?V7(e-1).map(n=>{const r=n*fT;return new _n(t.bits[r]/63,t.bits[r+1]/63,t.bits[r+2]/63)}):[]}function lqe(t){return t.generateMipmaps=!1,t.minFilter=Ja,t.magFilter=Ja,t.needsUpdate=!0,t}function xw(t){if(ae(t))return lqe(new cae(uLe(t)))}const O_=Be.createContext(eE(1,1,15,1));function mm(){return Be.useContext(O_)}const Gpe=Yb(()=>({blink:!1}));setInterval(()=>{Gpe.setState(t=>({blink:!t.blink}))},333);function ef(){return Gpe(t=>t.blink)}function qpe(){return p7(t=>{function e(){t(n=>({render:n.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function uqe(t){t.fill(0)}function _H(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return-1;t[r+i*e]=s}const $pe=Be.createContext(qpe());function hqe(t,e,n){const[r]=Be.useState(()=>qpe()),i=t*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(n),s.render=0),r}function Wpe(){return p7(t=>{function e(){t(n=>({render:n.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function Ype(t,e,n,r){t.char.fill(e),t.color.fill(n),t.bg.fill(r)}function ko(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return;const a=r+i*e;X3(s).forEach(o=>{const c=s[o];ae(c)&&(t[o][a]=c)})}const l9=Be.createContext(Wpe());function KN(t,e,n,r,i){const[s]=Be.useState(()=>Wpe()),a=t*e,o=s.getState();return o.char.length!==a&&(o.width=t,o.height=e,o.char=new Array(a).fill(n),o.color=new Array(a).fill(r),o.bg=new Array(a).fill(i),o.render=0),s}function Xpe(){return Be.useContext(l9).getState()}const ute=YC(RN),hte=XC(CN),Wv=Yb(t=>({palette:ute,charset:hte,screen:{},palettedata:yO(ute),charsetdata:xw(hte),setpalette(e){t(n=>Y1(n.palette,e)?n:{...n,palette:e,palettedata:yO(e)})},setcharset(e){t(n=>Y1(n.charset,e)?n:{...n,charset:e,charsetdata:xw(e)})},setaltcharset(e){t(n=>Y1(n.altcharset,e)?n:{...n,altcharset:e,altcharsetdata:xw(e)})},setscreen(e,n){t(r=>Y1(r.screen,n)?r:{...r,screen:{...r.screen,[e]:n}})}})),Vh=Yb(()=>({insetcols:20,insetrows:20,islowrez:!1,islandscape:!0,sidebaropen:!0,showkeyboard:!1,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1}));function qu(t,e,n){function r(i){Hr(t,e,"crash",i.message)}n().catch(r)}function mi(t,e,n){return t.namespaceURI&&t.namespaceURI!=="http://www.w3.org/1999/xhtml"||(e=Array.isArray(e)?e:[e],!e.includes(t.tagName.toLowerCase()))?!1:n?Object.entries(n).every(([r,i])=>t[r]===i):!0}function mp(t){var e;if(dqe(t)&&t.defaultView)return t.defaultView;if(!((e=t.ownerDocument)===null||e===void 0)&&e.defaultView)return t.ownerDocument.defaultView;throw new Error(`Could not determine window of node. Node was ${fqe(t)}`)}function dqe(t){return t.nodeType===9}function fqe(t){return typeof t=="function"?`function ${t.name}`:t===null?"null":String(t)}function Kpe(t,e){return new Promise((n,r)=>{const i=new e;i.onerror=r,i.onabort=r,i.onload=()=>{n(String(i.result))},i.readAsText(t)})}function u9(t,e){const n={...e,length:e.length,item:r=>n[r],[Symbol.iterator]:function*(){for(let i=0;i<n.length;i++)yield n[i]}};return n.constructor=t.FileList,t.FileList&&Object.setPrototypeOf(n,t.FileList.prototype),Object.freeze(n),n}function Z_(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Jpe{getAsFile(){return this.file}getAsString(e){typeof this.data=="string"&&e(this.data)}webkitGetAsEntry(){throw new Error("not implemented")}constructor(e,n){Z_(this,"kind",void 0),Z_(this,"type",void 0),Z_(this,"file",null),Z_(this,"data",void 0),typeof e=="string"?(this.kind="string",this.type=String(n),this.data=e):(this.kind="file",this.type=e.type,this.file=e)}}class pqe extends Array{add(...e){const n=new Jpe(e[0],e[1]);return this.push(n),n}clear(){this.splice(0,this.length)}remove(e){this.splice(e,1)}}function mD(t,e){const[n,r]=t.split("/"),i=!r||r==="*";return s=>e?s.type===(i?n:t):i?s.type.startsWith(`${n}/`):s.type===n}function mqe(t){return new class{getData(n){var r;const i=(r=this.items.find(mD(n,!0)))!==null&&r!==void 0?r:this.items.find(mD(n,!1));let s="";return i==null||i.getAsString(a=>{s=a}),s}setData(n,r){const i=this.items.findIndex(mD(n,!0)),s=new Jpe(r,n);i>=0?this.items.splice(i,1,s):this.items.push(s)}clearData(n){if(n){const r=this.items.findIndex(mD(n,!0));r>=0&&this.items.remove(r)}else this.items.clear()}get types(){const n=[];return this.files.length&&n.push("Files"),this.items.forEach(r=>n.push(r.type)),Object.freeze(n),n}setDragImage(){}constructor(){Z_(this,"dropEffect","none"),Z_(this,"effectAllowed","uninitialized"),Z_(this,"items",new pqe),Z_(this,"files",u9(t,[]))}}}function h9(t,e=[]){const n=typeof t.DataTransfer>"u"?mqe(t):new t.DataTransfer;return Object.defineProperty(n,"files",{get:()=>u9(t,e)}),n}async function gqe(t,e){return e.kind==="file"?e.getAsFile():new t.Blob([await new Promise(n=>e.getAsString(n))],{type:e.type})}function Zpe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qpe(t,...e){const n=Object.fromEntries(e.map(r=>[typeof r=="string"?"text/plain":r.type,Promise.resolve(r)]));return typeof t.ClipboardItem<"u"?new t.ClipboardItem(n):new class{get types(){return Array.from(Object.keys(this.data))}async getType(i){const s=await this.data[i];if(!s)throw new Error(`${i} is not one of the available MIME types on this item.`);return s instanceof t.Blob?s:new t.Blob([s],{type:i})}constructor(i){Zpe(this,"data",void 0),this.data=i}}(n)}const vC=Symbol("Manage ClipboardSub");function dte(t,e){return Object.assign(new class extends t.EventTarget{async read(){return Array.from(this.items)}async readText(){let r="";for(const i of this.items){const s=i.types.includes("text/plain")?"text/plain":i.types.find(a=>a.startsWith("text/"));s&&(r+=await i.getType(s).then(a=>Kpe(a,t.FileReader)))}return r}async write(r){this.items=r}async writeText(r){this.items=[Qpe(t,r)]}constructor(...r){super(...r),Zpe(this,"items",[])}},{[vC]:e})}function d9(t){return!!(t!=null&&t[vC])}function vqe(t){if(d9(t.navigator.clipboard))return t.navigator.clipboard[vC];const e=Object.getOwnPropertyDescriptor(t.navigator,"clipboard");let n;const r={resetClipboardStub:()=>{n=dte(t,r)},detachClipboardStub:()=>{e?Object.defineProperty(t.navigator,"clipboard",e):Object.defineProperty(t.navigator,"clipboard",{value:void 0,configurable:!0})}};return n=dte(t,r),Object.defineProperty(t.navigator,"clipboard",{get:()=>n,configurable:!0}),n[vC]}function yqe(t){d9(t.navigator.clipboard)&&t.navigator.clipboard[vC].resetClipboardStub()}function _qe(t){d9(t.navigator.clipboard)&&t.navigator.clipboard[vC].detachClipboardStub()}async function bqe(t){const e=t.defaultView,n=e==null?void 0:e.navigator.clipboard,r=n&&await n.read();if(!r)throw new Error("The Clipboard API is unavailable.");const i=h9(e);for(const s of r)for(const a of s.types)i.setData(a,await s.getType(a).then(o=>Kpe(o,e.FileReader)));return i}async function eme(t,e){const n=mp(t),r=n.navigator.clipboard,i=[];for(let a=0;a<e.items.length;a++){const o=e.items[a],c=await gqe(n,o);i.push(Qpe(n,c))}if(!(r&&await r.write(i).then(()=>!0,()=>!1)))throw new Error("The Clipboard API is unavailable.")}const sU=globalThis;typeof sU.afterEach=="function"&&sU.afterEach(()=>yqe(globalThis.window));typeof sU.afterAll=="function"&&sU.afterAll(()=>_qe(globalThis.window));const tme=["input:not([type=hidden]):not([disabled])","button:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[contenteditable=""]','[contenteditable="true"]',"a[href]","[tabindex]:not([disabled])"].join(", ");function f9(t){return t.matches(tme)}function Eqe(t){return new t.constructor(t.type,t)}function ly(t){for(let n=t;n;n=n.parentElement)if(mi(n,["button","input","select","textarea","optgroup","option"])){if(n.hasAttribute("disabled"))return!0}else if(mi(n,"fieldset")){var e;if(n.hasAttribute("disabled")&&!(!((e=n.querySelector(":scope > legend"))===null||e===void 0)&&e.contains(t)))return!0}else if(n.tagName.includes("-")&&n.constructor.formAssociated&&n.hasAttribute("disabled"))return!0;return!1}function JN(t){const e=t.activeElement;return e!=null&&e.shadowRoot?JN(e.shadowRoot):ly(e)?t.ownerDocument?t.ownerDocument.body:t.body:e}function bH(t){var e;return(e=JN(t))!==null&&e!==void 0?e:t.body}function Sqe(t,e){let n=t;do{if(e(n))return n;n=n.parentElement}while(n&&n!==t.ownerDocument.body)}function RT(t){return t.hasAttribute("contenteditable")&&(t.getAttribute("contenteditable")=="true"||t.getAttribute("contenteditable")=="")}function _O(t){const e=Tqe(t);return e&&(e.closest('[contenteditable=""]')||e.closest('[contenteditable="true"]'))}function Tqe(t){return t.nodeType===1?t:t.parentElement}var nme=function(t){return t.button="button",t.color="color",t.file="file",t.image="image",t.reset="reset",t.submit="submit",t.checkbox="checkbox",t.radio="radio",t}(nme||{});function rme(t){return mi(t,"button")||mi(t,"input")&&t.type in nme}function yC(t){return sme(t)&&!t.readOnly||RT(t)}var ime=function(t){return t.text="text",t.date="date",t["datetime-local"]="datetime-local",t.email="email",t.month="month",t.number="number",t.password="password",t.search="search",t.tel="tel",t.time="time",t.url="url",t.week="week",t}(ime||{});function sme(t){return mi(t,"textarea")||mi(t,"input")&&t.type in ime}function a0(t){return ame(t)&&sme(t)}function xqe(t){return ame(t)&&rme(t)}function ame(t){return t.nodeType===1}function wqe(t){const e=t.ownerDocument.getSelection();if(e!=null&&e.focusNode&&a0(t)){const r=_O(e.focusNode);if(r){if(!e.isCollapsed){var n;const i=((n=r.firstChild)===null||n===void 0?void 0:n.nodeType)===3?r.firstChild:r;e.setBaseAndExtent(i,0,i,0)}}else e.setBaseAndExtent(t,0,t,0)}}var Ib={},p9={exports:{}};p9.exports;(function(t){const n=(s=0)=>a=>`\x1B[${38+s};5;${a}m`,r=(s=0)=>(a,o,c)=>`\x1B[${38+s};2;${a};${o};${c}m`;function i(){const s=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,c]of Object.entries(a)){for(const[l,u]of Object.entries(c))a[l]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},c[l]=a[l],s.set(u[0],u[1]);Object.defineProperty(a,o,{value:c,enumerable:!1})}return Object.defineProperty(a,"codes",{value:s,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=n(),a.color.ansi16m=r(),a.bgColor.ansi256=n(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,c,l)=>o===c&&c===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:l}=c.groups;l.length===3&&(l=l.split("").map(h=>h+h).join(""));const u=Number.parseInt(l,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(t,"exports",{enumerable:!0,get:i})})(p9);var ome=p9.exports,by={};Object.defineProperty(by,"__esModule",{value:!0});by.printIteratorEntries=Rqe;by.printIteratorValues=Aqe;by.printListItems=Mqe;by.printObjectProperties=Oqe;const Cqe=(t,e)=>{const n=Object.keys(t).sort(e);return Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r=>{Object.getOwnPropertyDescriptor(t,r).enumerable&&n.push(r)}),n};function Rqe(t,e,n,r,i,s,a=": "){let o="",c=t.next();if(!c.done){o+=e.spacingOuter;const l=n+e.indent;for(;!c.done;){const u=s(c.value[0],e,l,r,i),h=s(c.value[1],e,l,r,i);o+=l+u+a+h,c=t.next(),c.done?e.min||(o+=","):o+=","+e.spacingInner}o+=e.spacingOuter+n}return o}function Aqe(t,e,n,r,i,s){let a="",o=t.next();if(!o.done){a+=e.spacingOuter;const c=n+e.indent;for(;!o.done;)a+=c+s(o.value,e,c,r,i),o=t.next(),o.done?e.min||(a+=","):a+=","+e.spacingInner;a+=e.spacingOuter+n}return a}function Mqe(t,e,n,r,i,s){let a="";if(t.length){a+=e.spacingOuter;const o=n+e.indent;for(let c=0;c<t.length;c++)a+=o,c in t&&(a+=s(t[c],e,o,r,i)),c<t.length-1?a+=","+e.spacingInner:e.min||(a+=",");a+=e.spacingOuter+n}return a}function Oqe(t,e,n,r,i,s){let a="";const o=Cqe(t,e.compareKeys);if(o.length){a+=e.spacingOuter;const c=n+e.indent;for(let l=0;l<o.length;l++){const u=o[l],h=s(u,e,c,r,i),d=s(t[u],e,c,r,i);a+=c+h+": "+d,l<o.length-1?a+=","+e.spacingInner:e.min||(a+=",")}a+=e.spacingOuter+n}return a}var lb={};Object.defineProperty(lb,"__esModule",{value:!0});lb.test=lb.serialize=lb.default=void 0;var fte=by,aU=function(){return typeof globalThis<"u"?globalThis:typeof aU<"u"?aU:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),EH=aU["jest-symbol-do-not-touch"]||aU.Symbol;const Nqe=typeof EH=="function"&&EH.for?EH.for("jest.asymmetricMatcher"):1267621,gD=" ",cme=(t,e,n,r,i,s)=>{const a=t.toString();return a==="ArrayContaining"||a==="ArrayNotContaining"?++r>e.maxDepth?"["+a+"]":a+gD+"["+(0,fte.printListItems)(t.sample,e,n,r,i,s)+"]":a==="ObjectContaining"||a==="ObjectNotContaining"?++r>e.maxDepth?"["+a+"]":a+gD+"{"+(0,fte.printObjectProperties)(t.sample,e,n,r,i,s)+"}":a==="StringMatching"||a==="StringNotMatching"||a==="StringContaining"||a==="StringNotContaining"?a+gD+s(t.sample,e,n,r,i):t.toAsymmetricMatcher()};lb.serialize=cme;const lme=t=>t&&t.$$typeof===Nqe;lb.test=lme;const Iqe={serialize:cme,test:lme};var kqe=Iqe;lb.default=kqe;var ub={},Dqe=({onlyFirst:t=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,t?void 0:"g")};Object.defineProperty(ub,"__esModule",{value:!0});ub.test=ub.serialize=ub.default=void 0;var ume=hme(Dqe),Zs=hme(ome);function hme(t){return t&&t.__esModule?t:{default:t}}const Pqe=t=>t.replace((0,ume.default)(),e=>{switch(e){case Zs.default.red.close:case Zs.default.green.close:case Zs.default.cyan.close:case Zs.default.gray.close:case Zs.default.white.close:case Zs.default.yellow.close:case Zs.default.bgRed.close:case Zs.default.bgGreen.close:case Zs.default.bgYellow.close:case Zs.default.inverse.close:case Zs.default.dim.close:case Zs.default.bold.close:case Zs.default.reset.open:case Zs.default.reset.close:return"</>";case Zs.default.red.open:return"<red>";case Zs.default.green.open:return"<green>";case Zs.default.cyan.open:return"<cyan>";case Zs.default.gray.open:return"<gray>";case Zs.default.white.open:return"<white>";case Zs.default.yellow.open:return"<yellow>";case Zs.default.bgRed.open:return"<bgRed>";case Zs.default.bgGreen.open:return"<bgGreen>";case Zs.default.bgYellow.open:return"<bgYellow>";case Zs.default.inverse.open:return"<inverse>";case Zs.default.dim.open:return"<dim>";case Zs.default.bold.open:return"<bold>";default:return""}}),dme=t=>typeof t=="string"&&!!t.match((0,ume.default)());ub.test=dme;const fme=(t,e,n,r,i,s)=>s(Pqe(t),e,n,r,i);ub.serialize=fme;const Lqe={serialize:fme,test:dme};var Uqe=Lqe;ub.default=Uqe;var hb={};Object.defineProperty(hb,"__esModule",{value:!0});hb.test=hb.serialize=hb.default=void 0;var pte=by;const Bqe=" ",pme=["DOMStringMap","NamedNodeMap"],Fqe=/^(HTML\w*Collection|NodeList)$/,zqe=t=>pme.indexOf(t)!==-1||Fqe.test(t),mme=t=>t&&t.constructor&&!!t.constructor.name&&zqe(t.constructor.name);hb.test=mme;const Hqe=t=>t.constructor.name==="NamedNodeMap",gme=(t,e,n,r,i,s)=>{const a=t.constructor.name;return++r>e.maxDepth?"["+a+"]":(e.min?"":a+Bqe)+(pme.indexOf(a)!==-1?"{"+(0,pte.printObjectProperties)(Hqe(t)?Array.from(t).reduce((o,c)=>(o[c.name]=c.value,o),{}):{...t},e,n,r,i,s)+"}":"["+(0,pte.printListItems)(Array.from(t),e,n,r,i,s)+"]")};hb.serialize=gme;const jqe={serialize:gme,test:mme};var Vqe=jqe;hb.default=Vqe;var db={},nu={},m9={};Object.defineProperty(m9,"__esModule",{value:!0});m9.default=Gqe;function Gqe(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}Object.defineProperty(nu,"__esModule",{value:!0});nu.printText=nu.printProps=nu.printElementAsLeaf=nu.printElement=nu.printComment=nu.printChildren=void 0;var vme=qqe(m9);function qqe(t){return t&&t.__esModule?t:{default:t}}const $qe=(t,e,n,r,i,s,a)=>{const o=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let h=a(u,n,o,i,s);return typeof u!="string"&&(h.indexOf(`
`)!==-1&&(h=n.spacingOuter+o+h+n.spacingOuter+r),h="{"+h+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+h+c.value.close}).join("")};nu.printProps=$qe;const Wqe=(t,e,n,r,i,s)=>t.map(a=>e.spacingOuter+n+(typeof a=="string"?yme(a,e):s(a,e,n,r,i))).join("");nu.printChildren=Wqe;const yme=(t,e)=>{const n=e.colors.content;return n.open+(0,vme.default)(t)+n.close};nu.printText=yme;const Yqe=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+(0,vme.default)(t)+"-->"+n.close};nu.printComment=Yqe;const Xqe=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close};nu.printElement=Xqe;const Kqe=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" …"+n.open+" />"+n.close};nu.printElementAsLeaf=Kqe;Object.defineProperty(db,"__esModule",{value:!0});db.test=db.serialize=db.default=void 0;var f1=nu;const Jqe=1,_me=3,bme=8,Eme=11,Zqe=/^((HTML|SVG)\w*)?Element$/,Qqe=t=>{try{return typeof t.hasAttribute=="function"&&t.hasAttribute("is")}catch{return!1}},e$e=t=>{const e=t.constructor.name,{nodeType:n,tagName:r}=t,i=typeof r=="string"&&r.includes("-")||Qqe(t);return n===Jqe&&(Zqe.test(e)||i)||n===_me&&e==="Text"||n===bme&&e==="Comment"||n===Eme&&e==="DocumentFragment"},Sme=t=>{var e;return(t==null||(e=t.constructor)===null||e===void 0?void 0:e.name)&&e$e(t)};db.test=Sme;function t$e(t){return t.nodeType===_me}function n$e(t){return t.nodeType===bme}function SH(t){return t.nodeType===Eme}const Tme=(t,e,n,r,i,s)=>{if(t$e(t))return(0,f1.printText)(t.data,e);if(n$e(t))return(0,f1.printComment)(t.data,e);const a=SH(t)?"DocumentFragment":t.tagName.toLowerCase();return++r>e.maxDepth?(0,f1.printElementAsLeaf)(a,e):(0,f1.printElement)(a,(0,f1.printProps)(SH(t)?[]:Array.from(t.attributes).map(o=>o.name).sort(),SH(t)?{}:Array.from(t.attributes).reduce((o,c)=>(o[c.name]=c.value,o),{}),e,n+e.indent,r,i,s),(0,f1.printChildren)(Array.prototype.slice.call(t.childNodes||t.children),e,n+e.indent,r,i,s),e,n)};db.serialize=Tme;const r$e={serialize:Tme,test:Sme};var i$e=r$e;db.default=i$e;var fb={};Object.defineProperty(fb,"__esModule",{value:!0});fb.test=fb.serialize=fb.default=void 0;var bO=by;const s$e="@@__IMMUTABLE_ITERABLE__@@",a$e="@@__IMMUTABLE_LIST__@@",o$e="@@__IMMUTABLE_KEYED__@@",c$e="@@__IMMUTABLE_MAP__@@",mte="@@__IMMUTABLE_ORDERED__@@",l$e="@@__IMMUTABLE_RECORD__@@",u$e="@@__IMMUTABLE_SEQ__@@",h$e="@@__IMMUTABLE_SET__@@",d$e="@@__IMMUTABLE_STACK__@@",_C=t=>"Immutable."+t,PB=t=>"["+t+"]",EO=" ",gte="…",f$e=(t,e,n,r,i,s,a)=>++r>e.maxDepth?PB(_C(a)):_C(a)+EO+"{"+(0,bO.printIteratorEntries)(t.entries(),e,n,r,i,s)+"}";function p$e(t){let e=0;return{next(){if(e<t._keys.length){const n=t._keys[e++];return{done:!1,value:[n,t.get(n)]}}return{done:!0,value:void 0}}}}const m$e=(t,e,n,r,i,s)=>{const a=_C(t._name||"Record");return++r>e.maxDepth?PB(a):a+EO+"{"+(0,bO.printIteratorEntries)(p$e(t),e,n,r,i,s)+"}"},g$e=(t,e,n,r,i,s)=>{const a=_C("Seq");return++r>e.maxDepth?PB(a):t[o$e]?a+EO+"{"+(t._iter||t._object?(0,bO.printIteratorEntries)(t.entries(),e,n,r,i,s):gte)+"}":a+EO+"["+(t._iter||t._array||t._collection||t._iterable?(0,bO.printIteratorValues)(t.values(),e,n,r,i,s):gte)+"]"},TH=(t,e,n,r,i,s,a)=>++r>e.maxDepth?PB(_C(a)):_C(a)+EO+"["+(0,bO.printIteratorValues)(t.values(),e,n,r,i,s)+"]",xme=(t,e,n,r,i,s)=>t[c$e]?f$e(t,e,n,r,i,s,t[mte]?"OrderedMap":"Map"):t[a$e]?TH(t,e,n,r,i,s,"List"):t[h$e]?TH(t,e,n,r,i,s,t[mte]?"OrderedSet":"Set"):t[d$e]?TH(t,e,n,r,i,s,"Stack"):t[u$e]?g$e(t,e,n,r,i,s):m$e(t,e,n,r,i,s);fb.serialize=xme;const wme=t=>t&&(t[s$e]===!0||t[l$e]===!0);fb.test=wme;const v$e={serialize:xme,test:wme};var y$e=v$e;fb.default=y$e;var pb={},Cme={exports:{}},Ys={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LB=60103,UB=60106,ZN=60107,QN=60108,eI=60114,tI=60109,nI=60110,rI=60112,iI=60113,g9=60120,sI=60115,aI=60116,Rme=60121,Ame=60122,Mme=60117,Ome=60129,Nme=60131;if(typeof Symbol=="function"&&Symbol.for){var Rl=Symbol.for;LB=Rl("react.element"),UB=Rl("react.portal"),ZN=Rl("react.fragment"),QN=Rl("react.strict_mode"),eI=Rl("react.profiler"),tI=Rl("react.provider"),nI=Rl("react.context"),rI=Rl("react.forward_ref"),iI=Rl("react.suspense"),g9=Rl("react.suspense_list"),sI=Rl("react.memo"),aI=Rl("react.lazy"),Rme=Rl("react.block"),Ame=Rl("react.server.block"),Mme=Rl("react.fundamental"),Ome=Rl("react.debug_trace_mode"),Nme=Rl("react.legacy_hidden")}function gm(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case LB:switch(t=t.type,t){case ZN:case eI:case QN:case iI:case g9:return t;default:switch(t=t&&t.$$typeof,t){case nI:case rI:case aI:case sI:case tI:return t;default:return e}}case UB:return e}}}var _$e=tI,b$e=LB,E$e=rI,S$e=ZN,T$e=aI,x$e=sI,w$e=UB,C$e=eI,R$e=QN,A$e=iI;Ys.ContextConsumer=nI;Ys.ContextProvider=_$e;Ys.Element=b$e;Ys.ForwardRef=E$e;Ys.Fragment=S$e;Ys.Lazy=T$e;Ys.Memo=x$e;Ys.Portal=w$e;Ys.Profiler=C$e;Ys.StrictMode=R$e;Ys.Suspense=A$e;Ys.isAsyncMode=function(){return!1};Ys.isConcurrentMode=function(){return!1};Ys.isContextConsumer=function(t){return gm(t)===nI};Ys.isContextProvider=function(t){return gm(t)===tI};Ys.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===LB};Ys.isForwardRef=function(t){return gm(t)===rI};Ys.isFragment=function(t){return gm(t)===ZN};Ys.isLazy=function(t){return gm(t)===aI};Ys.isMemo=function(t){return gm(t)===sI};Ys.isPortal=function(t){return gm(t)===UB};Ys.isProfiler=function(t){return gm(t)===eI};Ys.isStrictMode=function(t){return gm(t)===QN};Ys.isSuspense=function(t){return gm(t)===iI};Ys.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===ZN||t===eI||t===Ome||t===QN||t===iI||t===g9||t===Nme||typeof t=="object"&&t!==null&&(t.$$typeof===aI||t.$$typeof===sI||t.$$typeof===tI||t.$$typeof===nI||t.$$typeof===rI||t.$$typeof===Mme||t.$$typeof===Rme||t[0]===Ame)};Ys.typeOf=gm;Cme.exports=Ys;var M$e=Cme.exports;Object.defineProperty(pb,"__esModule",{value:!0});pb.test=pb.serialize=pb.default=void 0;var TS=O$e(M$e),vD=nu;function Ime(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ime=function(r){return r?n:e})(t)}function O$e(t,e){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var n=Ime(e);if(n&&n.has(t))return n.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var a=i?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=t[s]}return r.default=t,n&&n.set(t,r),r}const kme=(t,e=[])=>(Array.isArray(t)?t.forEach(n=>{kme(n,e)}):t!=null&&t!==!1&&e.push(t),e),vte=t=>{const e=t.type;if(typeof e=="string")return e;if(typeof e=="function")return e.displayName||e.name||"Unknown";if(TS.isFragment(t))return"React.Fragment";if(TS.isSuspense(t))return"React.Suspense";if(typeof e=="object"&&e!==null){if(TS.isContextProvider(t))return"Context.Provider";if(TS.isContextConsumer(t))return"Context.Consumer";if(TS.isForwardRef(t)){if(e.displayName)return e.displayName;const n=e.render.displayName||e.render.name||"";return n!==""?"ForwardRef("+n+")":"ForwardRef"}if(TS.isMemo(t)){const n=e.displayName||e.type.displayName||e.type.name||"";return n!==""?"Memo("+n+")":"Memo"}}return"UNDEFINED"},N$e=t=>{const{props:e}=t;return Object.keys(e).filter(n=>n!=="children"&&e[n]!==void 0).sort()},Dme=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,vD.printElementAsLeaf)(vte(t),e):(0,vD.printElement)(vte(t),(0,vD.printProps)(N$e(t),t.props,e,n+e.indent,r,i,s),(0,vD.printChildren)(kme(t.props.children),e,n+e.indent,r,i,s),e,n);pb.serialize=Dme;const Pme=t=>t!=null&&TS.isElement(t);pb.test=Pme;const I$e={serialize:Dme,test:Pme};var k$e=I$e;pb.default=k$e;var mb={};Object.defineProperty(mb,"__esModule",{value:!0});mb.test=mb.serialize=mb.default=void 0;var yD=nu,oU=function(){return typeof globalThis<"u"?globalThis:typeof oU<"u"?oU:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),xH=oU["jest-symbol-do-not-touch"]||oU.Symbol;const D$e=typeof xH=="function"&&xH.for?xH.for("react.test.json"):245830487,P$e=t=>{const{props:e}=t;return e?Object.keys(e).filter(n=>e[n]!==void 0).sort():[]},Lme=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,yD.printElementAsLeaf)(t.type,e):(0,yD.printElement)(t.type,t.props?(0,yD.printProps)(P$e(t),t.props,e,n+e.indent,r,i,s):"",t.children?(0,yD.printChildren)(t.children,e,n+e.indent,r,i,s):"",e,n);mb.serialize=Lme;const Ume=t=>t&&t.$$typeof===D$e;mb.test=Ume;const L$e={serialize:Lme,test:Ume};var U$e=L$e;mb.default=U$e;Object.defineProperty(Ib,"__esModule",{value:!0});Ib.default=Ib.DEFAULT_OPTIONS=void 0;var B$e=Ib.format=Xme,Bme=Ib.plugins=void 0,F$e=tE(ome),tA=by,z$e=tE(lb),H$e=tE(ub),j$e=tE(hb),V$e=tE(db),G$e=tE(fb),q$e=tE(pb),$$e=tE(mb);function tE(t){return t&&t.__esModule?t:{default:t}}const Fme=Object.prototype.toString,W$e=Date.prototype.toISOString,Y$e=Error.prototype.toString,yte=RegExp.prototype.toString,wH=t=>typeof t.constructor=="function"&&t.constructor.name||"Object",X$e=t=>typeof window<"u"&&t===window,K$e=/^Symbol\((.*)\)(.*)$/,J$e=/\n/gi;class zme extends Error{constructor(e,n){super(e),this.stack=n,this.name=this.constructor.name}}function Z$e(t){return t==="[object Array]"||t==="[object ArrayBuffer]"||t==="[object DataView]"||t==="[object Float32Array]"||t==="[object Float64Array]"||t==="[object Int8Array]"||t==="[object Int16Array]"||t==="[object Int32Array]"||t==="[object Uint8Array]"||t==="[object Uint8ClampedArray]"||t==="[object Uint16Array]"||t==="[object Uint32Array]"}function Q$e(t){return Object.is(t,-0)?"-0":String(t)}function e7e(t){return`${t}n`}function _te(t,e){return e?"[Function "+(t.name||"anonymous")+"]":"[Function]"}function bte(t){return String(t).replace(K$e,"Symbol($1)")}function Ete(t){return"["+Y$e.call(t)+"]"}function Hme(t,e,n,r){if(t===!0||t===!1)return""+t;if(t===void 0)return"undefined";if(t===null)return"null";const i=typeof t;if(i==="number")return Q$e(t);if(i==="bigint")return e7e(t);if(i==="string")return r?'"'+t.replace(/"|\\/g,"\\$&")+'"':'"'+t+'"';if(i==="function")return _te(t,e);if(i==="symbol")return bte(t);const s=Fme.call(t);return s==="[object WeakMap]"?"WeakMap {}":s==="[object WeakSet]"?"WeakSet {}":s==="[object Function]"||s==="[object GeneratorFunction]"?_te(t,e):s==="[object Symbol]"?bte(t):s==="[object Date]"?isNaN(+t)?"Date { NaN }":W$e.call(t):s==="[object Error]"?Ete(t):s==="[object RegExp]"?n?yte.call(t).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):yte.call(t):t instanceof Error?Ete(t):null}function jme(t,e,n,r,i,s){if(i.indexOf(t)!==-1)return"[Circular]";i=i.slice(),i.push(t);const a=++r>e.maxDepth,o=e.min;if(e.callToJSON&&!a&&t.toJSON&&typeof t.toJSON=="function"&&!s)return N_(t.toJSON(),e,n,r,i,!0);const c=Fme.call(t);return c==="[object Arguments]"?a?"[Arguments]":(o?"":"Arguments ")+"["+(0,tA.printListItems)(t,e,n,r,i,N_)+"]":Z$e(c)?a?"["+t.constructor.name+"]":(o||!e.printBasicPrototype&&t.constructor.name==="Array"?"":t.constructor.name+" ")+"["+(0,tA.printListItems)(t,e,n,r,i,N_)+"]":c==="[object Map]"?a?"[Map]":"Map {"+(0,tA.printIteratorEntries)(t.entries(),e,n,r,i,N_," => ")+"}":c==="[object Set]"?a?"[Set]":"Set {"+(0,tA.printIteratorValues)(t.values(),e,n,r,i,N_)+"}":a||X$e(t)?"["+wH(t)+"]":(o||!e.printBasicPrototype&&wH(t)==="Object"?"":wH(t)+" ")+"{"+(0,tA.printObjectProperties)(t,e,n,r,i,N_)+"}"}function t7e(t){return t.serialize!=null}function Vme(t,e,n,r,i,s){let a;try{a=t7e(t)?t.serialize(e,n,r,i,s,N_):t.print(e,o=>N_(o,n,r,i,s),o=>{const c=r+n.indent;return c+o.replace(J$e,`
`+c)},{edgeSpacing:n.spacingOuter,min:n.min,spacing:n.spacingInner},n.colors)}catch(o){throw new zme(o.message,o.stack)}if(typeof a!="string")throw new Error(`pretty-format: Plugin must return type "string" but instead returned "${typeof a}".`);return a}function Gme(t,e){for(let n=0;n<t.length;n++)try{if(t[n].test(e))return t[n]}catch(r){throw new zme(r.message,r.stack)}return null}function N_(t,e,n,r,i,s){const a=Gme(e.plugins,t);if(a!==null)return Vme(a,t,e,n,r,i);const o=Hme(t,e.printFunctionName,e.escapeRegex,e.escapeString);return o!==null?o:jme(t,e,n,r,i,s)}const v9={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},qme=Object.keys(v9),Wp={callToJSON:!0,compareKeys:void 0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printBasicPrototype:!0,printFunctionName:!0,theme:v9};Ib.DEFAULT_OPTIONS=Wp;function n7e(t){if(Object.keys(t).forEach(e=>{if(!Wp.hasOwnProperty(e))throw new Error(`pretty-format: Unknown option "${e}".`)}),t.min&&t.indent!==void 0&&t.indent!==0)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(t.theme!==void 0){if(t.theme===null)throw new Error('pretty-format: Option "theme" must not be null.');if(typeof t.theme!="object")throw new Error(`pretty-format: Option "theme" must be of type "object" but instead received "${typeof t.theme}".`)}}const r7e=t=>qme.reduce((e,n)=>{const r=t.theme&&t.theme[n]!==void 0?t.theme[n]:v9[n],i=r&&F$e.default[r];if(i&&typeof i.close=="string"&&typeof i.open=="string")e[n]=i;else throw new Error(`pretty-format: Option "theme" has a key "${n}" whose value "${r}" is undefined in ansi-styles.`);return e},Object.create(null)),i7e=()=>qme.reduce((t,e)=>(t[e]={close:"",open:""},t),Object.create(null)),$me=t=>t&&t.printFunctionName!==void 0?t.printFunctionName:Wp.printFunctionName,Wme=t=>t&&t.escapeRegex!==void 0?t.escapeRegex:Wp.escapeRegex,Yme=t=>t&&t.escapeString!==void 0?t.escapeString:Wp.escapeString,Ste=t=>{var e;return{callToJSON:t&&t.callToJSON!==void 0?t.callToJSON:Wp.callToJSON,colors:t&&t.highlight?r7e(t):i7e(),compareKeys:t&&typeof t.compareKeys=="function"?t.compareKeys:Wp.compareKeys,escapeRegex:Wme(t),escapeString:Yme(t),indent:t&&t.min?"":s7e(t&&t.indent!==void 0?t.indent:Wp.indent),maxDepth:t&&t.maxDepth!==void 0?t.maxDepth:Wp.maxDepth,min:t&&t.min!==void 0?t.min:Wp.min,plugins:t&&t.plugins!==void 0?t.plugins:Wp.plugins,printBasicPrototype:(e=t==null?void 0:t.printBasicPrototype)!==null&&e!==void 0?e:!0,printFunctionName:$me(t),spacingInner:t&&t.min?" ":`
`,spacingOuter:t&&t.min?"":`
`}};function s7e(t){return new Array(t+1).join(" ")}function Xme(t,e){if(e&&(n7e(e),e.plugins)){const r=Gme(e.plugins,t);if(r!==null)return Vme(r,t,Ste(e),"",0,[])}const n=Hme(t,$me(e),Wme(e),Yme(e));return n!==null?n:jme(t,Ste(e),"",0,[])}const a7e={AsymmetricMatcher:z$e.default,ConvertAnsi:H$e.default,DOMCollection:j$e.default,DOMElement:V$e.default,Immutable:G$e.default,ReactElement:q$e.default,ReactTestComponent:$$e.default};Bme=Ib.plugins=a7e;var o7e=Xme;Ib.default=o7e;var c7e=Object.prototype.toString;function l7e(t){return typeof t=="function"||c7e.call(t)==="[object Function]"}function u7e(t){var e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}var h7e=Math.pow(2,53)-1;function d7e(t){var e=u7e(t);return Math.min(Math.max(e,0),h7e)}function Yp(t,e){var n=Array,r=Object(t);if(t==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");for(var i=d7e(r.length),s=l7e(n)?Object(new n(i)):new Array(i),a=0,o;a<i;)o=r[a],s[a]=o,a+=1;return s.length=i,s}function SO(t){"@babel/helpers - typeof";return SO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SO(t)}function f7e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p7e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Kme(r.key),r)}}function m7e(t,e,n){return e&&p7e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function g7e(t,e,n){return e=Kme(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kme(t){var e=v7e(t,"string");return SO(e)==="symbol"?e:String(e)}function v7e(t,e){if(SO(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(SO(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var y7e=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];f7e(this,t),g7e(this,"items",void 0),this.items=e}return m7e(t,[{key:"add",value:function(n){return this.has(n)===!1&&this.items.push(n),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(n){var r=this.items.length;return this.items=this.items.filter(function(i){return i!==n}),r!==this.items.length}},{key:"forEach",value:function(n){var r=this;this.items.forEach(function(i){n(i,i,r)})}},{key:"has",value:function(n){return this.items.indexOf(n)!==-1}},{key:"size",get:function(){return this.items.length}}]),t}();const _7e=typeof Set>"u"?Set:y7e;function hu(t){var e;return(e=t.localName)!==null&&e!==void 0?e:t.tagName.toLowerCase()}var b7e={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},E7e={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function S7e(t,e){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some(function(n){var r;return t.hasAttribute(n)&&!((r=E7e[e])!==null&&r!==void 0&&r.has(n))})}function Jme(t,e){return S7e(t,e)}function T7e(t){var e=w7e(t);if(e===null||e==="presentation"){var n=x7e(t);if(e!=="presentation"||Jme(t,n||""))return n}return e}function x7e(t){var e=b7e[hu(t)];if(e!==void 0)return e;switch(hu(t)){case"a":case"area":case"link":if(t.hasAttribute("href"))return"link";break;case"img":return t.getAttribute("alt")===""&&!Jme(t,"img")?"presentation":"img";case"input":{var n=t,r=n.type;switch(r){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return r;case"range":return"slider";case"email":case"tel":case"text":case"url":return t.hasAttribute("list")?"combobox":"textbox";case"search":return t.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}}case"select":return t.hasAttribute("multiple")||t.size>1?"listbox":"combobox"}return null}function w7e(t){var e=t.getAttribute("role");if(e!==null){var n=e.trim().split(" ")[0];if(n.length>0)return n}return null}function Oa(t){return t!==null&&t.nodeType===t.ELEMENT_NODE}function Zme(t){return Oa(t)&&hu(t)==="caption"}function EP(t){return Oa(t)&&hu(t)==="input"}function C7e(t){return Oa(t)&&hu(t)==="optgroup"}function R7e(t){return Oa(t)&&hu(t)==="select"}function A7e(t){return Oa(t)&&hu(t)==="table"}function M7e(t){return Oa(t)&&hu(t)==="textarea"}function O7e(t){var e=t.ownerDocument===null?t:t.ownerDocument,n=e.defaultView;if(n===null)throw new TypeError("no window available");return n}function N7e(t){return Oa(t)&&hu(t)==="fieldset"}function I7e(t){return Oa(t)&&hu(t)==="legend"}function k7e(t){return Oa(t)&&hu(t)==="slot"}function D7e(t){return Oa(t)&&t.ownerSVGElement!==void 0}function P7e(t){return Oa(t)&&hu(t)==="svg"}function L7e(t){return D7e(t)&&hu(t)==="title"}function cU(t,e){if(Oa(t)&&t.hasAttribute(e)){var n=t.getAttribute(e).split(" "),r=t.getRootNode?t.getRootNode():t.ownerDocument;return n.map(function(i){return r.getElementById(i)}).filter(function(i){return i!==null})}return[]}function zv(t,e){return Oa(t)?e.indexOf(T7e(t))!==-1:!1}function U7e(t){return t.trim().replace(/\s\s+/g," ")}function B7e(t,e){if(!Oa(t))return!1;if(t.hasAttribute("hidden")||t.getAttribute("aria-hidden")==="true")return!0;var n=e(t);return n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"}function F7e(t){return zv(t,["button","combobox","listbox","textbox"])||Qme(t,"range")}function Qme(t,e){if(!Oa(t))return!1;switch(e){case"range":return zv(t,["meter","progressbar","scrollbar","slider","spinbutton"]);default:throw new TypeError("No knowledge about abstract role '".concat(e,"'. This is likely a bug :("))}}function Tte(t,e){var n=Yp(t.querySelectorAll(e));return cU(t,"aria-owns").forEach(function(r){n.push.apply(n,Yp(r.querySelectorAll(e)))}),n}function z7e(t){return R7e(t)?t.selectedOptions||Tte(t,"[selected]"):Tte(t,'[aria-selected="true"]')}function H7e(t){return zv(t,["none","presentation"])}function j7e(t){return Zme(t)}function V7e(t){return zv(t,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function G7e(t){return!1}function q7e(t){return EP(t)||M7e(t)?t.value:t.textContent||""}function xte(t){var e=t.getPropertyValue("content");return/^["'].*["']$/.test(e)?e.slice(1,-1):""}function ege(t){var e=hu(t);return e==="button"||e==="input"&&t.getAttribute("type")!=="hidden"||e==="meter"||e==="output"||e==="progress"||e==="select"||e==="textarea"}function tge(t){if(ege(t))return t;var e=null;return t.childNodes.forEach(function(n){if(e===null&&Oa(n)){var r=tge(n);r!==null&&(e=r)}}),e}function $7e(t){if(t.control!==void 0)return t.control;var e=t.getAttribute("for");return e!==null?t.ownerDocument.getElementById(e):tge(t)}function W7e(t){var e=t.labels;if(e===null)return e;if(e!==void 0)return Yp(e);if(!ege(t))return null;var n=t.ownerDocument;return Yp(n.querySelectorAll("label")).filter(function(r){return $7e(r)===t})}function Y7e(t){var e=t.assignedNodes();return e.length===0?Yp(t.childNodes):e}function nge(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new _7e,r=O7e(t),i=e.compute,s=i===void 0?"name":i,a=e.computedStyleSupportsPseudoElements,o=a===void 0?e.getComputedStyle!==void 0:a,c=e.getComputedStyle,l=c===void 0?r.getComputedStyle.bind(r):c,u=e.hidden,h=u===void 0?!1:u;function d(v,E){var T="";if(Oa(v)&&o){var x=l(v,"::before"),N=xte(x);T="".concat(N," ").concat(T)}var A=k7e(v)?Y7e(v):Yp(v.childNodes).concat(cU(v,"aria-owns"));if(A.forEach(function(L){var U=_(L,{isEmbeddedInLabel:E.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),$=Oa(L)?l(L).getPropertyValue("display"):"inline",q=$!=="inline"?" ":"";T+="".concat(q).concat(U).concat(q)}),Oa(v)&&o){var I=l(v,"::after"),k=xte(I);T="".concat(T," ").concat(k)}return T.trim()}function f(v,E){var T=v.getAttributeNode(E);return T!==null&&!n.has(T)&&T.value.trim()!==""?(n.add(T),T.value):null}function p(v){return Oa(v)?f(v,"title"):null}function g(v){if(!Oa(v))return null;if(N7e(v)){n.add(v);for(var E=Yp(v.childNodes),T=0;T<E.length;T+=1){var x=E[T];if(I7e(x))return _(x,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(A7e(v)){n.add(v);for(var N=Yp(v.childNodes),A=0;A<N.length;A+=1){var I=N[A];if(Zme(I))return _(I,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(P7e(v)){n.add(v);for(var k=Yp(v.childNodes),L=0;L<k.length;L+=1){var U=k[L];if(L7e(U))return U.textContent}return null}else if(hu(v)==="img"||hu(v)==="area"){var $=f(v,"alt");if($!==null)return $}else if(C7e(v)){var q=f(v,"label");if(q!==null)return q}if(EP(v)&&(v.type==="button"||v.type==="submit"||v.type==="reset")){var G=f(v,"value");if(G!==null)return G;if(v.type==="submit")return"Submit";if(v.type==="reset")return"Reset"}var X=W7e(v);if(X!==null&&X.length!==0)return n.add(v),Yp(X).map(function(Y){return _(Y,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})}).filter(function(Y){return Y.length>0}).join(" ");if(EP(v)&&v.type==="image"){var re=f(v,"alt");if(re!==null)return re;var V=f(v,"title");return V!==null?V:"Submit Query"}if(zv(v,["button"])){var Z=d(v,{isEmbeddedInLabel:!1,isReferenced:!1});if(Z!=="")return Z}return null}function _(v,E){if(n.has(v))return"";if(!h&&B7e(v,l)&&!E.isReferenced)return n.add(v),"";var T=Oa(v)?v.getAttributeNode("aria-labelledby"):null,x=T!==null&&!n.has(T)?cU(v,"aria-labelledby"):[];if(s==="name"&&!E.isReferenced&&x.length>0)return n.add(T),x.map(function($){return _($,{isEmbeddedInLabel:E.isEmbeddedInLabel,isReferenced:!0,recursion:!1})}).join(" ");var N=E.recursion&&F7e(v)&&s==="name";if(!N){var A=(Oa(v)&&v.getAttribute("aria-label")||"").trim();if(A!==""&&s==="name")return n.add(v),A;if(!H7e(v)){var I=g(v);if(I!==null)return n.add(v),I}}if(zv(v,["menu"]))return n.add(v),"";if(N||E.isEmbeddedInLabel||E.isReferenced){if(zv(v,["combobox","listbox"])){n.add(v);var k=z7e(v);return k.length===0?EP(v)?v.value:"":Yp(k).map(function($){return _($,{isEmbeddedInLabel:E.isEmbeddedInLabel,isReferenced:!1,recursion:!0})}).join(" ")}if(Qme(v,"range"))return n.add(v),v.hasAttribute("aria-valuetext")?v.getAttribute("aria-valuetext"):v.hasAttribute("aria-valuenow")?v.getAttribute("aria-valuenow"):v.getAttribute("value")||"";if(zv(v,["textbox"]))return n.add(v),q7e(v)}if(V7e(v)||Oa(v)&&E.isReferenced||j7e(v)||G7e()){var L=d(v,{isEmbeddedInLabel:E.isEmbeddedInLabel,isReferenced:!1});if(L!=="")return n.add(v),L}if(v.nodeType===v.TEXT_NODE)return n.add(v),v.textContent||"";if(E.recursion)return n.add(v),d(v,{isEmbeddedInLabel:E.isEmbeddedInLabel,isReferenced:!1});var U=p(v);return U!==null?(n.add(v),U):(n.add(v),"")}return U7e(_(t,{isEmbeddedInLabel:!1,isReferenced:s==="description",recursion:!1}))}function TO(t){"@babel/helpers - typeof";return TO=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},TO(t)}function wte(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Cte(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wte(Object(n),!0).forEach(function(r){X7e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wte(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function X7e(t,e,n){return e=K7e(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K7e(t){var e=J7e(t,"string");return TO(e)==="symbol"?e:String(e)}function J7e(t,e){if(TO(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(TO(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function rge(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=cU(t,"aria-describedby").map(function(i){return nge(i,Cte(Cte({},e),{},{compute:"description"}))}).join(" ");if(n===""){var r=t.getAttribute("title");n=r===null?"":r}return n}function Z7e(t){return zv(t,["caption","code","deletion","emphasis","generic","insertion","paragraph","presentation","strong","subscript","superscript"])}function y9(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Z7e(t)?"":nge(t,e)}var Jp={},BB={},ZT={},FB={};Object.defineProperty(FB,"__esModule",{value:!0});FB.default=void 0;function Q7e(){var t=this,e=0,n={"@@iterator":function(){return n},next:function(){if(e<t.length){var i=t[e];return e=e+1,{done:!1,value:i}}else return{done:!0}}};return n}var eWe=Q7e;FB.default=eWe;Object.defineProperty(ZT,"__esModule",{value:!0});ZT.default=rWe;var tWe=nWe(FB);function nWe(t){return t&&t.__esModule?t:{default:t}}function GV(t){"@babel/helpers - typeof";return GV=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},GV(t)}function rWe(t,e){return typeof Symbol=="function"&&GV(Symbol.iterator)==="symbol"&&Object.defineProperty(t,Symbol.iterator,{value:tWe.default.bind(e)}),t}Object.defineProperty(BB,"__esModule",{value:!0});BB.default=void 0;var iWe=sWe(ZT);function sWe(t){return t&&t.__esModule?t:{default:t}}function CH(t,e){return cWe(t)||oWe(t,e)||ige(t,e)||aWe()}function aWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oWe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,a,o;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,o=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw o}}return r}}function cWe(t){if(Array.isArray(t))return t}function lWe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ige(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,o;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,o=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw o}}}}function ige(t,e){if(t){if(typeof t=="string")return Rte(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rte(t,e)}}function Rte(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var p1=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-braillelabel",{type:"string"}],["aria-brailleroledescription",{type:"string"}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-description",{type:"string"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],qV={entries:function(){return p1},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=lWe(p1),i;try{for(r.s();!(i=r.n()).done;){var s=CH(i.value,2),a=s[0],o=s[1];e.call(n,o,a,p1)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=p1.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!qV.get(e)},keys:function(){return p1.map(function(e){var n=CH(e,1),r=n[0];return r})},values:function(){return p1.map(function(e){var n=CH(e,2),r=n[1];return r})}},uWe=(0,iWe.default)(qV,qV.entries());BB.default=uWe;var zB={};Object.defineProperty(zB,"__esModule",{value:!0});zB.default=void 0;var hWe=dWe(ZT);function dWe(t){return t&&t.__esModule?t:{default:t}}function RH(t,e){return mWe(t)||pWe(t,e)||sge(t,e)||fWe()}function fWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pWe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,a,o;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,o=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw o}}return r}}function mWe(t){if(Array.isArray(t))return t}function gWe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=sge(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,o;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,o=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw o}}}}function sge(t,e){if(t){if(typeof t=="string")return Ate(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ate(t,e)}}function Ate(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var m1=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],$V={entries:function(){return m1},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=gWe(m1),i;try{for(r.s();!(i=r.n()).done;){var s=RH(i.value,2),a=s[0],o=s[1];e.call(n,o,a,m1)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=m1.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!$V.get(e)},keys:function(){return m1.map(function(e){var n=RH(e,1),r=n[0];return r})},values:function(){return m1.map(function(e){var n=RH(e,2),r=n[1];return r})}},vWe=(0,hWe.default)($V,$V.entries());zB.default=vWe;var nR={},HB={},jB={};Object.defineProperty(jB,"__esModule",{value:!0});jB.default=void 0;var yWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},_We=yWe;jB.default=_We;var VB={};Object.defineProperty(VB,"__esModule",{value:!0});VB.default=void 0;var bWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},EWe=bWe;VB.default=EWe;var GB={};Object.defineProperty(GB,"__esModule",{value:!0});GB.default=void 0;var SWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},TWe=SWe;GB.default=TWe;var qB={};Object.defineProperty(qB,"__esModule",{value:!0});qB.default=void 0;var xWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},wWe=xWe;qB.default=wWe;var $B={};Object.defineProperty($B,"__esModule",{value:!0});$B.default=void 0;var CWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},RWe=CWe;$B.default=RWe;var WB={};Object.defineProperty(WB,"__esModule",{value:!0});WB.default=void 0;var AWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},MWe=AWe;WB.default=MWe;var YB={};Object.defineProperty(YB,"__esModule",{value:!0});YB.default=void 0;var OWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},NWe=OWe;YB.default=NWe;var XB={};Object.defineProperty(XB,"__esModule",{value:!0});XB.default=void 0;var IWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},kWe=IWe;XB.default=kWe;var KB={};Object.defineProperty(KB,"__esModule",{value:!0});KB.default=void 0;var DWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]},PWe=DWe;KB.default=PWe;var JB={};Object.defineProperty(JB,"__esModule",{value:!0});JB.default=void 0;var LWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},UWe=LWe;JB.default=UWe;var ZB={};Object.defineProperty(ZB,"__esModule",{value:!0});ZB.default=void 0;var BWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},FWe=BWe;ZB.default=FWe;var QB={};Object.defineProperty(QB,"__esModule",{value:!0});QB.default=void 0;var zWe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},HWe=zWe;QB.default=HWe;Object.defineProperty(HB,"__esModule",{value:!0});HB.default=void 0;var jWe=gp(jB),VWe=gp(VB),GWe=gp(GB),qWe=gp(qB),$We=gp($B),WWe=gp(WB),YWe=gp(YB),XWe=gp(XB),KWe=gp(KB),JWe=gp(JB),ZWe=gp(ZB),QWe=gp(QB);function gp(t){return t&&t.__esModule?t:{default:t}}var e9e=[["command",jWe.default],["composite",VWe.default],["input",GWe.default],["landmark",qWe.default],["range",$We.default],["roletype",WWe.default],["section",YWe.default],["sectionhead",XWe.default],["select",KWe.default],["structure",JWe.default],["widget",ZWe.default],["window",QWe.default]],t9e=e9e;HB.default=t9e;var eF={},tF={};Object.defineProperty(tF,"__esModule",{value:!0});tF.default=void 0;var n9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},r9e=n9e;tF.default=r9e;var nF={};Object.defineProperty(nF,"__esModule",{value:!0});nF.default=void 0;var i9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]},s9e=i9e;nF.default=s9e;var rF={};Object.defineProperty(rF,"__esModule",{value:!0});rF.default=void 0;var a9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},o9e=a9e;rF.default=o9e;var iF={};Object.defineProperty(iF,"__esModule",{value:!0});iF.default=void 0;var c9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},l9e=c9e;iF.default=l9e;var sF={};Object.defineProperty(sF,"__esModule",{value:!0});sF.default=void 0;var u9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},h9e=u9e;sF.default=h9e;var aF={};Object.defineProperty(aF,"__esModule",{value:!0});aF.default=void 0;var d9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"blockquote"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},f9e=d9e;aF.default=f9e;var oF={};Object.defineProperty(oF,"__esModule",{value:!0});oF.default=void 0;var p9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},m9e=p9e;oF.default=m9e;var cF={};Object.defineProperty(cF,"__esModule",{value:!0});cF.default=void 0;var g9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"caption"},module:"HTML"}],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},v9e=g9e;cF.default=v9e;var lF={};Object.defineProperty(lF,"__esModule",{value:!0});lF.default=void 0;var y9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["ancestor table element has table role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},_9e=y9e;lF.default=_9e;var uF={};Object.defineProperty(uF,"__esModule",{value:!0});uF.default=void 0;var b9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},E9e=b9e;uF.default=E9e;var hF={};Object.defineProperty(hF,"__esModule",{value:!0});hF.default=void 0;var S9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"code"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},T9e=S9e;hF.default=T9e;var dF={};Object.defineProperty(dF,"__esModule",{value:!0});dF.default=void 0;var x9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"col"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"colgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},w9e=x9e;dF.default=w9e;var fF={};Object.defineProperty(fF,"__esModule",{value:!0});fF.default=void 0;var C9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],constraints:["the multiple attribute is not set and the size attribute does not have a value greater than 1"],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]},R9e=C9e;fF.default=R9e;var pF={};Object.defineProperty(pF,"__esModule",{value:!0});pF.default=void 0;var A9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-label"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},M9e=A9e;pF.default=M9e;var mF={};Object.defineProperty(mF,"__esModule",{value:!0});mF.default=void 0;var O9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},N9e=O9e;mF.default=N9e;var gF={};Object.defineProperty(gF,"__esModule",{value:!0});gF.default=void 0;var I9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},k9e=I9e;gF.default=k9e;var vF={};Object.defineProperty(vF,"__esModule",{value:!0});vF.default=void 0;var D9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"del"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},P9e=D9e;vF.default=P9e;var yF={};Object.defineProperty(yF,"__esModule",{value:!0});yF.default=void 0;var L9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]},U9e=L9e;yF.default=U9e;var _F={};Object.defineProperty(_F,"__esModule",{value:!0});_F.default=void 0;var B9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]},F9e=B9e;_F.default=F9e;var bF={};Object.defineProperty(bF,"__esModule",{value:!0});bF.default=void 0;var z9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"html"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},H9e=z9e;bF.default=H9e;var EF={};Object.defineProperty(EF,"__esModule",{value:!0});EF.default=void 0;var j9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"em"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},V9e=j9e;EF.default=V9e;var SF={};Object.defineProperty(SF,"__esModule",{value:!0});SF.default=void 0;var G9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]},q9e=G9e;SF.default=q9e;var TF={};Object.defineProperty(TF,"__esModule",{value:!0});TF.default=void 0;var $9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},W9e=$9e;TF.default=W9e;var xF={};Object.defineProperty(xF,"__esModule",{value:!0});xF.default=void 0;var Y9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},X9e=Y9e;xF.default=X9e;var wF={};Object.defineProperty(wF,"__esModule",{value:!0});wF.default=void 0;var K9e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"a"},module:"HTML"},{concept:{name:"area"},module:"HTML"},{concept:{name:"aside"},module:"HTML"},{concept:{name:"b"},module:"HTML"},{concept:{name:"bdo"},module:"HTML"},{concept:{name:"body"},module:"HTML"},{concept:{name:"data"},module:"HTML"},{concept:{name:"div"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"footer"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"header"},module:"HTML"},{concept:{name:"hgroup"},module:"HTML"},{concept:{name:"i"},module:"HTML"},{concept:{name:"pre"},module:"HTML"},{concept:{name:"q"},module:"HTML"},{concept:{name:"samp"},module:"HTML"},{concept:{name:"section"},module:"HTML"},{concept:{name:"small"},module:"HTML"},{concept:{name:"span"},module:"HTML"},{concept:{name:"u"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},J9e=K9e;wF.default=J9e;var CF={};Object.defineProperty(CF,"__esModule",{value:!0});CF.default=void 0;var Z9e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]},Q9e=Z9e;CF.default=Q9e;var RF={};Object.defineProperty(RF,"__esModule",{value:!0});RF.default=void 0;var eYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{constraints:["ancestor table element has grid role","ancestor table element has treegrid role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]},tYe=eYe;RF.default=tYe;var AF={};Object.defineProperty(AF,"__esModule",{value:!0});AF.default=void 0;var nYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"},{concept:{name:"address"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},rYe=nYe;AF.default=rYe;var MF={};Object.defineProperty(MF,"__esModule",{value:!0});MF.default=void 0;var iYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]},sYe=iYe;MF.default=sYe;var OF={};Object.defineProperty(OF,"__esModule",{value:!0});OF.default=void 0;var aYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},oYe=aYe;OF.default=oYe;var NF={};Object.defineProperty(NF,"__esModule",{value:!0});NF.default=void 0;var cYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"ins"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},lYe=cYe;NF.default=lYe;var IF={};Object.defineProperty(IF,"__esModule",{value:!0});IF.default=void 0;var uYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"href"}],name:"area"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},hYe=uYe;IF.default=hYe;var kF={};Object.defineProperty(kF,"__esModule",{value:!0});kF.default=void 0;var dYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]},fYe=dYe;kF.default=fYe;var DF={};Object.defineProperty(DF,"__esModule",{value:!0});DF.default=void 0;var pYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"}],constraints:["the size attribute value is greater than 1"],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},mYe=pYe;DF.default=mYe;var PF={};Object.defineProperty(PF,"__esModule",{value:!0});PF.default=void 0;var gYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol","direct descendant of ul","direct descendant of menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},vYe=gYe;PF.default=vYe;var LF={};Object.defineProperty(LF,"__esModule",{value:!0});LF.default=void 0;var yYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},_Ye=yYe;LF.default=_Ye;var UF={};Object.defineProperty(UF,"__esModule",{value:!0});UF.default=void 0;var bYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},EYe=bYe;UF.default=EYe;var BF={};Object.defineProperty(BF,"__esModule",{value:!0});BF.default=void 0;var SYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null},relatedConcepts:[{concept:{name:"mark"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},TYe=SYe;BF.default=TYe;var FF={};Object.defineProperty(FF,"__esModule",{value:!0});FF.default=void 0;var xYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},wYe=xYe;FF.default=wYe;var zF={};Object.defineProperty(zF,"__esModule",{value:!0});zF.default=void 0;var CYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},RYe=CYe;zF.default=RYe;var HF={};Object.defineProperty(HF,"__esModule",{value:!0});HF.default=void 0;var AYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},MYe=AYe;HF.default=MYe;var jF={};Object.defineProperty(jF,"__esModule",{value:!0});jF.default=void 0;var OYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]},NYe=OYe;jF.default=NYe;var VF={};Object.defineProperty(VF,"__esModule",{value:!0});VF.default=void 0;var IYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},kYe=IYe;VF.default=kYe;var GF={};Object.defineProperty(GF,"__esModule",{value:!0});GF.default=void 0;var DYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]},PYe=DYe;GF.default=PYe;var qF={};Object.defineProperty(qF,"__esModule",{value:!0});qF.default=void 0;var LYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]},UYe=LYe;qF.default=UYe;var $F={};Object.defineProperty($F,"__esModule",{value:!0});$F.default=void 0;var BYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{name:"meter"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]},FYe=BYe;$F.default=FYe;var WF={};Object.defineProperty(WF,"__esModule",{value:!0});WF.default=void 0;var zYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},HYe=zYe;WF.default=HYe;var YF={};Object.defineProperty(YF,"__esModule",{value:!0});YF.default=void 0;var jYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},VYe=jYe;YF.default=VYe;var XF={};Object.defineProperty(XF,"__esModule",{value:!0});XF.default=void 0;var GYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},qYe=GYe;XF.default=qYe;var KF={};Object.defineProperty(KF,"__esModule",{value:!0});KF.default=void 0;var $Ye={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]},WYe=$Ye;KF.default=WYe;var JF={};Object.defineProperty(JF,"__esModule",{value:!0});JF.default=void 0;var YYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"p"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},XYe=YYe;JF.default=XYe;var ZF={};Object.defineProperty(ZF,"__esModule",{value:!0});ZF.default=void 0;var KYe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{attributes:[{name:"alt",value:""}],name:"img"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},JYe=KYe;ZF.default=JYe;var QF={};Object.defineProperty(QF,"__esModule",{value:!0});QF.default=void 0;var ZYe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]},QYe=ZYe;QF.default=QYe;var e4={};Object.defineProperty(e4,"__esModule",{value:!0});e4.default=void 0;var eXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},tXe=eXe;e4.default=tXe;var t4={};Object.defineProperty(t4,"__esModule",{value:!0});t4.default=void 0;var nXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},rXe=nXe;t4.default=rXe;var n4={};Object.defineProperty(n4,"__esModule",{value:!0});n4.default=void 0;var iXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},sXe=iXe;n4.default=sXe;var r4={};Object.defineProperty(r4,"__esModule",{value:!0});r4.default=void 0;var aXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]},oXe=aXe;r4.default=oXe;var i4={};Object.defineProperty(i4,"__esModule",{value:!0});i4.default=void 0;var cXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]},lXe=cXe;i4.default=lXe;var s4={};Object.defineProperty(s4,"__esModule",{value:!0});s4.default=void 0;var uXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"rowgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row","rowgroup"],requiredContextRole:["row","rowgroup"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},hXe=uXe;s4.default=hXe;var a4={};Object.defineProperty(a4,"__esModule",{value:!0});a4.default=void 0;var dXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]},fXe=dXe;a4.default=fXe;var o4={};Object.defineProperty(o4,"__esModule",{value:!0});o4.default=void 0;var pXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},mXe=pXe;o4.default=mXe;var c4={};Object.defineProperty(c4,"__esModule",{value:!0});c4.default=void 0;var gXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]},vXe=gXe;c4.default=vXe;var l4={};Object.defineProperty(l4,"__esModule",{value:!0});l4.default=void 0;var yXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},_Xe=yXe;l4.default=_Xe;var u4={};Object.defineProperty(u4,"__esModule",{value:!0});u4.default=void 0;var bXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]},EXe=bXe;u4.default=EXe;var h4={};Object.defineProperty(h4,"__esModule",{value:!0});h4.default=void 0;var SXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]},TXe=SXe;h4.default=TXe;var d4={};Object.defineProperty(d4,"__esModule",{value:!0});d4.default=void 0;var xXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},wXe=xXe;d4.default=wXe;var f4={};Object.defineProperty(f4,"__esModule",{value:!0});f4.default=void 0;var CXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"strong"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},RXe=CXe;f4.default=RXe;var p4={};Object.defineProperty(p4,"__esModule",{value:!0});p4.default=void 0;var AXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sub"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},MXe=AXe;p4.default=MXe;var m4={};Object.defineProperty(m4,"__esModule",{value:!0});m4.default=void 0;var OXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},NXe=OXe;m4.default=NXe;var g4={};Object.defineProperty(g4,"__esModule",{value:!0});g4.default=void 0;var IXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]},kXe=IXe;g4.default=kXe;var v4={};Object.defineProperty(v4,"__esModule",{value:!0});v4.default=void 0;var DXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]},PXe=DXe;v4.default=PXe;var y4={};Object.defineProperty(y4,"__esModule",{value:!0});y4.default=void 0;var LXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]},UXe=LXe;y4.default=UXe;var _4={};Object.defineProperty(_4,"__esModule",{value:!0});_4.default=void 0;var BXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]},FXe=BXe;_4.default=FXe;var b4={};Object.defineProperty(b4,"__esModule",{value:!0});b4.default=void 0;var zXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},HXe=zXe;b4.default=HXe;var E4={};Object.defineProperty(E4,"__esModule",{value:!0});E4.default=void 0;var jXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},VXe=jXe;E4.default=VXe;var S4={};Object.defineProperty(S4,"__esModule",{value:!0});S4.default=void 0;var GXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]},qXe=GXe;S4.default=qXe;var T4={};Object.defineProperty(T4,"__esModule",{value:!0});T4.default=void 0;var $Xe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"time"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},WXe=$Xe;T4.default=WXe;var x4={};Object.defineProperty(x4,"__esModule",{value:!0});x4.default=void 0;var YXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]},XXe=YXe;x4.default=XXe;var w4={};Object.defineProperty(w4,"__esModule",{value:!0});w4.default=void 0;var KXe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},JXe=KXe;w4.default=JXe;var C4={};Object.defineProperty(C4,"__esModule",{value:!0});C4.default=void 0;var ZXe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},QXe=ZXe;C4.default=QXe;var R4={};Object.defineProperty(R4,"__esModule",{value:!0});R4.default=void 0;var eKe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},tKe=eKe;R4.default=tKe;var A4={};Object.defineProperty(A4,"__esModule",{value:!0});A4.default=void 0;var nKe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]},rKe=nKe;A4.default=rKe;var M4={};Object.defineProperty(M4,"__esModule",{value:!0});M4.default=void 0;var iKe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]},sKe=iKe;M4.default=sKe;Object.defineProperty(eF,"__esModule",{value:!0});eF.default=void 0;var aKe=un(tF),oKe=un(nF),cKe=un(rF),lKe=un(iF),uKe=un(sF),hKe=un(aF),dKe=un(oF),fKe=un(cF),pKe=un(lF),mKe=un(uF),gKe=un(hF),vKe=un(dF),yKe=un(fF),_Ke=un(pF),bKe=un(mF),EKe=un(gF),SKe=un(vF),TKe=un(yF),xKe=un(_F),wKe=un(bF),CKe=un(EF),RKe=un(SF),AKe=un(TF),MKe=un(xF),OKe=un(wF),NKe=un(CF),IKe=un(RF),kKe=un(AF),DKe=un(MF),PKe=un(OF),LKe=un(NF),UKe=un(IF),BKe=un(kF),FKe=un(DF),zKe=un(PF),HKe=un(LF),jKe=un(UF),VKe=un(BF),GKe=un(FF),qKe=un(zF),$Ke=un(HF),WKe=un(jF),YKe=un(VF),XKe=un(GF),KKe=un(qF),JKe=un($F),ZKe=un(WF),QKe=un(YF),eJe=un(XF),tJe=un(KF),nJe=un(JF),rJe=un(ZF),iJe=un(QF),sJe=un(e4),aJe=un(t4),oJe=un(n4),cJe=un(r4),lJe=un(i4),uJe=un(s4),hJe=un(a4),dJe=un(o4),fJe=un(c4),pJe=un(l4),mJe=un(u4),gJe=un(h4),vJe=un(d4),yJe=un(f4),_Je=un(p4),bJe=un(m4),EJe=un(g4),SJe=un(v4),TJe=un(y4),xJe=un(_4),wJe=un(b4),CJe=un(E4),RJe=un(S4),AJe=un(T4),MJe=un(x4),OJe=un(w4),NJe=un(C4),IJe=un(R4),kJe=un(A4),DJe=un(M4);function un(t){return t&&t.__esModule?t:{default:t}}var PJe=[["alert",aKe.default],["alertdialog",oKe.default],["application",cKe.default],["article",lKe.default],["banner",uKe.default],["blockquote",hKe.default],["button",dKe.default],["caption",fKe.default],["cell",pKe.default],["checkbox",mKe.default],["code",gKe.default],["columnheader",vKe.default],["combobox",yKe.default],["complementary",_Ke.default],["contentinfo",bKe.default],["definition",EKe.default],["deletion",SKe.default],["dialog",TKe.default],["directory",xKe.default],["document",wKe.default],["emphasis",CKe.default],["feed",RKe.default],["figure",AKe.default],["form",MKe.default],["generic",OKe.default],["grid",NKe.default],["gridcell",IKe.default],["group",kKe.default],["heading",DKe.default],["img",PKe.default],["insertion",LKe.default],["link",UKe.default],["list",BKe.default],["listbox",FKe.default],["listitem",zKe.default],["log",HKe.default],["main",jKe.default],["mark",VKe.default],["marquee",GKe.default],["math",qKe.default],["menu",$Ke.default],["menubar",WKe.default],["menuitem",YKe.default],["menuitemcheckbox",XKe.default],["menuitemradio",KKe.default],["meter",JKe.default],["navigation",ZKe.default],["none",QKe.default],["note",eJe.default],["option",tJe.default],["paragraph",nJe.default],["presentation",rJe.default],["progressbar",iJe.default],["radio",sJe.default],["radiogroup",aJe.default],["region",oJe.default],["row",cJe.default],["rowgroup",lJe.default],["rowheader",uJe.default],["scrollbar",hJe.default],["search",dJe.default],["searchbox",fJe.default],["separator",pJe.default],["slider",mJe.default],["spinbutton",gJe.default],["status",vJe.default],["strong",yJe.default],["subscript",_Je.default],["superscript",bJe.default],["switch",EJe.default],["tab",SJe.default],["table",TJe.default],["tablist",xJe.default],["tabpanel",wJe.default],["term",CJe.default],["textbox",RJe.default],["time",AJe.default],["timer",MJe.default],["toolbar",OJe.default],["tooltip",NJe.default],["tree",IJe.default],["treegrid",kJe.default],["treeitem",DJe.default]],LJe=PJe;eF.default=LJe;var O4={},N4={};Object.defineProperty(N4,"__esModule",{value:!0});N4.default=void 0;var UJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},BJe=UJe;N4.default=BJe;var I4={};Object.defineProperty(I4,"__esModule",{value:!0});I4.default=void 0;var FJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},zJe=FJe;I4.default=zJe;var k4={};Object.defineProperty(k4,"__esModule",{value:!0});k4.default=void 0;var HJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},jJe=HJe;k4.default=jJe;var D4={};Object.defineProperty(D4,"__esModule",{value:!0});D4.default=void 0;var VJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},GJe=VJe;D4.default=GJe;var P4={};Object.defineProperty(P4,"__esModule",{value:!0});P4.default=void 0;var qJe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},$Je=qJe;P4.default=$Je;var L4={};Object.defineProperty(L4,"__esModule",{value:!0});L4.default=void 0;var WJe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},YJe=WJe;L4.default=YJe;var U4={};Object.defineProperty(U4,"__esModule",{value:!0});U4.default=void 0;var XJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},KJe=XJe;U4.default=KJe;var B4={};Object.defineProperty(B4,"__esModule",{value:!0});B4.default=void 0;var JJe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},ZJe=JJe;B4.default=ZJe;var F4={};Object.defineProperty(F4,"__esModule",{value:!0});F4.default=void 0;var QJe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},eZe=QJe;F4.default=eZe;var z4={};Object.defineProperty(z4,"__esModule",{value:!0});z4.default=void 0;var tZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},nZe=tZe;z4.default=nZe;var H4={};Object.defineProperty(H4,"__esModule",{value:!0});H4.default=void 0;var rZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},iZe=rZe;H4.default=iZe;var j4={};Object.defineProperty(j4,"__esModule",{value:!0});j4.default=void 0;var sZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},aZe=sZe;j4.default=aZe;var V4={};Object.defineProperty(V4,"__esModule",{value:!0});V4.default=void 0;var oZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},cZe=oZe;V4.default=cZe;var G4={};Object.defineProperty(G4,"__esModule",{value:!0});G4.default=void 0;var lZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},uZe=lZe;G4.default=uZe;var q4={};Object.defineProperty(q4,"__esModule",{value:!0});q4.default=void 0;var hZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},dZe=hZe;q4.default=dZe;var $4={};Object.defineProperty($4,"__esModule",{value:!0});$4.default=void 0;var fZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},pZe=fZe;$4.default=pZe;var W4={};Object.defineProperty(W4,"__esModule",{value:!0});W4.default=void 0;var mZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},gZe=mZe;W4.default=gZe;var Y4={};Object.defineProperty(Y4,"__esModule",{value:!0});Y4.default=void 0;var vZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},yZe=vZe;Y4.default=yZe;var X4={};Object.defineProperty(X4,"__esModule",{value:!0});X4.default=void 0;var _Ze={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},bZe=_Ze;X4.default=bZe;var K4={};Object.defineProperty(K4,"__esModule",{value:!0});K4.default=void 0;var EZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},SZe=EZe;K4.default=SZe;var J4={};Object.defineProperty(J4,"__esModule",{value:!0});J4.default=void 0;var TZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},xZe=TZe;J4.default=xZe;var Z4={};Object.defineProperty(Z4,"__esModule",{value:!0});Z4.default=void 0;var wZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},CZe=wZe;Z4.default=CZe;var Q4={};Object.defineProperty(Q4,"__esModule",{value:!0});Q4.default=void 0;var RZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},AZe=RZe;Q4.default=AZe;var e6={};Object.defineProperty(e6,"__esModule",{value:!0});e6.default=void 0;var MZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},OZe=MZe;e6.default=OZe;var t6={};Object.defineProperty(t6,"__esModule",{value:!0});t6.default=void 0;var NZe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},IZe=NZe;t6.default=IZe;var n6={};Object.defineProperty(n6,"__esModule",{value:!0});n6.default=void 0;var kZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},DZe=kZe;n6.default=DZe;var r6={};Object.defineProperty(r6,"__esModule",{value:!0});r6.default=void 0;var PZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},LZe=PZe;r6.default=LZe;var i6={};Object.defineProperty(i6,"__esModule",{value:!0});i6.default=void 0;var UZe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},BZe=UZe;i6.default=BZe;var s6={};Object.defineProperty(s6,"__esModule",{value:!0});s6.default=void 0;var FZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},zZe=FZe;s6.default=zZe;var a6={};Object.defineProperty(a6,"__esModule",{value:!0});a6.default=void 0;var HZe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]},jZe=HZe;a6.default=jZe;var o6={};Object.defineProperty(o6,"__esModule",{value:!0});o6.default=void 0;var VZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},GZe=VZe;o6.default=GZe;var c6={};Object.defineProperty(c6,"__esModule",{value:!0});c6.default=void 0;var qZe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},$Ze=qZe;c6.default=$Ze;var l6={};Object.defineProperty(l6,"__esModule",{value:!0});l6.default=void 0;var WZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},YZe=WZe;l6.default=YZe;var u6={};Object.defineProperty(u6,"__esModule",{value:!0});u6.default=void 0;var XZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},KZe=XZe;u6.default=KZe;var h6={};Object.defineProperty(h6,"__esModule",{value:!0});h6.default=void 0;var JZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]},ZZe=JZe;h6.default=ZZe;var d6={};Object.defineProperty(d6,"__esModule",{value:!0});d6.default=void 0;var QZe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},eQe=QZe;d6.default=eQe;var f6={};Object.defineProperty(f6,"__esModule",{value:!0});f6.default=void 0;var tQe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]},nQe=tQe;f6.default=nQe;var p6={};Object.defineProperty(p6,"__esModule",{value:!0});p6.default=void 0;var rQe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},iQe=rQe;p6.default=iQe;var m6={};Object.defineProperty(m6,"__esModule",{value:!0});m6.default=void 0;var sQe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},aQe=sQe;m6.default=aQe;Object.defineProperty(O4,"__esModule",{value:!0});O4.default=void 0;var oQe=_i(N4),cQe=_i(I4),lQe=_i(k4),uQe=_i(D4),hQe=_i(P4),dQe=_i(L4),fQe=_i(U4),pQe=_i(B4),mQe=_i(F4),gQe=_i(z4),vQe=_i(H4),yQe=_i(j4),_Qe=_i(V4),bQe=_i(G4),EQe=_i(q4),SQe=_i($4),TQe=_i(W4),xQe=_i(Y4),wQe=_i(X4),CQe=_i(K4),RQe=_i(J4),AQe=_i(Z4),MQe=_i(Q4),OQe=_i(e6),NQe=_i(t6),IQe=_i(n6),kQe=_i(r6),DQe=_i(i6),PQe=_i(s6),LQe=_i(a6),UQe=_i(o6),BQe=_i(c6),FQe=_i(l6),zQe=_i(u6),HQe=_i(h6),jQe=_i(d6),VQe=_i(f6),GQe=_i(p6),qQe=_i(m6);function _i(t){return t&&t.__esModule?t:{default:t}}var $Qe=[["doc-abstract",oQe.default],["doc-acknowledgments",cQe.default],["doc-afterword",lQe.default],["doc-appendix",uQe.default],["doc-backlink",hQe.default],["doc-biblioentry",dQe.default],["doc-bibliography",fQe.default],["doc-biblioref",pQe.default],["doc-chapter",mQe.default],["doc-colophon",gQe.default],["doc-conclusion",vQe.default],["doc-cover",yQe.default],["doc-credit",_Qe.default],["doc-credits",bQe.default],["doc-dedication",EQe.default],["doc-endnote",SQe.default],["doc-endnotes",TQe.default],["doc-epigraph",xQe.default],["doc-epilogue",wQe.default],["doc-errata",CQe.default],["doc-example",RQe.default],["doc-footnote",AQe.default],["doc-foreword",MQe.default],["doc-glossary",OQe.default],["doc-glossref",NQe.default],["doc-index",IQe.default],["doc-introduction",kQe.default],["doc-noteref",DQe.default],["doc-notice",PQe.default],["doc-pagebreak",LQe.default],["doc-pagelist",UQe.default],["doc-part",BQe.default],["doc-preface",FQe.default],["doc-prologue",zQe.default],["doc-pullquote",HQe.default],["doc-qna",jQe.default],["doc-subtitle",VQe.default],["doc-tip",GQe.default],["doc-toc",qQe.default]],WQe=$Qe;O4.default=WQe;var g6={},v6={};Object.defineProperty(v6,"__esModule",{value:!0});v6.default=void 0;var YQe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-object"}},{module:"ARIA",concept:{name:"img"}},{module:"ARIA",concept:{name:"article"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},XQe=YQe;v6.default=XQe;var y6={};Object.defineProperty(y6,"__esModule",{value:!0});y6.default=void 0;var KQe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-document"}},{module:"ARIA",concept:{name:"group"}},{module:"ARIA",concept:{name:"img"}},{module:"GRAPHICS",concept:{name:"graphics-symbol"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},JQe=KQe;y6.default=JQe;var _6={};Object.defineProperty(_6,"__esModule",{value:!0});_6.default=void 0;var ZQe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},QQe=ZQe;_6.default=QQe;Object.defineProperty(g6,"__esModule",{value:!0});g6.default=void 0;var eet=_9(v6),tet=_9(y6),net=_9(_6);function _9(t){return t&&t.__esModule?t:{default:t}}var ret=[["graphics-document",eet.default],["graphics-object",tet.default],["graphics-symbol",net.default]],iet=ret;g6.default=iet;Object.defineProperty(nR,"__esModule",{value:!0});nR.default=void 0;var set=oI(HB),aet=oI(eF),oet=oI(O4),cet=oI(g6),uet=oI(ZT);function oI(t){return t&&t.__esModule?t:{default:t}}function het(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WV(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=age(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,o;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,o=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw o}}}}function sM(t,e){return pet(t)||fet(t,e)||age(t,e)||det()}function det(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function age(t,e){if(t){if(typeof t=="string")return Mte(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mte(t,e)}}function Mte(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,a,o;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,o=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw o}}return r}}function pet(t){if(Array.isArray(t))return t}var I_=[].concat(set.default,aet.default,oet.default,cet.default);I_.forEach(function(t){var e=sM(t,2),n=e[1],r=WV(n.superClass),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,a=WV(s),o;try{var c=function(){var u=o.value,h=I_.find(function(_){var v=sM(_,1),E=v[0];return E===u});if(h)for(var d=h[1],f=0,p=Object.keys(d.props);f<p.length;f++){var g=p[f];Object.prototype.hasOwnProperty.call(n.props,g)||Object.assign(n.props,het({},g,d.props[g]))}};for(a.s();!(o=a.n()).done;)c()}catch(l){a.e(l)}finally{a.f()}}}catch(l){r.e(l)}finally{r.f()}});var YV={entries:function(){return I_},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=WV(I_),i;try{for(r.s();!(i=r.n()).done;){var s=sM(i.value,2),a=s[0],o=s[1];e.call(n,o,a,I_)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=I_.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!YV.get(e)},keys:function(){return I_.map(function(e){var n=sM(e,1),r=n[0];return r})},values:function(){return I_.map(function(e){var n=sM(e,2),r=n[1];return r})}},met=(0,uet.default)(YV,YV.entries());nR.default=met;var b6={},oge={},Ote=Object.prototype.hasOwnProperty;function XV(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&XV(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(Ote.call(t,n)&&++r&&!Ote.call(e,n)||!(n in e)||!XV(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}oge.dequal=XV;Object.defineProperty(b6,"__esModule",{value:!0});b6.default=void 0;var cge=oge,get=uge(ZT),lge=uge(nR);function uge(t){return t&&t.__esModule?t:{default:t}}function AH(t,e){return _et(t)||yet(t,e)||hge(t,e)||vet()}function vet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,a,o;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,o=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw o}}return r}}function _et(t){if(Array.isArray(t))return t}function bet(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=hge(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,o;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,o=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw o}}}}function hge(t,e){if(t){if(typeof t=="string")return Nte(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nte(t,e)}}function Nte(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var k_=[],Ite=lge.default.keys();for(var MH=0;MH<Ite.length;MH++){var OH=Ite[MH],NH=lge.default.get(OH);if(NH)for(var kte=[].concat(NH.baseConcepts,NH.relatedConcepts),IH=0;IH<kte.length;IH++){var Dte=kte[IH];Dte.module==="HTML"&&function(){var t=Dte.concept;if(t){var e=k_.find(function(s){return(0,cge.dequal)(s,t)}),n;e?n=e[1]:n=[];for(var r=!0,i=0;i<n.length;i++)if(n[i]===OH){r=!1;break}r&&n.push(OH),k_.push([t,n])}}()}}var KV={entries:function(){return k_},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=bet(k_),i;try{for(r.s();!(i=r.n()).done;){var s=AH(i.value,2),a=s[0],o=s[1];e.call(n,o,a,k_)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=k_.find(function(r){return e.name===r[0].name&&(0,cge.dequal)(e.attributes,r[0].attributes)});return n&&n[1]},has:function(e){return!!KV.get(e)},keys:function(){return k_.map(function(e){var n=AH(e,1),r=n[0];return r})},values:function(){return k_.map(function(e){var n=AH(e,2),r=n[1];return r})}},Eet=(0,get.default)(KV,KV.entries());b6.default=Eet;var E6={};Object.defineProperty(E6,"__esModule",{value:!0});E6.default=void 0;var Tet=fge(ZT),dge=fge(nR);function fge(t){return t&&t.__esModule?t:{default:t}}function kH(t,e){return Cet(t)||wet(t,e)||pge(t,e)||xet()}function xet(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wet(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,a,o;try{for(n=n.call(t);!(i=(a=n.next()).done)&&(r.push(a.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,o=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw o}}return r}}function Cet(t){if(Array.isArray(t))return t}function Ret(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=pge(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,o;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,o=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw o}}}}function pge(t,e){if(t){if(typeof t=="string")return Pte(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pte(t,e)}}function Pte(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var xS=[],Lte=dge.default.keys();for(var DH=0;DH<Lte.length;DH++){var Ute=Lte[DH],PH=dge.default.get(Ute),LH=[];if(PH){for(var Bte=[].concat(PH.baseConcepts,PH.relatedConcepts),UH=0;UH<Bte.length;UH++){var Fte=Bte[UH];if(Fte.module==="HTML"){var zte=Fte.concept;zte!=null&&LH.push(zte)}}LH.length>0&&xS.push([Ute,LH])}}var JV={entries:function(){return xS},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=Ret(xS),i;try{for(r.s();!(i=r.n()).done;){var s=kH(i.value,2),a=s[0],o=s[1];e.call(n,o,a,xS)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=xS.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!JV.get(e)},keys:function(){return xS.map(function(e){var n=kH(e,1),r=n[0];return r})},values:function(){return xS.map(function(e){var n=kH(e,2),r=n[1];return r})}},Aet=(0,Tet.default)(JV,JV.entries());E6.default=Aet;Object.defineProperty(Jp,"__esModule",{value:!0});var Hp=Jp.roles=gge=Jp.roleElements=mge=Jp.elementRoles=Jp.dom=Jp.aria=void 0,Met=cI(BB),Oet=cI(zB),Net=cI(nR),Iet=cI(b6),ket=cI(E6);function cI(t){return t&&t.__esModule?t:{default:t}}var Det=Met.default;Jp.aria=Det;var Pet=Oet.default;Jp.dom=Pet;var Let=Net.default;Hp=Jp.roles=Let;var Uet=Iet.default,mge=Jp.elementRoles=Uet,Bet=ket.default,gge=Jp.roleElements=Bet,b9={exports:{}};b9.exports;(function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var o={compressToBase64:function(c){if(c==null)return"";var l=o._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:o._decompress(c.length,32,function(l){return a(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":o._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:o._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=o.compress(c),u=new Uint8Array(l.length*2),h=0,d=l.length;h<d;h++){var f=l.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return o.decompress(c);for(var l=new Array(c.length/2),u=0,h=l.length;u<h;u++)l[u]=c[u*2]*256+c[u*2+1];var d=[];return l.forEach(function(f){d.push(n(f))}),o.decompress(d.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":o._compress(c,6,function(l){return i.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),o._decompress(c.length,32,function(l){return a(i,c.charAt(l))}))},compress:function(c){return o._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var h,d,f={},p={},g="",_="",v="",E=2,T=3,x=2,N=[],A=0,I=0,k;for(k=0;k<c.length;k+=1)if(g=c.charAt(k),Object.prototype.hasOwnProperty.call(f,g)||(f[g]=T++,p[g]=!0),_=v+g,Object.prototype.hasOwnProperty.call(f,_))v=_;else{if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<x;h++)A=A<<1,I==l-1?(I=0,N.push(u(A)),A=0):I++;for(d=v.charCodeAt(0),h=0;h<8;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1}else{for(d=1,h=0;h<x;h++)A=A<<1|d,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=0;for(d=v.charCodeAt(0),h=0;h<16;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1}E--,E==0&&(E=Math.pow(2,x),x++),delete p[v]}else for(d=f[v],h=0;h<x;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1;E--,E==0&&(E=Math.pow(2,x),x++),f[_]=T++,v=String(g)}if(v!==""){if(Object.prototype.hasOwnProperty.call(p,v)){if(v.charCodeAt(0)<256){for(h=0;h<x;h++)A=A<<1,I==l-1?(I=0,N.push(u(A)),A=0):I++;for(d=v.charCodeAt(0),h=0;h<8;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1}else{for(d=1,h=0;h<x;h++)A=A<<1|d,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=0;for(d=v.charCodeAt(0),h=0;h<16;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1}E--,E==0&&(E=Math.pow(2,x),x++),delete p[v]}else for(d=f[v],h=0;h<x;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1;E--,E==0&&(E=Math.pow(2,x),x++)}for(d=2,h=0;h<x;h++)A=A<<1|d&1,I==l-1?(I=0,N.push(u(A)),A=0):I++,d=d>>1;for(;;)if(A=A<<1,I==l-1){N.push(u(A));break}else I++;return N.join("")},decompress:function(c){return c==null?"":c==""?null:o._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var h=[],d=4,f=4,p=3,g="",_=[],v,E,T,x,N,A,I,k={val:u(0),position:l,index:1};for(v=0;v<3;v+=1)h[v]=v;for(T=0,N=Math.pow(2,2),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;switch(T){case 0:for(T=0,N=Math.pow(2,8),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;I=n(T);break;case 1:for(T=0,N=Math.pow(2,16),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;I=n(T);break;case 2:return""}for(h[3]=I,E=I,_.push(I);;){if(k.index>c)return"";for(T=0,N=Math.pow(2,p),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;switch(I=T){case 0:for(T=0,N=Math.pow(2,8),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;h[f++]=n(T),I=f-1,d--;break;case 1:for(T=0,N=Math.pow(2,16),A=1;A!=N;)x=k.val&k.position,k.position>>=1,k.position==0&&(k.position=l,k.val=u(k.index++)),T|=(x>0?1:0)*A,A<<=1;h[f++]=n(T),I=f-1,d--;break;case 2:return _.join("")}if(d==0&&(d=Math.pow(2,p),p++),h[I])g=h[I];else if(I===f)g=E+E.charAt(0);else return null;_.push(g),h[f++]=E+g.charAt(0),d--,E=g,d==0&&(d=Math.pow(2,p),p++)}}};return o}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(b9);var Fet=b9.exports;const zet=qc(Fet);var ZV={};function vge(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}const Het=(t,e,n,r,i,s,a)=>{const o=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let h=a(u,n,o,i,s);return typeof u!="string"&&(h.indexOf(`
`)!==-1&&(h=n.spacingOuter+o+h+n.spacingOuter+r),h="{"+h+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+h+c.value.close}).join("")},jet=3,Vet=(t,e,n,r,i,s)=>t.map(a=>{const o=typeof a=="string"?yge(a,e):s(a,e,n,r,i);return o===""&&typeof a=="object"&&a!==null&&a.nodeType!==jet?"":e.spacingOuter+n+o}).join(""),yge=(t,e)=>{const n=e.colors.content;return n.open+vge(t)+n.close},Get=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+vge(t)+"-->"+n.close},qet=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close},$et=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" …"+n.open+" />"+n.close},Wet=1,_ge=3,bge=8,Ege=11,Yet=/^((HTML|SVG)\w*)?Element$/,Sge=t=>{const{tagName:e}=t;return!!(typeof e=="string"&&e.includes("-")||typeof t.hasAttribute=="function"&&t.hasAttribute("is"))},Xet=t=>{const e=t.constructor.name,{nodeType:n}=t;return n===Wet&&(Yet.test(e)||Sge(t))||n===_ge&&e==="Text"||n===bge&&e==="Comment"||n===Ege&&e==="DocumentFragment"};function Ket(t){return t.nodeType===_ge}function Jet(t){return t.nodeType===bge}function BH(t){return t.nodeType===Ege}function Zet(t){return{test:e=>{var n;return((e==null||(n=e.constructor)==null?void 0:n.name)||Sge(e))&&Xet(e)},serialize:(e,n,r,i,s,a)=>{if(Ket(e))return yge(e.data,n);if(Jet(e))return Get(e.data,n);const o=BH(e)?"DocumentFragment":e.tagName.toLowerCase();return++i>n.maxDepth?$et(o,n):qet(o,Het(BH(e)?[]:Array.from(e.attributes).map(c=>c.name).sort(),BH(e)?{}:Array.from(e.attributes).reduce((c,l)=>(c[l.name]=l.value,c),{}),n,r+n.indent,i,s,a),Vet(Array.prototype.slice.call(e.childNodes||e.children).filter(t),n,r+n.indent,i,s,a),n,r)}}}let Tge=null,E9=null,S9=null;try{const t=module&&module.require;E9=t.call(module,"fs").readFileSync,S9=t.call(module,"@babel/code-frame").codeFrameColumns,Tge=t.call(module,"chalk")}catch{}function Qet(t){const e=t.indexOf("(")+1,n=t.indexOf(")"),r=t.slice(e,n),i=r.split(":"),[s,a,o]=[i[0],parseInt(i[1],10),parseInt(i[2],10)];let c="";try{c=E9(s,"utf-8")}catch{return""}const l=S9(c,{start:{line:a,column:o}},{highlightCode:!0,linesBelow:0});return Tge.dim(r)+`
`+l+`
`}function ett(){if(!E9||!S9)return"";const e=new Error().stack.split(`
`).slice(1).find(n=>!n.includes("node_modules/"));return Qet(e)}const xge=3;function FH(){return typeof jest<"u"&&jest!==null?setTimeout._isMockFunction===!0||Object.prototype.hasOwnProperty.call(setTimeout,"clock"):!1}function T9(){if(typeof window>"u")throw new Error("Could not find default container");return window.document}function ttt(t){if(t.defaultView)return t.defaultView;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;if(t.window)return t.window;throw t.ownerDocument&&t.ownerDocument.defaultView===null?new Error("It looks like the window object is not available for the provided node."):t.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(t)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):typeof t.debug=="function"&&typeof t.logTestingPlaygroundURL=="function"?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: "+typeof t+".")}function Ey(t){if(!t||typeof t.querySelector!="function"||typeof t.querySelectorAll!="function")throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got "+e(t)+".");function e(n){return typeof n=="object"?n===null?"null":n.constructor.name:typeof n}}const ntt=()=>{if(typeof zn>"u")return!1;let t;try{var e;const n=(e=ZV)==null?void 0:e.COLORS;n&&(t=JSON.parse(n))}catch{}return typeof t=="boolean"?t:zn.versions!==void 0&&zn.versions.node!==void 0},{DOMCollection:rtt}=Bme,itt=1,stt=8;function att(t){return t.nodeType!==stt&&(t.nodeType!==itt||!t.matches(as().defaultIgnore))}function lU(t,e,n){if(n===void 0&&(n={}),t||(t=T9().body),typeof e!="number"&&(e=typeof zn<"u"&&typeof ZV<"u"&&ZV.DEBUG_PRINT_LIMIT||7e3),e===0)return"";t.documentElement&&(t=t.documentElement);let r=typeof t;if(r==="object"?r=t.constructor.name:t={},!("outerHTML"in t))throw new TypeError("Expected an element or document but got "+r);const{filterNode:i=att,...s}=n,a=B$e(t,{plugins:[Zet(i),rtt],printFunctionName:!1,highlight:ntt(),...s});return e!==void 0&&t.outerHTML.length>e?a.slice(0,e)+"...":a}const Hte=function(){const t=ett();console.log(t?lU(...arguments)+`

`+t:lU(...arguments))};let uU={testIdAttribute:"data-testid",asyncUtilTimeout:1e3,asyncWrapper:t=>t(),unstable_advanceTimersWrapper:t=>t(),eventWrapper:t=>t(),defaultHidden:!1,defaultIgnore:"script, style",showOriginalStackTrace:!1,throwSuggestions:!1,getElementError(t,e){const n=lU(e),r=new Error([t,"Ignored nodes: comments, "+uU.defaultIgnore+`
`+n].filter(Boolean).join(`

`));return r.name="TestingLibraryElementError",r},_disableExpensiveErrorDiagnostics:!1,computedStyleSupportsPseudoElements:!1};function ott(t){try{return uU._disableExpensiveErrorDiagnostics=!0,t()}finally{uU._disableExpensiveErrorDiagnostics=!1}}function as(){return uU}const ctt=["button","meter","output","progress","select","textarea","input"];function wge(t){return ctt.includes(t.nodeName.toLowerCase())?"":t.nodeType===xge?t.textContent:Array.from(t.childNodes).map(e=>wge(e)).join("")}function QV(t){let e;return t.tagName.toLowerCase()==="label"?e=wge(t):e=t.value||t.textContent,e}function Cge(t){if(t.labels!==void 0){var e;return(e=t.labels)!=null?e:[]}if(!ltt(t))return[];const n=t.ownerDocument.querySelectorAll("label");return Array.from(n).filter(r=>r.control===t)}function ltt(t){return/BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(t.tagName)||t.tagName==="INPUT"&&t.getAttribute("type")!=="hidden"}function Rge(t,e,n){let{selector:r="*"}=n===void 0?{}:n;const i=e.getAttribute("aria-labelledby"),s=i?i.split(" "):[];return s.length?s.map(a=>{const o=t.querySelector('[id="'+a+'"]');return o?{content:QV(o),formControl:null}:{content:"",formControl:null}}):Array.from(Cge(e)).map(a=>{const o=QV(a),l=Array.from(a.querySelectorAll("button, input, meter, output, progress, select, textarea")).filter(u=>u.matches(r))[0];return{content:o,formControl:l}})}function Age(t){if(t==null)throw new Error("It looks like "+t+" was passed instead of a matcher. Did you do something like getByText("+t+")?")}function rR(t,e,n,r){if(typeof t!="string")return!1;Age(n);const i=r(t);return typeof n=="string"||typeof n=="number"?i.toLowerCase().includes(n.toString().toLowerCase()):typeof n=="function"?n(i,e):Oge(n,i)}function Yv(t,e,n,r){if(typeof t!="string")return!1;Age(n);const i=r(t);return n instanceof Function?n(i,e):n instanceof RegExp?Oge(n,i):i===String(n)}function Mge(t){let{trim:e=!0,collapseWhitespace:n=!0}=t===void 0?{}:t;return r=>{let i=r;return i=e?i.trim():i,i=n?i.replace(/\s+/g," "):i,i}}function QT(t){let{trim:e,collapseWhitespace:n,normalizer:r}=t;if(!r)return Mge({trim:e,collapseWhitespace:n});if(typeof e<"u"||typeof n<"u")throw new Error('trim and collapseWhitespace are not supported with a normalizer. If you want to use the default trim and collapseWhitespace logic in your normalizer, use "getDefaultNormalizer({trim, collapseWhitespace})" and compose that into your normalizer');return r}function Oge(t,e){const n=t.test(e);return t.global&&t.lastIndex!==0&&(console.warn("To match all elements we had to reset the lastIndex of the RegExp because the global flag is enabled. We encourage to remove the global flag from the RegExp."),t.lastIndex=0),n}function S6(t){return t.matches("input[type=submit], input[type=button], input[type=reset]")?t.value:Array.from(t.childNodes).filter(e=>e.nodeType===xge&&!!e.textContent).map(e=>e.textContent).join("")}const utt=htt(mge);function Nge(t){return t.hidden===!0||t.getAttribute("aria-hidden")==="true"||t.ownerDocument.defaultView.getComputedStyle(t).display==="none"}function x9(t,e){e===void 0&&(e={});const{isSubtreeInaccessible:n=Nge}=e;if(t.ownerDocument.defaultView.getComputedStyle(t).visibility==="hidden")return!0;let i=t;for(;i;){if(n(i))return!0;i=i.parentElement}return!1}function w9(t){for(const{match:e,roles:n}of utt)if(e(t))return[...n];return[]}function htt(t){function e(a){let{name:o,attributes:c}=a;return""+o+c.map(l=>{let{name:u,value:h,constraints:d=[]}=l;const f=d.indexOf("undefined")!==-1,p=d.indexOf("set")!==-1;return typeof h<"u"?"["+u+'="'+h+'"]':f?":not(["+u+"])":p?"["+u+"]:not(["+u+'=""])':"["+u+"]"}).join("")}function n(a){let{attributes:o=[]}=a;return o.length}function r(a,o){let{specificity:c}=a,{specificity:l}=o;return l-c}function i(a){let{attributes:o=[]}=a;const c=o.findIndex(u=>u.value&&u.name==="type"&&u.value==="text");c>=0&&(o=[...o.slice(0,c),...o.slice(c+1)]);const l=e({...a,attributes:o});return u=>c>=0&&u.type!=="text"?!1:u.matches(l)}let s=[];for(const[a,o]of t.entries())s=[...s,{match:i(a),roles:Array.from(o),specificity:n(a)}];return s.sort(r)}function dtt(t,e){let{hidden:n=!1}=e===void 0?{}:e;function r(i){return[i,...Array.from(i.children).reduce((s,a)=>[...s,...r(a)],[])]}return r(t).filter(i=>n===!1?x9(i)===!1:!0).reduce((i,s)=>{let a=[];return s.hasAttribute("role")?a=s.getAttribute("role").split(" ").slice(0,1):a=w9(s),a.reduce((o,c)=>Array.isArray(o[c])?{...o,[c]:[...o[c],s]}:{...o,[c]:[s]},i)},{})}function ftt(t,e){let{hidden:n,includeDescription:r}=e;const i=dtt(t,{hidden:n});return Object.entries(i).filter(s=>{let[a]=s;return a!=="generic"}).map(s=>{let[a,o]=s;const c="-".repeat(50),l=o.map(u=>{const h='Name "'+y9(u,{computedStyleSupportsPseudoElements:as().computedStyleSupportsPseudoElements})+`":
`,d=lU(u.cloneNode(!1));if(r){const f='Description "'+rge(u,{computedStyleSupportsPseudoElements:as().computedStyleSupportsPseudoElements})+`":
`;return""+h+f+d}return""+h+d}).join(`

`);return a+`:

`+l+`

`+c}).join(`
`)}function ptt(t){return t.tagName==="OPTION"?t.selected:lI(t,"aria-selected")}function mtt(t){return t.getAttribute("aria-busy")==="true"}function gtt(t){if(!("indeterminate"in t&&t.indeterminate))return"checked"in t?t.checked:lI(t,"aria-checked")}function vtt(t){return lI(t,"aria-pressed")}function ytt(t){var e,n;return(e=(n=lI(t,"aria-current"))!=null?n:t.getAttribute("aria-current"))!=null?e:!1}function _tt(t){return lI(t,"aria-expanded")}function lI(t,e){const n=t.getAttribute(e);if(n==="true")return!0;if(n==="false")return!1}function btt(t){const e={H1:1,H2:2,H3:3,H4:4,H5:5,H6:6};return t.getAttribute("aria-level")&&Number(t.getAttribute("aria-level"))||e[t.tagName]}function Ett(t){const e=t.getAttribute("aria-valuenow");return e===null?void 0:+e}function Stt(t){const e=t.getAttribute("aria-valuemax");return e===null?void 0:+e}function Ttt(t){const e=t.getAttribute("aria-valuemin");return e===null?void 0:+e}function xtt(t){const e=t.getAttribute("aria-valuetext");return e===null?void 0:e}const jte=Mge();function wtt(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function Vte(t){return new RegExp(wtt(t.toLowerCase()),"i")}function h_(t,e,n,r){let{variant:i,name:s}=r,a="";const o={},c=[["Role","TestId"].includes(t)?n:Vte(n)];s&&(o.name=Vte(s)),t==="Role"&&x9(e)&&(o.hidden=!0,a=`Element is inaccessible. This means that the element and all its children are invisible to screen readers.
    If you are using the aria-hidden prop, make sure this is the right choice for your case.
    `),Object.keys(o).length>0&&c.push(o);const l=i+"By"+t;return{queryName:t,queryMethod:l,queryArgs:c,variant:i,warning:a,toString(){a&&console.warn(a);let[u,h]=c;return u=typeof u=="string"?"'"+u+"'":u,h=h?", { "+Object.entries(h).map(d=>{let[f,p]=d;return f+": "+p}).join(", ")+" }":"",l+"("+u+h+")"}}}function d_(t,e,n){return n&&!e}function eG(t,e,n){var r,i;if(e===void 0&&(e="get"),t.matches(as().defaultIgnore))return;const s=(r=t.getAttribute("role"))!=null?r:(i=w9(t))==null?void 0:i[0];if(s!=="generic"&&d_("Role",n,s))return h_("Role",t,s,{variant:e,name:y9(t,{computedStyleSupportsPseudoElements:as().computedStyleSupportsPseudoElements})});const a=Rge(document,t).map(d=>d.content).join(" ");if(d_("LabelText",n,a))return h_("LabelText",t,a,{variant:e});const o=t.getAttribute("placeholder");if(d_("PlaceholderText",n,o))return h_("PlaceholderText",t,o,{variant:e});const c=jte(S6(t));if(d_("Text",n,c))return h_("Text",t,c,{variant:e});if(d_("DisplayValue",n,t.value))return h_("DisplayValue",t,jte(t.value),{variant:e});const l=t.getAttribute("alt");if(d_("AltText",n,l))return h_("AltText",t,l,{variant:e});const u=t.getAttribute("title");if(d_("Title",n,u))return h_("Title",t,u,{variant:e});const h=t.getAttribute(as().testIdAttribute);if(d_("TestId",n,h))return h_("TestId",t,h,{variant:e})}function _D(t,e){t.stack=e.stack.replace(e.message,t.message)}function Ctt(t,e){let{container:n=T9(),timeout:r=as().asyncUtilTimeout,showOriginalStackTrace:i=as().showOriginalStackTrace,stackTraceError:s,interval:a=50,onTimeout:o=l=>(Object.defineProperty(l,"message",{value:as().getElementError(l.message,n).message}),l),mutationObserverOptions:c={subtree:!0,childList:!0,attributes:!0,characterData:!0}}=e;if(typeof t!="function")throw new TypeError("Received `callback` arg must be a function");return new Promise(async(l,u)=>{let h,d,f,p=!1,g="idle";const _=setTimeout(N,r),v=FH();if(v){const{unstable_advanceTimersWrapper:A}=as();for(x();!p;){if(!FH()){const I=new Error("Changed from using fake timers to real timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to real timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");i||_D(I,s),u(I);return}if(await A(async()=>{jest.advanceTimersByTime(a)}),p)break;x()}}else{try{Ey(n)}catch(I){u(I);return}d=setInterval(T,a);const{MutationObserver:A}=ttt(n);f=new A(T),f.observe(n,c),x()}function E(A,I){p=!0,clearTimeout(_),v||(clearInterval(d),f.disconnect()),A?u(A):l(I)}function T(){if(FH()){const A=new Error("Changed from using real timers to fake timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to fake timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");return i||_D(A,s),u(A)}else return x()}function x(){if(g!=="pending")try{const A=ott(t);typeof(A==null?void 0:A.then)=="function"?(g="pending",A.then(I=>{g="resolved",E(null,I)},I=>{g="rejected",h=I})):E(null,A)}catch(A){h=A}}function N(){let A;h?(A=h,!i&&A.name==="TestingLibraryElementError"&&_D(A,s)):(A=new Error("Timed out in waitFor."),i||_D(A,s)),E(o(A),null)}})}function Rtt(t,e){const n=new Error("STACK_TRACE_MESSAGE");return as().asyncWrapper(()=>Ctt(t,{stackTraceError:n,...e}))}function Ige(t,e){return as().getElementError(t,e)}function Att(t,e){return Ige(t+"\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).",e)}function T6(t,e,n,r){let{exact:i=!0,collapseWhitespace:s,trim:a,normalizer:o}=r===void 0?{}:r;const c=i?Yv:rR,l=QT({collapseWhitespace:s,trim:a,normalizer:o});return Array.from(e.querySelectorAll("["+t+"]")).filter(u=>c(u.getAttribute(t),u,n,l))}function hU(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const a=t(n,...i);if(a.length>1){const o=a.map(c=>Ige(null,c).message).join(`

`);throw Att(e(n,...i)+`

Here are the matching elements:

`+o,n)}return a[0]||null}}function kge(t,e){return as().getElementError(`A better query is available, try this:
`+t.toString()+`
`,e)}function Mtt(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const a=t(n,...i);if(!a.length)throw as().getElementError(e(n,...i),n);return a}}function dU(t){return(e,n,r,i)=>Rtt(()=>t(e,n,r),{container:e,...i})}const ww=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];const o=t(r,...s),[{suggest:c=as().throwSuggestions}={}]=s.slice(-1);if(o&&c){const l=eG(o,n);if(l&&!e.endsWith(l.queryName))throw kge(l.toString(),r)}return o},cp=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];const o=t(r,...s),[{suggest:c=as().throwSuggestions}={}]=s.slice(-1);if(o.length&&c){const l=[...new Set(o.map(u=>{var h;return(h=eG(u,n))==null?void 0:h.toString()}))];if(l.length===1&&!e.endsWith(eG(o[0],n).queryName))throw kge(l[0],r)}return o};function ex(t,e,n){const r=ww(hU(t,e),t.name,"query"),i=Mtt(t,n),s=hU(i,e),a=ww(s,t.name,"get"),o=cp(i,t.name.replace("query","get"),"getAll"),c=dU(cp(i,t.name,"findAll")),l=dU(ww(s,t.name,"find"));return[r,o,a,c,l]}function Ott(t){return Array.from(t.querySelectorAll("label,input")).map(e=>({node:e,textToMatch:QV(e)})).filter(e=>{let{textToMatch:n}=e;return n!==null})}const Ntt=function(t,e,n){let{exact:r=!0,trim:i,collapseWhitespace:s,normalizer:a}=n===void 0?{}:n;const o=r?Yv:rR,c=QT({collapseWhitespace:s,trim:i,normalizer:a});return Ott(t).filter(u=>{let{node:h,textToMatch:d}=u;return o(d,h,e,c)}).map(u=>{let{node:h}=u;return h})},xO=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:a,normalizer:o}=n===void 0?{}:n;Ey(t);const c=i?Yv:rR,l=QT({collapseWhitespace:s,trim:a,normalizer:o}),u=Array.from(t.querySelectorAll("*")).filter(h=>Cge(h).length||h.hasAttribute("aria-labelledby")).reduce((h,d)=>{const f=Rge(t,d,{selector:r});f.filter(g=>!!g.formControl).forEach(g=>{c(g.content,g.formControl,e,l)&&g.formControl&&h.push(g.formControl)});const p=f.filter(g=>!!g.content).map(g=>g.content);return c(p.join(" "),d,e,l)&&h.push(d),p.length>1&&p.forEach((g,_)=>{c(g,d,e,l)&&h.push(d);const v=[...p];v.splice(_,1),v.length>1&&c(v.join(" "),d,e,l)&&h.push(d)}),h},[]).concat(T6("aria-label",t,e,{exact:i,normalizer:l}));return Array.from(new Set(u)).filter(h=>h.matches(r))},AT=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=xO(t,e,...r);if(!s.length){const a=Ntt(t,e,...r);if(a.length){const o=a.map(c=>Itt(t,c)).filter(c=>!!c);throw o.length?as().getElementError(o.map(c=>"Found a label with the text of: "+e+", however the element associated with this label (<"+c+" />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <"+c+" />, you can use aria-label or aria-labelledby instead.").join(`

`),t):as().getElementError("Found a label with the text of: "+e+`, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`,t)}else throw as().getElementError("Unable to find a label with the text of: "+e,t)}return s};function Itt(t,e){const n=e.getAttribute("for");if(!n)return null;const r=t.querySelector('[id="'+n+'"]');return r?r.tagName.toLowerCase():null}const Dge=(t,e)=>"Found multiple elements with the text of: "+e,ktt=ww(hU(xO,Dge),xO.name,"query"),Pge=hU(AT,Dge),Dtt=dU(cp(AT,AT.name,"findAll")),Ptt=dU(ww(Pge,AT.name,"find")),Ltt=cp(AT,AT.name,"getAll"),Utt=ww(Pge,AT.name,"get"),Btt=cp(xO,xO.name,"queryAll"),tG=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ey(e[0]),T6("placeholder",...e)},Ftt=(t,e)=>"Found multiple elements with the placeholder text of: "+e,ztt=(t,e)=>"Unable to find an element with the placeholder text of: "+e,Htt=cp(tG,tG.name,"queryAll"),[jtt,Vtt,Gtt,qtt,$tt]=ex(tG,Ftt,ztt),nG=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:a,ignore:o=as().defaultIgnore,normalizer:c}=n===void 0?{}:n;Ey(t);const l=i?Yv:rR,u=QT({collapseWhitespace:s,trim:a,normalizer:c});let h=[];return typeof t.matches=="function"&&t.matches(r)&&(h=[t]),[...h,...Array.from(t.querySelectorAll(r))].filter(d=>!o||!d.matches(o)).filter(d=>l(S6(d),d,e,u))},Wtt=(t,e)=>"Found multiple elements with the text: "+e,Ytt=function(t,e,n){n===void 0&&(n={});const{collapseWhitespace:r,trim:i,normalizer:s,selector:a}=n,c=QT({collapseWhitespace:r,trim:i,normalizer:s})(e.toString()),l=c!==e.toString(),u=(a??"*")!=="*";return"Unable to find an element with the text: "+(l?c+" (normalized from '"+e+"')":e)+(u?", which matches selector '"+a+"'":"")+". This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible."},Xtt=cp(nG,nG.name,"queryAll"),[Ktt,Jtt,Ztt,Qtt,ent]=ex(nG,Wtt,Ytt),rG=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:a}=n===void 0?{}:n;Ey(t);const o=r?Yv:rR,c=QT({collapseWhitespace:i,trim:s,normalizer:a});return Array.from(t.querySelectorAll("input,textarea,select")).filter(l=>l.tagName==="SELECT"?Array.from(l.options).filter(h=>h.selected).some(h=>o(S6(h),h,e,c)):o(l.value,l,e,c))},tnt=(t,e)=>"Found multiple elements with the display value: "+e+".",nnt=(t,e)=>"Unable to find an element with the display value: "+e+".",rnt=cp(rG,rG.name,"queryAll"),[int,snt,ant,ont,cnt]=ex(rG,tnt,nnt),lnt=/^(img|input|area|.+-.+)$/i,iG=function(t,e,n){return n===void 0&&(n={}),Ey(t),T6("alt",t,e,n).filter(r=>lnt.test(r.tagName))},unt=(t,e)=>"Found multiple elements with the alt text: "+e,hnt=(t,e)=>"Unable to find an element with the alt text: "+e,dnt=cp(iG,iG.name,"queryAll"),[fnt,pnt,mnt,gnt,vnt]=ex(iG,unt,hnt),ynt=t=>{var e;return t.tagName.toLowerCase()==="title"&&((e=t.parentElement)==null?void 0:e.tagName.toLowerCase())==="svg"},sG=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:a}=n===void 0?{}:n;Ey(t);const o=r?Yv:rR,c=QT({collapseWhitespace:i,trim:s,normalizer:a});return Array.from(t.querySelectorAll("[title], svg > title")).filter(l=>o(l.getAttribute("title"),l,e,c)||ynt(l)&&o(S6(l),l,e,c))},_nt=(t,e)=>"Found multiple elements with the title: "+e+".",bnt=(t,e)=>"Unable to find an element with the title: "+e+".",Ent=cp(sG,sG.name,"queryAll"),[Snt,Tnt,xnt,wnt,Cnt]=ex(sG,_nt,bnt),aG=function(t,e,n){let{hidden:r=as().defaultHidden,name:i,description:s,queryFallbacks:a=!1,selected:o,busy:c,checked:l,pressed:u,current:h,level:d,expanded:f,value:{now:p,min:g,max:_,text:v}={}}=n===void 0?{}:n;if(Ey(t),o!==void 0){var E;if(((E=Hp.get(e))==null?void 0:E.props["aria-selected"])===void 0)throw new Error('"aria-selected" is not supported on role "'+e+'".')}if(c!==void 0){var T;if(((T=Hp.get(e))==null?void 0:T.props["aria-busy"])===void 0)throw new Error('"aria-busy" is not supported on role "'+e+'".')}if(l!==void 0){var x;if(((x=Hp.get(e))==null?void 0:x.props["aria-checked"])===void 0)throw new Error('"aria-checked" is not supported on role "'+e+'".')}if(u!==void 0){var N;if(((N=Hp.get(e))==null?void 0:N.props["aria-pressed"])===void 0)throw new Error('"aria-pressed" is not supported on role "'+e+'".')}if(h!==void 0){var A;if(((A=Hp.get(e))==null?void 0:A.props["aria-current"])===void 0)throw new Error('"aria-current" is not supported on role "'+e+'".')}if(d!==void 0&&e!=="heading")throw new Error('Role "'+e+'" cannot have "level" property.');if(p!==void 0){var I;if(((I=Hp.get(e))==null?void 0:I.props["aria-valuenow"])===void 0)throw new Error('"aria-valuenow" is not supported on role "'+e+'".')}if(_!==void 0){var k;if(((k=Hp.get(e))==null?void 0:k.props["aria-valuemax"])===void 0)throw new Error('"aria-valuemax" is not supported on role "'+e+'".')}if(g!==void 0){var L;if(((L=Hp.get(e))==null?void 0:L.props["aria-valuemin"])===void 0)throw new Error('"aria-valuemin" is not supported on role "'+e+'".')}if(v!==void 0){var U;if(((U=Hp.get(e))==null?void 0:U.props["aria-valuetext"])===void 0)throw new Error('"aria-valuetext" is not supported on role "'+e+'".')}if(f!==void 0){var $;if((($=Hp.get(e))==null?void 0:$.props["aria-expanded"])===void 0)throw new Error('"aria-expanded" is not supported on role "'+e+'".')}const q=new WeakMap;function G(X){return q.has(X)||q.set(X,Nge(X)),q.get(X)}return Array.from(t.querySelectorAll(Rnt(e))).filter(X=>{if(X.hasAttribute("role")){const Z=X.getAttribute("role");if(a)return Z.split(" ").filter(Boolean).some(ee=>ee===e);const[Y]=Z.split(" ");return Y===e}return w9(X).some(Z=>Z===e)}).filter(X=>{if(o!==void 0)return o===ptt(X);if(c!==void 0)return c===mtt(X);if(l!==void 0)return l===gtt(X);if(u!==void 0)return u===vtt(X);if(h!==void 0)return h===ytt(X);if(f!==void 0)return f===_tt(X);if(d!==void 0)return d===btt(X);if(p!==void 0||_!==void 0||g!==void 0||v!==void 0){let V=!0;if(p!==void 0&&V&&(V=p===Ett(X)),_!==void 0&&V&&(V=_===Stt(X)),g!==void 0&&V&&(V=g===Ttt(X)),v!==void 0){var re;V&&(V=Yv((re=xtt(X))!=null?re:null,X,v,Z=>Z))}return V}return!0}).filter(X=>i===void 0?!0:Yv(y9(X,{computedStyleSupportsPseudoElements:as().computedStyleSupportsPseudoElements}),X,i,re=>re)).filter(X=>s===void 0?!0:Yv(rge(X,{computedStyleSupportsPseudoElements:as().computedStyleSupportsPseudoElements}),X,s,re=>re)).filter(X=>r===!1?x9(X,{isSubtreeInaccessible:G})===!1:!0)};function Rnt(t){var e;const n='*[role~="'+t+'"]',r=(e=gge.get(t))!=null?e:new Set,i=new Set(Array.from(r).map(s=>{let{name:a}=s;return a}));return[n].concat(Array.from(i)).join(",")}const Lge=t=>{let e="";return t===void 0?e="":typeof t=="string"?e=' and name "'+t+'"':e=" and name `"+t+"`",e},Ant=function(t,e,n){let{name:r}=n===void 0?{}:n;return'Found multiple elements with the role "'+e+'"'+Lge(r)},Mnt=function(t,e,n){let{hidden:r=as().defaultHidden,name:i,description:s}=n===void 0?{}:n;if(as()._disableExpensiveErrorDiagnostics)return'Unable to find role="'+e+'"'+Lge(i);let a="";Array.from(t.children).forEach(u=>{a+=ftt(u,{hidden:r,includeDescription:s!==void 0})});let o;a.length===0?r===!1?o="There are no accessible roles. But there might be some inaccessible roles. If you wish to access them, then set the `hidden` option to `true`. Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole":o="There are no available roles.":o=(`
Here are the `+(r===!1?"accessible":"available")+` roles:

  `+a.replace(/\n/g,`
  `).replace(/\n\s\s\n/g,`

`)+`
`).trim();let c="";i===void 0?c="":typeof i=="string"?c=' and name "'+i+'"':c=" and name `"+i+"`";let l="";return s===void 0?l="":typeof s=="string"?l=' and description "'+s+'"':l=" and description `"+s+"`",(`
Unable to find an `+(r===!1?"accessible ":"")+'element with the role "'+e+'"'+c+l+`

`+o).trim()},Ont=cp(aG,aG.name,"queryAll"),[Nnt,Int,knt,Dnt,Pnt]=ex(aG,Ant,Mnt),C9=()=>as().testIdAttribute,oG=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ey(e[0]),T6(C9(),...e)},Lnt=(t,e)=>"Found multiple elements by: ["+C9()+'="'+e+'"]',Unt=(t,e)=>"Unable to find an element by: ["+C9()+'="'+e+'"]',Bnt=cp(oG,oG.name,"queryAll"),[Fnt,znt,Hnt,jnt,Vnt]=ex(oG,Lnt,Unt);var cG=Object.freeze({__proto__:null,queryAllByLabelText:Btt,queryByLabelText:ktt,getAllByLabelText:Ltt,getByLabelText:Utt,findAllByLabelText:Dtt,findByLabelText:Ptt,queryByPlaceholderText:jtt,queryAllByPlaceholderText:Htt,getByPlaceholderText:Gtt,getAllByPlaceholderText:Vtt,findAllByPlaceholderText:qtt,findByPlaceholderText:$tt,queryByText:Ktt,queryAllByText:Xtt,getByText:Ztt,getAllByText:Jtt,findAllByText:Qtt,findByText:ent,queryByDisplayValue:int,queryAllByDisplayValue:rnt,getByDisplayValue:ant,getAllByDisplayValue:snt,findAllByDisplayValue:ont,findByDisplayValue:cnt,queryByAltText:fnt,queryAllByAltText:dnt,getByAltText:mnt,getAllByAltText:pnt,findAllByAltText:gnt,findByAltText:vnt,queryByTitle:Snt,queryAllByTitle:Ent,getByTitle:xnt,getAllByTitle:Tnt,findAllByTitle:wnt,findByTitle:Cnt,queryByRole:Nnt,queryAllByRole:Ont,getAllByRole:Int,getByRole:knt,findAllByRole:Dnt,findByRole:Pnt,queryByTestId:Fnt,queryAllByTestId:Bnt,getByTestId:Hnt,getAllByTestId:znt,findAllByTestId:jnt,findByTestId:Vnt});function Gnt(t,e,n){return e===void 0&&(e=cG),n===void 0&&(n={}),Object.keys(e).reduce((r,i)=>{const s=e[i];return r[i]=s.bind(null,t),r},n)}const qnt={copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionEnd:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionStart:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionUpdate:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyDown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyPress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyUp:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusIn:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusOut:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},invalid:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!0}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},reset:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},click:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,button:0,composed:!0}},contextMenu:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblClick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drag:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragEnd:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragEnter:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragExit:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragLeave:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragOver:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragStart:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drop:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseDown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseEnter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseLeave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseMove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOut:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOver:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseUp:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},select:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},touchCancel:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},touchEnd:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchMove:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchStart:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},resize:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},scroll:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},wheel:{EventType:"WheelEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},abort:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlay:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlayThrough:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},durationChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},emptied:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},encrypted:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},ended:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedData:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedMetadata:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadStart:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},pause:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},play:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},playing:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},progress:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},rateChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeked:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeking:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},stalled:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},suspend:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},timeUpdate:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},volumeChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},waiting:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},load:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},error:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},animationStart:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationEnd:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationIteration:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionCancel:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionEnd:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},transitionRun:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionStart:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},pointerOver:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerEnter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerDown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerMove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerUp:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerCancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerOut:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerLeave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},gotPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},lostPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},popState:{EventType:"PopStateEvent",defaultInit:{bubbles:!0,cancelable:!1}},offline:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},online:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},pageHide:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},pageShow:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}}},$nt={doubleClick:"dblClick"};Object.keys(qnt).forEach(t=>{t.toLowerCase()});Object.keys($nt).forEach(t=>{});function Wnt(t){return t.replace(/[ \t]*[\n][ \t]*/g,`
`)}function Ynt(t){return zet.compressToEncodedURIComponent(Wnt(t))}function Xnt(t){return"https://testing-playground.com/#markup="+Ynt(t)}const Knt=(t,e,n)=>Array.isArray(t)?t.forEach(r=>Hte(r,e,n)):Hte(t,e,n),Jnt=function(t){if(t===void 0&&(t=T9().body),!t||!("innerHTML"in t)){console.log("The element you're providing isn't a valid DOM element.");return}if(!t.innerHTML){console.log("The provided element doesn't have any children.");return}const e=Xnt(t.innerHTML);return console.log(`Open this URL in your browser

`+e),e},Gte={debug:Knt,logTestingPlaygroundURL:Jnt};typeof document<"u"&&document.body?Gnt(document.body,cG,Gte):Object.keys(cG).reduce((t,e)=>(t[e]=()=>{throw new TypeError("For queries bound to document.body a global document has to be available... Learn more: https://testing-library.com/s/screen-global-error")},t),Gte);function bC(t,e){return as().eventWrapper(t)}function kb(t){const e=Sqe(t,f9),n=JN(t.ownerDocument);(e??t.ownerDocument.body)!==n&&(bC(e?()=>e.focus():()=>n==null?void 0:n.blur()),wqe(e??t.ownerDocument.body))}function Znt(t){!f9(t)||!(JN(t.ownerDocument)===t)||bC(()=>t.blur())}const Db={};Db.click=(t,e,n)=>{const r=e.closest("button,input,label,select,textarea"),i=r&&mi(r,"label")&&r.control;if(i&&i!==e)return()=>{f9(i)&&(kb(i),n.dispatchEvent(i,Eqe(t)))};if(mi(e,"input",{type:"file"}))return()=>{Znt(e),e.dispatchEvent(new(mp(e)).Event("fileDialog")),kb(e)}};const EC=Symbol("Displayed value in UI"),Hv=Symbol("Displayed selection in UI"),fU=Symbol("Initial value to compare on blur");function Qnt(t){return typeof t=="object"&&EC in t}function ert(t){return!!t&&typeof t=="object"&&Hv in t}function trt(t,e){t[fU]===void 0&&(t[fU]=t.value),t[EC]=e,t.value=Object.assign(new String(e),{[EC]:!0})}function o0(t){return t[EC]===void 0?t.value:String(t[EC])}function R9(t){t[EC]=void 0}function Uge(t){t[fU]=void 0}function nrt(t){return t[fU]}function rrt(t,e){t[Hv]=e}function iR(t,{focusOffset:e,anchorOffset:n=e},r="replace"){const i=o0(t).length,s=h=>Math.max(0,Math.min(i,h)),a=r==="replace"||t[Hv]===void 0?s(n):t[Hv].anchorOffset,o=s(e),c=Math.min(a,o),l=Math.max(a,o);if(t[Hv]={anchorOffset:a,focusOffset:o},t.selectionStart===c&&t.selectionEnd===l)return;const u=Object.assign(new Number(c),{[Hv]:!0});try{t.setSelectionRange(u,l)}catch{}}function wO(t){var e,n,r;const i=(r=t[Hv])!==null&&r!==void 0?r:{anchorOffset:(e=t.selectionStart)!==null&&e!==void 0?e:0,focusOffset:(n=t.selectionEnd)!==null&&n!==void 0?n:0};return{...i,startOffset:Math.min(i.anchorOffset,i.focusOffset),endOffset:Math.max(i.anchorOffset,i.focusOffset)}}function irt(t){return!!t[Hv]}function SP(t){t[Hv]=void 0}const pU=globalThis.parseInt;function srt(t){const e=t.replace(/\D/g,"");if(e.length<2)return t;const n=pU(e[0],10),r=pU(e[1],10);if(n>=3||n===2&&r>=4){let i;return n>=3?i=1:i=2,qte(e,i)}return t.length===2?t:qte(e,2)}function qte(t,e){const n=t.slice(0,e),r=Math.min(pU(n,10),23),i=t.slice(e),s=pU(i,10),a=Math.min(s,59);return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}function Bge(t,e){const n=t.cloneNode();return n.value=e,n.value===e}var Fge=function(t){return t.email="email",t.password="password",t.search="search",t.telephone="telephone",t.text="text",t.url="url",t}(Fge||{});function art(t){var e;const n=(e=t.getAttribute("maxlength"))!==null&&e!==void 0?e:"";return/^\d+$/.test(n)&&Number(n)>=0?Number(n):void 0}function ort(t){return mi(t,"textarea")||mi(t,"input")&&t.type in Fge}function zge(t,e,n,r){if(TP(t)&&e+n>=0&&e+n<=t.nodeValue.length)return{node:t,offset:e+n};const i=$te(t,e,n);if(i){if(TP(i))return{node:i,offset:n>0?Math.min(1,i.nodeValue.length):Math.max(i.nodeValue.length-1,0)};if(mi(i,"br")){const s=$te(i,void 0,n);return s?TP(s)?{node:s,offset:n>0?0:s.nodeValue.length}:n<0&&mi(s,"br")?{node:i.parentNode,offset:bD(i)}:{node:s.parentNode,offset:bD(s)+(n>0?0:1)}:n<0&&r==="deleteContentBackward"?{node:i.parentNode,offset:bD(i)}:void 0}else return{node:i.parentNode,offset:bD(i)+(n>0?1:0)}}}function $te(t,e,n){const r=Number(e)+(n<0?-1:0);return e!==void 0&&A9(t)&&r>=0&&r<t.children.length&&(t=t.children[r]),lrt(t,n===1?"next":"previous",crt)}function crt(t){if(TP(t))return!0;if(A9(t)){if(mi(t,["input","textarea"]))return t.type!=="hidden";if(mi(t,"br"))return!0}return!1}function bD(t){let e=0;for(;t.previousSibling;)e++,t=t.previousSibling;return e}function A9(t){return t.nodeType===1}function TP(t){return t.nodeType===3}function lrt(t,e,n){for(;;){var r;const i=t[`${e}Sibling`];if(i){if(t=urt(i,e==="next"?"first":"last"),n(t))return t}else if(t.parentNode&&(!A9(t.parentNode)||!RT(t.parentNode)&&t.parentNode!==((r=t.ownerDocument)===null||r===void 0?void 0:r.body)))t=t.parentNode;else break}}function urt(t,e){for(;t.hasChildNodes();)t=t[`${e}Child`];return t}const CO=Symbol("Track programmatic changes for React workaround");function hrt(t){return Object.getOwnPropertyNames(t).some(e=>e.startsWith("__react"))&&mp(t).REACT_VERSION===17}function drt(t){hrt(t)&&(t[CO]={previousValue:String(t.value),tracked:[]})}function frt(t,e){var n,r;(r=t[CO])===null||r===void 0||(n=r.tracked)===null||n===void 0||n.push(e),t[CO]||(R9(t),iR(t,{focusOffset:e.length}))}function prt(t,e){var n;const r=t[CO];if(t[CO]=void 0,!(!(r==null||(n=r.tracked)===null||n===void 0)&&n.length))return;const i=r.tracked.length===2&&r.tracked[0]===r.previousValue&&r.tracked[1]===t.value;i||R9(t),irt(t)&&iR(t,{focusOffset:i?e:t.value.length})}function Hge(t){const e=mrt(t);if(e&&a0(e))return{type:"input",selection:wO(e)};const n=e==null?void 0:e.ownerDocument.getSelection();return{type:_O(t)&&(n==null?void 0:n.anchorNode)&&_O(n.anchorNode)?"contenteditable":"default",selection:n}}function mrt(t){return t.nodeType===1?t:t.parentElement}function grt(t){const e=Hge(t);if(e.type==="input")return e.selection;if(e.type==="contenteditable"){var n;return(n=e.selection)===null||n===void 0?void 0:n.getRangeAt(0)}}function MT({focusNode:t,focusOffset:e,anchorNode:n=t,anchorOffset:r=e}){var i,s;if(Hge(t).type==="input")return iR(t,{anchorOffset:r,focusOffset:e});(s=n.ownerDocument)===null||s===void 0||(i=s.getSelection())===null||i===void 0||i.setBaseAndExtent(n,r,t,e)}function jge(t){return mi(t,"input")&&["date","time"].includes(t.type)}function SC(t,e,n,r="insertText"){const i=grt(e);i&&(!jge(e)&&!t.dispatchUIEvent(e,"beforeinput",{inputType:r,data:n})||("startContainer"in i?vrt(t,e,i,n,r):yrt(t,e,i,n,r)))}function vrt(t,e,n,r,i){let s=!1;if(!n.collapsed)s=!0,n.deleteContents();else if(["deleteContentBackward","deleteContentForward"].includes(i)){const a=zge(n.startContainer,n.startOffset,i==="deleteContentBackward"?-1:1,i);if(a){s=!0;const o=n.cloneRange();o.comparePoint(a.node,a.offset)<0?o.setStart(a.node,a.offset):o.setEnd(a.node,a.offset),o.deleteContents()}}if(r)if(n.endContainer.nodeType===3){const a=n.endOffset;n.endContainer.insertData(a,r),n.setStart(n.endContainer,a+r.length),n.setEnd(n.endContainer,a+r.length)}else{const a=e.ownerDocument.createTextNode(r);n.insertNode(a),n.setStart(a,r.length),n.setEnd(a,r.length)}(s||r)&&t.dispatchUIEvent(e,"input",{inputType:i})}function yrt(t,e,n,r,i){let s=r;if(ort(e)){const l=art(e);if(l!==void 0&&r.length>0){const u=l-e.value.length;if(u>0)s=r.substring(0,u);else return}}const{newValue:a,newOffset:o,oldValue:c}=_rt(s,e,n,i);a===c&&o===n.startOffset&&o===n.endOffset||mi(e,"input",{type:"number"})&&!brt(a)||(trt(e,a),MT({focusNode:e,anchorOffset:o,focusOffset:o}),jge(e)?Bge(e,a)&&(Wte(t,e,o,{}),t.dispatchUIEvent(e,"change"),Uge(e)):Wte(t,e,o,{data:r,inputType:i}))}function _rt(t,e,{startOffset:n,endOffset:r},i){const s=o0(e),a=Math.max(0,n===r&&i==="deleteContentBackward"?n-1:n),o=s.substring(0,a),c=Math.min(s.length,n===r&&i==="deleteContentForward"?n+1:r),l=s.substring(c,s.length);let u=`${o}${t}${l}`,h=a+t.length;if(mi(e,"input",{type:"time"})){const d=srt(u);d!==""&&Bge(e,d)&&(u=d,h=d.length)}return{oldValue:s,newValue:u,newOffset:h}}function Wte(t,e,n,r){t.dispatchUIEvent(e,"input",r),prt(e,n)}function brt(t){var e,n;const r=t.split("e",2);return!(/[^\d.\-e]/.test(t)||Number((e=t.match(/-/g))===null||e===void 0?void 0:e.length)>2||Number((n=t.match(/\./g))===null||n===void 0?void 0:n.length)>1||r[1]&&!/^-?\d*$/.test(r[1]))}Db.cut=(t,e,n)=>()=>{yC(e)&&SC(n,e,"","deleteByCut")};function Ert(t){return t?RT(t)?t.textContent:o0(t):null}function Srt(t){const e=mp(t);for(let n=t;n!=null&&n.ownerDocument;n=n.parentElement){const{display:r,visibility:i}=e.getComputedStyle(n);if(r==="none"||i==="hidden")return!1}return!0}function Trt(t,e){const n=t.ownerDocument,r=n.querySelectorAll(tme),i=Array.from(r).filter(c=>c===t||!(Number(c.getAttribute("tabindex"))<0||ly(c)));Number(t.getAttribute("tabindex"))>=0&&i.sort((c,l)=>{const u=Number(c.getAttribute("tabindex")),h=Number(l.getAttribute("tabindex"));return u===h?0:u===0?1:h===0?-1:u-h});const s={};let a=[n.body];const o=mi(t,"input",{type:"radio"})?t.name:void 0;i.forEach(c=>{const l=c;if(mi(l,"input",{type:"radio"})&&l.name){if(l===t){a.push(l);return}else if(l.name===o)return;if(l.checked){a=a.filter(u=>!mi(u,"input",{type:"radio",name:l.name})),a.push(l),s[l.name]=l;return}if(typeof s[l.name]<"u")return}a.push(l)});for(let c=a.findIndex(l=>l===t);;)if(c+=e?-1:1,c===a.length?c=0:c===-1&&(c=a.length-1),a[c]===t||a[c]===n.body||Srt(a[c]))return a[c]}function Yte(t,e){if(a0(t)){const n=wO(t);MT({focusNode:t,focusOffset:n.startOffset===n.endOffset?n.focusOffset+e:e<0?n.startOffset:n.endOffset})}else{const n=t.ownerDocument.getSelection();if(!(n!=null&&n.focusNode))return;if(n.isCollapsed){const r=zge(n.focusNode,n.focusOffset,e);r&&MT({focusNode:r.node,focusOffset:r.offset})}else n[e<0?"collapseToStart":"collapseToEnd"]()}}function Vge(t){if(a0(t))return MT({focusNode:t,anchorOffset:0,focusOffset:o0(t).length});var e;const n=(e=_O(t))!==null&&e!==void 0?e:t.ownerDocument.body;MT({focusNode:n,anchorOffset:0,focusOffset:n.childNodes.length})}function xrt(t){if(a0(t))return wO(t).startOffset===0&&wO(t).endOffset===o0(t).length;var e;const n=(e=_O(t))!==null&&e!==void 0?e:t.ownerDocument.body,r=t.ownerDocument.getSelection();return(r==null?void 0:r.anchorNode)===n&&r.focusNode===n&&r.anchorOffset===0&&r.focusOffset===n.childNodes.length}function TA(t,e,n){var r;if(a0(t))return MT({focusNode:t,anchorOffset:e,focusOffset:n});if(RT(t)&&((r=t.firstChild)===null||r===void 0?void 0:r.nodeType)===3)return MT({focusNode:t.firstChild,anchorOffset:e,focusOffset:n});throw new Error("Not implemented. The result of this interaction is unreliable.")}function ED(t,e,n){const r=mp(e),i=Array.from(e.ownerDocument.querySelectorAll(e.name?`input[type="radio"][name="${r.CSS.escape(e.name)}"]`:'input[type="radio"][name=""], input[type="radio"]:not([name])'));for(let s=i.findIndex(a=>a===e)+n;;s+=n){if(i[s]||(s=n>0?0:i.length-1),i[s]===e)return;if(!ly(i[s])){kb(i[s]),t.dispatchUIEvent(i[s],"click");return}}}Db.keydown=(t,e,n)=>{var r,i;return(i=(r=Xte[t.key])===null||r===void 0?void 0:r.call(Xte,t,e,n))!==null&&i!==void 0?i:wrt(t,e,n)};const Xte={ArrowDown:(t,e,n)=>{if(mi(e,"input",{type:"radio"}))return()=>ED(n,e,1)},ArrowLeft:(t,e,n)=>mi(e,"input",{type:"radio"})?()=>ED(n,e,-1):()=>Yte(e,-1),ArrowRight:(t,e,n)=>mi(e,"input",{type:"radio"})?()=>ED(n,e,1):()=>Yte(e,1),ArrowUp:(t,e,n)=>{if(mi(e,"input",{type:"radio"}))return()=>ED(n,e,-1)},Backspace:(t,e,n)=>{if(yC(e))return()=>{SC(n,e,"","deleteContentBackward")}},Delete:(t,e,n)=>{if(yC(e))return()=>{SC(n,e,"","deleteContentForward")}},End:(t,e)=>{if(mi(e,["input","textarea"])||RT(e))return()=>{var n,r;const i=(r=(n=Ert(e))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0;TA(e,i,i)}},Home:(t,e)=>{if(mi(e,["input","textarea"])||RT(e))return()=>{TA(e,0,0)}},PageDown:(t,e)=>{if(mi(e,["input"]))return()=>{const n=o0(e).length;TA(e,n,n)}},PageUp:(t,e)=>{if(mi(e,["input"]))return()=>{TA(e,0,0)}},Tab:(t,e,n)=>()=>{const r=Trt(e,n.system.keyboard.modifiers.Shift);kb(r),a0(r)&&iR(r,{anchorOffset:0,focusOffset:r.value.length})}},wrt=(t,e,n)=>{if(t.code==="KeyA"&&n.system.keyboard.modifiers.Control)return()=>Vge(e)};Db.keypress=(t,e,n)=>{if(t.key==="Enter"){if(mi(e,"button")||mi(e,"input")&&Crt.includes(e.type)||mi(e,"a")&&e.href)return()=>{n.dispatchUIEvent(e,"click")};if(mi(e,"input")){const r=e.form,i=r==null?void 0:r.querySelector('input[type="submit"], button:not([type]), button[type="submit"]');return i?()=>n.dispatchUIEvent(i,"click"):r&&Rrt.includes(e.type)&&r.querySelectorAll("input").length===1?()=>n.dispatchUIEvent(r,"submit"):void 0}}if(yC(e)){const r=t.key==="Enter"?RT(e)&&!n.system.keyboard.modifiers.Shift?"insertParagraph":"insertLineBreak":"insertText",i=t.key==="Enter"?`
`:t.key;return()=>SC(n,e,i,r)}};const Crt=["button","color","file","image","reset","submit"],Rrt=["email","month","password","search","tel","text","url","week"];Db.keyup=(t,e,n)=>{var r;return(r=Kte[t.key])===null||r===void 0?void 0:r.call(Kte,t,e,n)};const Kte={" ":(t,e,n)=>{if(rme(e))return()=>n.dispatchUIEvent(e,"click")}};Db.paste=(t,e,n)=>{if(yC(e))return()=>{var r;const i=(r=t.clipboardData)===null||r===void 0?void 0:r.getData("text");i&&SC(n,e,i,"insertFromPaste")}};const Gge={auxclick:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},beforeinput:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},click:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},contextmenu:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblclick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusin:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusout:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},keydown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keypress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyup:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},mousedown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseenter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseleave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mousemove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseout:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseover:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseup:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerover:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerenter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerdown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointermove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerup:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointercancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerout:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerleave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}}};function qge(t){return Gge[t].EventType}const Art=["MouseEvent","PointerEvent"];function Mrt(t){return Art.includes(qge(t))}function Ort(t){return qge(t)==="KeyboardEvent"}const Nrt={ClipboardEvent:[krt],Event:[],FocusEvent:[nA,Drt],InputEvent:[nA,Prt],MouseEvent:[nA,zH,Jte],PointerEvent:[nA,zH,Jte,Urt],KeyboardEvent:[nA,zH,Lrt]};function $ge(t,e,n){const r=mp(e),{EventType:i,defaultInit:s}=Gge[t],a=new(Irt(r))[i](t,s);return Nrt[i].forEach(o=>o(a,n??{})),a}function Irt(t){var e;const n=(e=t.Event)!==null&&e!==void 0?e:class{};var r;const i=(r=t.AnimationEvent)!==null&&r!==void 0?r:class extends n{};var s;const a=(s=t.ClipboardEvent)!==null&&s!==void 0?s:class extends n{};var o;const c=(o=t.PopStateEvent)!==null&&o!==void 0?o:class extends n{};var l;const u=(l=t.ProgressEvent)!==null&&l!==void 0?l:class extends n{};var h;const d=(h=t.TransitionEvent)!==null&&h!==void 0?h:class extends n{};var f;const p=(f=t.UIEvent)!==null&&f!==void 0?f:class extends n{};var g;const _=(g=t.CompositionEvent)!==null&&g!==void 0?g:class extends p{};var v;const E=(v=t.FocusEvent)!==null&&v!==void 0?v:class extends p{};var T;const x=(T=t.InputEvent)!==null&&T!==void 0?T:class extends p{};var N;const A=(N=t.KeyboardEvent)!==null&&N!==void 0?N:class extends p{};var I;const k=(I=t.MouseEvent)!==null&&I!==void 0?I:class extends p{};var L;const U=(L=t.DragEvent)!==null&&L!==void 0?L:class extends k{};var $;const q=($=t.PointerEvent)!==null&&$!==void 0?$:class extends k{};var G;const X=(G=t.TouchEvent)!==null&&G!==void 0?G:class extends p{};return{Event:n,AnimationEvent:i,ClipboardEvent:a,PopStateEvent:c,ProgressEvent:u,TransitionEvent:d,UIEvent:p,CompositionEvent:_,FocusEvent:E,InputEvent:x,KeyboardEvent:A,MouseEvent:k,DragEvent:U,PointerEvent:q,TouchEvent:X}}function nE(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t,n,{get:()=>r??null})}function po(t){return Number(t??0)}function krt(t,{clipboardData:e}){nE(t,{clipboardData:e})}function Drt(t,{relatedTarget:e}){nE(t,{relatedTarget:e})}function Prt(t,{data:e,inputType:n,isComposing:r}){nE(t,{data:e,isComposing:!!r,inputType:String(n)})}function nA(t,{view:e,detail:n}){nE(t,{view:e,detail:po(n??0)})}function zH(t,{altKey:e,ctrlKey:n,metaKey:r,shiftKey:i,modifierAltGraph:s,modifierCapsLock:a,modifierFn:o,modifierFnLock:c,modifierNumLock:l,modifierScrollLock:u,modifierSymbol:h,modifierSymbolLock:d}){nE(t,{altKey:!!e,ctrlKey:!!n,metaKey:!!r,shiftKey:!!i,getModifierState(f){return!!{Alt:e,AltGraph:s,CapsLock:a,Control:n,Fn:o,FnLock:c,Meta:r,NumLock:l,ScrollLock:u,Shift:i,Symbol:h,SymbolLock:d}[f]}})}function Lrt(t,{key:e,code:n,location:r,repeat:i,isComposing:s,charCode:a}){nE(t,{key:String(e),code:String(n),location:po(r),repeat:!!i,isComposing:!!s,charCode:a})}function Jte(t,{x:e,y:n,screenX:r,screenY:i,clientX:s=e,clientY:a=n,button:o,buttons:c,relatedTarget:l,offsetX:u,offsetY:h,pageX:d,pageY:f}){nE(t,{screenX:po(r),screenY:po(i),clientX:po(s),x:po(s),clientY:po(a),y:po(a),button:po(o),buttons:po(c),relatedTarget:l,offsetX:po(u),offsetY:po(h),pageX:po(d),pageY:po(f)})}function Urt(t,{pointerId:e,width:n,height:r,pressure:i,tangentialPressure:s,tiltX:a,tiltY:o,twist:c,pointerType:l,isPrimary:u}){nE(t,{pointerId:po(e),width:po(n??1),height:po(r??1),pressure:po(i),tangentialPressure:po(s),tiltX:po(a),tiltY:po(o),twist:po(c),pointerType:String(l),isPrimary:!!u})}function Brt(t,e,n,r=!1){(Mrt(e)||Ort(e))&&(n={...n,...this.system.getUIEventModifiers()});const i=$ge(e,t,n);return Wge.call(this,t,i,r)}function Wge(t,e,n=!1){var r;const i=e.type,s=n?()=>{}:(r=Db[i])===null||r===void 0?void 0:r.call(Db,e,t,this);if(s){e.preventDefault();let a=!1;return Object.defineProperty(e,"defaultPrevented",{get:()=>a}),Object.defineProperty(e,"preventDefault",{value:()=>{a=e.cancelable}}),bC(()=>t.dispatchEvent(e)),a||s(),!a}return bC(()=>t.dispatchEvent(e))}function wS(t,e,n){const r=$ge(e,t,n);bC(()=>t.dispatchEvent(r))}const Zte=Symbol("patched focus/blur methods");function Yge(t){if(t.prototype[Zte])return;const{focus:e,blur:n}=t.prototype;Object.defineProperties(t.prototype,{focus:{configurable:!0,get:()=>i},blur:{configurable:!0,get:()=>s},[Zte]:{configurable:!0,get:()=>({focus:e,blur:n})}});let r;function i(a){if(this.ownerDocument.visibilityState!=="hidden")return e.call(this,a);const o=Qte(this.ownerDocument);if(o===this)return;const c=Symbol("focus call");r=c,o&&(n.call(o),wS(o,"blur",{relatedTarget:this}),wS(o,"focusout",{relatedTarget:r===c?this:null})),r===c&&(e.call(this,a),wS(this,"focus",{relatedTarget:o})),r===c&&wS(this,"focusin",{relatedTarget:o})}function s(){if(this.ownerDocument.visibilityState!=="hidden")return n.call(this);const a=Qte(this.ownerDocument);if(a!==this)return;r=Symbol("blur call"),n.call(this),wS(a,"blur",{relatedTarget:null}),wS(a,"focusout",{relatedTarget:null})}}function Qte(t){const e=JN(t);return(e==null?void 0:e.tagName)==="BODY"?null:e}const HH=Symbol("Interceptor for programmatical calls");function Z1(t,e,n){const r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=Object.getOwnPropertyDescriptor(t,e),s=r!=null&&r.set?"set":"value";if(typeof(r==null?void 0:r[s])!="function"||r[s][HH])throw new Error(`Element ${t.tagName} does not implement "${String(e)}".`);function a(...o){const{applyNative:c=!1,realArgs:l,then:u}=n.call(this,...o),h=(!c&&i||r)[s];s==="set"?h.call(this,l):h.call(this,...l),u==null||u()}a[HH]=HH,Object.defineProperty(t,e,{...i??r,[s]:a})}function Frt(t){Z1(t,"value",function(n){const r=Qnt(n);return r&&drt(this),{applyNative:!!r,realArgs:zrt(this,n),then:r?void 0:()=>frt(this,String(n))}})}function zrt(t,e){return mi(t,"input",{type:"number"})&&String(e)!==""&&!Number.isNaN(Number(e))?String(Number(e)):String(e)}function Hrt(t){Z1(t,"setSelectionRange",function(n,...r){const i=ert(n);return{applyNative:!!i,realArgs:[Number(n),...r],then:()=>i?void 0:SP(t)}}),Z1(t,"selectionStart",function(n){return{realArgs:n,then:()=>SP(t)}}),Z1(t,"selectionEnd",function(n){return{realArgs:n,then:()=>SP(t)}}),Z1(t,"select",function(){return{realArgs:[],then:()=>rrt(t,{anchorOffset:0,focusOffset:o0(t).length})}})}function jrt(t){Z1(t,"setRangeText",function(...n){return{realArgs:n,then:()=>{R9(t),SP(t)}}})}const Cw=Symbol("Node prepared with document state workarounds");function Xge(t){t[Cw]||(t.addEventListener("focus",e=>{const n=e.target;ene(n)},{capture:!0,passive:!0}),t.activeElement&&ene(t.activeElement),t.addEventListener("blur",e=>{const n=e.target,r=nrt(n);r!==void 0&&(n.value!==r&&wS(n,"change"),Uge(n))},{capture:!0,passive:!0}),t[Cw]=Cw)}function ene(t){t[Cw]||(mi(t,["input","textarea"])&&(Frt(t),Hrt(t),jrt(t)),t[Cw]=Cw)}function Vrt(t){return Grt(t)?t:t.ownerDocument}function Grt(t){return t.nodeType===9}var kd=function(t){return t[t.Trigger=2]="Trigger",t[t.Call=1]="Call",t}({});function xA(t,e){t.levelRefs[e]={}}function SD(t,e){return t.levelRefs[e]}function TC(t){const e=t.delay;if(typeof e=="number")return Promise.all([new Promise(n=>globalThis.setTimeout(()=>n(),e)),t.advanceTimers(e)])}var xP=function(t){return t[t.EachTrigger=4]="EachTrigger",t[t.EachApiCall=2]="EachApiCall",t[t.EachTarget=1]="EachTarget",t[t.Never=0]="Never",t}({});function cS(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var tg=function(t){return t[t.STANDARD=0]="STANDARD",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.NUMPAD=3]="NUMPAD",t}({});const qrt=["Alt","AltGraph","Control","Fn","Meta","Shift","Symbol"];function tne(t){return qrt.includes(t)}const $rt=["CapsLock","FnLock","NumLock","ScrollLock","SymbolLock"];function nne(t){return $rt.includes(t)}class Wrt{isKeyPressed(e){return this.pressed.has(String(e.code))}getPressedKeys(){return this.pressed.values().map(e=>e.keyDef)}async keydown(e,n){const r=String(n.key),i=String(n.code),s=bH(e.config.document);this.setKeydownTarget(s),this.pressed.add(i,n),tne(r)&&(this.modifiers[r]=!0);const a=e.dispatchUIEvent(s,"keydown",{key:r,code:i});nne(r)&&!this.modifiers[r]&&(this.modifiers[r]=!0,this.modifierLockStart[r]=!0),a&&this.pressed.setUnprevented(i),a&&this.hasKeyPress(r)&&e.dispatchUIEvent(bH(e.config.document),"keypress",{key:r,code:i,charCode:n.key==="Enter"?13:String(n.key).charCodeAt(0)})}async keyup(e,n){const r=String(n.key),i=String(n.code),s=this.pressed.isUnprevented(i);this.pressed.delete(i),tne(r)&&!this.pressed.values().find(a=>a.keyDef.key===r)&&(this.modifiers[r]=!1),e.dispatchUIEvent(bH(e.config.document),"keyup",{key:r,code:i},!s),nne(r)&&this.modifiers[r]&&(this.modifierLockStart[r]?this.modifierLockStart[r]=!1:this.modifiers[r]=!1)}setKeydownTarget(e){e!==this.lastKeydownTarget&&(this.carryChar=""),this.lastKeydownTarget=e}hasKeyPress(e){return(e.length===1||e==="Enter")&&!this.modifiers.Control&&!this.modifiers.Alt}constructor(e){cS(this,"system",void 0),cS(this,"modifiers",{Alt:!1,AltGraph:!1,CapsLock:!1,Control:!1,Fn:!1,FnLock:!1,Meta:!1,NumLock:!1,ScrollLock:!1,Shift:!1,Symbol:!1,SymbolLock:!1}),cS(this,"pressed",new class{add(n,r){var i,s,a;(a=(i=this.registry)[s=n])!==null&&a!==void 0||(i[s]={keyDef:r,unpreventedDefault:!1})}has(n){return!!this.registry[n]}setUnprevented(n){const r=this.registry[n];r&&(r.unpreventedDefault=!0)}isUnprevented(n){var r;return!!(!((r=this.registry[n])===null||r===void 0)&&r.unpreventedDefault)}delete(n){delete this.registry[n]}values(){return Object.values(this.registry)}constructor(){cS(this,"registry",{})}}),cS(this,"carryChar",""),cS(this,"lastKeydownTarget",void 0),cS(this,"modifierLockStart",{}),this.system=e}}const Yrt=[..."0123456789".split("").map(t=>({code:`Digit${t}`,key:t})),...")!@#$%^&*(".split("").map((t,e)=>({code:`Digit${e}`,key:t,shiftKey:!0})),..."abcdefghijklmnopqrstuvwxyz".split("").map(t=>({code:`Key${t.toUpperCase()}`,key:t})),..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(t=>({code:`Key${t}`,key:t,shiftKey:!0})),{code:"BracketLeft",key:"["},{code:"BracketLeft",key:"{",shiftKey:!0},{code:"BracketRight",key:"]"},{code:"BracketRight",key:"}",shiftKey:!0},{code:"Space",key:" "},{code:"AltLeft",key:"Alt",location:tg.LEFT},{code:"AltRight",key:"Alt",location:tg.RIGHT},{code:"ShiftLeft",key:"Shift",location:tg.LEFT},{code:"ShiftRight",key:"Shift",location:tg.RIGHT},{code:"ControlLeft",key:"Control",location:tg.LEFT},{code:"ControlRight",key:"Control",location:tg.RIGHT},{code:"MetaLeft",key:"Meta",location:tg.LEFT},{code:"MetaRight",key:"Meta",location:tg.RIGHT},{code:"OSLeft",key:"OS",location:tg.LEFT},{code:"OSRight",key:"OS",location:tg.RIGHT},{code:"ContextMenu",key:"ContextMenu"},{code:"Tab",key:"Tab"},{code:"CapsLock",key:"CapsLock"},{code:"Backspace",key:"Backspace"},{code:"Enter",key:"Enter"},{code:"Escape",key:"Escape"},{code:"ArrowUp",key:"ArrowUp"},{code:"ArrowDown",key:"ArrowDown"},{code:"ArrowLeft",key:"ArrowLeft"},{code:"ArrowRight",key:"ArrowRight"},{code:"Home",key:"Home"},{code:"End",key:"End"},{code:"Delete",key:"Delete"},{code:"PageUp",key:"PageUp"},{code:"PageDown",key:"PageDown"},{code:"Fn",key:"Fn"},{code:"Symbol",key:"Symbol"},{code:"AltRight",key:"AltGraph"}],Xrt=[{name:"MouseLeft",pointerType:"mouse",button:"primary"},{name:"MouseRight",pointerType:"mouse",button:"secondary"},{name:"MouseMiddle",pointerType:"mouse",button:"auxiliary"},{name:"TouchA",pointerType:"touch"},{name:"TouchB",pointerType:"touch"},{name:"TouchC",pointerType:"touch"}];function Krt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Kge{getButtons(){let e=0;for(const n of Object.keys(this.pressed))e|=2**Number(n);return e}down(e){const n=lG(e.button);if(n in this.pressed){this.pressed[n].push(e);return}return this.pressed[n]=[e],n}up(e){const n=lG(e.button);if(n in this.pressed&&(this.pressed[n]=this.pressed[n].filter(r=>r.name!==e.name),this.pressed[n].length===0))return delete this.pressed[n],n}constructor(){Krt(this,"pressed",{})}}const rne={primary:0,secondary:1,auxiliary:2,back:3,X1:3,forward:4,X2:4};function lG(t=0){return t in rne?rne[t]:Number(t)}const ine={1:2,2:1};function uG(t){return t=lG(t),t in ine?ine[t]:t}function Jrt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Zrt{get countPressed(){return this.pressedKeys.size}isPressed(e){return this.pressedKeys.has(e.name)}addPressed(e){return this.pressedKeys.add(e.name)}removePressed(e){return this.pressedKeys.delete(e.name)}constructor(){Jrt(this,"pressedKeys",new Set)}}function aM(t,e){const n=[];for(let s=t;s;s=s.parentElement)n.push(s);const r=[];for(let s=e;s;s=s.parentElement)r.push(s);let i=0;for(;!(i>=n.length||i>=r.length||n[n.length-1-i]!==r[r.length-1-i]);i++);return[n.slice(0,n.length-i),r.slice(0,r.length-i),r.slice(r.length-i)]}function hG({target:t,node:e,offset:n}){return a0(t)?{node:t,offset:n??o0(t).length}:e?{node:e,offset:n??(e.nodeType===3?e.nodeValue.length:e.childNodes.length)}:Jge(t,n)}function Jge(t,e,n=!0){let r=e===void 0?t.childNodes.length-1:0;const i=e===void 0?-1:1;for(;e===void 0?r>=(n?Math.max(t.childNodes.length-1,0):0):r<=t.childNodes.length;){if(e&&r===t.childNodes.length)throw new Error("The given offset is out of bounds.");const s=t.childNodes.item(r),a=String(s.textContent);if(a.length)if(e!==void 0&&a.length<e)e-=a.length;else{if(s.nodeType===1)return Jge(s,e,!1);if(s.nodeType===3)return{node:s,offset:e??s.nodeValue.length}}r+=i}return{node:t,offset:t.childNodes.length}}function Qrt({document:t,target:e,clickCount:n,node:r,offset:i}){if(xqe(e))return;const s=a0(e),a=String(s?o0(e):e.textContent),[o,c]=r?[i,i]:eit(a,i,n);if(s)return iR(e,{anchorOffset:o??a.length,focusOffset:c??a.length}),{node:e,start:o??0,end:c??a.length};{const{node:l,offset:u}=hG({target:e,node:r,offset:o}),{node:h,offset:d}=hG({target:e,node:r,offset:c}),f=e.ownerDocument.createRange();try{f.setStart(l,u),f.setEnd(h,d)}catch{throw new Error("The given offset is out of bounds.")}const p=t.getSelection();return p==null||p.removeAllRanges(),p==null||p.addRange(f.cloneRange()),f}}function eit(t,e,n){if(n%3===1||t.length===0)return[e,e];const r=e??t.length;return n%3===2?[r-t.substr(0,e).match(/(\w+|\s+|\W)?$/)[0].length,e===void 0?e:e+t.substr(e).match(/^(\w+|\s+|\W)?/)[0].length]:[r-t.substr(0,e).match(/[^\r\n]*$/)[0].length,e===void 0?e:e+t.substr(e).match(/^[^\r\n]*/)[0].length]}function tit(t,{document:e,target:n,node:r,offset:i}){const s=hG({target:n,node:r,offset:i});if("node"in t){if(s.node===t.node){const a=s.offset<t.start?t.end:t.start,o=s.offset>t.end||s.offset<t.start?s.offset:t.end;iR(t.node,{anchorOffset:a,focusOffset:o})}}else{const a=t.cloneRange(),o=a.comparePoint(s.node,s.offset);o<0?a.setStart(s.node,s.offset):o>0&&a.setEnd(s.node,s.offset);const c=e.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(a.cloneRange())}}function Zge(t,e){var n,r,i,s,a,o,c,l,u,h,d,f,p,g,_,v,E,T,x,N,A,I,k,L;return t.target!==e.target||((n=t.coords)===null||n===void 0?void 0:n.x)!==((r=e.coords)===null||r===void 0?void 0:r.x)||((i=t.coords)===null||i===void 0?void 0:i.y)!==((s=e.coords)===null||s===void 0?void 0:s.y)||((a=t.coords)===null||a===void 0?void 0:a.clientX)!==((o=e.coords)===null||o===void 0?void 0:o.clientX)||((c=t.coords)===null||c===void 0?void 0:c.clientY)!==((l=e.coords)===null||l===void 0?void 0:l.clientY)||((u=t.coords)===null||u===void 0?void 0:u.offsetX)!==((h=e.coords)===null||h===void 0?void 0:h.offsetX)||((d=t.coords)===null||d===void 0?void 0:d.offsetY)!==((f=e.coords)===null||f===void 0?void 0:f.offsetY)||((p=t.coords)===null||p===void 0?void 0:p.pageX)!==((g=e.coords)===null||g===void 0?void 0:g.pageX)||((_=t.coords)===null||_===void 0?void 0:_.pageY)!==((v=e.coords)===null||v===void 0?void 0:v.pageY)||((E=t.coords)===null||E===void 0?void 0:E.screenX)!==((T=e.coords)===null||T===void 0?void 0:T.screenX)||((x=t.coords)===null||x===void 0?void 0:x.screenY)!==((N=e.coords)===null||N===void 0?void 0:N.screenY)||((A=t.caret)===null||A===void 0?void 0:A.node)!==((I=e.caret)===null||I===void 0?void 0:I.node)||((k=t.caret)===null||k===void 0?void 0:k.offset)!==((L=e.caret)===null||L===void 0?void 0:L.offset)}function lS(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class nit{move(e,n,r){const i=this.position,s=this.getTarget(e);if(this.position=n,!Zge(i,n))return;const a=this.getTarget(e),o=this.getEventInit("mousemove"),[c,l]=aM(s,a);return{leave:()=>{s!==a&&(e.dispatchUIEvent(s,"mouseout",o),c.forEach(u=>e.dispatchUIEvent(u,"mouseleave",o)))},enter:()=>{s!==a&&(e.dispatchUIEvent(a,"mouseover",o),l.forEach(u=>e.dispatchUIEvent(u,"mouseenter",o)))},move:()=>{r||(e.dispatchUIEvent(a,"mousemove",o),this.modifySelecting(e))}}}down(e,n,r){const i=this.buttons.down(n);if(i===void 0)return;const s=this.getTarget(e);this.buttonDownTarget[i]=s;const a=this.getEventInit("mousedown",n.button),o=ly(s);!r&&(o||e.dispatchUIEvent(s,"mousedown",a))&&(this.startSelecting(e,a.detail),kb(s)),!o&&uG(n.button)===2&&e.dispatchUIEvent(s,"contextmenu",this.getEventInit("contextmenu",n.button))}up(e,n,r){const i=this.buttons.up(n);if(i===void 0)return;const s=this.getTarget(e);if(!ly(s)){if(!r){const o=this.getEventInit("mouseup",n.button);e.dispatchUIEvent(s,"mouseup",o),this.endSelecting()}const a=aM(this.buttonDownTarget[i],s)[2][0];if(a){const o=this.getEventInit("click",n.button);o.detail&&(e.dispatchUIEvent(a,o.button===0?"click":"auxclick",o),o.button===0&&o.detail===2&&e.dispatchUIEvent(a,"dblclick",{...this.getEventInit("dblclick",n.button),detail:o.detail}))}}}resetClickCount(){this.clickCount.reset()}getEventInit(e,n){const r={...this.position.coords};return r.button=uG(n),r.buttons=this.buttons.getButtons(),e==="mousedown"?r.detail=this.clickCount.getOnDown(r.button):e==="mouseup"?r.detail=this.clickCount.getOnUp(r.button):(e==="click"||e==="auxclick")&&(r.detail=this.clickCount.incOnClick(r.button)),r}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}startSelecting(e,n){var r,i;this.selecting=Qrt({document:e.config.document,target:this.getTarget(e),node:(r=this.position.caret)===null||r===void 0?void 0:r.node,offset:(i=this.position.caret)===null||i===void 0?void 0:i.offset,clickCount:n})}modifySelecting(e){var n,r;this.selecting&&tit(this.selecting,{document:e.config.document,target:this.getTarget(e),node:(n=this.position.caret)===null||n===void 0?void 0:n.node,offset:(r=this.position.caret)===null||r===void 0?void 0:r.offset})}endSelecting(){this.selecting=void 0}constructor(){lS(this,"position",{}),lS(this,"buttons",new Kge),lS(this,"selecting",void 0),lS(this,"buttonDownTarget",{}),lS(this,"clickCount",new class{incOnClick(e){const n=this.down[e]===void 0?void 0:Number(this.down[e])+1;return this.count=this.count[e]===void 0?{}:{[e]:Number(this.count[e])+1},n}getOnDown(e){var n;this.down={[e]:(n=this.count[e])!==null&&n!==void 0?n:0};var r;return this.count={[e]:(r=this.count[e])!==null&&r!==void 0?r:0},Number(this.count[e])+1}getOnUp(e){return this.down[e]===void 0?void 0:Number(this.down[e])+1}reset(){this.count={}}constructor(){lS(this,"down",{}),lS(this,"count",{})}})}}function mU(t,e){var n;return((n=Qge(t,e))===null||n===void 0?void 0:n.pointerEvents)!=="none"}function rit(t){const e=mp(t);for(let n=t,r=[];n!=null&&n.ownerDocument;n=n.parentElement){r.push(n);const i=e.getComputedStyle(n).pointerEvents;if(i&&!["inherit","unset"].includes(i))return{pointerEvents:i,tree:r}}}const sne=Symbol("Last check for pointer-events");function Qge(t,e){const n=e[sne];if(!(t.config.pointerEventsCheck!==xP.Never&&(!n||ane(t.config.pointerEventsCheck,xP.EachApiCall)&&n[kd.Call]!==SD(t,kd.Call)||ane(t.config.pointerEventsCheck,xP.EachTrigger)&&n[kd.Trigger]!==SD(t,kd.Trigger))))return n==null?void 0:n.result;const i=rit(e);return e[sne]={[kd.Call]:SD(t,kd.Call),[kd.Trigger]:SD(t,kd.Trigger),result:i},i}function wA(t,e){const n=Qge(t,e);if((n==null?void 0:n.pointerEvents)==="none")throw new Error([`Unable to perform pointer interaction as the element ${n.tree.length>1?"inherits":"has"} \`pointer-events: none\`:`,"",iit(n.tree)].join(`
`))}function iit(t){return t.reverse().map((e,n)=>["".padEnd(n),e.tagName,e.id&&`#${e.id}`,e.hasAttribute("data-testid")&&`(testId=${e.getAttribute("data-testid")})`,sit(e),t.length>1&&n===0&&"  <-- This element declared `pointer-events: none`",t.length>1&&n===t.length-1&&"  <-- Asserted pointer events here"].filter(Boolean).join("")).join(`
`)}function sit(t){var e;let n;if(t.hasAttribute("aria-label"))n=t.getAttribute("aria-label");else if(t.hasAttribute("aria-labelledby")){var r,i;n=(i=t.ownerDocument.getElementById(t.getAttribute("aria-labelledby")))===null||i===void 0||(r=i.textContent)===null||r===void 0?void 0:r.trim()}else if(mi(t,["button","input","meter","output","progress","select","textarea"])&&(!((e=t.labels)===null||e===void 0)&&e.length))n=Array.from(t.labels).map(a=>{var o;return(o=a.textContent)===null||o===void 0?void 0:o.trim()}).join("|");else if(mi(t,"button")){var s;n=(s=t.textContent)===null||s===void 0?void 0:s.trim()}return n=n==null?void 0:n.replace(/\n/g,"  "),Number(n==null?void 0:n.length)>30&&(n=`${n==null?void 0:n.substring(0,29)}…`),n?`(label=${n})`:""}function ane(t,e){return(t&e)>0}function vv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ait{init(e){const n=this.getTarget(e),[,r]=aM(null,n),i=this.getEventInit();return wA(e,n),e.dispatchUIEvent(n,"pointerover",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerenter",i)),this}move(e,n){const r=this.position,i=this.getTarget(e);if(this.position=n,!Zge(r,n))return;const s=this.getTarget(e),a=this.getEventInit(-1),[o,c]=aM(i,s);return{leave:()=>{mU(e,i)&&i!==s&&(e.dispatchUIEvent(i,"pointerout",a),o.forEach(l=>e.dispatchUIEvent(l,"pointerleave",a)))},enter:()=>{wA(e,s),i!==s&&(e.dispatchUIEvent(s,"pointerover",a),c.forEach(l=>e.dispatchUIEvent(l,"pointerenter",a)))},move:()=>{e.dispatchUIEvent(s,"pointermove",a)}}}down(e,n=0){if(this.isDown)return;const r=this.getTarget(e);wA(e,r),this.isDown=!0,this.isPrevented=!e.dispatchUIEvent(r,"pointerdown",this.getEventInit(n))}up(e,n=0){if(!this.isDown)return;const r=this.getTarget(e);wA(e,r),this.isPrevented=!1,this.isDown=!1,e.dispatchUIEvent(r,"pointerup",this.getEventInit(n))}release(e){const n=this.getTarget(e),[r]=aM(n,null),i=this.getEventInit();mU(e,n)&&(e.dispatchUIEvent(n,"pointerout",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerleave",i))),this.isCancelled=!0}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}getEventInit(e){return{...this.position.coords,pointerId:this.pointerId,pointerType:this.pointerType,isPrimary:this.isPrimary,button:uG(e),buttons:this.buttons.getButtons()}}constructor({pointerId:e,pointerType:n,isPrimary:r},i){vv(this,"pointerId",void 0),vv(this,"pointerType",void 0),vv(this,"isPrimary",void 0),vv(this,"buttons",void 0),vv(this,"isMultitouch",!1),vv(this,"isCancelled",!1),vv(this,"isDown",!1),vv(this,"isPrevented",!1),vv(this,"position",{}),this.pointerId=e,this.pointerType=n,this.isPrimary=r,this.isMultitouch=!r,this.buttons=i}}function f_(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class oit{isKeyPressed(e){return this.devices.get(e.pointerType).isPressed(e)}async press(e,n,r){this.devices.get(n.pointerType).addPressed(n),this.buttons.down(n);const i=this.getPointerName(n),s=n.pointerType==="touch"?this.pointers.new(i,n.pointerType,this.buttons):this.pointers.get(i);s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),s.pointerType==="touch"&&s.init(e),s.down(e,n.button),s.pointerType!=="touch"&&this.mouse.down(e,n,s.isPrevented)}async move(e,n,r){const i=this.pointers.get(n),s=i.move(e,r),a=i.pointerType==="touch"?void 0:this.mouse.move(e,r,i.isPrevented);s==null||s.leave(),a==null||a.leave(),s==null||s.enter(),a==null||a.enter(),s==null||s.move(),a==null||a.move()}async release(e,n,r){const i=this.devices.get(n.pointerType);i.removePressed(n),this.buttons.up(n);const s=this.pointers.get(this.getPointerName(n)),a=s.isPrevented;if(s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),i.countPressed===0&&s.up(e,n.button),s.pointerType==="touch"&&s.release(e),s.pointerType==="touch"&&!s.isMultitouch){const o=this.mouse.move(e,r,a);o==null||o.leave(),o==null||o.enter(),o==null||o.move(),this.mouse.down(e,n,a)}if(!s.isMultitouch){const o=this.mouse.move(e,r,a);o==null||o.leave(),o==null||o.enter(),o==null||o.move(),this.mouse.up(e,n,a)}}getPointerName(e){return e.pointerType==="touch"?e.name:e.pointerType}getPreviousPosition(e){return this.pointers.has(e)?this.pointers.get(e).position:void 0}resetClickCount(){this.mouse.resetClickCount()}getMouseTarget(e){var n;return(n=this.mouse.position.target)!==null&&n!==void 0?n:e.config.document.body}setMousePosition(e){this.mouse.position=e,this.pointers.get("mouse").position=e}constructor(e){f_(this,"system",void 0),f_(this,"mouse",void 0),f_(this,"buttons",void 0),f_(this,"devices",new class{get(n){var r,i,s;return(s=(r=this.registry)[i=n])!==null&&s!==void 0?s:r[i]=new Zrt}constructor(){f_(this,"registry",{})}}),f_(this,"pointers",new class{new(n,r,i){const s=r!=="touch"||!Object.values(this.registry).some(a=>a.pointerType==="touch"&&!a.isCancelled);return s||Object.values(this.registry).forEach(a=>{a.pointerType===r&&!a.isCancelled&&(a.isMultitouch=!0)}),this.registry[n]=new ait({pointerId:this.nextId++,pointerType:r,isPrimary:s},i),this.registry[n]}get(n){if(!this.has(n))throw new Error(`Trying to access pointer "${n}" which does not exist.`);return this.registry[n]}has(n){return n in this.registry}constructor(){f_(this,"registry",{}),f_(this,"nextId",1)}}),this.system=e,this.buttons=new Kge,this.mouse=new nit,this.pointers.new("mouse","mouse",this.buttons)}}function one(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class e0e{getUIEventModifiers(){return{altKey:this.keyboard.modifiers.Alt,ctrlKey:this.keyboard.modifiers.Control,metaKey:this.keyboard.modifiers.Meta,shiftKey:this.keyboard.modifiers.Shift,modifierAltGraph:this.keyboard.modifiers.AltGraph,modifierCapsLock:this.keyboard.modifiers.CapsLock,modifierFn:this.keyboard.modifiers.Fn,modifierFnLock:this.keyboard.modifiers.FnLock,modifierNumLock:this.keyboard.modifiers.NumLock,modifierScrollLock:this.keyboard.modifiers.ScrollLock,modifierSymbol:this.keyboard.modifiers.Symbol,modifierSymbolLock:this.keyboard.modifiers.SymbolLock}}constructor(){one(this,"keyboard",new Wrt(this)),one(this,"pointer",new oit(this))}}async function cit(t){const e=[];return this.config.skipHover||e.push({target:t}),e.push({keys:"[MouseLeft]",target:t}),this.pointer(e)}async function lit(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft]"])}async function uit(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft][MouseLeft]"])}async function hit(t){return this.pointer({target:t})}async function dit(t){return wA(this,this.system.pointer.getMouseTarget(this)),this.pointer({target:t.ownerDocument.body})}async function fit({shift:t}={}){return this.keyboard(t===!0?"{Shift>}{Tab}{/Shift}":t===!1?"[/ShiftLeft][/ShiftRight]{Tab}":"{Tab}")}var M9=function(t){return t["{"]="}",t["["]="]",t}(M9||{});function t0e(t,e){let n=0;const r=t[n]in M9?t[n]:"";n+=r.length;const s=new RegExp(`^\\${r}{2}`).test(t)?"":r;return{type:s,...s===""?pit(t,n,e):mit(t,n,s,e)}}function pit(t,e,n){const r=t[e];return n0e(r,t,e,n),e+=r.length,{consumedLength:e,descriptor:r,releasePrevious:!1,releaseSelf:!0,repeat:1}}function mit(t,e,n,r){var i,s;const a=t[e]==="/"?"/":"";e+=a.length;const o=n==="{"&&t[e]==="\\";e+=Number(o);const c=o?t[e]:(i=t.slice(e).match(n==="{"?/^\w+|^[^}>/]/:/^\w+/))===null||i===void 0?void 0:i[0];n0e(c,t,e,r),e+=c.length;var l;const u=(l=(s=t.slice(e).match(/^>\d+/))===null||s===void 0?void 0:s[0])!==null&&l!==void 0?l:"";e+=u.length;const h=t[e]==="/"||!u&&t[e]===">"?t[e]:"";e+=h.length;const d=M9[n],f=t[e]===d?d:"";if(!f)throw new Error(r0e([!u&&"repeat modifier",!h&&"release modifier",`"${d}"`].filter(Boolean).join(" or "),t[e],t,r));return e+=f.length,{consumedLength:e,descriptor:c,releasePrevious:!!a,repeat:u?Math.max(Number(u.substr(1)),1):1,releaseSelf:git(h,u)}}function n0e(t,e,n,r){if(!t)throw new Error(r0e("key descriptor",e[n],e,r))}function git(t,e){if(t)return t==="/";if(e)return!1}function r0e(t,e,n,r){return`Expected ${t} but found "${e??""}" in "${n}"
    See ${r==="pointer"?"https://testing-library.com/docs/user-event/pointer#pressing-a-button-or-touching-the-screen":"https://testing-library.com/docs/user-event/keyboard"}
    for more information about how userEvent parses your input.`}function vit(t,e){const n=[];do{const{type:i,descriptor:s,consumedLength:a,releasePrevious:o,releaseSelf:c=!0,repeat:l}=t0e(e,"keyboard");var r;const u=(r=t.find(h=>{if(i==="["){var d;return((d=h.code)===null||d===void 0?void 0:d.toLowerCase())===s.toLowerCase()}else if(i==="{"){var f;return((f=h.key)===null||f===void 0?void 0:f.toLowerCase())===s.toLowerCase()}return h.key===s}))!==null&&r!==void 0?r:{key:"Unknown",code:"Unknown",[i==="["?"code":"key"]:s};n.push({keyDef:u,releasePrevious:o,releaseSelf:c,repeat:l}),e=e.slice(a)}while(e);return n}async function yit(t){const e=vit(this.config.keyboardMap,t);for(let n=0;n<e.length;n++)await TC(this.config),await _it(this,e[n])}async function _it(t,{keyDef:e,releasePrevious:n,releaseSelf:r,repeat:i}){const{system:s}=t;if(s.keyboard.isKeyPressed(e)&&await s.keyboard.keyup(t,e),!n){for(let a=1;a<=i;a++)await s.keyboard.keydown(t,e),a<i&&await TC(t.config);r&&await s.keyboard.keyup(t,e)}}async function bit(t){for(const e of t.system.keyboard.getPressedKeys())await t.system.keyboard.keyup(t,e)}function i0e(t){const e=a0(t)?{"text/plain":Eit(t)}:{"text/plain":String(t.ownerDocument.getSelection())},n=h9(mp(t));for(const r in e)e[r]&&n.setData(r,e[r]);return n}function Eit(t){const e=wO(t);return o0(t).substring(e.startOffset,e.endOffset)}async function Sit(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=i0e(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"copy",{clipboardData:r})&&this.config.writeToClipboard&&await eme(t,r),r}async function Tit(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=i0e(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"cut",{clipboardData:r})&&this.config.writeToClipboard&&await eme(n.ownerDocument,r),r}async function xit(t){const e=this.config.document;var n;const r=(n=e.activeElement)!==null&&n!==void 0?n:e.body;var i;const s=(i=typeof t=="string"?wit(e,t):t)!==null&&i!==void 0?i:await bqe(e).catch(()=>{throw new Error("`userEvent.paste()` without `clipboardData` requires the `ClipboardAPI` to be available.")});this.dispatchUIEvent(r,"paste",{clipboardData:s})}function wit(t,e){const n=h9(mp(t));return n.setData("text",e),n}function cne(t,e){const n=[];do{const{descriptor:r,consumedLength:i,releasePrevious:s,releaseSelf:a=!0}=t0e(e,"pointer"),o=t.find(c=>c.name===r);o&&n.push({keyDef:o,releasePrevious:s,releaseSelf:a}),e=e.slice(i)}while(e);return n}async function Cit(t){const{pointerMap:e}=this.config,n=[];(Array.isArray(t)?t:[t]).forEach(r=>{typeof r=="string"?n.push(...cne(e,r)):"keys"in r?n.push(...cne(e,r.keys).map(i=>({...r,...i}))):n.push(r)});for(let r=0;r<n.length;r++)await TC(this.config),await Rit(this,n[r]);this.system.pointer.resetClickCount()}async function Rit(t,e){var n,r;const i="pointerName"in e&&e.pointerName?e.pointerName:"keyDef"in e?t.system.pointer.getPointerName(e.keyDef):"mouse",s=t.system.pointer.getPreviousPosition(i);var a,o,c,l;const u={target:(a=e.target)!==null&&a!==void 0?a:Ait(t,s),coords:(o=e.coords)!==null&&o!==void 0?o:s==null?void 0:s.coords,caret:{node:(c=e.node)!==null&&c!==void 0?c:lne(e)||s==null||(n=s.caret)===null||n===void 0?void 0:n.node,offset:(l=e.offset)!==null&&l!==void 0?l:lne(e)||s==null||(r=s.caret)===null||r===void 0?void 0:r.offset}};"keyDef"in e?(t.system.pointer.isKeyPressed(e.keyDef)&&(xA(t,kd.Trigger),await t.system.pointer.release(t,e.keyDef,u)),e.releasePrevious||(xA(t,kd.Trigger),await t.system.pointer.press(t,e.keyDef,u),e.releaseSelf&&(xA(t,kd.Trigger),await t.system.pointer.release(t,e.keyDef,u)))):(xA(t,kd.Trigger),await t.system.pointer.move(t,i,u))}function lne(t){var e,n;return!!((n=(e=t.target)!==null&&e!==void 0?e:t.node)!==null&&n!==void 0?n:t.offset!==void 0)}function Ait(t,e){if(!e)throw new Error("This pointer has no previous position. Provide a target property!");var n;return(n=e.target)!==null&&n!==void 0?n:t.config.document.body}async function Mit(t){if(!yC(t)||ly(t))throw new Error("clear()` is only supported on editable elements.");if(kb(t),t.ownerDocument.activeElement!==t)throw new Error("The element to be cleared could not be focused.");if(Vge(t),!xrt(t))throw new Error("The element content to be cleared could not be selected.");SC(this,t,"","deleteContentBackward")}async function Oit(t,e){return s0e.call(this,!0,t,e)}async function Nit(t,e){return s0e.call(this,!1,t,e)}async function s0e(t,e,n){if(!t&&!e.multiple)throw as().getElementError("Unable to deselect an option in a non-multiple select. Use selectOptions to change the selection instead.",e);const r=Array.isArray(n)?n:[n],i=Array.from(e.querySelectorAll('option, [role="option"]')),s=r.map(o=>{if(typeof o!="string"&&i.includes(o))return o;{const c=i.find(l=>l.value===o||l.innerHTML===o);if(c)return c;throw as().getElementError(`Value "${String(o)}" not found in options`,e)}}).filter(o=>!ly(o));if(ly(e)||!s.length)return;const a=o=>{o.selected=t,this.dispatchUIEvent(e,"input",{bubbles:!0,cancelable:!1,composed:!0}),this.dispatchUIEvent(e,"change")};if(mi(e,"select"))if(e.multiple)for(const o of s){const c=this.config.pointerEventsCheck===0?!0:mU(this,o);c&&(this.dispatchUIEvent(o,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(o,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(o,"pointermove"),this.dispatchUIEvent(o,"mousemove"),this.dispatchUIEvent(o,"pointerdown"),this.dispatchUIEvent(o,"mousedown")),kb(e),c&&(this.dispatchUIEvent(o,"pointerup"),this.dispatchUIEvent(o,"mouseup")),a(o),c&&this.dispatchUIEvent(o,"click"),await TC(this.config)}else if(s.length===1){const o=this.config.pointerEventsCheck===0?!0:mU(this,e);o?await this.click(e):kb(e),a(s[0]),o&&(this.dispatchUIEvent(e,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(e,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(e,"pointerup"),this.dispatchUIEvent(e,"mouseup"),this.dispatchUIEvent(e,"click")),await TC(this.config)}else throw as().getElementError("Cannot select multiple options on a non-multiple select",e);else if(e.getAttribute("role")==="listbox")for(const o of s)await this.click(o),await this.unhover(o);else throw as().getElementError("Cannot select options on elements that are neither select nor listbox elements",e)}async function Iit(t,e,{skipClick:n=this.config.skipClick,skipAutoClose:r=this.config.skipAutoClose,initialSelectionStart:i,initialSelectionEnd:s}={}){t.disabled||(n||await this.click(t),i!==void 0&&TA(t,i,s??i),await this.keyboard(e),r||await bit(this))}const une=Symbol("files and value properties are mocked");function jH(t,e,n){n?Object.defineProperty(t,e,n):delete t[e]}function kit(t,e){var n;(n=t[une])===null||n===void 0||n.restore();const r=Object.getOwnPropertyDescriptor(t,"type"),i=Object.getOwnPropertyDescriptor(t,"value"),s=Object.getOwnPropertyDescriptor(t,"files");function a(){jH(t,"type",r),jH(t,"value",i),jH(t,"files",s)}t[une]={restore:a},Object.defineProperties(t,{files:{configurable:!0,get:()=>e},value:{configurable:!0,get:()=>e.length?`C:\\fakepath\\${e[0].name}`:"",set(o){if(o==="")a();else{var c;i==null||(c=i.set)===null||c===void 0||c.call(t,o)}}},type:{configurable:!0,get:()=>"file",set(o){o!=="file"&&(a(),t.type=o)}}})}async function Dit(t,e){const n=mi(t,"label")?t.control:t;if(!n||!mi(n,"input",{type:"file"}))throw new TypeError(`The ${n===t?"given":"associated"} ${n==null?void 0:n.tagName} element does not accept file uploads`);if(ly(t))return;const r=(Array.isArray(e)?e:[e]).filter(s=>!this.config.applyAccept||Pit(s,n.accept)).slice(0,n.multiple?void 0:1),i=()=>{var s;r.length===((s=n.files)===null||s===void 0?void 0:s.length)&&r.every((a,o)=>{var c;return a===((c=n.files)===null||c===void 0?void 0:c.item(o))})||(kit(n,u9(mp(t),r)),this.dispatchUIEvent(n,"input"),this.dispatchUIEvent(n,"change"))};n.addEventListener("fileDialog",i),await this.click(t),n.removeEventListener("fileDialog",i)}function TD(t){return t.toLowerCase().replace(/(\.|\/)jpg\b/g,"$1jpeg")}function Pit(t,e){if(!e)return!0;const n=["audio/*","image/*","video/*"];return TD(e).trim().split(/\s*,\s*/).some(r=>r.startsWith(".")?TD(t.name).endsWith(r):n.includes(r)?TD(t.type).startsWith(r.replace("*","")):TD(t.type)===r)}const hne={click:cit,dblClick:lit,tripleClick:uit,hover:hit,unhover:dit,tab:fit,keyboard:yit,copy:Sit,cut:Tit,paste:xit,pointer:Cit,clear:Mit,deselectOptions:Nit,selectOptions:Oit,type:Iit,upload:Dit};function Lit(t){return as().asyncWrapper(t)}const a0e={applyAccept:!0,autoModify:!0,delay:0,document:globalThis.document,keyboardMap:Yrt,pointerMap:Xrt,pointerEventsCheck:xP.EachApiCall,skipAutoClose:!1,skipClick:!1,skipHover:!1,writeToClipboard:!1,advanceTimers:()=>Promise.resolve()},Uit={...a0e,writeToClipboard:!0};function o0e(t={},e=Uit,n){const r=Hit(t,n,e);return{...e,...t,document:r}}function Bit(t={}){const e=o0e(t);Xge(e.document),Yge(mp(e.document).HTMLElement);var n;const r=(n=e.document.defaultView)!==null&&n!==void 0?n:globalThis.window;return vqe(r),O9(e).api}function pu({keyboardState:t,pointerState:e,...n}={},r){const i=o0e(n,a0e,r);Xge(i.document),Yge(mp(i.document).HTMLElement);var s;const a=(s=e??t)!==null&&s!==void 0?s:new e0e;return{api:O9(i,a).api,system:a}}function Fit(t){return O9({...this.config,...t},this.system).api}function zit(t,e){function n(...r){return xA(t,kd.Call),Lit(()=>e.apply(t,r).then(async i=>(await TC(t.config),i)))}return Object.defineProperty(n,"name",{get:()=>e.name}),n}function O9(t,e=new e0e){const n={};return Object.assign(n,{config:t,dispatchEvent:Wge.bind(n),dispatchUIEvent:Brt.bind(n),system:e,levelRefs:{},...hne}),{instance:n,api:{...Object.fromEntries(Object.entries(hne).map(([r,i])=>[r,zit(n,i)])),setup:Fit.bind(n)}}}function Hit(t,e,n){var r,i;return(i=(r=t.document)!==null&&r!==void 0?r:e&&Vrt(e))!==null&&i!==void 0?i:n.document}function jit(t){return pu().api.clear(t)}function Vit(t,e={}){return pu(e,t).api.click(t)}function Git(t={}){return pu(t).api.copy()}function qit(t={}){return pu(t).api.cut()}function $it(t,e={}){return pu(e).api.dblClick(t)}function Wit(t,e,n={}){return pu(n).api.deselectOptions(t,e)}function Yit(t,e={}){return pu(e).api.hover(t)}async function Xit(t,e={}){const{api:n,system:r}=pu(e);return n.keyboard(t).then(()=>r)}async function Kit(t,e={}){const{api:n,system:r}=pu(e);return n.pointer(t).then(()=>r)}function Jit(t,e){return pu(e).api.paste(t)}function Zit(t,e,n={}){return pu(n).api.selectOptions(t,e)}function Qit(t,e={}){return pu(e).api.tripleClick(t)}function est(t,e,n={}){return pu(n,t).api.type(t,e,n)}function tst(t,e={}){const{api:n,system:r}=pu(e);return r.pointer.setMousePosition({target:t}),n.unhover(t)}function nst(t,e,n={}){return pu(n).api.upload(t,e)}function rst(t={}){return pu().api.tab(t)}const ist=Object.freeze(Object.defineProperty({__proto__:null,clear:jit,click:Vit,copy:Git,cut:qit,dblClick:$it,deselectOptions:Wit,hover:Yit,keyboard:Xit,paste:Jit,pointer:Kit,selectOptions:Zit,tab:rst,tripleClick:Qit,type:est,unhover:tst,upload:nst},Symbol.toStringTag,{value:"Module"})),sst={...ist,setup:Bit},Nd=sst.setup({delay:null});function Ia(){return window.sysclipboard}function N9(t){const e=new Set;function n(s){hDe(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),KM.invoke(s))}const r=Wb("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){KM.disconnect(r)}return{forward:n,disconnect:i}}function ast(t){switch(t.target){case"tick":case"tock":case"ready":return!0}return!1}function ost(t){switch(t.target){case"info":case"debug":case"error":case"tick":case"tock":case"ready":case"second":return!0;default:{const e=GT(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}function cst(t){return!1}function c0e(t){const e=GT(t.target);switch(e.target){case"vm":case"modem":case"gadgetserver":return!0}switch(e.path){case"sync":case"joinack":return!0}return!1}function lst(t){return new Worker("/assets/simspace-B9xATIn8.js",{name:t==null?void 0:t.name})}function ust(t){return new Worker("/assets/stubspace-DMmF7b2_.js",{name:t==null?void 0:t.name})}let xD;function hst(t=!1){if(!ae(xD)){xD=t?new ust:new lst;const{forward:e}=N9(n=>{c0e(n)&&xD.postMessage(n)});xD.addEventListener("message",n=>e(n.data))}}async function dst(t){return mPe(t)}async function fst(t,e){return gPe(t,e)}function pst(t){try{return sessionStorage.getItem(t)??void 0}catch(e){Hr(Mr,va,`readsession ${t}`,e.message)}}function mst(t,e){try{ae(e)?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}catch(n){Hr(Mr,va,`writesession ${t} <- ${e}`,n.message)}}function dG(){try{const t=location.hash.slice(1);if(t.length)return t}catch(t){Hr(Mr,va,"crash",t.message)}return""}function l0e(){cLe(Mr,va,"https://github.com/goldbuick/zed-software-system/wiki","open help wiki")}const gst=["$brown$153","$purple$5","$green$42","$ltgray$94","$white$24","$white$25","$white$26","$white$27","$white$16","$white$17","$white$30","$white$31","$red$234","$cyan$227","$dkpurple$227"];function dne(t){return Lr(t.data)?[t.sender,...t.data.map(e=>`${e}`)].join(" "):""}function VH(t){const{terminal:e}=Us.getState();let r=[[Do(),t.target,Cde(t.sender,gst),...t.data],...e.logs];r.length>LZ&&(r=r.slice(0,LZ)),Us.setState(i=>({terminal:{...i.terminal,logs:r}}))}function vst(t){const{layout:e,editor:n}=Us.getState();let i=e+(t?1:-1);if(i<0&&(i+=Pd.MAX),i>=Pd.MAX&&(i-=Pd.MAX),!n.open)switch(i){case Pd.SPLIT_Y:case Pd.SPLIT_Y_ALT:i=Pd.TOP;break}Us.setState({layout:i})}async function fG(t){if(t.length===0){Hr(Mr,va,"content","no content found"),l0e(),c7(Mr,va);return}const e=await _st()??"";XDe(Mr,va,t,e)}let gU="";window.addEventListener("hashchange",()=>{qu(Mr,va,async()=>{const t=dG();gU!==t&&(gU=t,await fG(t))})});function yst(t,e){const n=`#${t}`;if(location.hash!==n){gU=t,location.hash=n;const r=`wrote ${(t==null?void 0:t.length)??0} chars [${t.slice(0,8)}...${t.slice(-8)}]`;e.includes("autosave")?dDe(Mr,va,r):(e.length&&(document.title=e),Fg(Mr,va,r))}}async function _st(){return dst("SELECTED")}async function bst(t){return fst("SELECTED",()=>t)}let GH=0;const fne=1,va=pst("PLAYER")??MPe();mst("PLAYER",va);function ni(){return va}const Mr=Wb("register",["ready","second","info","error","debug","toast"],function(t){if(!Mr.session(t))return;switch(t.target){case"ready":case"second":break;default:if(t.player!==va)return;break}const{terminal:e}=Us.getState();switch(t.target){case"ready":{qu(Mr,t.player,async()=>{await Gp(256),wr(Mr,va,`myplayerid ${va}`),$De(Mr,va)});break}case"loginfail":Bv(Mr,va,"#pages"),l0e(),c7(Mr,va);break;case"ackoperator":qu(Mr,t.player,async()=>{const n=dG();ehe()?TDe(Mr,va,n):(YDe(Mr,va,iV()),await fG(n))});break;case"loginready":JDe(Mr,va);break;case"acklogin":y2(Mr,va),ADe(Mr,va),WDe(Mr,va);break;case"ackzsswords":Eo.setState({zsswords:t.data});break;case"copy":On(t.data)&&ae(Ia())&&Ia().writeText(t.data).then(()=>uo(Mr,t.player,"copied!")).catch(n=>console.error(n));break;case"copyjsonfile":if(Lr(t.data)&&ae(Ia())){const[n,r]=t.data,i=new Blob([JSON.stringify({exported:r,data:n},null,2)],{type:"text/plain"});Ia().write([new ClipboardItem({[i.type]:i})]).then(()=>uo(Mr,t.player,"copied!")).catch(s=>console.error(s))}break;case"downloadjsonfile":if(Lr(t.data)){const[n,r]=t.data;try{const i=new Blob([JSON.stringify({exported:r,data:n},null,2)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=r,a.click(),URL.revokeObjectURL(s)}catch(i){console.error(i)}}break;case"dev":qu(Mr,t.player,async function(){if(iV()){const n=await rV(location.href);_2(Mr,t.player,n,n)}else $p(Mr,t.player,"creating locked terminal"),await Gp(100),location.href=location.href.replace("/#","/locked/#")});break;case"share":qu(Mr,t.player,async function(){const n=await rV(location.href.replace(/cafe.*locked/,"cafe"));_2(Mr,t.player,n,n)});break;case"nuke":qu(Mr,t.player,async function(){$p(Mr,t.player,"nuke in"),ci(Mr,t.player,"3","..."),await Gp(1e3),ci(Mr,t.player,"2","..."),await Gp(1e3),ci(Mr,t.player,"1","..."),await Gp(1e3),$p(Mr,t.player,"BYE"),await Gp(100),location.hash="",gU=location.hash,location.reload()});break;case"savemem":if(Lr(t.data)){const[n,r]=t.data;On(n)&&On(r)&&yst(r,n)}break;case"forkmem":if(Lr(t.data)){const[n]=t.data;On(n)&&window.open(location.href.replace(/#.*/,`#${n}`),"_blank")}break;case"select":qu(Mr,t.player,async()=>{On(t.data)&&(await bst(t.data),await fG(dG()))});break;case"second":++GH,GH>=fne&&(GH-=fne,QDe(Mr,va));break;case"inspector":Us.setState(n=>{const r=ae(t.data)?!!t.data:!n.inspector;return wr(Mr,t.player,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&wr(Mr,t.player,"mouse click or tap elements to inspect"),{inspector:r}});break;case"info":e.level>=iP.INFO&&VH(t);break;case"debug":e.level>=iP.DEBUG&&(VH(t),console.debug(dne(t)));break;case"error":e.level>iP.OFF&&VH(t),console.error(dne(t));break;case"toast":qu(Mr,t.player,async()=>{if(ae(t.data)){const n=Math.min(Math.max(t.data.length*150,3e3),14e3);Us.setState({toast:t.data}),await Gp(n),Us.setState({toast:""})}});break;case"terminal:full":Us.setState(n=>({layout:Pd.FULL,terminal:{...n.terminal,open:!0}}));break;case"terminal:open":Us.setState(n=>({terminal:{...n.terminal,open:!0}}));break;case"terminal:quickopen":Us.setState({quickterminal:!0});break;case"terminal:close":Us.setState(n=>({quickterminal:!1,terminal:{...n.terminal,open:!1}}));break;case"terminal:toggle":Us.setState(n=>({terminal:{...n.terminal,open:!n.terminal.open}}));break;case"terminal:inclayout":uDe(t.data)&&vst(t.data);break;case"editor:open":if(Lr(t.data)){const[n,r,i,s,a]=t.data;Us.setState(o=>({editor:{open:!0,player:t.player,book:n,path:r,type:i,title:s,refsheet:a.length?a:o.editor.refsheet}}))}break;case"editor:close":Us.setState(n=>({editor:{...n.editor,open:!1}}));break;default:{const{target:n,path:r}=GT(t.target);switch(n){case"touchkey":qu(Mr,t.player,async()=>{switch(r){case"[Alt]":S_(Mr,t.player,"","-c",!0),Vh.setState(i=>({...i,keyboardalt:!i.keyboardalt,keyboardctrl:!1,keyboardshift:!1}));break;case"[Ctrl]":S_(Mr,t.player,"","-e",!0),Vh.setState(i=>({...i,keyboardalt:!1,keyboardctrl:!i.keyboardctrl,keyboardshift:!1}));break;case"[Shift]":S_(Mr,t.player,"","-g",!0),Vh.setState(i=>({...i,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!i.keyboardshift}));break;default:{const i=!isNaN(parseInt(r,10)),s=Vh.getState(),a=[],o=Ob?"Meta":"Ctrl";s.keyboardshift?(S_(Mr,t.player,"",i?"+c":"+f",!0),a.push("{Shift>}")):s.keyboardalt?(S_(Mr,t.player,"",i?"+c!":"+f!",!0),a.push("{Alt>}")):s.keyboardctrl?(S_(Mr,t.player,"",i?"+c#":"+f#",!0),a.push(`{${o}>}`)):S_(Mr,t.player,"",i?"-c":"-f",!0),a.push(r),s.keyboardshift?a.push("{/Shift}"):s.keyboardalt?a.push("{/Alt}"):s.keyboardctrl&&a.push(`{/${o}}`);const c=a.join("");await Nd.keyboard(c);break}}});break}break}}});setTimeout(function(){hst(ehe())},100);const u0e="15.1.22",pne=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),mne=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),pG=(t,e)=>({startTime:e,type:"setValue",value:t}),h0e=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),d0e=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),Q1=t=>t.type==="exponentialRampToValue",vU=t=>t.type==="linearRampToValue",D_=t=>Q1(t)||vU(t),I9=t=>t.type==="setValue",xv=t=>t.type==="setValueCurve",yU=(t,e,n,r)=>{const i=t[e];return i===void 0?r:D_(i)||I9(i)?i.value:xv(i)?i.values[i.values.length-1]:d0e(n,yU(t,e-1,i.startTime,r),i)},gne=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:D_(n)?[n.endTime,n.value]:I9(n)?[n.startTime,n.value]:xv(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,yU(t,e-1,n.startTime,i)],mG=t=>t.type==="cancelAndHold",gG=t=>t.type==="cancelScheduledValues",p_=t=>mG(t)||gG(t)?t.cancelTime:Q1(t)||vU(t)?t.endTime:t.startTime,vne=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,yne=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),Est=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},Sst=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return Est(r,i)},wD=t=>t.type==="setTarget";class Tst{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=p_(e);if(mG(e)||gG(e)){const r=this._automationEvents.findIndex(s=>gG(e)&&xv(s)?s.startTime+s.duration>=n:p_(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),mG(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&D_(i)){if(s!==void 0&&wD(s))throw new Error("The internal list is malformed.");const a=s===void 0?i.insertTime:xv(s)?s.startTime+s.duration:p_(s),o=s===void 0?this._defaultValue:xv(s)?s.values[s.values.length-1]:s.value,c=Q1(i)?vne(n,a,o,i):yne(n,a,o,i),l=Q1(i)?pne(c,n,this._currenTime):mne(c,n,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&wD(s)&&this._automationEvents.push(pG(this.getValue(n),n)),s!==void 0&&xv(s)&&s.startTime+s.duration>n){const a=n-s.startTime,o=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(a*o)),l=a/(c-1)*o,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const d=l*h%1;u[h]=s.values[h-1]*(1-d)+s.values[h]*d}this._automationEvents[this._automationEvents.length-1]=h0e(u,s.startTime,a)}}}else{const r=this._automationEvents.findIndex(a=>p_(a)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&xv(i)&&p_(i)+i.duration>n)return!1;const s=Q1(e)?pne(e.value,e.endTime,this._currenTime):vU(e)?mne(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(xv(e)&&n+e.duration>p_(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>p_(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];wD(i)&&r.unshift(pG(yU(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(a=>p_(a)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&wD(s)&&(r===void 0||!D_(r)||r.insertTime>e))return d0e(e,yU(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&I9(s)&&(r===void 0||!D_(r)))return s.value;if(s!==void 0&&xv(s)&&(r===void 0||!D_(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?Sst(e,s):s.values[s.values.length-1];if(s!==void 0&&D_(s)&&(r===void 0||!D_(r)))return s.value;if(r!==void 0&&Q1(r)){const[a,o]=gne(this._automationEvents,i,s,r,this._defaultValue);return vne(e,a,o,r)}if(r!==void 0&&vU(r)){const[a,o]=gne(this._automationEvents,i,s,r,this._defaultValue);return yne(e,a,o,r)}return this._defaultValue}}const xst=t=>({cancelTime:t,type:"cancelAndHold"}),wst=t=>({cancelTime:t,type:"cancelScheduledValues"}),Cst=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),Rst=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),Ast=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),Mst=()=>new DOMException("","AbortError"),Ost=t=>(e,n,[r,i,s],a)=>{t(e[i],[n,r,s],o=>o[0]===n&&o[1]===r,a)},Nst=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},Ist=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},xC=new WeakSet,f0e=new WeakMap,k9=new WeakMap,p0e=new WeakMap,D9=new WeakMap,x6=new WeakMap,m0e=new WeakMap,vG=new WeakMap,yG=new WeakMap,_G=new WeakMap,g0e={construct(){return g0e}},kst=t=>{try{const e=new Proxy(t,g0e);new e}catch{return!1}return!0},_ne=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,bne=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(_ne);for(;i!==null;){const s=i[1].slice(1,-1),a=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(a),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(_ne)}return[n.join(";"),r]},Ene=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Sne=t=>{if(!kst(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Dst=(t,e,n,r,i,s,a,o,c,l,u,h,d)=>{let f=0;return(p,g,_={credentials:"omit"})=>{const v=u.get(p);if(v!==void 0&&v.has(g))return Promise.resolve();const E=l.get(p);if(E!==void 0){const N=E.get(g);if(N!==void 0)return N}const T=s(p),x=T.audioWorklet===void 0?i(g).then(([N,A])=>{const[I,k]=bne(N,A),L=`${I};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${k}
})})(window,'_AWGS')`;return n(L)}).then(()=>{const N=d._AWGS.pop();if(N===void 0)throw new SyntaxError;r(T.currentTime,T.sampleRate,()=>N(class{},void 0,(A,I)=>{if(A.trim()==="")throw e();const k=yG.get(T);if(k!==void 0){if(k.has(A))throw e();Sne(I),Ene(I.parameterDescriptors),k.set(A,I)}else Sne(I),Ene(I.parameterDescriptors),yG.set(T,new Map([[A,I]]))},T.sampleRate,void 0,void 0))}):Promise.all([i(g),Promise.resolve(t(h,h))]).then(([[N,A],I])=>{const k=f+1;f=k;const[L,U]=bne(N,A),X=`${L};((AudioWorkletProcessor,registerProcessor)=>{${U}
})(${I?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${I?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${I?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${k}',class extends AudioWorkletProcessor{process(){return !1}})`,re=new Blob([X],{type:"application/javascript; charset=utf-8"}),V=URL.createObjectURL(re);return T.audioWorklet.addModule(V,_).then(()=>{if(o(T))return T;const Z=a(T);return Z.audioWorklet.addModule(V,_).then(()=>Z)}).then(Z=>{if(c===null)throw new SyntaxError;try{new c(Z,`__sac${k}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(V))});return E===void 0?l.set(p,new Map([[g,x]])):E.set(g,x),x.then(()=>{const N=u.get(p);N===void 0?u.set(p,new Set([g])):N.add(g)}).finally(()=>{const N=l.get(p);N!==void 0&&N.delete(g)}),x}},om=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},w6=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},v0e=(t,e,n,r)=>{const i=om(t,e),s=w6(i,a=>a[0]===n&&a[1]===r);return i.size===0&&t.delete(e),s},uI=t=>om(m0e,t),wC=t=>{if(xC.has(t))throw new Error("The AudioNode is already stored.");xC.add(t),uI(t).forEach(e=>e(!0))},y0e=t=>"port"in t,hI=t=>{if(!xC.has(t))throw new Error("The AudioNode is not stored.");xC.delete(t),uI(t).forEach(e=>e(!1))},bG=(t,e)=>{!y0e(t)&&e.every(n=>n.size===0)&&hI(t)},Pst=(t,e,n,r,i,s,a,o,c,l,u,h,d)=>{const f=new WeakMap;return(p,g,_,v,E)=>{const{activeInputs:T,passiveInputs:x}=s(g),{outputs:N}=s(p),A=o(p),I=k=>{const L=c(g),U=c(p);if(k){const $=v0e(x,p,_,v);t(T,p,$,!1),!E&&!h(p)&&n(U,L,_,v),d(g)&&wC(g)}else{const $=r(T,p,_,v);e(x,v,$,!1),!E&&!h(p)&&i(U,L,_,v);const q=a(g);if(q===0)u(g)&&bG(g,T);else{const G=f.get(g);G!==void 0&&clearTimeout(G),f.set(g,setTimeout(()=>{u(g)&&bG(g,T)},q*1e3))}}};return l(N,[g,_,v],k=>k[0]===g&&k[1]===_&&k[2]===v,!0)?(A.add(I),u(p)?t(T,p,[_,v,I],!0):e(x,v,[p,_,I],!0),!0):!1}},Lst=t=>(e,n,[r,i,s],a)=>{const o=e.get(r);o===void 0?e.set(r,new Set([[i,n,s]])):t(o,[i,n,s],c=>c[0]===i&&c[1]===n,a)},Ust=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},Bst=t=>(e,n)=>{t(e).add(n)},Fst={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},zst=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=i(o),u={...Fst,...c},h=r(l,u),d=s(l)?e():null;super(o,!1,h,d),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(o){this._nativeAnalyserNode.fftSize=o}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(o){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=o,!(o>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(o){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=o,!(this._nativeAnalyserNode.maxDecibels>o))throw this._nativeAnalyserNode.minDecibels=c,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(o){this._nativeAnalyserNode.smoothingTimeConstant=o}getByteFrequencyData(o){this._nativeAnalyserNode.getByteFrequencyData(o)}getByteTimeDomainData(o){this._nativeAnalyserNode.getByteTimeDomainData(o)}getFloatFrequencyData(o){this._nativeAnalyserNode.getFloatFrequencyData(o)}getFloatTimeDomainData(o){this._nativeAnalyserNode.getFloatTimeDomainData(o)}},mu=(t,e)=>t.context===e,Hst=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,a)=>{let o=e(s);if(!mu(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=t(a,l)}return r.set(a,o),await n(s,a,o),o};return{render(s,a){const o=r.get(a);return o!==void 0?Promise.resolve(o):i(s,a)}}},_U=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},c0=()=>new DOMException("","IndexSizeError"),P9=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?c0():r}})(t.getChannelData)},jst={numberOfChannels:1},Vst=(t,e,n,r,i,s,a,o)=>{let c=null;return class _0e{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:f}={...jst,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:h,numberOfChannels:d,sampleRate:f}):c.createBuffer(d,h,f);if(p.numberOfChannels===0)throw n();return typeof p.copyFromChannel!="function"?(a(p),P9(p)):e(_U,()=>_U(p))||o(p),t.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===_0e.prototype||t.has(u)}}},Ph=-34028234663852886e22,Wu=-Ph,Xv=t=>xC.has(t),Gst={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},qst=(t,e,n,r,i,s,a,o)=>class extends t{constructor(l,u){const h=s(l),d={...Gst,...u},f=i(h,d),p=a(h),g=p?e():null;super(l,!1,f,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=n(this,p,f.playbackRate,Wu,Ph)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?o(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){wC(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),Xv(this)&&hI(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},$st=(t,e,n,r,i)=>()=>{const s=new WeakMap;let a=null,o=null;const c=async(l,u)=>{let h=n(l);const d=mu(h,u);if(!d){const f={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,f),a!==null&&h.start(...a),o!==null&&h.stop(o)}return s.set(u,h),d?await t(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){a=l},set stop(l){o=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Wst=t=>"playbackRate"in t,Yst=t=>"frequency"in t&&"gain"in t,Xst=t=>"offset"in t,Kst=t=>!("frequency"in t)&&"gain"in t,Jst=t=>"detune"in t&&"frequency"in t&&!("gain"in t),Zst=t=>"pan"in t,Ju=t=>om(f0e,t),dI=t=>om(p0e,t),EG=(t,e)=>{const{activeInputs:n}=Ju(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||EG(s,[...e,t])}));const r=Wst(t)?[t.playbackRate]:y0e(t)?Array.from(t.parameters.values()):Yst(t)?[t.Q,t.detune,t.frequency,t.gain]:Xst(t)?[t.offset]:Kst(t)?[t.gain]:Jst(t)?[t.detune,t.frequency]:Zst(t)?[t.pan]:[];for(const i of r){const s=dI(i);s!==void 0&&s.activeInputs.forEach(([a])=>EG(a,e))}Xv(t)&&hI(t)},b0e=t=>{EG(t.destination,[])},Qst=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),eat=(t,e,n,r,i,s,a,o,c)=>class extends t{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?n():p}if(h===null)throw r();if(!Qst(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw n();super(h,2);const{latencyHint:d}=u,{sampleRate:f}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:d==="balanced"?512/f:d==="interactive"||d===void 0?256/f:d==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(d*f/128)))*128/f,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),b0e(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new a(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new o(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},tat=(t,e,n,r,i,s,a,o)=>class extends t{constructor(l,u){const h=s(l),d=a(h),f=i(h,u,d),p=d?e(o):null;super(l,!1,f,p),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},nat=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},rat=(t,e,n,r,i,s,a,o)=>(c,l)=>{const u=l.listener,h=()=>{const N=new Float32Array(1),A=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),I=a(l);let k=!1,L=[0,0,-1,0,1,0],U=[0,0,0];const $=()=>{if(k)return;k=!0;const re=r(l,256,9,0);re.onaudioprocess=({inputBuffer:V})=>{const Z=[s(V,N,0),s(V,N,1),s(V,N,2),s(V,N,3),s(V,N,4),s(V,N,5)];Z.some((ee,oe)=>ee!==L[oe])&&(u.setOrientation(...Z),L=Z);const Y=[s(V,N,6),s(V,N,7),s(V,N,8)];Y.some((ee,oe)=>ee!==U[oe])&&(u.setPosition(...Y),U=Y)},A.connect(re)},q=re=>V=>{V!==L[re]&&(L[re]=V,u.setOrientation(...L))},G=re=>V=>{V!==U[re]&&(U[re]=V,u.setPosition(...U))},X=(re,V,Z)=>{const Y=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:V});Y.connect(A,0,re),Y.start(),Object.defineProperty(Y.offset,"defaultValue",{get(){return V}});const ee=t({context:c},I,Y.offset,Wu,Ph);return o(ee,"value",oe=>()=>oe.call(ee),oe=>de=>{try{oe.call(ee,de)}catch(Me){if(Me.code!==9)throw Me}$(),I&&Z(de)}),ee.cancelAndHoldAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.cancelAndHoldAtTime),ee.cancelScheduledValues=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.cancelScheduledValues),ee.exponentialRampToValueAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.exponentialRampToValueAtTime),ee.linearRampToValueAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.linearRampToValueAtTime),ee.setTargetAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.setTargetAtTime),ee.setValueAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.setValueAtTime),ee.setValueCurveAtTime=(oe=>I?()=>{throw i()}:(...de)=>{const Me=oe.apply(ee,de);return $(),Me})(ee.setValueCurveAtTime),ee};return{forwardX:X(0,0,q(0)),forwardY:X(1,0,q(1)),forwardZ:X(2,-1,q(2)),positionX:X(6,0,G(0)),positionY:X(7,0,G(1)),positionZ:X(8,0,G(2)),upX:X(3,0,q(3)),upY:X(4,1,q(4)),upZ:X(5,0,q(5))}},{forwardX:d,forwardY:f,forwardZ:p,positionX:g,positionY:_,positionZ:v,upX:E,upY:T,upZ:x}=u.forwardX===void 0?h():u;return{get forwardX(){return d},get forwardY(){return f},get forwardZ(){return p},get positionX(){return g},get positionY(){return _},get positionZ(){return v},get upX(){return E},get upY(){return T},get upZ(){return x}}},bU=t=>"context"in t,fI=t=>bU(t[0]),tx=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Tne=(t,e,[n,r],i)=>{tx(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},xne=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):tx(s,[n,r],a=>a[0]===n,i)},sR=t=>"inputs"in t,EU=(t,e,n,r)=>{if(sR(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},E0e=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},iat=(t,e,n)=>w6(t,r=>r[0]===e&&r[1]===n),S0e=(t,e)=>{if(!uI(t).delete(e))throw new Error("Missing the expected event listener.")},T0e=(t,e,n)=>{const r=om(t,e),i=w6(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},SU=(t,e,n,r)=>{sR(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},Ea=t=>om(k9,t),RO=t=>om(D9,t),OT=t=>vG.has(t),wP=t=>!xC.has(t),wne=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),a=s.getChannelData(0);a[0]=1,a[1]=1;const o=t.createBufferSource();o.buffer=s,o.loop=!0,o.connect(r).connect(t.destination),o.connect(i),o.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?n(!0):n(!1),o.stop(),r.onaudioprocess=null,o.disconnect(r),r.disconnect(t.destination)},o.start()}}),qH=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},TU=t=>"context"in t,sat=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const a=TU(r)?n(r,i,s):n(r,i),o=e.get(r);return o===void 0?e.set(r,[{input:s,output:i}]):o.every(c=>c.input!==s||c.output!==i)&&o.push({input:s,output:i}),a})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[a,o]of e){const c=o.filter(l=>l.output!==r);c.length===0?e.delete(a):e.set(a,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const a=e.get(r);if(a!==void 0){const o=a.filter(c=>c.output!==i&&(c.input!==s||s===void 0));o.length===0?e.delete(r):e.set(r,o)}}for(const[a,o]of e)o.forEach(c=>{TU(a)?t.connect(a,c.output,c.input):t.connect(a,c.output)})})(t.disconnect)},aat=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=dI(e),{outputs:a}=Ju(t),o=uI(t),c=l=>{const u=Ea(t),h=RO(e);if(l){const d=T0e(s,t,n);Tne(i,t,d,!1),!r&&!OT(t)&&u.connect(h,n)}else{const d=iat(i,t,n);xne(s,d,!1),!r&&!OT(t)&&u.disconnect(h,n)}};return tx(a,[e,n],l=>l[0]===e&&l[1]===n,!0)?(o.add(c),Xv(t)?Tne(i,t,[n,c],!0):xne(s,[t,n,c],!0),!0):!1},oat=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=Ju(e),a=E0e(i[r],t,n);return a===null?[v0e(s,t,n,r)[2],!1]:[a[2],!0]},cat=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=dI(e),s=E0e(r,t,n);return s===null?[T0e(i,t,n)[1],!1]:[s[2],!0]},L9=(t,e,n,r,i)=>{const[s,a]=oat(t,n,r,i);if(s!==null&&(S0e(t,s),a&&!e&&!OT(t)&&SU(Ea(t),Ea(n),r,i)),Xv(n)){const{activeInputs:o}=Ju(n);bG(n,o)}},U9=(t,e,n,r)=>{const[i,s]=cat(t,n,r);i!==null&&(S0e(t,i),s&&!e&&!OT(t)&&Ea(t).disconnect(RO(n),r))},lat=(t,e)=>{const n=Ju(t),r=[];for(const i of n.outputs)fI(i)?L9(t,e,...i):U9(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},uat=(t,e,n)=>{const r=Ju(t),i=[];for(const s of r.outputs)s[1]===n&&(fI(s)?L9(t,e,...s):U9(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},hat=(t,e,n,r,i)=>{const s=Ju(t);return Array.from(s.outputs).filter(a=>a[0]===n&&(r===void 0||a[1]===r)&&(i===void 0||a[2]===i)).map(a=>(fI(a)?L9(t,e,...a):U9(t,e,...a),s.outputs.delete(a),a[0]))},dat=(t,e,n,r,i,s,a,o,c,l,u,h,d,f,p,g)=>class extends l{constructor(v,E,T,x){super(T),this._context=v,this._nativeAudioNode=T;const N=u(v);h(N)&&n(wne,()=>wne(N,g))!==!0&&sat(T),k9.set(this,T),m0e.set(this,new Set),v.state!=="closed"&&E&&wC(this),t(this,x,T)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,E=0,T=0){if(E<0||E>=this._nativeAudioNode.numberOfOutputs)throw i();const x=u(this._context),N=p(x);if(d(v)||f(v))throw s();if(bU(v)){const k=Ea(v);try{const U=EU(this._nativeAudioNode,k,E,T),$=wP(this);(N||$)&&this._nativeAudioNode.disconnect(...U),this.context.state!=="closed"&&!$&&wP(v)&&wC(v)}catch(U){throw U.code===12?s():U}if(e(this,v,E,T,N)){const U=c([this],v);qH(U,r(N))}return v}const A=RO(v);if(A.name==="playbackRate"&&A.maxValue===1024)throw a();try{this._nativeAudioNode.connect(A,E),(N||wP(this))&&this._nativeAudioNode.disconnect(A,E)}catch(k){throw k.code===12?s():k}if(aat(this,v,E,N)){const k=c([this],v);qH(k,r(N))}}disconnect(v,E,T){let x;const N=u(this._context),A=p(N);if(v===void 0)x=lat(this,A);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw i();x=uat(this,A,v)}else{if(E!==void 0&&(E<0||E>=this.numberOfOutputs)||bU(v)&&T!==void 0&&(T<0||T>=v.numberOfInputs))throw i();if(x=hat(this,A,v,E,T),x.length===0)throw s()}for(const I of x){const k=c([this],I);qH(k,o)}}},fat=(t,e,n,r,i,s,a,o,c,l,u,h,d)=>(f,p,g,_=null,v=null)=>{const E=g.value,T=new Tst(E),x=p?r(T):null,N={get defaultValue(){return E},get maxValue(){return _===null?g.maxValue:_},get minValue(){return v===null?g.minValue:v},get value(){return g.value},set value(A){g.value=A,N.setValueAtTime(A,f.context.currentTime)},cancelAndHoldAtTime(A){if(typeof g.cancelAndHoldAtTime=="function")x===null&&T.flush(f.context.currentTime),T.add(i(A)),g.cancelAndHoldAtTime(A);else{const I=Array.from(T).pop();x===null&&T.flush(f.context.currentTime),T.add(i(A));const k=Array.from(T).pop();g.cancelScheduledValues(A),I!==k&&k!==void 0&&(k.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime(k.value,k.endTime):k.type==="linearRampToValue"?g.linearRampToValueAtTime(k.value,k.endTime):k.type==="setValue"?g.setValueAtTime(k.value,k.startTime):k.type==="setValueCurve"&&g.setValueCurveAtTime(k.values,k.startTime,k.duration))}return N},cancelScheduledValues(A){return x===null&&T.flush(f.context.currentTime),T.add(s(A)),g.cancelScheduledValues(A),N},exponentialRampToValueAtTime(A,I){if(A===0)throw new RangeError;if(!Number.isFinite(I)||I<0)throw new RangeError;const k=f.context.currentTime;return x===null&&T.flush(k),Array.from(T).length===0&&(T.add(l(E,k)),g.setValueAtTime(E,k)),T.add(a(A,I)),g.exponentialRampToValueAtTime(A,I),N},linearRampToValueAtTime(A,I){const k=f.context.currentTime;return x===null&&T.flush(k),Array.from(T).length===0&&(T.add(l(E,k)),g.setValueAtTime(E,k)),T.add(o(A,I)),g.linearRampToValueAtTime(A,I),N},setTargetAtTime(A,I,k){return x===null&&T.flush(f.context.currentTime),T.add(c(A,I,k)),g.setTargetAtTime(A,I,k),N},setValueAtTime(A,I){return x===null&&T.flush(f.context.currentTime),T.add(l(A,I)),g.setValueAtTime(A,I),N},setValueCurveAtTime(A,I,k){const L=A instanceof Float32Array?A:new Float32Array(A);if(h!==null&&h.name==="webkitAudioContext"){const U=I+k,$=f.context.sampleRate,q=Math.ceil(I*$),G=Math.floor(U*$),X=G-q,re=new Float32Array(X);for(let Z=0;Z<X;Z+=1){const Y=(L.length-1)/k*((q+Z)/$-I),ee=Math.floor(Y),oe=Math.ceil(Y);re[Z]=ee===oe?L[ee]:(1-(Y-ee))*L[ee]+(1-(oe-Y))*L[oe]}x===null&&T.flush(f.context.currentTime),T.add(u(re,I,k)),g.setValueCurveAtTime(re,I,k);const V=G/$;V<U&&d(N,re[re.length-1],V),d(N,L[L.length-1],U)}else x===null&&T.flush(f.context.currentTime),T.add(u(L,I,k)),g.setValueCurveAtTime(L,I,k);return N}};return n.set(N,g),e.set(N,f),t(N,x),N},pat=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class x0e{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const mat={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},gat=(t,e,n,r,i,s,a,o,c,l,u,h,d,f)=>class extends e{constructor(g,_,v){var E;const T=o(g),x=c(T),N=u({...mat,...v});d(N);const A=yG.get(T),I=A==null?void 0:A.get(_),k=x||T.state!=="closed"?T:(E=a(T))!==null&&E!==void 0?E:T,L=i(k,x?null:g.baseLatency,l,_,I,N),U=x?r(_,N,I):null;super(g,!0,L,U);const $=[];L.parameters.forEach((G,X)=>{const re=n(this,x,G);$.push([X,re])}),this._nativeAudioWorkletNode=L,this._onprocessorerror=null,this._parameters=new x0e($),x&&t(T,this);const{activeInputs:q}=s(this);h(L,q)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){const _=typeof g=="function"?f(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=_;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===_?g:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function xU(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const a=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(a)}}}const w0e=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},wU=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let a=0;a<s;a+=1)i.push(new Float32Array(128));n.push(i)}return n},vat=(t,e)=>{const n=om(_G,t),r=Ea(e);return om(n,r)},yat=async(t,e,n,r,i,s,a)=>{const o=e===null?Math.ceil(t.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((_,v)=>_+v,0),u=l===0?null:n.createBuffer(l,o,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=Ju(t),d=await vat(n,t),f=wU(r.numberOfInputs,r.channelCount),p=wU(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce((_,v)=>({..._,[v]:new Float32Array(128)}),{});for(let _=0;_<o;_+=128){if(r.numberOfInputs>0&&e!==null)for(let v=0;v<r.numberOfInputs;v+=1)for(let E=0;E<r.channelCount;E+=1)xU(e,f[v],E,E,_);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:v},E)=>{xU(e,g,v,c+E,_)});for(let v=0;v<r.numberOfInputs;v+=1)for(let E=0;E<i[v];E+=1)p[v][E].byteLength===0&&(p[v][E]=new Float32Array(128));try{const v=f.map((T,x)=>h.activeInputs[x].size===0?[]:T),E=a(_/n.sampleRate,n.sampleRate,()=>d.process(v,p,g));if(u!==null)for(let T=0,x=0;T<r.numberOfOutputs;T+=1){for(let N=0;N<i[T];N+=1)w0e(u,p[T],N,x+N,_);x+=i[T]}if(!E)break}catch(v){t.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},_at=(t,e,n,r,i,s,a,o,c,l,u,h,d,f,p,g)=>(_,v,E)=>{const T=new WeakMap;let x=null;const N=async(A,I)=>{let k=u(A),L=null;const U=mu(k,I),$=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(h===null){const q=$.reduce((V,Z)=>V+Z,0),G=i(I,{channelCount:Math.max(1,q),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,q)}),X=[];for(let V=0;V<A.numberOfOutputs;V+=1)X.push(r(I,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:$[V]}));const re=a(I,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});re.connect=e.bind(null,X),re.disconnect=c.bind(null,X),L=[G,X,re]}else U||(k=new h(I,_));if(T.set(I,L===null?k:L[2]),L!==null){if(x===null){if(E===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");const Z=A.channelCount*A.numberOfInputs,Y=E.parameterDescriptors===void 0?0:E.parameterDescriptors.length,ee=Z+Y;x=yat(A,ee===0?null:await(async()=>{const de=new d(ee,Math.ceil(A.context.length/128)*128,I.sampleRate),Me=[],He=[];for(let we=0;we<v.numberOfInputs;we+=1)Me.push(a(de,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),He.push(i(de,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const Te=await Promise.all(Array.from(A.parameters.values()).map(async we=>{const Ce=s(de,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:we.value});return await f(de,we,Ce.offset),Ce})),Le=r(de,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Z+Y)});for(let we=0;we<v.numberOfInputs;we+=1){Me[we].connect(He[we]);for(let Ce=0;Ce<v.channelCount;Ce+=1)He[we].connect(Le,Ce,we*v.channelCount+Ce)}for(const[we,Ce]of Te.entries())Ce.connect(Le,0,Z+we),Ce.start(0);return Le.connect(de.destination),await Promise.all(Me.map(we=>p(A,de,we))),g(de)})(),I,v,$,E,l)}const q=await x,G=n(I,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[X,re,V]=L;q!==null&&(G.buffer=q,G.start(0)),G.connect(X);for(let Z=0,Y=0;Z<A.numberOfOutputs;Z+=1){const ee=re[Z];for(let oe=0;oe<$[Z];oe+=1)X.connect(ee,Y+oe,oe);Y+=$[Z]}return V}if(U)for(const[q,G]of A.parameters.entries())await t(I,G,k.parameters.get(q));else for(const[q,G]of A.parameters.entries())await f(I,G,k.parameters.get(q));return await p(A,I,k),k};return{render(A,I){o(I,A);const k=T.get(I);return k!==void 0?Promise.resolve(k):N(A,I)}}},bat=(t,e,n,r,i,s,a,o,c,l,u,h,d,f,p,g,_,v,E,T)=>class extends p{constructor(N,A){super(N,A),this._nativeContext=N,this._audioWorklet=t===void 0?void 0:{addModule:(I,k)=>t(this,I,k)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(N,A,I){return new n({length:A,numberOfChannels:N,sampleRate:I})}createBufferSource(){return new r(this)}createChannelMerger(N=6){return new s(this,{numberOfInputs:N})}createChannelSplitter(N=6){return new a(this,{numberOfOutputs:N})}createConstantSource(){return new o(this)}createConvolver(){return new c(this)}createDelay(N=1){return new u(this,{maxDelayTime:N})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(N,A){return new f(this,{feedback:A,feedforward:N})}createOscillator(){return new g(this)}createPanner(){return new _(this)}createPeriodicWave(N,A,I={disableNormalization:!1}){return new v(this,{...I,imag:A,real:N})}createStereoPanner(){return new E(this)}createWaveShaper(){return new T(this)}decodeAudioData(N,A,I){return l(this._nativeContext,N).then(k=>(typeof A=="function"&&A(k),k),k=>{throw typeof I=="function"&&I(k),k})}},Eat={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Sat=(t,e,n,r,i,s,a,o)=>class extends t{constructor(l,u){const h=s(l),d={...Eat,...u},f=i(h,d),p=a(h),g=p?n():null;super(l,!1,f,g),this._Q=e(this,p,f.Q,Wu,Ph),this._detune=e(this,p,f.detune,1200*Math.log2(Wu),-1200*Math.log2(Wu)),this._frequency=e(this,p,f.frequency,l.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(Wu),Ph),this._nativeBiquadFilterNode=f,o(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(d){throw d.code===11?r():d}if(l.length!==u.length||u.length!==h.length)throw r()}},Tat=(t,e,n,r,i)=>()=>{const s=new WeakMap,a=async(o,c)=>{let l=n(o);const u=mu(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await t(c,o.Q,l.Q),await t(c,o.detune,l.detune),await t(c,o.frequency,l.frequency),await t(c,o.gain,l.gain)):(await r(c,o.Q,l.Q),await r(c,o.detune,l.detune),await r(c,o.frequency,l.frequency),await r(c,o.gain,l.gain)),await i(o,c,l),l};return{render(o,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},xat=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const a=r();return a instanceof Promise?(t.set(n,a),a.catch(()=>!1).then(o=>(t.delete(n),e.set(n,o),o))):(e.set(n,a),a)}catch{return e.set(n,!1),!1}},wat={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Cat=(t,e,n,r,i)=>class extends t{constructor(a,o){const c=r(a),l={...wat,...o},u=n(c,l),h=i(c)?e():null;super(a,!1,u,h)}},Rat=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,a)=>{let o=e(s);if(!mu(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(a,l)}return r.set(a,o),await n(s,a,o),o};return{render(s,a){const o=r.get(a);return o!==void 0?Promise.resolve(o):i(s,a)}}},Aat={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Mat=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=r(o),u=s({...Aat,...c}),h=n(l,u),d=i(l)?e():null;super(o,!1,h,d)}},Oat=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,a)=>{let o=e(s);if(!mu(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(a,l)}return r.set(a,o),await n(s,a,o),o};return{render(s,a){const o=r.get(a);return o!==void 0?Promise.resolve(o):i(s,a)}}},Nat=t=>(e,n,r)=>t(n,e,r),Iat=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return TU(n)?s.connect(n,0,i):s.connect(n,0)},kat=t=>(e,n)=>{const r=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}},Dat={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Pat=(t,e,n,r,i,s,a)=>class extends t{constructor(c,l){const u=i(c),h={...Dat,...l},d=r(u,h),f=s(u),p=f?n():null;super(c,!1,d,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=d,this._offset=e(this,f,d.offset,Wu,Ph),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?a(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){wC(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),Xv(this)&&hI(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Lat=(t,e,n,r,i)=>()=>{const s=new WeakMap;let a=null,o=null;const c=async(l,u)=>{let h=n(l);const d=mu(h,u);if(!d){const f={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,f),a!==null&&h.start(a),o!==null&&h.stop(o)}return s.set(u,h),d?await t(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){a=l},set stop(l){o=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},Uat=t=>e=>(t[0]=e,t[0]),Bat={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Fat=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=r(o),u={...Bat,...c},h=n(l,u),f=i(l)?e():null;super(o,!1,h,f),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(o){if(this._nativeConvolverNode.buffer=o,o===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(o){this._nativeConvolverNode.normalize=o}},zat=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,a)=>{let o=e(s);if(!mu(o,a)){const l={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(a,l)}return r.set(a,o),sR(o)?await n(s,a,o.inputs[0]):await n(s,a,o),o};return{render(s,a){const o=r.get(a);return o!==void 0?Promise.resolve(o):i(s,a)}}},Hat=(t,e)=>(n,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){throw s.name==="SyntaxError"?t():s}},jat=()=>new DOMException("","DataCloneError"),Cne=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(r=>{const i=()=>{n.onmessage=null,e.close(),n.close(),r()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},Vat=(t,e,n,r,i,s,a,o,c,l,u)=>(h,d)=>{const f=a(h)?h:s(h);if(i.has(d)){const p=n();return Promise.reject(p)}try{i.add(d)}catch{}return e(c,()=>c(f))?f.decodeAudioData(d).then(p=>(Cne(d).catch(()=>{}),e(o,()=>o(p))||u(p),t.add(p),p)):new Promise((p,g)=>{const _=async()=>{try{await Cne(d)}catch{}},v=E=>{g(E),_()};try{f.decodeAudioData(d,E=>{typeof E.copyFromChannel!="function"&&(l(E),P9(E)),t.add(E),_().then(()=>p(E))},E=>{v(E===null?r():E)})}catch(E){v(E)}})},Gat=(t,e,n,r,i,s,a,o)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),d=o(h);if(u===l){if(e.delete(c),!d&&a(c)){const f=r(c),{outputs:p}=n(c);for(const g of p)if(fI(g)){const _=r(g[0]);t(f,_,g[1],g[2])}else{const _=i(g[0]);f.connect(_,g[1])}}}else e.set(c,u-l)},qat={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},$at=(t,e,n,r,i,s,a)=>class extends t{constructor(c,l){const u=i(c),h={...qat,...l},d=r(u,h),f=s(u),p=f?n(h.maxDelayTime):null;super(c,!1,d,p),this._delayTime=e(this,f,d.delayTime),a(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},Wat=(t,e,n,r,i)=>s=>{const a=new WeakMap,o=async(c,l)=>{let u=n(c);const h=mu(u,l);if(!h){const d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,d)}return a.set(l,u),h?await t(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=a.get(l);return u!==void 0?Promise.resolve(u):o(c,l)}}},Yat=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),Xat=t=>(e,n)=>{t(e).delete(n)},Kat=t=>"delayTime"in t,Jat=(t,e,n)=>function r(i,s){const a=bU(s)?s:n(t,s);if(Kat(a))return[];if(i[0]===a)return[i];if(i.includes(a))return[];const{outputs:o}=e(a);return Array.from(o).map(c=>r([...i,a],c[0])).reduce((c,l)=>c.concat(l),[])},CD=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},Zat=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?CD(t,e,n).disconnect():TU(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?CD(t,e,r).disconnect(n,0):CD(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):CD(t,e,r).disconnect(n,0),Qat={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},eot=(t,e,n,r,i,s,a,o)=>class extends t{constructor(l,u){const h=s(l),d={...Qat,...u},f=r(h,d),p=a(h),g=p?n():null;super(l,!1,f,g),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),o(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},tot=(t,e,n,r,i)=>()=>{const s=new WeakMap,a=async(o,c)=>{let l=n(o);const u=mu(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await t(c,o.attack,l.attack),await t(c,o.knee,l.knee),await t(c,o.ratio,l.ratio),await t(c,o.release,l.release),await t(c,o.threshold,l.threshold)):(await r(c,o.attack,l.attack),await r(c,o.knee,l.knee),await r(c,o.ratio,l.ratio),await r(c,o.release,l.release),await r(c,o.threshold,l.threshold)),await i(o,c,l),l};return{render(o,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},not=()=>new DOMException("","EncodingError"),rot=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(a),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(o)};t.onerror=(u,h,d,f,p)=>{if(h===o||h===t.location.href&&d===1&&f===1)return l(),r(p),!1;if(c!==null)return c(u,h,d,f,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),n()},s.src=o,s.type="module",i.appendChild(s)}}),iot=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},sot=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},aot=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},oot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},cot=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=i(o),u={...oot,...c},h=r(l,u),d=s(l),f=d?n():null;super(o,!1,h,f),this._gain=e(this,d,h.gain,Wu,Ph)}get gain(){return this._gain}},lot=(t,e,n,r,i)=>()=>{const s=new WeakMap,a=async(o,c)=>{let l=n(o);const u=mu(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await t(c,o.gain,l.gain):await r(c,o.gain,l.gain),await i(o,c,l),l};return{render(o,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},uot=(t,e)=>n=>e(t,n),hot=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},dot=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},fot=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},pot=t=>e=>t.get(e),ml=()=>new DOMException("","InvalidStateError"),mot=t=>e=>{const n=t.get(e);if(n===void 0)throw ml();return n},got=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},vot=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},C6=()=>new DOMException("","InvalidAccessError"),yot=t=>{t.getFrequencyResponse=(e=>(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw C6();return e.call(t,n,r,i)})(t.getFrequencyResponse)},_ot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},bot=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=r(o),u=i(l),h={..._ot,...c},d=e(l,u?null:o.baseLatency,h),f=u?n(h.feedback,h.feedforward):null;super(o,!1,d,f),yot(d),this._nativeIIRFilterNode=d,s(this,1)}getFrequencyResponse(o,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(o,c,l)}},C0e=(t,e,n,r,i,s,a,o,c,l,u)=>{const h=l.length;let d=o;for(let f=0;f<h;f+=1){let p=n[0]*l[f];for(let g=1;g<i;g+=1){const _=d-g&c-1;p+=n[g]*s[_],p-=t[g]*a[_]}for(let g=i;g<r;g+=1)p+=n[g]*s[d-g&c-1];for(let g=i;g<e;g+=1)p-=t[g]*a[d-g&c-1];s[d]=l[f],a[d]=p,d=d+1&c-1,u[f]=p}return d},Eot=(t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),a=i.length,o=s.length,c=Math.min(a,o);if(i[0]!==1){for(let p=0;p<a;p+=1)s[p]/=i[0];for(let p=1;p<o;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),d=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),f=t.numberOfChannels;for(let p=0;p<f;p+=1){const g=t.getChannelData(p),_=d.getChannelData(p);u.fill(0),h.fill(0),C0e(i,a,s,o,c,u,h,0,l,g,_)}return d},Sot=(t,e,n,r,i)=>(s,a)=>{const o=new WeakMap;let c=null;const l=async(u,h)=>{let d=null,f=e(u);const p=mu(f,h);if(h.createIIRFilter===void 0?d=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=h.createIIRFilter(a,s)),o.set(h,d===null?f:d),d!==null){if(c===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new n(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,_,_.destination);const v=await i(_);return Eot(v,h,s,a)})()}const g=await c;return d.buffer=g,d.start(0),d}return await r(u,h,f),f};return{render(u,h){const d=o.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Tot=(t,e,n,r,i,s)=>a=>(o,c)=>{const l=t.get(o);if(l===void 0){if(!a&&s(o)){const u=r(o),{outputs:h}=n(o);for(const d of h)if(fI(d)){const f=r(d[0]);e(u,f,d[1],d[2])}else{const f=i(d[0]);u.disconnect(f,d[1])}}t.set(o,c)}else t.set(o,l+c)},xot=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},wot=(t,e)=>n=>t.has(n)||e(n),Cot=(t,e)=>n=>t.has(n)||e(n),Rot=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},Aot=t=>e=>t!==null&&e instanceof t,Mot=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,Oot=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,Not=(t,e)=>n=>t(n)||e(n),Iot=t=>e=>t!==null&&e instanceof t,kot=t=>t!==null&&t.isSecureContext,Dot=(t,e,n,r)=>class extends t{constructor(s,a){const o=n(s),c=e(o,a);if(r(o))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},Pot={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Lot=(t,e,n,r)=>class extends t{constructor(s,a){const o=n(s);if(r(o))throw new TypeError;const c={...Pot,...a},l=e(o,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},Uot=(t,e,n,r)=>class extends t{constructor(s,a){const o=n(s),c=e(o,a);if(r(o))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},Bot=(t,e,n)=>class extends t{constructor(i,s){const a=n(i),o=e(a,s);super(i,!0,o,null)}},Fot=(t,e,n,r,i,s)=>class extends n{constructor(o,c){super(o),this._nativeContext=o,x6.set(this,o),r(o)&&i.set(o,new Set),this._destination=new t(this,c),this._listener=e(this,o),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(o){const c=typeof o=="function"?s(this,o):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?o:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},AO=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},zot=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(a=>(o,c=0,l=0)=>{const u=s.size===0;if(e(o))return a.call(n,o,c,l),t(s,[o,c,l],h=>h[0]===o&&h[1]===c&&h[2]===l,!0),u&&r(),o;a.call(n,o,c),t(s,[o,c],h=>h[0]===o&&h[1]===c,!0),u&&r()})(n.connect),n.disconnect=(a=>(o,c,l)=>{const u=s.size>0;if(o===void 0)a.apply(n),s.clear();else if(typeof o=="number"){a.call(n,o);for(const d of s)d[1]===o&&s.delete(d)}else{e(o)?a.call(n,o,c,l):a.call(n,o,c);for(const d of s)d[0]===o&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&s.delete(d)}const h=s.size===0;u&&h&&i()})(n.disconnect),n},Na=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},Gc=(t,e)=>{Na(t,e,"channelCount"),Na(t,e,"channelCountMode"),Na(t,e,"channelInterpretation")},Rne=t=>typeof t.getFloatTimeDomainData=="function",Hot=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=(n[i]-128)*.0078125;return e}},jot=(t,e)=>(n,r)=>{const i=n.createAnalyser();if(Gc(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Na(i,r,"fftSize"),Na(i,r,"maxDecibels"),Na(i,r,"minDecibels"),Na(i,r,"smoothingTimeConstant"),t(Rne,()=>Rne(i))||Hot(i),i},Vot=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,_o=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},Got=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw ml();e.call(t,r,i,s),n=!0}})(t.start)},B9=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},F9=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},qot=(t,e,n,r,i,s,a,o,c,l,u)=>(h,d)=>{const f=h.createBufferSource();return Gc(f,d),_o(f,d,"playbackRate"),Na(f,d,"buffer"),Na(f,d,"loop"),Na(f,d,"loopEnd"),Na(f,d,"loopStart"),e(n,()=>n(h))||Got(f),e(r,()=>r(h))||c(f),e(i,()=>i(h))||l(f,h),e(s,()=>s(h))||B9(f),e(a,()=>a(h))||u(f,h),e(o,()=>o(h))||F9(f),t(h,f),f},$ot=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,Wot=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const a=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(a,"channelCount",o=>()=>o.call(a),o=>c=>{o.call(a,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(a,"channelCountMode",o=>()=>o.call(a),o=>c=>{o.call(a,c),s.channelCountMode=c}),e(a,"channelInterpretation",o=>()=>o.call(a),o=>c=>{o.call(a,c),s.channelInterpretation=c}),Object.defineProperty(a,"maxChannelCount",{get:()=>s.maxChannelCount}),a.connect(s),a},Yot=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,Xot=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},Kot=(t,e,n,r,i)=>(s,a,o,c,l,u)=>{if(o!==null)try{const h=new o(s,c,u),d=new Map;let f=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&h.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&h.addEventListener("processorerror",f)}}}),h.addEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const _=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(_!==null){const v=d.get(g[1]);v!==void 0?g[1]=v:(g[1]=E=>{E.type==="error"?(Object.defineProperties(E,{type:{value:"processorerror"}}),_(E)):_(new ErrorEvent(g[0],{...E}))},d.set(_,g[1]))}}return p.call(h,"error",g[1],g[2]),p.call(h,...g)})(h.addEventListener),h.removeEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const _=d.get(g[1]);_!==void 0&&(d.delete(g[1]),g[1]=_)}return p.call(h,"error",g[1],g[2]),p.call(h,g[0],g[1],g[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(s.destination),i(h,()=>p.disconnect(),()=>p.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return Xot(u),e(s,a,l,u)},R0e=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Jot=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),Zot=async(t,e)=>{const n=await Jot(e);return new t(n)},Qot=(t,e,n,r)=>{let i=_G.get(t);i===void 0&&(i=new WeakMap,_G.set(t,i));const s=Zot(n,r);return i.set(e,s),s},ect=(t,e,n,r,i,s,a,o,c,l,u,h,d)=>(f,p,g,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const v=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(v.some(Fe=>Fe<1))throw c();if(v.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const E=_.channelCount*_.numberOfInputs,T=v.reduce((Fe,Ie)=>Fe+Ie,0),x=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(E+x>6||T>6)throw c();const N=new MessageChannel,A=[],I=[];for(let Fe=0;Fe<_.numberOfInputs;Fe+=1)A.push(a(f,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),I.push(i(f,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const k=[];if(g.parameterDescriptors!==void 0)for(const{defaultValue:Fe,maxValue:Ie,minValue:rt,name:dt}of g.parameterDescriptors){const gt=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[dt]!==void 0?_.parameterData[dt]:Fe===void 0?0:Fe});Object.defineProperties(gt.offset,{defaultValue:{get:()=>Fe===void 0?0:Fe},maxValue:{get:()=>Ie===void 0?Wu:Ie},minValue:{get:()=>rt===void 0?Ph:rt}}),k.push(gt)}const L=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,E+x)}),U=R0e(p,f.sampleRate),$=o(f,U,E+x,Math.max(1,T)),q=i(f,{channelCount:Math.max(1,T),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,T)}),G=[];for(let Fe=0;Fe<_.numberOfOutputs;Fe+=1)G.push(r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[Fe]}));for(let Fe=0;Fe<_.numberOfInputs;Fe+=1){A[Fe].connect(I[Fe]);for(let Ie=0;Ie<_.channelCount;Ie+=1)I[Fe].connect(L,Ie,Fe*_.channelCount+Ie)}const X=new x0e(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:Fe},Ie)=>{const rt=k[Ie];return rt.connect(L,0,E+Ie),rt.start(0),[Fe,rt.offset]}));L.connect($);let re=_.channelInterpretation,V=null;const Z=_.numberOfOutputs===0?[$]:G,Y={get bufferSize(){return U},get channelCount(){return _.channelCount},set channelCount(Fe){throw n()},get channelCountMode(){return _.channelCountMode},set channelCountMode(Fe){throw n()},get channelInterpretation(){return re},set channelInterpretation(Fe){for(const Ie of A)Ie.channelInterpretation=Fe;re=Fe},get context(){return $.context},get inputs(){return A},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return V},set onprocessorerror(Fe){typeof V=="function"&&Y.removeEventListener("processorerror",V),V=typeof Fe=="function"?Fe:null,typeof V=="function"&&Y.addEventListener("processorerror",V)},get parameters(){return X},get port(){return N.port2},addEventListener(...Fe){return $.addEventListener(Fe[0],Fe[1],Fe[2])},connect:t.bind(null,Z),disconnect:l.bind(null,Z),dispatchEvent(...Fe){return $.dispatchEvent(Fe[0])},removeEventListener(...Fe){return $.removeEventListener(Fe[0],Fe[1],Fe[2])}},ee=new Map;N.port1.addEventListener=(Fe=>(...Ie)=>{if(Ie[0]==="message"){const rt=typeof Ie[1]=="function"?Ie[1]:typeof Ie[1]=="object"&&Ie[1]!==null&&typeof Ie[1].handleEvent=="function"?Ie[1].handleEvent:null;if(rt!==null){const dt=ee.get(Ie[1]);dt!==void 0?Ie[1]=dt:(Ie[1]=gt=>{u(f.currentTime,f.sampleRate,()=>rt(gt))},ee.set(rt,Ie[1]))}}return Fe.call(N.port1,Ie[0],Ie[1],Ie[2])})(N.port1.addEventListener),N.port1.removeEventListener=(Fe=>(...Ie)=>{if(Ie[0]==="message"){const rt=ee.get(Ie[1]);rt!==void 0&&(ee.delete(Ie[1]),Ie[1]=rt)}return Fe.call(N.port1,Ie[0],Ie[1],Ie[2])})(N.port1.removeEventListener);let oe=null;Object.defineProperty(N.port1,"onmessage",{get:()=>oe,set:Fe=>{typeof oe=="function"&&N.port1.removeEventListener("message",oe),oe=typeof Fe=="function"?Fe:null,typeof oe=="function"&&(N.port1.addEventListener("message",oe),N.port1.start())}}),g.prototype.port=N.port1;let de=null;Qot(f,Y,g,_).then(Fe=>de=Fe);const He=wU(_.numberOfInputs,_.channelCount),Te=wU(_.numberOfOutputs,v),Le=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((Fe,{name:Ie})=>({...Fe,[Ie]:new Float32Array(128)}),{});let we=!0;const Ce=()=>{_.numberOfOutputs>0&&$.disconnect(q);for(let Fe=0,Ie=0;Fe<_.numberOfOutputs;Fe+=1){const rt=G[Fe];for(let dt=0;dt<v[Fe];dt+=1)q.disconnect(rt,Ie+dt,dt);Ie+=v[Fe]}},ke=new Map;$.onaudioprocess=({inputBuffer:Fe,outputBuffer:Ie})=>{if(de!==null){const rt=h(Y);for(let dt=0;dt<U;dt+=128){for(let gt=0;gt<_.numberOfInputs;gt+=1)for(let bt=0;bt<_.channelCount;bt+=1)xU(Fe,He[gt],bt,bt,dt);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:gt},bt)=>{xU(Fe,Le,gt,E+bt,dt)});for(let gt=0;gt<_.numberOfInputs;gt+=1)for(let bt=0;bt<v[gt];bt+=1)Te[gt][bt].byteLength===0&&(Te[gt][bt]=new Float32Array(128));try{const gt=He.map((be,ue)=>{if(rt[ue].size>0)return ke.set(ue,U/128),be;const nt=ke.get(ue);return nt===void 0?[]:(be.every($e=>$e.every(Ue=>Ue===0))&&(nt===1?ke.delete(ue):ke.set(ue,nt-1)),be)});we=u(f.currentTime+dt/f.sampleRate,f.sampleRate,()=>de.process(gt,Te,Le));for(let be=0,ue=0;be<_.numberOfOutputs;be+=1){for(let Xe=0;Xe<v[be];Xe+=1)w0e(Ie,Te[be],Xe,ue+Xe,dt);ue+=v[be]}}catch(gt){we=!1,Y.dispatchEvent(new ErrorEvent("processorerror",{colno:gt.colno,filename:gt.filename,lineno:gt.lineno,message:gt.message}))}if(!we){for(let gt=0;gt<_.numberOfInputs;gt+=1){A[gt].disconnect(I[gt]);for(let bt=0;bt<_.channelCount;bt+=1)I[dt].disconnect(L,bt,gt*_.channelCount+bt)}if(g.parameterDescriptors!==void 0){const gt=g.parameterDescriptors.length;for(let bt=0;bt<gt;bt+=1){const be=k[bt];be.disconnect(L,0,E+bt),be.stop()}}L.disconnect($),$.onaudioprocess=null,St?Ce():ye();break}}}};let St=!1;const At=a(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Ee=()=>$.connect(At).connect(f.destination),ye=()=>{$.disconnect(At),At.disconnect()},et=()=>{if(we){ye(),_.numberOfOutputs>0&&$.connect(q);for(let Fe=0,Ie=0;Fe<_.numberOfOutputs;Fe+=1){const rt=G[Fe];for(let dt=0;dt<v[Fe];dt+=1)q.connect(rt,Ie+dt,dt);Ie+=v[Fe]}}St=!0},fe=()=>{we&&(Ee(),Ce()),St=!1};return Ee(),d(Y,et,fe)},A0e=(t,e)=>{const n=t.createBiquadFilter();return Gc(n,e),_o(n,e,"Q"),_o(n,e,"detune"),_o(n,e,"frequency"),_o(n,e,"gain"),Na(n,e,"type"),n},tct=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),Gc(i,r),i},nct=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw ml()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw ml()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw ml()}})},pI=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Gc(n,e),nct(n),n},rct=(t,e,n,r,i)=>(s,a)=>{if(s.createConstantSource===void 0)return n(s,a);const o=s.createConstantSource();return Gc(o,a),_o(o,a,"offset"),e(r,()=>r(s))||B9(o),e(i,()=>i(s))||F9(o),t(s,o),o},aR=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),ict=(t,e,n,r)=>(i,{offset:s,...a})=>{const o=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...a,gain:s}),u=o.getChannelData(0);u[0]=1,u[1]=1,c.buffer=o,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},d=()=>c.connect(l),f=()=>c.disconnect(l);return t(i,c),r(aR(h,l),d,f)},sct=(t,e)=>(n,r)=>{const i=n.createConvolver();if(Gc(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Na(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>a=>{if(a>2)throw t();return s.call(i,a)}),r.channelCountMode==="max"))throw t();return e(i,"channelCountMode",s=>()=>s.call(i),s=>a=>{if(a==="max")throw t();return s.call(i,a)}),i},M0e=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Gc(n,e),_o(n,e,"delayTime"),n},act=t=>(e,n)=>{const r=e.createDynamicsCompressor();if(Gc(r,n),n.channelCount>2||n.channelCountMode==="max")throw t();return _o(r,n,"attack"),_o(r,n,"knee"),_o(r,n,"ratio"),_o(r,n,"release"),_o(r,n,"threshold"),r},rd=(t,e)=>{const n=t.createGain();return Gc(n,e),_o(n,e,"gain"),n},oct=t=>(e,n,r)=>{if(e.createIIRFilter===void 0)return t(e,n,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return Gc(i,r),i};function cct(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function lct(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function Ane(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)n=lct(n,e),n[0]+=t[r];return n}const uct=(t,e,n,r)=>(i,s,{channelCount:a,channelCountMode:o,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=R0e(s,i.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),p=d.length,g=f.length,_=Math.min(p,g);if(p===0||p>20)throw r();if(d[0]===0)throw e();if(g===0||g>20)throw r();if(f[0]===0)throw e();if(d[0]!==1){for(let k=0;k<g;k+=1)f[k]/=d[0];for(let k=1;k<p;k+=1)d[k]/=d[0]}const v=n(i,h,a,a);v.channelCount=a,v.channelCountMode=o,v.channelInterpretation=c;const E=32,T=[],x=[],N=[];for(let k=0;k<a;k+=1){T.push(0);const L=new Float32Array(E),U=new Float32Array(E);L.fill(0),U.fill(0),x.push(L),N.push(U)}v.onaudioprocess=k=>{const L=k.inputBuffer,U=k.outputBuffer,$=L.numberOfChannels;for(let q=0;q<$;q+=1){const G=L.getChannelData(q),X=U.getChannelData(q);T[q]=C0e(d,p,f,g,_,x[q],N[q],T[q],E,G,X)}};const A=i.sampleRate/2;return aR({get bufferSize(){return h},get channelCount(){return v.channelCount},set channelCount(k){v.channelCount=k},get channelCountMode(){return v.channelCountMode},set channelCountMode(k){v.channelCountMode=k},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(k){v.channelInterpretation=k},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...k){return v.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return v.dispatchEvent(k[0])},getFrequencyResponse(k,L,U){if(k.length!==L.length||L.length!==U.length)throw t();const $=k.length;for(let q=0;q<$;q+=1){const G=-Math.PI*(k[q]/A),X=[Math.cos(G),Math.sin(G)],re=Ane(f,X),V=Ane(d,X),Z=cct(re,V);L[q]=Math.sqrt(Z[0]*Z[0]+Z[1]*Z[1]),U[q]=Math.atan2(Z[1],Z[0])}},removeEventListener(...k){return v.removeEventListener(k[0],k[1],k[2])}},v)},hct=(t,e)=>t.createMediaElementSource(e.mediaElement),dct=(t,e)=>{const n=t.createMediaStreamDestination();return Gc(n,e),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},fct=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,a)=>s.id<a.id?-1:s.id>a.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},pct=(t,e)=>(n,{mediaStreamTrack:r})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if(r.kind!=="audio")throw t();if(e(n))throw new TypeError;return s},mct=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,gct=(t,e,n,r,i,s)=>(a,o)=>{const c=a.createOscillator();return Gc(c,o),_o(c,o,"detune"),_o(c,o,"frequency"),o.periodicWave!==void 0?c.setPeriodicWave(o.periodicWave):Na(c,o,"type"),e(n,()=>n(a))||B9(c),e(r,()=>r(a))||s(c,a),e(i,()=>i(a))||F9(c),t(a,c),c},vct=t=>(e,n)=>{const r=e.createPanner();return r.orientationX===void 0?t(e,n):(Gc(r,n),_o(r,n,"orientationX"),_o(r,n,"orientationY"),_o(r,n,"orientationZ"),_o(r,n,"positionX"),_o(r,n,"positionY"),_o(r,n,"positionZ"),Na(r,n,"coneInnerAngle"),Na(r,n,"coneOuterAngle"),Na(r,n,"coneOuterGain"),Na(r,n,"distanceModel"),Na(r,n,"maxDistance"),Na(r,n,"panningModel"),Na(r,n,"refDistance"),Na(r,n,"rolloffFactor"),r)},yct=(t,e,n,r,i,s,a,o,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:f,distanceModel:p,maxDistance:g,orientationX:_,orientationY:v,orientationZ:E,panningModel:T,positionX:x,positionY:N,positionZ:A,refDistance:I,rolloffFactor:k,...L})=>{const U=u.createPanner();if(L.channelCount>2||L.channelCountMode==="max")throw a();Gc(U,L);const $={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},q=n(u,{...$,channelInterpretation:"speakers",numberOfInputs:6}),G=r(u,{...L,gain:1}),X=r(u,{...$,gain:1}),re=r(u,{...$,gain:0}),V=r(u,{...$,gain:0}),Z=r(u,{...$,gain:0}),Y=r(u,{...$,gain:0}),ee=r(u,{...$,gain:0}),oe=i(u,256,6,1),de=s(u,{...$,curve:new Float32Array([1,1]),oversample:"none"});let Me=[_,v,E],He=[x,N,A];const Te=new Float32Array(1);oe.onaudioprocess=({inputBuffer:ke})=>{const St=[c(ke,Te,0),c(ke,Te,1),c(ke,Te,2)];St.some((Ee,ye)=>Ee!==Me[ye])&&(U.setOrientation(...St),Me=St);const At=[c(ke,Te,3),c(ke,Te,4),c(ke,Te,5)];At.some((Ee,ye)=>Ee!==He[ye])&&(U.setPosition(...At),He=At)},Object.defineProperty(re.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ee.gain,"defaultValue",{get:()=>0});const Le={get bufferSize(){},get channelCount(){return U.channelCount},set channelCount(ke){if(ke>2)throw a();G.channelCount=ke,U.channelCount=ke},get channelCountMode(){return U.channelCountMode},set channelCountMode(ke){if(ke==="max")throw a();G.channelCountMode=ke,U.channelCountMode=ke},get channelInterpretation(){return U.channelInterpretation},set channelInterpretation(ke){G.channelInterpretation=ke,U.channelInterpretation=ke},get coneInnerAngle(){return U.coneInnerAngle},set coneInnerAngle(ke){U.coneInnerAngle=ke},get coneOuterAngle(){return U.coneOuterAngle},set coneOuterAngle(ke){U.coneOuterAngle=ke},get coneOuterGain(){return U.coneOuterGain},set coneOuterGain(ke){if(ke<0||ke>1)throw e();U.coneOuterGain=ke},get context(){return U.context},get distanceModel(){return U.distanceModel},set distanceModel(ke){U.distanceModel=ke},get inputs(){return[G]},get maxDistance(){return U.maxDistance},set maxDistance(ke){if(ke<0)throw new RangeError;U.maxDistance=ke},get numberOfInputs(){return U.numberOfInputs},get numberOfOutputs(){return U.numberOfOutputs},get orientationX(){return X.gain},get orientationY(){return re.gain},get orientationZ(){return V.gain},get panningModel(){return U.panningModel},set panningModel(ke){U.panningModel=ke},get positionX(){return Z.gain},get positionY(){return Y.gain},get positionZ(){return ee.gain},get refDistance(){return U.refDistance},set refDistance(ke){if(ke<0)throw new RangeError;U.refDistance=ke},get rolloffFactor(){return U.rolloffFactor},set rolloffFactor(ke){if(ke<0)throw new RangeError;U.rolloffFactor=ke},addEventListener(...ke){return G.addEventListener(ke[0],ke[1],ke[2])},dispatchEvent(...ke){return G.dispatchEvent(ke[0])},removeEventListener(...ke){return G.removeEventListener(ke[0],ke[1],ke[2])}};h!==Le.coneInnerAngle&&(Le.coneInnerAngle=h),d!==Le.coneOuterAngle&&(Le.coneOuterAngle=d),f!==Le.coneOuterGain&&(Le.coneOuterGain=f),p!==Le.distanceModel&&(Le.distanceModel=p),g!==Le.maxDistance&&(Le.maxDistance=g),_!==Le.orientationX.value&&(Le.orientationX.value=_),v!==Le.orientationY.value&&(Le.orientationY.value=v),E!==Le.orientationZ.value&&(Le.orientationZ.value=E),T!==Le.panningModel&&(Le.panningModel=T),x!==Le.positionX.value&&(Le.positionX.value=x),N!==Le.positionY.value&&(Le.positionY.value=N),A!==Le.positionZ.value&&(Le.positionZ.value=A),I!==Le.refDistance&&(Le.refDistance=I),k!==Le.rolloffFactor&&(Le.rolloffFactor=k),(Me[0]!==1||Me[1]!==0||Me[2]!==0)&&U.setOrientation(...Me),(He[0]!==0||He[1]!==0||He[2]!==0)&&U.setPosition(...He);const we=()=>{G.connect(U),t(G,de,0,0),de.connect(X).connect(q,0,0),de.connect(re).connect(q,0,1),de.connect(V).connect(q,0,2),de.connect(Z).connect(q,0,3),de.connect(Y).connect(q,0,4),de.connect(ee).connect(q,0,5),q.connect(oe).connect(u.destination)},Ce=()=>{G.disconnect(U),o(G,de,0,0),de.disconnect(X),X.disconnect(q),de.disconnect(re),re.disconnect(q),de.disconnect(V),V.disconnect(q),de.disconnect(Z),Z.disconnect(q),de.disconnect(Y),Y.disconnect(q),de.disconnect(ee),ee.disconnect(q),q.disconnect(oe),oe.disconnect(u.destination)};return l(aR(Le,U),we,Ce)},_ct=t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),a=i instanceof Float32Array?i:new Float32Array(i),o=e.createPeriodicWave(a,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return o},mI=(t,e,n,r)=>t.createScriptProcessor(e,n,r),bct=(t,e)=>(n,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(n.createStereoPanner===void 0)return t(n,r);const s=n.createStereoPanner();return Gc(s,r),_o(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:a=>{if(a!==i)throw e()}}),s},Ect=(t,e,n,r,i,s)=>{const o=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,g,_,v)=>{const E=new Float32Array(16385),T=new Float32Array(16385);for(let L=0;L<16385;L+=1){const U=L/16384*c;E[L]=Math.cos(U),T[L]=Math.sin(U)}const x=n(p,{...l,gain:0}),N=r(p,{...u,curve:E}),A=r(p,{...u,curve:o}),I=n(p,{...l,gain:0}),k=r(p,{...u,curve:T});return{connectGraph(){g.connect(x),g.connect(A.inputs===void 0?A:A.inputs[0]),g.connect(I),A.connect(_),_.connect(N.inputs===void 0?N:N.inputs[0]),_.connect(k.inputs===void 0?k:k.inputs[0]),N.connect(x.gain),k.connect(I.gain),x.connect(v,0,0),I.connect(v,0,1)},disconnectGraph(){g.disconnect(x),g.disconnect(A.inputs===void 0?A:A.inputs[0]),g.disconnect(I),A.disconnect(_),_.disconnect(N.inputs===void 0?N:N.inputs[0]),_.disconnect(k.inputs===void 0?k:k.inputs[0]),N.disconnect(x.gain),k.disconnect(I.gain),x.disconnect(v,0,0),I.disconnect(v,0,1)}}},d=(p,g,_,v)=>{const E=new Float32Array(16385),T=new Float32Array(16385),x=new Float32Array(16385),N=new Float32Array(16385),A=Math.floor(16385/2);for(let Z=0;Z<16385;Z+=1)if(Z>A){const Y=(Z-A)/(16384-A)*c;E[Z]=Math.cos(Y),T[Z]=Math.sin(Y),x[Z]=0,N[Z]=1}else{const Y=Z/(16384-A)*c;E[Z]=1,T[Z]=0,x[Z]=Math.cos(Y),N[Z]=Math.sin(Y)}const I=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),k=n(p,{...l,gain:0}),L=r(p,{...u,curve:E}),U=n(p,{...l,gain:0}),$=r(p,{...u,curve:T}),q=r(p,{...u,curve:o}),G=n(p,{...l,gain:0}),X=r(p,{...u,curve:x}),re=n(p,{...l,gain:0}),V=r(p,{...u,curve:N});return{connectGraph(){g.connect(I),g.connect(q.inputs===void 0?q:q.inputs[0]),I.connect(k,0),I.connect(U,0),I.connect(G,1),I.connect(re,1),q.connect(_),_.connect(L.inputs===void 0?L:L.inputs[0]),_.connect($.inputs===void 0?$:$.inputs[0]),_.connect(X.inputs===void 0?X:X.inputs[0]),_.connect(V.inputs===void 0?V:V.inputs[0]),L.connect(k.gain),$.connect(U.gain),X.connect(G.gain),V.connect(re.gain),k.connect(v,0,0),G.connect(v,0,0),U.connect(v,0,1),re.connect(v,0,1)},disconnectGraph(){g.disconnect(I),g.disconnect(q.inputs===void 0?q:q.inputs[0]),I.disconnect(k,0),I.disconnect(U,0),I.disconnect(G,1),I.disconnect(re,1),q.disconnect(_),_.disconnect(L.inputs===void 0?L:L.inputs[0]),_.disconnect($.inputs===void 0?$:$.inputs[0]),_.disconnect(X.inputs===void 0?X:X.inputs[0]),_.disconnect(V.inputs===void 0?V:V.inputs[0]),L.disconnect(k.gain),$.disconnect(U.gain),X.disconnect(G.gain),V.disconnect(re.gain),k.disconnect(v,0,0),G.disconnect(v,0,0),U.disconnect(v,0,1),re.disconnect(v,0,1)}}},f=(p,g,_,v,E)=>{if(g===1)return h(p,_,v,E);if(g===2)return d(p,_,v,E);throw i()};return(p,{channelCount:g,channelCountMode:_,pan:v,...E})=>{if(_==="max")throw i();const T=t(p,{...E,channelCount:1,channelCountMode:_,numberOfInputs:2}),x=n(p,{...E,channelCount:g,channelCountMode:_,gain:1}),N=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:A,disconnectGraph:I}=f(p,g,x,N,T);Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"maxValue",{get:()=>1}),Object.defineProperty(N.gain,"minValue",{get:()=>-1});const k={get bufferSize(){},get channelCount(){return x.channelCount},set channelCount(q){x.channelCount!==q&&(L&&I(),{connectGraph:A,disconnectGraph:I}=f(p,q,x,N,T),L&&A()),x.channelCount=q},get channelCountMode(){return x.channelCountMode},set channelCountMode(q){if(q==="clamped-max"||q==="max")throw i();x.channelCountMode=q},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(q){x.channelInterpretation=q},get context(){return x.context},get inputs(){return[x]},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},get pan(){return N.gain},addEventListener(...q){return x.addEventListener(q[0],q[1],q[2])},dispatchEvent(...q){return x.dispatchEvent(q[0])},removeEventListener(...q){return x.removeEventListener(q[0],q[1],q[2])}};let L=!1;const U=()=>{A(),L=!0},$=()=>{I(),L=!1};return s(aR(k,T),U,$)}},Sct=(t,e,n,r,i,s,a)=>(o,c)=>{const l=o.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&o.createGain().gain.automationRate===void 0)return n(o,c);Gc(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Na(l,{curve:u},"curve"),Na(l,c,"oversample");let h=null,d=!1;return a(l,"curve",g=>()=>g.call(l),g=>_=>(g.call(l,_),d&&(r(_)&&h===null?h=t(o,l):!r(_)&&h!==null&&(h(),h=null)),_)),i(l,()=>{d=!0,r(l.curve)&&(h=t(o,l))},()=>{d=!1,h!==null&&(h(),h=null)})},Tct=(t,e,n,r,i)=>(s,{curve:a,oversample:o,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();Gc(l,c),Gc(u,c);const h=n(s,{...c,gain:1}),d=n(s,{...c,gain:-1}),f=n(s,{...c,gain:1}),p=n(s,{...c,gain:-1});let g=null,_=!1,v=null;const E={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(N){h.channelCount=N,d.channelCount=N,l.channelCount=N,f.channelCount=N,u.channelCount=N,p.channelCount=N},get channelCountMode(){return l.channelCountMode},set channelCountMode(N){h.channelCountMode=N,d.channelCountMode=N,l.channelCountMode=N,f.channelCountMode=N,u.channelCountMode=N,p.channelCountMode=N},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(N){h.channelInterpretation=N,d.channelInterpretation=N,l.channelInterpretation=N,f.channelInterpretation=N,u.channelInterpretation=N,p.channelInterpretation=N},get context(){return l.context},get curve(){return v},set curve(N){if(N!==null&&N.length<2)throw e();if(N===null)l.curve=N,u.curve=N;else{const A=N.length,I=new Float32Array(A+2-A%2),k=new Float32Array(A+2-A%2);I[0]=N[0],k[0]=-N[A-1];const L=Math.ceil((A+1)/2),U=(A+1)/2-1;for(let $=1;$<L;$+=1){const q=$/L*U,G=Math.floor(q),X=Math.ceil(q);I[$]=G===X?N[G]:(1-(q-G))*N[G]+(1-(X-q))*N[X],k[$]=G===X?-N[A-1-G]:-((1-(q-G))*N[A-1-G])-(1-(X-q))*N[A-1-X]}I[L]=A%2===1?N[L-1]:(N[L-2]+N[L-1])/2,l.curve=I,u.curve=k}v=N,_&&(r(v)&&g===null?g=t(s,h):g!==null&&(g(),g=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(N){l.oversample=N,u.oversample=N},addEventListener(...N){return h.addEventListener(N[0],N[1],N[2])},dispatchEvent(...N){return h.dispatchEvent(N[0])},removeEventListener(...N){return h.removeEventListener(N[0],N[1],N[2])}};a!==null&&(E.curve=a instanceof Float32Array?a:new Float32Array(a)),o!==E.oversample&&(E.oversample=o);const T=()=>{h.connect(l).connect(f),h.connect(d).connect(u).connect(p).connect(f),_=!0,r(v)&&(g=t(s,h))},x=()=>{h.disconnect(l),l.disconnect(f),h.disconnect(d),d.disconnect(u),u.disconnect(p),p.disconnect(f),_=!1,g!==null&&(g(),g=null)};return i(aR(E,f),T,x)},sh=()=>new DOMException("","NotSupportedError"),xct={numberOfChannels:1},wct=(t,e,n,r,i)=>class extends t{constructor(a,o,c){let l;if(typeof a=="number"&&o!==void 0&&c!==void 0)l={length:o,numberOfChannels:a,sampleRate:c};else if(typeof a=="object")l=a;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:d}={...xct,...l},f=r(h,u,d);e(AO,()=>AO(f))||f.addEventListener("statechange",(()=>{let p=0;const g=_=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",g),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):p+=1)};return g})()),super(f,h),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,b0e(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},Cct={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Rct=(t,e,n,r,i,s,a)=>class extends t{constructor(c,l){const u=i(c),h={...Cct,...l},d=n(u,h),f=s(u),p=f?r():null,g=c.sampleRate/2;super(c,!1,d,p),this._detune=e(this,f,d.detune,153600,-153600),this._frequency=e(this,f,d.frequency,g,-g),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?a(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){wC(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),Xv(this)&&hI(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},Act=(t,e,n,r,i)=>()=>{const s=new WeakMap;let a=null,o=null,c=null;const l=async(u,h)=>{let d=n(u);const f=mu(d,h);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:a===null?void 0:a,type:d.type};d=e(h,p),o!==null&&d.start(o),c!==null&&d.stop(c)}return s.set(h,d),f?(await t(h,u.detune,d.detune),await t(h,u.frequency,d.frequency)):(await r(h,u.detune,d.detune),await r(h,u.frequency,d.frequency)),await i(u,h,d),d};return{set periodicWave(u){a=u},set start(u){o=u},set stop(u){c=u},render(u,h){const d=s.get(h);return d!==void 0?Promise.resolve(d):l(u,h)}}},Mct={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Oct=(t,e,n,r,i,s,a)=>class extends t{constructor(c,l){const u=i(c),h={...Mct,...l},d=n(u,h),f=s(u),p=f?r():null;super(c,!1,d,p),this._nativePannerNode=d,this._orientationX=e(this,f,d.orientationX,Wu,Ph),this._orientationY=e(this,f,d.orientationY,Wu,Ph),this._orientationZ=e(this,f,d.orientationZ,Wu,Ph),this._positionX=e(this,f,d.positionX,Wu,Ph),this._positionY=e(this,f,d.positionY,Wu,Ph),this._positionZ=e(this,f,d.positionZ,Wu,Ph),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Nct=(t,e,n,r,i,s,a,o,c,l)=>()=>{const u=new WeakMap;let h=null;const d=async(f,p)=>{let g=null,_=s(f);const v={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},E={...v,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},T=mu(_,p);if("bufferSize"in _)g=r(p,{...v,gain:1});else if(!T){const x={...E,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(p,x)}if(u.set(p,g===null?_:g),g!==null){if(h===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const $=new a(6,f.context.length,p.sampleRate),q=e($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});q.connect($.destination),h=(async()=>{const G=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(X,re)=>{const V=n($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:re===0?1:0});return await o($,X,V.offset),V}));for(let X=0;X<6;X+=1)G[X].connect(q,0,X),G[X].start(0);return l($)})()}const x=await h,N=r(p,{...v,gain:1});await c(f,p,N);const A=[];for(let $=0;$<x.numberOfChannels;$+=1)A.push(x.getChannelData($));let I=[A[0][0],A[1][0],A[2][0]],k=[A[3][0],A[4][0],A[5][0]],L=r(p,{...v,gain:1}),U=i(p,{...E,orientationX:I[0],orientationY:I[1],orientationZ:I[2],positionX:k[0],positionY:k[1],positionZ:k[2]});N.connect(L).connect(U.inputs[0]),U.connect(g);for(let $=128;$<x.length;$+=128){const q=[A[0][$],A[1][$],A[2][$]],G=[A[3][$],A[4][$],A[5][$]];if(q.some((X,re)=>X!==I[re])||G.some((X,re)=>X!==k[re])){I=q,k=G;const X=$/p.sampleRate;L.gain.setValueAtTime(0,X),L=r(p,{...v,gain:0}),U=i(p,{...E,orientationX:I[0],orientationY:I[1],orientationZ:I[2],positionX:k[0],positionY:k[1],positionZ:k[2]}),L.gain.setValueAtTime(1,X),N.connect(L).connect(U.inputs[0]),U.connect(g)}}return g}return T?(await t(p,f.orientationX,_.orientationX),await t(p,f.orientationY,_.orientationY),await t(p,f.orientationZ,_.orientationZ),await t(p,f.positionX,_.positionX),await t(p,f.positionY,_.positionY),await t(p,f.positionZ,_.positionZ)):(await o(p,f.orientationX,_.orientationX),await o(p,f.orientationY,_.orientationY),await o(p,f.orientationZ,_.orientationZ),await o(p,f.positionX,_.positionX),await o(p,f.positionY,_.positionY),await o(p,f.positionZ,_.positionZ)),sR(_)?await c(f,p,_.inputs[0]):await c(f,p,_),_};return{render(f,p){const g=u.get(p);return g!==void 0?Promise.resolve(g):d(f,p)}}},Ict={disableNormalization:!1},kct=(t,e,n,r)=>class O0e{constructor(s,a){const o=e(s),c=r({...Ict,...a}),l=t(o,c);return n.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===O0e.prototype||n.has(s)}},Dct=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),Pct=(t,e,n)=>async(r,i,s)=>{const a=t(r);await Promise.all(a.activeInputs.map((o,c)=>Array.from(o).map(async([l,u])=>{const d=await e(l).render(l,i),f=r.context.destination;!n(l)&&(r!==f||!n(r))&&d.connect(s,u,c)})).reduce((o,c)=>[...o,...c],[]))},Lct=(t,e,n)=>async(r,i,s)=>{const a=e(r);await Promise.all(Array.from(a.activeInputs).map(async([o,c])=>{const u=await t(o).render(o,i);n(o)||u.connect(s,c)}))},Uct=(t,e,n,r)=>i=>t(AO,()=>AO(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const a=n(i,512,0,1);i.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>i.currentTime,a.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const a=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=o=>{a.disconnect(),s(o.renderedBuffer)},a.connect(i.destination),i.startRendering()}),Bct=t=>(e,n)=>{t.set(e,n)},Fct=t=>(e,n)=>t.set(e,n),zct=(t,e,n,r,i,s,a,o)=>(c,l)=>n(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>n(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(a(u),P9(u)):e(s,()=>s(u))||o(u),t.add(u),u)),Hct={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},jct=(t,e,n,r,i,s)=>class extends t{constructor(o,c){const l=i(o),u={...Hct,...c},h=n(l,u),d=s(l),f=d?r():null;super(o,!1,h,f),this._pan=e(this,d,h.pan)}get pan(){return this._pan}},Vct=(t,e,n,r,i)=>()=>{const s=new WeakMap,a=async(o,c)=>{let l=n(o);const u=mu(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await t(c,o.pan,l.pan):await r(c,o.pan,l.pan),sR(l)?await i(o,c,l.inputs[0]):await i(o,c,l),l};return{render(o,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):a(o,c)}}},Gct=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},qct=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,a=!1;try{await r.audioWorklet.addModule(i);const o=new t(r,"a",{numberOfOutputs:0}),c=r.createOscillator();o.port.onmessage=()=>s=!0,o.onprocessorerror=()=>a=!0,c.connect(o),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!a},$ct=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},Wct=()=>new DOMException("","UnknownError"),Yct={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Xct=(t,e,n,r,i,s,a)=>class extends t{constructor(c,l){const u=i(c),h={...Yct,...l},d=n(u,h),p=s(u)?r():null;super(c,!0,d,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},Kct=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,a)=>{let o=e(s);if(!mu(o,a)){const l={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(a,l)}return r.set(a,o),sR(o)?await n(s,a,o.inputs[0]):await n(s,a,o),o};return{render(s,a){const o=r.get(a);return o!==void 0?Promise.resolve(o):i(s,a)}}},Jct=()=>typeof window>"u"?null:window,Zct=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const a=t(s),o=t(i);if(o>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(o),u=r.length;for(let h=a<0?-a:0;h+a<c&&h<u;h+=1)r[h]=l[h+a]},n.copyToChannel=(r,i,s=0)=>{const a=t(s),o=t(i);if(o>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(o),u=r.length;for(let h=a<0?-a:0;h+a<c&&h<u;h+=1)l[h+a]=r[h]}},Qct=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const a=t(s),o=t(i);if(a<e.length)return n.call(e,r,o,a)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const a=t(s),o=t(i);if(a<e.length)return n.call(e,r,o,a)})(e.copyToChannel)},elt=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},tlt=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const o=r.numberOfInputs;for(let c=0;c<o;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},N0e=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),I0e=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},gI=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:a}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(a)})},nlt=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),rlt=t=>({...t,channelCount:t.numberOfOutputs}),ilt=t=>{const{imag:e,real:n}=t;return e===void 0?n===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:n===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},k0e=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;k0e(t,e,n+1e-7)}},slt=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},alt=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},olt=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},z9=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},D0e=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},H9=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},clt=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},llt=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,a=s===null?r:Math.min(s.duration,r);s!==null&&a>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,a,i)})(t.start)},P0e=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),aR(t,n),t.stop=(i=>{let s=!1;return(a=0)=>{if(s)try{i.call(t,a)}catch{n.gain.setValueAtTime(0,a)}else i.call(t,a),s=!0}})(t.stop)},oR=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},ult=Ost(tx),hlt=Lst(tx),dlt=Yat(w6),L0e=new WeakMap,flt=dot(L0e),vm=xat(new Map,new WeakMap),$g=Jct(),U0e=jot(vm,c0),j9=hot(Ju),Fl=Pct(Ju,j9,OT),plt=Hst(U0e,Ea,Fl),sa=mot(x6),Sy=mct($g),Fs=Iot(Sy),B0e=new WeakMap,F0e=iot(oR),vI=$ot($g),V9=Aot(vI),G9=Mot($g),z0e=Oot($g),MO=Yot($g),zo=dat(Nst(f0e),Pst(ult,hlt,EU,dlt,SU,Ju,flt,uI,Ea,tx,Xv,OT,wP),vm,Tot(vG,SU,Ju,Ea,RO,Xv),c0,C6,sh,Gat(EU,vG,Ju,Ea,RO,sa,Xv,Fs),Jat(B0e,Ju,om),F0e,sa,V9,G9,z0e,Fs,MO),mlt=zst(zo,plt,c0,U0e,sa,Fs),q9=new WeakSet,Mne=Vot($g),H0e=Uat(new Uint32Array(1)),$9=Zct(H0e,c0),W9=Qct(H0e),j0e=Vst(q9,vm,sh,Mne,Sy,Gct(Mne),$9,W9),R6=Ust(rd),V0e=Lct(j9,dI,OT),l0=Nat(V0e),cR=qot(R6,vm,slt,alt,olt,z9,D0e,H9,llt,elt(gI),P0e),u0=Dct(fot(dI),V0e),glt=$st(l0,cR,Ea,u0,Fl),ym=fat(Ist(p0e),B0e,D9,pat,xst,wst,Cst,Rst,Ast,pG,h0e,vI,k0e),vlt=qst(zo,glt,ym,ml,cR,sa,Fs,oR),ylt=tat(zo,nat,c0,ml,Wot(rd,gI),sa,Fs,Fl),_lt=Tat(l0,A0e,Ea,u0,Fl),nx=Fct(L0e),blt=Sat(zo,ym,_lt,C6,A0e,sa,Fs,nx),rE=zot(tx,G9),Elt=tlt(ml,rE),iE=tct(vI,Elt),Slt=Rat(iE,Ea,Fl),Tlt=Cat(zo,Slt,iE,sa,Fs),xlt=Oat(pI,Ea,Fl),wlt=Mat(zo,xlt,pI,sa,Fs,rlt),Clt=ict(R6,cR,rd,rE),lR=rct(R6,vm,Clt,z9,H9),Rlt=Lat(l0,lR,Ea,u0,Fl),Alt=Pat(zo,ym,Rlt,lR,sa,Fs,oR),G0e=sct(sh,gI),Mlt=zat(G0e,Ea,Fl),Olt=Fat(zo,Mlt,G0e,sa,Fs,nx),Nlt=Wat(l0,M0e,Ea,u0,Fl),Ilt=$at(zo,ym,Nlt,M0e,sa,Fs,nx),q0e=act(sh),klt=tot(l0,q0e,Ea,u0,Fl),Dlt=eot(zo,ym,klt,q0e,sh,sa,Fs,nx),Plt=lot(l0,rd,Ea,u0,Fl),Llt=cot(zo,ym,Plt,rd,sa,Fs),Ult=uct(C6,ml,mI,sh),A6=Uct(vm,rd,mI,$ct(rd,Sy)),Blt=Sot(cR,Ea,Sy,Fl,A6),Flt=oct(Ult),zlt=bot(zo,Flt,Blt,sa,Fs,nx),Hlt=rat(ym,iE,lR,mI,sh,N0e,Fs,gI),$0e=new WeakMap,jlt=Fot(ylt,Hlt,F0e,Fs,$0e,oR),W0e=gct(R6,vm,z9,D0e,H9,P0e),Vlt=Act(l0,W0e,Ea,u0,Fl),Glt=Rct(zo,ym,W0e,Vlt,sa,Fs,oR),Y0e=kat(cR),qlt=Tct(Y0e,ml,rd,I0e,rE),M6=Sct(Y0e,ml,qlt,I0e,rE,vI,gI),$lt=yct(EU,ml,iE,rd,mI,M6,sh,SU,N0e,rE),X0e=vct($lt),Wlt=Nct(l0,iE,lR,rd,X0e,Ea,Sy,u0,Fl,A6),Ylt=Oct(zo,ym,X0e,Wlt,sa,Fs,nx),Xlt=_ct(c0),Klt=kct(Xlt,sa,new WeakSet,ilt),Jlt=Ect(iE,pI,rd,M6,sh,rE),K0e=bct(Jlt,sh),Zlt=Vct(l0,K0e,Ea,u0,Fl),Qlt=jct(zo,ym,K0e,Zlt,sa,Fs),eut=Kct(M6,Ea,Fl),tut=Xct(zo,ml,M6,eut,sa,Fs,nx),J0e=kot($g),Y9=sot($g),Z0e=new WeakMap,nut=got(Z0e,Sy),rut=J0e?Dst(vm,sh,rot($g),Y9,aot(Mst),sa,nut,Fs,MO,new WeakMap,new WeakMap,qct(MO,Sy),$g):void 0,iut=Not(V9,Fs),sut=Vat(q9,vm,jat,not,new WeakSet,sa,iut,_U,AO,$9,W9),Q0e=bat(rut,mlt,j0e,vlt,blt,Tlt,wlt,Alt,Olt,sut,Ilt,Dlt,Llt,zlt,jlt,Glt,Ylt,Klt,Qlt,tut),aut=Dot(zo,hct,sa,Fs),out=Lot(zo,dct,sa,Fs),cut=Uot(zo,fct,sa,Fs),lut=pct(ml,Fs),uut=Bot(zo,lut,sa),hut=eat(Q0e,ml,sh,Wct,aut,out,cut,uut,vI),X9=vot($0e),dut=Bst(X9),eve=Iat(c0),fut=Xat(X9),tve=Zat(c0),nve=new WeakMap,put=uot(nve,om),mut=ect(eve,c0,ml,iE,pI,lR,rd,mI,sh,tve,Y9,put,rE),gut=Kot(ml,mut,rd,sh,rE),vut=_at(l0,eve,cR,iE,pI,lR,rd,fut,tve,Y9,Ea,MO,Sy,u0,Fl,A6),yut=pot(Z0e),_ut=Bct(nve),One=J0e?gat(dut,zo,ym,vut,gut,Ju,yut,sa,Fs,MO,nlt,_ut,clt,oR):void 0,but=Hat(sh,Sy),Eut=zct(q9,vm,j9,X9,A6,_U,$9,W9),Sut=wct(Q0e,vm,ml,but,Eut),Tut=xot(x6,V9),xut=wot(k9,G9),wut=Cot(D9,z0e),Cut=Rot(x6,Fs);function Kd(t){return t===void 0}function gi(t){return t!==void 0}function Rut(t){return typeof t=="function"}function cm(t){return typeof t=="number"}function gb(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function rve(t){return typeof t=="boolean"}function Yh(t){return Array.isArray(t)}function uy(t){return typeof t=="string"}function RD(t){return uy(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function Cr(t,e){if(!t)throw new Error(e)}function Xf(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function ive(t){!t.isOffline&&t.state!=="running"&&O6('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let sve=!1,Nne=!1;function Ine(t){sve=t}function Aut(t){Kd(t)&&sve&&!Nne&&(Nne=!0,O6("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let ave=console;function Mut(...t){ave.log(...t)}function O6(...t){ave.warn(...t)}function Out(t){return new hut(t)}function Nut(t,e,n){return new Sut(t,e,n)}const Bd=typeof self=="object"?self:null,Iut=Bd&&(Bd.hasOwnProperty("AudioContext")||Bd.hasOwnProperty("webkitAudioContext"));function kut(t,e,n){return Cr(gi(One),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(Bd==null?void 0:Bd.BaseAudioContext)?Bd==null?void 0:Bd.AudioWorkletNode:One)(t,e,n)}var SG=function(t,e){return SG=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},SG(t,e)};function ove(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");SG(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function aa(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,n,s):a(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Ka(t,e,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?s(u.value):i(u.value).then(o,c)}l((r=r.apply(t,e||[])).next())})}function K9(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function N6(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return s}function TG(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}class Dut{constructor(e,n,r,i){this._callback=e,this._type=n,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var n;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((n=this._worker)===null||n===void 0||n.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function NT(t){return wut(t)}function vb(t){return xut(t)}function CP(t){return Cut(t)}function R1(t){return Tut(t)}function Put(t){return t instanceof j0e}function Lut(t,e){return t==="value"||NT(e)||vb(e)||Put(e)}function ZS(t,...e){if(!e.length)return t;const n=e.shift();if(gb(t)&&gb(n))for(const r in n)Lut(r,n[r])?t[r]=n[r]:gb(n[r])?(t[r]||Object.assign(t,{[r]:{}}),ZS(t[r],n[r])):Object.assign(t,{[r]:n[r]});return ZS(t,...e)}function Uut(t,e){return t.length===e.length&&t.every((n,r)=>e[r]===n)}function Pn(t,e,n=[],r){const i={},s=Array.from(e);if(gb(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(o=>Reflect.has(t,o))||(ZS(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())),s.length===1&&gb(s[0]))ZS(i,s[0]);else for(let a=0;a<n.length;a++)gi(s[a])&&(i[n[a]]=s[a]);return ZS(t,i)}function But(t){return t.constructor.getDefaults()}function Dg(t,e){return Kd(t)?e:t}function OO(t,e){return e.forEach(n=>{Reflect.has(t,n)&&delete t[n]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class Ty{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Bd&&this.toString()===Bd.TONE_DEBUG_CLASS)&&Mut(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ty.version=u0e;const J9=1e-6;function CC(t,e){return t>e+J9}function xG(t,e){return CC(t,e)||Xp(t,e)}function CU(t,e){return t+J9<e}function Xp(t,e){return Math.abs(t-e)<J9}function Fut(t,e,n){return Math.max(Math.min(t,n),e)}class tp extends Ty{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Pn(tp.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Cr(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const n=this._timeline[this.length-1];Cr(xG(e.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){const n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(e){const n=this._timeline.indexOf(e);return n!==-1&&this._timeline.splice(n,1),this}get(e,n="time"){const r=this._search(e,n);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,n="time"){const r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const n=this._timeline.length;if(n>0&&this._timeline[n-1].time<e)return this._timeline[n-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let n=this._search(e);if(n>=0)if(Xp(this._timeline[n].time,e)){for(let r=n;r>=0&&Xp(this._timeline[r].time,e);r--)n=r;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&xG(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const n=this._search(e);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(e){const n=this._timeline.indexOf(e);return n>0?this._timeline[n-1]:null}_search(e,n="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<s;){let a=Math.floor(r+(s-r)/2);const o=this._timeline[a],c=this._timeline[a+1];if(Xp(o[n],e)){for(let l=a;l<this._timeline.length;l++){const u=this._timeline[l];if(Xp(u[n],e))a=l;else break}return a}else{if(CU(o[n],e)&&CC(c[n],e))return a;CC(o[n],e)?s=a:r=a+1}}return-1}_iterate(e,n=0,r=this._timeline.length-1){this._timeline.slice(n,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,n){const r=this._search(e);return r!==-1&&this._iterate(n,0,r),this}forEachAfter(e,n){const r=this._search(e);return this._iterate(n,r+1),this}forEachBetween(e,n,r){let i=this._search(e),s=this._search(n);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===n&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,n){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(n,r+1),this}forEachAtTime(e,n){const r=this._search(e);if(r!==-1&&Xp(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&Xp(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{n(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const cve=[];function I6(t){cve.push(t)}function zut(t){cve.forEach(e=>e(t))}const lve=[];function k6(t){lve.push(t)}function Hut(t){lve.forEach(e=>e(t))}class yI extends Ty{constructor(){super(...arguments),this.name="Emitter"}on(e,n){return e.split(/\W+/).forEach(i=>{Kd(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(n)}),this}once(e,n){const r=(...i)=>{n(...i),this.off(e,r)};return this.on(e,r),this}off(e,n){return e.split(/\W+/).forEach(i=>{if(Kd(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Kd(n))this._events[i]=[];else{const s=this._events[i];for(let a=s.length-1;a>=0;a--)s[a]===n&&s.splice(a,1)}}),this}emit(e,...n){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const r=Object.getOwnPropertyDescriptor(yI.prototype,n);Object.defineProperty(e.prototype,n,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class uve extends yI{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class uR extends uve{constructor(){var e,n;super(),this.name="Context",this._constants=new Map,this._timeouts=new tp,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=Pn(uR.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=Out({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new Dut(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((n=arguments[0])===null||n===void 0)&&n.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(zut(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,n,r){return this._context.createBuffer(e,n,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,n){return this._context.createIIRFilter(e,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,n,r){return this._context.createPeriodicWave(e,n,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Cr(R1(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Cr(R1(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Cr(R1(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Cr(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Cr(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Cr(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Cr(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,n){return kut(this.rawContext,e,n)}addAudioWorkletModule(e){return Ka(this,void 0,void 0,function*(){Cr(gi(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Ka(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return R1(this._context)?this._context.resume():Promise.resolve()}close(){return Ka(this,void 0,void 0,function*(){R1(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Hut(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const n=this._context.createBuffer(1,128,this._context.sampleRate),r=n.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=n,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,n=>{n.callback(),this._timeouts.remove(n)})}setTimeout(e,n){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+n}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(n=>{n.id===e&&this._timeouts.remove(n)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,n){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+n})};return i(),r}}class jut extends uve{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,n,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,n){return{}}createPanner(){return{}}createPeriodicWave(e,n,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,n){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Ka(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,n){return 0}clearTimeout(e){return this}setInterval(e,n){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Ri(t,e){Yh(e)?e.forEach(n=>Ri(t,n)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function _I(t,e){Yh(e)?e.forEach(n=>_I(t,n)):Object.defineProperty(t,e,{writable:!0})}const Es=()=>{};class Ps extends Ty{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Es;const e=Pn(Ps.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,uy(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:Es,onload:Es,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:cc().sampleRate}set(e){return e instanceof Ps?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Ka(this,void 0,void 0,function*(){const n=Ps.load(e).then(r=>{this.set(r),this.onload(this)});Ps.downloads.push(n);try{yield n}finally{const r=Ps.downloads.indexOf(n);Ps.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const n=Yh(e)&&e[0].length>0,r=n?e.length:1,i=n?e[0].length:e.length,s=cc(),a=s.createBuffer(r,i,s.sampleRate),o=!n&&r===1?[e]:e;for(let c=0;c<r;c++)a.copyToChannel(o[c],c);return this._buffer=a,this}toMono(e){if(cm(e))this.fromArray(this.toArray(e));else{let n=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let a=0;a<s.length;a++)n[a]+=s[a]}n=n.map(i=>i/r),this.fromArray(n)}return this}toArray(e){if(cm(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const n=[];for(let r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,n=this.duration){Cr(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(n*this.sampleRate);Cr(r<i,"The start time must be less than the end time");const s=i-r,a=cc().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)a.copyToChannel(this.getChannelData(o).subarray(r,i),o);return new Ps(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Ps().fromArray(e)}static fromUrl(e){return Ka(this,void 0,void 0,function*(){return yield new Ps().load(e)})}static load(e){return Ka(this,void 0,void 0,function*(){const n=Ps.baseUrl===""||Ps.baseUrl.endsWith("/")?Ps.baseUrl:Ps.baseUrl+"/",r=yield fetch(n+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield cc().decodeAudioData(i)})}static supportsType(e){const n=e.split("."),r=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return Ka(this,void 0,void 0,function*(){for(yield Promise.resolve();Ps.downloads.length;)yield Ps.downloads[0]})}}Ps.baseUrl="";Ps.downloads=[];class D6 extends uR{constructor(){super({clockSource:"offline",context:CP(arguments[0])?arguments[0]:Nut(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:CP(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=CP(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Ka(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;const r=Math.floor(this.sampleRate/128);e&&n%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Ka(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const n=yield this._context.startRendering();return new Ps(n)})}close(){return Promise.resolve()}}const hve=new jut;let US=hve;function cc(){return US===hve&&Iut&&dve(new uR),US}function dve(t,e=!1){e&&US.dispose(),R1(t)?US=new uR(t):CP(t)?US=new D6(t):US=t}function Vut(){return US.resume()}if(Bd&&!Bd.TONE_SILENCE_LOGGING){const e=` * Tone.js v${u0e} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Gut(t){return Math.pow(10,t/20)}function qut(t){return 20*(Math.log(t)/Math.LN10)}function fve(t){return Math.pow(2,t/12)}let P6=440;function $ut(){return P6}function Wut(t){P6=t}function BS(t){return Math.round(pve(t))}function pve(t){return 69+12*Math.log2(t/P6)}function mve(t){return P6*Math.pow(2,(t-69)/12)}class Z9 extends Ty{constructor(e,n,r){super(),this.defaultUnits="s",this._val=n,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,n)=>{const r=parseInt(e,10),i=n==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const n=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(n)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,n,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Z9&&this.fromType(this._val),Kd(this._val))return this._noArg();if(uy(this._val)&&Kd(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(gb(this._val)){let e=0;for(const n in this._val)if(gi(this._val[n])){const r=this._val[n],i=new this.constructor(this.context,n).valueOf()*r;e+=i}return e}if(gi(this._units)){const e=this._expressions[this._units],n=this._val.toString().trim().match(e.regexp);return n?e.method.apply(this,n.slice(1)):e.method.call(this,this._val)}else return uy(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Kf extends Z9{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new Kf(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(e,n=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),o=Math.round(i/r)*r-i;return i+o*n}toNotation(){const e=this.toSeconds(),n=["1m"];for(let s=1;s<9;s++){const a=Math.pow(2,s);n.push(a+"n."),n.push(a+"n"),n.push(a+"t")}n.push("0");let r=n[0],i=new Kf(this.context,n[0]).toSeconds();return n.forEach(s=>{const a=new Kf(this.context,s).toSeconds();Math.abs(a-e)<Math.abs(i-e)&&(r=s,i=a)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let n=this.valueOf()/e;n=parseFloat(n.toFixed(4));const r=Math.floor(n/this._getTimeSignature());let i=n%1*4;n=Math.floor(n)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,n,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return BS(this.toFrequency())}_now(){return this.context.now()}}function Cc(t,e){return new Kf(cc(),t,e)}class Gh extends Kf{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return $ut()}static set A4(e){Wut(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Gh.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,n){const i=Yut[e.toLowerCase()]+(parseInt(n,10)+1)*12;return this.defaultUnits==="midi"?i:Gh.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,n,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new Gh(this.context,this.valueOf()*fve(e))}harmonize(e){return e.map(n=>this.transpose(n))}toMidi(){return BS(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/Gh.A4);let r=Math.round(12*n)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),Xut[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mve(e)}static ftom(e){return BS(e)}}const Yut={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Xut=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function kne(t,e){return new Gh(cc(),t,e)}class Rw extends Kf{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class uu extends Ty{constructor(){super();const e=Pn(uu.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:cc()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Aut(e),new Kf(this.context,e).toSeconds()}toFrequency(e){return new Gh(this.context,e).toFrequency()}toTicks(e){return new Rw(this.context,e).toTicks()}_getPartialProperties(e){const n=this.get();return Object.keys(n).forEach(r=>{Kd(e[r])&&delete n[r]}),n}get(){const e=But(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const r=this[n];gi(r)&&gi(r.value)&&gi(r.setValueAtTime)?e[n]=r.value:r instanceof uu?e[n]=r._getPartialProperties(e[n]):Yh(r)||cm(r)||uy(r)||rve(r)?e[n]=r:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&gi(this[n])&&(this[n]&&gi(this[n].value)&&gi(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof uu?this[n].set(e[n]):this[n]=e[n])}),this}}class bI extends tp{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const n=this.get(e);return n!==null?n.state:this._initial}setStateAtTime(e,n,r){return Xf(n,0),this.add(Object.assign({},r,{state:e,time:n})),this}getLastState(e,n){const r=this._search(n);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,n){const r=this._search(n);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class pi extends uu{constructor(){const e=Pn(pi.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Cr(gi(e.param)&&(NT(e.param)||e.param instanceof pi),"param must be an AudioParam");!NT(e.param);)e.param=e.param._param;this._swappable=gi(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new tp(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,gi(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(uu.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return gi(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return gi(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,n){return this.units===n}_assertRange(e){return gi(this.maxValue)&&gi(this.minValue)&&Xf(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Gut(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?qut(e):e}setValueAtTime(e,n){const r=this.toSeconds(n),i=this._fromType(e);return Cr(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const n=Math.max(this.toSeconds(e),0),r=this._events.getAfter(n),i=this._events.get(n);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const a=this._events.getBefore(i.time);let o;a===null?o=this._initialValue:o=a.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,o,i.value,i.constant,n))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let a=i.value;if(i.type==="setTargetAtTime"){const o=this._events.getBefore(i.time);o===null?a=this._initialValue:a=o.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,a,r.time,r.value,n):s=this._exponentialInterpolate(i.time,a,r.time,r.value,n)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let n=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,e),this}linearRampToValueAtTime(e,n){const r=this._fromType(e),i=this.toSeconds(n);return Cr(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,n){let r=this._fromType(e);r=Xp(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(n);return Cr(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(n)),this}linearRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(n)),this}targetRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,n),this}exponentialApproachValueAtTime(e,n,r){n=this.toSeconds(n),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,n,i),this.cancelAndHoldAtTime(n+r*.9),this.linearRampToValueAtTime(e,n+r),this}setTargetAtTime(e,n,r){const i=this._fromType(e);Cr(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(n);return this._assertRange(i),Cr(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,n,r,i=1){r=this.toSeconds(r),n=this.toSeconds(n);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),n);const a=r/(e.length-1);for(let o=1;o<e.length;o++){const c=this._fromType(e[o])*i;this.linearRampToValueAtTime(this._toType(c),n+o*a)}return this}cancelScheduledValues(e){const n=this.toSeconds(e);return Cr(isFinite(n),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(e){const n=this.toSeconds(e),r=this._fromType(this.getValueAtTime(n));Cr(isFinite(n),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",n,"value="+r);const i=this._events.get(n),s=this._events.getAfter(n);return i&&Xp(i.time,n)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),n):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),n)),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}rampTo(e,n=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this}apply(e){const n=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(n),n);const r=this._events.get(n);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:n+2,a=(s-n)/10;for(let o=n;o<s;o+=a)e.linearRampToValueAtTime(this.getValueAtTime(o),o)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Cr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const n=this.input;return n.disconnect(this._param),this.apply(e),this._param=e,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,n,r,i,s){return r+(n-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,n,r,i,s){return n+(i-n)*((s-e)/(r-e))}_exponentialInterpolate(e,n,r,i,s){return n*Math.pow(i/n,(s-e)/(r-e))}}class Gn extends uu{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return gi(this.input)?NT(this.input)||this.input instanceof pi?1:this.input.numberOfInputs:0}get numberOfOutputs(){return gi(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return gi(e)&&(e instanceof Gn||vb(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Cr(e.length>0,"ToneAudioNode does not have any internal nodes");const n=e[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:e}))}connect(e,n=0,r=0){return lp(this,e,n,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return O6("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,n=0,r=0){return gve(this,e,n,r),this}chain(...e){return IT(this,...e),this}fan(...e){return e.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),gi(this.input)&&(this.input instanceof Gn?this.input.dispose():vb(this.input)&&this.input.disconnect()),gi(this.output)&&(this.output instanceof Gn?this.output.dispose():vb(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function IT(...t){const e=t.shift();t.reduce((n,r)=>(n instanceof Gn?n.connect(r):vb(n)&&lp(n,r),r),e)}function lp(t,e,n=0,r=0){for(Cr(gi(t),"Cannot connect from undefined node"),Cr(gi(e),"Cannot connect to undefined node"),(e instanceof Gn||vb(e))&&Cr(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Cr(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Gn||e instanceof pi;)gi(e.input)&&(e=e.input);for(;t instanceof Gn;)gi(t.output)&&(t=t.output);NT(e)?t.connect(e,n):t.connect(e,n,r)}function gve(t,e,n=0,r=0){if(gi(e))for(;e instanceof Gn;)e=e.input;for(;!vb(t);)gi(t.output)&&(t=t.output);NT(e)?t.disconnect(e,n):vb(e)?t.disconnect(e,n,r):t.disconnect()}class yi extends Gn{constructor(){const e=Pn(yi.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new pi({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Ri(this,"gain")}static getDefaults(){return Object.assign(Gn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class RC extends Gn{constructor(e){super(e),this.onended=Es,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new yi({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){const r=this.toSeconds(n);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Gn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Es})}_startGain(e,n=1){Cr(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,e+r):this._gainNode.gain.exponentialApproachValueAtTime(n,e,r)):this._gainNode.gain.setValueAtTime(n,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Cr(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.now()),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?n*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Es&&(this.onended(this),this.onended=Es,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Cr(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Es,this}}class Q9 extends RC{constructor(){const e=Pn(Q9.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),lp(this._source,this._gainNode),this.offset=new pi({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(RC.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class os extends Gn{constructor(){const e=Pn(os.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Q9({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Gn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,n=0,r=0){return L6(this,e,n,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,n){return this._param.setValueAtTime(e,n),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,n){return this._param.linearRampToValueAtTime(e,n),this}exponentialRampToValueAtTime(e,n){return this._param.exponentialRampToValueAtTime(e,n),this}exponentialRampTo(e,n,r){return this._param.exponentialRampTo(e,n,r),this}linearRampTo(e,n,r){return this._param.linearRampTo(e,n,r),this}targetRampTo(e,n,r){return this._param.targetRampTo(e,n,r),this}exponentialApproachValueAtTime(e,n,r){return this._param.exponentialApproachValueAtTime(e,n,r),this}setTargetAtTime(e,n,r){return this._param.setTargetAtTime(e,n,r),this}setValueCurveAtTime(e,n,r,i){return this._param.setValueCurveAtTime(e,n,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,n,r){return this._param.rampTo(e,n,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function L6(t,e,n,r){(e instanceof pi||NT(e)||e instanceof os&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof os&&(e.overridden=!0)),lp(t,e,n,r)}class eY extends pi{constructor(){const e=Pn(eY.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new tp(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(pi.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,n,r){n=this.toSeconds(n),this.setRampPoint(n);const i=this._fromType(e),s=this._events.get(n),a=Math.round(Math.max(1/r,1));for(let o=0;o<=a;o++){const c=r*o+n,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,n){const r=this.toSeconds(n);super.setValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),a=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,n){const r=this.toSeconds(n);super.linearRampToValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),a=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,n){n=this.toSeconds(n);const r=this._fromType(e),i=this._events.get(n),s=Math.round(Math.max((n-i.time)*10,1)),a=(n-i.time)/s;for(let o=0;o<=s;o++){const c=a*o+i.time,l=this._exponentialInterpolate(i.time,i.value,n,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,n){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Kd(e.ticks)){const a=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(a,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(n));const s=this._events.get(n);return s&&s.time===n&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const n=this.toSeconds(e),r=this._events.get(n);return Math.max(this._getTicksUntilEvent(r,n),0)}getDurationOfTicks(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(n);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type==="linearRampToValueAtTime"&&n.value!==r.value){const i=this._fromType(this.getValueAtTime(n.time)),a=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-n.time),o=Math.sqrt(Math.pow(i,2)-2*a*(n.ticks-e)),c=(-i+o)/a,l=(-i-o)/a;return(c>0?c:l)+n.time}else return n?n.value===0?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue}ticksToTime(e,n){return this.getDurationOfTicks(e,n)}timeToTicks(e,n){const r=this.toSeconds(n),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const n=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class tY extends os{constructor(){const e=Pn(tY.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new eY({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(os.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,n){return this._param.ticksToTime(e,n)}timeToTicks(e,n){return this._param.timeToTicks(e,n)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,n){return this._param.getDurationOfTicks(e,n)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class nY extends uu{constructor(){const e=Pn(nY.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new bI,this._tickOffset=new tp,this._ticksAtTime=new tp,this._secondsAtTime=new tp,this.frequency=new tY({context:this.context,units:e.units,value:e.frequency}),Ri(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},uu.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,n){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),gi(n)&&this.setTicksAtTime(n,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const n=this.toSeconds(e);if(this._state.getValueAtTime(n)==="stopped"){const r=this._state.get(n);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const n=this.toSeconds(e),r=this._state.getLastState("stopped",n),i=this._ticksAtTime.get(n),s={state:"paused",time:n};this._state.add(s);let a=i||r,o=i?i.ticks:0,c=null;return this._state.forEachBetween(a.time,n+this.sampleTime,l=>{let u=a.time;const h=this._tickOffset.get(l.time);h&&h.time>=a.time&&(o=h.ticks,u=h.time),a.state==="started"&&l.state!=="started"&&(o+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:o})),a=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const n=this.now(),r=this.frequency.timeToTicks(e,n);this.setTicksAtTime(r,n)}getSecondsAtTime(e){e=this.toSeconds(e);const n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||n,a=i?i.seconds:0,o=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(a=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(a+=c.time-l,c.time!==r.time&&(o={state:c.state,time:c.time,seconds:a})),s=c}),this._state.remove(r),o&&this._secondsAtTime.add(o),a}setTicksAtTime(e,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,n),ticks:e,time:n}),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,n=this.now()){const r=this._tickOffset.get(n),i=this._state.get(n),s=Math.max(r.time,i.time),a=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,n,r){let i=this._state.get(e);this._state.forEachBetween(e,n,a=>{i&&i.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),a.time-this.sampleTime,r),i=a});let s=null;if(i&&i.state==="started"){const a=Math.max(i.time,e),o=this.frequency.getTicksAtTime(a),c=this.frequency.getTicksAtTime(i.time),l=o-c;let u=Math.ceil(l)-l;u=Xp(u,1)?0:u;let h=this.frequency.getTimeOfTick(o+u);for(;h<n;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(d){s=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class U6 extends uu{constructor(){const e=Pn(U6.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Es,this._lastUpdate=0,this._state=new bI("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new nY({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ri(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(uu.getDefaults(),{callback:Es,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,n){ive(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,n),r<this._lastUpdate&&this.emit("start",r,n)),this}stop(e){const n=this.toSeconds(e);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,n){return this._tickSource.setTicksAtTime(e,n),this}getTimeOfTick(e,n=this.now()){return this._tickSource.getTimeOfTick(e,n)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",e,n),e!==n&&(this._state.forEachBetween(e,n,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,n,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}yI.mixin(U6);class AC extends Gn{constructor(){const e=Pn(AC.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new pi({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),Ri(this,"delayTime")}static getDefaults(){return Object.assign(Gn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Sg extends Gn{constructor(){const e=Pn(Sg.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new yi({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Ri(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Gn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class rY extends Gn{constructor(){const e=Pn(rY.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Sg({context:this.context}),this.output=new yi({context:this.context}),this.volume=this.input.volume,IT(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Gn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),IT(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}I6(t=>{t.destination=new rY({context:t})});k6(t=>{t.destination.dispose()});class Kut extends Gn{constructor(){super(...arguments),this.name="Listener",this.positionX=new pi({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new pi({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new pi({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new pi({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new pi({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new pi({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new pi({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new pi({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new pi({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Gn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}I6(t=>{t.listener=new Kut({context:t})});k6(t=>{t.listener.dispose()});class iY extends Ty{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Pn(iY.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(n=>{this._loadingCount++;const r=e.urls[n];this.add(n,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Es,onload:Es,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Cr(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,n])=>n.loaded)}add(e,n,r=Es,i=Es){return uy(n)?(this.baseUrl&&n.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Ps(this.baseUrl+n,r,i))):this._buffers.set(e.toString(),new Ps(n,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class RU extends Gh{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return BS(super._frequencyToUnits(e))}_ticksToUnits(e){return BS(super._ticksToUnits(e))}_beatsToUnits(e){return BS(super._beatsToUnits(e))}_secondsToUnits(e){return BS(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return mve(this.toMidi())}transpose(e){return new RU(this.context,this.toMidi()+e)}}class Nc extends Rw{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Jut extends uu{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new tp,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,n){return this._events.add({callback:e,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,n=>{e-n.time<=this.expiration&&n.callback(),this._events.remove(n)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}I6(t=>{t.draw=new Jut({context:t})});k6(t=>{t.draw.dispose()});class Zut extends Ty{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Cr(gi(e.time),"Events must have a time property"),Cr(gi(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let n=new Qut(e.time,e.time+e.duration,e);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(e){if(this._root!==null){const n=[];this._root.search(e.time,n);for(const r of n)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,n=>this.remove(n)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,n){e.parent!==null?(e.isLeftChild()?e.parent.left=n:e.parent.right=n,this._rebalance(e.parent)):this._setRoot(n)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const n=e.getBalance();let r,i=null;if(n>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const n=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rotateRight(e){const n=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rebalance(e){const n=e.getBalance();n>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):n<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const n=[];if(this._root.search(e,n),n.length>0){let r=n[0];for(let i=1;i<n.length;i++)n[i].low>r.low&&(r=n[i]);return r.event}}return null}forEach(e){if(this._root!==null){const n=[];this._root.traverse(r=>n.push(r)),n.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,n){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}forEachFrom(e,n){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Qut{constructor(e,n,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=n,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,n){e>this.max||(this.left!==null&&this.left.search(e,n),this.low<=e&&this.high>e&&n.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,n))}searchAfter(e,n){this.low>=e&&(n.push(this),this.left!==null&&this.left.searchAfter(e,n)),this.right!==null&&this.right.searchAfter(e,n)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class eht extends Ty{constructor(e){super(),this.name="TimelineValue",this._timeline=new tp({memory:10}),this._initialValue=e}set(e,n){return this._timeline.add({value:e,time:n}),this}get(e){const n=this._timeline.get(e);return n?n.value:this._initialValue}}class Wg extends Gn{constructor(){super(Pn(Wg.getDefaults(),arguments,["context"]))}connect(e,n=0,r=0){return L6(this,e,n,r),this}}class rx extends Wg{constructor(){const e=Pn(rx.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Yh(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Rut(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(os.getDefaults(),{length:1024})}setMap(e,n=1024){const r=new Float32Array(n);for(let i=0,s=n;i<s;i++){const a=i/(s-1)*2-1;r[i]=e(a,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const n=["none","2x","4x"].some(r=>r.includes(e));Cr(n,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class sY extends Wg{constructor(){const e=Pn(sY.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new rx({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Wg.getDefaults(),{value:1})}_expFunc(e){return n=>Math.pow(Math.abs(n),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Pb{constructor(e,n){this.id=Pb._eventId++,this._remainderTime=0;const r=Object.assign(Pb.getDefaults(),n);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:Es,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Pb._eventId=0;class aY extends Pb{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(aY.getDefaults(),n);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Pb.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return CU(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Nc(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){CU(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Nc(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const n=this.transport.getTicksAtTime(e);CC(n,this.time)&&(this._nextTick=this.floatTime+Math.ceil((n-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class B6 extends uu{constructor(){const e=Pn(B6.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new eht(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new tp,this._repeatedEvents=new Zut,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new U6({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Ri(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(uu.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,n){if(this._loop.get(e)&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&n%this._ppq!==0&&n%(this._swingTicks*2)!==0){const r=n%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new Nc(this.context,this._swingTicks*2/3).toSeconds()*i}Ine(!0),this._timeline.forEachAtTime(n,r=>r.invoke(e)),Ine(!1)}schedule(e,n){const r=new Pb(this,{callback:e,time:new Rw(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,n,r,i=1/0){const s=new aY(this,{callback:e,duration:new Kf(this.context,i).toTicks(),interval:new Kf(this.context,n).toTicks(),time:new Rw(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,n){const r=new Pb(this,{callback:e,once:!0,time:new Rw(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const n=this._scheduledEvents[e.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,n){return this._scheduledEvents[e.id.toString()]={event:e,timeline:n},n.add(e),e.id}cancel(e=0){const n=this.toTicks(e);return this._timeline.forEachFrom(n,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(n,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,n)=>{n=new Nc(this.context,n).toSeconds(),this.emit("start",e,n)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,n){this.context.resume();let r;return gi(n)&&(r=this.toTicks(n)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Yh(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Kf(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Kf(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Nc(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),n=this._clock.getTicksAtTime(e);return new Nc(this.context,n).toBarsBeatsSixteenths()}set position(e){const n=this.toTicks(e);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(e){const n=this.now(),r=this._clock.frequency.timeToTicks(e,n);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const n=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(n),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,n),s=n+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",n),this._clock.setTicksAtTime(e,n)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)}}syncSignal(e,n){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),a=[];if(e.units==="time"){const c=.015625/s,l=new yi(c),u=new sY(-1),h=new yi(c);i.chain(l,u,h),i=h,s=1/s,a=[l,u,h]}n||(e.getValueAtTime(r)!==0?n=e.getValueAtTime(r)/s:n=0);const o=new yi(n);return i.connect(o),o.connect(e._param),a.push(o),this._syncedSignals.push({initial:e.value,nodes:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let n=this._syncedSignals.length-1;n>=0;n--){const r=this._syncedSignals[n];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),_I(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}yI.mixin(B6);I6(t=>{t.transport=new B6({context:t})});k6(t=>{t.transport.dispose()});class du extends Gn{constructor(e){super(e),this.input=void 0,this._state=new bI("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Es,this._syncedStop=Es,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Sg({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Ri(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Gn.getDefaults(),{mute:!1,onstop:Es,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,n,r){let i=Kd(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Cr(CC(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,n,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(Dg(n,0)),s.duration=r?this.toSeconds(r):void 0);const a=this.context.transport.schedule(o=>{this._start(o,n,r)},i);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else ive(this.context),this._start(i,n,r);return this}stop(e){let n=Kd(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||gi(this._state.getNextState("started",n))){if(this.log("stop",n),!this._synced)this._stop(n);else{const r=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(r)}this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(e,n,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,n,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(CC(n,0)){const r=this._state.get(n);if(r&&r.state==="started"&&r.time!==n){const i=n-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const n=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Es,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class EI extends RC{constructor(){const e=Pn(EI.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,lp(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new pi({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Ps(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(RC.getDefaults(),{url:new Ps,loop:!1,loopEnd:0,loopStart:0,onload:Es,onerror:Es,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,n,r,i=1){Cr(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?n=Dg(n,this.loopStart):n=Dg(n,0);let a=Math.max(this.toSeconds(n),0);if(this.loop){const o=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=o-c;xG(a,o)&&(a=(a-c)%l+c),Xp(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,CU(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,a)),gi(r)){let o=this.toSeconds(r);o=Math.max(o,0),this.stop(s+o)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class MC extends du{constructor(){const e=Pn(MC.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(du.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Cr(e in Dne,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=Dne[this._type];this._source=new EI({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const g1=44100*5,$H=2,yv={brown:null,pink:null,white:null},Dne={get brown(){if(!yv.brown){const t=[];for(let e=0;e<$H;e++){const n=new Float32Array(g1);t[e]=n;let r=0;for(let i=0;i<g1;i++){const s=Math.random()*2-1;n[i]=(r+.02*s)/1.02,r=n[i],n[i]*=3.5}}yv.brown=new Ps().fromArray(t)}return yv.brown},get pink(){if(!yv.pink){const t=[];for(let e=0;e<$H;e++){const n=new Float32Array(g1);t[e]=n;let r,i,s,a,o,c,l;r=i=s=a=o=c=l=0;for(let u=0;u<g1;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,a=.8665*a+h*.3104856,o=.55*o+h*.5329522,c=-.7616*c-h*.016898,n[u]=r+i+s+a+o+c+l+h*.5362,n[u]*=.11,l=h*.115926}}yv.pink=new Ps().fromArray(t)}return yv.pink},get white(){if(!yv.white){const t=[];for(let e=0;e<$H;e++){const n=new Float32Array(g1);t[e]=n;for(let r=0;r<g1;r++)n[r]=Math.random()*2-1}yv.white=new Ps().fromArray(t)}return yv.white}};function ix(t,e){return Ka(this,void 0,void 0,function*(){const n=e/t.context.sampleRate,r=new D6(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class oY extends RC{constructor(){const e=Pn(oY.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],lp(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new pi({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new pi({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Ri(this,["frequency","detune"])}static getDefaults(){return Object.assign(RC.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class bo extends du{constructor(){const e=Pn(bo.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new os({context:this.context,units:"frequency",value:e.frequency}),Ri(this,"frequency"),this.detune=new os({context:this.context,units:"cents",value:e.detune}),Ri(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(du.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const n=this.toSeconds(e),r=new oY({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(e){const n=this.toSeconds(e);this._oscillator&&this._oscillator.stop(n)}_restart(e){const n=this.toSeconds(e);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return bo._periodicWaveCache.find(n=>n.phase===this._phase&&Uut(n.partials,this._partials));{const e=bo._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(gi(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),a=this.context.createPeriodicWave(i,s);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),bo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),bo._periodicWaveCache.length>100&&bo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Xf(e,0);let n=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(n=r[1]),this._type!=="custom")e===0?this.type=n:this.type=n+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,a)=>i[a]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,n){let i=2048;const s=new Float32Array(i),a=new Float32Array(i);let o=1;if(e==="custom"){if(o=this._partials.length+1,this._partialCount=this._partials.length,i=o,this._partials.length===0)return[s,a]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(o=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],o=Math.max(o,2),i=o):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=o?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(n*c),a[c]=u*Math.cos(n*c)):(s[c]=0,a[c]=0)}return[s,a]}_inverseFFT(e,n,r){let i=0;const s=e.length;for(let a=0;a<s;a++)i+=e[a]*Math.cos(a*r)+n[a]*Math.sin(a*r);return i}getInitialValue(){const[e,n]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let a=0;a<s;a++)r=Math.max(this._inverseFFT(e,n,a/s*i),r);return Fut(-this._inverseFFT(e,n,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}bo._periodicWaveCache=[];class vve extends Wg{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new rx({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class kT extends os{constructor(){const e=Pn(kT.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new yi({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(os.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class F6 extends du{constructor(){const e=Pn(F6.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new vve({context:this.context}),this._modulationNode=new yi({context:this.context}),this._carrier=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new bo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new kT({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ri(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(bo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class z6 extends du{constructor(){const e=Pn(z6.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new yi({context:this.context,gain:0}),this._carrier=new bo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new os({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new bo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new kT({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new kT({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ri(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(bo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class SI extends du{constructor(){const e=Pn(SI.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new yi({context:this.context,gain:0}),this._thresh=new rx({context:this.context,mapping:n=>n<=0?-1:1}),this.width=new os({context:this.context,units:"audioRange",value:e.width}),this._triangle=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ri(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(du.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class H6 extends du{constructor(){const e=Pn(H6.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new os({context:this.context,units:"frequency",value:e.frequency}),this.detune=new os({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Ri(this,["frequency","detune"])}static getDefaults(){return Object.assign(bo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(n=>n.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(n=>n.stop(e))}_restart(e){this._forEach(n=>n.restart(e))}_forEach(e){for(let n=0;n<this._oscillators.length;n++)e(this._oscillators[n],n)}get type(){return this._type}set type(e){this._type=e,this._forEach(n=>n.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const n=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=n+r*s)}}get count(){return this._oscillators.length}set count(e){if(Xf(e,1),this._oscillators.length!==e){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<e;n++){const r=new bo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):Es});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((n,r)=>n.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(n=>n.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(n=>n.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(n=>n.partialCount=e),this._type=this._oscillators[0].type}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class j6 extends du{constructor(){const e=Pn(j6.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new kT({context:this.context,value:2}),this._pulse=new SI({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new bo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ri(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(du.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Pne={am:F6,fat:H6,fm:z6,oscillator:bo,pulse:SI,pwm:j6};class AU extends du{constructor(){const e=Pn(AU.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new os({context:this.context,units:"frequency",value:e.frequency}),this.detune=new os({context:this.context,units:"cents",value:e.detune}),Ri(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(bo.getDefaults(),z6.getDefaults(),F6.getDefaults(),H6.getDefaults(),SI.getDefaults(),j6.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const n=Pne[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),e==="fm"?this.type="fm"+n:e==="am"?this.type="am"+n:e==="fat"?this.type="fat"+n:e==="oscillator"?this.type=n:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,n){return e instanceof Pne[n]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&cm(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&cm(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&uy(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return Ka(this,arguments,void 0,function*(e=1024){return ix(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class cY extends os{constructor(){super(Pn(cY.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new yi({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,IT(this._constantSource,this._sum)}static getDefaults(){return Object.assign(os.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class lY extends Wg{constructor(){const e=Pn(lY.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new kT({context:this.context,value:e.max-e.min}),this._add=this.output=new cY({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Wg.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class uY extends Wg{constructor(){super(Pn(uY.getDefaults(),arguments)),this.name="Zero",this._gain=new yi({context:this.context}),this.output=this._gain,this.input=void 0,lp(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),gve(this.context.getConstant(0),this._gain),this}}class DT extends Gn{constructor(){const e=Pn(DT.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=pi.prototype._fromType,this._toType=pi.prototype._toType,this._is=pi.prototype._is,this._clampValue=pi.prototype._clampValue,this._oscillator=new bo(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new yi({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new os({context:this.context,units:"audioRange",value:0}),this._zeros=new uY({context:this.context}),this._a2g=new vve({context:this.context}),this._scaler=this.output=new lY({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ri(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(bo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const n=this.min,r=this.max;this._units=e,this.min=n,this.max=r}get state(){return this._oscillator.state}connect(e,n,r){return(e instanceof pi||e instanceof os)&&(this.convert=e.convert,this.units=e.units),L6(this,e,n,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function yve(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Xf(s,t,e),n.set(this,s)}})}}function xy(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Xf(this.toSeconds(s),t,e),n.set(this,s)}})}}class TI extends du{constructor(){const e=Pn(TI.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Ps({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(du.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Es,onerror:Es,playbackRate:1,reverse:!1})}load(e){return Ka(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Es){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,n,r){return super.start(e,n,r),this}_start(e,n,r){this._loop?n=Dg(n,this._loopStart):n=Dg(n,0);const i=this.toSeconds(n),s=r;r=Dg(r,Math.max(this._buffer.duration-i,0));let a=this.toSeconds(r);a=a/this._playbackRate,e=this.toSeconds(e);const o=new EI({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Kd(s)?o.start(e,i):o.start(e,i,a-this.toSeconds(this.fadeOut))}_stop(e){const n=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(n))}restart(e,n,r){return super.restart(e,n,r),this}_restart(e,n,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,n,r)}seek(e,n){const r=this.toSeconds(n);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Xf(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Xf(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(n=>{n.loop=e}),e)){const n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const n=this.now(),r=this._state.getNextState("stopped",n);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}aa([xy(0)],TI.prototype,"fadeIn",void 0);aa([xy(0)],TI.prototype,"fadeOut",void 0);class tht extends Wg{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new rx({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class wy extends Gn{constructor(){const e=Pn(wy.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new os({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Gn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(uy(e))return e;{let r;for(r in AD)if(AD[r][n]===e)return r;return e}}_setCurve(e,n,r){if(uy(r)&&Reflect.has(AD,r)){const i=AD[r];gb(i)?e!=="_decayCurve"&&(this[e]=i[n]):this[e]=i}else if(Yh(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,n=1){this.log("triggerAttack",e,n),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0){const o=1/i;i=(1-a)/o}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(n,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,i,e);else{this._sig.cancelAndHoldAtTime(e);let o=this._attackCurve;for(let c=1;c<o.length;c++)if(o[c-1]<=a&&a<=o[c]){o=this._attackCurve.slice(c),o[0]=a;break}this._sig.setValueCurveAtTime(o,e,i,n)}if(s&&this.sustain<1){const o=n*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(o,s+c):this._sig.exponentialApproachValueAtTime(o,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const n=this.getValueAtTime(e);if(n>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Cr(Yh(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,n))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),this.triggerAttack(n,r),this.triggerRelease(n+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,n=0,r=0){return L6(this,e,n,r),this}asArray(){return Ka(this,arguments,void 0,function*(e=1024){const n=e/this.context.sampleRate,r=new D6(1,n,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),a=s*.1,o=s+a,c=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/o,decay:n*this.toSeconds(this.decay)/o,release:n*this.toSeconds(this.release)/o,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(n*(i+a)/o,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}aa([xy(0)],wy.prototype,"attack",void 0);aa([xy(0)],wy.prototype,"decay",void 0);aa([yve(0,1)],wy.prototype,"sustain",void 0);aa([xy(0)],wy.prototype,"release",void 0);const AD=(()=>{let e,n;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){n=e/127;const d=Math.sin(n*(Math.PI*2)*s-Math.PI/2)+1;i[e]=d/10+n*.83}i[127]=1;const a=[],o=5;for(e=0;e<128;e++)a[e]=Math.ceil(e/127*o)/o;const c=[];for(e=0;e<128;e++)n=e/127,c[e]=.5*(1-Math.cos(Math.PI*n));const l=[];for(e=0;e<128;e++){n=e/127;const d=Math.pow(n,3)*4+.2,f=Math.cos(d*Math.PI*2*n);l[e]=Math.abs(f*(1-n))}function u(d){const f=new Array(d.length);for(let p=0;p<d.length;p++)f[p]=1-d[p];return f}function h(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:a,Out:u(a)}}})();class Yg extends Gn{constructor(){const e=Pn(Yg.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=n=>this._original_triggerRelease(n),this._volume=this.output=new Sg({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Ri(this,"volume")}static getDefaults(){return Object.assign(Gn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,n){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[n],a=this.context.transport.schedule(o=>{i[n]=o,r.apply(this,i)},s);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r),a=this.toSeconds(n);return this.triggerAttack(e,s,i),this.triggerRelease(s+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class PT extends Yg{constructor(){const e=Pn(PT.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Yg.getDefaults(),{detune:0,onsilence:Es,portamento:0})}triggerAttack(e,n,r=1){this.log("triggerAttack",e,n,r);const i=this.toSeconds(n);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const n=this.toSeconds(e);return this._triggerEnvelopeRelease(n),this}setNote(e,n){const r=this.toSeconds(n),i=e instanceof Gh?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}aa([xy(0)],PT.prototype,"portamento",void 0);class V6 extends wy{constructor(){super(Pn(V6.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new yi({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Gu extends PT{constructor(){const e=Pn(Gu.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new AU(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new V6(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Ri(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(PT.getDefaults(),{envelope:Object.assign(OO(wy.getDefaults(),Object.keys(Gn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(OO(AU.getDefaults(),[...Object.keys(du.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,n){if(this.envelope.triggerAttack(e,n),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MU extends Gn{constructor(){const e=Pn(MU.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new pi({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new pi({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new pi({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new pi({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Gn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Cr(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let a=0;a<e;a++){const c=Math.pow(a/e,2)*19980+20;n[a]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Uf extends Gn{constructor(){const e=Pn(Uf.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new yi({context:this.context}),this.output=new yi({context:this.context}),this._filters=[],this._filters=[],this.Q=new os({context:this.context,units:"positive",value:e.Q}),this.frequency=new os({context:this.context,units:"frequency",value:e.frequency}),this.detune=new os({context:this.context,units:"cents",value:e.detune}),this.gain=new os({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Ri(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Cr(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=cm(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(n);Cr(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const a=new MU({context:this.context});a.type=this._type,this.frequency.connect(a.frequency),this.detune.connect(a.detune),this.Q.connect(a.Q),this.gain.connect(a.gain),this._filters[s]=a}this._internalChannels=this._filters,IT(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new MU({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((s,a)=>r[a]*=s)}),n.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),_I(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class xI extends Gu{constructor(){const e=Pn(xI.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Ri(this,["oscillator","envelope"])}static getDefaults(){return ZS(PT.getDefaults(),Gu.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,n){const r=this.toSeconds(n),i=this.toFrequency(e instanceof Gh?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}aa([yve(0)],xI.prototype,"octaves",void 0);aa([xy(0)],xI.prototype,"pitchDecay",void 0);class ew extends Yg{constructor(){const e=Pn(ew.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new MC(Object.assign({context:this.context},e.noise)),this.envelope=new V6(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Yg.getDefaults(),{envelope:Object.assign(OO(wy.getDefaults(),Object.keys(Gn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(OO(MC.getDefaults(),Object.keys(du.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,r),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const _ve=new Set;function hY(t){_ve.add(t)}function bve(t,e){const n=`registerProcessor("${t}", ${e})`;_ve.add(n)}const nht=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;hY(nht);const rht=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;hY(rht);const iht=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;hY(iht);const sht="feedback-comb-filter",aht=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;bve(sht,aht);class OU extends Yg{constructor(){const e=Pn(OU.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Cr(!cm(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Yg.getDefaults(),{maxPolyphony:32,options:{},voice:Gu})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const n=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Cr(e instanceof PT,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else O6("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),n=this._voices.indexOf(e);this._voices.splice(n,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,n,r){e.forEach(i=>{const s=new RU(this.context,i).toMidi(),a=this._getNextAvailableVoice();a&&(a.triggerAttack(i,n,r),this._activeVoices.push({midi:s,voice:a,released:!1}),this.log("triggerAttack",i,n))})}_triggerRelease(e,n){e.forEach(r=>{const i=new RU(this.context,r).toMidi(),s=this._activeVoices.find(({midi:a,released:o})=>a===i&&!o);s&&(s.voice.triggerRelease(n),s.released=!0,this.log("triggerRelease",r,n))})}_scheduleEvent(e,n,r,i){Cr(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(n,r,i):this._triggerRelease(n,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,n,r,i)},r-this.now())}triggerAttack(e,n,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(n);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,n){Array.isArray(e)||(e=[e]);const r=this.toSeconds(n);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),Yh(n)){Cr(Yh(e),"If the duration is an array, the notes must also be an array"),e=e;for(let a=0;a<e.length;a++){const o=n[Math.min(a,n.length-1)],c=this.toSeconds(o);Cr(c>0,"The duration must be greater than 0"),this.triggerRelease(e[a],s+c)}}else{const a=this.toSeconds(n);Cr(a>0,"The duration must be greater than 0"),this.triggerRelease(e,s+a)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const n=OO(e,["onsilence","context"]);return this.options=ZS(this.options,n),this._voices.forEach(r=>r.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(e){const n=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class wI extends Yg{constructor(){const e=Pn(wI.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const n={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Cr(RD(r)||cm(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),RD(r)){const s=new Gh(this.context,r).toMidi();n[s]=e.urls[r]}else cm(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new iY({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Yg.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Es,onerror:Es,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,n,r=1){return this.log("triggerAttack",e,n,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=pve(new Gh(this.context,i).toFrequency()),a=Math.round(s),o=s-a,c=this._findClosest(a),l=a-c,u=this._buffers.get(l),h=fve(c+o),d=new EI({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(n,0,u.duration/h,r),Yh(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const f=this._activeSources.get(a),p=f.indexOf(d);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,n){return this.log("triggerRelease",e,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new Gh(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);n=this.toSeconds(n),s.forEach(a=>{a.stop(n)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const n=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,n,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),Yh(n)?(Cr(Yh(e),"notes must be an array when duration is array"),e.forEach((a,o)=>{const c=n[Math.min(o,n.length-1)];this.triggerRelease(a,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(n)),this}add(e,n,r){if(Cr(RD(e)||isFinite(e),`note must be a pitch or midi: ${e}`),RD(e)){const i=new Gh(this.context,e).toMidi();this._buffers.add(i,n,r)}else this._buffers.add(e,n,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}aa([xy(0)],wI.prototype,"attack",void 0);aa([xy(0)],wI.prototype,"release",void 0);class tw extends uu{constructor(){const e=Pn(tw.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new bI("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(uu.getDefaults(),{callback:Es,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,n=>{let r;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);const i=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||cm(this._loop)&&this._loop>1){r=1/0,cm(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new Nc(this.context,r));const a=new Nc(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),a,new Nc(this.context,i),r)}else n.id=this.context.transport.schedule(this._tick.bind(this),new Nc(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const n=this.toTicks(e);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(e){this.cancel(e);const n=this.toTicks(e);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});const r=this._state.getBefore(n);let i=n;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=Dg(e,-1/0);const n=this.toTicks(e);return this._state.forEachFrom(n,r=>{this.context.transport.clear(r.id)}),this._state.cancel(n),this}_tick(e){const n=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;rve(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new Nc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new Nc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,n=this._state.get(e);if(n!==null&&n.state==="started"){const r=this._getLoopDuration();return(e-n.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class NU extends tw{constructor(){const e=Pn(NU.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new bI("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(n=>{Yh(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(tw.getDefaults(),{events:[]})}start(e,n){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){n=Dg(n,this._loop?this._loopStart:0),this._loop?n=Dg(n,this._loopStart):n=Dg(n,0);const i=this.toTicks(n);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(new Nc(this.context,n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new Nc(this.context,n))):e.startOffset>=r&&e.start(new Nc(this.context,n))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(e){const n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(r=>{r.stop(e)}),this}at(e,n){const r=new Rw(this.context,e).toTicks(),i=new Nc(this.context,1).toSeconds(),s=this._events.values();let a=s.next();for(;!a.done;){const o=a.value;if(Math.abs(r-o.startOffset)<i)return gi(n)&&(o.value=n),o;a=s.next()}return gi(n)?(this.add(e,n),this.at(e)):null}add(e,n){e instanceof Object&&Reflect.has(e,"time")&&(n=e,e=n.time);const r=this.toTicks(e);let i;return n instanceof tw?(i=n,i.callback=this._tick.bind(this)):i=new tw({callback:this._tick.bind(this),context:this.context,value:n}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(n=>{n.state==="started"?this._startNote(e,n.time,n.offset):e.stop(new Nc(this.context,n.time))})}remove(e,n){return gb(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(Kd(n)||gi(n)&&r.value===n)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(n=>n.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof NU?n._forEach(e):e(n)}),this}_setAll(e,n){this._forEach(r=>{r[e]=n})}_tick(e,n){this.mute||this.callback(e,n)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=e,this._testLoopBoundries(n)})}get loopEnd(){return new Nc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopEnd=e,this._testLoopBoundries(n)})}get loopStart(){return new Nc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class G6 extends Gn{constructor(){const e=Pn(G6.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new tht({context:this.context}),this.a=new yi({context:this.context,gain:0}),this.b=new yi({context:this.context,gain:0}),this.output=new yi({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new os({context:this.context,units:"normalRange",value:e.fade}),Ri(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",lp(this._split,this.a.gain,0),lp(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Gn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let Xg=class extends Gn{constructor(e){super(e),this.name="Effect",this._dryWet=new G6({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new yi({context:this.context}),this.effectReturn=new yi({context:this.context}),this.input=new yi({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Ri(this,"wet")}static getDefaults(){return Object.assign(Gn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class dY extends Gn{constructor(){const e=Pn(dY.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new pi({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Ri(this,"pan")}static getDefaults(){return Object.assign(Gn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const oht="bit-crusher",cht=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;bve(oht,cht);class q6 extends Gn{constructor(){const e=Pn(q6.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Gn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class CI extends Gn{constructor(){const e=Pn(CI.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Gn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class IU extends Gn{constructor(e){super(e),this.name="StereoEffect",this.input=new yi({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new G6({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new q6({context:this.context,channels:2}),this._merge=new CI({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Ri(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),IT(...e),lp(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),IT(...e),lp(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Gn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Lne extends IU{constructor(e){super(e),this.feedback=new os({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new yi({context:this.context}),this._feedbackR=new yi({context:this.context}),this._feedbackSplit=new q6({context:this.context,channels:2}),this._feedbackMerge=new CI({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Ri(this,["feedback"])}static getDefaults(){return Object.assign(IU.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class fY extends Lne{constructor(){const e=Pn(fY.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new DT({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new DT({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new AC({context:this.context}),this._delayNodeR=new AC({context:this.context}),this.frequency=this._lfoL.frequency,Ri(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(Lne.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const n=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class NO extends Xg{constructor(){const e=Pn(NO.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new rx({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(Xg.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const n=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+n)*i*20*r/(Math.PI+n*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Une extends Xg{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new yi({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Ri(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Xg.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class $6 extends Une{constructor(){const e=Pn($6.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new AC({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Ri(this,"delayTime")}static getDefaults(){return Object.assign(Une.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class pY extends IU{constructor(){const e=Pn(pY.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(e),this.name="Phaser",this._lfoL=new DT({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new DT({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new os({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),Ri(this,["frequency","Q"])}static getDefaults(){return Object.assign(IU.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,n){const r=[];for(let i=0;i<e;i++){const s=this.context.createBiquadFilter();s.type="allpass",this.Q.connect(s.Q),n.connect(s.frequency),r.push(s)}return r}get octaves(){return this._octaves}set octaves(e){this._octaves=e;const n=this._baseFrequency*Math.pow(2,e);this._lfoL.max=n,this._lfoR.max=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class mY extends Xg{constructor(){const e=Pn(mY.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const n=this.toSeconds(e.decay);Xf(n,.001),this._decay=n;const r=this.toSeconds(e.preDelay);Xf(r,0),this._preDelay=r,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Xg.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Xf(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Xf(e,0),this._preDelay=e,this.generate()}generate(){return Ka(this,void 0,void 0,function*(){const e=this.ready,n=new D6(2,this._decay+this._preDelay,this.context.sampleRate),r=new MC({context:n}),i=new MC({context:n}),s=new CI({context:n});r.connect(s,0,0),i.connect(s,0,1);const a=new yi({context:n}).toDestination();s.connect(a),r.start(0),i.start(0),a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(1,this._preDelay),a.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=n.render();return this.ready=o.then(Es),yield e,this._convolver.buffer=(yield o).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class gY extends Xg{constructor(){const e=Pn(gY.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new AC({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new DT({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,Ri(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Xg.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ic extends Gn{constructor(){const e=Pn(ic.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new yi({context:this.context}),ic._allSolos.has(this.context)||ic._allSolos.set(this.context,new Set),ic._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Gn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),ic._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){ic._soloed.has(this.context)||ic._soloed.set(this.context,new Set),ic._soloed.get(this.context).add(this)}_removeSolo(){ic._soloed.has(this.context)&&ic._soloed.get(this.context).delete(this)}_isSoloed(){return ic._soloed.has(this.context)&&ic._soloed.get(this.context).has(this)}_noSolos(){return!ic._soloed.has(this.context)||ic._soloed.has(this.context)&&ic._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ic._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ic._allSolos=new Map;ic._soloed=new Map;class vY extends Gn{constructor(){const e=Pn(vY.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new dY({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Sg({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Ri(this,["pan","volume"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class nw extends Gn{constructor(){const e=Pn(nw.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new ic({solo:e.solo,context:this.context}),this._panVol=this.output=new vY({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ri(this,["pan","volume"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return nw.buses.has(e)||nw.buses.set(e,new yi({context:this.context})),nw.buses.get(e)}send(e,n=0){const r=this._getBus(e),i=new yi({context:this.context,units:"decibels",gain:n});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}nw.buses=new Map;class yY extends Gn{constructor(){const e=Pn(yY.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new yi({context:this.context}),this.output=void 0,this.low=new Uf({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Uf({context:this.context,frequency:0,type:"highpass"}),this.mid=new Uf({context:this.context,frequency:0,type:"lowpass"}),this.high=new Uf({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new os({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new os({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new os({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Ri(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),_I(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class _Y extends Gn{constructor(){const e=Pn(_Y.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new pi({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new pi({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new pi({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new pi({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new pi({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),Ri(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Gn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class bY extends Gn{constructor(){const e=Pn(bY.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new yi({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new yY({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new yi({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new yi({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new yi({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Ri(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Gn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),_I(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}cc().transport;function EY(){return cc().transport}cc().destination;cc().destination;function lht(){return cc().destination}cc().listener;cc().draw;cc();const Bne=4,uht={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31};function hht(t,e,n,r=!0){let i=e,s=3,a="32n",o="",c="";const l=[];function u(){c="",o="",i+=Cc(a).toSeconds()}function h(){c===null?(l.push([i,[t,a,c]]),u()):pn(c)?(l.push([i,[t,a,c]]),u()):c.startsWith("#")?(l.push([i,[t,a,c]]),u()):c!==""&&(l.push([i,[t,a,`${c}${o}${s}`]]),u())}if(On(n))c=n;else for(let d=0;d<n.length;++d){switch(n[d]){case 9:case 10:break;default:h();break}switch(n[d]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:o+="#";break;case 10:o+="b";break;case 11:++s;break;case 12:--s;break;case 13:a="64n";break;case 14:a="32n";break;case 15:a="16n";break;case 16:a="8n";break;case 17:a="4n";break;case 18:a="2n";break;case 19:a="1n";break;case 20:a=a.replace("n","t");break;case 21:a+=".";break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return h(),r&&l.push([i,[t,"8n",-1]]),l}function dht(t){const e=[],n=t.split(";");for(let r=0;r<n.length;++r){const i=[],s=n[r];if(s.startsWith("#"))e.push(s);else{for(let a=0;a<s.length;++a){const o=uht[s[a]];ae(o)&&i.push(o)}e.push(i)}}return e}const fht="data:text/javascript;base64,Ly8gQSBkb3duc2FtcGxpbmcvZGVncmFkaW5nIHByb2Nlc3NpbmcgZWZmZWN0Ci8vIFNhbXBsZSBhbmQgaG9sZHMgdGhlIHNpZ25hbCBiYXNlZCBvbiBhbiBpbmNyZW1lbnRpbmcgY291bnRlcgovLyB3cml0dGVuIGJ5IFRpbW8gSG9vZ2xhbmQsIChjKSAyMDIzLCB3d3cudGltb2hvb2dsYW5kLmNvbQovLwpjbGFzcyBTeW50aFdvcmtsZXRQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gWwogICAgICB7CiAgICAgICAgbmFtZTogJ2Rvd24nLAogICAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgICBtaW5WYWx1ZTogMSwKICAgICAgICBtYXhWYWx1ZTogNTEyLAogICAgICB9LAogICAgXQogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpCiAgICAvLyB0aGUgZnJhbWUgY291bnRlcgogICAgdGhpcy5jb3VudCA9IDAKICAgIC8vIHNhbXBsZSBhbmQgaG9sZCB2YXJpYWJsZSBhcnJheQogICAgdGhpcy5zYWggPSBbXQogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdCiAgICBjb25zdCBvdXRwdXQgPSBvdXRwdXRzWzBdCgogICAgLy8gaWYgdGhlcmUgaXMgYW55dGhpbmcgdG8gcHJvY2VzcwogICAgaWYgKGlucHV0Lmxlbmd0aCA+IDApIHsKICAgICAgLy8gZm9yIHRoZSBsZW5ndGggb2YgdGhlIHNhbXBsZSBhcnJheSAoZ2VuZXJhbGx5IDEyOCkKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFswXS5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIGZvciBldmVyeSBjaGFubmVsCiAgICAgICAgZm9yIChsZXQgY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBpbnB1dC5sZW5ndGg7ICsrY2hhbm5lbCkgewogICAgICAgICAgLy8gaWYgY291bnRlciBlcXVhbHMgMCwgc2FtcGxlIGFuZCBob2xkCiAgICAgICAgICBpZiAodGhpcy5jb3VudCAlIHBhcmFtZXRlcnMuZG93biA9PT0gMCkgewogICAgICAgICAgICB0aGlzLnNhaFtjaGFubmVsXSA9IGlucHV0W2NoYW5uZWxdW2ldCiAgICAgICAgICB9CiAgICAgICAgICAvLyBvdXRwdXQgdGhlIGN1cnJlbnRseSBoZWxkIHNhbXBsZQogICAgICAgICAgb3V0cHV0W2NoYW5uZWxdW2ldID0gdGhpcy5zYWhbY2hhbm5lbF0KICAgICAgICB9CiAgICAgICAgLy8gaW5jcmVtZW50IHNhbXBsZSBjb3VudGVyCiAgICAgICAgdGhpcy5jb3VudCsrCiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlCiAgfQp9CgpyZWdpc3RlclByb2Nlc3Nvcignc3ludGh3b3JrbGV0cHJvY2Vzc29yJywgU3ludGhXb3JrbGV0UHJvY2Vzc29yKQo=";class SY extends Xg{constructor(){const n=Pn(SY.getDefaults(),arguments,["rate"]);super(n);Qn(this,"name","FrequencyCrusher");Qn(this,"rate");Qn(this,"_audioworkletnode",this.context.createAudioWorkletNode("synthworkletprocessor"));this.rate=new pi({context:this.context,param:this._audioworkletnode.parameters.get("down"),value:n.rate,minValue:1,maxValue:512}),this.connectEffect(this._audioworkletnode)}static getDefaults(){return Object.assign(Xg.getDefaults(),{rate:64})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}async function pht(){await cc().addAudioWorkletModule(fht)}const wG=Cc("256n").toSeconds(),mht=Cc("8n").toSeconds();function WH(){const t=new mY,e=cl(t.get()),n=new $6,r=cl(n.get()),i=new pY,s=cl(i.get()),a=new NO,o=cl(a.get()),c=new gY,l=cl(c.get()),u=new SY,h=cl(u.get());function d(){t.set({...e,wet:0}),n.set({...r,wet:0,delayTime:wG,maxDelay:"8n",feedback:.666}),i.set({...s,wet:0,frequency:4,octaves:3,baseFrequency:330}),a.set({...o,wet:0,distortion:.9,oversample:"2x"}),c.set({...l,wet:0,depth:.2}),u.set({...h,wet:0,rate:32})}return d(),{fc:u,echo:n,reverb:t,phaser:i,vibrato:c,distortion:a,applyreset:d,fcrush:u,distort:a}}var Nl=(t=>(t[t.SYNTH=0]="SYNTH",t[t.RETRO_NOISE=1]="RETRO_NOISE",t[t.BUZZ_NOISE=2]="BUZZ_NOISE",t[t.CLANG_NOISE=3]="CLANG_NOISE",t[t.METALLIC_NOISE=4]="METALLIC_NOISE",t))(Nl||{});const Fne=32768;function ght(t){const e=cc().createBuffer(1,Fne,cc().sampleRate);let n=1;const r=e.getChannelData(0);for(let i=0;i<Fne;i++){t===4?r[i]=(n&1)*4*(Math.random()*14+1)-8:r[i]=(n&1)*2-1;let s=n>>1;if((n+s&1)==1)switch(t){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}n=s}return e}function _v(t){let e,n;function r(){switch(e==null?void 0:e.type){case 0:{e.synth.set({...n,envelope:{...n.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...n.oscillator,type:"square"}});break}case 1:e.synth.set({...n,release:"8n"})}}switch(t){case 0:return e={type:t,synth:new Gu},n=cl(e.synth.get()),r(),{source:e,applyreset:r};case 1:case 2:case 3:case 4:return e={type:t,synth:new wI({volume:-12,attack:.001,release:.75,urls:{C4:ght(t)}})},n=cl(e.synth.get()),r(),{source:e,applyreset:r}}}function zne(t){return 20*Math.log10(t)-35}function vht(){const t=lht(),e=cc().createMediaStreamDestination(),n=new Sg(-4);n.connect(t),n.connect(e);const r=new _Y({threshold:-24,ratio:4,attack:.003,release:.25,knee:30});r.connect(n);const i=new fY;i.set({wet:.22,depth:.777,delayTime:16}),i.connect(r);const s=new Sg;s.connect(i);const a=new Sg;a.connect(i);const o=new Sg;o.connect(i);const c=[_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH),_v(Nl.SYNTH)],l=[WH(),WH(),WH()];function u($e){return $e<4?Math.floor($e/2):2}function h($e){const Ue=u($e);c[$e].source.synth.chain(l[Ue].fc,l[Ue].distortion,l[Ue].vibrato,l[Ue].phaser,l[Ue].echo,l[Ue].reverb,$e<4?s:a)}for(let $e=0;$e<c.length;++$e)h($e);function d($e,Ue){c[$e].source.type!==Ue&&(c[$e].source.synth.dispose(),c[$e]=_v(Ue),h($e))}const f=new OU().connect(s);f.maxPolyphony=8,f.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function p($e){f.triggerAttackRelease("C6","1i",$e)}const g=new Gu().connect(s);f.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function _($e){const Ue=Cc("64n").toSeconds();g.triggerAttackRelease("C6","8n",$e),g.frequency.exponentialRampToValueAtTime("C11",Ue+$e)}const v=new Uf(350,"bandpass").connect(s),E=new yi().connect(v);E.gain.value=0;const T=new OU().connect(E);T.volume.value=16,T.maxPolyphony=8,T.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function x($e,Ue){const qt=Cc("64n").toSeconds()+Cc($e).toSeconds();E.gain.setValueAtTime(.5,Ue),E.gain.exponentialRampToValueAtTime(.01,qt+Ue),T.triggerAttackRelease([800,540],$e,Ue)}const N=new bY(-10,10,-1).connect(s),A=new Uf(800,"highpass",-12);A.connect(N);const I=new ew;I.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),I.connect(A);function k($e,Ue){I.triggerAttackRelease($e,Ue)}const L=new NO().connect(s);L.set({distortion:.666});const U=new Gu;U.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),U.connect(L);const $=new Uf;$.set({type:"highpass",frequency:1e4}),$.connect(L);const q=new ew;q.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),q.connect($);function G($e,Ue){const qt=Cc("512n").toSeconds(),Mt=Cc("32n").toSeconds();U.triggerAttackRelease(1e4,$e,Ue,1),U.frequency.exponentialRampToValueAtTime(300,Ue+qt),U.frequency.exponentialRampToValueAtTime(100,Ue+Mt),q.triggerAttackRelease("8n",Ue,.333),q.volume.setValueAtTime(1,Ue),q.volume.exponentialRampToValueAtTime(0,Ue+Cc("32n").toSeconds())}const X=new Uf;X.set({type:"bandpass",frequency:256,Q:.17}),X.connect(s);const re=new Gu;re.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),re.connect(X);const V=new Gu;V.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),V.connect(X);function Z($e,Ue){re.triggerAttackRelease(2e3,$e,Ue),re.frequency.exponentialRampToValueAtTime(1e3,Ue+Cc("32n").toSeconds()),V.triggerAttackRelease(999,$e,Ue),V.frequency.exponentialRampToValueAtTime(888,Ue+Cc("256n").toSeconds())}const Y=new NO().connect(s);Y.set({distortion:.876});const ee=new Gu;ee.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),ee.connect(Y);const oe=new Uf;oe.set({type:"highpass",frequency:1e4}),oe.connect(Y);const de=new ew;de.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),de.connect(oe);function Me($e,Ue){const qt=Cc("512n").toSeconds(),Mt=Cc("32n").toSeconds();ee.triggerAttackRelease(1e4,$e,Ue,1),ee.frequency.exponentialRampToValueAtTime(150,Ue+qt),ee.frequency.exponentialRampToValueAtTime(100,Ue+Mt),de.triggerAttackRelease("8n",Ue,.25),de.volume.setValueAtTime(1,Ue),de.volume.exponentialRampToValueAtTime(0,Ue+Cc("32n").toSeconds())}const He=new Gu().connect(s);He.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const Te=new Gu().connect(s);He.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const Le=new ew().connect(s);Le.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function we($e,Ue){const qt=Cc("256n").toSeconds(),Mt=Cc($e).toSeconds()-qt;He.triggerAttackRelease("C4",Mt,Ue,1),He.frequency.exponentialRampToValueAtTime(kne("C0").toFrequency(),Ue+Mt),Te.triggerAttackRelease("C5",Mt,Ue,.5),Te.frequency.exponentialRampToValueAtTime(kne("C0").toFrequency(),Ue+Mt);const Yt=Cc("4n").toSeconds();Le.triggerAttackRelease("8n",Ue),Le.volume.setValueAtTime(1,Ue),Le.volume.exponentialRampToValueAtTime(0,Ue+Yt)}const Ce=new Uf;Ce.set({type:"bandpass",frequency:256,Q:.17}),Ce.connect(s);const ke=new Gu;ke.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),ke.connect(Ce);const St=new Gu;St.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),St.connect(Ce);function At($e,Ue){ke.triggerAttackRelease(2e3,$e,Ue),ke.frequency.exponentialRampToValueAtTime(100,Ue+Cc("32n").toSeconds()),St.triggerAttackRelease(699,$e,Ue),St.frequency.exponentialRampToValueAtTime(399,Ue+Cc("256n").toSeconds())}const Ee=new xI().connect(s);Ee.set({octaves:8});function ye($e){Ee.triggerAttackRelease("C1","8n",$e)}const et=new NU(fe);function fe($e,Ue){if(Ue===null)return;const[qt,Mt,Yt]=Ue;if(On(Yt)&&ae(c[qt])&&(Yt.startsWith("#")?cPe(Ge,"",Yt.slice(1)):c[qt].source.synth.triggerAttackRelease(Yt,Mt,$e)),pn(Yt))switch(Yt){case 0:p($e);break;case 1:_($e);break;case 2:x(Mt,$e);break;case 3:k(Mt,$e);break;case 4:G(Mt,$e);break;case 5:Z(Mt,$e);break;case 6:Me(Mt,$e);break;case 7:we(Mt,$e);break;case 8:At(Mt,$e);break;case 9:ye($e);break;case-1:--rt,rt===0&&(et.clear(),Ie=-1);break}}function Fe($e,Ue,qt,Mt=!0){let Yt=Ue;const ce=hht($e,Ue,qt,Mt),j=ce[ce.length-1];ae(j)&&(Yt=Math.max(Yt,j[0]));for(let W=0;W<ce.length;++W){const[me,De]=ce[W];et.add(me,De)}return Yt}let Ie=-1,rt=0,dt=Bne;function gt($e,Ue){const qt=dht($e),Mt=EY().seconds+.1;if(Ue)for(let Yt=0;Yt<qt.length;++Yt)Fe(dt++,Mt,qt[Yt],!1),dt>=c.length&&(dt=Bne);else{Ie===-1&&(Ie=Mt),rt+=qt.length;const Yt=Ie;for(let ce=0;ce<qt.length&&ce<c.length;++ce){const j=Fe(ce,Yt,qt[ce]);Ie=Math.max(Ie,j)}}}et.start(0);function bt(){et.clear(),Ie=-1,rt=0}function be($e){s.volume.value=zne($e)}function ue($e){a.volume.value=zne($e)}function Xe($e){new TI($e).connect(o).start(0)}function nt($e){o.volume.value=$e}return nt(100),be(45),ue(80),{broadcastdestination:e,addplay:gt,stopplay:bt,addttsaudiobuffer:Xe,setplayvolume:be,setbgplayvolume:ue,setttsvolume:nt,SOURCE:c,FX:l,changesource:d}}const yht=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,_ht=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function bht(t,e){if(On(t)){const n=ar(t);if(yht.test(n))return Lr(e);switch(n){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":return!0;default:return _ht.test(n)}}return!1}function Eht(t,e,n,r,i){if(!ae(e))return;const s=e.SOURCE[n];if(!ae(s)){Hr(Ge,t,"synth",`unknown voice ${n}`);return}switch(r){case"reset":case"restart":s.applyreset();return;case"vol":case"volume":pn(i)&&(s.source.synth.volume.value=i);return;case"port":case"portamento":if(pn(i))switch(s.source.type){case Nl.SYNTH:s.source.synth.portamento=i;break;case Nl.RETRO_NOISE:Hr(Ge,t,"synth","portamento for retro synth not supported");break}return;case"env":case"envelope":if(Lr(i)){const[a,o,c,l]=i;s.source.synth.set({envelope:{attack:a,decay:o,sustain:c,release:l}})}return;default:if(On(r)){if(bht(r,i)){switch(r){case"retro":e.changesource(n,Nl.RETRO_NOISE);break;case"buzz":e.changesource(n,Nl.BUZZ_NOISE);break;case"clang":e.changesource(n,Nl.CLANG_NOISE);break;case"metallic":e.changesource(n,Nl.METALLIC_NOISE);break;default:e.changesource(n,Nl.SYNTH),s.source.synth.set({oscillator:{type:r}}),Lr(i)&&s.source.synth.set({oscillator:{type:r,partials:i,partialCount:i.length}}),pn(i)&&s.source.synth.set({oscillator:{type:r,partials:[i],partialCount:1}});break}return}switch(s.source.type){case Nl.SYNTH:{switch(s.source.synth.get().oscillator.type){case"pwm":switch(r){case"modfreq":case"modulationfrequency":pn(i)&&s.source.synth.set({oscillator:{modulationFrequency:i}});return}break;case"pulse":switch(r){case"width":pn(i)&&s.source.synth.set({oscillator:{width:i}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(r){case"phase":pn(i)&&s.source.synth.set({oscillator:{phase:i}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(r){case"harmonicity":pn(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modtype":case"modulationtype":On(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":case"modulationenvelope":if(Lr(i)){const[o,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:c,sustain:l,release:u}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(r){case"harmonicity":if(pn(i)){s.source.synth.set({oscillator:{harmonicity:i}});return}break;case"modindex":if(pn(i)){s.source.synth.set({oscillator:{modulationIndex:i}});return}break;case"modtype":if(On(i)){s.source.synth.set({oscillator:{modulationType:i}});return}break;case"modenv":if(Lr(i)){const[o,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:c,sustain:l,release:u}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(r){case"count":if(pn(i)){s.source.synth.set({oscillator:{count:i}});return}break;case"phase":if(pn(i)){s.source.synth.set({oscillator:{phase:i}});return}break;case"spread":if(pn(i)){s.source.synth.set({oscillator:{spread:i}});return}break}break}return}}Hr(Ge,t,"synth",`unknown config ${r}`)}break}}function Sht(t,e,n,r,i){if(!ae(e)||n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].distortion;switch(r){case"distortion":if(pn(i)){s.set({distortion:i});return}break;case"oversample":if(On(i)){s.set({oversample:i});return}break}Hr(Ge,t,"kind",`unknown distortion ${r} or ${i}`)}function Tht(t,e,n,r,i){if(!ae(e)||n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].echo;switch(r){case"delaytime":if(pn(i)){s.set({delayTime:i});return}break;case"feedback":if(pn(i)){s.set({feedback:i});return}break}Hr(Ge,t,"kind",`unknown echo ${r} or ${i}`)}function xht(t,e,n,r,i){if(!ae(e)||n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].fcrush;switch(r){case"rate":if(pn(i)){s.set({rate:i});return}break}Hr(Ge,t,"kind",`unknown fcrush ${r} or ${i}`)}function wht(t,e,n,r,i){if(!ae(e)||n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].phaser;switch(r){case"q":if(pn(i)){s.set({Q:i});return}break;case"octaves":if(pn(i)){s.set({octaves:i});return}break;case"basefrequency":s.set({baseFrequency:i});return}Hr(Ge,t,"kind",`unknown phaser ${r} or ${i}`)}function Cht(t,e,n,r,i){if(!ae(e)||n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].reverb;switch(r){case"decay":if(pn(i)){s.set({decay:i});return}break;case"predelay":if(pn(i)){s.set({preDelay:i});return}break}Hr(Ge,t,"kind",`unknown reverb ${r} or ${i}`)}function Rht(t,e,n,r,i){if(!ae(e))return;if(n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const s=e.FX[n].vibrato;switch(r){case"maxdelay":if(pn(i)){s.set({maxDelay:i});return}break;case"depth":if(pn(i)){s.set({depth:i});return}break}Hr(Ge,t,"synth",`unknown vibrato config ${r} with ${i}`)}function Aht(t,e,n,r,i,s){if(!ae(e))return;if(n<0||n>=e.FX.length){Hr(Ge,t,"synth",`index ${n} out of bounds`);return}const a=e.FX[n][r];if(ae(a)){switch(i){case"on":a.wet.value=.2;break;case"off":a.wet.value=0;break;default:if(pn(i))a.wet.value=Ei(.01*i,0,1);else switch(r){case"fc":case"fcrush":xht(t,e,n,i,s);break;case"echo":Tht(t,e,n,i,s);break;case"phaser":wht(t,e,n,i,s);break;case"reverb":Cht(t,e,n,i,s);break;case"distort":case"distortion":Sht(t,e,n,i,s);break;case"vibrato":Rht(t,e,n,i,s);break}break}a instanceof $6&&(a.wet.value===0?a.set({delayTime:wG}):a.get().delayTime===wG&&a.set({delayTime:mht}));return}Hr(Ge,t,"synth",`unknown fx ${r}`)}const Mht="modulepreload",Oht=function(t){return"/"+t},Hne={},CG=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=Oht(c),c in Hne)return;Hne[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Mht,l||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),l)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})};var Nht=Object.defineProperty,Iht=(t,e,n)=>e in t?Nht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wr=(t,e,n)=>(Iht(t,typeof e!="symbol"?e+"":e,n),n),Eve=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},rA=(t,e,n)=>(Eve(t,e,"read from private field"),n?n.call(t):e.get(t)),kht=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Dht=(t,e,n,r)=>(Eve(t,e,"write to private field"),e.set(t,n),n),w_,YH=new Intl.Collator(0,{numeric:1}).compare;function Sve(t,e,n){return t=t.split("."),e=e.split("."),YH(t[0],e[0])||YH(t[1],e[1])||(e[2]=e.slice(2).join("."),n=/[.-]/.test(t[2]=t.slice(2).join(".")),n==/[.-]/.test(e[2])?YH(t[2],e[2]):n?-1:1)}const Pht="host",Tve="queue/data",Lht="queue/join",jne="upload",Uht="login",Bht="config",Fht="info",zht="runtime",Hht="sleeptime",jht="heartbeat",Vht="component_server",Ght="reset",qht="cancel",$ht="https://gradio-space-api-fetcher-v2.hf.space/api",xve="This application is currently busy. Please try again. ",QS="Connection errored out. ",P_="Could not resolve app config. ",Wht="Could not get space status. ",Yht="Could not get API info. ",TY="Space metadata could not be loaded. ",Xht="Invalid URL. A full URL path is required.",Kht="Not authorized to access this space. ",wve="Invalid credentials. Could not login. ",Jht="Login credentials are required to access this space.",Zht="File system access is only available in Node.js environments",Cve="Root URL not found in client config",Qht="Error uploading file";function Rve(t,e,n){return e.startsWith("http://")||e.startsWith("https://")?n?t:e:t+e}async function Vne(t,e,n){try{return(await(await fetch(`https://huggingface.co/api/spaces/${t}/jwt`,{headers:{Authorization:`Bearer ${e}`,...n?{Cookie:n}:{}}})).json()).token||!1}catch{return!1}}function edt(t){let e={};return t.forEach(({api_name:n,id:r})=>{n&&(e[n]=r)}),e}async function tdt(t){var e;const n=this.options.hf_token?{Authorization:`Bearer ${this.options.hf_token}`}:{};if(n["Content-Type"]="application/json",typeof window<"u"&&window.gradio_config&&location.origin!=="http://localhost:9876"&&!window.gradio_config.dev_mode){const r=window.gradio_config.root,i=window.gradio_config;let s=Rve(t,i.root,!1);return i.root=s,{...i,path:r}}else if(t){const r=Ove(t,Bht),i=await this.fetch(r,{headers:n,credentials:"include"});if((i==null?void 0:i.status)===401&&!this.options.auth)throw new Error(Jht);if((i==null?void 0:i.status)===401&&this.options.auth)throw new Error(wve);if((i==null?void 0:i.status)===200){let s=await i.json();return s.path=s.path??"",s.root=t,(e=s.dependencies)==null||e.forEach((a,o)=>{a.id===void 0&&(a.id=o)}),s}else if((i==null?void 0:i.status)===401)throw new Error(Kht);throw new Error(P_)}throw new Error(P_)}async function ndt(){const{http_protocol:t,host:e}=await W6(this.app_reference,this.options.hf_token);try{if(this.options.auth){const n=await Ave(t,e,this.options.auth,this.fetch,this.options.hf_token);n&&this.set_cookies(n)}}catch(n){throw Error(n.message)}}async function Ave(t,e,n,r,i){const s=new FormData;s.append("username",n==null?void 0:n[0]),s.append("password",n==null?void 0:n[1]);let a={};i&&(a.Authorization=`Bearer ${i}`);const o=await r(`${t}//${e}/${Uht}`,{headers:a,method:"POST",body:s,credentials:"include"});if(o.status===200)return o.headers.get("set-cookie");throw o.status===401?new Error(wve):new Error(TY)}function XH(t){if(t.startsWith("http")){const{protocol:e,host:n,pathname:r}=new URL(t);return{ws_protocol:e==="https:"?"wss":"ws",http_protocol:e,host:n+(r!=="/"?r:"")}}else if(t.startsWith("file:"))return{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"};return{ws_protocol:"wss",http_protocol:"https:",host:new URL(t).host}}const Mve=t=>{let e=[];return t.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach(r=>{const[i,s]=r.split(";")[0].split("=");i&&s&&e.push(`${i.trim()}=${s.trim()}`)}),e},xY=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,rdt=/.*hf\.space\/{0,1}.*$/;async function W6(t,e){const n={};e&&(n.Authorization=`Bearer ${e}`);const r=t.trim().replace(/\/$/,"");if(xY.test(r))try{const s=(await(await fetch(`https://huggingface.co/api/spaces/${r}/${Pht}`,{headers:n})).json()).host;return{space_id:t,...XH(s)}}catch{throw new Error(TY)}if(rdt.test(r)){const{ws_protocol:i,http_protocol:s,host:a}=XH(r);return{space_id:a.split("/")[0].replace(".hf.space",""),ws_protocol:i,http_protocol:s,host:a}}return{space_id:!1,...XH(r)}}const Ove=(...t)=>{try{return t.reduce((e,n)=>(e=e.replace(/\/+$/,""),n=n.replace(/^\/+/,""),new URL(n,e+"/").toString()))}catch{throw new Error(Xht)}};function idt(t,e,n){const r={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(t).forEach(i=>{(i==="named_endpoints"||i==="unnamed_endpoints")&&(r[i]={},Object.entries(t[i]).forEach(([s,{parameters:a,returns:o}])=>{var c,l,u,h;const d=((c=e.dependencies.find(g=>g.api_name===s||g.api_name===s.replace("/","")))==null?void 0:c.id)||n[s.replace("/","")]||-1,f=d!==-1?(l=e.dependencies.find(g=>g.id==d))==null?void 0:l.types:{generator:!1,cancel:!1};if(d!==-1&&((h=(u=e.dependencies.find(g=>g.id==d))==null?void 0:u.inputs)==null?void 0:h.length)!==a.length){const g=e.dependencies.find(_=>_.id==d).inputs.map(_=>{var v;return(v=e.components.find(E=>E.id===_))==null?void 0:v.type});try{g.forEach((_,v)=>{if(_==="state"){const E={component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0};a.splice(v,0,E)}})}catch(_){console.error(_)}}const p=(g,_,v,E)=>({...g,description:adt(g==null?void 0:g.type,v),type:sdt(g==null?void 0:g.type,_,v,E)||""});r[i][s]={parameters:a.map(g=>p(g,g==null?void 0:g.component,g==null?void 0:g.serializer,"parameter")),returns:o.map(g=>p(g,g==null?void 0:g.component,g==null?void 0:g.serializer,"return")),type:f}}))}),r}function sdt(t,e,n,r){if(e==="Api")return t.type;switch(t==null?void 0:t.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}if(n==="JSONSerializable"||n==="StringSerializable")return"any";if(n==="ListStringSerializable")return"string[]";if(e==="Image")return r==="parameter"?"Blob | File | Buffer":"string";if(n==="FileSerializable")return(t==null?void 0:t.type)==="array"?r==="parameter"?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":r==="parameter"?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}";if(n==="GallerySerializable")return r==="parameter"?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]"}function adt(t,e){return e==="GallerySerializable"?"array of [file, label] tuples":e==="ListStringSerializable"?"array of strings":e==="FileSerializable"?"array of files or single file":t==null?void 0:t.description}function KH(t,e){switch(t.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:!0,message:xve,stage:"error",code:t.code,success:t.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:!0,message:t.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:!0,stage:e||"pending",code:t.code,size:t.queue_size,position:t.rank,eta:t.rank_eta,success:t.success}};case"progress":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,progress_data:t.progress_data,success:t.success}};case"log":return{type:"log",data:t};case"process_generating":return{type:"generating",status:{queue:!0,message:t.success?null:t.output.error,stage:t.success?"generating":"error",code:t.code,progress_data:t.progress_data,eta:t.average_duration,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_streaming":return{type:"streaming",status:{queue:!0,message:t.output.error,stage:"streaming",time_limit:t.time_limit,code:t.code,progress_data:t.progress_data,eta:t.eta},data:t.output};case"process_completed":return"error"in t.output?{type:"update",status:{queue:!0,title:t.output.title,message:t.output.error,visible:t.output.visible,duration:t.output.duration,stage:"error",code:t.code,success:t.success}}:{type:"complete",status:{queue:!0,message:t.success?void 0:t.output.error,stage:t.success?"complete":"error",code:t.code,progress_data:t.progress_data,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_starts":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,size:t.rank,position:0,success:t.success,eta:t.eta},original_msg:"process_starts"}}return{type:"none",status:{stage:"error",queue:!0}}}const odt=(t=[],e)=>{const n=e?e.parameters:[];if(Array.isArray(t))return t.length>n.length&&console.warn("Too many arguments provided for the endpoint."),t;const r=[],i=Object.keys(t);return n.forEach((s,a)=>{if(t.hasOwnProperty(s.parameter_name))r[a]=t[s.parameter_name];else if(s.parameter_has_default)r[a]=s.parameter_default;else throw new Error(`No value provided for required parameter: ${s.parameter_name}`)}),i.forEach(s=>{if(!n.some(a=>a.parameter_name===s))throw new Error(`Parameter \`${s}\` is not a valid keyword argument. Please refer to the API for usage.`)}),r.forEach((s,a)=>{if(s===void 0&&!n[a].parameter_has_default)throw new Error(`No value provided for required parameter: ${n[a].parameter_name}`)}),r};async function cdt(){if(this.api_info)return this.api_info;const{hf_token:t}=this.options,{config:e}=this,n={"Content-Type":"application/json"};if(t&&(n.Authorization=`Bearer ${t}`),!!e)try{let r,i;if(typeof window<"u"&&window.gradio_api_info)i=window.gradio_api_info;else{if(Sve((e==null?void 0:e.version)||"2.0.0","3.30")<0)r=await this.fetch($ht,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(e)}),headers:n,credentials:"include"});else{const s=Ove(e.root,this.api_prefix,Fht);r=await this.fetch(s,{headers:n,credentials:"include"})}if(!r.ok)throw new Error(QS);i=await r.json()}return"api"in i&&(i=i.api),i.named_endpoints["/predict"]&&!i.unnamed_endpoints[0]&&(i.unnamed_endpoints[0]=i.named_endpoints["/predict"]),idt(i,e,this.api_map)}catch(r){""+r.message}}async function ldt(t,e,n){var r;const i={};(r=this==null?void 0:this.options)!=null&&r.hf_token&&(i.Authorization=`Bearer ${this.options.hf_token}`);const s=1e3,a=[];let o;for(let c=0;c<e.length;c+=s){const l=e.slice(c,c+s),u=new FormData;l.forEach(d=>{u.append("files",d)});try{const d=n?`${t}${this.api_prefix}/${jne}?upload_id=${n}`:`${t}${this.api_prefix}/${jne}`;o=await this.fetch(d,{method:"POST",body:u,headers:i,credentials:"include"})}catch(d){throw new Error(QS+d.message)}if(!o.ok){const d=await o.text();return{error:`HTTP ${o.status}: ${d}`}}const h=await o.json();h&&a.push(...h)}return{files:a}}async function udt(t,e,n,r){let i=(Array.isArray(t)?t:[t]).map(a=>a.blob);const s=i.filter(a=>a.size>(r??1/0));if(s.length)throw new Error(`File size exceeds the maximum allowed size of ${r} bytes: ${s.map(a=>a.name).join(", ")}`);return await Promise.all(await this.upload_files(e,i,n).then(async a=>{if(a.error)throw new Error(a.error);return a.files?a.files.map((o,c)=>new wY({...t[c],path:o,url:`${e}${this.api_prefix}/file=${o}`})):[]}))}class wY{constructor({path:e,url:n,orig_name:r,size:i,blob:s,is_stream:a,mime_type:o,alt_text:c,b64:l}){Wr(this,"path"),Wr(this,"url"),Wr(this,"orig_name"),Wr(this,"size"),Wr(this,"blob"),Wr(this,"is_stream"),Wr(this,"mime_type"),Wr(this,"alt_text"),Wr(this,"b64"),Wr(this,"meta",{_type:"gradio.FileData"}),this.path=e,this.url=n,this.orig_name=r,this.size=i,this.blob=n?void 0:s,this.is_stream=a,this.mime_type=o,this.alt_text=c,this.b64=l}}class hdt{constructor(e,n){Wr(this,"type"),Wr(this,"command"),Wr(this,"meta"),Wr(this,"fileData"),this.type="command",this.command=e,this.meta=n}}typeof zn<"u"&&zn.versions&&zn.versions.node;function Gne(t,e,n){for(;n.length>1;){const i=n.shift();if(typeof i=="string"||typeof i=="number")t=t[i];else throw new Error("Invalid key type")}const r=n.shift();if(typeof r=="string"||typeof r=="number")t[r]=e;else throw new Error("Invalid key type")}async function RG(t,e=void 0,n=[],r=!1,i=void 0){if(Array.isArray(t)){let s=[];return await Promise.all(t.map(async(a,o)=>{var c;let l=n.slice();l.push(String(o));const u=await RG(t[o],r?((c=i==null?void 0:i.parameters[o])==null?void 0:c.component)||void 0:e,l,!1,i);s=s.concat(u)})),s}else{if(globalThis.Buffer&&t instanceof globalThis.Buffer||t instanceof Blob)return[{path:n,blob:new Blob([t]),type:e}];if(typeof t=="object"&&t!==null){let s=[];for(const a of Object.keys(t)){const o=[...n,a],c=t[a];s=s.concat(await RG(c,void 0,o,!1,i))}return s}}return[]}function ddt(t,e){var n,r;let i=(r=(n=e==null?void 0:e.dependencies)==null?void 0:n.find(s=>s.id==t))==null?void 0:r.queue;return i!=null?!i:!e.enable_queue}function fdt(t,e){return new Promise((n,r)=>{const i=new MessageChannel;i.port1.onmessage=({data:s})=>{i.port1.close(),n(s)},window.parent.postMessage(t,e,[i.port2])})}function iA(t,e,n,r,i=!1){if(r==="input"&&!i)throw new Error("Invalid code path. Cannot skip state inputs for input.");if(r==="output"&&i)return t;let s=[],a=0;const o=r==="input"?e.inputs:e.outputs;for(let c=0;c<o.length;c++){const l=o[c],u=n.find(h=>h.id===l);if((u==null?void 0:u.type)==="state"){if(i)if(t.length===o.length){const h=t[a];s.push(h),a++}else s.push(null);else{a++;continue}continue}else{const h=t[a];s.push(h),a++}}return s}async function pdt(t,e,n){const r=this;await mdt(r,e);const i=await RG(e,void 0,[],!0,n);return(await Promise.all(i.map(async({path:a,blob:o,type:c})=>{if(!o)return{path:a,type:c};const l=await r.upload_files(t,[o]),u=l.files&&l.files[0];return{path:a,file_url:u,type:c,name:typeof File<"u"&&o instanceof File?o==null?void 0:o.name:void 0}}))).forEach(({path:a,file_url:o,type:c,name:l})=>{if(c==="Gallery")Gne(e,o,a);else if(o){const u=new wY({path:o,orig_name:l});Gne(e,u,a)}}),e}async function mdt(t,e){var n,r;if(!(((n=t.config)==null?void 0:n.root)||((r=t.config)==null?void 0:r.root_url)))throw new Error(Cve);await Nve(t,e)}async function Nve(t,e,n=[]){for(const r in e)e[r]instanceof hdt?await gdt(t,e,r):typeof e[r]=="object"&&e[r]!==null&&await Nve(t,e[r],[...n,r])}async function gdt(t,e,n){var r,i;let s=e[n];const a=((r=t.config)==null?void 0:r.root)||((i=t.config)==null?void 0:i.root_url);if(!a)throw new Error(Cve);try{let o,c;if(typeof zn<"u"&&zn.versions&&zn.versions.node){const d=await CG(()=>Promise.resolve().then(()=>BV),void 0);c=(await CG(()=>Promise.resolve().then(()=>BV),void 0)).resolve(zn.cwd(),s.meta.path),o=await d.readFile(c)}else throw new Error(Zht);const l=new Blob([o],{type:"application/octet-stream"}),u=await t.upload_files(a,[l]),h=u.files&&u.files[0];if(h){const d=new wY({path:h,orig_name:s.meta.name||""});e[n]=d}}catch(o){console.error(Qht,o)}}async function vdt(t,e,n){const r={"Content-Type":"application/json"};this.options.hf_token&&(r.Authorization=`Bearer ${this.options.hf_token}`);try{var i=await this.fetch(t,{method:"POST",body:JSON.stringify(e),headers:{...r,...n},credentials:"include"})}catch{return[{error:QS},500]}let s,a;try{s=await i.json(),a=i.status}catch(o){s={error:`Could not parse server response: ${o}`},a=500}return[s,a]}async function ydt(t,e={}){let n=!1,r=!1;if(!this.config)throw new Error("Could not resolve app config");if(typeof t=="number")this.config.dependencies.find(i=>i.id==t);else{const i=t.replace(/^\//,"");this.config.dependencies.find(s=>s.id==this.api_map[i])}return new Promise(async(i,s)=>{const a=this.submit(t,e,null,null,!0);let o;for await(const c of a)c.type==="data"&&(r&&i(o),n=!0,o=c),c.type==="status"&&(c.stage==="error"&&s(c),c.stage==="complete"&&(r=!0,n&&i(o)))})}async function oM(t,e,n){let r=e==="subdomain"?`https://huggingface.co/api/spaces/by-subdomain/${t}`:`https://huggingface.co/api/spaces/${t}`,i,s;try{if(i=await fetch(r),s=i.status,s!==200)throw new Error;i=await i.json()}catch{n({status:"error",load_status:"error",message:Wht,detail:"NOT_FOUND"});return}if(!i||s!==200)return;const{runtime:{stage:a},id:o}=i;switch(a){case"STOPPED":case"SLEEPING":n({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:a}),setTimeout(()=>{oM(t,e,n)},1e3);break;case"PAUSED":n({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:a,discussions_enabled:await qne(o)});break;case"RUNNING":case"RUNNING_BUILDING":n({status:"running",load_status:"complete",message:"Space is running.",detail:a});break;case"BUILDING":n({status:"building",load_status:"pending",message:"Space is building...",detail:a}),setTimeout(()=>{oM(t,e,n)},1e3);break;case"APP_STARTING":n({status:"starting",load_status:"pending",message:"Space is starting...",detail:a}),setTimeout(()=>{oM(t,e,n)},1e3);break;default:n({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:a,discussions_enabled:await qne(o)});break}}const Ive=async(t,e)=>{let n=0;const r=12,i=5e3;return new Promise(s=>{oM(t,xY.test(t)?"space_name":"subdomain",a=>{e(a),a.status==="running"||a.status==="error"||a.status==="paused"||a.status==="space_error"?s():(a.status==="sleeping"||a.status==="building")&&(n<r?(n++,setTimeout(()=>{Ive(t,e).then(s)},i)):s())})})},_dt=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function qne(t){try{const e=await fetch(`https://huggingface.co/api/spaces/${t}/discussions`,{method:"HEAD"}),n=e.headers.get("x-error-message");return!(!e.ok||n&&_dt.test(n))}catch{return!1}}async function bdt(t,e){const n={};e&&(n.Authorization=`Bearer ${e}`);try{const r=await fetch(`https://huggingface.co/api/spaces/${t}/${zht}`,{headers:n});if(r.status!==200)throw new Error("Space hardware could not be obtained.");const{hardware:i}=await r.json();return i.current}catch(r){throw new Error(r.message)}}async function Edt(t,e,n){const r={};n&&(r.Authorization=`Bearer ${n}`);const i={seconds:e};try{const s=await fetch(`https://huggingface.co/api/spaces/${t}/${Hht}`,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(i)});if(s.status!==200)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await s.json()}catch(s){throw new Error(s.message)}}const $ne=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function Sdt(t,e){const{hf_token:n,private:r,hardware:i,timeout:s,auth:a}=e;if(i&&!$ne.includes(i))throw new Error(`Invalid hardware type provided. Valid types are: ${$ne.map(_=>`"${_}"`).join(",")}.`);const{http_protocol:o,host:c}=await W6(t,n);let l=null;if(a){const _=await Ave(o,c,a,fetch);_&&(l=Mve(_))}const u={Authorization:`Bearer ${n}`,"Content-Type":"application/json",...l?{Cookie:l.join("; ")}:{}},h=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:u})).json()).name,d=t.split("/")[1],f={repository:`${h}/${d}`};r&&(f.private=!0);let p;try{i||(p=await bdt(t,n))}catch(_){throw Error(TY+_.message)}const g=i||p||"cpu-basic";f.hardware=g;try{const _=await fetch(`https://huggingface.co/api/spaces/${t}/duplicate`,{method:"POST",headers:u,body:JSON.stringify(f)});if(_.status===409)try{return await AG.connect(`${h}/${d}`,e)}catch(E){throw console.error("Failed to connect Client instance:",E),E}else if(_.status!==200)throw new Error(_.statusText);const v=await _.json();return await Edt(`${h}/${d}`,s||300,n),await AG.connect(Tdt(v.url),e)}catch(_){throw new Error(_)}}function Tdt(t){const e=/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/,n=t.match(e);if(n)return n[1]}class xdt extends TransformStream{constructor(e={allowCR:!1}){super({transform:(n,r)=>{for(n=rA(this,w_)+n;;){const i=n.indexOf(`
`),s=e.allowCR?n.indexOf("\r"):-1;if(s!==-1&&s!==n.length-1&&(i===-1||i-1>s)){r.enqueue(n.slice(0,s)),n=n.slice(s+1);continue}if(i===-1)break;const a=n[i-1]==="\r"?i-1:i;r.enqueue(n.slice(0,a)),n=n.slice(i+1)}Dht(this,w_,n)},flush:n=>{if(rA(this,w_)==="")return;const r=e.allowCR&&rA(this,w_).endsWith("\r")?rA(this,w_).slice(0,-1):rA(this,w_);n.enqueue(r)}}),kht(this,w_,"")}}w_=new WeakMap;function wdt(t){let e=new TextDecoderStream,n=new xdt({allowCR:!0});return t.pipeThrough(e).pipeThrough(n)}function Cdt(t){let n=/[:]\s*/.exec(t),r=n&&n.index;if(r)return[t.substring(0,r),t.substring(r+n[0].length)]}function Wne(t,e,n){t.get(e)||t.set(e,n)}async function*Rdt(t,e){if(!t.body)return;let n=wdt(t.body),r,i=n.getReader(),s;for(;;){if(e&&e.aborted)return i.cancel();if(r=await i.read(),r.done)return;if(!r.value){s&&(yield s),s=void 0;continue}let[a,o]=Cdt(r.value)||[];a&&(a==="data"?(s||(s={}),s[a]=s[a]?s[a]+`
`+o:o):a==="event"?(s||(s={}),s[a]=o):a==="id"?(s||(s={}),s[a]=+o||o):a==="retry"&&(s||(s={}),s[a]=+o||void 0))}}async function Adt(t,e){let n=new Request(t,e);Wne(n.headers,"Accept","text/event-stream"),Wne(n.headers,"Content-Type","application/json");let r=await fetch(n);if(!r.ok)throw r;return Rdt(r,n.signal)}async function Mdt(){let{event_callbacks:t,unclosed_events:e,pending_stream_messages:n,stream_status:r,config:i,jwt:s}=this;const a=this;if(!i)throw new Error("Could not resolve app config");r.open=!0;let o=null,c=new URLSearchParams({session_hash:this.session_hash}).toString(),l=new URL(`${i.root}${this.api_prefix}/${Tve}?${c}`);if(s&&l.searchParams.set("__sign",s),o=this.stream(l),!o){console.warn("Cannot connect to SSE endpoint: "+l.toString());return}o.onmessage=async function(u){let h=JSON.parse(u.data);if(h.msg==="close_stream"){kU(r,a.abort_controller);return}const d=h.event_id;if(!d)await Promise.all(Object.keys(t).map(f=>t[f](h)));else if(t[d]&&i){h.msg==="process_completed"&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(i.protocol)&&e.delete(d);let f=t[d];typeof window<"u"&&typeof document<"u"?setTimeout(f,0,h):f(h)}else n[d]||(n[d]=[]),n[d].push(h)},o.onerror=async function(){await Promise.all(Object.keys(t).map(u=>t[u]({msg:"unexpected_error",message:QS})))}}function kU(t,e){t&&(t.open=!1,e==null||e.abort())}function Odt(t,e,n){!t[e]?(t[e]=[],n.data.forEach((i,s)=>{t[e][s]=i})):n.data.forEach((i,s)=>{let a=Ndt(t[e][s],i);t[e][s]=a,n.data[s]=a})}function Ndt(t,e){return e.forEach(([n,r,i])=>{t=Idt(t,r,n,i)}),t}function Idt(t,e,n,r){if(e.length===0){if(n==="replace")return r;if(n==="append")return t+r;throw new Error(`Unsupported action: ${n}`)}let i=t;for(let a=0;a<e.length-1;a++)i=i[e[a]];const s=e[e.length-1];switch(n){case"replace":i[s]=r;break;case"append":i[s]+=r;break;case"add":Array.isArray(i)?i.splice(Number(s),0,r):i[s]=r;break;case"delete":Array.isArray(i)?i.splice(Number(s),1):delete i[s];break;default:throw new Error(`Unknown action: ${n}`)}return t}function kdt(t,e={}){const n={close:()=>{console.warn("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:t.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:()=>{throw new Error("Method not implemented.")},dispatchEvent:()=>{throw new Error("Method not implemented.")},removeEventListener:()=>{throw new Error("Method not implemented.")}};return Adt(t,e).then(async r=>{n.readyState=n.OPEN;try{for await(const i of r)n.onmessage&&n.onmessage(i);n.readyState=n.CLOSED}catch(i){n.onerror&&n.onerror(i),n.readyState=n.CLOSED}}).catch(r=>{console.error(r),n.onerror&&n.onerror(r),n.readyState=n.CLOSED}),n}function Ddt(t,e={},n,r,i){var s;try{let a=function(Fe){(i||Ce[Fe.type])&&u(Fe)},o=function(){for(Ee=!0;et.length>0;)et.shift()({value:void 0,done:!0})},c=function(Fe){Ee||(et.length>0?et.shift()(Fe):ye.push(Fe))},l=function(Fe){c(Pdt(Fe)),o()},u=function(Fe){c({value:Fe,done:!1})},h=function(){return ye.length>0?Promise.resolve(ye.shift()):Ee?Promise.resolve({value:void 0,done:!0}):new Promise(Fe=>et.push(Fe))};const{hf_token:d}=this.options,{fetch:f,app_reference:p,config:g,session_hash:_,api_info:v,api_map:E,stream_status:T,pending_stream_messages:x,pending_diff_streams:N,event_callbacks:A,unclosed_events:I,post_data:k,options:L,api_prefix:U}=this,$=this;if(!v)throw new Error("No API found");if(!g)throw new Error("Could not resolve app config");let{fn_index:q,endpoint_info:G,dependency:X}=Ldt(v,t,E,g),re=odt(e,G),V,Z,Y=g.protocol??"ws",ee="",oe=()=>ee;const de=typeof t=="number"?"/predict":t;let Me,He=null,Te=!1,Le={},we=typeof window<"u"&&typeof document<"u"?new URLSearchParams(window.location.search).toString():"";const Ce=((s=L==null?void 0:L.events)==null?void 0:s.reduce((Fe,Ie)=>(Fe[Ie]=!0,Fe),{}))||{};async function ke(){const Fe={stage:"complete",queue:!1,time:new Date};Te=Fe,a({...Fe,type:"status",endpoint:de,fn_index:q});let Ie={},rt={};Y==="ws"?(V&&V.readyState===0?V.addEventListener("open",()=>{V.close()}):V.close(),Ie={fn_index:q,session_hash:_}):(kU(T,$.abort_controller),o(),Ie={event_id:He},rt={event_id:He,session_hash:_,fn_index:q});try{if(!g)throw new Error("Could not resolve app config");"event_id"in rt&&await f(`${g.root}${U}/${qht}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(rt)}),await f(`${g.root}${U}/${Ght}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(Ie)})}catch{console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}const St=async Fe=>{await this._resolve_hearbeat(Fe)};async function At(Fe){if(!g)return;let Ie=Fe.render_id;g.components=[...g.components.filter(gt=>gt.props.rendered_in!==Ie),...Fe.components],g.dependencies=[...g.dependencies.filter(gt=>gt.rendered_in!==Ie),...Fe.dependencies];const rt=g.components.some(gt=>gt.type==="state"),dt=g.dependencies.some(gt=>gt.targets.some(bt=>bt[1]==="unload"));g.connect_heartbeat=rt||dt,await St(g),a({type:"render",data:Fe,endpoint:de,fn_index:q})}this.handle_blob(g.root,re,G).then(async Fe=>{var Ie;if(Me={data:iA(Fe,X,g.components,"input",!0)||[],event_data:n,fn_index:q,trigger_id:r},ddt(q,g))a({type:"status",endpoint:de,stage:"pending",queue:!1,fn_index:q,time:new Date}),k(`${g.root}${U}/run${de.startsWith("/")?de:`/${de}`}${we?"?"+we:""}`,{...Me,session_hash:_}).then(([gt,bt])=>{const be=gt.data;bt==200?(a({type:"data",endpoint:de,fn_index:q,data:iA(be,X,g.components,"output",L.with_null_state),time:new Date,event_data:n,trigger_id:r}),gt.render_config&&At(gt.render_config),a({type:"status",endpoint:de,fn_index:q,stage:"complete",eta:gt.average_duration,queue:!1,time:new Date})):a({type:"status",stage:"error",endpoint:de,fn_index:q,message:gt.error,queue:!1,time:new Date})}).catch(gt=>{a({type:"status",stage:"error",message:gt.message,endpoint:de,fn_index:q,queue:!1,time:new Date})});else if(Y=="ws"){const{ws_protocol:gt,host:bt}=await W6(p,d);a({type:"status",stage:"pending",queue:!0,endpoint:de,fn_index:q,time:new Date});let be=new URL(`${gt}://${Rve(bt,g.path,!0)}/queue/join${we?"?"+we:""}`);this.jwt&&be.searchParams.set("__sign",this.jwt),V=new WebSocket(be),V.onclose=ue=>{ue.wasClean||a({type:"status",stage:"error",broken:!0,message:QS,queue:!0,endpoint:de,fn_index:q,time:new Date})},V.onmessage=function(ue){const Xe=JSON.parse(ue.data),{type:nt,status:$e,data:Ue}=KH(Xe,Le[q]);if(nt==="update"&&$e&&!Te)a({type:"status",endpoint:de,fn_index:q,time:new Date,...$e}),$e.stage==="error"&&V.close();else if(nt==="hash"){V.send(JSON.stringify({fn_index:q,session_hash:_}));return}else nt==="data"?V.send(JSON.stringify({...Me,session_hash:_})):nt==="complete"?Te=$e:nt==="log"?a({type:"log",title:Ue.title,log:Ue.log,level:Ue.level,endpoint:de,duration:Ue.duration,visible:Ue.visible,fn_index:q}):nt==="generating"&&a({type:"status",time:new Date,...$e,stage:$e==null?void 0:$e.stage,queue:!0,endpoint:de,fn_index:q});Ue&&(a({type:"data",time:new Date,data:iA(Ue.data,X,g.components,"output",L.with_null_state),endpoint:de,fn_index:q,event_data:n,trigger_id:r}),Te&&(a({type:"status",time:new Date,...Te,stage:$e==null?void 0:$e.stage,queue:!0,endpoint:de,fn_index:q}),V.close()))},Sve(g.version||"2.0.0","3.6")<0&&addEventListener("open",()=>V.send(JSON.stringify({hash:_})))}else if(Y=="sse"){a({type:"status",stage:"pending",queue:!0,endpoint:de,fn_index:q,time:new Date});var dt=new URLSearchParams({fn_index:q.toString(),session_hash:_}).toString();let gt=new URL(`${g.root}${U}/${Tve}?${we?we+"&":""}${dt}`);if(this.jwt&&gt.searchParams.set("__sign",this.jwt),Z=this.stream(gt),!Z)return Promise.reject(new Error("Cannot connect to SSE endpoint: "+gt.toString()));Z.onmessage=async function(bt){const be=JSON.parse(bt.data),{type:ue,status:Xe,data:nt}=KH(be,Le[q]);if(ue==="update"&&Xe&&!Te)a({type:"status",endpoint:de,fn_index:q,time:new Date,...Xe}),Xe.stage==="error"&&(Z==null||Z.close(),o());else if(ue==="data"){let[$e,Ue]=await k(`${g.root}${U}/queue/data`,{...Me,session_hash:_,event_id:He});Ue!==200&&(a({type:"status",stage:"error",message:QS,queue:!0,endpoint:de,fn_index:q,time:new Date}),Z==null||Z.close(),o())}else ue==="complete"?Te=Xe:ue==="log"?a({type:"log",title:nt.title,log:nt.log,level:nt.level,endpoint:de,duration:nt.duration,visible:nt.visible,fn_index:q}):(ue==="generating"||ue==="streaming")&&a({type:"status",time:new Date,...Xe,stage:Xe==null?void 0:Xe.stage,queue:!0,endpoint:de,fn_index:q});nt&&(a({type:"data",time:new Date,data:iA(nt.data,X,g.components,"output",L.with_null_state),endpoint:de,fn_index:q,event_data:n,trigger_id:r}),Te&&(a({type:"status",time:new Date,...Te,stage:Xe==null?void 0:Xe.stage,queue:!0,endpoint:de,fn_index:q}),Z==null||Z.close(),o()))}}else if(Y=="sse_v1"||Y=="sse_v2"||Y=="sse_v2.1"||Y=="sse_v3"){a({type:"status",stage:"pending",queue:!0,endpoint:de,fn_index:q,time:new Date});let gt="";typeof window<"u"&&typeof document<"u"&&(gt=(Ie=window==null?void 0:window.location)==null?void 0:Ie.hostname);const be=gt.includes(".dev.")?`https://moon-${gt.split(".")[1]}.dev.spaces.huggingface.tech`:"https://huggingface.co";(typeof window<"u"&&typeof document<"u"&&window.parent!=window&&window.supports_zerogpu_headers?fdt("zerogpu-headers",be):Promise.resolve(null)).then($e=>k(`${g.root}${U}/${Lht}?${we}`,{...Me,session_hash:_},$e)).then(async([$e,Ue])=>{if(Ue===503)a({type:"status",stage:"error",message:xve,queue:!0,endpoint:de,fn_index:q,time:new Date});else if(Ue!==200)a({type:"status",stage:"error",message:QS,queue:!0,endpoint:de,fn_index:q,time:new Date});else{He=$e.event_id,ee=He;let qt=async function(Mt){try{const{type:Yt,status:ce,data:j,original_msg:W}=KH(Mt,Le[q]);if(Yt=="heartbeat")return;if(Yt==="update"&&ce&&!Te)a({type:"status",endpoint:de,fn_index:q,time:new Date,original_msg:W,...ce});else if(Yt==="complete")Te=ce;else if(Yt=="unexpected_error")console.error("Unexpected error",ce==null?void 0:ce.message),a({type:"status",stage:"error",message:(ce==null?void 0:ce.message)||"An Unexpected Error Occurred!",queue:!0,endpoint:de,fn_index:q,time:new Date});else if(Yt==="log"){a({type:"log",title:j.title,log:j.log,level:j.level,endpoint:de,duration:j.duration,visible:j.visible,fn_index:q});return}else(Yt==="generating"||Yt==="streaming")&&(a({type:"status",time:new Date,...ce,stage:ce==null?void 0:ce.stage,queue:!0,endpoint:de,fn_index:q}),j&&X.connection!=="stream"&&["sse_v2","sse_v2.1","sse_v3"].includes(Y)&&Odt(N,He,j));j&&(a({type:"data",time:new Date,data:iA(j.data,X,g.components,"output",L.with_null_state),endpoint:de,fn_index:q}),j.render_config&&await At(j.render_config),Te&&(a({type:"status",time:new Date,...Te,stage:ce==null?void 0:ce.stage,queue:!0,endpoint:de,fn_index:q}),o())),((ce==null?void 0:ce.stage)==="complete"||(ce==null?void 0:ce.stage)==="error")&&(A[He]&&delete A[He],He in N&&delete N[He])}catch(Yt){console.error("Unexpected client exception",Yt),a({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:de,fn_index:q,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(Y)&&(kU(T,$.abort_controller),T.open=!1,o())}};He in x&&(x[He].forEach(Mt=>qt(Mt)),delete x[He]),A[He]=qt,I.add(He),T.open||await this.open_stream()}})}});let Ee=!1;const ye=[],et=[],fe={[Symbol.asyncIterator]:()=>fe,next:h,throw:async Fe=>(l(Fe),h()),return:async()=>(o(),h()),cancel:ke,event_id:oe};return fe}catch(a){throw console.error("Submit function encountered an error:",a),a}}function Pdt(t){return{then:(e,n)=>n(t)}}function Ldt(t,e,n,r){let i,s,a;if(typeof e=="number")i=e,s=t.unnamed_endpoints[i],a=r.dependencies.find(o=>o.id==e);else{const o=e.replace(/^\//,"");i=n[o],s=t.named_endpoints[e.trim()],a=r.dependencies.find(c=>c.id==n[o])}if(typeof i!="number")throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:i,endpoint_info:s,dependency:a}}class AG{constructor(e,n={events:["data"]}){Wr(this,"app_reference"),Wr(this,"options"),Wr(this,"config"),Wr(this,"api_prefix",""),Wr(this,"api_info"),Wr(this,"api_map",{}),Wr(this,"session_hash",Math.random().toString(36).substring(2)),Wr(this,"jwt",!1),Wr(this,"last_status",{}),Wr(this,"cookies",null),Wr(this,"stream_status",{open:!1}),Wr(this,"pending_stream_messages",{}),Wr(this,"pending_diff_streams",{}),Wr(this,"event_callbacks",{}),Wr(this,"unclosed_events",new Set),Wr(this,"heartbeat_event",null),Wr(this,"abort_controller",null),Wr(this,"stream_instance",null),Wr(this,"current_payload"),Wr(this,"ws_map",{}),Wr(this,"view_api"),Wr(this,"upload_files"),Wr(this,"upload"),Wr(this,"handle_blob"),Wr(this,"post_data"),Wr(this,"submit"),Wr(this,"predict"),Wr(this,"open_stream"),Wr(this,"resolve_config"),Wr(this,"resolve_cookies"),this.app_reference=e,n.events||(n.events=["data"]),this.options=n,this.current_payload={},this.view_api=cdt.bind(this),this.upload_files=ldt.bind(this),this.handle_blob=pdt.bind(this),this.post_data=vdt.bind(this),this.submit=Ddt.bind(this),this.predict=ydt.bind(this),this.open_stream=Mdt.bind(this),this.resolve_config=tdt.bind(this),this.resolve_cookies=ndt.bind(this),this.upload=udt.bind(this),this.fetch=this.fetch.bind(this),this.handle_space_success=this.handle_space_success.bind(this),this.stream=this.stream.bind(this)}get_url_config(e=null){if(!this.config)throw new Error(P_);e===null&&(e=window.location.href);const n=a=>a.replace(/^\/+|\/+$/g,"");let r=n(new URL(this.config.root).pathname),i=n(new URL(e).pathname),s;return i.startsWith(r)?s=n(i.substring(r.length)):s="",this.get_page_config(s)}get_page_config(e){if(!this.config)throw new Error(P_);let n=this.config;return e in n.page||(e=""),{...n,current_page:e,layout:n.page[e].layout,components:n.components.filter(r=>n.page[e].components.includes(r.id)),dependencies:this.config.dependencies.filter(r=>n.page[e].dependencies.includes(r.id))}}fetch(e,n){const r=new Headers((n==null?void 0:n.headers)||{});if(this&&this.cookies&&r.append("Cookie",this.cookies),this&&this.options.headers)for(const i in this.options.headers)r.append(i,this.options.headers[i]);return fetch(e,{...n,headers:r})}stream(e){const n=new Headers;if(this&&this.cookies&&n.append("Cookie",this.cookies),this&&this.options.headers)for(const r in this.options.headers)n.append(r,this.options.headers[r]);return this.abort_controller=new AbortController,this.stream_instance=kdt(e.toString(),{credentials:"include",headers:n,signal:this.abort_controller.signal}),this.stream_instance}async init(){var e;if((typeof window>"u"||!("WebSocket"in window))&&!Qp.WebSocket){const n=await CG(()=>import("./wrapper-CviSselG-CwtK6w9V.js"),[]);Qp.WebSocket=n.WebSocket}this.options.auth&&await this.resolve_cookies(),await this._resolve_config().then(({config:n})=>this._resolve_hearbeat(n)),this.api_info=await this.view_api(),this.api_map=edt(((e=this.config)==null?void 0:e.dependencies)||[])}async _resolve_hearbeat(e){if(e&&(this.config=e,this.api_prefix=e.api_prefix||"",this.config&&this.config.connect_heartbeat&&this.config.space_id&&this.options.hf_token&&(this.jwt=await Vne(this.config.space_id,this.options.hf_token,this.cookies))),e.space_id&&this.options.hf_token&&(this.jwt=await Vne(e.space_id,this.options.hf_token)),this.config&&this.config.connect_heartbeat){const n=new URL(`${this.config.root}${this.api_prefix}/${jht}/${this.session_hash}`);this.jwt&&n.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(n))}}static async connect(e,n={events:["data"]}){const r=new this(e,n);return await r.init(),r}close(){kU(this.stream_status,this.abort_controller)}set_current_payload(e){this.current_payload=e}static async duplicate(e,n={events:["data"]}){return Sdt(e,n)}async _resolve_config(){const{http_protocol:e,host:n,space_id:r}=await W6(this.app_reference,this.options.hf_token),{status_callback:i}=this.options;r&&i&&await Ive(r,i);let s;try{if(s=await this.resolve_config(`${e}//${n}`),!s)throw new Error(P_);return this.config_success(s)}catch(a){if(r&&i)oM(r,xY.test(r)?"space_name":"subdomain",this.handle_space_success);else throw i&&i({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(a)}}async config_success(e){if(this.config=e,this.api_prefix=e.api_prefix||"",typeof window<"u"&&typeof document<"u"&&window.location.protocol==="https:"&&(this.config.root=this.config.root.replace("http://","https://")),this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(n){console.error(Yht+n.message)}return this.prepare_return_obj()}async handle_space_success(e){var n;if(!this)throw new Error(P_);const{status_callback:r}=this.options;if(r&&r(e),e.status==="running")try{if(this.config=await this._resolve_config(),this.api_prefix=((n=this==null?void 0:this.config)==null?void 0:n.api_prefix)||"",!this.config)throw new Error(P_);return await this.config_success(this.config)}catch(i){throw r&&r({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),i}}async component_server(e,n,r){var i;if(!this.config)throw new Error(P_);const s={},{hf_token:a}=this.options,{session_hash:o}=this;a&&(s.Authorization=`Bearer ${this.options.hf_token}`);let c,l=this.config.components.find(h=>h.id===e);(i=l==null?void 0:l.props)!=null&&i.root_url?c=l.props.root_url:c=this.config.root;let u;if("binary"in r){u=new FormData;for(const h in r.data)h!=="binary"&&u.append(h,r.data[h]);u.set("component_id",e.toString()),u.set("fn_name",n),u.set("session_hash",o)}else u=JSON.stringify({data:r,component_id:e,fn_name:n,session_hash:o}),s["Content-Type"]="application/json";a&&(s.Authorization=`Bearer ${a}`);try{const h=await this.fetch(`${c}${this.api_prefix}/${Vht}/`,{method:"POST",body:u,headers:s,credentials:"include"});if(!h.ok)throw new Error("Could not connect to component server: "+h.statusText);return await h.json()}catch(h){console.warn(h)}}set_cookies(e){this.cookies=Mve(e).join("; ")}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}async connect_ws(e){return new Promise((n,r)=>{let i;try{i=new WebSocket(e)}catch{this.ws_map[e]="failed";return}i.onopen=()=>{n()},i.onerror=s=>{console.error("WebSocket error:",s),this.close_ws(e),this.ws_map[e]="failed",n()},i.onclose=()=>{delete this.ws_map[e],this.ws_map[e]="failed"},i.onmessage=s=>{},this.ws_map[e]=i})}async send_ws_message(e,n){e in this.ws_map||await this.connect_ws(e);const r=this.ws_map[e];r instanceof WebSocket?r.send(JSON.stringify(n)):this.post_data(e,n)}async close_ws(e){if(e in this.ws_map){const n=this.ws_map[e];n instanceof WebSocket&&(n.close(),delete this.ws_map[e])}}}function LT(t){"@babel/helpers - typeof";return LT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},LT(t)}function Fd(){Fd=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(V,Z,Y){V[Z]=Y.value},s=typeof Symbol=="function"?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(V,Z,Y){return Object.defineProperty(V,Z,{value:Y,enumerable:!0,configurable:!0,writable:!0}),V[Z]}try{l({},"")}catch{l=function(Y,ee,oe){return Y[ee]=oe}}function u(V,Z,Y,ee){var oe=Z&&Z.prototype instanceof v?Z:v,de=Object.create(oe.prototype),Me=new X(ee||[]);return i(de,"_invoke",{value:U(V,Y,Me)}),de}function h(V,Z,Y){try{return{type:"normal",arg:V.call(Z,Y)}}catch(ee){return{type:"throw",arg:ee}}}e.wrap=u;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",_={};function v(){}function E(){}function T(){}var x={};l(x,a,function(){return this});var N=Object.getPrototypeOf,A=N&&N(N(re([])));A&&A!==n&&r.call(A,a)&&(x=A);var I=T.prototype=v.prototype=Object.create(x);function k(V){["next","throw","return"].forEach(function(Z){l(V,Z,function(Y){return this._invoke(Z,Y)})})}function L(V,Z){function Y(oe,de,Me,He){var Te=h(V[oe],V,de);if(Te.type!=="throw"){var Le=Te.arg,we=Le.value;return we&&LT(we)=="object"&&r.call(we,"__await")?Z.resolve(we.__await).then(function(Ce){Y("next",Ce,Me,He)},function(Ce){Y("throw",Ce,Me,He)}):Z.resolve(we).then(function(Ce){Le.value=Ce,Me(Le)},function(Ce){return Y("throw",Ce,Me,He)})}He(Te.arg)}var ee;i(this,"_invoke",{value:function(de,Me){function He(){return new Z(function(Te,Le){Y(de,Me,Te,Le)})}return ee=ee?ee.then(He,He):He()}})}function U(V,Z,Y){var ee=d;return function(oe,de){if(ee===p)throw Error("Generator is already running");if(ee===g){if(oe==="throw")throw de;return{value:t,done:!0}}for(Y.method=oe,Y.arg=de;;){var Me=Y.delegate;if(Me){var He=$(Me,Y);if(He){if(He===_)continue;return He}}if(Y.method==="next")Y.sent=Y._sent=Y.arg;else if(Y.method==="throw"){if(ee===d)throw ee=g,Y.arg;Y.dispatchException(Y.arg)}else Y.method==="return"&&Y.abrupt("return",Y.arg);ee=p;var Te=h(V,Z,Y);if(Te.type==="normal"){if(ee=Y.done?g:f,Te.arg===_)continue;return{value:Te.arg,done:Y.done}}Te.type==="throw"&&(ee=g,Y.method="throw",Y.arg=Te.arg)}}}function $(V,Z){var Y=Z.method,ee=V.iterator[Y];if(ee===t)return Z.delegate=null,Y==="throw"&&V.iterator.return&&(Z.method="return",Z.arg=t,$(V,Z),Z.method==="throw")||Y!=="return"&&(Z.method="throw",Z.arg=new TypeError("The iterator does not provide a '"+Y+"' method")),_;var oe=h(ee,V.iterator,Z.arg);if(oe.type==="throw")return Z.method="throw",Z.arg=oe.arg,Z.delegate=null,_;var de=oe.arg;return de?de.done?(Z[V.resultName]=de.value,Z.next=V.nextLoc,Z.method!=="return"&&(Z.method="next",Z.arg=t),Z.delegate=null,_):de:(Z.method="throw",Z.arg=new TypeError("iterator result is not an object"),Z.delegate=null,_)}function q(V){var Z={tryLoc:V[0]};1 in V&&(Z.catchLoc=V[1]),2 in V&&(Z.finallyLoc=V[2],Z.afterLoc=V[3]),this.tryEntries.push(Z)}function G(V){var Z=V.completion||{};Z.type="normal",delete Z.arg,V.completion=Z}function X(V){this.tryEntries=[{tryLoc:"root"}],V.forEach(q,this),this.reset(!0)}function re(V){if(V||V===""){var Z=V[a];if(Z)return Z.call(V);if(typeof V.next=="function")return V;if(!isNaN(V.length)){var Y=-1,ee=function oe(){for(;++Y<V.length;)if(r.call(V,Y))return oe.value=V[Y],oe.done=!1,oe;return oe.value=t,oe.done=!0,oe};return ee.next=ee}}throw new TypeError(LT(V)+" is not iterable")}return E.prototype=T,i(I,"constructor",{value:T,configurable:!0}),i(T,"constructor",{value:E,configurable:!0}),E.displayName=l(T,c,"GeneratorFunction"),e.isGeneratorFunction=function(V){var Z=typeof V=="function"&&V.constructor;return!!Z&&(Z===E||(Z.displayName||Z.name)==="GeneratorFunction")},e.mark=function(V){return Object.setPrototypeOf?Object.setPrototypeOf(V,T):(V.__proto__=T,l(V,c,"GeneratorFunction")),V.prototype=Object.create(I),V},e.awrap=function(V){return{__await:V}},k(L.prototype),l(L.prototype,o,function(){return this}),e.AsyncIterator=L,e.async=function(V,Z,Y,ee,oe){oe===void 0&&(oe=Promise);var de=new L(u(V,Z,Y,ee),oe);return e.isGeneratorFunction(Z)?de:de.next().then(function(Me){return Me.done?Me.value:de.next()})},k(I),l(I,c,"Generator"),l(I,a,function(){return this}),l(I,"toString",function(){return"[object Generator]"}),e.keys=function(V){var Z=Object(V),Y=[];for(var ee in Z)Y.push(ee);return Y.reverse(),function oe(){for(;Y.length;){var de=Y.pop();if(de in Z)return oe.value=de,oe.done=!1,oe}return oe.done=!0,oe}},e.values=re,X.prototype={constructor:X,reset:function(Z){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(G),!Z)for(var Y in this)Y.charAt(0)==="t"&&r.call(this,Y)&&!isNaN(+Y.slice(1))&&(this[Y]=t)},stop:function(){this.done=!0;var Z=this.tryEntries[0].completion;if(Z.type==="throw")throw Z.arg;return this.rval},dispatchException:function(Z){if(this.done)throw Z;var Y=this;function ee(Le,we){return Me.type="throw",Me.arg=Z,Y.next=Le,we&&(Y.method="next",Y.arg=t),!!we}for(var oe=this.tryEntries.length-1;oe>=0;--oe){var de=this.tryEntries[oe],Me=de.completion;if(de.tryLoc==="root")return ee("end");if(de.tryLoc<=this.prev){var He=r.call(de,"catchLoc"),Te=r.call(de,"finallyLoc");if(He&&Te){if(this.prev<de.catchLoc)return ee(de.catchLoc,!0);if(this.prev<de.finallyLoc)return ee(de.finallyLoc)}else if(He){if(this.prev<de.catchLoc)return ee(de.catchLoc,!0)}else{if(!Te)throw Error("try statement without catch or finally");if(this.prev<de.finallyLoc)return ee(de.finallyLoc)}}}},abrupt:function(Z,Y){for(var ee=this.tryEntries.length-1;ee>=0;--ee){var oe=this.tryEntries[ee];if(oe.tryLoc<=this.prev&&r.call(oe,"finallyLoc")&&this.prev<oe.finallyLoc){var de=oe;break}}de&&(Z==="break"||Z==="continue")&&de.tryLoc<=Y&&Y<=de.finallyLoc&&(de=null);var Me=de?de.completion:{};return Me.type=Z,Me.arg=Y,de?(this.method="next",this.next=de.finallyLoc,_):this.complete(Me)},complete:function(Z,Y){if(Z.type==="throw")throw Z.arg;return Z.type==="break"||Z.type==="continue"?this.next=Z.arg:Z.type==="return"?(this.rval=this.arg=Z.arg,this.method="return",this.next="end"):Z.type==="normal"&&Y&&(this.next=Y),_},finish:function(Z){for(var Y=this.tryEntries.length-1;Y>=0;--Y){var ee=this.tryEntries[Y];if(ee.finallyLoc===Z)return this.complete(ee.completion,ee.afterLoc),G(ee),_}},catch:function(Z){for(var Y=this.tryEntries.length-1;Y>=0;--Y){var ee=this.tryEntries[Y];if(ee.tryLoc===Z){var oe=ee.completion;if(oe.type==="throw"){var de=oe.arg;G(ee)}return de}}throw Error("illegal catch attempt")},delegateYield:function(Z,Y,ee){return this.delegate={iterator:re(Z),resultName:Y,nextLoc:ee},this.method==="next"&&(this.arg=t),_}},e}function Yne(t,e,n,r,i,s,a){try{var o=t[s](a),c=o.value}catch(l){return void n(l)}o.done?e(c):Promise.resolve(c).then(r,i)}function Aw(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function a(c){Yne(s,r,i,a,o,"next",c)}function o(c){Yne(s,r,i,a,o,"throw",c)}a(void 0)})}}function Udt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bdt(t,e){if(LT(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(LT(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function kve(t){var e=Bdt(t,"string");return LT(e)=="symbol"?e:e+""}function Fdt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kve(r.key),r)}}function zdt(t,e,n){return e&&Fdt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function dg(t,e,n){return(e=kve(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const RP={"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-KatjaNeural","de-DE-KillianNeural"],"en-US":["en-US-AriaNeural","en-US-AnaNeural","en-US-ChristopherNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-YunJheNeural","zh-TW-HsiaoYuNeural"]},AP={"ar-SA-HamedNeural":"حامد","ar-SA-ZariyahNeural":"زارية","de-DE-AmalaNeural":"Amala","de-DE-BerndNeural":"Bernd","de-DE-ChristophNeural":"Christoph","de-DE-ConradNeural":"Conrad","de-DE-ElkeNeural":"Elke","de-DE-GiselaNeural":"Gisela","de-DE-KasperNeural":"Kasper","de-DE-KatjaNeural":"Katja","de-DE-KillianNeural":"Killian","de-DE-KlarissaNeural":"Klarissa","de-DE-KlausNeural":"Klaus","de-DE-LouisaNeural":"Louisa","de-DE-MajaNeural":"Maja","de-DE-RalfNeural":"Ralf","de-DE-TanjaNeural":"Tanja","en-US-AIGenerate1Neural":"AIGenerate1","en-US-AIGenerate2Neural":"AIGenerate2","en-US-AmberNeural":"Amber","en-US-AnaNeural":"Ana","en-US-AndrewNeural":"Andrew","en-US-AriaNeural":"Aria","en-US-AshleyNeural":"Ashley","en-US-BlueNeural":"Blue","en-US-BrandonNeural":"Brandon","en-US-BrianNeural":"Brian","en-US-ChristopherNeural":"Christopher","en-US-CoraNeural":"Cora","en-US-DavisNeural":"Davis","en-US-ElizabethNeural":"Elizabeth","en-US-EmmaNeural":"Emma","en-US-EricNeural":"Eric","en-US-GuyNeural":"Guy","en-US-JacobNeural":"Jacob","en-US-JaneNeural":"Jane","en-US-JasonNeural":"Jason","en-US-JennyMultilingualNeural":"Jenny Multilingual","en-US-JennyMultilingualV2Neural":"Jenny Multilingual V2","en-US-JennyNeural":"Jenny","en-US-MichelleNeural":"Michelle","en-US-MonicaNeural":"Monica","en-US-NancyNeural":"Nancy","en-US-RogerNeural":"Roger","en-US-RyanMultilingualNeural":"Ryan Multilingual","en-US-SaraNeural":"Sara","en-US-SteffanNeural":"Steffan","en-US-TonyNeural":"Tony","es-ES-AbrilNeural":"Abril","es-ES-AlvaroNeural":"Álvaro","es-ES-ArnauNeural":"Arnau","es-ES-DarioNeural":"Dario","es-ES-EliasNeural":"Elias","es-ES-ElviraNeural":"Elvira","es-ES-EstrellaNeural":"Estrella","es-ES-IreneNeural":"Irene","es-ES-LaiaNeural":"Laia","es-ES-LiaNeural":"Lia","es-ES-NilNeural":"Nil","es-ES-SaulNeural":"Saul","es-ES-TeoNeural":"Teo","es-ES-TrianaNeural":"Triana","es-ES-VeraNeural":"Vera","fr-FR-AlainNeural":"Alain","fr-FR-BrigitteNeural":"Brigitte","fr-FR-CelesteNeural":"Celeste","fr-FR-ClaudeNeural":"Claude","fr-FR-CoralieNeural":"Coralie","fr-FR-DeniseNeural":"Denise","fr-FR-EloiseNeural":"Eloise","fr-FR-HenriNeural":"Henri","fr-FR-JacquelineNeural":"Jacqueline","fr-FR-JeromeNeural":"Jerome","fr-FR-JosephineNeural":"Josephine","fr-FR-MauriceNeural":"Maurice","fr-FR-YvesNeural":"Yves","fr-FR-YvetteNeural":"Yvette","ja-JP-AoiNeural":"碧衣","ja-JP-DaichiNeural":"大智","ja-JP-KeitaNeural":"圭太","ja-JP-MayuNeural":"真夕","ja-JP-NanamiNeural":"七海","ja-JP-NaokiNeural":"直紀","ja-JP-ShioriNeural":"志織","ko-KR-BongJinNeural":"봉진","ko-KR-GookMinNeural":"국민","ko-KR-InJoonNeural":"인준","ko-KR-JiMinNeural":"지민","ko-KR-SeoHyeonNeural":"서현","ko-KR-SoonBokNeural":"순복","ko-KR-SunHiNeural":"선히","ko-KR-YuJinNeural":"유진","pt-BR-AntonioNeural":"Antônio","pt-BR-BrendaNeural":"Brenda","pt-BR-DonatoNeural":"Donato","pt-BR-ElzaNeural":"Elza","pt-BR-FabioNeural":"Fabio","pt-BR-FranciscaNeural":"Francisca","pt-BR-GiovannaNeural":"Giovanna","pt-BR-HumbertoNeural":"Humberto","pt-BR-JulioNeural":"Julio","pt-BR-LeilaNeural":"Leila","pt-BR-LeticiaNeural":"Leticia","pt-BR-ManuelaNeural":"Manuela","pt-BR-NicolauNeural":"Nicolau","pt-BR-ValerioNeural":"Valerio","pt-BR-YaraNeural":"Yara","ru-RU-DariyaNeural":"Дария","ru-RU-DmitryNeural":"Дмитрий","ru-RU-SvetlanaNeural":"Светлана","wuu-CN-XiaotongNeural":"晓彤","wuu-CN-YunzheNeural":"云哲","yue-CN-XiaoMinNeural":"晓敏","yue-CN-YunSongNeural":"云松","zh-CN-XiaochenNeural":"晓辰","zh-CN-XiaohanNeural":"晓涵","zh-CN-XiaomengNeural":"晓梦","zh-CN-XiaomoNeural":"晓墨","zh-CN-XiaoqiuNeural":"晓秋","zh-CN-XiaorouNeural":"晓柔","zh-CN-XiaoruiNeural":"晓睿","zh-CN-XiaoshuangNeural":"晓双","zh-CN-XiaoxiaoNeural":"晓晓","zh-CN-XiaoxuanNeural":"晓萱","zh-CN-XiaoyanNeural":"晓颜","zh-CN-XiaoyiNeural":"晓伊","zh-CN-XiaoyouNeural":"晓悠","zh-CN-XiaozhenNeural":"晓甄","zh-CN-YunfengNeural":"云枫","zh-CN-YunhaoNeural":"云皓","zh-CN-YunjianNeural":"云健","zh-CN-YunjieNeural":"云杰","zh-CN-YunxiNeural":"云希","zh-CN-YunxiaNeural":"云夏","zh-CN-YunyangNeural":"云扬","zh-CN-YunyeNeural":"云野","zh-CN-YunzeNeural":"云泽","zh-CN-guangxi-YunqiNeural":"云奇","zh-CN-henan-YundengNeural":"云登","zh-CN-liaoning-XiaobeiNeural":"晓北","zh-CN-liaoning-YunbiaoNeural":"云彪","zh-CN-shaanxi-XiaoniNeural":"晓妮","zh-CN-shandong-YunxiangNeural":"云翔","zh-CN-sichuan-YunxiNeural":"云希","zh-TW-HsiaoChenNeural":"曉臻","zh-TW-HsiaoYuNeural":"曉雨","zh-TW-YunJheNeural":"雲哲"};var Hdt=function(){var t=Aw(Fd().mark(function e(n){var r;return Fd().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=new AudioContext,s.next=3,r.decodeAudioData(n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},e)}));return function(n){return t.apply(this,arguments)}}();function jdt(t){if(Array.isArray(t))return t}function Vdt(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,a,o=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(o.push(r.value),o.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return o}}function Xne(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Dve(t,e){if(t){if(typeof t=="string")return Xne(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xne(t,e):void 0}}function Gdt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CY(t,e){return jdt(t)||Vdt(t,e)||Dve(t,e)||Gdt()}const qdt={"ar-SA":"العربية","de-DE":"Deutsch","en-US":"English","es-ES":"Español","fr-FR":"Français","ja-JP":"日本語","ko-KR":"한국어","pt-BR":"Português","ru-RU":"Русский","zh-CN":"简体中文","zh-TW":"繁體中文"};var $dt=function(){return Object.entries(qdt).map(function(e){var n=CY(e,2),r=n[0],i=n[1];return{label:i,value:r}})};const Pve="%[a-f0-9]{2}",Kne=new RegExp("("+Pve+")|([^%]+?)","gi"),Jne=new RegExp("("+Pve+")+","gi");function MG(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;const n=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],MG(n),MG(r))}function Wdt(t){try{return decodeURIComponent(t)}catch{let e=t.match(Kne)||[];for(let n=1;n<e.length;n++)t=MG(e,n).join(""),e=t.match(Kne)||[];return t}}function Ydt(t){const e={"%FE%FF":"��","%FF%FE":"��"};let n=Jne.exec(t);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{const i=Wdt(n[0]);i!==n[0]&&(e[n[0]]=i)}n=Jne.exec(t)}e["%C2"]="�";const r=Object.keys(e);for(const i of r)t=t.replace(new RegExp(i,"g"),e[i]);return t}function Xdt(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return Ydt(t)}}function Kdt(t,e){const n={};if(Array.isArray(e))for(const r of e){const i=Object.getOwnPropertyDescriptor(t,r);i!=null&&i.enumerable&&Object.defineProperty(n,r,i)}else for(const r of Reflect.ownKeys(t)){const i=Object.getOwnPropertyDescriptor(t,r);if(i.enumerable){const s=t[r];e(r,s,t)&&Object.defineProperty(n,r,i)}}return n}function Lve(t,e){if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t===""||e==="")return[];const n=t.indexOf(e);return n===-1?[]:[t.slice(0,n),t.slice(n+e.length)]}const Jdt=t=>t==null,Zdt=t=>encodeURIComponent(t).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),OG=Symbol("encodeFragmentIdentifier");function Qdt(t){switch(t.arrayFormat){case"index":return e=>(n,r)=>{const i=n.length;return r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sc(e,t),"[",i,"]"].join("")]:[...n,[sc(e,t),"[",sc(i,t),"]=",sc(r,t)].join("")]};case"bracket":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sc(e,t),"[]"].join("")]:[...n,[sc(e,t),"[]=",sc(r,t)].join("")];case"colon-list-separator":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sc(e,t),":list="].join("")]:[...n,[sc(e,t),":list=",sc(r,t)].join("")];case"comma":case"separator":case"bracket-separator":{const e=t.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(r,i)=>i===void 0||t.skipNull&&i===null||t.skipEmptyString&&i===""?r:(i=i===null?"":i,r.length===0?[[sc(n,t),e,sc(i,t)].join("")]:[[r,sc(i,t)].join(t.arrayFormatSeparator)])}default:return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,sc(e,t)]:[...n,[sc(e,t),"=",sc(r,t)].join("")]}}function eft(t){let e;switch(t.arrayFormat){case"index":return(n,r,i)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){i[n]=r;return}i[n]===void 0&&(i[n]={}),i[n][e[1]]=r};case"bracket":return(n,r,i)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"colon-list-separator":return(n,r,i)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"comma":case"separator":return(n,r,i)=>{const s=typeof r=="string"&&r.includes(t.arrayFormatSeparator),a=typeof r=="string"&&!s&&wv(r,t).includes(t.arrayFormatSeparator);r=a?wv(r,t):r;const o=s||a?r.split(t.arrayFormatSeparator).map(c=>wv(c,t)):r===null?r:wv(r,t);i[n]=o};case"bracket-separator":return(n,r,i)=>{const s=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!s){i[n]=r&&wv(r,t);return}const a=r===null?[]:wv(r,t).split(t.arrayFormatSeparator);if(i[n]===void 0){i[n]=a;return}i[n]=[...i[n],...a]};default:return(n,r,i)=>{if(i[n]===void 0){i[n]=r;return}i[n]=[...[i[n]].flat(),r]}}}function Uve(t){if(typeof t!="string"||t.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function sc(t,e){return e.encode?e.strict?Zdt(t):encodeURIComponent(t):t}function wv(t,e){return e.decode?Xdt(t):t}function Bve(t){return Array.isArray(t)?t.sort():typeof t=="object"?Bve(Object.keys(t)).sort((e,n)=>Number(e)-Number(n)).map(e=>t[e]):t}function Fve(t){const e=t.indexOf("#");return e!==-1&&(t=t.slice(0,e)),t}function tft(t){let e="";const n=t.indexOf("#");return n!==-1&&(e=t.slice(n)),e}function Zne(t,e,n){return n==="string"&&typeof t=="string"?t:typeof n=="function"&&typeof t=="string"?n(t):e.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")?t.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?Number(t):t}function RY(t){t=Fve(t);const e=t.indexOf("?");return e===-1?"":t.slice(e+1)}function AY(t,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...e},Uve(e.arrayFormatSeparator);const n=eft(e),r=Object.create(null);if(typeof t!="string"||(t=t.trim().replace(/^[?#&]/,""),!t))return r;for(const i of t.split("&")){if(i==="")continue;const s=e.decode?i.replaceAll("+"," "):i;let[a,o]=Lve(s,"=");a===void 0&&(a=s),o=o===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?o:wv(o,e),n(wv(a,e),o,r)}for(const[i,s]of Object.entries(r))if(typeof s=="object"&&s!==null&&e.types[i]!=="string")for(const[a,o]of Object.entries(s)){const c=e.types[i]?e.types[i].replace("[]",""):void 0;s[a]=Zne(o,e,c)}else typeof s=="object"&&s!==null&&e.types[i]==="string"?r[i]=Object.values(s).join(e.arrayFormatSeparator):r[i]=Zne(s,e,e.types[i]);return e.sort===!1?r:(e.sort===!0?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce((i,s)=>{const a=r[s];return i[s]=a&&typeof a=="object"&&!Array.isArray(a)?Bve(a):a,i},Object.create(null))}function zve(t,e){if(!t)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},Uve(e.arrayFormatSeparator);const n=a=>e.skipNull&&Jdt(t[a])||e.skipEmptyString&&t[a]==="",r=Qdt(e),i={};for(const[a,o]of Object.entries(t))n(a)||(i[a]=o);const s=Object.keys(i);return e.sort!==!1&&s.sort(e.sort),s.map(a=>{const o=t[a];return o===void 0?"":o===null?sc(a,e):Array.isArray(o)?o.length===0&&e.arrayFormat==="bracket-separator"?sc(a,e)+"[]":o.reduce(r(a),[]).join("&"):sc(a,e)+"="+sc(o,e)}).filter(a=>a.length>0).join("&")}function Hve(t,e){var i;e={decode:!0,...e};let[n,r]=Lve(t,"#");return n===void 0&&(n=t),{url:((i=n==null?void 0:n.split("?"))==null?void 0:i[0])??"",query:AY(RY(t),e),...e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:wv(r,e)}:{}}}function jve(t,e){e={encode:!0,strict:!0,[OG]:!0,...e};const n=Fve(t.url).split("?")[0]||"",r=RY(t.url),i={...AY(r,{sort:!1}),...t.query};let s=zve(i,e);s&&(s=`?${s}`);let a=tft(t.url);if(typeof t.fragmentIdentifier=="string"){const o=new URL(n);o.hash=t.fragmentIdentifier,a=e[OG]?o.hash:`#${t.fragmentIdentifier}`}return`${n}${s}${a}`}function Vve(t,e,n){n={parseFragmentIdentifier:!0,[OG]:!1,...n};const{url:r,query:i,fragmentIdentifier:s}=Hve(t,n);return jve({url:r,query:Kdt(i,e),fragmentIdentifier:s},n)}function nft(t,e,n){const r=Array.isArray(e)?i=>!e.includes(i):(i,s)=>!e(i,s);return Vve(t,r,n)}const rft=Object.freeze(Object.defineProperty({__proto__:null,exclude:nft,extract:RY,parse:AY,parseUrl:Hve,pick:Vve,stringify:zve,stringifyUrl:jve},Symbol.toStringTag,{value:"Module"}));var Al=[];for(var JH=0;JH<256;++JH)Al.push((JH+256).toString(16).slice(1));function ift(t,e=0){return(Al[t[e+0]]+Al[t[e+1]]+Al[t[e+2]]+Al[t[e+3]]+"-"+Al[t[e+4]]+Al[t[e+5]]+"-"+Al[t[e+6]]+Al[t[e+7]]+"-"+Al[t[e+8]]+Al[t[e+9]]+"-"+Al[t[e+10]]+Al[t[e+11]]+Al[t[e+12]]+Al[t[e+13]]+Al[t[e+14]]+Al[t[e+15]]).toLowerCase()}var MD,sft=new Uint8Array(16);function aft(){if(!MD&&(MD=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!MD))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return MD(sft)}var oft=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Qne={randomUUID:oft};function cft(t,e,n){if(Qne.randomUUID&&!e&&!t)return Qne.randomUUID();t=t||{};var r=t.random||(t.rng||aft)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ift(r)}var lft=function(e,n){var r=n.voice;return'<voice name="'.concat(r,'">').concat(e,"</voice>")},uft=function(e,n){var r=n.style;return r?'<mstts:express-as style="'.concat(r,'">').concat(e,"</mstts:express-as>"):e},hft=function(e,n){var r=n.pitch,i=n.rate;return!r&&!i?e:'<prosody pitch="'.concat(Math.floor((r||1)*100),'%" rate="').concat(Math.floor((i||1)*100),'%">').concat(e,"</prosody>")},dft=function(e){return'<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="en-US">'.concat(e,"</speak>")},fft=function(e,n){var r=hft(e,n);return r=uft(r,n),r=lft(r,n),r=dft(r),r},ere=function(e,n){for(var r=[],i=0,s=Object.entries(e);i<s.length;i++){var a=CY(s[i],2),o=a[0],c=a[1];r.push("".concat(o,":").concat(c))}return r.push("",n),r.join(`\r
`)};function pft(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Dve(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return a=l.done,l},e:function(l){o=!0,s=l},f:function(){try{a||n.return==null||n.return()}finally{if(o)throw s}}}}var mft=function(e){var n={},r=pft(e.slice(0,e.indexOf(`\r
\r
`)).split(`\r
`)),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,a=s.split(":",2),o=CY(a,2),c=o[0],l=o[1];n[c]=l}}catch(u){r.e(u)}finally{r.f()}return{data:e.slice(e.indexOf(`\r
\r
`)+4),headers:n}},gft="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",vft="6A5AA1D4EAFF4E9FB37E23D68491D6F4",yft=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),_ft=function(e){var n=new Date().toString(),r={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":n},i={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":e,"X-Timestamp":n};return{configHeader:r,contentHeader:i}},Gve=function(){var t=Aw(Fd().mark(function e(n){var r,i,s,a,o,c,l,u,h,d,f,p,g,_=arguments;return Fd().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return r=n.payload,i=_.length>1&&_[1]!==void 0?_[1]:{},s=i.proxyUrl,a=i.token,o=r.input,c=r.options,l=cft().replaceAll("-",""),u=rft.stringifyUrl({query:{ConnectionId:l,TrustedClientToken:a||vft},url:s||gft}),h=_ft(l),d=h.configHeader,f=h.contentHeader,p=ere(d,yft),g=ere(f,fft(o,c)),E.abrupt("return",new Promise(function(T,x){var N=new WebSocket(u);N.binaryType="arraybuffer";var A=function(){N.send(p),N.send(g)},I=new ArrayBuffer(0),k=function(){var U=Aw(Fd().mark(function $(q){var G,X,re,V,Z,Y,ee,oe;return Fd().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:if(typeof q.data!="string"){Me.next=13;break}G=mft(q.data),X=G.headers,Me.t0=X.Path,Me.next=Me.t0==="turn.end"?5:11;break;case 5:if(N.close(),I.byteLength){Me.next=8;break}return Me.abrupt("return");case 8:return re=new Response(I),T(re),Me.abrupt("break",11);case 11:Me.next=14;break;case 13:q.data instanceof ArrayBuffer&&(V=new DataView(q.data),Z=V.getInt16(0),q.data.byteLength>Z+2&&(Y=q.data.slice(2+Z),ee=new ArrayBuffer(I.byteLength+Y.byteLength),oe=new Uint8Array(ee),oe.set(new Uint8Array(I),0),oe.set(new Uint8Array(Y),I.byteLength),I=ee));case 14:case"end":return Me.stop()}},$)}));return function(q){return U.apply(this,arguments)}}(),L=function(){x(new Error("WebSocket error occurred.")),N.close()};N.addEventListener("open",A),N.addEventListener("message",k),N.addEventListener("error",L)}));case 9:case"end":return E.stop()}},e)}));return function(n){return t.apply(this,arguments)}}(),bft=function(e){var n=e&&RP[e]?RP[e]||[]:$h(Object.values(RP));return n.map(function(r){return{label:(AP==null?void 0:AP[r])||r,value:r}})},RI=function(){function t(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.serviceUrl,i=n.locale,s=n.headers;Udt(this,t),dg(this,"locale",void 0),dg(this,"serviceUrl",void 0),dg(this,"headers",void 0),dg(this,"fetch",function(){var a=Aw(Fd().mark(function o(c){var l;return Fd().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.serviceUrl?fetch(e.serviceUrl,{body:JSON.stringify(c),headers:e.headers,method:"POST"}):Gve({payload:c});case 2:return l=h.sent,h.abrupt("return",l);case 4:case"end":return h.stop()}},o)}));return function(o){return a.apply(this,arguments)}}()),dg(this,"create",function(){var a=Aw(Fd().mark(function o(c){return Fd().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",e.fetch(c));case 1:case"end":return u.stop()}},o)}));return function(o){return a.apply(this,arguments)}}()),dg(this,"createAudio",function(){var a=Aw(Fd().mark(function o(c){var l,u;return Fd().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,e.create(c);case 2:return l=d.sent,d.next=5,l.arrayBuffer();case 5:return u=d.sent,d.abrupt("return",Hdt(u));case 7:case"end":return d.stop()}},o)}));return function(o){return a.apply(this,arguments)}}()),this.locale=i,this.serviceUrl=r,this.headers=s}return zdt(t,[{key:"voiceOptions",get:function(){return bft(this.locale)}}]),t}();dg(RI,"localeOptions",$dt());dg(RI,"voiceList",RP);dg(RI,"voiceName",AP);dg(RI,"createRequest",Gve);let ZH;async function Eft(t,e){if(!ae(t))return;ae(ZH)||(ZH=new RI({locale:"en-US"}));const[n,r]=e,i=await ZH.createAudio({input:r,options:{voice:n||"en-US-GuyNeural"}});t.addttsaudiobuffer(i)}const tre=new Map;async function Sft(t,e,n){var s,a;if(!ae(e))return;const[r]=n,i=tre.get(r);if(ae(i))i.loaded&&e.addttsaudiobuffer(i);else{const c=await(await AG.connect("declare-lab/TangoFlux")).predict("/predict",[r,25,4.5,3]);if(Lr(c.data)&&On((s=c.data[0])==null?void 0:s.url)){const l=(a=c.data[0])==null?void 0:a.url;tre.set(r,new Ps(l,()=>{Fg(Ge,t,"loaded",`${l.substring(0,8)}...${l.slice(-8)}`)}))}}}const Tft=Date.now(),Of={get value(){return(Date.now()-Tft)/1e3%1e6}},xft=120;let qve=0;function MY(t){qve=xft/t,EY().bpm.value=t}MY(150);const Y6={get value(){return qve}};function X6(t){const e=t.clone();return e.uniforms.time=Of,e.uniforms.interval=Y6,e}dve(new uR({latencyHint:"playback"}));pht().catch(t=>{Hr(Ov,ni(),"audio",t.message)});let MP=!1;function sE(){MP||Vut().then(()=>{if(!MP){const t=EY();MP=!0,t.start(),Fg(Ov,ni(),"audio is enabled!"),MY(107);try{const e=navigator;ae(e.audioSession)&&(e.audioSession.type="playback")}catch{}kDe(Ov,ni())}}).catch(t=>{Hr(Ov,ni(),"audio",t.message)})}let Hu,nre="";function wft(){return Hu==null?void 0:Hu.broadcastdestination}const Ov=Wb("synth",[],t=>{if(Ov.session(t)&&(MP&&!ae(Hu)&&(Hu=vht()),!!ae(Hu)))switch(t.target){case"audioenabled":qu(Ov,t.player,async()=>{await Gp(1e3),Ag(Ov,t.player,void 0,"text","audioenabled","")});break;case"bpm":pn(t.data)&&MY(t.data);break;case"playvolume":pn(t.data)&&Hu.setplayvolume(t.data);break;case"bgplayvolume":pn(t.data)&&Hu.setbgplayvolume(t.data);break;case"ttsvolume":pn(t.data)&&Hu.setttsvolume(t.data);break;case"focus":On(t.data)&&(nre=t.data);break;case"play":if(Lr(t.data)){const[e,n,r]=t.data;if(e&&e!==nre)return;n.trim()===""?Hu.stopplay():Hu.addplay(n,r)}break;case"voice":if(Lr(t.data)){const[e,n,r]=t.data;Eht(t.player,Hu,e,n,r)}break;case"voicefx":if(Lr(t.data)){const[e,n,r,i]=t.data;Aht(t.player,Hu,e,n,r,i)}break;case"tts":qu(Ov,t.player,async()=>{Lr(t.data)&&await Eft(Hu,t.data)});break;case"tta":qu(Ov,t.player,async()=>{Lr(t.data)&&await Sft(t.player,Hu,t.data)});break}});function IO(){return IO=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},IO.apply(null,arguments)}var Cft=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*e*i)/n)},Rft=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function Kv(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Rft,o=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(t.__damp===void 0&&(t.__damp={}),t.__damp[c]===void 0&&(t.__damp[c]=0),Math.abs(t[e]-n)<=o)return t[e]=n,!1;r=Math.max(1e-4,r);var l=2/r,u=a(l*i),h=t[e]-n,d=n,f=s*r;h=Math.min(Math.max(h,-f),f),n=t[e]-h;var p=(t.__damp[c]+l*h)*i;t.__damp[c]=(t.__damp[c]-l*p)*u;var g=n+(h+p)*u;return d-t[e]>0==g>d&&(g=d,t.__damp[c]=(g-d)/i),t[e]=g,!0}function QH(t,e,n,r,i,s,a,o){return Kv(t,e,t[e]+Fke(t[e],n),r,i,s,a,o)}var v1=new Re,rre,ire,sre;function DU(t,e,n,r,i,s,a){return typeof e=="number"?v1.setScalar(e):Array.isArray(e)?v1.set(e[0],e[1],e[2]):v1.copy(e),rre=Kv(t,"x",v1.x,n,r,i,s,a),ire=Kv(t,"y",v1.y,n,r,i,s,a),sre=Kv(t,"z",v1.z,n,r,i,s,a),rre||ire||sre}var sA=new Xh,are,ore,cre;function Aft(t,e,n,r,i,s,a){return Array.isArray(e)?sA.set(e[0],e[1],e[2],e[3]):sA.copy(e),are=QH(t,"x",sA.x,n,r,i,s,a),ore=QH(t,"y",sA.y,n,r,i,s,a),cre=QH(t,"z",sA.z,n,r,i,s,a),are||ore||cre}const lre=t=>Symbol.iterator in t,ure=t=>"entries"in t,hre=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[i,s]of n)if(!Object.is(s,r.get(i)))return!1;return!0},Mft=(t,e)=>{const n=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done};function Oft(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!lre(t)||!lre(e)?hre({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):ure(t)&&ure(e)?hre(t,e):Mft(t,e)}function up(t){const e=xg.useRef();return n=>{const r=t(n);return Oft(e.current,r)?e.current:e.current=r}}function OY(t,e,n){const r=Zu(d=>d.size),i=Zu(d=>d.viewport),s=typeof t=="number"?t:r.width*i.dpr,a=typeof e=="number"?e:r.height*i.dpr,o=(typeof t=="number"?n:t)||{},{samples:c=0,depth:l,...u}=o,h=Be.useMemo(()=>{const d=new Ul(s,a,{minFilter:_a,magFilter:_a,type:Bb,...u});return l&&(d.depthTexture=new UC(s,a,ru)),d.samples=c,d},[]);return Be.useLayoutEffect(()=>{h.setSize(s,a),c&&(h.samples=c)},[c,h,s,a]),Be.useEffect(()=>()=>h.dispose(),[]),h}const Nft=t=>typeof t=="function",Ift=Be.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,children:r,makeDefault:i,...s},a)=>{const o=Zu(({set:_})=>_),c=Zu(({camera:_})=>_),l=Zu(({size:_})=>_),u=Be.useRef(null);Be.useImperativeHandle(a,()=>u.current,[]);const h=Be.useRef(null),d=OY(e);Be.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[l,s]),Be.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),Be.useLayoutEffect(()=>{if(i){const _=c;return o(()=>({camera:u.current})),()=>o(()=>({camera:_}))}},[u,i,o]);let f=0,p=null;const g=Nft(r);return fy(_=>{g&&(n===1/0||f<n)&&(h.current.visible=!1,_.gl.setRenderTarget(d),p=_.scene.background,t&&(_.scene.background=t),_.gl.render(_.scene,u.current),_.scene.background=p,_.gl.setRenderTarget(null),h.current.visible=!0,f++)}),Be.createElement(Be.Fragment,null,Be.createElement("orthographicCamera",IO({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},s),!g&&r),Be.createElement("group",{ref:h},g&&r(d.texture)))}),kft=t=>typeof t=="function",Dft=Be.forwardRef(({envMap:t,resolution:e=256,frames:n=1/0,makeDefault:r,children:i,...s},a)=>{const o=Zu(({set:_})=>_),c=Zu(({camera:_})=>_),l=Zu(({size:_})=>_),u=Be.useRef(null);Be.useImperativeHandle(a,()=>u.current,[]);const h=Be.useRef(null),d=OY(e);Be.useLayoutEffect(()=>{s.manual||(u.current.aspect=l.width/l.height)},[l,s]),Be.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let f=0,p=null;const g=kft(i);return fy(_=>{g&&(n===1/0||f<n)&&(h.current.visible=!1,_.gl.setRenderTarget(d),p=_.scene.background,t&&(_.scene.background=t),_.gl.render(_.scene,u.current),_.scene.background=p,_.gl.setRenderTarget(null),h.current.visible=!0,f++)}),Be.useLayoutEffect(()=>{if(r){const _=c;return o(()=>({camera:u.current})),()=>o(()=>({camera:_}))}},[u,r,o]),Be.createElement(Be.Fragment,null,Be.createElement("perspectiveCamera",IO({ref:u},s),!g&&i),Be.createElement("group",{ref:h},g&&i(d.texture)))});var $ve={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ll,function(){var n=function(){function r(f){return a.appendChild(f.dom),f}function i(f){for(var p=0;p<a.children.length;p++)a.children[p].style.display=p===f?"block":"none";s=f}var s=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(f){f.preventDefault(),i(++s%a.children.length)},!1);var o=(performance||Date).now(),c=o,l=0,u=r(new n.Panel("FPS","#0ff","#002")),h=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:a,addPanel:r,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){l++;var f=(performance||Date).now();if(h.update(f-o,200),f>c+1e3&&(u.update(1e3*l/(f-c),100),c=f,l=0,d)){var p=performance.memory;d.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return f},update:function(){o=this.end()},domElement:a,setMode:i}};return n.Panel=function(r,i,s){var a=1/0,o=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,d=3*l,f=2*l,p=3*l,g=15*l,_=74*l,v=30*l,E=document.createElement("canvas");E.width=u,E.height=h,E.style.cssText="width:80px;height:48px";var T=E.getContext("2d");return T.font="bold "+9*l+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=s,T.fillRect(0,0,u,h),T.fillStyle=i,T.fillText(r,d,f),T.fillRect(p,g,_,v),T.fillStyle=s,T.globalAlpha=.9,T.fillRect(p,g,_,v),{dom:E,update:function(x,N){a=Math.min(a,x),o=Math.max(o,x),T.fillStyle=s,T.globalAlpha=1,T.fillRect(0,0,u,g),T.fillStyle=i,T.fillText(c(x)+" "+r+" ("+c(a)+"-"+c(o)+")",d,f),T.drawImage(E,p+l,g,_-l,v,p,g,_-l,v),T.fillRect(p+_-l,g,l,v),T.fillStyle=s,T.globalAlpha=.9,T.fillRect(p+_-l,g,l,c((1-x/N)*v))}}},n})})($ve);var Pft=$ve.exports;const Lft=qc(Pft);function ej(t,e,n,r){return new(n||(n=Promise))(function(i,s){function a(l){try{c(r.next(l))}catch(u){s(u)}}function o(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(h){h(u)})).then(a,o)}c((r=r.apply(t,[])).next())})}const Uft=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function dre(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Wve=typeof window>"u",cg=(()=>{if(Wve)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function Bft(t,e,n){if(!n)return[e];const r=function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,d=l.createShader(35633),f=l.createShader(35632),p=l.createProgram();if(!(f&&d&&p))return;l.shaderSource(d,u),l.shaderSource(f,h),l.compileShader(d),l.compileShader(f),l.attachShader(p,d),l.attachShader(p,f),l.linkProgram(p),l.detachShader(p,d),l.detachShader(p,f),l.deleteShader(d),l.deleteShader(f),l.useProgram(p);const g=l.createBuffer();l.bindBuffer(34962,g),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const _=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(_,3,5126,!1,0,0),l.enableVertexAttribArray(_),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const v=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,v),l.deleteProgram(p),l.deleteBuffer(g),v.join("")}(t),i="801621810",s="8016218135",a="80162181161",o=cg!=null&&cg.isIpad?[["a7",a,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",a,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=o.filter(([,,l])=>l>=14):(c=o.filter(([,l])=>l===r),c.length||(c=o)),c.map(([l])=>`apple ${l} gpu`)}class fre extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const tj=[],pre=[];function Fft(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,a=0;for(;a<r&&t.charCodeAt(a)===e.charCodeAt(a);)a++;if(r-=a,i-=a,r===0)return i;let o,c,l=0,u=0,h=0;for(;u<r;)pre[u]=t.charCodeAt(a+u),tj[u]=++u;for(;h<i;)for(s=e.charCodeAt(a+h),o=h++,l=h,u=0;u<r;u++)c=s===pre[u]?o:o+1,o=tj[u],l=tj[u]=o>l?c>l?l+1:c:c>o?o+1:c;return l}function zft(t){return t!=null}const Hft=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.56/dist/benchmarks"}={})=>ej(void 0,void 0,void 0,function*(){const a={};if(Wve)return{tier:0,type:"SSR"};const{isIpad:o=!!(cg!=null&&cg.isIpad),isMobile:c=!!(cg!=null&&cg.isMobile),screenSize:l=window.screen,loadBenchmarks:u=N=>ej(void 0,void 0,void 0,function*(){const A=yield fetch(`${s}/${N}`).then(I=>I.json());if(parseInt(A.shift().split(".")[0],10)<4)throw new fre("Detect GPU benchmark data is out of date. Please update to version 4x");return A})}=n;let{renderer:h}=n;const d=(N,A,I,k,L)=>({device:L,fps:k,gpu:I,isMobile:c,tier:N,type:A});let f,p="";if(h)h=dre(h),f=[h];else{const N=r||function(I,k=!1){const L={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:k,powerPreference:"high-performance",stencil:!1};I&&delete L.powerPreference;const U=window.document.createElement("canvas"),$=U.getContext("webgl",L)||U.getContext("experimental-webgl",L);return $??void 0}(cg==null?void 0:cg.isSafari12,i);if(!N)return d(0,"WEBGL_UNSUPPORTED");const A=cg!=null&&cg.isFirefox?null:N.getExtension("WEBGL_debug_renderer_info");if(h=A?N.getParameter(A.UNMASKED_RENDERER_WEBGL):N.getParameter(N.RENDERER),!h)return d(1,"FALLBACK");p=h,h=dre(h),f=function(I,k,L){return k==="apple gpu"?Bft(I,k,L):[k]}(N,h,c)}const g=(yield Promise.all(f.map(function(N){var A;return ej(this,void 0,void 0,function*(){const I=(He=>{const Te=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const Le of Te)if(He.includes(Le))return Le})(N);if(!I)return;const k=`${c?"m":"d"}-${I}${o?"-ipad":""}.json`,L=a[k]=(A=a[k])!==null&&A!==void 0?A:u(k);let U;try{U=yield L}catch(He){if(He instanceof fre)throw He;return}const $=function(He){var Te;const Le=(He=He.replace(/\([^)]+\)/,"")).match(/\d+/)||He.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(Te=Le==null?void 0:Le.join("").replace(/\W|amd/g,""))!==null&&Te!==void 0?Te:""}(N);let q=U.filter(([,He])=>He===$);q.length||(q=U.filter(([He])=>He.includes(N)));const G=q.length;if(G===0)return;const X=N.split(/[.,()\[\]/\s]/g).sort().filter((He,Te,Le)=>Te===0||He!==Le[Te-1]).join(" ");let re,[V,,,,Z]=G>1?q.map(He=>[He,Fft(X,He[2])]).sort(([,He],[,Te])=>He-Te)[0][0]:q[0],Y=Number.MAX_VALUE;const{devicePixelRatio:ee}=window,oe=l.width*ee*l.height*ee;for(const He of Z){const[Te,Le]=He,we=Te*Le,Ce=Math.abs(oe-we);Ce<Y&&(Y=Ce,re=He)}if(!re)return;const[,,de,Me]=re;return[Y,de,V,Me]})}))).filter(zft).sort(([N=Number.MAX_VALUE,A],[I=Number.MAX_VALUE,k])=>N===I?A-k:N-I);if(!g.length){const N=Uft.find(A=>h.includes(A));return N?d(0,"BLOCKLISTED",N):d(1,"FALLBACK",`${h} (${p})`)}const[,_,v,E]=g[0];if(_===-1)return d(0,"BLOCKLISTED",v,_,E);const T=c?t:e;let x=0;for(let N=0;N<T.length;N++)_>=T[N]&&(x=N);return d(x,"BENCHMARK",v,_,E)}),jft=t=>lOe(()=>Hft(t),["useDetectGPU"]),Vft=Be.forwardRef(({children:t,compute:e,width:n,height:r,samples:i=8,renderPriority:s=0,eventPriority:a=0,frames:o=1/0,stencilBuffer:c=!1,depthBuffer:l=!0,generateMipmaps:u=!1,...h},d)=>{const{size:f,viewport:p}=Zu(),g=OY((n||f.width)*p.dpr,(r||f.height)*p.dpr,{samples:i,stencilBuffer:c,depthBuffer:l,generateMipmaps:u}),[_]=Be.useState(()=>new Hw),v=Be.useCallback((E,T,x)=>{var N,A;let I=(N=g.texture)==null||(N=N.__r3f.parent)==null?void 0:N.object;for(;I&&!(I instanceof Gi);){var k;I=(k=I.__r3f.parent)==null?void 0:k.object}if(!I)return!1;x.raycaster.camera||x.events.compute(E,x,(A=x.previousRoot)==null?void 0:A.getState());const[L]=x.raycaster.intersectObject(I);if(!L)return!1;const U=L.uv;if(!U)return!1;T.raycaster.setFromCamera(T.pointer.set(U.x*2-1,U.y*2-1),T.camera)},[]);return Be.useImperativeHandle(d,()=>g.texture,[g]),Be.createElement(Be.Fragment,null,HOe(Be.createElement(Gft,{renderPriority:s,frames:o,fbo:g},t,Be.createElement("group",{onPointerOver:()=>null})),_,{events:{compute:e||v,priority:a}}),Be.createElement("primitive",IO({object:g.texture},h)))});function Gft({frames:t,renderPriority:e,children:n,fbo:r}){let i=0,s,a,o,c;return fy(l=>{(t===1/0||i<t)&&(s=l.gl.autoClear,a=l.gl.xr.enabled,o=l.gl.getRenderTarget(),c=l.gl.xr.isPresenting,l.gl.autoClear=!0,l.gl.xr.enabled=!1,l.gl.xr.isPresenting=!1,l.gl.setRenderTarget(r),l.gl.render(l.scene,l.camera),l.gl.setRenderTarget(o),l.gl.autoClear=s,l.gl.xr.enabled=a,l.gl.xr.isPresenting=c,i++)},e),Be.createElement(Be.Fragment,null,n)}/**
 * postprocessing v6.37.3 build Sun Apr 27 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rüschen
 * @license Zlib
 */var nj=1/1e3,qft=1e3,$ft=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*nj}get fixedDelta(){return this._fixedDelta*nj}set fixedDelta(t){this._fixedDelta=t*qft}get elapsed(){return this._elapsed*nj}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(t!==void 0?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Wft=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new Qr;return n.setAttribute("position",new ii(t,3)),n.setAttribute("uv",new ii(e,2)),n})(),_m=class NG{static get fullscreenGeometry(){return Wft}constructor(e="Pass",n=new Hw,r=new eN){this.name=e,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;n!==null?n.material=e:(n=new Bo(NG.fullscreenGeometry,e),n.frustumCulled=!1,this.scene===null&&(this.scene=new Hw),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,n=Fb){}render(e,n,r,i,s){throw new Error("Render method not implemented!")}setSize(e,n){}initialize(e,n,r){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof Ul||n instanceof yl||n instanceof Pa||n instanceof NG)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},Yft=class extends _m{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,r,i){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Xft=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,Kft="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Jft=class extends Bc{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Yr(null),opacity:new Yr(1)},blending:Zf,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Xft,vertexShader:Kft})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},Zft=class extends _m{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new Jft,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Ul(1,1,{minFilter:_a,magFilter:_a,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,r,i){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==gl?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t!==null&&t.outputColorSpace===ya&&(this.renderTarget.texture.colorSpace=ya))}},mre=new _n,Yve=class extends _m{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,r,i){const s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),c=s!==null,l=a>=0;c?(t.getClearColor(mre),t.setClearColor(s,l?a:o)):l&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),c?t.setClearColor(mre,o):l&&t.setClearAlpha(o)}},Qft=class extends _m{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new Yve(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,r,i){const s=t.getContext(),a=t.state.buffers,o=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(t,null):(l.render(t,e),l.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,c)):(t.setRenderTarget(e),t.render(o,c),t.setRenderTarget(n),t.render(o,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},ept=class{constructor(t=null,{depthBuffer:e=!0,stencilBuffer:n=!1,multisampling:r=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,n,i,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Zft,this.depthTexture=null,this.passes=[],this.timer=new $ft,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const e=this.inputBuffer,n=this.multisampling;n>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):n!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){const e=t.getSize(new Rt),n=t.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===gl&&t.outputColorSpace===ya&&(this.inputBuffer.texture.colorSpace=ya,this.outputBuffer.texture.colorSpace=ya,this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(e.width,e.height);for(const i of this.passes)i.initialize(t,n,r)}}replaceRenderer(t,e=!0){const n=this.renderer,r=n.domElement.parentNode;return this.setRenderer(t),e&&r!==null&&(r.removeChild(n.domElement),r.appendChild(t.domElement)),n}createDepthTexture(){const t=this.depthTexture=new UC;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=iT,t.type=rT):t.type=Ug,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,n,r){const i=this.renderer,s=i===null?new Rt:i.getDrawingBufferSize(new Rt),a={minFilter:_a,magFilter:_a,stencilBuffer:e,depthBuffer:t,type:n},o=new Ul(s.width,s.height,a);return r>0&&(o.ignoreDepthForMultisampleCopy=!1,o.samples=r),n===gl&&i!==null&&i.outputColorSpace===ya&&(o.texture.colorSpace=ya),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}setMainScene(t){for(const e of this.passes)e.mainScene=t}setMainCamera(t){for(const e of this.passes)e.mainCamera=t}addPass(t,e){const n=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new Rt),s=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(t.setRenderer(r),t.setSize(i.width,i.height),t.initialize(r,s,a),this.autoRenderToScreen&&(n.length>0&&(n[n.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?n.splice(e,0,t):n.push(t),this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const o=this.createDepthTexture();for(t of n)t.setDepthTexture(o)}else t.setDepthTexture(this.depthTexture)}removePass(t){const e=this.passes,n=e.indexOf(t);if(n!==-1&&e.splice(n,1).length>0){if(this.depthTexture!==null){const s=(o,c)=>o||c.needsDepthTexture;e.reduce(s,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&n===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const e=this.renderer,n=this.copyPass;let r=this.inputBuffer,i=this.outputBuffer,s=!1,a,o,c;t===void 0&&(this.timer.update(),t=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(e,r,i,t,s),l.needsSwap&&(s&&(n.renderToScreen=l.renderToScreen,a=e.getContext(),o=e.state.buffers.stencil,o.setFunc(a.NOTEQUAL,1,4294967295),n.render(e,r,i,t,s),o.setFunc(a.EQUAL,1,4294967295)),c=r,r=i,i=c),l instanceof Qft?s=!0:l instanceof Yft&&(s=!1))}setSize(t,e,n){const r=this.renderer,i=r.getSize(new Rt);(t===void 0||e===void 0)&&(t=i.width,e=i.height),(i.width!==t||i.height!==e)&&r.setSize(t,e,n);const s=r.getDrawingBufferSize(new Rt);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height);for(const a of this.passes)a.setSize(s.width,s.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),_m.fullscreenGeometry.dispose()}},yb={NONE:0,DEPTH:1,CONVOLUTION:2},ss={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},tpt=class{constructor(){this.shaderParts=new Map([[ss.FRAGMENT_HEAD,null],[ss.FRAGMENT_MAIN_UV,null],[ss.FRAGMENT_MAIN_IMAGE,null],[ss.VERTEX_HEAD,null],[ss.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=yb.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Bg}},rj=!1,gre=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let n;if(e.material.flatShading)switch(e.material.side){case ll:n=this.materialsFlatShadedDoubleSide;break;case Pc:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(e.material.side){case ll:n=this.materialsDoubleSide;break;case Pc:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof Bc))return t.clone();const e=t.uniforms,n=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,n.set(i,s))}const r=t.clone();for(const i of n)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=Lg;e[2].skinning=!0,this.materialsBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=Pc,r}),this.materialsDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=ll,r}),this.materialsFlatShaded=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=Pc,r}),this.materialsFlatShadedDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=ll,r})}}render(t,e,n){const r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,rj){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return rj}static set workaroundEnabled(t){rj=t}},m_=-1,Mw=class extends Zd{constructor(t,e=m_,n=m_,r=1){super(),this.resizable=t,this.baseSize=new Rt(1,1),this.preferredSize=new Rt(e,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Rt,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,r=this.scale;e.width!==m_?n.width=e.width:e.height!==m_?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*r),e.height!==m_?n.height=e.height:e.width!==m_?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*r)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(m_),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.baseSize.width!==t||this.baseSize.height!==e)&&(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferredSize.width!==t||this.preferredSize.height!==e)&&(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return m_}},Oi={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},npt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",rpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",ipt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",spt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",apt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",opt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",cpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",lpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",upt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",hpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",dpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",fpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",ppt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",mpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",gpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",vpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",ypt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",_pt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",bpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Ept="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Spt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Tpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",xpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",wpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Cpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Rpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Apt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Mpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",Opt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Npt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Ipt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",kpt="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Dpt=new Map([[Oi.ADD,npt],[Oi.ALPHA,rpt],[Oi.AVERAGE,ipt],[Oi.COLOR,spt],[Oi.COLOR_BURN,apt],[Oi.COLOR_DODGE,opt],[Oi.DARKEN,cpt],[Oi.DIFFERENCE,lpt],[Oi.DIVIDE,upt],[Oi.DST,null],[Oi.EXCLUSION,hpt],[Oi.HARD_LIGHT,dpt],[Oi.HARD_MIX,fpt],[Oi.HUE,ppt],[Oi.INVERT,mpt],[Oi.INVERT_RGB,gpt],[Oi.LIGHTEN,vpt],[Oi.LINEAR_BURN,ypt],[Oi.LINEAR_DODGE,_pt],[Oi.LINEAR_LIGHT,bpt],[Oi.LUMINOSITY,Ept],[Oi.MULTIPLY,Spt],[Oi.NEGATION,Tpt],[Oi.NORMAL,xpt],[Oi.OVERLAY,wpt],[Oi.PIN_LIGHT,Cpt],[Oi.REFLECT,Rpt],[Oi.SATURATION,Apt],[Oi.SCREEN,Mpt],[Oi.SOFT_LIGHT,Opt],[Oi.SRC,Npt],[Oi.SUBTRACT,Ipt],[Oi.VIVID_LIGHT,kpt]]),Ppt=class extends Zd{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new Yr(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return Dpt.get(this.blendFunction)}},IG=class extends Zd{constructor(t,e,{attributes:n=yb.NONE,blendFunction:r=Oi.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=o,this.defines=i,this.uniforms=s,this.extensions=a,this.blendMode=new Ppt(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Bg,this._outputColorSpace=Kp}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=Fb){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Ul||e instanceof yl||e instanceof Pa||e instanceof _m)&&this[t].dispose()}}},OD={RED:0,GREEN:1,BLUE:2,ALPHA:3},Xve=class extends _m{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new Yve,this.overrideMaterialManager=n===null?null:new gre(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new gre(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,r,i){const s=this.scene,a=this.camera,o=this.selection,c=a.layers.mask,l=s.background,u=t.shadowMap.autoUpdate,h=this.renderToScreen?null:e;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=c,s.background=l,t.shadowMap.autoUpdate=u}},Lpt=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,Upt="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",Bpt=class extends Bc{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Yr(null),normalBuffer:new Yr(null),texelSize:new Yr(new Rt)},blending:Zf,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Lpt,vertexShader:Upt})}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Fb){this.depthBuffer=t,this.depthPacking=e}set normalBuffer(t){this.uniforms.normalBuffer.value=t,t!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(t){this.normalBuffer=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Fpt=class extends _m{constructor({normalBuffer:t=null,resolutionScale:e=.5,width:n=Mw.AUTO_SIZE,height:r=Mw.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("DepthDownsamplingPass");const a=new Bpt;a.normalBuffer=t,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Ul(1,1,{minFilter:Ja,magFilter:Ja,depthBuffer:!1,type:ru}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const o=this.resolution=new Mw(this,i,s,e);o.addEventListener("change",c=>this.setSize(o.baseWidth,o.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(t,e=Fb){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e}render(t,e,n,r,i){t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(t,e)}initialize(t,e,n){const r=t.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},zpt=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Hpt="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",jpt=class extends Bc{constructor(t,e,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:XO.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Yr(null),depthBuffer:new Yr(null),resolution:new Yr(new Rt),texelSize:new Yr(new Rt),cameraNear:new Yr(.3),cameraFar:new Yr(1e3),aspect:new Yr(1),time:new Yr(0)},blending:Zf,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=Fb){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader=zpt.replace(ss.FRAGMENT_HEAD,t.get(ss.FRAGMENT_HEAD)||"").replace(ss.FRAGMENT_MAIN_UV,t.get(ss.FRAGMENT_MAIN_UV)||"").replace(ss.FRAGMENT_MAIN_IMAGE,t.get(ss.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Hpt.replace(ss.VERTEX_HEAD,t.get(ss.VERTEX_HEAD)||"").replace(ss.VERTEX_MAIN_SUPPORT,t.get(ss.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Ic?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return ss}};function vre(t,e,n){for(const r of e){const i="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const a of n.entries())a[1]!==null&&n.set(a[0],a[1].replace(s,i))}}function Vpt(t,e,n){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),a=r!==void 0&&/mainUv/.test(r);if(n.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&n.attributes&yb.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const o=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let l=c.get(ss.FRAGMENT_HEAD)||"",u=c.get(ss.FRAGMENT_MAIN_UV)||"",h=c.get(ss.FRAGMENT_MAIN_IMAGE)||"",d=c.get(ss.VERTEX_HEAD)||"",f=c.get(ss.VERTEX_MAIN_SUPPORT)||"";const p=new Set,g=new Set;if(a&&(u+=`	${t}MainUv(UV);
`,n.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const E=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);f+=`	${t}MainSupport(`,f+=E?`vUv);
`:`);
`;for(const T of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const x of T[1].split(/\s*,\s*/))n.varyings.add(x),p.add(x),g.add(x);for(const T of i.matchAll(o))g.add(T[1])}for(const E of r.matchAll(o))g.add(E[1]);for(const E of e.defines.keys())g.add(E.replace(/\([\w\s,]*\)/g,""));for(const E of e.uniforms.keys())g.add(E);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((E,T)=>n.uniforms.set(t+T.charAt(0).toUpperCase()+T.slice(1),E)),e.defines.forEach((E,T)=>n.defines.set(t+T.charAt(0).toUpperCase()+T.slice(1),E));const _=new Map([["fragment",r],["vertex",i]]);vre(t,g,n.defines),vre(t,g,_),r=_.get("fragment"),i=_.get("vertex");const v=e.blendMode;if(n.blendModes.set(v.blendFunction,v),s){e.inputColorSpace!==null&&e.inputColorSpace!==n.colorSpace&&(h+=e.inputColorSpace===ya?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Kp?n.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(n.colorSpace=e.inputColorSpace);const E=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${t}MainImage(color0, UV, `,n.attributes&yb.DEPTH&&E.test(r)&&(h+="depth, ",n.readDepth=!0),h+=`color1);
	`;const T=t+"BlendOpacity";n.uniforms.set(T,v.opacity),h+=`color0 = blend${v.blendFunction}(color0, color1, ${T});

	`,l+=`uniform float ${T};

`}if(l+=r+`
`,i!==null&&(d+=i+`
`),c.set(ss.FRAGMENT_HEAD,l),c.set(ss.FRAGMENT_MAIN_UV,u),c.set(ss.FRAGMENT_MAIN_IMAGE,h),c.set(ss.VERTEX_HEAD,d),c.set(ss.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const E of e.extensions)n.extensions.add(E)}}var Gpt=class extends _m{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new jpt(null,null,null,t),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((e,n)=>n.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new tpt;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===Oi.DST)t.attributes|=a.getAttributes()&yb.DEPTH;else{if(t.attributes&a.getAttributes()&yb.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);Vpt("e"+e++,a,t)}let n=t.shaderParts.get(ss.FRAGMENT_HEAD),r=t.shaderParts.get(ss.FRAGMENT_MAIN_IMAGE),i=t.shaderParts.get(ss.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const a of t.blendModes.values())n+=a.getShaderCode().replace(s,`blend${a.blendFunction}`)+`
`;t.attributes&yb.DEPTH?(t.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,t.colorSpace===ya&&(r+=`color0 = sRGBToLinear(color0);
	`),t.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(ss.FRAGMENT_HEAD,n),t.shaderParts.set(ss.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(ss.FRAGMENT_MAIN_UV,i);for(const[a,o]of t.shaderParts)o!==null&&t.shaderParts.set(a,o.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=Fb){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,r,i){for(const s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const r of this.effects)r.initialize(t,e,n);this.updateMaterial(),n!==void 0&&n!==gl&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},qpt=class extends _m{constructor(t,e,{renderTarget:n,resolutionScale:r=1,width:i=Mw.AUTO_SIZE,height:s=Mw.AUTO_SIZE,resolutionX:a=i,resolutionY:o=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new Xve(t,e,new Uq);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new _n(7829503),l.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Ul(1,1,{minFilter:Ja,magFilter:Ja}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Mw(this,a,o,r);u.addEventListener("change",h=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(t){this.renderPass.mainScene=t}set mainCamera(t){this.renderPass.mainCamera=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,r,i){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s,s)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}};function cM(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}new Rt;new Rt;function Kve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Cf=function t(e,n,r){var i=this;Kve(this,t),cM(this,"dot2",function(s,a){return i.x*s+i.y*a}),cM(this,"dot3",function(s,a,o){return i.x*s+i.y*a+i.z*o}),this.x=e,this.y=n,this.z=r},$pt=[new Cf(1,1,0),new Cf(-1,1,0),new Cf(1,-1,0),new Cf(-1,-1,0),new Cf(1,0,1),new Cf(-1,0,1),new Cf(1,0,-1),new Cf(-1,0,-1),new Cf(0,1,1),new Cf(0,-1,1),new Cf(0,1,-1),new Cf(0,-1,-1)],yre=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],_re=new Array(512),bre=new Array(512),Wpt=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var n=0;n<256;n++){var r;n&1?r=yre[n]^e&255:r=yre[n]^e>>8&255,_re[n]=_re[n+256]=r,bre[n]=bre[n+256]=$pt[r%12]}};Wpt(0);function Ypt(t){if(typeof t=="number")t=Math.abs(t);else if(typeof t=="string"){var e=t;t=0;for(var n=0;n<e.length;n++)t=(t+(n+1)*(e.charCodeAt(n)%96))%2147483647}return t===0&&(t=311),t}function Ere(t){var e=Ypt(t);return function(){var n=e*48271%2147483647;return e=n,n/2147483647}}var Xpt=function t(e){var n=this;Kve(this,t),cM(this,"seed",0),cM(this,"init",function(r){n.seed=r,n.value=Ere(r)}),cM(this,"value",Ere(this.seed)),this.init(e)};new Xpt(Math.random());const Kpt=Be.createContext(null),Sre=t=>(t.getAttributes()&2)===2,Jpt=Be.memo(Be.forwardRef(({children:t,camera:e,scene:n,resolutionScale:r,enabled:i=!0,renderPriority:s=1,autoClear:a=!0,depthBuffer:o,enableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:h=Bb},d)=>{const{gl:f,scene:p,camera:g,size:_}=Zu(),v=n||p,E=e||g,[T,x,N]=Be.useMemo(()=>{const k=new ept(f,{depthBuffer:o,stencilBuffer:l,multisampling:u,frameBufferType:h});k.addPass(new Xve(v,E));let L=null,U=null;return c&&(U=new qpt(v,E),U.enabled=!1,k.addPass(U),r!==void 0&&(L=new Fpt({normalBuffer:U.texture,resolutionScale:r}),L.enabled=!1,k.addPass(L))),[k,U,L]},[E,f,o,l,u,h,v,c,r]);Be.useEffect(()=>T==null?void 0:T.setSize(_.width,_.height),[T,_]),fy((k,L)=>{if(i){const U=f.autoClear;f.autoClear=a,l&&!a&&f.clearStencil(),T.render(L),f.autoClear=U}},i?s:0);const A=Be.useRef(null);Be.useLayoutEffect(()=>{var U;const k=[],L=A.current.__r3f;if(L&&T){const $=L.children;for(let q=0;q<$.length;q++){const G=$[q].object;if(G instanceof IG){const X=[G];if(!Sre(G)){let V=null;for(;(V=(U=$[q+1])==null?void 0:U.object)instanceof IG&&!Sre(V);)X.push(V),q++}const re=new Gpt(E,...X);k.push(re)}else G instanceof _m&&k.push(G)}for(const q of k)T==null||T.addPass(q);x&&(x.enabled=!0),N&&(N.enabled=!0)}return()=>{for(const $ of k)T==null||T.removePass($);x&&(x.enabled=!1),N&&(N.enabled=!1)}},[T,t,E,x,N]),Be.useEffect(()=>{const k=f.toneMapping;return f.toneMapping=em,()=>{f.toneMapping=k}},[f]);const I=Be.useMemo(()=>({composer:T,normalPass:x,downSamplingPass:N,resolutionScale:r,camera:E,scene:v}),[T,x,N,r,E,v]);return Be.useImperativeHandle(d,()=>T,[T]),Ae.jsx(Kpt.Provider,{value:I,children:Ae.jsx("group",{ref:A,children:t})})}));let Zpt=0;const Tre=new WeakMap,Qpt=(t,e)=>function({blendFunction:n=e==null?void 0:e.blendFunction,opacity:r=e==null?void 0:e.opacity,...i}){let s=Tre.get(t);if(!s){const c=`@react-three/postprocessing/${t.name}-${Zpt++}`;Ooe({[c]:t}),Tre.set(t,s=c)}const a=Zu(c=>c.camera),o=xg.useMemo(()=>[...(e==null?void 0:e.args)??[],...i.args??[{...e,...i}]],[JSON.stringify(i)]);return Ae.jsx(s,{camera:a,"blendMode-blendFunction":n,"blendMode-opacity-value":r,...i,args:o})};var hp=typeof window<"u"?window:{screen:{},navigator:{}},OC=(hp.matchMedia||function(){return{matches:!1}}).bind(hp),emt={get passive(){return!0}},Jve=function(){};hp.addEventListener&&hp.addEventListener("p",Jve,emt);hp.removeEventListener&&hp.removeEventListener("p",Jve,!1);var NY="ontouchstart"in hp,tmt="TouchEvent"in hp,nmt=NY||tmt&&OC("(any-pointer: coarse)").matches,xre=(hp.navigator.maxTouchPoints||0)>0||nmt,Zve=hp.navigator.userAgent||"",rmt=OC("(pointer: coarse)").matches&&/iPad|Macintosh/.test(Zve)&&Math.min(hp.screen.width||0,hp.screen.height||0)>=768,Qve=(OC("(pointer: coarse)").matches||!OC("(pointer: fine)").matches&&NY)&&!/Windows.*Firefox/.test(Zve),imt=OC("(any-pointer: fine)").matches||OC("(any-hover: hover)").matches||rmt||!NY,kG=xre&&(imt||!Qve)?"hybrid":xre?"touchOnly":"mouseOnly",smt=kG==="mouseOnly"?"mouse":kG==="touchOnly"||Qve?"touch":"mouse";const amt=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,omt=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,cmt=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,lmt=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,umt=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,hmt=`
uniform float viewheight;
uniform sampler2D splat;

${omt}
${cmt}
${lmt}
${amt}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class dmt extends IG{constructor({splat:e,viewheight:n}={}){super("CRTShapeEffect",hmt,{blendFunction:Oi.NORMAL,attributes:yb.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new Yr(e)],["viewheight",new Yr(n??128)]])})}get splat(){var e;return(e=this.uniforms.get("splat"))==null?void 0:e.value}set splat(e){const{splat:n,uniforms:r,defines:i}=this,s=r.get("splat"),a=r.get("uvTransform");n!==e&&s&&a&&(s.value=e,a.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(umt)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==gl&&i.set("TEXTURE_PRECISION_HIGH","1"),(n===null||(n==null?void 0:n.type)!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const e=this.splat;return!!(e!=null&&e.matrixAutoUpdate)}set uvTransform(e){const n=this.splat;ae(n)&&(n.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,n=e,r=e,i=e){const s="rgba";let a="";(e!==OD.RED||n!==OD.GREEN||r!==OD.BLUE||i!==OD.ALPHA)&&(a=[".",s[e],s[n],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+a),this.setChanged()}update(){var e;(e=this.splat)!=null&&e.matrixAutoUpdate&&this.splat.updateMatrix()}}const fmt=Qpt(dmt),pmt=new Re,eye=Be.createContext([]);function K6(){return Be.useContext(eye)}function tye({width:t=0,height:e=0,children:n,...r}){const i=Be.useRef(null),[s]=Be.useState(()=>{const o=[];return t&&o.push(new Nf,new Nf),e&&o.push(new Nf,new Nf),o}),[a]=Be.useState(()=>[new Re(0,0,0),new Re(0,0,0),new Re(0,0,0),new Re(0,0,0),new Re(0,0,0)]);return fy(()=>{if(i.current){const o=i.current.localToWorld(a[0].set(0,0,0)),c=[];if(t){const l=t*.5;c.push(i.current.localToWorld(a[3].set(l,0,0)),i.current.localToWorld(a[4].set(-l,0,0)))}if(e){const l=e*.5;c.push(i.current.localToWorld(a[1].set(0,l,0)),i.current.localToWorld(a[2].set(0,-l,0)))}for(let l=0;l<s.length;l+=1)s[l].setFromNormalAndCoplanarPoint(pmt.subVectors(o,c[l]).normalize(),c[l])}}),Ae.jsx(eye.Provider,{value:s,children:Ae.jsx("group",{position:[t*.5,e*.5,0],children:Ae.jsx("group",{ref:i,...r,children:Ae.jsx("group",{position:[t*-.5,e*-.5,0],children:n})})})})}function wre(){}const mmt=xg.forwardRef(function({args:e,children:n,...r},i){const s=xg.useRef(null);return xg.useImperativeHandle(i,()=>s.current),Ae.jsxs("mesh",{ref:s,...r,children:[Ae.jsx("planeGeometry",{attach:"geometry",args:e}),n]})}),Vd=xg.forwardRef(function({blocking:e=!1,cursor:n="default",x:r=0,y:i=0,z:s=0,width:a=1,height:o=1,opacity:c=1,visible:l=!0,color:u="white",...h},d){const f=a*.5,p=o*.5,g=[(r+f)*kn.DRAW_CHAR_WIDTH(),(i+p)*kn.DRAW_CHAR_HEIGHT(),s],_=K6();return Ae.jsx(mmt,{ref:d,args:[a*kn.DRAW_CHAR_WIDTH(),o*kn.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:n,clippingPlanes:_},onClick:e?wre:void 0,onPointerMove:e?wre:void 0,position:g,...h,children:Ae.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1,clippingPlanes:_})})}),PU=new Re;function Cre(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor(PU.x/t),r=Math.floor((PU.y+e*.5)/e);return{x:n,y:ji*.5+r}}function gmt(){const t=Us(u=>u.inspector),[e,n]=i1(up(u=>[u.cursor,u.select])),r=qQ(e??0,fr),i=qQ(n??e??0,fr),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},a={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},o=a.x-s.x+1,c=a.y-s.y+1;function l(){i1.getState().cursor&&rPe(Ge,ni(),s,a),i1.setState(()=>({cursor:void 0,select:void 0}))}return Ae.jsxs(Ae.Fragment,{children:[t?Ae.jsx(Vd,{visible:!0,x:0,y:0,z:-1,width:fr,height:ji,color:"black",cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(PU.copy(u.intersections[0].point));const h=Cre();i1.setState(()=>({cursor:vT(h,fr)}))},onPointerMove:u=>{if(ae(i1.getState().cursor)){u.intersections[0].object.worldToLocal(PU.copy(u.intersections[0].point));const h=Cre();i1.setState(()=>({select:vT(h,fr)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}):Ae.jsx(Vd,{visible:!0,x:0,y:0,z:-1,width:fr,height:ji,color:"black"}),ae(e)&&Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(Vd,{x:s.x+.25,y:s.y+.25,z:100,width:o-.5,height:c-.5,color:"black",opacity:.3}),Ae.jsx(Vd,{x:s.x,y:s.y,z:101,width:o,height:c,color:"white",opacity:.25})]})]})}class vmt{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return ymt(e).buffer}}function ymt(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);n.set(s,r),r+=i.byteLength}return n}function nye(t){return new _mt(t).unpack()}function rye(t){const e=new bmt,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class _mt{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,i="",s,a;for(;r<e;)s=n[r],s<160?(a=s,r++):(s^192)<32?(a=(s&31)<<6|n[r+1]&63,r+=2):(s^224)<16?(a=(s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(a=(s&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),i+=String.fromCodePoint(a);return this.index+=e,i}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const i=this.unpack();n[i]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(n===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,a=(e&1048575|1048576)*2**(i-20)+n*2**(i-52);return(r===0?1:-1)*a}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class bmt{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<n){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),a=2**32,o=n<<31|r+1023<<20|s/a&1048575,c=s%a;this._bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<n.length){const a=n[s];if(e.hasOwnProperty(a)){this.pack(a);const o=this.pack(e[a]);if(o instanceof Promise)return o.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new vmt,this._textEncoder=new TextEncoder}}let iye=!0,sye=!0;function OP(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function sx(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(a,o){if(a!==e)return i.apply(this,arguments);const c=l=>{const u=n(l);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,c),i.apply(this,[a,c])};const s=r.removeEventListener;r.removeEventListener=function(a,o){if(a!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(o))return s.apply(this,arguments);const c=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Emt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(iye=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Smt(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(sye=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function aye(){if(typeof window=="object"){if(iye)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function IY(t,e){sye&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Tmt(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=OP(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=OP(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=OP(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Rre(t){return Object.prototype.toString.call(t)==="[object Object]"}function oye(t){return Rre(t)?Object.keys(t).reduce(function(e,n){const r=Rre(t[n]),i=r?oye(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function DG(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?DG(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{DG(t,t.get(i),n)})}))}function Are(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&s.push(a)}),s.forEach(a=>{t.forEach(o=>{o.type===r&&o.trackId===a.id&&DG(t,o,i)})}),i}const Mre=aye;function cye(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const c={};return Object.keys(o).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof o[l]=="object"?o[l]:{ideal:o[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(d,f){return d?d+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){c.optional=c.optional||[];let d={};typeof u.ideal=="number"?(d[h("min",l)]=u.ideal,c.optional.push(d),d={},d[h("max",l)]=u.ideal,c.optional.push(d)):(d[h("",l)]=u.ideal,c.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(d,l)]=u[d])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(e.version>=61)return c(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const l=function(u,h,d){h in u&&!(d in u)&&(u[d]=u[h],delete u[h])};o=JSON.parse(JSON.stringify(o)),l(o.audio,"autoGainControl","googAutoGainControl"),l(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let l=o.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(d=>{d=d.filter(p=>p.kind==="videoinput");let f=d.find(p=>h.some(g=>p.label.toLowerCase().includes(g)));return!f&&d.length&&h.includes("back")&&(f=d[d.length-1]),f&&(o.video.deviceId=l.exact?{exact:f.deviceId}:{ideal:f.deviceId}),o.video=r(o.video),Mre("chrome: "+JSON.stringify(o)),c(o)})}o.video=r(o.video)}return Mre("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,c,l){i(o,u=>{n.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>o(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function lye(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function uye(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):s={track:i.track};const a=new Event("track");a.track=i.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===i.id):s={track:i};const a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else sx(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function hye(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,c){let l=i.apply(this,arguments);return l||(l=e(this,o),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(a=>{const o=this._senders.find(c=>c.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function dye(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(a=>a._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Are(a,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),sx(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>Are(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,a;return this.getSenders().forEach(o=>{o.track===r&&(i?a=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===r&&(s?a=!0:s=o),o.track===r)),a||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function fye(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>o.indexOf(l)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const c=this._shimmedLocalStreams[o].indexOf(a);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function pye(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return fye(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[h.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const f=l._reverseStreams[d],p=l._streams[f.id];h=h.replace(new RegExp(p.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(d=>{const f=l._reverseStreams[d],p=l._streams[f.id];h=h.replace(new RegExp(f.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],h={[l](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const g=s(this,p);d[0].apply(null,[g])},p=>{d[1]&&d[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>s(this,p))}};t.RTCPeerConnection.prototype[l]=h[l]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(g=>u.track===g)&&(d=this._streams[f])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function PG(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function mye(t,e){sx(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Ore=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:mye,shimAddTrackRemoveTrack:pye,shimAddTrackRemoveTrackWithNative:fye,shimGetSendersWithDtmf:hye,shimGetUserMedia:cye,shimMediaStream:lye,shimOnTrack:uye,shimPeerConnection:PG,shimSenderReceiverGetStats:dye},Symbol.toStringTag,{value:"Module"}));function gye(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,a){IY("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(a,o,c){o in a&&!(c in a)&&(a[c]=a[o],delete a[o])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const o=a.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function xmt(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function vye(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function LG(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=a[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,o]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(a,o)}}function yye(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _ye(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),sx(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function bye(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){IY("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Eye(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Sye(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:a}=s,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Tye(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function xye(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function wye(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const Nre=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Sye,shimCreateAnswer:wye,shimCreateOffer:xye,shimGetDisplayMedia:xmt,shimGetParameters:Tye,shimGetUserMedia:gye,shimOnTrack:vye,shimPeerConnection:LG,shimRTCDataChannel:Eye,shimReceiverGetStats:_ye,shimRemoveStream:bye,shimSenderGetStats:yye},Symbol.toStringTag,{value:"Module"}));function Cye(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function Rye(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,r.dispatchEvent(a)})}),e.apply(r,arguments)}}}function Aye(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[h]);return u?(d.then(l,u),Promise.resolve()):d};let o=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=o,o=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=o,o=function(c,l,u){const h=a.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=o}function Mye(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(Oye(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function Oye(t){return t&&t.video!==void 0?Object.assign({},t,{video:oye(t.video)}):t}function Nye(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let a=0;a<r.iceServers.length;a++){let o=r.iceServers[a];o.urls===void 0&&o.url?(IY("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(r.iceServers[a])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Iye(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kye(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Dye(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Ire=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Dye,shimCallbacksAPI:Aye,shimConstraints:Oye,shimCreateOfferLegacy:kye,shimGetUserMedia:Mye,shimLocalStreamsAPI:Cye,shimRTCIceServerUrls:Nye,shimRemoteStreamsAPI:Rye,shimTrackEventTransceiver:Iye},Symbol.toStringTag,{value:"Module"}));var Pye={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)i=s[a].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?s.push(a+"="+n.parameters[a]):s.push(a)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let o=3;o<s.length;o++){const c=s[o],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(e.parseExtmap(o))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(o=>{a.forEach(c=>{o.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{i+=e.writeRtpMap(a),i+=e.writeFmtp(a),i+=e.writeRtcpFb(a)});let s=0;return r.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{i+=e.writeExtmap(a)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(n,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),c=o.length>0&&o[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let f={ssrc:c,codecPayloadType:parseInt(d.parameters.apt,10)};c&&l&&(f.rtx={ssrc:l}),r.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(f))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(d=>{d.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const o=e.matchPrefix(n,"a=sctpmap:");if(o.length>0){const c=o[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const a=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(Pye);var Lye=Pye.exports;const Ow=qc(Lye),wmt=YEe({__proto__:null,default:Ow},[Lye]);function NP(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Ow.parseCandidate(r.candidate);for(const a in s)a in i||Object.defineProperty(i,a,{value:s[a]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,sx(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function UG(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||sx(t,"icecandidate",e=>{if(e.candidate){const n=Ow.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function IP(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(o){if(!o||!o.sdp)return!1;const c=Ow.splitSections(o.sdp);return c.shift(),c.some(l=>{const u=Ow.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(o){const c=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(o){let c=65536;return e.browser==="firefox"&&(e.version<57?o===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(o,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Ow.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return h}}),this._sctp=d}return a.apply(this,arguments)}}function kP(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const o=arguments[0],c=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},sx(t,"datachannel",r=>(e(r.channel,r.target),r))}function BG(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",i);s.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function FG(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function DP(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function PP(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}const Cmt=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:FG,shimAddIceCandidateNullOrEmpty:DP,shimConnectionState:BG,shimMaxMessageSize:IP,shimParameterlessSetLocalDescription:PP,shimRTCIceCandidate:NP,shimRTCIceCandidateRelayProtocol:UG,shimSendThrowTypeError:kP},Symbol.toStringTag,{value:"Module"}));function Rmt({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=aye,r=Tmt(t),i={browserDetails:r,commonShim:Cmt,extractVersion:OP,disableLog:Emt,disableWarnings:Smt,sdp:wmt};switch(r.browser){case"chrome":if(!Ore||!PG||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Ore,DP(t,r),PP(t),cye(t,r),lye(t),PG(t,r),uye(t),pye(t,r),hye(t),dye(t),mye(t,r),NP(t),UG(t),BG(t),IP(t,r),kP(t),FG(t,r);break;case"firefox":if(!Nre||!LG||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Nre,DP(t,r),PP(t),gye(t,r),LG(t,r),vye(t),bye(t),yye(t),_ye(t),Eye(t),Sye(t),Tye(t),xye(t),wye(t),NP(t),BG(t),IP(t,r),kP(t);break;case"safari":if(!Ire||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Ire,DP(t,r),PP(t),Nye(t),kye(t),Aye(t),Cye(t),Rye(t),Iye(t),Mye(t),Dye(t),NP(t),UG(t),IP(t,r),kP(t),FG(t,r);break;default:n("Unsupported browser!");break}return i}const kre=Rmt({window:typeof window>"u"?void 0:window});function ax(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class Uye{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,a=0;for(;a<r;){const o=Math.min(r,a+this.chunkedMTU),c=e.slice(a,o),l={__peerData:this._dataCount,n:s,data:c,total:i};n.push(l),a=o,s++}return this._dataCount++,n}}}function Amt(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.byteLength;return n}const ij=kre.default||kre,aA=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return ij.browserDetails.browser}getVersion(){return ij.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=ij.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Mmt=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),Bye=()=>Math.random().toString(36).slice(2),Dre={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Omt extends Uye{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Dre,this.browser=aA.getBrowser(),this.browserVersion=aA.getVersion(),this.pack=rye,this.unpack=nye,this.supports=function(){const n={browser:aA.isBrowserSupported(),webRTC:aA.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(Dre),n.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!i.ordered;try{i.binaryType="blob",n.binaryBlob=!aA.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=Mmt,this.randomToken=Bye}}const Oh=new Omt,Nmt="PeerJS: ";var Pre;(function(t){t[t.Disabled=0]="Disabled",t[t.Errors=1]="Errors",t[t.Warnings=2]="Warnings",t[t.All=3]="All"})(Pre||(Pre={}));class Imt{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[Nmt,...n];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var jn=new Imt,kY={},kmt=Object.prototype.hasOwnProperty,th="~";function kO(){}Object.create&&(kO.prototype=Object.create(null),new kO().__proto__||(th=!1));function Dmt(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function Fye(t,e,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new Dmt(n,r||t,i),a=th?th+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function LP(t,e){--t._eventsCount===0?t._events=new kO:delete t._events[e]}function fu(){this._events=new kO,this._eventsCount=0}fu.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)kmt.call(n,r)&&e.push(th?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};fu.prototype.listeners=function(e){var n=th?th+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);i<s;i++)a[i]=r[i].fn;return a};fu.prototype.listenerCount=function(e){var n=th?th+e:e,r=this._events[n];return r?r.fn?1:r.length:0};fu.prototype.emit=function(e,n,r,i,s,a){var o=th?th+e:e;if(!this._events[o])return!1;var c=this._events[o],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,i),!0;case 5:return c.fn.call(c.context,n,r,i,s),!0;case 6:return c.fn.call(c.context,n,r,i,s,a),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var d=c.length,f;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,i);break;default:if(!u)for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];c[h].fn.apply(c[h].context,u)}}return!0};fu.prototype.on=function(e,n,r){return Fye(this,e,n,r,!1)};fu.prototype.once=function(e,n,r){return Fye(this,e,n,r,!0)};fu.prototype.removeListener=function(e,n,r,i){var s=th?th+e:e;if(!this._events[s])return this;if(!n)return LP(this,s),this;var a=this._events[s];if(a.fn)a.fn===n&&(!i||a.once)&&(!r||a.context===r)&&LP(this,s);else{for(var o=0,c=[],l=a.length;o<l;o++)(a[o].fn!==n||i&&!a[o].once||r&&a[o].context!==r)&&c.push(a[o]);c.length?this._events[s]=c.length===1?c[0]:c:LP(this,s)}return this};fu.prototype.removeAllListeners=function(e){var n;return e?(n=th?th+e:e,this._events[n]&&LP(this,n)):(this._events=new kO,this._eventsCount=0),this};fu.prototype.off=fu.prototype.removeListener;fu.prototype.addListener=fu.prototype.on;fu.prefixed=th;fu.EventEmitter=fu;kY=fu;var ox={};ax(ox,"ConnectionType",()=>Pg);ax(ox,"PeerErrorType",()=>fo);ax(ox,"BaseConnectionErrorType",()=>DO);ax(ox,"DataConnectionErrorType",()=>PO);ax(ox,"SerializationType",()=>NC);ax(ox,"SocketEventType",()=>Tg);ax(ox,"ServerMessageType",()=>al);var Pg;(function(t){t.Data="data",t.Media="media"})(Pg||(Pg={}));var fo;(function(t){t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc"})(fo||(fo={}));var DO;(function(t){t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed"})(DO||(DO={}));var PO;(function(t){t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big"})(PO||(PO={}));var NC;(function(t){t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw"})(NC||(NC={}));var Tg;(function(t){t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close"})(Tg||(Tg={}));var al;(function(t){t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE"})(al||(al={}));var DY={};DY=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class Pmt extends kY.EventEmitter{constructor(e,n,r,i,s,a=5e3){super(),this.pingInterval=a,this._disconnected=!0,this._messagesQueue=[];const o=e?"wss://":"ws://";this._baseUrl=o+n+":"+r+i+"peerjs?key="+s}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+DY.version),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),jn.log("Server message received:",s)}catch{jn.log("Invalid server message",i.data);return}this.emit(Tg.Message,s)},this._socket.onclose=i=>{this._disconnected||(jn.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Tg.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),jn.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){jn.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:al.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Tg.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class zye{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Pg.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=n.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){jn.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;jn.log("Listening for ICE candidates."),e.onicecandidate=a=>{!a.candidate||!a.candidate.candidate||(jn.log(`Received ICE candidates for ${n}:`,a.candidate),s.socket.send({type:al.Candidate,payload:{candidate:a.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":jn.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(DO.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":jn.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(DO.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":jn.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},jn.log("Listening for data channel"),e.ondatachannel=a=>{jn.log("Received data channel");const o=a.channel;s.getConnection(n,r)._initializeDataChannel(o)},jn.log("Listening for remote stream"),e.ontrack=a=>{jn.log("Received remote stream");const o=a.streams[0],c=s.getConnection(n,r);if(c.type===Pg.Media){const l=c;this._addStreamToMediaConnection(o,l)}}}cleanup(){jn.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);jn.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),jn.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Pg.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}n.socket.send({type:al.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(fo.WebRTC,i),jn.log("Failed to setLocalDescription, ",i))}}catch(r){n.emitError(fo.WebRTC,r),jn.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();jn.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),jn.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:al.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){n.emitError(fo.WebRTC,i),jn.log("Failed to setLocalDescription, ",i)}}catch(r){n.emitError(fo.WebRTC,r),jn.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,i=this.connection.provider;jn.log("Setting remote description",n);const s=this;try{await r.setRemoteDescription(n),jn.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(a){i.emitError(fo.WebRTC,a),jn.log("Failed to setRemoteDescription, ",a)}}async handleCandidate(e){jn.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),jn.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(fo.WebRTC,n),jn.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(jn.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return jn.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){jn.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class Hye extends kY.EventEmitter{emitError(e,n){jn.error("Error:",n),this.emit("error",new Lmt(`${e}`,n))}}class Lmt extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class jye extends Hye{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var lq;const mM=class mM extends jye{get type(){return Pg.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||mM.ID_PREFIX+Oh.randomToken(),this._negotiator=new zye(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{jn.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{jn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){jn.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case al.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case al.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:jn.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){jn.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};lq=new WeakMap,RR(mM,lq,mM.ID_PREFIX="mc_");let LU=mM;class Umt{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:i,path:s,key:a}=this._options,o=new URL(`${n}://${r}:${i}${s}${a}/${e}`);return o.searchParams.set("ts",`${Date.now()}${Math.random()}`),o.searchParams.set("version",DY.version),fetch(o.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){jn.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Oh.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Oh.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw jn.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var uq,hq;const OS=class OS extends jye{get type(){return Pg.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||OS.ID_PREFIX+Bye(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new zye(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{jn.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{jn.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{jn.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(PO.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case al.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case al.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:jn.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};uq=new WeakMap,hq=new WeakMap,RR(OS,uq,OS.ID_PREFIX="dc_"),RR(OS,hq,OS.MAX_BUFFERED_AMOUNT=8388608);let UU=OS;class PY extends UU{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>UU.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return jn.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class sj extends PY{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new Uye,this.serialization=NC.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=nye(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const i=Amt(r.data);this._handleDataMessage({data:i})}}_send(e,n){const r=rye(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);jn.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class Bmt extends PY{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=NC.None}}class Fmt extends PY{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Oh.chunkedMTU){this.emitError(PO.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=NC.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var dq;const gM=class gM extends Hye{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:Bmt,json:Fmt,binary:sj,"binary-utf8":sj,default:sj},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Oh.CLOUD_HOST,port:Oh.CLOUD_PORT,path:"/",key:gM.DEFAULT_KEY,token:Oh.randomToken(),config:Oh.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Oh.CLOUD_HOST?this._options.secure=Oh.isSecure():this._options.host==Oh.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&jn.setLogFunction(this._options.logFunction),jn.logLevel=this._options.debug||0,this._api=new Umt(n),this._socket=this._createServerConnection(),!Oh.supports.audioVideo&&!Oh.supports.data){this._delayedAbort(fo.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Oh.validateId(r)){this._delayedAbort(fo.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(fo.ServerError,i))}_createServerConnection(){const e=new Pmt(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Tg.Message,n=>{this._handleMessage(n)}),e.on(Tg.Error,n=>{this._abort(fo.SocketError,n)}),e.on(Tg.Disconnected,()=>{this.disconnected||(this.emitError(fo.Network,"Lost connection to server."),this.disconnect())}),e.on(Tg.Close,()=>{this.disconnected||this._abort(fo.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,i=e.src;switch(n){case al.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case al.Error:this._abort(fo.ServerError,r.msg);break;case al.IdTaken:this._abort(fo.UnavailableID,`ID "${this.id}" is taken`);break;case al.InvalidKey:this._abort(fo.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case al.Leave:jn.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case al.Expire:this.emitError(fo.PeerUnavailable,`Could not connect to peer ${i}`);break;case al.Offer:{const s=r.connectionId;let a=this.getConnection(i,s);if(a&&(a.close(),jn.warn(`Offer received for existing Connection ID:${s}`)),r.type===Pg.Media){const c=new LU(i,this,{connectionId:s,_payload:r,metadata:r.metadata});a=c,this._addConnection(i,a),this.emit("call",c)}else if(r.type===Pg.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});a=c,this._addConnection(i,a),this.emit("connection",c)}else{jn.warn(`Received malformed connection type:${r.type}`);return}const o=this._getMessages(s);for(const c of o)a.handleMessage(c);break}default:{if(!r){jn.warn(`You received a malformed message from ${i} of type ${n}`);return}const s=r.connectionId,a=this.getConnection(i,s);a&&a.peerConnection?a.handleMessage(e):s?this._storeMessage(s,e):jn.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){jn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(fo.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){jn.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(fo.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){jn.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new LU(e,this,{...r,_stream:n});return this._addConnection(e,i),i}_addConnection(e,n){jn.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===n)return i;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){jn.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(jn.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;jn.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)jn.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)jn.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(fo.ServerError,n))}};dq=new WeakMap,RR(gM,dq,gM.DEFAULT_KEY="peerjs");let zG=gM;var zmt=zG;let Jf,LO,UO;const BO={},IC={},FO={},HG={},Vye={};function Gye(t,e,n=!1){const r=cc().createMediaStreamSource(e),i=new yi(5);lp(r,i),t===ni()?(console.info("setup local voice",t),LO=e):console.info("setup remote voice",t),i.toDestination(),FO[t]=i}function qye(t,e){const n=document.createElement("video");n.autoplay=!0,n.srcObject=e,t===ni()?UO=e:console.info("setup remote screen",t),Wv.getState().setscreen(t,n),Vye[t]=n}function jG(t){var e,n;(e=FO[t])==null||e.dispose(),(n=IC[t])==null||n.close(),delete FO[t],delete IC[t],delete HG[t],delete Vye[t]}function VG(t){console.info("mediaconnection.metadata",t.metadata),t.on("stream",e=>{t.metadata.screen?qye(t.peer,e):Gye(t.peer,e)}),t.on("close",()=>{jG(t.peer)}),t.on("error",()=>{jG(t.peer)})}function LY(){ae(Jf)||(Jf=new zmt(ni()),Jf.on("call",t=>{t.answer(),VG(t),setTimeout(J6,1e3)}),Jf.on("error",t=>{Hr(Ge,ni(),"usermedia",t.toString())}))}function $ye(){ae(Jf)&&(Jf.destroy(),Jf=void 0)}async function Hmt(){try{return await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1}})}catch(t){Hr(Ge,ni(),"uservoice",t.toString())}}function jmt(){LY(),Hmt().then(t=>{ae(t)&&(Gye(ni(),t),J6())}).catch(t=>{Hr(Ge,ni(),"uservoice",t.toString())})}function Vmt(){jG(ni()),LO=void 0,ae(UO)||$ye()}async function Gmt(){try{return await navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0})}catch(t){Hr(Ge,ni(),"userscreenshare",t.toString())}}function qmt(){LY(),Gmt().then(t=>{ae(t)&&(qye(ni(),t),J6())}).catch(t=>{Hr(Ge,ni(),"userscreen",t.toString())})}function $mt(){UO=void 0,ae(LO)||$ye()}function Wmt(t){LY(),ae(Jf)&&(BO[t]=!0)}function Ymt(t){var e,n;ae(Jf)&&((e=IC[t])==null||e.close(),(n=FO[t])==null||n.dispose(),delete BO[t],delete IC[t],delete FO[t])}function J6(){if(!ae(Jf))return;const t=Object.keys(BO);if(ae(LO))for(let e=0;e<t.length;++e){const n=t[e];if(n===ni())continue;const r=IC[n];if(!ae(r)||!r.open){const i=Jf.call(n,LO,{metadata:{voice:!0}});IC[n]=i,VG(i)}}if(ae(UO))for(let e=0;e<t.length;++e){const n=t[e];if(n===ni())continue;const r=HG[n];if(!ae(r)||!r.open){const i=Jf.call(n,UO,{metadata:{screen:!0}});HG[n]=i,VG(i)}}}function Wye(t){const e={};for(let r=0;r<t.length;++r){const i=t[r];ae(BO[i])||(e[i]=!0,Wmt(i))}const n=Object.keys(BO);for(let r=0;r<n.length;++r){const i=n[r];ae(e[i])||Ymt(i)}J6()}function Xmt(t,e,n,r){const i=e*n*4;for(let s=0,a=0;s<i;++a)t.image.data[s]=r[a]*255,s+=4;return t.needsUpdate=!0,t}function Kmt(t,e){const n=new Uint8Array(4*t*e);return new Qf(n,t,e)}const Jmt=new Bc({transparent:!1,side:ll,uniforms:{color:{value:new _n(0,0,0)},data:{value:null}},vertexShader:`
      #include <clipping_planes_pars_vertex>
  
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
        
        #include <clipping_planes_vertex>
      }
    `,fragmentShader:`
      #include <clipping_planes_pars_fragment>
  
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        #include <clipping_planes_fragment>
  
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function Zmt(){return X6(Jmt)}const BU=[0,1,0],Yye=[1,1,0],FU=[1,0,0],Xye=[0,0,0],Qmt=new Float32Array([...BU,...FU,...Yye,...BU,...Xye,...FU]),egt=new Float32Array([...BU.slice(0,2),...FU.slice(0,2),...Yye.slice(0,2),...BU.slice(0,2),...Xye.slice(0,2),...FU.slice(0,2)]);function tgt(t,e,n,r,i,s){const a=e*n*4;for(let o=0,c=0;o<a;++c){const l=r[c]??0;t.image.data[o++]=l%Hh,t.image.data[o++]=Math.floor(l/Hh),t.image.data[o++]=i[c]??16,t.image.data[o++]=s[c]??16}return t.needsUpdate=!0,t}function ngt(t,e){const n=new Uint8Array(4*t*e),r=new Qf(n,t,e,ZO,gl);return r.internalFormat="RGBA8UI",r}function Kye(t,e,n){const r=e*kn.DRAW_CHAR_WIDTH(),i=n*kn.DRAW_CHAR_HEIGHT(),s=Qmt.map((a,o)=>{switch(o%3){case 0:return a*r;case 1:return a*i;default:return a}});t.setAttribute("position",new ii(s,3)),t.setAttribute("uv",new ii(egt,2)),t.computeBoundingBox(),t.computeBoundingSphere()}const rgt=yO(YC(RN)),Lre=xw(XC(CN)),igt=new Bc({transparent:!1,side:ll,uniforms:{time:Of,interval:Y6,palette:new Yr(rgt),map:new Yr(Lre),alt:new Yr(Lre),data:new Yr(null),size:{value:new Rt},step:{value:new Rt},flip:new Yr(!0)},vertexShader:`
    #include <clipping_planes_pars_vertex>
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    uniform bool flip;
    varying vec2 vUv;

    void main() {
      #include <clipping_planes_fragment>

      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      vec3 color = palette[colori];

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Qt.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function sgt(){return X6(igt)}function AI({width:t,height:e,alphas:n}){const r=K6(),i=Be.useRef(null),[s]=Be.useState(()=>Zmt());return Be.useEffect(()=>{s.uniforms.data.value=Kmt(t,e)},[s.uniforms.data,t,e]),Be.useEffect(()=>{Xmt(s.uniforms.data.value,t,e,n)},[s.uniforms.data.value,t,e,n]),Be.useEffect(()=>{i.current&&(Kye(i.current,t,e),s.clipping=r.length>0,s.clippingPlanes=r,s.needsUpdate=!0)},[s,r,t,e]),Ae.jsx("mesh",{material:s,children:Ae.jsx("bufferGeometry",{ref:i})})}function agt({width:t,height:e,alpha:n}){const r=Be.useMemo(()=>new Array(t*e).fill(n),[t,e,n]);return Ae.jsx(AI,{width:t,height:e,alphas:r})}const oA=new Yae,uS=new Rt;function zO({width:t,height:e,top:n,left:r,right:i,bottom:s,scale:a=.125,alpha:o=.25}){const c=Be.useMemo(()=>{const l=new Array(t*e);oA.min.x=r,oA.min.y=n,oA.max.x=i,oA.max.y=s,uS.x=0,uS.y=0;for(let u=0;u<l.length;++u)l[u]=Gse.smootherstep(1-oA.distanceToPoint(uS)*a,0,1)*o,++uS.x,uS.x>=t&&(uS.x=0,++uS.y);return l},[t,e,n,r,i,s,a,o]);return Ae.jsx(AI,{width:t,height:e,alphas:c})}const ogt=G7,cgt=yO(YC(RN)),Ure=xw(XC(CN)),lgt=new Bc({transparent:!1,side:ll,uniforms:{time:Of,interval:Y6,smoothrate:new Yr(ogt),palette:new Yr(cgt),map:new Yr(Ure),alt:new Yr(Ure),dpr:new Yr(1),screenwidth:new Yr(1),screenheight:new Yr(1),pointSize:{value:new Rt(1,1)},rows:new Yr(1),step:new Yr(new Rt),flip:new Yr(!0)},vertexShader:`
    #include <clipping_planes_pars_vertex>

    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float screenwidth;
    uniform float screenheight;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      vec3 sourceColor = colorFromIndex(lastColor.x);
      vec3 destColor = colorFromIndex(charData.z);
      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      vCharData.xy = charData.xy;

      // draw space
      float xpadding = (pointSize.y - pointSize.x);
      animPosition *= pointSize;
      animPosition.x += pointSize.x * 0.5;
      animPosition.x += xpadding * 0.5;
      animPosition.y += pointSize.y;

      // model space
      vec4 mvPosition = modelViewMatrix * vec4(animPosition, 0.0, 1.0);

      // transform to screenspace 
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      float ptaspect = (screenwidth / screenheight);
      float ptsize = pointSize.y + ptaspect;
      
      gl_PointSize = (screenheight * (ptsize + 0.5)) / gl_Position.w;
      gl_PointSize *= dpr;
      gl_Position.y -= ptsize - ptaspect;
      
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      #include <clipping_planes_fragment>

      float xscale = pointSize.y / pointSize.x;
      float px = gl_PointCoord.x * xscale;
      
      if (vVisible == 0.0 || px >= 1.0) {
        discard;
      }

      vec2 lookup = vec2(vCharData.x, vCharData.y);

      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }
      vec2 idx = vec2(px, py);
      vec2 char = vec2(lookup.x * step.x, (rows - lookup.y) * step.y);
      vec2 uv = idx * step + char;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function ugt(){return X6(lgt)}const hgt=G7,dgt=yO(YC(RN)),Bre=xw(XC(CN)),fgt=new Bc({transparent:!1,side:ll,uniforms:{time:Of,interval:Y6,smoothrate:new Yr(hgt),palette:new Yr(dgt),map:new Yr(Bre),alt:new Yr(Bre),dpr:new Yr(1),screenwidth:new Yr(1),screenheight:new Yr(1),pointSize:{value:new Rt(1,1)},rows:new Yr(1),step:new Yr(new Rt),flip:new Yr(!0)},vertexShader:`
    #include <clipping_planes_pars_vertex>

    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      vec3 sourceColor = colorFromIndex(lastColor.x);
      vec3 destColor = colorFromIndex(charData.z);
      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      vCharData.xy = charData.xy;

      animPosition = animPosition * pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x += (pointSize.y - pointSize.x) * 0.5;

      vec4 mvPosition = modelViewMatrix * vec4(animPosition, 0.0, 1.0);
      gl_Position = projectionMatrix * mvPosition;      

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
      
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      #include <clipping_planes_fragment>

      float xscale = pointSize.y / pointSize.x;
      float px = gl_PointCoord.x * xscale;
      
      if (vVisible == 0.0 || px >= 1.0) {
        discard;
      }

      vec2 lookup = vec2(vCharData.x, vCharData.y);

      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }
      vec2 idx = vec2(px, py);
      vec2 char = vec2(lookup.x * step.x, (rows - lookup.y) * step.y);
      vec2 uv = idx * step + char;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 1.0) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function pgt(){return X6(fgt)}const Fre=2048;function Jye({sprites:t,fliptexture:e=!0,withbillboards:n=!1}){const{viewport:r}=Zu(),i=Wv(f=>f.palettedata),s=Wv(f=>f.charsetdata),a=Wv(f=>f.altcharsetdata),o=Be.useMemo(()=>n?ugt():pgt(),[n]),c=K6(),l=Be.useRef(null),u=Be.useRef([]),{width:h=0,height:d=0}=(s==null?void 0:s.image)??{};return Be.useMemo(()=>{var _;u.current.length===0&&(u.current=Array.from({length:Fre},()=>({id:"",x:0,y:0,char:0,color:0,bg:0})));const f={};for(let v=0;v<t.length;++v)f[t[v].id]=t[v];const p=new Set(u.current.map(v=>v.id));let g=0;for(let v=0;v<Fre;++v)if(u.current[v].id){const E=f[u.current[v].id];ae(E)?u.current[v]={...E}:u.current[v].id=""}else if(g<t.length){for(;p.has((_=t[g])==null?void 0:_.id)===!0;)++g;g<t.length&&(u.current[v]={...t[g++]})}},[t]),Be.useEffect(()=>{const{current:f}=l,{current:p}=u;if(!f||!p)return;let g=f.getAttribute("visible"),_=f.getAttribute("lastVisible"),v=f.getAttribute("position"),E=f.getAttribute("charData"),T=f.getAttribute("lastPosition"),x=f.getAttribute("lastColor"),N=f.getAttribute("lastBg"),A=f.getAttribute("animShake"),I=f.getAttribute("animBounce");if(!g||g.count!==p.length){g=new ii(new Float32Array(p.length),1),_=new ii(new Float32Array(p.length),1),v=new ii(new Float32Array(p.length*3),3),E=new ii(new Float32Array(p.length*4),4),T=new ii(new Float32Array(p.length*3),3),x=new ii(new Float32Array(p.length*2),2),N=new ii(new Float32Array(p.length*2),2),A=new ii(new Float32Array(p.length*2),2),I=new ii(new Float32Array(p.length*2),2);for(let k=0;k<p.length;++k){const L=p[k],U=L.id?1:0;g.setX(k,U),_.setX(k,U),v.setXY(k,L.x,L.y),E.setXYZW(k,L.char%Hh,Math.floor(L.char/Hh),L.color,L.bg),T.setXYZ(k,L.x,L.y,Of.value),x.setXY(k,L.color,Of.value),N.setXY(k,L.bg,Of.value),A.setXY(k,0,Of.value-1e6),I.setXY(k,0,Of.value-1e6)}f.setAttribute("visible",g),f.setAttribute("lastVisible",_),f.setAttribute("position",v),f.setAttribute("charData",E),f.setAttribute("lastPosition",T),f.setAttribute("lastColor",x),f.setAttribute("lastBg",N),f.setAttribute("animShake",A),f.setAttribute("animBounce",I)}else for(let k=0;k<p.length;++k){const L=p[k],U=v.getX(k),$=v.getY(k),q=E.getX(k),G=E.getY(k),X=E.getZ(k),re=E.getW(k);_.setX(k,g.getX(k)),_.needsUpdate=!0,g.setX(k,L.id?1:0),g.needsUpdate=!0;const V=_.getX(k)===0&&g.getX(k)===1;(V||U!==L.x||$!==L.y)&&(T.setXYZ(k,V?L.x:U,V?L.y:$,Of.value),T.needsUpdate=!0,v.setXY(k,L.x,L.y),v.needsUpdate=!0),(V||X!==L.color)&&(x.setXY(k,V?L.color:X,Of.value),x.needsUpdate=!0,E.setZ(k,L.color),E.needsUpdate=!0),(V||re!==L.bg)&&(N.setXY(k,V?L.bg:re,Of.value),N.needsUpdate=!0,E.setW(k,L.bg),E.needsUpdate=!0);const Z=L.char%Hh,Y=Math.floor(L.char/Hh);(q!==Z||G!==Y)&&(E.setXY(k,Z,Y),E.needsUpdate=!0)}f.computeBoundingBox(),f.computeBoundingSphere()},[t]),Be.useEffect(()=>{if(!s||!l.current)return;const f=Math.round(h/Mg),p=Math.round(d/Og);o.uniforms.palette.value=i,o.uniforms.map.value=s,o.uniforms.alt.value=a??s,o.uniforms.dpr.value=window.devicePixelRatio,o.uniforms.screenwidth.value=r.width,o.uniforms.screenheight.value=r.height,o.uniforms.pointSize.value.x=kn.DRAW_CHAR_WIDTH(),o.uniforms.pointSize.value.y=kn.DRAW_CHAR_HEIGHT(),o.uniforms.rows.value=p-1,o.uniforms.step.value.x=1/f,o.uniforms.step.value.y=1/p,o.uniforms.flip.value=e,o.clipping=c.length>0,o.clippingPlanes=c,o.needsUpdate=!0},[i,s,a,o,h,d,e,c,n,r.width,r.height]),Ae.jsx("points",{frustumCulled:!1,material:o,children:Ae.jsx("bufferGeometry",{ref:l})})}function UY({width:t,height:e,char:n,color:r,bg:i,fliptexture:s=!0}){const a=Wv(p=>p.palettedata),o=Wv(p=>p.charsetdata),c=Wv(p=>p.altcharsetdata),l=K6(),[u]=Be.useState(()=>sgt()),h=Be.useRef(null),{width:d=0,height:f=0}=(o==null?void 0:o.image)??{};return Be.useEffect(()=>{t===0||e===0||(u.uniforms.data.value=ngt(t,e))},[u.uniforms.data,t,e]),Be.useEffect(()=>{t===0||e===0||tgt(u.uniforms.data.value,t,e,n,r,i)},[u.uniforms.data.value,t,e,n,r,i]),Be.useEffect(()=>{t===0||e===0||!h.current||!o||(Kye(h.current,t,e),u.uniforms.map.value=o,u.uniforms.alt.value=c??o,u.uniforms.palette.value=a,u.uniforms.size.value.x=1/t,u.uniforms.size.value.y=1/e,u.uniforms.step.value.x=1/Math.round(d/Mg),u.uniforms.step.value.y=1/Math.round(f/Og),u.uniforms.flip.value=s,u.clipping=l.length>0,u.clippingPlanes=l,u.needsUpdate=!0)},[a,o,c,u,t,e,d,f,s,l]),Ae.jsx("mesh",{material:u,children:Ae.jsx("bufferGeometry",{ref:h})})}function lM({id:t,z:e,from:n}){const r=Wv(),i=Eo(up(a=>{var o;return(o=a.gadget[n])==null?void 0:o.find(c=>c.id===t)})),s=(i==null?void 0:i.type)===Ld.MEDIA?i:void 0;switch(Be.useEffect(()=>{switch(s==null?void 0:s.mime){case"image/palette":Lr(s.media)&&r.setpalette(mw(fT,g7,s.media));break;case"image/charset":Lr(s.media)&&r.setcharset(mw(Hh*Mg,JM*Og,s.media));break;case"image/altcharset":Lr(s.media)&&r.setaltcharset(mw(Hh*Mg,JM*Og,s.media));break;case"text/players":On(s.media)&&Wye(s.media.split(","));break}},[r,s]),i==null?void 0:i.type){default:case Ld.BLANK:case Ld.MEDIA:return null;case Ld.TILES:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(UY,{width:i.width,height:i.height,char:[...i.char],color:[...i.color],bg:[...i.bg]})},i.id);case Ld.SPRITES:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(Jye,{sprites:[...i.sprites]})},i.id);case Ld.DITHER:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(AI,{width:i.width,height:i.height,alphas:[...i.alphas]})},i.id)}}function mgt({width:t,height:e}){const n=t*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT(),i=Be.useRef(null),s=Be.useRef(null),a=Be.useRef(null),o=Be.useRef(null);fy((h,d)=>{if(!i.current||!s.current||!a.current||!o.current)return;const f=b2(Eo.getState().gadget.layers??[]);ae(s.current.userData.focusx)||(a.current.scale.setScalar(f.viewscale),s.current.userData={focusx:f.focusx,focusy:f.focusy,tfocusx:f.focusx,tfocusy:f.focusy,facing:f.facing},s.current.position.set(-f.focusx*kn.DRAW_CHAR_WIDTH(),-f.focusy*kn.DRAW_CHAR_HEIGHT(),0));const p=.25,g=s.current.userData.focusx,_=s.current.userData.focusy,v=g*kn.DRAW_CHAR_WIDTH(),E=_*kn.DRAW_CHAR_HEIGHT();DU(s.current.position,[-v,-E,0],p,d);const T=Math.abs(s.current.userData.focusx-s.current.userData.tfocusx),x=Math.abs(s.current.userData.focusy-s.current.userData.tfocusy);T<1&&x<1&&DU(a.current.scale,f.viewscale,p,d);const N=a.current.scale.x,A=1/N,k=Math.abs(N-f.viewscale)>.01,L=N<nm.MID,q=(N*kn.DRAW_CHAR_WIDTH()-kn.DRAW_CHAR_WIDTH())*A,G=kn.DRAW_CHAR_WIDTH()+q,V=(N*kn.DRAW_CHAR_HEIGHT()-kn.DRAW_CHAR_HEIGHT())*A,Z=kn.DRAW_CHAR_HEIGHT()+V;o.current.position.set(v-g*G,E-_*Z,0);const Y=kn.DRAW_CHAR_WIDTH()*N,ee=kn.DRAW_CHAR_HEIGHT()*N,oe=n/Y,de=r/ee;if(k&&(s.current.userData.tfocusx=f.focusx+.5,s.current.userData.tfocusy=f.focusy+.5),i.current.position.set(n*.5,r*.5,0),!k)if(L)s.current.userData.tfocusx=f.focusx+.5,s.current.userData.tfocusy=f.focusy+.5;else{const ke=Math.round(oe*.25),St=Math.round(de*.25),At=Math.round(s.current.userData.tfocusx-f.focusx);if(Math.abs(At)>=ke){const ye=At<0?ke:-ke;s.current.userData.tfocusx+=ye*2}const Ee=Math.round(s.current.userData.tfocusy-f.focusy);if(Math.abs(Ee)>=St){const ye=Ee<0?St:-St;s.current.userData.tfocusy+=ye*2}}const Me=Math.round(oe*.5),He=Math.round(de*.5),Te=f.width-oe*.5,Le=f.height-de*.5,we=-Math.round((oe-f.width)*.5),Ce=-Math.round((de-f.height)*.5);we>=0?(s.current.userData.tfocusx<Me&&(k&&(s.current.userData.focusx=Me),s.current.userData.tfocusx=Me),s.current.userData.tfocusx>Te&&(k&&(s.current.userData.focusx=Te),s.current.userData.tfocusx=Te)):s.current.userData.tfocusx=Me+we,Ce>=0?(s.current.userData.tfocusy<He&&(k&&(s.current.userData.focusy=He),s.current.userData.tfocusy=He),s.current.userData.tfocusy>Le&&(k&&(s.current.userData.focusy=Le),s.current.userData.tfocusy=Le)):s.current.userData.tfocusy=He+Ce,Kv(s.current.userData,"focusx",s.current.userData.tfocusx,p),Kv(s.current.userData,"focusy",s.current.userData.tfocusy,p)}),Eo(h=>{var d;return((d=h.gadget.over)==null?void 0:d.length)??0}),Eo(h=>{var d;return((d=h.gadget.under)==null?void 0:d.length)??0}),Eo(h=>{var d;return((d=h.gadget.layers)==null?void 0:d.length)??0});const{over:c=[],under:l=[],layers:u=[]}=Eo.getState().gadget;return Ae.jsx(tye,{width:n,height:r,children:Ae.jsx("group",{ref:i,children:Ae.jsx("group",{ref:s,children:Ae.jsx("group",{ref:a,children:Ae.jsxs("group",{ref:o,children:[Ae.jsx(gmt,{}),l.map((h,d)=>Ae.jsx(lM,{from:"under",id:h.id,z:d*2},h.id)),u.map((h,d)=>Ae.jsx(lM,{from:"layers",id:h.id,z:l.length+d*2},h.id)),c.map((h,d)=>Ae.jsx(lM,{from:"over",id:h.id,z:l.length+u.length+d*2},h.id))]})})})})})}function ggt({id:t,z:e,from:n}){const r=Wv(),i=Eo(up(a=>{var o;return(o=a.gadget[n])==null?void 0:o.find(c=>c.id===t)})),s=(i==null?void 0:i.type)===Ld.MEDIA?i:void 0;switch(Be.useEffect(()=>{switch(s==null?void 0:s.mime){case"image/palette":Lr(s.media)&&r.setpalette(mw(fT,g7,s.media));break;case"image/charset":Lr(s.media)&&r.setcharset(mw(Hh*Mg,JM*Og,s.media));break;case"image/altcharset":Lr(s.media)&&r.setaltcharset(mw(Hh*Mg,JM*Og,s.media));break;case"text/players":On(s.media)&&Wye(s.media.split(","));break}},[r,s]),i==null?void 0:i.type){default:case Ld.BLANK:case Ld.MEDIA:return null;case Ld.TILES:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(UY,{width:i.width,height:i.height,char:[...i.char],color:[...i.color],bg:[...i.bg]})},i.id);case Ld.SPRITES:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(Jye,{sprites:[...i.sprites],withbillboards:!0,fliptexture:!1})},i.id);case Ld.DITHER:return Ae.jsx("group",{position:[0,0,e],children:Ae.jsx(AI,{width:i.width,height:i.height,alphas:[...i.alphas]})},i.id)}}function vgt({viewwidth:t,viewheight:e,children:n}){return Ae.jsxs("mesh",{position:[t*.5,e*.5,0],children:[Ae.jsx("planeGeometry",{args:[t,e]}),Ae.jsx("meshBasicMaterial",{transparent:!0,children:Ae.jsx(Vft,{attach:"map",width:t,height:e,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1,children:n})})]})}function zre(t){switch(t){case nm.NEAR:return 160;default:case nm.MID:return 320;case nm.FAR:return 768}}function ygt(t){switch(t){case nm.NEAR:return 1;default:case nm.MID:return 1;case nm.FAR:return-1}}function _gt(t){switch(t){case nm.NEAR:return .888;default:case nm.MID:return .777;case nm.FAR:return .444}}function bgt({width:t,height:e}){const n=t*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT(),i=Be.useRef(null),s=Be.useRef(null),a=Be.useRef(null),o=Be.useRef(null),c=Be.useRef(null);fy((p,g)=>{if(!i.current||!s.current||!a.current||!o.current||!c.current)return;const _=b2(Eo.getState().gadget.layers??[]),v=t*kn.DRAW_CHAR_WIDTH(),E=e*kn.DRAW_CHAR_HEIGHT(),T=fr*kn.DRAW_CHAR_WIDTH(),x=ji*kn.DRAW_CHAR_HEIGHT();ae(o.current.userData.focusx)||(o.current.userData={focusx:_.focusx,focusy:_.focusy,facing:_.facing,focusz:zre(_.viewscale)}),s.current.position.x=0,s.current.position.y=E-x;const N=Ei(v/T,1,10);a.current.position.x=v-T*N,a.current.position.y=0,a.current.scale.setScalar(N);const A=.125,I=ygt(_.viewscale),k=o.current.userData.focusx,L=o.current.userData.focusy,U=(k+.5)*-kn.DRAW_CHAR_WIDTH(),$=(L+I)*-kn.DRAW_CHAR_HEIGHT();DU(c.current.position,[0,0,zre(_.viewscale)],A,g),Aft(i.current.rotation,[_gt(_.viewscale),0,0],A,g),DU(o.current.position,[U,$,0],A,g),Kv(o.current.userData,"focusx",_.focusx,A),Kv(o.current.userData,"focusy",_.focusy,A),i.current.position.y=I,i.current.rotation.z=_.facing}),Eo(p=>{var g;return((g=p.gadget.over)==null?void 0:g.length)??0}),Eo(p=>{var g;return((g=p.gadget.under)==null?void 0:g.length)??0}),Eo(p=>{var g;return((g=p.gadget.layers)==null?void 0:g.length)??0});const{over:l=[],under:u=[],layers:h=[]}=Eo.getState().gadget,d=u.length*2+2,f=d+2;return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx("group",{"position-z":d,children:Ae.jsxs(vgt,{viewwidth:n,viewheight:r,children:[Ae.jsx(Dft,{ref:c,makeDefault:!0,manual:!0,near:1,far:2e3,aspect:n/r}),Ae.jsx("group",{ref:i,children:Ae.jsx("group",{ref:o,children:h.map(p=>Ae.jsx(ggt,{id:p.id,from:"layers",z:0},p.id))})})]})}),Ae.jsxs(tye,{width:n,height:r,children:[Ae.jsx("group",{ref:a,children:u.map((p,g)=>Ae.jsx(lM,{from:"under",id:p.id,z:g*2},p.id))}),Ae.jsx("group",{ref:s,"position-z":f,children:l.map((p,g)=>Ae.jsx(lM,{from:"over",id:p.id,z:g*2},p.id))})]})]})}var BY={};Object.defineProperty(BY,"__esModule",{value:!0});var Zye=BY.GamepadHelper=void 0;const qa=class qa{static getButtonValue(e,n){var r,i;return(i=(r=qa.gamepads[e])==null?void 0:r.buttons[n])==null?void 0:i.value}static getAxisValue(e,n){var r;return(r=qa.gamepads[e])==null?void 0:r.axes[n]}static update(){qa.checkForNewGamepads(),!(!qa.gamepads||Object.keys(qa.gamepads).length<1)&&(qa.gamepadsLastUpdate&&Object.keys(qa.gamepadsLastUpdate).length>0&&Object.values(qa.gamepads).forEach(e=>{var n;for(let r=0;r<e.buttons.length;r++){const i=(n=qa.gamepadsLastUpdate[e.index])==null?void 0:n.buttons[r],s=e.buttons[r];(s==null?void 0:s.value)==1&&(i==null?void 0:i.value)==0?qa.dispatchButtonDownEvent(e.index,r):(s==null?void 0:s.value)==0&&(i==null?void 0:i.value)==1&&qa.dispatchButtonUpEvent(e.index,r)}}),qa.gamepadsLastUpdate=Object.assign({},qa.gamepads))}static checkForNewGamepads(){const e=navigator.getGamepads();for(const n of e)n&&(qa.gamepads[n.index]||qa.logOutput&&console.log("gamepad "+n.index+" connected"),qa.gamepads[n.index]=n)}static dispatchButtonDownEvent(e,n){qa.logOutput&&console.log(`gamepad ${e}: button ${n} is down`),document.dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:{gamepad:e,button:n}}))}static dispatchButtonUpEvent(e,n){qa.logOutput&&console.log(`gamepad ${e}: button ${n} is up`),document.dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:{gamepad:e,button:n}}))}};Qn(qa,"gamepads",{}),Qn(qa,"gamepadsLastUpdate"),Qn(qa,"logOutput",!1);let GG=qa;Zye=BY.GamepadHelper=GG;var Cy={};Object.defineProperty(Cy,"__esModule",{value:!0});var Egt=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),aj={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},Qye={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:Egt?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},FY={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var ND=1;ND<20;ND++)FY["f"+ND]=111+ND;function Z6(t,e,n){e&&!("byKey"in e)&&(n=e,e=null),Array.isArray(t)||(t=[t]);var r=t.map(function(a){return e_e(a,e)}),i=function(o){return r.some(function(c){return t_e(c,o)})},s=n==null?i:i(n);return s}function Sgt(t,e){return Z6(t,e)}function Tgt(t,e){return Z6(t,{byKey:!0},e)}function e_e(t,e){var n=e&&e.byKey,r={};t=t.replace("++","+add");var i=t.split("+"),s=i.length;for(var a in aj)r[aj[a]]=!1;var o=!0,c=!1,l=void 0;try{for(var u=i[Symbol.iterator](),h;!(o=(h=u.next()).done);o=!0){var d=h.value,f=d.endsWith("?")&&d.length>1;f&&(d=d.slice(0,-1));var p=zY(d),g=aj[p];if(d.length>1&&!g&&!Qye[d]&&!FY[p])throw new TypeError('Unknown modifier: "'+d+'"');(s===1||!g)&&(n?r.key=p:r.which=n_e(d)),g&&(r[g]=f?null:!0)}}catch(_){c=!0,l=_}finally{try{!o&&u.return&&u.return()}finally{if(c)throw l}}return r}function t_e(t,e){for(var n in t){var r=t[n],i=void 0;if(r!=null&&(n==="key"&&e.key!=null?i=e.key.toLowerCase():n==="which"?i=r===91&&e.which===93?91:e.which:i=e[n],!(i==null&&r===!1)&&i!==r))return!1}return!0}function n_e(t){t=zY(t);var e=FY[t]||t.toUpperCase().charCodeAt(0);return e}function zY(t){return t=t.toLowerCase(),t=Qye[t]||t,t}var xgt=Cy.default=Z6;Cy.isHotkey=Z6;Cy.isCodeHotkey=Sgt;Cy.isKeyHotkey=Tgt;Cy.parseHotkey=e_e;Cy.compareHotkey=t_e;Cy.toKeyCode=n_e;Cy.toKeyName=zY;function r_e(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(i){i(n)}),(r=t.get("*"))&&r.slice().map(function(i){i(e,n)})}}}const vg={[tn.NONE]:!1,[tn.ALT]:!1,[tn.CTRL]:!1,[tn.SHIFT]:!1,[tn.MOVE_UP]:!1,[tn.MOVE_DOWN]:!1,[tn.MOVE_LEFT]:!1,[tn.MOVE_RIGHT]:!1,[tn.OK_BUTTON]:!1,[tn.CANCEL_BUTTON]:!1,[tn.MENU_BUTTON]:!1};let UP=0,Hre=performance.now();const HO=200;function i_e(){const t=performance.now(),e=t-Hre;if(UP+=e,UP>=HO){UP%=HO;const n={alt:!!vg[tn.ALT],ctrl:!!vg[tn.CTRL],shift:!!vg[tn.SHIFT]};[tn.MOVE_UP,tn.MOVE_DOWN,tn.MOVE_LEFT,tn.MOVE_RIGHT,tn.OK_BUTTON,tn.CANCEL_BUTTON,tn.MENU_BUTTON].forEach(i=>{vg[i]&&a_e(i,n)})}Hre=t,Zye.update(),setTimeout(i_e,100)}i_e();function ju(t){vg[t]||(UP=0,a_e(t,{alt:vg[tn.ALT],ctrl:vg[tn.CTRL],shift:vg[tn.SHIFT]})),vg[t]=!0}function Ac(t){vg[t]=!1}const fg={root:r_e(),ignorehotkeys:!1},s_e=Be.createContext(fg.root);function Q6(t){return{alt:t.altKey,ctrl:Ob?t.metaKey:t.ctrlKey,shift:t.shiftKey}}function a_e(t,e){fg.root.emit(tn[t],e)}document.addEventListener("keydown",t=>{const e=ar(t.key),n=Q6(t),r=ni();switch(e){case"s":case"j":case"o":case"f":case"z":case"y":case"e":case"k":case"p":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":n.ctrl&&t.preventDefault();break;case"tab":t.preventDefault();break}switch(n.alt?ju(tn.ALT):Ac(tn.ALT),n.ctrl?ju(tn.CTRL):Ac(tn.CTRL),n.shift?ju(tn.SHIFT):Ac(tn.SHIFT),e){case"arrowleft":ju(tn.MOVE_LEFT);break;case"arrowright":ju(tn.MOVE_RIGHT);break;case"arrowup":ju(tn.MOVE_UP);break;case"arrowdown":ju(tn.MOVE_DOWN);break;case"enter":ju(tn.OK_BUTTON);break;case"esc":case"escape":ju(tn.CANCEL_BUTTON);break;case"tab":ju(tn.MENU_BUTTON);break;case"s":n.ctrl&&Bv(Ge,r,"#save");break;case"j":n.ctrl&&Bv(Ge,r,n.shift?"#jointab hush":"#jointab");break;case"o":n.ctrl&&Bv(Ge,r,n.shift?"#joincode hush":"#joincode");break;case"p":n.ctrl&&aPe(Ge,r);break;case"l":break;case"f":n.ctrl&&Bv(Ge,r,"#fork");break}fg.root.emit("keydown",t)},{capture:!0});document.addEventListener("keyup",t=>{const e=ar(t.key),n=Q6(t);switch(n.alt?ju(tn.ALT):Ac(tn.ALT),n.ctrl?ju(tn.CTRL):Ac(tn.CTRL),n.shift?ju(tn.SHIFT):Ac(tn.SHIFT),e){case"meta":Ac(tn.MOVE_LEFT),Ac(tn.MOVE_RIGHT),Ac(tn.MOVE_UP),Ac(tn.MOVE_DOWN);break;case"arrowleft":Ac(tn.MOVE_LEFT);break;case"arrowright":Ac(tn.MOVE_RIGHT);break;case"arrowup":Ac(tn.MOVE_UP);break;case"arrowdown":Ac(tn.MOVE_DOWN);break;case"enter":Ac(tn.OK_BUTTON);break;case"esc":case"escape":Ac(tn.CANCEL_BUTTON);break;case"tab":Ac(tn.MENU_BUTTON);break}},{capture:!0});Wb("userinput",["tock"],t=>{switch(t.target){case"up":pn(t.data)&&Ac(t.data);break;case"down":pn(t.data)&&ju(t.data);break}});const wgt=0,Cgt=1,Rgt=2,Agt=3,Mgt=4,Ogt=5,Ngt=6,Igt=7,kgt=9,Dgt=12,Pgt=13,Lgt=14,Ugt=15,o_e={[wgt]:tn.OK_BUTTON,[Cgt]:tn.CANCEL_BUTTON,[Rgt]:tn.OK_BUTTON,[Agt]:tn.CANCEL_BUTTON,[Mgt]:tn.ALT,[Ogt]:tn.CTRL,[Ngt]:tn.SHIFT,[Igt]:tn.SHIFT,[kgt]:tn.MENU_BUTTON,[Dgt]:tn.MOVE_UP,[Pgt]:tn.MOVE_DOWN,[Lgt]:tn.MOVE_LEFT,[Ugt]:tn.MOVE_RIGHT};document.addEventListener("gamepadbuttondown",t=>{ju(o_e[t.detail.button])});document.addEventListener("gamepadbuttonup",t=>{Ac(o_e[t.detail.button])});const jre="keyup";function Nw({hotkey:t,children:e}){return Be.useEffect(()=>{const n=xgt(t,{byKey:!0});function r(i){fg.ignorehotkeys===!1&&n(i)&&e()}return document.addEventListener(jre,r,!1),()=>document.removeEventListener(jre,r,!1)},[t,e]),null}function uc(t){const e=Be.useContext(s_e);return Be.useEffect(()=>{const n=Object.entries(t);return n.forEach(([r,i])=>e.on(r,i)),()=>{n.forEach(([r,i])=>e.off(r,i))}},[e,t]),null}function cx({blockhotkeys:t,children:e}){const[n]=Be.useState(()=>r_e());return Be.useEffect(()=>{const r=fg.root,i=fg.ignorehotkeys;return fg.root=n,fg.ignorehotkeys=!!t,()=>{fg.root=r,fg.ignorehotkeys=i}},[n,t]),Ae.jsx(s_e.Provider,{value:n,children:e})}function hS(t,e,n){let r=0;n.alt&&(r|=nhe),n.ctrl&&(r|=rhe),n.shift&&(r|=ihe),ob(t)&&ePe(Ge,t,e,r)}function Bgt({width:t,height:e}){const n=ni();Eo(s=>{var a;return((a=s.gadget.layers)==null?void 0:a.length)??0}),Eo(s=>b2(s.gadget.layers??[]).graphics);const{layers:r=[]}=Eo.getState().gadget,i=b2(r);return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(uc,{MOVE_LEFT:s=>hS(n,tn.MOVE_LEFT,s),MOVE_RIGHT:s=>hS(n,tn.MOVE_RIGHT,s),MOVE_UP:s=>hS(n,tn.MOVE_UP,s),MOVE_DOWN:s=>hS(n,tn.MOVE_DOWN,s),OK_BUTTON:s=>hS(n,tn.OK_BUTTON,s),CANCEL_BUTTON:s=>hS(n,tn.CANCEL_BUTTON,s),MENU_BUTTON:s=>hS(n,tn.MENU_BUTTON,s),keydown:s=>{const{key:a}=s;switch(ar(a)){case"t":jDe(Ge,ni());break}}}),Ae.jsx(Vd,{visible:!0,color:new _n(.076,.076,0),width:t,height:e,z:-3}),i.graphics==="flat"&&Ae.jsx(mgt,{width:t,height:e}),i.graphics==="mode7"&&Ae.jsx(bgt,{width:t,height:e})]})}const h0=Be.createContext({sendmessage(){},sendclose(){},didclose(){}}),Vre={input:{color:"$white",active:"$yellow"}};function vp(t){return t?Vre.input.active:Vre.input.color}function MI(t,e){switch(t){case"touchkey":return`register:${t}:${e}`}return`vm:${t}:${e}`}function CA(t,e,n=0,r=""){return`${t.substring(0,e)}${r}${t.substring(e+n)}`}function tf(t,e){ae(t)&&(e.x=1,e.y=t)}const C_=32,c_e=8,qG=new Re;function Fgt(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor(qG.x/t),r=Math.floor(qG.y/e);return{x:C_*.5+n,y:c_e*.5+r}}function zgt({chip:t,row:e,label:n,args:r,context:i}){tf(e,i);const[s]=[ou(r[0],"")],a=Xb(t,s),c=qN(a)??0,l=ef(),[u,h]=Be.useState(!1);Be.useLayoutEffect(()=>{h(!0)},[]);const d=`${c}`.padStart(3,"0"),f=n.trim(),p=i.x-1,g=i.y+2,_=[`$green${f} ${d}
$white`];for(let k=0;k<256;++k)if(k%C_===0&&_.push(`
`),k===c){const L=l?"$green$onwhite":"$white$ongreen";_.push(`${L}$${k}$white$ondkblue`)}else _.push(`$${k}`);const v=_.join("");ir(v,i,!0);const E=Be.useContext(h0),T=Be.useCallback(()=>{c>=C_&&ul(a,c-C_)},[a,c]),x=Be.useCallback(()=>{c>0&&ul(a,c-1)},[a,c]),N=Be.useCallback(()=>{c<255&&ul(a,c+1)},[a,c]),A=Be.useCallback(()=>{c<=255-C_&&ul(a,c+C_)},[a,c]),I=Be.useCallback(()=>{E.sendclose()},[E]);return Ae.jsx("group",{position:[p*kn.DRAW_CHAR_WIDTH(),g*kn.DRAW_CHAR_HEIGHT(),1],children:u&&Ae.jsxs(cx,{blockhotkeys:!0,children:[Ae.jsx(Vd,{blocking:!0,visible:!1,width:C_,height:c_e,onClick:k=>{k.intersections[0].object.worldToLocal(qG.copy(k.intersections[0].point));const L=vT(Fgt(),C_);L>=0&&L<=255&&(ul(a,L),E.sendclose())}}),Ae.jsx(uc,{MOVE_LEFT:x,MOVE_UP:T,MOVE_RIGHT:N,MOVE_DOWN:A,OK_BUTTON:I,CANCEL_BUTTON:I})]})})}const R_=8,l_e=2,$G=new Re;function Hgt(){const t=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),n=Math.floor($G.x/t),r=Math.floor($G.y/e);return{x:R_*.5+n,y:l_e*.5+r}}function jgt({chip:t,row:e,label:n,args:r,context:i}){tf(e,i);const[s]=[ou(r[0],"")],a=Xb(t,s),c=qN(a)??0,l=ef(),[u,h]=Be.useState(!1);Be.useLayoutEffect(()=>{h(!0)},[]);const d=`${c}`.padStart(2,"0"),f=n.trim(),p=(Qt[c]||Qt[Qt.BLACK]).padEnd(12," ").toLowerCase(),g=i.x-1,_=i.y+2,v=[`$green${f} ${d} ${p}
$white`];for(let k=0;k<16;++k)if(k%R_===0&&v.push(`
`),k===c){const L=k<8?"$white":"$black",U=l?L:`$${Qt[k]}`;v.push(`${U}$219`)}else v.push(`$${Qt[k]}$219`);v.push("$white"),ir(v.join(""),i,!0);const E=Be.useContext(h0),T=Be.useCallback(()=>{c>=R_&&ul(a,c-R_)},[a,c]),x=Be.useCallback(()=>{c>0&&ul(a,c-1)},[a,c]),N=Be.useCallback(()=>{c<15&&ul(a,c+1)},[a,c]),A=Be.useCallback(()=>{c<=15-R_&&ul(a,c+R_)},[a,c]),I=Be.useCallback(()=>{E.sendclose()},[E]);return Ae.jsx("group",{position:[g*kn.DRAW_CHAR_WIDTH(),_*kn.DRAW_CHAR_HEIGHT(),1],children:u&&Ae.jsxs(cx,{blockhotkeys:!0,children:[Ae.jsx(Vd,{blocking:!0,visible:!1,width:R_,height:l_e,onClick:k=>{k.intersections[0].object.worldToLocal($G.copy(k.intersections[0].point));const L=Hgt(),U=vT(L,R_);U>=0&&U<=16&&(ul(a,U),E.sendclose())}}),Ae.jsx(uc,{MOVE_LEFT:x,MOVE_UP:T,MOVE_RIGHT:N,MOVE_DOWN:A,OK_BUTTON:I,CANCEL_BUTTON:I})]})})}function Vgt({item:t,row:e,context:n}){return tf(e,n),ir(`${t}${ae(e)?`
`:""}`,n,!0),null}function Ggt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,o]=[ou(i[0],""),i[1]],c=vp(n);ir(`  $purple$16 ${c}${r}
`,s,!0);const l=Be.useContext(h0),u=Be.useCallback(()=>{l.sendmessage(MI(t,a),o),l.sendclose()},[l,t,a,o]);return n&&Ae.jsx(uc,{OK_BUTTON:u})}function qgt({chip:t,row:e,active:n,label:r,args:i,context:s}){var _;tf(e,s);const[a,o,c,l]=[ou(i[0],""),ou(i[1],((_=i[1])==null?void 0:_.toString())??""),ou(i[2],""),ou(i[3],"")],u=c||` ${o.toUpperCase()} `,h=vp(n),d=s.x-.25,f=s.y-.25;ir(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${u}${h}$onclear ${r}${ae(e)?`
`:""}`,s,!0);const p=Be.useContext(h0),g=Be.useCallback(()=>{p.sendmessage(MI(t,a)),l||p.sendclose()},[t,p,a,l]);return Ae.jsxs("group",{position:[d*kn.DRAW_CHAR_WIDTH(),f*kn.DRAW_CHAR_HEIGHT(),1],children:[Ae.jsx(Vd,{visible:!1,width:u.length+.5,height:1.5,blocking:!0,onClick:g}),n&&Ae.jsx(uc,{OK_BUTTON:g}),o&&Ae.jsx(Nw,{hotkey:o,children:g})]})}function $gt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,o]=[ou(i[0],""),i[1]],c=vp(n);ir(`  $purple$16 ${c}${r}
`,s,!0);const l=Be.useContext(h0),u=Be.useCallback(()=>{l.sendmessage(MI(t,a),o),l.sendclose()},[l,t,a,o]);return n&&Ae.jsx(uc,{OK_BUTTON:u})}function Wgt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,o]=[ou(i[0],""),i[1]],c=vp(n);ir(`  $purple$16 ${c}${r}
`,s,!0);const l=Be.useContext(h0),u=Be.useCallback(()=>{l.sendmessage(MI(t,a),o),l.sendclose()},[l,t,a,o]);return n&&Ae.jsx(uc,{OK_BUTTON:u})}function Ygt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,o,c]=[ou(i[0],""),LS(i[1],-1),LS(i[2],-1)];let l,u;o===-1?(l=0,u=31):c===-1?(l=0,u=o):(l=o,u=c);const h=Xb(t,a),d=qN(h),f=d??0,p=ef(),[g,_]=Be.useState(""),[v,E]=Be.useState(0),[T,x]=Be.useState(!1);let N=`${f}`;const A=r.trim(),I=vp(n);T&&(N=p?CA(g,v,1,"$219+"):g),s.writefullwidth=32,ir(`  # ${I}${A} $green${N}`,s,!1),s.writefullwidth=void 0,ir(`
`,s,!1);const k=Be.useCallback($=>{const q=$.alt?10:1;ul(h,Math.min(u,f+q))},[u,f,h]),L=Be.useCallback($=>{const q=$.alt?10:1;ul(h,Math.max(l,f-q))},[l,f,h]),U=Be.useCallback(()=>{x($=>{const q=!$;if(q){const G=`${d}`;_(G),E(G.length)}else{const G=parseFloat(g),X=isNaN(G)?0:G;ul(a,Math.min(u,Math.max(l,X)))}return q})},[u,l,g,a,d]);return d!==void 0&&Ae.jsxs(Ae.Fragment,{children:[n&&!T&&Ae.jsx(uc,{MOVE_LEFT:L,MOVE_RIGHT:k,OK_BUTTON:U}),T&&Ae.jsxs(cx,{blockhotkeys:!0,children:[Ae.jsx(Nw,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),Ae.jsx(Nw,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),Ae.jsx(Nw,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),Ae.jsx(uc,{MOVE_LEFT:()=>{E($=>Math.max(0,$-1))},MOVE_RIGHT:()=>{E($=>Math.min(g.length,$+1))},CANCEL_BUTTON:U,OK_BUTTON:U,keydown:$=>{switch(ar($.key)){case"delete":g.length>0&&_(q=>CA(q,v,1));break;case"backspace":v>0&&(_(q=>CA(q,v-1,1)),E(q=>Math.max(0,q-1)));break}$.key.length===1&&g.length<s.width*.5&&(_(q=>CA(q,v,0,$.key)),E(q=>q+1))}})]})]})}function Xgt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,o,c]=[ou(i[0],""),ou(i[1],""),ou(i[2],"")];let l,u;o===""?(l="L ",u=" H"):c===""?(l="L ",u=` ${o}`):(l=`${o} `,u=` ${c}`);const h=0,d=8,f=Xb(t,a),g=qN(f)??0,_=ef(),v=r.trim(),E=vp(n);ir(` $red $29 ${E}${v} `,s,!1);const x=CA("----:----",g,1,`$green${n?_?"$26":"$27":"$4"}${E}`).replaceAll("-","$7").replaceAll(":","$9");ir(`${E}${l}${x}${u} $green${g+1}
`,s,!1);const N=Be.useCallback(I=>{const k=I.alt?10:1;ul(f,Math.min(d,g+k))},[d,g,f]),A=Be.useCallback(I=>{const k=I.alt?10:1;ul(f,Math.max(h,g-k))},[h,g,f]);return Ae.jsx(Ae.Fragment,{children:n&&Ae.jsx(uc,{MOVE_LEFT:A,MOVE_RIGHT:N})})}function Kgt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a,...o]=[ou(i[0],""),...i.slice(1)],c=[],l=[];for(let x=0;x<o.length;x+=2)c.push(o[x]),l.push(o[x+1]);const u=Xb(t,a),d=`${qN(u)??0}`;let f=l.indexOf(d);f<0&&(f=0);const p=ef(),g=r.trim(),_=vp(n);ir(` $dkred ? ${_}${g} `,s,!1);const v=n?p?"$26":"$27":"/";ir(`${f+1}$green${v}${_}${l.length}`,s,!1),s.writefullwidth=32,ir(` $green${c[f]}`,s,!1),s.writefullwidth=void 0,ir(`
`,s,!1);const E=Be.useCallback(()=>{const x=Math.min(0,f-1),N=parseFloat(l[x]);Number.isInteger(N)&&ul(u,N)},[f,u]),T=Be.useCallback(()=>{const x=Math.max(l.length-1,f+1),N=parseFloat(l[x]);Number.isInteger(N)&&ul(u,N)},[f,u]);return Ae.jsx(Ae.Fragment,{children:n&&Ae.jsx(uc,{MOVE_LEFT:E,MOVE_RIGHT:T})})}function Jgt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const a=ou(i[0],""),o=Xb(t,a),c=ope(o),l=(c==null?void 0:c.toJSON())??"",u=ef(),[h,d]=Be.useState(0),[f,p]=Be.useState(!1),[g,_]=Be.useState(void 0),v=`${l} `,E=r.trim(),T=vp(n);ir(`$green  $20 ${T}${E} $green`,s,!1);const x=s.x,A=s.y*s.width;s.writefullwidth=32,ir(`${v}`,s,!1),s.writefullwidth=void 0,ir(`
`,s,!1);const I=ae(g),k=s.width-x-2,L=I?Math.min(g,h):h;let U=I?Math.max(g,h):h;I&&(U!==L&&U===h&&--U,vO(x+L+A,x+U+A,15,8,s)),f&&u&&DB(x+h+A,"Û",s);function $(){ae(c)&&(d(L),_(void 0),c.delete(L,U-L+1))}return Ae.jsxs(Ae.Fragment,{children:[n&&Ae.jsx(uc,{OK_BUTTON:()=>{c&&(p(!0),d(c.length),_(void 0))}}),f&&Ae.jsx(cx,{blockhotkeys:!0,children:Ae.jsx(uc,{MOVE_LEFT:q=>{q.shift?ae(g)||_(Ei(h-1,0,l.length)):_(void 0),d(G=>Ei(G-1,0,l.length))},MOVE_RIGHT:q=>{q.shift?ae(g)||_(h):_(void 0),d(G=>Ei(G+1,0,l.length))},CANCEL_BUTTON:()=>{p(!1),d(l.length),_(void 0)},OK_BUTTON:()=>p(!1),keydown:q=>{if(!c)return;const{key:G}=q,X=ar(G),re={alt:q.altKey,ctrl:Ob?q.metaKey:q.ctrlKey,shift:q.shiftKey},V=c.toJSON();switch(X){case"delete":I?$():V.length>0&&c.delete(h,1);break;case"backspace":I?$():h>0&&(c.delete(h-1,1),d(Z=>Math.max(0,Z-1)));break;default:if(re.ctrl)switch(X){case"a":_(0),d(V.length);break;case"c":ae(Ia())&&Ia().writeText(c.toJSON()).catch(Z=>console.error(Z));break;case"v":ae(Ia())&&Ia().readText().then(Z=>{I&&$(),c.insert(h,Z),d(h+Z.length)}).catch(Z=>console.error(Z));break;case"x":ae(Ia())&&Ia().writeText(c.toJSON()).then(()=>$()).catch(Z=>console.error(Z));break}else re.alt||G.length===1&&V.length<k&&(c.insert(h,G),d(Z=>Z+1));break}}})})]})}function Zgt({chip:t,row:e,active:n,label:r,args:i,context:s}){tf(e,s);const[a]=[ou(i[0],"")],o="z",c=` ${o.toUpperCase()} `,l=vp(n),u=s.x-.25,h=s.y-.25;ir(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${ae(e)?`
`:""}`,s,!0);const d=Be.useContext(h0),f=Be.useCallback(()=>{d.sendmessage(MI(t,a),void 0)},[d,t,a]);return Ae.jsxs("group",{position:[u*kn.DRAW_CHAR_WIDTH(),h*kn.DRAW_CHAR_HEIGHT(),1],children:[Ae.jsx(Vd,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:f}),n&&Ae.jsx(uc,{OK_BUTTON:f}),Ae.jsx(Nw,{hotkey:o,children:f})]})}function Qgt({row:t,item:e,active:n}){const r=ni(),i=mm();if(tf(t,i),i.iseven=i.y%2===0,typeof e=="string")return Ae.jsx(Vgt,{player:r,item:e,row:t,context:i});if(Lr(e)){const[s,a,o,c,...l]=e;if(typeof s!="string"||typeof a!="string"||typeof o!="string")return null;const u={player:r,chip:s,row:t,active:n,label:a,args:[o,...l],context:i},h=On(c)?c:"";switch(ar(h)){default:case"hyperlink":return Ae.jsx($gt,{...u});case"hk":case"hotkey":return Ae.jsx(qgt,{...u});case"rn":case"range":return Ae.jsx(Xgt,{...u});case"sl":case"select":return Ae.jsx(Kgt,{...u});case"nm":case"number":return Ae.jsx(Ygt,{...u});case"tx":case"text":return Ae.jsx(Jgt,{...u});case"copyit":return Ae.jsx(Ggt,{...u});case"linkit":return Ae.jsx(Wgt,{...u});case"zssedit":return Ae.jsx(Zgt,{...u});case"charedit":return Ae.jsx(zgt,{...u});case"coloredit":return Ae.jsx(jgt,{...u})}kB(i)}return null}function OI({store:t,children:e}){return Ae.jsx(l9.Provider,{value:t,children:e})}function NI({width:t,height:e}){const n=Be.useContext(l9),[r,i,s]=m7(n,up(a=>[a.char,a.color,a.bg,a.render]));return t>0&&e>0&&Ae.jsx(UY,{char:r.slice(),color:i.slice(),bg:s.slice(),width:t,height:e})}function HY({inline:t=!1,xmargin:e=1,ymargin:n=1,selected:r=-1,width:i,height:s,color:a,bg:o,text:c}){const l=KN(i,s,0,a,o),u=l.getState(),h={...eE(i,s,a,o,n,e,i-e,s-n),...l.getState(),x:e,y:n};return Ype(u,0,a,o),Ae.jsxs(OI,{store:l,children:[Ae.jsx(NI,{width:i,height:s}),Ae.jsx(O_.Provider,{value:h,children:c.map((d,f)=>Ae.jsx(Qgt,{row:t?void 0:f,item:d,active:f===r},f))})]})}const e0t=2,t0t=14,u_e=t0t*e0t;function n0t(t){return W3(t,u_e*.5)}function r0t(t,e,n,r,i=1.235){function s(o){return Cft(o,r)}Kv(t.userData,e,n,i,r,u_e*12,s),t.position[e]=n0t(t.userData[e]);const a=n-t.position.y;return Math.abs(a)<.1}function i0t({name:t,width:e,height:n,context:r}){const i=Xpe();for(let l=1;l<e-1;++l)l>2&&l<e-1&&ko(i,e,n,l,1,{char:205,color:15}),ko(i,e,n,l,n-1,{char:205,color:15});ko(i,e,n,e-2,0,{char:196,color:15}),ko(i,e,n,1,0,{char:205,color:15}),ko(i,e,n,2,0,{char:187,color:15}),ko(i,e,n,2,1,{char:200,color:15});for(let l=1;l<n-1;++l)ko(i,e,n,0,l,{char:179,color:15}),ko(i,e,n,e-1,l,{char:179,color:15});for(let l=2;l<n-1;++l)ko(i,e,n,1,l,{char:0,color:15}),ko(i,e,n,e-2,l,{char:0,color:15});ko(i,e,n,0,0,{char:213,color:15}),ko(i,e,n,e-1,0,{char:191,color:15}),ko(i,e,n,e-1,1,{char:181,color:15}),ko(i,e,n,0,n-1,{char:212,color:15}),ko(i,e,n,e-1,n-1,{char:190,color:15});const s=` ${t} `,a=XN(s,e,n),o=(a==null?void 0:a.x)??s.length,c=e-2;return r.x=2+Math.round(c*.5),r.x-=Math.round(o*.5),r.y++,ir(s,r,!0),null}function Gre({x:t,y:e,color:n,on:r=232,off:i=7,alt:s}){const a=ef(),o=Xpe(),c=Be.useRef(0),l=ae(s)?c.current%2===0?r:s:r;return ko(o,o.width,o.height,t,e,{char:a?l:i,color:n}),o.changed(),a&&++c.current,null}function s0t({store:t,children:e}){return Ae.jsx($pe.Provider,{value:t,children:e})}function a0t({width:t,height:e}){const n=Be.useContext($pe),[r]=m7(n,up(i=>[i.dither,i.render]));return t>0&&e>0&&Ae.jsx(AI,{alphas:r.slice(),width:t,height:e})}function o0t({row:t,width:e,height:n,panelwidth:r,panelheight:i,children:s}){const a=hqe(r,i,0),o=[.001,.05,.1,.2],c=.4,{dither:l}=a.getState();uqe(l);for(let u=0;u<r;++u){_H(l,r,i,u,t,c);for(let h=0;h<o.length;++h){const d=o.length-h;_H(l,r,i,u,t-d,o[h]),_H(l,r,i,u,t+d,o[h])}}return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(NI,{width:e,height:n}),Ae.jsxs("group",{position:[2*kn.DRAW_CHAR_WIDTH(),2*kn.DRAW_CHAR_HEIGHT(),0],children:[Ae.jsx(s0t,{store:a,children:Ae.jsx(a0t,{width:r,height:i})}),s,Ae.jsx(Gre,{x:1,y:1}),Ae.jsx(Gre,{x:1,y:2+t,on:26,alt:27,off:45,color:12})]})]})}function jY({line:t,color:e,margin:n,y:r,leftedge:i,rightedge:s,context:a}){const o=ef(),l=`$${(Qt[e]??"").toLowerCase()} ${t.replaceAll(`
`,"").trim()} --=--`,u=XN(l,1e4,1),h=(u==null?void 0:u.measuredwidth)??1,[d,f]=Be.useState(0);Be.useEffect(()=>{f(p=>o?p:(p-1)%h)},[o,h]),a.disablewrap=!0,a.active.leftedge=n,a.active.rightedge=s-n;for(let p=i+n+d;p<=s;p+=h)a.x=p,a.y=r,ir(l,a,!1);return a.active.leftedge=0,a.active.rightedge=s,a.disablewrap=!1,null}function c0t({name:t,width:e,height:n,color:r,bg:i,text:s,shouldclose:a}){const{viewport:o}=Zu(),c=e-3,l=n-3,u=KN(e,n,0,r,i),h=Be.useContext(h0),d={...eE(e,n,r,i,0,0,e,n),...u.getState()},[f,p]=Be.useState(()=>{const A=s.findIndex(I=>Lr(I));return A>=0&&A<=8?A:0});let g=f-Math.floor(l*.5);g=Math.min(s.length-l,g),g=Math.max(0,g);const _=s.slice(g,g+l),v=f-g,E=Be.useRef(null),T=Be.useCallback(()=>{a&&h.didclose()},[a,h]),x=Be.useCallback(A=>{const I=A.alt?10:1;p(k=>Math.max(0,k-I))},[p]),N=Be.useCallback(A=>{const I=A.alt?10:1;p(k=>Math.min(s.length,k+I))},[p,s.length]);return Be.useEffect(()=>{if(E.current&&!a){const A=o.height;E.current.position.y=A,E.current.userData.y=A,E.current.userData.vy=0}},[a]),fy(Be.useCallback((A,I)=>{if(ae(E.current)){const k=a?n*2*-kn.DRAW_CHAR_HEIGHT():0;r0t(E.current,"y",k,I)&&T()}},[a,T,n])),Ae.jsx("group",{ref:E,"position-y":1e6,children:Ae.jsxs(cx,{children:[Ae.jsx(uc,{MOVE_UP:x,MOVE_DOWN:N,CANCEL_BUTTON:h.sendclose}),Ae.jsxs(OI,{store:u,children:[Ae.jsx(i0t,{name:t,width:e,height:n,context:d}),Ae.jsx(jY,{margin:3,color:Qt.BLUE,y:0,leftedge:0,rightedge:e-1,line:`
   up/down$white.SCROLL UP/DOWN   $blue
esc/cancel$white.CLOSE SCROLL   $blue
alt+up/down$white.JUMP 10 LINES   $blue
`,context:d}),Ae.jsx(o0t,{row:v,width:e,height:n,panelwidth:c,panelheight:l,children:Ae.jsx(HY,{name:t,width:c,height:l,xmargin:0,ymargin:0,color:r,bg:Qt.ONCLEAR,text:_,selected:v})})]})]})})}const qre=new Rt,$re=[153,5,42,94,24,25,26,27,16,17,30,31,234,227,227].map((t,e)=>[t,e%3===0?176:177,e%3===0?178:176]).flat();function l0t({context:t,width:e,height:n,drawstick:r}){const{islandscape:i,sidebaropen:s,showkeyboard:a}=Vh();if(Ype(t,0,Qt.WHITE,Qt.ONCLEAR),!i){const o=e*n;for(let c=4*e;c<o;++c)t.char[c]=s?$re[c%$re.length]:0,t.color[c]=s?Qt.DKPURPLE:Qt.ONCLEAR}t.y=3;for(let o=0;o<3;++o)t.x=t.active.leftedge=1,ir("$YELLOW$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,ir(`$WHITE$176$176$176$176$176
`,t,!1);t.y=n-5;for(let o=0;o<3;++o)t.x=t.active.leftedge=1,ir("$GREEN$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,ir(`$RED$176$176$176$176$176
`,t,!1);if(t.y=n-5,t.active.leftedge=1,t.active.bg=Qt.ONCLEAR,a?(++t.y,t.x=Math.round((e-8)*.5),ir("$GREY$221",t,!1),t.x+=5,ir(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),ir("$GREY$221",t,!1),t.x+=3,ir(`$GREY$222
`,t,!1),t.x=Math.round((e-4)*.5),ir("$GREY$221",t,!1),++t.x,ir(`$GREY$222
`,t,!1)):(t.x=Math.round((e-4)*.5),ir("$GREY$221",t,!1),++t.x,ir(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),ir("$GREY$221",t,!1),t.x+=3,ir(`$GREY$222
`,t,!1),t.x=Math.round((e-8)*.5),ir("$GREY$221",t,!1),t.x+=5,ir(`$GREY$222
`,t,!1)),r.startx!==-1){t.active.leftedge=0,t.x=t.active.leftedge=r.startx-4,t.y=r.starty-3;for(let c=0;c<5;++c)ir(`$BLUE$176$176$176$176$176$176$176$176
`,t,!1);qre.set(r.tipx-r.startx,r.tipy-r.starty);const o=Oue(W3(Nue(qre.angle()),45));t.x=t.active.leftedge=Math.round(r.startx+Math.cos(o)*4)-2,t.y=Math.round(r.starty+Math.sin(o)*3)-2;for(let c=0;c<3;++c)ir(`$BLUE$177$177$177$177
`,t,!1)}return i||(t.active.leftedge=1,t.y=4,t.x=2,ir("$YELLOW?",t,!1),t.x=e-7,ir("$WHITEMENU",t,!1),t.y=n-4,t.x=2,ir("$GREENOKAY",t,!1),t.x=e-9,ir("$REDCANCEL",t,!1)),null}function u0t(t,e){switch(t){case 0:Nd.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(Vu);break;case 45:Nd.keyboard(e?"{Shift>}[ArrowLeft][ArrowUp]{/Shift}":"[ArrowLeft][ArrowUp]").catch(Vu);break;case 90:Nd.keyboard(e?"{Shift>}[ArrowUp]{/Shift}":"[ArrowUp]").catch(Vu);break;case 135:Nd.keyboard(e?"{Shift>}[ArrowRight][ArrowUp]{/Shift}":"[ArrowRight][ArrowUp]").catch(Vu);break;case 180:Nd.keyboard(e?"{Shift>}[ArrowRight]{/Shift}":"[ArrowRight]").catch(Vu);break;case 225:Nd.keyboard(e?"{Shift>}[ArrowRight][ArrowDown]{/Shift}":"[ArrowRight][ArrowDown]").catch(Vu);break;case 270:Nd.keyboard(e?"{Shift>}[ArrowDown]{/Shift}":"[ArrowDown]").catch(Vu);break;case 315:Nd.keyboard(e?"{Shift>}[ArrowLeft][ArrowDown]{/Shift}":"[ArrowLeft][ArrowDown]").catch(Vu);break;case 360:Nd.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(Vu);break}}const h0t=HO/1e3,cA=new Rt,rw=new Re;function lA(t,e){const n=kn.DRAW_CHAR_WIDTH(),r=kn.DRAW_CHAR_HEIGHT(),i=rw.x+n*.5,s=rw.y+r*.5;return{cx:Math.floor(t*.5)+Math.floor(i/n),cy:Math.floor(e*.5)+Math.floor(s/r)}}function d0t({width:t,height:e,player:n,onDrawStick:r}){const{islandscape:i}=Vh(),[s]=Be.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,presscount:0,inputacc:HO});function a(o,c){s.tipx===-1&&(T_(o,c,3,6,6,1)?VDe(Ge,n):T_(o,c,3,t-2,6,t-6)?Nd.keyboard("[Tab]").catch(Vu):T_(o,c,e-5,6,e-2,1)?Nd.keyboard("[Enter]").catch(Vu):T_(o,c,e-5,t-2,e-2,t-6)?Nd.keyboard("[Escape]").catch(Vu):i&&T_(o,c,6,t,e-6,t-5)||!i&&T_(o,c,0,t-12,3,12)?Vh.setState(l=>({...l,sidebaropen:!l.sidebaropen})):T_(o,c,e-4,t-12,e-2,12)&&Vh.setState({showkeyboard:!0})),s.startx=-1,s.starty=-1,s.tipx=-1,s.tipy=-1,s.pointerid=-1,r(s.startx,s.starty,s.tipx,s.tipy)}return fy((o,c)=>{if(s.inputacc+=c,s.inputacc>=h0t&&s.presscount>0){s.inputacc=0;const{cx:l,cy:u}=lA(t,e);if(cA.set(s.startx-l,s.starty-u),s.tipx!==-1||cA.length()>3){const h=W3(Nue(cA.angle()),45);u0t(h,s.presscount>1)}}}),Ae.jsx(Vd,{width:t,height:e,visible:!1,onPointerDown:o=>{if(sE(),++s.presscount,s.startx===-1){o.intersections[0].object.worldToLocal(rw.copy(o.intersections[0].point));const{cx:c,cy:l}=lA(t,e);s.startx=c,s.starty=l,s.tipx=-1,s.tipy=-1,s.pointerid=o.pointerId,s.inputacc=HO}},onPointerMove:o=>{if(o.pointerId===s.pointerid){o.intersections[0].object.worldToLocal(rw.copy(o.intersections[0].point));const{cx:c,cy:l}=lA(t,e);cA.set(s.startx-c,s.starty-l),(s.tipx!==-1||cA.length()>3)&&(s.tipx=c,s.tipy=l,r(s.startx,s.starty,s.tipx,s.tipy))}},onPointerCancel:o=>{if(--s.presscount,o.pointerId===s.pointerid){o.intersections[0].object.worldToLocal(rw.copy(o.intersections[0].point));const{cx:c,cy:l}=lA(t,e);a(c,l)}},onPointerUp:o=>{if(--s.presscount,o.pointerId===s.pointerid){o.intersections[0].object.worldToLocal(rw.copy(o.intersections[0].point));const{cx:c,cy:l}=lA(t,e);a(c,l)}}})}function f0t({width:t,height:e}){const n=ni(),[r,i]=Be.useState({startx:-1,starty:-1,tipx:-1,tipy:-1}),s=KN(t,e,0,Qt.WHITE,Qt.ONCLEAR),a={...eE(t,e,Qt.WHITE,Qt.ONCLEAR),...s.getState()};return cqe(1,1,t-2,e-2,a),Ae.jsxs(OI,{store:s,children:[Ae.jsx(l0t,{context:a,width:t,height:e,drawstick:r}),Ae.jsx(d0t,{width:t,height:e,player:n,onDrawStick:(o,c,l,u)=>i({startx:o,starty:c,tipx:l,tipy:u})}),Ae.jsx(zO,{width:t,height:e,top:5,left:0,right:5,bottom:e-6,alpha:.47135}),Ae.jsx(zO,{width:t,height:e,top:5,left:t-6,right:t-1,bottom:e-6,alpha:.47135}),Ae.jsx(NI,{width:t,height:e})]})}const Wre=1.5,Yre=56,p0t=16,m0t=[[`
`],["[Escape]","$","1","2","3","4","5","6","7","8","9","0","&",`
`],[" ","Q","W","E","R","T","Y","U","I","O","P","-","+","*",`
`,`
`],["A","S","D","F","G","H","J","K","L","[Backspace]","_","=","%",`
`],[" ","Z","X","C","V","B","N","M","!","[Enter]","(",")","|",`
`],["                                          ","<",">","`",`
`],["[Space]","#","/","?",":","'",";",'"',"  ","[ArrowUp]",`
`],["         ","[Shift]","[Ctrl]","[Alt]","@","[ArrowLeft]","    ","[ArrowRight]",`
`],["                                      ","[ArrowDown]",`
`],["$greenz s s k e y s"]].flat();function g0t(t){return t.replaceAll("{","").replaceAll("}","").replaceAll("[","").replaceAll("]","")}function v0t(t,e,n,r){let i=t,s=g0t(t);switch(t){case"$":s=" $$ ";break;case";":s=" $59 ";break;case"[Escape]":s=" esc ";break;case"[ArrowUp]":s=" $30 ";break;case"[ArrowDown]":s=" $31 ";break;case"[ArrowRight]":s=" $16 ";break;case"[ArrowLeft]":s=" $17 ";break;case"[Backspace]":s=" del ";break;case"[Shift]":s=r?" SHIFT ":" shift ";break;case"[Ctrl]":s=n?" CTRL ":" ctrl ";break;case"[Alt]":s=e?" ALT ":" alt ";break;default:if(!r)i=i.toLowerCase(),s=s.toLowerCase();else switch(s){case"(":s="[";break;case")":s="]";break;case"<":s="{";break;case">":s="}";break;case"`":s="~";break}s=` ${s} `;break}return["touchkey","",i,"hk","",s]}function y0t({width:t,height:e}){const n=ni(),{showkeyboard:r,keyboardalt:i,keyboardctrl:s,keyboardshift:a}=Vh(),o=Be.useRef(null),[c]=Be.useState({}),l=16;return r&&Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(Vd,{blocking:!0,width:t,height:e,visible:!1,onPointerDown:u=>{sE(),c[u.pointerId]=u.point.x,ae(o.current)&&(o.current.userData.x=o.current.position.x)},onPointerMove:u=>{const h=c[u.pointerId],d=u.point.x;if(ae(h)&&o.current){const f=kn.DRAW_CHAR_WIDTH()*Wre,p=Math.round(W3(d-h,f)/f);o.current.position.x=Ei(o.current.userData.x+p*f,Yre*-f+t*kn.DRAW_CHAR_WIDTH(),0)}},onPointerUp:u=>{delete c[u.pointerId]}}),Ae.jsx(zO,{width:t,height:e,top:5,left:0,right:t-1,bottom:e-1,alpha:.753718}),Ae.jsx("group",{position:[0,0,1],children:Ae.jsx(Vd,{visible:!1,x:t*.5-l*.5,y:e-3.5,width:l,height:4,onClick:()=>{Vh.setState({showkeyboard:!1})}})}),Ae.jsx("group",{ref:o,scale:Wre,children:Ae.jsx(h0.Provider,{value:{sendmessage(u,h){Ge.emit(n,u,h)},sendclose(){},didclose(){}},children:Ae.jsx(HY,{name:"keyboard",inline:!0,ymargin:1,color:Qt.WHITE,bg:Qt.ONCLEAR,width:Yre,height:p0t,text:m0t.map(u=>{switch(u){case`
`:return u;default:if(u.includes(" "))return u}return v0t(u,i,s,a)})})})})]})}function _0t({width:t,height:e}){const n=ez();return n.cols<10||n.rows<10?null:Ae.jsxs(Ae.Fragment,{children:[Ae.jsx("group",{position:[0,0,800],children:Ae.jsx(f0t,{width:t,height:e})}),Ae.jsx("group",{position:[0,0,850],children:Ae.jsx(y0t,{width:t,height:e})})]})}const h_e=Be.createContext({cols:1,rows:1});function ez(){return Be.useContext(h_e)}function b0t({children:t}){const{viewport:e}=Zu(),{width:n,height:r}=e.getCurrentViewport(),{islandscape:i,showtouchcontrols:s}=Vh(),a=n/kn.DRAW_CHAR_WIDTH();let o=Math.floor(a);const c=r/kn.DRAW_CHAR_HEIGHT();let l=Math.floor(c);const u=(n-o*kn.DRAW_CHAR_WIDTH())*.5,h=(r-l*kn.DRAW_CHAR_HEIGHT())*.5;let d=0,f=0;const p=Math.round(a);let g=Math.round(c);if(s)if(i)d=5*kn.DRAW_CHAR_WIDTH(),o-=5*2;else{l=Math.round(l*.666);const _=l-4;g-=_,f=_*kn.DRAW_CHAR_HEIGHT()}return Be.useEffect(()=>{Vh.setState(_=>({..._,insetcols:p,insetrows:g}))},[p,g]),Ae.jsxs(h_e.Provider,{value:{cols:o,rows:l},children:[Ae.jsx(Ift,{makeDefault:!0,near:1,far:2e3,position:[0,0,1e3]}),o>=10&&l>=10&&Ae.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:Ae.jsxs("group",{position:[n*-.5+u,r*-.5+h,0],children:[Ae.jsx("group",{position:[d,0,0],children:t}),s&&Ae.jsx("group",{position:[0,f,0],children:Ae.jsx(_0t,{width:p,height:g},p*g)})]})})]})}function Xre({rect:t,islandscape:e=!0,sidebaropen:n=!0,shouldclose:r=!1}){switch(t.type){case 0:return Ae.jsx(HY,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,xmargin:e?1:n?3:10,ymargin:e&&!n?6:0});case 1:return Ae.jsx(c0t,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,shouldclose:r});case 2:return Ae.jsx(Bgt,{width:t.width,height:t.height})}return null}const y1=20;function E0t(){const t=ez(),{islandscape:e,sidebaropen:n,insetrows:r,showtouchcontrols:i}=Vh(),s=Eo(PZ(p=>p.gadget.scroll??[])),a=s.length===0,[o,c]=Be.useState(!1),l=Eo(PZ(p=>p.gadget.sidebar??[]));if(t.cols<10||t.rows<10)return null;const u={name:"main",type:2,x:0,y:0,text:[],width:t.cols,height:t.rows},h=[];if(l.length)if(i)if(e){const p=n?y1+5:y1,g=n?y1:4,_={name:"sidebar",type:0,x:u.x+u.width-g,y:u.y,width:p,height:u.height,text:l};u.width-=g,h.push(_)}else{const p=n?r-7:r,g=n?p:4,_={name:"sidebar",type:0,x:0,y:u.y+u.height-g,width:u.width,height:p,text:l};u.height-=g,h.push(_)}else{const p={name:"sidebar",type:0,x:u.x+u.width-y1,y:u.y,width:y1,height:u.height,text:l};u.width-=y1,h.push(p)}const d={name:"scroll",type:1,x:0,y:0,width:Ei(50,24,u.width-2),height:Ei(18,8,u.height-8),text:s};d.x=u.x+Math.floor((u.width-d.width)*.5),d.y=u.y+Math.floor((u.height-d.height)*.5),!a&&!o&&c(!0),h.unshift(u);const f=ni();return Ae.jsx(h0.Provider,{value:{sendmessage(p,g){Ge.emit(f,p,g)},sendclose(){MDe(Ge,f)},didclose(){c(!1)}},children:Ae.jsxs("group",{position:[0,0,-512],children:[h.map(p=>Ae.jsx("group",{position:[p.x*kn.DRAW_CHAR_WIDTH(),p.y*kn.DRAW_CHAR_HEIGHT(),0],children:Ae.jsx(Xre,{islandscape:!i||e,sidebaropen:!i||n,rect:p})},p.name)),o&&Ae.jsxs(xg.Fragment,{children:[Ae.jsx("group",{position:[0,0,800],children:Ae.jsx(agt,{width:t.cols,height:t.rows,alpha:.14})}),Ae.jsx("group",{position:[d.x*kn.DRAW_CHAR_WIDTH(),d.y*kn.DRAW_CHAR_HEIGHT(),900],children:Ae.jsx(Xre,{rect:d,shouldclose:a})})]},"scroll")]})})}const S0t=250,T0t=249,jO=Qt.BLUE,x0t=Qt.WHITE,w0t=Qt.DKGRAY,VY=Qt.BLACK;function hR(t){return t?Qt.ONCLEAR:Qt.DKBLUE}const d_e=Be.createContext({sendmessage(){}});function eT(t,e,n,r,i){const s=pm(i);i.iseven=i.y%2===0,i.active.bg=e&&!t?VY:i.reset.bg,i.active.leftedge=s.left,i.active.rightedge=s.right,i.active.topedge=s.top,i.active.bottomedge=s.bottom,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function MS(t,e,n,r,i,s,a,o){const c=pm(i);i.iseven=i.y%2===0,i.active.color=Qt.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+a,i.active.bottomedge=c.bottom-o,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function C0t(t){let e=0;return t.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function R0t(t){return t.reduce((e,n)=>{const r=n.code.length;return r>e?r:e},0)}function A0t(t,e){for(let n=0;n<e.length;++n)if(t<=e[n].end)return n;return 0}function GY({bump:t,context:e}){const n=pm(e),{quickterminal:r}=Us(),i=hR(r);if(t&&n.top++,r){for(let s=n.top;s<=n.bottom;++s)for(let a=n.left;a<=n.right;++a)ko(e,e.width,e.height,a,s,{char:0,color:jO,bg:i});return null}for(let s=n.top;s<=n.bottom;++s)for(let a=n.left;a<=n.right;++a){let o=0;(a+s)%2===0&&(o=Math.abs(Math.round(Math.cos(a*s*.01)))?S0t:T0t),ko(e,e.width,e.height,a,s,{char:o,color:jO,bg:i})}return null}const oj=Qt.WHITE,iw=Qt.GREEN,Tc=Qt.YELLOW,M0t=Qt.CYAN,Dd=Qt.DKGREEN;Qt.DKGREEN;const Kre=Qt.DKCYAN,O0t=Qt.GREEN,BP=Qt.BLUE,f_e=Qt.DKPURPLE,p_e=Qt.WHITE,N0t=Qt.DKRED,cj=Qt.DKYELLOW,I0t={[lC.tokenTypeIdx??0]:oj,[Xde.tokenTypeIdx??0]:oj,[Kde.tokenTypeIdx??0]:oj,[BN.tokenTypeIdx??0]:BP,[AS.tokenTypeIdx??0]:Tc,[_B.tokenTypeIdx??0]:iw,[Z7.tokenTypeIdx??0]:M0t,[Q7.tokenTypeIdx??0]:N0t,[eW.tokenTypeIdx??0]:Tc,[tW.tokenTypeIdx??0]:iw,[vl.tokenTypeIdx??0]:iw,[nW.tokenTypeIdx??0]:iw,[rW.tokenTypeIdx??0]:p_e,[iW.tokenTypeIdx??0]:Tc,[sW.tokenTypeIdx??0]:Tc,[aW.tokenTypeIdx??0]:Tc,[oW.tokenTypeIdx??0]:Tc,[cW.tokenTypeIdx??0]:Tc,[lW.tokenTypeIdx??0]:Tc,[P2.tokenTypeIdx??0]:cj,[L2.tokenTypeIdx??0]:cj,[U2.tokenTypeIdx??0]:cj,[B2.tokenTypeIdx??0]:Tc,[F2.tokenTypeIdx??0]:Tc,[uW.tokenTypeIdx??0]:Tc,[hW.tokenTypeIdx??0]:Tc,[z2.tokenTypeIdx??0]:Tc,[dW.tokenTypeIdx??0]:Tc,[fW.tokenTypeIdx??0]:Tc,[pW.tokenTypeIdx??0]:Tc,[mW.tokenTypeIdx??0]:Tc,[gW.tokenTypeIdx??0]:Tc,[vW.tokenTypeIdx??0]:O0t,[H2.tokenTypeIdx??0]:Dd,[nM.tokenTypeIdx??0]:Kre,[j2.tokenTypeIdx??0]:Kre,[V2.tokenTypeIdx??0]:Dd,[yW.tokenTypeIdx??0]:Dd,[_W.tokenTypeIdx??0]:Dd,[bW.tokenTypeIdx??0]:Dd,[EW.tokenTypeIdx??0]:Dd,[SW.tokenTypeIdx??0]:Dd,[TW.tokenTypeIdx??0]:Dd};Qt.DKPURPLE;const k0t=Qt.DKYELLOW,D0t=f_e,P0t=Qt.CYAN,L0t=Qt.DKCYAN,U0t=Qt.RED,B0t=Qt.WHITE,F0t=Qt.LTGRAY,m_e=new Map;function ng(t,e){m_e.set(t,e)}function z0t(t){if(t.startsWith("play ")){const e=[];for(let n=0;n<t.length;++n)n<5?e.push(Dd):e.push(eie(t[n]));return e.push(Qt.BLUE),e}else if(t.startsWith("bgplay ")){const e=[];for(let n=0;n<t.length;++n)n<7?e.push(Dd):e.push(eie(t[n]));return e.push(Qt.BLUE),e}return m_e.get(t)??Qt.GREEN}const dS=Qt.GREEN,H0t=Qt.DKGREEN,rg=Qt.PURPLE,fS=Qt.DKCYAN,Jre=Qt.CYAN,Zre=Qt.YELLOW,Qre=Qt.DKYELLOW,g_e=new Map;function rs(t,e){g_e.set(t,e)}function eie(t){return g_e.get(t)??Qt.GREEN}function j0t(){const t=mm(),e=pm(t),[n,r,i]=Us(up(v=>[v.quickterminal,v.editor.type,v.editor.title])),s=Qt.WHITE,a=hR(n);for(let v=e.top;v<e.bottom;++v)ko(t,t.width,t.height,e.left,v,{char:179,color:s,bg:a}),ko(t,t.width,t.height,e.right,v,{char:179,color:s,bg:a});MS(!1,!1,0,0,t,0,0,0),ir("$213$205$187",t,!0),MS(!1,!1,t.width-3,0,t,0,0,0),ir("$196$196$191",t,!0);const o="$205".repeat(e.width-2);MS(!1,!1,0,e.height-1,t,0,0,0),ir(`$212${o}$190`,t,!0);const c=ef(),l="$205".repeat(e.width-4);MS(!1,!1,0,1,t,0,0,0),ir(`$179$${c?"7":"232"}$200${l}$181`,t,!0);const h=` ${`$blue[${r}] `}$green${i}$white `,d=XN(h,e.width,e.height),f=(d==null?void 0:d.measuredwidth)??1,p=e.width-2,g=2+Math.round(p*.5)-Math.round(f*.5);MS(!1,!1,g,1,t,0,0,0),ir(h,t,!0);const _=Ob?`shift+${Ad}+z`:`${Ad}+y`;return Ae.jsx(jY,{margin:3,color:Qt.BLUE,y:e.top,leftedge:0,rightedge:e.width-1,line:`
    esc/cancel$white.CLOSE   $blue
    tab$white.CHANGE LAYOUT   $blue
    hold shift$white.SELECT TEXT   $blue
    alt+up/down$white.JUMP 10 LINES   $blue
    alt+left/right$white.JUMP 10 COLS   $blue
    ${Ad}+up/down$white.JUMP TOP/BOTTOM   $blue
    ${Ad}+left/right$white.JUMP TO START/END OF LINE   $blue
    ${Ad}+a$white.SELECT ALL   $blue
    ${Ad}+c$white.COPY   $blue
    ${Ad}+x$white.CUT   $blue
    ${Ad}+v$white.PASTE   $blue
    ${Ad}+z$white.UNDO   $blue
    ${_}$white.REDO   $blue
    ${Ad}+p$white.TEST SELECTED CODE   $blue
    ${Ad}+k$white.PICK REFSHEET   $blue
    ${Ad}+e$white.COPY CODEPAGE TO CLIPBOARD AS JSON   $blue
    `,context:t})}const V0t=t=>{const e="nativeEvent"in t?t.nativeEvent:t;return{deltaX:e.deltaX||0,deltaY:e.deltaY||0,deltaZ:e.deltaZ||0,timeStamp:e.timeStamp}},G0t=t=>[t.deltaX,t.deltaY,t.deltaZ],ID=t=>{const e=G0t(t).map(Math.abs);return Math.max(...e)};var L_;(function(t){t.ALL_OTHER_CHECKS_FAILED="ALL_OTHER_CHECKS_FAILED",t.NO_PREVIOUS_EVENT_TO_COMPARE="NO_PREVIOUS_EVENT_TO_COMPARE",t.PAST_TIMESTAMP_EVENT="PAST_TIMESTAMP_EVENT",t.ENOUGH_TIME_PASSED="ENOUGH_TIME_PASSED",t.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN="NON_DECREASING_DELTAS_OF_KNOWN_HUMAN",t.DELTA_MODULE_HAS_BEEN_INCREASING="DELTA_MODULE_HAS_BEEN_INCREASING"})(L_||(L_={}));class q0t{constructor({sensitivity:e=2,delay:n=100,increasingDeltasThreshold:r=3}={}){Qn(this,"sensitivity");Qn(this,"delay");Qn(this,"increasingDeltasThreshold");Qn(this,"previousEvents");this.sensitivity=Math.max(1,e),this.delay=Math.max(1,n),this.increasingDeltasThreshold=Math.max(2,r),this.previousEvents=[]}check(e){var s;if(!(("nativeEvent"in e?e.nativeEvent:e)instanceof Event))throw new Error(`"${e}" is not a valid event`);const r=V0t(e);if(ID(r)<this.sensitivity)return!1;const{isHuman:i}=this.isHuman(r);return i?this.previousEvents=[r]:r.timeStamp>(((s=this.previousEvents.at(-1))==null?void 0:s.timeStamp)||0)&&this.previousEvents.push(r),i}isHuman(e){const n=this.previousEvents.at(-1);if(!n)return{isHuman:!0,reason:L_.NO_PREVIOUS_EVENT_TO_COMPARE};if(e.timeStamp<n.timeStamp)return{isHuman:!1,reason:L_.PAST_TIMESTAMP_EVENT};if(e.timeStamp>n.timeStamp+this.delay)return{isHuman:!0,reason:L_.ENOUGH_TIME_PASSED};const s=ID(e),a=ID(n);if(s>=a){if(this.previousEvents.length===1)return{isHuman:!0,reason:L_.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN};if(this.increasingDeltasThreshold<=2||this.previousEvents.length>=this.increasingDeltasThreshold&&this.previousEvents.slice(-this.increasingDeltasThreshold).map(ID).every((u,h,d)=>h===0||u>d[h-1]))return{isHuman:!0,reason:L_.DELTA_MODULE_HAS_BEEN_INCREASING}}return{isHuman:!1,reason:L_.ALL_OTHER_CHECKS_FAILED}}}const $0t=new q0t({sensitivity:Ob?7:2}),tie=4,W0t=.75;function Y0t(t){const e=Ei(t,-tie,tie);return Math.round(e*W0t)}function v_e({debug:t=!1,disabled:e=!1,blocking:n=!0,cursor:r="pointer",x:i=0,y:s=0,width:a=30,height:o=10,children:c,onScroll:l,...u}){return Ae.jsxs("group",{...u,children:[Ae.jsx(Vd,{blocking:n,cursor:r,visible:t,x:i,y:s,width:a,height:o,onWheel:h=>{e||!$0t.check(h)||l==null||l(Y0t(h.deltaY))}}),c]})}function X0t({xcursor:t,ycursor:e,xoffset:n,yoffset:r,rows:i,codepage:s}){var X,re;const a=ef(),o=mm(),c=Be.useRef(),l=ho(),u=pm(o),h=Us(V=>V.editor.path),d=ni(),f=ae(s)?s.toJSON():"",p=i.length-1,g=t+1-n,_=e+2-r;if(ae(s)){const V=((X=c.current)==null?void 0:X.x)!==g||((re=c.current)==null?void 0:re.y)!==_;if(a||V){const Z=u.left+g,Y=u.top+_;Y>u.top+1&&Y<u.bottom&&Z>u.left&&Z<u.right&&DB(Z+Y*o.width,"Ý",o)}}c.current={x:g,y:_};const v=i[p].end,E=i[e];let T=l.cursor,x=l.cursor,N=!1;ae(l.select)&&(N=!0,T=Math.min(l.cursor,l.select),x=Math.max(l.cursor,l.select),l.cursor!==l.select&&--x);const A=x-T+1,I=N?f.substring(T,x+1):f;function k(V){V?ae(l.select)||ho.setState({select:l.cursor}):ho.setState({select:void 0})}function L(V,Z,Y){Z>0&&(s==null||s.delete(V,Z)),ae(Y)&&(s==null||s.insert(V,Y)),ho.setState({cursor:V+(Y??"").length,select:void 0})}function U(){ae(l.select)&&(ho.setState({cursor:T}),L(T,A))}function $(){ho.setState({cursor:v,select:void 0})}const q=Be.useCallback(function(Z){const Y=Math.round(e+Z);if(Y<0)ho.setState({cursor:0});else if(Y>p)ho.setState({cursor:v});else{const ee=i[Y];ho.setState({cursor:ee.start+Math.min(t,ee.code.length-1)})}},[v,i,p,t,e]),G=Be.useMemo(()=>s?new Jje(s):void 0,[s]);return Be.useEffect(()=>{function V(Y){Y.stackItem.meta.set("cursor",l.cursor)}function Z(Y){if(Y.stackItem.meta.has("cursor")){const ee=Y.stackItem.meta.get("cursor");ho.setState({cursor:ee})}}return G==null||G.on("stack-item-added",V),G==null||G.on("stack-item-popped",Z),()=>{G==null||G.off("stack-item-added",V),G==null||G.off("stack-item-popped",Z)}},[G,l.cursor]),Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(v_e,{blocking:!0,x:u.left,y:u.top,width:u.width,height:u.height,onScroll:V=>q(V*.75)}),Ae.jsx(uc,{keydown:V=>{if(!ae(s))return;const{key:Z}=V,Y=ar(Z),ee=Q6(V);switch(Y){case"arrowleft":if(k(ee.shift),ee.ctrl)ho.setState({cursor:E.start});else{const oe=l.cursor-(ee.alt?10:1);ho.setState({cursor:Ei(oe,0,v)})}break;case"arrowright":if(k(ee.shift),ee.ctrl)ho.setState({cursor:E.end});else{const oe=l.cursor+(ee.alt?10:1);ho.setState({cursor:Ei(oe,0,v)})}break;case"arrowup":k(ee.shift),ee.ctrl?ho.setState({cursor:0}):q(ee.alt?-10:-1);break;case"arrowdown":k(ee.shift),ee.ctrl?ho.setState({cursor:v}):q(ee.alt?10:1);break;case"enter":ae(s)&&(s.insert(l.cursor,`
`),ho.setState({cursor:l.cursor+1}));break;case"esc":case"escape":ee.shift||ee.alt||ee.ctrl?y2(Ge,d):qDe(Ge,d);break;case"tab":Lue(Ge,d,!ee.shift);break;case"delete":N?U():L(l.cursor,1);break;case"backspace":N?U():f.length>0&&L(Math.max(l.cursor-1,0),1);break;default:if(ee.ctrl)switch(Y){case"e":tPe(Ge,d,h);break;case"k":nPe(Ge,d,h);break;case"z":Ob&&ee.shift?G==null||G.redo():G==null||G.undo();break;case"y":Ob||G==null||G.redo();break;case"a":ho.setState({cursor:v,select:0});break;case"c":ae(Ia())?Ia().writeText(I).catch(oe=>Hr(Ge,d,"clipboard",oe)):$();break;case"v":ae(Ia())?Ia().readText().then(oe=>{const de=oe.replaceAll("\r","");N?L(T,A,de):L(l.cursor,0,de)}).catch(oe=>Hr(Ge,d,"clipboard",oe)):$();break;case"x":ae(Ia())?Ia().writeText(I).then(()=>U()).catch(oe=>Hr(Ge,d,"clipboard",oe)):$();break;case"p":Bv(Ge,d,I);break}else if(!ee.alt){if(Z.length===1)if(N)L(T,A,Z);else{const oe=l.cursor+Z.length;s.insert(l.cursor,Z),ho.setState({cursor:oe})}}break}}})]})}function K0t({ycursor:t,xoffset:e,yoffset:n,rows:r,codepage:i}){const s=ef(),a=mm(),o=ho(),{editor:c,quickterminal:l}=Us();if(!ae(i)){const v=(s?"|":"-").repeat(3);return MS(!1,!1,0,0,a,1,2,1),ir(` ${v} LOADING ${v}`,a,!0),null}const u=c.refsheet.length>0,h=a.width-(u?28:3),d=pm(a);d.right=h;let f=o.cursor,p=o.cursor,g=!1;ae(o.select)&&(g=!0,f=Math.min(o.cursor,o.select),p=Math.max(o.cursor,o.select),o.cursor!==o.select&&--p);const _=d.left+1;MS(!1,!1,-e,-n,a,1,2,1);for(let v=0;v<r.length;++v){if(a.y<=d.top+1){++a.y;continue}const E=r[v],T=v===t,x=E.code.replaceAll(`
`,"");a.x=_-e,a.iseven=a.y%2===0,a.active.bg=T?VY:hR(l),a.disablewrap=!0,a.active.rightedge=h,Vpe(`${x} `,a,!1);const N=1+a.y*a.width;if(ae(E.tokens))for(let A=0;A<E.tokens.length;++A){const I=E.tokens[A],k=(I.startColumn??1)-1-e,L=(I.endColumn??1)-1-e,U=I0t[I.tokenTypeIdx];if(ae(U))switch(U){case BP:{const $=I.image.substring(1).split(" ");switch(tfe("",$,!!I.payload).type){case cn.LOADER:case cn.BOARD:case cn.OBJECT:case cn.TERRAIN:case cn.CHARSET:case cn.PALETTE:{const[G]=$;eg(N,d.right,k,k+G.length,BP,a.active.bg,a),$.length>1&&eg(N,d.right,k+G.length+1,L,iw,a.active.bg,a);break}case cn.CONST:{const[G]=$;eg(N,d.right,k,k+G.length,f_e,a.active.bg,a),$.length>1&&eg(N,d.right,k+G.length+1,L,p_e,a.active.bg,a);break}case cn.RANGE:case cn.SELECT:case cn.NUMBER:case cn.TEXT:case cn.LINK:case cn.HOTKEY:case cn.COPYIT:case cn.OPENIT:case cn.ZSSEDIT:case cn.CHAREDIT:case cn.COLOREDIT:{const[G]=$;eg(N,d.right,k,k+G.length,BP,a.active.bg,a);break}default:eg(N,d.right,k,L,Qt.DKRED,a.active.bg,a);break}break}case iw:{const $=z0t(I.image);if(Lr($))for(let q=0;q<$.length;++q)eg(N,d.right,k+q,L+q,$[q],a.active.bg,a);else eg(N,d.right,k,L,$,a.active.bg,a);break}default:eg(N,d.right,k,L,U,a.active.bg,a);break}}if(g&&E.start<=p&&E.end>=f){const A=Math.max(E.start,f)-E.start-e,I=Math.min(E.end,p)-E.start-e,k=d.width-3,L=Math.max(0,A),U=Math.min(k,I);L<=k&&U>=_&&eg(N,d.right,L,U,x0t,w0t,a)}if(++a.y,a.y>=d.bottom)break}if(u){let v=0;for(let E=d.top+2;E<d.bottom;++E){a.active.rightedge=a.width-2,a.active.leftedge=d.right+2,ko(a,a.width,a.height,d.right+1,E,{char:179,color:jO,bg:Qt.DKBLUE});const T=c.refsheet[v++];ae(T)&&(a.x=a.active.leftedge-1,a.y=E,ir(`$white$ondkblue ${T}`,a,!0))}}return a.disablewrap=!1,a.active.rightedge=a.width,null}function lj(t){switch(t){case"stat":case"text":case"hyperlink":return!1;default:return!0}}function uj(){const t=ni(),[e]=Us(up(U=>[U.editor])),[n,r,i,s,a,o,c,l,u,h]=Eo(up(U=>[U.zsswords.cli,U.zsswords.loader,U.zsswords.runtime,U.zsswords.flags,U.zsswords.stats,U.zsswords.kinds,U.zsswords.altkinds,U.zsswords.colors,U.zsswords.dirs,U.zsswords.dirmods]));Be.useEffect(()=>{n.filter(lj).forEach(U=>ng(U,Dd)),r.filter(lj).forEach(U=>ng(U,Dd)),i.filter(lj).forEach(U=>ng(U,Dd)),s.forEach(U=>ng(U,k0t)),a.forEach(U=>ng(U,D0t)),o.forEach(U=>ng(U,P0t)),c.forEach(U=>ng(U,L0t)),l.forEach(U=>ng(U,U0t)),u.forEach(U=>ng(U,B0t)),h.forEach(U=>ng(U,F0t)),rs("a",dS),rs("b",dS),rs("c",dS),rs("d",dS),rs("e",dS),rs("f",dS),rs("g",dS),rs("x",H0t),rs("#",Qre),rs("!",Qre),rs("y",fS),rs("t",fS),rs("s",fS),rs("i",fS),rs("q",fS),rs("h",fS),rs("w",fS),rs("3",Jre),rs(".",Jre),rs("+",Zre),rs("-",Zre),rs("0",rg),rs("1",rg),rs("2",rg),rs("p",rg),rs("4",rg),rs("5",rg),rs("6",rg),rs("7",rg),rs("8",rg),rs("9",rg),rs(";",Tc)},[n,r,i,s,a,o,c,l,u,h]);const d=mm(),f=ho(),p=ope(Uue(e.book,e.path)),g=pm(d);Be.useEffect(()=>(iPe(Ge,t,e.book,e.path),()=>{sPe(Ge,t,e.book,e.path)}),[e.book,e.path,t]);const _=ae(p)?p.toJSON():"",v=C0t(_),E=A0t(f.cursor,v),T=f.cursor-v[E].start,x=R0t(v),N=Ppe(_);if(ae(N.tokens)){let U=!0;for(let $=0;$<N.tokens.length;++$){const q=N.tokens[$];q.tokenTypeIdx===BN.tokenTypeIdx&&(q.payload=U,U=!1);const G=v[(q.startLine??1)-1];ae(G)&&(G.tokens=G.tokens??[],G.tokens.push(q))}}if(ae(N.errors))for(let U=0;U<N.errors.length;++U){const $=N.errors[U],q=v[($.line??1)-1];ae(q)&&(q.errors=q.errors??[],q.errors.push($))}const A={rows:v,xcursor:T,ycursor:E,codepage:p,xoffset:f.xscroll,yoffset:f.yscroll},I=32,k=(Math.round(x/I)+1)*I,L=v.length;return Be.useEffect(()=>{let U=f.xscroll;const $=T-U,q=g.width-3;let G=Math.round(Ei(Math.abs($)*.5,1,I));G<8&&(G=1),$>q-8&&(U+=G),$<8&&(U-=G);let X=f.yscroll;const re=E-X,V=g.height-4,Z=Math.round(V*.5);let Y=Math.round(Ei(Math.abs(re)*.25,1,Z));Y<8&&(Y=1),re>V-4&&(X+=Y),re<4&&(X-=Y),setTimeout(()=>ho.setState({xscroll:Math.round(Ei(U,0,k)),yscroll:Math.round(Ei(X,0,L))}),16)},[T,k,f.xscroll,E,L,f.yscroll,g.width,g.height]),Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(GY,{bump:!0,context:d}),Ae.jsx(j0t,{}),Ae.jsx(K0t,{...A}),Ae.jsx(X0t,{...A})]})}function J0t({tapeycursor:t,logrowtotalheight:e}){const n=ef(),r=mm(),{quickterminal:i}=Us(),s=nc(),a=ni(),o=pm(r),c=s.buffer[s.bufferindex];let l=s.xcursor,u=s.xcursor,h=!1;ae(s.xselect)&&ae(s.yselect)&&(h=!0,l=Math.min(s.xcursor,s.xselect),u=Math.max(s.xcursor,s.xselect),s.xcursor!==s.xselect&&--u);const d=u-l+1,f=s.ycursor===0,p=h?c.substring(l,u+1):c;function g(k,L,U){s.bufferindex>0&&nc.setState({bufferindex:0}),s.buffer[0]=J5e(c,k,L,U),nc.setState({buffer:s.buffer,xselect:void 0,xcursor:k+(U??"").length})}function _(k){const L=s.buffer.length-1,U=Ei(k,0,L);nc.setState({bufferindex:U,xcursor:s.buffer[U].length,ycursor:0,xselect:void 0,yselect:void 0})}function v(k){k?ae(s.xselect)||nc.setState({xselect:s.xcursor,yselect:s.ycursor}):nc.setState({xselect:void 0,yselect:void 0})}function E(){ae(s.xselect)&&(nc.setState({xcursor:l,xselect:void 0,yselect:void 0}),g(l,d))}function T(){nc.setState({xcursor:c.length,ycursor:0,xselect:void 0,yselect:void 0})}if(r.reset.bg=hR(i),!i){eT(!1,!1,0,0,r);const k="main:0.48.4 - if lost try #help";r.x=o.right-k.length,ir(`$dkcyan${k}`,r,!0)}const x="$196",A="$205".repeat(o.width-6);eT(!1,!1,0,o.height-2,r),r.active.color=Qt.WHITE,ir(`  ${x}${A}${x}  `,r,!0);const I=c.padEnd(o.width," ");if(eT(!1,!1,0,o.height-1,r),r.active.color=Qt.WHITE,Vpe(I,r,!0),ae(s.xselect)&&ae(s.yselect)&&s.xcursor!==s.xselect){const k=Math.min(s.xcursor,s.xselect),L=Math.min(s.ycursor,s.yselect),U=Math.max(s.xcursor,s.xselect)-1,$=Math.max(s.ycursor,s.yselect);for(let q=L;q<=$;++q){const G=k+(o.bottom-q)*o.width,X=U+(o.bottom-q)*o.width;vO(G,X,15,8,r)}}if(n){const k=o.left+s.xcursor,L=o.top+t,U=k+L*r.width;DB(U,"Ý",r),vO(U,U,15,r.reset.bg,r)}return Be.useEffect(()=>{let k=s.scroll;t<4&&k++,t>o.bottom-4&&k--,nc.setState({scroll:Math.round(Ei(k,0,e))})},[s.scroll,t,e,o.bottom]),Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(v_e,{blocking:!0,x:o.left,y:o.top,width:o.width,height:o.height,onScroll:k=>{v(!1),nc.setState({ycursor:Ei(Math.round(s.ycursor-k),0,e)})}}),Ae.jsx(uc,{keydown:k=>{const{key:L}=k,U=ar(L),$=Q6(k);switch(U){case"arrowleft":v($.shift),$.ctrl?nc.setState({xcursor:0}):nc.setState({xcursor:Ei(s.xcursor-($.alt?10:1),0,o.right)});break;case"arrowright":v($.shift),$.ctrl?nc.setState({xcursor:f?c.length:o.right}):nc.setState({xcursor:Ei(s.xcursor+($.alt?10:1),0,o.right)});break;case"arrowup":$.ctrl?_(s.bufferindex+1):(v($.shift),nc.setState({ycursor:Ei(Math.round(s.ycursor+($.alt?10:1)),0,e)}));break;case"arrowdown":$.ctrl?_(s.bufferindex-1):(v($.shift),nc.setState({ycursor:Ei(Math.round(s.ycursor-($.alt?10:1)),0,e)}));break;case"enter":{const q=h?p:c;q.length&&(f?(nc.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:["",q,...s.buffer.slice(1).filter(G=>G!==q)]}),Bv(Ge,a,q),i&&y2(Ge,a)):T());break}case"esc":case"escape":y2(Ge,a);break;case"tab":Lue(Ge,a,!$.shift);break;case"delete":f?h?E():c.length>0&&g(s.xcursor,1):T();break;case"backspace":f?h?E():s.xcursor>0&&g(s.xcursor-1,1):T();break;default:if($.ctrl)switch(U){case"e":Bv(Ge,a,"#export");break;case"a":nc.setState({xselect:0,yselect:0,xcursor:c.length,ycursor:0});break;case"c":f&&ae(Ia())?Ia().writeText(p).catch(q=>console.error(q)):T();break;case"v":f&&ae(Ia())?Ia().readText().then(q=>{try{const X=JSON.parse(q);if(On(X.exported)&&ae(X.data)){Ag(Ge,a,void 0,"json",`file:${X.exported}`,JSON.stringify(X));return}}catch(X){console.error(X)}const G=q.replaceAll("\r","");h?g(l,d,G):g(s.xcursor,0,G)}).catch(q=>console.error(q)):T();break;case"x":f&&ae(Ia())?Ia().writeText(p).then(()=>E()).catch(q=>console.error(q)):T();break}else $.alt||L.length===1&&(f&&s.xcursor<=c.length?h?(g(l,d,L),nc.setState({xselect:void 0})):g(s.xcursor,0,L):T());break}}})]})}function Z0t({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const a=mm(),o=Be.useCallback(()=>{setTimeout(()=>{if(ae(Ia())){const[,...l]=i,u=l.join(" ");Ia().writeText(u).then(()=>uo(Ge,ni(),"copied!")).catch(h=>console.error(h))}},100)},[i]),c=vp(!!e);return eT(!!t,!!e,0,s,a),ir(`${n} $purple$16 $yellowCOPYIT ${c}${r}`,a,!0),e&&Ae.jsx(uc,{OK_BUTTON:o})}function Q0t({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const a=mm(),o=Be.useContext(d_e),c=Be.useCallback(()=>{const[u,...h]=i;setTimeout(()=>{o.sendmessage(u,h)},100)},[i,o]),l=vp(!!e);return eT(!!t,!!e,0,s,a),ir(`${n} $purple$16 ${l}${r}`,a,!0),e&&Ae.jsx(uc,{OK_BUTTON:c})}function evt({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const a=mm(),o=Be.useCallback(()=>{const[,...l]=i,u=l.join(" ");setTimeout(()=>{window.open(u,"_blank")},100)},[i]),c=vp(!!e);return eT(!!t,!!e,0,s,a),ir(`${n} $purple$16 $yellowOPENIT ${c}${r}`,a,!0),e&&Ae.jsx(uc,{OK_BUTTON:o})}function y_e({blink:t,active:e,text:n,y:r}){const i=mm(),{quickterminal:s}=Us(),a=pm(i),o=n.startsWith("!");if(eT(!!t,!!e,0,r,i),i.reset.bg=e?VY:hR(s),i.active.bottomedge=a.bottom,ir(o?"":n,i,!0),o){const[c,...l]=n.slice(1).split("!"),u=`${l.join("!")}`;let h="PRESS ME";const d=[],f=IB(u,!0);for(let v=0;v<f.tokens.length;v++){const E=f.tokens[v];switch(E.tokenType){case o9:h=E.image.slice(1);break;default:d.push(E.image);break}}const[p,...g]=d,_={blink:t,active:e,prefix:c,label:h,words:g,y:r};switch(ar(p)){case"copyit":return Ae.jsx(Z0t,{..._,words:d});case"openit":return Ae.jsx(evt,{..._,words:d});default:case"hyperlink":return Ae.jsx(Q0t,{..._,words:d});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function tvt(t){const e=ef();return Ae.jsx(y_e,{active:!0,blink:e,...t})}function hj(){const t=ni(),[e]=Us(up(f=>[f.editor.open])),n=Us(up(f=>f.terminal.logs)),r=mm(),i=nc(),s=pm(r),a=n.map(f=>{const[,p,g,..._]=f;let v="$white";switch(p){case"debug":v="$yellow";break;case"error":v="$red";break}const E=_.map(N=>`${N}`).join(" "),T=E.startsWith("!"),x=`$onclear${v}${g}$white$180$blue`;return`${T?"!":""}${x}${E}`}),o=a.map(f=>{if(f.startsWith("!"))return 1;const p=XN(f,s.width,s.height);return(p==null?void 0:p.y)??1}),c=s.bottom-s.top-(e?0:2);let l=0,u=c+1;const h=o.map(f=>(u-=f,l+=f,u));++l;const d=s.bottom-i.ycursor+i.scroll;return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(GY,{context:r}),Ae.jsxs(d_e.Provider,{value:{sendmessage(f,p){const[g,_]=WW(f);if(g==="self"){const v=`#${_} ${p.join(" ")}`;Bv(Ge,t,v)}else Ge.emit(t,`${g}:${_}`,p)}},children:[a.map((f,p)=>{const g=h[p]+i.scroll,_=o[p],v=g+_;return v<0||g>c?null:!e&&d>=g&&d<v?Ae.jsx(tvt,{text:f,y:g},p):Ae.jsx(y_e,{text:f,y:g},p)}),!e&&Ae.jsx(J0t,{tapeycursor:d,logrowtotalheight:l})]})]})}function nie(t,e,n,r,i){return{...i,x:t,y:e,reset:{...cl(i.reset),topedge:e,leftedge:t,rightedge:n,bottomedge:r},active:{...cl(i.active),topedge:e,leftedge:t,rightedge:n,bottomedge:r}}}function nvt({context:t}){const[e,n]=Us(up(h=>[h.layout,h.editor.open])),r=0,i=0,s=t.width-1,a=t.height-1,o=pm(t),c=Math.floor(o.height*.5),l=Be.useMemo(()=>nie(i,r,s,c-1,t),[c,s,t]),u=Be.useMemo(()=>nie(i,c,s,a,t),[c,s,a,t]);if(n)switch(e){case Pd.SPLIT_Y:return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(O_.Provider,{value:l,children:Ae.jsx(hj,{})}),Ae.jsx(O_.Provider,{value:u,children:Ae.jsx(uj,{})})]});case Pd.SPLIT_Y_ALT:return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(O_.Provider,{value:l,children:Ae.jsx(uj,{})}),Ae.jsx(O_.Provider,{value:u,children:Ae.jsx(hj,{})})]});default:return Ae.jsx(O_.Provider,{value:t,children:Ae.jsx(uj,{})})}return Ae.jsx(O_.Provider,{value:t,children:Ae.jsx(hj,{})},"single")}function rvt(){const t=ez();let e=0,n=t.rows-2;const[r,i,s,a]=Us(up(d=>[d.layout,d.quickterminal,d.terminal.open,d.editor.open]));switch(r){case Pd.TOP:n=Math.floor(t.rows*.5);break;case Pd.BOTTOM:n=Math.ceil(t.rows*.5),e=t.rows-n;break;default:case Pd.FULL:break}const o=hR(i),c=KN(t.cols,n,0,jO,o),l={...eE(t.cols,n,jO,o),...c.getState()};if(t.cols<10||t.rows<10)return null;const u=ni(),h=i||s||a;return Ae.jsxs(OI,{store:c,children:[h&&Ae.jsx(zO,{width:t.cols,height:t.rows,top:e,left:0,right:t.cols-1,bottom:e+n-1}),h?Ae.jsxs(cx,{blockhotkeys:!0,children:[Ae.jsx(GY,{context:l}),Ae.jsx(nvt,{context:l}),Ae.jsx("group",{position:[0,e*kn.DRAW_CHAR_HEIGHT(),0],children:Ae.jsx(NI,{width:t.cols,height:n})})]}):Ae.jsx(Nw,{hotkey:"/",children:()=>HDe(Ge,u)})]})}function ivt({context:t}){return Ae.jsx("group",{position:[0,0,999],children:Ae.jsx(NI,{width:t.width,height:t.height})})}function svt(){const{toast:t}=Us(),e=ez(),n=KN(e.cols,1,0,Qt.GREEN,Qt.ONCLEAR),r={...eE(e.cols,1,Qt.GREEN,Qt.ONCLEAR,0,0,e.cols-1,1),...n.getState()};if(e.cols<10||e.rows<10)return null;const i=e.cols-1;return Ae.jsx(OI,{store:n,children:t&&Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(jY,{margin:1,color:Qt.YELLOW,y:0,leftedge:0,rightedge:i,line:t,context:r}),Ae.jsx("group",{position:[0,0,998],children:Ae.jsx(zO,{alpha:.4,width:e.cols,height:10,top:0,left:0,right:i,bottom:0})}),Ae.jsx(ivt,{context:r})]})})}const rie=Wb("gadgetclient",[],t=>{if(!rie.session(t)||t.player!==ni())return;const{desync:e}=Eo.getState();switch(t.target){case"paint":Eo.setState({desync:!1,gadget:t.data});break;case"patch":e||Eo.setState(n=>{let r;try{r=s7(t.data,n.gadget)}catch(s){r=s}if(ae(r))return rie.replynext(t,"desync"),{...n,desync:!0};const i=Y3(n.gadget,t.data,!0,!1);return{...n,gadget:i.newDocument}});break}}),qY=Object.prototype.toString.call(typeof zn<"u"?zn:0)==="[object process]";var g_,pr;(function(t){t[t.CRITICAL=0]="CRITICAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=7]="TRACE"})(pr||(pr={}));function $Y(t){if(typeof t=="number"){if(Object.prototype.hasOwnProperty.call(pr,t))return t;var e=Object.keys(pr).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<t});return e.length?Math.max.apply(Math,e):pr.WARNING}var n=t.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(pr,n))throw new Error("Unknown log level string: ".concat(t));return pr[n]}var avt=qY?console.log.bind(console):console.debug.bind(console),__e=(g_={},g_[pr.CRITICAL]=console.error.bind(console),g_[pr.ERROR]=console.error.bind(console),g_[pr.WARNING]=console.warn.bind(console),g_[pr.INFO]=console.info.bind(console),g_[pr.DEBUG]=avt.bind(console),g_[pr.TRACE]=console.trace.bind(console),g_);function aE(t){return function(e,n){Object.defineProperty(e,n,{get:function(){},set:function(r){Object.defineProperty(this,n,{value:r,writable:!0,enumerable:t})},enumerable:t})}}function WG(t){return Ka(this,void 0,Promise,function(){return K9(this,function(e){switch(e.label){case 0:return typeof t!="function"?[3,2]:[4,t()];case 1:return[2,e.sent()];case 2:return[2,t]}})})}function ovt(t){return typeof t=="function"?t():t}function b_e(t){var e,n,r;return K9(this,function(i){switch(i.label){case 0:e=0,n=1,i.label=1;case 1:return e<t?[4,e]:[3,3];case 2:return i.sent(),r=N6([n,e+n],2),e=r[0],n=r[1],[3,1];case 3:return[4,t];case 4:return i.sent(),[3,3];case 5:return[2]}})}function kD(t,e){return Object.assign.apply(Object,TG([{}],N6(t.map(e)),!1))}function YG(t,e){Object.entries(t).forEach(function(n){var r=N6(n,2),i=r[0],s=r[1];return e(s,i)})}function E_e(t){return t==null}function VO(t,e){return E_e(t)?null:e(t)}function S_e(t,e){return E_e(t)?void 0:e(t)}function cvt(t){return Ka(this,void 0,Promise,function(){return K9(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function XG(){var t,e,n=new Promise(function(r,i){t=r,e=i});return{promise:n,resolve:t,reject:e}}function lvt(t,e,n){if(typeof t=="number"&&(t=t.toString()),e=e-t.length,e<=0)return t;n===void 0&&(n=" ");var r="";do(e&1)===1&&(r+=n),e>>=1,e&&(n+=n);while(e);return r+t}function tT(t,e,n){var r=t.split(e);return r.length<=n?r:TG(TG([],N6(r.slice(0,n-1)),!1),[r.slice(n-1).join(e)],!1)}var uvt={},dj,fj,zU=typeof zn>"u"?[]:(fj=(dj=uvt.LOGGING)===null||dj===void 0?void 0:dj.split(";").map(function(t){var e=t.split("=",2),n=e[0],r=e[1];return r?[n==="default"?void 0:n.split(":"),$Y(r)]:null}).filter(function(t){return!!t}).sort(function(t,e){var n,r,i=t[0],s=e[0];return((n=s==null?void 0:s.length)!==null&&n!==void 0?n:0)-((r=i==null?void 0:i.length)!==null&&r!==void 0?r:0)}))!==null&&fj!==void 0?fj:[],pj=zU.findIndex(function(t){var e=t[0];return!e}),T_e=void 0;pj!==-1&&(T_e=zU[pj][1],zU.splice(pj));function hvt(t,e){return e.length<=t.length&&e.every(function(n,r){return n===t[r]})}function x_e(t){for(var e=t.split(":"),n=0,r=zU;n<r.length;n++){var i=r[n],s=i[0],a=i[1];if(hvt(e,s))return a}return T_e}var w_e=function(){function t(e){var n=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,a=e.colors,o=e.timestamps,c=o===void 0?qY:o,l,u;this._name=n,this._minLevel=(u=(l=S_e(r,function(h){return $Y(h)}))!==null&&l!==void 0?l:x_e(n))!==null&&u!==void 0?u:pr.WARNING,this._emoji=s,this._colors=a,this._timestamps=c}return t.prototype.crit=function(e){this.log(pr.CRITICAL,e)},t.prototype.error=function(e){this.log(pr.ERROR,e)},t.prototype.warn=function(e){this.log(pr.WARNING,e)},t.prototype.info=function(e){this.log(pr.INFO,e)},t.prototype.debug=function(e){this.log(pr.DEBUG,e)},t.prototype.trace=function(e){this.log(pr.TRACE,e)},t}(),dvt=function(t){ove(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){if(!(n>this._minLevel)){var i=__e[n],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e}(w_e),fvt=function(){function t(e){var n=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=S_e(r,function(a){return $Y(a)}))!==null&&s!==void 0?s:x_e(n),this._override=typeof i=="function"?{log:i}:i}return t.prototype.log=function(e,n){this._shouldLog(e)&&this._override.log(e,n)},t.prototype.crit=function(e){this._override.crit?this._shouldLog(pr.CRITICAL)&&this._override.crit(e):this.log(pr.CRITICAL,e)},t.prototype.error=function(e){this._override.error?this._shouldLog(pr.ERROR)&&this._override.error(e):this.log(pr.ERROR,e)},t.prototype.warn=function(e){this._override.warn?this._shouldLog(pr.WARNING)&&this._override.warn(e):this.log(pr.WARNING,e)},t.prototype.info=function(e){this._override.info?this._shouldLog(pr.INFO)&&this._override.info(e):this.log(pr.INFO,e)},t.prototype.debug=function(e){this._override.debug?this._shouldLog(pr.DEBUG)&&this._override.debug(e):this.log(pr.DEBUG,e)},t.prototype.trace=function(e){this._override.trace?this._shouldLog(pr.TRACE)&&this._override.trace(e):this.log(pr.TRACE,e)},t.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},t}(),v_,y_,__,pvt=(v_={},v_[pr.CRITICAL]="🛑",v_[pr.ERROR]="❌",v_[pr.WARNING]="⚠️ ",v_[pr.INFO]="ℹ️ ",v_[pr.DEBUG]="🐞",v_[pr.TRACE]="🐾",v_),mvt={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},gvt={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function tz(t,e,n){return function(r){return"\x1B[".concat(t,"m").concat(n?n(r):r,"\x1B[").concat(e,"m")}}function yg(t){return tz(mvt[t],39)}function uA(t,e){return tz(gvt[t],49,e)}var vvt=(y_={},y_[pr.CRITICAL]=yg("red"),y_[pr.ERROR]=yg("redBright"),y_[pr.WARNING]=yg("yellow"),y_[pr.INFO]=yg("blue"),y_[pr.DEBUG]=yg("magenta"),y_[pr.TRACE]=tz(0,0),y_),iie=(__={},__[pr.CRITICAL]=uA("bgRed",yg("white")),__[pr.ERROR]=uA("bgRedBright",yg("white")),__[pr.WARNING]=uA("bgYellow",yg("black")),__[pr.INFO]=uA("bgBlue",yg("white")),__[pr.DEBUG]=uA("bgMagenta",yg("black")),__[pr.TRACE]=tz(7,27),__),yvt=function(t){ove(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){var i,s,a;if(!(n>this._minLevel)){var o=__e[n],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=pvt[n];c+="".concat(l," ")}var u=(a=(i=this._colors)!==null&&i!==void 0?i:(s=zn.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&a!==void 0?a:!0;u?c+="".concat(iie[n](this._name)," ").concat(iie[n](pr[n])," ").concat(vvt[n](r)):c+="[".concat(this._name,":").concat(pr[n].toLowerCase(),"] ").concat(r),o(c)}},e}(w_e);function nz(t){return t.custom?new fvt(t):qY?new yvt(t):new dvt(t)}let _vt=class extends Error{constructor(...e){var n;super(...e),Object.setPrototypeOf(this,new.target.prototype),(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class C_e extends _vt{}class bvt{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=nz({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,n){return await new Promise((r,i)=>{var s,a;const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(a=this._usedFromBucket.get(c))!==null&&a!==void 0?a:0;if(l>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(o),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{o.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{o.reject(new C_e(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(o,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const n=[];return this._partitionedQueue.set(e,n),n}async _runRequest(e,n){var r;const i=this._getPartitionedQueue(n);this._logger.debug(`doing a request for ${n?`partition ${n}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(n,((r=this._usedFromBucket.get(n))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:a,reject:o}=e;try{a(await this._callback(s))}catch(c){o(c)}finally{setTimeout(()=>{const c=this._usedFromBucket.get(n)-1;this._usedFromBucket.set(n,c),i.length&&c<this._bucketSize&&this._runNextRequest(n)},this._timeFrame)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class KG{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._paused=!1,this._logger=nz({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i}async request(e,n){return await new Promise((r,i)=>{var s;const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{this._queue.push(a),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{a.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{a.reject(new C_e(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(a)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:n,resolve:r,reject:i}=e;try{r(await this._callback(n))}catch(s){i(s)}finally{setTimeout(()=>{this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class Evt extends KG{constructor(e,n){super({...n,async doRequest(r,i){return await e.request(r,i)}})}}class Svt{constructor(e,n,r,i=!1){this.owner=e,this.event=n,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}let II=class{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,n){return this._addListener(!1,e,n)}addListener(e,n){return this._addListener(!1,e,n)}removeListener(e,n){this._removeListener(!1,e,n)}registerEvent(){const e=n=>this.addListener(e,n);return e}emit(e,...n){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...n);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...n)}registerInternalEvent(){const e=n=>this.addInternalListener(e,n);return e}addInternalListener(e,n){return this._addListener(!0,e,n)}removeInternalListener(e,n){this._removeListener(!0,e,n)}_addListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(n)?i.get(n).push(r):i.set(n,[r]),new Svt(this,n,r,e)}_removeListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;if(!n)i.clear();else if(typeof n=="object"){const s=n;this._removeListener(s._internal,s.event,s.listener)}else{const s=n;if(i.has(s))if(r){const a=i.get(s);let o=0;for(;(o=a.indexOf(r))!==-1;)a.splice(o,1)}else i.delete(s)}}};const Tvt=6e4;function xvt(t){return VO(t.expiresIn,e=>t.obtainmentTimestamp+e*1e3-Tvt)}function FP(t){var e;return(e=VO(xvt(t),n=>Date.now()>n))!==null&&e!==void 0?e:!1}var JG={exports:{}};(function(t,e){var n=typeof self<"u"?self:Ll,r=function(){function s(){this.fetch=!1,this.DOMException=n.DOMException}return s.prototype=n,new s}();(function(s){(function(a){var o={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(X){return X&&DataView.prototype.isPrototypeOf(X)}if(o.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(X){return X&&l.indexOf(Object.prototype.toString.call(X))>-1};function h(X){if(typeof X!="string"&&(X=String(X)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(X))throw new TypeError("Invalid character in header field name");return X.toLowerCase()}function d(X){return typeof X!="string"&&(X=String(X)),X}function f(X){var re={next:function(){var V=X.shift();return{done:V===void 0,value:V}}};return o.iterable&&(re[Symbol.iterator]=function(){return re}),re}function p(X){this.map={},X instanceof p?X.forEach(function(re,V){this.append(V,re)},this):Array.isArray(X)?X.forEach(function(re){this.append(re[0],re[1])},this):X&&Object.getOwnPropertyNames(X).forEach(function(re){this.append(re,X[re])},this)}p.prototype.append=function(X,re){X=h(X),re=d(re);var V=this.map[X];this.map[X]=V?V+", "+re:re},p.prototype.delete=function(X){delete this.map[h(X)]},p.prototype.get=function(X){return X=h(X),this.has(X)?this.map[X]:null},p.prototype.has=function(X){return this.map.hasOwnProperty(h(X))},p.prototype.set=function(X,re){this.map[h(X)]=d(re)},p.prototype.forEach=function(X,re){for(var V in this.map)this.map.hasOwnProperty(V)&&X.call(re,this.map[V],V,this)},p.prototype.keys=function(){var X=[];return this.forEach(function(re,V){X.push(V)}),f(X)},p.prototype.values=function(){var X=[];return this.forEach(function(re){X.push(re)}),f(X)},p.prototype.entries=function(){var X=[];return this.forEach(function(re,V){X.push([V,re])}),f(X)},o.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function g(X){if(X.bodyUsed)return Promise.reject(new TypeError("Already read"));X.bodyUsed=!0}function _(X){return new Promise(function(re,V){X.onload=function(){re(X.result)},X.onerror=function(){V(X.error)}})}function v(X){var re=new FileReader,V=_(re);return re.readAsArrayBuffer(X),V}function E(X){var re=new FileReader,V=_(re);return re.readAsText(X),V}function T(X){for(var re=new Uint8Array(X),V=new Array(re.length),Z=0;Z<re.length;Z++)V[Z]=String.fromCharCode(re[Z]);return V.join("")}function x(X){if(X.slice)return X.slice(0);var re=new Uint8Array(X.byteLength);return re.set(new Uint8Array(X)),re.buffer}function N(){return this.bodyUsed=!1,this._initBody=function(X){this._bodyInit=X,X?typeof X=="string"?this._bodyText=X:o.blob&&Blob.prototype.isPrototypeOf(X)?this._bodyBlob=X:o.formData&&FormData.prototype.isPrototypeOf(X)?this._bodyFormData=X:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(X)?this._bodyText=X.toString():o.arrayBuffer&&o.blob&&c(X)?(this._bodyArrayBuffer=x(X.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(X)||u(X))?this._bodyArrayBuffer=x(X):this._bodyText=X=Object.prototype.toString.call(X):this._bodyText="",this.headers.get("content-type")||(typeof X=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(X)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var X=g(this);if(X)return X;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var X=g(this);if(X)return X;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(T(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(L)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function I(X){var re=X.toUpperCase();return A.indexOf(re)>-1?re:X}function k(X,re){re=re||{};var V=re.body;if(X instanceof k){if(X.bodyUsed)throw new TypeError("Already read");this.url=X.url,this.credentials=X.credentials,re.headers||(this.headers=new p(X.headers)),this.method=X.method,this.mode=X.mode,this.signal=X.signal,!V&&X._bodyInit!=null&&(V=X._bodyInit,X.bodyUsed=!0)}else this.url=String(X);if(this.credentials=re.credentials||this.credentials||"same-origin",(re.headers||!this.headers)&&(this.headers=new p(re.headers)),this.method=I(re.method||this.method||"GET"),this.mode=re.mode||this.mode||null,this.signal=re.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&V)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(V)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})};function L(X){var re=new FormData;return X.trim().split("&").forEach(function(V){if(V){var Z=V.split("="),Y=Z.shift().replace(/\+/g," "),ee=Z.join("=").replace(/\+/g," ");re.append(decodeURIComponent(Y),decodeURIComponent(ee))}}),re}function U(X){var re=new p,V=X.replace(/\r?\n[\t ]+/g," ");return V.split(/\r?\n/).forEach(function(Z){var Y=Z.split(":"),ee=Y.shift().trim();if(ee){var oe=Y.join(":").trim();re.append(ee,oe)}}),re}N.call(k.prototype);function $(X,re){re||(re={}),this.type="default",this.status=re.status===void 0?200:re.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in re?re.statusText:"OK",this.headers=new p(re.headers),this.url=re.url||"",this._initBody(X)}N.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},$.error=function(){var X=new $(null,{status:0,statusText:""});return X.type="error",X};var q=[301,302,303,307,308];$.redirect=function(X,re){if(q.indexOf(re)===-1)throw new RangeError("Invalid status code");return new $(null,{status:re,headers:{location:X}})},a.DOMException=s.DOMException;try{new a.DOMException}catch{a.DOMException=function(re,V){this.message=re,this.name=V;var Z=Error(re);this.stack=Z.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function G(X,re){return new Promise(function(V,Z){var Y=new k(X,re);if(Y.signal&&Y.signal.aborted)return Z(new a.DOMException("Aborted","AbortError"));var ee=new XMLHttpRequest;function oe(){ee.abort()}ee.onload=function(){var de={status:ee.status,statusText:ee.statusText,headers:U(ee.getAllResponseHeaders()||"")};de.url="responseURL"in ee?ee.responseURL:de.headers.get("X-Request-URL");var Me="response"in ee?ee.response:ee.responseText;V(new $(Me,de))},ee.onerror=function(){Z(new TypeError("Network request failed"))},ee.ontimeout=function(){Z(new TypeError("Network request failed"))},ee.onabort=function(){Z(new a.DOMException("Aborted","AbortError"))},ee.open(Y.method,Y.url,!0),Y.credentials==="include"?ee.withCredentials=!0:Y.credentials==="omit"&&(ee.withCredentials=!1),"responseType"in ee&&o.blob&&(ee.responseType="blob"),Y.headers.forEach(function(de,Me){ee.setRequestHeader(Me,de)}),Y.signal&&(Y.signal.addEventListener("abort",oe),ee.onreadystatechange=function(){ee.readyState===4&&Y.signal.removeEventListener("abort",oe)}),ee.send(typeof Y._bodyInit>"u"?null:Y._bodyInit)})}return G.polyfill=!0,s.fetch||(s.fetch=G,s.Headers=p,s.Request=k,s.Response=$),a.Headers=p,a.Request=k,a.Response=$,a.fetch=G,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(JG,JG.exports);var R_e=JG.exports;const wvt=qc(R_e);var mj=Object.prototype.hasOwnProperty,A1=Array.isArray,ig=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Cvt=function(e){for(;e.length>1;){var n=e.pop(),r=n.obj[n.prop];if(A1(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);n.obj[n.prop]=i}}},A_e=function(e,n){for(var r=n&&n.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},Rvt=function t(e,n,r){if(!n)return e;if(typeof n!="object"){if(A1(e))e.push(n);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!mj.call(Object.prototype,n))&&(e[n]=!0);else return[e,n];return e}if(!e||typeof e!="object")return[e].concat(n);var i=e;return A1(e)&&!A1(n)&&(i=A_e(e,r)),A1(e)&&A1(n)?(n.forEach(function(s,a){if(mj.call(e,a)){var o=e[a];o&&typeof o=="object"&&s&&typeof s=="object"?e[a]=t(o,s,r):e.push(s)}else e[a]=s}),e):Object.keys(n).reduce(function(s,a){var o=n[a];return mj.call(s,a)?s[a]=t(s[a],o,r):s[a]=o,s},i)},Avt=function(e,n){return Object.keys(n).reduce(function(r,i){return r[i]=n[i],r},e)},Mvt=function(t,e,n){var r=t.replace(/\+/g," ");if(n==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Ovt=function(e,n,r){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),r==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var s="",a=0;a<i.length;++a){var o=i.charCodeAt(a);if(o===45||o===46||o===95||o===126||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122){s+=i.charAt(a);continue}if(o<128){s=s+ig[o];continue}if(o<2048){s=s+(ig[192|o>>6]+ig[128|o&63]);continue}if(o<55296||o>=57344){s=s+(ig[224|o>>12]+ig[128|o>>6&63]+ig[128|o&63]);continue}a+=1,o=65536+((o&1023)<<10|i.charCodeAt(a)&1023),s+=ig[240|o>>18]+ig[128|o>>12&63]+ig[128|o>>6&63]+ig[128|o&63]}return s},Nvt=function(e){for(var n=[{obj:{o:e},prop:"o"}],r=[],i=0;i<n.length;++i)for(var s=n[i],a=s.obj[s.prop],o=Object.keys(a),c=0;c<o.length;++c){var l=o[c],u=a[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(n.push({obj:a,prop:l}),r.push(u))}return Cvt(n),e},Ivt=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},kvt=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Dvt=function(e,n){return[].concat(e,n)},WY={arrayToObject:A_e,assign:Avt,combine:Dvt,compact:Nvt,decode:Mvt,encode:Ovt,isBuffer:kvt,isRegExp:Ivt,merge:Rvt},Pvt=String.prototype.replace,Lvt=/%20/g,Uvt=WY,sie={RFC1738:"RFC1738",RFC3986:"RFC3986"},Bvt=Uvt.assign({default:sie.RFC3986,formatters:{RFC1738:function(t){return Pvt.call(t,Lvt,"+")},RFC3986:function(t){return String(t)}}},sie),M_e=WY,uM=Bvt,Fvt=Object.prototype.hasOwnProperty,aie={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,n){return e+"["+n+"]"},repeat:function(e){return e}},Iw=Array.isArray,zvt=Array.prototype.push,ZG=function(t,e){zvt.apply(t,Iw(e)?e:[e])},Hvt=Date.prototype.toISOString,oie=uM.default,tu={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:M_e.encode,encodeValuesOnly:!1,format:oie,formatter:uM.formatters[oie],indices:!1,serializeDate:function(e){return Hvt.call(e)},skipNulls:!1,strictNullHandling:!1},jvt=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Vvt=function t(e,n,r,i,s,a,o,c,l,u,h,d,f){var p=e;if(typeof o=="function"?p=o(n,p):p instanceof Date?p=u(p):r==="comma"&&Iw(p)&&(p=p.join(",")),p===null){if(i)return a&&!d?a(n,tu.encoder,f,"key"):n;p=""}if(jvt(p)||M_e.isBuffer(p)){if(a){var g=d?n:a(n,tu.encoder,f,"key");return[h(g)+"="+h(a(p,tu.encoder,f,"value"))]}return[h(n)+"="+h(String(p))]}var _=[];if(typeof p>"u")return _;var v;if(Iw(o))v=o;else{var E=Object.keys(p);v=c?E.sort(c):E}for(var T=0;T<v.length;++T){var x=v[T];s&&p[x]===null||(Iw(p)?ZG(_,t(p[x],typeof r=="function"?r(n,x):n,r,i,s,a,o,c,l,u,h,d,f)):ZG(_,t(p[x],n+(l?"."+x:"["+x+"]"),r,i,s,a,o,c,l,u,h,d,f)))}return _},Gvt=function(e){if(!e)return tu;if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var n=e.charset||tu.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=uM.default;if(typeof e.format<"u"){if(!Fvt.call(uM.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=uM.formatters[r],s=tu.filter;return(typeof e.filter=="function"||Iw(e.filter))&&(s=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:tu.addQueryPrefix,allowDots:typeof e.allowDots>"u"?tu.allowDots:!!e.allowDots,charset:n,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:tu.charsetSentinel,delimiter:typeof e.delimiter>"u"?tu.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:tu.encode,encoder:typeof e.encoder=="function"?e.encoder:tu.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:tu.encodeValuesOnly,filter:s,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:tu.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:tu.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:tu.strictNullHandling}},qvt=function(t,e){var n=t,r=Gvt(e),i,s;typeof r.filter=="function"?(s=r.filter,n=s("",n)):Iw(r.filter)&&(s=r.filter,i=s);var a=[];if(typeof n!="object"||n===null)return"";var o;e&&e.arrayFormat in aie?o=e.arrayFormat:e&&"indices"in e?o=e.indices?"indices":"repeat":o="indices";var c=aie[o];i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);for(var l=0;l<i.length;++l){var u=i[l];r.skipNulls&&n[u]===null||ZG(a,Vvt(n[u],u,c,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.formatter,r.encodeValuesOnly,r.charset))}var h=a.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),h.length>0?d+h:""};const O_e=qc(qvt);var $vt=WY;$vt.decode;const M1=Symbol("twurpleRawData");class Wvt{constructor(e){this[M1]=e}}class lx extends Error{constructor(e,n){var r;super(e,n),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function kI(t,e,n){return r=>{const i=n?function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class cie extends lx{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function bv(t){return typeof t=="string"?t:typeof t=="number"?t.toString(10):t.id}class N_e extends lx{constructor(e,n,r,i,s,a){super(`Encountered HTTP status code ${e}: ${n}

URL: ${r}
Method: ${i}
Body:
${!a&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function Yvt(t,e){var n;if(!t.ok){const r=t.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await t.json(),null,2):await t.text(),s=O_e(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),a=`${e.url}${s}`;throw new N_e(t.status,t.statusText,a,(n=e.method)!==null&&n!==void 0?n:"GET",i,r)}}async function Xvt(t){if(t.status===204)return;const e=await t.text();if(e)return JSON.parse(e)}function Kvt(t,e,n){switch(e){case"helix":return`https://api.twitch.tv/helix/${t.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${t.replace(/^\//,"")}`;case"custom":return t;default:return t}}async function Jvt(t,e,n,r,i={},s){var a,o;const c=(a=t.type)!==null&&a!==void 0?a:"helix",l=Kvt(t.url,c),u=O_e(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),h=new R_e.Headers({Accept:"application/json"});let d;t.jsonBody&&(d=JSON.stringify(t.jsonBody),h.append("Content-Type","application/json")),e&&c!=="auth"&&h.append("Client-ID",e),n&&h.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${n}`);const f={...i,method:(o=t.method)!==null&&o!==void 0?o:"GET",headers:h,body:d};return await wvt(`${l}${u}`,f)}async function rz(t,e,n,r,i={}){const s=await Jvt(t,e,n,r,i);return await Yvt(s,t),await Xvt(s)}class kw extends lx{constructor(e){super("Invalid token supplied",e)}}class zP extends lx{}function Zvt(t,e,n,r){return{grant_type:"authorization_code",client_id:t,client_secret:e,code:n,redirect_uri:r}}function Qvt(t,e){return{grant_type:"client_credentials",client_id:t,client_secret:e}}function eyt(t,e,n){return{grant_type:"refresh_token",client_id:t,client_secret:e,refresh_token:n}}let QG=class extends Wvt{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[M1].client_id}get userId(){var e;return(e=this[M1].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[M1].login)!==null&&e!==void 0?e:null}get scopes(){return this[M1].scopes}get expiryDate(){return VO(this[M1].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};QG=aa([kI("auth","TokenInfo","clientId")],QG);function YY(t){var e,n;return{accessToken:t.access_token,refreshToken:t.refresh_token||null,scope:(e=t.scope)!==null&&e!==void 0?e:[],expiresIn:(n=t.expires_in)!==null&&n!==void 0?n:null,obtainmentTimestamp:Date.now()}}async function tyt(t,e,n,r){return YY(await rz({type:"auth",url:"token",method:"POST",query:Zvt(t,e,n,r)}))}async function nyt(t,e){return YY(await rz({type:"auth",url:"token",method:"POST",query:Qvt(t,e)}))}async function lie(t,e,n){return YY(await rz({type:"auth",url:"token",method:"POST",query:eyt(t,e,n)}))}async function GO(t,e){try{const n=await rz({type:"auth",url:"validate"},e,t);return new QG(n)}catch(n){throw n instanceof N_e&&n.statusCode===401?new kw({cause:n}):n}}const ryt=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function iyt(t,e){if(e!=null&&e.length){const n=new Set(t.flatMap(r=>{var i;return[r,...(i=ryt.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!n.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function HP(t,e){for(const n of e)iyt(t,n)}async function syt(t,e,n,r,i){if(i!=null&&i.length||!n){const s=await GO(e,t);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const a=r??s.scopes;return i&&HP(a,i.filter(o=>!!o)),[a,s.userId]}return[r,n]}class uie{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var n;const r=e.filter(o=>!!o);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:o,resolve:c,reject:l}=XG();this._queuePromise=o,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(h){l(h)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:a}=XG();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(o){a(o)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(n=this._queueExecutor)===null||n===void 0||n.call(this)}return await i}}class hie extends lx{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class ayt extends lx{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class oyt extends lx{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let Lb=class extends II{constructor(e){var n;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(n=e.appImpliedScopes)!==null&&n!==void 0?n:[],this._appTokenFetcher=new uie(async r=>await this._fetchAppToken(r))}addUser(e,n,r){const i=bv(e);if(!n.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...n,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new uie(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,n){let r=null;if(e.accessToken&&!FP(e))try{const o=await GO(e.accessToken);r=[e,o]}catch(o){if(!(o instanceof kw))throw o}if(!r){if(!e.refreshToken)throw new kw;const o=await lie(this._clientId,this._clientSecret,e.refreshToken),c=await GO(o.accessToken);this.emit(this.onRefresh,c.userId,o),r=[o,c]}const[i,s]=r;if(!s.userId)throw new zP("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const a=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,a,n),s.userId}async addUserForCode(e,n){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await tyt(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,n)}hasUser(e){return this._userTokenFetchers.has(bv(e))}removeUser(e){const n=bv(e);if(this._userIdToIntents.has(n)){const r=this._userIdToIntents.get(n);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(n)}this._userAccessTokens.delete(n),this._userTokenFetchers.delete(n),this._cachedRefreshFailures.delete(n)}addIntentsToUser(e,n){const r=bv(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of n)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const n=bv(e);return this._userIdToIntents.has(n)?Array.from(this._userIdToIntents.get(n)):[]}removeIntents(e){var n;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(n=this._userIdToIntents.get(i))===null||n===void 0||n.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const n=bv(e);if(this._cachedRefreshFailures.has(n))throw new hie(n);const r=this._userAccessTokens.get(n);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(n,r.refreshToken);return this._checkIntermediateUserRemoval(n),this._userAccessTokens.set(n,{...i,userId:n}),this.emit(this.onRefresh,n,i),{...i,userId:n}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new oyt(e);const n=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(n)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var n;const r=this._userAccessTokens.get(bv(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(n=r.scope)!==null&&n!==void 0?n:[]}async getAccessTokenForUser(e,...n){const r=bv(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new hie(r);return HP(this.getCurrentScopesForUser(r),n.filter(Boolean)),await i.fetch(...n)}async getAccessTokenForIntent(e,...n){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...n);if(!i)throw new cie(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const n=bv(e);if(this._userAccessTokens.has(n)){const r=await this.getAccessTokenForUser(n);if(!r)throw new cie(`Token for user ID ${n} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:n}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(n=>[n]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new ayt(e)}async _fetchUserToken(e,n){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!FP(r))try{if(r.scope)return HP(r.scope,n),r;const[s=[]]=await syt(this._clientId,r.accessToken,e,r.scope,n),a={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,a),a}catch(s){if(!(s instanceof kw))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return HP(i.scope,n),i}async _refreshUserTokenWithCallback(e,n){try{return await lie(this.clientId,this._clientSecret,n)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const n of e)if(this._appImpliedScopes.length){if(n.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${n.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${n.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||FP(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await nyt(this._clientId,this._clientSecret)}};aa([aE(!1)],Lb.prototype,"_clientSecret",void 0);aa([aE(!1)],Lb.prototype,"_userAccessTokens",void 0);aa([aE(!1)],Lb.prototype,"_userTokenFetchers",void 0);aa([aE(!1)],Lb.prototype,"_appAccessToken",void 0);aa([aE(!1)],Lb.prototype,"_appTokenFetcher",void 0);Lb=aa([kI("auth","RefreshingAuthProvider","clientId")],Lb);class cyt extends II{constructor({lineBased:e,logger:n,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=n,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var n,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(n=i.shift())!==null&&n!==void 0?n:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class lyt{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class uyt extends II{constructor(e,n,r={}){var i;super(),this._type=e,this._target=n,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&n!==void 0?n:!1}get isConnecting(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&n!==void 0?n:this._connecting}get hasSocket(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&n!==void 0?n:!1}sendLine(e){var n;(n=this._currentConnection)===null||n===void 0||n.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const n=this._currentConnection;this._currentConnection=void 0,n.disconnect()}}assumeExternalDisconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(n=this._currentConnection)===null||n===void 0||n.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var n,r;(n=this._logger)===null||n===void 0||n.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=b_e(120));const s=this._currentConnection=new this._type(ovt(this._target),this._config);s.onReceive(a=>this.emit(this.onReceive,a)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((a,o)=>{var c,l,u;if(this.emit(this.onDisconnect,a,o),a)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=o==null?void 0:o.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var d;this._connecting&&((d=this._logger)===null||d===void 0||d.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var O1=null;typeof WebSocket<"u"?O1=WebSocket:typeof MozWebSocket<"u"?O1=MozWebSocket:typeof Qp<"u"?O1=Qp.WebSocket||Qp.MozWebSocket:typeof window<"u"?O1=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(O1=self.WebSocket||self.MozWebSocket);class hyt extends cyt{constructor(e,n){if(super(n),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var n;(n=this._socket)===null||n===void 0||n.send(e)}connect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new O1(this._url,(n=this._additionalOptions)===null||n===void 0?void 0:n.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,a=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${a.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const o=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,o),this.emit(this.onEnd,!1,o)}this.clearSocket()}}disconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(n=this._socket)===null||n===void 0||n.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function hM(t){var e,n,r;if(Array.isArray(t)){for(n=Array(e=t.length);e--;)n[e]=(r=t[e])&&typeof r=="object"?hM(r):r;return n}if(Object.prototype.toString.call(t)==="[object Object]"){n={};for(e in t)e==="__proto__"?Object.defineProperty(n,e,{value:hM(t[e]),configurable:!0,enumerable:!0,writable:!0}):n[e]=(r=t[e])&&typeof r=="object"?hM(r):r;return n}return t}const dyt={name:"away-notify"};class HU extends Error{constructor(e,n,r){super(`command "${e}" expected ${n} or more parameters, got ${r}`),this._command=e,this._expectedParams=n,this._actualParams=r,Object.setPrototypeOf(this,HU.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,HU)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class jU extends Error{constructor(e,n,r,i){var s;super(`required parameter "${n}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=n,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,jU.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jU)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const Dw={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var I_e={exports:{}};(function(t){t.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},t.exports.default=t.exports})(I_e);var fyt=I_e.exports;const pyt=qc(fyt);function eq(t,e="#&"){return new RegExp(`^[${pyt(e)}][^ \b\0
\r,]+$`).test(t)}const die={0:"\0",n:`
`,r:"\r","":""};function fie(t){if(!t.startsWith("")||(t=t.substring(1),t.endsWith("")&&(t=t.slice(0,-1)),!t))return!1;t=t.replace(/\x10(.)/,(r,i)=>i in die?die[i]:"");let[e,n=""]=tT(t," ",2);return e=e?e.toUpperCase():"",{command:e,params:n}}const myt={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function gyt(t){return t.replace(/[\\;\n\r ]/g,e=>`\\${myt[e]}`)}function vyt(t){let e=`${t.nick}`;return t.user&&(e+=`!${t.user}`),t.host&&(e+=`@${t.host}`),e}function yyt(t,e,n,r,i=Dw,s=!1){const a=new t(t.COMMAND,void 0,{serverProperties:i}),o={};if(a._paramSpec&&YG(a._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(t.checkParam(u,c,i))o[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in o)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${t.COMMAND}"`)}}),a._parsedParams=o,a._paramSpec)for(const c of Object.keys(a._paramSpec))Object.defineProperty(a,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return a._initPrefixAndTags(n,r),a}class zt{static checkParam(e,n,r=Dw){return!(n.type==="channel"&&!eq(e,r.channelTypes)||n.type==="channelList"&&!e.split(",").every(s=>eq(s,r.channelTypes))||n.match&&!n.match.test(e))}constructor(e,{params:n,tags:r,prefix:i,rawLine:s}={},{serverProperties:a=Dw,isServer:o=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=Dw,this._paramSpec=l,this._command=e,this._params=n,this._tags=r??new Map,this._prefix=i,this._serverProperties=a,this._raw=s,c&&this.parseParams(o)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(n=>n.noServer&&e||n.noClient&&!e?!1:!n.optional).length:0}get paramCount(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0}prefixToString(){return this._prefix?vyt(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,n])=>n?`${e}=${gyt(n)}`:e).join(";")}toString(e=!1,n=!1){const i=[n?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const a=this.prefixToString();a&&i.unshift(`:${a}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,n){this._prefix=e,n&&(this._tags=n)}parseParams(e=!1){if(this._params){let n=this.getMinParamCount(e);if(n>this._params.length)throw new HU(this._command,n,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[a,o]of Object.entries(r)){if(o.noServer&&e||o.noClient&&!e)continue;if(this._params.length-i<=n){if(o.optional)continue;if(this._params.length-i!==n)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(o.optional)break;throw new Error("unexpected parameter underflow")}if(o.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(o.optional)continue;throw new Error(`no parameters left for required rest parameter "${a}"`)}c={value:l.join(" "),trailing:!1}}if(zt.checkParam(c.value,o))s[a]={...c},o.optional||--n,o.rest||++i;else if(!o.optional)throw new jU(this._command,a,o,c.value);if(o.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const a of Object.keys(this._paramSpec))Object.defineProperty(this,a,{get(){var o,c;return(c=(o=this._parsedParams)===null||o===void 0?void 0:o[a])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&n!==void 0?n:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(n=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[n];if(i)return(i.trailing?":":"")+i.value}).filter(n=>n!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,n;return[this._command,...(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&n!==void 0?n:[]].join(" ")}}zt.COMMAND="";zt.SUPPORTS_CAPTURE=!1;class k_e extends zt{constructor(e,n,r){super(e,n,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}k_e.COMMAND="BATCH";const _yt={name:"batch",messageTypes:[k_e],usesTags:!0},byt={name:"cap-notify"};class D_e extends zt{constructor(e,n,r){super(e,n,r,{newUser:{},newHost:{}})}}D_e.COMMAND="CHGHOST";const Eyt={name:"chghost",messageTypes:[D_e]},Syt={name:"invite-notify"};class P_e extends zt{}P_e.COMMAND="ACK";const Tyt={name:"labeled-response",messageTypes:[P_e],usesTags:!0},xyt={name:"message-tags",usesTags:!0},wyt={name:"multi-prefix"},Cyt=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:dyt,Batch:_yt,CapNotify:byt,ChgHost:Eyt,InviteNotify:Syt,LabeledResponse:Tyt,MessageTags:xyt,MultiPrefix:wyt},Symbol.toStringTag,{value:"Module"}));class Ryt{constructor(e,n,...r){this._client=e,this._originalMessage=n,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const n=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,n)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class XY extends zt{constructor(e,n,r){super(e,n,r,{password:{}})}}XY.COMMAND="PASS";class dM extends zt{constructor(e,n,r){super(e,n,r,{nick:{}})}}dM.COMMAND="NICK";class KY extends zt{constructor(e,n,r){super(e,n,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}KY.COMMAND="USER";class L_e extends zt{constructor(e,n,r){super(e,n,r,{name:{},password:{}})}}L_e.COMMAND="OPER";class JY extends zt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}JY.COMMAND="QUIT";class U_e extends zt{constructor(e,n,r){super(e,n,r,{server:{},reason:{trailing:!0}})}}U_e.COMMAND="SQUIT";class qO extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},key:{optional:!0}})}}qO.COMMAND="JOIN";class $O extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}$O.COMMAND="PART";class VU extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,VU.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,VU)}get char(){return this._char}}class B_e extends zt{constructor(e,n,r){super(e,n,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return eq(this.target,this._serverProperties.channelTypes)}separate(){const e=[],n=this.modes;if(!n)throw new Error("can't separate a channel mode request, just set actions");const r=n.split(" "),i=r.shift();let s="add";for(const a of i){let o=s;switch(a){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(a)||this._serverProperties.supportedChannelModes.prefix.includes(a))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(a))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(a))r.length?c=!0:o="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(a))throw new VU(a)}else l=this._serverProperties.supportedUserModes.includes(a);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:o,letter:a,param:c?r.shift():void 0,known:l})}}}return e}}B_e.COMMAND="MODE";class F_e extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}F_e.COMMAND="TOPIC";class DI extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channelList",optional:!0}})}}DI.COMMAND="NAMES";DI.SUPPORTS_CAPTURE=!0;class z_e extends zt{constructor(e,n,r){super(e,n,r,{channel:{optional:!0},server:{optional:!0}})}}z_e.COMMAND="LIST";class H_e extends zt{constructor(e,n,r){super(e,n,r,{target:{},channel:{type:"channel"}})}}H_e.COMMAND="INVITE";class j_e extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}j_e.COMMAND="KICK";class V_e extends zt{constructor(e,n,r){super(e,n,r,{server:{optional:!0}})}}V_e.COMMAND="TIME";class WO extends zt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}WO.COMMAND="PRIVMSG";class iz extends zt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}iz.COMMAND="NOTICE";class sz extends zt{constructor(e,n,r){super(e,n,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}sz.COMMAND="WHO";class G_e extends zt{constructor(e,n,r){super(e,n,r,{server:{optional:!0},nickMask:{}})}}G_e.COMMAND="WHOIS";class q_e extends zt{constructor(e,n,r){super(e,n,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}q_e.COMMAND="WHOWAS";class $_e extends zt{constructor(e,n,r){super(e,n,r,{target:{},reason:{trailing:!0,optional:!0}})}}$_e.COMMAND="KILL";class GU extends zt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}GU.COMMAND="PING";class qU extends zt{constructor(e,n,r){super(e,n,r,{server:{noClient:!0},text:{trailing:!0}})}}qU.COMMAND="PONG";class W_e extends zt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}W_e.COMMAND="ERROR";class Y_e extends zt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}Y_e.COMMAND="AWAY";class X_e extends zt{}X_e.COMMAND="REHASH";class K_e extends zt{}K_e.COMMAND="RESTART";class J_e extends zt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}J_e.COMMAND="WALLOPS";class Z_e extends zt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Z_e.COMMAND="USERHOST";class Q_e extends zt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}Q_e.COMMAND="ISON";class Bf extends zt{constructor(e,n,r){super(e,n,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof Bf))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof Bf))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}Bf.COMMAND="CAP";Bf.SUPPORTS_CAPTURE=!0;class ebe extends zt{constructor(e,n,r){super(e,n,r,{target:{}})}}ebe.COMMAND="TAGMSG";const tbe=Object.freeze(Object.defineProperty({__proto__:null,Away:Y_e,CapabilityNegotiation:Bf,ChannelInvite:H_e,ChannelJoin:qO,ChannelKick:j_e,ChannelList:z_e,ChannelPart:$O,ClientQuit:JY,ErrorMessage:W_e,IsOnQuery:Q_e,Kill:$_e,Mode:B_e,Names:DI,NickChange:dM,Notice:iz,OperLogin:L_e,Password:XY,Ping:GU,Pong:qU,PrivateMessage:WO,Rehash:X_e,Restart:K_e,ServerQuit:U_e,TagMessage:ebe,Time:V_e,Topic:F_e,UserHostQuery:Z_e,UserRegistration:KY,Wallops:J_e,WhoIsQuery:G_e,WhoQuery:sz,WhoWasQuery:q_e},Symbol.toStringTag,{value:"Module"}));class ZY extends zt{constructor(e,n,r){super(e,n,r,{me:{},welcomeText:{trailing:!0}})}}ZY.COMMAND="001";class nbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},yourHost:{trailing:!0}})}}nbe.COMMAND="002";class rbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},createdText:{trailing:!0}})}}rbe.COMMAND="003";class QY extends zt{constructor(e,n,r){super(e,n,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}QY.COMMAND="004";class eX extends zt{constructor(e,n,r){super(e,n,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}eX.COMMAND="005";class ibe extends zt{constructor(e,n,r){super(e,n,r,{me:{},modes:{}})}}ibe.COMMAND="221";class sbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},text:{trailing:!0}})}}sbe.COMMAND="301";class abe extends zt{constructor(e,n,r){super(e,n,r,{me:{},hosts:{trailing:!0}})}}abe.COMMAND="302";class obe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}obe.COMMAND="305";class cbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}cbe.COMMAND="306";class lbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}lbe.COMMAND="311";class ube extends zt{constructor(e,n,r){super(e,n,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof sz}endsResponseTo(){return!0}}ube.COMMAND="315";class hbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}hbe.COMMAND="318";class dbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channels:{trailing:!0}})}}dbe.COMMAND="319";class fbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}fbe.COMMAND="322";class pbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}pbe.COMMAND="323";class mbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}mbe.COMMAND="324";class gbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}gbe.COMMAND="331";class vbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}vbe.COMMAND="332";class ybe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}ybe.COMMAND="333";class _be extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"}})}}_be.COMMAND="341";class bbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}bbe.COMMAND="348";class Ebe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Ebe.COMMAND="349";class Sbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof sz}}Sbe.COMMAND="352";class Tbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof DI}}Tbe.COMMAND="353";class xbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof DI}endsResponseTo(){return!0}}xbe.COMMAND="366";class wbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}wbe.COMMAND="367";class Cbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Cbe.COMMAND="368";class Rbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}Rbe.COMMAND="372";class Abe extends zt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}Abe.COMMAND="375";class tX extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}tX.COMMAND="376";class Mbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Mbe.COMMAND="381";class Obe extends zt{constructor(e,n,r){super(e,n,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}Obe.COMMAND="391";class Nbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}}Nbe.COMMAND="401";class Ibe extends zt{constructor(e,n,r){super(e,n,r,{me:{},server:{},suffix:{trailing:!0}})}}Ibe.COMMAND="402";class kbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}kbe.COMMAND="403";class Dbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Dbe.COMMAND="404";class Pbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Pbe.COMMAND="405";class Lbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}Lbe.COMMAND="410";class Ube extends zt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}Ube.COMMAND="421";class nX extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}nX.COMMAND="422";class Bbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Bbe.COMMAND="431";class Fbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Fbe.COMMAND="432";class zbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}zbe.COMMAND="433";class Hbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Hbe.COMMAND="436";class jbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}jbe.COMMAND="441";class Vbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Vbe.COMMAND="442";class Gbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Gbe.COMMAND="443";class qbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}qbe.COMMAND="451";class $be extends zt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}$be.COMMAND="461";class rX extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}rX.COMMAND="462";class Wbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Wbe.COMMAND="471";class Ybe extends zt{constructor(e,n,r){super(e,n,r,{me:{},char:{},suffix:{trailing:!0}})}}Ybe.COMMAND="472";class Xbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Xbe.COMMAND="473";class Kbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Kbe.COMMAND="474";class Jbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Jbe.COMMAND="475";class Zbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Zbe.COMMAND="479";class Qbe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Qbe.COMMAND="481";class eEe extends zt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}eEe.COMMAND="482";class tEe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}tEe.COMMAND="491";class nEe extends zt{constructor(e,n,r){super(e,n,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}nEe.COMMAND="501";class rEe extends zt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}rEe.COMMAND="502";const iEe=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:Nbe,Error402NoSuchServer:Ibe,Error403NoSuchChannel:kbe,Error404CanNotSendToChan:Dbe,Error405TooManyChannels:Pbe,Error410InvalidCapCmd:Lbe,Error421UnknownCommand:Ube,Error422NoMotd:nX,Error431NoNickNameGiven:Bbe,Error432ErroneusNickname:Fbe,Error433NickNameInUse:zbe,Error436NickCollision:Hbe,Error441UserNotInChannel:jbe,Error442NotOnChannel:Vbe,Error443UserOnChannel:Gbe,Error451NotRegistered:qbe,Error461NeedMoreParams:$be,Error462AlreadyRegistered:rX,Error471ChannelIsFull:Wbe,Error472UnknownMode:Ybe,Error473InviteOnlyChan:Xbe,Error474BannedFromChan:Kbe,Error475BadChannelKey:Jbe,Error479BadChanName:Zbe,Error481NoPrivileges:Qbe,Error482ChanOpPrivsNeeded:eEe,Error491NoOperHost:tEe,Error501UmodeUnknownFlag:nEe,Error502UsersDontMatch:rEe,Reply001Welcome:ZY,Reply002YourHost:nbe,Reply003Created:rbe,Reply004ServerInfo:QY,Reply005Isupport:eX,Reply221UmodeIs:ibe,Reply301Away:sbe,Reply302UserHost:abe,Reply305UnAway:obe,Reply306NowAway:cbe,Reply311WhoisUser:lbe,Reply315EndOfWho:ube,Reply318EndOfWhois:hbe,Reply319WhoisChannels:dbe,Reply322List:fbe,Reply323ListEnd:pbe,Reply324ChannelModeIs:mbe,Reply331NoTopic:gbe,Reply332Topic:vbe,Reply333TopicWhoTime:ybe,Reply341Inviting:_be,Reply348ExceptList:bbe,Reply349EndOfExceptList:Ebe,Reply352WhoReply:Sbe,Reply353NamesReply:Tbe,Reply366EndOfNames:xbe,Reply367BanList:wbe,Reply368EndOfBanList:Cbe,Reply372Motd:Rbe,Reply375MotdStart:Abe,Reply376EndOfMotd:tX,Reply381YoureOper:Mbe,Reply391Time:Obe},Symbol.toStringTag,{value:"Module"})),Ayt=new Map([...Object.values(tbe),...Object.values(iEe)].map(t=>[t.COMMAND,t]));function Myt(t){const[e,n]=tT(t,"!",2);if(n){const[r,i]=tT(n,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const pie={":":";",n:`
`,r:"\r",s:" "};function Oyt(t){const e=new Map,n=t.split(";");for(const r of n){const[i,s]=tT(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(a,o)=>Object.prototype.hasOwnProperty.call(pie,o)?pie[o]:o):"")}return e}function Nyt(t,e=Dw,n=Ayt,r=!1,i=[],s=!0){const a=t.split(" ");let o,c;const l=[];let u,h;for(;a.length;){if([o]=a,o.startsWith("@")&&!u&&!c&&!h)u=Oyt(o.slice(1));else if(o.startsWith(":"))if(!h&&!c)o.length>1&&(h=Myt(o.slice(1)));else{l.push({value:a.join(" ").slice(1),trailing:!0});break}else c?l.push({value:o,trailing:!1}):c=o.toUpperCase();a.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${t}`);s&&(s=!i.includes(c));let d=zt;return n.has(c)&&(d=n.get(c)),new d(c,{params:l,tags:u,prefix:h,rawLine:t},{serverProperties:e,isServer:r,shouldParseParams:s})}class sEe extends II{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=hM(Dw),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:n,credentials:r,channels:i,channelTypes:s,webSocket:a,logger:o={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=n;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=nz({name:"ircv3",emoji:!0,...o}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:d=!0}=n,f={hostName:u,port:this.port,secure:h},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},g=a?hyt:lyt;d?this._connection=new uyt(g,f,p):this._connection=new g(p,this._logger,e.connectionOptions);for(const _ of Object.values(Cyt))this.addCapability(_);this.addInternalListener(this.onRegister,async()=>{const _=this._hasRegisteredBefore,v=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const E=_&&this._options.rejoinChannelsOnReconnect?v:await WG(i);if(E)for(const T of E)this.join(T)}),this.onTypedMessage(Bf,async({subCommand:_,capabilities:v})=>{const E=v.split(" ");switch(_.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${E.join(", ")}`);const T=kD(E,N=>{if(!N)return{};const[A,I]=tT(N,"=",2);return{[A]:{name:A,param:I||!0}}});for(const[N,A]of Object.entries(T))this._serverCapabilities.set(N,A);const x=Object.keys(T);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([N])=>x.includes(N)).map(([,N])=>N));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${E.join(", ")}`);for(const T of E)this._serverCapabilities.delete(T),this._negotiatedCapabilities.delete(T)}}}),this.onTypedMessage(GU,({text:_})=>{this.sendMessage(qU,{text:_})}),this.onTypedMessage(ZY,({me:_})=>this._handleReceivedClientNick(_)),this.onTypedMessage(QY,({userModes:_})=>{_&&(this._serverProperties.supportedUserModes=_)}),this.onTypedMessage(eX,({supports:_})=>{const v=kD(_.split(" "),E=>{const[T,x]=tT(E,"=",2);return{[T]:x||!0}});this._supportedFeatures={...this._supportedFeatures,...v}}),this.onTypedMessage(tX,({me:_})=>{this._registered||(this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(nX,({me:_})=>{this._registered||(this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(rX,({me:_})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(WO,_=>{var v;const{target:E,text:T}=_,x=fie(T),N=(v=_.prefix)===null||v===void 0?void 0:v.nick;x?x.command==="ACTION"?this.emit(this.onAction,E,N,x.params,_):this.emit(this.onCtcp,E,N,x.command,x.params,_):this.emit(this.onPrivmsg,E,N,T,_)}),this.onTypedMessage(dM,_=>{var v;const{nick:E}=_,T=(v=_.prefix)===null||v===void 0?void 0:v.nick;T===this._currentNick&&(this._currentNick=E),this.emit(this.onNickChange,T,E,_)}),this.onTypedMessage(iz,_=>{var v;const{target:E,text:T}=_,x=fie(T),N=(v=_.prefix)===null||v===void 0?void 0:v.nick;x&&this.emit(this.onCtcpReply,E,N,x.command,x.params,_),this.emit(this.onNotice,E,N,T,_)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(qO,({channel:_,prefix:v})=>{(v==null?void 0:v.nick)===this._currentNick&&this.acknowledgeJoin(_)}),this.onTypedMessage($O,_=>{var v;((v=_.prefix)===null||v===void 0?void 0:v.nick)===this._currentNick&&(this._currentChannels.delete(_.channel),this._channelsFromLastRegister.delete(_.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var n;this._logger.debug(`Received message: ${e}`);let r;try{r=Nyt(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((n=i.stack)!==null&&n!==void 0?n:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return hM(this._serverProperties)}get port(){const{webSocket:e,connection:{port:n,secure:r}}=this._options;return n||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),n=e.toString(),r=this.onTypedMessage(qU,i=>{const{text:s}=i;s===n&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(GU,{text:n})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const n of Object.values(e.messageTypes))this.registerMessageType(n)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,n,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${lvt(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,n),r}onTypedMessage(e,n,r){return this.onNamedMessage(e.COMMAND,n,r)}removeMessageListener(e){const[n]=e.split(":");this._events.has(n)&&this._events.get(n).delete(e)}createMessage(e,n,r){const i=r?new Map(Object.entries(r)):void 0;return yyt(e,n,void 0,i,this.serverProperties)}sendMessage(e,n,r){this.send(this.createMessage(e,n,r))}async sendMessageAndCaptureReply(e,n){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,n),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...n){const r=new Ryt(this,e,...n);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(n=>n===e),1)}join(e,n){this.sendMessage(qO,{channel:e,key:n})}part(e){this.sendMessage($O,{channel:e})}quit(e){this.sendMessage(JY,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,n,r={}){this.sendMessage(WO,{target:e,text:n},r)}sendCtcp(e,n,r){this.say(e,`${n.toUpperCase()} ${r}`)}action(e,n){this.sendCtcp(e,"ACTION",n)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(dM,{nick:e}))}registerCoreMessageTypes(){YG(tbe,e=>{this.registerMessageType(e)}),YG(iEe,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(n=>n.length).map(async n=>await this._negotiateCapabilities(n)))}async _negotiateCapabilities(e){const n=kD(e,a=>({[a.name]:a})),i=(await this.sendMessageAndCaptureReply(Bf,{subCommand:"REQ",capabilities:e.map(a=>a.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof Bf))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(a=>a);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const a=s.map(o=>n[o]);for(const o of a){const c=this._clientCapabilities.get(o.name);c.param=o.param,this._negotiatedCapabilities.set(c.name,c)}return a}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,n;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([WG(this._options.credentials.password),this.sendMessageAndCaptureReply(Bf,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof Bf))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(o=>kD(o.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=tT(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const a=s.map(o=>{const c=Object.keys(o);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(a)}).then(()=>{this.sendMessage(Bf,{subCommand:"END"})})]);r&&this.sendMessage(XY,{password:r}),this.sendMessage(dM,{nick:this._desiredNick}),this.sendMessage(KY,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(n=this._realName)!==null&&n!==void 0?n:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,n)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=n?`Disconnected unexpectedly: ${n.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,n)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const n=this._events.get(e.constructor.COMMAND);if(n)for(const r of n.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}aa([aE(!1)],sEe.prototype,"_options",void 0);class iX extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}iX.COMMAND="CLEARCHAT";class aEe extends zt{}aEe.COMMAND="RECONNECT";class sX extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}sX.COMMAND="ROOMSTATE";function Iyt(t){switch(typeof t){case"undefined":return"";case"object":{if(t===null)return"";if("cacheKey"in t)return t.cacheKey;const e=JSON.stringify(t);if(e!=="{}")return e}default:return t.toString()}}function oEe(t,e,n){return[t,...e.map(Iyt)].join("/")+(n?"/":"")}const Ev=Symbol("cache");function kyt(t){var e,n;return n=class extends t{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[Ev].has(r)){const i=this[Ev].get(r);if(i)return i.value}}setCache(r,i,s){this[Ev].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[Ev].forEach((a,o)=>{o.startsWith(s)&&this[Ev].delete(o)}):this[Ev].delete(s)}_cleanCache(){const r=Date.now();this[Ev].forEach((i,s)=>{i.expires<r&&this[Ev].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return oEe(s,r,i)}}},e=Ev,n}function cEe(t=1/0){return function(e,n,r){if(r.get){const i=r.get;r.get=function(){const s=oEe(n,[]),a=this.getFromCache(s);if(a)return a;const o=i.call(this);return this.setCache(s,o,t),o}}return r}}var jP;let Ub=jP=class{constructor(e,n){this._userName=e.toLowerCase(),this._userData=n?new Map(n):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(n=>{const r=n.indexOf("/");return r===-1?[n,""]:[n.slice(0,r),n.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return jP._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return jP._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};aa([aE(!1)],Ub.prototype,"_userData",void 0);aa([cEe()],Ub.prototype,"badges",null);aa([cEe()],Ub.prototype,"badgeInfo",null);Ub=jP=aa([kyt,kI("chat","ChatUser","userId")],Ub);function aX(t){return t?new Map(t.split("/").map(e=>{const[n,r]=e.split(":",2);return r?[n,r.split(",")]:null}).filter(e=>e!==null)):new Map}class oX extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Ub(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return aX(this._tags.get("emotes"))}}oX.COMMAND="USERNOTICE";class lEe extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}lEe.COMMAND="USERSTATE";class cX extends zt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}get userInfo(){return new Ub(this._prefix.nick,this._tags)}get emoteOffsets(){return aX(this._tags.get("emotes"))}}cX.COMMAND="WHISPER";const Dyt={name:"twitch.tv/commands",messageTypes:[iX,aEe,sX,oX,lEe,cX]},Pyt={name:"twitch.tv/membership"};class lX extends zt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}lX.COMMAND="CLEARMSG";class uEe extends zt{}uEe.COMMAND="GLOBALUSERSTATE";const Lyt={name:"twitch.tv/tags",messageTypes:[uEe,lX]},Uyt=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let $U=class extends WO{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Ub(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return aX(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return VO(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return VO(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?Uyt.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};$U=aa([kI("chat","ChatMessage","id")],$U);function Byt(t){return t instanceof $U?t.tags.get("id"):t}function mie(t,e){if(t.length<=e)return[t];t=t.trim();const n=[];let r=0,i=e;for(;r<t.length;){let s=t.lastIndexOf(" ",i);(s===-1||s<=r||t.length-r+1<=e)&&(s=r+e);const a=t.slice(r,s).trim();a.length&&n.push(a),r=s+(t[s]===" "?1:0),i=r+e}return n}const Fyt=/^[a-z0-9][a-z0-9_]{0,24}$/;function xc(t){const e=t.replace(/^#/,"").toLowerCase();if(!Fyt.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function DD(t){return`#${xc(t)}`}var tq;let WU=tq=class extends II{constructor(e={}){var n,r,i,s,a;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new zP("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new sEe({connection:{hostName:(n=e.hostName)!==null&&n!==void 0?n:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{this._messageRateLimiter.clear(),this._messageRateLimiter.pause(),this._joinRateLimiter.clear(),this._joinRateLimiter.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType($U),this._chatLogger=nz({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(a=e.authIntents)!==null&&a!==void 0?a:[],"chat"];const o=async({type:l,text:u,channel:h,tags:d})=>{l==="say"?this._ircClient.say(h,u,d):this._ircClient.action(h,u)},c=async l=>{const{promise:u,resolve:h,reject:d}=XG();let f;const p=this.addInternalListener(this._onJoinResult,(g,_,v)=>{g===l&&(clearTimeout(f),v?d(v):h(),this.removeListener(p))});f=setTimeout(()=>{this.removeListener(p),this.emit(this._onJoinResult,l,void 0,"twurple_timeout"),d(new Error(`Did not receive a reply to join ${l} in time; assuming that the join failed`))},1e4),this._ircClient.join(l),await u};if(e.isAlwaysMod)this._messageRateLimiter=new KG({bucketSize:e.botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:o});else{let l=20;e.botLevel==="verified"?l=7500:e.botLevel==="known"&&(l=50),this._messageRateLimiter=new Evt(new bvt({bucketSize:1,timeFrame:1200,logger:{minLevel:pr.ERROR},doRequest:o,getPartitionKey:({channel:u})=>u}),{bucketSize:l,timeFrame:32e3})}this._joinRateLimiter=new KG({bucketSize:e.botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:c}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause(),this._ircClient.addCapability(Lyt),this._ircClient.addCapability(Dyt),e.requestMembershipEvents&&this._ircClient.addCapability(Pyt),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{this._messageRateLimiter.resume(),this._joinRateLimiter.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const l=await WG(e.channels);l&&await Promise.all(l.map(async u=>{var h;try{await this.join(u)}catch(d){this._chatLogger.warn(`Failed to join configured channel ${u}; original message: ${(h=d==null?void 0:d.message)!==null&&h!==void 0?h:d}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,d)=>{u!=="jtv"&&this.emit(this.onMessage,xc(l),u,h,d)}),this._ircClient.onAction((l,u,h,d)=>{this.emit(this.onAction,xc(l),u,h,d)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,xc(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(iX,l=>{const{channel:u,user:h,tags:d}=l,f=xc(u);if(h){const p=d.get("ban-duration");p===void 0?this.emit(this.onBan,f,h,l):this.emit(this.onTimeout,f,h,Number(p),l)}else this.emit(this.onChatClear,f,l)}),this._ircClient.onTypedMessage(lX,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,xc(u),h,l)}),this._ircClient.onTypedMessage(qO,({prefix:l,channel:u})=>{this.emit(this.onJoin,xc(u),l.nick)}),this._ircClient.onTypedMessage($O,({prefix:l,channel:u})=>{this.emit(this.onPart,xc(u),l.nick)}),this._ircClient.onTypedMessage(sX,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const d=xc(l);if(u.has("slow")){const f=Number(u.get("slow"));f?this.emit(this.onSlow,d,!0,f):this.emit(this.onSlow,d,!1)}if(u.has("followers-only")){const f=Number(u.get("followers-only"));f===-1?this.emit(this.onFollowersOnly,d,!1):this.emit(this.onFollowersOnly,d,!0,f)}}}),this._ircClient.onTypedMessage(oX,l=>{const{channel:u,text:h,tags:d}=l,f=d.get("msg-id"),p=xc(u);switch(f){case"sub":case"resub":{const g=f==="sub"?this.onSub:this.onResub,_=d.get("msg-param-sub-plan"),v=d.get("msg-param-streak-months"),E={userId:d.get("user-id"),displayName:d.get("display-name"),plan:_,planName:d.get("msg-param-sub-plan-name"),isPrime:_==="Prime",months:Number(d.get("msg-param-cumulative-months")),streak:v?Number(v):void 0,message:h};if(d.get("msg-param-was-gifted")==="true"){const x=d.get("msg-param-anon-gift")==="true",N=Number(d.get("msg-param-gift-months")),A=Number(d.get("msg-param-gift-month-being-redeemed"));x?E.originalGiftInfo={anonymous:!0,duration:N,redeemedMonth:A}:E.originalGiftInfo={anonymous:!1,duration:N,redeemedMonth:A,userId:d.get("msg-param-gifter-id"),userName:d.get("msg-param-gifter-login"),userDisplayName:d.get("msg-param-gifter-name")}}this.emit(g,p,d.get("login"),E,l);break}case"subgift":{const g=d.get("msg-param-sub-plan"),_=d.get("login"),v=_==="ananonymousgifter",E={userId:d.get("msg-param-recipient-id"),displayName:d.get("msg-param-recipient-display-name"),gifter:v?void 0:_,gifterUserId:v?void 0:d.get("user-id"),gifterDisplayName:v?void 0:d.get("display-name"),gifterGiftCount:v?void 0:Number(d.get("msg-param-sender-count")),giftDuration:Number(d.get("msg-param-gift-months")),plan:g,planName:d.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(d.get("msg-param-months"))};this.emit(this.onSubGift,p,d.get("msg-param-recipient-user-name"),E,l);break}case"submysterygift":{const g=d.get("login"),_=g==="ananonymousgifter",v={gifter:_?void 0:g,gifterUserId:_?void 0:d.get("user-id"),gifterDisplayName:_?void 0:d.get("display-name"),gifterGiftCount:_?void 0:Number(d.get("msg-param-sender-count")),count:Number(d.get("msg-param-mass-gift-count")),plan:d.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,d.get("login"),v,l);break}case"primepaidupgrade":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,d.get("login"),g,l);break}case"giftpaidupgrade":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),gifter:d.get("msg-param-sender-login"),gifterDisplayName:d.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,d.get("login"),g,l);break}case"standardpayforward":{const g=d.get("msg-param-prior-gifter-anonymous")==="true",_={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:g?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:d.get("msg-param-prior-gifter-display-name"),recipientUserId:d.get("msg-param-recipient-id"),recipientDisplayName:d.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,d.get("login"),_,l);break}case"communitypayforward":{const g=d.get("msg-param-prior-gifter-anonymous")==="true",_={userId:d.get("user-id"),displayName:d.get("display-name"),originalGifterUserId:g?void 0:d.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:d.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,d.get("login"),_,l);break}case"primecommunitygiftreceived":{const g={name:d.get("msg-param-gift-name"),gifter:d.get("login"),gifterDisplayName:d.get("display-name")};this.emit(this.onPrimeCommunityGift,p,d.get("msg-param-recipient"),g,l);break}case"raid":{const g={displayName:d.get("msg-param-displayName"),viewerCount:Number(d.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,d.get("login"),g,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const g={ritualName:d.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,p,d.get("login"),g,l);break}case"bitsbadgetier":{const g={displayName:d.get("display-name"),threshold:Number(d.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,d.get("login"),g,l);break}case"extendsub":{const g={userId:d.get("user-id"),displayName:d.get("display-name"),plan:d.get("msg-param-sub-plan"),months:Number(d.get("msg-param-cumulative-months")),endMonth:Number(d.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,d.get("login"),g,l);break}case"rewardgift":{const g={domain:d.get("msg-param-domain"),gifterId:d.get("user-id"),gifterDisplayName:d.get("display-name"),count:Number(d.get("msg-param-selected-count")),gifterGiftCount:Number(d.get("msg-param-total-reward-count")),triggerType:d.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,d.get("login"),g,l);break}case"announcement":{const g={color:d.get("msg-param-color")};this.emit(this.onAnnouncement,p,d.get("login"),g,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${f}`)}}),this._ircClient.onTypedMessage(cX,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(iz,async({target:l,text:u,tags:h})=>{const d=h.get("msg-id");switch(d){case"emote_only_on":{this.emit(this.onEmoteOnly,xc(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,xc(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,d);break}case"r9k_on":{this.emit(this.onUniqueChat,xc(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,xc(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,xc(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,xc(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,xc(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,xc(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,xc(l),d);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=b_e(120),this._authRetryCount=0);const f=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),f!==0&&this._chatLogger.info(`Retrying authentication in ${f} seconds`),await cvt(f*1e3),this._ircClient.reconnect()}break}default:d.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${d}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(tq._generateJustinfanNick()),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,n,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=Byt(r.replyTo));const a=mie(n,500);await Promise.all(a.map(async o=>await this._messageRateLimiter.request({type:"say",channel:DD(e),text:o,tags:s},i)))}async action(e,n,r){const i=mie(n,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:DD(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(DD(e))}part(e){this._ircClient.part(DD(e))}quit(){this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,n;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!FP(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const a of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(a,r),!this._authToken)continue;s=!0;const o=await GO(this._authToken.accessToken);if(!o.userName)throw new zP("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(o.userName),`oauth:${this._authToken.accessToken}`}catch(o){o instanceof kw?i=o:this._chatLogger.error(`Retrieving an access token failed: ${o.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((n=(e=this._authProvider).refreshAccessTokenForIntent)===null||n===void 0?void 0:n.call(e,a)),this._authToken){const o=await GO(this._authToken.accessToken);if(!o.userName)throw new zP("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(o.userName),`oauth:${this._authToken.accessToken}`}}catch(o){o instanceof kw?i=o:this._chatLogger.error(`Refreshing the access token failed: ${o.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof Lb?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}};aa([aE(!1)],WU.prototype,"_authProvider",void 0);WU=tq=aa([kI("chat","ChatClient")],WU);var hEe={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(self,()=>(()=>{var n={9669:(a,o,c)=>{a.exports=c(1609)},5448:(a,o,c)=>{var l=c(4867),u=c(6026),h=c(4372),d=c(5327),f=c(4097),p=c(4109),g=c(7985),_=c(7874),v=c(2648),E=c(644),T=c(205);a.exports=function(x){return new Promise(function(N,A){var I,k=x.data,L=x.headers,U=x.responseType;function $(){x.cancelToken&&x.cancelToken.unsubscribe(I),x.signal&&x.signal.removeEventListener("abort",I)}l.isFormData(k)&&l.isStandardBrowserEnv()&&delete L["Content-Type"];var q=new XMLHttpRequest;if(x.auth){var G=x.auth.username||"",X=x.auth.password?unescape(encodeURIComponent(x.auth.password)):"";L.Authorization="Basic "+btoa(G+":"+X)}var re=f(x.baseURL,x.url);function V(){if(q){var ee="getAllResponseHeaders"in q?p(q.getAllResponseHeaders()):null,oe={data:U&&U!=="text"&&U!=="json"?q.response:q.responseText,status:q.status,statusText:q.statusText,headers:ee,config:x,request:q};u(function(de){N(de),$()},function(de){A(de),$()},oe),q=null}}if(q.open(x.method.toUpperCase(),d(re,x.params,x.paramsSerializer),!0),q.timeout=x.timeout,"onloadend"in q?q.onloadend=V:q.onreadystatechange=function(){q&&q.readyState===4&&(q.status!==0||q.responseURL&&q.responseURL.indexOf("file:")===0)&&setTimeout(V)},q.onabort=function(){q&&(A(new v("Request aborted",v.ECONNABORTED,x,q)),q=null)},q.onerror=function(){A(new v("Network Error",v.ERR_NETWORK,x,q,q)),q=null},q.ontimeout=function(){var ee=x.timeout?"timeout of "+x.timeout+"ms exceeded":"timeout exceeded",oe=x.transitional||_;x.timeoutErrorMessage&&(ee=x.timeoutErrorMessage),A(new v(ee,oe.clarifyTimeoutError?v.ETIMEDOUT:v.ECONNABORTED,x,q)),q=null},l.isStandardBrowserEnv()){var Z=(x.withCredentials||g(re))&&x.xsrfCookieName?h.read(x.xsrfCookieName):void 0;Z&&(L[x.xsrfHeaderName]=Z)}"setRequestHeader"in q&&l.forEach(L,function(ee,oe){k===void 0&&oe.toLowerCase()==="content-type"?delete L[oe]:q.setRequestHeader(oe,ee)}),l.isUndefined(x.withCredentials)||(q.withCredentials=!!x.withCredentials),U&&U!=="json"&&(q.responseType=x.responseType),typeof x.onDownloadProgress=="function"&&q.addEventListener("progress",x.onDownloadProgress),typeof x.onUploadProgress=="function"&&q.upload&&q.upload.addEventListener("progress",x.onUploadProgress),(x.cancelToken||x.signal)&&(I=function(ee){q&&(A(!ee||ee&&ee.type?new E:ee),q.abort(),q=null)},x.cancelToken&&x.cancelToken.subscribe(I),x.signal&&(x.signal.aborted?I():x.signal.addEventListener("abort",I))),k||(k=null);var Y=T(re);Y&&["http","https","file"].indexOf(Y)===-1?A(new v("Unsupported protocol "+Y+":",v.ERR_BAD_REQUEST,x)):q.send(k)})}},1609:(a,o,c)=>{var l=c(4867),u=c(1849),h=c(321),d=c(7185),f=function p(g){var _=new h(g),v=u(h.prototype.request,_);return l.extend(v,h.prototype,_),l.extend(v,_),v.create=function(E){return p(d(g,E))},v}(c(5546));f.Axios=h,f.CanceledError=c(644),f.CancelToken=c(4972),f.isCancel=c(6502),f.VERSION=c(7288).version,f.toFormData=c(7675),f.AxiosError=c(2648),f.Cancel=f.CanceledError,f.all=function(p){return Promise.all(p)},f.spread=c(8713),f.isAxiosError=c(6268),a.exports=f,a.exports.default=f},4972:(a,o,c)=>{var l=c(644);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(p){d=p});var f=this;this.promise.then(function(p){if(f._listeners){var g,_=f._listeners.length;for(g=0;g<_;g++)f._listeners[g](p);f._listeners=null}}),this.promise.then=function(p){var g,_=new Promise(function(v){f.subscribe(v),g=v}).then(p);return _.cancel=function(){f.unsubscribe(g)},_},h(function(p){f.reason||(f.reason=new l(p),d(f.reason))})}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var d=this._listeners.indexOf(h);d!==-1&&this._listeners.splice(d,1)}},u.source=function(){var h;return{token:new u(function(d){h=d}),cancel:h}},a.exports=u},644:(a,o,c)=>{var l=c(2648);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(4867).inherits(u,l,{__CANCEL__:!0}),a.exports=u},6502:a=>{a.exports=function(o){return!(!o||!o.__CANCEL__)}},321:(a,o,c)=>{var l=c(4867),u=c(5327),h=c(782),d=c(3572),f=c(7185),p=c(4097),g=c(4875),_=g.validators;function v(E){this.defaults=E,this.interceptors={request:new h,response:new h}}v.prototype.request=function(E,T){typeof E=="string"?(T=T||{}).url=E:T=E||{},(T=f(this.defaults,T)).method?T.method=T.method.toLowerCase():this.defaults.method?T.method=this.defaults.method.toLowerCase():T.method="get";var x=T.transitional;x!==void 0&&g.assertOptions(x,{silentJSONParsing:_.transitional(_.boolean),forcedJSONParsing:_.transitional(_.boolean),clarifyTimeoutError:_.transitional(_.boolean)},!1);var N=[],A=!0;this.interceptors.request.forEach(function(G){typeof G.runWhen=="function"&&G.runWhen(T)===!1||(A=A&&G.synchronous,N.unshift(G.fulfilled,G.rejected))});var I,k=[];if(this.interceptors.response.forEach(function(G){k.push(G.fulfilled,G.rejected)}),!A){var L=[d,void 0];for(Array.prototype.unshift.apply(L,N),L=L.concat(k),I=Promise.resolve(T);L.length;)I=I.then(L.shift(),L.shift());return I}for(var U=T;N.length;){var $=N.shift(),q=N.shift();try{U=$(U)}catch(G){q(G);break}}try{I=d(U)}catch(G){return Promise.reject(G)}for(;k.length;)I=I.then(k.shift(),k.shift());return I},v.prototype.getUri=function(E){E=f(this.defaults,E);var T=p(E.baseURL,E.url);return u(T,E.params,E.paramsSerializer)},l.forEach(["delete","get","head","options"],function(E){v.prototype[E]=function(T,x){return this.request(f(x||{},{method:E,url:T,data:(x||{}).data}))}}),l.forEach(["post","put","patch"],function(E){function T(x){return function(N,A,I){return this.request(f(I||{},{method:E,headers:x?{"Content-Type":"multipart/form-data"}:{},url:N,data:A}))}}v.prototype[E]=T(),v.prototype[E+"Form"]=T(!0)}),a.exports=v},2648:(a,o,c)=>{var l=c(4867);function u(f,p,g,_,v){Error.call(this),this.message=f,this.name="AxiosError",p&&(this.code=p),g&&(this.config=g),_&&(this.request=_),v&&(this.response=v)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,d={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(f){d[f]={value:f}}),Object.defineProperties(u,d),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(f,p,g,_,v,E){var T=Object.create(h);return l.toFlatObject(f,T,function(x){return x!==Error.prototype}),u.call(T,f.message,p,g,_,v),T.name=f.name,E&&Object.assign(T,E),T},a.exports=u},782:(a,o,c)=>{var l=c(4867);function u(){this.handlers=[]}u.prototype.use=function(h,d,f){return this.handlers.push({fulfilled:h,rejected:d,synchronous:!!f&&f.synchronous,runWhen:f?f.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,function(d){d!==null&&h(d)})},a.exports=u},4097:(a,o,c)=>{var l=c(1793),u=c(7303);a.exports=function(h,d){return h&&!l(d)?u(h,d):d}},3572:(a,o,c)=>{var l=c(4867),u=c(8527),h=c(6502),d=c(5546),f=c(644);function p(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new f}a.exports=function(g){return p(g),g.headers=g.headers||{},g.data=u.call(g,g.data,g.headers,g.transformRequest),g.headers=l.merge(g.headers.common||{},g.headers[g.method]||{},g.headers),l.forEach(["delete","get","head","post","put","patch","common"],function(_){delete g.headers[_]}),(g.adapter||d.adapter)(g).then(function(_){return p(g),_.data=u.call(g,_.data,_.headers,g.transformResponse),_},function(_){return h(_)||(p(g),_&&_.response&&(_.response.data=u.call(g,_.response.data,_.response.headers,g.transformResponse))),Promise.reject(_)})}},7185:(a,o,c)=>{var l=c(4867);a.exports=function(u,h){h=h||{};var d={};function f(T,x){return l.isPlainObject(T)&&l.isPlainObject(x)?l.merge(T,x):l.isPlainObject(x)?l.merge({},x):l.isArray(x)?x.slice():x}function p(T){return l.isUndefined(h[T])?l.isUndefined(u[T])?void 0:f(void 0,u[T]):f(u[T],h[T])}function g(T){if(!l.isUndefined(h[T]))return f(void 0,h[T])}function _(T){return l.isUndefined(h[T])?l.isUndefined(u[T])?void 0:f(void 0,u[T]):f(void 0,h[T])}function v(T){return T in h?f(u[T],h[T]):T in u?f(void 0,u[T]):void 0}var E={url:g,method:g,data:g,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:v};return l.forEach(Object.keys(u).concat(Object.keys(h)),function(T){var x=E[T]||p,N=x(T);l.isUndefined(N)&&x!==v||(d[T]=N)}),d}},6026:(a,o,c)=>{var l=c(2648);a.exports=function(u,h,d){var f=d.config.validateStatus;d.status&&f&&!f(d.status)?h(new l("Request failed with status code "+d.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d)):u(d)}},8527:(a,o,c)=>{var l=c(4867),u=c(5546);a.exports=function(h,d,f){var p=this||u;return l.forEach(f,function(g){h=g.call(p,h,d)}),h}},5546:(a,o,c)=>{var l=c(4867),u=c(6016),h=c(2648),d=c(7874),f=c(7675),p={"Content-Type":"application/x-www-form-urlencoded"};function g(E,T){!l.isUndefined(E)&&l.isUndefined(E["Content-Type"])&&(E["Content-Type"]=T)}var _,v={transitional:d,adapter:((typeof XMLHttpRequest<"u"||typeof zn<"u"&&Object.prototype.toString.call(zn)==="[object process]")&&(_=c(5448)),_),transformRequest:[function(E,T){if(u(T,"Accept"),u(T,"Content-Type"),l.isFormData(E)||l.isArrayBuffer(E)||l.isBuffer(E)||l.isStream(E)||l.isFile(E)||l.isBlob(E))return E;if(l.isArrayBufferView(E))return E.buffer;if(l.isURLSearchParams(E))return g(T,"application/x-www-form-urlencoded;charset=utf-8"),E.toString();var x,N=l.isObject(E),A=T&&T["Content-Type"];if((x=l.isFileList(E))||N&&A==="multipart/form-data"){var I=this.env&&this.env.FormData;return f(x?{"files[]":E}:E,I&&new I)}return N||A==="application/json"?(g(T,"application/json"),function(k,L,U){if(l.isString(k))try{return(L||JSON.parse)(k),l.trim(k)}catch($){if($.name!=="SyntaxError")throw $}return(0,JSON.stringify)(k)}(E)):E}],transformResponse:[function(E){var T=this.transitional||v.transitional,x=T&&T.silentJSONParsing,N=T&&T.forcedJSONParsing,A=!x&&this.responseType==="json";if(A||N&&l.isString(E)&&E.length)try{return JSON.parse(E)}catch(I){if(A)throw I.name==="SyntaxError"?h.from(I,h.ERR_BAD_RESPONSE,this,null,this.response):I}return E}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1623)},validateStatus:function(E){return E>=200&&E<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],function(E){v.headers[E]={}}),l.forEach(["post","put","patch"],function(E){v.headers[E]=l.merge(p)}),a.exports=v},7874:a=>{a.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:a=>{a.exports={version:"0.27.2"}},1849:a=>{a.exports=function(o,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return o.apply(c,l)}}},5327:(a,o,c)=>{var l=c(4867);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}a.exports=function(h,d,f){if(!d)return h;var p;if(f)p=f(d);else if(l.isURLSearchParams(d))p=d.toString();else{var g=[];l.forEach(d,function(v,E){v!=null&&(l.isArray(v)?E+="[]":v=[v],l.forEach(v,function(T){l.isDate(T)?T=T.toISOString():l.isObject(T)&&(T=JSON.stringify(T)),g.push(u(E)+"="+u(T))}))}),p=g.join("&")}if(p){var _=h.indexOf("#");_!==-1&&(h=h.slice(0,_)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}},7303:a=>{a.exports=function(o,c){return c?o.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):o}},4372:(a,o,c)=>{var l=c(4867);a.exports=l.isStandardBrowserEnv()?{write:function(u,h,d,f,p,g){var _=[];_.push(u+"="+encodeURIComponent(h)),l.isNumber(d)&&_.push("expires="+new Date(d).toGMTString()),l.isString(f)&&_.push("path="+f),l.isString(p)&&_.push("domain="+p),g===!0&&_.push("secure"),document.cookie=_.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:a=>{a.exports=function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}},6268:(a,o,c)=>{var l=c(4867);a.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},7985:(a,o,c)=>{var l=c(4867);a.exports=l.isStandardBrowserEnv()?function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");function f(p){var g=p;return h&&(d.setAttribute("href",g),g=d.href),d.setAttribute("href",g),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return u=f(window.location.href),function(p){var g=l.isString(p)?f(p):p;return g.protocol===u.protocol&&g.host===u.host}}():function(){return!0}},6016:(a,o,c)=>{var l=c(4867);a.exports=function(u,h){l.forEach(u,function(d,f){f!==h&&f.toUpperCase()===h.toUpperCase()&&(u[h]=d,delete u[f])})}},1623:a=>{a.exports=null},4109:(a,o,c)=>{var l=c(4867),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];a.exports=function(h){var d,f,p,g={};return h&&l.forEach(h.split(`
`),function(_){if(p=_.indexOf(":"),d=l.trim(_.substr(0,p)).toLowerCase(),f=l.trim(_.substr(p+1)),d){if(g[d]&&u.indexOf(d)>=0)return;g[d]=d==="set-cookie"?(g[d]?g[d]:[]).concat([f]):g[d]?g[d]+", "+f:f}}),g}},205:a=>{a.exports=function(o){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return c&&c[1]||""}},8713:a=>{a.exports=function(o){return function(c){return o.apply(null,c)}}},7675:(a,o,c)=>{var l=c(4867);a.exports=function(u,h){h=h||new FormData;var d=[];function f(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):kl.from(p):p}return function p(g,_){if(l.isPlainObject(g)||l.isArray(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+_);d.push(g),l.forEach(g,function(v,E){if(!l.isUndefined(v)){var T,x=_?_+"."+E:E;if(v&&!_&&typeof v=="object"){if(l.endsWith(E,"{}"))v=JSON.stringify(v);else if(l.endsWith(E,"[]")&&(T=l.toArray(v)))return void T.forEach(function(N){!l.isUndefined(N)&&h.append(x,f(N))})}p(v,x)}}),d.pop()}else h.append(_,f(g))}(u),h}},4875:(a,o,c)=>{var l=c(7288).version,u=c(2648),h={};["object","boolean","number","function","string","symbol"].forEach(function(f,p){h[f]=function(g){return typeof g===f||"a"+(p<1?"n ":" ")+f}});var d={};h.transitional=function(f,p,g){function _(v,E){return"[Axios v"+l+"] Transitional option '"+v+"'"+E+(g?". "+g:"")}return function(v,E,T){if(f===!1)throw new u(_(E," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!d[E]&&(d[E]=!0,console.warn(_(E," has been deprecated since v"+p+" and will be removed in the near future"))),!f||f(v,E,T)}},a.exports={assertOptions:function(f,p,g){if(typeof f!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var _=Object.keys(f),v=_.length;v-- >0;){var E=_[v],T=p[E];if(T){var x=f[E],N=x===void 0||T(x,E,f);if(N!==!0)throw new u("option "+E+" must be "+N,u.ERR_BAD_OPTION_VALUE)}else if(g!==!0)throw new u("Unknown option "+E,u.ERR_BAD_OPTION)}},validators:h}},4867:(a,o,c)=>{var l,u=c(1849),h=Object.prototype.toString,d=(l=Object.create(null),function(q){var G=h.call(q);return l[G]||(l[G]=G.slice(8,-1).toLowerCase())});function f(q){return q=q.toLowerCase(),function(G){return d(G)===q}}function p(q){return Array.isArray(q)}function g(q){return q===void 0}var _=f("ArrayBuffer");function v(q){return q!==null&&typeof q=="object"}function E(q){if(d(q)!=="object")return!1;var G=Object.getPrototypeOf(q);return G===null||G===Object.prototype}var T=f("Date"),x=f("File"),N=f("Blob"),A=f("FileList");function I(q){return h.call(q)==="[object Function]"}var k=f("URLSearchParams");function L(q,G){if(q!=null)if(typeof q!="object"&&(q=[q]),p(q))for(var X=0,re=q.length;X<re;X++)G.call(null,q[X],X,q);else for(var V in q)Object.prototype.hasOwnProperty.call(q,V)&&G.call(null,q[V],V,q)}var U,$=(U=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(q){return U&&q instanceof U});a.exports={isArray:p,isArrayBuffer:_,isBuffer:function(q){return q!==null&&!g(q)&&q.constructor!==null&&!g(q.constructor)&&typeof q.constructor.isBuffer=="function"&&q.constructor.isBuffer(q)},isFormData:function(q){var G="[object FormData]";return q&&(typeof FormData=="function"&&q instanceof FormData||h.call(q)===G||I(q.toString)&&q.toString()===G)},isArrayBufferView:function(q){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(q):q&&q.buffer&&_(q.buffer)},isString:function(q){return typeof q=="string"},isNumber:function(q){return typeof q=="number"},isObject:v,isPlainObject:E,isUndefined:g,isDate:T,isFile:x,isBlob:N,isFunction:I,isStream:function(q){return v(q)&&I(q.pipe)},isURLSearchParams:k,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:L,merge:function q(){var G={};function X(Z,Y){E(G[Y])&&E(Z)?G[Y]=q(G[Y],Z):E(Z)?G[Y]=q({},Z):p(Z)?G[Y]=Z.slice():G[Y]=Z}for(var re=0,V=arguments.length;re<V;re++)L(arguments[re],X);return G},extend:function(q,G,X){return L(G,function(re,V){q[V]=X&&typeof re=="function"?u(re,X):re}),q},trim:function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")},stripBOM:function(q){return q.charCodeAt(0)===65279&&(q=q.slice(1)),q},inherits:function(q,G,X,re){q.prototype=Object.create(G.prototype,re),q.prototype.constructor=q,X&&Object.assign(q.prototype,X)},toFlatObject:function(q,G,X){var re,V,Z,Y={};G=G||{};do{for(V=(re=Object.getOwnPropertyNames(q)).length;V-- >0;)Y[Z=re[V]]||(G[Z]=q[Z],Y[Z]=!0);q=Object.getPrototypeOf(q)}while(q&&(!X||X(q,G))&&q!==Object.prototype);return G},kindOf:d,kindOfTest:f,endsWith:function(q,G,X){q=String(q),(X===void 0||X>q.length)&&(X=q.length),X-=G.length;var re=q.indexOf(G,X);return re!==-1&&re===X},toArray:function(q){if(!q)return null;var G=q.length;if(g(G))return null;for(var X=new Array(G);G-- >0;)X[G]=q[G];return X},isTypedArray:$,isFileList:A}},1206:function(a){a.exports=function(o){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return o[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=o,l.c=c,l.d=function(u,h,d){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:d})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var d=Object.create(null);if(l.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var f in u)l.d(d,f,(function(p){return u[p]}).bind(null,f));return d},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)}({17:function(o,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=function(){function d(){}return d.getFirstMatch=function(f,p){var g=p.match(f);return g&&g.length>0&&g[1]||""},d.getSecondMatch=function(f,p){var g=p.match(f);return g&&g.length>1&&g[2]||""},d.matchAndReturnConst=function(f,p,g){if(f.test(p))return g},d.getWindowsVersionName=function(f){switch(f){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},d.getMacOSVersionName=function(f){var p=f.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},d.getAndroidVersionName=function(f){var p=f.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},d.getVersionPrecision=function(f){return f.split(".").length},d.compareVersions=function(f,p,g){g===void 0&&(g=!1);var _=d.getVersionPrecision(f),v=d.getVersionPrecision(p),E=Math.max(_,v),T=0,x=d.map([f,p],function(N){var A=E-d.getVersionPrecision(N),I=N+new Array(A+1).join(".0");return d.map(I.split("."),function(k){return new Array(20-k.length).join("0")+k}).reverse()});for(g&&(T=E-Math.min(_,v)),E-=1;E>=T;){if(x[0][E]>x[1][E])return 1;if(x[0][E]===x[1][E]){if(E===T)return 0;E-=1}else if(x[0][E]<x[1][E])return-1}},d.map=function(f,p){var g,_=[];if(Array.prototype.map)return Array.prototype.map.call(f,p);for(g=0;g<f.length;g+=1)_.push(p(f[g]));return _},d.find=function(f,p){var g,_;if(Array.prototype.find)return Array.prototype.find.call(f,p);for(g=0,_=f.length;g<_;g+=1){var v=f[g];if(p(v,g))return v}},d.assign=function(f){for(var p,g,_=f,v=arguments.length,E=new Array(v>1?v-1:0),T=1;T<v;T++)E[T-1]=arguments[T];if(Object.assign)return Object.assign.apply(Object,[f].concat(E));var x=function(){var N=E[p];typeof N=="object"&&N!==null&&Object.keys(N).forEach(function(A){_[A]=N[A]})};for(p=0,g=E.length;p<g;p+=1)x();return f},d.getBrowserAlias=function(f){return u.BROWSER_ALIASES_MAP[f]},d.getBrowserTypeByAlias=function(f){return u.BROWSER_MAP[f]||""},d}();c.default=h,o.exports=c.default},18:function(o,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(o,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},d=l(18);function f(g,_){for(var v=0;v<_.length;v++){var E=_[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}var p=function(){function g(){}var _,v,E;return g.getParser=function(T,x){if(x===void 0&&(x=!1),typeof T!="string")throw new Error("UserAgent should be a string");return new h.default(T,x)},g.parse=function(T){return new h.default(T).getResult()},_=g,E=[{key:"BROWSER_MAP",get:function(){return d.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return d.ENGINE_MAP}},{key:"OS_MAP",get:function(){return d.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return d.PLATFORMS_MAP}}],(v=null)&&f(_.prototype,v),E&&f(_,E),g}();c.default=p,o.exports=c.default},91:function(o,c,l){c.__esModule=!0,c.default=void 0;var u=g(l(92)),h=g(l(93)),d=g(l(94)),f=g(l(95)),p=g(l(17));function g(v){return v&&v.__esModule?v:{default:v}}var _=function(){function v(T,x){if(x===void 0&&(x=!1),T==null||T==="")throw new Error("UserAgent parameter can't be empty");this._ua=T,this.parsedResult={},x!==!0&&this.parse()}var E=v.prototype;return E.getUA=function(){return this._ua},E.test=function(T){return T.test(this._ua)},E.parseBrowser=function(){var T=this;this.parsedResult.browser={};var x=p.default.find(u.default,function(N){if(typeof N.test=="function")return N.test(T);if(N.test instanceof Array)return N.test.some(function(A){return T.test(A)});throw new Error("Browser's test function is not valid")});return x&&(this.parsedResult.browser=x.describe(this.getUA())),this.parsedResult.browser},E.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},E.getBrowserName=function(T){return T?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},E.getBrowserVersion=function(){return this.getBrowser().version},E.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},E.parseOS=function(){var T=this;this.parsedResult.os={};var x=p.default.find(h.default,function(N){if(typeof N.test=="function")return N.test(T);if(N.test instanceof Array)return N.test.some(function(A){return T.test(A)});throw new Error("Browser's test function is not valid")});return x&&(this.parsedResult.os=x.describe(this.getUA())),this.parsedResult.os},E.getOSName=function(T){var x=this.getOS().name;return T?String(x).toLowerCase()||"":x||""},E.getOSVersion=function(){return this.getOS().version},E.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},E.getPlatformType=function(T){T===void 0&&(T=!1);var x=this.getPlatform().type;return T?String(x).toLowerCase()||"":x||""},E.parsePlatform=function(){var T=this;this.parsedResult.platform={};var x=p.default.find(d.default,function(N){if(typeof N.test=="function")return N.test(T);if(N.test instanceof Array)return N.test.some(function(A){return T.test(A)});throw new Error("Browser's test function is not valid")});return x&&(this.parsedResult.platform=x.describe(this.getUA())),this.parsedResult.platform},E.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},E.getEngineName=function(T){return T?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},E.parseEngine=function(){var T=this;this.parsedResult.engine={};var x=p.default.find(f.default,function(N){if(typeof N.test=="function")return N.test(T);if(N.test instanceof Array)return N.test.some(function(A){return T.test(A)});throw new Error("Browser's test function is not valid")});return x&&(this.parsedResult.engine=x.describe(this.getUA())),this.parsedResult.engine},E.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},E.getResult=function(){return p.default.assign({},this.parsedResult)},E.satisfies=function(T){var x=this,N={},A=0,I={},k=0;if(Object.keys(T).forEach(function(V){var Z=T[V];typeof Z=="string"?(I[V]=Z,k+=1):typeof Z=="object"&&(N[V]=Z,A+=1)}),A>0){var L=Object.keys(N),U=p.default.find(L,function(V){return x.isOS(V)});if(U){var $=this.satisfies(N[U]);if($!==void 0)return $}var q=p.default.find(L,function(V){return x.isPlatform(V)});if(q){var G=this.satisfies(N[q]);if(G!==void 0)return G}}if(k>0){var X=Object.keys(I),re=p.default.find(X,function(V){return x.isBrowser(V,!0)});if(re!==void 0)return this.compareVersion(I[re])}},E.isBrowser=function(T,x){x===void 0&&(x=!1);var N=this.getBrowserName().toLowerCase(),A=T.toLowerCase(),I=p.default.getBrowserTypeByAlias(A);return x&&I&&(A=I.toLowerCase()),A===N},E.compareVersion=function(T){var x=[0],N=T,A=!1,I=this.getBrowserVersion();if(typeof I=="string")return T[0]===">"||T[0]==="<"?(N=T.substr(1),T[1]==="="?(A=!0,N=T.substr(2)):x=[],T[0]===">"?x.push(1):x.push(-1)):T[0]==="="?N=T.substr(1):T[0]==="~"&&(A=!0,N=T.substr(1)),x.indexOf(p.default.compareVersions(I,N,A))>-1},E.isOS=function(T){return this.getOSName(!0)===String(T).toLowerCase()},E.isPlatform=function(T){return this.getPlatformType(!0)===String(T).toLowerCase()},E.isEngine=function(T){return this.getEngineName(!0)===String(T).toLowerCase()},E.is=function(T,x){return x===void 0&&(x=!1),this.isBrowser(T,x)||this.isOS(T)||this.isPlatform(T)},E.some=function(T){var x=this;return T===void 0&&(T=[]),T.some(function(N){return x.is(N)})},v}();c.default=_,o.exports=c.default},92:function(o,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=/version\/(\d+(\.?_?\d+)+)/i,f=[{test:[/googlebot/i],describe:function(p){var g={name:"Googlebot"},_=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/opera/i],describe:function(p){var g={name:"Opera"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/opr\/|opios/i],describe:function(p){var g={name:"Opera"},_=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/SamsungBrowser/i],describe:function(p){var g={name:"Samsung Internet for Android"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/Whale/i],describe:function(p){var g={name:"NAVER Whale Browser"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/MZBrowser/i],describe:function(p){var g={name:"MZ Browser"},_=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/focus/i],describe:function(p){var g={name:"Focus"},_=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/swing/i],describe:function(p){var g={name:"Swing"},_=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/coast/i],describe:function(p){var g={name:"Opera Coast"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var g={name:"Opera Touch"},_=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/yabrowser/i],describe:function(p){var g={name:"Yandex Browser"},_=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/ucbrowser/i],describe:function(p){var g={name:"UC Browser"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/Maxthon|mxios/i],describe:function(p){var g={name:"Maxthon"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/epiphany/i],describe:function(p){var g={name:"Epiphany"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/puffin/i],describe:function(p){var g={name:"Puffin"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/sleipnir/i],describe:function(p){var g={name:"Sleipnir"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/k-meleon/i],describe:function(p){var g={name:"K-Meleon"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/micromessenger/i],describe:function(p){var g={name:"WeChat"},_=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/qqbrowser/i],describe:function(p){var g={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},_=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/msie|trident/i],describe:function(p){var g={name:"Internet Explorer"},_=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/\sedg\//i],describe:function(p){var g={name:"Microsoft Edge"},_=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/edg([ea]|ios)/i],describe:function(p){var g={name:"Microsoft Edge"},_=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/vivaldi/i],describe:function(p){var g={name:"Vivaldi"},_=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/seamonkey/i],describe:function(p){var g={name:"SeaMonkey"},_=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/sailfish/i],describe:function(p){var g={name:"Sailfish"},_=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return _&&(g.version=_),g}},{test:[/silk/i],describe:function(p){var g={name:"Amazon Silk"},_=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/phantom/i],describe:function(p){var g={name:"PhantomJS"},_=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/slimerjs/i],describe:function(p){var g={name:"SlimerJS"},_=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g={name:"BlackBerry"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g={name:"WebOS Browser"},_=h.default.getFirstMatch(d,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/bada/i],describe:function(p){var g={name:"Bada"},_=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/tizen/i],describe:function(p){var g={name:"Tizen"},_=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/qupzilla/i],describe:function(p){var g={name:"QupZilla"},_=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var g={name:"Firefox"},_=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/electron/i],describe:function(p){var g={name:"Electron"},_=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/MiuiBrowser/i],describe:function(p){var g={name:"Miui"},_=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/chromium/i],describe:function(p){var g={name:"Chromium"},_=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/chrome|crios|crmo/i],describe:function(p){var g={name:"Chrome"},_=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/GSA/i],describe:function(p){var g={name:"Google Search"},_=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:function(p){var g=!p.test(/like android/i),_=p.test(/android/i);return g&&_},describe:function(p){var g={name:"Android Browser"},_=h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/playstation 4/i],describe:function(p){var g={name:"PlayStation 4"},_=h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/safari|applewebkit/i],describe:function(p){var g={name:"Safari"},_=h.default.getFirstMatch(d,p);return _&&(g.version=_),g}},{test:[/.*/i],describe:function(p){var g=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(g,p),version:h.default.getSecondMatch(g,p)}}}];c.default=f,o.exports=c.default},93:function(o,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),f=[{test:[/Roku\/DVP/],describe:function(p){var g=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:d.OS_MAP.Roku,version:g}}},{test:[/windows phone/i],describe:function(p){var g=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.WindowsPhone,version:g}}},{test:[/windows /i],describe:function(p){var g=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),_=h.default.getWindowsVersionName(g);return{name:d.OS_MAP.Windows,version:g,versionName:_}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var g={name:d.OS_MAP.iOS},_=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return _&&(g.version=_),g}},{test:[/macintosh/i],describe:function(p){var g=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),_=h.default.getMacOSVersionName(g),v={name:d.OS_MAP.MacOS,version:g};return _&&(v.versionName=_),v}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var g=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:d.OS_MAP.iOS,version:g}}},{test:function(p){var g=!p.test(/like android/i),_=p.test(/android/i);return g&&_},describe:function(p){var g=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),_=h.default.getAndroidVersionName(g),v={name:d.OS_MAP.Android,version:g};return _&&(v.versionName=_),v}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),_={name:d.OS_MAP.WebOS};return g&&g.length&&(_.version=g),_}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:d.OS_MAP.BlackBerry,version:g}}},{test:[/bada/i],describe:function(p){var g=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.Bada,version:g}}},{test:[/tizen/i],describe:function(p){var g=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.Tizen,version:g}}},{test:[/linux/i],describe:function(){return{name:d.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:d.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var g=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:d.OS_MAP.PlayStation4,version:g}}}];c.default=f,o.exports=c.default},94:function(o,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),f=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var g=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",_={type:d.PLATFORMS_MAP.mobile,vendor:"Huawei"};return g&&(_.model=g),_}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(p){var g=p.test(/ipod|iphone/i),_=p.test(/like (ipod|iphone)/i);return g&&!_},describe:function(p){var g=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:d.PLATFORMS_MAP.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:d.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var g=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&g>=3},describe:function(){return{type:d.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:d.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:d.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:d.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:d.PLATFORMS_MAP.tv}}}];c.default=f,o.exports=c.default},95:function(o,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},d=l(18),f=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:d.ENGINE_MAP.Blink};var g=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:d.ENGINE_MAP.EdgeHTML,version:g}}},{test:[/trident/i],describe:function(p){var g={name:d.ENGINE_MAP.Trident},_=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:function(p){return p.test(/presto/i)},describe:function(p){var g={name:d.ENGINE_MAP.Presto},_=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:function(p){var g=p.test(/gecko/i),_=p.test(/like gecko/i);return g&&!_},describe:function(p){var g={name:d.ENGINE_MAP.Gecko},_=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:d.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var g={name:d.ENGINE_MAP.WebKit},_=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return _&&(g.version=_),g}}];c.default=f,o.exports=c.default}})},6729:a=>{var o=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,g,_){this.fn=p,this.context=g,this.once=_||!1}function h(p,g,_,v,E){if(typeof _!="function")throw new TypeError("The listener must be a function");var T=new u(_,v||p,E),x=c?c+g:g;return p._events[x]?p._events[x].fn?p._events[x]=[p._events[x],T]:p._events[x].push(T):(p._events[x]=T,p._eventsCount++),p}function d(p,g){--p._eventsCount==0?p._events=new l:delete p._events[g]}function f(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),f.prototype.eventNames=function(){var p,g,_=[];if(this._eventsCount===0)return _;for(g in p=this._events)o.call(p,g)&&_.push(c?g.slice(1):g);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(p)):_},f.prototype.listeners=function(p){var g=c?c+p:p,_=this._events[g];if(!_)return[];if(_.fn)return[_.fn];for(var v=0,E=_.length,T=new Array(E);v<E;v++)T[v]=_[v].fn;return T},f.prototype.listenerCount=function(p){var g=c?c+p:p,_=this._events[g];return _?_.fn?1:_.length:0},f.prototype.emit=function(p,g,_,v,E,T){var x=c?c+p:p;if(!this._events[x])return!1;var N,A,I=this._events[x],k=arguments.length;if(I.fn){switch(I.once&&this.removeListener(p,I.fn,void 0,!0),k){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,g),!0;case 3:return I.fn.call(I.context,g,_),!0;case 4:return I.fn.call(I.context,g,_,v),!0;case 5:return I.fn.call(I.context,g,_,v,E),!0;case 6:return I.fn.call(I.context,g,_,v,E,T),!0}for(A=1,N=new Array(k-1);A<k;A++)N[A-1]=arguments[A];I.fn.apply(I.context,N)}else{var L,U=I.length;for(A=0;A<U;A++)switch(I[A].once&&this.removeListener(p,I[A].fn,void 0,!0),k){case 1:I[A].fn.call(I[A].context);break;case 2:I[A].fn.call(I[A].context,g);break;case 3:I[A].fn.call(I[A].context,g,_);break;case 4:I[A].fn.call(I[A].context,g,_,v);break;default:if(!N)for(L=1,N=new Array(k-1);L<k;L++)N[L-1]=arguments[L];I[A].fn.apply(I[A].context,N)}}return!0},f.prototype.on=function(p,g,_){return h(this,p,g,_,!1)},f.prototype.once=function(p,g,_){return h(this,p,g,_,!0)},f.prototype.removeListener=function(p,g,_,v){var E=c?c+p:p;if(!this._events[E])return this;if(!g)return d(this,E),this;var T=this._events[E];if(T.fn)T.fn!==g||v&&!T.once||_&&T.context!==_||d(this,E);else{for(var x=0,N=[],A=T.length;x<A;x++)(T[x].fn!==g||v&&!T[x].once||_&&T[x].context!==_)&&N.push(T[x]);N.length?this._events[E]=N.length===1?N[0]:N:d(this,E)}return this},f.prototype.removeAllListeners=function(p){var g;return p?(g=c?c+p:p,this._events[g]&&d(this,g)):(this._events=new l,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=c,f.EventEmitter=f,a.exports=f},1564:a=>{var o;o=()=>(()=>{var c={228:u=>{var h=Object.prototype.hasOwnProperty,d="~";function f(){}function p(E,T,x){this.fn=E,this.context=T,this.once=x||!1}function g(E,T,x,N,A){if(typeof x!="function")throw new TypeError("The listener must be a function");var I=new p(x,N||E,A),k=d?d+T:T;return E._events[k]?E._events[k].fn?E._events[k]=[E._events[k],I]:E._events[k].push(I):(E._events[k]=I,E._eventsCount++),E}function _(E,T){--E._eventsCount==0?E._events=new f:delete E._events[T]}function v(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(d=!1)),v.prototype.eventNames=function(){var E,T,x=[];if(this._eventsCount===0)return x;for(T in E=this._events)h.call(E,T)&&x.push(d?T.slice(1):T);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(E)):x},v.prototype.listeners=function(E){var T=d?d+E:E,x=this._events[T];if(!x)return[];if(x.fn)return[x.fn];for(var N=0,A=x.length,I=new Array(A);N<A;N++)I[N]=x[N].fn;return I},v.prototype.listenerCount=function(E){var T=d?d+E:E,x=this._events[T];return x?x.fn?1:x.length:0},v.prototype.emit=function(E,T,x,N,A,I){var k=d?d+E:E;if(!this._events[k])return!1;var L,U,$=this._events[k],q=arguments.length;if($.fn){switch($.once&&this.removeListener(E,$.fn,void 0,!0),q){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,T),!0;case 3:return $.fn.call($.context,T,x),!0;case 4:return $.fn.call($.context,T,x,N),!0;case 5:return $.fn.call($.context,T,x,N,A),!0;case 6:return $.fn.call($.context,T,x,N,A,I),!0}for(U=1,L=new Array(q-1);U<q;U++)L[U-1]=arguments[U];$.fn.apply($.context,L)}else{var G,X=$.length;for(U=0;U<X;U++)switch($[U].once&&this.removeListener(E,$[U].fn,void 0,!0),q){case 1:$[U].fn.call($[U].context);break;case 2:$[U].fn.call($[U].context,T);break;case 3:$[U].fn.call($[U].context,T,x);break;case 4:$[U].fn.call($[U].context,T,x,N);break;default:if(!L)for(G=1,L=new Array(q-1);G<q;G++)L[G-1]=arguments[G];$[U].fn.apply($[U].context,L)}}return!0},v.prototype.on=function(E,T,x){return g(this,E,T,x,!1)},v.prototype.once=function(E,T,x){return g(this,E,T,x,!0)},v.prototype.removeListener=function(E,T,x,N){var A=d?d+E:E;if(!this._events[A])return this;if(!T)return _(this,A),this;var I=this._events[A];if(I.fn)I.fn!==T||N&&!I.once||x&&I.context!==x||_(this,A);else{for(var k=0,L=[],U=I.length;k<U;k++)(I[k].fn!==T||N&&!I[k].once||x&&I[k].context!==x)&&L.push(I[k]);L.length?this._events[A]=L.length===1?L[0]:L:_(this,A)}return this},v.prototype.removeAllListeners=function(E){var T;return E?(T=d?d+E:E,this._events[T]&&_(this,T)):(this._events=new f,this._eventsCount=0),this},v.prototype.off=v.prototype.removeListener,v.prototype.addListener=v.prototype.on,v.prefixed=d,v.EventEmitter=v,u.exports=v},815:function(u,h){var d,f,p=this&&this.__extends||(d=function(Y,ee){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(oe,de){oe.__proto__=de}||function(oe,de){for(var Me in de)Object.prototype.hasOwnProperty.call(de,Me)&&(oe[Me]=de[Me])},d(Y,ee)},function(Y,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Class extends value "+String(ee)+" is not a constructor or null");function oe(){this.constructor=Y}d(Y,ee),Y.prototype=ee===null?Object.create(ee):(oe.prototype=ee.prototype,new oe)});function g(Y){return 60*Y*60}function _(Y){return 60*Y*60*24}Object.defineProperty(h,"__esModule",{value:!0}),h.daysToSeconds=h.hoursToSeconds=h.ConfigurationHolder=h.ConfigurationManager=h.Env=void 0,function(Y){Y.BETA="beta",Y.PROD="prod",Y.CUSTOM="custom"}(f||(h.Env=f={})),h.hoursToSeconds=g,h.daysToSeconds=_;var v=function(Y){function ee(oe){return Y.call(this,oe)||this}return p(ee,Y),ee}(Error),E="data",T="metrics",x=g(1),N=_(3),A=g(2),I="base64",k=function(){function Y(ee,oe){var de,Me,He,Te,Le,we,Ce,ke;if(!oe.fileKey)throw new Error("options.fileKey cannot be empty");var St=(de=oe.clock)!==null&&de!==void 0?de:new re,At=St.getMillis();switch(this.context=ee,this.fileKey=oe.fileKey,this.env=oe.standardEnv,oe.standardEnv){case f.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case f.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case f.CUSTOM:if(!oe.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=oe.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(oe.standardEnv))}this.trace=(Me=oe.trace)!==null&&Me!==void 0?Me:new q(this.env),this.fetch=(He=oe.fetch)!==null&&He!==void 0?He:new $(ee),this.storage=new X("amazon_ivs_device_config_v1_"+oe.fileKey,ee.localStorage),this.state=new Z(this.storage,"state"),this.refresh={refreshIntervalSeconds:(Te=oe.refresh.refreshIntervalSeconds)!==null&&Te!==void 0?Te:x,retryCount:(Le=oe.refresh.retryCount)!==null&&Le!==void 0?Le:3,retryIntervalSeconds:(we=oe.refresh.retryIntervalSeconds)!==null&&we!==void 0?we:10,maxCacheAgeSeconds:(Ce=oe.refresh.maxCacheAgeSeconds)!==null&&Ce!==void 0?Ce:N,stopRefreshAfterSeconds:(ke=oe.refresh.stopRefreshAfterSeconds)!==null&&ke!==void 0?ke:A,canRefreshNow:oe.refresh.canRefreshNow},this.clock=St,this.isInitialRefreshDone=!1;var Ee=0,ye=this.state.getState();ye&&ye.fetchServer===this.fetchServer&&ye.lastFetchWhenMs&&(Ee=ye.lastFetchWhenMs);var et=St.getMillis(),fe=(et-Ee)/1e3;if(fe<=this.refresh.maxCacheAgeSeconds){var Fe=this.storage.getJson(E);Fe&&Fe.fetchServer===this.fetchServer&&this.setData(Fe.json)}if(this.lastUseMs=et,fe>=this.refresh.refreshIntervalSeconds||Ee==0)this.trace.onTrace("Will start refresh right now"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),0);else{var Ie=Math.round(this.refresh.refreshIntervalSeconds-fe);this.trace.onTrace("Will start refresh in "+Ie+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*Ie),this.isInitialRefreshDone=!0}var rt=St.getMillis();this.initialLoadTime=rt-At}return Y.getInstance=function(ee,oe){try{if(!(ee.fetch&&ee.setTimeout&&ee.clearTimeout&&ee.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(de){return void console.error("Error checking for context properties "+de)}if(this.gInstance){if(this.gInstance.fileKey!=oe.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(oe.fileKey));return this.gInstance}return this.gInstance=new Y(ee,oe),this.gInstance},Y.prototype.getConfigurationHolder=function(ee){var oe,de=this,Me=this.clock.getMillis();this.lastUseMs=Me;var He=(oe=ee.analytics)!==null&&oe!==void 0?oe:new G(this.env);this.context.setTimeout(function(){de.emitMetrics(He)});var Te=0,Le=this.state.getState();return Le&&Le.fetchServer===this.fetchServer&&Le.lastFetchWhenMs&&(Te=Le.lastFetchWhenMs),(Me-Te)/1e3<=this.refresh.maxCacheAgeSeconds?new L(He,this.properties):new L(He,void 0)},Y.prototype.getFetchUrl=function(){var ee="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),oe=new URL(ee);return oe.searchParams.set("version","1.0"),oe},Y.clearInstance=function(){var ee;(ee=this.gInstance)===null||ee===void 0||ee.clearInstanceImpl(),this.gInstance=void 0},Y.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},Y.prototype.startRefresh=function(){var ee=this;this.trace.onTrace("Starting refresh request..."),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0);var oe=this.clock.getMillis();return(oe-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds?(this.trace.onTrace("Actually will not refresh due to refresh timeout"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):this.isInitialRefreshDone&&!this.refresh.canRefreshNow()?(this.trace.onTrace("Will not refresh due to callback having returned false"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):void this.fetchData().then(function(de){ee.processResponse(de,oe)}).catch(function(de){ee.exceptionMetrics(de),ee.trace.onTrace("Fetch error: "+de),ee.refresh.retryCount>0&&ee.scheduleRetry(1)}).finally(function(){ee.isInitialRefreshDone=!0,ee.fetchTask=ee.context.setTimeout(ee.startRefresh.bind(ee),1e3*ee.refresh.refreshIntervalSeconds)})},Y.prototype.fetchData=function(){var ee=this.getFetchUrl(),oe=new Headers,de=this.state.getState();return de.fetchServer===this.fetchServer&&(de.lastFetchWhenFullMs&&this.clock.getMillis()-de.lastFetchWhenFullMs>1e3*g(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&de.lastFetchEtagHeader&&oe.set("If-None-Match",de.lastFetchEtagHeader)),this.incrementMetrics("fetch_attempt_count"),this.fetch.fetchUrl(ee,oe)},Y.prototype.processResponse=function(ee,oe){var de={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},Me=ee.headers.get("etag");Me&&(de.lastFetchEtagHeader=Me);try{if(ee.status<300&&ee.json)if(this.setData(ee.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(E,{fetchServer:this.fetchServer,json:ee.json});var He=this.clock.getMillis();de.lastFetchWhenFullMs=He,this.incrementMetricsWithDuration("success_new_data_count",He-oe)}else this.incrementMetrics("fail_invalid_data_count");else{if(ee.status!==304){var Te="Unexpected http fetch status: "+ee.status;throw this.trace.onTrace(Te),new v(Te)}this.trace.onTrace("Server said no change in data"),He=this.clock.getMillis(),this.incrementMetricsWithDuration("success_no_change_count",He-oe)}}finally{this.state.setState(de)}},Y.prototype.scheduleRetry=function(ee){var oe=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var de=ee*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout(function(){oe.retryTask=void 0,oe.fetchRetry(ee)},1e3*de)},Y.prototype.fetchRetry=function(ee){var oe=this;this.trace.onTrace("Starting retry request ".concat(ee,"..."));var de=this.clock.getMillis();this.fetchData().then(function(Me){oe.processResponse(Me,de)}).catch(function(Me){oe.exceptionMetrics(Me),oe.trace.onTrace("Fetch error: "+Me),oe.refresh.retryCount>ee&&oe.scheduleRetry(ee+1)})},Y.prototype.setData=function(ee){if(!ee)return!1;if(ee.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var oe=ee.properties;if(!oe||!Array.isArray(oe))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var de=new Map,Me=0,He=oe;Me<He.length;Me++){var Te=He[Me];if(Te.name&&Te.type&&this.isValidValueType(Te.type)){if(Te.value_string&&typeof Te.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof Te.value_string);continue}if(Te.value_number&&typeof Te.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof Te.value_number);continue}if(Te.value_boolean&&typeof Te.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof Te.value_boolean);continue}if(Te.value_json&&typeof Te.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof Te.value_json);continue}if(Te.value_analytics&&typeof Te.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof Te.value_analytics);continue}var Le=new V(Te.name,this.parseValueType(Te.type),Te.value_string,Te.value_number,Te.value_boolean,Te.value_json,Te.value_analytics,Te.encoding);de.set(Le.name,Le)}}return de.size!=0&&(this.properties=de,!0)},Y.prototype.isValidValueType=function(ee){return ee==="string"||ee==="number"||ee==="boolean"||ee=="json"},Y.prototype.parseValueType=function(ee){switch(ee){case"string":return U.STRING;case"number":return U.NUMBER;case"boolean":return U.BOOLEAN;case"json":return U.JSON;default:throw new Error("Unsupported value type ".concat(ee))}},Y.prototype.emitMetrics=function(ee){var oe,de,Me,He,Te,Le,we,Ce,ke=(oe=this.storage.getJson(T))!==null&&oe!==void 0?oe:{},St={initial_load_time:this.initialLoadTime,fetch_attempt_count:(de=ke.fetch_attempt_count)!==null&&de!==void 0?de:0,fetch_duration_average:(Me=ke.fetch_duration_average)!==null&&Me!==void 0?Me:0,success_no_change_count:(He=ke.success_no_change_count)!==null&&He!==void 0?He:0,success_new_data_count:(Te=ke.success_new_data_count)!==null&&Te!==void 0?Te:0,fail_exception_count:(Le=ke.fail_exception_count)!==null&&Le!==void 0?Le:0,fail_http_error_count:(we=ke.fail_http_error_count)!==null&&we!==void 0?we:0,fail_invalid_data_count:(Ce=ke.fail_invalid_data_count)!==null&&Ce!==void 0?Ce:0};ee.onMetrics(St),ke.fetch_attempt_count=0,ke.success_no_change_count=0,ke.success_new_data_count=0,ke.fail_exception_count=0,ke.fail_http_error_count=0,ke.fail_invalid_data_count=0,this.storage.setJson(T,ke)},Y.prototype.exceptionMetrics=function(ee){ee instanceof v||ee.message.startsWith("http error")?this.incrementMetrics("fail_http_error_count"):this.incrementMetrics("fail_exception_count")},Y.prototype.incrementMetrics=function(ee){var oe,de,Me=(oe=this.storage.getJson(T))!==null&&oe!==void 0?oe:{};Me[ee]=((de=Me[ee])!==null&&de!==void 0?de:0)+1,this.storage.setJson(T,Me)},Y.prototype.incrementMetricsWithDuration=function(ee,oe){var de,Me,He=(de=this.storage.getJson(T))!==null&&de!==void 0?de:{};He[ee]=((Me=He[ee])!==null&&Me!==void 0?Me:0)+1,oe>0&&(He.fetch_duration_average!==void 0?He.fetch_duration_average=.9*He.fetch_duration_average+.1*oe|0:He.fetch_duration_average=oe),this.storage.setJson(T,He)},Y}();h.ConfigurationManager=k;var L=function(){function Y(ee,oe){this.analytics=ee,this.properties=oe}return Y.prototype.getSize=function(){return this.properties?this.properties.size:-1},Y.prototype.getStringValue=function(ee){var oe,de;if(this.properties){var Me=this.properties.get(ee);if(Me){if(Me.type===U.STRING){var He=(oe=Me.valueString)!==null&&oe!==void 0?oe:"";return this.analytics.onValue(ee,(de=Me.valueAnalytics)!==null&&de!==void 0?de:He),He}this.analytics.onError(ee,"Type is not string")}}else this.analytics.onTrace(ee,"Configuration is not available")},Y.prototype.getNumberValue=function(ee){var oe,de;if(this.properties){var Me=this.properties.get(ee);if(Me){if(Me.type===U.NUMBER){var He=(oe=Me.valueNumber)!==null&&oe!==void 0?oe:0;return this.analytics.onValue(ee,(de=Me.valueAnalytics)!==null&&de!==void 0?de:He.toString()),He}this.analytics.onError(ee,"Type is not number")}}else this.analytics.onTrace(ee,"Configuration is not available")},Y.prototype.getBooleanValue=function(ee){var oe,de;if(this.properties){var Me=this.properties.get(ee);if(Me){if(Me.type===U.BOOLEAN){var He=(oe=Me.valueBoolean)!==null&&oe!==void 0&&oe;return this.analytics.onValue(ee,(de=Me.valueAnalytics)!==null&&de!==void 0?de:He.toString()),He}this.analytics.onError(ee,"Type is not boolean")}}else this.analytics.onTrace(ee,"Configuration is not available")},Y.prototype.getJsonValue=function(ee){var oe,de;if(this.properties){var Me=this.properties.get(ee);if(Me){if(Me.type===U.JSON){var He=Me.valueJson;if(!He)return this.analytics.onValue(ee,(oe=Me.valueAnalytics)!==null&&oe!==void 0?oe:""),null;try{var Te=JSON.parse(He);return this.analytics.onValue(ee,(de=Me.valueAnalytics)!==null&&de!==void 0?de:He),Te}catch{return void this.analytics.onError(ee,"Json parse error")}}this.analytics.onError(ee,"Type is not json")}}else this.analytics.onTrace(ee,"Configuration is not available")},Y}();h.ConfigurationHolder=L;var U,$=function(){function Y(ee){this.context=ee}return Y.prototype.fetchUrl=function(ee,oe){var de=this;return new Promise(function(Me,He){de.context.fetch(ee,{headers:oe,cache:"no-store"}).then(function(Te){if(Te.status>=400)He(new v("http error ".concat(Te.status,", ").concat(Te.statusText)));else{var Le={status:Te.status,headers:Te.headers};Te.json().then(function(we){Le.json=we}).catch(function(){}).finally(function(){Me(Le)})}}).catch(function(Te){He(Te)})})},Y}(),q=function(){function Y(ee){this.env=ee}return Y.prototype.onTrace=function(ee){this.env!=f.PROD&&console.log("Configuration: "+ee)},Y}(),G=function(){function Y(ee){this.env=ee}return Y.prototype.onMetrics=function(ee){this.env!=f.PROD&&console.log("Metrics",ee)},Y.prototype.onValue=function(ee,oe){this.env!=f.PROD&&console.log("Configuration for ".concat(ee,": value = ").concat(oe))},Y.prototype.onError=function(ee,oe){this.env!=f.PROD&&console.error("Configuration for ".concat(ee,": error = ").concat(oe))},Y.prototype.onTrace=function(ee,oe){this.env!=f.PROD&&console.log("Configuration for ".concat(ee,": trace = ").concat(oe))},Y}(),X=function(){function Y(ee,oe){this.prefix=ee,this.storage=oe}return Y.prototype.getJson=function(ee){var oe=this.prefix+"_"+ee;try{var de=this.storage.getItem(oe);if(de)return JSON.parse(de)}catch(Me){console.error("Error getting local storage key ".concat(oe)+Me)}return null},Y.prototype.setJson=function(ee,oe){var de=this.prefix+"_"+ee;try{this.storage.setItem(de,JSON.stringify(oe))}catch(Me){console.error("Error setting local storage key ".concat(de,": ")+Me)}},Y}(),re=function(){function Y(){}return Y.prototype.getMillis=function(){return Date.now()},Y}();(function(Y){Y[Y.STRING=0]="STRING",Y[Y.NUMBER=1]="NUMBER",Y[Y.BOOLEAN=2]="BOOLEAN",Y[Y.JSON=3]="JSON"})(U||(U={}));var V=function(Y,ee,oe,de,Me,He,Te,Le){switch(this.name=Y,this.type=ee,this.valueString=oe,this.valueNumber=de,this.valueBoolean=Me,this.valueJson=He,this.valueAnalytics=Te,this.type){case U.STRING:Le===I&&oe&&(this.valueString=atob(oe));break;case U.JSON:Le===I&&He&&(this.valueJson=atob(He))}},Z=function(){function Y(ee,oe){var de;this.storage=ee,this.key=oe,this.state=(de=ee.getJson(oe))!==null&&de!==void 0?de:{}}return Y.prototype.getState=function(){return this.state},Y.prototype.setState=function(ee){Object.assign(this.state,ee),this.storage.setJson(this.key,this.state)},Y}()},456:function(u,h,d){var f=this&&this.__createBinding||(Object.create?function(g,_,v,E){E===void 0&&(E=v);var T=Object.getOwnPropertyDescriptor(_,v);T&&!("get"in T?!_.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return _[v]}}),Object.defineProperty(g,E,T)}:function(g,_,v,E){E===void 0&&(E=v),g[E]=_[v]}),p=this&&this.__exportStar||function(g,_){for(var v in g)v==="default"||Object.prototype.hasOwnProperty.call(_,v)||f(_,g,v)};Object.defineProperty(h,"__esModule",{value:!0}),p(d(903),h)},903:function(u,h,d){var f=this&&this.__spreadArray||function(_,v,E){if(E||arguments.length===2)for(var T,x=0,N=v.length;x<N;x++)!T&&x in v||(T||(T=Array.prototype.slice.call(v,0,x)),T[x]=v[x]);return _.concat(T||Array.prototype.slice.call(v))};Object.defineProperty(h,"__esModule",{value:!0}),h.TypedEmitter=void 0;var p=d(228),g=function(){function _(v){var E=v.propagateErrors;this.emitter=new p.EventEmitter,this.propagateErrors=E!=null&&E}return _.prototype.on=function(v,E){E.call=this.wrapCall(v,E),this.emitter.on(v,E)},_.prototype.off=function(v,E){this.emitter.off(v,E)},_.prototype.emit=function(v){for(var E,T=[],x=1;x<arguments.length;x++)T[x-1]=arguments[x];(E=this.emitter).emit.apply(E,f([v],T,!1))},_.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},_.prototype.wrapCall=function(v,E){var T=this;return function(x){for(var N=[],A=1;A<arguments.length;A++)N[A-1]=arguments[A];if(T.propagateErrors)E.apply(x,N);else try{E.apply(x,N)}catch(L){var I="Error in callback for ".concat(v),k=E.name;return k&&(I+=" for function ".concat(k)),void console.error(I,L)}}},_}();h.TypedEmitter=g},987:function(u,h,d){var f,p=this&&this.__extends||(f=function(N,A){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,k){I.__proto__=k}||function(I,k){for(var L in k)Object.prototype.hasOwnProperty.call(k,L)&&(I[L]=k[L])},f(N,A)},function(N,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function I(){this.constructor=N}f(N,A),N.prototype=A===null?Object.create(A):(I.prototype=A.prototype,new I)}),g=this&&this.__createBinding||(Object.create?function(N,A,I,k){k===void 0&&(k=I);var L=Object.getOwnPropertyDescriptor(A,I);L&&!("get"in L?!A.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return A[I]}}),Object.defineProperty(N,k,L)}:function(N,A,I,k){k===void 0&&(k=I),N[k]=A[I]}),_=this&&this.__setModuleDefault||(Object.create?function(N,A){Object.defineProperty(N,"default",{enumerable:!0,value:A})}:function(N,A){N.default=A}),v=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var A={};if(N!=null)for(var I in N)I!=="default"&&Object.prototype.hasOwnProperty.call(N,I)&&g(A,N,I);return _(A,N),A};Object.defineProperty(h,"__esModule",{value:!0}),h.createFsm=h.FsmWildcardState=h.RejectedTransitionError=h.InvalidStateTransitionError=void 0;var E=v(d(293)),T=function(N){function A(I,k){var L=N.call(this,"Invalid transition from '".concat(k,"' via event '").concat(I,"'"))||this;return L.name="InvalidStateTransitionError",L}return p(A,N),A}(Error);h.InvalidStateTransitionError=T;var x=function(N){function A(I,k,L){var U=N.call(this,"Transition from '".concat(k,"' via event '").concat(I,"' was rejected for: ").concat(L))||this;return U.name="RejectedTransitionError",U}return p(A,N),A}(Error);h.RejectedTransitionError=x,h.FsmWildcardState="*",h.createFsm=function(N){var A,I=N.transitions,k=N.callbacks,L=N.initialState,U=function($){var q,G=(q=I[$])===null||q===void 0?void 0:q.from;return!!G&&(typeof G=="string"?G===h.FsmWildcardState:G.includes(L))};return{canTransition:U,transition:function($,q){var G,X,re,V,Z,Y;if(!U($))return E.err(new T(String(L),String($)));var ee=I[$];return ee.shouldTransition===void 0||ee.shouldTransition(L)?((X=(G=k==null?void 0:k[L])===null||G===void 0?void 0:G.onExiting)===null||X===void 0||X.call(G),(re=k==null?void 0:k.onStateExiting)===null||re===void 0||re.call(k,L),A=L,L=ee.to,(Z=(V=k==null?void 0:k[L])===null||V===void 0?void 0:V.onChanged)===null||Z===void 0||Z.call(V,A,q),(Y=k==null?void 0:k.onStateChanged)===null||Y===void 0||Y.call(k,A,L,q),E.ok(L)):E.err(new x(String(L),String($),"shouldTransition returned false"))},previousState:function(){return A},currentState:function(){return L}}}},156:function(u,h,d){var f=this&&this.__createBinding||(Object.create?function(g,_,v,E){E===void 0&&(E=v);var T=Object.getOwnPropertyDescriptor(_,v);T&&!("get"in T?!_.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return _[v]}}),Object.defineProperty(g,E,T)}:function(g,_,v,E){E===void 0&&(E=v),g[E]=_[v]}),p=this&&this.__exportStar||function(g,_){for(var v in g)v==="default"||Object.prototype.hasOwnProperty.call(_,v)||f(_,g,v)};Object.defineProperty(h,"__esModule",{value:!0}),h.VERSION=void 0,h.VERSION="0.2.0",p(d(815),h),p(d(456),h),p(d(987),h),p(d(293),h)},293:(u,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.getErr=h.getOk_or=h.getOk=h.isNotOk=h.isOk=h.err=h.ok=void 0,h.ok=function(d){return{ok:!0,value:d}},h.err=function(d){return{ok:!1,error:d}},h.isOk=function(d){return d.ok===!0},h.isNotOk=function(d){return!(0,h.isOk)(d)},h.getOk=function(d){return d.ok===!0?d.value:void 0},h.getOk_or=function(d,f){return d.ok===!0?d.value:f},h.getErr=function(d){return d.ok===!0?void 0:d.error}}},l={};return function u(h){var d=l[h];if(d!==void 0)return d.exports;var f=l[h]={exports:{}};return c[h].call(f.exports,f,f.exports,u),f.exports}(156)})(),a.exports=o()},1989:(a,o,c)=>{var l=c(1789),u=c(401),h=c(7667),d=c(1327),f=c(1866);function p(g){var _=-1,v=g==null?0:g.length;for(this.clear();++_<v;){var E=g[_];this.set(E[0],E[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=f,a.exports=p},8407:(a,o,c)=>{var l=c(7040),u=c(4125),h=c(2117),d=c(7518),f=c(4705);function p(g){var _=-1,v=g==null?0:g.length;for(this.clear();++_<v;){var E=g[_];this.set(E[0],E[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=f,a.exports=p},7071:(a,o,c)=>{var l=c(852)(c(5639),"Map");a.exports=l},3369:(a,o,c)=>{var l=c(4785),u=c(1285),h=c(6e3),d=c(9916),f=c(5265);function p(g){var _=-1,v=g==null?0:g.length;for(this.clear();++_<v;){var E=g[_];this.set(E[0],E[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=d,p.prototype.set=f,a.exports=p},6384:(a,o,c)=>{var l=c(8407),u=c(7465),h=c(3779),d=c(7599),f=c(4758),p=c(4309);function g(_){var v=this.__data__=new l(_);this.size=v.size}g.prototype.clear=u,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=f,g.prototype.set=p,a.exports=g},2705:(a,o,c)=>{var l=c(5639).Symbol;a.exports=l},1149:(a,o,c)=>{var l=c(5639).Uint8Array;a.exports=l},6874:a=>{a.exports=function(o,c,l){switch(l.length){case 0:return o.call(c);case 1:return o.call(c,l[0]);case 2:return o.call(c,l[0],l[1]);case 3:return o.call(c,l[0],l[1],l[2])}return o.apply(c,l)}},4636:(a,o,c)=>{var l=c(2545),u=c(5694),h=c(1469),d=c(4144),f=c(5776),p=c(6719),g=Object.prototype.hasOwnProperty;a.exports=function(_,v){var E=h(_),T=!E&&u(_),x=!E&&!T&&d(_),N=!E&&!T&&!x&&p(_),A=E||T||x||N,I=A?l(_.length,String):[],k=I.length;for(var L in _)!v&&!g.call(_,L)||A&&(L=="length"||x&&(L=="offset"||L=="parent")||N&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||f(L,k))||I.push(L);return I}},6556:(a,o,c)=>{var l=c(9465),u=c(7813);a.exports=function(h,d,f){(f!==void 0&&!u(h[d],f)||f===void 0&&!(d in h))&&l(h,d,f)}},4865:(a,o,c)=>{var l=c(9465),u=c(7813),h=Object.prototype.hasOwnProperty;a.exports=function(d,f,p){var g=d[f];h.call(d,f)&&u(g,p)&&(p!==void 0||f in d)||l(d,f,p)}},8470:(a,o,c)=>{var l=c(7813);a.exports=function(u,h){for(var d=u.length;d--;)if(l(u[d][0],h))return d;return-1}},9465:(a,o,c)=>{var l=c(8777);a.exports=function(u,h,d){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:d,writable:!0}):u[h]=d}},3118:(a,o,c)=>{var l=c(3218),u=Object.create,h=function(){function d(){}return function(f){if(!l(f))return{};if(u)return u(f);d.prototype=f;var p=new d;return d.prototype=void 0,p}}();a.exports=h},8483:(a,o,c)=>{var l=c(5063)();a.exports=l},4239:(a,o,c)=>{var l=c(2705),u=c(9607),h=c(2333),d="[object Null]",f="[object Undefined]",p=l?l.toStringTag:void 0;a.exports=function(g){return g==null?g===void 0?f:d:p&&p in Object(g)?u(g):h(g)}},9454:(a,o,c)=>{var l=c(4239),u=c(7005),h="[object Arguments]";a.exports=function(d){return u(d)&&l(d)==h}},8458:(a,o,c)=>{var l=c(3560),u=c(5346),h=c(3218),d=c(346),f=/^\[object .+?Constructor\]$/,p=Function.prototype,g=Object.prototype,_=p.toString,v=g.hasOwnProperty,E=RegExp("^"+_.call(v).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");a.exports=function(T){return!(!h(T)||u(T))&&(l(T)?E:f).test(d(T))}},8749:(a,o,c)=>{var l=c(4239),u=c(1780),h=c(7005),d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d["[object Arguments]"]=d["[object Array]"]=d["[object ArrayBuffer]"]=d["[object Boolean]"]=d["[object DataView]"]=d["[object Date]"]=d["[object Error]"]=d["[object Function]"]=d["[object Map]"]=d["[object Number]"]=d["[object Object]"]=d["[object RegExp]"]=d["[object Set]"]=d["[object String]"]=d["[object WeakMap]"]=!1,a.exports=function(f){return h(f)&&u(f.length)&&!!d[l(f)]}},313:(a,o,c)=>{var l=c(3218),u=c(5726),h=c(3498),d=Object.prototype.hasOwnProperty;a.exports=function(f){if(!l(f))return h(f);var p=u(f),g=[];for(var _ in f)(_!="constructor"||!p&&d.call(f,_))&&g.push(_);return g}},2980:(a,o,c)=>{var l=c(6384),u=c(6556),h=c(8483),d=c(9783),f=c(3218),p=c(1704),g=c(6390);a.exports=function _(v,E,T,x,N){v!==E&&h(E,function(A,I){if(N||(N=new l),f(A))d(v,E,I,T,_,x,N);else{var k=x?x(g(v,I),A,I+"",v,E,N):void 0;k===void 0&&(k=A),u(v,I,k)}},p)}},9783:(a,o,c)=>{var l=c(6556),u=c(4626),h=c(7133),d=c(278),f=c(8517),p=c(5694),g=c(1469),_=c(9246),v=c(4144),E=c(3560),T=c(3218),x=c(8630),N=c(6719),A=c(6390),I=c(9881);a.exports=function(k,L,U,$,q,G,X){var re=A(k,U),V=A(L,U),Z=X.get(V);if(Z)l(k,U,Z);else{var Y=G?G(re,V,U+"",k,L,X):void 0,ee=Y===void 0;if(ee){var oe=g(V),de=!oe&&v(V),Me=!oe&&!de&&N(V);Y=V,oe||de||Me?g(re)?Y=re:_(re)?Y=d(re):de?(ee=!1,Y=u(V,!0)):Me?(ee=!1,Y=h(V,!0)):Y=[]:x(V)||p(V)?(Y=re,p(re)?Y=I(re):T(re)&&!E(re)||(Y=f(V))):ee=!1}ee&&(X.set(V,Y),q(Y,V,$,G,X),X.delete(V)),l(k,U,Y)}}},5976:(a,o,c)=>{var l=c(6557),u=c(5357),h=c(61);a.exports=function(d,f){return h(u(d,f,l),d+"")}},6560:(a,o,c)=>{var l=c(5703),u=c(8777),h=c(6557),d=u?function(f,p){return u(f,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:h;a.exports=d},2545:a=>{a.exports=function(o,c){for(var l=-1,u=Array(o);++l<o;)u[l]=c(l);return u}},1717:a=>{a.exports=function(o){return function(c){return o(c)}}},4318:(a,o,c)=>{var l=c(1149);a.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},4626:(a,o,c)=>{a=c.nmd(a);var l=c(5639),u=o&&!o.nodeType&&o,h=u&&a&&!a.nodeType&&a,d=h&&h.exports===u?l.Buffer:void 0,f=d?d.allocUnsafe:void 0;a.exports=function(p,g){if(g)return p.slice();var _=p.length,v=f?f(_):new p.constructor(_);return p.copy(v),v}},7133:(a,o,c)=>{var l=c(4318);a.exports=function(u,h){var d=h?l(u.buffer):u.buffer;return new u.constructor(d,u.byteOffset,u.length)}},278:a=>{a.exports=function(o,c){var l=-1,u=o.length;for(c||(c=Array(u));++l<u;)c[l]=o[l];return c}},8363:(a,o,c)=>{var l=c(4865),u=c(9465);a.exports=function(h,d,f,p){var g=!f;f||(f={});for(var _=-1,v=d.length;++_<v;){var E=d[_],T=p?p(f[E],h[E],E,f,h):void 0;T===void 0&&(T=h[E]),g?u(f,E,T):l(f,E,T)}return f}},4429:(a,o,c)=>{var l=c(5639)["__core-js_shared__"];a.exports=l},1463:(a,o,c)=>{var l=c(5976),u=c(6612);a.exports=function(h){return l(function(d,f){var p=-1,g=f.length,_=g>1?f[g-1]:void 0,v=g>2?f[2]:void 0;for(_=h.length>3&&typeof _=="function"?(g--,_):void 0,v&&u(f[0],f[1],v)&&(_=g<3?void 0:_,g=1),d=Object(d);++p<g;){var E=f[p];E&&h(d,E,p,_)}return d})}},5063:a=>{a.exports=function(o){return function(c,l,u){for(var h=-1,d=Object(c),f=u(c),p=f.length;p--;){var g=f[o?p:++h];if(l(d[g],g,d)===!1)break}return c}}},8777:(a,o,c)=>{var l=c(852),u=function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}}();a.exports=u},1957:(a,o,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;a.exports=l},5050:(a,o,c)=>{var l=c(7019);a.exports=function(u,h){var d=u.__data__;return l(h)?d[typeof h=="string"?"string":"hash"]:d.map}},852:(a,o,c)=>{var l=c(8458),u=c(7801);a.exports=function(h,d){var f=u(h,d);return l(f)?f:void 0}},5924:(a,o,c)=>{var l=c(5569)(Object.getPrototypeOf,Object);a.exports=l},9607:(a,o,c)=>{var l=c(2705),u=Object.prototype,h=u.hasOwnProperty,d=u.toString,f=l?l.toStringTag:void 0;a.exports=function(p){var g=h.call(p,f),_=p[f];try{p[f]=void 0;var v=!0}catch{}var E=d.call(p);return v&&(g?p[f]=_:delete p[f]),E}},7801:a=>{a.exports=function(o,c){return o==null?void 0:o[c]}},1789:(a,o,c)=>{var l=c(4536);a.exports=function(){this.__data__=l?l(null):{},this.size=0}},401:a=>{a.exports=function(o){var c=this.has(o)&&delete this.__data__[o];return this.size-=c?1:0,c}},7667:(a,o,c)=>{var l=c(4536),u="__lodash_hash_undefined__",h=Object.prototype.hasOwnProperty;a.exports=function(d){var f=this.__data__;if(l){var p=f[d];return p===u?void 0:p}return h.call(f,d)?f[d]:void 0}},1327:(a,o,c)=>{var l=c(4536),u=Object.prototype.hasOwnProperty;a.exports=function(h){var d=this.__data__;return l?d[h]!==void 0:u.call(d,h)}},1866:(a,o,c)=>{var l=c(4536),u="__lodash_hash_undefined__";a.exports=function(h,d){var f=this.__data__;return this.size+=this.has(h)?0:1,f[h]=l&&d===void 0?u:d,this}},8517:(a,o,c)=>{var l=c(3118),u=c(5924),h=c(5726);a.exports=function(d){return typeof d.constructor!="function"||h(d)?{}:l(u(d))}},5776:a=>{var o=9007199254740991,c=/^(?:0|[1-9]\d*)$/;a.exports=function(l,u){var h=typeof l;return!!(u=u??o)&&(h=="number"||h!="symbol"&&c.test(l))&&l>-1&&l%1==0&&l<u}},6612:(a,o,c)=>{var l=c(7813),u=c(8612),h=c(5776),d=c(3218);a.exports=function(f,p,g){if(!d(g))return!1;var _=typeof p;return!!(_=="number"?u(g)&&h(p,g.length):_=="string"&&p in g)&&l(g[p],f)}},7019:a=>{a.exports=function(o){var c=typeof o;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?o!=="__proto__":o===null}},5346:(a,o,c)=>{var l,u=c(4429),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";a.exports=function(d){return!!h&&h in d}},5726:a=>{var o=Object.prototype;a.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||o)}},7040:a=>{a.exports=function(){this.__data__=[],this.size=0}},4125:(a,o,c)=>{var l=c(8470),u=Array.prototype.splice;a.exports=function(h){var d=this.__data__,f=l(d,h);return!(f<0)&&(f==d.length-1?d.pop():u.call(d,f,1),--this.size,!0)}},2117:(a,o,c)=>{var l=c(8470);a.exports=function(u){var h=this.__data__,d=l(h,u);return d<0?void 0:h[d][1]}},7518:(a,o,c)=>{var l=c(8470);a.exports=function(u){return l(this.__data__,u)>-1}},4705:(a,o,c)=>{var l=c(8470);a.exports=function(u,h){var d=this.__data__,f=l(d,u);return f<0?(++this.size,d.push([u,h])):d[f][1]=h,this}},4785:(a,o,c)=>{var l=c(1989),u=c(8407),h=c(7071);a.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},1285:(a,o,c)=>{var l=c(5050);a.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},6e3:(a,o,c)=>{var l=c(5050);a.exports=function(u){return l(this,u).get(u)}},9916:(a,o,c)=>{var l=c(5050);a.exports=function(u){return l(this,u).has(u)}},5265:(a,o,c)=>{var l=c(5050);a.exports=function(u,h){var d=l(this,u),f=d.size;return d.set(u,h),this.size+=d.size==f?0:1,this}},4536:(a,o,c)=>{var l=c(852)(Object,"create");a.exports=l},3498:a=>{a.exports=function(o){var c=[];if(o!=null)for(var l in Object(o))c.push(l);return c}},1167:(a,o,c)=>{a=c.nmd(a);var l=c(1957),u=o&&!o.nodeType&&o,h=u&&a&&!a.nodeType&&a,d=h&&h.exports===u&&l.process,f=function(){try{var p=h&&h.require&&h.require("util").types;return p||d&&d.binding&&d.binding("util")}catch{}}();a.exports=f},2333:a=>{var o=Object.prototype.toString;a.exports=function(c){return o.call(c)}},5569:a=>{a.exports=function(o,c){return function(l){return o(c(l))}}},5357:(a,o,c)=>{var l=c(6874),u=Math.max;a.exports=function(h,d,f){return d=u(d===void 0?h.length-1:d,0),function(){for(var p=arguments,g=-1,_=u(p.length-d,0),v=Array(_);++g<_;)v[g]=p[d+g];g=-1;for(var E=Array(d+1);++g<d;)E[g]=p[g];return E[d]=f(v),l(h,this,E)}}},5639:(a,o,c)=>{var l=c(1957),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();a.exports=h},6390:a=>{a.exports=function(o,c){if((c!=="constructor"||typeof o[c]!="function")&&c!="__proto__")return o[c]}},61:(a,o,c)=>{var l=c(6560),u=c(1275)(l);a.exports=u},1275:a=>{var o=800,c=16,l=Date.now;a.exports=function(u){var h=0,d=0;return function(){var f=l(),p=c-(f-d);if(d=f,p>0){if(++h>=o)return arguments[0]}else h=0;return u.apply(void 0,arguments)}}},7465:(a,o,c)=>{var l=c(8407);a.exports=function(){this.__data__=new l,this.size=0}},3779:a=>{a.exports=function(o){var c=this.__data__,l=c.delete(o);return this.size=c.size,l}},7599:a=>{a.exports=function(o){return this.__data__.get(o)}},4758:a=>{a.exports=function(o){return this.__data__.has(o)}},4309:(a,o,c)=>{var l=c(8407),u=c(7071),h=c(3369),d=200;a.exports=function(f,p){var g=this.__data__;if(g instanceof l){var _=g.__data__;if(!u||_.length<d-1)return _.push([f,p]),this.size=++g.size,this;g=this.__data__=new h(_)}return g.set(f,p),this.size=g.size,this}},346:a=>{var o=Function.prototype.toString;a.exports=function(c){if(c!=null){try{return o.call(c)}catch{}try{return c+""}catch{}}return""}},5703:a=>{a.exports=function(o){return function(){return o}}},7813:a=>{a.exports=function(o,c){return o===c||o!=o&&c!=c}},6557:a=>{a.exports=function(o){return o}},5694:(a,o,c)=>{var l=c(9454),u=c(7005),h=Object.prototype,d=h.hasOwnProperty,f=h.propertyIsEnumerable,p=l(function(){return arguments}())?l:function(g){return u(g)&&d.call(g,"callee")&&!f.call(g,"callee")};a.exports=p},1469:a=>{var o=Array.isArray;a.exports=o},8612:(a,o,c)=>{var l=c(3560),u=c(1780);a.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},9246:(a,o,c)=>{var l=c(8612),u=c(7005);a.exports=function(h){return u(h)&&l(h)}},4144:(a,o,c)=>{a=c.nmd(a);var l=c(5639),u=c(5062),h=o&&!o.nodeType&&o,d=h&&a&&!a.nodeType&&a,f=d&&d.exports===h?l.Buffer:void 0,p=(f?f.isBuffer:void 0)||u;a.exports=p},3560:(a,o,c)=>{var l=c(4239),u=c(3218),h="[object AsyncFunction]",d="[object Function]",f="[object GeneratorFunction]",p="[object Proxy]";a.exports=function(g){if(!u(g))return!1;var _=l(g);return _==d||_==f||_==h||_==p}},1780:a=>{var o=9007199254740991;a.exports=function(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}},3218:a=>{a.exports=function(o){var c=typeof o;return o!=null&&(c=="object"||c=="function")}},7005:a=>{a.exports=function(o){return o!=null&&typeof o=="object"}},8630:(a,o,c)=>{var l=c(4239),u=c(5924),h=c(7005),d="[object Object]",f=Function.prototype,p=Object.prototype,g=f.toString,_=p.hasOwnProperty,v=g.call(Object);a.exports=function(E){if(!h(E)||l(E)!=d)return!1;var T=u(E);if(T===null)return!0;var x=_.call(T,"constructor")&&T.constructor;return typeof x=="function"&&x instanceof x&&g.call(x)==v}},6719:(a,o,c)=>{var l=c(8749),u=c(1717),h=c(1167),d=h&&h.isTypedArray,f=d?u(d):l;a.exports=f},1704:(a,o,c)=>{var l=c(4636),u=c(313),h=c(8612);a.exports=function(d){return h(d)?l(d,!0):u(d)}},6486:function(a,o,c){var l;a=c.nmd(a),(function(){var u,h="Expected a function",d="__lodash_hash_undefined__",f="__lodash_placeholder__",p=16,g=32,_=64,v=128,E=256,T=1/0,x=9007199254740991,N=NaN,A=4294967295,I=[["ary",v],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",g],["partialRight",_],["rearg",E]],k="[object Arguments]",L="[object Array]",U="[object Boolean]",$="[object Date]",q="[object Error]",G="[object Function]",X="[object GeneratorFunction]",re="[object Map]",V="[object Number]",Z="[object Object]",Y="[object Promise]",ee="[object RegExp]",oe="[object Set]",de="[object String]",Me="[object Symbol]",He="[object WeakMap]",Te="[object ArrayBuffer]",Le="[object DataView]",we="[object Float32Array]",Ce="[object Float64Array]",ke="[object Int8Array]",St="[object Int16Array]",At="[object Int32Array]",Ee="[object Uint8Array]",ye="[object Uint8ClampedArray]",et="[object Uint16Array]",fe="[object Uint32Array]",Fe=/\b__p \+= '';/g,Ie=/\b(__p \+=) '' \+/g,rt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,dt=/&(?:amp|lt|gt|quot|#39);/g,gt=/[&<>"']/g,bt=RegExp(dt.source),be=RegExp(gt.source),ue=/<%-([\s\S]+?)%>/g,Xe=/<%([\s\S]+?)%>/g,nt=/<%=([\s\S]+?)%>/g,$e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ue=/^\w*$/,qt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mt=/[\\^$.*+?()[\]{}|]/g,Yt=RegExp(Mt.source),ce=/^\s+/,j=/\s/,W=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,me=/\{\n\/\* \[wrapped with (.+)\] \*/,De=/,? & /,je=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,mt=/[()=,{}\[\]\/\s]/,xt=/\\(\\)?/g,Vn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qe=/\w*$/,Vt=/^[-+]0x[0-9a-f]+$/i,ht=/^0b[01]+$/i,Pt=/^\[object .+?Constructor\]$/,hn=/^0o[0-7]+$/i,an=/^(?:0|[1-9]\d*)$/,Ve=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ot=/($^)/,Ct=/['\n\r\u2028\u2029\\]/g,Nt="\\ud800-\\udfff",Yn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",si="\\u2700-\\u27bf",Sr="a-z\\xdf-\\xf6\\xf8-\\xff",sr="A-Z\\xc0-\\xd6\\xd8-\\xde",En="\\ufe0e\\ufe0f",sn="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ln="['’]",Nn="["+Nt+"]",dr="["+sn+"]",ui="["+Yn+"]",er="\\d+",La="["+si+"]",gu="["+Sr+"]",nf="[^"+Nt+sn+er+si+Sr+sr+"]",_p="\\ud83c[\\udffb-\\udfff]",d0="[^"+Nt+"]",rf="(?:\\ud83c[\\udde6-\\uddff]){2}",sf="[\\ud800-\\udbff][\\udc00-\\udfff]",vu="["+sr+"]",ve="\\u200d",Ke="(?:"+gu+"|"+nf+")",vt="(?:"+vu+"|"+nf+")",yt="(?:['’](?:d|ll|m|re|s|t|ve))?",Ze="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+ui+"|"+_p+")?",nn="["+En+"]?",mn=nn+Ht+("(?:"+ve+"(?:"+[d0,rf,sf].join("|")+")"+nn+Ht+")*"),Sn="(?:"+[La,rf,sf].join("|")+")"+mn,or="(?:"+[d0+ui+"?",ui,rf,sf,Nn].join("|")+")",cr=RegExp(Ln,"g"),Cn=RegExp(ui,"g"),gr=RegExp(_p+"(?="+_p+")|"+or+mn,"g"),ai=RegExp([vu+"?"+gu+"+"+yt+"(?="+[dr,vu,"$"].join("|")+")",vt+"+"+Ze+"(?="+[dr,vu+Ke,"$"].join("|")+")",vu+"?"+Ke+"+"+yt,vu+"+"+Ze,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",er,Sn].join("|"),"g"),As=RegExp("["+ve+Nt+Yn+En+"]"),vs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Kr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Xn=-1,Tr={};Tr[we]=Tr[Ce]=Tr[ke]=Tr[St]=Tr[At]=Tr[Ee]=Tr[ye]=Tr[et]=Tr[fe]=!0,Tr[k]=Tr[L]=Tr[Te]=Tr[U]=Tr[Le]=Tr[$]=Tr[q]=Tr[G]=Tr[re]=Tr[V]=Tr[Z]=Tr[ee]=Tr[oe]=Tr[de]=Tr[He]=!1;var Bn={};Bn[k]=Bn[L]=Bn[Te]=Bn[Le]=Bn[U]=Bn[$]=Bn[we]=Bn[Ce]=Bn[ke]=Bn[St]=Bn[At]=Bn[re]=Bn[V]=Bn[Z]=Bn[ee]=Bn[oe]=Bn[de]=Bn[Me]=Bn[Ee]=Bn[ye]=Bn[et]=Bn[fe]=!0,Bn[q]=Bn[G]=Bn[He]=!1;var Ho={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},zl=parseFloat,Qa=parseInt,ah=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,cs=typeof self=="object"&&self&&self.Object===Object&&self,bn=ah||cs||Function("return this")(),eo=o&&!o.nodeType&&o,Hs=eo&&a&&!a.nodeType&&a,qn=Hs&&Hs.exports===eo,_l=qn&&ah.process,oa=function(){try{var ft=Hs&&Hs.require&&Hs.require("util").types;return ft||_l&&_l.binding&&_l.binding("util")}catch{}}(),bp=oa&&oa.isArrayBuffer,ad=oa&&oa.isDate,oh=oa&&oa.isMap,f0=oa&&oa.isRegExp,Ry=oa&&oa.isSet,p0=oa&&oa.isTypedArray;function jo(ft,at,Ft){switch(Ft.length){case 0:return ft.call(at);case 1:return ft.call(at,Ft[0]);case 2:return ft.call(at,Ft[0],Ft[1]);case 3:return ft.call(at,Ft[0],Ft[1],Ft[2])}return ft.apply(at,Ft)}function m0(ft,at,Ft,fn){for(var Xt=-1,jr=ft==null?0:ft.length;++Xt<jr;){var la=ft[Xt];at(fn,la,Ft(la),ft)}return fn}function Vo(ft,at){for(var Ft=-1,fn=ft==null?0:ft.length;++Ft<fn&&at(ft[Ft],Ft,ft)!==!1;);return ft}function hx(ft,at){for(var Ft=ft==null?0:ft.length;Ft--&&at(ft[Ft],Ft,ft)!==!1;);return ft}function oE(ft,at){for(var Ft=-1,fn=ft==null?0:ft.length;++Ft<fn;)if(!at(ft[Ft],Ft,ft))return!1;return!0}function yu(ft,at){for(var Ft=-1,fn=ft==null?0:ft.length,Xt=0,jr=[];++Ft<fn;){var la=ft[Ft];at(la,Ft,ft)&&(jr[Xt++]=la)}return jr}function bm(ft,at){return!!(ft!=null&&ft.length)&&of(ft,at,0)>-1}function od(ft,at,Ft){for(var fn=-1,Xt=ft==null?0:ft.length;++fn<Xt;)if(Ft(at,ft[fn]))return!0;return!1}function Ss(ft,at){for(var Ft=-1,fn=ft==null?0:ft.length,Xt=Array(fn);++Ft<fn;)Xt[Ft]=at(ft[Ft],Ft,ft);return Xt}function ch(ft,at){for(var Ft=-1,fn=at.length,Xt=ft.length;++Ft<fn;)ft[Xt+Ft]=at[Ft];return ft}function Ay(ft,at,Ft,fn){var Xt=-1,jr=ft==null?0:ft.length;for(fn&&jr&&(Ft=ft[++Xt]);++Xt<jr;)Ft=at(Ft,ft[Xt],Xt,ft);return Ft}function cE(ft,at,Ft,fn){var Xt=ft==null?0:ft.length;for(fn&&Xt&&(Ft=ft[--Xt]);Xt--;)Ft=at(Ft,ft[Xt],Xt,ft);return Ft}function My(ft,at){for(var Ft=-1,fn=ft==null?0:ft.length;++Ft<fn;)if(at(ft[Ft],Ft,ft))return!0;return!1}var dx=g0("length");function lE(ft,at,Ft){var fn;return Ft(ft,function(Xt,jr,la){if(at(Xt,jr,la))return fn=jr,!1}),fn}function af(ft,at,Ft,fn){for(var Xt=ft.length,jr=Ft+(fn?1:-1);fn?jr--:++jr<Xt;)if(at(ft[jr],jr,ft))return jr;return-1}function of(ft,at,Ft){return at==at?function(fn,Xt,jr){for(var la=jr-1,uh=fn.length;++la<uh;)if(fn[la]===Xt)return la;return-1}(ft,at,Ft):af(ft,uE,Ft)}function Oy(ft,at,Ft,fn){for(var Xt=Ft-1,jr=ft.length;++Xt<jr;)if(fn(ft[Xt],at))return Xt;return-1}function uE(ft){return ft!=ft}function hE(ft,at){var Ft=ft==null?0:ft.length;return Ft?lh(ft,at)/Ft:N}function g0(ft){return function(at){return at==null?u:at[ft]}}function Ny(ft){return function(at){return ft==null?u:ft[at]}}function dE(ft,at,Ft,fn,Xt){return Xt(ft,function(jr,la,uh){Ft=fn?(fn=!1,jr):at(Ft,jr,la,uh)}),Ft}function lh(ft,at){for(var Ft,fn=-1,Xt=ft.length;++fn<Xt;){var jr=at(ft[fn]);jr!==u&&(Ft=Ft===u?jr:Ft+jr)}return Ft}function Em(ft,at){for(var Ft=-1,fn=Array(ft);++Ft<ft;)fn[Ft]=at(Ft);return fn}function fE(ft){return ft&&ft.slice(0,y0(ft)+1).replace(ce,"")}function hc(ft){return function(at){return ft(at)}}function Ms(ft,at){return Ss(at,function(Ft){return ft[Ft]})}function cd(ft,at){return ft.has(at)}function fx(ft,at){for(var Ft=-1,fn=ft.length;++Ft<fn&&of(at,ft[Ft],0)>-1;);return Ft}function ca(ft,at){for(var Ft=ft.length;Ft--&&of(at,ft[Ft],0)>-1;);return Ft}var px=Ny({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),v0=Ny({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function mx(ft){return"\\"+Ho[ft]}function cf(ft){return As.test(ft)}function Sm(ft){var at=-1,Ft=Array(ft.size);return ft.forEach(function(fn,Xt){Ft[++at]=[Xt,fn]}),Ft}function to(ft,at){return function(Ft){return ft(at(Ft))}}function dc(ft,at){for(var Ft=-1,fn=ft.length,Xt=0,jr=[];++Ft<fn;){var la=ft[Ft];la!==at&&la!==f||(ft[Ft]=f,jr[Xt++]=Ft)}return jr}function Tm(ft){var at=-1,Ft=Array(ft.size);return ft.forEach(function(fn){Ft[++at]=fn}),Ft}function gx(ft){var at=-1,Ft=Array(ft.size);return ft.forEach(function(fn){Ft[++at]=[fn,fn]}),Ft}function Ta(ft){return cf(ft)?function(at){for(var Ft=gr.lastIndex=0;gr.test(at);)++Ft;return Ft}(ft):dx(ft)}function Xs(ft){return cf(ft)?function(at){return at.match(gr)||[]}(ft):function(at){return at.split("")}(ft)}function y0(ft){for(var at=ft.length;at--&&j.test(ft.charAt(at)););return at}var ld=Ny({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Ep=function ft(at){var Ft,fn=(at=at==null?bn:Ep.defaults(bn.Object(),at,Ep.pick(bn,Kr))).Array,Xt=at.Date,jr=at.Error,la=at.Function,uh=at.Math,Jr=at.Object,Hl=at.RegExp,hh=at.String,Wc=at.TypeError,xm=fn.prototype,_0=la.prototype,_u=Jr.prototype,Yc=at["__core-js_shared__"],Ua=_0.toString,Ai=_u.hasOwnProperty,b0=0,Iy=(Ft=/[^.]+$/.exec(Yc&&Yc.keys&&Yc.keys.IE_PROTO||""))?"Symbol(src)_1."+Ft:"",lf=_u.toString,uf=Ua.call(Jr),ky=bn._,vx=Hl("^"+Ua.call(Ai).replace(Mt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Go=qn?at.Buffer:u,ud=at.Symbol,dh=at.Uint8Array,pE=Go?Go.allocUnsafe:u,wm=to(Jr.getPrototypeOf,Jr),Cm=Jr.create,E0=_u.propertyIsEnumerable,hf=xm.splice,S0=ud?ud.isConcatSpreadable:u,bu=ud?ud.iterator:u,Fi=ud?ud.toStringTag:u,T0=function(){try{var b=wl(Jr,"defineProperty");return b({},"",{}),b}catch{}}(),dn=at.clearTimeout!==bn.clearTimeout&&at.clearTimeout,ua=Xt&&Xt.now!==bn.Date.now&&Xt.now,x0=at.setTimeout!==bn.setTimeout&&at.setTimeout,Eu=uh.ceil,Xc=uh.floor,w0=Jr.getOwnPropertySymbols,Sp=Go?Go.isBuffer:u,xa=at.isFinite,mE=xm.join,fc=to(Jr.keys,Jr),Ts=uh.max,Ks=uh.min,Ir=Xt.now,pc=at.parseInt,To=uh.random,Tp=xm.reverse,C0=wl(at,"DataView"),xo=wl(at,"Map"),Bt=wl(at,"Promise"),wa=wl(at,"Set"),Rm=wl(at,"WeakMap"),df=wl(Jr,"create"),hd=Rm&&new Rm,ha={},R0=Dp(C0),mc=Dp(xo),yx=Dp(Bt),bl=Dp(wa),xp=Dp(Rm),jl=ud?ud.prototype:u,ff=jl?jl.valueOf:u,Am=jl?jl.toString:u;function ge(b){if(P(b)&&!Jn(b)&&!(b instanceof Br)){if(b instanceof no)return b;if(Ai.call(b,"__wrapped__"))return DE(b)}return new no(b)}var dd=function(){function b(){}return function(w){if(!M(w))return{};if(Cm)return Cm(w);b.prototype=w;var F=new b;return b.prototype=u,F}}();function fh(){}function no(b,w){this.__wrapped__=b,this.__actions__=[],this.__chain__=!!w,this.__index__=0,this.__values__=u}function Br(b){this.__wrapped__=b,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=A,this.__views__=[]}function fd(b){var w=-1,F=b==null?0:b.length;for(this.clear();++w<F;){var Q=b[w];this.set(Q[0],Q[1])}}function Su(b){var w=-1,F=b==null?0:b.length;for(this.clear();++w<F;){var Q=b[w];this.set(Q[0],Q[1])}}function Kc(b){var w=-1,F=b==null?0:b.length;for(this.clear();++w<F;){var Q=b[w];this.set(Q[0],Q[1])}}function Tu(b){var w=-1,F=b==null?0:b.length;for(this.__data__=new Kc;++w<F;)this.add(b[w])}function gc(b){var w=this.__data__=new Su(b);this.size=w.size}function Dy(b,w){var F=Jn(b),Q=!F&&Hi(b),le=!F&&!Q&&_f(b),xe=!F&&!Q&&!le&&pe(b),Pe=F||Q||le||xe,We=Pe?Em(b.length,hh):[],ct=We.length;for(var kt in b)!w&&!Ai.call(b,kt)||Pe&&(kt=="length"||le&&(kt=="offset"||kt=="parent")||xe&&(kt=="buffer"||kt=="byteLength"||kt=="byteOffset")||Os(kt,ct))||We.push(kt);return We}function Vl(b){var w=b.length;return w?b[TE(0,w-1)]:u}function Py(b,w){return X0(_c(b),pd(w,0,b.length))}function A0(b){return X0(_c(b))}function M0(b,w,F){(F!==u&&!Ns(b[w],F)||F===u&&!(w in b))&&xu(b,w,F)}function pf(b,w,F){var Q=b[w];Ai.call(b,w)&&Ns(Q,F)&&(F!==u||w in b)||xu(b,w,F)}function wo(b,w){for(var F=b.length;F--;)if(Ns(b[F][0],w))return F;return-1}function gE(b,w,F,Q){return El(b,function(le,xe,Pe){w(Q,le,F(le),Pe)}),Q}function qo(b,w){return b&&Ou(w,Tn(w),b)}function xu(b,w,F){w=="__proto__"&&T0?T0(b,w,{configurable:!0,enumerable:!0,value:F,writable:!0}):b[w]=F}function O0(b,w){for(var F=-1,Q=w.length,le=fn(Q),xe=b==null;++F<Q;)le[F]=xe?u:Rr(b,w[F]);return le}function pd(b,w,F){return b==b&&(F!==u&&(b=b<=F?b:F),w!==u&&(b=b>=w?b:w)),b}function vc(b,w,F,Q,le,xe){var Pe,We=1&w,ct=2&w,kt=4&w;if(F&&(Pe=le?F(b,Q,le,xe):F(b)),Pe!==u)return Pe;if(!M(b))return b;var Lt=Jn(b);if(Lt){if(Pe=function(Ut){var Zt=Ut.length,mr=new Ut.constructor(Zt);return Zt&&typeof Ut[0]=="string"&&Ai.call(Ut,"index")&&(mr.index=Ut.index,mr.input=Ut.input),mr}(b),!We)return _c(b,Pe)}else{var Wt=Fa(b),An=Wt==G||Wt==X;if(_f(b))return vr(b,We);if(Wt==Z||Wt==k||An&&!le){if(Pe=ct||An?{}:Cx(b),!We)return ct?function(Ut,Zt){return Ou(Ut,OE(Ut),Zt)}(b,function(Ut,Zt){return Ut&&Ou(Zt,$n(Zt),Ut)}(Pe,b)):function(Ut,Zt){return Ou(Ut,$0(Ut),Zt)}(b,qo(Pe,b))}else{if(!Bn[Wt])return le?b:{};Pe=function(Ut,Zt,mr){var Gt=Ut.constructor;switch(Zt){case Te:return Lm(Ut);case U:case $:return new Gt(+Ut);case Le:return function(on,In){var ln=In?Lm(on.buffer):on.buffer;return new on.constructor(ln,on.byteOffset,on.byteLength)}(Ut,mr);case we:case Ce:case ke:case St:case At:case Ee:case ye:case et:case fe:return Hy(Ut,mr);case re:return new Gt;case V:case de:return new Gt(Ut);case ee:return function(on){var In=new on.constructor(on.source,qe.exec(on));return In.lastIndex=on.lastIndex,In}(Ut);case oe:return new Gt;case Me:return Mn=Ut,ff?Jr(ff.call(Mn)):{}}var Mn}(b,Wt,We)}}xe||(xe=new gc);var Un=xe.get(b);if(Un)return Un;xe.set(b,Pe),K(b)?b.forEach(function(Ut){Pe.add(vc(Ut,w,F,Ut,b,xe))}):B(b)&&b.forEach(function(Ut,Zt){Pe.set(Zt,vc(Ut,w,F,Zt,b,xe))});var nr=Lt?u:(kt?ct?Vy:AE:ct?$n:Tn)(b);return Vo(nr||b,function(Ut,Zt){nr&&(Ut=b[Zt=Ut]),pf(Pe,Zt,vc(Ut,w,F,Zt,b,xe))}),Pe}function ls(b,w,F){var Q=F.length;if(b==null)return!Q;for(b=Jr(b);Q--;){var le=F[Q],xe=w[le],Pe=b[le];if(Pe===u&&!(le in b)||!xe(Pe))return!1}return!0}function Ly(b,w,F){if(typeof b!="function")throw new Wc(h);return zm(function(){b.apply(u,F)},w)}function mf(b,w,F,Q){var le=-1,xe=bm,Pe=!0,We=b.length,ct=[],kt=w.length;if(!We)return ct;F&&(w=Ss(w,hc(F))),Q?(xe=od,Pe=!1):w.length>=200&&(xe=cd,Pe=!1,w=new Tu(w));e:for(;++le<We;){var Lt=b[le],Wt=F==null?Lt:F(Lt);if(Lt=Q||Lt!==0?Lt:0,Pe&&Wt==Wt){for(var An=kt;An--;)if(w[An]===Wt)continue e;ct.push(Lt)}else xe(w,Wt,Q)||ct.push(Lt)}return ct}ge.templateSettings={escape:ue,evaluate:Xe,interpolate:nt,variable:"",imports:{_:ge}},ge.prototype=fh.prototype,ge.prototype.constructor=ge,no.prototype=dd(fh.prototype),no.prototype.constructor=no,Br.prototype=dd(fh.prototype),Br.prototype.constructor=Br,fd.prototype.clear=function(){this.__data__=df?df(null):{},this.size=0},fd.prototype.delete=function(b){var w=this.has(b)&&delete this.__data__[b];return this.size-=w?1:0,w},fd.prototype.get=function(b){var w=this.__data__;if(df){var F=w[b];return F===d?u:F}return Ai.call(w,b)?w[b]:u},fd.prototype.has=function(b){var w=this.__data__;return df?w[b]!==u:Ai.call(w,b)},fd.prototype.set=function(b,w){var F=this.__data__;return this.size+=this.has(b)?0:1,F[b]=df&&w===u?d:w,this},Su.prototype.clear=function(){this.__data__=[],this.size=0},Su.prototype.delete=function(b){var w=this.__data__,F=wo(w,b);return!(F<0)&&(F==w.length-1?w.pop():hf.call(w,F,1),--this.size,!0)},Su.prototype.get=function(b){var w=this.__data__,F=wo(w,b);return F<0?u:w[F][1]},Su.prototype.has=function(b){return wo(this.__data__,b)>-1},Su.prototype.set=function(b,w){var F=this.__data__,Q=wo(F,b);return Q<0?(++this.size,F.push([b,w])):F[Q][1]=w,this},Kc.prototype.clear=function(){this.size=0,this.__data__={hash:new fd,map:new(xo||Su),string:new fd}},Kc.prototype.delete=function(b){var w=Gy(this,b).delete(b);return this.size-=w?1:0,w},Kc.prototype.get=function(b){return Gy(this,b).get(b)},Kc.prototype.has=function(b){return Gy(this,b).has(b)},Kc.prototype.set=function(b,w){var F=Gy(this,b),Q=F.size;return F.set(b,w),this.size+=F.size==Q?0:1,this},Tu.prototype.add=Tu.prototype.push=function(b){return this.__data__.set(b,d),this},Tu.prototype.has=function(b){return this.__data__.has(b)},gc.prototype.clear=function(){this.__data__=new Su,this.size=0},gc.prototype.delete=function(b){var w=this.__data__,F=w.delete(b);return this.size=w.size,F},gc.prototype.get=function(b){return this.__data__.get(b)},gc.prototype.has=function(b){return this.__data__.has(b)},gc.prototype.set=function(b,w){var F=this.__data__;if(F instanceof Su){var Q=F.__data__;if(!xo||Q.length<199)return Q.push([b,w]),this.size=++F.size,this;F=this.__data__=new Kc(Q)}return F.set(b,w),this.size=F.size,this};var El=Sx(wu),N0=Sx(_E,!0);function vE(b,w){var F=!0;return El(b,function(Q,le,xe){return F=!!w(Q,le,xe)}),F}function Mm(b,w,F){for(var Q=-1,le=b.length;++Q<le;){var xe=b[Q],Pe=w(xe);if(Pe!=null&&(We===u?Pe==Pe&&!he(Pe):F(Pe,We)))var We=Pe,ct=xe}return ct}function Om(b,w){var F=[];return El(b,function(Q,le,xe){w(Q,le,xe)&&F.push(Q)}),F}function Ba(b,w,F,Q,le){var xe=-1,Pe=b.length;for(F||(F=NE),le||(le=[]);++xe<Pe;){var We=b[xe];w>0&&F(We)?w>1?Ba(We,w-1,F,Q,le):ch(le,We):Q||(le[le.length]=We)}return le}var I0=Tx(),yE=Tx(!0);function wu(b,w){return b&&I0(b,w,Tn)}function _E(b,w){return b&&yE(b,w,Tn)}function Cu(b,w){return yu(w,function(F){return O(b[F])})}function js(b,w){for(var F=0,Q=(w=yh(w,b)).length;b!=null&&F<Q;)b=b[Du(w[F++])];return F&&F==Q?b:u}function Gl(b,w,F){var Q=w(b);return Jn(b)?Q:ch(Q,F(b))}function da(b){return b==null?b===u?"[object Undefined]":"[object Null]":Fi&&Fi in Jr(b)?function(w){var F=Ai.call(w,Fi),Q=w[Fi];try{w[Fi]=u;var le=!0}catch{}var xe=lf.call(w);return le&&(F?w[Fi]=Q:delete w[Fi]),xe}(b):function(w){return lf.call(w)}(b)}function zi(b,w){return b>w}function Nm(b,w){return b!=null&&Ai.call(b,w)}function Im(b,w){return b!=null&&w in Jr(b)}function Uy(b,w,F){for(var Q=F?od:bm,le=b[0].length,xe=b.length,Pe=xe,We=fn(xe),ct=1/0,kt=[];Pe--;){var Lt=b[Pe];Pe&&w&&(Lt=Ss(Lt,hc(w))),ct=Ks(Lt.length,ct),We[Pe]=!F&&(w||le>=120&&Lt.length>=120)?new Tu(Pe&&Lt):u}Lt=b[0];var Wt=-1,An=We[0];e:for(;++Wt<le&&kt.length<ct;){var Un=Lt[Wt],nr=w?w(Un):Un;if(Un=F||Un!==0?Un:0,!(An?cd(An,nr):Q(kt,nr,F))){for(Pe=xe;--Pe;){var Ut=We[Pe];if(!(Ut?cd(Ut,nr):Q(b[Pe],nr,F)))continue e}An&&An.push(nr),kt.push(Un)}}return kt}function yc(b,w,F){var Q=(b=kE(b,w=yh(w,b)))==null?b:b[Du(Ao(w))];return Q==null?u:jo(Q,b,F)}function k0(b){return P(b)&&da(b)==k}function oi(b,w,F,Q,le){return b===w||(b==null||w==null||!P(b)&&!P(w)?b!=b&&w!=w:function(xe,Pe,We,ct,kt,Lt){var Wt=Jn(xe),An=Jn(Pe),Un=Wt?L:Fa(xe),nr=An?L:Fa(Pe),Ut=(Un=Un==k?Z:Un)==Z,Zt=(nr=nr==k?Z:nr)==Z,mr=Un==nr;if(mr&&_f(xe)){if(!_f(Pe))return!1;Wt=!0,Ut=!1}if(mr&&!Ut)return Lt||(Lt=new gc),Wt||pe(xe)?RE(xe,Pe,We,ct,kt,Lt):function(ln,Fn,xs,Ds,Ec,ki,fi){switch(xs){case Le:if(ln.byteLength!=Fn.byteLength||ln.byteOffset!=Fn.byteOffset)return!1;ln=ln.buffer,Fn=Fn.buffer;case Te:return!(ln.byteLength!=Fn.byteLength||!ki(new dh(ln),new dh(Fn)));case U:case $:case V:return Ns(+ln,+Fn);case q:return ln.name==Fn.name&&ln.message==Fn.message;case ee:case de:return ln==Fn+"";case re:var Sc=Sm;case oe:var Wl=1&Ds;if(Sc||(Sc=Tm),ln.size!=Fn.size&&!Wl)return!1;var Qy=fi.get(ln);if(Qy)return Qy==Fn;Ds|=2,fi.set(ln,Fn);var Yl=RE(Sc(ln),Sc(Fn),Ds,Ec,ki,fi);return fi.delete(ln),Yl;case Me:if(ff)return ff.call(ln)==ff.call(Fn)}return!1}(xe,Pe,Un,We,ct,kt,Lt);if(!(1&We)){var Gt=Ut&&Ai.call(xe,"__wrapped__"),Mn=Zt&&Ai.call(Pe,"__wrapped__");if(Gt||Mn){var on=Gt?xe.value():xe,In=Mn?Pe.value():Pe;return Lt||(Lt=new gc),kt(on,In,We,ct,Lt)}}return mr?(Lt||(Lt=new gc),function(ln,Fn,xs,Ds,Ec,ki){var fi=1&xs,Sc=AE(ln),Wl=Sc.length,Qy=AE(Fn),Yl=Qy.length;if(Wl!=Yl&&!fi)return!1;for(var Lp=Wl;Lp--;){var Ed=Sc[Lp];if(!(fi?Ed in Fn:Ai.call(Fn,Ed)))return!1}var Sd=ki.get(ln),Dx=ki.get(Fn);if(Sd&&Dx)return Sd==Fn&&Dx==ln;var e_=!0;ki.set(ln,Fn),ki.set(Fn,ln);for(var nv=fi;++Lp<Wl;){var rv=ln[Ed=Sc[Lp]],Td=Fn[Ed];if(Ds)var VE=fi?Ds(Td,rv,Ed,Fn,ln,ki):Ds(rv,Td,Ed,ln,Fn,ki);if(!(VE===u?rv===Td||Ec(rv,Td,xs,Ds,ki):VE)){e_=!1;break}nv||(nv=Ed=="constructor")}if(e_&&!nv){var Sf=ln.constructor,Xm=Fn.constructor;Sf==Xm||!("constructor"in ln)||!("constructor"in Fn)||typeof Sf=="function"&&Sf instanceof Sf&&typeof Xm=="function"&&Xm instanceof Xm||(e_=!1)}return ki.delete(ln),ki.delete(Fn),e_}(xe,Pe,We,ct,kt,Lt)):!1}(b,w,F,Q,oi,le))}function D0(b,w,F,Q){var le=F.length,xe=le,Pe=!Q;if(b==null)return!xe;for(b=Jr(b);le--;){var We=F[le];if(Pe&&We[2]?We[1]!==b[We[0]]:!(We[0]in b))return!1}for(;++le<xe;){var ct=(We=F[le])[0],kt=b[ct],Lt=We[1];if(Pe&&We[2]){if(kt===u&&!(ct in b))return!1}else{var Wt=new gc;if(Q)var An=Q(kt,Lt,ct,b,w,Wt);if(!(An===u?oi(Lt,kt,3,Q,Wt):An))return!1}}return!0}function _x(b){return!(!M(b)||(w=b,Iy&&Iy in w))&&(O(b)?vx:Pt).test(Dp(b));var w}function bE(b){return typeof b=="function"?b:b==null?ps:typeof b=="object"?Jn(b)?ph(b[0],b[1]):P0(b):Ef(b)}function EE(b){if(!W0(b))return fc(b);var w=[];for(var F in Jr(b))Ai.call(b,F)&&F!="constructor"&&w.push(F);return w}function bx(b){if(!M(b))return function(le){var xe=[];if(le!=null)for(var Pe in Jr(le))xe.push(Pe);return xe}(b);var w=W0(b),F=[];for(var Q in b)(Q!="constructor"||!w&&Ai.call(b,Q))&&F.push(Q);return F}function By(b,w){return b<w}function Ru(b,w){var F=-1,Q=oo(b)?fn(b.length):[];return El(b,function(le,xe,Pe){Q[++F]=w(le,xe,Pe)}),Q}function P0(b){var w=tr(b);return w.length==1&&w[0][2]?Ax(w[0][0],w[0][1]):function(F){return F===b||D0(F,b,w)}}function ph(b,w){return qy(b)&&Rx(w)?Ax(Du(b),w):function(F){var Q=Rr(F,b);return Q===u&&Q===w?Dr(F,b):oi(w,Q,3)}}function L0(b,w,F,Q,le){b!==w&&I0(w,function(xe,Pe){if(le||(le=new gc),M(xe))(function(ct,kt,Lt,Wt,An,Un,nr){var Ut=Y0(ct,Lt),Zt=Y0(kt,Lt),mr=nr.get(Zt);if(mr)return void M0(ct,Lt,mr);var Gt=Un?Un(Ut,Zt,Lt+"",ct,kt,nr):u,Mn=Gt===u;if(Mn){var on=Jn(Zt),In=!on&&_f(Zt),ln=!on&&!In&&pe(Zt);Gt=Zt,on||In||ln?Jn(Ut)?Gt=Ut:Is(Ut)?Gt=_c(Ut):In?(Mn=!1,Gt=vr(Zt,!0)):ln?(Mn=!1,Gt=Hy(Zt,!0)):Gt=[]:te(Zt)||Hi(Zt)?(Gt=Ut,Hi(Ut)?Gt=Kt(Ut):M(Ut)&&!O(Ut)||(Gt=Cx(Zt))):Mn=!1}Mn&&(nr.set(Zt,Gt),An(Gt,Zt,Wt,Un,nr),nr.delete(Zt)),M0(ct,Lt,Gt)})(b,w,Pe,F,L0,Q,le);else{var We=Q?Q(Y0(b,Pe),xe,Pe+"",b,w,le):u;We===u&&(We=xe),M0(b,Pe,We)}},$n)}function U0(b,w){var F=b.length;if(F)return Os(w+=w<0?F:0,F)?b[w]:u}function gf(b,w,F){w=w.length?Ss(w,function(xe){return Jn(xe)?function(Pe){return js(Pe,xe.length===1?xe[0]:xe)}:xe}):[ps];var Q=-1;w=Ss(w,hc(lr()));var le=Ru(b,function(xe,Pe,We){var ct=Ss(w,function(kt){return kt(xe)});return{criteria:ct,index:++Q,value:xe}});return function(xe,Pe){var We=xe.length;for(xe.sort(Pe);We--;)xe[We]=xe[We].value;return xe}(le,function(xe,Pe){return function(We,ct,kt){for(var Lt=-1,Wt=We.criteria,An=ct.criteria,Un=Wt.length,nr=kt.length;++Lt<Un;){var Ut=Op(Wt[Lt],An[Lt]);if(Ut)return Lt>=nr?Ut:Ut*(kt[Lt]=="desc"?-1:1)}return We.index-ct.index}(xe,Pe,F)})}function SE(b,w,F){for(var Q=-1,le=w.length,xe={};++Q<le;){var Pe=w[Q],We=js(b,Pe);F(We,Pe)&&km(xe,yh(Pe,b),We)}return xe}function B0(b,w,F,Q){var le=Q?Oy:of,xe=-1,Pe=w.length,We=b;for(b===w&&(w=_c(w)),F&&(We=Ss(b,hc(F)));++xe<Pe;)for(var ct=0,kt=w[xe],Lt=F?F(kt):kt;(ct=le(We,Lt,ct,Q))>-1;)We!==b&&hf.call(We,ct,1),hf.call(b,ct,1);return b}function Fy(b,w){for(var F=b?w.length:0,Q=F-1;F--;){var le=w[F];if(F==Q||le!==xe){var xe=le;Os(le)?hf.call(b,le,1):Ap(b,le)}}return b}function TE(b,w){return b+Xc(To()*(w-b+1))}function zy(b,w){var F="";if(!b||w<1||w>x)return F;do w%2&&(F+=b),(w=Xc(w/2))&&(b+=b);while(w);return F}function qr(b,w){return $y(Fm(b,w,ps),b+"")}function F0(b){return Vl(hi(b))}function Ex(b,w){var F=hi(b);return X0(F,pd(w,0,F.length))}function km(b,w,F,Q){if(!M(b))return b;for(var le=-1,xe=(w=yh(w,b)).length,Pe=xe-1,We=b;We!=null&&++le<xe;){var ct=Du(w[le]),kt=F;if(ct==="__proto__"||ct==="constructor"||ct==="prototype")return b;if(le!=Pe){var Lt=We[ct];(kt=Q?Q(Lt,ct,We):u)===u&&(kt=M(Lt)?Lt:Os(w[le+1])?[]:{})}pf(We,ct,kt),We=We[ct]}return b}var md=hd?function(b,w){return hd.set(b,w),b}:ps,Vr=T0?function(b,w){return T0(b,"toString",{configurable:!0,enumerable:!1,value:Mo(w),writable:!0})}:ps;function wp(b){return X0(hi(b))}function us(b,w,F){var Q=-1,le=b.length;w<0&&(w=-w>le?0:le+w),(F=F>le?le:F)<0&&(F+=le),le=w>F?0:F-w>>>0,w>>>=0;for(var xe=fn(le);++Q<le;)xe[Q]=b[Q+w];return xe}function mh(b,w){var F;return El(b,function(Q,le,xe){return!(F=w(Q,le,xe))}),!!F}function Cp(b,w,F){var Q=0,le=b==null?Q:b.length;if(typeof w=="number"&&w==w&&le<=2147483647){for(;Q<le;){var xe=Q+le>>>1,Pe=b[xe];Pe!==null&&!he(Pe)&&(F?Pe<=w:Pe<w)?Q=xe+1:le=xe}return le}return Dm(b,w,ps,F)}function Dm(b,w,F,Q){var le=0,xe=b==null?0:b.length;if(xe===0)return 0;for(var Pe=(w=F(w))!=w,We=w===null,ct=he(w),kt=w===u;le<xe;){var Lt=Xc((le+xe)/2),Wt=F(b[Lt]),An=Wt!==u,Un=Wt===null,nr=Wt==Wt,Ut=he(Wt);if(Pe)var Zt=Q||nr;else Zt=kt?nr&&(Q||An):We?nr&&An&&(Q||!Un):ct?nr&&An&&!Un&&(Q||!Ut):!Un&&!Ut&&(Q?Wt<=w:Wt<w);Zt?le=Lt+1:xe=Lt}return Ks(xe,4294967294)}function Rp(b,w){for(var F=-1,Q=b.length,le=0,xe=[];++F<Q;){var Pe=b[F],We=w?w(Pe):Pe;if(!F||!Ns(We,ct)){var ct=We;xe[le++]=Pe===0?0:Pe}}return xe}function gh(b){return typeof b=="number"?b:he(b)?N:+b}function Jc(b){if(typeof b=="string")return b;if(Jn(b))return Ss(b,Jc)+"";if(he(b))return Am?Am.call(b):"";var w=b+"";return w=="0"&&1/b==-1/0?"-0":w}function vh(b,w,F){var Q=-1,le=bm,xe=b.length,Pe=!0,We=[],ct=We;if(F)Pe=!1,le=od;else if(xe>=200){var kt=w?null:pR(b);if(kt)return Tm(kt);Pe=!1,le=cd,ct=new Tu}else ct=w?[]:We;e:for(;++Q<xe;){var Lt=b[Q],Wt=w?w(Lt):Lt;if(Lt=F||Lt!==0?Lt:0,Pe&&Wt==Wt){for(var An=ct.length;An--;)if(ct[An]===Wt)continue e;w&&ct.push(Wt),We.push(Lt)}else le(ct,Wt,F)||(ct!==We&&ct.push(Wt),We.push(Lt))}return We}function Ap(b,w){return(b=kE(b,w=yh(w,b)))==null||delete b[Du(Ao(w))]}function xE(b,w,F,Q){return km(b,w,F(js(b,w)),Q)}function Au(b,w,F,Q){for(var le=b.length,xe=Q?le:-1;(Q?xe--:++xe<le)&&w(b[xe],xe,b););return F?us(b,Q?0:xe,Q?xe+1:le):us(b,Q?xe+1:0,Q?le:xe)}function Pm(b,w){var F=b;return F instanceof Br&&(F=F.value()),Ay(w,function(Q,le){return le.func.apply(le.thisArg,ch([Q],le.args))},F)}function z0(b,w,F){var Q=b.length;if(Q<2)return Q?vh(b[0]):[];for(var le=-1,xe=fn(Q);++le<Q;)for(var Pe=b[le],We=-1;++We<Q;)We!=le&&(xe[le]=mf(xe[le]||Pe,b[We],w,F));return vh(Ba(xe,1),w,F)}function Mp(b,w,F){for(var Q=-1,le=b.length,xe=w.length,Pe={};++Q<le;){var We=Q<xe?w[Q]:u;F(Pe,b[Q],We)}return Pe}function H0(b){return Is(b)?b:[]}function Mu(b){return typeof b=="function"?b:ps}function yh(b,w){return Jn(b)?b:qy(b,w)?[b]:Wy(It(b))}var fR=qr;function ro(b,w,F){var Q=b.length;return F=F===u?Q:F,!w&&F>=Q?b:us(b,w,F)}var wE=dn||function(b){return bn.clearTimeout(b)};function vr(b,w){if(w)return b.slice();var F=b.length,Q=pE?pE(F):new b.constructor(F);return b.copy(Q),Q}function Lm(b){var w=new b.constructor(b.byteLength);return new dh(w).set(new dh(b)),w}function Hy(b,w){var F=w?Lm(b.buffer):b.buffer;return new b.constructor(F,b.byteOffset,b.length)}function Op(b,w){if(b!==w){var F=b!==u,Q=b===null,le=b==b,xe=he(b),Pe=w!==u,We=w===null,ct=w==w,kt=he(w);if(!We&&!kt&&!xe&&b>w||xe&&Pe&&ct&&!We&&!kt||Q&&Pe&&ct||!F&&ct||!le)return 1;if(!Q&&!xe&&!kt&&b<w||kt&&F&&le&&!Q&&!xe||We&&F&&le||!Pe&&le||!ct)return-1}return 0}function gd(b,w,F,Q){for(var le=-1,xe=b.length,Pe=F.length,We=-1,ct=w.length,kt=Ts(xe-Pe,0),Lt=fn(ct+kt),Wt=!Q;++We<ct;)Lt[We]=w[We];for(;++le<Pe;)(Wt||le<xe)&&(Lt[F[le]]=b[le]);for(;kt--;)Lt[We++]=b[le++];return Lt}function j0(b,w,F,Q){for(var le=-1,xe=b.length,Pe=-1,We=F.length,ct=-1,kt=w.length,Lt=Ts(xe-We,0),Wt=fn(Lt+kt),An=!Q;++le<Lt;)Wt[le]=b[le];for(var Un=le;++ct<kt;)Wt[Un+ct]=w[ct];for(;++Pe<We;)(An||le<xe)&&(Wt[Un+F[Pe]]=b[le++]);return Wt}function _c(b,w){var F=-1,Q=b.length;for(w||(w=fn(Q));++F<Q;)w[F]=b[F];return w}function Ou(b,w,F,Q){var le=!F;F||(F={});for(var xe=-1,Pe=w.length;++xe<Pe;){var We=w[xe],ct=Q?Q(F[We],b[We],We,F,b):u;ct===u&&(ct=b[We]),le?xu(F,We,ct):pf(F,We,ct)}return F}function vf(b,w){return function(F,Q){var le=Jn(F)?m0:gE,xe=w?w():{};return le(F,b,lr(Q,2),xe)}}function Um(b){return qr(function(w,F){var Q=-1,le=F.length,xe=le>1?F[le-1]:u,Pe=le>2?F[2]:u;for(xe=b.length>3&&typeof xe=="function"?(le--,xe):u,Pe&&Wo(F[0],F[1],Pe)&&(xe=le<3?u:xe,le=1),w=Jr(w);++Q<le;){var We=F[Q];We&&b(w,We,Q,xe)}return w})}function Sx(b,w){return function(F,Q){if(F==null)return F;if(!oo(F))return b(F,Q);for(var le=F.length,xe=w?le:-1,Pe=Jr(F);(w?xe--:++xe<le)&&Q(Pe[xe],xe,Pe)!==!1;);return F}}function Tx(b){return function(w,F,Q){for(var le=-1,xe=Jr(w),Pe=Q(w),We=Pe.length;We--;){var ct=Pe[b?We:++le];if(F(xe[ct],ct,xe)===!1)break}return w}}function xx(b){return function(w){var F=cf(w=It(w))?Xs(w):u,Q=F?F[0]:w.charAt(0),le=F?ro(F,1).join(""):w.slice(1);return Q[b]()+le}}function Np(b){return function(w){return Ay(Gr(fs(w).replace(cr,"")),b,"")}}function Ip(b){return function(){var w=arguments;switch(w.length){case 0:return new b;case 1:return new b(w[0]);case 2:return new b(w[0],w[1]);case 3:return new b(w[0],w[1],w[2]);case 4:return new b(w[0],w[1],w[2],w[3]);case 5:return new b(w[0],w[1],w[2],w[3],w[4]);case 6:return new b(w[0],w[1],w[2],w[3],w[4],w[5]);case 7:return new b(w[0],w[1],w[2],w[3],w[4],w[5],w[6])}var F=dd(b.prototype),Q=b.apply(F,w);return M(Q)?Q:F}}function CE(b){return function(w,F,Q){var le=Jr(w);if(!oo(w)){var xe=lr(F,3);w=Tn(w),F=function(We){return xe(le[We],We,le)}}var Pe=b(w,F,Q);return Pe>-1?le[xe?w[Pe]:Pe]:u}}function Bm(b){return ku(function(w){var F=w.length,Q=F,le=no.prototype.thru;for(b&&w.reverse();Q--;){var xe=w[Q];if(typeof xe!="function")throw new Wc(h);if(le&&!Pe&&vd(xe)=="wrapper")var Pe=new no([],!0)}for(Q=Pe?Q:F;++Q<F;){var We=vd(xe=w[Q]),ct=We=="wrapper"?ME(xe):u;Pe=ct&&IE(ct[0])&&ct[1]==424&&!ct[4].length&&ct[9]==1?Pe[vd(ct[0])].apply(Pe,ct[3]):xe.length==1&&IE(xe)?Pe[We]():Pe.thru(xe)}return function(){var kt=arguments,Lt=kt[0];if(Pe&&kt.length==1&&Jn(Lt))return Pe.plant(Lt).value();for(var Wt=0,An=F?w[Wt].apply(this,kt):Lt;++Wt<F;)An=w[Wt].call(this,An);return An}})}function V0(b,w,F,Q,le,xe,Pe,We,ct,kt){var Lt=w&v,Wt=1&w,An=2&w,Un=24&w,nr=512&w,Ut=An?u:Ip(b);return function Zt(){for(var mr=arguments.length,Gt=fn(mr),Mn=mr;Mn--;)Gt[Mn]=arguments[Mn];if(Un)var on=xl(Zt),In=function(Ds,Ec){for(var ki=Ds.length,fi=0;ki--;)Ds[ki]===Ec&&++fi;return fi}(Gt,on);if(Q&&(Gt=gd(Gt,Q,le,Un)),xe&&(Gt=j0(Gt,xe,Pe,Un)),mr-=In,Un&&mr<kt){var ln=dc(Gt,on);return Sl(b,w,V0,Zt.placeholder,F,Gt,ln,We,ct,kt-mr)}var Fn=Wt?F:this,xs=An?Fn[b]:b;return mr=Gt.length,We?Gt=function(Ds,Ec){for(var ki=Ds.length,fi=Ks(Ec.length,ki),Sc=_c(Ds);fi--;){var Wl=Ec[fi];Ds[fi]=Os(Wl,ki)?Sc[Wl]:u}return Ds}(Gt,We):nr&&mr>1&&Gt.reverse(),Lt&&ct<mr&&(Gt.length=ct),this&&this!==bn&&this instanceof Zt&&(xs=Ut||Ip(xs)),xs.apply(Fn,Gt)}}function wx(b,w){return function(F,Q){return function(le,xe,Pe,We){return wu(le,function(ct,kt,Lt){xe(We,Pe(ct),kt,Lt)}),We}(F,b,w(Q),{})}}function jy(b,w){return function(F,Q){var le;if(F===u&&Q===u)return w;if(F!==u&&(le=F),Q!==u){if(le===u)return Q;typeof F=="string"||typeof Q=="string"?(F=Jc(F),Q=Jc(Q)):(F=gh(F),Q=gh(Q)),le=b(F,Q)}return le}}function G0(b){return ku(function(w){return w=Ss(w,hc(lr())),qr(function(F){var Q=this;return b(w,function(le){return jo(le,Q,F)})})})}function ql(b,w){var F=(w=w===u?" ":Jc(w)).length;if(F<2)return F?zy(w,b):w;var Q=zy(w,Eu(b/Ta(w)));return cf(w)?ro(Xs(Q),0,b).join(""):Q.slice(0,b)}function Co(b){return function(w,F,Q){return Q&&typeof Q!="number"&&Wo(w,F,Q)&&(F=Q=u),w=Oe(w),F===u?(F=w,w=0):F=Oe(F),function(le,xe,Pe,We){for(var ct=-1,kt=Ts(Eu((xe-le)/(Pe||1)),0),Lt=fn(kt);kt--;)Lt[We?kt:++ct]=le,le+=Pe;return Lt}(w,F,Q=Q===u?w<F?1:-1:Oe(Q),b)}}function Nu(b){return function(w,F){return typeof w=="string"&&typeof F=="string"||(w=wt(w),F=wt(F)),b(w,F)}}function Sl(b,w,F,Q,le,xe,Pe,We,ct,kt){var Lt=8&w;w|=Lt?g:_,4&(w&=~(Lt?_:g))||(w&=-4);var Wt=[b,w,le,Lt?xe:u,Lt?Pe:u,Lt?u:xe,Lt?u:Pe,We,ct,kt],An=F.apply(u,Wt);return IE(b)&&Zc(An,Wt),An.placeholder=Q,za(An,b,w)}function q0(b){var w=uh[b];return function(F,Q){if(F=wt(F),(Q=Q==null?0:Ks(_e(Q),292))&&xa(F)){var le=(It(F)+"e").split("e");return+((le=(It(w(le[0]+"e"+(+le[1]+Q)))+"e").split("e"))[0]+"e"+(+le[1]-Q))}return w(F)}}var pR=wa&&1/Tm(new wa([,-0]))[1]==T?function(b){return new wa(b)}:co;function $o(b){return function(w){var F=Fa(w);return F==re?Sm(w):F==oe?gx(w):function(Q,le){return Ss(le,function(xe){return[xe,Q[xe]]})}(w,b(w))}}function io(b,w,F,Q,le,xe,Pe,We){var ct=2&w;if(!ct&&typeof b!="function")throw new Wc(h);var kt=Q?Q.length:0;if(kt||(w&=-97,Q=le=u),Pe=Pe===u?Pe:Ts(_e(Pe),0),We=We===u?We:_e(We),kt-=le?le.length:0,w&_){var Lt=Q,Wt=le;Q=le=u}var An=ct?u:ME(b),Un=[b,w,F,Q,le,Lt,Wt,xe,Pe,We];if(An&&function(Ut,Zt){var mr=Ut[1],Gt=Zt[1],Mn=mr|Gt,on=Mn<131,In=Gt==v&&mr==8||Gt==v&&mr==E&&Ut[7].length<=Zt[8]||Gt==384&&Zt[7].length<=Zt[8]&&mr==8;if(!on&&!In)return Ut;1&Gt&&(Ut[2]=Zt[2],Mn|=1&mr?0:4);var ln=Zt[3];if(ln){var Fn=Ut[3];Ut[3]=Fn?gd(Fn,ln,Zt[4]):ln,Ut[4]=Fn?dc(Ut[3],f):Zt[4]}(ln=Zt[5])&&(Fn=Ut[5],Ut[5]=Fn?j0(Fn,ln,Zt[6]):ln,Ut[6]=Fn?dc(Ut[5],f):Zt[6]),(ln=Zt[7])&&(Ut[7]=ln),Gt&v&&(Ut[8]=Ut[8]==null?Zt[8]:Ks(Ut[8],Zt[8])),Ut[9]==null&&(Ut[9]=Zt[9]),Ut[0]=Zt[0],Ut[1]=Mn}(Un,An),b=Un[0],w=Un[1],F=Un[2],Q=Un[3],le=Un[4],!(We=Un[9]=Un[9]===u?ct?0:b.length:Ts(Un[9]-kt,0))&&24&w&&(w&=-25),w&&w!=1)nr=w==8||w==p?function(Ut,Zt,mr){var Gt=Ip(Ut);return function Mn(){for(var on=arguments.length,In=fn(on),ln=on,Fn=xl(Mn);ln--;)In[ln]=arguments[ln];var xs=on<3&&In[0]!==Fn&&In[on-1]!==Fn?[]:dc(In,Fn);return(on-=xs.length)<mr?Sl(Ut,Zt,V0,Mn.placeholder,u,In,xs,u,u,mr-on):jo(this&&this!==bn&&this instanceof Mn?Gt:Ut,this,In)}}(b,w,We):w!=g&&w!=33||le.length?V0.apply(u,Un):function(Ut,Zt,mr,Gt){var Mn=1&Zt,on=Ip(Ut);return function In(){for(var ln=-1,Fn=arguments.length,xs=-1,Ds=Gt.length,Ec=fn(Ds+Fn),ki=this&&this!==bn&&this instanceof In?on:Ut;++xs<Ds;)Ec[xs]=Gt[xs];for(;Fn--;)Ec[xs++]=arguments[++ln];return jo(ki,Mn?mr:this,Ec)}}(b,w,F,Q);else var nr=function(Ut,Zt,mr){var Gt=1&Zt,Mn=Ip(Ut);return function on(){return(this&&this!==bn&&this instanceof on?Mn:Ut).apply(Gt?mr:this,arguments)}}(b,w,F);return za((An?md:Zc)(nr,Un),b,w)}function Iu(b,w,F,Q){return b===u||Ns(b,_u[F])&&!Ai.call(Q,F)?w:b}function Tl(b,w,F,Q,le,xe){return M(b)&&M(w)&&(xe.set(w,b),L0(b,w,u,Tl,xe),xe.delete(w)),b}function hs(b){return te(b)?u:b}function RE(b,w,F,Q,le,xe){var Pe=1&F,We=b.length,ct=w.length;if(We!=ct&&!(Pe&&ct>We))return!1;var kt=xe.get(b),Lt=xe.get(w);if(kt&&Lt)return kt==w&&Lt==b;var Wt=-1,An=!0,Un=2&F?new Tu:u;for(xe.set(b,w),xe.set(w,b);++Wt<We;){var nr=b[Wt],Ut=w[Wt];if(Q)var Zt=Pe?Q(Ut,nr,Wt,w,b,xe):Q(nr,Ut,Wt,b,w,xe);if(Zt!==u){if(Zt)continue;An=!1;break}if(Un){if(!My(w,function(mr,Gt){if(!cd(Un,Gt)&&(nr===mr||le(nr,mr,F,Q,xe)))return Un.push(Gt)})){An=!1;break}}else if(nr!==Ut&&!le(nr,Ut,F,Q,xe)){An=!1;break}}return xe.delete(b),xe.delete(w),An}function ku(b){return $y(Fm(b,u,Mx),b+"")}function AE(b){return Gl(b,Tn,$0)}function Vy(b){return Gl(b,$n,OE)}var ME=hd?function(b){return hd.get(b)}:co;function vd(b){for(var w=b.name+"",F=ha[w],Q=Ai.call(ha,w)?F.length:0;Q--;){var le=F[Q],xe=le.func;if(xe==null||xe==b)return le.name}return w}function xl(b){return(Ai.call(ge,"placeholder")?ge:b).placeholder}function lr(){var b=ge.iteratee||Zo;return b=b===Zo?bE:b,arguments.length?b(arguments[0],arguments[1]):b}function Gy(b,w){var F,Q,le=b.__data__;return((Q=typeof(F=w))=="string"||Q=="number"||Q=="symbol"||Q=="boolean"?F!=="__proto__":F===null)?le[typeof w=="string"?"string":"hash"]:le.map}function tr(b){for(var w=Tn(b),F=w.length;F--;){var Q=w[F],le=b[Q];w[F]=[Q,le,Rx(le)]}return w}function wl(b,w){var F=function(Q,le){return Q==null?u:Q[le]}(b,w);return _x(F)?F:u}var $0=w0?function(b){return b==null?[]:(b=Jr(b),yu(w0(b),function(w){return E0.call(b,w)}))}:bd,OE=w0?function(b){for(var w=[];b;)ch(w,$0(b)),b=wm(b);return w}:bd,Fa=da;function kp(b,w,F){for(var Q=-1,le=(w=yh(w,b)).length,xe=!1;++Q<le;){var Pe=Du(w[Q]);if(!(xe=b!=null&&F(b,Pe)))break;b=b[Pe]}return xe||++Q!=le?xe:!!(le=b==null?0:b.length)&&R(le)&&Os(Pe,le)&&(Jn(b)||Hi(b))}function Cx(b){return typeof b.constructor!="function"||W0(b)?{}:dd(wm(b))}function NE(b){return Jn(b)||Hi(b)||!!(S0&&b&&b[S0])}function Os(b,w){var F=typeof b;return!!(w=w??x)&&(F=="number"||F!="symbol"&&an.test(b))&&b>-1&&b%1==0&&b<w}function Wo(b,w,F){if(!M(F))return!1;var Q=typeof w;return!!(Q=="number"?oo(F)&&Os(w,F.length):Q=="string"&&w in F)&&Ns(F[w],b)}function qy(b,w){if(Jn(b))return!1;var F=typeof b;return!(F!="number"&&F!="symbol"&&F!="boolean"&&b!=null&&!he(b))||Ue.test(b)||!$e.test(b)||w!=null&&b in Jr(w)}function IE(b){var w=vd(b),F=ge[w];if(typeof F!="function"||!(w in Br.prototype))return!1;if(b===F)return!0;var Q=ME(F);return!!Q&&b===Q[0]}(C0&&Fa(new C0(new ArrayBuffer(1)))!=Le||xo&&Fa(new xo)!=re||Bt&&Fa(Bt.resolve())!=Y||wa&&Fa(new wa)!=oe||Rm&&Fa(new Rm)!=He)&&(Fa=function(b){var w=da(b),F=w==Z?b.constructor:u,Q=F?Dp(F):"";if(Q)switch(Q){case R0:return Le;case mc:return re;case yx:return Y;case bl:return oe;case xp:return He}return w});var mR=Yc?O:xh;function W0(b){var w=b&&b.constructor;return b===(typeof w=="function"&&w.prototype||_u)}function Rx(b){return b==b&&!M(b)}function Ax(b,w){return function(F){return F!=null&&F[b]===w&&(w!==u||b in Jr(F))}}function Fm(b,w,F){return w=Ts(w===u?b.length-1:w,0),function(){for(var Q=arguments,le=-1,xe=Ts(Q.length-w,0),Pe=fn(xe);++le<xe;)Pe[le]=Q[w+le];le=-1;for(var We=fn(w+1);++le<w;)We[le]=Q[le];return We[w]=F(Pe),jo(b,this,We)}}function kE(b,w){return w.length<2?b:js(b,us(w,0,-1))}function Y0(b,w){if((w!=="constructor"||typeof b[w]!="function")&&w!="__proto__")return b[w]}var Zc=Hm(md),zm=x0||function(b,w){return bn.setTimeout(b,w)},$y=Hm(Vr);function za(b,w,F){var Q=w+"";return $y(b,function(le,xe){var Pe=xe.length;if(!Pe)return le;var We=Pe-1;return xe[We]=(Pe>1?"& ":"")+xe[We],xe=xe.join(Pe>2?", ":" "),le.replace(W,`{
/* [wrapped with `+xe+`] */
`)}(Q,function(le,xe){return Vo(I,function(Pe){var We="_."+Pe[0];xe&Pe[1]&&!bm(le,We)&&le.push(We)}),le.sort()}(function(le){var xe=le.match(me);return xe?xe[1].split(De):[]}(Q),F)))}function Hm(b){var w=0,F=0;return function(){var Q=Ir(),le=16-(Q-F);if(F=Q,le>0){if(++w>=800)return arguments[0]}else w=0;return b.apply(u,arguments)}}function X0(b,w){var F=-1,Q=b.length,le=Q-1;for(w=w===u?Q:w;++F<w;){var xe=TE(F,le),Pe=b[xe];b[xe]=b[F],b[F]=Pe}return b.length=w,b}var Wy=function(b){var w=Ko(b,function(Q){return F.size===500&&F.clear(),Q}),F=w.cache;return w}(function(b){var w=[];return b.charCodeAt(0)===46&&w.push(""),b.replace(qt,function(F,Q,le,xe){w.push(le?xe.replace(xt,"$1"):Q||F)}),w});function Du(b){if(typeof b=="string"||he(b))return b;var w=b+"";return w=="0"&&1/b==-1/0?"-0":w}function Dp(b){if(b!=null){try{return Ua.call(b)}catch{}try{return b+""}catch{}}return""}function DE(b){if(b instanceof Br)return b.clone();var w=new no(b.__wrapped__,b.__chain__);return w.__actions__=_c(b.__actions__),w.__index__=b.__index__,w.__values__=b.__values__,w}var jm=qr(function(b,w){return Is(b)?mf(b,Ba(w,1,Is,!0)):[]}),Ha=qr(function(b,w){var F=Ao(w);return Is(F)&&(F=u),Is(b)?mf(b,Ba(w,1,Is,!0),lr(F,2)):[]}),Vm=qr(function(b,w){var F=Ao(w);return Is(F)&&(F=u),Is(b)?mf(b,Ba(w,1,Is,!0),u,F):[]});function fa(b,w,F){var Q=b==null?0:b.length;if(!Q)return-1;var le=F==null?0:_e(F);return le<0&&(le=Ts(Q+le,0)),af(b,lr(w,3),le)}function _h(b,w,F){var Q=b==null?0:b.length;if(!Q)return-1;var le=Q-1;return F!==u&&(le=_e(F),le=F<0?Ts(Q+le,0):Ks(le,Q-1)),af(b,lr(w,3),le,!0)}function Mx(b){return b!=null&&b.length?Ba(b,1):[]}function Gm(b){return b&&b.length?b[0]:u}var Yy=qr(function(b){var w=Ss(b,H0);return w.length&&w[0]===b[0]?Uy(w):[]}),Yo=qr(function(b){var w=Ao(b),F=Ss(b,H0);return w===Ao(F)?w=u:F.pop(),F.length&&F[0]===b[0]?Uy(F,lr(w,2)):[]}),Ro=qr(function(b){var w=Ao(b),F=Ss(b,H0);return(w=typeof w=="function"?w:u)&&F.pop(),F.length&&F[0]===b[0]?Uy(F,u,w):[]});function Ao(b){var w=b==null?0:b.length;return w?b[w-1]:u}var PE=qr(Ox);function Ox(b,w){return b&&b.length&&w&&w.length?B0(b,w):b}var yd=ku(function(b,w){var F=b==null?0:b.length,Q=O0(b,w);return Fy(b,Ss(w,function(le){return Os(le,F)?+le:le}).sort(Op)),Q});function bi(b){return b==null?b:Tp.call(b)}var gR=qr(function(b){return vh(Ba(b,1,Is,!0))}),vR=qr(function(b){var w=Ao(b);return Is(w)&&(w=u),vh(Ba(b,1,Is,!0),lr(w,2))}),yR=qr(function(b){var w=Ao(b);return w=typeof w=="function"?w:u,vh(Ba(b,1,Is,!0),u,w)});function qm(b){if(!b||!b.length)return[];var w=0;return b=yu(b,function(F){if(Is(F))return w=Ts(F.length,w),!0}),Em(w,function(F){return Ss(b,g0(F))})}function $m(b,w){if(!b||!b.length)return[];var F=qm(b);return w==null?F:Ss(F,function(Q){return jo(w,u,Q)})}var K0=qr(function(b,w){return Is(b)?mf(b,w):[]}),_R=qr(function(b){return z0(yu(b,Is))}),bR=qr(function(b){var w=Ao(b);return Is(w)&&(w=u),z0(yu(b,Is),lr(w,2))}),Nx=qr(function(b){var w=Ao(b);return w=typeof w=="function"?w:u,z0(yu(b,Is),u,w)}),Pu=qr(qm),Lu=qr(function(b){var w=b.length,F=w>1?b[w-1]:u;return F=typeof F=="function"?(b.pop(),F):u,$m(b,F)});function so(b){var w=ge(b);return w.__chain__=!0,w}function bh(b,w){return w(b)}var _d=ku(function(b){var w=b.length,F=w?b[0]:0,Q=this.__wrapped__,le=function(xe){return O0(xe,b)};return!(w>1||this.__actions__.length)&&Q instanceof Br&&Os(F)?((Q=Q.slice(F,+F+(w?1:0))).__actions__.push({func:bh,args:[le],thisArg:u}),new no(Q,this.__chain__).thru(function(xe){return w&&!xe.length&&xe.push(u),xe})):this.thru(le)}),Eh=vf(function(b,w,F){Ai.call(b,F)?++b[F]:xu(b,F,1)}),Vs=CE(fa),Xo=CE(_h);function LE(b,w){return(Jn(b)?Vo:El)(b,lr(w,3))}function J0(b,w){return(Jn(b)?hx:N0)(b,lr(w,3))}var UE=vf(function(b,w,F){Ai.call(b,F)?b[F].push(w):xu(b,F,[w])}),ER=qr(function(b,w,F){var Q=-1,le=typeof w=="function",xe=oo(b)?fn(b.length):[];return El(b,function(Pe){xe[++Q]=le?jo(w,Pe,F):yc(Pe,w,F)}),xe}),Ix=vf(function(b,w,F){xu(b,F,w)});function Xy(b,w){return(Jn(b)?Ss:Ru)(b,lr(w,3))}var BE=vf(function(b,w,F){b[F?0:1].push(w)},function(){return[[],[]]}),SR=qr(function(b,w){if(b==null)return[];var F=w.length;return F>1&&Wo(b,w[0],w[1])?w=[]:F>2&&Wo(w[0],w[1],w[2])&&(w=[w[0]]),gf(b,Ba(w,1),[])}),Ca=ua||function(){return bn.Date.now()};function Wm(b,w,F){return w=F?u:w,w=b&&w==null?b.length:w,io(b,v,u,u,u,u,w)}function Ky(b,w){var F;if(typeof w!="function")throw new Wc(h);return b=_e(b),function(){return--b>0&&(F=w.apply(this,arguments)),b<=1&&(w=u),F}}var FE=qr(function(b,w,F){var Q=1;if(F.length){var le=dc(F,xl(FE));Q|=g}return io(b,Q,w,F,le)}),zE=qr(function(b,w,F){var Q=3;if(F.length){var le=dc(F,xl(zE));Q|=g}return io(w,Q,b,F,le)});function HE(b,w,F){var Q,le,xe,Pe,We,ct,kt=0,Lt=!1,Wt=!1,An=!0;if(typeof b!="function")throw new Wc(h);function Un(Gt){var Mn=Q,on=le;return Q=le=u,kt=Gt,Pe=b.apply(on,Mn)}function nr(Gt){var Mn=Gt-ct;return ct===u||Mn>=w||Mn<0||Wt&&Gt-kt>=xe}function Ut(){var Gt=Ca();if(nr(Gt))return Zt(Gt);We=zm(Ut,function(Mn){var on=w-(Mn-ct);return Wt?Ks(on,xe-(Mn-kt)):on}(Gt))}function Zt(Gt){return We=u,An&&Q?Un(Gt):(Q=le=u,Pe)}function mr(){var Gt=Ca(),Mn=nr(Gt);if(Q=arguments,le=this,ct=Gt,Mn){if(We===u)return function(on){return kt=on,We=zm(Ut,w),Lt?Un(on):Pe}(ct);if(Wt)return wE(We),We=zm(Ut,w),Un(ct)}return We===u&&(We=zm(Ut,w)),Pe}return w=wt(w)||0,M(F)&&(Lt=!!F.leading,xe=(Wt="maxWait"in F)?Ts(wt(F.maxWait)||0,w):xe,An="trailing"in F?!!F.trailing:An),mr.cancel=function(){We!==u&&wE(We),kt=0,Q=ct=le=We=u},mr.flush=function(){return We===u?Pe:Zt(Ca())},mr}var ao=qr(function(b,w){return Ly(b,1,w)}),yf=qr(function(b,w,F){return Ly(b,wt(w)||0,F)});function Ko(b,w){if(typeof b!="function"||w!=null&&typeof w!="function")throw new Wc(h);var F=function(){var Q=arguments,le=w?w.apply(this,Q):Q[0],xe=F.cache;if(xe.has(le))return xe.get(le);var Pe=b.apply(this,Q);return F.cache=xe.set(le,Pe)||xe,Pe};return F.cache=new(Ko.Cache||Kc),F}function Jo(b){if(typeof b!="function")throw new Wc(h);return function(){var w=arguments;switch(w.length){case 0:return!b.call(this);case 1:return!b.call(this,w[0]);case 2:return!b.call(this,w[0],w[1]);case 3:return!b.call(this,w[0],w[1],w[2])}return!b.apply(this,w)}}Ko.Cache=Kc;var TR=fR(function(b,w){var F=(w=w.length==1&&Jn(w[0])?Ss(w[0],hc(lr())):Ss(Ba(w,1),hc(lr()))).length;return qr(function(Q){for(var le=-1,xe=Ks(Q.length,F);++le<xe;)Q[le]=w[le].call(this,Q[le]);return jo(b,this,Q)})}),Jy=qr(function(b,w){var F=dc(w,xl(Jy));return io(b,g,u,w,F)}),Z0=qr(function(b,w){var F=dc(w,xl(Z0));return io(b,_,u,w,F)}),ja=ku(function(b,w){return io(b,E,u,u,u,w)});function Ns(b,w){return b===w||b!=b&&w!=w}var Sh=Nu(zi),xR=Nu(function(b,w){return b>=w}),Hi=k0(function(){return arguments}())?k0:function(b){return P(b)&&Ai.call(b,"callee")&&!E0.call(b,"callee")},Jn=fn.isArray,kx=bp?hc(bp):function(b){return P(b)&&da(b)==Te};function oo(b){return b!=null&&R(b.length)&&!O(b)}function Is(b){return P(b)&&oo(b)}var _f=Sp||xh,Ym=ad?hc(ad):function(b){return P(b)&&da(b)==$};function jE(b){if(!P(b))return!1;var w=da(b);return w==q||w=="[object DOMException]"||typeof b.message=="string"&&typeof b.name=="string"&&!te(b)}function O(b){if(!M(b))return!1;var w=da(b);return w==G||w==X||w=="[object AsyncFunction]"||w=="[object Proxy]"}function S(b){return typeof b=="number"&&b==_e(b)}function R(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=x}function M(b){var w=typeof b;return b!=null&&(w=="object"||w=="function")}function P(b){return b!=null&&typeof b=="object"}var B=oh?hc(oh):function(b){return P(b)&&Fa(b)==re};function H(b){return typeof b=="number"||P(b)&&da(b)==V}function te(b){if(!P(b)||da(b)!=Z)return!1;var w=wm(b);if(w===null)return!0;var F=Ai.call(w,"constructor")&&w.constructor;return typeof F=="function"&&F instanceof F&&Ua.call(F)==uf}var ie=f0?hc(f0):function(b){return P(b)&&da(b)==ee},K=Ry?hc(Ry):function(b){return P(b)&&Fa(b)==oe};function se(b){return typeof b=="string"||!Jn(b)&&P(b)&&da(b)==de}function he(b){return typeof b=="symbol"||P(b)&&da(b)==Me}var pe=p0?hc(p0):function(b){return P(b)&&R(b.length)&&!!Tr[da(b)]},Ne=Nu(By),Je=Nu(function(b,w){return b<=w});function Ye(b){if(!b)return[];if(oo(b))return se(b)?Xs(b):_c(b);if(bu&&b[bu])return function(F){for(var Q,le=[];!(Q=F.next()).done;)le.push(Q.value);return le}(b[bu]());var w=Fa(b);return(w==re?Sm:w==oe?Tm:hi)(b)}function Oe(b){return b?(b=wt(b))===T||b===-1/0?17976931348623157e292*(b<0?-1:1):b==b?b:0:b===0?b:0}function _e(b){var w=Oe(b),F=w%1;return w==w?F?w-F:w:0}function lt(b){return b?pd(_e(b),0,A):0}function wt(b){if(typeof b=="number")return b;if(he(b))return N;if(M(b)){var w=typeof b.valueOf=="function"?b.valueOf():b;b=M(w)?w+"":w}if(typeof b!="string")return b===0?b:+b;b=fE(b);var F=ht.test(b);return F||hn.test(b)?Qa(b.slice(2),F?2:8):Vt.test(b)?N:+b}function Kt(b){return Ou(b,$n(b))}function It(b){return b==null?"":Jc(b)}var Kn=Um(function(b,w){if(W0(w)||oo(w))Ou(w,Tn(w),b);else for(var F in w)Ai.call(w,F)&&pf(b,F,w[F])}),wn=Um(function(b,w){Ou(w,$n(w),b)}),yr=Um(function(b,w,F,Q){Ou(w,$n(w),b,Q)}),Fr=Um(function(b,w,F,Q){Ou(w,Tn(w),b,Q)}),kr=ku(O0),xr=qr(function(b,w){b=Jr(b);var F=-1,Q=w.length,le=Q>2?w[2]:u;for(le&&Wo(w[0],w[1],le)&&(Q=1);++F<Q;)for(var xe=w[F],Pe=$n(xe),We=-1,ct=Pe.length;++We<ct;){var kt=Pe[We],Lt=b[kt];(Lt===u||Ns(Lt,_u[kt])&&!Ai.call(b,kt))&&(b[kt]=xe[kt])}return b}),_r=qr(function(b){return b.push(u,Tl),jo(Ji,u,b)});function Rr(b,w,F){var Q=b==null?u:js(b,w);return Q===u?F:Q}function Dr(b,w){return b!=null&&kp(b,w,Im)}var br=wx(function(b,w,F){w!=null&&typeof w.toString!="function"&&(w=lf.call(w)),b[w]=F},Mo(ps)),Ar=wx(function(b,w,F){w!=null&&typeof w.toString!="function"&&(w=lf.call(w)),Ai.call(b,w)?b[w].push(F):b[w]=[F]},lr),ur=qr(yc);function Tn(b){return oo(b)?Dy(b):EE(b)}function $n(b){return oo(b)?Dy(b,!0):bx(b)}var $r=Um(function(b,w,F){L0(b,w,F)}),Ji=Um(function(b,w,F,Q){L0(b,w,F,Q)}),ys=ku(function(b,w){var F={};if(b==null)return F;var Q=!1;w=Ss(w,function(xe){return xe=yh(xe,b),Q||(Q=xe.length>1),xe}),Ou(b,Vy(b),F),Q&&(F=vc(F,7,hs));for(var le=w.length;le--;)Ap(F,w[le]);return F}),Zi=ku(function(b,w){return b==null?{}:function(F,Q){return SE(F,Q,function(le,xe){return Dr(F,xe)})}(b,w)});function ds(b,w){if(b==null)return{};var F=Ss(Vy(b),function(Q){return[Q]});return w=lr(w),SE(b,F,function(Q,le){return w(Q,le[0])})}var Qi=$o(Tn),Ii=$o($n);function hi(b){return b==null?[]:Ms(b,Tn(b))}var $i=Np(function(b,w,F){return w=w.toLowerCase(),b+(F?es(w):w)});function es(b){return Zn(It(b).toLowerCase())}function fs(b){return(b=It(b))&&b.replace(Ve,px).replace(Cn,"")}var Js=Np(function(b,w,F){return b+(F?"-":"")+w.toLowerCase()}),pa=Np(function(b,w,F){return b+(F?" ":"")+w.toLowerCase()}),_s=xx("toLowerCase"),ks=Np(function(b,w,F){return b+(F?"_":"")+w.toLowerCase()}),di=Np(function(b,w,F){return b+(F?" ":"")+Zn(w)}),Ra=Np(function(b,w,F){return b+(F?" ":"")+w.toUpperCase()}),Zn=xx("toUpperCase");function Gr(b,w,F){return b=It(b),(w=F?u:w)===u?function(Q){return vs.test(Q)}(b)?function(Q){return Q.match(ai)||[]}(b):function(Q){return Q.match(je)||[]}(b):b.match(w)||[]}var Mi=qr(function(b,w){try{return jo(b,u,w)}catch(F){return jE(F)?F:new jr(F)}}),Va=ku(function(b,w){return Vo(w,function(F){F=Du(F),xu(b,F,FE(b[F],b))}),b});function Mo(b){return function(){return b}}var bc=Bm(),Qc=Bm(!0);function ps(b){return b}function Zo(b){return bE(typeof b=="function"?b:vc(b,1))}var Th=qr(function(b,w){return function(F){return yc(F,b,w)}}),$l=qr(function(b,w){return function(F){return yc(b,F,w)}});function Aa(b,w,F){var Q=Tn(w),le=Cu(w,Q);F!=null||M(w)&&(le.length||!Q.length)||(F=w,w=b,b=this,le=Cu(w,Tn(w)));var xe=!(M(F)&&"chain"in F&&!F.chain),Pe=O(b);return Vo(le,function(We){var ct=w[We];b[We]=ct,Pe&&(b.prototype[We]=function(){var kt=this.__chain__;if(xe||kt){var Lt=b(this.__wrapped__);return(Lt.__actions__=_c(this.__actions__)).push({func:ct,args:arguments,thisArg:b}),Lt.__chain__=kt,Lt}return ct.apply(b,ch([this.value()],arguments))})}),b}function co(){}var Oo=G0(Ss),Qo=G0(oE),bf=G0(My);function Ef(b){return qy(b)?g0(Du(b)):function(w){return function(F){return js(F,w)}}(b)}var Pp=Co(),Gs=Co(!0);function bd(){return[]}function xh(){return!1}var Uu=jy(function(b,w){return b+w},0),Cl=q0("ceil"),Q0=jy(function(b,w){return b/w},1),Zy=q0("floor"),ev,Wi=jy(function(b,w){return b*w},1),tv=q0("round"),wh=jy(function(b,w){return b-w},0);return ge.after=function(b,w){if(typeof w!="function")throw new Wc(h);return b=_e(b),function(){if(--b<1)return w.apply(this,arguments)}},ge.ary=Wm,ge.assign=Kn,ge.assignIn=wn,ge.assignInWith=yr,ge.assignWith=Fr,ge.at=kr,ge.before=Ky,ge.bind=FE,ge.bindAll=Va,ge.bindKey=zE,ge.castArray=function(){if(!arguments.length)return[];var b=arguments[0];return Jn(b)?b:[b]},ge.chain=so,ge.chunk=function(b,w,F){w=(F?Wo(b,w,F):w===u)?1:Ts(_e(w),0);var Q=b==null?0:b.length;if(!Q||w<1)return[];for(var le=0,xe=0,Pe=fn(Eu(Q/w));le<Q;)Pe[xe++]=us(b,le,le+=w);return Pe},ge.compact=function(b){for(var w=-1,F=b==null?0:b.length,Q=0,le=[];++w<F;){var xe=b[w];xe&&(le[Q++]=xe)}return le},ge.concat=function(){var b=arguments.length;if(!b)return[];for(var w=fn(b-1),F=arguments[0],Q=b;Q--;)w[Q-1]=arguments[Q];return ch(Jn(F)?_c(F):[F],Ba(w,1))},ge.cond=function(b){var w=b==null?0:b.length,F=lr();return b=w?Ss(b,function(Q){if(typeof Q[1]!="function")throw new Wc(h);return[F(Q[0]),Q[1]]}):[],qr(function(Q){for(var le=-1;++le<w;){var xe=b[le];if(jo(xe[0],this,Q))return jo(xe[1],this,Q)}})},ge.conforms=function(b){return function(w){var F=Tn(w);return function(Q){return ls(Q,w,F)}}(vc(b,1))},ge.constant=Mo,ge.countBy=Eh,ge.create=function(b,w){var F=dd(b);return w==null?F:qo(F,w)},ge.curry=function b(w,F,Q){var le=io(w,8,u,u,u,u,u,F=Q?u:F);return le.placeholder=b.placeholder,le},ge.curryRight=function b(w,F,Q){var le=io(w,p,u,u,u,u,u,F=Q?u:F);return le.placeholder=b.placeholder,le},ge.debounce=HE,ge.defaults=xr,ge.defaultsDeep=_r,ge.defer=ao,ge.delay=yf,ge.difference=jm,ge.differenceBy=Ha,ge.differenceWith=Vm,ge.drop=function(b,w,F){var Q=b==null?0:b.length;return Q?us(b,(w=F||w===u?1:_e(w))<0?0:w,Q):[]},ge.dropRight=function(b,w,F){var Q=b==null?0:b.length;return Q?us(b,0,(w=Q-(w=F||w===u?1:_e(w)))<0?0:w):[]},ge.dropRightWhile=function(b,w){return b&&b.length?Au(b,lr(w,3),!0,!0):[]},ge.dropWhile=function(b,w){return b&&b.length?Au(b,lr(w,3),!0):[]},ge.fill=function(b,w,F,Q){var le=b==null?0:b.length;return le?(F&&typeof F!="number"&&Wo(b,w,F)&&(F=0,Q=le),function(xe,Pe,We,ct){var kt=xe.length;for((We=_e(We))<0&&(We=-We>kt?0:kt+We),(ct=ct===u||ct>kt?kt:_e(ct))<0&&(ct+=kt),ct=We>ct?0:lt(ct);We<ct;)xe[We++]=Pe;return xe}(b,w,F,Q)):[]},ge.filter=function(b,w){return(Jn(b)?yu:Om)(b,lr(w,3))},ge.flatMap=function(b,w){return Ba(Xy(b,w),1)},ge.flatMapDeep=function(b,w){return Ba(Xy(b,w),T)},ge.flatMapDepth=function(b,w,F){return F=F===u?1:_e(F),Ba(Xy(b,w),F)},ge.flatten=Mx,ge.flattenDeep=function(b){return b!=null&&b.length?Ba(b,T):[]},ge.flattenDepth=function(b,w){return b!=null&&b.length?Ba(b,w=w===u?1:_e(w)):[]},ge.flip=function(b){return io(b,512)},ge.flow=bc,ge.flowRight=Qc,ge.fromPairs=function(b){for(var w=-1,F=b==null?0:b.length,Q={};++w<F;){var le=b[w];Q[le[0]]=le[1]}return Q},ge.functions=function(b){return b==null?[]:Cu(b,Tn(b))},ge.functionsIn=function(b){return b==null?[]:Cu(b,$n(b))},ge.groupBy=UE,ge.initial=function(b){return b!=null&&b.length?us(b,0,-1):[]},ge.intersection=Yy,ge.intersectionBy=Yo,ge.intersectionWith=Ro,ge.invert=br,ge.invertBy=Ar,ge.invokeMap=ER,ge.iteratee=Zo,ge.keyBy=Ix,ge.keys=Tn,ge.keysIn=$n,ge.map=Xy,ge.mapKeys=function(b,w){var F={};return w=lr(w,3),wu(b,function(Q,le,xe){xu(F,w(Q,le,xe),Q)}),F},ge.mapValues=function(b,w){var F={};return w=lr(w,3),wu(b,function(Q,le,xe){xu(F,le,w(Q,le,xe))}),F},ge.matches=function(b){return P0(vc(b,1))},ge.matchesProperty=function(b,w){return ph(b,vc(w,1))},ge.memoize=Ko,ge.merge=$r,ge.mergeWith=Ji,ge.method=Th,ge.methodOf=$l,ge.mixin=Aa,ge.negate=Jo,ge.nthArg=function(b){return b=_e(b),qr(function(w){return U0(w,b)})},ge.omit=ys,ge.omitBy=function(b,w){return ds(b,Jo(lr(w)))},ge.once=function(b){return Ky(2,b)},ge.orderBy=function(b,w,F,Q){return b==null?[]:(Jn(w)||(w=w==null?[]:[w]),Jn(F=Q?u:F)||(F=F==null?[]:[F]),gf(b,w,F))},ge.over=Oo,ge.overArgs=TR,ge.overEvery=Qo,ge.overSome=bf,ge.partial=Jy,ge.partialRight=Z0,ge.partition=BE,ge.pick=Zi,ge.pickBy=ds,ge.property=Ef,ge.propertyOf=function(b){return function(w){return b==null?u:js(b,w)}},ge.pull=PE,ge.pullAll=Ox,ge.pullAllBy=function(b,w,F){return b&&b.length&&w&&w.length?B0(b,w,lr(F,2)):b},ge.pullAllWith=function(b,w,F){return b&&b.length&&w&&w.length?B0(b,w,u,F):b},ge.pullAt=yd,ge.range=Pp,ge.rangeRight=Gs,ge.rearg=ja,ge.reject=function(b,w){return(Jn(b)?yu:Om)(b,Jo(lr(w,3)))},ge.remove=function(b,w){var F=[];if(!b||!b.length)return F;var Q=-1,le=[],xe=b.length;for(w=lr(w,3);++Q<xe;){var Pe=b[Q];w(Pe,Q,b)&&(F.push(Pe),le.push(Q))}return Fy(b,le),F},ge.rest=function(b,w){if(typeof b!="function")throw new Wc(h);return qr(b,w=w===u?w:_e(w))},ge.reverse=bi,ge.sampleSize=function(b,w,F){return w=(F?Wo(b,w,F):w===u)?1:_e(w),(Jn(b)?Py:Ex)(b,w)},ge.set=function(b,w,F){return b==null?b:km(b,w,F)},ge.setWith=function(b,w,F,Q){return Q=typeof Q=="function"?Q:u,b==null?b:km(b,w,F,Q)},ge.shuffle=function(b){return(Jn(b)?A0:wp)(b)},ge.slice=function(b,w,F){var Q=b==null?0:b.length;return Q?(F&&typeof F!="number"&&Wo(b,w,F)?(w=0,F=Q):(w=w==null?0:_e(w),F=F===u?Q:_e(F)),us(b,w,F)):[]},ge.sortBy=SR,ge.sortedUniq=function(b){return b&&b.length?Rp(b):[]},ge.sortedUniqBy=function(b,w){return b&&b.length?Rp(b,lr(w,2)):[]},ge.split=function(b,w,F){return F&&typeof F!="number"&&Wo(b,w,F)&&(w=F=u),(F=F===u?A:F>>>0)?(b=It(b))&&(typeof w=="string"||w!=null&&!ie(w))&&!(w=Jc(w))&&cf(b)?ro(Xs(b),0,F):b.split(w,F):[]},ge.spread=function(b,w){if(typeof b!="function")throw new Wc(h);return w=w==null?0:Ts(_e(w),0),qr(function(F){var Q=F[w],le=ro(F,0,w);return Q&&ch(le,Q),jo(b,this,le)})},ge.tail=function(b){var w=b==null?0:b.length;return w?us(b,1,w):[]},ge.take=function(b,w,F){return b&&b.length?us(b,0,(w=F||w===u?1:_e(w))<0?0:w):[]},ge.takeRight=function(b,w,F){var Q=b==null?0:b.length;return Q?us(b,(w=Q-(w=F||w===u?1:_e(w)))<0?0:w,Q):[]},ge.takeRightWhile=function(b,w){return b&&b.length?Au(b,lr(w,3),!1,!0):[]},ge.takeWhile=function(b,w){return b&&b.length?Au(b,lr(w,3)):[]},ge.tap=function(b,w){return w(b),b},ge.throttle=function(b,w,F){var Q=!0,le=!0;if(typeof b!="function")throw new Wc(h);return M(F)&&(Q="leading"in F?!!F.leading:Q,le="trailing"in F?!!F.trailing:le),HE(b,w,{leading:Q,maxWait:w,trailing:le})},ge.thru=bh,ge.toArray=Ye,ge.toPairs=Qi,ge.toPairsIn=Ii,ge.toPath=function(b){return Jn(b)?Ss(b,Du):he(b)?[b]:_c(Wy(It(b)))},ge.toPlainObject=Kt,ge.transform=function(b,w,F){var Q=Jn(b),le=Q||_f(b)||pe(b);if(w=lr(w,4),F==null){var xe=b&&b.constructor;F=le?Q?new xe:[]:M(b)&&O(xe)?dd(wm(b)):{}}return(le?Vo:wu)(b,function(Pe,We,ct){return w(F,Pe,We,ct)}),F},ge.unary=function(b){return Wm(b,1)},ge.union=gR,ge.unionBy=vR,ge.unionWith=yR,ge.uniq=function(b){return b&&b.length?vh(b):[]},ge.uniqBy=function(b,w){return b&&b.length?vh(b,lr(w,2)):[]},ge.uniqWith=function(b,w){return w=typeof w=="function"?w:u,b&&b.length?vh(b,u,w):[]},ge.unset=function(b,w){return b==null||Ap(b,w)},ge.unzip=qm,ge.unzipWith=$m,ge.update=function(b,w,F){return b==null?b:xE(b,w,Mu(F))},ge.updateWith=function(b,w,F,Q){return Q=typeof Q=="function"?Q:u,b==null?b:xE(b,w,Mu(F),Q)},ge.values=hi,ge.valuesIn=function(b){return b==null?[]:Ms(b,$n(b))},ge.without=K0,ge.words=Gr,ge.wrap=function(b,w){return Jy(Mu(w),b)},ge.xor=_R,ge.xorBy=bR,ge.xorWith=Nx,ge.zip=Pu,ge.zipObject=function(b,w){return Mp(b||[],w||[],pf)},ge.zipObjectDeep=function(b,w){return Mp(b||[],w||[],km)},ge.zipWith=Lu,ge.entries=Qi,ge.entriesIn=Ii,ge.extend=wn,ge.extendWith=yr,Aa(ge,ge),ge.add=Uu,ge.attempt=Mi,ge.camelCase=$i,ge.capitalize=es,ge.ceil=Cl,ge.clamp=function(b,w,F){return F===u&&(F=w,w=u),F!==u&&(F=(F=wt(F))==F?F:0),w!==u&&(w=(w=wt(w))==w?w:0),pd(wt(b),w,F)},ge.clone=function(b){return vc(b,4)},ge.cloneDeep=function(b){return vc(b,5)},ge.cloneDeepWith=function(b,w){return vc(b,5,w=typeof w=="function"?w:u)},ge.cloneWith=function(b,w){return vc(b,4,w=typeof w=="function"?w:u)},ge.conformsTo=function(b,w){return w==null||ls(b,w,Tn(w))},ge.deburr=fs,ge.defaultTo=function(b,w){return b==null||b!=b?w:b},ge.divide=Q0,ge.endsWith=function(b,w,F){b=It(b),w=Jc(w);var Q=b.length,le=F=F===u?Q:pd(_e(F),0,Q);return(F-=w.length)>=0&&b.slice(F,le)==w},ge.eq=Ns,ge.escape=function(b){return(b=It(b))&&be.test(b)?b.replace(gt,v0):b},ge.escapeRegExp=function(b){return(b=It(b))&&Yt.test(b)?b.replace(Mt,"\\$&"):b},ge.every=function(b,w,F){var Q=Jn(b)?oE:vE;return F&&Wo(b,w,F)&&(w=u),Q(b,lr(w,3))},ge.find=Vs,ge.findIndex=fa,ge.findKey=function(b,w){return lE(b,lr(w,3),wu)},ge.findLast=Xo,ge.findLastIndex=_h,ge.findLastKey=function(b,w){return lE(b,lr(w,3),_E)},ge.floor=Zy,ge.forEach=LE,ge.forEachRight=J0,ge.forIn=function(b,w){return b==null?b:I0(b,lr(w,3),$n)},ge.forInRight=function(b,w){return b==null?b:yE(b,lr(w,3),$n)},ge.forOwn=function(b,w){return b&&wu(b,lr(w,3))},ge.forOwnRight=function(b,w){return b&&_E(b,lr(w,3))},ge.get=Rr,ge.gt=Sh,ge.gte=xR,ge.has=function(b,w){return b!=null&&kp(b,w,Nm)},ge.hasIn=Dr,ge.head=Gm,ge.identity=ps,ge.includes=function(b,w,F,Q){b=oo(b)?b:hi(b),F=F&&!Q?_e(F):0;var le=b.length;return F<0&&(F=Ts(le+F,0)),se(b)?F<=le&&b.indexOf(w,F)>-1:!!le&&of(b,w,F)>-1},ge.indexOf=function(b,w,F){var Q=b==null?0:b.length;if(!Q)return-1;var le=F==null?0:_e(F);return le<0&&(le=Ts(Q+le,0)),of(b,w,le)},ge.inRange=function(b,w,F){return w=Oe(w),F===u?(F=w,w=0):F=Oe(F),function(Q,le,xe){return Q>=Ks(le,xe)&&Q<Ts(le,xe)}(b=wt(b),w,F)},ge.invoke=ur,ge.isArguments=Hi,ge.isArray=Jn,ge.isArrayBuffer=kx,ge.isArrayLike=oo,ge.isArrayLikeObject=Is,ge.isBoolean=function(b){return b===!0||b===!1||P(b)&&da(b)==U},ge.isBuffer=_f,ge.isDate=Ym,ge.isElement=function(b){return P(b)&&b.nodeType===1&&!te(b)},ge.isEmpty=function(b){if(b==null)return!0;if(oo(b)&&(Jn(b)||typeof b=="string"||typeof b.splice=="function"||_f(b)||pe(b)||Hi(b)))return!b.length;var w=Fa(b);if(w==re||w==oe)return!b.size;if(W0(b))return!EE(b).length;for(var F in b)if(Ai.call(b,F))return!1;return!0},ge.isEqual=function(b,w){return oi(b,w)},ge.isEqualWith=function(b,w,F){var Q=(F=typeof F=="function"?F:u)?F(b,w):u;return Q===u?oi(b,w,u,F):!!Q},ge.isError=jE,ge.isFinite=function(b){return typeof b=="number"&&xa(b)},ge.isFunction=O,ge.isInteger=S,ge.isLength=R,ge.isMap=B,ge.isMatch=function(b,w){return b===w||D0(b,w,tr(w))},ge.isMatchWith=function(b,w,F){return F=typeof F=="function"?F:u,D0(b,w,tr(w),F)},ge.isNaN=function(b){return H(b)&&b!=+b},ge.isNative=function(b){if(mR(b))throw new jr("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return _x(b)},ge.isNil=function(b){return b==null},ge.isNull=function(b){return b===null},ge.isNumber=H,ge.isObject=M,ge.isObjectLike=P,ge.isPlainObject=te,ge.isRegExp=ie,ge.isSafeInteger=function(b){return S(b)&&b>=-9007199254740991&&b<=x},ge.isSet=K,ge.isString=se,ge.isSymbol=he,ge.isTypedArray=pe,ge.isUndefined=function(b){return b===u},ge.isWeakMap=function(b){return P(b)&&Fa(b)==He},ge.isWeakSet=function(b){return P(b)&&da(b)=="[object WeakSet]"},ge.join=function(b,w){return b==null?"":mE.call(b,w)},ge.kebabCase=Js,ge.last=Ao,ge.lastIndexOf=function(b,w,F){var Q=b==null?0:b.length;if(!Q)return-1;var le=Q;return F!==u&&(le=(le=_e(F))<0?Ts(Q+le,0):Ks(le,Q-1)),w==w?function(xe,Pe,We){for(var ct=We+1;ct--;)if(xe[ct]===Pe)return ct;return ct}(b,w,le):af(b,uE,le,!0)},ge.lowerCase=pa,ge.lowerFirst=_s,ge.lt=Ne,ge.lte=Je,ge.max=function(b){return b&&b.length?Mm(b,ps,zi):u},ge.maxBy=function(b,w){return b&&b.length?Mm(b,lr(w,2),zi):u},ge.mean=function(b){return hE(b,ps)},ge.meanBy=function(b,w){return hE(b,lr(w,2))},ge.min=function(b){return b&&b.length?Mm(b,ps,By):u},ge.minBy=function(b,w){return b&&b.length?Mm(b,lr(w,2),By):u},ge.stubArray=bd,ge.stubFalse=xh,ge.stubObject=function(){return{}},ge.stubString=function(){return""},ge.stubTrue=function(){return!0},ge.multiply=Wi,ge.nth=function(b,w){return b&&b.length?U0(b,_e(w)):u},ge.noConflict=function(){return bn._===this&&(bn._=ky),this},ge.noop=co,ge.now=Ca,ge.pad=function(b,w,F){b=It(b);var Q=(w=_e(w))?Ta(b):0;if(!w||Q>=w)return b;var le=(w-Q)/2;return ql(Xc(le),F)+b+ql(Eu(le),F)},ge.padEnd=function(b,w,F){b=It(b);var Q=(w=_e(w))?Ta(b):0;return w&&Q<w?b+ql(w-Q,F):b},ge.padStart=function(b,w,F){b=It(b);var Q=(w=_e(w))?Ta(b):0;return w&&Q<w?ql(w-Q,F)+b:b},ge.parseInt=function(b,w,F){return F||w==null?w=0:w&&(w=+w),pc(It(b).replace(ce,""),w||0)},ge.random=function(b,w,F){if(F&&typeof F!="boolean"&&Wo(b,w,F)&&(w=F=u),F===u&&(typeof w=="boolean"?(F=w,w=u):typeof b=="boolean"&&(F=b,b=u)),b===u&&w===u?(b=0,w=1):(b=Oe(b),w===u?(w=b,b=0):w=Oe(w)),b>w){var Q=b;b=w,w=Q}if(F||b%1||w%1){var le=To();return Ks(b+le*(w-b+zl("1e-"+((le+"").length-1))),w)}return TE(b,w)},ge.reduce=function(b,w,F){var Q=Jn(b)?Ay:dE,le=arguments.length<3;return Q(b,lr(w,4),F,le,El)},ge.reduceRight=function(b,w,F){var Q=Jn(b)?cE:dE,le=arguments.length<3;return Q(b,lr(w,4),F,le,N0)},ge.repeat=function(b,w,F){return w=(F?Wo(b,w,F):w===u)?1:_e(w),zy(It(b),w)},ge.replace=function(){var b=arguments,w=It(b[0]);return b.length<3?w:w.replace(b[1],b[2])},ge.result=function(b,w,F){var Q=-1,le=(w=yh(w,b)).length;for(le||(le=1,b=u);++Q<le;){var xe=b==null?u:b[Du(w[Q])];xe===u&&(Q=le,xe=F),b=O(xe)?xe.call(b):xe}return b},ge.round=tv,ge.runInContext=ft,ge.sample=function(b){return(Jn(b)?Vl:F0)(b)},ge.size=function(b){if(b==null)return 0;if(oo(b))return se(b)?Ta(b):b.length;var w=Fa(b);return w==re||w==oe?b.size:EE(b).length},ge.snakeCase=ks,ge.some=function(b,w,F){var Q=Jn(b)?My:mh;return F&&Wo(b,w,F)&&(w=u),Q(b,lr(w,3))},ge.sortedIndex=function(b,w){return Cp(b,w)},ge.sortedIndexBy=function(b,w,F){return Dm(b,w,lr(F,2))},ge.sortedIndexOf=function(b,w){var F=b==null?0:b.length;if(F){var Q=Cp(b,w);if(Q<F&&Ns(b[Q],w))return Q}return-1},ge.sortedLastIndex=function(b,w){return Cp(b,w,!0)},ge.sortedLastIndexBy=function(b,w,F){return Dm(b,w,lr(F,2),!0)},ge.sortedLastIndexOf=function(b,w){if(b!=null&&b.length){var F=Cp(b,w,!0)-1;if(Ns(b[F],w))return F}return-1},ge.startCase=di,ge.startsWith=function(b,w,F){return b=It(b),F=F==null?0:pd(_e(F),0,b.length),w=Jc(w),b.slice(F,F+w.length)==w},ge.subtract=wh,ge.sum=function(b){return b&&b.length?lh(b,ps):0},ge.sumBy=function(b,w){return b&&b.length?lh(b,lr(w,2)):0},ge.template=function(b,w,F){var Q=ge.templateSettings;F&&Wo(b,w,F)&&(w=u),b=It(b),w=yr({},w,Q,Iu);var le,xe,Pe=yr({},w.imports,Q.imports,Iu),We=Tn(Pe),ct=Ms(Pe,We),kt=0,Lt=w.interpolate||ot,Wt="__p += '",An=Hl((w.escape||ot).source+"|"+Lt.source+"|"+(Lt===nt?Vn:ot).source+"|"+(w.evaluate||ot).source+"|$","g"),Un="//# sourceURL="+(Ai.call(w,"sourceURL")?(w.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Xn+"]")+`
`;b.replace(An,function(Zt,mr,Gt,Mn,on,In){return Gt||(Gt=Mn),Wt+=b.slice(kt,In).replace(Ct,mx),mr&&(le=!0,Wt+=`' +
__e(`+mr+`) +
'`),on&&(xe=!0,Wt+=`';
`+on+`;
__p += '`),Gt&&(Wt+=`' +
((__t = (`+Gt+`)) == null ? '' : __t) +
'`),kt=In+Zt.length,Zt}),Wt+=`';
`;var nr=Ai.call(w,"variable")&&w.variable;if(nr){if(mt.test(nr))throw new jr("Invalid `variable` option passed into `_.template`")}else Wt=`with (obj) {
`+Wt+`
}
`;Wt=(xe?Wt.replace(Fe,""):Wt).replace(Ie,"$1").replace(rt,"$1;"),Wt="function("+(nr||"obj")+`) {
`+(nr?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(le?", __e = _.escape":"")+(xe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Wt+`return __p
}`;var Ut=Mi(function(){return la(We,Un+"return "+Wt).apply(u,ct)});if(Ut.source=Wt,jE(Ut))throw Ut;return Ut},ge.times=function(b,w){if((b=_e(b))<1||b>x)return[];var F=A,Q=Ks(b,A);w=lr(w),b-=A;for(var le=Em(Q,w);++F<b;)w(F);return le},ge.toFinite=Oe,ge.toInteger=_e,ge.toLength=lt,ge.toLower=function(b){return It(b).toLowerCase()},ge.toNumber=wt,ge.toSafeInteger=function(b){return b?pd(_e(b),-9007199254740991,x):b===0?b:0},ge.toString=It,ge.toUpper=function(b){return It(b).toUpperCase()},ge.trim=function(b,w,F){if((b=It(b))&&(F||w===u))return fE(b);if(!b||!(w=Jc(w)))return b;var Q=Xs(b),le=Xs(w);return ro(Q,fx(Q,le),ca(Q,le)+1).join("")},ge.trimEnd=function(b,w,F){if((b=It(b))&&(F||w===u))return b.slice(0,y0(b)+1);if(!b||!(w=Jc(w)))return b;var Q=Xs(b);return ro(Q,0,ca(Q,Xs(w))+1).join("")},ge.trimStart=function(b,w,F){if((b=It(b))&&(F||w===u))return b.replace(ce,"");if(!b||!(w=Jc(w)))return b;var Q=Xs(b);return ro(Q,fx(Q,Xs(w))).join("")},ge.truncate=function(b,w){var F=30,Q="...";if(M(w)){var le="separator"in w?w.separator:le;F="length"in w?_e(w.length):F,Q="omission"in w?Jc(w.omission):Q}var xe=(b=It(b)).length;if(cf(b)){var Pe=Xs(b);xe=Pe.length}if(F>=xe)return b;var We=F-Ta(Q);if(We<1)return Q;var ct=Pe?ro(Pe,0,We).join(""):b.slice(0,We);if(le===u)return ct+Q;if(Pe&&(We+=ct.length-We),ie(le)){if(b.slice(We).search(le)){var kt,Lt=ct;for(le.global||(le=Hl(le.source,It(qe.exec(le))+"g")),le.lastIndex=0;kt=le.exec(Lt);)var Wt=kt.index;ct=ct.slice(0,Wt===u?We:Wt)}}else if(b.indexOf(Jc(le),We)!=We){var An=ct.lastIndexOf(le);An>-1&&(ct=ct.slice(0,An))}return ct+Q},ge.unescape=function(b){return(b=It(b))&&bt.test(b)?b.replace(dt,ld):b},ge.uniqueId=function(b){var w=++b0;return It(b)+w},ge.upperCase=Ra,ge.upperFirst=Zn,ge.each=LE,ge.eachRight=J0,ge.first=Gm,Aa(ge,(ev={},wu(ge,function(b,w){Ai.call(ge.prototype,w)||(ev[w]=b)}),ev),{chain:!1}),ge.VERSION="4.17.21",Vo(["bind","bindKey","curry","curryRight","partial","partialRight"],function(b){ge[b].placeholder=ge}),Vo(["drop","take"],function(b,w){Br.prototype[b]=function(F){F=F===u?1:Ts(_e(F),0);var Q=this.__filtered__&&!w?new Br(this):this.clone();return Q.__filtered__?Q.__takeCount__=Ks(F,Q.__takeCount__):Q.__views__.push({size:Ks(F,A),type:b+(Q.__dir__<0?"Right":"")}),Q},Br.prototype[b+"Right"]=function(F){return this.reverse()[b](F).reverse()}}),Vo(["filter","map","takeWhile"],function(b,w){var F=w+1,Q=F==1||F==3;Br.prototype[b]=function(le){var xe=this.clone();return xe.__iteratees__.push({iteratee:lr(le,3),type:F}),xe.__filtered__=xe.__filtered__||Q,xe}}),Vo(["head","last"],function(b,w){var F="take"+(w?"Right":"");Br.prototype[b]=function(){return this[F](1).value()[0]}}),Vo(["initial","tail"],function(b,w){var F="drop"+(w?"":"Right");Br.prototype[b]=function(){return this.__filtered__?new Br(this):this[F](1)}}),Br.prototype.compact=function(){return this.filter(ps)},Br.prototype.find=function(b){return this.filter(b).head()},Br.prototype.findLast=function(b){return this.reverse().find(b)},Br.prototype.invokeMap=qr(function(b,w){return typeof b=="function"?new Br(this):this.map(function(F){return yc(F,b,w)})}),Br.prototype.reject=function(b){return this.filter(Jo(lr(b)))},Br.prototype.slice=function(b,w){b=_e(b);var F=this;return F.__filtered__&&(b>0||w<0)?new Br(F):(b<0?F=F.takeRight(-b):b&&(F=F.drop(b)),w!==u&&(F=(w=_e(w))<0?F.dropRight(-w):F.take(w-b)),F)},Br.prototype.takeRightWhile=function(b){return this.reverse().takeWhile(b).reverse()},Br.prototype.toArray=function(){return this.take(A)},wu(Br.prototype,function(b,w){var F=/^(?:filter|find|map|reject)|While$/.test(w),Q=/^(?:head|last)$/.test(w),le=ge[Q?"take"+(w=="last"?"Right":""):w],xe=Q||/^find/.test(w);le&&(ge.prototype[w]=function(){var Pe=this.__wrapped__,We=Q?[1]:arguments,ct=Pe instanceof Br,kt=We[0],Lt=ct||Jn(Pe),Wt=function(mr){var Gt=le.apply(ge,ch([mr],We));return Q&&An?Gt[0]:Gt};Lt&&F&&typeof kt=="function"&&kt.length!=1&&(ct=Lt=!1);var An=this.__chain__,Un=!!this.__actions__.length,nr=xe&&!An,Ut=ct&&!Un;if(!xe&&Lt){Pe=Ut?Pe:new Br(this);var Zt=b.apply(Pe,We);return Zt.__actions__.push({func:bh,args:[Wt],thisArg:u}),new no(Zt,An)}return nr&&Ut?b.apply(this,We):(Zt=this.thru(Wt),nr?Q?Zt.value()[0]:Zt.value():Zt)})}),Vo(["pop","push","shift","sort","splice","unshift"],function(b){var w=xm[b],F=/^(?:push|sort|unshift)$/.test(b)?"tap":"thru",Q=/^(?:pop|shift)$/.test(b);ge.prototype[b]=function(){var le=arguments;if(Q&&!this.__chain__){var xe=this.value();return w.apply(Jn(xe)?xe:[],le)}return this[F](function(Pe){return w.apply(Jn(Pe)?Pe:[],le)})}}),wu(Br.prototype,function(b,w){var F=ge[w];if(F){var Q=F.name+"";Ai.call(ha,Q)||(ha[Q]=[]),ha[Q].push({name:w,func:F})}}),ha[V0(u,2).name]=[{name:"wrapper",func:u}],Br.prototype.clone=function(){var b=new Br(this.__wrapped__);return b.__actions__=_c(this.__actions__),b.__dir__=this.__dir__,b.__filtered__=this.__filtered__,b.__iteratees__=_c(this.__iteratees__),b.__takeCount__=this.__takeCount__,b.__views__=_c(this.__views__),b},Br.prototype.reverse=function(){if(this.__filtered__){var b=new Br(this);b.__dir__=-1,b.__filtered__=!0}else(b=this.clone()).__dir__*=-1;return b},Br.prototype.value=function(){var b=this.__wrapped__.value(),w=this.__dir__,F=Jn(b),Q=w<0,le=F?b.length:0,xe=function(In,ln,Fn){for(var xs=-1,Ds=Fn.length;++xs<Ds;){var Ec=Fn[xs],ki=Ec.size;switch(Ec.type){case"drop":In+=ki;break;case"dropRight":ln-=ki;break;case"take":ln=Ks(ln,In+ki);break;case"takeRight":In=Ts(In,ln-ki)}}return{start:In,end:ln}}(0,le,this.__views__),Pe=xe.start,We=xe.end,ct=We-Pe,kt=Q?We:Pe-1,Lt=this.__iteratees__,Wt=Lt.length,An=0,Un=Ks(ct,this.__takeCount__);if(!F||!Q&&le==ct&&Un==ct)return Pm(b,this.__actions__);var nr=[];e:for(;ct--&&An<Un;){for(var Ut=-1,Zt=b[kt+=w];++Ut<Wt;){var mr=Lt[Ut],Gt=mr.iteratee,Mn=mr.type,on=Gt(Zt);if(Mn==2)Zt=on;else if(!on){if(Mn==1)continue e;break e}}nr[An++]=Zt}return nr},ge.prototype.at=_d,ge.prototype.chain=function(){return so(this)},ge.prototype.commit=function(){return new no(this.value(),this.__chain__)},ge.prototype.next=function(){this.__values__===u&&(this.__values__=Ye(this.value()));var b=this.__index__>=this.__values__.length;return{done:b,value:b?u:this.__values__[this.__index__++]}},ge.prototype.plant=function(b){for(var w,F=this;F instanceof fh;){var Q=DE(F);Q.__index__=0,Q.__values__=u,w?le.__wrapped__=Q:w=Q;var le=Q;F=F.__wrapped__}return le.__wrapped__=b,w},ge.prototype.reverse=function(){var b=this.__wrapped__;if(b instanceof Br){var w=b;return this.__actions__.length&&(w=new Br(this)),(w=w.reverse()).__actions__.push({func:bh,args:[bi],thisArg:u}),new no(w,this.__chain__)}return this.thru(bi)},ge.prototype.toJSON=ge.prototype.valueOf=ge.prototype.value=function(){return Pm(this.__wrapped__,this.__actions__)},ge.prototype.first=ge.prototype.head,bu&&(ge.prototype[bu]=function(){return this}),ge}();bn._=Ep,(l=(function(){return Ep}).call(o,c,o,a))===u||(a.exports=l)}).call(this)},2492:(a,o,c)=>{var l=c(2980),u=c(1463)(function(h,d,f){l(h,d,f)});a.exports=u},5062:a=>{a.exports=function(){return!1}},9881:(a,o,c)=>{var l=c(8363),u=c(1704);a.exports=function(h){return l(h,u(h))}},6692:a=>{var o=a.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(o).forEach(function(c){o[c].forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})},766:(a,o,c)=>{var l=c(962),u=c(8627);o.cW=u,o.Qc=l.parse,o.rz=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},962:(a,o,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,g,_){var v=p.name&&p.names;p.push&&!g[p.push]?g[p.push]=[]:v&&!g[p.name]&&(g[p.name]={});var E=p.push?{}:v?g[p.name]:g;(function(T,x,N,A){if(A&&!N)x[A]=l(T[1]);else for(var I=0;I<N.length;I+=1)T[I+1]!=null&&(x[N[I]]=l(T[I+1]))})(_.match(p.reg),E,p.names,p.name),p.push&&g[p.push].push(E)},h=c(6692),d=RegExp.prototype.test.bind(/^([a-z])=(.*)/);o.parse=function(p){var g={},_=[],v=g;return p.split(/(\r\n|\r|\n)/).filter(d).forEach(function(E){var T=E[0],x=E.slice(2);T==="m"&&(_.push({rtp:[],fmtp:[]}),v=_[_.length-1]);for(var N=0;N<(h[T]||[]).length;N+=1){var A=h[T][N];if(A.reg.test(x))return u(A,v,x)}}),g.media=_,g};var f=function(p,g){var _=g.split(/=(.+)/,2);return _.length===2?p[_[0]]=l(_[1]):_.length===1&&g.length>1&&(p[_[0]]=void 0),p};o.parseParams=function(p){return p.split(/;\s?/).reduce(f,{})},o.parseFmtpConfig=o.parseParams,o.parsePayloads=function(p){return p.toString().split(" ").map(Number)},o.parseRemoteCandidates=function(p){for(var g=[],_=p.split(" ").map(l),v=0;v<_.length;v+=3)g.push({component:_[v],ip:_[v+1],port:_[v+2]});return g},o.parseImageAttributes=function(p){return p.split(" ").map(function(g){return g.substring(1,g.length-1).split(",").reduce(f,{})})},o.parseSimulcastStreamList=function(p){return p.split(";").map(function(g){return g.split(",").map(function(_){var v,E=!1;return _[0]!=="~"?v=l(_):(v=l(_.substring(1,_.length)),E=!0),{scid:v,paused:E}})})}},8627:(a,o,c)=>{var l=c(6692),u=/%[sdv%]/g,h=function(g){var _=1,v=arguments,E=v.length;return g.replace(u,function(T){if(_>=E)return T;var x=v[_];switch(_+=1,T){case"%%":return"%";case"%s":return String(x);case"%d":return Number(x);case"%v":return""}})},d=function(g,_,v){var E=[g+"="+(_.format instanceof Function?_.format(_.push?v:v[_.name]):_.format)];if(_.names)for(var T=0;T<_.names.length;T+=1){var x=_.names[T];_.name?E.push(v[_.name][x]):E.push(v[_.names[T]])}else E.push(v[_.name]);return h.apply(null,E)},f=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];a.exports=function(g,_){_=_||{},g.version==null&&(g.version=0),g.name==null&&(g.name=" "),g.media.forEach(function(x){x.payloads==null&&(x.payloads="")});var v=_.outerOrder||f,E=_.innerOrder||p,T=[];return v.forEach(function(x){l[x].forEach(function(N){N.name in g&&g[N.name]!=null?T.push(d(x,N,g)):N.push in g&&g[N.push]!=null&&g[N.push].forEach(function(A){T.push(d(x,N,A))})})}),g.media.forEach(function(x){T.push(d("m",l.m[0],x)),E.forEach(function(N){l[N].forEach(function(A){A.name in x&&x[A.name]!=null?T.push(d(N,A,x)):A.push in x&&x[A.push]!=null&&x[A.push].forEach(function(I){T.push(d(N,A,I))})})})}),T.join(`\r
`)+`\r
`}},7539:a=>{const o={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};o.localCName=o.generateIdentifier(),o.splitLines=function(c){return c.trim().split(`
`).map(l=>l.trim())},o.splitSections=function(c){return c.split(`
m=`).map((l,u)=>(u>0?"m="+l:l).trim()+`\r
`)},o.getDescription=function(c){const l=o.splitSections(c);return l&&l[0]},o.getMediaSections=function(c){const l=o.splitSections(c);return l.shift(),l},o.matchPrefix=function(c,l){return o.splitLines(c).filter(u=>u.indexOf(l)===0)},o.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},o.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},o.parseIceOptions=function(c){return c.substring(14).split(" ")},o.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},o.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},o.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},o.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},o.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let d=0;d<h.length;d++)u=h[d].trim().split("="),l[u[0].trim()]=u[1];return l},o.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach(d=>{c.parameters[d]!==void 0?h.push(d+"="+c.parameters[d]):h.push(d)}),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},o.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},o.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),l},o.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},o.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(u=>parseInt(u,10))}},o.getMid=function(c){const l=o.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},o.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},o.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:o.matchPrefix(c+l,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach(h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),u},o.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},o.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?o.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},o.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},o.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},o.getCryptoParameters=function(c,l){return o.matchPrefix(c+l,"a=crypto:").map(o.parseCryptoLine)},o.getIceParameters=function(c,l){const u=o.matchPrefix(c+l,"a=ice-ufrag:")[0],h=o.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},o.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},o.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=o.splitLines(c)[0].split(" ");l.profile=u[2];for(let d=3;d<u.length;d++){const f=u[d],p=o.matchPrefix(c,"a=rtpmap:"+f+" ")[0];if(p){const g=o.parseRtpMap(p),_=o.matchPrefix(c,"a=fmtp:"+f+" ");switch(g.parameters=_.length?o.parseFmtp(_[0]):{},g.rtcpFeedback=o.matchPrefix(c,"a=rtcp-fb:"+f+" ").map(o.parseRtcpFb),l.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(g.name.toUpperCase())}}}o.matchPrefix(c,"a=extmap:").forEach(d=>{l.headerExtensions.push(o.parseExtmap(d))});const h=o.matchPrefix(c,"a=rtcp-fb:* ").map(o.parseRtcpFb);return l.codecs.forEach(d=>{h.forEach(f=>{d.rtcpFeedback.find(p=>p.type===f.type&&p.parameter===f.parameter)||d.rtcpFeedback.push(f)})}),l},o.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(d=>{u+=o.writeRtpMap(d),u+=o.writeFmtp(d),u+=o.writeRtcpFb(d)});let h=0;return l.codecs.forEach(d=>{d.maxptime>h&&(h=d.maxptime)}),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach(d=>{u+=o.writeExtmap(d)}),u},o.parseRtpEncodingParameters=function(c){const l=[],u=o.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,d=u.fecMechanisms.indexOf("ULPFEC")!==-1,f=o.matchPrefix(c,"a=ssrc:").map(E=>o.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),p=f.length>0&&f[0].ssrc;let g;const _=o.matchPrefix(c,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(T=>parseInt(T,10)));_.length>0&&_[0].length>1&&_[0][0]===p&&(g=_[0][1]),u.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let T={ssrc:p,codecPayloadType:parseInt(E.parameters.apt,10)};p&&g&&(T.rtx={ssrc:g}),l.push(T),h&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},l.push(T))}}),l.length===0&&p&&l.push({ssrc:p});let v=o.matchPrefix(c,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,l.forEach(E=>{E.maxBitrate=v})),l},o.parseRtcpParameters=function(c){const l={},u=o.matchPrefix(c,"a=ssrc:").map(f=>o.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=o.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const d=o.matchPrefix(c,"a=rtcp-mux");return l.mux=d.length>0,l},o.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},o.parseMsid=function(c){let l;const u=o.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=o.matchPrefix(c,"a=ssrc:").map(d=>o.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},o.parseSctpDescription=function(c){const l=o.parseMLine(c),u=o.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const d=o.matchPrefix(c,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const f=o.matchPrefix(c,"a=sctpmap:");if(f.length>0){const p=f[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:h}}},o.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},o.generateSessionId=function(){return Math.random().toString().substr(2,22)},o.writeSessionBoilerplate=function(c,l,u){let h;const d=l!==void 0?l:2;return h=c||o.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},o.getDirection=function(c,l){const u=o.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?o.getDirection(l):"sendrecv"},o.getKind=function(c){return o.splitLines(c)[0].split(" ")[0].substring(2)},o.isRejected=function(c){return c.split(" ",2)[1]==="0"},o.parseMLine=function(c){const l=o.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},o.parseOLine=function(c){const l=o.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},o.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=o.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},a.exports=o},477:a=>{a.exports=function(o,c,l,u){var h=self||window;try{try{var d;try{d=new h.Blob([o])}catch{(d=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(o),d=d.getBlob()}var f=h.URL||h.webkitURL,p=f.createObjectURL(d),g=new h[c](p,l);return f.revokeObjectURL(p),g}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(o)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8520:(a,o,c)=>{var l;(function(u){(function(h){var d=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:function(){try{return Function("return this;")()}catch{}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch{}}(),f=p(u);function p(g,_){return function(v,E){Object.defineProperty(g,v,{configurable:!0,writable:!0,value:E}),_&&_(v,E)}}d.Reflect!==void 0&&(f=p(d.Reflect,f)),function(g,_){var v=Object.prototype.hasOwnProperty,E=typeof Symbol=="function",T=E&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",x=E&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",N=typeof Object.create=="function",A={__proto__:[]}instanceof Array,I=!N&&!A,k={create:N?function(){return an(Object.create(null))}:A?function(){return an({__proto__:null})}:function(){return an({})},has:I?function(Ve,ot){return v.call(Ve,ot)}:function(Ve,ot){return ot in Ve},get:I?function(Ve,ot){return v.call(Ve,ot)?Ve[ot]:void 0}:function(Ve,ot){return Ve[ot]}},L=Object.getPrototypeOf(Function),U=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ht(),$=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pt(),q=typeof WeakMap=="function"?WeakMap:hn(),G=E?Symbol.for("@reflect-metadata:registry"):void 0,X=xt(),re=Vn(X);function V(Ve,ot,Ct,Nt){if(Ie(Ct)){if(!$e(Ve))throw new TypeError;if(!qt(ot))throw new TypeError;return we(Ve,ot)}if(!$e(Ve))throw new TypeError;if(!gt(ot))throw new TypeError;if(!gt(Nt)&&!Ie(Nt)&&!rt(Nt))throw new TypeError;return rt(Nt)&&(Nt=void 0),Ce(Ve,ot,Ct=nt(Ct),Nt)}function Z(Ve,ot){function Ct(Nt,Yn){if(!gt(Nt))throw new TypeError;if(!Ie(Yn)&&!Mt(Yn))throw new TypeError;ye(Ve,ot,Nt,Yn)}return Ct}function Y(Ve,ot,Ct,Nt){if(!gt(Ct))throw new TypeError;return Ie(Nt)||(Nt=nt(Nt)),ye(Ve,ot,Ct,Nt)}function ee(Ve,ot,Ct){if(!gt(ot))throw new TypeError;return Ie(Ct)||(Ct=nt(Ct)),ke(Ve,ot,Ct)}function oe(Ve,ot,Ct){if(!gt(ot))throw new TypeError;return Ie(Ct)||(Ct=nt(Ct)),St(Ve,ot,Ct)}function de(Ve,ot,Ct){if(!gt(ot))throw new TypeError;return Ie(Ct)||(Ct=nt(Ct)),At(Ve,ot,Ct)}function Me(Ve,ot,Ct){if(!gt(ot))throw new TypeError;return Ie(Ct)||(Ct=nt(Ct)),Ee(Ve,ot,Ct)}function He(Ve,ot){if(!gt(Ve))throw new TypeError;return Ie(ot)||(ot=nt(ot)),et(Ve,ot)}function Te(Ve,ot){if(!gt(Ve))throw new TypeError;return Ie(ot)||(ot=nt(ot)),fe(Ve,ot)}function Le(Ve,ot,Ct){if(!gt(ot))throw new TypeError;if(Ie(Ct)||(Ct=nt(Ct)),!gt(ot))throw new TypeError;Ie(Ct)||(Ct=nt(Ct));var Nt=Vt(ot,Ct,!1);return!Ie(Nt)&&Nt.OrdinaryDeleteMetadata(Ve,ot,Ct)}function we(Ve,ot){for(var Ct=Ve.length-1;Ct>=0;--Ct){var Nt=(0,Ve[Ct])(ot);if(!Ie(Nt)&&!rt(Nt)){if(!qt(Nt))throw new TypeError;ot=Nt}}return ot}function Ce(Ve,ot,Ct,Nt){for(var Yn=Ve.length-1;Yn>=0;--Yn){var si=(0,Ve[Yn])(ot,Ct,Nt);if(!Ie(si)&&!rt(si)){if(!gt(si))throw new TypeError;Nt=si}}return Nt}function ke(Ve,ot,Ct){if(St(Ve,ot,Ct))return!0;var Nt=je(ot);return!rt(Nt)&&ke(Ve,Nt,Ct)}function St(Ve,ot,Ct){var Nt=Vt(ot,Ct,!1);return!Ie(Nt)&&ue(Nt.OrdinaryHasOwnMetadata(Ve,ot,Ct))}function At(Ve,ot,Ct){if(St(Ve,ot,Ct))return Ee(Ve,ot,Ct);var Nt=je(ot);return rt(Nt)?void 0:At(Ve,Nt,Ct)}function Ee(Ve,ot,Ct){var Nt=Vt(ot,Ct,!1);if(!Ie(Nt))return Nt.OrdinaryGetOwnMetadata(Ve,ot,Ct)}function ye(Ve,ot,Ct,Nt){Vt(Ct,Nt,!0).OrdinaryDefineOwnMetadata(Ve,ot,Ct,Nt)}function et(Ve,ot){var Ct=fe(Ve,ot),Nt=je(Ve);if(Nt===null)return Ct;var Yn=et(Nt,ot);if(Yn.length<=0)return Ct;if(Ct.length<=0)return Yn;for(var si=new $,Sr=[],sr=0,En=Ct;sr<En.length;sr++){var sn=En[sr];si.has(sn)||(si.add(sn),Sr.push(sn))}for(var Ln=0,Nn=Yn;Ln<Nn.length;Ln++)sn=Nn[Ln],si.has(sn)||(si.add(sn),Sr.push(sn));return Sr}function fe(Ve,ot){var Ct=Vt(Ve,ot,!1);return Ct?Ct.OrdinaryOwnMetadataKeys(Ve,ot):[]}function Fe(Ve){if(Ve===null)return 1;switch(typeof Ve){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ve===null?1:6;default:return 6}}function Ie(Ve){return Ve===void 0}function rt(Ve){return Ve===null}function dt(Ve){return typeof Ve=="symbol"}function gt(Ve){return typeof Ve=="object"?Ve!==null:typeof Ve=="function"}function bt(Ve,ot){switch(Fe(Ve)){case 0:case 1:case 2:case 3:case 4:case 5:return Ve}var Ct="string",Nt=ce(Ve,T);if(Nt!==void 0){var Yn=Nt.call(Ve,Ct);if(gt(Yn))throw new TypeError;return Yn}return be(Ve)}function be(Ve,ot){var Ct,Nt;{var Yn=Ve.toString;if(Ue(Yn)&&!gt(Nt=Yn.call(Ve))||Ue(Ct=Ve.valueOf)&&!gt(Nt=Ct.call(Ve)))return Nt}throw new TypeError}function ue(Ve){return!!Ve}function Xe(Ve){return""+Ve}function nt(Ve){var ot=bt(Ve);return dt(ot)?ot:Xe(ot)}function $e(Ve){return Array.isArray?Array.isArray(Ve):Ve instanceof Object?Ve instanceof Array:Object.prototype.toString.call(Ve)==="[object Array]"}function Ue(Ve){return typeof Ve=="function"}function qt(Ve){return typeof Ve=="function"}function Mt(Ve){switch(Fe(Ve)){case 3:case 4:return!0;default:return!1}}function Yt(Ve,ot){return Ve===ot||Ve!=Ve&&ot!=ot}function ce(Ve,ot){var Ct=Ve[ot];if(Ct!=null){if(!Ue(Ct))throw new TypeError;return Ct}}function j(Ve){var ot=ce(Ve,x);if(!Ue(ot))throw new TypeError;var Ct=ot.call(Ve);if(!gt(Ct))throw new TypeError;return Ct}function W(Ve){return Ve.value}function me(Ve){var ot=Ve.next();return!ot.done&&ot}function De(Ve){var ot=Ve.return;ot&&ot.call(Ve)}function je(Ve){var ot=Object.getPrototypeOf(Ve);if(typeof Ve!="function"||Ve===L||ot!==L)return ot;var Ct=Ve.prototype,Nt=Ct&&Object.getPrototypeOf(Ct);if(Nt==null||Nt===Object.prototype)return ot;var Yn=Nt.constructor;return typeof Yn!="function"||Yn===Ve?ot:Yn}function mt(){var Ve,ot,Ct,Nt;Ie(G)||_.Reflect===void 0||G in _.Reflect||typeof _.Reflect.defineMetadata!="function"||(Ve=qe(_.Reflect));var Yn=new q,si={registerProvider:Sr,getProvider:En,setProvider:Ln};return si;function Sr(Nn){if(!Object.isExtensible(si))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Ve===Nn:break;case Ie(ot):ot=Nn;break;case ot===Nn:break;case Ie(Ct):Ct=Nn;break;case Ct===Nn:break;default:Nt===void 0&&(Nt=new $),Nt.add(Nn)}}function sr(Nn,dr){if(!Ie(ot)){if(ot.isProviderFor(Nn,dr))return ot;if(!Ie(Ct)){if(Ct.isProviderFor(Nn,dr))return ot;if(!Ie(Nt))for(var ui=j(Nt);;){var er=me(ui);if(!er)return;var La=W(er);if(La.isProviderFor(Nn,dr))return De(ui),La}}}if(!Ie(Ve)&&Ve.isProviderFor(Nn,dr))return Ve}function En(Nn,dr){var ui,er=Yn.get(Nn);return Ie(er)||(ui=er.get(dr)),Ie(ui)&&(Ie(ui=sr(Nn,dr))||(Ie(er)&&(er=new U,Yn.set(Nn,er)),er.set(dr,ui))),ui}function sn(Nn){if(Ie(Nn))throw new TypeError;return ot===Nn||Ct===Nn||!Ie(Nt)&&Nt.has(Nn)}function Ln(Nn,dr,ui){if(!sn(ui))throw new Error("Metadata provider not registered.");var er=En(Nn,dr);if(er!==ui){if(!Ie(er))return!1;var La=Yn.get(Nn);Ie(La)&&(La=new U,Yn.set(Nn,La)),La.set(dr,ui)}return!0}}function xt(){var Ve;return!Ie(G)&&gt(_.Reflect)&&Object.isExtensible(_.Reflect)&&(Ve=_.Reflect[G]),Ie(Ve)&&(Ve=mt()),!Ie(G)&&gt(_.Reflect)&&Object.isExtensible(_.Reflect)&&Object.defineProperty(_.Reflect,G,{enumerable:!1,configurable:!1,writable:!1,value:Ve}),Ve}function Vn(Ve){var ot=new q,Ct={isProviderFor:function(sn,Ln){var Nn=ot.get(sn);return!Ie(Nn)&&Nn.has(Ln)},OrdinaryDefineOwnMetadata:Sr,OrdinaryHasOwnMetadata:Yn,OrdinaryGetOwnMetadata:si,OrdinaryOwnMetadataKeys:sr,OrdinaryDeleteMetadata:En};return X.registerProvider(Ct),Ct;function Nt(sn,Ln,Nn){var dr=ot.get(sn),ui=!1;if(Ie(dr)){if(!Nn)return;dr=new U,ot.set(sn,dr),ui=!0}var er=dr.get(Ln);if(Ie(er)){if(!Nn)return;if(er=new U,dr.set(Ln,er),!Ve.setProvider(sn,Ln,Ct))throw dr.delete(Ln),ui&&ot.delete(sn),new Error("Wrong provider for target.")}return er}function Yn(sn,Ln,Nn){var dr=Nt(Ln,Nn,!1);return!Ie(dr)&&ue(dr.has(sn))}function si(sn,Ln,Nn){var dr=Nt(Ln,Nn,!1);if(!Ie(dr))return dr.get(sn)}function Sr(sn,Ln,Nn,dr){Nt(Nn,dr,!0).set(sn,Ln)}function sr(sn,Ln){var Nn=[],dr=Nt(sn,Ln,!1);if(Ie(dr))return Nn;for(var ui=j(dr.keys()),er=0;;){var La=me(ui);if(!La)return Nn.length=er,Nn;var gu=W(La);try{Nn[er]=gu}catch(nf){try{De(ui)}finally{throw nf}}er++}}function En(sn,Ln,Nn){var dr=Nt(Ln,Nn,!1);if(Ie(dr)||!dr.delete(sn))return!1;if(dr.size===0){var ui=ot.get(Ln);Ie(ui)||(ui.delete(Nn),ui.size===0&&ot.delete(ui))}return!0}}function qe(Ve){var ot=Ve.defineMetadata,Ct=Ve.hasOwnMetadata,Nt=Ve.getOwnMetadata,Yn=Ve.getOwnMetadataKeys,si=Ve.deleteMetadata,Sr=new q;return{isProviderFor:function(sr,En){var sn=Sr.get(sr);return!(Ie(sn)||!sn.has(En))||!!Yn(sr,En).length&&(Ie(sn)&&(sn=new $,Sr.set(sr,sn)),sn.add(En),!0)},OrdinaryDefineOwnMetadata:ot,OrdinaryHasOwnMetadata:Ct,OrdinaryGetOwnMetadata:Nt,OrdinaryOwnMetadataKeys:Yn,OrdinaryDeleteMetadata:si}}function Vt(Ve,ot,Ct){var Nt=X.getProvider(Ve,ot);if(!Ie(Nt))return Nt;if(Ct){if(X.setProvider(Ve,ot,re))return re;throw new Error("Illegal state.")}}function ht(){var Ve={},ot=[],Ct=function(){function Sr(sr,En,sn){this._index=0,this._keys=sr,this._values=En,this._selector=sn}return Sr.prototype["@@iterator"]=function(){return this},Sr.prototype[x]=function(){return this},Sr.prototype.next=function(){var sr=this._index;if(sr>=0&&sr<this._keys.length){var En=this._selector(this._keys[sr],this._values[sr]);return sr+1>=this._keys.length?(this._index=-1,this._keys=ot,this._values=ot):this._index++,{value:En,done:!1}}return{value:void 0,done:!0}},Sr.prototype.throw=function(sr){throw this._index>=0&&(this._index=-1,this._keys=ot,this._values=ot),sr},Sr.prototype.return=function(sr){return this._index>=0&&(this._index=-1,this._keys=ot,this._values=ot),{value:sr,done:!0}},Sr}();return function(){function Sr(){this._keys=[],this._values=[],this._cacheKey=Ve,this._cacheIndex=-2}return Object.defineProperty(Sr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Sr.prototype.has=function(sr){return this._find(sr,!1)>=0},Sr.prototype.get=function(sr){var En=this._find(sr,!1);return En>=0?this._values[En]:void 0},Sr.prototype.set=function(sr,En){var sn=this._find(sr,!0);return this._values[sn]=En,this},Sr.prototype.delete=function(sr){var En=this._find(sr,!1);if(En>=0){for(var sn=this._keys.length,Ln=En+1;Ln<sn;Ln++)this._keys[Ln-1]=this._keys[Ln],this._values[Ln-1]=this._values[Ln];return this._keys.length--,this._values.length--,Yt(sr,this._cacheKey)&&(this._cacheKey=Ve,this._cacheIndex=-2),!0}return!1},Sr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ve,this._cacheIndex=-2},Sr.prototype.keys=function(){return new Ct(this._keys,this._values,Nt)},Sr.prototype.values=function(){return new Ct(this._keys,this._values,Yn)},Sr.prototype.entries=function(){return new Ct(this._keys,this._values,si)},Sr.prototype["@@iterator"]=function(){return this.entries()},Sr.prototype[x]=function(){return this.entries()},Sr.prototype._find=function(sr,En){if(!Yt(this._cacheKey,sr)){this._cacheIndex=-1;for(var sn=0;sn<this._keys.length;sn++)if(Yt(this._keys[sn],sr)){this._cacheIndex=sn;break}}return this._cacheIndex<0&&En&&(this._cacheIndex=this._keys.length,this._keys.push(sr),this._values.push(void 0)),this._cacheIndex},Sr}();function Nt(Sr,sr){return Sr}function Yn(Sr,sr){return sr}function si(Sr,sr){return[Sr,sr]}}function Pt(){return function(){function Ve(){this._map=new U}return Object.defineProperty(Ve.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ve.prototype.has=function(ot){return this._map.has(ot)},Ve.prototype.add=function(ot){return this._map.set(ot,ot),this},Ve.prototype.delete=function(ot){return this._map.delete(ot)},Ve.prototype.clear=function(){this._map.clear()},Ve.prototype.keys=function(){return this._map.keys()},Ve.prototype.values=function(){return this._map.keys()},Ve.prototype.entries=function(){return this._map.entries()},Ve.prototype["@@iterator"]=function(){return this.keys()},Ve.prototype[x]=function(){return this.keys()},Ve}()}function hn(){var Ve=16,ot=k.create(),Ct=Nt();return function(){function En(){this._key=Nt()}return En.prototype.has=function(sn){var Ln=Yn(sn,!1);return Ln!==void 0&&k.has(Ln,this._key)},En.prototype.get=function(sn){var Ln=Yn(sn,!1);return Ln!==void 0?k.get(Ln,this._key):void 0},En.prototype.set=function(sn,Ln){return Yn(sn,!0)[this._key]=Ln,this},En.prototype.delete=function(sn){var Ln=Yn(sn,!1);return Ln!==void 0&&delete Ln[this._key]},En.prototype.clear=function(){this._key=Nt()},En}();function Nt(){var En;do En="@@WeakMap@@"+sr();while(k.has(ot,En));return ot[En]=!0,En}function Yn(En,sn){if(!v.call(En,Ct)){if(!sn)return;Object.defineProperty(En,Ct,{value:k.create()})}return En[Ct]}function si(En,sn){for(var Ln=0;Ln<sn;++Ln)En[Ln]=255*Math.random()|0;return En}function Sr(En){if(typeof Uint8Array=="function"){var sn=new Uint8Array(En);return typeof crypto<"u"?crypto.getRandomValues(sn):typeof msCrypto<"u"?msCrypto.getRandomValues(sn):si(sn,En),sn}return si(new Array(En),En)}function sr(){var En=Sr(Ve);En[6]=79&En[6]|64,En[8]=191&En[8]|128;for(var sn="",Ln=0;Ln<Ve;++Ln){var Nn=En[Ln];Ln!==4&&Ln!==6&&Ln!==8||(sn+="-"),Nn<16&&(sn+="0"),sn+=Nn.toString(16).toLowerCase()}return sn}}function an(Ve){return Ve.__=void 0,delete Ve.__,Ve}g("decorate",V),g("metadata",Z),g("defineMetadata",Y),g("hasMetadata",ee),g("hasOwnMetadata",oe),g("getMetadata",de),g("getOwnMetadata",Me),g("getMetadataKeys",He),g("getOwnMetadataKeys",Te),g("deleteMetadata",Le)}(f,d),d.Reflect===void 0&&(d.Reflect=u)})()})(l||(l={}))}},r={};function i(a){var o=r[a];if(o!==void 0)return o.exports;var c=r[a]={id:a,loaded:!1,exports:{}};return n[a].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return i.d(o,{a:o}),o},i.d=(a,o)=>{for(var c in o)i.o(o,c)&&!i.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:o[c]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(a,o)=>Object.prototype.hasOwnProperty.call(a,o),i.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.nmd=a=>(a.paths=[],a.children||(a.children=[]),a);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>Tr,BASIC_FULL_HD_PORTRAIT:()=>Bn,BASIC_LANDSCAPE:()=>Kr,BASIC_PORTRAIT:()=>Xn,BroadcastClientError:()=>xt,BroadcastClientEvents:()=>Ta,ConnectionState:()=>at,Errors:()=>u,InitialLayerPreference:()=>Gl,JitterBufferMinDelay:()=>js,LOG_LEVEL:()=>W,LocalStageStream:()=>UE,LocalStageStreamEvents:()=>_d,LogLevels:()=>W,RemoteStageStream:()=>zE,RemoteStageStreamEvents:()=>so,STANDARD_LANDSCAPE:()=>Ho,STANDARD_PORTRAIT:()=>zl,Stage:()=>_f,StageConnectionState:()=>hs,StageErrorCategory:()=>yd,StageErrorCode:()=>bi,StageEvents:()=>Hi,StageLeftReason:()=>Ym,StageParticipantPublishState:()=>Vs,StageParticipantSubscribeState:()=>Xo,StageStream:()=>J0,StageStreamLayerSelectedReason:()=>bh,StreamType:()=>Xt,SubscribeType:()=>Ro,__version:()=>T0,create:()=>Fi,default:()=>jE,isSupported:()=>j});var a={};i.r(a),i.d(a,{fixNegotiationNeeded:()=>ee,shimAddTrackRemoveTrack:()=>Z,shimAddTrackRemoveTrackWithNative:()=>V,shimGetDisplayMedia:()=>U,shimGetSendersWithDtmf:()=>G,shimGetStats:()=>X,shimGetUserMedia:()=>L,shimMediaStream:()=>$,shimOnTrack:()=>q,shimPeerConnection:()=>Y,shimSenderReceiverGetStats:()=>re});var o={};i.r(o),i.d(o,{shimAddTransceiver:()=>ke,shimCreateAnswer:()=>Ee,shimCreateOffer:()=>At,shimGetDisplayMedia:()=>de,shimGetParameters:()=>St,shimGetUserMedia:()=>oe,shimOnTrack:()=>Me,shimPeerConnection:()=>He,shimRTCDataChannel:()=>Ce,shimReceiverGetStats:()=>Le,shimRemoveStream:()=>we,shimSenderGetStats:()=>Te});var c={};i.r(c),i.d(c,{shimAudioContext:()=>bt,shimCallbacksAPI:()=>fe,shimConstraints:()=>Ie,shimCreateOfferLegacy:()=>gt,shimGetUserMedia:()=>Fe,shimLocalStreamsAPI:()=>ye,shimRTCIceServerUrls:()=>rt,shimRemoteStreamsAPI:()=>et,shimTrackEventTransceiver:()=>dt});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>Mt,shimAddIceCandidateNullOrEmpty:()=>Yt,shimConnectionState:()=>qt,shimMaxMessageSize:()=>$e,shimParameterlessSetLocalDescription:()=>ce,shimRTCIceCandidate:()=>Xe,shimRTCIceCandidateRelayProtocol:()=>nt,shimSendThrowTypeError:()=>Ue});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>an,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>hn,ADD_DEVICE_CONSTRAINTS_ERROR:()=>Ct,ADD_DEVICE_DEVICE_ERROR:()=>ht,ADD_DEVICE_NAME_EXISTS_ERROR:()=>Pt,ADD_DEVICE_NAME_MISSING_ERROR:()=>Ve,ADD_DEVICE_UNSUPPORTED:()=>ot,BROADCAST_CONFIGURATION_ERROR:()=>ui,BROADCAST_ERROR:()=>Vn,CAMERA_ERROR:()=>qe,CLIENT_INVALID_ERROR:()=>d0,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>En,FAILED_TO_ADD_IMAGE_ERROR:()=>sn,INGEST_ENDPOINT_TYPE_ERROR:()=>La,INGEST_ENDPOINT_URL_ERROR:()=>gu,INPUT_ERROR:()=>Vt,INVALID_STREAM_KEY:()=>dr,LOGGER_TYPE_ERROR:()=>_p,LOG_LEVEL_TYPE_ERROR:()=>nf,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>rf,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>sf,PEER_CONNECTION_ERROR:()=>Nn,PEER_SETUP_ERROR:()=>Ln,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>Nt,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Yn,STAGE_TOKEN_TYPE_ERROR:()=>ve,STAGE_WHIP_OVERRIDE_ERROR:()=>Ke,STREAM_CONFIGURATION_ERROR:()=>er,STREAM_KEY_INVALID_CHAR_ERROR:()=>vu,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Sr,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>si,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>sr});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>Tr,BASIC_FULL_HD_PORTRAIT:()=>Bn,BASIC_LANDSCAPE:()=>Kr,BASIC_PORTRAIT:()=>Xn,BroadcastClientError:()=>xt,BroadcastClientEvents:()=>Ta,ConnectionState:()=>at,Errors:()=>u,LOG_LEVEL:()=>W,LogLevels:()=>W,STANDARD_LANDSCAPE:()=>Ho,STANDARD_PORTRAIT:()=>zl,__version:()=>T0,create:()=>Fi,isSupported:()=>j});let d=!0,f=!0;function p(O,S,R){const M=O.match(S);return M&&M.length>=R&&parseInt(M[R],10)}function g(O,S,R){if(!O.RTCPeerConnection)return;const M=O.RTCPeerConnection.prototype,P=M.addEventListener;M.addEventListener=function(H,te){if(H!==S)return P.apply(this,arguments);const ie=K=>{const se=R(K);se&&(te.handleEvent?te.handleEvent(se):te(se))};return this._eventMap=this._eventMap||{},this._eventMap[S]||(this._eventMap[S]=new Map),this._eventMap[S].set(te,ie),P.apply(this,[H,ie])};const B=M.removeEventListener;M.removeEventListener=function(H,te){if(H!==S||!this._eventMap||!this._eventMap[S])return B.apply(this,arguments);if(!this._eventMap[S].has(te))return B.apply(this,arguments);const ie=this._eventMap[S].get(te);return this._eventMap[S].delete(te),this._eventMap[S].size===0&&delete this._eventMap[S],Object.keys(this._eventMap).length===0&&delete this._eventMap,B.apply(this,[H,ie])},Object.defineProperty(M,"on"+S,{get(){return this["_on"+S]},set(H){this["_on"+S]&&(this.removeEventListener(S,this["_on"+S]),delete this["_on"+S]),H&&this.addEventListener(S,this["_on"+S]=H)},enumerable:!0,configurable:!0})}function _(O){return typeof O!="boolean"?new Error("Argument type: "+typeof O+". Please use a boolean."):(d=O,O?"adapter.js logging disabled":"adapter.js logging enabled")}function v(O){return typeof O!="boolean"?new Error("Argument type: "+typeof O+". Please use a boolean."):(f=!O,"adapter.js deprecation warnings "+(O?"disabled":"enabled"))}function E(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function T(O,S){f&&console.warn(O+" is deprecated, please use "+S+" instead.")}function x(O){return Object.prototype.toString.call(O)==="[object Object]"}function N(O){return x(O)?Object.keys(O).reduce(function(S,R){const M=x(O[R]),P=M?N(O[R]):O[R],B=M&&!Object.keys(P).length;return P===void 0||B?S:Object.assign(S,{[R]:P})},{}):O}function A(O,S,R){S&&!R.has(S.id)&&(R.set(S.id,S),Object.keys(S).forEach(M=>{M.endsWith("Id")?A(O,O.get(S[M]),R):M.endsWith("Ids")&&S[M].forEach(P=>{A(O,O.get(P),R)})}))}function I(O,S,R){const M=R?"outbound-rtp":"inbound-rtp",P=new Map;if(S===null)return P;const B=[];return O.forEach(H=>{H.type==="track"&&H.trackIdentifier===S.id&&B.push(H)}),B.forEach(H=>{O.forEach(te=>{te.type===M&&te.trackId===H.id&&A(O,te,P)})}),P}const k=E;function L(O,S){const R=O&&O.navigator;if(!R.mediaDevices)return;const M=function(H){if(typeof H!="object"||H.mandatory||H.optional)return H;const te={};return Object.keys(H).forEach(ie=>{if(ie==="require"||ie==="advanced"||ie==="mediaSource")return;const K=typeof H[ie]=="object"?H[ie]:{ideal:H[ie]};K.exact!==void 0&&typeof K.exact=="number"&&(K.min=K.max=K.exact);const se=function(he,pe){return he?he+pe.charAt(0).toUpperCase()+pe.slice(1):pe==="deviceId"?"sourceId":pe};if(K.ideal!==void 0){te.optional=te.optional||[];let he={};typeof K.ideal=="number"?(he[se("min",ie)]=K.ideal,te.optional.push(he),he={},he[se("max",ie)]=K.ideal,te.optional.push(he)):(he[se("",ie)]=K.ideal,te.optional.push(he))}K.exact!==void 0&&typeof K.exact!="number"?(te.mandatory=te.mandatory||{},te.mandatory[se("",ie)]=K.exact):["min","max"].forEach(he=>{K[he]!==void 0&&(te.mandatory=te.mandatory||{},te.mandatory[se(he,ie)]=K[he])})}),H.advanced&&(te.optional=(te.optional||[]).concat(H.advanced)),te},P=function(H,te){if(S.version>=61)return te(H);if((H=JSON.parse(JSON.stringify(H)))&&typeof H.audio=="object"){const ie=function(K,se,he){se in K&&!(he in K)&&(K[he]=K[se],delete K[se])};ie((H=JSON.parse(JSON.stringify(H))).audio,"autoGainControl","googAutoGainControl"),ie(H.audio,"noiseSuppression","googNoiseSuppression"),H.audio=M(H.audio)}if(H&&typeof H.video=="object"){let ie=H.video.facingMode;ie=ie&&(typeof ie=="object"?ie:{ideal:ie});const K=S.version<66;if(ie&&(ie.exact==="user"||ie.exact==="environment"||ie.ideal==="user"||ie.ideal==="environment")&&(!R.mediaDevices.getSupportedConstraints||!R.mediaDevices.getSupportedConstraints().facingMode||K)){let se;if(delete H.video.facingMode,ie.exact==="environment"||ie.ideal==="environment"?se=["back","rear"]:ie.exact!=="user"&&ie.ideal!=="user"||(se=["front"]),se)return R.mediaDevices.enumerateDevices().then(he=>{let pe=(he=he.filter(Ne=>Ne.kind==="videoinput")).find(Ne=>se.some(Je=>Ne.label.toLowerCase().includes(Je)));return!pe&&he.length&&se.includes("back")&&(pe=he[he.length-1]),pe&&(H.video.deviceId=ie.exact?{exact:pe.deviceId}:{ideal:pe.deviceId}),H.video=M(H.video),k("chrome: "+JSON.stringify(H)),te(H)})}H.video=M(H.video)}return k("chrome: "+JSON.stringify(H)),te(H)},B=function(H){return S.version>=64?H:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[H.name]||H.name,message:H.message,constraint:H.constraint||H.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(R.getUserMedia=(function(H,te,ie){P(H,K=>{R.webkitGetUserMedia(K,te,se=>{ie&&ie(B(se))})})}).bind(R),R.mediaDevices.getUserMedia){const H=R.mediaDevices.getUserMedia.bind(R.mediaDevices);R.mediaDevices.getUserMedia=function(te){return P(te,ie=>H(ie).then(K=>{if(ie.audio&&!K.getAudioTracks().length||ie.video&&!K.getVideoTracks().length)throw K.getTracks().forEach(se=>{se.stop()}),new DOMException("","NotFoundError");return K},K=>Promise.reject(B(K))))}}}function U(O,S){O.navigator.mediaDevices&&"getDisplayMedia"in O.navigator.mediaDevices||O.navigator.mediaDevices&&(typeof S=="function"?O.navigator.mediaDevices.getDisplayMedia=function(R){return S(R).then(M=>{const P=R.video&&R.video.width,B=R.video&&R.video.height,H=R.video&&R.video.frameRate;return R.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:M,maxFrameRate:H||3}},P&&(R.video.mandatory.maxWidth=P),B&&(R.video.mandatory.maxHeight=B),O.navigator.mediaDevices.getUserMedia(R)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function $(O){O.MediaStream=O.MediaStream||O.webkitMediaStream}function q(O){if(typeof O=="object"&&O.RTCPeerConnection&&!("ontrack"in O.RTCPeerConnection.prototype)){Object.defineProperty(O.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(R){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=R)},enumerable:!0,configurable:!0});const S=O.RTCPeerConnection.prototype.setRemoteDescription;O.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=R=>{R.stream.addEventListener("addtrack",M=>{let P;P=O.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(H=>H.track&&H.track.id===M.track.id):{track:M.track};const B=new Event("track");B.track=M.track,B.receiver=P,B.transceiver={receiver:P},B.streams=[R.stream],this.dispatchEvent(B)}),R.stream.getTracks().forEach(M=>{let P;P=O.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(H=>H.track&&H.track.id===M.id):{track:M};const B=new Event("track");B.track=M,B.receiver=P,B.transceiver={receiver:P},B.streams=[R.stream],this.dispatchEvent(B)})},this.addEventListener("addstream",this._ontrackpoly)),S.apply(this,arguments)}}else g(O,"track",S=>(S.transceiver||Object.defineProperty(S,"transceiver",{value:{receiver:S.receiver}}),S))}function G(O){if(typeof O=="object"&&O.RTCPeerConnection&&!("getSenders"in O.RTCPeerConnection.prototype)&&"createDTMFSender"in O.RTCPeerConnection.prototype){const S=function(P,B){return{track:B,get dtmf(){return this._dtmf===void 0&&(B.kind==="audio"?this._dtmf=P.createDTMFSender(B):this._dtmf=null),this._dtmf},_pc:P}};if(!O.RTCPeerConnection.prototype.getSenders){O.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const P=O.RTCPeerConnection.prototype.addTrack;O.RTCPeerConnection.prototype.addTrack=function(H,te){let ie=P.apply(this,arguments);return ie||(ie=S(this,H),this._senders.push(ie)),ie};const B=O.RTCPeerConnection.prototype.removeTrack;O.RTCPeerConnection.prototype.removeTrack=function(H){B.apply(this,arguments);const te=this._senders.indexOf(H);te!==-1&&this._senders.splice(te,1)}}const R=O.RTCPeerConnection.prototype.addStream;O.RTCPeerConnection.prototype.addStream=function(P){this._senders=this._senders||[],R.apply(this,[P]),P.getTracks().forEach(B=>{this._senders.push(S(this,B))})};const M=O.RTCPeerConnection.prototype.removeStream;O.RTCPeerConnection.prototype.removeStream=function(P){this._senders=this._senders||[],M.apply(this,[P]),P.getTracks().forEach(B=>{const H=this._senders.find(te=>te.track===B);H&&this._senders.splice(this._senders.indexOf(H),1)})}}else if(typeof O=="object"&&O.RTCPeerConnection&&"getSenders"in O.RTCPeerConnection.prototype&&"createDTMFSender"in O.RTCPeerConnection.prototype&&O.RTCRtpSender&&!("dtmf"in O.RTCRtpSender.prototype)){const S=O.RTCPeerConnection.prototype.getSenders;O.RTCPeerConnection.prototype.getSenders=function(){const R=S.apply(this,[]);return R.forEach(M=>M._pc=this),R},Object.defineProperty(O.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function X(O){if(!O.RTCPeerConnection)return;const S=O.RTCPeerConnection.prototype.getStats;O.RTCPeerConnection.prototype.getStats=function(){const[R,M,P]=arguments;if(arguments.length>0&&typeof R=="function")return S.apply(this,arguments);if(S.length===0&&(arguments.length===0||typeof R!="function"))return S.apply(this,[]);const B=function(te){const ie={};return te.result().forEach(K=>{const se={id:K.id,timestamp:K.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[K.type]||K.type};K.names().forEach(he=>{se[he]=K.stat(he)}),ie[se.id]=se}),ie},H=function(te){return new Map(Object.keys(te).map(ie=>[ie,te[ie]]))};if(arguments.length>=2){const te=function(ie){M(H(B(ie)))};return S.apply(this,[te,R])}return new Promise((te,ie)=>{S.apply(this,[function(K){te(H(B(K)))},ie])}).then(M,P)}}function re(O){if(!(typeof O=="object"&&O.RTCPeerConnection&&O.RTCRtpSender&&O.RTCRtpReceiver))return;if(!("getStats"in O.RTCRtpSender.prototype)){const R=O.RTCPeerConnection.prototype.getSenders;R&&(O.RTCPeerConnection.prototype.getSenders=function(){const P=R.apply(this,[]);return P.forEach(B=>B._pc=this),P});const M=O.RTCPeerConnection.prototype.addTrack;M&&(O.RTCPeerConnection.prototype.addTrack=function(){const P=M.apply(this,arguments);return P._pc=this,P}),O.RTCRtpSender.prototype.getStats=function(){const P=this;return this._pc.getStats().then(B=>I(B,P.track,!0))}}if(!("getStats"in O.RTCRtpReceiver.prototype)){const R=O.RTCPeerConnection.prototype.getReceivers;R&&(O.RTCPeerConnection.prototype.getReceivers=function(){const M=R.apply(this,[]);return M.forEach(P=>P._pc=this),M}),g(O,"track",M=>(M.receiver._pc=M.srcElement,M)),O.RTCRtpReceiver.prototype.getStats=function(){const M=this;return this._pc.getStats().then(P=>I(P,M.track,!1))}}if(!("getStats"in O.RTCRtpSender.prototype)||!("getStats"in O.RTCRtpReceiver.prototype))return;const S=O.RTCPeerConnection.prototype.getStats;O.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof O.MediaStreamTrack){const R=arguments[0];let M,P,B;return this.getSenders().forEach(H=>{H.track===R&&(M?B=!0:M=H)}),this.getReceivers().forEach(H=>(H.track===R&&(P?B=!0:P=H),H.track===R)),B||M&&P?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):M?M.getStats():P?P.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return S.apply(this,arguments)}}function V(O){O.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(B=>this._shimmedLocalStreams[B][0])};const S=O.RTCPeerConnection.prototype.addTrack;O.RTCPeerConnection.prototype.addTrack=function(B,H){if(!H)return S.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const te=S.apply(this,arguments);return this._shimmedLocalStreams[H.id]?this._shimmedLocalStreams[H.id].indexOf(te)===-1&&this._shimmedLocalStreams[H.id].push(te):this._shimmedLocalStreams[H.id]=[H,te],te};const R=O.RTCPeerConnection.prototype.addStream;O.RTCPeerConnection.prototype.addStream=function(B){this._shimmedLocalStreams=this._shimmedLocalStreams||{},B.getTracks().forEach(ie=>{if(this.getSenders().find(K=>K.track===ie))throw new DOMException("Track already exists.","InvalidAccessError")});const H=this.getSenders();R.apply(this,arguments);const te=this.getSenders().filter(ie=>H.indexOf(ie)===-1);this._shimmedLocalStreams[B.id]=[B].concat(te)};const M=O.RTCPeerConnection.prototype.removeStream;O.RTCPeerConnection.prototype.removeStream=function(B){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[B.id],M.apply(this,arguments)};const P=O.RTCPeerConnection.prototype.removeTrack;O.RTCPeerConnection.prototype.removeTrack=function(B){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},B&&Object.keys(this._shimmedLocalStreams).forEach(H=>{const te=this._shimmedLocalStreams[H].indexOf(B);te!==-1&&this._shimmedLocalStreams[H].splice(te,1),this._shimmedLocalStreams[H].length===1&&delete this._shimmedLocalStreams[H]}),P.apply(this,arguments)}}function Z(O,S){if(!O.RTCPeerConnection)return;if(O.RTCPeerConnection.prototype.addTrack&&S.version>=65)return V(O);const R=O.RTCPeerConnection.prototype.getLocalStreams;O.RTCPeerConnection.prototype.getLocalStreams=function(){const ie=R.apply(this);return this._reverseStreams=this._reverseStreams||{},ie.map(K=>this._reverseStreams[K.id])};const M=O.RTCPeerConnection.prototype.addStream;O.RTCPeerConnection.prototype.addStream=function(ie){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},ie.getTracks().forEach(K=>{if(this.getSenders().find(se=>se.track===K))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[ie.id]){const K=new O.MediaStream(ie.getTracks());this._streams[ie.id]=K,this._reverseStreams[K.id]=ie,ie=K}M.apply(this,[ie])};const P=O.RTCPeerConnection.prototype.removeStream;function B(ie,K){let se=K.sdp;return Object.keys(ie._reverseStreams||[]).forEach(he=>{const pe=ie._reverseStreams[he],Ne=ie._streams[pe.id];se=se.replace(new RegExp(Ne.id,"g"),pe.id)}),new RTCSessionDescription({type:K.type,sdp:se})}O.RTCPeerConnection.prototype.removeStream=function(ie){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},P.apply(this,[this._streams[ie.id]||ie]),delete this._reverseStreams[this._streams[ie.id]?this._streams[ie.id].id:ie.id],delete this._streams[ie.id]},O.RTCPeerConnection.prototype.addTrack=function(ie,K){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const se=[].slice.call(arguments,1);if(se.length!==1||!se[0].getTracks().find(pe=>pe===ie))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(pe=>pe.track===ie))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const he=this._streams[K.id];if(he)he.addTrack(ie),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const pe=new O.MediaStream([ie]);this._streams[K.id]=pe,this._reverseStreams[pe.id]=K,this.addStream(pe)}return this.getSenders().find(pe=>pe.track===ie)},["createOffer","createAnswer"].forEach(function(ie){const K=O.RTCPeerConnection.prototype[ie],se={[ie](){const he=arguments;return arguments.length&&typeof arguments[0]=="function"?K.apply(this,[pe=>{const Ne=B(this,pe);he[0].apply(null,[Ne])},pe=>{he[1]&&he[1].apply(null,pe)},arguments[2]]):K.apply(this,arguments).then(pe=>B(this,pe))}};O.RTCPeerConnection.prototype[ie]=se[ie]});const H=O.RTCPeerConnection.prototype.setLocalDescription;O.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(ie,K){let se=K.sdp;return Object.keys(ie._reverseStreams||[]).forEach(he=>{const pe=ie._reverseStreams[he],Ne=ie._streams[pe.id];se=se.replace(new RegExp(pe.id,"g"),Ne.id)}),new RTCSessionDescription({type:K.type,sdp:se})}(this,arguments[0]),H.apply(this,arguments)):H.apply(this,arguments)};const te=Object.getOwnPropertyDescriptor(O.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(O.RTCPeerConnection.prototype,"localDescription",{get(){const ie=te.get.apply(this);return ie.type===""?ie:B(this,ie)}}),O.RTCPeerConnection.prototype.removeTrack=function(ie){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!ie._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(ie._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let K;this._streams=this._streams||{},Object.keys(this._streams).forEach(se=>{this._streams[se].getTracks().find(he=>ie.track===he)&&(K=this._streams[se])}),K&&(K.getTracks().length===1?this.removeStream(this._reverseStreams[K.id]):K.removeTrack(ie.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Y(O,S){!O.RTCPeerConnection&&O.webkitRTCPeerConnection&&(O.RTCPeerConnection=O.webkitRTCPeerConnection),O.RTCPeerConnection&&S.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(R){const M=O.RTCPeerConnection.prototype[R],P={[R](){return arguments[0]=new(R==="addIceCandidate"?O.RTCIceCandidate:O.RTCSessionDescription)(arguments[0]),M.apply(this,arguments)}};O.RTCPeerConnection.prototype[R]=P[R]})}function ee(O,S){g(O,"negotiationneeded",R=>{const M=R.target;if(!(S.version<72||M.getConfiguration&&M.getConfiguration().sdpSemantics==="plan-b")||M.signalingState==="stable")return R})}function oe(O,S){const R=O&&O.navigator,M=O&&O.MediaStreamTrack;if(R.getUserMedia=function(P,B,H){T("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),R.mediaDevices.getUserMedia(P).then(B,H)},!(S.version>55&&"autoGainControl"in R.mediaDevices.getSupportedConstraints())){const P=function(H,te,ie){te in H&&!(ie in H)&&(H[ie]=H[te],delete H[te])},B=R.mediaDevices.getUserMedia.bind(R.mediaDevices);if(R.mediaDevices.getUserMedia=function(H){return typeof H=="object"&&typeof H.audio=="object"&&(H=JSON.parse(JSON.stringify(H)),P(H.audio,"autoGainControl","mozAutoGainControl"),P(H.audio,"noiseSuppression","mozNoiseSuppression")),B(H)},M&&M.prototype.getSettings){const H=M.prototype.getSettings;M.prototype.getSettings=function(){const te=H.apply(this,arguments);return P(te,"mozAutoGainControl","autoGainControl"),P(te,"mozNoiseSuppression","noiseSuppression"),te}}if(M&&M.prototype.applyConstraints){const H=M.prototype.applyConstraints;M.prototype.applyConstraints=function(te){return this.kind==="audio"&&typeof te=="object"&&(te=JSON.parse(JSON.stringify(te)),P(te,"autoGainControl","mozAutoGainControl"),P(te,"noiseSuppression","mozNoiseSuppression")),H.apply(this,[te])}}}}function de(O,S){O.navigator.mediaDevices&&"getDisplayMedia"in O.navigator.mediaDevices||O.navigator.mediaDevices&&(O.navigator.mediaDevices.getDisplayMedia=function(R){if(!R||!R.video){const M=new DOMException("getDisplayMedia without video constraints is undefined");return M.name="NotFoundError",M.code=8,Promise.reject(M)}return R.video===!0?R.video={mediaSource:S}:R.video.mediaSource=S,O.navigator.mediaDevices.getUserMedia(R)})}function Me(O){typeof O=="object"&&O.RTCTrackEvent&&"receiver"in O.RTCTrackEvent.prototype&&!("transceiver"in O.RTCTrackEvent.prototype)&&Object.defineProperty(O.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function He(O,S){if(typeof O!="object"||!O.RTCPeerConnection&&!O.mozRTCPeerConnection)return;!O.RTCPeerConnection&&O.mozRTCPeerConnection&&(O.RTCPeerConnection=O.mozRTCPeerConnection),S.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(P){const B=O.RTCPeerConnection.prototype[P],H={[P](){return arguments[0]=new(P==="addIceCandidate"?O.RTCIceCandidate:O.RTCSessionDescription)(arguments[0]),B.apply(this,arguments)}};O.RTCPeerConnection.prototype[P]=H[P]});const R={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},M=O.RTCPeerConnection.prototype.getStats;O.RTCPeerConnection.prototype.getStats=function(){const[P,B,H]=arguments;return M.apply(this,[P||null]).then(te=>{if(S.version<53&&!B)try{te.forEach(ie=>{ie.type=R[ie.type]||ie.type})}catch(ie){if(ie.name!=="TypeError")throw ie;te.forEach((K,se)=>{te.set(se,Object.assign({},K,{type:R[K.type]||K.type}))})}return te}).then(B,H)}}function Te(O){if(typeof O!="object"||!O.RTCPeerConnection||!O.RTCRtpSender||O.RTCRtpSender&&"getStats"in O.RTCRtpSender.prototype)return;const S=O.RTCPeerConnection.prototype.getSenders;S&&(O.RTCPeerConnection.prototype.getSenders=function(){const M=S.apply(this,[]);return M.forEach(P=>P._pc=this),M});const R=O.RTCPeerConnection.prototype.addTrack;R&&(O.RTCPeerConnection.prototype.addTrack=function(){const M=R.apply(this,arguments);return M._pc=this,M}),O.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Le(O){if(typeof O!="object"||!O.RTCPeerConnection||!O.RTCRtpSender||O.RTCRtpSender&&"getStats"in O.RTCRtpReceiver.prototype)return;const S=O.RTCPeerConnection.prototype.getReceivers;S&&(O.RTCPeerConnection.prototype.getReceivers=function(){const R=S.apply(this,[]);return R.forEach(M=>M._pc=this),R}),g(O,"track",R=>(R.receiver._pc=R.srcElement,R)),O.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function we(O){O.RTCPeerConnection&&!("removeStream"in O.RTCPeerConnection.prototype)&&(O.RTCPeerConnection.prototype.removeStream=function(S){T("removeStream","removeTrack"),this.getSenders().forEach(R=>{R.track&&S.getTracks().includes(R.track)&&this.removeTrack(R)})})}function Ce(O){O.DataChannel&&!O.RTCDataChannel&&(O.RTCDataChannel=O.DataChannel)}function ke(O){if(typeof O!="object"||!O.RTCPeerConnection)return;const S=O.RTCPeerConnection.prototype.addTransceiver;S&&(O.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let R=arguments[1]&&arguments[1].sendEncodings;R===void 0&&(R=[]),R=[...R];const M=R.length>0;M&&R.forEach(B=>{if("rid"in B&&!/^[a-z0-9]{0,16}$/i.test(B.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in B&&!(parseFloat(B.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in B&&!(parseFloat(B.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const P=S.apply(this,arguments);if(M){const{sender:B}=P,H=B.getParameters();(!("encodings"in H)||H.encodings.length===1&&Object.keys(H.encodings[0]).length===0)&&(H.encodings=R,B.sendEncodings=R,this.setParametersPromises.push(B.setParameters(H).then(()=>{delete B.sendEncodings}).catch(()=>{delete B.sendEncodings})))}return P})}function St(O){if(typeof O!="object"||!O.RTCRtpSender)return;const S=O.RTCRtpSender.prototype.getParameters;S&&(O.RTCRtpSender.prototype.getParameters=function(){const R=S.apply(this,arguments);return"encodings"in R||(R.encodings=[].concat(this.sendEncodings||[{}])),R})}function At(O){if(typeof O!="object"||!O.RTCPeerConnection)return;const S=O.RTCPeerConnection.prototype.createOffer;O.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>S.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):S.apply(this,arguments)}}function Ee(O){if(typeof O!="object"||!O.RTCPeerConnection)return;const S=O.RTCPeerConnection.prototype.createAnswer;O.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>S.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):S.apply(this,arguments)}}function ye(O){if(typeof O=="object"&&O.RTCPeerConnection){if("getLocalStreams"in O.RTCPeerConnection.prototype||(O.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in O.RTCPeerConnection.prototype)){const S=O.RTCPeerConnection.prototype.addTrack;O.RTCPeerConnection.prototype.addStream=function(R){this._localStreams||(this._localStreams=[]),this._localStreams.includes(R)||this._localStreams.push(R),R.getAudioTracks().forEach(M=>S.call(this,M,R)),R.getVideoTracks().forEach(M=>S.call(this,M,R))},O.RTCPeerConnection.prototype.addTrack=function(R,...M){return M&&M.forEach(P=>{this._localStreams?this._localStreams.includes(P)||this._localStreams.push(P):this._localStreams=[P]}),S.apply(this,arguments)}}"removeStream"in O.RTCPeerConnection.prototype||(O.RTCPeerConnection.prototype.removeStream=function(S){this._localStreams||(this._localStreams=[]);const R=this._localStreams.indexOf(S);if(R===-1)return;this._localStreams.splice(R,1);const M=S.getTracks();this.getSenders().forEach(P=>{M.includes(P.track)&&this.removeTrack(P)})})}}function et(O){if(typeof O=="object"&&O.RTCPeerConnection&&("getRemoteStreams"in O.RTCPeerConnection.prototype||(O.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in O.RTCPeerConnection.prototype))){Object.defineProperty(O.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(R){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=R),this.addEventListener("track",this._onaddstreampoly=M=>{M.streams.forEach(P=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(P))return;this._remoteStreams.push(P);const B=new Event("addstream");B.stream=P,this.dispatchEvent(B)})})}});const S=O.RTCPeerConnection.prototype.setRemoteDescription;O.RTCPeerConnection.prototype.setRemoteDescription=function(){const R=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(M){M.streams.forEach(P=>{if(R._remoteStreams||(R._remoteStreams=[]),R._remoteStreams.indexOf(P)>=0)return;R._remoteStreams.push(P);const B=new Event("addstream");B.stream=P,R.dispatchEvent(B)})}),S.apply(R,arguments)}}}function fe(O){if(typeof O!="object"||!O.RTCPeerConnection)return;const S=O.RTCPeerConnection.prototype,R=S.createOffer,M=S.createAnswer,P=S.setLocalDescription,B=S.setRemoteDescription,H=S.addIceCandidate;S.createOffer=function(ie,K){const se=arguments.length>=2?arguments[2]:arguments[0],he=R.apply(this,[se]);return K?(he.then(ie,K),Promise.resolve()):he},S.createAnswer=function(ie,K){const se=arguments.length>=2?arguments[2]:arguments[0],he=M.apply(this,[se]);return K?(he.then(ie,K),Promise.resolve()):he};let te=function(ie,K,se){const he=P.apply(this,[ie]);return se?(he.then(K,se),Promise.resolve()):he};S.setLocalDescription=te,te=function(ie,K,se){const he=B.apply(this,[ie]);return se?(he.then(K,se),Promise.resolve()):he},S.setRemoteDescription=te,te=function(ie,K,se){const he=H.apply(this,[ie]);return se?(he.then(K,se),Promise.resolve()):he},S.addIceCandidate=te}function Fe(O){const S=O&&O.navigator;if(S.mediaDevices&&S.mediaDevices.getUserMedia){const R=S.mediaDevices,M=R.getUserMedia.bind(R);S.mediaDevices.getUserMedia=P=>M(Ie(P))}!S.getUserMedia&&S.mediaDevices&&S.mediaDevices.getUserMedia&&(S.getUserMedia=(function(R,M,P){S.mediaDevices.getUserMedia(R).then(M,P)}).bind(S))}function Ie(O){return O&&O.video!==void 0?Object.assign({},O,{video:N(O.video)}):O}function rt(O){if(!O.RTCPeerConnection)return;const S=O.RTCPeerConnection;O.RTCPeerConnection=function(R,M){if(R&&R.iceServers){const P=[];for(let B=0;B<R.iceServers.length;B++){let H=R.iceServers[B];H.urls===void 0&&H.url?(T("RTCIceServer.url","RTCIceServer.urls"),H=JSON.parse(JSON.stringify(H)),H.urls=H.url,delete H.url,P.push(H)):P.push(R.iceServers[B])}R.iceServers=P}return new S(R,M)},O.RTCPeerConnection.prototype=S.prototype,"generateCertificate"in S&&Object.defineProperty(O.RTCPeerConnection,"generateCertificate",{get:()=>S.generateCertificate})}function dt(O){typeof O=="object"&&O.RTCTrackEvent&&"receiver"in O.RTCTrackEvent.prototype&&!("transceiver"in O.RTCTrackEvent.prototype)&&Object.defineProperty(O.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gt(O){const S=O.RTCPeerConnection.prototype.createOffer;O.RTCPeerConnection.prototype.createOffer=function(R){if(R){R.offerToReceiveAudio!==void 0&&(R.offerToReceiveAudio=!!R.offerToReceiveAudio);const M=this.getTransceivers().find(B=>B.receiver.track.kind==="audio");R.offerToReceiveAudio===!1&&M?M.direction==="sendrecv"?M.setDirection?M.setDirection("sendonly"):M.direction="sendonly":M.direction==="recvonly"&&(M.setDirection?M.setDirection("inactive"):M.direction="inactive"):R.offerToReceiveAudio!==!0||M||this.addTransceiver("audio",{direction:"recvonly"}),R.offerToReceiveVideo!==void 0&&(R.offerToReceiveVideo=!!R.offerToReceiveVideo);const P=this.getTransceivers().find(B=>B.receiver.track.kind==="video");R.offerToReceiveVideo===!1&&P?P.direction==="sendrecv"?P.setDirection?P.setDirection("sendonly"):P.direction="sendonly":P.direction==="recvonly"&&(P.setDirection?P.setDirection("inactive"):P.direction="inactive"):R.offerToReceiveVideo!==!0||P||this.addTransceiver("video",{direction:"recvonly"})}return S.apply(this,arguments)}}function bt(O){typeof O!="object"||O.AudioContext||(O.AudioContext=O.webkitAudioContext)}var be=i(7539),ue=i.n(be);function Xe(O){if(!O.RTCIceCandidate||O.RTCIceCandidate&&"foundation"in O.RTCIceCandidate.prototype)return;const S=O.RTCIceCandidate;O.RTCIceCandidate=function(R){if(typeof R=="object"&&R.candidate&&R.candidate.indexOf("a=")===0&&((R=JSON.parse(JSON.stringify(R))).candidate=R.candidate.substring(2)),R.candidate&&R.candidate.length){const M=new S(R),P=ue().parseCandidate(R.candidate);for(const B in P)B in M||Object.defineProperty(M,B,{value:P[B]});return M.toJSON=function(){return{candidate:M.candidate,sdpMid:M.sdpMid,sdpMLineIndex:M.sdpMLineIndex,usernameFragment:M.usernameFragment}},M}return new S(R)},O.RTCIceCandidate.prototype=S.prototype,g(O,"icecandidate",R=>(R.candidate&&Object.defineProperty(R,"candidate",{value:new O.RTCIceCandidate(R.candidate),writable:"false"}),R))}function nt(O){!O.RTCIceCandidate||O.RTCIceCandidate&&"relayProtocol"in O.RTCIceCandidate.prototype||g(O,"icecandidate",S=>{if(S.candidate){const R=ue().parseCandidate(S.candidate.candidate);R.type==="relay"&&(S.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[R.priority>>24])}return S})}function $e(O,S){if(!O.RTCPeerConnection)return;"sctp"in O.RTCPeerConnection.prototype||Object.defineProperty(O.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const R=O.RTCPeerConnection.prototype.setRemoteDescription;O.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,S.browser==="chrome"&&S.version>=76){const{sdpSemantics:M}=this.getConfiguration();M==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(M){if(!M||!M.sdp)return!1;const P=ue().splitSections(M.sdp);return P.shift(),P.some(B=>{const H=ue().parseMLine(B);return H&&H.kind==="application"&&H.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const M=function(ie){const K=ie.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(K===null||K.length<2)return-1;const se=parseInt(K[1],10);return se!=se?-1:se}(arguments[0]),P=function(ie){let K=65536;return S.browser==="firefox"&&(K=S.version<57?ie===-1?16384:2147483637:S.version<60?S.version===57?65535:65536:2147483637),K}(M),B=function(ie,K){let se=65536;S.browser==="firefox"&&S.version===57&&(se=65535);const he=ue().matchPrefix(ie.sdp,"a=max-message-size:");return he.length>0?se=parseInt(he[0].substring(19),10):S.browser==="firefox"&&K!==-1&&(se=2147483637),se}(arguments[0],M);let H;H=P===0&&B===0?Number.POSITIVE_INFINITY:P===0||B===0?Math.max(P,B):Math.min(P,B);const te={};Object.defineProperty(te,"maxMessageSize",{get:()=>H}),this._sctp=te}return R.apply(this,arguments)}}function Ue(O){if(!O.RTCPeerConnection||!("createDataChannel"in O.RTCPeerConnection.prototype))return;function S(M,P){const B=M.send;M.send=function(){const H=arguments[0],te=H.length||H.size||H.byteLength;if(M.readyState==="open"&&P.sctp&&te>P.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+P.sctp.maxMessageSize+" bytes)");return B.apply(M,arguments)}}const R=O.RTCPeerConnection.prototype.createDataChannel;O.RTCPeerConnection.prototype.createDataChannel=function(){const M=R.apply(this,arguments);return S(M,this),M},g(O,"datachannel",M=>(S(M.channel,M.target),M))}function qt(O){if(!O.RTCPeerConnection||"connectionState"in O.RTCPeerConnection.prototype)return;const S=O.RTCPeerConnection.prototype;Object.defineProperty(S,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(S,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(R){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),R&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=R)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(R=>{const M=S[R];S[R]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=P=>{const B=P.target;if(B._lastConnectionState!==B.connectionState){B._lastConnectionState=B.connectionState;const H=new Event("connectionstatechange",P);B.dispatchEvent(H)}return P},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),M.apply(this,arguments)}})}function Mt(O,S){if(!O.RTCPeerConnection||S.browser==="chrome"&&S.version>=71||S.browser==="safari"&&S.version>=605)return;const R=O.RTCPeerConnection.prototype.setRemoteDescription;O.RTCPeerConnection.prototype.setRemoteDescription=function(M){if(M&&M.sdp&&M.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const P=M.sdp.split(`
`).filter(B=>B.trim()!=="a=extmap-allow-mixed").join(`
`);O.RTCSessionDescription&&M instanceof O.RTCSessionDescription?arguments[0]=new O.RTCSessionDescription({type:M.type,sdp:P}):M.sdp=P}return R.apply(this,arguments)}}function Yt(O,S){if(!O.RTCPeerConnection||!O.RTCPeerConnection.prototype)return;const R=O.RTCPeerConnection.prototype.addIceCandidate;R&&R.length!==0&&(O.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(S.browser==="chrome"&&S.version<78||S.browser==="firefox"&&S.version<68||S.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ce(O,S){if(!O.RTCPeerConnection||!O.RTCPeerConnection.prototype)return;const R=O.RTCPeerConnection.prototype.setLocalDescription;R&&R.length!==0&&(O.RTCPeerConnection.prototype.setLocalDescription=function(){let M=arguments[0]||{};if(typeof M!="object"||M.type&&M.sdp)return R.apply(this,arguments);if(M={type:M.type,sdp:M.sdp},!M.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":M.type="offer";break;default:M.type="answer"}return M.sdp||M.type!=="offer"&&M.type!=="answer"?R.apply(this,[M]):(M.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(P=>R.apply(this,[P]))})}(function({window:O}={},S={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const R=E,M=function(B){const H={browser:null,version:null};if(B===void 0||!B.navigator||!B.navigator.userAgent)return H.browser="Not a browser.",H;const{navigator:te}=B;if(te.mozGetUserMedia)H.browser="firefox",H.version=p(te.userAgent,/Firefox\/(\d+)\./,1);else if(te.webkitGetUserMedia||B.isSecureContext===!1&&B.webkitRTCPeerConnection)H.browser="chrome",H.version=p(te.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!B.RTCPeerConnection||!te.userAgent.match(/AppleWebKit\/(\d+)\./))return H.browser="Not a supported browser.",H;H.browser="safari",H.version=p(te.userAgent,/AppleWebKit\/(\d+)\./,1),H.supportsUnifiedPlan=B.RTCRtpTransceiver&&"currentDirection"in B.RTCRtpTransceiver.prototype}return H}(O),P={browserDetails:M,commonShim:l,extractVersion:p,disableLog:_,disableWarnings:v,sdp:be};switch(M.browser){case"chrome":if(!a||!Y||!S.shimChrome)return R("Chrome shim is not included in this adapter release."),P;if(M.version===null)return R("Chrome shim can not determine version, not shimming."),P;R("adapter.js shimming chrome."),P.browserShim=a,Yt(O,M),ce(O),L(O,M),$(O),Y(O,M),q(O),Z(O,M),G(O),X(O),re(O),ee(O,M),Xe(O),nt(O),qt(O),$e(O,M),Ue(O),Mt(O,M);break;case"firefox":if(!o||!He||!S.shimFirefox)return R("Firefox shim is not included in this adapter release."),P;R("adapter.js shimming firefox."),P.browserShim=o,Yt(O,M),ce(O),oe(O,M),He(O,M),Me(O),we(O),Te(O),Le(O),Ce(O),ke(O),St(O),At(O),Ee(O),Xe(O),qt(O),$e(O,M),Ue(O);break;case"safari":if(!c||!S.shimSafari)return R("Safari shim is not included in this adapter release."),P;R("adapter.js shimming safari."),P.browserShim=c,Yt(O,M),ce(O),rt(O),gt(O),fe(O),ye(O),et(O),dt(O),Fe(O),bt(O),Xe(O),nt(O),$e(O,M),Ue(O),Mt(O,M);break;default:R("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8520);const j=()=>typeof RTCPeerConnection=="function";var W,me;(function(O){O[O.TRACE=0]="TRACE",O[O.DEBUG=1]="DEBUG",O[O.INFO=2]="INFO",O[O.WARN=3]="WARN",O[O.ERROR=4]="ERROR",O[O.SILENT=5]="SILENT"})(W||(W={})),function(O){O.SPADE="SPADE",O.TIME="Time",O.WEBRTC="WebRTC",O.EMITTER="Emitter",O.MEDIA="Media",O.SUBSCRIPTION="StageSubscription",O.PUBLICATION="StagePublication",O.CONNECTION="StageConnection",O.SOCKET="StageSocket",O.BROADCAST_STAGE_CLIENT="BroadcastStageClient",O.STAGE="Stage",O.REMOTE_PARTICIPANT="RemoteParticipant",O.LOCAL_PARTICIPANT="LocalParticipant",O.CONFIGURATION="Configuration",O.REMOTE_PLAYBACK="RemotePlaybackController",O.REMOTE_STAGE_STREAM="RemoteStageStream"}(me||(me={}));const De=1007,je=12e4,mt=3e5;class xt extends Error{constructor({name:S,message:R,code:M,details:P,cause:B,params:H}){super(R),Error.captureStackTrace&&Error.captureStackTrace(this,xt),this.name=S||"BroadcastClientError",this.message=R,this.code=M,this.details=P,this.cause=B,this.params=H}}const Vn={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},qe={name:"CameraError",code:2e3,message:"Camera could not be captured"},Vt={name:"InputError",code:3e3,message:"Input could not be attached"},ht={name:"AddDeviceError",code:4e3,message:"Device is missing"},Pt={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},hn={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},an={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},Ve={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},ot={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},Ct={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},Nt={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Yn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},si={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Sr={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},sr={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},En={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},sn={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},Ln={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},Nn={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},dr={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},ui={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},er={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},La={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},gu={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},nf={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},_p={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},d0={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},rf={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},sf={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},vu={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},ve={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},Ke={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var vt,yt,Ze,Ht,nn,mn,Sn,or,cr,Cn=function(O,S,R,M){if(R==="a"&&!M)throw new TypeError("Private accessor was defined without a getter");if(typeof S=="function"?O!==S||!M:!S.has(O))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?M:R==="a"?M.call(O):M?M.value:S.get(O)},gr=function(O,S,R,M,P){if(typeof S=="function"?O!==S||!P:!S.has(O))throw new TypeError("Cannot write private member to an object whose class did not declare it");return S.set(O,R),R};const ai=1920,As=1080,vs=W.ERROR,Kr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},Xn={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},Tr={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},Bn={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Ho={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},zl={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Qa={reconnect:!1,timeout:je};function ah(O){var S,R;if(typeof O!="string"&&O!==void 0)throw new xt(La);if(O){if(O.startsWith("https"))return O;{const M=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(O);if(((S=M==null?void 0:M.groups)===null||S===void 0?void 0:S.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(R=M==null?void 0:M.groups)===null||R===void 0?void 0:R.id)return`https://${M.groups.id}.webrtc.live-video.net:4443`;throw new xt(gu)}}return""}class cs{constructor(S,R,M=Kr,P,B=Qa){this.LOG_LEVEL=W,this.BASIC_LANDSCAPE=Kr,this.BASIC_PORTRAIT=Xn,this.BASIC_FULL_HD_LANDSCAPE=Tr,this.BASIC_FULL_HD_PORTRAIT=Bn,this.STANDARD_LANDSCAPE=Ho,this.STANDARD_PORTRAIT=zl,vt.set(this,void 0),yt.set(this,void 0),Ze.set(this,Kr),Ht.set(this,void 0),nn.set(this,Qa),mn.set(this,H=>{if(!H)throw new xt(Object.assign(Object.assign({},er),{details:"missing stream configuration"}));if(!(H.maxBitrate<=8500&&H.maxBitrate>=200))throw new xt(Object.assign(Object.assign({},er),{details:"maxBitrate must be between 200 and 8500"}));if(!(H.maxFramerate<=60&&H.maxFramerate>=10))throw new xt(Object.assign(Object.assign({},er),{details:"maxFramerate must be between 10 and 60"}));const te=H.maxResolution.width,ie=H.maxResolution.height;if(te>ai||ie>ai||te<160||ie<160||te===ai&&ie>As||ie===ai&&te>As)throw new xt(Object.assign(Object.assign({},er),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))}),Sn.set(this,H=>{if(!H)return;const te=Number(H),ie=Number.isInteger(te),K=te>=W.TRACE,se=te<=W.SILENT;if(!ie||!K||!se)throw new xt(nf)}),or.set(this,H=>{if(H&&typeof H!="object")throw new xt(_p)}),cr.set(this,H=>{if(!H)return;if(typeof H!="object"||typeof H.reconnect!="boolean")throw new xt(rf);const{timeout:te}=H;if(te!==void 0&&(Number.isNaN(te)||typeof te!="number"||te<1e4||te>mt))throw new xt(sf)}),Cn(this,or,"f").call(this,P),Cn(this,Sn,"f").call(this,R),Cn(this,mn,"f").call(this,M),gr(this,vt,S),gr(this,yt,R),gr(this,Ze,M),gr(this,Ht,P),gr(this,nn,B)}get ingestEndpoint(){return Cn(this,vt,"f")}set ingestEndpoint(S){gr(this,vt,ah(S))}get streamConfig(){return Cn(this,Ze,"f")}set streamConfig(S){Cn(this,mn,"f").call(this,S),gr(this,Ze,S)}get logLevel(){return Cn(this,yt,"f")}set logLevel(S){Cn(this,Sn,"f").call(this,S),gr(this,yt,S)}get logger(){return Cn(this,Ht,"f")}set logger(S){Cn(this,or,"f").call(this,S),gr(this,Ht,S)}get networkReconnectConfig(){return Cn(this,nn,"f")}set networkReconnectConfig(S){Cn(this,cr,"f").call(this,S),gr(this,nn,S)}}vt=new WeakMap,yt=new WeakMap,Ze=new WeakMap,Ht=new WeakMap,nn=new WeakMap,mn=new WeakMap,Sn=new WeakMap,or=new WeakMap,cr=new WeakMap;var bn,eo=i(6729),Hs=i(1206);(function(O){O.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",O.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",O.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",O.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",O.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",O.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",O.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",O.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",O.PUBLISH="ivs_broadcast_multihost_publish",O.UNPUBLISH="ivs_broadcast_multihost_unpublish",O.SUBSCRIBE="ivs_broadcast_multihost_subscribe",O.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",O.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",O.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",O.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",O.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",O.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",O.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",O.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",O.FIRST_FRAME="ivs_broadcast_multihost_first_frame",O.JOIN="ivs_broadcast_multihost_join",O.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",O.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",O.JOIN_ENDED="ivs_broadcast_multihost_join_ended",O.LEAVE="ivs_broadcast_multihost_leave",O.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",O.SERVER_REQUEST="ivs_broadcast_multihost_server_request",O.TRACE="ivs_broadcast_stage_trace",O.ERROR="ivs_broadcast_error",O.MINUTE="ivs_broadcast_multihost_minute",O.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",O.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",O.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",O.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",O.EDP_PONG="ivs_broadcast_multihost_edp_rtt",O.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",O.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",O.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",O.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",O.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state"})(bn||(bn={}));class qn{constructor(S,R,M,P){let B="unknown";if(R.stageARN&&R.stageARN.startsWith("arn:aws:ivs:")){const H=R.stageARN.split(":");H.length===6&&(B=H[4])}this.event=S,this.properties={client_time:new Date().toISOString(),customer_id:B,device_software:window.navigator.userAgent,multihost_id:R.stageARN,participant_id:R.participantID,participant_user_id:R.userID,platform:"web",sdk_version:"1.19.0",stage_arn:R.stageARN,trace_id:M.value},R.attrGsRole&&(this.properties.token_attribute_0=R.attrGsRole),R.attrGsSessionId&&(this.properties.token_attribute_1=R.attrGsSessionId),this.critical=P}}class _l extends qn{constructor(S){super(bn.ERROR,S.token,S.traceId,!0),Object.assign(this.properties,{code:S.code,tag:S.tag,description:S.message,remote_participant_id:S.remoteParticipantId,request_uuid:S.requestUUID,is_nominal:S.nominal,is_fatal:S.fatal,details:S.details,location:S.location})}}const oa="IVS_CLIENT_OVERRIDES";function bp(O){const S=window[oa];return typeof S=="object"?S[O]:O==="logLevel"?window.STAGES_LOG_LEVEL:O==="appLabel"?window.IVS_APP_LABEL:O==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function ad(O){const S=bp(O);if(typeof S=="string")return S}function oh(O){const S=bp(O);if(typeof S=="boolean")return S}function f0(){const O=bp("logLevel");if(typeof O=="number"&&Object.values(W).includes(O))return O}function Ry(){return oh("disableXdp")}function p0(){return oh("enableXdpPublish")}function jo(){return oh("preferMainProfile")}function m0(){return oh("enableInitialLayerOnSdp")}var Vo=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};const hx=4;class oE{constructor(S="https://broadcast.stats.live-video.net/"){this.spadeUrl=S}send(S,R=!1){return Vo(this,void 0,void 0,function*(){const M=Date.now();for(const te of S)te.properties.batch_time_millis=M;const P=this.b64EncodeUnicode(JSON.stringify(S)),B={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},H=`data=${P}`;R?navigator.sendBeacon(this.spadeUrl,H):Vo(this,void 0,void 0,function*(){try{yield function(te,ie,K={},se=""){return Vo(this,void 0,void 0,function*(){const he=new XMLHttpRequest;return he.open(te,ie,!0),K&&Object.keys(K).forEach(pe=>{K.hasOwnProperty(pe)&&he.setRequestHeader(pe,K[pe])}),new Promise((pe,Ne)=>{he.onreadystatechange=()=>{he.readyState===hx&&(he.status>=200&&he.status<300?pe(he.responseText):Ne(new Error(`Spade ${te} ${ie} responded ${he.status}
${he.responseText}`)))},he.send(se)})})}("POST",this.spadeUrl,B,H)}catch{}})})}b64EncodeUnicode(S){return btoa(encodeURIComponent(S).replace(/%([0-9A-F]{2})/g,(R,M)=>String.fromCharCode(+`0x${M}`)))}}function yu(O){if(!O)throw new Error("SpadeClient is not defined")}function bm(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,O=>{const S=16*Math.random()|0;return(O==="x"?S:3&S|8).toString(16)})}class od{constructor(){this.sharedProperties={},this.spadeClient={},this.queuedEvents=[],this.genSessionId();const S=function(){const M=ad("analyticsPostUrl");if(M!==void 0)return M}()||"https://broadcast.stats.live-video.net/",R=function(){const M=ad("appLabel");if(M!==void 0)return M.substring(0,64)}();this.spadeClient=new oE(S),this.initSharedProperties({appLabel:R})}start(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.flushEvents()},1e3))}stop(S){let R=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,S&&(this.queuedEvents=this.queuedEvents.filter(M=>M.critical),R=!0),this.flushEvents(R),this.genSessionId()}trackEvent(S,R=!1){let M=this.sharedProperties;R&&(M={global_session_id:od.globalSessionId,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version}),"data"in S?(S.data.properties=Object.assign({},M,S.data.properties),this.queuedEvents.push(S.data)):(S.properties=Object.assign({},M,S.properties),this.queuedEvents.push(S))}trackEventNoSharedProps(S){this.trackEvent(S,!0)}trackErrorAndThrow(S){throw this.trackError(S),S}trackError(S){this.trackEvent(new _l(S))}batchEvents(S){yu(this.spadeClient);const R=S.map(M=>(M.data.properties=Object.assign({},this.sharedProperties,M.data.properties),M.data));this.spadeClient.send(R)}initSharedProperties({appLabel:S}){const R=Hs.getParser(navigator.userAgent),M=this.parseSemver(String(R.getBrowserVersion()));this.sharedProperties={browser:navigator.appVersion,browser_family:R.getBrowserName().toLowerCase(),browser_version:`${M.major}.${M.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:R.getOSName(),os_version:String(R.getOSVersion()),platform:"web",global_session_id:od.globalSessionId,session_id:this.sessionId,sdk_version:"1.19.0",user_agent:navigator.userAgent},S&&(this.sharedProperties.app_label=S)}genSessionId(){this.sessionId=bm(),this.sharedProperties.session_id=this.sessionId}flushEvents(S=!1){yu(this.spadeClient),this.queuedEvents.length>0&&this.spadeClient.send(this.queuedEvents,S),this.queuedEvents=[]}parseSemver(S){const R=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(S)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(S)||/^(\d+)$/.exec(S)||[];return{major:parseInt(R[1],10)||0,minor:parseInt(R[2],10)||0,patch:parseInt(R[3],10)||0}}getSessionId(){return this.sessionId}}od.globalSessionId=bm();class Ss{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.CONGESTION_TIME,properties:M}}}class ch{constructor(S,R,M){this.transformProperties=(B,H,te)=>({duration:(B.getTime()-((H==null?void 0:H.getTime())||0))/1e3,ecn_negotiated:!1,ingest_session_id:te});const P=this.transformProperties(S,R,M);this.data={event:Ms.CONNECTION_ESTABLISHED,properties:P}}}class Ay{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.CONNECTION_RTT,properties:M}}}class cE{constructor(S){this.transformProperties=M=>{var P;return{is_fatal:(P=M.isFatal)!==null&&P!==void 0&&P,value:M.value,code:M.code,description:M.description}};const R=this.transformProperties(S);this.data={event:Ms.ERROR,properties:R}}}class My{constructor(S,R){this.transformProperties=(P,B)=>({type:P,input_device_id:B.deviceId,position:B.facingMode||"unknown"});const M=this.transformProperties(S,R);this.data={event:Ms.INPUT_DEVICE_ATTACHED,properties:M}}}class dx{constructor(S,R){this.transformProperties=(P,B)=>({type:P,input_device_id:B.deviceId,position:B.facingMode||"unknown"});const M=this.transformProperties(S,R);this.data={event:Ms.INPUT_DEVICE_DETACHED,properties:M}}}class lE{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.MEASURED_BITRATE,properties:M}}}class af{constructor(S,R){this.transformProperties=(P,B)=>({minutes_logged:Math.round((P.timestamp-B)/6e4)});const M=this.transformProperties(S,R);this.data={event:Ms.MINUTE_BROADCAST,properties:M}}}class of{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.RECOMMENDED_BITRATE,properties:M}}}class Oy{constructor(S){this.transformProperties=M=>({codec:M.mimeType,bitrate:0,sample_rate:M.clockRate,channel_count:M.channels});const R=this.transformProperties(S);this.data={event:Ms.SESSION_AUDIO_ENCODER_CONFIGURED,properties:R}}}class uE{constructor(S){this.transformProperties=M=>({codec:"audio",bitrate:32e3,sample_rate:M.sampleRate,channel_count:M.channelCount});const R=this.transformProperties(S);this.data={event:Ms.SESSION_AUDIO_PROPERTIES,properties:R}}}class hE{constructor(S,R,M){this.transformProperties=(B,H,te)=>({codec:te.mimeType,codec_profile:H.profile,codec_level:H.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:B.width,height:B.height,bframe_count:0,target_fps:B.frameRate});const P=this.transformProperties(S,R,M);this.data={event:Ms.SESSION_VIDEO_ENCODER_CONFIGURED,properties:P}}}class g0{constructor(S){this.transformProperties=M=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:M.width,height:M.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:M.frameRate});const R=this.transformProperties(S);this.data={event:Ms.SESSION_VIDEO_PROPERTIES,properties:R}}}class Ny{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.SOURCE_AUDIO_LATENCY,properties:M}}}class dE{constructor(S,R){this.transformProperties=(P,B)=>({sum:P.sum,median:P.median(),min:P.min,max:P.max,p90:P.percentile(.9),event_count:P.data.length,period:B});const M=this.transformProperties(S,R);this.data={event:Ms.SOURCE_VIDEO_LATENCY,properties:M}}}class lh{constructor(S,R){this.transformProperties=({protocol:P,hostname:B,port:H},te)=>({protocol:P,endpoint_host:B,endpoint_port:H,reason:te});const M=this.transformProperties(S,R);this.data={event:Ms.START_BROADCAST,properties:M}}}class Em{constructor(S){this.transformProperties=({protocol:M,hostname:P,port:B})=>({protocol:M,endpoint_host:P,endpoint_port:B});const R=this.transformProperties(S);this.data={event:Ms.STOP_BROADCAST,properties:R}}}class fE{constructor(S){this.transformProperties=M=>({bytes_sent:M.bytesSent,header_bytes_sent:M.headerBytesSent,nack_count:M.nackCount,packets_sent:M.packetsSent,retransmitted_bytes_sent:M.retransmittedBytesSent,retransmitted_packets_sent:M.retransmittedPacketsSent});const R=this.transformProperties(S);this.data={event:Ms.WEBRTC_AUDIO_STATS,properties:R}}}class hc{constructor(S){this.transformProperties=M=>({bytes_sent:M.bytesSent,fir_count:M.firCount,frames_encoded:M.framesEncoded,frames_sent:M.framesSent,header_bytes_sent:M.headerBytesSent,huge_frames_sent:M.hugeFramesSent,key_frames_encoded:M.keyFramesEncoded,nack_count:M.nackCount,packets_sent:M.packetsSent,pli_count:M.pliCount,quality_limitation_reason:M.qualityLimitationReason,quality_limitation_resolution_changes:M.qualityLimitationResolutionChanges,retransmitted_bytes_sent:M.retransmittedBytesSent,retransmitted_packets_sent:M.retransmittedPacketsSent,total_encode_time:M.totalEncodeTime,total_encoded_bytes_target:M.totalEncodedBytesTarget,total_packet_send_delay:M.totalPacketSendDelay});const R=this.transformProperties(S);this.data={event:Ms.WEBRTC_VIDEO_STATS,properties:R}}}var Ms,cd;(function(O){O.START_BROADCAST="ivs_broadcast_start_broadcast",O.STOP_BROADCAST="ivs_broadcast_stop_broadcast",O.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",O.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",O.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",O.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",O.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",O.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",O.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",O.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",O.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",O.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",O.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",O.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",O.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",O.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",O.CONGESTION_TIME="ivs_broadcast_congestion_time",O.BUFFER_DURATION="ivs_broadcast_buffer_duration",O.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",O.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",O.CONNECTION_RTT="ivs_broadcast_connection_rtt",O.ERROR="ivs_broadcast_error"})(Ms||(Ms={})),function(O){O.USER_INITIATED="user-initiated",O.NETWORK_DISCONNECT="network-disconnect"}(cd||(cd={}));const fx={[W.INFO]:"#528bff",[W.WARN]:"#ffb31a",[W.DEBUG]:"#00f593",[W.ERROR]:"#ff4f4d",[W.TRACE]:"",[W.SILENT]:"",[me.SPADE]:"#a970ff",[me.TIME]:"#53535f",[me.WEBRTC]:"#0e9bd8",[me.SUBSCRIPTION]:"#ffc400",[me.CONNECTION]:"#ff5edb",[me.SOCKET]:"#8585ff",[me.EMITTER]:"#adadb8",[me.LOCAL_PARTICIPANT]:"#1DD21D",[me.STAGE]:"#EC9806",[me.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},ca=({label:O})=>`background: ${fx[O]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,px=Object.entries(W),v0=(O,S,R)=>{const M=ca({label:O}),[P]=px.find(([,Je])=>Je===Number(O))||[],B=`%c${P}`,H=ca({label:S}),te=`%c${S}`,ie=ca({label:me.TIME}),K=`%c[${new Date().toISOString()}]`,se=ca({label:"details"}),he=`%c[${R}]`,pe=[K,B,te],Ne=[ie,M,H];return R&&(pe.push(he),Ne.push(se)),[pe.join(""),...Ne]},mx={debug(O){console.groupCollapsed(...v0(W.DEBUG,O.scope,O.label)),console.debug(O.msg,Object.assign(Object.assign({},O),{level:"debug"})),console.groupEnd()},info(O){console.groupCollapsed(...v0(W.INFO,O.scope,O.label)),console.info(O.msg,Object.assign(Object.assign({},O),{level:"info"})),console.groupEnd()},warn(O){console.groupCollapsed(...v0(W.WARN,O.scope,O.label)),console.warn(O.msg,Object.assign(Object.assign({},O),{level:"warn"})),console.groupEnd()},error(O){console.groupCollapsed(...v0(W.ERROR,O.scope,O.label)),console.error(O),console.groupEnd()}};var cf=function(O,S){var R={};for(var M in O)Object.prototype.hasOwnProperty.call(O,M)&&S.indexOf(M)<0&&(R[M]=O[M]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function"){var P=0;for(M=Object.getOwnPropertySymbols(O);P<M.length;P++)S.indexOf(M[P])<0&&Object.prototype.propertyIsEnumerable.call(O,M[P])&&(R[M[P]]=O[M[P]])}return R};Object.entries(W);class Sm{constructor(S=vs,R=mx){this.logLevel=S,this.loggerInstance=R}debug(S){var R,M;this.logLevel>W.DEBUG||(M=(R=this.loggerInstance).debug)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{level:"debug"}))))}info(S){var R,M;this.logLevel>W.INFO||(M=(R=this.loggerInstance).info)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{level:"info"}))))}warn(S){var R,M;this.logLevel>W.WARN||(M=(R=this.loggerInstance).warn)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{level:"warn"}))))}error(S){var R,M,{err:P}=S,B=cf(S,["err"]);this.logLevel>W.ERROR||(M=(R=this.loggerInstance).error)===null||M===void 0||M.call(R,Object.assign({err:P},B))}}class to{constructor(S,R){this.logger=S,this.scope=R}debug(S){var R,M;(M=(R=this.logger).debug)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{scope:this.scope}))))}info(S){var R,M;(M=(R=this.logger).info)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{scope:this.scope}))))}warn(S){var R,M;(M=(R=this.logger).warn)===null||M===void 0||M.call(R,JSON.parse(JSON.stringify(Object.assign(Object.assign({},S),{scope:this.scope}))))}error(S){var R,M,{err:P}=S,B=cf(S,["err"]);(M=(R=this.logger).error)===null||M===void 0||M.call(R,Object.assign(Object.assign({err:P},B),{scope:this.scope}))}unwrap(){return this.logger}}class dc{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(S){(this.min===0||S<this.min)&&(this.min=S),S>=this.max&&(this.max=S),this.data.push(S),this.sum+=S}median(){this.data.sort();const S=this.data.length>>1;return this.data.length%2==0?this.data[S-1]+this.data[S]>>1:this.data[S]}percentile(S){if(this.data.length===0)return 0;if(S<=0)return this.data[0];if(S>=1)return this.data[this.data.length-1];const R=(this.data.length-1)*S,M=Math.floor(R),P=M+1,B=R%1;return P>=this.data.length?this.data[M]:this.data[M]*(1-B)+this.data[P]*B}}var Tm=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class gx{constructor(S,R,M,P){this.peerClient=S,this.broadcastCanvasManager=R,this.analyticsTracker=P,this.logger=new to(M,me.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval(()=>{this.collectSamples()},1e3),this.trackSamplesTimerId=window.setInterval(()=>{this.trackSamples()},3e4),this.trackPeerConnectionStatsTimerId=window.setInterval(()=>{this.trackPeerConnectionStats()},6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return Tm(this,void 0,void 0,function*(){(yield this.peerClient.getReports()).forEach(S=>{if(S.type==="outbound-rtp")switch(S.kind){case"audio":this.analyticsTracker.trackEvent(new fE(S));break;case"video":{const R=new hc(S),M=new af(S,this.startTimestamp);this.analyticsTracker.batchEvents([R,M]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:S.kind})}})})}collectSamples(){return Tm(this,void 0,void 0,function*(){let S=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach(M=>{switch(M.type){case"candidate-pair":M.nominated&&(this.rttSamples.push(M.currentRoundTripTime),this.recommendedBitrateSamples.push(M.availableOutgoingBitrate));break;case"outbound-rtp":S+=M.bytesSent||0,this.startTimestamp===0&&M.kind==="video"&&(this.startTimestamp=M.timestamp)}});const R=8*Math.round(S-this.previousBytesSent);this.previousBytesSent=S,this.measuredBitrateSamples.push(R)})}trackSamples(){const R=new Ny(this.audioLatencySamples,30),M=new dE(this.videoLatencySamples,30),P=new Ss(this.congestionTimeSamples,30),B=new lE(this.measuredBitrateSamples,30),H=new of(this.recommendedBitrateSamples,30),te=new Ay(this.rttSamples,30);this.analyticsTracker.batchEvents([R,M,P,B,H,te]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new dc,this.videoLatencySamples=new dc,this.congestionTimeSamples=new dc,this.measuredBitrateSamples=new dc,this.recommendedBitrateSamples=new dc,this.rttSamples=new dc}}const Ta={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},Xs="connectionStateChange",y0="sdpNegotiated",ld="clientError",Ep="seiMessageReceived",ft="transformError";var at;(function(O){O.CLOSED="closed",O.COMPLETED="completed",O.CONNECTED="connected",O.CONNECTING="connecting",O.DISCONNECTED="disconnected",O.FAILED="failed",O.IDLE="idle",O.NEW="new",O.NONE="none"})(at||(at={}));const Ft=O=>{const S=B=>{var H;return!((H=B.deviceId)===null||H===void 0)&&H.startsWith("web-contents-media-stream")?"tab":void 0},R=B=>{var H;return!((H=B.deviceId)===null||H===void 0)&&H.startsWith("window")&&B.displaySurface==="window"?"window":void 0},M=B=>{var H;return!((H=B.deviceId)===null||H===void 0)&&H.startsWith("screen")&&B.displaySurface==="monitor"?"screen":void 0};return(S(P=O)||R(P)||M(P)?void 0:"camera")||M(O)||R(O)||S(O)||"unknown";var P};function fn(O,S){return O.find(R=>R.kind===S)}var Xt;(function(O){O.VIDEO="video",O.AUDIO="audio"})(Xt||(Xt={}));class jr{constructor(){this.mediaTracks=new Map([[Xt.VIDEO,void 0],[Xt.AUDIO,void 0]])}setTrack(S,R){this.mediaTracks.set(S,R)}getTrack(S){return this.mediaTracks.get(S)}}class la{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(S){return S?(S.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map(R=>R.trim()).filter(Boolean).forEach(R=>{const M=R.split("=");if(M.length===2)switch(M[0]){case"level-asymmetry-allowed":M[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":M[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(M[1]),this.level=this.getLevelFromId(M[1])}}),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(S){const R=S.substr(0,2),M=S.substr(2,2);switch(R.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return M==="00"?"high 10":"high 10 intra";case"7a":return M==="00"?"high 42":"high 42 intra";case"f4":return M==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(S){return parseInt(S.substr(4,2),16)}}function uh(O){return btoa(JSON.stringify(O))}var Jr,Hl=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};(function(O){O.IDLE="idle",O.EXECUTING="executing",O.RECONNECTING="reconnecting"})(Jr||(Jr={}));class hh{constructor(S,R=12e4,M,P){this.state=Jr.IDLE,this.failureCallback=()=>{},this.peerClient=S,this.timeout=R,this.logger=M,this.emitter=P}onFailure(S){this.failureCallback=S}setStartConfig(S,R){this.ingestEndpoint=S,this.streamKey=R}execute(){const{id:S}=this;this.state===Jr.IDLE&&(this.state=Jr.EXECUTING,this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,at.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:S}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(S){this.timeoutTimerId=window.setTimeout(()=>{this.state!==Jr.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,at.FAILED),this.failureCallback())},S)}stop(){this.state=Jr.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Hl(this,void 0,void 0,function*(){if(this.ingestEndpoint&&this.streamKey){const S=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),S===at.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(R){throw this.logger.error({err:R}),R}}})}isActive(){return this.state!==Jr.IDLE}}class Wc extends hh{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let S=5e3;const R=()=>Hl(this,void 0,void 0,function*(){if(this.state===Jr.EXECUTING)try{this.state=Jr.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:S}),this.state=Jr.EXECUTING,this.currentTimeoutId=window.setTimeout(R,S),S*=2}});this.currentTimeoutId=window.setTimeout(R,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class xm extends hh{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Hl(this,void 0,void 0,function*(){if(navigator.onLine&&this.state===Jr.EXECUTING){this.state=Jr.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Jr.EXECUTING}}})}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class _0{static create(S,R=Qa,M,P){const{reconnect:B,timeout:H}=R;if(B){const te=Hs.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(te)&&navigator.connection?new xm(S,H,M,P):new Wc(S,H,M,P)}}}var _u,Yc=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})},Ua=function(O,S,R,M){if(R==="a"&&!M)throw new TypeError("Private accessor was defined without a getter");if(typeof S=="function"?O!==S||!M:!S.has(O))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?M:R==="a"?M.call(O):M?M.value:S.get(O)};const Ai=O=>!!O;function b0(O){if(!O)throw new Error("PeerConnection is not defined")}const Iy={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class lf{constructor(S,R,M,P,B){this.config=S,this.emitter=R,this.mediaStreamManager=M,this.analyticsTracker=B,this.establishConnection=(H,te)=>Yc(this,void 0,void 0,function*(){var ie,K,se;b0(this.peerConnection);try{const he=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(he),yield this.sendSetupRequest(H,te,he)}catch(he){if(he instanceof Error){(ie=(se=he).code)!==null&&ie!==void 0||(se.code=Ln.code);const pe=new xt(Object.assign(Object.assign({},Ln),{name:he.name,message:he.message,code:he==null?void 0:he.code,cause:he}));throw!((K=this.reconnectStrategy)===null||K===void 0)&&K.isActive()||this.handleError(he.code,he.message),this.stop(),pe}}}),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var H;if(!this.peerConnection)return at.NONE;const te=(H=this.reconnectStrategy)===null||H===void 0?void 0:H.isActive(),ie=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(ie){case"new":return at.NEW;case"closed":return at.CLOSED;case"disconnected":return te?at.CONNECTING:at.DISCONNECTED;case"failed":return te?at.CONNECTING:at.FAILED;case"idle":return at.IDLE;case"checking":case"connecting":return at.CONNECTING;case"completed":case"connected":return at.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:ie}),at.IDLE}},this.onConnectionStateChange=()=>{var H;const te=this.getConnectionState();switch(te){case at.CONNECTED:{this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,te);const ie=new Date;this.analyticsTracker.trackEvent(new ch(ie,this.connectionStartDate,this.ingestSessionId));const K=this.mediaStreamManager.getTrack(Xt.AUDIO),se=this.mediaStreamManager.getTrack(Xt.VIDEO);if(se){const he=se.getSettings();this.analyticsTracker.trackEvent(new g0(he))}if(K){const he=K.getSettings();this.analyticsTracker.trackEvent(new uE(he))}(((H=this.peerConnection)===null||H===void 0?void 0:H.getSenders())||[]).forEach(he=>{var pe;(((pe=he.getParameters())===null||pe===void 0?void 0:pe.codecs)||[]).forEach(Ne=>{var Je;switch((Je=he.track)===null||Je===void 0?void 0:Je.kind){case"video":{if(!se)break;const Ye=new la().extractVideoSdpFmtpLine(Ne.sdpFmtpLine),Oe=se.getSettings();this.analyticsTracker.trackEvent(new hE(Oe,Ye,Ne));break}case"audio":if(!K)break;this.analyticsTracker.trackEvent(new Oy(Ne))}})});break}case at.CONNECTING:this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,te),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case at.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,te),this.handleTerminalConnectionFailure());break;case at.DISCONNECTED:this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,te),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,te)}},this.handleLocalDescription=H=>Yc(this,void 0,void 0,function*(){var te;return(te=this.peerConnection)===null||te===void 0?void 0:te.setLocalDescription(H)}),_u.set(this,H=>{if(typeof H!="string")throw new xt(La);try{new URL(H)}catch{throw new xt(gu)}}),this.logger=new to(P,me.WEBRTC),this.createReconnectStrategy(S)}start(S,R){var M;return Yc(this,void 0,void 0,function*(){Ua(this,_u,"f").call(this,S);const P=[this.mediaStreamManager.getTrack(Xt.VIDEO),this.mediaStreamManager.getTrack(Xt.AUDIO)].filter(Ai);if(this.createPeerConnection(),this.addTracks({tracks:P}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(S,R),yield this.establishConnection(S,R),!((M=this.reconnectStrategy)===null||M===void 0)&&M.isActive()){const B=new URL(S);this.analyticsTracker.trackEvent(new lh({protocol:"webrtc",hostname:B.hostname,port:B.port},cd.NETWORK_DISCONNECT))}})}stop(){var S,R,M,P;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[at.NEW,at.CONNECTING,at.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(Ta.CONNECTION_STATE_CHANGE,at.CLOSED),(S=this.peerConnection)===null||S===void 0||S.close(),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("connectionstatechange",this.onConnectionStateChange),(M=this.peerConnection)===null||M===void 0||M.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(P=this.reconnectStrategy)===null||P===void 0||P.stop()}addTracks(S){var R;if(b0(this.peerConnection),!S)return;const M=this.peerConnection.getSenders().map(B=>{var H;return(H=B.track)===null||H===void 0?void 0:H.id}),P=S.tracks.filter(B=>!M.includes(B.id));for(const B of P)(R=this.peerConnection)===null||R===void 0||R.addTrack(B)}getReports(){var S;return Yc(this,void 0,void 0,function*(){try{const R=(yield(S=this.peerConnection)===null||S===void 0?void 0:S.getStats())||[],M=[];return R.forEach(P=>{M.push(P)}),M}catch{return[]}})}sendSetupRequest(S,R,M){var P;return Yc(this,void 0,void 0,function*(){const B=yield fetch(`${S}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:uh(M),streamKey:R},this.config.streamConfig))});if(!B.ok)throw function(te){let ie=new xt(Object.assign({},Ln));return(te==null?void 0:te.code)===De&&(ie=new xt(Object.assign({},dr))),te!=null&&te.message&&(ie.message=te.message),ie}(yield B.json());const H=yield B.json();H!=null&&H.answer&&(yield(P=this.peerConnection)===null||P===void 0?void 0:P.setRemoteDescription(function(te){return JSON.parse(atob(te))}(H.answer)),this.ingestSessionId=H.ingestSessionId)})}handleTerminalConnectionFailure(){const S=new xt(Nn);this.handleError(S.code,S.message)}handleError(S,R){this.analyticsTracker.trackEvent(new cE({code:S,description:R,isFatal:!0})),this.emitter.emit(Ta.ERROR,{code:S,message:R})}createPeerConnection(){var S;const R=this.getConnectionState(),M=R!==at.NONE,P=R!==at.CLOSED,B=(S=this.reconnectStrategy)===null||S===void 0?void 0:S.isActive();M&&P&&!B||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval(()=>{const H=this.getConnectionState();if(this.reconnectStrategy&&H===at.DISCONNECTED&&this.disconnectionStartDate){const te=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:te}),te>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else H===at.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)},1e3),this.peerConnection=new RTCPeerConnection(Iy),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(S){if(this.reconnectStrategy=_0.create(this,S.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const R=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:R})}}}_u=new WeakMap;var uf,ky=i(2492);(function(O){O.CONFIG="config",O.UPDATE="update",O.START="start",O.STOP="stop"})(uf||(uf={}));var vx=i(477),Go=i.n(vx);function ud(){return Go()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var t;!function(t){t.CONFIG="config",t.UPDATE="update",t.START="start",t.STOP="stop"}(t||(t={}));const i=self;const s=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(t){this.config=Object.assign(Object.assign({},this.config),t),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{i.postMessage({type:t.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};i.addEventListener("message",(function(i){var n;if(null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.type)switch(i.data.type){case t.CONFIG:s.setConfig(i.data.payload||{});break;case t.START:s.start();break;case t.STOP:s.stop()}}))})();`,"Worker",void 0,void 0)}var dh=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class pE{constructor(S,R,M){this.config=S,this.mediaStreamManager=R,this.analyticsTracker=M,this.handleWorkerEvent=te=>{var ie;((ie=te.data)===null||ie===void 0?void 0:ie.type)===uf.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new ud,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const P=this.compositeEl.getContext("2d");if(P===null)throw new xt(Object.assign({},Vn));this.compositeContext=P,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const B=fn(this.compositeStream.getTracks(),Xt.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const H=fn(this.audioDestination.stream.getTracks(),Xt.AUDIO);B&&this.mediaStreamManager.setTrack(Xt.VIDEO,B),H&&this.mediaStreamManager.setTrack(Xt.AUDIO,H),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:uf.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(S){this.previewElement=S;const{width:R,height:M}=this.config.streamConfig.maxResolution;this.previewElement.width=R,this.previewElement.height=M,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const S=this.audioContext.createConstantSource(),R=this.audioContext.createGain();R.gain.value=.001,S.connect(R),R.connect(this.audioDestination),S.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const S=document.body,R=["touchstart","touchend","mousedown","keydown"],M=()=>{R.forEach(B=>{S.removeEventListener(B,P)})},P=()=>{this.audioContext.resume().then(M)};R.forEach(B=>{S.addEventListener(B,P,!1)})}getTracks(){return[this.mediaStreamManager.getTrack(Xt.VIDEO),this.mediaStreamManager.getTrack(Xt.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Xt.VIDEO)}getAudioInputDevice(S){if(typeof S!="string")return;const R=this.mixer.audio.find(M=>{if(M.name===S)return M.source});return R==null?void 0:R.source}getVideoInputDevice(S){if(typeof S=="string")return this.mixer.video.find(R=>R.name===S)}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(S,R,M){var P;return dh(this,void 0,void 0,function*(){if(typeof S!="object")throw new xt(Object.assign({},ht));if(!R||typeof R!="string")throw new xt(Object.assign({},Ve));if(this.mixer.video.some(pe=>pe.name===R))throw new xt(Object.assign({},Pt));if(!M)throw new xt(Object.assign({},hn));if(typeof M.index!="number")throw new xt(Object.assign({},an));const B=function(){const pe=document.createElement("video");return pe.autoplay=!0,pe.muted=!0,pe.setAttribute("playsinline",""),pe.setAttribute("webkit-playsinline",""),pe}(),H=S.getVideoTracks(),[te]=H;if(!H.length)throw new xt(Object.assign({},qe));const ie=te.getConstraints(),K=ky({},ie,{frameRate:this.config.streamConfig.maxFramerate});try{yield te.applyConstraints(K)}catch(pe){let Ne="Unknown constraints error";pe instanceof Error&&(Ne=pe.message),this.analyticsTracker.trackEvent(new cE({description:`${Ct.message}: ${Ne}`,isFatal:!1,code:Ct.code}))}const se=()=>dh(this,void 0,void 0,function*(){let pe=0;for(;pe<5;)try{return void(yield B.play())}catch(Ne){if(!(Ne instanceof Error))throw new Error("unknown error trying to add video to broadcast");pe++,yield new Promise(Je=>setTimeout(Je,150))}throw new Error("Error playing video, tries exceeded")}),he=new MediaStream([te]);B.srcObject=he;try{yield se();const pe={name:R,element:B,position:M,source:he,render:!0},Ne=((P=te.getSettings)===null||P===void 0?void 0:P.call(te))||{};this.analyticsTracker.trackEvent(new My(Ft(Ne),Ne)),this.mixer.video.push(pe)}catch(pe){throw new xt(Object.assign(Object.assign({},qe),{cause:pe}))}})}addImageSource(S,R,M){var P;return dh(this,void 0,void 0,function*(){if(!S)throw new xt(Object.assign({},ht));if(!R||typeof R!="string")throw new xt(Object.assign({},Ve));if(S.tagName==="image")throw new xt(Object.assign({},ot));if(this.mixer.video.some(H=>H.name===R))throw new xt(Object.assign({},Pt));if(!M)throw new xt(Object.assign({},hn));if(typeof M.index!="number")throw new xt(Object.assign({},an));if(S instanceof Image){const H=(P=S.src)===null||P===void 0?void 0:P.slice();try{const te=S.src?new URL(S.src):{};if(te.host&&te.hostname){const ie=yield fetch(S.src).then(se=>dh(this,void 0,void 0,function*(){return se.blob()})),K=yield new Promise(se=>{const he=new FileReader;he.onload=()=>{se(he.result)},he.readAsDataURL(ie)});S.src=K}}catch{throw new xt(Object.assign(Object.assign({},sn),{params:{details:`Image URL: ${H}`}}))}}const B={name:R,element:S,position:M,render:!0};this.mixer.video.push(B)})}addAudioInputDevice(S,R){return dh(this,void 0,void 0,function*(){if(typeof S!="object")throw new xt(Object.assign({},ht));if(!R||typeof R!="string")throw new xt(Object.assign({},Ve));if(this.mixer.audio.some(te=>te.name===R))throw new xt(Object.assign({},Pt));const M=S.getAudioTracks();if(!M.length)throw new xt(Object.assign({},Vt));const P=this.audioContext.createMediaStreamSource(new MediaStream(M)),B=this.audioContext.createGain();B.gain.value=1,P.connect(B),B.connect(this.audioDestination);const H={name:R,source:S,audioTrackSource:P,gainNode:B};this.analyticsTracker.trackEvent(new My("audio",{deviceId:S.id})),this.mixer.audio.push(H)})}removeImage(S){const R=this.mixer.video.findIndex(M=>M.name===S);if(R<0)throw new xt(Object.assign({},Yn));this.mixer.video.splice(R,1)}removeVideoInputDevice(S){var R;const M=this.removeDevice(S,this.mixer.video);if(!M)throw new xt(Object.assign({},Nt));{const P=fn(M.source.getTracks(),Xt.VIDEO);if(!P)throw new xt(Object.assign({},Nt));M.element.srcObject=null,P.stop();const B=((R=P==null?void 0:P.getSettings)===null||R===void 0?void 0:R.call(P))||{};this.analyticsTracker.trackEvent(new dx(Ft(B),B))}}removeAudioInputDevice(S){const R=this.removeDevice(S,this.mixer.audio);if(R!=null&&R.audioTrackSource){for(const M of R.source.getTracks())M.stop(),this.analyticsTracker.trackEvent(new dx("audio",{deviceId:M.id}));R.gainNode.disconnect(this.audioDestination)}else if(!R)throw new xt(Object.assign({},Nt))}updateVideoDeviceComposition(S,R){if(!S||typeof S!="string")throw new xt(Object.assign({},sr));if(!R)throw new xt(Object.assign({},si));if(typeof R.index!="number")throw new xt(Object.assign({},Sr));this.mixer.video.forEach((M,P)=>{M.name===S&&(M.position=R)})}exchangeVideoDevicePositions(S,R){const M=this.getVideoInputDevice(S),P=this.getVideoInputDevice(R);if(!M)throw new xt(Object.assign(Object.assign({},En),{params:{details:`device with name: "${S}" not found`}}));if(!P)throw new xt(Object.assign(Object.assign({},En),{params:{details:`device with name: "${R}" not found`}}));const B=Object.assign({},M.position),H=Object.assign({},P.position);for(const te of this.mixer.video)te.name===S&&(wm(H.x)?te.position=Object.assign(Object.assign({},te.position),H):te.position={index:H.index}),te.name===R&&(wm(B.x)?te.position=Object.assign(Object.assign({},te.position),B):te.position={index:B.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:uf.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:uf.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var S;return((S=this.mediaStreamManager.getTrack(Xt.VIDEO))===null||S===void 0?void 0:S.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach(S=>{S.render=!1})}enableVideo(){this.mixer.video.forEach(S=>{S.render=!0})}disableAudio(){this.mixer.audio.forEach(S=>{S.audioTrackSource&&(S.gainNode.gain.value=0)})}enableAudio(){this.mixer.audio.forEach(S=>{S.audioTrackSource&&(S.gainNode.gain.value=1)})}getDrawRegion(S,R,M){var P,B,H,te;let ie=(P=S.position.x)!==null&&P!==void 0?P:0,K=(B=S.position.y)!==null&&B!==void 0?B:0;const se=(H=S.position.width)!==null&&H!==void 0?H:R-ie,he=(te=S.position.height)!==null&&te!==void 0?te:M-K,pe=se/he;let Ne=S.element.width,Je=S.element.height;S.element instanceof HTMLVideoElement&&(Ne=S.element.videoWidth,Je=S.element.videoHeight);const Ye=Ne/Je;let Oe=se,_e=he;return Ye>pe?(Oe=se,_e=2*Math.round(se/Ye/2),K+=(he-_e)/2):Ye<pe&&(_e=he,Oe=2*Math.round(he*Ye/2),ie+=(se-Oe)/2),{x:ie,y:K,width:Oe,height:_e}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const S=this.mixer.video.filter(R=>R.render);S.sort((R,M)=>R.position.index-M.position.index);for(const R of S){const{x:M,y:P,width:B,height:H}=this.getDrawRegion(R,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(R.element,M,P,B,H)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Xt.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(S,R){const M=R.findIndex(P=>(B=>B.name===S)(P));if(!(M<0))return R.splice(M,1)[0]}shouldMix(S){if(S.getTime()<this.nextMix)return!1;for(;this.nextMix<=S.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function wm(O){return Number.isSafeInteger(O)}var Cm,E0,hf=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})},S0=function(O,S,R,M){if(R==="a"&&!M)throw new TypeError("Private accessor was defined without a getter");if(typeof S=="function"?O!==S||!M:!S.has(O))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?M:R==="a"?M.call(O):M?M.value:S.get(O)};class bu{constructor(S){this.config=S,Cm.add(this),this.emitter=new eo,this.isValid=!0,this.emitter.on(Ta.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new od,this.mediaStreamManager=new jr;const R=new Sm(S.logLevel,S.logger);this.peerClient=new lf(this.config,this.emitter,this.mediaStreamManager,R,this.analyticsTracker),this.broadcastCanvasManager=new pE(S,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new gx(this.peerClient,this.broadcastCanvasManager,R,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(bu.prototype).forEach(M=>{this[M]=new Proxy(this[M],{apply:(P,B,H)=>{if(!B.isValid)throw new xt(Object.assign({},d0));return Reflect.apply(P,B,H)}})}),window.addEventListener("beforeunload",()=>{this.analyticsTracker.stop(!0)})}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(S,R){return hf(this,void 0,void 0,function*(){S0(this,Cm,"m",E0).call(this,S);const M=ah(R||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(M,S),this.emitter.emit(Ta.ACTIVE_STATE_CHANGE,!0),this.url=new URL(M),this.url&&this.analyticsTracker.trackEvent(new lh({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},cd.USER_INITIATED))})}stopBroadcast(){var S,R,M;this.url&&this.analyticsTracker.trackEvent(new Em({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(S=this.peerStatsTracker)===null||S===void 0||S.stop(),(R=this.peerClient)===null||R===void 0||R.stop(),(M=this.emitter)===null||M===void 0||M.emit(Ta.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(S,R,M){return hf(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addVideoInputDevice(S,R,M)})}addImageSource(S,R,M){return hf(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addImageSource(S,R,M)})}addAudioInputDevice(S,R){return hf(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addAudioInputDevice(S,R)})}removeVideoInputDevice(S){this.broadcastCanvasManager.removeVideoInputDevice(S)}removeAudioInputDevice(S){this.broadcastCanvasManager.removeAudioInputDevice(S)}removeImage(S){this.broadcastCanvasManager.removeImage(S)}updateVideoDeviceComposition(S,R){this.broadcastCanvasManager.updateVideoDeviceComposition(S,R)}exchangeVideoDevicePositions(S,R){this.broadcastCanvasManager.exchangeVideoDevicePositions(S,R)}getAudioInputDevice(S){return this.broadcastCanvasManager.getAudioInputDevice(S)}getVideoInputDevice(S){return this.broadcastCanvasManager.getVideoInputDevice(S)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(S,R){this.emitter.on(S,R)}off(S,R){this.emitter.off(S,R)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(S){this.broadcastCanvasManager.attachPreview(S)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function Fi(O){return new bu(function(S){const R=new cs;return R.streamConfig=S.streamConfig,R.ingestEndpoint=S.ingestEndpoint,R.logger=S.logger,R.logLevel=S.logLevel,R.networkReconnectConfig=S.networkReconnectConfig,R}(O))}Cm=new WeakSet,E0=function(O){if(typeof O!="string"||!/^[a-zA-Z0-9_-]+$/.test(O))throw new xt(vu)};const T0="1.19.0";var dn,ua=i(6486);(function(O){O.PUBLISH="publish",O.SUBSCRIBE="subscribe",O.JOIN="join",O.LEAVE="leave"})(dn||(dn={}));const x0=2;class Eu extends qn{constructor(S){super(bn.LEAVE,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.LEAVE,event_endpoint:S.eventEndpoint,whip_endpoint:S.whipEndpoint,reason:S.reason}),this.critical=!0}}class Xc{constructor(){this.emitter=new eo}on(S,R,M){R.call=function(P,B){return function(H,...te){try{B.apply(H,te)}catch(ie){let K=`Error in callback for ${P}`;const se=B.name;return se&&(K+=` for function ${se}`),void console.error(`${K}
`,ie)}}}(S,R),this.emitter.on(S,R,M)}off(S,R,M){this.emitter.off(S,R,M)}emit(S,...R){this.emitter.emit(S,...R)}removeAllListeners(){this.emitter.removeAllListeners()}}function w0(O){const S="0123456789abcdef";let R="";for(let M=0;M<O;M+=1)R+=S.charAt(Math.floor(Math.random()*S.length));return R}class Sp{constructor(){const S=w0;this.value=`${S(8)}-${S(4)}-${S(4)}-${S(4)}-${S(12)}`}}function xa(){return new Sp}class mE{constructor(){const S=(Date.now()/1e3|0).toString(16);this.value=`1-${S}-${w0(24)}`}}function fc(){return new mE}var Ts=i(9669),Ks=i.n(Ts);class Ir extends xt{constructor({token:S,traceId:R,code:M,tag:P,location:B,message:H,details:te,remoteParticipantId:ie,requestUUID:K,fatal:se,nominal:he,action:pe}){super({name:"StageClientError",message:H,code:M}),Error.captureStackTrace&&Error.captureStackTrace(this,Ir),this.action=pe,this.token=S,this.traceId=R,this.code=M,this.tag=P,this.location=B,this.message=H,this.details=te,this.remoteParticipantId=ie,this.requestUUID=K,this.fatal=se,this.nominal=he}}const pc={JOIN_RELATED:"signalling_session",PUBLISH_RELATED:"webrtc_sink",UNPUBLISH_RELATED:"webrtc_unsink",SUBSCRIBE_RELATED:"webrtc_source"};function To(O,S){switch(O){case dn.PUBLISH:return pc.PUBLISH_RELATED;case dn.SUBSCRIBE:return`webrtc_source:${S}`;default:return"unknown"}}function Tp(O,S){var R,M,P,B;const H={code:O.code,message:`${O.message}: ${S.name} ${S.message}`,fatal:(R=O.fatal)!==null&&R!==void 0&&R,nominal:(M=O.nominal)!==null&&M!==void 0&&M};return S instanceof Ir&&(H.fatal=(P=S.fatal)!==null&&P!==void 0&&P,H.nominal=(B=S.nominal)!==null&&B!==void 0&&B),H}function C0(O,S){if(O===0)return Bt.UNKNOWN_SERVER_ERROR;if(!(O<400))if(O>=400&&O<=403)switch(S){case xo.TokenExpired:return Bt.EXPIRED_TOKEN;case xo.NoPermissions:return Bt.TOKEN_PERMISSIONS_DENIED;case xo.StageAtCapacity:return Bt.STAGE_AT_CAPACITY;case xo.NoMatchingCodec:return Bt.NO_MATCHING_CODEC;default:return Bt.UNKNOWN_SERVER_ERROR}else{if(O===404)return S===xo.RemoteStreamNotFound?Bt.REMOTE_STREAM_NOT_FOUND:Bt.UNKNOWN_SERVER_ERROR;if(O===412)return S===xo.AbortedMHCPError?Bt.MHCP_ABORTED:Bt.UNKNOWN_SERVER_ERROR;if(O===429)return S===xo.StageAuthThrottled?Bt.STAGE_AUTH_THROTTLED:Bt.WHIP_TOO_MANY_REQUESTS;if(O!==500)return Bt.UNKNOWN_SERVER_ERROR;switch(S){case xo.InternalMHCPError:return Bt.INTERNAL_MHCP_ERROR;case xo.UnreachableMHCP:return Bt.UNREACHABLE_MHCP;case xo.InvalidSessionStatus:return Bt.INVALID_SESSION_STATUS;default:return Bt.INTERNAL_SERVER_ERROR}}}var xo;(function(O){O[O.Unspecified=2001]="Unspecified",O[O.TokenExpired=2002]="TokenExpired",O[O.NoPermissions=2003]="NoPermissions",O[O.RemoteStreamNotFound=2004]="RemoteStreamNotFound",O[O.StageAtCapacity=2005]="StageAtCapacity",O[O.InternalMHCPError=2006]="InternalMHCPError",O[O.UncategorizedMHCPError=2007]="UncategorizedMHCPError",O[O.UnreachableMHCP=2008]="UnreachableMHCP",O[O.InvalidSessionStatus=2010]="InvalidSessionStatus",O[O.PostWithoutOptions=2011]="PostWithoutOptions",O[O.AbortedMHCPError=2012]="AbortedMHCPError",O[O.StageAuthThrottled=2013]="StageAuthThrottled",O[O.NoMatchingCodec=2014]="NoMatchingCodec"})(xo||(xo={}));const Bt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},NO_CANDIDATES:{code:1022,message:"No ICE candidates",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNCATEGORIZED_MHCP_ERROR:{code:1029,message:"Authorization failed due to uncategorized MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},POST_WITHOUT_OPTIONS:{code:1032,message:"Cannot POST without OPTIONS in mandatory TURN",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},CHIME_MEETING_NOT_FOUND:{code:1098,message:"Meeting or Attendee was deleted",fatal:!0,nominal:!0},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message",fatal:!1,nominal:!1},WHIP_SESSION_RESOURCE_DELETED:{code:1206,message:"WHIP signaling session resource not found",fatal:!0,nominal:!0},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_OPTIONS_FAILURE:{code:1501,message:"Failed to get ICE Servers from OPTIONS",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PING_SEND_FAIL:{code:1303,message:"Ping send fail",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var wa;(function(O){O.UNPUBLISH="unpublish",O.UNSUBSCRIBE="unsubscribe",O.UNLOAD="unload",O.CONNECTION_FAIL="connection fail",O.REASSIGNMENT="reassignment"})(wa||(wa={}));const Rm="stageJoined",df="stageParticipantJoined",hd="stageParticipantLeft",ha="stageParticipantKicked",R0="stageParticipantUpdated",mc="localPublishingChanged",yx="stageRefresh",bl="stateChange",xp="error",jl="reassignmentRequest",ff="incompatibleCodecs",Am="connectionStateChange",ge="stageStreamUpdate",dd="error",fh="stageStreamSeiMessageReceived",no="transformError",Br="reassignmentStarted",fd="reassignmentSuccess",Su="reassignmentFailed",Kc="open",Tu="closed",gc="messageParseError",Dy="refresh",Vl="error",Py="stageStateMessage",A0="sdpAnswer",M0="disconnectMessage",pf="reassignmentMessage",wo="incompatibleCodecs";function gE(O){return R=function(M){return M.replace(/-/g,"+").replace(/_/g,"/").padEnd(M.length+(4-M.length%4)%4,"=")}(O),window.atob(R);var R}class qo{constructor(S,R){this.analyticsTracker=R,this.rawToken=S;const M=S.split(".");if(M.length!==3)throw Error(`Token format incorrect. length: ${M.length}`);try{this.header=JSON.parse(gE(M[0]))}catch(H){const te=H instanceof Error?`: ${H.message}`:"";throw Error(`Error parsing Stage Token header${te}`)}try{this.claims=JSON.parse(gE(M[1]))}catch(H){const te=H instanceof Error?`: ${H.message}`:"";throw Error(`Error parsing Stage Token claims${te}`)}this.signature=M[2];const{claims:P}=this;this.stageARN=P.resource,this.participantID=P.jti,this.eventsURL=P.events_url,this.whipURL=ad("whipUrl")||P.whip_url,this.userID=P.user_id,this.expirationTime=P.exp,this.topic=P.topic,this.parseVersionFlags(P.version);const{attributes:B}=P;B&&(this.attrGsRole=B.gs_role,this.attrGsSessionId=B.gs_session_id)}getPublishEndpoint(){let S="";return this.whipURL&&this.participantID&&(S=`${this.whipURL}/publish/${this.participantID}`),S}getSubscribeEndpoint(S){let R="";return this.whipURL&&(R=`${this.whipURL}/subscribe/${S}`),R}assertTokenIsUnexpired(S,R,M,P){(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Ir(Object.assign(Object.assign({},Bt.EXPIRED_TOKEN),{action:dn.JOIN,location:M,tag:R,token:this,traceId:S,remoteParticipantId:P,message:Bt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(S){if(!S)return;const R=S.split(".");R.length===2&&(this.versionFlags=parseInt(R[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||(this.versionFlags&x0)!=0}}function xu(O,S){return new qo(O,S)}class O0{constructor(S,R){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=S,this.trailing=!(R&&R.skipTrailing)}invoke(S,...R){return this.throttled?(this.trailingFn=S,this.trailingFnArgs=R,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),S(...R),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class pd extends qn{constructor(S,R,M,P,B,H,te,ie){super(bn.SERVER_REQUEST,R,te,!0),Object.assign(this.properties,{action:S,http_method:P,remote_participant_id:H,request_uuid:B,url:M,transport:ie})}}const vc="draft-ietf-wish-whip-04";var ls,Ly=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};function mf(O,S){return Ly(this,void 0,void 0,function*(){O.validateStatus=M=>M>=200&&M<300||M===403;const R=yield Ks()(O);if(R.status===403){if(R.data.code===2003)throw new Ts.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",O,R.request,R);return O.url===R.request.responseURL?(O.validateStatus=M=>M>=200&&M<300,Ks()(O)):(O.url=R.request.responseURL,S<5?mf(O,S+1):(O.validateStatus=M=>M>=200&&M<300,Ks()(O)))}return R})}function El(O){return Ly(this,void 0,void 0,function*(){return mf(O,0)})}function N0(){}function vE(O){switch(O){case"new":return at.NEW;case"closed":return at.CLOSED;case"disconnected":return at.DISCONNECTED;case"failed":return at.FAILED;case"idle":return at.IDLE;case"checking":case"connecting":return at.CONNECTING;case"completed":case"connected":return at.CONNECTED;default:throw new Error(`unknown connecion state: ${O}`)}}function Mm(O,S,R){let M=document.createElement(S);const P=()=>{M&&(M.removeEventListener("loadeddata",B),M.removeEventListener("error",P),M.srcObject=null,M.src="",M=null)},B=()=>{P(),R(S)};return M.addEventListener("loadeddata",B),M.addEventListener("error",P),M.srcObject=O,P}class Om extends qn{constructor(S,R,M,P,B){super(bn.TRACE,S,R,!1),Object.assign(this.properties,{action:P,message:M,remote_participant_id:B})}}class Ba extends qn{constructor(S,R,M,P,B){super(bn.CONNECTION_STATE,R,M,!1),Object.assign(this.properties,{action:S,remote_participant_id:B,state:P})}}class I0 extends qn{constructor(S,R,M,P,B){super(bn.ICE_GATHERING_STATE,R,M,!1),Object.assign(this.properties,{action:S,remote_participant_id:B,state:P})}}(function(O){O.POST="post",O.CONNECTED="connected",O.ICE_GATHERING="icegathering",O.SDP_EXCHANGE="sdpExchange",O.SET_REMOTE_DESC="setRemoteDesc",O.PEER_CONNECTION="peerConnection"})(ls||(ls={}));const yE="start",wu="stop";class _E{constructor(S,R){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=S,this.traceId=R}markActionStart(){this.markStart(ls.CONNECTED)}markPostStart(){this.markStart(ls.POST)}markPostStop(){this.markStop(ls.POST),this.postDuration=this.measure(ls.POST)}markIceGatheringStart(){this.markStart(ls.ICE_GATHERING)}markIceGatheringStop(){this.markStop(ls.ICE_GATHERING),this.timeToCandidate=this.measure(ls.ICE_GATHERING)}markActionStop(){this.markStop(ls.CONNECTED),this.timeToConnected=this.measure(ls.CONNECTED),this.markStop(ls.PEER_CONNECTION),this.peerConnectionDuration=this.measure(ls.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(ls.SET_REMOTE_DESC)}markSetRemoteDescStop(){const S=ls.SET_REMOTE_DESC;this.markStop(S),this.setRemoteDescDuration=this.measure(S),this.markStart(ls.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(ls.SDP_EXCHANGE)}markSdpExchangeStop(){const S=ls.SDP_EXCHANGE;this.markStop(S),this.sdpExchangeDuration=this.measure(S)}setTransport(S){this.sdpExchangeTransport=S}markStart(S){this.marks[`${this.namespace}.${S}.${yE}`]=performance.now()}markStop(S){this.marks[`${this.namespace}.${S}.${wu}`]=performance.now()}measure(S){const R=`${this.namespace}.${S}.${yE}`,M=`${this.namespace}.${S}.${wu}`,P=this.marks[R],B=this.marks[M];return P===void 0||B===void 0?0:B-P}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:S,postDuration:R,timeToCandidate:M,timeToConnected:P,sdpExchangeDuration:B,sdpExchangeTransport:H,setRemoteDescDuration:te,peerConnectionDuration:ie}=this;return{optionsDuration:S,postDuration:R,timeToCandidate:M,timeToConnected:P,sdpExchangeDuration:B,sdpExchangeTransport:H,setRemoteDescDuration:te,peerConnectionDuration:ie}}resetMeasurements(S){this.traceId=S,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var Cu,js,Gl;(function(O){O.VIDEO="video",O.AUDIO="audio"})(Cu||(Cu={})),function(O){O.DEFAULT="default",O.LOW="low",O.MEDIUM="medium",O.HIGH="high"}(js||(js={})),function(O){O.LOWEST_QUALITY="lowest_quality",O.HIGHEST_QUALITY="highest_quality"}(Gl||(Gl={}));var da=i(766);class zi{constructor(S){this.sdp=S}static splitLines(S){return S.trim().split(`
`).map(R=>R.trim())}static splitSections(S){return S.split(`
m=`).map((R,M)=>(M>0?`m=${R}`:R).trim()+zi.CRLF)}getUniqueRtpHeaderExtensionId(S){const R=[];for(const P of S)if(/^a=extmap:/.test(P.trim())){const B=+P.split("a=extmap:")[1].split(" ")[0];R.includes(B)||R.push(B)}R.sort((P,B)=>P-B);let M=0;for(const P of R){if(P-M>1)return M+1;M=P}return M===14?-1:M+1}withVideoLayersAllocationRtpHeaderExtension(S){const R="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",M=S?S.getRtpHeaderExtensionId(R):-1,P=M===-1?this.getUniqueRtpHeaderExtensionId(zi.splitLines(this.sdp)):M,B=zi.splitSections(this.sdp),H=[];for(let ie of B){if(/^m=video/.test(ie)&&zi.getRtpHeaderExtensionIdInSection(ie,R)===-1){const K=zi.splitLines(ie),se=[];if(P===-1||this.hasRtpHeaderExtensionId(P)){H.push(ie);continue}for(const he of K)if(se.push(he),/^a=sendrecv/.test(he.trim())){const pe=`a=extmap:${P} ${R}`;se.push(pe)}ie=se.join(zi.CRLF)+zi.CRLF}else if(M!==-1&&/^m=video/.test(ie)&&zi.getRtpHeaderExtensionIdInSection(ie,R)!==M){const K=zi.splitLines(ie),se=[];for(const he of K){if(/^a=extmap:/.test(he.trim())&&he.split("a=extmap:")[1].split(" ")[1]===R){if(!this.hasRtpHeaderExtensionId(M)){const pe=`a=extmap:${M} ${R}`;se.push(pe)}continue}se.push(he)}ie=se.join(zi.CRLF)+zi.CRLF}H.push(ie)}const te=H.join("");return new zi(te)}withOpusAudioConfig(S,R){const M=da.Qc(this.sdp);for(const P of M.media)if(P.type==="audio"){const{payload:B}=P.rtp.find(K=>K.codec==="opus");if(!B)continue;let H=P.fmtp.find(K=>K.payload===B);H||(H={payload:B,config:""});const te=da.rz(H.config);if(te.maxaveragebitrate=S,typeof R=="boolean"){const K=R?1:0;te["sprop-stereo"]=K,te.stereo=K}let ie="";for(const K of Object.keys(te))ie+=`${K}=${te[K]}; `;H.config=ie.trim()}return new zi(da.cW(M))}static getRtpHeaderExtensionIdInSection(S,R){const M=zi.splitLines(S);for(const P of M)if(/^a=extmap:/.test(P.trim())){const B=P.split("a=extmap:")[1].split(" "),H=+B[0];if(B[1]===R)return H}return-1}getRtpHeaderExtensionId(S){const R=zi.splitSections(this.sdp);for(const M of R)if(/^m=video/.test(M)){const P=zi.getRtpHeaderExtensionIdInSection(M,S);if(P!==-1)return P}return-1}hasRtpHeaderExtensionId(S){const R=zi.splitLines(this.sdp);for(const M of R)if(/^a=extmap:/.test(M.trim())&&+M.split("a=extmap:")[1].split(" ")[0]===S)return!0;return!1}hasAudioNacksEnabled(){var S,R,M;return((M=(R=((S=da.Qc(this.sdp).media.filter(P=>P.type==="audio")[0])!==null&&S!==void 0?S:{}).rtcpFb)===null||R===void 0?void 0:R.filter(P=>P.type==="nack"))!==null&&M!==void 0?M:[]).length>0}}zi.CRLF=`\r
`,zi.rfc7587LowestBitrate=6e3,zi.rfc7587HighestBitrate=51e4;const Nm=200,Im=2500,Uy=10,yc=30,k0=12,oi=128,D0={[js.DEFAULT]:0,[js.LOW]:50,[js.MEDIUM]:150,[js.HIGH]:250},_x={[js.DEFAULT]:0,[js.LOW]:100,[js.MEDIUM]:200,[js.HIGH]:300},bE=()=>({minBitrate:Nm,maxBitrate:Im,maxFramerate:yc,simulcast:{enabled:!1},maxAudioBitrateKbps:64,stereo:!1});var EE=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};const bx="H264",By=O=>{const S=O==null?void 0:O.split("/");if((S==null?void 0:S.length)===2)return S[1]},Ru=(O,S)=>{const R=By(O);if(O===void 0||R===void 0)return;const M={mimeSubtype:R};if(S){const P=(B=>{const H=B.split(";"),te=new Map;for(const ie of H){const[K,se]=ie.split("=");te.set(K,se)}return te})(S);switch(R){case bx:{const B=P.get("profile-level-id");B&&((H,te)=>{if(te.length<6)return;const ie=te.substring(0,4),K=parseInt(te.substring(4,6),16);H.profile=ie,H.level=K})(M,B);break}case"H265":((B,H)=>{const te=H.get("profile-id")||"0",ie=H.get("tier-flag")||"0",K=parseInt(H.get("level-id")||"0",10),se=[ie,te].join("_");B.profile=se,B.level=K})(M,P)}}return M},P0=(O,S)=>O.sort((R,M)=>{if(By(R.mimeType)===bx){const P=Ru(R.mimeType,R.sdpFmtpLine);if((P==null?void 0:P.profile)===S)return-1}return 0}),ph=(O,S)=>{var R;const M=Ru(O.mimeType,O.sdpFmtpLine);return(M==null?void 0:M.mimeSubtype.toLowerCase())===S.mime.toLowerCase()&&((R=M==null?void 0:M.profile)===null||R===void 0?void 0:R.toLowerCase().indexOf(S.config.toLowerCase()))===0},L0=(O,S)=>S.filter(R=>!R.mimeType.endsWith("rtx")).filter(R=>R.mimeType.indexOf("packetization-mode=0")===-1).find(R=>O.reduce((M,P)=>M&&ph(R,P)===!1,!0));class U0 extends qn{constructor(S,R,M,P,B,H,te,ie,K){var se,he;super(bn.PUBLISHED_VIDEO_STATS,S,R,!1),Object.assign(this.properties,Object.assign({action:dn.PUBLISH,node:(se=M==null?void 0:M.node)!==null&&se!==void 0?se:"",cluster:(he=M==null?void 0:M.cluster)!==null&&he!==void 0?he:""},((pe,Ne,Je,Ye,Oe,_e)=>{var lt,wt,Kt,It,Kn,wn,yr,Fr,kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji,ys,Zi,ds,Qi,Ii,hi,$i,es,fs,Js,pa;const _s=(wt=(lt=pe==null?void 0:pe.qualityLimitationDurations)===null||lt===void 0?void 0:lt.cpu)!==null&&wt!==void 0?wt:0,ks=(It=(Kt=pe==null?void 0:pe.qualityLimitationDurations)===null||Kt===void 0?void 0:Kt.bandwidth)!==null&&It!==void 0?It:0,di=Math.max((Kn=pe==null?void 0:pe.bytesSent)!==null&&Kn!==void 0?Kn:0,0),Ra=8*di/(_e??1),Zn=Math.max((wn=Ne==null?void 0:Ne.packetsLost)!==null&&wn!==void 0?wn:0,0),Gr=Math.max((yr=pe==null?void 0:pe.packetsSent)!==null&&yr!==void 0?yr:0,0),Mi=Zn/Math.max(Gr,1),Va=Ru(Ye==null?void 0:Ye.mimeType,Ye==null?void 0:Ye.sdpFmtpLine);return{active:!!(pe!=null&&pe.framesPerSecond)&&pe.framesPerSecond!==0,bytes_sent:di,codec_mime_type:Va==null?void 0:Va.mimeSubtype,codec_profile:Va==null?void 0:Va.profile,codec_level:Va==null?void 0:Va.level,configured_bitrate:Oe==null?void 0:Oe.max_bitrate,connection_bandwidth:(Fr=Je==null?void 0:Je.availableOutgoingBitrate)!==null&&Fr!==void 0?Fr:0,encode_bitrate:Ra,encoder_implementation:(kr=pe==null?void 0:pe.encoderImplementation)!==null&&kr!==void 0?kr:"unknown",fir_count:(xr=pe==null?void 0:pe.firCount)!==null&&xr!==void 0?xr:0,fraction_packets_lost:Mi,frame_height:Math.max((_r=pe==null?void 0:pe.frameHeight)!==null&&_r!==void 0?_r:0,0),frame_width:Math.max((Rr=pe==null?void 0:pe.frameWidth)!==null&&Rr!==void 0?Rr:0,0),frames_encoded:(Dr=pe==null?void 0:pe.framesEncoded)!==null&&Dr!==void 0?Dr:0,frames_per_second:Math.max((br=pe==null?void 0:pe.framesPerSecond)!==null&&br!==void 0?br:0,0),frames_sent:(Ar=pe==null?void 0:pe.framesSent)!==null&&Ar!==void 0?Ar:0,header_bytes_sent:(ur=pe==null?void 0:pe.headerBytesSent)!==null&&ur!==void 0?ur:0,huge_frames_sent:(Tn=pe==null?void 0:pe.hugeFramesSent)!==null&&Tn!==void 0?Tn:0,key_frames_encoded:($n=pe==null?void 0:pe.keyFramesEncoded)!==null&&$n!==void 0?$n:0,nack_count:($r=pe==null?void 0:pe.nackCount)!==null&&$r!==void 0?$r:0,packets_lost:Zn,packets_sent:Gr,power_efficient_encoder:(Ji=pe==null?void 0:pe.powerEfficientEncoder)!==null&&Ji!==void 0&&Ji,pli_count:(ys=pe==null?void 0:pe.pliCount)!==null&&ys!==void 0?ys:0,quality_limitation_reason:(Zi=pe==null?void 0:pe.qualityLimitationReason)!==null&&Zi!==void 0?Zi:"none",quality_limitation_resolution_changes:(ds=pe==null?void 0:pe.qualityLimitationResolutionChanges)!==null&&ds!==void 0?ds:0,quality_limitation_cpu_duration:_s,quality_limitation_bandwidth_duration:ks,retransmitted_bytes_sent:(Qi=pe==null?void 0:pe.retransmittedBytesSent)!==null&&Qi!==void 0?Qi:0,retransmitted_packets_sent:(Ii=pe==null?void 0:pe.retransmittedPacketsSent)!==null&&Ii!==void 0?Ii:0,rid:(hi=pe==null?void 0:pe.rid)!==null&&hi!==void 0?hi:"no-rid",scalability_mode:($i=pe==null?void 0:pe.scalabilityMode)!==null&&$i!==void 0?$i:"unknown",target_bitrate:Math.max((es=pe==null?void 0:pe.targetBitrate)!==null&&es!==void 0?es:0,0),total_encode_time:(fs=pe==null?void 0:pe.totalEncodeTime)!==null&&fs!==void 0?fs:0,total_encoded_bytes_target:(Js=pe==null?void 0:pe.totalEncodedBytesTarget)!==null&&Js!==void 0?Js:0,total_packet_send_delay:(pa=pe==null?void 0:pe.totalPacketSendDelay)!==null&&pa!==void 0?pa:0}})(P,B,H,te,ie,K)))}}class gf extends qn{constructor(S,R,M,P,B,H,te,ie,K,se){var he,pe,Ne,Je;super(bn.PUBLISHED_VIDEO_STATS_WINDOW,S,R,!1);const Ye=Math.max(((he=P==null?void 0:P.timestamp)!==null&&he!==void 0?he:0)-((pe=B==null?void 0:B.timestamp)!==null&&pe!==void 0?pe:0),0);Object.assign(this.properties,Object.assign({action:dn.PUBLISH,node:(Ne=M==null?void 0:M.node)!==null&&Ne!==void 0?Ne:"",cluster:(Je=M==null?void 0:M.cluster)!==null&&Je!==void 0?Je:"",window_size_ms:Ye},((Oe,_e,lt,wt,Kt,It,Kn,wn)=>{var yr,Fr,kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji,ys,Zi,ds,Qi,Ii,hi,$i,es,fs,Js,pa,_s,ks,di,Ra,Zn,Gr,Mi,Va,Mo,bc,Qc,ps,Zo,Th,$l,Aa,co,Oo,Qo,bf,Ef,Pp,Gs,bd,xh,Uu,Cl;const Q0=(Fr=(yr=Oe==null?void 0:Oe.qualityLimitationDurations)===null||yr===void 0?void 0:yr.cpu)!==null&&Fr!==void 0?Fr:0,Zy=(xr=(kr=_e==null?void 0:_e.qualityLimitationDurations)===null||kr===void 0?void 0:kr.cpu)!==null&&xr!==void 0?xr:0,ev=(Rr=(_r=Oe==null?void 0:Oe.qualityLimitationDurations)===null||_r===void 0?void 0:_r.bandwidth)!==null&&Rr!==void 0?Rr:0,Wi=(br=(Dr=_e==null?void 0:_e.qualityLimitationDurations)===null||Dr===void 0?void 0:Dr.bandwidth)!==null&&br!==void 0?br:0,tv=Math.max(((Ar=Oe==null?void 0:Oe.bytesSent)!==null&&Ar!==void 0?Ar:0)-((ur=_e==null?void 0:_e.bytesSent)!==null&&ur!==void 0?ur:0),0),wh=8*tv/(typeof wn!="number"?1:wn/1e3),b=Math.max(((Tn=lt==null?void 0:lt.packetsLost)!==null&&Tn!==void 0?Tn:0)-(($n=wt==null?void 0:wt.packetsLost)!==null&&$n!==void 0?$n:0),0),w=Math.max((($r=Oe==null?void 0:Oe.packetsSent)!==null&&$r!==void 0?$r:0)-((Ji=_e==null?void 0:_e.packetsSent)!==null&&Ji!==void 0?Ji:0),0),F=b/Math.max(w,1),Q=Ru(It==null?void 0:It.mimeType,It==null?void 0:It.sdpFmtpLine);return{active:!!(Oe!=null&&Oe.framesPerSecond)&&(Oe==null?void 0:Oe.framesPerSecond)!==0,bytes_sent:tv,codec_mime_type:Q==null?void 0:Q.mimeSubtype,codec_profile:Q==null?void 0:Q.profile,codec_level:Q==null?void 0:Q.level,configured_bitrate:Kn==null?void 0:Kn.max_bitrate,connection_bandwidth:(ys=Kt==null?void 0:Kt.availableOutgoingBitrate)!==null&&ys!==void 0?ys:0,encode_bitrate:wh,encoder_implementation:(Zi=Oe==null?void 0:Oe.encoderImplementation)!==null&&Zi!==void 0?Zi:"unknown",fir_count:Math.max(((ds=Oe==null?void 0:Oe.firCount)!==null&&ds!==void 0?ds:0)-((Qi=_e==null?void 0:_e.firCount)!==null&&Qi!==void 0?Qi:0),0),fraction_packets_lost:F,frame_height:Math.max((Ii=Oe==null?void 0:Oe.frameHeight)!==null&&Ii!==void 0?Ii:0,0),frame_width:Math.max((hi=Oe==null?void 0:Oe.frameWidth)!==null&&hi!==void 0?hi:0,0),frames_encoded:Math.max((($i=Oe==null?void 0:Oe.framesEncoded)!==null&&$i!==void 0?$i:0)-((es=_e==null?void 0:_e.framesEncoded)!==null&&es!==void 0?es:0),0),frames_per_second:Math.max((fs=Oe==null?void 0:Oe.framesPerSecond)!==null&&fs!==void 0?fs:0,0),frames_sent:Math.max(((Js=Oe==null?void 0:Oe.framesSent)!==null&&Js!==void 0?Js:0)-((pa=_e==null?void 0:_e.framesSent)!==null&&pa!==void 0?pa:0),0),header_bytes_sent:Math.max(((_s=Oe==null?void 0:Oe.headerBytesSent)!==null&&_s!==void 0?_s:0)-((ks=_e==null?void 0:_e.headerBytesSent)!==null&&ks!==void 0?ks:0),0),huge_frames_sent:Math.max(((di=Oe==null?void 0:Oe.hugeFramesSent)!==null&&di!==void 0?di:0)-((Ra=_e==null?void 0:_e.hugeFramesSent)!==null&&Ra!==void 0?Ra:0),0),key_frames_encoded:Math.max(((Zn=Oe==null?void 0:Oe.keyFramesEncoded)!==null&&Zn!==void 0?Zn:0)-((Gr=_e==null?void 0:_e.keyFramesEncoded)!==null&&Gr!==void 0?Gr:0),0),nack_count:Math.max(((Mi=Oe==null?void 0:Oe.nackCount)!==null&&Mi!==void 0?Mi:0)-((Va=_e==null?void 0:_e.nackCount)!==null&&Va!==void 0?Va:0),0),packets_lost:b,packets_sent:w,power_efficient_encoder:(Mo=Oe==null?void 0:Oe.powerEfficientEncoder)!==null&&Mo!==void 0&&Mo,pli_count:Math.max(((bc=Oe==null?void 0:Oe.pliCount)!==null&&bc!==void 0?bc:0)-((Qc=_e==null?void 0:_e.pliCount)!==null&&Qc!==void 0?Qc:0),0),quality_limitation_reason:(ps=Oe==null?void 0:Oe.qualityLimitationReason)!==null&&ps!==void 0?ps:"none",quality_limitation_resolution_changes:Math.max(((Zo=Oe==null?void 0:Oe.qualityLimitationResolutionChanges)!==null&&Zo!==void 0?Zo:0)-((Th=_e==null?void 0:_e.qualityLimitationResolutionChanges)!==null&&Th!==void 0?Th:0),0),quality_limitation_cpu_duration:Math.max(Q0-Zy,0),quality_limitation_bandwidth_duration:Math.max(ev-Wi,0),retransmitted_bytes_sent:Math.max((($l=Oe==null?void 0:Oe.retransmittedBytesSent)!==null&&$l!==void 0?$l:0)-((Aa=_e==null?void 0:_e.retransmittedBytesSent)!==null&&Aa!==void 0?Aa:0),0),rid:(co=Oe==null?void 0:Oe.rid)!==null&&co!==void 0?co:"no-rid",retransmitted_packets_sent:Math.max(((Oo=Oe==null?void 0:Oe.retransmittedPacketsSent)!==null&&Oo!==void 0?Oo:0)-((Qo=_e==null?void 0:_e.retransmittedPacketsSent)!==null&&Qo!==void 0?Qo:0),0),scalability_mode:(bf=Oe==null?void 0:Oe.scalabilityMode)!==null&&bf!==void 0?bf:"unknown",target_bitrate:Math.max((Ef=Oe==null?void 0:Oe.targetBitrate)!==null&&Ef!==void 0?Ef:0,0),total_encode_time:Math.max(((Pp=Oe==null?void 0:Oe.totalEncodeTime)!==null&&Pp!==void 0?Pp:0)-((Gs=_e==null?void 0:_e.totalEncodeTime)!==null&&Gs!==void 0?Gs:0),0),total_encoded_bytes_target:Math.max(((bd=Oe==null?void 0:Oe.totalEncodedBytesTarget)!==null&&bd!==void 0?bd:0)-((xh=_e==null?void 0:_e.totalEncodedBytesTarget)!==null&&xh!==void 0?xh:0),0),total_packet_send_delay:Math.max(((Uu=Oe==null?void 0:Oe.totalPacketSendDelay)!==null&&Uu!==void 0?Uu:0)-((Cl=_e==null?void 0:_e.totalPacketSendDelay)!==null&&Cl!==void 0?Cl:0),0)}})(P,B,H,te,ie,K,se,Ye)))}}class SE extends qn{constructor(S,R,M,P,B,H,te,ie,K,se){var he,pe;super(bn.PUBLISHED_AUDIO_STATS,S,R,!1),Object.assign(this.properties,Object.assign({action:dn.PUBLISH,node:(he=M==null?void 0:M.node)!==null&&he!==void 0?he:"",cluster:(pe=M==null?void 0:M.cluster)!==null&&pe!==void 0?pe:""},((Ne,Je,Ye,Oe,_e,lt,wt)=>{var Kt,It,Kn,wn,yr,Fr,kr,xr,_r,Rr,Dr;const br=Math.max((Kt=Ne==null?void 0:Ne.bytesSent)!==null&&Kt!==void 0?Kt:0,0),Ar=8*br/(lt??1),ur=Math.max((It=Je==null?void 0:Je.packetsLost)!==null&&It!==void 0?It:0,0),Tn=Math.max((Kn=Ne==null?void 0:Ne.packetsSent)!==null&&Kn!==void 0?Kn:0,0),$n=ur/Math.max(Tn,1),$r=Ru(Oe==null?void 0:Oe.mimeType,Oe==null?void 0:Oe.sdpFmtpLine);return{audio_nacks_enabled:(wn=wt==null?void 0:wt.audioNacks)!==null&&wn!==void 0&&wn,bytes_sent:br,codec_mime_type:$r==null?void 0:$r.mimeSubtype,configured_bitrate:(yr=_e==null?void 0:_e.max_audio_bitrate_bps)!==null&&yr!==void 0?yr:0,connection_bandwidth:(Fr=Ye==null?void 0:Ye.availableOutgoingBitrate)!==null&&Fr!==void 0?Fr:0,encode_bitrate:Ar,fraction_packets_lost:$n,header_bytes_sent:(kr=Ne==null?void 0:Ne.headerBytesSent)!==null&&kr!==void 0?kr:0,nack_count:(xr=Ne==null?void 0:Ne.nackCount)!==null&&xr!==void 0?xr:0,packets_lost:ur,packets_sent:Tn,retransmitted_bytes_sent:(_r=Ne==null?void 0:Ne.retransmittedBytesSent)!==null&&_r!==void 0?_r:0,retransmitted_packets_sent:(Rr=Ne==null?void 0:Ne.retransmittedPacketsSent)!==null&&Rr!==void 0?Rr:0,target_bitrate:(Dr=Ne==null?void 0:Ne.targetBitrate)!==null&&Dr!==void 0?Dr:0}})(P,B,H,te,ie,K,se)))}}class B0 extends qn{constructor(S,R,M,P,B,H,te,ie,K,se,he){var pe,Ne,Je,Ye;super(bn.PUBLISHED_AUDIO_STATS_WINDOW,S,R,!1);const Oe=Math.max(((pe=P==null?void 0:P.timestamp)!==null&&pe!==void 0?pe:0)-((Ne=B==null?void 0:B.timestamp)!==null&&Ne!==void 0?Ne:0),0);Object.assign(this.properties,Object.assign({action:dn.PUBLISH,node:(Je=M==null?void 0:M.node)!==null&&Je!==void 0?Je:"",cluster:(Ye=M==null?void 0:M.cluster)!==null&&Ye!==void 0?Ye:"",window_size_ms:Oe},((_e,lt,wt,Kt,It,Kn,wn,yr,Fr)=>{var kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji,ys,Zi,ds,Qi,Ii,hi,$i,es;const fs=Math.max(((kr=_e==null?void 0:_e.bytesSent)!==null&&kr!==void 0?kr:0)-((xr=lt==null?void 0:lt.bytesSent)!==null&&xr!==void 0?xr:0),0),Js=8*fs/(typeof yr!="number"?1:yr/1e3),pa=Math.max(((_r=wt==null?void 0:wt.packetsLost)!==null&&_r!==void 0?_r:0)-((Rr=Kt==null?void 0:Kt.packetsLost)!==null&&Rr!==void 0?Rr:0),0),_s=Math.max(((Dr=_e==null?void 0:_e.packetsSent)!==null&&Dr!==void 0?Dr:0)-((br=lt==null?void 0:lt.packetsSent)!==null&&br!==void 0?br:0),0),ks=pa/Math.max(_s,1),di=Ru(Kn==null?void 0:Kn.mimeType,Kn==null?void 0:Kn.sdpFmtpLine);return{audio_nacks_enabled:(Ar=Fr==null?void 0:Fr.audioNacks)!==null&&Ar!==void 0&&Ar,bytes_sent:fs,codec_mime_type:di==null?void 0:di.mimeSubtype,configured_bitrate:(ur=wn==null?void 0:wn.max_audio_bitrate_bps)!==null&&ur!==void 0?ur:0,connection_bandwidth:(Tn=It==null?void 0:It.availableOutgoingBitrate)!==null&&Tn!==void 0?Tn:0,encode_bitrate:Js,fraction_packets_lost:ks,header_bytes_sent:Math.max((($n=_e==null?void 0:_e.headerBytesSent)!==null&&$n!==void 0?$n:0)-(($r=lt==null?void 0:lt.headerBytesSent)!==null&&$r!==void 0?$r:0),0),nack_count:Math.max(((Ji=_e==null?void 0:_e.nackCount)!==null&&Ji!==void 0?Ji:0)-((ys=lt==null?void 0:lt.nackCount)!==null&&ys!==void 0?ys:0),0),packets_lost:pa,packets_sent:Math.max(((Zi=_e==null?void 0:_e.packetsSent)!==null&&Zi!==void 0?Zi:0)-((ds=lt==null?void 0:lt.packetsSent)!==null&&ds!==void 0?ds:0),0),retransmitted_bytes_sent:Math.max(((Qi=_e==null?void 0:_e.retransmittedBytesSent)!==null&&Qi!==void 0?Qi:0)-((Ii=lt==null?void 0:lt.retransmittedBytesSent)!==null&&Ii!==void 0?Ii:0),0),retransmitted_packets_sent:Math.max(((hi=_e==null?void 0:_e.retransmittedPacketsSent)!==null&&hi!==void 0?hi:0)-(($i=lt==null?void 0:lt.retransmittedPacketsSent)!==null&&$i!==void 0?$i:0),0),target_bitrate:Math.max((es=_e==null?void 0:_e.targetBitrate)!==null&&es!==void 0?es:0,0)}})(P,B,H,te,ie,K,se,Oe,he)))}}class Fy extends qn{constructor(S,R,M,P,B,H,te,ie){var K,se;super(bn.SUBSCRIBED_VIDEO_STATS,S,R,!1),Object.assign(this.properties,Object.assign({action:dn.SUBSCRIBE,node:(K=P==null?void 0:P.node)!==null&&K!==void 0?K:"",cluster:(se=P==null?void 0:P.cluster)!==null&&se!==void 0?se:"",remote_participant_id:M},((he,pe,Ne,Je)=>{var Ye,Oe,_e,lt,wt,Kt,It,Kn,wn,yr,Fr,kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji;let ys=0;he!=null&&he.jitterBufferDelay&&(he!=null&&he.jitterBufferEmittedCount)&&he.jitterBufferEmittedCount>0&&(ys=he.jitterBufferDelay/he.jitterBufferEmittedCount);const Zi=Je??1,ds=Math.max((Ye=he==null?void 0:he.bytesReceived)!==null&&Ye!==void 0?Ye:0,0),Qi=8*ds/Zi;let Ii=0;he!=null&&he.totalDecodeTime&&(he!=null&&he.framesDecoded)&&(Ii=he.totalDecodeTime/Math.max(he==null?void 0:he.framesDecoded,1));const hi=Math.max((Oe=he==null?void 0:he.packetsLost)!==null&&Oe!==void 0?Oe:0,0),$i=Math.max((_e=he==null?void 0:he.packetsReceived)!==null&&_e!==void 0?_e:0,0),es=hi/Math.max($i+hi,1),fs=Ru(Ne==null?void 0:Ne.mimeType,Ne==null?void 0:Ne.sdpFmtpLine);return{bytes_received:ds,codec_mime_type:fs==null?void 0:fs.mimeSubtype,codec_profile:fs==null?void 0:fs.profile,codec_level:fs==null?void 0:fs.level,connection_bandwidth:(lt=pe==null?void 0:pe.availableIncomingBitrate)!==null&&lt!==void 0?lt:0,decode_bitrate:Qi,decoder_implementation:(wt=he==null?void 0:he.decoderImplementation)!==null&&wt!==void 0?wt:"unknown",fir_count:Math.max((Kt=he==null?void 0:he.firCount)!==null&&Kt!==void 0?Kt:0,0),fraction_packets_lost:es,frame_decode_time_avg:Ii,frame_height:Math.max((It=he==null?void 0:he.frameHeight)!==null&&It!==void 0?It:0,0),frame_width:Math.max((Kn=he==null?void 0:he.frameWidth)!==null&&Kn!==void 0?Kn:0,0),frames_decoded:Math.max((wn=he==null?void 0:he.framesDecoded)!==null&&wn!==void 0?wn:0,0),frames_dropped:Math.max((yr=he==null?void 0:he.framesDropped)!==null&&yr!==void 0?yr:0,0),frames_received:Math.max((Fr=he==null?void 0:he.framesReceived)!==null&&Fr!==void 0?Fr:0,0),freeze_count:Math.max((kr=he==null?void 0:he.freezeCount)!==null&&kr!==void 0?kr:0,0),frames_rendered:Math.max((xr=he==null?void 0:he.framesRendered)!==null&&xr!==void 0?xr:0,0),frames_per_second:Math.max((_r=he==null?void 0:he.framesPerSecond)!==null&&_r!==void 0?_r:0,0),header_bytes_received:Math.max((Rr=he==null?void 0:he.headerBytesReceived)!==null&&Rr!==void 0?Rr:0,0),jitter_buffer_delay_avg:ys,key_frames_decoded:Math.max((Dr=he==null?void 0:he.keyFramesDecoded)!==null&&Dr!==void 0?Dr:0,0),nack_count:Math.max((br=he==null?void 0:he.nackCount)!==null&&br!==void 0?br:0,0),packets_discarded:Math.max((Ar=he==null?void 0:he.packetsDiscarded)!==null&&Ar!==void 0?Ar:0,0),packets_lost:hi,packets_received:$i,pause_count:Math.max((ur=he==null?void 0:he.pauseCount)!==null&&ur!==void 0?ur:0,0),pli_count:Math.max((Tn=he==null?void 0:he.pliCount)!==null&&Tn!==void 0?Tn:0,0),power_efficient_decoder:($n=he==null?void 0:he.powerEfficientDecoder)!==null&&$n!==void 0&&$n,total_freezes_duration:Math.max(($r=he==null?void 0:he.totalFreezesDuration)!==null&&$r!==void 0?$r:0,0),total_pauses_duration:Math.max((Ji=he==null?void 0:he.totalPausesDuration)!==null&&Ji!==void 0?Ji:0,0)}})(B,H,te,ie)))}}class TE extends qn{constructor(S,R,M,P,B,H,te,ie,K,se,he){var pe,Ne,Je,Ye;super(bn.SUBSCRIBED_VIDEO_STATS_WINDOW,S,R,!1);const Oe=Math.max(((pe=B==null?void 0:B.timestamp)!==null&&pe!==void 0?pe:0)-((Ne=H==null?void 0:H.timestamp)!==null&&Ne!==void 0?Ne:0),0);Object.assign(this.properties,Object.assign({action:dn.SUBSCRIBE,node:(Je=P==null?void 0:P.node)!==null&&Je!==void 0?Je:"",cluster:(Ye=P==null?void 0:P.cluster)!==null&&Ye!==void 0?Ye:"",window_size_ms:Oe,remote_participant_id:M},((_e,lt,wt,Kt,It,Kn,wn,yr)=>{var Fr,kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji,ys,Zi,ds,Qi,Ii,hi,$i,es,fs,Js,pa,_s,ks,di,Ra,Zn,Gr,Mi,Va,Mo,bc,Qc,ps,Zo,Th,$l,Aa,co,Oo,Qo;let bf=0,Ef=0;if(_e!=null&&_e.jitterBufferEmittedCount&&(lt!=null&&lt.jitterBufferEmittedCount)&&_e.jitterBufferEmittedCount>lt.jitterBufferEmittedCount){_e!=null&&_e.jitterBufferDelay&&(lt!=null&&lt.jitterBufferDelay)&&(bf=(_e.jitterBufferDelay-lt.jitterBufferDelay)/(_e.jitterBufferEmittedCount-lt.jitterBufferEmittedCount));const wh=lt==null?void 0:lt.jitterBufferMinimumDelay,b=_e==null?void 0:_e.jitterBufferMinimumDelay;wh&&b&&(Ef=(b-wh)/(_e.jitterBufferEmittedCount-lt.jitterBufferEmittedCount))}const Pp=Math.max(((Fr=_e==null?void 0:_e.bytesReceived)!==null&&Fr!==void 0?Fr:0)-((kr=lt==null?void 0:lt.bytesReceived)!==null&&kr!==void 0?kr:0),0),Gs=typeof It!="number"?1:It/1e3,bd=8*Pp/Gs,xh=Math.max(((xr=_e==null?void 0:_e.totalDecodeTime)!==null&&xr!==void 0?xr:0)-((_r=lt==null?void 0:lt.totalDecodeTime)!==null&&_r!==void 0?_r:0),0),Uu=Math.max(((Rr=_e==null?void 0:_e.framesDecoded)!==null&&Rr!==void 0?Rr:0)-((Dr=lt==null?void 0:lt.framesDecoded)!==null&&Dr!==void 0?Dr:0),0),Cl=xh/Math.max(Uu,1),Q0=Math.max(((br=_e==null?void 0:_e.packetsLost)!==null&&br!==void 0?br:0)-((Ar=lt==null?void 0:lt.packetsLost)!==null&&Ar!==void 0?Ar:0),0),Zy=Math.max(((ur=_e==null?void 0:_e.packetsReceived)!==null&&ur!==void 0?ur:0)-((Tn=lt==null?void 0:lt.packetsReceived)!==null&&Tn!==void 0?Tn:0),0),ev=Q0/Math.max(Zy+Q0,1),Wi=Ru(Kt==null?void 0:Kt.mimeType,Kt==null?void 0:Kt.sdpFmtpLine),tv=8*(yr||0)/Gs;return{bytes_received:Pp,codec_mime_type:Wi==null?void 0:Wi.mimeSubtype,codec_profile:Wi==null?void 0:Wi.profile,codec_level:Wi==null?void 0:Wi.level,connection_bandwidth:($n=wt==null?void 0:wt.availableIncomingBitrate)!==null&&$n!==void 0?$n:0,decode_bitrate:bd,decoder_implementation:($r=_e==null?void 0:_e.decoderImplementation)!==null&&$r!==void 0?$r:"unknown",fir_count:Math.max(((Ji=_e==null?void 0:_e.firCount)!==null&&Ji!==void 0?Ji:0)-((ys=lt==null?void 0:lt.firCount)!==null&&ys!==void 0?ys:0),0),fraction_packets_lost:ev,frame_decode_time_avg:Cl,frame_height:Math.max((Zi=_e==null?void 0:_e.frameHeight)!==null&&Zi!==void 0?Zi:0,0),frame_width:Math.max((ds=_e==null?void 0:_e.frameWidth)!==null&&ds!==void 0?ds:0,0),frames_decoded:Math.max(((Qi=_e==null?void 0:_e.framesDecoded)!==null&&Qi!==void 0?Qi:0)-((Ii=lt==null?void 0:lt.framesDecoded)!==null&&Ii!==void 0?Ii:0),0),frames_dropped:Math.max(((hi=_e==null?void 0:_e.framesDropped)!==null&&hi!==void 0?hi:0)-(($i=lt==null?void 0:lt.framesDropped)!==null&&$i!==void 0?$i:0),0),frames_received:Math.max(((es=_e==null?void 0:_e.framesReceived)!==null&&es!==void 0?es:0)-((fs=lt==null?void 0:lt.framesReceived)!==null&&fs!==void 0?fs:0),0),freeze_count:Math.max(((Js=_e==null?void 0:_e.freezeCount)!==null&&Js!==void 0?Js:0)-((pa=lt==null?void 0:lt.freezeCount)!==null&&pa!==void 0?pa:0),0),frames_rendered:Math.max((_s=_e==null?void 0:_e.framesRendered)!==null&&_s!==void 0?_s:0,0),frames_per_second:Math.max((ks=_e==null?void 0:_e.framesPerSecond)!==null&&ks!==void 0?ks:0,0),header_bytes_received:Math.max(((di=_e==null?void 0:_e.headerBytesReceived)!==null&&di!==void 0?di:0)-((Ra=lt==null?void 0:lt.headerBytesReceived)!==null&&Ra!==void 0?Ra:0),0),configured_jitter_buffer_min_delay_ms:Kn??0,jitter_buffer_min_obtainable_delay:Ef,jitter_buffer_delay_avg:bf,key_frames_decoded:Math.max(((Zn=_e==null?void 0:_e.keyFramesDecoded)!==null&&Zn!==void 0?Zn:0)-((Gr=lt==null?void 0:lt.keyFramesDecoded)!==null&&Gr!==void 0?Gr:0),0),nack_count:Math.max(((Mi=_e==null?void 0:_e.nackCount)!==null&&Mi!==void 0?Mi:0)-((Va=lt==null?void 0:lt.nackCount)!==null&&Va!==void 0?Va:0),0),packets_discarded:Math.max(((Mo=_e==null?void 0:_e.packetsDiscarded)!==null&&Mo!==void 0?Mo:0)-((bc=lt==null?void 0:lt.packetsDiscarded)!==null&&bc!==void 0?bc:0),0),packets_lost:Q0,packets_received:Zy,pause_count:Math.max(((Qc=_e==null?void 0:_e.pauseCount)!==null&&Qc!==void 0?Qc:0)-((ps=lt==null?void 0:lt.pauseCount)!==null&&ps!==void 0?ps:0),0),pli_count:Math.max(((Zo=_e==null?void 0:_e.pliCount)!==null&&Zo!==void 0?Zo:0)-((Th=lt==null?void 0:lt.pliCount)!==null&&Th!==void 0?Th:0),0),power_efficient_decoder:($l=_e==null?void 0:_e.powerEfficientDecoder)!==null&&$l!==void 0&&$l,total_freezes_duration:Math.max(((Aa=_e==null?void 0:_e.totalFreezesDuration)!==null&&Aa!==void 0?Aa:0)-((co=lt==null?void 0:lt.totalFreezesDuration)!==null&&co!==void 0?co:0),0),total_pauses_duration:Math.max(((Oo=_e==null?void 0:_e.totalPausesDuration)!==null&&Oo!==void 0?Oo:0)-((Qo=lt==null?void 0:lt.totalPausesDuration)!==null&&Qo!==void 0?Qo:0),0),sei_read_count:wn,sei_bytes_received:yr,sei_bitrate:tv}})(B,H,te,ie,Oe,K,se,he)))}}class zy extends qn{constructor(S,R,M,P,B,H,te,ie,K){var se,he;super(bn.SUBSCRIBED_AUDIO_STATS,S,R,!1),Object.assign(this.properties,Object.assign({action:dn.SUBSCRIBE,node:(se=P==null?void 0:P.node)!==null&&se!==void 0?se:"",cluster:(he=P==null?void 0:P.cluster)!==null&&he!==void 0?he:"",remote_participant_id:M},((pe,Ne,Je,Ye,Oe)=>{var _e,lt,wt,Kt,It,Kn,wn,yr,Fr,kr,xr,_r,Rr,Dr,br,Ar,ur;let Tn=0;pe!=null&&pe.jitterBufferDelay&&(pe!=null&&pe.jitterBufferEmittedCount)&&pe.jitterBufferEmittedCount>0&&(Tn=pe.jitterBufferDelay/pe.jitterBufferEmittedCount);const $n=Ye??1,$r=Math.max((_e=pe==null?void 0:pe.bytesReceived)!==null&&_e!==void 0?_e:0,0),Ji=8*$r/$n,ys=Math.max((lt=pe==null?void 0:pe.packetsLost)!==null&&lt!==void 0?lt:0,0),Zi=Math.max((wt=pe==null?void 0:pe.packetsReceived)!==null&&wt!==void 0?wt:0,0),ds=ys/Math.max(Zi+ys,1),Qi=Math.max((Kt=pe==null?void 0:pe.concealedSamples)!==null&&Kt!==void 0?Kt:0,0),Ii=Math.max((It=pe==null?void 0:pe.totalSamplesReceived)!==null&&It!==void 0?It:0,0),hi=Qi/Math.max(Ii,1),$i=Ru(Je==null?void 0:Je.mimeType,Je==null?void 0:Je.sdpFmtpLine);return{audio_level:(Kn=pe==null?void 0:pe.audioLevel)!==null&&Kn!==void 0?Kn:0,audio_nacks_enabled:(wn=Oe==null?void 0:Oe.audioNacks)!==null&&wn!==void 0&&wn,bytes_received:$r,codec_mime_type:$i==null?void 0:$i.mimeSubtype,connection_bandwidth:(yr=Ne==null?void 0:Ne.availableIncomingBitrate)!==null&&yr!==void 0?yr:0,concealed_samples:Qi,concealment_events:Math.max((Fr=pe==null?void 0:pe.concealmentEvents)!==null&&Fr!==void 0?Fr:0,0),silent_concealed_samples:Math.max((kr=pe==null?void 0:pe.silentConcealedSamples)!==null&&kr!==void 0?kr:0,0),decode_bitrate:Ji,fraction_audio_concealed:hi,fraction_packets_lost:ds,header_bytes_received:Math.max((xr=pe==null?void 0:pe.headerBytesReceived)!==null&&xr!==void 0?xr:0,0),inserted_samples_for_deceleration:Math.max((_r=pe==null?void 0:pe.insertedSamplesForDeceleration)!==null&&_r!==void 0?_r:0,0),jitter_buffer_delay_avg:Tn,packets_discarded:Math.max((Rr=pe==null?void 0:pe.packetsDiscarded)!==null&&Rr!==void 0?Rr:0,0),retransmitted_packets_received:Math.max((Dr=pe==null?void 0:pe.retransmittedPacketsReceived)!==null&&Dr!==void 0?Dr:0,0),retransmitted_bytes_received:Math.max((br=pe==null?void 0:pe.retransmittedBytesReceived)!==null&&br!==void 0?br:0,0),packets_lost:ys,packets_received:Zi,nack_count:Math.max((Ar=pe==null?void 0:pe.nackCount)!==null&&Ar!==void 0?Ar:0,0),removed_samples_for_acceleration:Math.max((ur=pe==null?void 0:pe.removedSamplesForAcceleration)!==null&&ur!==void 0?ur:0,0),total_samples_received:Ii}})(B,H,te,ie,K)))}}class qr extends qn{constructor(S,R,M,P,B,H,te,ie,K,se){var he,pe,Ne,Je;super(bn.SUBSCRIBED_AUDIO_STATS_WINDOW,S,R,!1);const Ye=Math.max(((he=B==null?void 0:B.timestamp)!==null&&he!==void 0?he:0)-((pe=H==null?void 0:H.timestamp)!==null&&pe!==void 0?pe:0),0);Object.assign(this.properties,Object.assign({action:dn.SUBSCRIBE,window_size_ms:Ye,node:(Ne=P==null?void 0:P.node)!==null&&Ne!==void 0?Ne:"",cluster:(Je=P==null?void 0:P.cluster)!==null&&Je!==void 0?Je:"",remote_participant_id:M},((Oe,_e,lt,wt,Kt,It,Kn)=>{var wn,yr,Fr,kr,xr,_r,Rr,Dr,br,Ar,ur,Tn,$n,$r,Ji,ys,Zi,ds,Qi,Ii,hi,$i,es,fs,Js,pa,_s,ks,di,Ra,Zn;let Gr=0,Mi=0;if(Oe!=null&&Oe.jitterBufferEmittedCount&&(_e!=null&&_e.jitterBufferEmittedCount)&&Oe.jitterBufferEmittedCount>_e.jitterBufferEmittedCount){Oe!=null&&Oe.jitterBufferDelay&&(_e!=null&&_e.jitterBufferDelay)&&(Gr=(Oe.jitterBufferDelay-_e.jitterBufferDelay)/(Oe.jitterBufferEmittedCount-_e.jitterBufferEmittedCount));const Oo=_e==null?void 0:_e.jitterBufferMinimumDelay,Qo=Oe==null?void 0:Oe.jitterBufferMinimumDelay;Oo&&Qo&&(Mi=(Qo-Oo)/(Oe.jitterBufferEmittedCount-_e.jitterBufferEmittedCount))}const Va=typeof Kt!="number"?1:Kt/1e3,Mo=Math.max(((wn=Oe==null?void 0:Oe.bytesReceived)!==null&&wn!==void 0?wn:0)-((yr=_e==null?void 0:_e.bytesReceived)!==null&&yr!==void 0?yr:0),0),bc=8*Mo/Va,Qc=Math.max(((Fr=Oe==null?void 0:Oe.packetsLost)!==null&&Fr!==void 0?Fr:0)-((kr=_e==null?void 0:_e.packetsLost)!==null&&kr!==void 0?kr:0),0),ps=Math.max(((xr=Oe==null?void 0:Oe.packetsReceived)!==null&&xr!==void 0?xr:0)-((_r=_e==null?void 0:_e.packetsReceived)!==null&&_r!==void 0?_r:0),0),Zo=Qc/Math.max(ps+Qc,1),Th=Math.max(((Rr=Oe==null?void 0:Oe.concealedSamples)!==null&&Rr!==void 0?Rr:0)-((Dr=_e==null?void 0:_e.concealedSamples)!==null&&Dr!==void 0?Dr:0),0),$l=Math.max(((br=Oe==null?void 0:Oe.totalSamplesReceived)!==null&&br!==void 0?br:0)-((Ar=_e==null?void 0:_e.totalSamplesReceived)!==null&&Ar!==void 0?Ar:0),0),Aa=Th/Math.max($l,1),co=Ru(wt==null?void 0:wt.mimeType,wt==null?void 0:wt.sdpFmtpLine);return{audio_level:(ur=Oe==null?void 0:Oe.audioLevel)!==null&&ur!==void 0?ur:0,audio_nacks_enabled:(Tn=It==null?void 0:It.audioNacks)!==null&&Tn!==void 0&&Tn,bytes_received:Mo,codec_mime_type:co==null?void 0:co.mimeSubtype,connection_bandwidth:($n=lt==null?void 0:lt.availableIncomingBitrate)!==null&&$n!==void 0?$n:0,decode_bitrate:bc,concealed_samples:Th,concealment_events:Math.max((($r=Oe==null?void 0:Oe.concealmentEvents)!==null&&$r!==void 0?$r:0)-((Ji=_e==null?void 0:_e.concealmentEvents)!==null&&Ji!==void 0?Ji:0),0),silent_concealed_samples:Math.max(((ys=Oe==null?void 0:Oe.silentConcealedSamples)!==null&&ys!==void 0?ys:0)-((Zi=_e==null?void 0:_e.silentConcealedSamples)!==null&&Zi!==void 0?Zi:0),0),fraction_audio_concealed:Aa,fraction_packets_lost:Zo,header_bytes_received:Math.max(((ds=Oe==null?void 0:Oe.headerBytesReceived)!==null&&ds!==void 0?ds:0)-((Qi=_e==null?void 0:_e.headerBytesReceived)!==null&&Qi!==void 0?Qi:0),0),inserted_samples_for_deceleration:Math.max(((Ii=Oe==null?void 0:Oe.insertedSamplesForDeceleration)!==null&&Ii!==void 0?Ii:0)-((hi=_e==null?void 0:_e.insertedSamplesForDeceleration)!==null&&hi!==void 0?hi:0),0),configured_jitter_buffer_min_delay_ms:Kn??0,jitter_buffer_min_obtainable_delay:Mi,jitter_buffer_delay_avg:Gr,packets_discarded:Math.max((($i=Oe==null?void 0:Oe.packetsDiscarded)!==null&&$i!==void 0?$i:0)-((es=_e==null?void 0:_e.packetsDiscarded)!==null&&es!==void 0?es:0),0),packets_lost:Qc,packets_received:ps,nack_count:Math.max(((fs=Oe==null?void 0:Oe.nackCount)!==null&&fs!==void 0?fs:0)-((Js=_e==null?void 0:_e.nackCount)!==null&&Js!==void 0?Js:0),0),removed_samples_for_acceleration:Math.max(((pa=Oe==null?void 0:Oe.removedSamplesForAcceleration)!==null&&pa!==void 0?pa:0)-((_s=_e==null?void 0:_e.removedSamplesForAcceleration)!==null&&_s!==void 0?_s:0),0),retransmitted_packets_received:Math.max(((ks=Oe==null?void 0:Oe.retransmittedPacketsReceived)!==null&&ks!==void 0?ks:0)-((di=_e==null?void 0:_e.retransmittedPacketsReceived)!==null&&di!==void 0?di:0),0),retransmitted_bytes_received:Math.max(((Ra=Oe==null?void 0:Oe.retransmittedBytesReceived)!==null&&Ra!==void 0?Ra:0)-((Zn=_e==null?void 0:_e.retransmittedBytesReceived)!==null&&Zn!==void 0?Zn:0),0),total_samples_received:$l}})(B,H,te,ie,Ye,K,se)))}}class F0 extends qn{constructor(S,R,M,P,B=dn.PUBLISH,H=!1,te=""){super(bn.SIMULCAST_LAYER_INFO,S,R,!1),Object.assign(this.properties,{rid:M,active:P,selected:H,source:B===dn.PUBLISH?"publisher":"subscriber",remote_participant_id:te})}}class Ex extends qn{constructor(S,R,M,P){super(bn.MULTIHOST_CONFIGURATION,S,R,!1),Object.assign(this.properties,Object.assign(Object.assign({},M),{action:P}))}}class km extends qn{constructor(S,R,M){super(bn.MULTIHOST_SUBSCRIBE_CONFIGURATION,S,R,!1),Object.assign(this.properties,Object.assign({},M))}}var md,Vr,wp;(function(O){O.Mobile="mobile",O.Tablet="tablet",O.Desktop="desktop",O.Tv="tv"})(md||(md={})),function(O){O.IOS="iOS",O.MacOS="macOS",O.Windows="Windows",O.Android="Android"}(Vr||(Vr={})),function(O){O.Safari="Safari",O.Firefox="Firefox",O.Chrome="Chrome",O.IE="Internet Explorer",O.Edge="Microsoft Edge"}(wp||(wp={}));const us=function(O){const S=mh(O);return{platform:{isMobile:Cp(md.Mobile,S),isTablet:Cp(md.Tablet,S),isDesktop:Cp(md.Desktop,S),isTv:Cp(md.Tv,S)},os:{name:Rp(S),version:Dm(S),isIOS:gh(Vr.IOS,S),isMacOS:gh(Vr.MacOS,S),isWindows:gh(Vr.Windows,S),isAndroid:gh(Vr.Android,S)},browser:{name:vh(S),version:Jc(S),isSafari:Ap(wp.Safari,S),isFirefox:Ap(wp.Firefox,S),isChrome:Ap(wp.Chrome,S),isIE:Ap(wp.IE,S),isEdge:Ap(wp.Edge,S)}}}(window.navigator.userAgent);function mh(O){try{return Hs.getParser(O||window.navigator.userAgent)}catch{}}function Cp(O,S){return()=>(S||(S=mh()),!(!S||S.getPlatformType(!0)!==O.toLowerCase()))}function Dm(O){return()=>(O||(O=mh()),O&&O.getOSVersion()||"")}function Rp(O){return()=>(O||(O=mh()),O&&O.getOSName()||"")}function gh(O,S){return()=>(S||(S=mh()),!(!S||S.getOSName(!0)!==O.toLowerCase()))}function Jc(O){return()=>(O||(O=mh()),O&&O.getBrowserVersion()||"")}function vh(O){return()=>(O||(O=mh()),O&&O.getBrowserName()||"")}function Ap(O,S){return()=>(S||(S=mh()),!(!S||S.getBrowserName().toLowerCase()!==O.toLowerCase()))}const xE={active:!1,maxBitrate:2e5,rid:"low",maxFramerate:15,scaleResolutionDownBy:4},Au={width:320,height:180},Pm={active:!1,maxBitrate:7e5,rid:"mid",maxFramerate:20,scaleResolutionDownBy:2},z0={width:640,height:360},Mp={active:!1,maxBitrate:17e5,rid:"hi",maxFramerate:30,scaleResolutionDownBy:1},H0={width:1280,height:720};function Mu(O){const{config:S}=O;return[{maxBitrate:S.maxBitrateBps}]}function yh(O,S){var R,M;const P=S==null?void 0:S.track,B=S==null?void 0:S.config;if(O&&P){const H=(0,ua.cloneDeep)([{encodingParams:xE,targetResolution:Au},{encodingParams:Pm,targetResolution:z0},{encodingParams:Mp,targetResolution:H0}]),{height:te,width:ie}=P.getSettings(),K=te&&ie?{width:ie,height:te}:void 0;for(const pe of H){pe.encodingParams.active=!0;let Ne=1;K&&(Ne=Math.floor(Math.sqrt(K.width*K.height/(pe.targetResolution.width*pe.targetResolution.height))),Ne=Math.max(Ne,1)),pe.encodingParams.scaleResolutionDownBy=Ne}let se=(R=B==null?void 0:B.maxBitrateBps)!==null&&R!==void 0?R:Mp.maxBitrate;const he=(M=B==null?void 0:B.maxFramerate)!==null&&M!==void 0?M:Mp.maxFramerate;return se<Pm.maxBitrate&&(se=Mp.maxBitrate),H[2].encodingParams.maxBitrate=se,H[2].encodingParams.maxFramerate=he,H[2].encodingParams.scaleResolutionDownBy=1,H.map(pe=>pe.encodingParams)}return B?[{maxBitrate:B.maxBitrateBps,maxFramerate:B.maxFramerate}]:[{maxBitrate:ro(Im),maxFramerate:yc}]}const fR=1e3;function ro(O){return O*fR}const wE=(O,...S)=>{const R=S.map(M=>typeof M!="object").filter(Boolean).length>0;if(typeof O=="object"&&!R)return(0,ua.merge)({},O,...S)},vr=O=>Lm(O),Lm=O=>(0,ua.cloneDeep)(O),Hy=O=>{switch(O){case Gl.HIGHEST_QUALITY:return"highest";case Gl.LOWEST_QUALITY:default:return"lowest"}};var Op=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};const gd="no-rid";class j0{constructor(S,R,M,P,B,H){this.analyticsTracker=B,this.receiveVideoTransformer=H,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new zi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=j0.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case at.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case at.FAILED:this.flushStats()}},this.action=S,this.token=R,this.traceId=M,this.identifier=P}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:ro(oi)}}set sdpAnswer(S){try{this.sdp=new zi(S),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(S,R=!1){this.peerConnection=S,this.simulcastEnabled=R,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var S;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(S=this.peerConnection)===null||S===void 0||S.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(S){this.sfuResource=S}updateMultihostConfiguration(S,R){var M,P,B,H,te,ie;return Op(this,void 0,void 0,function*(){if(this.action!==dn.PUBLISH||!this.peerConnection)return;const K=j0.defaultMultihostConfiguration();if(R){const se=this.peerConnection.getSenders().filter(pe=>pe.track!==null&&pe.track.kind==="video");se.length>0&&(yield se[0].getStats()).forEach(pe=>{pe.type==="codec"&&(K.video_codec=pe.mimeType)});const he=R.track.getSettings();K.width=(M=he.width)!==null&&M!==void 0?M:0,K.height=(P=he.height)!==null&&P!==void 0?P:0,K.target_fps=(B=he.frameRate)!==null&&B!==void 0?B:0,R.config?(K.max_bitrate=R.config.maxBitrateBps,K.min_bitrate=R.config.minBitrateBps,K.enable_simulcast=R.config.simulcastEnabled):(K.max_bitrate=ro(Im),K.min_bitrate=ro(Nm),K.enable_simulcast=!1)}if(S){const se=S.track.getSettings();K.auto_gain=(H=se.autoGainControl)!==null&&H!==void 0&&H,K.echo_cancellation=(te=se.echoCancellation)!==null&&te!==void 0&&te,K.noise_suppression=(ie=se.noiseSuppression)!==null&&ie!==void 0&&ie,K.max_audio_bitrate_bps=S.config.maxBitrateBps,K.stereo=S.config.stereo}(0,ua.isEqual)(K,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new Ex(this.token,this.traceId,K,this.action)),this.multihostConfiguration=K)})}updateJitterBufferMinDelay(S){this.jitterBufferMinDelayInMs=S}setupIntervals(){this.action===dn.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(S,R){return setInterval(S.bind(this),R)}getConnectionState(){var S;if(!this.peerConnection)return at.NONE;const R=(S=this.peerConnection.connectionState)!==null&&S!==void 0?S:this.peerConnection.iceConnectionState;try{return vE(R)}catch{return at.IDLE}}pollSimulcastLayers(){var S;return Op(this,void 0,void 0,function*(){if(this.getConnectionState()===at.CONNECTED){const R=yield(S=this.peerConnection)===null||S===void 0?void 0:S.getStats();if(!R)return;R.forEach(M=>{var P;if(M.type==="outbound-rtp"){const B=((P=M.framesPerSecond)!==null&&P!==void 0?P:0)!==0;switch(M.rid){case"low":B!==this.simulcastState.low&&(this.simulcastState.low=B,this.analyticsTracker.trackEventNoSharedProps(new F0(this.token,this.traceId,M.rid,B)));break;case"mid":B!==this.simulcastState.mid&&(this.simulcastState.mid=B,this.analyticsTracker.trackEventNoSharedProps(new F0(this.token,this.traceId,M.rid,B)));break;case"hi":B!==this.simulcastState.hi&&(this.simulcastState.hi=B,this.analyticsTracker.trackEventNoSharedProps(new F0(this.token,this.traceId,M.rid,B)))}}})}})}flushStats(){var S;return Op(this,void 0,void 0,function*(){const R=yield(S=this.peerConnection)===null||S===void 0?void 0:S.getStats();R&&(this.action===dn.PUBLISH?this.uploadPublisherStats(R):this.action===dn.SUBSCRIBE&&this.uploadSubscriberStats(R))})}uploadStats(){var S;return Op(this,void 0,void 0,function*(){if(this.getConnectionState()===at.CONNECTED){const R=yield(S=this.peerConnection)===null||S===void 0?void 0:S.getStats();if(!R)return;this.action===dn.PUBLISH?this.uploadPublisherStats(R):this.action===dn.SUBSCRIBE&&this.uploadSubscriberStats(R)}})}uploadPublisherStats(S){const R={audio:{},video:[]},M=new Map,P=(Date.now()-this.connectionStartedTimestamp)/1e3,B=Object.assign({},this.multihostConfiguration);S.forEach(H=>{if(H.type==="outbound-rtp"){const te=S.get(H.remoteId),ie=this.prevRemoteInboundStats.get(H.remoteId);switch(te&&this.prevRemoteInboundStats.set(te.id,te),H.kind){case"audio":R.audio=this.updateOutboundAudio(H),R.audio.remoteInbound=te,R.audio.prevRemoteInbound=ie,R.audio.codec=M.get(H.codecId);break;case"video":R.video.push(Object.assign({},this.updateOutboundVideo(H),{remoteInbound:te,prevRemoteInbound:ie,codec:M.get(H.codecId)}))}}H.type==="candidate-pair"&&H.nominated&&(R.candidatePair=H),H.type==="codec"&&M.set(H.id,H)}),this.analyticsTracker.trackEventNoSharedProps(new SE(this.token,this.traceId,this.sfuResource,R.audio.outbound,R.audio.remoteInbound,R.candidatePair,R.audio.codec,B,P,this.sdpFeatures)),R.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new B0(this.token,this.traceId,this.sfuResource,R.audio.outbound,R.audio.prevOutbound,R.audio.remoteInbound,R.audio.prevRemoteInbound,R.candidatePair,R.audio.codec,B,this.sdpFeatures)),R.video.forEach(H=>{this.analyticsTracker.trackEventNoSharedProps(new U0(this.token,this.traceId,this.sfuResource,H.outbound,H.remoteInbound,R.candidatePair,H.codec,B,P)),H.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new gf(this.token,this.traceId,this.sfuResource,H.outbound,H.prevOutbound,H.remoteInbound,H.prevRemoteInbound,R.candidatePair,H.codec,B))})}uploadSubscriberStats(S){var R;const M={audio:{},video:{}},P=new Map,B=(Date.now()-this.connectionStartedTimestamp)/1e3,H=(R=this.jitterBufferMinDelayInMs)!==null&&R!==void 0?R:0,{seiReadCnt:te,seiBytesRead:ie}=this.updateAndDiffSinceLastUpdate(this.receiveVideoTransformer.getReceiverStats());S.forEach(K=>{if(K.type==="inbound-rtp")switch(K.kind){case"audio":M.audio=this.updateInboundAudio(K),M.audio.codec=P.get(K.codecId);break;case"video":M.video=this.updateInboundVideo(K),M.video.codec=P.get(K.codecId)}K.type==="candidate-pair"&&K.nominated&&(M.candidatePair=K),K.type==="codec"&&P.set(K.id,K)}),this.analyticsTracker.trackEventNoSharedProps(new zy(this.token,this.traceId,this.identifier,this.sfuResource,M.audio.inbound,M.candidatePair,M.audio.codec,B,this.sdpFeatures)),M.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new qr(this.token,this.traceId,this.identifier,this.sfuResource,M.audio.inbound,M.audio.prevInbound,M.candidatePair,M.audio.codec,this.sdpFeatures,H)),this.analyticsTracker.trackEventNoSharedProps(new Fy(this.token,this.traceId,this.identifier,this.sfuResource,M.video.inbound,M.candidatePair,M.video.codec,B)),M.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new TE(this.token,this.traceId,this.identifier,this.sfuResource,M.video.inbound,M.video.prevInbound,M.candidatePair,M.video.codec,H,te,ie))}updateAndDiffSinceLastUpdate(S){const R=this.prevVideoReceiverTransformerStats,M=S.seiReadCnt-R.seiReadCnt,P=S.seiBytesRead-R.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:S.seiReadCnt,seiBytesRead:S.seiBytesRead},{seiReadCnt:M,seiBytesRead:P}}updateOutboundAudio(S){const R=S,M=this.prevOutboundAudioStats,P=S.id===(M==null?void 0:M.id)?M:void 0;return this.prevOutboundAudioStats=S,{outbound:R,prevOutbound:P}}updateInboundAudio(S){const R=S,M=this.prevInboundAudioStats,P=S.id===(M==null?void 0:M.id)?M:void 0;return this.prevInboundAudioStats=S,{inbound:R,prevInbound:P}}updateInboundVideo(S){const R=S,M=this.prevInboundVideoStats.get(gd),P=S.id===(M==null?void 0:M.id)?M:void 0;return this.prevInboundVideoStats.set(gd,S),{inbound:R,prevInbound:P}}updateOutboundVideo(S){const R=S,M=this.getPrevOutboundVideo(S),P=S.id===(M==null?void 0:M.id)?M:void 0;return this.setPrevVideoStat(S),{outbound:R,prevOutbound:P}}getPrevOutboundVideo(S){return this.simulcastEnabled&&S.rid&&this.prevOutboundVideoStats.has(S.rid)?this.prevOutboundVideoStats.get(S.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(gd)?this.prevOutboundVideoStats.get(gd):void 0}setPrevVideoStat(S){this.simulcastEnabled&&S.rid?this.prevOutboundVideoStats.set(S.rid,S):this.simulcastEnabled||this.prevOutboundVideoStats.set(gd,S)}}class _c extends qn{constructor(S,R,M,P,B){super(bn.MINUTE,S,R,!1),Object.assign(this.properties,{action:P?dn.PUBLISH:dn.SUBSCRIBE,is_publishing:P,minutes_logged:M,subscribed_number:B})}}class Ou extends qn{constructor(S){super(bn.PUBLISH,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.PUBLISH,remote_participant_id:S.token.participantID})}}class vf extends qn{constructor(S){super(bn.UNPUBLISH,S.token,S.traceId,!0),Object.assign(this.properties,{action:dn.PUBLISH,remote_participant_id:S.token.participantID})}}class Um extends qn{constructor(S){var R,M,P,B;super(bn.SUBSCRIBE,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.SUBSCRIBE,remote_participant_id:S.subscribedId,subscribed_id:S.subscribedId,is_edp_connected:S.isEdpConnected,is_reassignment:S.isReassignment,node:(M=(R=S.preAttemptSfuResource)===null||R===void 0?void 0:R.node)!==null&&M!==void 0?M:"",cluster:(B=(P=S.preAttemptSfuResource)===null||P===void 0?void 0:P.cluster)!==null&&B!==void 0?B:""})}}class Sx extends qn{constructor(S){super(bn.UNSUBSCRIBE,S.token,S.traceId,!0),Object.assign(this.properties,{action:dn.SUBSCRIBE,remote_participant_id:S.unsubscribedId,unsubscribed_id:S.unsubscribedId})}}class Tx extends qn{constructor(S){var R,M,P,B;super(bn.PUBLISH_STARTED,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.PUBLISH,options_duration:S.optionsDuration,post_duration:S.postDuration,remote_participant_id:S.token.participantID,time_to_candidate:S.timeToCandidate,total_duration:S.totalDuration,edp_initial_connect_duration:S.edpInitialConnectDuration,edp_initial_connect_retry_times:S.edpInitialConnectRetries,edp_initial_state_duration:S.edpInitialStateDuration,edp_state_update_count:S.edpStateUpdateCount,sdp_exchange_duration:S.sdpExchangeDuration,sdp_exchange_transport:S.sdpExchangeTransport,set_remote_desc_duration:S.setRemoteDescDuration,peer_connection_duration:S.peerConnectionDuration,node:(M=(R=S.sfuResource)===null||R===void 0?void 0:R.node)!==null&&M!==void 0?M:"",cluster:(B=(P=S.sfuResource)===null||P===void 0?void 0:P.cluster)!==null&&B!==void 0?B:"",publish_retry_times:S.publishRetries,total_duration_with_retries:S.totalDurationWithRetries})}}class xx extends qn{constructor(S){super(bn.PUBLISH_FAILED,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.PUBLISH,code:S.code,message:S.message,fatal:S.fatal,nominal:S.nominal})}}class Np extends qn{constructor(S){super(bn.PUBLISH_ENDED,S.token,S.traceId,!0),Object.assign(this.properties,{action:dn.PUBLISH,remote_participant_id:S.token.participantID,unpublish_successful:S.isUnpublishSuccessful,reason:S.reason})}}class Ip extends qn{constructor(S){var R,M,P,B;super(bn.SUBSCRIBE_STARTED,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.SUBSCRIBE,options_duration:S.optionsDuration,post_duration:S.postDuration,remote_participant_id:S.remoteParticipantId,time_to_candidate:S.timeToCandidate,total_duration:S.totalDuration,edp_initial_connect_duration:S.edpInitialConnectDuration,edp_initial_connect_retry_times:S.edpInitialConnectRetries,edp_initial_state_duration:S.edpInitialStateDuration,edp_initial_state_publishing_count:S.edpInitialStatePublishingCount,edp_state_update_count:S.edpStateUpdateCount,sdp_exchange_duration:S.sdpExchangeDuration,sdp_exchange_transport:S.sdpExchangeTransport,set_remote_desc_duration:S.setRemoteDescDuration,peer_connection_duration:S.peerConnectionDuration,node:(M=(R=S.sfuResource)===null||R===void 0?void 0:R.node)!==null&&M!==void 0?M:"",cluster:(B=(P=S.sfuResource)===null||P===void 0?void 0:P.cluster)!==null&&B!==void 0?B:"",total_duration_with_retries:S.totalDurationWithRetries,subscribe_retry_times:S.subscribeRetryTimes,is_reassignment:S.isReassignment})}}class CE extends qn{constructor(S){super(bn.SUBSCRIBE_FAILED,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.SUBSCRIBE,remote_participant_id:S.remoteParticipantId,code:S.code,message:S.message,fatal:S.fatal,nominal:S.nominal,is_reassignment:S.isReassignment})}}class Bm extends qn{constructor(S){super(bn.SUBSCRIBE_ENDED,S.token,S.traceId,!0),Object.assign(this.properties,{action:dn.SUBSCRIBE,remote_participant_id:S.remoteParticipantId,unsubscribe_successful:S.isUnsubscribeSuccessful,reason:S.reason}),this.critical=!0}}class V0 extends qn{constructor(S){super(bn.STATE_UPDATED,S.token,S.traceId,!1),Object.assign(this.properties,{audio_muted:S.isAudioMuted,is_disconnected:S.isDisconnected,is_publishing:S.isPublishing,other_participant_id:S.otherParticipantId,other_participant_user_id:S.otherParticipantUserId,video_stopped:S.isVideoStopped})}}class wx extends qn{constructor(S){var R,M,P,B,H;super(bn.FIRST_FRAME,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.SUBSCRIBE,remote_participant_id:S.remoteParticipantId,edp_initial_connect_duration:S.edpInitialConnectDuration,edp_initial_connect_retry_times:S.edpInitialConnectRetries,edp_initial_state_duration:S.edpInitialStateDuration,edp_initial_state_publishing_count:S.edpInitialStatePublishingCount,edp_state_update_count:S.edpStateUpdateCount,sdp_exchange_duration:S.sdpExchangeDuration,sdp_exchange_transport:S.sdpExchangeTransport,set_remote_desc_duration:S.setRemoteDescDuration,peer_connection_duration:S.peerConnectionDuration,node:(M=(R=S.sfuResource)===null||R===void 0?void 0:R.node)!==null&&M!==void 0?M:"",cluster:(B=(P=S.sfuResource)===null||P===void 0?void 0:P.cluster)!==null&&B!==void 0?B:"",video_was_paused:S.videoWasPaused,first_frame_duration:S.firstFrameDuration,total_duration_with_retries:S.totalDurationWithRetries,subscribe_retry_times:S.subscribeRetryTimes,media_type:S.mediaType,configured_jitter_buffer_min_delay_ms:(H=S.currentJitterBufferMinDelayInMs)!==null&&H!==void 0?H:0})}}class jy extends qn{constructor(S){super(bn.EDP_PONG,S.token,S.traceId,!1),Object.assign(this.properties,{event_endpoint:S.eventEndpoint,protocol:S.protocol,edp_rtt:S.edpRttMs})}}class G0 extends qn{constructor(S){super(bn.JOIN,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.JOIN,event_endpoint:S.eventEndpoint,whip_endpoint:S.whipEndpoint})}}class ql extends qn{constructor(S){super(bn.JOIN_ATTEMPT,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.JOIN,event_endpoint:S.eventEndpoint,whip_endpoint:S.whipEndpoint})}}class Co extends qn{constructor(S){super(bn.JOIN_ATTEMPT_FAILED,S.token,S.traceId,!1),Object.assign(this.properties,{action:dn.JOIN,event_endpoint:S.eventEndpoint,whip_endpoint:S.whipEndpoint,code:S.code,message:S.message,fatal:S.fatal,nominal:S.nominal,connect_retry_times:S.retryCnt})}}class Nu extends qn{constructor(S){super(bn.EDP_DISCONNECTED,S.token,S.traceId,!1),Object.assign(this.properties,{event_endpoint:S.eventEndpoint,protocol:S.protocol}),this.critical=!0}}class Sl extends qn{constructor(S){super(bn.EDP_CONNECTED,S.token,S.traceId,!1),Object.assign(this.properties,{event_endpoint:S.eventEndpoint,protocol:S.protocol,connect_retry_times:S.numRetries}),this.critical=!0}}var q0;(function(O){O.MESSAGE="message",O.RESPONSE="response"})(q0||(q0={}));class pR{constructor(S,R,M){this.token=S,this.analyticsTracker=M,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.latestPingTimestamp=0,this.pongCount=0,this.latestSequenceNumber=0,this.nextConnectionAttempt=0,this.pingInterval=0,this.pongTimeout=0,this.connectTimeout=0,this.beforeUnload=()=>{this.emitter.emit(Tu,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(P,B,H,te,ie,K,se,he)=>{var pe;const Ne={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:B,requestId:te,traceId:H,platform:"web",sdk:"1.19.0",whipVersion:vc,content:P,contentType:"application/sdp"}};ie&&(Ne.payload.forceNode=ie),K&&(Ne.payload.assignmentToken=K),se&&(Ne.payload.multiCodec=se);const Je=m0()===void 0,Ye=m0()||Je;he&&Ye&&(Ne.payload.initialLayerPref=Hy(he)),(pe=this.socket)===null||pe===void 0||pe.send(JSON.stringify(Ne))},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new Nu({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.logger=new to(R,me.SOCKET),this.emitter=new eo.EventEmitter,this.connectionAttempts=0,this.sentPing=!1,this.receivedPong=!1,this.traceId=fc(),this.id=`[${xa().value}] `,window.addEventListener("beforeunload",this.beforeUnload)}connect(S,R,M=!1){this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=S,this.traceId=R,M&&!this.connecting&&(window.clearTimeout(this.connectTimeout),this.connectTimeout=window.setTimeout(this.connectTimedOut.bind(this),1e4)),this.attemptConnect(R)}attemptConnect(S){this.traceId=S||fc(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:R,rawToken:M}=this.token;this.connecting=!0,this.closing=!1;try{const P=encodeURIComponent(this.traceId.value);this.socket=this.createWebSocket(`${this.addr}?topic=${R}/publishers&traceid=${P}`,M),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(P){const B=P instanceof Error?P.message:void 0,H=this.createError(Bt.EVENT_PLANE_WS_CREATE_FAILED,B);this.trackJoinFailed(H,this.getRetryCount()),this.emitter.emit(Vl,H)}}send(S){var R;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(S)}`}),this.isReady()?(R=this.socket)===null||R===void 0||R.send(JSON.stringify(S)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const S=this.connecting,R=this.socket&&this.socket.readyState===this.socket.OPEN,M=this.socket&&this.socket.readyState===this.socket.CLOSING,P=this.getRetryCount();if(this.closing=!0,this.connecting=!1,this.cleanPingPongTimeouts(),window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.connectionAttempts=0,this.connectTimeout=0,this.socket){if(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,R)this.trackJoinEnded(),this.emitter.emit(Tu,"intentional-close");else if(S&&!M){const B=this.createError(Bt.OPERATION_ABORTED);this.trackJoinFailed(B,P),this.analyticsTracker.trackError(B),this.emitter.emit(Vl,B)}}}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(S,R){return new WebSocket(S,R)}createError(S,R){return new Ir(Object.assign({action:dn.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:pc.JOIN_RELATED,details:R},S))}on(S,R){this.emitter.on(S,R)}off(S,R){this.emitter.off(S,R)}isReady(){return this.logger.debug({msg:`${this.id}isReady called`}),!!this.socket&&this.socket.readyState===this.socket.OPEN}onMessage(S){this.logger.debug({msg:`${this.id}received message: ${S.data}`});try{const R=JSON.parse(S.data);switch(R.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const M=R.payload.sequenceNumber;M>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&p0()&&this.connectTimeout>0&&this.triggerSocketOpen(R),this.emitter.emit(Py,R),this.latestSequenceNumber=M);break}case"PONG":this.receivedPong=!0,this.pongCount%2==0&&this.analyticsTracker.trackEventNoSharedProps(new jy({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp})),this.pongCount++;break;case"REFRESH":this.emitter.emit(Dy);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(A0,R.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(M0,R.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(pf,R.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(wo,R.payload);break;default:(0,ua.noop)()}}catch(R){this.logger.debug({msg:`onMessage JSON Parse error: ${R}`}),this.emitter.emit(gc,R)}}onError(S){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(S)}`})}onClose(S){if(this.logger.debug({msg:`${this.id}onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.cleanPingPongTimeouts(),this.closing)this.closing=!1;else if(!this.windowUnloading)if(this.connecting){let R=Math.pow(2,this.connectionAttempts-1);R>64&&(R=64),this.logger.debug({msg:`${this.id}reconnecting in ${R} seconds`}),window.clearTimeout(this.nextConnectionAttempt),this.nextConnectionAttempt=window.setTimeout(this.attemptConnect.bind(this),1e3*R);const M=this.createError(Bt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,`code: ${S==null?void 0:S.code}, reason: ${S==null?void 0:S.reason}, wasClean: ${S==null?void 0:S.wasClean}`);this.trackJoinFailed(M,this.getRetryCount()),this.analyticsTracker.trackError(M)}else{this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(Tu,"unknown");const R=this.createError(Bt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,`code: ${S==null?void 0:S.code}, reason: ${S==null?void 0:S.reason}, wasClean: ${S==null?void 0:S.wasClean}`);this.trackJoinEnded(),this.emitter.emit(Vl,R)}}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),p0()?this.connectTimeout=window.setTimeout(()=>{this.triggerSocketOpen()},1e4):this.triggerSocketOpen()}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.nextConnectionAttempt=0,this.connectTimeout=0}triggerSocketOpen(S){this.clearConnectionAttemptTimeouts();const R=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(),this.emitter.emit(Kc,{retryCnt:R,traceId:this.traceId,initialStageState:S}),this.pingInterval=window.setInterval(this.ping.bind(this),3e4)}ping(){var S;this.logger.debug({msg:`${this.id}sending PING`});try{this.latestPingTimestamp=performance.now(),(S=this.socket)===null||S===void 0||S.send(JSON.stringify({type:"PING"})),this.sentPing=!0,this.receivedPong=!1,this.pongTimeout&&clearTimeout(this.pongTimeout),this.pongTimeout=window.setTimeout(this.pongTimedOut.bind(this),5e3)}catch(R){const M=R instanceof Error?R.message:void 0,P=this.createError(Bt.EVENT_PLANE_PING_SEND_FAIL,M);this.emitter.emit(Vl,P)}}connectTimedOut(){const S=this.socket&&this.socket.readyState===this.socket.CONNECTING;this.connecting=!1,this.logger.debug({msg:`${this.id}Connect timed out!`});const R=this.createError(Bt.JOIN_TIMED_OUT);S&&this.trackJoinFailed(R,this.getRetryCount()),this.createError(Bt.JOIN_TIMED_OUT),this.emitter.emit(Vl,R),this.close()}pongTimedOut(){if(this.sentPing&&!this.receivedPong){this.logger.debug({msg:`${this.id}Pong timed out!`});const S=this.createError(Bt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(Vl,S)}}cleanPingPongTimeouts(){this.sentPing=this.receivedPong=!1,window.clearTimeout(this.pongTimeout),window.clearInterval(this.pingInterval)}trackJoinAttempt(S){const{token:R,traceId:M}=this;this.analyticsTracker.trackEvent(new ql({token:R,eventEndpoint:(R==null?void 0:R.eventsURL)||"",whipEndpoint:(R==null?void 0:R.whipURL)||"",traceId:M}))}trackJoinFailed(S,R){const{token:M,traceId:P,code:B,message:H,fatal:te,nominal:ie}=S;this.analyticsTracker.trackEvent(new Co({token:M,eventEndpoint:M.eventsURL,whipEndpoint:M.whipURL,traceId:P,code:B,message:H,fatal:te,nominal:ie,retryCnt:R}))}trackJoinStarted(){this.analyticsTracker.trackEventNoSharedProps(new Sl({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:this.getRetryCount(),protocol:this.protocol,traceId:this.traceId}))}}var $o=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})},io,Iu,Tl,hs;(function(O){O.SDP_EXCHANGE="xdp",O.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(io||(io={})),function(O){O.USER_INITIATED="user-initiated",O.CLIENT_RECONNECT="reconnect",O.TOKEN_REUSED="token-reused",O.UNKNOWN="unknown",O.PARTICIPANT_DISCONNECTED="participant-disconnected",O.STAGE_DELETED="stage-deleted"}(Iu||(Iu={})),function(O){O[O.NOT_CONNECTED=0]="NOT_CONNECTED",O[O.CONNECTION_LOST=1]="CONNECTION_LOST",O[O.TIMEDOUT=2]="TIMEDOUT",O[O.ABORTED=3]="ABORTED",O[O.INVALID_MESSAGE=4]="INVALID_MESSAGE",O[O.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"}(Tl||(Tl={})),function(O){O.DISCONNECTED="disconnected",O.CONNECTING="connecting",O.CONNECTED="connected",O.ERRORED="errored"}(hs||(hs={}));class RE extends Xc{constructor(S,R,M){super(),this.token=S,this.nonScopedLogger=R,this.analyticsTracker=M,this.participants=new Map,this.disconnected=[],this.state={value:hs.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(P,B)=>{this.logger.debug({msg:"onConnecting",context:P,event:B}),P.connectStartTime=performance.now();const H=B.type==="RECONNECT";H&&this.stageSocket.close();const{eventsURL:te}=this.token;this.emit(bl,hs.CONNECTING),this.state.value=hs.CONNECTING;const ie=!H;this.stageSocket.connect(te,this.traceId,ie)},this.onConnected=(P,B)=>{this.logger.debug({msg:"onConnected",context:P,event:B}),P.hasConnected=!0,this.emit(Rm),this.emit(bl,hs.CONNECTED),this.state.value=hs.CONNECTED},this.onDisconnected=(P,B)=>{this.logger.debug({msg:"onDisconnected",context:P}),this.state.value=hs.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),P.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(bl,hs.DISCONNECTED,B)},this.onErrored=(P,B)=>{this.logger.error({msg:"Connection failure occurred",err:B.payload.error}),this.emit(bl,hs.ERRORED),this.emit(xp,B.payload.error),this.state.value=hs.ERRORED,P.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=P=>{const B=this.state.value,H=this.state.context;switch(B){case hs.DISCONNECTED:P.type==="CONNECT"&&this.onConnecting(H,P);break;case hs.CONNECTING:P.type==="RECONNECT"?this.onConnecting(H,P):P.type==="DISCONNECT"?this.onDisconnected(H,P.reason):P.type==="CONNECT_SUCCESS"?this.onConnected(H,P):P.type==="ERROR"&&this.onErrored(H,P);break;case hs.CONNECTED:P.type==="RECONNECT"?this.onConnecting(H,P):P.type==="DISCONNECT"?this.onDisconnected(H,P.reason):P.type==="ERROR"&&this.onErrored(H,P);break;case hs.ERRORED:P.type==="RECONNECT"?this.onConnecting(H,P):P.type==="DISCONNECT"&&this.onDisconnected(H,P.reason)}},this.measureConnect=(P,B)=>{const H=this.stats.edpConnectCount,te=H+1,ie=performance.now(),K=ie-B;return Object.assign(this.stats,{edpConnectCount:te,edpConnectDuration:K}),H===0&&Object.assign(this.stats,{edpInitialStartConnectTime:B,edpInitialFinishConnectTime:ie,edpInitialConnectDuration:K,edpInitialConnectRetries:P}),this.stats},this.measureStateUpdate=P=>{const{edpInitialFinishConnectTime:B}=this.stats,H=this.stats.edpStateUpdateCount,te=H+1;return Object.assign(this.stats,{edpStateUpdateCount:te}),H===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-B,edpInitialStatePublishingCount:P}),this.stats},this.trackMessageParseError=P=>{this.logger.error({msg:"Message Parse Error occurred",err:P.err});const B=new Ir({token:P.token,traceId:P.traceId,code:Bt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:P.tag,location:P.location,message:P.message,details:P.err.message});this.analyticsTracker.trackEvent(new _l(B))},this.trackStageSocketMessageParseError=(P,B,H)=>{this.trackMessageParseError({token:P,traceId:B,tag:pc.JOIN_RELATED,location:"StageConnection.onMessage",message:Bt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:H})},this.trackStageStateMessageParseError=(P,B,H,te)=>{this.trackMessageParseError({token:P,traceId:B,tag:pc.JOIN_RELATED,location:"StageConnection.onStageStateMessage",message:te,err:H})},this.onDisconnectMessage=P=>{this.analyticsTracker.trackEventNoSharedProps(new Om(this.token,this.traceId,`DISCONNECT message received: ${P.code}:${P.reason}`,dn.JOIN));let B=Iu.UNKNOWN;if(P.code==="PARTICIPANT_DISCONNECTED")B=Iu.PARTICIPANT_DISCONNECTED;else if(P.code==="STAGE_DELETED")B=Iu.STAGE_DELETED;else if(P.code==="TOKEN_REUSED"&&(B=Iu.TOKEN_REUSED,oh("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${P.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:B})},this.onReassignmentMessage=P=>{this.emit(jl,P)},this.onIncompatibleCodecsMessage=P=>{this.emit(ff,P)},this.onStageStateMessage=(P,B,H)=>{var te,ie;this.logger.debug({msg:"State Stage Message occurred",state:H});const K=H.payload,se=(te=K.participants)!==null&&te!==void 0?te:[],he=(ie=K.disconnected)!==null&&ie!==void 0?ie:[],pe=[],Ne=[];this.measureStateUpdate(se.length),this.enableFeaturesBasedOnServerFeatures(K.serverFeatures||[]);const Je=(Ye,Oe)=>{this.analyticsTracker.trackEventNoSharedProps(new V0({token:P,otherParticipantId:Ye.id,otherParticipantUserId:Ye.userId,isAudioMuted:Ye.audioMuted,isVideoStopped:Ye.videoStopped,isPublishing:Ye.isPublishing,isDisconnected:Oe,traceId:B}))};this.participants.forEach(Ye=>{const Oe=se.find(_e=>_e.id===Ye.id);if(Oe){let _e=!0,lt=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach(wt=>{_e=_e&&Oe[wt.toString()]===Ye[wt.toString()],_e||(Ye[wt.toString()]=Oe[wt.toString()],lt=!0)}),Object.keys(Ye.attributes).forEach(wt=>{_e=_e&&Oe.attributes[wt]===Ye.attributes[wt],_e||(Ye.attributes=Oe.attributes,lt=!0)}),lt&&(Je(Ye,!1),this.emit(R0,Oe))}else Ne.push(Ye)}),se.forEach(Ye=>{this.participants.get(Ye.id)||pe.push(Ye)}),Ne.forEach(Ye=>{this.participants.delete(Ye.id),Je(Ye,!0),this.emit(hd,Ye)}),pe.forEach(Ye=>{this.participants.set(Ye.id,Ye),Je(Ye,!1),this.emit(df,Ye)}),he.forEach(Ye=>{this.disconnected.find(Oe=>Oe.id===Ye.id)||(this.disconnected.push(Ye),Ye.status==="KICKED"&&this.emit(ha,Ye))}),this.disconnected=he},this.nonScopedLogger=R,this.logger=new to(R,me.CONNECTION),this.stageSocket=new pR(S,this.nonScopedLogger,M),this.token=S,this.traceId=fc()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(S){return $o(this,void 0,void 0,function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:S}),this.traceId=S,this.state.value!==hs.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:Iu.CLIENT_RECONNECT})),new Promise((R,M)=>{this.stageSocket.on(Kc,P=>{var B,H;const{retryCnt:te,initialStageState:ie}=P;ie&&this.enableFeaturesBasedOnServerFeatures((H=(B=ie.payload)===null||B===void 0?void 0:B.serverFeatures)!==null&&H!==void 0?H:[]),this.traceId=P.traceId||fc(),this.measureConnect(te,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),R(this.traceId)}),this.stageSocket.on(Vl,P=>{M(P),this.processStateUpdate({type:"ERROR",payload:{error:P}})}),this.stageSocket.on(Dy,()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(yx),this.processStateUpdate({type:"RECONNECT"})}),this.stageSocket.on(Py,P=>this.onStageStateMessage(this.token,this.traceId,P)),this.stageSocket.on(gc,P=>this.trackStageSocketMessageParseError(this.token,this.traceId,P)),this.stageSocket.on(M0,this.onDisconnectMessage),this.stageSocket.on(pf,this.onReassignmentMessage),this.stageSocket.on(wo,this.onIncompatibleCodecsMessage),this.stageSocket.on(Tu,P=>{this.stopStageMinuteLoggedInterval()}),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:S}})})})}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:Iu.USER_INITIATED}),this.traceId}getParticipant(S){return this.participants.get(S)}listConnectedParticipants(){const S=[];return this.participants.forEach(R=>{R.subscribed&&S.push(R)}),S}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(S,R){this.stageSocket.send({audioMuted:S,type:"SET_STATE",version:"0",videoStopped:R})}setStagePublishing(S){this.isStagePublishing=S,this.emit(mc,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(S,R){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new _c(S,R,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval(()=>{this.analyticsTracker.trackEvent(new _c(S,R??fc(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++},6e4))}stopStageMinuteLoggedInterval(S=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),S&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(S){const R=(H,te)=>{this.trackStageStateMessageParseError(this.token,this.traceId,te,`Could not parse "${H}" from the Eevee server features list`)},M=S.includes(io.SDP_EXCHANGE);this.features.sdpExchange!==M&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${M}`}),this.features.sdpExchange=M);const P=S.find(H=>H.indexOf(io.JITTER_BUFFER_MIN_DELAY_MS)!==-1),B=H=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${H}`}),this.features.jitterBufferMinDelayInMs=H};if(P!==void 0)try{const H=P.split("=")[1],te=parseInt(H,10);if(isNaN(te))throw new Error("Unable to parse - result is NaN");if(te<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===te||B(te)}catch(H){R(P,H),B(void 0)}else B(void 0)}isConnected(){return this.state.value===hs.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(S,R,M,P,B,H,te,ie,K){return $o(this,void 0,void 0,function*(){return this.isConnected()?new Promise((se,he)=>{const pe=window.setTimeout(()=>{Ne(),he(Tl.TIMEDOUT)},8e3),Ne=()=>{window.clearTimeout(pe),this.stageSocket.off(A0,Je),this.stageSocket.off(Vl,Ye)},Je=Oe=>{Oe.requestId===P&&(Ne(),se(Oe))},Ye=()=>{Ne(),he(Tl.CONNECTION_LOST)};B==null||B.addEventListener("abort",()=>{Ne(),he(Tl.ABORTED)}),this.stageSocket.on(A0,Je),this.stageSocket.on(Vl,Ye),this.stageSocket.sendSdpOffer(S,R,M,P,H,te,ie,K)}):Promise.reject(Tl.NOT_CONNECTED)})}}class ku{constructor(S){this.token=S}}var AE=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};const Vy={[Tl.ABORTED]:Bt.OPERATION_ABORTED,[Tl.NOT_CONNECTED]:Bt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[Tl.CONNECTION_LOST]:Bt.XDP_CONNECTION_LOST,[Tl.TIMEDOUT]:Bt.XDP_TIMEOUT,[Tl.INVALID_MESSAGE]:Bt.XDP_INVALID_ANSWER_MSG,[Tl.UNEXPECTED_ERROR]:Bt.XDP_UNEXPECTED_ERROR};class ME extends ku{constructor(S,R,M,P){super(S),this.token=S,this.stageConnection=R,this.contextData=M,this.analyticsTracker=P}exchange(S){return AE(this,void 0,void 0,function*(){const R=xa(),{action:M}=this.contextData,{sdpOffer:P,url:B,traceId:H,forceNode:te,assignmentToken:ie,multiCodec:K,abortController:se,initialLayerPreference:he}=S;let pe;this.trackAttempt(B,R,H);try{pe=yield this.stageConnection.exchangeSdp(P,B,H.value,R.value,se==null?void 0:se.signal,te,ie,K,he)}catch(Kt){if(typeof Kt=="number")throw this.createClientSideErrorFromReasonCode(Kt,H,R,M)}if(!pe)return;const{httpStatusCode:Ne,errorCode:Je,location:Ye,content:Oe,sessionDeleteLink:_e,subscriberControlLink:lt,videoLayersLink:wt}=pe;if(Ne>=200&&Ne<300)return{sdpAnswer:Oe,url:B,location:Ye,sessionDeleteLink:_e,mediaControls:lt,layerControls:wt};throw this.createServerSideError(H,R,Ne,Je,M)})}trackAttempt(S,R,M){const{remoteParticipantId:P,action:B}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new pd(B,this.token,S,"POST",R.value,P,M,"xdp"))}createServerSideError(S,R,M,P,B){const H=this.baseErrorProps(S,R);let te=C0(M,P);return te||(te=Bt.UNKNOWN_SERVER_ERROR),new Ir(Object.assign(Object.assign({action:B},H),te))}baseErrorProps(S,R){const{remoteParticipantId:M,action:P}=this.contextData;return{token:this.token,traceId:S,tag:To(P,M),location:"EdpSdpExchanger.exchange",requestUUID:R,remoteParticipantId:M}}createClientSideErrorFromReasonCode(S,R,M,P){const B=this.baseErrorProps(R,M),H=Vy[S];return new Ir(H?Object.assign(Object.assign({action:P},B),H):Object.assign(Object.assign({action:P},B),Bt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}const vd=new RegExp("^(?:[a-z+]+:)?//","i");function xl(O){return vd.test(O)}var lr=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class Gy extends ku{constructor(S,R,M){super(S),this.contextData=R,this.analyticsTracker=M}exchange(S){return lr(this,void 0,void 0,function*(){const R=xa(),{token:M}=this,{action:P,remoteParticipantId:B}=this.contextData,{sdpOffer:H,url:te,traceId:ie,forceNode:K,assignmentToken:se,multiCodec:he,abortController:pe,initialLayerPreference:Ne}=S;try{const Ye="POST",Oe="http";this.analyticsTracker.trackEventNoSharedProps(new pd(P,M,te,Ye,R.value,B,ie,Oe));const _e={data:H,headers:{Authorization:`Bearer ${M.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":R.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":ie.value,"X-Stages-WHIP-Version":vc,"X-Stages-Options":(Je=JSON.stringify({cap:["sau"]}),btoa(Je).replace(/[^A-Za-z0-9+/]/g,""))},method:Ye,responseType:"text",url:te,signal:pe==null?void 0:pe.signal,params:{}};K&&(_e.params.force_node=K),se&&(_e.params.assignment_token=se),he&&(_e.params.multi_codec=!0);const lt=m0()===void 0,wt=m0()||lt;Ne&&_e.headers&&wt&&(_e.headers["X-Stages-Initial-Layer-Pref"]=Hy(Ne));const{data:Kt,headers:It,request:Kn}=yield El(_e),wn=this.parseWhipResource(te,It.location,It.link);return{url:Kn.responseURL,sdpAnswer:Kt,location:wn==null?void 0:wn.location,sessionDeleteLink:wn==null?void 0:wn.sessionDeleteLink,mediaControls:wn==null?void 0:wn.mediaControls,layerControls:wn==null?void 0:wn.layerControls}}catch(Ye){if(Ks().isCancel(Ye))throw new Ir(Object.assign(Object.assign({},Tp(Bt.OPERATION_ABORTED,Ye)),{action:P,token:M,traceId:ie,tag:To(P,B),location:"StagePeerClient.start",requestUUID:R,remoteParticipantId:B}));const Oe=function(_e,lt){var wt;return _e instanceof Ts.AxiosError&&_e.response&&typeof _e.response.status=="number"?_e instanceof Ts.AxiosError&&_e.code==="ERR_NETWORK"?Bt.NETWORK_FAILURE:C0(Number(_e.response.status),(wt=_e.response.data)===null||wt===void 0?void 0:wt.code)||lt:lt}(Ye,Bt.WHIP_POST_FAILURE);throw new Ir(Object.assign(Object.assign({},Tp(Oe,Ye)),{action:P,token:M,traceId:ie,tag:To(P,B),location:"StagePeerClient.start",requestUUID:R,remoteParticipantId:B}))}var Je})}parseWhipResource(S,R,M){const P=new URL(S);let B;return B=function(H,te,ie){if(!ie)return H;if(H||(H={}),xl(ie))return H.location=ie,H;const K=te.port?`:${te.port}`:"";return H.location=`${te.protocol}//${te.hostname}${K}${ie}`,H}(B,P,R),B=function(H,te,ie){if(!ie)return H;H||(H={});const K=H;return ie.split(",").forEach(se=>{const he=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(se);if((he==null?void 0:he.length)!==3)return;let pe;if(xl(he[1]))pe=he[1];else{const Ne=te.port?`:${te.port}`:"";pe=`${te.protocol}//${te.hostname}${Ne}${he[1]}`}switch(he[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":K.sessionDeleteLink=pe;break;case"urn:ietf:params:whep:core:playback-controls":K.mediaControls=pe;break;case"urn:ietf:params:whep:ext:core:layer":K.layerControls=pe;break;default:return}}),K}(B,P,M),B}getTransport(){return"http"}}var tr=i(1564);function wl(O){return O.track.kind===Cu.AUDIO}function $0(O){return O.track.kind===Cu.VIDEO&&typeof O.config=="object"}const OE=(O,S)=>function(R){return R.kind===Cu.AUDIO}(O)?((R,M)=>{var P;const B={maxBitrateBps:ro((P=M==null?void 0:M.maxAudioBitrateKbps)!==null&&P!==void 0?P:64)},H=M==null?void 0:M.stereo;return typeof H=="boolean"&&(B.stereo=H),{track:R,config:B}})(O,S):((R,M)=>{var P,B,H,te;const ie=(P=M==null?void 0:M.minBitrate)!==null&&P!==void 0?P:Nm,K=(B=M==null?void 0:M.maxBitrate)!==null&&B!==void 0?B:Im,se=(H=M==null?void 0:M.maxFramerate)!==null&&H!==void 0?H:yc,he=!!(!((te=M==null?void 0:M.simulcast)===null||te===void 0)&&te.enabled);return{track:R,config:{minBitrateBps:ro(ie),maxBitrateBps:ro(K),maxFramerate:se,simulcastEnabled:he,inBandMessagingEnabled:!1}}})(O,S),Fa=(O,S)=>{if(typeof O=="number")return O;const R=S?D0:_x;return R[O]!==void 0?R[O]:0};function kp(O){if(O<Nm||O>Im)throw new Error(`Stage bitrate must be between ${Nm} kbps and ${Im} kbps`)}function Cx(O,S){const R=bE();let M=Object.assign({},R,(0,ua.cloneDeep)(S));return M=function(P,B){var H,te,ie;const K=Object.assign({},(0,ua.cloneDeep)(B)),se=!us.browser.isChrome()&&!us.browser.isEdge(),he=(ie=(te=(H=P.getSettings)===null||H===void 0?void 0:H.call(P))===null||te===void 0?void 0:te.displaySurface)!==null&&ie!==void 0&&ie,pe=ro(K.maxBitrate)<Pm.maxBitrate;return(se||he||pe)&&(K.simulcast.enabled=!1),K}(O,M),kp(M.maxBitrate),kp(M.minBitrate),function(P){if(P&&(P>yc||P<Uy))throw new Error(`framerate cannot exceed ${yc} fps`)}(M.maxFramerate),function(P){if(P<k0||P>oi)throw new Error(`Stage audio bitrate must be between ${k0} kbps and ${oi} kbps`)}(M.maxAudioBitrateKbps),function(P){if(typeof P!="boolean")throw new Error("Stage stereo prop must be a boolean")}(M.stereo),M}function NE({stageErrorValue:O,action:S,token:R,traceId:M,tag:P,identifier:B,details:H}){return new Ir(Object.assign(Object.assign({},O),{token:R,traceId:M,location:"peer-client",tag:P,action:S,remoteParticipantId:B,details:H}))}var Os;function Wo(O){var S;return!((S=O==null?void 0:O.sender)===null||S===void 0)&&S.createEncodedStreams?Os.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?Os.ENCODED_TRANSFORMS:Os.NONE}function qy(O){var S;return!((S=O==null?void 0:O.receiver)===null||S===void 0)&&S.createEncodedStreams?Os.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?Os.ENCODED_TRANSFORMS:Os.NONE}function IE(O){let S=[];const R=new Map;function M(P){const B="0123456789abcdef";let H="";for(let te=0;te<P;te+=1)H+=B.charAt(Math.floor(Math.random()*B.length));return H}return{add(P){const B=M,H=`${B(8)}-${B(4)}-${B(4)}-${B(4)}-${B(12)}`,te=Date.now();return S.push({id:H,enqueuedAt:te,payload:P}),H},poll(P){return R.has(P)||R.set(P,[]),R.size>=O&&(R.forEach(B=>{B.push(...S)}),S=[]),(R.get(P)||[]).splice(0,1)}}}function mR(O,S){return S.type==="sei"?function(R,M){const te=new Uint8Array([1,2,1,8,1,2,3,4,2,2,2,4,4,3,2,1]);function ie(he,pe,Ne){return Ne+pe.length<=he.byteLength&&pe.every((Je,Ye)=>he.getUint8(Ne+Ye)===Je)}function K(he,pe){const Ne=function(Ye,Oe){return new Uint8Array([0,0,1,6,5,...Oe,...Ye])}(he,function(Ye){const Oe=[];for(;Ye>=255;)Oe.push(255),Ye-=255;return Oe.push(Ye),new Uint8Array(Oe)}(pe.length+he.length)),Je=function(Ye){const Oe=[...Ye];let _e=3;for(;_e<Oe.length-2;)Oe[_e]!==0||Oe[_e+1]!==0||Oe[_e+2]!==0&&Oe[_e+2]!==1&&Oe[_e+2]!==2&&Oe[_e+2]!==3?_e+=1:(Oe.splice(_e+2,0,3),_e+=3);return Oe}(new Uint8Array([...Ne,...pe,128]));return new Uint8Array(Je)}function se(he,pe){const Ne=function(Je){const Ye=new DataView(Je);for(let Oe=0;Oe<Ye.byteLength-4;Oe++)if(ie(Ye,[0,0,1],Oe)){const _e=31&Ye.getUint8(Oe+3);if(_e>=1&&_e<=5)return Oe}return-1}(R.data);if(Ne>=0){const Je=new ArrayBuffer(R.data.byteLength+pe.byteLength),Ye=new Uint8Array(Je);return Ye.set(new Uint8Array(R.data.slice(0,Ne)),0),Ye.set(pe,Ne),Ye.set(new Uint8Array(R.data.slice(Ne)),Ne+pe.byteLength),Je}return he}return function(){for(let he=0;he<M.length;he+=1){const pe=K(te,new Uint8Array(M[he]));R.data=se(R.data,pe)}return R}()}(O,S.payloads||[]):O}function W0(O,S){const{type:R,transformerId:M}=S;if(R==="sei"){const P=function(te){function se(Ne,Je,Ye){return Ye+Je.length<Ne.byteLength&&Je.every((Oe,_e)=>Ne.getUint8(Ye+_e)===Oe)}function he(Ne){const Je=[];let Ye=0;for(;Ye<Ne.length;)Ne[Ye]===0&&Ne[Ye+1]===0&&Ne[Ye+2]===3?(Je.push(Ne[Ye]),Je.push(Ne[Ye+1]),Ye+=3):(Je.push(Ne[Ye]),Ye+=1);return new Uint8Array(Je)}function pe(Ne){let Je=2;const Ye=Ne.byteLength;for(;Je<Ye;){let Oe=0;for(;Je<Ye&&Ne[Je]===255;)Oe+=255,Je++;Oe+=Ne[Je],Je++;const _e=Math.min(Je+Oe,Ye),lt=new Uint8Array(Ne.slice(Je,_e));return{uuid:lt.slice(0,16),payload:lt.slice(16)}}}return{messages:function(Ne){const Je=new DataView(Ne.data),Ye=[];let Oe=0;if(!se(Je,[0,0,1],0)&&!se(Je,[0,0,0,1],0))return[];for(;Oe<Je.byteLength-5;)if(se(Je,[0,0,1],Oe)){const _e=Oe+3;Oe=_e;const lt=31&Je.getUint8(Oe),wt=31&Je.getUint8(Oe+1);if(lt===6&&wt===5){for(;Oe<Je.byteLength&&!se(Je,[0,0,1],Oe);)Oe++;const Kt=Oe,It=pe(he(new Uint8Array(Ne.data.slice(_e,Kt))));It&&Ye.push(Object.assign(Object.assign({},It),{timestamp:Ne.timestamp,type:Ne.type}))}else Oe++}else Oe++;return Ye}(te),frame:te}}(O),{frame:B,messages:H}=P;return{success:!0,frame:B,type:R,transformerId:M,seiResult:H}}return{success:!0,frame:O,transformerId:M,type:R}}function Rx(){let O;const S=P=>(B,H)=>{const te=B.getMetadata().synchronizationSource,ie=(O?O.poll(te):[]).map(K=>K.payload);H.enqueue("<SEND_TRANSFORMER_IMPL>"(B,Object.assign(Object.assign({},P),{payloads:ie})))},R=P=>(B,H)=>{try{const te="<RECEIVE_TRANSFORMER_IMPL>"(B,P);H.enqueue(te.frame),self.postMessage(Object.assign(Object.assign({success:te.success},P),{seiResult:te.seiResult}))}catch{self.postMessage(Object.assign({success:!1},P))}};function M(P,B,H,te){const ie=new TransformStream({transform:P==="video/send"?S(B):R(B)});H.pipeThrough(ie).pipeTo(te)}return self.onrtctransform=P=>{const B=P.transformer;B&&M(B.options.method,B.options,B.readable,B.writable)},self.onmessage=P=>{var B;const{operation:H,transformerId:te}=P.data;H==="insert"?(O||(O="<CREATE_MESSAGE_QUEUE>"(1)),O.add((B=P.data)===null||B===void 0?void 0:B.payload)):H!=="video/receive"&&H!=="video/send"||M(H,{method:H,transformerId:te,type:"sei"},P.data.readable,P.data.writable)},{videoReceiveTransform:R,videoSendTransform:S}}(function(O){O.NONE="none",O.ENCODED_TRANSFORMS="encodedTransforms",O.INSERTABLE_STREAMS="insertableStreams"})(Os||(Os={}));const Ax=()=>{let O=Rx.toString();return O=O.replace('"<SEND_TRANSFORMER_IMPL>"',mR.toString()),O=O.replace('"<RECEIVE_TRANSFORMER_IMPL>"',W0.toString()),O=O.replace('"<CREATE_MESSAGE_QUEUE>"',IE.toString()),O},Fm=(()=>{let O;return{getWorker:()=>(O||(O=function(){const S=new Blob([`(${Ax()})()`],{type:"text/javascript"}),R=URL.createObjectURL(S);return new Worker(R)}()),O),destroy:()=>{O&&O.terminate(),O=void 0}}})(),kE="seiMessageReceived",Y0="error";var Zc;(function(O){O.CREATED="created",O.INITIALIZED="initialized",O.DESTROYED="destroyed"})(Zc||(Zc={}));class zm extends Xc{constructor({enabled:S}){super(),this.state=Zc.CREATED,this.transformerId=xa().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=R=>{this.onTransformResult(R.data)},S||this.destroy()}initializeInsertableStreams(S){var R;this.worker=Fm.getWorker();const M=S.receiver.createEncodedStreams(),{readable:P,writable:B}=M;(R=this.worker)===null||R===void 0||R.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:P,writable:B},[P,B]),this.worker.addEventListener("message",this.onMessage)}initializeEncodedTransforms(S){this.worker=Fm.getWorker();const R={method:"video/receive",type:"sei",transformerId:this.transformerId};S.receiver.transform=new RTCRtpScriptTransform(this.worker,R),this.worker.addEventListener("message",this.onMessage)}initialize(S,R){if(this.state!==Zc.CREATED)return!1;const M=qy(S);if(M===Os.NONE)return!1;if(R&&M===Os.INSERTABLE_STREAMS)this.initializeInsertableStreams(S);else{if(R||M!==Os.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(S)}return this.transceiver=S,this.state=Zc.INITIALIZED,!0}onTransceiverAdd(S){return this.initialize(S,!0)}onTrackEvent(S){return S.track.kind==="video"&&this.initialize(S.transceiver,!1)}static isSupported(S){return qy(S)!==Os.NONE}onTransformResult(S){return S.transformerId===this.transformerId&&(S.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!S.seiResult&&(S.seiResult.forEach(R=>{const{payload:M,uuid:P}=R;this.updateReadStats(R),this.emit(kE,{uuid:P,payload:M})}),S.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(S,Bt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(S,Bt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(S){this.seiReadCnt++,this.seiBytesRead+=S.payload.byteLength}getReceiverStats(){const{seiBytesRead:S,seiReadCnt:R}=this;return{seiReadCnt:R,seiBytesRead:S}}onError(S,R){const{type:M}=S;this.emit(Y0,{type:M,stageErrorValue:R})}destroy(){var S,R;this.state!==Zc.DESTROYED&&(this.removeAllListeners(),(S=this.worker)===null||S===void 0||S.removeEventListener("message",this.onMessage),!((R=this.transceiver)===null||R===void 0)&&R.receiver&&(this.transceiver.receiver.transform=null),this.state=Zc.DESTROYED)}getState(){return this.state}}class $y{constructor({enabled:S}){this.state=Zc.CREATED,this.transformerId=xa().value,S||this.destroy()}initializeInsertableStreams(S,R){var M;this.worker=Fm.getWorker();const P=S.sender.createEncodedStreams(),{readable:B,writable:H}=P;(M=this.worker)===null||M===void 0||M.postMessage({operation:"video/send",transformerId:this.transformerId,readable:B,writable:H},[B,H])}initializeEncodedTransforms(S,R){this.worker=Fm.getWorker();const M={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:R};S.sender.transform=new RTCRtpScriptTransform(this.worker,M)}initialize(S){var R;if(this.state!==Zc.CREATED)return!1;const M=Wo(S);if(M===Os.NONE)return!1;const P=S.sender.getParameters(),B=((R=P==null?void 0:P.encodings)===null||R===void 0?void 0:R.length)||1;if(M===Os.INSERTABLE_STREAMS)this.initializeInsertableStreams(S,B);else{if(M!==Os.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(S,B)}return this.transceiver=S,this.state=Zc.INITIALIZED,!0}static isSupported(S){return Wo(S)!==Os.NONE}sendSeiMessage(S){var R;this.state===Zc.INITIALIZED&&this.transceiver&&((R=this.worker)===null||R===void 0||R.postMessage({operation:"insert",transformerId:this.transformerId,payload:S}))}onTransceiverAdd(S){return this.initialize(S)}onTrackEvent(S){return!1}destroy(){var S;this.state!==Zc.DESTROYED&&(!((S=this.transceiver)===null||S===void 0)&&S.receiver&&(this.transceiver.receiver.transform=null),this.state=Zc.DESTROYED)}getState(){return this.state}}var za=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};let Hm=null;class X0 extends Xc{constructor(S,R,M,P,B,H,te,ie,K){var se,he;if(super(),this.analyticsTracker=H,this.sfuResource={node:"",cluster:""},this.stageCapabilities={simulcastNegotiated:!1},this.incompatibleCodecs=new Set,this.connect=({audioOnly:pe=!1,traceId:Ne,iceRestartOptions:Je})=>za(this,void 0,void 0,function*(){const{token:Ye,tag:Oe,identifier:_e,action:lt}=this,wt=!!Je,Kt=new AbortController;let It,Kn,wn;this.abortController=Kt,this.traceId=Ne,this.perfTracker.resetMeasurements(Ne);const yr=()=>{It&&this.off(ld,It),Kn&&this.off(Xs,Kn)},Fr=new Promise((kr,xr)=>{const _r=function({action:br,token:Ar,traceId:ur,tag:Tn,identifier:$n}){const $r=br===dn.SUBSCRIBE?Bt.SUBSCRIBE_TIMED_OUT:Bt.PUBLISH_TIMED_OUT;return new Ir(Object.assign(Object.assign({},$r),{action:br,token:Ar,traceId:ur,tag:Tn,location:"connect",remoteParticipantId:$n}))}({action:lt,token:Ye,traceId:Ne,tag:Oe,identifier:_e}),Rr=function({action:br,token:Ar,traceId:ur,tag:Tn}){const $n=Bt.OPERATION_ABORTED;return new Ir(Object.assign(Object.assign({},$n),{token:Ar,traceId:ur,location:"peer-client.connect",tag:Tn,action:br}))}({action:lt,token:Ye,traceId:Ne,tag:Oe}),Dr=setTimeout(()=>{this.stop(),this.analyticsTracker.trackError(_r),xr(_r)},1e4);It=br=>{clearTimeout(Dr),wt||this.stop(),xr(br)},Kn=br=>{if(br===at.CONNECTED)clearTimeout(Dr),kr();else if(br===at.FAILED){const Ar=function({action:ur,token:Tn,traceId:$n,tag:$r}){return new Ir(Object.assign(Object.assign({},Bt.PEER_CONNECTION_NETWORK_FAILURE),{token:Tn,traceId:$n,location:"peer-client.connect",tag:$r,action:ur}))}({action:lt,token:Ye,traceId:Ne,tag:Oe});clearTimeout(Dr),xr(Ar)}},this.on(ld,It),this.on(Xs,Kn),wn=()=>{clearTimeout(Dr)},Kt.signal.aborted&&(clearTimeout(Dr),xr(Rr)),Kt.signal.addEventListener("abort",()=>{clearTimeout(Dr),xr(Rr)})});try{const kr=yield Promise.all([za(this,void 0,void 0,function*(){wt||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(pe));const _r=Je==null?void 0:Je.assignmentToken,Rr=Je==null?void 0:Je.nodeOverride;return yield this.exchangeSdp({iceRestart:wt,nodeOverride:Rr,assignmentToken:_r,abortController:Kt}),this.mediaStream}),Fr]);this.statsReporter.traceId=Ne;const xr=kr[0];if(this.abortController=void 0,!wt&&lt===dn.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(_r){this.logger.error({err:_r,msg:"error syncing transceivers"})}return{mediaStream:xr}}catch(kr){throw wn&&wn(),kr}finally{yr()}}),this.disconnect=(pe=!1)=>za(this,void 0,void 0,function*(){var Ne;const{token:Je,action:Ye}=this;(Ne=this.abortController)===null||Ne===void 0||Ne.abort(),this.stop(),pe?this.cleanup(Ye,Je.participantID,Je,pe):yield this.cleanup(Ye,Je.participantID,Je,pe)}),this.onTrack=pe=>{const{token:Ne,action:Je,traceId:Ye,identifier:Oe}=this;this.trace(Ne,Ye,`onTrack: ${pe.track.kind}`,Je,Oe),this.videoSenderTransformer.onTrackEvent(pe),this.videoReceiverTransformer.onTrackEvent(pe)},this.onIceGatheringStateChange=()=>{var pe,Ne,Je;const{token:Ye,action:Oe,traceId:_e,identifier:lt}=this;if(((pe=this.peerConnection)===null||pe===void 0?void 0:pe.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((Ne=this.peerConnection)===null||Ne===void 0?void 0:Ne.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const wt=this.peerConnection.iceGatheringState,Kt=new I0(Oe,Ye,_e,wt,lt);this.analyticsTracker.trackEventNoSharedProps(Kt)}this.trace(Ye,_e,`ICE gathering state change: ${(Je=this.peerConnection)===null||Je===void 0?void 0:Je.iceGatheringState}`,Oe,lt)},this.onSelectedCandidatePairChange=()=>{var pe,Ne;const{token:Je,action:Ye,traceId:Oe,identifier:_e}=this,lt=(Ne=(pe=this.peerConnection)===null||pe===void 0?void 0:pe.getReceivers()[0].transport)===null||Ne===void 0?void 0:Ne.iceTransport,wt=lt==null?void 0:lt.getSelectedCandidatePair();if(wt){const{local:Kt,remote:It}=wt,Kn=`Selected candidate pair change (local, remote): ${Kt==null?void 0:Kt.candidate}, ${It==null?void 0:It.candidate}`;this.logger.debug({msg:Kn}),this.trace(Je,Oe,Kn,Ye,_e)}},this.onIceCandidate=pe=>za(this,void 0,void 0,function*(){var Ne,Je;const{identifier:Ye,action:Oe,traceId:_e}=this,lt=(Ne=pe.target.localDescription)===null||Ne===void 0?void 0:Ne.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new Om(this.token,_e,`ice candidate: hasRelay = ${lt}, candidate = ${(Je=pe.candidate)===null||Je===void 0?void 0:Je.candidate}`,Oe,Ye))}),this.onMute=()=>za(this,void 0,void 0,function*(){const{token:pe,action:Ne,traceId:Je,identifier:Ye}=this;this.trace(pe,Je,"Track has muted",Ne,Ye)}),this.onUnMute=()=>za(this,void 0,void 0,function*(){const{token:pe,action:Ne,traceId:Je,identifier:Ye}=this;this.trace(pe,Je,"Track has unmuted",Ne,Ye)}),this.fetchAndSetRemoteDescription=pe=>za(this,void 0,void 0,function*(){var Ne,Je,Ye,Oe;const _e=(Je=(Ne=this.peerConnection)===null||Ne===void 0?void 0:Ne.localDescription)===null||Je===void 0?void 0:Je.sdp;_e||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:lt,traceId:wt,action:Kt,identifier:It,tag:Kn}=this,{endpointURL:wn,nodeOverride:yr,assignmentToken:Fr,multiCodec:kr,abortController:xr}=pe;let _r;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{this.perfTracker.setTransport(this.sdpExchanger.getTransport());const ur=yr||ad("node")||ad("dataPlaneEndpoint");_r=yield this.sdpExchanger.exchange({sdpOffer:_e,url:wn,traceId:wt,forceNode:ur,assignmentToken:Fr,multiCodec:kr,abortController:xr,initialLayerPreference:(Ye=this.simulcastSubscribeConfig)===null||Ye===void 0?void 0:Ye.initialLayerPreference})}catch(ur){let Tn=ur;Tn instanceof Ir||(Tn=new Ir(Object.assign(Object.assign({},Bt.UNEXPECTED_ERROR),{action:Kt,token:lt,traceId:wt,tag:Kn,details:ur instanceof Error?ur.message:"",location:"sdp-exchange"}))),Tn instanceof Ir&&(this.analyticsTracker.trackError(Tn),this.emit(ld,Tn))}if(this.perfTracker.markSdpExchangeStop(),!_r)return;const{location:Rr,sessionDeleteLink:Dr,mediaControls:br}=_r;let Ar=_r.sdpAnswer;try{Ar=this.mungeSdpAnswer(Ar),_r.sdpAnswer=Ar}catch(ur){this.logger.error({err:ur,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=Ar,this.emit(y0,_r),Rr&&(this.whipResource={location:Rr,sessionDeleteLink:Dr,mediaControls:br},this.sfuResource=function(ur){const Tn=ur.match(/https:\/\/([^/]+)\//);if(Tn){const $n=Tn[1].split(".");if($n[0].includes("video-rtx"))return{node:`${$n[0]}.${$n[1]}`,cluster:$n[1]}}}(Rr)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(Oe=this.peerConnection)===null||Oe===void 0?void 0:Oe.setRemoteDescription({sdp:Ar,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(ur){const Tn=new Ir(Object.assign(Object.assign({},Bt.SET_ANSWER_FAILURE),{action:Kt,token:lt,traceId:wt,tag:To(Kt,It),location:"setRemoteDescription",remoteParticipantId:It,details:ur instanceof Error?ur.message:""}));this.analyticsTracker.trackError(Tn),this.emit(ld,Tn)}}),this.cleanup=(pe,Ne,Je,Ye=!1)=>za(this,void 0,void 0,function*(){var Oe,_e,lt;const wt=xa();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,!(!((Oe=this.whipResource)===null||Oe===void 0)&&Oe.location))return this.trace(Je,this.traceId,"whipResource location not known, exiting cleanup",pe,Ne),void this.analyticsTracker.trackError(new Ir(Object.assign(Object.assign({},Bt.WHIP_URL_MISSING),{action:pe,token:Je,traceId:this.traceId,tag:To(pe,Ne),location:pe===dn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:wt,remoteParticipantId:Ne})));let Kt=this.whipResource.location;if(this.trace(Je,this.traceId,`use hostnamecachedurl: ${Kt}`,pe,Ne),Ye){if(!((lt=this.whipResource)===null||lt===void 0)&&lt.sessionDeleteLink){Kt=this.whipResource.sessionDeleteLink,this.trace(Je,this.traceId,`DELETE via session-delete beacon path: ${Kt}`,pe,Ne);try{navigator.sendBeacon(Kt,JSON.stringify({authorization:Je.rawToken}))}catch(It){this.analyticsTracker.trackErrorAndThrow(new Ir(Object.assign(Object.assign({},Tp(Bt.WHIP_DELETE_FAILURE,It)),{action:pe,token:Je,traceId:this.traceId,tag:To(pe,Ne),location:dn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:wt,remoteParticipantId:Ne})))}}}else try{yield Ks().delete(Kt,{headers:{Authorization:`Bearer ${Je.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":wt.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":vc}})}catch(It){((_e=It.response)===null||_e===void 0?void 0:_e.status)===404?this.trace(Je,this.traceId,`DELETE returned 404, ignoring, action = ${pe}, uuid = ${wt.value}`,pe,Ne):this.analyticsTracker.trackErrorAndThrow(new Ir(Object.assign(Object.assign({},Tp(Bt.WHIP_DELETE_FAILURE,It)),{action:pe,token:Je,traceId:this.traceId,tag:To(pe,Ne),location:dn.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:wt,remoteParticipantId:Ne})))}}),this.getConnectionState=()=>{if(!this.peerConnection)return at.NONE;const pe=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return vE(pe)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:pe}),at.IDLE}},this.onIceCandidateError=pe=>{const{token:Ne,traceId:Je,tag:Ye}=this;if(pe.errorCode!==701){const Oe=new Ir(Object.assign(Object.assign({},Bt.ICE_CANDIDATE_ERROR),{action:this.action,token:Ne,traceId:Je,tag:Ye,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(Oe),this.emit(ld,Oe)}},this.onIceConnectionStateChange=()=>{var pe;const{token:Ne,traceId:Je,action:Ye,identifier:Oe}=this;this.trace(Ne,Je,`ICE connection state change: ${(pe=this.peerConnection)===null||pe===void 0?void 0:pe.iceConnectionState}`,Ye,Oe),this.onConnectionStateChange()},this.createVideoReceiverTransformer=({enabled:pe})=>{const Ne=new zm({enabled:pe}),{token:Je,tag:Ye,identifier:Oe,action:_e,traceId:lt}=this;Ne.on(kE,It=>{this.emit(Ep,It)});const wt=function(It,Kn){let wn=0;return function(...yr){const Fr=Date.now();Fr-wn>=Kn&&(wn=Fr,It(...yr))}}(It=>{const Kn=`Transform error occurred: ${It.type}`,wn=NE({traceId:lt,token:Je,tag:Ye,identifier:Oe,action:_e,details:Kn,stageErrorValue:Bt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:wn,msg:"Error encountered when transforming receiver",error:It})},1e3),Kt=It=>{const Kn=`Too many errors occurred: ${It.type}`,wn=NE({traceId:lt,token:Je,tag:Ye,identifier:Oe,action:_e,details:Kn,stageErrorValue:Bt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:wn,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:It}),Ne.destroy(),this.analyticsTracker.trackError(wn),this.emit(ft,wn)};return Ne.on(Y0,It=>{It.stageErrorValue.code!==Bt.TRANSFORM_TOO_MANY_ERRORS.code?wt(It):Kt(It)}),Ne},this.onConnectionStateChange=()=>{var pe;if(this.peerConnection){const Je=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:Ye,traceId:Oe,identifier:_e,action:lt}=this,wt=new Ba(lt,Ye,Oe,Je,_e);this.analyticsTracker.trackEventNoSharedProps(wt),this.trace(Ye,Oe,`connection state change: ${Je}`,lt,_e)}const Ne=this.getConnectionState();switch(Ne){case at.CONNECTED:this.perfTracker.markActionStop(),this.emit(Xs,Ne),this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub),(pe=this.peerConnection)===null||pe===void 0||pe.getTransceivers().forEach(Je=>{var Ye,Oe;!((Oe=(Ye=Je.receiver)===null||Ye===void 0?void 0:Ye.transport)===null||Oe===void 0)&&Oe.iceTransport&&Je.receiver.transport.iceTransport.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)});break;case at.FAILED:this.emit(Xs,Ne),this.handleConnectionFailure();break;default:this.emit(Xs,Ne)}},this.onIncompatibleCodecs=pe=>za(this,void 0,void 0,function*(){if(pe.forEach(Ye=>{let Oe=!1;this.incompatibleCodecs.forEach(_e=>{_e.config===Ye.config&&_e.mime===Ye.mime&&(Oe=!0)}),Oe||this.incompatibleCodecs.add(Ye)}),this.peerConnection)try{yield(Ne=this.peerConnection,Je=[...this.incompatibleCodecs],EE(void 0,void 0,void 0,function*(){var Ye;for(const Oe of Ne.getSenders()){const _e=Oe.getParameters();if(_e.codecs.length>1){const lt=_e.codecs[0];let wt=!1;for(const Kt of Je)ph(lt,Kt)&&(wt=!0);if(wt){const Kt=L0(Je,_e.codecs);(Ye=_e.encodings)===null||Ye===void 0||Ye.forEach(It=>{It.active&&(It.codec=Kt)}),yield Oe.setParameters(_e)}}}}))}catch(Ye){const{token:Oe,action:_e,traceId:lt,identifier:wt}=this,Kt=new Ir(Object.assign(Object.assign({},Bt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:_e,token:Oe,traceId:lt,tag:To(_e,wt),location:"onIncompatibleCodecs",remoteParticipantId:wt,details:Ye instanceof Error?Ye.message:""}));this.analyticsTracker.trackError(Kt),this.emit(ld,Kt)}var Ne,Je}),this.token=S,this.logger=new to(R,me.WEBRTC),this.action=M,this.tag=P,this.traceId=B,M===dn.SUBSCRIBE&&!te)throw new Error("Subscribe action provided without subscriber Id");this.inBandMessagingEnabled=M===dn.SUBSCRIBE?!!(!((se=K==null?void 0:K.inBandMessaging)===null||se===void 0)&&se.enabled):(he=oh("enableInBandMessaging"))!==null&&he!==void 0&&he,this.jitterBufferConfig=K==null?void 0:K.jitterBuffer,this.simulcastSubscribeConfig=K==null?void 0:K.simulcast,this.subscriberId=te,this.stageConnection=ie,this.videoSenderTransformer=new $y({enabled:this.action===dn.PUBLISH&&this.inBandMessagingEnabled}),this.videoReceiverTransformer=this.createVideoReceiverTransformer({enabled:this.action===dn.SUBSCRIBE&&this.inBandMessagingEnabled}),this.perfTracker=new _E(this.action,this.traceId),this.statsReporter=new j0(M,S,B,this.identifier,this.analyticsTracker,this.videoReceiverTransformer),this.sdpExchanger=function(pe){const{connection:Ne,token:Je,action:Ye,identifier:Oe,tracker:_e}=pe,lt=Ne&&Ne.supportsSdpExchange(),wt=Ye===dn.SUBSCRIBE&&lt&&!Ry(),Kt=Ye===dn.PUBLISH&&lt&&p0()&&!Ry();return wt||Kt?new ME(Je,Ne,{action:Ye,remoteParticipantId:Oe},_e):new Gy(Je,{action:Ye,remoteParticipantId:Oe},_e)}({connection:ie,action:M,token:S,identifier:this.identifier,tracker:H}),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var S,R;return(R=(S=this.videoTransceiver)===null||S===void 0?void 0:S.mid)!==null&&R!==void 0?R:null}toggleStageConnectionListeners(S){var R,M;S?(R=this.stageConnection)===null||R===void 0||R.on(mc,this.handlePublishingChangedBinding):(M=this.stageConnection)===null||M===void 0||M.off(mc,this.handlePublishingChangedBinding)}updateSubscribeConfig(S){var R,M;this.jitterBufferConfig=S.jitterBuffer,this.simulcastSubscribeConfig=S.simulcast,this.action===dn.SUBSCRIBE&&(this.inBandMessagingEnabled=S.inBandMessaging.enabled),this.applyJitterBufferMinDelayConditionally((M=(R=this.stageConnection)===null||R===void 0?void 0:R.getIsStagePublishing())!==null&&M!==void 0&&M)}verifyOrUpdateTransceiverSync(){var S,R;return za(this,void 0,void 0,function*(){if(this.videoTrackForPub){const M=this.getTransceiverForKind("video");M?this.videoTrackForPub.track.id!==((S=M.sender.track)===null||S===void 0?void 0:S.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateTrack(this.videoTrackForPub)):this.logger.warn({msg:"missing transceiver for video"})}if(this.audioTrackForPub){const M=this.getTransceiverForKind("audio");M?this.audioTrackForPub.track.id!==((R=M.sender.track)===null||R===void 0?void 0:R.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateTrack(this.audioTrackForPub)):this.logger.warn({msg:"missing transceiver for audio"})}})}start(){var S,R,M;return za(this,void 0,void 0,function*(){const{token:P,action:B,traceId:H,identifier:te}=this;B!==dn.PUBLISH||P.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Ir(Object.assign(Object.assign({},Tp(Bt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:B,token:P,traceId:H,tag:To(B,te),location:"StagePeerClient.start",remoteParticipantId:te})));const ie=function({action:K,identifier:se,token:he,analyticsTracker:pe}){let Ne="";const Je=xu(he,pe);switch(K){case dn.PUBLISH:Ne=Je.getPublishEndpoint();break;case dn.SUBSCRIBE:se&&(Ne=Je.getSubscribeEndpoint(se))}return Ne}({action:B,identifier:te,token:P.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.stageCapabilities={simulcastNegotiated:(M=(R=(S=this.videoTrackForPub)===null||S===void 0?void 0:S.config)===null||R===void 0?void 0:R.simulcastEnabled)!==null&&M!==void 0&&M},this.endpointURL=ie,this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,this.stageCapabilities.simulcastNegotiated),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute),this.trace(P,H,"peer connection created",B,te)}catch(K){const se=new Ir(Object.assign(Object.assign({action:B},Tp(Bt.CREATE_PEER_CONNECTION_FAILURE,K)),{token:P,traceId:H,tag:To(B,te),location:"StagePeerClient.start",remoteParticipantId:te}));B===dn.PUBLISH&&this.emit(Xs,at.FAILED),this.emit(ld,se),this.analyticsTracker.trackErrorAndThrow(se)}})}mungeSdpOffer(S,R,M){if(M.simulcastNegotiated&&(S=new zi(S).withVideoLayersAllocationRtpHeaderExtension().sdp),R===dn.SUBSCRIBE)S=new zi(S).withOpusAudioConfig(ro(oi),!0).sdp;else if(R===dn.PUBLISH&&M.audioConfig){const{maxBitrateBps:P,stereo:B}=M.audioConfig;S=new zi(S).withOpusAudioConfig(P,B).sdp}return S}mungeSdpAnswer(S){return us.browser.isFirefox()&&this.audioTrackForPub&&this.action===dn.PUBLISH&&(S=new zi(S).withOpusAudioConfig(this.audioTrackForPub.config.maxBitrateBps,void 0).sdp),S}stop(){var S,R,M,P,B,H,te,ie,K;this.statsReporter.stop(),this.videoReceiverTransformer.destroy(),this.videoSenderTransformer.destroy(),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("connectionstatechange",this.onConnectionStateChange),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(M=this.peerConnection)===null||M===void 0||M.removeEventListener("icecandidateerror",this.onIceCandidateError),(P=this.peerConnection)===null||P===void 0||P.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(B=this.peerConnection)===null||B===void 0||B.removeEventListener("track",this.onTrack),(H=this.peerConnection)===null||H===void 0||H.removeEventListener("mute",this.onMute),(te=this.peerConnection)===null||te===void 0||te.removeEventListener("unmute",this.onUnMute),(ie=this.peerConnection)===null||ie===void 0||ie.removeEventListener("icecandidate",this.onIceCandidate),(K=this.peerConnection)===null||K===void 0||K.close()}getTransceiverForKind(S){if(!this.peerConnection)return;const R=this.peerConnection.getTransceivers();return S==="audio"?R.find(M=>M.mid==="0"):S==="video"?R.find(M=>M.mid==="1"):void 0}removeTrack(S){return za(this,void 0,void 0,function*(){if(S==="audio"||S==="video")if(this.peerConnection)try{const R=this.getTransceiverForKind(S);if(!R)return void this.logger.warn({msg:`tried removing track type ${S} but couldn't find transceiver`});yield R.sender.replaceTrack(null),S===Cu.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0,yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(R){this.logger.warn({msg:"error replacing track",err:R})}else S===Cu.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:S})})}replaceOrUpdateTrack(S){return za(this,void 0,void 0,function*(){if(S.track){if(wl(S)?this.audioTrackForPub=S:$0(S)&&(this.videoTrackForPub=S),this.peerConnection)try{const R=this.getTransceiverForKind(S.track.kind);if(!R)return void this.logger.warn({msg:`tried replacing track type ${S.track.kind} but couldn't find transceiver`,track:S.track});if($0(S)){const M=R.sender.getParameters(),P=yh(this.stageCapabilities.simulcastNegotiated,S);M.encodings=M.encodings.map(B=>{var H;const te=(H=B.rid)!==null&&H!==void 0?H:"",ie=P.find(K=>{var se;return((se=K.rid)!==null&&se!==void 0?se:"")===te});return ie?Object.assign(Object.assign({},B),ie):B}),yield R.sender.setParameters(M)}else if(wl(S)){const M=R.sender.getParameters(),P=Mu(S)[0];M.encodings=M.encodings.map(B=>Object.assign(Object.assign({},B),P)),yield R.sender.setParameters(M)}yield R.sender.replaceTrack(S.track),yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(R){this.logger.warn({msg:"error replacing track",err:R})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateTrack with no track"})})}initializePeerConnection(S=!1){var R,M,P;return za(this,void 0,void 0,function*(){const{traceId:B,token:H,action:te,identifier:ie}=this;b0(this.peerConnection);let K=new MediaStream;if(te===dn.PUBLISH){this.audioTrackForPub||(this.audioTrackForPub={track:this.getSilentAudio(),config:{maxBitrateBps:ro(k0),stereo:!1}});const se=this.peerConnection.getTransceivers(),he=[];se.forEach(_e=>{var lt;he.concat((lt=_e.sender.track)===null||lt===void 0?void 0:lt.id)}),K=new MediaStream([this.audioTrackForPub.track,(R=this.videoTrackForPub)===null||R===void 0?void 0:R.track].filter(_e=>!!_e&&!he.includes(_e.id)));const pe=K.getAudioTracks()[0]||"audio",Ne=K.getVideoTracks()[0]||"video",Je={direction:"sendonly",streams:[K],sendEncodings:Mu(this.audioTrackForPub)},Ye={direction:"sendrecv",streams:[K],sendEncodings:yh(this.stageCapabilities.simulcastNegotiated,this.videoTrackForPub)};this.peerConnection.addTransceiver(pe,Je),this.trace(H,B,`track added, type: ${pe.kind||pe}`,te,ie);const Oe=this.peerConnection.addTransceiver(Ne,Ye);this.trace(H,B,`track added, type: ${Ne.kind||Ne}`,te,ie),this.inBandMessagingEnabled&&!$y.isSupported(Oe)&&this.handleTransformNotSupported(),this.videoSenderTransformer.onTransceiverAdd(Oe)}else te===dn.SUBSCRIBE&&(H.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(H,B,"track added, type: audio",te,ie),S||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(H,B,"track added, type: video",te,ie),this.inBandMessagingEnabled&&!zm.isSupported(this.videoTransceiver)&&this.handleTransformNotSupported(),this.videoReceiverTransformer.onTransceiverAdd(this.videoTransceiver)),this.peerConnection.getTransceivers().forEach(se=>{se.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),K==null||K.addTrack(se.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})}),this.applyJitterBufferMinDelayConditionally((P=(M=this.stageConnection)===null||M===void 0?void 0:M.getIsStagePublishing())!==null&&P!==void 0&&P));return K})}handlePublishingChanged(S){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${S}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===dn.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(S)}applyJitterBufferMinDelayConditionally(S){const R=this.currentJitterBufferMinDelayInMs,M=this.calcJitterBufferMinDelay(S,this.jitterBufferConfig);if(S){if(R===void 0||R>M){const P=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${M}`;this.logger.debug({msg:P}),this.trace(this.token,this.traceId,P,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(M)}}else if(R===void 0||M!==R){const P=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${M}`;this.logger.debug({msg:P}),this.trace(this.token,this.traceId,P,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(M)}}calcJitterBufferMinDelay(S,R){var M,P,B;let H=0;if(!(()=>{const te=RTCRtpReceiver.prototype;return!(!te||typeof te!="object")&&("jitterBufferTarget"in te||"playoutDelayHint"in te)})())return 0;if(S)H=Fa((M=R==null?void 0:R.minDelayWhenPublishing)!==null&&M!==void 0?M:js.DEFAULT,S);else{H=Fa((P=R==null?void 0:R.minDelayWhenSubscribeOnly)!==null&&P!==void 0?P:js.DEFAULT,S);const te=(B=this.stageConnection)===null||B===void 0?void 0:B.jitterBufferMinDelayInMs();(R==null?void 0:R.minDelayWhenSubscribeOnly)===js.DEFAULT&&te!==void 0&&(H=te,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${H}`}))}return H}applyAndTrackJitterBufferMinDelay(S){var R,M;this.currentJitterBufferMinDelayInMs=S,this.statsReporter.updateJitterBufferMinDelay(S),S!==void 0&&((M=(R=this.peerConnection)===null||R===void 0?void 0:R.getTransceivers())===null||M===void 0||M.forEach(P=>{P.receiver&&this.applyJitterBufferMinDelay(P.receiver,S)}))}applyJitterBufferMinDelay(S,R){let M="Unable to set jitter buffer min delay";if("jitterBufferTarget"in S)M=`setting jitterBufferTarget to: ${R} for track: ${S.track.kind}`,this.logger.debug({msg:M}),S.jitterBufferTarget=R;else if("playoutDelayHint"in S){const P=R/1e3;M=`setting playoutDelayHint to: ${R} for track: ${S.track.kind}`,this.logger.debug({msg:M}),S.playoutDelayHint=P}else this.logger.warn({msg:M});this.trace(this.token,this.traceId,M,this.action,this.identifier)}exchangeSdp(S){var R;return za(this,void 0,void 0,function*(){const{traceId:M,token:P,action:B,identifier:H,tag:te,endpointURL:ie}=this,{iceRestart:K=!1,nodeOverride:se,assignmentToken:he,abortController:pe}=S;let Ne;this.logger.debug({msg:`Exchanging SDP: ${M.value}, iceRestart=${K}, nodeOverride=${se}, assignmentToken=${he}`}),b0(this.peerConnection),B===dn.PUBLISH&&jo()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((Ye,Oe)=>{var _e,lt;const wt=(_e=RTCRtpReceiver.getCapabilities("video"))===null||_e===void 0?void 0:_e.codecs;if(!wt)return;let Kt=wt;Kt=P0(wt,"42e0"),Oe.preferMainProfile&&(Kt=P0(wt,"4d00")),(lt=Ye.getTransceivers().find(It=>It.receiver.track.kind==="video"))===null||lt===void 0||lt.setCodecPreferences(Kt)})(this.peerConnection,{preferMainProfile:jo()}));try{this.trace(P,M,"Creating offer",B,H),Ne=yield this.peerConnection.createOffer({iceRestart:K})}catch(Ye){const Oe=new Ir(Object.assign(Object.assign({},Tp(Bt.CREATE_OFFER_FAILURE,Ye)),{action:B,token:P,traceId:M,tag:te,location:"exchangeSdp",remoteParticipantId:H}));this.emit(ld,Oe),this.analyticsTracker.trackErrorAndThrow(Oe)}Ne.sdp&&(Ne.sdp=this.mungeSdpOffer(Ne.sdp,B,{simulcastNegotiated:this.stageCapabilities.simulcastNegotiated,audioConfig:(R=this.audioTrackForPub)===null||R===void 0?void 0:R.config})),this.trace(P,M,"Setting local description",B,H),yield this.peerConnection.setLocalDescription(Ne),this.trace(P,M,"local description set",B,H),ie||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const Je=B===dn.PUBLISH&&jo()||B===dn.SUBSCRIBE&&oh("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:ie,nodeOverride:se,assignmentToken:he,multiCodec:Je,abortController:pe})})}getReports(){var S;return za(this,void 0,void 0,function*(){try{const R=(yield(S=this.peerConnection)===null||S===void 0?void 0:S.getStats())||[],M=[];return R.forEach(P=>{M.push(P)}),M}catch{return[]}})}requestRTCStats(S){return za(this,void 0,void 0,function*(){if(this.peerConnection)return this.peerConnection.getStats(S)})}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:S,tag:R,identifier:M,action:P,traceId:B}=this,H=NE({traceId:B,token:S,tag:R,identifier:M,action:P,stageErrorValue:Bt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:H,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(H),this.emit(ft,H)}handleConnectionFailure(){return za(this,void 0,void 0,function*(){const{token:S,traceId:R,tag:M}=this;this.analyticsTracker.trackError(new Ir(Object.assign(Object.assign({},Bt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:S,traceId:R,tag:M,location:"onIceCandidateError",remoteParticipantId:this.identifier})))})}getSilentAudio(){Hm||(Hm=new AudioContext);const S=Hm.createOscillator(),R=Hm.createGain();S.connect(R);const M=Hm.createMediaStreamDestination();return R.connect(M),R.gain.value=0,S.start(),M.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}initTracksToPublish(S){this.videoTrackForPub=S.find($0),this.audioTrackForPub=S.find(wl)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var S,R;return this.calcJitterBufferMinDelay((R=(S=this.stageConnection)===null||S===void 0?void 0:S.getIsStagePublishing())!==null&&R!==void 0&&R,this.jitterBufferConfig)}trace(S,R,M,P,B){this.analyticsTracker.trackEventNoSharedProps(new Om(S,R,M,P,B))}sendSeiMessage(S){var R;this.action===dn.PUBLISH&&((R=this.videoSenderTransformer)===null||R===void 0||R.sendSeiMessage(S))}}const Wy=dn.SUBSCRIBE;class Du{constructor(S,R,M){this.analyticsTracker=S,this.token=R,this.remoteId=M,this.action=Wy}trackAttempt({stageConnectionStats:S,isReassignment:R=!1,traceIdOverride:M,preAttemptSfuResource:P}){const{action:B,analyticsTracker:H,token:te,remoteId:ie}=this,K=M||fc();return H.trackEvent(new Um({token:this.token,subscribedId:this.remoteId,traceId:K,isEdpConnected:S.isConnected,isReassignment:R,preAttemptSfuResource:P})),{getTraceId:()=>K,trackSubscribeStarted({totalDurationWithRetries:se,retryTimes:he,sfuResource:pe,peerClientPerfStats:Ne}){const{optionsDuration:Je,postDuration:Ye,timeToCandidate:Oe,timeToConnected:_e,sdpExchangeDuration:lt,sdpExchangeTransport:wt,setRemoteDescDuration:Kt,peerConnectionDuration:It}=Ne,{edpInitialConnectDuration:Kn,edpInitialConnectRetries:wn,edpInitialStateDuration:yr,edpInitialStatePublishingCount:Fr,edpStateUpdateCount:kr}=S;H.trackEvent(new Ip({token:te,traceId:K,remoteParticipantId:ie,optionsDuration:Je,postDuration:Ye,timeToCandidate:Oe,totalDuration:_e,edpInitialConnectDuration:Kn,edpInitialConnectRetries:wn,edpInitialStateDuration:yr,edpInitialStatePublishingCount:Fr,edpStateUpdateCount:kr,sdpExchangeDuration:lt,sdpExchangeTransport:wt,setRemoteDescDuration:Kt,peerConnectionDuration:It,sfuResource:pe,totalDurationWithRetries:se,subscribeRetryTimes:he,isReassignment:R}))},trackSubscribeFirstFrame:({peerClientPerfStats:se,totalDurationWithRetries:he,sfuResource:pe,retryTimes:Ne,currentJitterBufferMinDelayInMs:Je,mediaType:Ye,firstFrameDuration:Oe})=>{const{sdpExchangeDuration:_e,sdpExchangeTransport:lt,setRemoteDescDuration:wt,peerConnectionDuration:Kt}=se,{edpInitialConnectDuration:It,edpInitialConnectRetries:Kn,edpInitialStateDuration:wn,edpInitialStatePublishingCount:yr,edpStateUpdateCount:Fr}=S;this.analyticsTracker.trackEvent(new wx({token:this.token,traceId:K,remoteParticipantId:ie,edpInitialConnectDuration:It,edpInitialConnectRetries:Kn,edpInitialStateDuration:wn,edpInitialStatePublishingCount:yr,edpStateUpdateCount:Fr,sdpExchangeDuration:_e,sdpExchangeTransport:lt,setRemoteDescDuration:wt,peerConnectionDuration:Kt,videoWasPaused:!1,firstFrameDuration:Oe,mediaType:Ye,sfuResource:pe,totalDurationWithRetries:he,subscribeRetryTimes:Ne,currentJitterBufferMinDelayInMs:Je}))},trackSubscribeFailed(se,he){const pe=((Ye,Oe,_e)=>{if(Ye instanceof Ir)return Ye;let lt="";return Ye instanceof Ts.AxiosError&&(lt+=`AxiosError - ${Ye.code}`),new Ir(Object.assign(Object.assign(Object.assign({},Bt.SUBSCRIBE_FAILURE),{action:Wy,token:Oe,traceId:_e,tag:pc.SUBSCRIBE_RELATED,location:"subscribe",details:`${lt} ${Ye==null?void 0:Ye.message}`}),{fatal:!0}))})(se,te,K);H.trackEvent(new CE({token:te,traceId:K,remoteParticipantId:ie,code:pe.code,message:pe.message,fatal:pe.fatal,nominal:pe.nominal,isReassignment:R}));const{isConnected:Ne}=S,Je=new Ir(Object.assign(Object.assign({},Bt.SUBSCRIBE_FAILURE),{action:B,token:te,traceId:K,tag:To(dn.SUBSCRIBE,ie),location:"subscribe",remoteParticipantId:ie,isEdpConnected:Ne,details:he}));return se instanceof Ir&&(Je.fatal=se.fatal,Je.nominal=se.nominal,Je.location=`subscribe > ${se.location}`),H.trackError(Je),pe},trackUnsubscribe:()=>{H.trackEvent(new Sx({token:te,unsubscribedId:ie,traceId:K}))},trackEndSucceeded:se=>{H.trackEvent(new Bm({token:te,traceId:K,remoteParticipantId:ie,isUnsubscribeSuccessful:!0,reason:se}))},trackEndFailed:se=>{const he=new Ir(Object.assign(Object.assign({},Bt.UNSUBSCRIBE_FAILURE),{token:te,traceId:K,tag:To(dn.SUBSCRIBE,ie),location:"unsubscribe",remoteParticipantId:ie}));return se!==wa.UNLOAD&&se!==wa.UNSUBSCRIBE||H.trackError(he),H.trackEvent(new Bm({token:te,traceId:K,remoteParticipantId:ie,isUnsubscribeSuccessful:!0,reason:se})),he}}}}class Dp extends qn{constructor(S,R,M,P,B,H){super(bn.PLAYBACK_LAYER_REQUEST,S,R,!1),Object.assign(this.properties,{media_type:M,remote_participant_id:P,track_id:B,layer_id:H})}}class DE extends qn{constructor(S,R,M,P,B,H=1){super(bn.PLAYBACK_LAYER_STATE,S,R,!1),Object.assign(this.properties,{media_type:M,remote_participant_id:P,track_id:B,request_count:H})}}var jm,Ha,Vm,fa;(function(O){O.PAUSE="pause",O.PLAY="play"})(jm||(jm={})),function(O){O.IDLE="idle",O.ACTIVE="active",O.ERRORED="errored",O.DESTROYED="destroyed"}(Ha||(Ha={})),function(O){O.SUCCESS="success"}(Vm||(Vm={})),function(O){O.FAILED="failed",O.DESTROYED="destroyed",O.THROTTLED="throttled"}(fa||(fa={}));var _h=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class Mx{constructor(S){this.state=Ha.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>_h(this,void 0,void 0,function*(){return this.state!==Ha.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(jm.PAUSE)}),this.startVideo=()=>_h(this,void 0,void 0,function*(){return this.state!==Ha.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(jm.PLAY)}),this.setLayer=R=>_h(this,void 0,void 0,function*(){return this.state!==Ha.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(R)}),this.unsetLayer=()=>_h(this,void 0,void 0,function*(){return this.state!==Ha.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()}),this.getLayers=()=>_h(this,void 0,void 0,function*(){return this.state!==Ha.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()}),this.sendPlaybackRequest=R=>_h(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,tr.err)(fa.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,tr.err)(fa.FAILED);this.logger.info({msg:`Sending ${R} request to ${this.playbackEndpoint}`});const M=R===jm.PAUSE?{pause:[this.mid]}:{play:[this.mid]},P=this.createPostWhepRequest(M);return fetch(this.playbackEndpoint,P).then(B=>B.status>=300?(new Error(`Error sending media controls request: ${B.status}:${B.statusText}`),this.logger.error({err:tr.err}),(0,tr.err)(fa.FAILED)):(this.logger.debug({msg:`Request to ${R} was successful: ${B.status}`}),(0,tr.ok)(Vm.SUCCESS))).catch(B=>(this.logger.error({err:B,msg:"Error sending media controls request"}),(0,tr.err)(fa.FAILED)))}),this.sendLayerRequest=R=>_h(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,tr.err)(fa.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,tr.err)(fa.FAILED);const M=typeof R=="string",P=M?{mediaId:this.mid,encodingId:R}:{},B=M?`set : ${R}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${B} at ${this.layersEndpoint}`});const H=this.createPostWhepRequest(P);return this.trackLayerRequest(R??"auto"),fetch(this.layersEndpoint,H).then(te=>this.state===Ha.DESTROYED?(0,tr.err)(fa.DESTROYED):te.status>=300?this.handleLayerRequestError(te.status,te.statusText):(this.logger.debug({msg:`Request to ${B} was successful: ${te.status}`}),(0,tr.ok)(Vm.SUCCESS))).catch(te=>this.handleLayerRequestError(0,te.message))}),this.sendLayerStateRequest=()=>_h(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,tr.err)(fa.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,tr.err)(fa.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const R=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,R).then(M=>_h(this,void 0,void 0,function*(){var P;if(this.state===Ha.DESTROYED)return(0,tr.err)(fa.DESTROYED);if(M.status>=300)return this.handleLayerStateRequestError(M.status,M.statusText);const B=yield M.json(),H=(P=B==null?void 0:B.layers)!==null&&P!==void 0?P:[],te=JSON.stringify(H,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${te}`}),(0,tr.ok)(H)})).catch(M=>this.handleLayerStateRequestError(0,M.message))}),this.logger=new to(S.logger,me.REMOTE_PLAYBACK),this.token=S.token,this.traceId=S.traceId,this.analyticsTracker=S.analyticsTracker,this.remoteParticipantId=S.remoteParticipantId}set mediaId(S){if(this.state!==Ha.DESTROYED){if(this.mid=S,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Ha.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Ha.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(S){var R,M;if(this.state!==Ha.DESTROYED){if(this.playbackEndpoint=(R=S.playback)!==null&&R!==void 0?R:null,this.layersEndpoint=(M=S.layers)!==null&&M!==void 0?M:null,!this.playbackEndpoint||!this.layersEndpoint){const P={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(P,null)}`}),void(this.state=Ha.IDLE)}this.mid&&(this.state=Ha.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Ha.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(S="command"){this.logger.info({msg:`skipping ${S}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(S){return S===Ha.DESTROYED?(0,tr.err)(fa.DESTROYED):(0,tr.err)(fa.FAILED)}createPostWhepRequest(S){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(S)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var S,R;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":xa().value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(R=(S=this.traceId)===null||S===void 0?void 0:S.value)!==null&&R!==void 0?R:"","X-Stages-WHIP-Version":vc}}trackLayerRequest(S){var R;this.analyticsTracker.trackEventNoSharedProps(new Dp(this.token,this.traceId,Xt.VIDEO,this.remoteParticipantId,(R=this.mid)!==null&&R!==void 0?R:"unknown",S))}trackLayerStateRequest(S=1){var R;this.analyticsTracker.trackEventNoSharedProps(new DE(this.token,this.traceId,Xt.VIDEO,this.remoteParticipantId,(R=this.mid)!==null&&R!==void 0?R:"unknown",S))}handleLayerRequestError(S,R){const M=`sendLayerRequest failed for reason: ${S} ${R}`;let P,B;return S===429?(P=fa.THROTTLED,B=Bt.WHEP_SET_LAYER_REQUEST_THROTTLED):(P=fa.FAILED,B=Bt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(B,M),(0,tr.err)(P)}handleLayerStateRequestError(S,R){const M=`sendLayerStateRequest failed for reason: ${S} ${R}`;let P,B;return S===429?(P=fa.THROTTLED,B=Bt.WHEP_GET_LAYER_STATE_THROTTLED):(P=fa.FAILED,B=Bt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(B,M),(0,tr.err)(P)}trackRequestError(S,R){const M=new Error(R);this.logger.error({err:M}),S.message=R;const P=this.createError(S);this.analyticsTracker.trackError(P)}createError(S,R){return new Ir(Object.assign({action:dn.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:pc.SUBSCRIBE_RELATED,details:R},S))}}var Gm,Yy,Yo,Ro,Ao=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})},PE=function(O,S,R,M){if(R==="a"&&!M)throw new TypeError("Private accessor was defined without a getter");if(typeof S=="function"?O!==S||!M:!S.has(O))throw new TypeError("Cannot read private member from an object whose class did not declare it");return R==="m"?M:R==="a"?M.call(O):M?M.value:S.get(O)};(function(O){O.DISCONNECTED="disconnected",O.CONNECTING="connecting",O.CONNECTED="connected",O.ERRORED="errored"})(Yo||(Yo={})),function(O){O.NONE="none",O.AUDIO_ONLY="audio_only",O.AUDIO_VIDEO="audio_video"}(Ro||(Ro={}));class Ox extends Xc{constructor(S,R,M,P,B,H,te){super(),this.id=S,this.token=R,this.stageConnection=M,this.nonScopedLogger=P,this.analyticsTracker=B,this.desiredSubscribeType=H,Gm.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:Yo.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new O0(1e3),this.cleanupFirstFrameTracking=N0,this.actualSubscribeType=Ro.NONE,this.action=dn.SUBSCRIBE,this.updateDesiredSubscribeType=K=>{this.desiredSubscribeType=K,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=K=>{this.peerClient.updateSubscribeConfig(K)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const K=this.actualSubscribeType,se=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${se}`}),this.subscriptionState.connectionState===Yo.CONNECTED&&se!==Ro.NONE&&K!==se&&this.applyVideoControlsBySubscribeType(se,K)},this.onParticipantUpdated=K=>{PE(this,Gm,"m",Yy).call(this,K)&&(this.logger.debug({msg:"onParticipantUpdated",participant:K}),this.processStateUpdate({isTargetPublishing:K.isPublishing}))},this.onParticipantJoined=K=>{PE(this,Gm,"m",Yy).call(this,K)&&(this.logger.debug({msg:"onParticipantJoined",participant:K}),this.processStateUpdate({isTargetPublishing:K.isPublishing}))},this.onParticipantLeft=K=>{PE(this,Gm,"m",Yy).call(this,K)&&(this.logger.debug({msg:"onParticipantLeft",participant:K}),this.processStateUpdate({isTargetPublishing:!1}))},this.requestRTCStats=K=>Ao(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(K)}),this.trySubscribe=K=>Ao(this,void 0,void 0,function*(){if(this.logger.debug({msg:`Subscribe attempt started: ${K}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==Yo.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:Yo.CONNECTING}));const se=this.stageConnection.getConnectionStats(),he=this.peerClient.getExpectedJitterBufferMinDelayInMs(),pe=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:se,preAttemptSfuResource:pe});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:Ne}=yield this.subscribe(this.attemptTracker.getTraceId()),Je=performance.now()-this.startConnectingTimestamp,Ye=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const Oe=this.failedRetries;this.attemptToActualizeSubscribeType();const _e=this.peerClient.getActionMeasurements();if(this.attemptTracker.trackSubscribeStarted({sfuResource:Ye,totalDurationWithRetries:Je,retryTimes:Oe,peerClientPerfStats:_e}),Ne){this.cleanupFirstFrameTracking();const lt=this.actualSubscribeType,wt=this.attemptTracker,Kt=(It,Kn)=>{wt.trackSubscribeFirstFrame({peerClientPerfStats:_e,sfuResource:Ye,totalDurationWithRetries:Je,retryTimes:Oe,currentJitterBufferMinDelayInMs:he,mediaType:Kn,firstFrameDuration:It})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:Ne,subscribeType:lt,callback:Kt})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,Ne&&this.emit(ge,Ne,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(Ne){const Je=this.attemptTracker.trackSubscribeFailed(Ne);this.logger.error({log:"Subscribe attempt failed",err:Ne}),this.onTrySubscribeFailure(Je,K)}return!1});const ie=fc();this.peerClient=new X0(R,this.nonScopedLogger,this.action,To(this.action,S),ie,B,S,M,te),this.logger=new to(P,me.SUBSCRIPTION),this.subscribeTracker=new Du(this.analyticsTracker,R,S),this.remotePlaybackController=new Mx({token:R,analyticsTracker:B,traceId:ie,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(S,R){try{S===Ro.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch(M=>{this.logger.error({err:M,msg:"Remote playback request to stop video failed"})}):S===Ro.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch(M=>{this.logger.error({err:M,msg:"Remote playback request to start video failed"})}),this.actualSubscribeType=S,this.logger.debug({msg:`Desired subscribe type actualized from ${R} to ${S}.`})}catch(M){this.logger.error({err:M,msg:`Error updating subscribe type from ${R} to ${S}.`})}}onPeerClientConnectionStateChange(S){const R=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${S}`,state:S,targetParticipant:R}),this.processStateUpdate({peerClientState:S})}onPeerClientTransformError(S){this.emit(no,S)}processStateUpdate(S){const R=this.previousSignalState,M=Object.assign({},R,S);this.isSubscriptionActive?(M.isTargetPublishing?S.peerClientState===at.CONNECTED?this.updateState({connectionState:Yo.CONNECTED,subscribeInProgress:!0}):S.peerClientState===at.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(wa.CONNECTION_FAIL),this.updateState({subscribeInProgress:!1})):(R.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:Yo.DISCONNECTED})),(!R.isTargetPublishing&&S.isTargetPublishing||S.peerClientState===at.FAILED)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,S)):this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"})}onTrySubscribeFailure(S,R){this.logger.debug({msg:"Changing/keeping state FAILED"});const M=S.fatal,P=S.code===Bt.OPERATION_ABORTED.code,B=this.failedRetries<=4;if(!P&&!M&&B){const H=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${H}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout(()=>Ao(this,void 0,void 0,function*(){this.throttledTrySubscribe(R)}),H)}else this.updateState({connectionState:Yo.ERRORED}),this.emit(dd,S),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(Xs,this.onPeerClientConnectionStateChange,this),this.peerClient.on(y0,R=>{this.remotePlaybackController.endpoints={playback:R.mediaControls,layers:R.layerControls}}),this.peerClient.on(Ep,R=>{this.emit(fh,R)}),this.peerClient.on(ft,this.onPeerClientTransformError,this),this.stageConnection.on(R0,this.onParticipantUpdated),this.stageConnection.on(df,this.onParticipantJoined),this.stageConnection.on(hd,this.onParticipantLeft),this.stageConnection.on(ha,this.onParticipantLeft);let S=!0;if(this.stageConnection.isConnected()){const R=this.stageConnection.getParticipant(this.id);S=!!(R!=null&&R.isPublishing)}this.processStateUpdate({isTargetPublishing:S})}throttledTrySubscribe(S){return this.throttler.invoke(this.trySubscribe,S)}updateState(S){S.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=S.subscribeInProgress),S.connectionState&&this.subscriptionState.connectionState!==S.connectionState&&(this.subscriptionState.connectionState=S.connectionState,this.emit(Am,this.subscriptionState.connectionState))}stop(S=!1){this.peerClient.off(Xs,this.onPeerClientConnectionStateChange,this),this.peerClient.off(ft,this.onPeerClientTransformError,this),this.unsubscribe(S),this.throttler.clear(),this.stageConnection.off(R0,this.onParticipantUpdated),this.stageConnection.off(df,this.onParticipantJoined),this.stageConnection.off(hd,this.onParticipantLeft),this.stageConnection.off(ha,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:Yo.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(S,R){return Ao(this,void 0,void 0,function*(){const{token:M,id:P}=this;M.assertTokenIsUnexpired(S,To(dn.SUBSCRIBE,P),"subscribe",P);const{mediaStream:B}=yield this.peerClient.connect({audioOnly:R,traceId:S});return{peerClient:this.peerClient,mediaStream:B}})}unsubscribe(S=!1){return Ao(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===Yo.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const R=S?wa.UNLOAD:wa.UNSUBSCRIBE;try{S?this.peerClient.disconnect(S):yield this.peerClient.disconnect(S),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(R)}catch{this.attemptTracker.trackEndFailed(R)}})}triggerIceRestart(S){var R;return Ao(this,void 0,void 0,function*(){const M=this.stageConnection.getConnectionStats(),P=this.peerClient.getSfuResource(),B=this.subscribeTracker.trackAttempt({stageConnectionStats:M,isReassignment:!0,traceIdOverride:S.traceId,preAttemptSfuResource:P}),H=performance.now();try{this.emit(Br),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:S,traceId:S.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const te=performance.now()-H,ie=this.peerClient.getSfuResource(),K=this.peerClient.getActionMeasurements();(R=this.attemptTracker)===null||R===void 0||R.trackEndSucceeded(wa.REASSIGNMENT),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),B.trackSubscribeStarted({totalDurationWithRetries:te,sfuResource:ie,retryTimes:0,peerClientPerfStats:K}),this.emit(fd)}catch(te){this.emit(Su),this.logger.error({msg:"ICE restart attempt failed",err:te});const ie=this.peerClient.getSfuResource(),K=B.trackSubscribeFailed(te,`iceRestart=true, startNode=${P.node}, endNode=${ie==null?void 0:ie.node}`);throw K.code===Bt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(K,"ice restart timeout"),te}})}measureFirstFrameDuration({mediaStream:S,subscribeType:R,callback:M}){const P=performance.now(),B=ie=>{const K=performance.now()-P;M(K,ie),ie==="audio"?te():H()};let H=N0,te=N0;return R!==Ro.AUDIO_ONLY&&(H=function(ie,K){return Mm(ie,"video",K)}(S,B)),te=function(ie,K){return Mm(ie,"audio",K)}(S,B),()=>{H(),te()}}}var yd,bi;Gm=new WeakSet,Yy=function(O){return O.id===this.id},function(O){O.JOIN_ERROR="JOIN_ERROR",O.PUBLISH_ERROR="PUBLISH_ERROR",O.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"}(yd||(yd={})),function(O){O[O.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",O[O.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",O[O.TIMEOUT=3]="TIMEOUT",O[O.FAILED=4]="FAILED",O[O.CANCELED=5]="CANCELED",O[O.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",O[O.CODEC_MISMATCH=7]="CODEC_MISMATCH",O[O.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED"}(bi||(bi={}));const gR={[bi.TOKEN_MALFORMED]:"Token is malformed",[bi.TOKEN_EXPIRED]:"Token expired and is no longer valid",[bi.TIMEOUT]:"Operation timed out",[bi.FAILED]:"Operation failed",[bi.CANCELED]:"Operation canceled",[bi.STAGE_AT_CAPACITY]:"Stage at capacity",[bi.CODEC_MISMATCH]:"Client codec is not supported",[bi.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation"},vR={[Bt.EXPIRED_TOKEN.code]:bi.TOKEN_EXPIRED,[Bt.MALFORMED_TOKEN.code]:bi.TOKEN_MALFORMED,[Bt.TOKEN_PERMISSIONS_DENIED.code]:bi.TOKEN_NOT_ALLOWED,[Bt.OPERATION_ABORTED.code]:bi.CANCELED,[Bt.JOIN_TIMED_OUT.code]:bi.TIMEOUT,[Bt.EVENT_PLANE_WS_CREATE_FAILED.code]:bi.FAILED,[Bt.EVENT_PLANE_PONG_TIMEOUT.code]:bi.FAILED,[Bt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:bi.FAILED,[Bt.PUBLISH_TIMED_OUT.code]:bi.TIMEOUT,[Bt.PUBLISH_FAILURE.code]:bi.FAILED,[Bt.SUBSCRIBE_TIMED_OUT.code]:bi.TIMEOUT,[Bt.SUBSCRIBE_FAILURE.code]:bi.FAILED,[Bt.STAGE_AT_CAPACITY.code]:bi.STAGE_AT_CAPACITY,[Bt.NO_MATCHING_CODEC.code]:bi.CODEC_MISMATCH,[Bt.NETWORK_FAILURE.code]:bi.FAILED,[Bt.INTERNAL_SERVER_ERROR.code]:bi.FAILED,[Bt.REMOTE_STREAM_NOT_FOUND.code]:bi.FAILED,[Bt.INTERNAL_MHCP_ERROR.code]:bi.FAILED,[Bt.UNREACHABLE_MHCP.code]:bi.FAILED,[Bt.INVALID_SESSION_STATUS.code]:bi.FAILED,[Bt.MHCP_ABORTED.code]:bi.FAILED};class yR extends Error{constructor(S,R,M){super(),this.code=S,this.category=R,this.message=M,this.name="StageError",this.errorDetails=[],this.message=`[${R}] ${M}`}addDetails(S){this.errorDetails.push(S)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var qm,$m,K0;(function(O){O.ERROR="error"})(qm||(qm={}));class _R extends Xc{constructor(){super(...arguments),this.handleError=(S,R,M=!0)=>{let P;if(S instanceof Ir){const B=vR[S.code];B&&(P=function(H,te,ie){var K,se;const he=gR[H],pe=new yR(H,te,he);return pe.addDetails({stageErrorMessage:he,stageErrorCode:H,stageErrorCategory:te,stageArn:(K=ie.token)===null||K===void 0?void 0:K.stageARN,traceId:(se=ie.traceId)===null||se===void 0?void 0:se.value,causeCode:ie.code,causeDetails:ie.details,causeMessage:ie.message,causeLocation:ie.location}),pe}(B,R,S))}if(P)return M&&this.emit(qm.ERROR,P),P}}}(function(O){O.INTERNAL="internal",O.API="api"})($m||($m={})),function(O){O.ADDITIVE="additive",O.REPLACE="replace"}(K0||(K0={}));class bR{constructor(S){this.logger=new to(S.logger,me.CONNECTION),this.subscribeConfig={defaults:S.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(S,R,M,P=K0.REPLACE){R=(se=>{const he=Lm(se);if(he.jitterBuffer!==void 0){const pe=Ne=>{if(typeof Ne=="number"){if(Ne<0)return 0;if(Ne>4e3)return 4e3}return Ne};he.jitterBuffer.minDelayWhenPublishing!==void 0&&(he.jitterBuffer.minDelayWhenPublishing=pe(he.jitterBuffer.minDelayWhenPublishing)),he.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(he.jitterBuffer.minDelayWhenSubscribeOnly=pe(he.jitterBuffer.minDelayWhenSubscribeOnly))}return he})(R),this.subscribeConfig.participants[S]===void 0&&(this.subscribeConfig.participants[S]={internalOverrides:{},apiOverrides:{},lastMerged:this.subscribeConfig.defaults});const B=this.subscribeConfig.participants[S];switch(M){case $m.INTERNAL:B.internalOverrides=this.handleSubscribeConfigLevelMerging(B.internalOverrides,R,P);break;case $m.API:B.apiOverrides=this.handleSubscribeConfigLevelMerging(B.apiOverrides,R,P);break;default:(function(se){throw new Error(`Unknown case kind: ${se}`)})(M)}const H=wE(this.subscribeConfig.defaults,B.internalOverrides,B.apiOverrides);if(H===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${S} | ${B}, ${R}`}),!1;const te=(ie=B.lastMerged,K=H,(typeof ie=="object"&&typeof K=="object"&&(0,ua.isEqual)(ie,K))===!1);var ie,K;return B.lastMerged=H,this.subscribeConfig.participants[S]=B,te}handleExternalSubscribeConfigUpdate(S,R,M,P=K0.REPLACE){const B=(H=>{const te={};return typeof H!="object"?tr.err(new Error("Invalid input")):(H.jitterBuffer!==void 0&&(te.jitterBuffer={},H.jitterBuffer.minDelay!==void 0&&(te.jitterBuffer.minDelayWhenSubscribeOnly=H.jitterBuffer.minDelay)),H.inBandMessaging!==void 0&&(te.inBandMessaging={enabled:H.inBandMessaging.enabled===!0}),H.simulcast!==void 0&&(te.simulcast={},H.simulcast.initialLayerPreference!==void 0&&(te.simulcast.initialLayerPreference=H.simulcast.initialLayerPreference)),tr.ok(te))})(R);return B.ok===!0&&this.handleSubscribeConfigUpdate(S,B.value,M,P)}handleSubscribeConfigLevelMerging(S,R,M){if(M===K0.REPLACE)return R;{const P=wE(S,R);return P===void 0?(this.logger.warn({msg:`Unable to merge '${S}' and '${R}' with type ${M}`}),S):P}}getSubscribeConfigSnapshot(S){return this.subscribeConfig.participants[S]===void 0?vr(this.subscribeConfig.defaults):vr(this.subscribeConfig.participants[S].lastMerged)}}class Nx extends qn{constructor(S){super(bn.REASSIGNMENT_REQUEST,S.token,S.traceId,!1),Object.assign(this.properties,{target_local_participant_id:S.targetLocalParticipantId,target_remote_participant_id:S.targetRemoteParticipantId}),this.critical=!0}}var Pu,Lu,so,bh,_d,Eh,Vs,Xo,LE=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class J0 extends Xc{constructor(S,R){super(),this.setGetStats=M=>{this.getInternalStats=M},this.getStats=()=>LE(this,void 0,void 0,function*(){return this.requestRTCStats()}),this.requestRTCStats=()=>LE(this,void 0,void 0,function*(){if(this.getInternalStats)return this.getInternalStats(this.mediaStreamTrack)}),this.getInternalStats=R,this.id=S.id,this.isMuted=!S.enabled,this.mediaStreamTrack=S,this.streamType=this.mediaStreamTrack.kind==="audio"?Xt.AUDIO:Xt.VIDEO}cleanup(){this.removeAllListeners(),this.getInternalStats=void 0}}(function(O){O.IDLE="IDLE",O.INITIALIZING="INITIALIZING",O.ACTIVE="ACTIVE",O.CONTROLS_PAUSED="CONTROLS_PAUSED",O.DESTROYED="DESTROYED"})(Pu||(Pu={})),function(O){O.LAYERS_CHANGED="LAYERS_CHANGED",O.LAYER_SELECTED="LAYER_SELECTED",O.ADAPTION_CHANGED="ADAPTION_CHANGED"}(Lu||(Lu={})),function(O){O.LAYERS_CHANGED="LAYERS_CHANGED",O.LAYER_SELECTED="LAYER_SELECTED",O.ADAPTION_CHANGED="ADAPTION_CHANGED"}(so||(so={})),function(O){O.UNAVAILABLE="unavailable",O.SELECTED="selected"}(bh||(bh={})),function(O){O.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged"}(_d||(_d={}));class UE extends J0{constructor(S,R){super(S),this.setMuted=M=>{M!==this.isMuted&&(this.mediaStreamTrack.enabled=!M,this.isMuted=M,this.emit(_d.LOCAL_STREAM_MUTE_CHANGED,this))},this.mediaConfig=Cx(S,R)}}class ER{constructor(S,R){this.strategy=S,this.logger=R}setStrategy(S){this.strategy=S}stageStreamsToPublish(){let S=[];try{S=this.strategy.stageStreamsToPublish(),S=S.filter(P=>P instanceof UE)}catch(P){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:P}),console.error("Error executing stageStreamsToPublish",P),tr.err(P)}let R=0,M=0;for(const P of S)P.mediaStreamTrack.kind==="audio"?R++:P.mediaStreamTrack.kind==="video"&&M++;if(R>1||M>1){const P=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return tr.err(P)}return tr.ok(S)}shouldPublishParticipant(S){try{return tr.ok(this.strategy.shouldPublishParticipant(S))}catch(R){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:R}),console.error("Error executing shouldPublishParticipant",R),tr.err(R)}}shouldSubscribeToParticipant(S){try{return tr.ok(this.strategy.shouldSubscribeToParticipant(S))}catch(R){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:R}),console.error("Error executing shouldSubscribeToParticipant",R),tr.err(R)}}subscribeConfiguration(S){var R,M;try{return tr.ok((M=(R=this.strategy).subscribeConfiguration)===null||M===void 0?void 0:M.call(R,S))}catch(P){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:P}),console.error("Error executing subscribeConfiguration",P),tr.err(P)}}preferredLayerForStream(S,R){var M,P;try{return tr.ok((P=(M=this.strategy).preferredLayerForStream)===null||P===void 0?void 0:P.call(M,S,R))}catch(B){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:B}),console.error("Error executing preferredLayerForStream",B),tr.err(B)}}}class Ix extends Xc{constructor(S,R){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=Vs.NOT_PUBLISHED,this.logger=R,this.info=S,this.audioMuted=S.audioMuted,this.videoStopped=S.videoStopped}}(function(O){O.PUBLISH="publish",O.SUBSCRIBE="subscribe"})(Eh||(Eh={})),function(O){O.NOT_PUBLISHED="not_published",O.ATTEMPTING_PUBLISH="attempting_publish",O.PUBLISHED="published",O.ERRORED="errored"}(Vs||(Vs={})),function(O){O.NOT_SUBSCRIBED="not_subscribed",O.ATTEMPTING_SUBSCRIBE="attempting_subscribe",O.SUBSCRIBED="subscribed",O.ERRORED="errored"}(Xo||(Xo={}));const Xy=1e3;function BE(O){return O.map(S=>S.remote)}function SR(O){return{label:O.encodingId,bitrateBps:O.bitrate*Xy,width:O.width,height:O.height,framesPerSecond:O.framesPerSecond,selected:O.selected}}function Ca(O,S){const R=O.width*O.height,M=S.width*S.height;return R>M||O.bitrateBps>S.bitrateBps||O.framesPerSecond>S.framesPerSecond?1:R===M||O.bitrateBps===S.bitrateBps||O.framesPerSecond>S.framesPerSecond?0:-1}var Wm,Ky,FE=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class zE extends Xc{constructor(S){super(),this.setGetStats=()=>{},this.requestRTCStats=()=>this.internalStream.requestRTCStats(),this.getStats=()=>FE(this,void 0,void 0,function*(){return this.internalStream.requestRTCStats()}),this.setMuted=R=>{this.internalStream.setMuted(R)},this.getLayers=()=>this.internalStream.layers,this.getSelectedLayer=()=>this.internalStream.selectedLayer,this.getLowestQualityLayer=()=>this.internalStream.lowestQualityLayer,this.getHighestQualityLayer=()=>this.internalStream.highestQualityLayer,this.internalStream=S,this.internalStream.on(Lu.ADAPTION_CHANGED,R=>{this.emit(so.ADAPTION_CHANGED,R)}),this.internalStream.on(Lu.LAYERS_CHANGED,R=>{this.emit(so.LAYERS_CHANGED,R)}),this.internalStream.on(Lu.LAYER_SELECTED,(R,M)=>{this.emit(so.LAYER_SELECTED,R,M)})}get id(){return this.internalStream.id}get participantInfo(){return this.internalStream.participantInfo}get streamType(){return this.internalStream.streamType}get mediaStreamTrack(){return this.internalStream.mediaStreamTrack}get isMuted(){return this.internalStream.isMuted}set isMuted(S){this.internalStream.setMuted(S)}get isAdapting(){return this.internalStream.isAdapting}cleanup(){this.removeAllListeners()}}class HE extends J0{constructor({track:S,info:R,getStats:M,remotePlaybackController:P,analyticsTracker:B,token:H}){super(S,M),this.setMuted=ie=>{this.isMuted=ie},this.setLayer=ie=>{const K=(0,ua.cloneDeep)(ie);if(this.queueLayerUpdateForValidState(K))return void this.logger.debug({msg:`setLayer:${K} queued, skipping for now`});const se=function(pe,Ne){if(!pe)return(0,tr.ok)(void 0);const Je=typeof pe=="string"?pe:pe.label,Ye=Ne.filter(Oe=>Oe.label===Je)[0];return Ye?(0,tr.ok)(Ye):(0,tr.err)(`Provided layer with id ${Je} does not exist`)}(K,this._layers);if(!se.ok){const pe=se.error;return void this.logger.error({err:pe,msg:"Unable to select layer, skipping skipping selection"})}const he=se.value;if(this.isNextUpdateAdaptionOnly(he))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(he)||this.isAdapting?he&&(this.logger.warn({msg:`setLayer:${JSON.stringify(he)} `}),this.handleManualUpdate(he)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Pu.INITIALIZING,this.prevState=Pu.IDLE,this.analyticsTracker=B,this.token=H,this.id=S.id,this.info=R,this.mediaStreamTrack=S,this.remotePlaybackController=P,this.layerPollingTimeoutId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const te=f0();this.logger=new to(new Sm(te),me.REMOTE_STAGE_STREAM),this.streamType===Xt.AUDIO?this.isMuted=R.audioMuted:this.isMuted=R.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers()}transitionStateTo(S){this.state!==S&&(this.prevState=this.state,this.state=S)}initializeLayerPolling(){this.streamType!==Xt.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingTimeoutId=setInterval(()=>{this.pollInternalLayers()},3e3)):this.logger.debug({msg:"Skipping initializing polling for audio streams"})}startLayerPolling(){this.layerPollingTimeoutId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingTimeoutId!==null?(clearInterval(this.layerPollingTimeoutId),this.layerPollingTimeoutId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(){this.streamType!==Xt.AUDIO?this.remotePlaybackController.getLayers().then(S=>{if(this.isStateValidForLayerUpdates()){if(!S.ok)throw Error(S.error);this.updateInternalLayersFromRemote(S.value),this.transitionStateTo(Pu.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})}).catch(S=>{this.logger.error({err:S,msg:"Error calling getLayers, returning current layers"})}):this.logger.debug({msg:"Skipping layer poll request for audio stream"})}updateInternalLayersFromRemote(S){const R=this._layers,M=S.map(SR).sort(Ca),P=!(0,ua.isEqual)(M,R);this._layers=M;const B=this._selectedLayer,H=this._layers.filter(ie=>ie.selected)[0],te=!(0,ua.isEqual)(H,B);B&&(B.selected=!1),this._selectedLayer=H,te&&(this.trackLayerUpdate(B),this.trackLayerUpdate(H)),this.isCommandQueueEmpty()&&(P&&this.emitLayersChanged(),te&&this.emitLayerSelected(H))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const S=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${S}`});for(const R of this.commandMap.keys()){const M=this.commandMap.get(R);M==null||M()}this.commandMap.clear()}queueLayerUpdateForValidState(S){if(!S)return this.commandMap.delete("setLayer"),!1;if(this.state===Pu.INITIALIZING){const R=this.setLayer.bind(this,S);return this.commandMap.set("setLayer",R),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const S=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then(R=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(S,`Stream in invalid state: ${this.state}`);R.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(S,R.error)}).catch(()=>{})}resetAdaptionStateOnError(S,R){this._isAdapting=S,this.emitAdaptionChanged(),this.logger.error({err:R,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(S){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const R=this._isAdapting,M=this._selectedLayer;M&&(M.selected=!1),this._isAdapting=!1,this._selectedLayer=S,S.selected=!0,R!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(S,M),this.trackLayerUpdate(M),this.trackLayerUpdate(S),this.emitLayersChanged(),this.emitLayerSelected(S),this.remotePlaybackController.setLayer(S.label).then(P=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const B=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(R,B),void this.resetLayerOnError(M,S,B)}if(!P.ok){const B=P.error;return this.resetAdaptionStateOnError(R,B),void this.resetLayerOnError(M,S,B)}this.logger.debug({msg:`Layer successfully selected: ${S.label}`})}).catch(()=>{})}applyExistingControlState(){var S;this._isAdapting?this.remotePlaybackController.unsetLayer().then(()=>{}).catch(()=>{}):!((S=this._selectedLayer)===null||S===void 0)&&S.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then(()=>{}).catch(()=>{})}resetLayerOnError(S,R,M){R&&(R.selected=!1),S&&(S.selected=!0),this._selectedLayer=S,this.logger.error({err:M,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(S,R),this.emitLayersChanged(),S!==null&&this.emitLayerSelected(S,bh.UNAVAILABLE),this.trackLayerUpdate(R),this.trackLayerUpdate(S)}updateLocalLayerStateBeforeRemote(S,R){this._layers=this._layers.map(M=>M.label===(S==null?void 0:S.label)?S:M.label===(R==null?void 0:R.label)?R:M).sort(Ca)}trackLayerUpdate(S){var R,M;this.analyticsTracker.trackEventNoSharedProps(new F0(this.token,fc(),(R=S==null?void 0:S.label)!==null&&R!==void 0?R:"auto",!0,dn.SUBSCRIBE,(M=S==null?void 0:S.selected)!==null&&M!==void 0&&M,this.info.id))}isNextUpdateAdaptionOnly(S){return S===void 0&&this.isFirstLayerUpdate()||S===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(S){var R;return((R=this._selectedLayer)===null||R===void 0?void 0:R.label)===(S==null?void 0:S.label)}isStateValidForLayerUpdates(){return this.state===Pu.ACTIVE||this.state===Pu.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(S,R=bh.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(S,null,2)}`}),this.emit(Lu.LAYER_SELECTED,(0,ua.cloneDeep)(S),R)}emitLayersChanged(){this.emit(Lu.LAYERS_CHANGED,(0,ua.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(Lu.ADAPTION_CHANGED,this._isAdapting)}get remote(){const S=this.weakRemoteMap.get(this.weakRemoteKey);if(S)return S;const R=new zE(this);return this.weakRemoteMap.set(this.weakRemoteKey,R),R}get participantInfo(){return(0,ua.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,ua.cloneDeep)(this._layers)}get selectedLayer(){var S;return(0,ua.cloneDeep)((S=this._selectedLayer)!==null&&S!==void 0?S:void 0)}get highestQualityLayer(){return(0,ua.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,ua.cloneDeep)(this.layers[0])}pauseControls(){this.transitionStateTo(Pu.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Pu.ACTIVE)}cleanup(){this.transitionStateTo(Pu.DESTROYED),super.cleanup(),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(O){O.STATE_CHANGE="stateChange",O.MEDIA_STREAM_ADDED="mediaStreamAdded",O.MEDIA_STREAM_REMOVED="mediaStreamRemoved",O.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",O.ERROR="error"})(Wm||(Wm={})),function(O){O.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",O.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"}(Ky||(Ky={}));const ao=Object.assign(Object.assign({},Wm),Ky);var yf;(function(O){O.PUBLICATION_STATE_CHANGE="publicationStateChange"})(yf||(yf={}));const Ko=Object.assign(Object.assign({},Wm),yf);var Jo=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class TR extends Ix{constructor(S,R,M,P,B,H,te,ie=!1){super(S,new to(P,me.REMOTE_PARTICIPANT)),this.subscribeState=Xo.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=K=>{this.logger.debug({msg:"subscriptionStateChange",state:K}),K===Yo.DISCONNECTED?this.updateSubscriptionState(Xo.NOT_SUBSCRIBED):K===Yo.CONNECTED?this.updateSubscriptionState(Xo.SUBSCRIBED):K===Yo.CONNECTING?this.updateSubscriptionState(Xo.ATTEMPTING_SUBSCRIBE):K===Yo.ERRORED?this.updateSubscriptionState(Xo.ERRORED):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:K})},this.onSubscriptionMediaStream=(K,se)=>{this.logger.debug({msg:"onSubscriptionMediaStream",stream:K});let he=K.getTracks().map(pe=>{const Ne=new HE({track:pe,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:se,analyticsTracker:this.analyticsTracker,token:this.token});return this.streams.push(Ne),Ne});this.subscription.getDesiredSubscribeType()===Ro.AUDIO_ONLY&&(he=he.filter(pe=>pe.streamType!==Xt.VIDEO)),this.emit(ao.MEDIA_STREAM_ADDED,he)},this.onSubscriptionError=K=>{this.emit(ao.ERROR,K)},this.onSubscriptionSeiMessageReceived=K=>{this.emit(ao.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,K)},this.onSubscriptionTransformError=K=>{this.emit(ao.ERROR,K)},this.onSubscriptionReassignmentStart=()=>{for(const K of this.streams)K.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const K of this.streams)K.resumeControls()},this.updateSubscribeStateIfNecessary=(K,se)=>{if(!this.info.capabilities.has(Eh.SUBSCRIBE))return;se!==void 0&&this.subscription.updateSubscribeConfig(se);const he=K!==Ro.NONE&&this.publishState===Vs.PUBLISHED,pe=this.subscribeState!==Xo.NOT_SUBSCRIBED&&this.subscribeState!==Xo.ERRORED;if(he&&!pe)this.subscription.updateDesiredSubscribeType(K),this.subscribe();else if(!he&&pe)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(K);else if(this.subscribeState===Xo.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==K)try{K===Ro.AUDIO_ONLY?this.emit(ao.MEDIA_STREAM_REMOVED,this.streams.filter(Ne=>Ne.streamType===Xt.VIDEO)):K===Ro.AUDIO_VIDEO&&this.emit(ao.MEDIA_STREAM_ADDED,this.streams.filter(Ne=>Ne.streamType===Xt.VIDEO)),this.subscription.updateDesiredSubscribeType(K)}catch(Ne){this.logger.error({err:Ne,msg:"error updating subscribe type"})}},this.updatePublishState=K=>{const se=K&&this.publishState===Vs.PUBLISHED,he=!K&&this.publishState===Vs.NOT_PUBLISHED;return!se&&!he&&(this.info.isPublishing=K,this.publishState=K?Vs.PUBLISHED:Vs.NOT_PUBLISHED,!0)},this.updateStreamState=(K,se)=>{this.audioMuted!==K&&(this.audioMuted=K,this.info.audioMuted=K,this.updateStreamMuteState(Xt.AUDIO,K)),this.videoStopped!==se&&(this.videoStopped=se,this.info.videoStopped=se,this.updateStreamMuteState(Xt.VIDEO,se))},this.updateStreamMuteState=(K,se)=>{const he=this.streams.find(pe=>pe.streamType===K);he?(he.setMuted(se),this.emit(ao.MEDIA_STREAM_MUTE_CHANGED,he)):this.logger.warn({msg:`tried to update mute state for ${K} stream on participant ${this.info.id} that didn't exist`})},this.cleanup=()=>{for(const K of this.streams)K.remote.removeAllListeners(),K.removeAllListeners();this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==Xo.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=te,this.token=R,this.createSubscription=()=>{const K=new Ox(S.id,R,M,P,te,B,H);return K.on(Am,this.onSubscriptionStateChange),K.on(ge,this.onSubscriptionMediaStream),K.on(dd,this.onSubscriptionError),K.on(fh,this.onSubscriptionSeiMessageReceived),K.on(no,this.onSubscriptionTransformError),K.on(Br,this.onSubscriptionReassignmentStart),K.on(fd,this.onSubscriptionReassignmentDone),K.on(Su,this.onSubscriptionReassignmentDone),K},this.subscription=this.createSubscription(),ie&&(this.publishState=Vs.PUBLISHED)}updateSubscriptionState(S){S!==this.subscribeState&&(this.subscribeState=S,this.emit(ao.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(Xo.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===Xo.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(Am,this.onSubscriptionStateChange),this.subscription.off(ge,this.onSubscriptionMediaStream),this.subscription.off(dd,this.onSubscriptionError),this.subscription.off(no,this.onSubscriptionTransformError);const S=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),S===Ro.AUDIO_ONLY?this.emit(ao.MEDIA_STREAM_REMOVED,this.streams.filter(R=>R.streamType===Xt.AUDIO)):this.emit(ao.MEDIA_STREAM_REMOVED,this.streams),this.updateSubscriptionState(Xo.NOT_SUBSCRIBED),this.streams.forEach(R=>{R.cleanup()}),this.streams=[]}triggerIceRestart(S){return Jo(this,void 0,void 0,function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(S)}finally{this.reassigning=!1}})}}const Jy=dn.PUBLISH;class Z0{constructor(S,R){this.analyticsTracker=S,this.token=R,this.action=Jy,this.traceId=fc()}trackPublish(S){const{action:R,traceId:M,analyticsTracker:P,token:B}=this;return P.trackEvent(new Ou({token:B,traceId:M})),{getTraceId:()=>M,trackPublishStarted({totalDurationWithRetries:H,retryTimes:te,sfuResource:ie,peerClientPerfStats:K}){const{optionsDuration:se,postDuration:he,timeToCandidate:pe,timeToConnected:Ne,sdpExchangeDuration:Je,sdpExchangeTransport:Ye,setRemoteDescDuration:Oe,peerConnectionDuration:_e}=K,{edpInitialConnectDuration:lt,edpInitialConnectRetries:wt,edpInitialStateDuration:Kt,edpStateUpdateCount:It}=S;P.trackEvent(new Tx({token:B,traceId:M,optionsDuration:se,postDuration:he,timeToCandidate:pe,totalDuration:Ne,edpInitialConnectDuration:lt,edpInitialConnectRetries:wt,edpInitialStateDuration:Kt,edpStateUpdateCount:It,sdpExchangeDuration:Je,sdpExchangeTransport:Ye,setRemoteDescDuration:Oe,peerConnectionDuration:_e,publishRetries:te,totalDurationWithRetries:H,sfuResource:ie}))},trackPublishFailed(H){const te=((K,se,he)=>{if(K instanceof Ir)return K;let pe="";return K instanceof Ts.AxiosError&&(pe+=`AxiosError - ${K.code}`),new Ir(Object.assign(Object.assign(Object.assign({},Bt.PUBLISH_FAILURE),{action:Jy,token:se,traceId:he,tag:pc.PUBLISH_RELATED,location:"publish",details:`${pe} ${K.message}`}),{fatal:!0}))})(H,B,M);P.trackEvent(new xx({token:B,traceId:M,code:te.code,message:te.message,fatal:te.fatal,nominal:te.nominal}));const ie=new Ir(Object.assign(Object.assign({},Bt.PUBLISH_FAILURE),{action:R,token:B,traceId:M,tag:pc.PUBLISH_RELATED,location:"publish"}));return H instanceof Ir&&(ie.fatal=H.fatal,ie.nominal=H.nominal,ie.location=`publish > ${H.location}`),P.trackError(ie),te},trackUnpublish:()=>{P.trackEvent(new vf({token:B,traceId:M}))},trackEndSucceeded:H=>{P.trackEvent(new Np({token:B,isUnpublishSuccessful:!0,traceId:M,reason:H}))},trackEndFailed:H=>{const te=new Ir(Object.assign(Object.assign({},Bt.UNPUBLISH_FAILURE),{token:B,traceId:M,tag:pc.UNPUBLISH_RELATED,location:"unpublish"}));return H!==wa.UNLOAD&&H!==wa.UNPUBLISH||this.analyticsTracker.trackError(te),P.trackEvent(new Np({token:B,isUnpublishSuccessful:!1,traceId:M,reason:H})),te}}}}var ja,Ns,Sh=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};(function(O){O.DISCONNECTED="disconnected",O.CONNECTING="connecting",O.CONNECTED="connected",O.ERRORED="errored"})(ja||(ja={})),function(O){O.STATE_CHANGE="stateChange",O.ERROR="error",O.TRANSFORM_ERROR="transformError"}(Ns||(Ns={}));class xR extends Xc{constructor(S,R,M,P){super(),this.token=S,this.stageConnection=R,this.nonScopedLogger=M,this.analyticsTracker=P,this.tracksToPublish=[],this.publicationState=ja.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=dn.PUBLISH,this.start=B=>{this.publicationState===ja.DISCONNECTED||this.publicationState===ja.ERRORED?(this.tracksToPublish=B,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=B=>Sh(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(B)}),this.stop=(B=!1)=>Sh(this,void 0,void 0,function*(){this.peerClient.off(Xs,this.onPeerClientConnectionStateChange,this),this.peerClient.off(ft,this.onPeerClientTransformError,this),yield this.unpublish(B),this.updateState(ja.DISCONNECTED)}),this.processStateUpdate=B=>{const{publicationState:H}=this;H===ja.DISCONNECTED||H===ja.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(ja.CONNECTING),this.tryPublish()):H===ja.CONNECTING?B===at.CONNECTED&&this.updateState(ja.CONNECTED):H===ja.CONNECTED&&B===at.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(wa.CONNECTION_FAIL),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(ja.CONNECTING),this.tryPublish()))},this.updateState=B=>{this.publicationState=B,this.emit(Ns.STATE_CHANGE,B)},this.tryPublish=()=>Sh(this,void 0,void 0,function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const B=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(B);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.tracksToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const H=this.peerClient.getSfuResource(),te=this.latestPubAttemptNum-1,ie=performance.now()-this.startConnectingTimestamp,K=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:H,totalDurationWithRetries:ie,retryTimes:te,peerClientPerfStats:K}),this.latestPubAttemptNum=0}catch(H){this.logger.error({msg:"publish failed!",err:H});const te=this.attemptTracker.trackPublishFailed(H),ie=te.code===Bt.OPERATION_ABORTED.code,K=te.fatal,se=this.latestPubAttemptNum===4;if(ie)return;if(K||se)return this.logger.error({msg:`Stopping attempts: isFatal=${K}, isLastAttempt=${se}`,err:H}),this.updateState(ja.ERRORED),void this.emit(Ns.ERROR,te);const he=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${he}ms`}),this.nextAttemptTimerId=window.setTimeout(()=>{this.tryPublish()},he)}}}),this.publish=(B,H)=>Sh(this,void 0,void 0,function*(){this.peerClient.initTracksToPublish(B),yield this.peerClient.connect({audioOnly:!1,traceId:H})}),this.unpublish=(B=!1)=>Sh(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===ja.DISCONNECTED||this.publicationState===ja.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const H=B?wa.UNLOAD:wa.UNPUBLISH;try{B?this.peerClient.disconnect(B):yield this.peerClient.disconnect(B),this.attemptTracker.trackEndSucceeded(H)}catch{this.attemptTracker.trackEndFailed(H)}}),this.replaceOrUpdateTrack=B=>Sh(this,void 0,void 0,function*(){this.tracksToPublish.find(H=>H.track.kind===B.track.kind)?this.tracksToPublish=this.tracksToPublish.map(H=>H.track.kind===B.track.kind?B:H):this.tracksToPublish.push(B),yield this.peerClient.replaceOrUpdateTrack(B)}),this.onPeerClientConnectionStateChange=B=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${B}`,state:B}),this.processStateUpdate(B)},this.onPeerClientTransformError=B=>{this.emit(Ns.TRANSFORM_ERROR,B)},this.onIncompatibleCodecs=B=>Sh(this,void 0,void 0,function*(){yield this.peerClient.onIncompatibleCodecs(B)}),this.sendSeiMessage=B=>{this.peerClient.sendSeiMessage(B)},this.peerClient=new X0(S,this.nonScopedLogger,this.action,To(this.action),fc(),this.analyticsTracker,void 0,R,void 0),this.logger=new to(M,me.PUBLICATION),this.peerClient.on(Xs,this.onPeerClientConnectionStateChange,this),this.peerClient.on(ft,this.onPeerClientTransformError,this),this.publishTracker=new Z0(this.analyticsTracker,this.token)}removeTrack(S){return Sh(this,void 0,void 0,function*(){this.tracksToPublish=this.tracksToPublish.filter(R=>R.track.kind!==S),yield this.peerClient.removeTrack(S)})}}var Hi,Jn=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};class kx extends Ix{constructor(S,R,M,P,B){super(S,new to(M,me.LOCAL_PARTICIPANT)),this.onPublicationStateChange=H=>{switch(this.logger.debug({msg:"publicationStateChange",state:H}),H){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(Vs.PUBLISHED);break;case"connecting":this.updatePublishState(Vs.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(Vs.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:H})}},this.onPublicationError=H=>{this.emit(Ko.ERROR,H)},this.updatePublishState=H=>{this.info.isPublishing=H===Vs.PUBLISHED,this.publishState=H,this.emit(Ko.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=H=>{H.streamType===Xt.AUDIO&&(this.audioMuted=H.isMuted,this.info.audioMuted=H.isMuted),H.streamType===Xt.VIDEO&&(this.videoStopped=H.isMuted,this.info.videoStopped=H.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(Ko.MEDIA_STREAM_MUTE_CHANGED,H)},this.publish=H=>{this.logger.debug({msg:"publish"}),H.forEach(ie=>{ie&&(this.setupStreamListener(ie),ie.streamType===Xt.AUDIO?(this.audioStream=ie,this.audioMuted=!ie.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):ie.streamType===Xt.VIDEO&&(this.videoStream=ie,this.videoStopped=!ie.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),ie.setGetStats(this.publication.requestRTCStats))}),this.connection.emitStageState(this.audioMuted,this.videoStopped);const te=H.map(ie=>OE(ie.mediaStreamTrack,ie.mediaConfig));this.publication.start(te)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==Vs.NOT_PUBLISHED&&this.publishState!==Vs.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=H=>Jn(this,void 0,void 0,function*(){yield this.publication.onIncompatibleCodecs(H)}),this.sendSeiMessage=H=>{this.publication.sendSeiMessage(H)},this.sendSeiMessageString=H=>{const te=new TextEncoder().encode(H);this.publication.sendSeiMessage(te)},this.connection=P,this.createPublication=()=>{const H=new xR(R,P,M,B);return H.on(Ns.STATE_CHANGE,this.onPublicationStateChange),H.on(Ns.ERROR,this.onPublicationError),H.on(Ns.TRANSFORM_ERROR,this.onPublicationError),H},this.publication=this.createPublication()}setupStreamListener(S){S.on(_d.LOCAL_STREAM_MUTE_CHANGED,this.handleMute)}removeTrack(S){var R,M;S.streamType===Xt.AUDIO?((R=this.audioStream)===null||R===void 0||R.off(_d.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):S.streamType===Xt.VIDEO&&((M=this.videoStream)===null||M===void 0||M.off(_d.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(S.streamType)}replaceOrAddTrack(S){return Jn(this,void 0,void 0,function*(){this.setupStreamListener(S),S.setGetStats(this.publication.requestRTCStats),S.streamType===Xt.AUDIO?(this.audioStream=S,this.audioMuted=!S.mediaStreamTrack.enabled):S.streamType===Xt.VIDEO&&(this.videoStream=S,this.videoStopped=!S.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const R=OE(S.mediaStreamTrack,S.mediaConfig);yield this.publication.replaceOrUpdateTrack(R)})}unpublish(){if(this.publishState===Vs.NOT_PUBLISHED||this.publishState===Vs.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Ns.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Ns.ERROR,this.onPublicationError),this.publication.off(Ns.TRANSFORM_ERROR,this.onPublicationError);const S=[this.audioStream,this.videoStream].filter(R=>!!R);S.forEach(R=>{R.cleanup()}),this.audioStream=void 0,this.videoStream=void 0,this.emit(Ko.MEDIA_STREAM_REMOVED,S),this.updatePublishState(Vs.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(O){O.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",O.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",O.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",O.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",O.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",O.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",O.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",O.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",O.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",O.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",O.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",O.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",O.ERROR="error",O.STAGE_LEFT="stageLeft"})(Hi||(Hi={}));var oo=function(O,S,R,M){return new(R||(R=Promise))(function(P,B){function H(K){try{ie(M.next(K))}catch(se){B(se)}}function te(K){try{ie(M.throw(K))}catch(se){B(se)}}function ie(K){var se;K.done?P(K.value):(se=K.value,se instanceof R?se:new R(function(he){he(se)})).then(H,te)}ie((M=M.apply(O,[])).next())})};const Is=O=>!!O;class _f extends Xc{constructor(S,R){super(),this.connectionState=hs.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(P,B)=>{var H,te;if(this.connectionState=P,P===hs.ERRORED&&(this.connectionStateErrored=!0),P===hs.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==Vs.NOT_PUBLISHED&&this.stageConnection.emitStageState((H=this.localParticipant)===null||H===void 0?void 0:H.audioMuted,(te=this.localParticipant)===null||te===void 0?void 0:te.videoStopped),P===hs.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),P===hs.DISCONNECTED){if(B&&B!==Iu.CLIENT_RECONNECT&&B!==Iu.USER_INITIATED){let ie=Ym.UNKNOWN;(function(K){return Object.values(Ym).includes(K)})(B)?ie=B:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${B}`}),this.cleanup(ie)}}else this.emit(Hi.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var P;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new Om(this.token,(P=this.joinTraceId)!==null&&P!==void 0?P:new mE,"reusing local participant from repeat join",dn.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const P=function(B){var H,te;const ie=new Set;return B.token.claims.capabilities.allow_publish&&ie.add(Eh.PUBLISH),B.token.claims.capabilities.allow_subscribe&&ie.add(Eh.SUBSCRIBE),{id:B.token.participantID,userId:(H=B.token.userID)!==null&&H!==void 0?H:"",attributes:(te=B.token.claims.attributes)!==null&&te!==void 0?te:{},capabilities:ie,isLocal:!0,userInfo:{},videoStopped:B.videoStopped,audioMuted:B.audioMuted,isPublishing:B.isPublishing}}({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new kx(P,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(Ko.PUBLICATION_STATE_CHANGE,B=>{this.onPublishStateChanged(this.localParticipant.info,B)}),this.localParticipant.on(Ko.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(Ko.MEDIA_STREAM_MUTE_CHANGED,B=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,B):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})}),this.localParticipant.on(Ko.ERROR,B=>{this.errorManager.handleError(B,yd.PUBLISH_ERROR)}),this.emit(Hi.STAGE_PARTICIPANT_JOINED,P)},this.onRemoteParticipantJoined=P=>{var B;if(P.id!==((B=this.localParticipant)===null||B===void 0?void 0:B.info.id)){const H=function(se){return{id:se.id,userId:se.userId,attributes:se.attributes,capabilities:new Set([Eh.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:se.videoStopped,audioMuted:se.audioMuted,isPublishing:se.isPublishing}}(P);if(this.participants.has(H.id))return void this.logger.warn({msg:"Remote participant already tracked"});let te=Ro.NONE;H.capabilities.has(Eh.SUBSCRIBE)&&(te=tr.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(H),te),this.updateManagerWithExternalSubscribeConfig(H,"joined"));const ie=this.configManager.getSubscribeConfigSnapshot(H.id),K=new TR(H,this.token,this.stageConnection,this.logger.unwrap(),te,ie,this.analyticsTracker,P.isPublishing);this.participants.set(H.id,K),this.setupRemoteParticipantListeners(K),this.emit(Hi.STAGE_PARTICIPANT_JOINED,K.info),K.updateSubscribeStateIfNecessary(te)}},this.setupRemoteParticipantListeners=P=>{P.on(ao.SUBSCRIPTION_STATE_CHANGE,B=>{this.onParticipantSubscribeStateChanged(P.info.id,B)}),P.on(ao.MEDIA_STREAM_ADDED,B=>{const H=this.participants.get(P.info.id);if(H){for(const te of B)this.setupRemoteParticipantStreamEvents(H.info,te);this.emit(Hi.STAGE_PARTICIPANT_STREAMS_ADDED,H.info,BE(B)),this.updateStreamLayerForParticipant(P)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})}),P.on(ao.MEDIA_STREAM_REMOVED,B=>{const H=this.participants.get(P.info.id);H?this.emit(Hi.STAGE_PARTICIPANT_STREAMS_REMOVED,H.info,BE(B)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})}),P.on(ao.MEDIA_STREAM_MUTE_CHANGED,B=>{this.onStreamMuteChange(P.info,B.remote)}),P.on(ao.ERROR,B=>{this.errorManager.handleError(B,yd.SUBSCRIBE_ERROR)}),P.on(ao.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,B=>{this.onSeiMessageReceived(P.info,B)})},this.onRemoteParticipantLeft=P=>{if(this.connectionState!==hs.CONNECTED)return;const B=this.participants.get(P);B?(B.participantLeave(),B.unsubscribe(),B.cleanup(),this.participants.delete(P),this.emitParticipantLeave(B.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=P=>{this.emit(Hi.STAGE_PARTICIPANT_LEFT,P)},this.onRemoteParticipantStateChanged=P=>{const B=this.participants.get(P.id);if(!B)return void this.logger.warn({msg:"Remote participant updated but not tracked"});B.updatePublishState(P.isPublishing)&&this.onPublishStateChanged(B.info,B.publishState),B.updateStreamState(P.audioMuted,P.videoStopped);const H=this.strategyWrapper.shouldSubscribeToParticipant(B.info);if(tr.isNotOk(H))return;this.updateManagerWithExternalSubscribeConfig(B.info,"updated");const te=this.configManager.getSubscribeConfigSnapshot(B.info.id),ie=tr.getOk_or(H,Ro.NONE);B.updateSubscribeStateIfNecessary(ie,te)},this.onPublishStateChanged=(P,B)=>{this.emit(Hi.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,P,B)},this.onParticipantSubscribeStateChanged=(P,B)=>{const H=this.participants.get(P);H?this.emit(Hi.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,H.info,B):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=P=>{this.localParticipant&&this.emit(Hi.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,P)},this.onLocalStreamsRemoved=P=>{this.localParticipant&&this.emit(Hi.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,P)},this.onStreamMuteChange=(P,B)=>{this.emit(Hi.STAGE_STREAM_MUTE_CHANGED,P,B)},this.onSeiMessageReceived=(P,B)=>{this.emit(Hi.STAGE_STREAM_SEI_MESSAGE_RECEIVED,P,B)},this.leave=()=>{this.cleanup(Ym.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var P;this.participants.forEach(B=>{B.quickUnsubscribe()}),(P=this.localParticipant)===null||P===void 0||P.quickUnpublish(),this.stageConnection.disconnect(),this.emit(Hi.STAGE_CONNECTION_STATE_CHANGED,hs.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=P=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new Eu({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:P})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const B=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(B);const H=this.participants.entries();for(const[te,ie]of H)ie.unsubscribe(),this.participants.delete(te),ie.cleanup(),this.emitParticipantLeave(ie.info);Fm.destroy(),this.stageConnection.disconnect(),this.emit(Hi.STAGE_CONNECTION_STATE_CHANGED,hs.DISCONNECTED),this.emit(Hi.STAGE_LEFT,P),this.stageConnection.removeAllListeners(),this.stageConnection=new RE(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners(),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(P=>{if(P.info.capabilities.has(Eh.SUBSCRIBE)){const B=this.strategyWrapper.shouldSubscribeToParticipant(P.info);if(tr.isNotOk(B))return;const H=tr.getOk_or(B,Ro.NONE);this.updateManagerWithExternalSubscribeConfig(P.info,"updated");const te=this.configManager.getSubscribeConfigSnapshot(P.info.id);P.updateSubscribeStateIfNecessary(H,te),this.updateStreamLayerForParticipant(P)}}),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var P;if(!this.localParticipant||!(!((P=this.localParticipant)===null||P===void 0)&&P.info.capabilities.has(Eh.PUBLISH)))return;const B=this.localParticipant.publishState!==Vs.NOT_PUBLISHED&&this.localParticipant.publishState!==Vs.ERRORED,H=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(tr.isNotOk(H))return;let te=tr.getOk_or(H,!1);if(!B&&!te)return;if(B&&!te)return void this.localParticipant.unpublish();const ie=this.strategyWrapper.stageStreamsToPublish();if(tr.isNotOk(ie)){const se=tr.getErr(ie);if(se instanceof Error&&se.cause==="UserStrategy")throw se;return}const K=tr.getOk_or(ie,[]);te=te&&K.length>0,!B&&te?(this.localParticipant.publish(K),this.onLocalStreamsAdded(K)):this.syncTracksToPublish(K)},this.syncTracksToPublish=P=>{var B;if(!this.localParticipant)return;const H=this.localParticipant.audioStream,te=this.localParticipant.videoStream,{updates:ie,streamsToAdd:K,streamsToRemove:se}=this.determineStreamUpdates(H,te,P);if(ie.length){for(const he of ie)he.newStream?(B=this.localParticipant)===null||B===void 0||B.replaceOrAddTrack(he.newStream):he.oldStream&&this.localParticipant.removeTrack(he.oldStream);se.length!==0&&this.onLocalStreamsRemoved(se),K.length!==0&&this.onLocalStreamsAdded(K)}},this.determineStreamUpdates=(P,B,H=[])=>{const te=[],ie=H.slice(0,2);if(ie.sort((he,pe)=>he.streamType===Xt.AUDIO?-1:1),ie.length===0)P&&te.push({oldStream:P}),B&&te.push({oldStream:B});else if(ie.length===1){const he=ie[0];he.streamType===Xt.AUDIO?B&&te.push({oldStream:B}):he.streamType===Xt.VIDEO&&P&&te.push({oldStream:P})}ie.forEach(he=>{var pe,Ne;he.streamType===Xt.AUDIO?P?P.id===he.id&&(0,ua.isEqual)(P.mediaConfig,he.mediaConfig)||(!!(!((pe=P.mediaConfig)===null||pe===void 0)&&pe.stereo)!=!!(!((Ne=he.mediaConfig)===null||Ne===void 0)&&Ne.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),te.push({oldStream:P,newStream:he})):te.push({newStream:he}):he.streamType===Xt.VIDEO&&(B?B.id===he.id&&(0,ua.isEqual)(B.mediaConfig,he.mediaConfig)||te.push({oldStream:B,newStream:he}):te.push({newStream:he}))});const K=te.map(he=>he.newStream).filter(Is),se=te.map(he=>he.oldStream).filter(Is);return{updates:te,streamsToAdd:K,streamsToRemove:se}},this.onReassignmentMessage=P=>oo(this,void 0,void 0,function*(){if(oh("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!us.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const B=fc();this.trackReassignmentRequest(P,B);const H=this.participants.get(P.remoteParticipantId),te=this.token.participantID,ie=function(K,{localParticipantId:se,remoteParticipant:he}){const{participantId:pe}=K;if(se!==pe)return tr.err(Object.assign(Object.assign({},Bt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${pe}`}));if(!he)return tr.err(Object.assign(Object.assign({},Bt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${he}`}));if(he.isReassigning())return tr.err(Bt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const Ne=he.subscription.peerClient.getConnectionState();return[at.CONNECTED,at.DISCONNECTED].includes(Ne)?tr.ok(he):tr.err(Object.assign(Object.assign({},Bt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${Ne}`}))}(P,{localParticipantId:te,remoteParticipant:H});if(!ie.ok)this.trackReassignmentRequestRejected(ie.error,B);else try{const{token:K,nodeOverride:se}=P;yield ie.value.triggerIceRestart({assignmentToken:K,traceId:B,nodeOverride:se})}catch(K){this.logger.error({msg:"Reassignment failed.",err:K})}}),this.onIncompatibleCodecsMessage=P=>oo(this,void 0,void 0,function*(){var B;yield(B=this.localParticipant)===null||B===void 0?void 0:B.onIncompatibleCodecs(P.codecs)}),this.analyticsTracker=new od;const M=f0();this.logger=new to(new Sm(M),me.STAGE),this.strategyWrapper=new ER(R,this.logger),this.configManager=new bR({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:js.DEFAULT,minDelayWhenSubscribeOnly:js.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Gl.LOWEST_QUALITY}}}),this.errorManager=new _R;try{this.token=xu(S,this.analyticsTracker)}catch(P){const B=new Ir(Object.assign({action:dn.JOIN,token:S,traceId:fc(),tag:pc.JOIN_RELATED,location:"Stage.constructor"},Bt.MALFORMED_TOKEN));throw P instanceof Error&&(B.details=P.message),this.errorManager.handleError(B,yd.JOIN_ERROR)||P}this.stageConnection=new RE(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(bl,(S,R)=>{this.onConnectionStateChanged(S,R)}),this.stageConnection.on(df,S=>{this.onRemoteParticipantJoined(S)}),this.stageConnection.on(hd,S=>{this.onRemoteParticipantLeft(S.id)}),this.stageConnection.on(R0,S=>{var R;S.id!==((R=this.localParticipant)===null||R===void 0?void 0:R.info.id)&&this.onRemoteParticipantStateChanged(S)}),this.stageConnection.on(jl,S=>oo(this,void 0,void 0,function*(){yield this.onReassignmentMessage(S)})),this.stageConnection.on(ff,S=>oo(this,void 0,void 0,function*(){yield this.onIncompatibleCodecsMessage(S)})),this.stageConnection.on(xp,S=>{S instanceof Ir&&this.analyticsTracker.trackError(S),this.errorManager.handleError(S,yd.JOIN_ERROR)}),this.errorManager.on(qm.ERROR,S=>{this.emit(Hi.ERROR,S)})}setupRemoteParticipantStreamEvents(S,R){const M=R.remote;R.on(Lu.ADAPTION_CHANGED,P=>{this.emit(Hi.STAGE_STREAM_ADAPTION_CHANGED,S,M,P)}),R.on(Lu.LAYERS_CHANGED,P=>{this.emit(Hi.STAGE_STREAM_LAYERS_CHANGED,S,M,P)}),R.on(Lu.LAYER_SELECTED,(P,B)=>{this.emit(Hi.STAGE_STREAM_LAYER_SELECTED,S,M,P,B)}),R.layers.length>0&&(this.emit(Hi.STAGE_STREAM_LAYERS_CHANGED,S,M,M.getLayers()),this.emit(Hi.STAGE_STREAM_LAYER_SELECTED,S,M,M.getSelectedLayer(),bh.SELECTED))}join(){return oo(this,void 0,void 0,function*(){this.analyticsTracker.start(),this.joinTraceId=fc(),this.analyticsTracker.trackEvent(new G0({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(fc(),pc.JOIN_RELATED,"join")}catch(S){throw this.errorManager.handleError(S,yd.JOIN_ERROR)||S}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===hs.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(S){throw this.logger.error({err:S,msg:"error joining stage"}),this.errorManager.handleError(S,yd.JOIN_ERROR,!1)||S}})}replaceStrategy(S){this.strategyWrapper.setStrategy(S),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(S,R){const M=tr.getOk(this.strategyWrapper.subscribeConfiguration(S));if(M===void 0)return;const P=S.id;if(this.configManager.handleExternalSubscribeConfigUpdate(P,M,$m.API)){const B=this.configManager.getSubscribeConfigSnapshot(P);this.analyticsTracker.trackEventNoSharedProps(new km(this.token,this.joinTraceId,{trigger:R==="joined"?"initial":"ad-hoc",remote_participant_id:P,min_delay_when_publishing:Fa(B.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:Fa(B.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:B.inBandMessaging.enabled,simulcast_initial_layer_preference:B.simulcast.initialLayerPreference}))}}updateStreamLayerForParticipant(S){S.streams.forEach(R=>{if(R.streamType==="audio")return;const M=this.strategyWrapper.preferredLayerForStream(S.info,R.remote),P=tr.getOk_or(M,void 0);R.setLayer(P)})}trackReassignmentRequestRejected(S,R){const{token:M}=this,P=new Ir(Object.assign(Object.assign({},S),{token:M,action:dn.JOIN,traceId:R,tag:pc.SUBSCRIBE_RELATED,location:"publish"}));this.logger.error({err:P,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(P)}trackReassignmentRequest(S,R){const{token:M}=this;this.analyticsTracker.trackEvent(new Nx({token:M,traceId:R,targetLocalParticipantId:S.participantId,targetRemoteParticipantId:S.remoteParticipantId}))}}var Ym;(function(O){O.UNKNOWN="unknown",O.USER_INITIATED="user-initiated",O.TOKEN_REUSED="token-reused",O.PARTICIPANT_DISCONNECTED="participant-disconnected",O.STAGE_DELETED="stage-deleted"})(Ym||(Ym={}));const jE=h})(),s})())})(hEe);var zyt=hEe.exports;const pS=qc(zyt),dEe="0123456789abcdefABCDEF";dEe.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const n=String.fromCodePoint(e),r=dEe.indexOf(n);return r<0?void 0:r<16?r:r-6});new TextEncoder;new TextDecoder;function _1(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;++r)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return t.length===e.length?0:t.length>e.length?1:-1}var Hyt=(t,e,n=Math.min(t.length,e.length))=>{for(let r=0;r<n;r++){const i=t[r],s=e[r];if(i!==s)return 8*n-(r*8+Math.clz32(i^s)-24)}return 0},jyt=class{constructor(t,e){this.id=t,this.bucketSize=e.bucketSize||20,this.buckets=new Array(t.length*8+1).fill(void 0).map(()=>[]),this.compare=e.compare||(()=>0),this.getId=e.getId}get length(){return this.buckets.reduce((t,e)=>t+e.length,0)}*[Symbol.iterator](){for(const t of this.buckets)for(const e of t)yield e}add(t,e=this.getBitwiseDistance(this.getId(t))){if(this.has(this.getId(t),e))return!1;if(this.buckets[e].length<this.bucketSize)return this.buckets[e].push(t),!0;const n=this.buckets[e].slice(0);n.push(t);const r=n.sort(this.compare);this.buckets[e]=r.slice(0,this.bucketSize);const i=r.at(-1);return _1(this.getId(t),this.getId(i))!==0}clear(){for(let t=0;t<this.buckets.length;t++)this.buckets[t]=[]}listClosestToId(t,e=this.buckets.length*this.bucketSize){const n=this.getBitwiseDistance(t);return this.getNodes(n,e)}get(t){const e=this.buckets[t].shift();return e&&this.buckets[t].push(e),e}getById(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(i=>_1(this.getId(i),t)===0);if(n===-1)return;const r=this.buckets[e][n];return this.buckets[e]=this.buckets[e].splice(n,1).concat(r),r}getBitwiseDistance(t){return Hyt(this.id,t)}getNodes(t,e,n=0){const r=(n%2===0?1:-1)*Math.ceil(n/2);if(Math.abs(r)>Math.max(t,this.buckets.length-1-t))return[];const i=t+r;if(0>i||i>this.buckets.length-1)return this.getNodes(t,e,n+1);const s=this.buckets[i].slice(0,e);return s.length>=e?(this.buckets[i]=this.buckets[i].slice(s.length).concat(this.buckets[i].slice(0,s.length)),s):s.concat(this.getNodes(t,e-s.length,n+1))}has(t,e=this.getBitwiseDistance(t)){return!!this.buckets[e].find(n=>_1(this.getId(n),t)===0)}peek(t){return this.buckets[t].at(0)}peekById(t,e=this.getBitwiseDistance(t)){return this.buckets[e].find(n=>_1(this.getId(n),t)===0)}update(t,e=this.getBitwiseDistance(this.getId(t))){const n=this.buckets[e].findIndex(r=>_1(this.getId(r),this.getId(t))===0);return n===-1?!1:(this.buckets[e][n]=t,!0)}remove(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(r=>_1(this.getId(r),t)===0);return n===-1?!1:(this.buckets[e].splice(n,1),!0)}},fEe={exports:{}};(function(t){var e=function(){function n(d,f){return f!=null&&d instanceof f}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function a(d,f,p,g,_){typeof f=="object"&&(p=f.depth,g=f.prototype,_=f.includeNonEnumerable,f=f.circular);var v=[],E=[],T=typeof kl<"u";typeof f>"u"&&(f=!0),typeof p>"u"&&(p=1/0);function x(N,A){if(N===null)return null;if(A===0)return N;var I,k;if(typeof N!="object")return N;if(n(N,r))I=new r;else if(n(N,i))I=new i;else if(n(N,s))I=new s(function(Z,Y){N.then(function(ee){Z(x(ee,A-1))},function(ee){Y(x(ee,A-1))})});else if(a.__isArray(N))I=[];else if(a.__isRegExp(N))I=new RegExp(N.source,h(N)),N.lastIndex&&(I.lastIndex=N.lastIndex);else if(a.__isDate(N))I=new Date(N.getTime());else{if(T&&kl.isBuffer(N))return kl.allocUnsafe?I=kl.allocUnsafe(N.length):I=new kl(N.length),N.copy(I),I;n(N,Error)?I=Object.create(N):typeof g>"u"?(k=Object.getPrototypeOf(N),I=Object.create(k)):(I=Object.create(g),k=g)}if(f){var L=v.indexOf(N);if(L!=-1)return E[L];v.push(N),E.push(I)}n(N,r)&&N.forEach(function(Z,Y){var ee=x(Y,A-1),oe=x(Z,A-1);I.set(ee,oe)}),n(N,i)&&N.forEach(function(Z){var Y=x(Z,A-1);I.add(Y)});for(var U in N){var $;k&&($=Object.getOwnPropertyDescriptor(k,U)),!($&&$.set==null)&&(I[U]=x(N[U],A-1))}if(Object.getOwnPropertySymbols)for(var q=Object.getOwnPropertySymbols(N),U=0;U<q.length;U++){var G=q[U],X=Object.getOwnPropertyDescriptor(N,G);X&&!X.enumerable&&!_||(I[G]=x(N[G],A-1),X.enumerable||Object.defineProperty(I,G,{enumerable:!1}))}if(_)for(var re=Object.getOwnPropertyNames(N),U=0;U<re.length;U++){var V=re[U],X=Object.getOwnPropertyDescriptor(N,V);X&&X.enumerable||(I[V]=x(N[V],A-1),Object.defineProperty(I,V,{enumerable:!1}))}return I}return x(d,p)}a.clonePrototype=function(f){if(f===null)return null;var p=function(){};return p.prototype=f,new p};function o(d){return Object.prototype.toString.call(d)}a.__objToStr=o;function c(d){return typeof d=="object"&&o(d)==="[object Date]"}a.__isDate=c;function l(d){return typeof d=="object"&&o(d)==="[object Array]"}a.__isArray=l;function u(d){return typeof d=="object"&&o(d)==="[object RegExp]"}a.__isRegExp=u;function h(d){var f="";return d.global&&(f+="g"),d.ignoreCase&&(f+="i"),d.multiline&&(f+="m"),f}return a.__getRegExpFlags=h,a}();t.exports&&(t.exports=e)})(fEe);var Vyt=fEe.exports,nq={exports:{}},gj,gie;function Gyt(){if(gie)return gj;gie=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;gj=function(u,h){h=h||{};var d=typeof u;if(d==="string"&&u.length>0)return a(u);if(d==="number"&&isFinite(u))return h.long?c(u):o(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function a(u){if(u=String(u),!(u.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(h){var d=parseFloat(h[1]),f=(h[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return d*s;case"weeks":case"week":case"w":return d*i;case"days":case"day":case"d":return d*r;case"hours":case"hour":case"hrs":case"hr":case"h":return d*n;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function o(u){var h=Math.abs(u);return h>=r?Math.round(u/r)+"d":h>=n?Math.round(u/n)+"h":h>=e?Math.round(u/e)+"m":h>=t?Math.round(u/t)+"s":u+"ms"}function c(u){var h=Math.abs(u);return h>=r?l(u,h,r,"day"):h>=n?l(u,h,n,"hour"):h>=e?l(u,h,e,"minute"):h>=t?l(u,h,t,"second"):u+" ms"}function l(u,h,d,f){var p=h>=d*1.5;return Math.round(u/d)+" "+f+(p?"s":"")}return gj}function qyt(t){n.debug=n,n.default=n,n.coerce=c,n.disable=s,n.enable=i,n.enabled=a,n.humanize=Gyt(),n.destroy=l,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let h=0;for(let d=0;d<u.length;d++)h=(h<<5)-h+u.charCodeAt(d),h|=0;return n.colors[Math.abs(h)%n.colors.length]}n.selectColor=e;function n(u){let h,d=null,f,p;function g(..._){if(!g.enabled)return;const v=g,E=Number(new Date),T=E-(h||E);v.diff=T,v.prev=h,v.curr=E,h=E,_[0]=n.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(A,I)=>{if(A==="%%")return"%";x++;const k=n.formatters[I];if(typeof k=="function"){const L=_[x];A=k.call(v,L),_.splice(x,1),x--}return A}),n.formatArgs.call(v,_),(v.log||n.log).apply(v,_)}return g.namespace=u,g.useColors=n.useColors(),g.color=n.selectColor(u),g.extend=r,g.destroy=n.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(f!==n.namespaces&&(f=n.namespaces,p=n.enabled(u)),p),set:_=>{d=_}}),typeof n.init=="function"&&n.init(g),g}function r(u,h){const d=n(this.namespace+(typeof h>"u"?":":h)+u);return d.log=this.log,d}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let h;const d=(typeof u=="string"?u:"").split(/[\s,]+/),f=d.length;for(h=0;h<f;h++)d[h]&&(u=d[h].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.slice(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...n.names.map(o),...n.skips.map(o).map(h=>"-"+h)].join(",");return n.enable(""),u}function a(u){if(u[u.length-1]==="*")return!0;let h,d;for(h=0,d=n.skips.length;h<d;h++)if(n.skips[h].test(u))return!1;for(h=0,d=n.names.length;h<d;h++)if(n.names[h].test(u))return!0;return!1}function o(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var $yt=qyt;(function(t,e){var n={};e.formatArgs=i,e.save=s,e.load=a,e.useColors=r,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let h=0,d=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(h++,f==="%c"&&(d=h))}),l.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function a(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof zn<"u"&&"env"in zn&&(l=n.DEBUG),l}function o(){try{return localStorage}catch{}}t.exports=$yt(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(nq,nq.exports);var az=nq.exports,Wyt=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},rq={exports:{}},iq={exports:{}};const PI=Xie(T8e);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var n=PI,r=n.Buffer;function i(a,o){for(var c in a)o[c]=a[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=s);function s(a,o,c){return r(a,o,c)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(a,o,c){if(typeof a=="number")throw new TypeError("Argument must not be a number");return r(a,o,c)},s.alloc=function(a,o,c){if(typeof a!="number")throw new TypeError("Argument must be a number");var l=r(a);return o!==void 0?typeof c=="string"?l.fill(o,c):l.fill(o):l.fill(0),l},s.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r(a)},s.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(a)}})(iq,iq.exports);var pEe=iq.exports,vj=65536,Yyt=4294967295;function Xyt(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Kyt=pEe.Buffer,YU=Ll.crypto||Ll.msCrypto;YU&&YU.getRandomValues?rq.exports=Jyt:rq.exports=Xyt;function Jyt(t,e){if(t>Yyt)throw new RangeError("requested too many random bytes");var n=Kyt.allocUnsafe(t);if(t>0)if(t>vj)for(var r=0;r<t;r+=vj)YU.getRandomValues(n.slice(r,r+vj));else YU.getRandomValues(n);return typeof e=="function"?zn.nextTick(function(){e(null,n)}):n}var oz=rq.exports,sq={exports:{}},uX={exports:{}},Pw=typeof Reflect=="object"?Reflect:null,vie=Pw&&typeof Pw.apply=="function"?Pw.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},VP;Pw&&typeof Pw.ownKeys=="function"?VP=Pw.ownKeys:Object.getOwnPropertySymbols?VP=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:VP=function(e){return Object.getOwnPropertyNames(e)};function Zyt(t){console&&console.warn&&console.warn(t)}var mEe=Number.isNaN||function(e){return e!==e};function zs(){zs.init.call(this)}uX.exports=zs;uX.exports.once=n_t;zs.EventEmitter=zs;zs.prototype._events=void 0;zs.prototype._eventsCount=0;zs.prototype._maxListeners=void 0;var yie=10;function cz(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(zs,"defaultMaxListeners",{enumerable:!0,get:function(){return yie},set:function(t){if(typeof t!="number"||t<0||mEe(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");yie=t}});zs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};zs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||mEe(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function gEe(t){return t._maxListeners===void 0?zs.defaultMaxListeners:t._maxListeners}zs.prototype.getMaxListeners=function(){return gEe(this)};zs.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")vie(c,this,n);else for(var l=c.length,u=EEe(c,l),r=0;r<l;++r)vie(u[r],this,n);return!0};function vEe(t,e,n,r){var i,s,a;if(cz(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),a=s[e]),a===void 0)a=s[e]=n,++t._eventsCount;else if(typeof a=="function"?a=s[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=gEe(t),i>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=a.length,Zyt(o)}return t}zs.prototype.addListener=function(e,n){return vEe(this,e,n,!1)};zs.prototype.on=zs.prototype.addListener;zs.prototype.prependListener=function(e,n){return vEe(this,e,n,!0)};function Qyt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function yEe(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Qyt.bind(r);return i.listener=n,r.wrapFn=i,i}zs.prototype.once=function(e,n){return cz(n),this.on(e,yEe(this,e,n)),this};zs.prototype.prependOnceListener=function(e,n){return cz(n),this.prependListener(e,yEe(this,e,n)),this};zs.prototype.removeListener=function(e,n){var r,i,s,a,o;if(cz(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){o=r[a].listener,s=a;break}if(s<0)return this;s===0?r.shift():e_t(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,o||n)}return this};zs.prototype.off=zs.prototype.removeListener;zs.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function _Ee(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?t_t(i):EEe(i,i.length)}zs.prototype.listeners=function(e){return _Ee(this,e,!0)};zs.prototype.rawListeners=function(e){return _Ee(this,e,!1)};zs.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):bEe.call(t,e)};zs.prototype.listenerCount=bEe;function bEe(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}zs.prototype.eventNames=function(){return this._eventsCount>0?VP(this._events):[]};function EEe(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function e_t(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function t_t(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function n_t(t,e){return new Promise(function(n,r){function i(a){t.removeListener(e,s),r(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}SEe(t,e,s,{once:!0}),e!=="error"&&r_t(t,i,{once:!0})})}function r_t(t,e,n){typeof t.on=="function"&&SEe(t,"error",e,n)}function SEe(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var LI=uX.exports;const JEt=qc(LI);var TEe=LI.EventEmitter,yj,_ie;function i_t(){if(_ie)return yj;_ie=1;function t(p,g){var _=Object.keys(p);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(p);g&&(v=v.filter(function(E){return Object.getOwnPropertyDescriptor(p,E).enumerable})),_.push.apply(_,v)}return _}function e(p){for(var g=1;g<arguments.length;g++){var _=arguments[g]!=null?arguments[g]:{};g%2?t(Object(_),!0).forEach(function(v){n(p,v,_[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(_)):t(Object(_)).forEach(function(v){Object.defineProperty(p,v,Object.getOwnPropertyDescriptor(_,v))})}return p}function n(p,g,_){return g=a(g),g in p?Object.defineProperty(p,g,{value:_,enumerable:!0,configurable:!0,writable:!0}):p[g]=_,p}function r(p,g){if(!(p instanceof g))throw new TypeError("Cannot call a class as a function")}function i(p,g){for(var _=0;_<g.length;_++){var v=g[_];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(p,a(v.key),v)}}function s(p,g,_){return g&&i(p.prototype,g),Object.defineProperty(p,"prototype",{writable:!1}),p}function a(p){var g=o(p,"string");return typeof g=="symbol"?g:String(g)}function o(p,g){if(typeof p!="object"||p===null)return p;var _=p[Symbol.toPrimitive];if(_!==void 0){var v=_.call(p,g||"default");if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(p)}var c=PI,l=c.Buffer,u=CT,h=u.inspect,d=h&&h.custom||"inspect";function f(p,g,_){l.prototype.copy.call(p,g,_)}return yj=function(){function p(){r(this,p),this.head=null,this.tail=null,this.length=0}return s(p,[{key:"push",value:function(_){var v={data:_,next:null};this.length>0?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,E=""+v.data;v=v.next;)E+=_+v.data;return E}},{key:"concat",value:function(_){if(this.length===0)return l.alloc(0);for(var v=l.allocUnsafe(_>>>0),E=this.head,T=0;E;)f(E.data,v,T),T+=E.data.length,E=E.next;return v}},{key:"consume",value:function(_,v){var E;return _<this.head.data.length?(E=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?E=this.shift():E=v?this._getString(_):this._getBuffer(_),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,E=1,T=v.data;for(_-=T.length;v=v.next;){var x=v.data,N=_>x.length?x.length:_;if(N===x.length?T+=x:T+=x.slice(0,_),_-=N,_===0){N===x.length?(++E,v.next?this.head=v.next:this.head=this.tail=null):(this.head=v,v.data=x.slice(N));break}++E}return this.length-=E,T}},{key:"_getBuffer",value:function(_){var v=l.allocUnsafe(_),E=this.head,T=1;for(E.data.copy(v),_-=E.data.length;E=E.next;){var x=E.data,N=_>x.length?x.length:_;if(x.copy(v,v.length-_,0,N),_-=N,_===0){N===x.length?(++T,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=x.slice(N));break}++T}return this.length-=T,v}},{key:d,value:function(_,v){return h(this,e(e({},v),{},{depth:0,customInspect:!1}))}}]),p}(),yj}function s_t(t,e){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,zn.nextTick(aq,this,t)):zn.nextTick(aq,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?n._writableState?n._writableState.errorEmitted?zn.nextTick(GP,n):(n._writableState.errorEmitted=!0,zn.nextTick(bie,n,s)):zn.nextTick(bie,n,s):e?(zn.nextTick(GP,n),e(s)):zn.nextTick(GP,n)}),this)}function bie(t,e){aq(t,e),GP(t)}function GP(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function a_t(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function aq(t,e){t.emit("error",e)}function o_t(t,e){var n=t._readableState,r=t._writableState;n&&n.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var xEe={destroy:s_t,undestroy:a_t,errorOrDestroy:o_t},ux={};function c_t(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var wEe={};function yp(t,e,n){n||(n=Error);function r(s,a,o){return typeof e=="string"?e:e(s,a,o)}var i=function(s){c_t(a,s);function a(o,c,l){return s.call(this,r(o,c,l))||this}return a}(n);i.prototype.name=n.name,i.prototype.code=t,wEe[t]=i}function Eie(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map(function(r){return String(r)}),n>2?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:n===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function l_t(t,e,n){return t.substr(0,e.length)===e}function u_t(t,e,n){return(n===void 0||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}function h_t(t,e,n){return typeof n!="number"&&(n=0),n+e.length>t.length?!1:t.indexOf(e,n)!==-1}yp("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);yp("ERR_INVALID_ARG_TYPE",function(t,e,n){var r;typeof e=="string"&&l_t(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var i;if(u_t(t," argument"))i="The ".concat(t," ").concat(r," ").concat(Eie(e,"type"));else{var s=h_t(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(Eie(e,"type"))}return i+=". Received type ".concat(typeof n),i},TypeError);yp("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");yp("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});yp("ERR_STREAM_PREMATURE_CLOSE","Premature close");yp("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});yp("ERR_MULTIPLE_CALLBACK","Callback called multiple times");yp("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");yp("ERR_STREAM_WRITE_AFTER_END","write after end");yp("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);yp("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);yp("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");ux.codes=wEe;var d_t=ux.codes.ERR_INVALID_OPT_VALUE;function f_t(t,e,n){return t.highWaterMark!=null?t.highWaterMark:e?t[n]:null}function p_t(t,e,n,r){var i=f_t(e,r,n);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=r?n:"highWaterMark";throw new d_t(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var CEe={getHighWaterMark:p_t},oq={exports:{}};typeof Object.create=="function"?oq.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:oq.exports=function(e,n){if(n){e.super_=n;var r=function(){};r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e}};var UI=oq.exports,m_t=g_t;function g_t(t,e){if(_j("noDeprecation"))return t;var n=!1;function r(){if(!n){if(_j("throwDeprecation"))throw new Error(e);_j("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}return r}function _j(t){try{if(!Ll.localStorage)return!1}catch{return!1}var e=Ll.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var bj,Sie;function REe(){if(Sie)return bj;Sie=1,bj=k;function t(we){var Ce=this;this.next=null,this.entry=null,this.finish=function(){Le(Ce,we)}}var e;k.WritableState=A;var n={deprecate:m_t},r=TEe,i=PI.Buffer,s=(typeof Ll<"u"?Ll:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(we){return i.from(we)}function o(we){return i.isBuffer(we)||we instanceof s}var c=xEe,l=CEe,u=l.getHighWaterMark,h=ux.codes,d=h.ERR_INVALID_ARG_TYPE,f=h.ERR_METHOD_NOT_IMPLEMENTED,p=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_STREAM_CANNOT_PIPE,_=h.ERR_STREAM_DESTROYED,v=h.ERR_STREAM_NULL_VALUES,E=h.ERR_STREAM_WRITE_AFTER_END,T=h.ERR_UNKNOWN_ENCODING,x=c.errorOrDestroy;UI(k,r);function N(){}function A(we,Ce,ke){e=e||kC(),we=we||{},typeof ke!="boolean"&&(ke=Ce instanceof e),this.objectMode=!!we.objectMode,ke&&(this.objectMode=this.objectMode||!!we.writableObjectMode),this.highWaterMark=u(this,we,"writableHighWaterMark",ke),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var St=we.decodeStrings===!1;this.decodeStrings=!St,this.defaultEncoding=we.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(At){V(Ce,At)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=we.emitClose!==!1,this.autoDestroy=!!we.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}A.prototype.getBuffer=function(){for(var Ce=this.bufferedRequest,ke=[];Ce;)ke.push(Ce),Ce=Ce.next;return ke},function(){try{Object.defineProperty(A.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var I;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(I=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(Ce){return I.call(this,Ce)?!0:this!==k?!1:Ce&&Ce._writableState instanceof A}})):I=function(Ce){return Ce instanceof this};function k(we){e=e||kC();var Ce=this instanceof e;if(!Ce&&!I.call(k,this))return new k(we);this._writableState=new A(we,this,Ce),this.writable=!0,we&&(typeof we.write=="function"&&(this._write=we.write),typeof we.writev=="function"&&(this._writev=we.writev),typeof we.destroy=="function"&&(this._destroy=we.destroy),typeof we.final=="function"&&(this._final=we.final)),r.call(this)}k.prototype.pipe=function(){x(this,new g)};function L(we,Ce){var ke=new E;x(we,ke),zn.nextTick(Ce,ke)}function U(we,Ce,ke,St){var At;return ke===null?At=new v:typeof ke!="string"&&!Ce.objectMode&&(At=new d("chunk",["string","Buffer"],ke)),At?(x(we,At),zn.nextTick(St,At),!1):!0}k.prototype.write=function(we,Ce,ke){var St=this._writableState,At=!1,Ee=!St.objectMode&&o(we);return Ee&&!i.isBuffer(we)&&(we=a(we)),typeof Ce=="function"&&(ke=Ce,Ce=null),Ee?Ce="buffer":Ce||(Ce=St.defaultEncoding),typeof ke!="function"&&(ke=N),St.ending?L(this,ke):(Ee||U(this,St,we,ke))&&(St.pendingcb++,At=q(this,St,Ee,we,Ce,ke)),At},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var we=this._writableState;we.corked&&(we.corked--,!we.writing&&!we.corked&&!we.bufferProcessing&&we.bufferedRequest&&ee(this,we))},k.prototype.setDefaultEncoding=function(Ce){if(typeof Ce=="string"&&(Ce=Ce.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Ce+"").toLowerCase())>-1))throw new T(Ce);return this._writableState.defaultEncoding=Ce,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function $(we,Ce,ke){return!we.objectMode&&we.decodeStrings!==!1&&typeof Ce=="string"&&(Ce=i.from(Ce,ke)),Ce}Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function q(we,Ce,ke,St,At,Ee){if(!ke){var ye=$(Ce,St,At);St!==ye&&(ke=!0,At="buffer",St=ye)}var et=Ce.objectMode?1:St.length;Ce.length+=et;var fe=Ce.length<Ce.highWaterMark;if(fe||(Ce.needDrain=!0),Ce.writing||Ce.corked){var Fe=Ce.lastBufferedRequest;Ce.lastBufferedRequest={chunk:St,encoding:At,isBuf:ke,callback:Ee,next:null},Fe?Fe.next=Ce.lastBufferedRequest:Ce.bufferedRequest=Ce.lastBufferedRequest,Ce.bufferedRequestCount+=1}else G(we,Ce,!1,et,St,At,Ee);return fe}function G(we,Ce,ke,St,At,Ee,ye){Ce.writelen=St,Ce.writecb=ye,Ce.writing=!0,Ce.sync=!0,Ce.destroyed?Ce.onwrite(new _("write")):ke?we._writev(At,Ce.onwrite):we._write(At,Ee,Ce.onwrite),Ce.sync=!1}function X(we,Ce,ke,St,At){--Ce.pendingcb,ke?(zn.nextTick(At,St),zn.nextTick(He,we,Ce),we._writableState.errorEmitted=!0,x(we,St)):(At(St),we._writableState.errorEmitted=!0,x(we,St),He(we,Ce))}function re(we){we.writing=!1,we.writecb=null,we.length-=we.writelen,we.writelen=0}function V(we,Ce){var ke=we._writableState,St=ke.sync,At=ke.writecb;if(typeof At!="function")throw new p;if(re(ke),Ce)X(we,ke,St,Ce,At);else{var Ee=oe(ke)||we.destroyed;!Ee&&!ke.corked&&!ke.bufferProcessing&&ke.bufferedRequest&&ee(we,ke),St?zn.nextTick(Z,we,ke,Ee,At):Z(we,ke,Ee,At)}}function Z(we,Ce,ke,St){ke||Y(we,Ce),Ce.pendingcb--,St(),He(we,Ce)}function Y(we,Ce){Ce.length===0&&Ce.needDrain&&(Ce.needDrain=!1,we.emit("drain"))}function ee(we,Ce){Ce.bufferProcessing=!0;var ke=Ce.bufferedRequest;if(we._writev&&ke&&ke.next){var St=Ce.bufferedRequestCount,At=new Array(St),Ee=Ce.corkedRequestsFree;Ee.entry=ke;for(var ye=0,et=!0;ke;)At[ye]=ke,ke.isBuf||(et=!1),ke=ke.next,ye+=1;At.allBuffers=et,G(we,Ce,!0,Ce.length,At,"",Ee.finish),Ce.pendingcb++,Ce.lastBufferedRequest=null,Ee.next?(Ce.corkedRequestsFree=Ee.next,Ee.next=null):Ce.corkedRequestsFree=new t(Ce),Ce.bufferedRequestCount=0}else{for(;ke;){var fe=ke.chunk,Fe=ke.encoding,Ie=ke.callback,rt=Ce.objectMode?1:fe.length;if(G(we,Ce,!1,rt,fe,Fe,Ie),ke=ke.next,Ce.bufferedRequestCount--,Ce.writing)break}ke===null&&(Ce.lastBufferedRequest=null)}Ce.bufferedRequest=ke,Ce.bufferProcessing=!1}k.prototype._write=function(we,Ce,ke){ke(new f("_write()"))},k.prototype._writev=null,k.prototype.end=function(we,Ce,ke){var St=this._writableState;return typeof we=="function"?(ke=we,we=null,Ce=null):typeof Ce=="function"&&(ke=Ce,Ce=null),we!=null&&this.write(we,Ce),St.corked&&(St.corked=1,this.uncork()),St.ending||Te(this,St,ke),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function oe(we){return we.ending&&we.length===0&&we.bufferedRequest===null&&!we.finished&&!we.writing}function de(we,Ce){we._final(function(ke){Ce.pendingcb--,ke&&x(we,ke),Ce.prefinished=!0,we.emit("prefinish"),He(we,Ce)})}function Me(we,Ce){!Ce.prefinished&&!Ce.finalCalled&&(typeof we._final=="function"&&!Ce.destroyed?(Ce.pendingcb++,Ce.finalCalled=!0,zn.nextTick(de,we,Ce)):(Ce.prefinished=!0,we.emit("prefinish")))}function He(we,Ce){var ke=oe(Ce);if(ke&&(Me(we,Ce),Ce.pendingcb===0&&(Ce.finished=!0,we.emit("finish"),Ce.autoDestroy))){var St=we._readableState;(!St||St.autoDestroy&&St.endEmitted)&&we.destroy()}return ke}function Te(we,Ce,ke){Ce.ending=!0,He(we,Ce),ke&&(Ce.finished?zn.nextTick(ke):we.once("finish",ke)),Ce.ended=!0,we.writable=!1}function Le(we,Ce,ke){var St=we.entry;for(we.entry=null;St;){var At=St.callback;Ce.pendingcb--,At(ke),St=St.next}Ce.corkedRequestsFree.next=we}return Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Ce){this._writableState&&(this._writableState.destroyed=Ce)}}),k.prototype.destroy=c.destroy,k.prototype._undestroy=c.undestroy,k.prototype._destroy=function(we,Ce){Ce(we)},bj}var Ej,Tie;function kC(){if(Tie)return Ej;Tie=1;var t=Object.keys||function(l){var u=[];for(var h in l)u.push(h);return u};Ej=a;var e=MEe(),n=REe();UI(a,e);for(var r=t(n.prototype),i=0;i<r.length;i++){var s=r[i];a.prototype[s]||(a.prototype[s]=n.prototype[s])}function a(l){if(!(this instanceof a))return new a(l);e.call(this,l),n.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||zn.nextTick(c,this)}function c(l){l.end()}return Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=u,this._writableState.destroyed=u)}}),Ej}var Sj={},xie;function wie(){if(xie)return Sj;xie=1;var t=pEe.Buffer,e=t.isEncoding||function(v){switch(v=""+v,v&&v.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(v){if(!v)return"utf8";for(var E;;)switch(v){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return v;default:if(E)return;v=(""+v).toLowerCase(),E=!0}}function r(v){var E=n(v);if(typeof E!="string"&&(t.isEncoding===e||!e(v)))throw new Error("Unknown encoding: "+v);return E||v}Sj.StringDecoder=i;function i(v){this.encoding=r(v);var E;switch(this.encoding){case"utf16le":this.text=h,this.end=d,E=4;break;case"utf8":this.fillLast=c,E=4;break;case"base64":this.text=f,this.end=p,E=3;break;default:this.write=g,this.end=_;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(E)}i.prototype.write=function(v){if(v.length===0)return"";var E,T;if(this.lastNeed){if(E=this.fillLast(v),E===void 0)return"";T=this.lastNeed,this.lastNeed=0}else T=0;return T<v.length?E?E+this.text(v,T):this.text(v,T):E||""},i.prototype.end=u,i.prototype.text=l,i.prototype.fillLast=function(v){if(this.lastNeed<=v.length)return v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);v.copy(this.lastChar,this.lastTotal-this.lastNeed,0,v.length),this.lastNeed-=v.length};function s(v){return v<=127?0:v>>5===6?2:v>>4===14?3:v>>3===30?4:v>>6===2?-1:-2}function a(v,E,T){var x=E.length-1;if(x<T)return 0;var N=s(E[x]);return N>=0?(N>0&&(v.lastNeed=N-1),N):--x<T||N===-2?0:(N=s(E[x]),N>=0?(N>0&&(v.lastNeed=N-2),N):--x<T||N===-2?0:(N=s(E[x]),N>=0?(N>0&&(N===2?N=0:v.lastNeed=N-3),N):0))}function o(v,E,T){if((E[0]&192)!==128)return v.lastNeed=0,"�";if(v.lastNeed>1&&E.length>1){if((E[1]&192)!==128)return v.lastNeed=1,"�";if(v.lastNeed>2&&E.length>2&&(E[2]&192)!==128)return v.lastNeed=2,"�"}}function c(v){var E=this.lastTotal-this.lastNeed,T=o(this,v);if(T!==void 0)return T;if(this.lastNeed<=v.length)return v.copy(this.lastChar,E,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);v.copy(this.lastChar,E,0,v.length),this.lastNeed-=v.length}function l(v,E){var T=a(this,v,E);if(!this.lastNeed)return v.toString("utf8",E);this.lastTotal=T;var x=v.length-(T-this.lastNeed);return v.copy(this.lastChar,0,x),v.toString("utf8",E,x)}function u(v){var E=v&&v.length?this.write(v):"";return this.lastNeed?E+"�":E}function h(v,E){if((v.length-E)%2===0){var T=v.toString("utf16le",E);if(T){var x=T.charCodeAt(T.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1],T.slice(0,-1)}return T}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=v[v.length-1],v.toString("utf16le",E,v.length-1)}function d(v){var E=v&&v.length?this.write(v):"";if(this.lastNeed){var T=this.lastTotal-this.lastNeed;return E+this.lastChar.toString("utf16le",0,T)}return E}function f(v,E){var T=(v.length-E)%3;return T===0?v.toString("base64",E):(this.lastNeed=3-T,this.lastTotal=3,T===1?this.lastChar[0]=v[v.length-1]:(this.lastChar[0]=v[v.length-2],this.lastChar[1]=v[v.length-1]),v.toString("base64",E,v.length-T))}function p(v){var E=v&&v.length?this.write(v):"";return this.lastNeed?E+this.lastChar.toString("base64",0,3-this.lastNeed):E}function g(v){return v.toString(this.encoding)}function _(v){return v&&v.length?this.write(v):""}return Sj}var Cie=ux.codes.ERR_STREAM_PREMATURE_CLOSE;function v_t(t){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.apply(this,r)}}}function y_t(){}function __t(t){return t.setHeader&&typeof t.abort=="function"}function AEe(t,e,n){if(typeof e=="function")return AEe(t,null,e);e||(e={}),n=v_t(n||y_t);var r=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||o()},a=t._writableState&&t._writableState.finished,o=function(){i=!1,a=!0,r||n.call(t)},c=t._readableState&&t._readableState.endEmitted,l=function(){r=!1,c=!0,i||n.call(t)},u=function(p){n.call(t,p)},h=function(){var p;if(r&&!c)return(!t._readableState||!t._readableState.ended)&&(p=new Cie),n.call(t,p);if(i&&!a)return(!t._writableState||!t._writableState.ended)&&(p=new Cie),n.call(t,p)},d=function(){t.req.on("finish",o)};return __t(t)?(t.on("complete",o),t.on("abort",h),t.req?d():t.on("request",d)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",o),e.error!==!1&&t.on("error",u),t.on("close",h),function(){t.removeListener("complete",o),t.removeListener("abort",h),t.removeListener("request",d),t.req&&t.req.removeListener("finish",o),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",o),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",h)}}var hX=AEe,Tj,Rie;function b_t(){if(Rie)return Tj;Rie=1;var t;function e(T,x,N){return x=n(x),x in T?Object.defineProperty(T,x,{value:N,enumerable:!0,configurable:!0,writable:!0}):T[x]=N,T}function n(T){var x=r(T,"string");return typeof x=="symbol"?x:String(x)}function r(T,x){if(typeof T!="object"||T===null)return T;var N=T[Symbol.toPrimitive];if(N!==void 0){var A=N.call(T,x||"default");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(T)}var i=hX,s=Symbol("lastResolve"),a=Symbol("lastReject"),o=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),h=Symbol("stream");function d(T,x){return{value:T,done:x}}function f(T){var x=T[s];if(x!==null){var N=T[h].read();N!==null&&(T[l]=null,T[s]=null,T[a]=null,x(d(N,!1)))}}function p(T){zn.nextTick(f,T)}function g(T,x){return function(N,A){T.then(function(){if(x[c]){N(d(void 0,!0));return}x[u](N,A)},A)}}var _=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((t={get stream(){return this[h]},next:function(){var x=this,N=this[o];if(N!==null)return Promise.reject(N);if(this[c])return Promise.resolve(d(void 0,!0));if(this[h].destroyed)return new Promise(function(L,U){zn.nextTick(function(){x[o]?U(x[o]):L(d(void 0,!0))})});var A=this[l],I;if(A)I=new Promise(g(A,this));else{var k=this[h].read();if(k!==null)return Promise.resolve(d(k,!1));I=new Promise(this[u])}return this[l]=I,I}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var x=this;return new Promise(function(N,A){x[h].destroy(null,function(I){if(I){A(I);return}N(d(void 0,!0))})})}),t),_),E=function(x){var N,A=Object.create(v,(N={},e(N,h,{value:x,writable:!0}),e(N,s,{value:null,writable:!0}),e(N,a,{value:null,writable:!0}),e(N,o,{value:null,writable:!0}),e(N,c,{value:x._readableState.endEmitted,writable:!0}),e(N,u,{value:function(k,L){var U=A[h].read();U?(A[l]=null,A[s]=null,A[a]=null,k(d(U,!1))):(A[s]=k,A[a]=L)},writable:!0}),N));return A[l]=null,i(x,function(I){if(I&&I.code!=="ERR_STREAM_PREMATURE_CLOSE"){var k=A[a];k!==null&&(A[l]=null,A[s]=null,A[a]=null,k(I)),A[o]=I;return}var L=A[s];L!==null&&(A[l]=null,A[s]=null,A[a]=null,L(d(void 0,!0))),A[c]=!0}),x.on("readable",p.bind(null,A)),A};return Tj=E,Tj}var xj,Aie;function E_t(){return Aie||(Aie=1,xj=function(){throw new Error("Readable.from is not available in the browser")}),xj}var wj,Mie;function MEe(){if(Mie)return wj;Mie=1,wj=L;var t;L.ReadableState=k,LI.EventEmitter;var e=function(ye,et){return ye.listeners(et).length},n=TEe,r=PI.Buffer,i=(typeof Ll<"u"?Ll:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(Ee){return r.from(Ee)}function a(Ee){return r.isBuffer(Ee)||Ee instanceof i}var o=CT,c;o&&o.debuglog?c=o.debuglog("stream"):c=function(){};var l=i_t(),u=xEe,h=CEe,d=h.getHighWaterMark,f=ux.codes,p=f.ERR_INVALID_ARG_TYPE,g=f.ERR_STREAM_PUSH_AFTER_EOF,_=f.ERR_METHOD_NOT_IMPLEMENTED,v=f.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,E,T,x;UI(L,n);var N=u.errorOrDestroy,A=["error","close","destroy","pause","resume"];function I(Ee,ye,et){if(typeof Ee.prependListener=="function")return Ee.prependListener(ye,et);!Ee._events||!Ee._events[ye]?Ee.on(ye,et):Array.isArray(Ee._events[ye])?Ee._events[ye].unshift(et):Ee._events[ye]=[et,Ee._events[ye]]}function k(Ee,ye,et){t=t||kC(),Ee=Ee||{},typeof et!="boolean"&&(et=ye instanceof t),this.objectMode=!!Ee.objectMode,et&&(this.objectMode=this.objectMode||!!Ee.readableObjectMode),this.highWaterMark=d(this,Ee,"readableHighWaterMark",et),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Ee.emitClose!==!1,this.autoDestroy=!!Ee.autoDestroy,this.destroyed=!1,this.defaultEncoding=Ee.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Ee.encoding&&(E||(E=wie().StringDecoder),this.decoder=new E(Ee.encoding),this.encoding=Ee.encoding)}function L(Ee){if(t=t||kC(),!(this instanceof L))return new L(Ee);var ye=this instanceof t;this._readableState=new k(Ee,this,ye),this.readable=!0,Ee&&(typeof Ee.read=="function"&&(this._read=Ee.read),typeof Ee.destroy=="function"&&(this._destroy=Ee.destroy)),n.call(this)}Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ye){this._readableState&&(this._readableState.destroyed=ye)}}),L.prototype.destroy=u.destroy,L.prototype._undestroy=u.undestroy,L.prototype._destroy=function(Ee,ye){ye(Ee)},L.prototype.push=function(Ee,ye){var et=this._readableState,fe;return et.objectMode?fe=!0:typeof Ee=="string"&&(ye=ye||et.defaultEncoding,ye!==et.encoding&&(Ee=r.from(Ee,ye),ye=""),fe=!0),U(this,Ee,ye,!1,fe)},L.prototype.unshift=function(Ee){return U(this,Ee,null,!0,!1)};function U(Ee,ye,et,fe,Fe){c("readableAddChunk",ye);var Ie=Ee._readableState;if(ye===null)Ie.reading=!1,V(Ee,Ie);else{var rt;if(Fe||(rt=q(Ie,ye)),rt)N(Ee,rt);else if(Ie.objectMode||ye&&ye.length>0)if(typeof ye!="string"&&!Ie.objectMode&&Object.getPrototypeOf(ye)!==r.prototype&&(ye=s(ye)),fe)Ie.endEmitted?N(Ee,new v):$(Ee,Ie,ye,!0);else if(Ie.ended)N(Ee,new g);else{if(Ie.destroyed)return!1;Ie.reading=!1,Ie.decoder&&!et?(ye=Ie.decoder.write(ye),Ie.objectMode||ye.length!==0?$(Ee,Ie,ye,!1):ee(Ee,Ie)):$(Ee,Ie,ye,!1)}else fe||(Ie.reading=!1,ee(Ee,Ie))}return!Ie.ended&&(Ie.length<Ie.highWaterMark||Ie.length===0)}function $(Ee,ye,et,fe){ye.flowing&&ye.length===0&&!ye.sync?(ye.awaitDrain=0,Ee.emit("data",et)):(ye.length+=ye.objectMode?1:et.length,fe?ye.buffer.unshift(et):ye.buffer.push(et),ye.needReadable&&Z(Ee)),ee(Ee,ye)}function q(Ee,ye){var et;return!a(ye)&&typeof ye!="string"&&ye!==void 0&&!Ee.objectMode&&(et=new p("chunk",["string","Buffer","Uint8Array"],ye)),et}L.prototype.isPaused=function(){return this._readableState.flowing===!1},L.prototype.setEncoding=function(Ee){E||(E=wie().StringDecoder);var ye=new E(Ee);this._readableState.decoder=ye,this._readableState.encoding=this._readableState.decoder.encoding;for(var et=this._readableState.buffer.head,fe="";et!==null;)fe+=ye.write(et.data),et=et.next;return this._readableState.buffer.clear(),fe!==""&&this._readableState.buffer.push(fe),this._readableState.length=fe.length,this};var G=1073741824;function X(Ee){return Ee>=G?Ee=G:(Ee--,Ee|=Ee>>>1,Ee|=Ee>>>2,Ee|=Ee>>>4,Ee|=Ee>>>8,Ee|=Ee>>>16,Ee++),Ee}function re(Ee,ye){return Ee<=0||ye.length===0&&ye.ended?0:ye.objectMode?1:Ee!==Ee?ye.flowing&&ye.length?ye.buffer.head.data.length:ye.length:(Ee>ye.highWaterMark&&(ye.highWaterMark=X(Ee)),Ee<=ye.length?Ee:ye.ended?ye.length:(ye.needReadable=!0,0))}L.prototype.read=function(Ee){c("read",Ee),Ee=parseInt(Ee,10);var ye=this._readableState,et=Ee;if(Ee!==0&&(ye.emittedReadable=!1),Ee===0&&ye.needReadable&&((ye.highWaterMark!==0?ye.length>=ye.highWaterMark:ye.length>0)||ye.ended))return c("read: emitReadable",ye.length,ye.ended),ye.length===0&&ye.ended?ke(this):Z(this),null;if(Ee=re(Ee,ye),Ee===0&&ye.ended)return ye.length===0&&ke(this),null;var fe=ye.needReadable;c("need readable",fe),(ye.length===0||ye.length-Ee<ye.highWaterMark)&&(fe=!0,c("length less than watermark",fe)),ye.ended||ye.reading?(fe=!1,c("reading or ended",fe)):fe&&(c("do read"),ye.reading=!0,ye.sync=!0,ye.length===0&&(ye.needReadable=!0),this._read(ye.highWaterMark),ye.sync=!1,ye.reading||(Ee=re(et,ye)));var Fe;return Ee>0?Fe=Ce(Ee,ye):Fe=null,Fe===null?(ye.needReadable=ye.length<=ye.highWaterMark,Ee=0):(ye.length-=Ee,ye.awaitDrain=0),ye.length===0&&(ye.ended||(ye.needReadable=!0),et!==Ee&&ye.ended&&ke(this)),Fe!==null&&this.emit("data",Fe),Fe};function V(Ee,ye){if(c("onEofChunk"),!ye.ended){if(ye.decoder){var et=ye.decoder.end();et&&et.length&&(ye.buffer.push(et),ye.length+=ye.objectMode?1:et.length)}ye.ended=!0,ye.sync?Z(Ee):(ye.needReadable=!1,ye.emittedReadable||(ye.emittedReadable=!0,Y(Ee)))}}function Z(Ee){var ye=Ee._readableState;c("emitReadable",ye.needReadable,ye.emittedReadable),ye.needReadable=!1,ye.emittedReadable||(c("emitReadable",ye.flowing),ye.emittedReadable=!0,zn.nextTick(Y,Ee))}function Y(Ee){var ye=Ee._readableState;c("emitReadable_",ye.destroyed,ye.length,ye.ended),!ye.destroyed&&(ye.length||ye.ended)&&(Ee.emit("readable"),ye.emittedReadable=!1),ye.needReadable=!ye.flowing&&!ye.ended&&ye.length<=ye.highWaterMark,we(Ee)}function ee(Ee,ye){ye.readingMore||(ye.readingMore=!0,zn.nextTick(oe,Ee,ye))}function oe(Ee,ye){for(;!ye.reading&&!ye.ended&&(ye.length<ye.highWaterMark||ye.flowing&&ye.length===0);){var et=ye.length;if(c("maybeReadMore read 0"),Ee.read(0),et===ye.length)break}ye.readingMore=!1}L.prototype._read=function(Ee){N(this,new _("_read()"))},L.prototype.pipe=function(Ee,ye){var et=this,fe=this._readableState;switch(fe.pipesCount){case 0:fe.pipes=Ee;break;case 1:fe.pipes=[fe.pipes,Ee];break;default:fe.pipes.push(Ee);break}fe.pipesCount+=1,c("pipe count=%d opts=%j",fe.pipesCount,ye);var Fe=(!ye||ye.end!==!1)&&Ee!==zn.stdout&&Ee!==zn.stderr,Ie=Fe?dt:Ue;fe.endEmitted?zn.nextTick(Ie):et.once("end",Ie),Ee.on("unpipe",rt);function rt(qt,Mt){c("onunpipe"),qt===et&&Mt&&Mt.hasUnpiped===!1&&(Mt.hasUnpiped=!0,be())}function dt(){c("onend"),Ee.end()}var gt=de(et);Ee.on("drain",gt);var bt=!1;function be(){c("cleanup"),Ee.removeListener("close",nt),Ee.removeListener("finish",$e),Ee.removeListener("drain",gt),Ee.removeListener("error",Xe),Ee.removeListener("unpipe",rt),et.removeListener("end",dt),et.removeListener("end",Ue),et.removeListener("data",ue),bt=!0,fe.awaitDrain&&(!Ee._writableState||Ee._writableState.needDrain)&&gt()}et.on("data",ue);function ue(qt){c("ondata");var Mt=Ee.write(qt);c("dest.write",Mt),Mt===!1&&((fe.pipesCount===1&&fe.pipes===Ee||fe.pipesCount>1&&At(fe.pipes,Ee)!==-1)&&!bt&&(c("false write response, pause",fe.awaitDrain),fe.awaitDrain++),et.pause())}function Xe(qt){c("onerror",qt),Ue(),Ee.removeListener("error",Xe),e(Ee,"error")===0&&N(Ee,qt)}I(Ee,"error",Xe);function nt(){Ee.removeListener("finish",$e),Ue()}Ee.once("close",nt);function $e(){c("onfinish"),Ee.removeListener("close",nt),Ue()}Ee.once("finish",$e);function Ue(){c("unpipe"),et.unpipe(Ee)}return Ee.emit("pipe",et),fe.flowing||(c("pipe resume"),et.resume()),Ee};function de(Ee){return function(){var et=Ee._readableState;c("pipeOnDrain",et.awaitDrain),et.awaitDrain&&et.awaitDrain--,et.awaitDrain===0&&e(Ee,"data")&&(et.flowing=!0,we(Ee))}}L.prototype.unpipe=function(Ee){var ye=this._readableState,et={hasUnpiped:!1};if(ye.pipesCount===0)return this;if(ye.pipesCount===1)return Ee&&Ee!==ye.pipes?this:(Ee||(Ee=ye.pipes),ye.pipes=null,ye.pipesCount=0,ye.flowing=!1,Ee&&Ee.emit("unpipe",this,et),this);if(!Ee){var fe=ye.pipes,Fe=ye.pipesCount;ye.pipes=null,ye.pipesCount=0,ye.flowing=!1;for(var Ie=0;Ie<Fe;Ie++)fe[Ie].emit("unpipe",this,{hasUnpiped:!1});return this}var rt=At(ye.pipes,Ee);return rt===-1?this:(ye.pipes.splice(rt,1),ye.pipesCount-=1,ye.pipesCount===1&&(ye.pipes=ye.pipes[0]),Ee.emit("unpipe",this,et),this)},L.prototype.on=function(Ee,ye){var et=n.prototype.on.call(this,Ee,ye),fe=this._readableState;return Ee==="data"?(fe.readableListening=this.listenerCount("readable")>0,fe.flowing!==!1&&this.resume()):Ee==="readable"&&!fe.endEmitted&&!fe.readableListening&&(fe.readableListening=fe.needReadable=!0,fe.flowing=!1,fe.emittedReadable=!1,c("on readable",fe.length,fe.reading),fe.length?Z(this):fe.reading||zn.nextTick(He,this)),et},L.prototype.addListener=L.prototype.on,L.prototype.removeListener=function(Ee,ye){var et=n.prototype.removeListener.call(this,Ee,ye);return Ee==="readable"&&zn.nextTick(Me,this),et},L.prototype.removeAllListeners=function(Ee){var ye=n.prototype.removeAllListeners.apply(this,arguments);return(Ee==="readable"||Ee===void 0)&&zn.nextTick(Me,this),ye};function Me(Ee){var ye=Ee._readableState;ye.readableListening=Ee.listenerCount("readable")>0,ye.resumeScheduled&&!ye.paused?ye.flowing=!0:Ee.listenerCount("data")>0&&Ee.resume()}function He(Ee){c("readable nexttick read 0"),Ee.read(0)}L.prototype.resume=function(){var Ee=this._readableState;return Ee.flowing||(c("resume"),Ee.flowing=!Ee.readableListening,Te(this,Ee)),Ee.paused=!1,this};function Te(Ee,ye){ye.resumeScheduled||(ye.resumeScheduled=!0,zn.nextTick(Le,Ee,ye))}function Le(Ee,ye){c("resume",ye.reading),ye.reading||Ee.read(0),ye.resumeScheduled=!1,Ee.emit("resume"),we(Ee),ye.flowing&&!ye.reading&&Ee.read(0)}L.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function we(Ee){var ye=Ee._readableState;for(c("flow",ye.flowing);ye.flowing&&Ee.read()!==null;);}L.prototype.wrap=function(Ee){var ye=this,et=this._readableState,fe=!1;Ee.on("end",function(){if(c("wrapped end"),et.decoder&&!et.ended){var rt=et.decoder.end();rt&&rt.length&&ye.push(rt)}ye.push(null)}),Ee.on("data",function(rt){if(c("wrapped data"),et.decoder&&(rt=et.decoder.write(rt)),!(et.objectMode&&rt==null)&&!(!et.objectMode&&(!rt||!rt.length))){var dt=ye.push(rt);dt||(fe=!0,Ee.pause())}});for(var Fe in Ee)this[Fe]===void 0&&typeof Ee[Fe]=="function"&&(this[Fe]=function(dt){return function(){return Ee[dt].apply(Ee,arguments)}}(Fe));for(var Ie=0;Ie<A.length;Ie++)Ee.on(A[Ie],this.emit.bind(this,A[Ie]));return this._read=function(rt){c("wrapped _read",rt),fe&&(fe=!1,Ee.resume())},this},typeof Symbol=="function"&&(L.prototype[Symbol.asyncIterator]=function(){return T===void 0&&(T=b_t()),T(this)}),Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ye){this._readableState&&(this._readableState.flowing=ye)}}),L._fromList=Ce,Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Ce(Ee,ye){if(ye.length===0)return null;var et;return ye.objectMode?et=ye.buffer.shift():!Ee||Ee>=ye.length?(ye.decoder?et=ye.buffer.join(""):ye.buffer.length===1?et=ye.buffer.first():et=ye.buffer.concat(ye.length),ye.buffer.clear()):et=ye.buffer.consume(Ee,ye.decoder),et}function ke(Ee){var ye=Ee._readableState;c("endReadable",ye.endEmitted),ye.endEmitted||(ye.ended=!0,zn.nextTick(St,ye,Ee))}function St(Ee,ye){if(c("endReadableNT",Ee.endEmitted,Ee.length),!Ee.endEmitted&&Ee.length===0&&(Ee.endEmitted=!0,ye.readable=!1,ye.emit("end"),Ee.autoDestroy)){var et=ye._writableState;(!et||et.autoDestroy&&et.finished)&&ye.destroy()}}typeof Symbol=="function"&&(L.from=function(Ee,ye){return x===void 0&&(x=E_t()),x(L,Ee,ye)});function At(Ee,ye){for(var et=0,fe=Ee.length;et<fe;et++)if(Ee[et]===ye)return et;return-1}return wj}var OEe=hy,lz=ux.codes,S_t=lz.ERR_METHOD_NOT_IMPLEMENTED,T_t=lz.ERR_MULTIPLE_CALLBACK,x_t=lz.ERR_TRANSFORM_ALREADY_TRANSFORMING,w_t=lz.ERR_TRANSFORM_WITH_LENGTH_0,uz=kC();UI(hy,uz);function C_t(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(r===null)return this.emit("error",new T_t);n.writechunk=null,n.writecb=null,e!=null&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function hy(t){if(!(this instanceof hy))return new hy(t);uz.call(this,t),this._transformState={afterTransform:C_t.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",R_t)}function R_t(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,n){Oie(t,e,n)}):Oie(this,null,null)}hy.prototype.push=function(t,e){return this._transformState.needTransform=!1,uz.prototype.push.call(this,t,e)};hy.prototype._transform=function(t,e,n){n(new S_t("_transform()"))};hy.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};hy.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};hy.prototype._destroy=function(t,e){uz.prototype._destroy.call(this,t,function(n){e(n)})};function Oie(t,e,n){if(e)return t.emit("error",e);if(n!=null&&t.push(n),t._writableState.length)throw new w_t;if(t._transformState.transforming)throw new x_t;return t.push(null)}var A_t=YO,NEe=OEe;UI(YO,NEe);function YO(t){if(!(this instanceof YO))return new YO(t);NEe.call(this,t)}YO.prototype._transform=function(t,e,n){n(null,t)};var Cj;function M_t(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var IEe=ux.codes,O_t=IEe.ERR_MISSING_ARGS,N_t=IEe.ERR_STREAM_DESTROYED;function Nie(t){if(t)throw t}function I_t(t){return t.setHeader&&typeof t.abort=="function"}function k_t(t,e,n,r){r=M_t(r);var i=!1;t.on("close",function(){i=!0}),Cj===void 0&&(Cj=hX),Cj(t,{readable:e,writable:n},function(a){if(a)return r(a);i=!0,r()});var s=!1;return function(a){if(!i&&!s){if(s=!0,I_t(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(a||new N_t("pipe"))}}}function Iie(t){t()}function D_t(t,e){return t.pipe(e)}function P_t(t){return!t.length||typeof t[t.length-1]!="function"?Nie:t.pop()}function L_t(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=P_t(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new O_t("streams");var i,s=e.map(function(a,o){var c=o<e.length-1,l=o>0;return k_t(a,c,l,function(u){i||(i=u),u&&s.forEach(Iie),!c&&(s.forEach(Iie),r(i))})});return e.reduce(D_t)}var U_t=L_t;(function(t,e){e=t.exports=MEe(),e.Stream=e,e.Readable=e,e.Writable=REe(),e.Duplex=kC(),e.Transform=OEe,e.PassThrough=A_t,e.finished=hX,e.pipeline=U_t})(sq,sq.exports);var kEe=sq.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let kie;var DEe=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:Ll):t=>(kie||(kie=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function Die(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function B_t(t,e,n){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return Die(t,n)}catch{n.message=t.message,n.stack=t.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),Die(new i,n)}}var F_t=B_t;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const z_t=az("simple-peer"),PEe=Wyt,Pie=oz,H_t=kEe,Rj=DEe,Di=F_t,{Buffer:j_t}=PI,Aj=64*1024,V_t=5*1e3,G_t=5*1e3;function Lie(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function q_t(t){console.warn(t)}let hz=class cq extends H_t.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Pie(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Pie(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||cq.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},cq.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(n=>n),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||V_t,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:PEe(),!this._wrtc)throw Di(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(Di(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(Di(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(Di(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(Di(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch(r=>{!n.address||n.address.endsWith(".local")?q_t("Ignoring unsupported ICE candidate."):this.destroy(Di(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,n){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(r){this.destroy(Di(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this.destroying)return;if(this.destroyed)throw Di(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(n);if(!i)i=this._pc.addTrack(e,n),r.set(n,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?Di(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):Di(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,r){if(this.destroying)return;if(this.destroyed)throw Di(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),s=i?i.get(r):null;if(!s)throw Di(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,i),s.replaceTrack!=null?s.replaceTrack(n):this.destroy(Di(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this.destroying)return;if(this.destroyed)throw Di(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw Di(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(Di(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,Rj(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw Di(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),Rj(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),n()}))}_setupData(e){if(!e.channel)return this.destroy(Di(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Aj),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(Di(i,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},G_t)}_read(){}_write(e,n,r){if(this.destroyed)return r(Di(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(Di(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Aj?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Lie(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(Di(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(Di(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Lie(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(Di(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(Di(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(Di(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),this.emit("iceStateChange",e,n),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(Di(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(Di(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const n=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(s=>{i.push(n(s))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(s=>{const a={};s.names().forEach(o=>{a[o]=s.stat(o)}),a.id=s.id,a.type=s.type,a.timestamp=s.timestamp,i.push(n(a))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((n,r)=>{if(this.destroyed)return;n&&(r=[]);const i={},s={},a={};let o=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(i[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(s[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(a[l.id]=l)});const c=l=>{o=!0;let u=s[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let h=i[l.remoteCandidateId];h&&(h.ip||h.address)?(this.remoteAddress=h.ip||h.address,this.remotePort=Number(h.port)):h&&h.ipAddress?(this.remoteAddress=h.ipAddress,this.remotePort=Number(h.portNumber)):typeof l.googRemoteAddress=="string"&&(h=l.googRemoteAddress.split(":"),this.remoteAddress=h[0],this.remotePort=Number(h[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(a[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!o&&(!Object.keys(a).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.destroy(Di(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const l=this._cb;this._cb=null,l(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Aj||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=j_t.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(r=>r.id===n.id)&&(this._remoteStreams.push(n),Rj(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],z_t.apply(null,e)}};hz.WEBRTC_SUPPORT=!!PEe();hz.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};hz.channelConfig={};var $_t=hz;const W_t=az("simple-websocket"),Y_t=oz,X_t=kEe,Uie=DEe,fM=CT,RA=typeof fM!="function"?WebSocket:fM,Bie=64*1024;let LEe=class extends X_t.Duplex{constructor(e={}){if(typeof e=="string"&&(e={url:e}),e=Object.assign({allowHalfOpen:!1},e),super(e),e.url==null&&e.socket==null)throw new Error("Missing required `url` or `socket` option");if(e.url!=null&&e.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=Y_t(4).toString("hex").slice(0,7),this._debug("new websocket: %o",e),this.connected=!1,this.destroyed=!1,this._chunk=null,this._cb=null,this._interval=null,e.socket)this.url=e.socket.url,this._ws=e.socket,this.connected=e.socket.readyState===RA.OPEN;else{this.url=e.url;try{typeof fM=="function"?this._ws=new RA(e.url,null,{...e,encoding:void 0}):this._ws=new RA(e.url)}catch(n){Uie(()=>this.destroy(n));return}}this._ws.binaryType="arraybuffer",e.socket&&this.connected?Uie(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=n=>this._handleMessage(n),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=n=>this._handleError(n),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(e){this._ws.send(e)}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const r=this._ws,i=()=>{r.onclose=null};if(r.readyState===RA.CLOSED)i();else try{r.onclose=i,r.close()}catch{i()}r.onopen=null,r.onmessage=null,r.onerror=()=>{}}this._ws=null,e&&this.emit("error",e),this.emit("close"),n()}}_read(){}_write(e,n,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(i){return this.destroy(i)}typeof fM!="function"&&this._ws.bufferedAmount>Bie?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(n){return this.destroy(n)}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}typeof fM!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=kl.from(n)),this.push(n)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(e){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?e():this.once("connect",e)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>Bie)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],W_t.apply(null,e)}};LEe.WEBSOCKET_SUPPORT=!!RA;var K_t=LEe,UEe={};(function(t){t.DEFAULT_ANNOUNCE_PEERS=50,t.MAX_ANNOUNCE_PEERS=82,t.binaryToHex=n=>(typeof n!="string"&&(n=String(n)),kl.from(n,"binary").toString("hex")),t.hexToBinary=n=>(typeof n!="string"&&(n=String(n)),kl.from(n,"hex").toString("binary")),t.parseUrl=n=>{const r=new URL(n.replace(/^udp:/,"http:"));return n.match(/^udp:/)&&Object.defineProperties(r,{href:{value:r.href.replace(/^http/,"udp")},protocol:{value:r.protocol.replace(/^http/,"udp")},origin:{value:r.origin.replace(/^http/,"udp")}}),r},Object.assign(t,CT)})(UEe);const J_t=LI;let Z_t=class extends J_t{constructor(e,n){super(),this.client=e,this.announceUrl=n,this.interval=null,this.destroyed=!1}setInterval(e){e==null&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},e),this.interval.unref&&this.interval.unref())}};var Q_t=Z_t;const ebt=Vyt,zp=az("bittorrent-tracker:websocket-tracker"),tbt=$_t,nbt=oz,rbt=K_t,ibt=CT,b_=UEe,sbt=Q_t,Sv={},abt=10*1e3,obt=60*60*1e3,cbt=5*60*1e3,lbt=50*1e3;let dX=class extends sbt{constructor(e,n){super(e,n),zp("new websocket tracker %s",n),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.announce(e)});return}const n=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(n.trackerid=this._trackerId),e.event==="stopped"||e.event==="completed")this._send(n);else{const r=Math.min(e.numwant,5);this._generateOffers(r,i=>{n.numwant=r,n.offers=i,this._send(n)})}}scrape(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.scrape(e)});return}const r={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(i=>i.toString("binary")):e.infoHash&&e.infoHash.toString("binary")||this.client._infoHashBinary};this._send(r)}destroy(e=Fie){if(this.destroyed)return e(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(const s in this.peers){const a=this.peers[s];clearTimeout(a.trackerTimeout),a.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,Sv[this.announceUrl]&&(Sv[this.announceUrl].consumers-=1),Sv[this.announceUrl].consumers>0)return e();let n=Sv[this.announceUrl];delete Sv[this.announceUrl],n.on("error",Fie),n.once("close",e);let r;if(!this.expectingResponse)return i();r=setTimeout(i,b_.DESTROY_TIMEOUT),n.once("data",i);function i(){r&&(clearTimeout(r),r=null),n.removeListener("data",i),n.destroy(),n=null}}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=e=>{this._onSocketError(e)},this._onSocketDataBound=e=>{this._onSocketData(e)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=Sv[this.announceUrl],this.socket)Sv[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{const e=new URL(this.announceUrl);let n;this.client._proxyOpts&&(n=e.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!n&&this.client._proxyOpts.socksProxy&&(n=new ibt.Agent(ebt(this.client._proxyOpts.socksProxy),e.protocol==="wss:"))),this.socket=Sv[this.announceUrl]=new rbt({url:this.announceUrl,agent:n}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch{this.client.emit("warning",new Error("Invalid tracker response"));return}e.action==="announce"?this._onAnnounceResponse(e):e.action==="scrape"?this._onScrapeResponse(e):this._onSocketError(new Error(`invalid action in WS response: ${e.action}`))}}_onAnnounceResponse(e){if(e.info_hash!==this.client._infoHashBinary){zp("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,b_.binaryToHex(e.info_hash),this.client.infoHash);return}if(e.peer_id&&e.peer_id===this.client._peerIdBinary)return;zp("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);const n=e["failure reason"];if(n)return this.client.emit("warning",new Error(n));const r=e["warning message"];r&&this.client.emit("warning",new Error(r));const i=e.interval||e["min interval"];i&&this.setInterval(i*1e3);const s=e["tracker id"];if(s&&(this._trackerId=s),e.complete!=null){const o=Object.assign({},e,{announce:this.announceUrl,infoHash:b_.binaryToHex(e.info_hash)});this.client.emit("update",o)}let a;if(e.offer&&e.peer_id&&(zp("creating peer (from remote offer)"),a=this._createPeer(),a.id=b_.binaryToHex(e.peer_id),a.once("signal",o=>{const c={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:e.peer_id,answer:o,offer_id:e.offer_id};this._trackerId&&(c.trackerid=this._trackerId),this._send(c)}),this.client.emit("peer",a),a.signal(e.offer)),e.answer&&e.peer_id){const o=b_.binaryToHex(e.offer_id);a=this.peers[o],a?(a.id=b_.binaryToHex(e.peer_id),this.client.emit("peer",a),a.signal(e.answer),clearTimeout(a.trackerTimeout),a.trackerTimeout=null,delete this.peers[o]):zp(`got unexpected answer: ${JSON.stringify(e.answer)}`)}}_onScrapeResponse(e){e=e.files||{};const n=Object.keys(e);if(n.length===0){this.client.emit("warning",new Error("invalid scrape response"));return}n.forEach(r=>{const i=Object.assign(e[r],{announce:this.announceUrl,infoHash:b_.binaryToHex(r)});this.client.emit("scrape",i)})}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}_startReconnectTimer(){const e=Math.floor(Math.random()*cbt)+Math.min(Math.pow(2,this.retries)*abt,obt);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},e),this.reconnectTimer.unref&&this.reconnectTimer.unref(),zp("reconnecting socket in %s ms",e)}_send(e){if(this.destroyed)return;this.expectingResponse=!0;const n=JSON.stringify(e);zp("send %s",n),this.socket.send(n)}_generateOffers(e,n){const r=this,i=[];zp("generating %s offers",e);for(let o=0;o<e;++o)s();a();function s(){const o=nbt(20).toString("hex");zp("creating peer (from _generateOffers)");const c=r.peers[o]=r._createPeer({initiator:!0});c.once("signal",l=>{i.push({offer:l,offer_id:b_.hexToBinary(o)}),a()}),c.trackerTimeout=setTimeout(()=>{zp("tracker timeout: destroying peer"),c.trackerTimeout=null,delete r.peers[o],c.destroy()},lbt),c.trackerTimeout.unref&&c.trackerTimeout.unref()}function a(){i.length===e&&(zp("generated %s offers",e),n(i))}}_createPeer(e){const n=this;e=Object.assign({trickle:!1,config:n.client._rtcConfig,wrtc:n.client._wrtc},e);const r=new tbt(e);return r.once("error",i),r.once("connect",s),r;function i(a){n.client.emit("warning",new Error(`Connection error: ${a.message}`)),r.destroy()}function s(){r.removeListener("error",i),r.removeListener("connect",s)}}};dX.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1e3;dX._socketPool=Sv;function Fie(){}var ubt=dX,fX={exports:{}},BEe={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(typeof self<"u"?self:Ll,function(){return function(n){var r={};function i(s){if(r[s])return r[s].exports;var a=r[s]={i:s,l:!1,exports:{}};return n[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=n,i.c=r,i.d=function(s,a,o){i.o(s,a)||Object.defineProperty(s,a,{configurable:!1,enumerable:!0,get:o})},i.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(a,"a",a),a},i.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},i.p="",i(i.s=3)}([function(n,r,i){function s(_,v){if(!(_ instanceof v))throw new TypeError("Cannot call a class as a function")}var a=i(5),o=i(1),c=o.toHex,l=o.ceilHeapSize,u=i(6),h=function(_){for(_+=9;_%64>0;_+=1);return _},d=function(_,v){var E=new Uint8Array(_.buffer),T=v%4,x=v-T;switch(T){case 0:E[x+3]=0;case 1:E[x+2]=0;case 2:E[x+1]=0;case 3:E[x+0]=0}for(var N=(v>>2)+1;N<_.length;N++)_[N]=0},f=function(_,v,E){_[v>>2]|=128<<24-(v%4<<3),_[((v>>2)+2&-16)+14]=E/(1<<29)|0,_[((v>>2)+2&-16)+15]=E<<3},p=function(_,v){var E=new Int32Array(_,v+320,5),T=new Int32Array(5),x=new DataView(T.buffer);return x.setInt32(0,E[0],!1),x.setInt32(4,E[1],!1),x.setInt32(8,E[2],!1),x.setInt32(12,E[3],!1),x.setInt32(16,E[4],!1),T},g=function(){function _(v){if(s(this,_),v=v||64*1024,v%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=v,this._padMaxChunkLen=h(v),this._heap=new ArrayBuffer(l(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new a({Int32Array},{},this._heap)}return _.prototype._initState=function(E,T){this._offset=0;var x=new Int32Array(E,T+320,5);x[0]=1732584193,x[1]=-271733879,x[2]=-1732584194,x[3]=271733878,x[4]=-1009589776},_.prototype._padChunk=function(E,T){var x=h(E),N=new Int32Array(this._heap,0,x>>2);return d(N,E),f(N,E,T),x},_.prototype._write=function(E,T,x,N){u(E,this._h8,this._h32,T,x,N||0)},_.prototype._coreCall=function(E,T,x,N,A){var I=x;this._write(E,T,x),A&&(I=this._padChunk(x,N)),this._core.hash(I,this._padMaxChunkLen)},_.prototype.rawDigest=function(E){var T=E.byteLength||E.length||E.size||0;this._initState(this._heap,this._padMaxChunkLen);var x=0,N=this._maxChunkLen;for(x=0;T>x+N;x+=N)this._coreCall(E,x,N,T,!1);return this._coreCall(E,x,T-x,T,!0),p(this._heap,this._padMaxChunkLen)},_.prototype.digest=function(E){return c(this.rawDigest(E).buffer)},_.prototype.digestFromString=function(E){return this.digest(E)},_.prototype.digestFromBuffer=function(E){return this.digest(E)},_.prototype.digestFromArrayBuffer=function(E){return this.digest(E)},_.prototype.resetState=function(){return this._initState(this._heap,this._padMaxChunkLen),this},_.prototype.append=function(E){var T=0,x=E.byteLength||E.length||E.size||0,N=this._offset%this._maxChunkLen,A=void 0;for(this._offset+=x;T<x;)A=Math.min(x-T,this._maxChunkLen-N),this._write(E,T,A,N),N+=A,T+=A,N===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),N=0);return this},_.prototype.getState=function(){var E=this._offset%this._maxChunkLen,T=void 0;if(E)T=this._heap.slice(0);else{var x=new Int32Array(this._heap,this._padMaxChunkLen+320,5);T=x.buffer.slice(x.byteOffset,x.byteOffset+x.byteLength)}return{offset:this._offset,heap:T}},_.prototype.setState=function(E){if(this._offset=E.offset,E.heap.byteLength===20){var T=new Int32Array(this._heap,this._padMaxChunkLen+320,5);T.set(new Int32Array(E.heap))}else this._h32.set(new Int32Array(E.heap));return this},_.prototype.rawEnd=function(){var E=this._offset,T=E%this._maxChunkLen,x=this._padChunk(T,E);this._core.hash(x,this._padMaxChunkLen);var N=p(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),N},_.prototype.end=function(){return c(this.rawEnd().buffer)},_}();n.exports=g,n.exports._core=a},function(n,r){for(var i=new Array(256),s=0;s<256;s++)i[s]=(s<16?"0":"")+s.toString(16);n.exports.toHex=function(a){for(var o=new Uint8Array(a),c=new Array(a.byteLength),l=0;l<c.length;l++)c[l]=i[o[l]];return c.join("")},n.exports.ceilHeapSize=function(a){var o=0;if(a<=65536)return 65536;if(a<16777216)for(o=1;o<a;o=o<<1);else for(o=16777216;o<a;o+=16777216);return o},n.exports.isDedicatedWorkerScope=function(a){var o="WorkerGlobalScope"in a&&a instanceof a.WorkerGlobalScope,c="SharedWorkerGlobalScope"in a&&a instanceof a.SharedWorkerGlobalScope,l="ServiceWorkerGlobalScope"in a&&a instanceof a.ServiceWorkerGlobalScope;return o&&!c&&!l}},function(n,r,i){n.exports=function(){var s=i(0),a=function(l,u,h){try{return h(null,l.digest(u))}catch(d){return h(d)}},o=function(l,u,h,d,f){var p=new self.FileReader;p.onloadend=function(){if(p.error)return f(p.error);var _=p.result;u+=p.result.byteLength;try{l.append(_)}catch(v){f(v);return}u<d.size?o(l,u,h,d,f):f(null,l.end())},p.readAsArrayBuffer(d.slice(u,u+h))},c=!0;return self.onmessage=function(l){if(c){var u=l.data.data,h=l.data.file,d=l.data.id;if(!(typeof d>"u")&&!(!h&&!u)){var f=l.data.blockSize||4*1024*1024,p=new s(f);p.resetState();var g=function(_,v){_?self.postMessage({id:d,error:_.name}):self.postMessage({id:d,hash:v})};u&&a(p,u,g),h&&o(p,0,f,h,g)}}},function(){c=!1}}},function(n,r,i){var s=i(4),a=i(0),o=i(7),c=i(2),l=i(1),u=l.isDedicatedWorkerScope,h=typeof self<"u"&&u(self);a.disableWorkerBehaviour=h?c():function(){},a.createWorker=function(){var d=s(2),f=d.terminate;return d.terminate=function(){URL.revokeObjectURL(d.objectURL),f.call(d)},d},a.createHash=o,n.exports=a},function(n,r,i){function s(d){var f={};function p(_){if(f[_])return f[_].exports;var v=f[_]={i:_,l:!1,exports:{}};return d[_].call(v.exports,v,v.exports,p),v.l=!0,v.exports}p.m=d,p.c=f,p.i=function(_){return _},p.d=function(_,v,E){p.o(_,v)||Object.defineProperty(_,v,{configurable:!1,enumerable:!0,get:E})},p.r=function(_){Object.defineProperty(_,"__esModule",{value:!0})},p.n=function(_){var v=_&&_.__esModule?function(){return _.default}:function(){return _};return p.d(v,"a",v),v},p.o=function(_,v){return Object.prototype.hasOwnProperty.call(_,v)},p.p="/",p.oe=function(_){throw console.error(_),_};var g=p(p.s=ENTRY_MODULE);return g.default||g}var a="[\\.|\\-|\\+|\\w|/|@]+",o="\\((/\\*.*?\\*/)?s?.*?("+a+").*?\\)";function c(d){return(d+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function l(d,f,p){var g={};g[p]=[];var _=f.toString(),v=_.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return g;for(var E=v[1],T=new RegExp("(\\\\n|\\W)"+c(E)+o,"g"),x;x=T.exec(_);)x[3]!=="dll-reference"&&g[p].push(x[3]);for(T=new RegExp("\\("+c(E)+'\\("(dll-reference\\s('+a+'))"\\)\\)'+o,"g");x=T.exec(_);)d[x[2]]||(g[p].push(x[1]),d[x[2]]=i(x[1]).m),g[x[2]]=g[x[2]]||[],g[x[2]].push(x[4]);return g}function u(d){var f=Object.keys(d);return f.reduce(function(p,g){return p||d[g].length>0},!1)}function h(d,f){for(var p={main:[f]},g={main:[]},_={main:{}};u(p);)for(var v=Object.keys(p),E=0;E<v.length;E++){var T=v[E],x=p[T],N=x.pop();if(_[T]=_[T]||{},!(_[T][N]||!d[T][N])){_[T][N]=!0,g[T]=g[T]||[],g[T].push(N);for(var A=l(d,d[T][N],T),I=Object.keys(A),k=0;k<I.length;k++)p[I[k]]=p[I[k]]||[],p[I[k]]=p[I[k]].concat(A[I[k]])}}return g}n.exports=function(d,f){f=f||{};var p={main:i.m},g=f.all?{main:Object.keys(p)}:h(p,d),_="";Object.keys(g).filter(function(N){return N!=="main"}).forEach(function(N){for(var A=0;g[N][A];)A++;g[N].push(A),p[N][A]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",_=_+"var "+N+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(A))+")({"+g[N].map(function(I){return""+JSON.stringify(I)+": "+p[N][I].toString()}).join(",")+`});
`}),_=_+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(d))+")({"+g.main.map(function(N){return""+JSON.stringify(N)+": "+p.main[N].toString()}).join(",")+"})(self);";var v=new window.Blob([_],{type:"text/javascript"});if(f.bare)return v;var E=window.URL||window.webkitURL||window.mozURL||window.msURL,T=E.createObjectURL(v),x=new window.Worker(T);return x.objectURL=T,x}},function(n,r){n.exports=function(s,a,o){var c=new s.Int32Array(o);function l(u,h){u=u|0,h=h|0;var d=0,f=0,p=0,g=0,_=0,v=0,E=0,T=0,x=0,N=0,A=0,I=0,k=0,L=0;for(p=c[h+320>>2]|0,_=c[h+324>>2]|0,E=c[h+328>>2]|0,x=c[h+332>>2]|0,A=c[h+336>>2]|0,d=0;(d|0)<(u|0);d=d+64|0){for(g=p,v=_,T=E,N=x,I=A,f=0;(f|0)<64;f=f+4|0)L=c[d+f>>2]|0,k=((p<<5|p>>>27)+(_&E|~_&x)|0)+((L+A|0)+1518500249|0)|0,A=x,x=E,E=_<<30|_>>>2,_=p,p=k,c[u+f>>2]=L;for(f=u+64|0;(f|0)<(u+80|0);f=f+4|0)L=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,k=((p<<5|p>>>27)+(_&E|~_&x)|0)+((L+A|0)+1518500249|0)|0,A=x,x=E,E=_<<30|_>>>2,_=p,p=k,c[f>>2]=L;for(f=u+80|0;(f|0)<(u+160|0);f=f+4|0)L=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,k=((p<<5|p>>>27)+(_^E^x)|0)+((L+A|0)+1859775393|0)|0,A=x,x=E,E=_<<30|_>>>2,_=p,p=k,c[f>>2]=L;for(f=u+160|0;(f|0)<(u+240|0);f=f+4|0)L=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,k=((p<<5|p>>>27)+(_&E|_&x|E&x)|0)+((L+A|0)-1894007588|0)|0,A=x,x=E,E=_<<30|_>>>2,_=p,p=k,c[f>>2]=L;for(f=u+240|0;(f|0)<(u+320|0);f=f+4|0)L=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,k=((p<<5|p>>>27)+(_^E^x)|0)+((L+A|0)-899497514|0)|0,A=x,x=E,E=_<<30|_>>>2,_=p,p=k,c[f>>2]=L;p=p+g|0,_=_+v|0,E=E+T|0,x=x+N|0,A=A+I|0}c[h+320>>2]=p,c[h+324>>2]=_,c[h+328>>2]=E,c[h+332>>2]=x,c[h+336>>2]=A}return{hash:l}}},function(n,r){var i=this,s=void 0;typeof self<"u"&&typeof self.FileReaderSync<"u"&&(s=new self.FileReaderSync);var a=function(l,u,h,d,f,p){var g=void 0,_=p%4,v=(f+_)%4,E=f-v;switch(_){case 0:u[p]=l.charCodeAt(d+3);case 1:u[p+1-(_<<1)|0]=l.charCodeAt(d+2);case 2:u[p+2-(_<<1)|0]=l.charCodeAt(d+1);case 3:u[p+3-(_<<1)|0]=l.charCodeAt(d)}if(!(f<v+(4-_))){for(g=4-_;g<E;g=g+4|0)h[p+g>>2]=l.charCodeAt(d+g)<<24|l.charCodeAt(d+g+1)<<16|l.charCodeAt(d+g+2)<<8|l.charCodeAt(d+g+3);switch(v){case 3:u[p+E+1|0]=l.charCodeAt(d+E+2);case 2:u[p+E+2|0]=l.charCodeAt(d+E+1);case 1:u[p+E+3|0]=l.charCodeAt(d+E)}}},o=function(l,u,h,d,f,p){var g=void 0,_=p%4,v=(f+_)%4,E=f-v;switch(_){case 0:u[p]=l[d+3];case 1:u[p+1-(_<<1)|0]=l[d+2];case 2:u[p+2-(_<<1)|0]=l[d+1];case 3:u[p+3-(_<<1)|0]=l[d]}if(!(f<v+(4-_))){for(g=4-_;g<E;g=g+4|0)h[p+g>>2|0]=l[d+g]<<24|l[d+g+1]<<16|l[d+g+2]<<8|l[d+g+3];switch(v){case 3:u[p+E+1|0]=l[d+E+2];case 2:u[p+E+2|0]=l[d+E+1];case 1:u[p+E+3|0]=l[d+E]}}},c=function(l,u,h,d,f,p){var g=void 0,_=p%4,v=(f+_)%4,E=f-v,T=new Uint8Array(s.readAsArrayBuffer(l.slice(d,d+f)));switch(_){case 0:u[p]=T[3];case 1:u[p+1-(_<<1)|0]=T[2];case 2:u[p+2-(_<<1)|0]=T[1];case 3:u[p+3-(_<<1)|0]=T[0]}if(!(f<v+(4-_))){for(g=4-_;g<E;g=g+4|0)h[p+g>>2|0]=T[g]<<24|T[g+1]<<16|T[g+2]<<8|T[g+3];switch(v){case 3:u[p+E+1|0]=T[E+2];case 2:u[p+E+2|0]=T[E+1];case 1:u[p+E+3|0]=T[E]}}};n.exports=function(l,u,h,d,f,p){if(typeof l=="string")return a(l,u,h,d,f,p);if(l instanceof Array||i&&i.Buffer&&i.Buffer.isBuffer(l))return o(l,u,h,d,f,p);if(l instanceof ArrayBuffer)return o(new Uint8Array(l),u,h,d,f,p);if(l.buffer instanceof ArrayBuffer)return o(new Uint8Array(l.buffer,l.byteOffset,l.byteLength),u,h,d,f,p);if(l instanceof Blob)return c(l,u,h,d,f,p);throw new Error("Unsupported data type.")}},function(n,r,i){var s=function(){function h(d,f){for(var p=0;p<f.length;p++){var g=f[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}}return function(d,f,p){return f&&h(d.prototype,f),p&&h(d,p),d}}();function a(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var o=i(0),c=i(1),l=c.toHex,u=function(){function h(){a(this,h),this._rusha=new o,this._rusha.resetState()}return h.prototype.update=function(f){return this._rusha.append(f),this},h.prototype.digest=function(f){var p=this._rusha.rawEnd().buffer;if(!f)return p;if(f==="hex")return l(p);throw new Error("unsupported digest encoding")},s(h,[{key:"state",get:function(){return this._rusha.getState()},set:function(d){this._rusha.setState(d)}}]),h}();n.exports=function(){return new u}}])})})(BEe);var FEe=BEe.exports;const hbt=FEe;let XU,qP,$P;function dbt(){XU=hbt.createWorker(),qP=1,$P={},XU.onmessage=function(e){const n=e.data.id,r=$P[n];delete $P[n],e.data.error!=null?r(new Error("Rusha worker error: "+e.data.error)):r(null,e.data.hash)}}function fbt(t,e){XU||dbt(),$P[qP]=e,XU.postMessage({id:qP,data:t}),qP+=1}var pbt=fbt;const mbt=FEe,gbt=pbt,vbt=new mbt,zie=typeof window<"u"?window:self,Hie=zie.crypto||zie.msCrypto||{};let pM=Hie.subtle||Hie.webkitSubtle;function WP(t){return vbt.digest(t)}try{pM.digest({name:"sha-1"},new Uint8Array).catch(function(){pM=!1})}catch{pM=!1}function ybt(t,e){if(!pM){typeof window<"u"?gbt(t,function(r,i){if(r){e(WP(t));return}e(i)}):queueMicrotask(()=>e(WP(t)));return}typeof t=="string"&&(t=_bt(t)),pM.digest({name:"sha-1"},t).then(function(r){e(bbt(new Uint8Array(r)))},function(){e(WP(t))})}function _bt(t){const e=t.length,n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t.charCodeAt(r);return n}function bbt(t){const e=t.length,n=[];for(let r=0;r<e;r++){const i=t[r];n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")}fX.exports=ybt;fX.exports.sync=WP;var Ebt=fX.exports;const jie=ubt,Sbt=oz,Tbt=LI,xbt=Ebt,hA=az("p2pt"),Vie="^",Gie=16e3;class wbt extends Tbt{constructor(e=[],n=""){super(),this.announceURLs=e,this.trackers={},this.peers={},this.msgChunks={},this.responseWaiting={},n&&this.setIdentifier(n),this._peerIdBuffer=Sbt(20),this._peerId=this._peerIdBuffer.toString("hex"),this._peerIdBinary=this._peerIdBuffer.toString("binary"),hA("my peer id: "+this._peerId)}setIdentifier(e){this.identifierString=e,this.infoHash=xbt.sync(e).toLowerCase(),this._infoHashBuffer=kl.from(this.infoHash,"hex"),this._infoHashBinary=this._infoHashBuffer.toString("binary")}start(){this.on("peer",e=>{let n=!1;this.peers[e.id]||(n=!0,this.peers[e.id]={},this.responseWaiting[e.id]={}),e.on("connect",()=>{this.peers[e.id][e.channelName]=e,n&&this.emit("peerconnect",e)}),e.on("data",r=>{if(this.emit("data",e,r),r=r.toString(),hA("got a message from "+e.id),r[0]===Vie)try{r=JSON.parse(r.slice(1)),e.respond=this._peerRespond(e,r.id);let i=this._chunkHandler(r);i!==!1&&(r.o&&(i=JSON.parse(i)),this.responseWaiting[e.id][r.id]?(this.responseWaiting[e.id][r.id]([e,i]),delete this.responseWaiting[e.id][r.id]):this.emit("msg",e,i),this._destroyChunks(r.id))}catch(i){console.log(i)}}),e.on("error",r=>{this._removePeer(e),hA("Error in connection : "+r)}),e.on("close",()=>{this._removePeer(e),hA("Connection closed with "+e.id)})}),this.on("update",e=>{const n=this.trackers[this.announceURLs.indexOf(e.announce)];this.emit("trackerconnect",n,this.getTrackerStats())}),this.on("warning",e=>{this.emit("trackerwarning",e,this.getTrackerStats())}),this._fetchPeers()}addTracker(e){if(this.announceURLs.indexOf(e)!==-1)throw new Error("Tracker already added");const n=this.announceURLs.push(e);this.trackers[n]=new jie(this,e),this.trackers[n].announce(this._defaultAnnounceOpts())}removeTracker(e){const n=this.announceURLs.indexOf(e);if(n===-1)throw new Error("Tracker does not exist");this.trackers[n].peers=[],this.trackers[n].destroy(),delete this.trackers[n],delete this.announceURLs[n]}_removePeer(e){if(!this.peers[e.id])return!1;delete this.peers[e.id][e.channelName],Object.keys(this.peers[e.id]).length===0&&(this.emit("peerclose",e),delete this.responseWaiting[e.id],delete this.peers[e.id])}send(e,n,r=""){return new Promise((i,s)=>{const a={id:r!==""?r:Math.floor(Math.random()*1e5+1e5),msg:n};typeof n=="object"&&(a.msg=JSON.stringify(n),a.o=1);try{if(!e.connected){for(const l in this.peers[e.id])if(e=this.peers[e.id][l],e.connected)break}this.responseWaiting[e.id]||(this.responseWaiting[e.id]={}),this.responseWaiting[e.id][a.id]=i}catch(l){return s(Error("Connection to peer closed"+l))}let o=0,c="";for(;a.msg.length>0;)a.c=o,c=a.msg.slice(Gie),a.msg=a.msg.slice(0,Gie),c||(a.last=!0),e.send(Vie+JSON.stringify(a)),a.msg=c,o++;hA("sent a message to "+e.id)})}requestMorePeers(){return new Promise(e=>{for(const n in this.trackers)this.trackers[n].announce(this._defaultAnnounceOpts());e(this.peers)})}getTrackerStats(){let e=0;for(const n in this.trackers)this.trackers[n].socket&&this.trackers[n].socket.connected&&e++;return{connected:e,total:this.announceURLs.length}}destroy(){let e;for(e in this.peers)for(const n in this.peers[e])this.peers[e][n].destroy();for(e in this.trackers)this.trackers[e].destroy()}_peerRespond(e,n){return r=>this.send(e,r,n)}_chunkHandler(e){return this.msgChunks[e.id]||(this.msgChunks[e.id]=[]),this.msgChunks[e.id][e.c]=e.msg,e.last?this.msgChunks[e.id].join(""):!1}_destroyChunks(e){delete this.msgChunks[e]}_defaultAnnounceOpts(e={}){return e.numwant==null&&(e.numwant=50),e.uploaded==null&&(e.uploaded=0),e.downloaded==null&&(e.downloaded=0),e}_fetchPeers(){for(const e in this.announceURLs)this.trackers[e]=new jie(this,this.announceURLs[e]),this.trackers[e].announce(this._defaultAnnounceOpts())}}var Cbt=wbt;const Rbt=qc(Cbt),Abt=`
wss://tracker.btorrent.xyz
wss://tracker.webtorrent.dev
wss://tracker.openwebtorrent.com
`.split(`
`).map(t=>t.trim()).filter(t=>t);function dR(t){return ZM(t)}const Mbt="hubworld_6bc074b79dc8efad5cc1082e3b1caa2aeffa2990",np=new Rbt(Abt,Mbt),BI=new jyt(dR(np._peerId),{getId(t){return t.id}});np.on("peerconnect",t=>{wr(Ge,ni(),`remote connected ${t.id}`),BI.add({id:dR(t.id),peer:t})});np.on("peerclose",t=>{wr(Ge,ni(),`remote closed ${t.id}`),BI.remove(dR(t.id))});let YP="";const qie=new Map;np.on("msg",(t,e)=>{const n=Date.now(),r=qie.get(e.topic)??new Map;if("pub"in e){e.topic===YP&&(U_==null||U_.forward({...e.gme,session:Ge.session()}));for(const[i,s]of r)if(n-s>1e3*60)r.delete(i);else{const[o]=BI.listClosestToId(dR(i),1);ae(o)&&np.send(o.peer,e).catch(console.error)}}else"sub"in e&&(r.set(e.sub,n),e.topic===YP&&np._peerId===YP?(U_==null||U_.forward({...e.gme,session:Ge.session()}),Nbt()):ae(e.gme)&&jEe(e.topic,e.sub,e.gme));qie.set(e.topic,r)});np.on("trackerconnect",(t,e)=>{wr(Ge,ni(),`looking for players ${kPe(t.announceUrl)} [${e.connected}]`)});let $ie=!1,U_,zEe;function Obt(t){function e(){KDe(Ge,t)}e(),zEe=setInterval(e,5*1e3)}function Nbt(){clearInterval(zEe)}function HEe(t){$ie||($ie=!0,YP=t,np.start(),wr(Ge,ni(),`connecting to hubworld for ${t}`))}function Ibt(t,e){const[n]=BI.listClosestToId(dR(t),1);ae(n)&&np.send(n.peer,{topic:t,pub:!0,gme:e}).catch(()=>{})}function Wie(t,e){const n=np._peerId;HEe(n),RDe(Ge,ni(),t,n),e&&CDe(Ge,ni(),n),U_=N9(r=>{ost(r)&&ast(r)===!1&&Ibt(n,r)})}function jEe(t,e,n){const[r]=BI.listClosestToId(dR(t),1);ae(r)&&np.send(r.peer,{topic:t,sub:e,gme:n}).catch(console.error)}function kbt(t,e){HEe(t),U_=N9(n=>{c0e(n)&&cst()===!1&&jEe(t,np._peerId,n)}),setTimeout(()=>Obt(e),1e3)}let sg,eu;async function Dbt(t,e,n,r,i,s){let a;switch(ar(i)){case"get":{a=await fetch(r);break}case"post:json":{const l=[];for(let u=0;u<s.length;u+=2)l.push([s[u],s[u+1]]);a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(lDe(l))});break}}if(!(a!=null&&a.ok))return;const o=`fetch:${n}`,[c]=(a.headers.get("content-type")??"").split(";");switch(c){case"text/plain":{const l=await a.text();wr(Ge,t,JSON.stringify(l)),Ag(Ge,t,e,"text",o,l);break}case"application/json":{const l=await a.json();wr(Ge,t,JSON.stringify(l)),Ag(Ge,t,e,"json",o,l);break}case"application/octet-stream":{const l=await a.arrayBuffer();Ag(Ge,t,e,"binary",o,new Uint8Array(l));break}}}const Qs=Wb("bridge",[],t=>{if(!Qs.session(t))return;const e=ni();switch(t.target){default:if(t.player!==e)return;break}switch(t.target){case"fetch":if(Lr(t.data)){const[n,r,i,s,a]=t.data;qu(Ge,t.player,async()=>{await Dbt(t.player,n,r,i,s,a)})}break;case"start":Wie(!!t.data,!1);break;case"tab":Wie(!!t.data,!0);break;case"tabopen":On(t.data)&&window.open(`${location.origin}/join/#${t.data}`,"_blank","noopener,noreferrer");break;case"join":On(t.data)&&kbt(t.data,t.player);break;case"showjoincode":qu(Qs,t.player,async()=>{if(Lr(t.data)){const[n,r]=t.data,i=`${location.origin}/join/#${r}`,s=await rV(i);n?_2(Qs,t.player,s,"secret join url",!1):_2(Qs,t.player,s,s)}});break;case"talkstart":jmt();break;case"talkstop":Vmt();break;case"mediastart":qmt();break;case"mediastop":$mt();break;case"chatstart":ae(sg)?Hr(Qs,t.player,"bridge","chat is already started"):On(t.data)&&(wr(Qs,t.player,`connecting to ${t.data}`),sg=new WU({channels:[t.data]}),sg.connect(),sg.onConnect(()=>{wr(Qs,t.player,"connected")}),sg.onDisconnect(()=>{wr(Qs,t.player,"disconnected")}),sg.onMessage((n,r,i)=>{Ag(Qs,t.player,void 0,"text",`chat:message:${t.data}`,`${r}:${i}`)}),sg.onAction((n,r,i)=>{Ag(Qs,t.player,void 0,"text",`chat:action:${t.data}`,`${r}:${i}`)}));break;case"chatstop":ae(sg)?(sg.quit(),sg=void 0,wr(Qs,t.player,"chat stopped")):Hr(Qs,t.player,"bridge","chat is already stoped");break;case"streamstart":qu(Qs,t.player,async()=>{if(ae(eu))Hr(Qs,t.player,"bridge","stream is already open");else{const n=window.innerHeight>window.innerWidth;eu=pS.create({streamConfig:n?pS.STANDARD_PORTRAIT:pS.STANDARD_LANDSCAPE,logLevel:pS.LOG_LEVEL.DEBUG}),eu.on(pS.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(s){console.info({activestate:s})}),eu.on(pS.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(s){wr(Qs,t.player,s)}),eu.on(pS.BroadcastClientEvents.ERROR,function(s){Hr(Qs,t.player,"bridge",s),eu=void 0});const r=document.querySelector("canvas");if(ae(r))await eu.addImageSource(r,"video",{index:1});else{Hr(Qs,t.player,"video","unabled to find canvas element"),eu=void 0;return}const i=wft();if(ae(i))await eu.addAudioInputDevice(i.stream,"audio");else{Hr(Qs,t.player,"video","unable create media audio node destination"),eu=void 0;return}wr(Qs,t.player,"created client")}On(t.data)&&ae(eu)&&($p(Qs,t.player,"broadcasting in"),ci(Qs,t.player,"3","..."),await Gp(1e3),ci(Qs,t.player,"2","..."),await Gp(1e3),ci(Qs,t.player,"1","..."),await Gp(1e3),$p(Qs,t.player,"GOING LIVE"),await eu.startBroadcast(t.data,"https://g.webrtc.live-video.net:4443"))});break;case"streamstop":ae(eu)?(eu.stopBroadcast(),eu.delete(),eu=void 0,wr(Qs,t.player,"stream stopped")):Hr(Qs,t.player,"bridge","stream already stopped");break}});function Pbt(){const{viewport:t}=Zu(),{width:e,height:n}=t.getCurrentViewport(),[r]=Be.useState(()=>new Lft);Be.useEffect(()=>{if(!Uze)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;";const u=GOe(()=>r.begin()),h=qOe(()=>r.end());return()=>{document.body.removeChild(r.dom),u(),h()}},[r]);const i=jft(),a=Math.min(e,n)<600||zze;kn.DRAW_CHAR_SCALE=a?1:2;const o=e>n,c=Hze||kG==="touchOnly"||smt==="touch",l=!Fze&&!a&&!c&&i&&i.tier>2&&!i.isMobile;return Be.useEffect(()=>{Vh.setState(u=>({...u,islowrez:a,islandscape:o,showtouchcontrols:c}))},[a,o,c]),Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(cx,{children:Ae.jsxs(b0t,{children:[Ae.jsx(E0t,{}),Ae.jsx(rvt,{}),Ae.jsx(svt,{})]})}),l&&Ae.jsx(Jpt,{children:Ae.jsx(fmt,{viewheight:n})})]})}document.addEventListener("keydown",()=>{sE()});window.addEventListener("touchstart",()=>{sE()});window.addEventListener("click",()=>{sE()});window.addEventListener("dragover",t=>{t.preventDefault()});window.addEventListener("contextmenu",t=>{sE(),t.preventDefault()});window.addEventListener("paste",t=>{var n;if(!((n=t.clipboardData)!=null&&n.files.length))return;sE(),t.preventDefault(),[...t.clipboardData.files].forEach(r=>Ag(Ge,ni(),void 0,"file",`file:${r.name}`,r))});window.addEventListener("drop",t=>{var e,n;sE(),t.preventDefault(),(e=t.dataTransfer)!=null&&e.items?[...t.dataTransfer.items].forEach(i=>{if(i.kind==="file"){const s=i.getAsFile();ae(s)&&Ag(Ge,ni(),void 0,"file",s.name,s)}}):[...((n=t.dataTransfer)==null?void 0:n.files)??[]].forEach(i=>Ag(Ge,ni(),void 0,"file",i.name,i))});function Lbt(){return Ae.jsx(Pbt,{})}Lke();const PD=new Re,Yie=new Re,Ubt=t=>({...Foe(t),filter:e=>{const n=e.filter(a=>!(!a.object.visible||(a.object.userData.clippingPlanes??[]).some(c=>(c.projectPoint(a.point,PD),Yie.subVectors(a.point,PD).normalize().round(),PD.copy(c.normal).round(),PD.equals(Yie)===!1)))),r=n.findIndex(a=>a.object.userData.blocking),i=r===-1?n:n.slice(0,r+1);let s="default";return i.some(a=>a.object.userData.cursor?(s=a.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(a=>{a.style.cursor=s}),i}});let Mj;function Bbt(t,e){const n=document.getElementById("frame");if(!ae(n))return;const r=AZ(t),i=AZ(e);n.style.width=`${r}px`,n.style.height=`${i}px`,ae(Mj)||(Mj=kke.createRoot(n),Mj.render(Ae.jsx(ZOe,{flat:!0,linear:!0,shadows:!1,events:Ubt,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0},onCreated:({gl:s})=>{s.localClippingEnabled=!0},children:Ae.jsx(Lbt,{})})))}const VEe=eNe(Bbt,256);window.addEventListener("resize",()=>VEe(window.innerWidth,window.innerHeight));VEe(window.innerWidth,window.innerHeight);export{kl as B,JEt as a,pGe as b,Ll as c,zn as p,CT as r};

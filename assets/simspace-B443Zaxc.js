var Q$=Object.defineProperty;var tD=(fi,Jn,Fn)=>Jn in fi?Q$(fi,Jn,{enumerable:!0,configurable:!0,writable:!0,value:Fn}):fi[Jn]=Fn;var xt=(fi,Jn,Fn)=>tD(fi,typeof Jn!="symbol"?Jn+"":Jn,Fn);(function(){"use strict";const fi=new Set,Jn={emit(e,t,n,r,i){Jn.invoke(WE(e,t,n,r,i))},invoke(e){fi.forEach(t=>t.handle(e))},connect(e){fi.add(e)},disconnect(e){fi.delete(e)}};var Fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cE(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Kd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Fn,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Kd);var lE=Kd.exports,Hd=Fs(lE),Yd={};(function(e){var t=Fn&&Fn.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,b=l.addAdverb,k=b===void 0?!1:b,v=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),k?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Yd);var Vd=Fs(Yd);const uE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let hE=e=>crypto.getRandomValues(new Uint8Array(e)),fE=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Xd=(e,t=21)=>fE(e,t,hE),dE=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=uE[n[e]&63];return t};var qd="abcdefghijklmnopqrstuvwxyz",Jd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Zd="0123456789",pE="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",mE="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const gE=Zd,_E=qd,yE=Jd;var bE=gE+_E+yE,uu={lowercase:qd,uppercase:Jd,numbers:Zd,nolookalikes:pE,nolookalikesSafe:mE,alphanumeric:bE};function De(){return`sid_${dE(12).replaceAll("-",".")}`}Xd(uu.numbers,4),Xd(`${uu.numbers}${uu.lowercase}`,16);function bn(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function kE(){return Vd({capitalize:!1,adjectiveCount:1})}function wE(){return Vd({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var EE=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),xE=Object.prototype.hasOwnProperty;function hu(e,t){return xE.call(e,t)}function fu(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)hu(e,i)&&r.push(i);return r}function Bn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function du(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function ss(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Qd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function pu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(pu(e[t]))return!0}else if(typeof e=="object"){for(var r=fu(e),i=r.length,s=0;s<i;s++)if(pu(e[r[s]]))return!0}}return!1}function t0(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var e0=function(e){EE(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,t0(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=t0(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Fe=e0,vE=Bn,Bs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Wa(n,this.path);r&&(r=Bn(r));var i=os(n,{op:"remove",path:this.from}).removed;return os(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Wa(n,this.from);return os(n,{op:"add",path:this.path,value:Bn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Uo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},TE={add:function(e,t,n){return du(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Bs.move,copy:Bs.copy,test:Bs.test,_get:Bs._get};function Wa(e,t){if(t=="")return e;var n={op:"_get",path:t};return os(e,n),n.value}function os(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ga(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Wa(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Uo(e,t.value),o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Bn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Ga;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Qd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!du(h))throw new Fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);du(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=TE[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Bs[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function mu(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Bn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=os(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function AE(e,t,n){var r=os(e,t);if(r.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ga(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Bs[e.op]){if(typeof e.path!="string")throw new Fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&pu(e.value))throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=n0([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function n0(e,t,n){try{if(!Array.isArray(e))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)mu(Bn(t),Bn(e),n||!0);else{n=n||Ga;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Fe)return i;throw i}}function Uo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Uo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Uo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var SE=Object.freeze({__proto__:null,JsonPatchError:Fe,_areEquals:Uo,applyOperation:os,applyPatch:mu,applyReducer:AE,deepClone:vE,getValueByPointer:Wa,validate:n0,validator:Ga});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var gu=new WeakMap,RE=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),OE=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function NE(e){return gu.get(e)}function IE(e,t){return e.observers.get(t)}function CE(e,t){e.observers.delete(t.callback)}function LE(e,t){t.unobserve()}function ME(e,t){var n=[],r,i=NE(e);if(!i)i=new RE(e),gu.set(e,i);else{var s=IE(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Bn(e),t){r.callback=t,r.next=null;var o=function(){_u(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){_u(r),clearTimeout(r.next),CE(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new OE(t,r)),r}function _u(e,t){t===void 0&&(t=!1);var n=gu.get(e.object);yu(n.value,e.object,e.patches,"",t),e.patches.length&&mu(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function yu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=fu(t),o=fu(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(hu(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?yu(u,f,n,r+"/"+ss(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ss(l),value:Bn(u)}),n.push({op:"replace",path:r+"/"+ss(l),value:Bn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+ss(l),value:Bn(u)}),n.push({op:"remove",path:r+"/"+ss(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!hu(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+ss(l),value:Bn(t[l])})}}}function r0(e,t,n){n===void 0&&(n=!1);var r=[];return yu(e,t,r,"",n),r}var UE=Object.freeze({__proto__:null,compare:r0,generate:_u,observe:ME,unobserve:LE});Object.assign({},SE,UE,{JsonPatchError:e0,deepClone:Bn,escapePathComponent:ss,unescapePathComponent:Qd});var FE=typeof Element<"u",BE=typeof Map=="function",PE=typeof Set=="function",$E=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ka(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ka(e[r],t[r]))return!1;return!0}var s;if(BE&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ka(r.value[1],t.get(r.value[0])))return!1;return!0}if(PE&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if($E&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(FE&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ka(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var DE=function(t,n){try{return Ka(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},jE=Fs(DE);function y(e){return e!=null}const Zn=Object.keys;function Ar(e){return Bn(e)}function zE(e){return typeof e=="boolean"}function Et(e){return typeof e=="number"&&isNaN(e)===!1}function gt(e){return typeof e=="string"}function ue(e){return Array.isArray(e)}function bu(e){return e}var Lt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Lt||{}),zt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(zt||{}),Pn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Pn||{}),pt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(pt||{}),At=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(At||{});function It(e){return(e==null?void 0:e.toLowerCase().trim())??""}function WE(e,t,n,r,i){return{session:e,player:t,id:De(),sender:n,target:r,data:i}}function $n(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Ps(e,t=[],n=bu,r=""){const i=De(),s=It(e),o=t.map(It);let a=r;const c={id(){return i},name(){return e},session(l){return y(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){Jn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=$n(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&y(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Jn.connect(c),c}function GE(e){return typeof e=="object"&&gt(e.session)&&gt(e.player)&&gt(e.id)&&gt(e.sender)&&gt(e.target)}function de(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function KE(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function i0(e,t,n){e.emit(t,"toast",n)}function HE(e,t,n){e.emit(t,"bridge:streamstart",n)}function YE(e,t){e.emit(t,"bridge:streamstop",void 0)}function VE(e,t,n){e.emit(t,"bridge:chatstart",n)}function XE(e,t){e.emit(t,"bridge:chatstop")}function qE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function JE(e,t){e.emit(t,"bridge:talkstart",t)}function ZE(e,t){e.emit(t,"bridge:talkstop",t)}function QE(e,t){e.emit(t,"bridge:mediastart",t)}function tx(e,t){e.emit(t,"bridge:mediastop",t)}function ex(e,t,n){e.emit(t,"bridge:start",n)}function nx(e,t,n){e.emit(t,"bridge:tab",n)}function rx(e,t,n){e.emit(t,"gadgetclient:paint",n)}function ix(e,t,n){e.emit(t,"gadgetclient:patch",n)}function sx(e,t){e.emit(t,"gadgetserver:clearscroll")}function ox(e){e.emit("","ready")}function s0(e,t){e.emit(t,"register:loginfail")}function ku(e,t){e.emit(t,"register:loginready",!0)}function ax(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function cx(e,t,n){e.emit(t,"register:forkmem",[n])}function lx(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function wu(e,t,n){e.emit(t,"register:copy",n)}function ux(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function o0(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function hx(e,t){e.emit(t,"register:dev",void 0)}function fx(e,t){e.emit(t,"register:share",void 0)}function dx(e,t){e.emit(t,"register:nuke",void 0)}function px(e,t){e.emit(t,"register:enterar",void 0)}function mx(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function gx(e,t,n,r){e.emit(t,"synth:play",[n,r])}function _x(e,t,n,r,i){e.emit(t,"synth:bgplay",[n,r,i])}function yx(e,t,n){e.emit(t,"synth:focus",n)}function bx(e,t,n){e.emit(t,"synth:bpm",n)}function kx(e,t,n){e.emit(t,"synth:playvolume",n)}function wx(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function Ex(e,t,n){e.emit(t,"synth:ttsvolume",n)}function Eu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function a0(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function c0(e,t,n,r){e.emit(t,"register:config",[n,r])}function xx(e,t){e.emit(t,"register:configshow")}function vx(e,t){e.emit(t,"register:inspector")}function l0(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function Tx(e,t){e.emit(t,"vm:local")}function u0(e,t){e.emit(t,"vm:logout")}function Ha(e,t){const[n,r]=t;return`${e}:${[n,r].filter(y).join(":")}`}function Ax(e,t,n){e.emit(t,"vm:cli",n)}function Sx(e,t){e.emit(t,"vm:restart")}function h0(e,t){e.emit(t,"vm:flush")}function Rx(e,t){e.emit(t,"vm:fork")}function Ox(e,t){e.emit(t,"vm:itchiopublish")}function Nx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function Ix(e,t){return{filename:e,json:t}}function Cx(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function xu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=Nx(i,s);break;case"json":o=Ix(i,s);break;case"binary":o=Cx(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function Lx(e){const t=new Set;function n(s){GE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Jn.invoke(s))}const r=Ps("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Jn.disconnect(r)}return{forward:n,disconnect:i}}function Mx(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=$n(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const vu=66.666,Ya=Math.round(1e3/vu),f0=3;function d0(e){return new Promise(t=>setTimeout(t,e))}const Tu=Ps("clock");let Au=0,Va=0,Su=0,p0=performance.now();function m0(){const e=performance.now(),t=e-p0;Su+=t,Su>=vu&&(Su%=vu,Tu.emit("","tick",Va),Tu.emit("","tock",Va),++Au,++Va,Au>=Ya&&(Au%=Ya,Tu.emit("","second",Va))),p0=e,setTimeout(m0,2)}m0();function Ux(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var g0={exports:{}},je=g0.exports={},Wr,Gr;function Ru(){throw new Error("setTimeout has not been defined")}function Ou(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Wr=setTimeout:Wr=Ru}catch{Wr=Ru}try{typeof clearTimeout=="function"?Gr=clearTimeout:Gr=Ou}catch{Gr=Ou}})();function _0(e){if(Wr===setTimeout)return setTimeout(e,0);if((Wr===Ru||!Wr)&&setTimeout)return Wr=setTimeout,setTimeout(e,0);try{return Wr(e,0)}catch{try{return Wr.call(null,e,0)}catch{return Wr.call(this,e,0)}}}function Fx(e){if(Gr===clearTimeout)return clearTimeout(e);if((Gr===Ou||!Gr)&&clearTimeout)return Gr=clearTimeout,clearTimeout(e);try{return Gr(e)}catch{try{return Gr.call(null,e)}catch{return Gr.call(this,e)}}}var di=[],$s=!1,as,Xa=-1;function Bx(){!$s||!as||($s=!1,as.length?di=as.concat(di):Xa=-1,di.length&&y0())}function y0(){if(!$s){var e=_0(Bx);$s=!0;for(var t=di.length;t;){for(as=di,di=[];++Xa<t;)as&&as[Xa].run();Xa=-1,t=di.length}as=null,$s=!1,Fx(e)}}je.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];di.push(new b0(e,t)),di.length===1&&!$s&&_0(y0)};function b0(e,t){this.fun=e,this.array=t}b0.prototype.run=function(){this.fun.apply(null,this.array)},je.title="browser",je.browser=!0,je.env={},je.argv=[],je.version="",je.versions={};function pi(){}je.on=pi,je.addListener=pi,je.once=pi,je.off=pi,je.removeListener=pi,je.removeAllListeners=pi,je.emit=pi,je.prependListener=pi,je.prependOnceListener=pi,je.listeners=function(e){return[]},je.binding=function(e){throw new Error("process.binding is not supported")},je.cwd=function(){return"/"},je.chdir=function(e){throw new Error("process.chdir is not supported")},je.umask=function(){return 0};var Px=g0.exports;const Sr=Ux(Px);var Yt={},Nu=Symbol.for("react.transitional.element"),$x=Symbol.for("react.portal"),Dx=Symbol.for("react.fragment"),jx=Symbol.for("react.strict_mode"),zx=Symbol.for("react.profiler"),Wx=Symbol.for("react.consumer"),Gx=Symbol.for("react.context"),Kx=Symbol.for("react.forward_ref"),Hx=Symbol.for("react.suspense"),Yx=Symbol.for("react.memo"),k0=Symbol.for("react.lazy"),w0=Symbol.iterator;function Vx(e){return e===null||typeof e!="object"?null:(e=w0&&e[w0]||e["@@iterator"],typeof e=="function"?e:null)}var E0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x0=Object.assign,v0={};function Ds(e,t,n){this.props=e,this.context=t,this.refs=v0,this.updater=n||E0}Ds.prototype.isReactComponent={},Ds.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ds.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function T0(){}T0.prototype=Ds.prototype;function Iu(e,t,n){this.props=e,this.context=t,this.refs=v0,this.updater=n||E0}var Cu=Iu.prototype=new T0;Cu.constructor=Iu,x0(Cu,Ds.prototype),Cu.isPureReactComponent=!0;var A0=Array.isArray,ve={H:null,A:null,T:null,S:null,V:null},S0=Object.prototype.hasOwnProperty;function Lu(e,t,n,r,i,s){return n=s.ref,{$$typeof:Nu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function Xx(e,t){return Lu(e.type,t,void 0,void 0,void 0,e.props)}function Mu(e){return typeof e=="object"&&e!==null&&e.$$typeof===Nu}function qx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var R0=/\/+/g;function Uu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?qx(""+e.key):t.toString(36)}function O0(){}function Jx(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(O0,O0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function js(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Nu:case $x:o=!0;break;case k0:return o=e._init,js(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Uu(e,0):r,A0(i)?(n="",o!=null&&(n=o.replace(R0,"$&/")+"/"),js(i,t,n,"",function(l){return l})):i!=null&&(Mu(i)&&(i=Xx(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(R0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(A0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Uu(r,c),o+=js(r,t,n,s,i);else if(c=Vx(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Uu(r,c++),o+=js(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return js(Jx(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function qa(e,t,n){if(e==null)return e;var r=[],i=0;return js(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Zx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var N0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Sr=="object"&&typeof Sr.emit=="function"){Sr.emit("uncaughtException",e);return}console.error(e)};function Qx(){}Yt.Children={map:qa,forEach:function(e,t,n){qa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return qa(e,function(){t++}),t},toArray:function(e){return qa(e,function(t){return t})||[]},only:function(e){if(!Mu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=Ds,Yt.Fragment=Dx,Yt.Profiler=zx,Yt.PureComponent=Iu,Yt.StrictMode=jx,Yt.Suspense=Hx,Yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ve,Yt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return ve.H.useMemoCache(e)}},Yt.cache=function(e){return function(){return e.apply(null,arguments)}},Yt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=x0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!S0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Lu(e.type,i,void 0,void 0,s,r)},Yt.createContext=function(e){return e={$$typeof:Gx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:Wx,_context:e},e},Yt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)S0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Lu(e,s,void 0,void 0,null,i)},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:Kx,render:e}},Yt.isValidElement=Mu,Yt.lazy=function(e){return{$$typeof:k0,_payload:{_status:-1,_result:e},_init:Zx}},Yt.memo=function(e,t){return{$$typeof:Yx,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=ve.T,n={};ve.T=n;try{var r=e(),i=ve.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(Qx,N0)}catch(s){N0(s)}finally{ve.T=t}},Yt.unstable_useCacheRefresh=function(){return ve.H.useCacheRefresh()},Yt.use=function(e){return ve.H.use(e)},Yt.useActionState=function(e,t,n){return ve.H.useActionState(e,t,n)},Yt.useCallback=function(e,t){return ve.H.useCallback(e,t)},Yt.useContext=function(e){return ve.H.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e,t){return ve.H.useDeferredValue(e,t)},Yt.useEffect=function(e,t,n){var r=ve.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Yt.useId=function(){return ve.H.useId()},Yt.useImperativeHandle=function(e,t,n){return ve.H.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return ve.H.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return ve.H.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return ve.H.useMemo(e,t)},Yt.useOptimistic=function(e,t){return ve.H.useOptimistic(e,t)},Yt.useReducer=function(e,t,n){return ve.H.useReducer(e,t,n)},Yt.useRef=function(e){return ve.H.useRef(e)},Yt.useState=function(e){return ve.H.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return ve.H.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return ve.H.useTransition()},Yt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const I0="0123456789abcdef",C0=[],Ja=[];for(let e=0;e<256;e++)C0[e]=I0[e>>4&15]+I0[e&15],e<16&&(e<10?Ja[48+e]=e:Ja[87+e]=e);const L0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=C0[e[r++]];return n},Za=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=Ja[e.charCodeAt(s++)]<<4|Ja[e.charCodeAt(s++)];return r};for(var M0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tv=typeof Uint8Array>"u"?[]:new Uint8Array(256),Qa=0;Qa<M0.length;Qa++)tv[M0.charCodeAt(Qa)]=Qa;new TextDecoder,new TextEncoder;const U0=typeof window<"u"?window:self,F0=U0.crypto||U0.msCrypto||{};F0.subtle||F0.webkitSubtle;const zs=globalThis||void 0||self,Rr=()=>new Map,Fu=e=>{const t=Rr();return e.forEach((n,r)=>{t.set(r,n)}),t},Mi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},ev=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},nv=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},Ws=()=>new Set,Bu=e=>e[e.length-1],rv=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},cs=Array.from,iv=Array.isArray;class sv{constructor(){this._observers=Rr()}on(t,n){return Mi(this._observers,t,Ws).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return cs((this._observers.get(t)||Rr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Rr()}}const Ui=Math.floor,tc=Math.abs,B0=(e,t)=>e<t?e:t,ls=(e,t)=>e>t?e:t,P0=e=>e!==0?e<0:1/e<0,$0=1,D0=2,Pu=4,$u=8,Fo=32,mi=64,Qn=128,ec=31,Du=63,us=127,ov=2147483647,j0=Number.MAX_SAFE_INTEGER,av=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ui(e)===e),cv=e=>e.toLowerCase(),lv=/^\s*/g,uv=e=>e.replace(lv,""),hv=/([A-Z])/g,z0=(e,t)=>uv(e.replace(hv,n=>`${t}${cv(n)}`)),fv=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Bo=typeof TextEncoder<"u"?new TextEncoder:null,dv=Bo?e=>Bo.encode(e):fv;let Po=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Po&&Po.decode(new Uint8Array).length===1&&(Po=null);class $o{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const nc=()=>new $o,pv=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Kr=e=>{const t=new Uint8Array(pv(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},mv=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ls(n,t)*2),e.cpos=0)},sn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},ju=sn,se=(e,t)=>{for(;t>us;)sn(e,Qn|us&t),t=Ui(t/128);sn(e,us&t)},zu=(e,t)=>{const n=P0(t);for(n&&(t=-t),sn(e,(t>Du?Qn:0)|(n?mi:0)|Du&t),t=Ui(t/64);t>0;)sn(e,(t>us?Qn:0)|us&t),t=Ui(t/128)},Wu=new Uint8Array(3e4),gv=Wu.length/3,_v=(e,t)=>{if(t.length<gv){const n=Bo.encodeInto(t,Wu).written||0;se(e,n);for(let r=0;r<n;r++)sn(e,Wu[r])}else tr(e,dv(t))},yv=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;se(e,r);for(let i=0;i<r;i++)sn(e,n.codePointAt(i))},Gs=Bo&&Bo.encodeInto?_v:yv,rc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=B0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ls(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},tr=(e,t)=>{se(e,t.byteLength),rc(e,t)},Gu=(e,t)=>{mv(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},bv=(e,t)=>Gu(e,4).setFloat32(0,t,!1),kv=(e,t)=>Gu(e,8).setFloat64(0,t,!1),wv=(e,t)=>Gu(e,8).setBigInt64(0,t,!1),W0=new DataView(new ArrayBuffer(4)),Ev=e=>(W0.setFloat32(0,e),W0.getFloat32(0)===e),Do=(e,t)=>{switch(typeof t){case"string":sn(e,119),Gs(e,t);break;case"number":av(t)&&tc(t)<=ov?(sn(e,125),zu(e,t)):Ev(t)?(sn(e,124),bv(e,t)):(sn(e,123),kv(e,t));break;case"bigint":sn(e,122),wv(e,t);break;case"object":if(t===null)sn(e,126);else if(iv(t)){sn(e,117),se(e,t.length);for(let n=0;n<t.length;n++)Do(e,t[n])}else if(t instanceof Uint8Array)sn(e,116),tr(e,t);else{sn(e,118);const n=Object.keys(t);se(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Gs(e,i),Do(e,t[i])}}break;case"boolean":sn(e,t?120:121);break;default:sn(e,127)}};class G0 extends $o{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&se(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const K0=e=>{e.count>0&&(zu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&se(e.encoder,e.count-2))};class ic{constructor(){this.encoder=new $o,this.s=0,this.count=0}write(t){this.s===t?this.count++:(K0(this),this.count=1,this.s=t)}toUint8Array(){return K0(this),Kr(this.encoder)}}const H0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);zu(e.encoder,t),e.count>1&&se(e.encoder,e.count-2)}};class Ku{constructor(){this.encoder=new $o,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(H0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return H0(this),Kr(this.encoder)}}class xv{constructor(){this.sarr=[],this.s="",this.lensE=new ic}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new $o;return this.sarr.push(this.s),this.s="",Gs(t,this.sarr.join("")),rc(t,this.lensE.toUint8Array()),Kr(t)}}const Fi=e=>new Error(e),Hr=()=>{throw Fi("Method unimplemented")},Yr=()=>{throw Fi("Unexpected case")},Y0=Fi("Unexpected end of array"),V0=Fi("Integer out of Range");class sc{constructor(t){this.arr=t,this.pos=0}}const Ks=e=>new sc(e),vv=e=>e.pos!==e.arr.length,Tv=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},er=e=>Tv(e,Xt(e)),Hs=e=>e.arr[e.pos++],Xt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&us)*n,n*=128,i<Qn)return t;if(t>j0)throw V0}throw Y0},Hu=e=>{let t=e.arr[e.pos++],n=t&Du,r=64;const i=(t&mi)>0?-1:1;if(!(t&Qn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&us)*r,r*=128,t<Qn)return i*n;if(n>j0)throw V0}throw Y0},Ys=Po?e=>Po.decode(er(e)):e=>{let t=Xt(e);if(t===0)return"";{let n=String.fromCodePoint(Hs(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Hs(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Yu=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Av=[e=>{},e=>null,Hu,e=>Yu(e,4).getFloat32(0,!1),e=>Yu(e,8).getFloat64(0,!1),e=>Yu(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Ys,e=>{const t=Xt(e),n={};for(let r=0;r<t;r++){const i=Ys(e);n[i]=jo(e)}return n},e=>{const t=Xt(e),n=[];for(let r=0;r<t;r++)n.push(jo(e));return n},er],jo=e=>Av[127-Hs(e)](e);class X0 extends sc{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),vv(this)?this.count=Xt(this)+1:this.count=-1),this.count--,this.s}}class oc extends sc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Hu(this);const t=P0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Xt(this)+2)}return this.count--,this.s}}class Vu extends sc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=Hu(this),n=t&1;this.diff=Ui(t/2),this.count=1,n&&(this.count=Xt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Sv{constructor(t){this.decoder=new oc(t),this.str=Ys(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Rv=crypto.getRandomValues.bind(crypto),q0=()=>Rv(new Uint32Array(1))[0],Ov="10000000-1000-4000-8000"+-1e11,Nv=()=>Ov.replace(/[018]/g,e=>(e^q0()&15>>e/4).toString(16)),J0=e=>new Promise(e);Promise.all.bind(Promise);var Z0={},ac={};ac.byteLength=Lv,ac.toByteArray=Uv,ac.fromByteArray=Pv;for(var Vr=[],ur=[],Iv=typeof Uint8Array<"u"?Uint8Array:Array,Xu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vs=0,Cv=Xu.length;Vs<Cv;++Vs)Vr[Vs]=Xu[Vs],ur[Xu.charCodeAt(Vs)]=Vs;ur[45]=62,ur[95]=63;function Q0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Lv(e){var t=Q0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Mv(e,t,n){return(t+n)*3/4-n}function Uv(e){var t,n=Q0(e),r=n[0],i=n[1],s=new Iv(Mv(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=ur[e.charCodeAt(c)]<<18|ur[e.charCodeAt(c+1)]<<12|ur[e.charCodeAt(c+2)]<<6|ur[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=ur[e.charCodeAt(c)]<<2|ur[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=ur[e.charCodeAt(c)]<<10|ur[e.charCodeAt(c+1)]<<4|ur[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Fv(e){return Vr[e>>18&63]+Vr[e>>12&63]+Vr[e>>6&63]+Vr[e&63]}function Bv(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Fv(r));return i.join("")}function Pv(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Bv(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Vr[t>>2]+Vr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Vr[t>>10]+Vr[t>>4&63]+Vr[t<<2&63]+"=")),i.join("")}var qu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */qu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},qu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=ac,n=qu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=L,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,_){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,_)}u.poolSize=8192;function f(R,g,_){if(typeof R=="string")return p(R,g);if(o.isView(R))return k(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(mt(R,o)||R&&mt(R.buffer,o)||typeof a<"u"&&(mt(R,a)||R&&mt(R.buffer,a)))return v(R,g,_);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const U=R.valueOf&&R.valueOf();if(U!=null&&U!==R)return u.from(U,g,_);const G=T(R);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,_){return f(R,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,_){return d(R),R<=0?l(R):g!==void 0?typeof _=="string"?l(R).fill(g,_):l(R).fill(g):l(R)}u.alloc=function(R,g,_){return h(R,g,_)};function m(R){return d(R),l(R<0?0:A(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=S(R,g)|0;let U=l(_);const G=U.write(R,g);return G!==_&&(U=U.slice(0,G)),U}function b(R){const g=R.length<0?0:A(R.length)|0,_=l(g);for(let U=0;U<g;U+=1)_[U]=R[U]&255;return _}function k(R){if(mt(R,s)){const g=new s(R);return v(g.buffer,g.byteOffset,g.byteLength)}return b(R)}function v(R,g,_){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let U;return g===void 0&&_===void 0?U=new s(R):_===void 0?U=new s(R,g):U=new s(R,g,_),Object.setPrototypeOf(U,u.prototype),U}function T(R){if(u.isBuffer(R)){const g=A(R.length)|0,_=l(g);return _.length===0||R.copy(_,0,0,g),_}if(R.length!==void 0)return typeof R.length!="number"||Nt(R.length)?l(0):b(R);if(R.type==="Buffer"&&Array.isArray(R.data))return b(R.data)}function A(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function L(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),mt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let U=g.length,G=_.length;for(let et=0,ct=Math.min(U,G);et<ct;++et)if(g[et]!==_[et]){U=g[et],G=_[et];break}return U<G?-1:G<U?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let U;if(_===void 0)for(_=0,U=0;U<g.length;++U)_+=g[U].length;const G=u.allocUnsafe(_);let et=0;for(U=0;U<g.length;++U){let ct=g[U];if(mt(ct,s))et+ct.length>G.length?(u.isBuffer(ct)||(ct=u.from(ct)),ct.copy(G,et)):s.prototype.set.call(G,ct,et);else if(u.isBuffer(ct))ct.copy(G,et);else throw new TypeError('"list" argument must be an Array of Buffers');et+=ct.length}return G};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||mt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const _=R.length,U=arguments.length>2&&arguments[2]===!0;if(!U&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return _t(R).length;default:if(G)return U?-1:ht(R).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=S;function I(R,g,_){let U=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return D(this,g,_);case"utf8":case"utf-8":return F(this,g,_);case"ascii":return st(this,g,_);case"latin1":case"binary":return W(this,g,_);case"base64":return P(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yt(this,g,_);default:if(U)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),U=!0}}u.prototype._isBuffer=!0;function $(R,g,_){const U=R[g];R[g]=R[_],R[_]=U}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)$(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)$(this,_,_+3),$(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)$(this,_,_+7),$(this,_+1,_+6),$(this,_+2,_+5),$(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?F(this,0,g):I.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,U,G,et){if(mt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),U===void 0&&(U=g?g.length:0),G===void 0&&(G=0),et===void 0&&(et=this.length),_<0||U>g.length||G<0||et>this.length)throw new RangeError("out of range index");if(G>=et&&_>=U)return 0;if(G>=et)return-1;if(_>=U)return 1;if(_>>>=0,U>>>=0,G>>>=0,et>>>=0,this===g)return 0;let ct=et-G,Ht=U-_;const Ie=Math.min(ct,Ht),we=this.slice(G,et),Ce=g.slice(_,U);for(let he=0;he<Ie;++he)if(we[he]!==Ce[he]){ct=we[he],Ht=Ce[he];break}return ct<Ht?-1:Ht<ct?1:0};function N(R,g,_,U,G){if(R.length===0)return-1;if(typeof _=="string"?(U=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Nt(_)&&(_=G?0:R.length-1),_<0&&(_=R.length+_),_>=R.length){if(G)return-1;_=R.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,U)),u.isBuffer(g))return g.length===0?-1:z(R,g,_,U,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(R,g,_):s.prototype.lastIndexOf.call(R,g,_):z(R,[g],_,U,G);throw new TypeError("val must be string, number or Buffer")}function z(R,g,_,U,G){let et=1,ct=R.length,Ht=g.length;if(U!==void 0&&(U=String(U).toLowerCase(),U==="ucs2"||U==="ucs-2"||U==="utf16le"||U==="utf-16le")){if(R.length<2||g.length<2)return-1;et=2,ct/=2,Ht/=2,_/=2}function Ie(Ce,he){return et===1?Ce[he]:Ce.readUInt16BE(he*et)}let we;if(G){let Ce=-1;for(we=_;we<ct;we++)if(Ie(R,we)===Ie(g,Ce===-1?0:we-Ce)){if(Ce===-1&&(Ce=we),we-Ce+1===Ht)return Ce*et}else Ce!==-1&&(we-=we-Ce),Ce=-1}else for(_+Ht>ct&&(_=ct-Ht),we=_;we>=0;we--){let Ce=!0;for(let he=0;he<Ht;he++)if(Ie(R,we+he)!==Ie(g,he)){Ce=!1;break}if(Ce)return we}return-1}u.prototype.includes=function(g,_,U){return this.indexOf(g,_,U)!==-1},u.prototype.indexOf=function(g,_,U){return N(this,g,_,U,!0)},u.prototype.lastIndexOf=function(g,_,U){return N(this,g,_,U,!1)};function J(R,g,_,U){_=Number(_)||0;const G=R.length-_;U?(U=Number(U),U>G&&(U=G)):U=G;const et=g.length;U>et/2&&(U=et/2);let ct;for(ct=0;ct<U;++ct){const Ht=parseInt(g.substr(ct*2,2),16);if(Nt(Ht))return ct;R[_+ct]=Ht}return ct}function M(R,g,_,U){return vt(ht(g,R.length-_),R,_,U)}function O(R,g,_,U){return vt(dt(g),R,_,U)}function E(R,g,_,U){return vt(_t(g),R,_,U)}function C(R,g,_,U){return vt(Q(g,R.length-_),R,_,U)}u.prototype.write=function(g,_,U,G){if(_===void 0)G="utf8",U=this.length,_=0;else if(U===void 0&&typeof _=="string")G=_,U=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(U)?(U=U>>>0,G===void 0&&(G="utf8")):(G=U,U=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const et=this.length-_;if((U===void 0||U>et)&&(U=et),g.length>0&&(U<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ct=!1;for(;;)switch(G){case"hex":return J(this,g,_,U);case"utf8":case"utf-8":return M(this,g,_,U);case"ascii":case"latin1":case"binary":return O(this,g,_,U);case"base64":return E(this,g,_,U);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,g,_,U);default:if(ct)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ct=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(R,g,_){return g===0&&_===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,_))}function F(R,g,_){_=Math.min(R.length,_);const U=[];let G=g;for(;G<_;){const et=R[G];let ct=null,Ht=et>239?4:et>223?3:et>191?2:1;if(G+Ht<=_){let Ie,we,Ce,he;switch(Ht){case 1:et<128&&(ct=et);break;case 2:Ie=R[G+1],(Ie&192)===128&&(he=(et&31)<<6|Ie&63,he>127&&(ct=he));break;case 3:Ie=R[G+1],we=R[G+2],(Ie&192)===128&&(we&192)===128&&(he=(et&15)<<12|(Ie&63)<<6|we&63,he>2047&&(he<55296||he>57343)&&(ct=he));break;case 4:Ie=R[G+1],we=R[G+2],Ce=R[G+3],(Ie&192)===128&&(we&192)===128&&(Ce&192)===128&&(he=(et&15)<<18|(Ie&63)<<12|(we&63)<<6|Ce&63,he>65535&&he<1114112&&(ct=he))}}ct===null?(ct=65533,Ht=1):ct>65535&&(ct-=65536,U.push(ct>>>10&1023|55296),ct=56320|ct&1023),U.push(ct),G+=Ht}return tt(U)}const ot=4096;function tt(R){const g=R.length;if(g<=ot)return String.fromCharCode.apply(String,R);let _="",U=0;for(;U<g;)_+=String.fromCharCode.apply(String,R.slice(U,U+=ot));return _}function st(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]&127);return U}function W(R,g,_){let U="";_=Math.min(R.length,_);for(let G=g;G<_;++G)U+=String.fromCharCode(R[G]);return U}function D(R,g,_){const U=R.length;(!g||g<0)&&(g=0),(!_||_<0||_>U)&&(_=U);let G="";for(let et=g;et<_;++et)G+=fe[R[et]];return G}function yt(R,g,_){const U=R.slice(g,_);let G="";for(let et=0;et<U.length-1;et+=2)G+=String.fromCharCode(U[et]+U[et+1]*256);return G}u.prototype.slice=function(g,_){const U=this.length;g=~~g,_=_===void 0?U:~~_,g<0?(g+=U,g<0&&(g=0)):g>U&&(g=U),_<0?(_+=U,_<0&&(_=0)):_>U&&(_=U),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function X(R,g,_){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],et=1,ct=0;for(;++ct<_&&(et*=256);)G+=this[g+ct]*et;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g+--_],et=1;for(;_>0&&(et*=256);)G+=this[g+--_]*et;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||X(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=jt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,et=this[++g]+this[++g]*2**8+this[++g]*2**16+U*2**24;return BigInt(G)+(BigInt(et)<<BigInt(32))}),u.prototype.readBigUInt64BE=jt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],et=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U;return(BigInt(G)<<BigInt(32))+BigInt(et)}),u.prototype.readIntLE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=this[g],et=1,ct=0;for(;++ct<_&&(et*=256);)G+=this[g+ct]*et;return et*=128,G>=et&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,U){g=g>>>0,_=_>>>0,U||X(g,_,this.length);let G=_,et=1,ct=this[g+--G];for(;G>0&&(et*=256);)ct+=this[g+--G]*et;return et*=128,ct>=et&&(ct-=Math.pow(2,8*_)),ct},u.prototype.readInt8=function(g,_){return g=g>>>0,_||X(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g]|this[g+1]<<8;return U&32768?U|4294901760:U},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||X(g,2,this.length);const U=this[g+1]|this[g]<<8;return U&32768?U|4294901760:U},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||X(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=jt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(U<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=jt(function(g){g=g>>>0,rt(g,"offset");const _=this[g],U=this[g+7];(_===void 0||U===void 0)&&j(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+U)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||X(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||X(g,8,this.length),n.read(this,g,!1,52,8)};function at(R,g,_,U,G,et){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<et)throw new RangeError('"value" argument is out of bounds');if(_+U>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Ht=Math.pow(2,8*U)-1;at(this,g,_,U,Ht,0)}let et=1,ct=0;for(this[_]=g&255;++ct<U&&(et*=256);)this[_+ct]=g/et&255;return _+U},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,U=U>>>0,!G){const Ht=Math.pow(2,8*U)-1;at(this,g,_,U,Ht,0)}let et=U-1,ct=1;for(this[_+et]=g&255;--et>=0&&(ct*=256);)this[_+et]=g/ct&255;return _+U},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function Bt(R,g,_,U,G){lt(g,U,G,R,_,7);let et=Number(g&BigInt(4294967295));R[_++]=et,et=et>>8,R[_++]=et,et=et>>8,R[_++]=et,et=et>>8,R[_++]=et;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,ct=ct>>8,R[_++]=ct,_}function Wt(R,g,_,U,G){lt(g,U,G,R,_,7);let et=Number(g&BigInt(4294967295));R[_+7]=et,et=et>>8,R[_+6]=et,et=et>>8,R[_+5]=et,et=et>>8,R[_+4]=et;let ct=Number(g>>BigInt(32)&BigInt(4294967295));return R[_+3]=ct,ct=ct>>8,R[_+2]=ct,ct=ct>>8,R[_+1]=ct,ct=ct>>8,R[_]=ct,_+8}u.prototype.writeBigUInt64LE=jt(function(g,_=0){return Bt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=jt(function(g,_=0){return Wt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);at(this,g,_,U,Ie-1,-Ie)}let et=0,ct=1,Ht=0;for(this[_]=g&255;++et<U&&(ct*=256);)g<0&&Ht===0&&this[_+et-1]!==0&&(Ht=1),this[_+et]=(g/ct>>0)-Ht&255;return _+U},u.prototype.writeIntBE=function(g,_,U,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*U-1);at(this,g,_,U,Ie-1,-Ie)}let et=U-1,ct=1,Ht=0;for(this[_+et]=g&255;--et>=0&&(ct*=256);)g<0&&Ht===0&&this[_+et+1]!==0&&(Ht=1),this[_+et]=(g/ct>>0)-Ht&255;return _+U},u.prototype.writeInt8=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,U){return g=+g,_=_>>>0,U||at(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=jt(function(g,_=0){return Bt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=jt(function(g,_=0){return Wt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Dt(R,g,_,U,G,et){if(_+U>R.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Pt(R,g,_,U,G){return g=+g,_=_>>>0,G||Dt(R,g,_,4),n.write(R,g,_,U,23,4),_+4}u.prototype.writeFloatLE=function(g,_,U){return Pt(this,g,_,!0,U)},u.prototype.writeFloatBE=function(g,_,U){return Pt(this,g,_,!1,U)};function le(R,g,_,U,G){return g=+g,_=_>>>0,G||Dt(R,g,_,8),n.write(R,g,_,U,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,U){return le(this,g,_,!0,U)},u.prototype.writeDoubleBE=function(g,_,U){return le(this,g,_,!1,U)},u.prototype.copy=function(g,_,U,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(U||(U=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<U&&(G=U),G===U||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(U<0||U>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-U&&(G=g.length-_+U);const et=G-U;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,U,G):s.prototype.set.call(g,this.subarray(U,G),_),et},u.prototype.fill=function(g,_,U,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,U=this.length):typeof U=="string"&&(G=U,U=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ct=g.charCodeAt(0);(G==="utf8"&&ct<128||G==="latin1")&&(g=ct)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<U)throw new RangeError("Out of range index");if(U<=_)return this;_=_>>>0,U=U===void 0?this.length:U>>>0,g||(g=0);let et;if(typeof g=="number")for(et=_;et<U;++et)this[et]=g;else{const ct=u.isBuffer(g)?g:u.from(g,G),Ht=ct.length;if(Ht===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(et=0;et<U-_;++et)this[et+_]=ct[et%Ht]}return this};const qt={};function Ne(R,g,_){qt[R]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Ne("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ne("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Ne("ERR_OUT_OF_RANGE",function(R,g,_){let U=`The value of "${R}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=$e(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=$e(G)),G+="n"),U+=` It must be ${g}. Received ${G}`,U},RangeError);function $e(R){let g="",_=R.length;const U=R[0]==="-"?1:0;for(;_>=U+4;_-=3)g=`_${R.slice(_-3,_)}${g}`;return`${R.slice(0,_)}${g}`}function x(R,g,_){rt(g,"offset"),(R[g]===void 0||R[g+_]===void 0)&&j(g,R.length-(_+1))}function lt(R,g,_,U,G,et){if(R>_||R<g){const ct=typeof g=="bigint"?"n":"";let Ht;throw g===0||g===BigInt(0)?Ht=`>= 0${ct} and < 2${ct} ** ${(et+1)*8}${ct}`:Ht=`>= -(2${ct} ** ${(et+1)*8-1}${ct}) and < 2 ** ${(et+1)*8-1}${ct}`,new qt.ERR_OUT_OF_RANGE("value",Ht,R)}x(U,G,et)}function rt(R,g){if(typeof R!="number")throw new qt.ERR_INVALID_ARG_TYPE(g,"number",R)}function j(R,g,_){throw Math.floor(R)!==R?(rt(R,_),new qt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new qt.ERR_BUFFER_OUT_OF_BOUNDS:new qt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const B=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(B,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let _;const U=R.length;let G=null;const et=[];for(let ct=0;ct<U;++ct){if(_=R.charCodeAt(ct),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&et.push(239,191,189);continue}else if(ct+1===U){(g-=3)>-1&&et.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&et.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&et.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;et.push(_)}else if(_<2048){if((g-=2)<0)break;et.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;et.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;et.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return et}function dt(R){const g=[];for(let _=0;_<R.length;++_)g.push(R.charCodeAt(_)&255);return g}function Q(R,g){let _,U,G;const et=[];for(let ct=0;ct<R.length&&!((g-=2)<0);++ct)_=R.charCodeAt(ct),U=_>>8,G=_%256,et.push(G),et.push(U);return et}function _t(R){return t.toByteArray(V(R))}function vt(R,g,_,U){let G;for(G=0;G<U&&!(G+_>=g.length||G>=R.length);++G)g[G+_]=R[G];return G}function mt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function Nt(R){return R!==R}const fe=function(){const R="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const U=_*16;for(let G=0;G<16;++G)g[U+G]=R[_]+R[G]}return g}();function jt(R){return typeof BigInt>"u"?qn:R}function qn(){throw new Error("BigInt not supported")}})(Z0);const pn=Z0.Buffer,tp=e=>e===void 0?null:e;class $v{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ep=new $v,Dv=!0;try{typeof localStorage<"u"&&localStorage&&(ep=localStorage,Dv=!1)}catch{}const jv=ep,zv=Object.assign,Wv=Object.keys,Gv=(e,t)=>{for(const n in e)t(e[n],n)},np=e=>Wv(e).length,Kv=e=>{for(const t in e)return!1;return!0},Hv=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Yv=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Vv=(e,t)=>e===t||np(e)===np(t)&&Hv(e,(n,r)=>(n!==void 0||Yv(t,r))&&t[r]===n),Xv=Object.freeze,rp=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&rp(e[t])}return Xv(e)},Ju=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Ju(e,t,n+1)}},qv=e=>e,Jv=(e,t)=>t.includes(e);var ip={};const zo=typeof Sr<"u"&&Sr.release&&/node|io\.js/.test(Sr.release.name)&&Object.prototype.toString.call(typeof Sr<"u"?Sr:0)==="[object process]";let Xr;const Zv=()=>{if(Xr===void 0)if(zo){Xr=Rr();const e=Sr.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Xr.set(t,""),t=r):t!==null&&(Xr.set(t,r),t=null)}t!==null&&Xr.set(t,"")}else typeof location=="object"?(Xr=Rr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Xr.set(`--${z0(t,"-")}`,n),Xr.set(`-${z0(t,"-")}`,n)}})):Xr=Rr();return Xr},Zu=e=>Zv().has(e),cc=e=>tp(zo?ip[e.toUpperCase().replaceAll("-","_")]:jv.getItem(e)),sp=e=>Zu("--"+e)||cc(e)!==null;sp("production");const Qv=zo&&Jv(ip.FORCE_COLOR,["true","1","2"])||!Zu("--no-colors")&&!sp("no-color")&&(!zo||Sr.stdout.isTTY)&&(!zo||Zu("--color")||cc("COLORTERM")!==null||(cc("TERM")||"").includes("color")),tT=e=>new Uint8Array(e),eT=e=>{const t=tT(e.byteLength);return t.set(e),t};class nT{constructor(t,n){this.left=t,this.right=n}}const gi=(e,t)=>new nT(e,t);typeof DOMParser<"u"&&new DOMParser;const rT=e=>ev(e,(t,n)=>`${n}:${t};`).join(""),_i=Symbol,op=_i(),ap=_i(),iT=_i(),sT=_i(),oT=_i(),cp=_i(),aT=_i(),Qu=_i(),cT=_i(),lT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},uT={[op]:gi("font-weight","bold"),[ap]:gi("font-weight","normal"),[iT]:gi("color","blue"),[oT]:gi("color","green"),[sT]:gi("color","grey"),[cp]:gi("color","red"),[aT]:gi("color","purple"),[Qu]:gi("color","orange"),[cT]:gi("color","black")},lp=Qv?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Rr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=uT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=rT(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:lT,hT=(...e)=>{console.log(...lp(e)),up.forEach(t=>t.print(e))},fT=(...e)=>{console.warn(...lp(e)),e.unshift(Qu),up.forEach(t=>t.print(e))},up=Ws(),hp=e=>({[Symbol.iterator](){return this},next:e}),dT=(e,t)=>hp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),th=(e,t)=>hp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class eh{constructor(t,n){this.clock=t,this.len=n}}class Wo{constructor(){this.clients=new Map}}const fp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Rp(e,s,a.clock,a.len,n)}}),pT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ui((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},dp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&pT(n,t.clock)!==null},nh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=ls(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},mT=e=>{const t=new Wo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)rv(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return nh(t),t},lc=(e,t,n,r)=>{Mi(e.clients,t,()=>[]).push(new eh(n,r))},gT=()=>new Wo,_T=e=>{const t=gT();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new eh(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Xs=(e,t)=>{se(e.restEncoder,t.clients.size),cs(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),se(e.restEncoder,n);const i=r.length;se(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},rh=e=>{const t=new Wo,n=Xt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Xt(e.restDecoder),s=Xt(e.restDecoder);if(s>0){const o=Mi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new eh(e.readDsClock(),e.readDsLen()))}}return t},pp=(e,t,n)=>{const r=new Wo,i=Xt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Xt(e.restDecoder),a=Xt(e.restDecoder),c=n.clients.get(o)||[],l=on(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&lc(r,o,l,d-l);let h=qr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,xc(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,xc(t,m,d-m.id.clock)),m.delete(t))}else lc(r,o,f,d-f)}}if(r.clients.size>0){const s=new hs;return se(s.restEncoder,0),Xs(s,r),s.toUint8Array()}return null},mp=q0;class qs extends sv{constructor({guid:t=Nv(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=mp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Tp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=J0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>J0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&pe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(cs(this.subdocs).map(t=>t.guid))}transact(t,n=null){return pe(this,t,n)}get(t,n=mn){const r=Mi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==mn&&i!==n)if(i===mn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,to)}getText(t=""){return this.get(t,yi)}getMap(t=""){return this.get(t,eo)}getXmlElement(t=""){return this.get(t,ro)}getXmlFragment(t=""){return this.get(t,fs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,cs(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new qs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,pe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class gp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Xt(this.restDecoder)}readDsLen(){return Xt(this.restDecoder)}}class _p extends gp{readLeftID(){return Qt(Xt(this.restDecoder),Xt(this.restDecoder))}readRightID(){return Qt(Xt(this.restDecoder),Xt(this.restDecoder))}readClient(){return Xt(this.restDecoder)}readInfo(){return Hs(this.restDecoder)}readString(){return Ys(this.restDecoder)}readParentInfo(){return Xt(this.restDecoder)===1}readTypeRef(){return Xt(this.restDecoder)}readLen(){return Xt(this.restDecoder)}readAny(){return jo(this.restDecoder)}readBuf(){return eT(er(this.restDecoder))}readJSON(){return JSON.parse(Ys(this.restDecoder))}readKey(){return Ys(this.restDecoder)}}class yT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Xt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Xt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Js extends yT{constructor(t){super(t),this.keys=[],Xt(t),this.keyClockDecoder=new Vu(er(t)),this.clientDecoder=new oc(er(t)),this.leftClockDecoder=new Vu(er(t)),this.rightClockDecoder=new Vu(er(t)),this.infoDecoder=new X0(er(t),Hs),this.stringDecoder=new Sv(er(t)),this.parentInfoDecoder=new X0(er(t),Hs),this.typeRefDecoder=new oc(er(t)),this.lenDecoder=new oc(er(t))}readLeftID(){return new Zs(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Zs(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return jo(this.restDecoder)}readBuf(){return er(this.restDecoder)}readJSON(){return jo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class bT{constructor(){this.restEncoder=nc()}toUint8Array(){return Kr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){se(this.restEncoder,t)}writeDsLen(t){se(this.restEncoder,t)}}class Go extends bT{writeLeftID(t){se(this.restEncoder,t.client),se(this.restEncoder,t.clock)}writeRightID(t){se(this.restEncoder,t.client),se(this.restEncoder,t.clock)}writeClient(t){se(this.restEncoder,t)}writeInfo(t){ju(this.restEncoder,t)}writeString(t){Gs(this.restEncoder,t)}writeParentInfo(t){se(this.restEncoder,t?1:0)}writeTypeRef(t){se(this.restEncoder,t)}writeLen(t){se(this.restEncoder,t)}writeAny(t){Do(this.restEncoder,t)}writeBuf(t){tr(this.restEncoder,t)}writeJSON(t){Gs(this.restEncoder,JSON.stringify(t))}writeKey(t){Gs(this.restEncoder,t)}}class kT{constructor(){this.restEncoder=nc(),this.dsCurrVal=0}toUint8Array(){return Kr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,se(this.restEncoder,n)}writeDsLen(t){t===0&&Yr(),se(this.restEncoder,t-1),this.dsCurrVal+=t}}class hs extends kT{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ku,this.clientEncoder=new ic,this.leftClockEncoder=new Ku,this.rightClockEncoder=new Ku,this.infoEncoder=new G0(ju),this.stringEncoder=new xv,this.parentInfoEncoder=new G0(ju),this.typeRefEncoder=new ic,this.lenEncoder=new ic}toUint8Array(){const t=nc();return se(t,0),tr(t,this.keyClockEncoder.toUint8Array()),tr(t,this.clientEncoder.toUint8Array()),tr(t,this.leftClockEncoder.toUint8Array()),tr(t,this.rightClockEncoder.toUint8Array()),tr(t,Kr(this.infoEncoder)),tr(t,this.stringEncoder.toUint8Array()),tr(t,Kr(this.parentInfoEncoder)),tr(t,this.typeRefEncoder.toUint8Array()),tr(t,this.lenEncoder.toUint8Array()),rc(t,Kr(this.restEncoder)),Kr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Do(this.restEncoder,t)}writeBuf(t){tr(this.restEncoder,t)}writeJSON(t){Do(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const wT=(e,t,n,r)=>{r=ls(r,t[0].id.clock);const i=qr(t,r);se(e.restEncoder,t.length-i),e.writeClient(n),se(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},ih=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{on(t,s)>i&&r.set(s,i)}),oh(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),se(e.restEncoder,r.size),cs(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{wT(e,t.clients.get(i),i,s)})},ET=(e,t)=>{const n=Rr(),r=Xt(e.restDecoder);for(let i=0;i<r;i++){const s=Xt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Xt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(ec&u){case 0:{const f=e.readLen();o[l]=new hr(Qt(a,c),f),c+=f;break}case 10:{const f=Xt(e.restDecoder);o[l]=new fr(Qt(a,c),f),c+=f;break}default:{const f=(u&(mi|Qn))===0,d=new Ze(Qt(a,c),null,(u&Qn)===Qn?e.readLeftID():null,null,(u&mi)===mi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Fo)===Fo?e.readString():null,Qp(e,u));o[l]=d,c+=d.length}}}}return n},xT=(e,t,n)=>{const r=[];let i=cs(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new Tp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(b=>b!==m)}r.length=0};for(;;){if(u.constructor!==fr){const m=Mi(f,u.id.client,()=>on(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const b=n.get(p)||{refs:[],i:0};if(b.refs.length===b.i)l(p,on(t,p)),d();else{u=b.refs[b.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new hs;return ih(h,a,new Map),se(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},vT=(e,t)=>ih(e,t.doc.store,t.beforeState),TT=(e,t,n,r=new Js(e))=>pe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ET(r,o),l=xT(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<on(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=fc([u.update,l.update])}}else a.pendingStructs=l;const f=pp(r,i,a);if(a.pendingDs){const d=new Js(Ks(a.pendingDs));Xt(d.restDecoder);const h=pp(d,i,a);f&&h?a.pendingDs=fc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,yp(i.doc,d)}},n,!1),yp=(e,t,n,r=Js)=>{const i=Ks(t);TT(i,e,n,new r(i))},bp=(e,t,n)=>yp(e,t,n,_p),AT=(e,t,n=new Map)=>{ih(e,t.store,n),Xs(e,_T(t.store))},ST=(e,t=new Uint8Array([0]),n=new hs)=>{const r=kp(t);AT(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push($T(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Go)return BT(i.map((s,o)=>o===0?s:jT(s)));if(n.constructor===hs)return fc(i)}return i[0]},RT=(e,t)=>ST(e,t,new Go),OT=e=>{const t=new Map,n=Xt(e.restDecoder);for(let r=0;r<n;r++){const i=Xt(e.restDecoder),s=Xt(e.restDecoder);t.set(i,s)}return t},kp=e=>OT(new gp(Ks(e)));class NT{constructor(){this.l=[]}}const wp=()=>new NT,Ep=(e,t)=>e.l.push(t),xp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},vp=(e,t,n)=>Ju(e.l,[t,n]);class Zs{constructor(t,n){this.client=t,this.clock=n}}const uc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Qt=(e,t)=>new Zs(e,t),IT=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Yr()},Qs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!dp(t.ds,e.id),sh=(e,t)=>{const n=Mi(e.meta,sh,Ws),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<on(r,s)&&Bi(e,Qt(s,i))}),fp(e,t.ds,i=>{}),n.add(t))};class Tp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const oh=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},on=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ap=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Yr()}n.push(t)},qr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ui(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ui((n+r)/2)}throw Yr()},ah=(e,t)=>{const n=e.clients.get(t.client);return n[qr(n,t.clock)]},ch=(e,t,n)=>{const r=qr(t,n),i=t[r];return i.id.clock<n&&i instanceof Ze?(t.splice(r+1,0,xc(e,i,n-i.id.clock)),r+1):r},Bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[ch(e,n,t.clock)]},Sp=(e,t,n)=>{const r=t.clients.get(n.client),i=qr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==hr&&r.splice(i+1,0,xc(e,s,n.clock-s.id.clock+1)),s},CT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[qr(r,t.id.clock)]=n},Rp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=ch(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&ch(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class LT{constructor(t,n,r){this.doc=t,this.deleteSet=new Wo,this.beforeState=oh(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Op=(e,t)=>t.deleteSet.clients.size===0&&!nv(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(nh(t.deleteSet),vT(e,t),Xs(e,t.deleteSet),!0),Np=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Mi(e.changed,t,Ws).add(n)},hc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},MT=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=qr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},UT=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=B0(i.length-1,1+qr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+hc(i,c)}})},Ip=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{nh(s),n.afterState=oh(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),vp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Ju(a,[]),n._needFormattingCleanup&&eA(n)}finally{r.gc&&MT(s,i,r.gcFilter),UT(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=ls(qr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+hc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=qr(h,d);m+1<h.length&&hc(h,m+1)>1||m>0&&hc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(hT(Qu,op,"[yjs] ",ap,cp,"Changed the client-id because another client seems to be using it."),r.clientID=mp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Go;Op(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new hs;Op(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Ip(e,t+1)}}},pe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new LT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Ip(i,0)}}return o};function*FT(e){const t=Xt(e.restDecoder);for(let n=0;n<t;n++){const r=Xt(e.restDecoder),i=e.readClient();let s=Xt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Xt(e.restDecoder);yield new fr(Qt(i,s),c),s+=c}else if(ec&a){const c=(a&(mi|Qn))===0,l=new Ze(Qt(i,s),null,(a&Qn)===Qn?e.readLeftID():null,null,(a&mi)===mi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Fo)===Fo?e.readString():null,Qp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new hr(Qt(i,s),c),s+=c}}}}class lh{constructor(t,n){this.gen=FT(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===fr);return this.curr}}class uh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const BT=e=>fc(e,_p,Go),PT=(e,t)=>{if(e.constructor===hr){const{client:n,clock:r}=e.id;return new hr(Qt(n,r+t),e.length-t)}else if(e.constructor===fr){const{client:n,clock:r}=e.id;return new fr(Qt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ze(Qt(r,i+t),null,Qt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},fc=(e,t=Js,n=hs)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ks(u)));let i=r.map(u=>new lh(u,!0)),s=null;const o=new n,a=new uh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===fr?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===fr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new fr(Qt(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===fr?s.struct.length-=m:d=PT(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==fr;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),hh(a);const c=r.map(u=>rh(u)),l=mT(c);return Xs(o,l),o.toUint8Array()},$T=(e,t,n=Js,r=hs)=>{const i=kp(t),s=new r,o=new uh(s),a=new n(Ks(e)),c=new lh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===fr){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,ls(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}hh(o);const l=rh(a);return Xs(s,l),s.toUint8Array()},Cp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Kr(e.encoder.restEncoder)}),e.encoder.restEncoder=nc(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Cp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),se(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},hh=e=>{Cp(e);const t=e.encoder.restEncoder;se(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];se(t,r.written),rc(t,r.restEncoder)}},DT=(e,t,n,r)=>{const i=new n(Ks(e)),s=new lh(i,!1),o=new r,a=new uh(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);hh(a);const c=rh(i);return Xs(o,c),o.toUint8Array()},jT=e=>DT(e,qv,Js,Go),Lp="You must not compute changes after the event-handler fired.";class dc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=zT(this.currentTarget,this.target))}deletes(t){return dp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Lp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Bu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Bu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Bu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(Lp);const n=this.target,r=Ws(),i=Ws(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const zT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},kn=()=>{fT("Invalid access: Add Yjs type to a document before reading data.")},Mp=80;let fh=0;class WT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=fh++}}const GT=e=>{e.timestamp=fh++},Up=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=fh++},KT=(e,t,n)=>{if(e.length>=Mp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Up(r,t,n),r}else{const r=new WT(t,n);return e.push(r),r}},pc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>tc(t-s.index)<tc(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,GT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&tc(n.index-i)<r.parent.length/Mp?(Up(n,r,i),n):KT(e._searchMarker,r,i)},Ko=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=ls(t,i.index+n))}},mc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Mi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;vp(r._eH,n,t)};class mn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=wp(),this._dEH=wp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Hr()}clone(){throw Hr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ep(this._eH,t)}observeDeep(t){Ep(this._dEH,t)}unobserve(t){xp(this._eH,t)}unobserveDeep(t){xp(this._dEH,t)}toJSON(){}}const Fp=(e,t,n)=>{e.doc??kn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Bp=e=>{e.doc??kn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Ho=(e,t)=>{let n=0,r=e._start;for(e.doc??kn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Pp=(e,t)=>{const n=[];return Ho(e,(r,i)=>{n.push(t(r,i,e))}),n},HT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},$p=(e,t)=>{e.doc??kn();const n=pc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},gc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(Qt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ps(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(Qt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Yo(new Uint8Array(f))),i.integrate(e,0);break;case qs:i=new Ze(Qt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Xo(f)),i.integrate(e,0);break;default:if(f instanceof mn)i=new Ze(Qt(o,on(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Dp=()=>Fi("Length exceeded!"),jp=(e,t,n,r)=>{if(n>t._length)throw Dp();if(n===0)return t._searchMarker&&Ko(t._searchMarker,n,r.length),gc(e,t,null,r);const i=n,s=pc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Bi(e,Qt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Ko(t._searchMarker,i,r.length),gc(e,t,o,r)},YT=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return gc(e,t,i,n)},zp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=pc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Bi(e,Qt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bi(e,Qt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Dp();t._searchMarker&&Ko(t._searchMarker,i,-s+r)},_c=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},dh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ps([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ps([r]);break;case Uint8Array:a=new Yo(r);break;case qs:a=new Xo(r);break;default:if(r instanceof mn)a=new bi(r);else throw new Error("Unexpected content type")}new Ze(Qt(o,on(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},ph=(e,t)=>{e.doc??kn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Wp=e=>{const t={};return e.doc??kn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Gp=(e,t)=>{e.doc??kn();const n=e._map.get(t);return n!==void 0&&!n.deleted},VT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Qs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},yc=e=>(e.doc??kn(),dT(e._map.entries(),t=>!t[1].deleted));class XT extends dc{}class to extends mn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new to;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return t.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),t}get length(){return this.doc??kn(),this._length}_callObserver(t,n){super._callObserver(t,n),mc(this,t,new XT(this,t))}insert(t,n){this.doc!==null?pe(this.doc,r=>{jp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?pe(this.doc,n=>{YT(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{zp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return $p(this,t)}toArray(){return Bp(this)}slice(t=0,n=this.length){return Fp(this,t,n)}toJSON(){return this.map(t=>t instanceof mn?t.toJSON():t)}map(t){return Pp(this,t)}forEach(t){Ho(this,t)}[Symbol.iterator](){return HT(this)}_write(t){t.writeTypeRef(kA)}}const qT=e=>new to;class JT extends dc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class eo extends mn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new eo}clone(){const t=new eo;return this.forEach((n,r)=>{t.set(r,n instanceof mn?n.clone():n)}),t}_callObserver(t,n){mc(this,t,new JT(this,t,n))}toJSON(){this.doc??kn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof mn?i.toJSON():i}}),t}get size(){return[...yc(this)].length}keys(){return th(yc(this),t=>t[0])}values(){return th(yc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return th(yc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??kn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?pe(this.doc,r=>{dh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return ph(this,t)}has(t){return Gp(this,t)}clear(){this.doc!==null?pe(this.doc,t=>{this.forEach(function(n,r,i){_c(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(wA)}}const ZT=e=>new eo,$i=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Vv(e,t);class mh{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Yr(),this.right.content.constructor){case Je:this.right.deleted||no(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Kp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Je:t.right.deleted||no(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Bi(e,Qt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},bc=(e,t,n,r)=>{const i=new Map,s=r?pc(t,n):null;if(s){const o=new mh(s.p.left,s.p,s.index,i);return Kp(e,o,n-s.index)}else{const o=new mh(null,t._start,0,i);return Kp(e,o,n)}},Hp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&$i(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(Qt(s,on(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Je(a,o));u.integrate(e,0),n.right=u,n.forward()})},no=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Yp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Je&&$i(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Vp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(Qt(s,on(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Je(a,c)),n.right.integrate(e,0),n.forward()}}return o},gh=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Yp(n,i);const a=Vp(e,t,n,i),c=r.constructor===String?new Jr(r):r instanceof mn?new bi(r):new ds(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Ko(t._searchMarker,n.index,c.getLength()),u=new Ze(Qt(o,on(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Hp(e,t,n,a)},Xp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Yp(n,i);const a=Vp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Bi(e,Qt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(Qt(o,on(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Jr(c)),n.right.integrate(e,0),n.forward()}Hp(e,t,n,a)},qp=(e,t,n,r,i)=>{let s=t;const o=Rr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Je:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&no(i,l);break}}}t=t.right}return a},QT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},tA=e=>{let t=0;return pe(e.doc,n=>{let r=e._start,i=e._start,s=Rr();const o=Fu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:no(o,i.content);break;default:t+=qp(n,r,i,s,o),s=Fu(o),r=i;break}i=i.right}}),t},eA=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Rp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==hr&&t.add(o.parent)})}pe(n,r=>{fp(e,e.deleteSet,i=>{if(i instanceof hr||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Je?t.add(s):QT(r,i)});for(const i of t)tA(i)})},Jp=(e,t,n)=>{const r=n,i=Fu(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case bi:case ds:case Jr:n<t.right.length&&Bi(e,Qt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&qp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Ko(o._searchMarker,t.index,-r+n),t};class nA extends dc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];pe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},Kv(c)||(h.attributes=zv({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case bi:case ds:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Jr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;$i(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),$i(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;$i(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&($i(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),no(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class yi extends mn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??kn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new yi}clone(){const t=new yi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new nA(this,t,n);mc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??kn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Jr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new mh(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&gh(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Xp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Jp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??kn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Qs(c,t)||n!==void 0&&Qs(c,n))switch(c.content.constructor){case Jr:{const f=s.get("ychange");t!==void 0&&!Qs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Qs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bi:case ds:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Je:Qs(c,t)&&(l(),no(s,c.content));break}c=c.right}l()};return t||n?pe(o,f=>{t&&sh(f,t),n&&sh(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),gh(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!r);gh(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{Jp(i,bc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=bc(s,this,t,!1);o.right!==null&&Xp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{dh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return ph(this,t)}getAttributes(){return Wp(this)}_write(t){t.writeTypeRef(EA)}}const rA=e=>new yi;class _h{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??kn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===ro||n.constructor===fs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class fs extends mn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fs}clone(){const t=new fs;return t.insert(0,this.toArray().map(n=>n instanceof mn?n.clone():n)),t}get length(){return this.doc??kn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new _h(this,t)}querySelector(t){t=t.toUpperCase();const r=new _h(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),cs(new _h(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){mc(this,t,new oA(this,n,t))}toString(){return Pp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ho(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?pe(this.doc,r=>{jp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)pe(this.doc,r=>{const i=t&&t instanceof mn?t._item:t;gc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Fi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{zp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Bp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return $p(this,t)}slice(t=0,n=this.length){return Fp(this,t,n)}forEach(t){Ho(this,t)}_write(t){t.writeTypeRef(vA)}}const iA=e=>new fs;class ro extends fs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ro(this.nodeName)}clone(){const t=new ro(this.nodeName),n=this.getAttributes();return Gv(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof mn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{_c(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{dh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return ph(this,t)}hasAttribute(t){return Gp(this,t)}getAttributes(t){return t?VT(this,t):Wp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ho(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(xA),t.writeKey(this.nodeName)}}const sA=e=>new ro(e.readKey());class oA extends dc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class kc extends eo{constructor(t){super(),this.hookName=t}_copy(){return new kc(this.hookName)}clone(){const t=new kc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(TA),t.writeKey(this.hookName)}}const aA=e=>new kc(e.readKey());class wc extends yi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new wc}clone(){const t=new wc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(AA)}}const cA=e=>new wc;class yh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Hr()}mergeWith(t){return!1}write(t,n,r){throw Hr()}integrate(t,n){throw Hr()}}const lA=0;class hr extends yh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ap(t.doc.store,this)}write(t,n){t.writeInfo(lA),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Yo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Yo(this.content)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const uA=e=>new Yo(e.readBuf());class Vo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Vo(this.len)}splice(t){const n=new Vo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){lc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const hA=e=>new Vo(e.readLen()),Zp=(e,t)=>new qs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Xo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xo(Zp(this.doc.guid,this.opts))}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const fA=e=>new Xo(Zp(e.readString(),e.readAny()));class ds{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ds(this.embed)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const dA=e=>new ds(e.readJSON());class Je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const pA=e=>new Je(e.readKey(),e.readJSON());class Ec{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ec(this.arr)}splice(t){const n=new Ec(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const mA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Ec(n)},gA=cc("node_env")==="development";class ps{constructor(t){this.arr=t,gA&&rp(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ps(this.arr)}splice(t){const n=new ps(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const _A=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ps(n)};class Jr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Jr(this.str)}splice(t){const n=new Jr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const yA=e=>new Jr(e.readString()),bA=[qT,ZT,rA,sA,iA,aA,cA],kA=0,wA=1,EA=2,xA=3,vA=4,TA=5,AA=6;class bi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bi(this.type._copy())}splice(t){throw Hr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const SA=e=>new bi(bA[e.readTypeRef()](e)),xc=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ze(Qt(r,i+n),t,Qt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Qt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ze extends yh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?D0:0}set marker(t){(this.info&$u)>0!==t&&(this.info^=$u)}get marker(){return(this.info&$u)>0}get keep(){return(this.info&$0)>0}set keep(t){this.keep!==t&&(this.info^=$0)}get countable(){return(this.info&D0)>0}get deleted(){return(this.info&Pu)>0}set deleted(t){this.deleted!==t&&(this.info^=Pu)}markDeleted(){this.info|=Pu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=on(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=on(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Zs&&this.id.client!==this.parent.client&&this.parent.clock>=on(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Sp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===hr||this.right&&this.right.constructor===hr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Zs){const r=ah(n,this.parent);r.constructor===hr?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Sp(t,t.doc.store,Qt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),uc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(uc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(ah(t.doc.store,i.origin)))s.has(ah(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ap(t.doc.store,this),this.content.integrate(t,this),Np(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new hr(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Qt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&uc(t.origin,this.lastId)&&this.right===t&&uc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),lc(t.deleteSet,this.id.client,this.id.clock,this.length),Np(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Yr();this.content.gc(t),n?CT(t,this,new hr(this.id,this.length)):this.content=new Vo(this.length)}write(t,n){const r=n>0?Qt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&ec|(r===null?0:Qn)|(i===null?0:mi)|(s===null?0:Fo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=IT(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Zs?(t.writeParentInfo(!1),t.writeLeftID(a)):Yr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Qp=(e,t)=>RA[t&ec](e),RA=[()=>{Yr()},hA,mA,uA,yA,dA,pA,SA,_A,fA,()=>{Yr()}],OA=10;class fr extends yh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Yr()}write(t,n){t.writeInfo(OA),se(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const tm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof zs<"u"?zs:{},em="__ $YJS$ __";tm[em]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),tm[em]=!0;let nm=!1;const nr=new qs;function rm(e,t,n){const r=nr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function NA(e,t){rm(e,0,t)}function bh(e,t){const n=new yi(t);rm(e,1,n)}function IA(e,t){nr.getMap().set(e,t)}function CA(e,t){const n=nr.getMap(),r=new yi(t);n.set(e,r)}function im(e,t){const n=nr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function LA(e,t){return im(e,n=>{Et(n)&&t(n)})}function sm(e,t){return im(e,n=>{n instanceof yi&&t(n.toJSON())})}const ms=Ps("modem",["second"],e=>{if(ms.session(e))switch(e.target){case"second":!nm&&e.data%2===0&&ms.emit(e.player,"modem:join");break;case"join":e.sender!==ms.id()&&ms.reply(e,"joinack",L0(RT(nr)));break;case"joinack":e.sender!==ms.id()&&(nm=!0,bp(nr,Za(e.data),nr));break;case"sync":{e.sender!==ms.id()&&y(e.data)&&bp(nr,Za(e.data),nr);break}}});function om(e,t){t!==nr&&ms.emit("","modem:sync",L0(e))}nr.on("update",om),nr.on("destroy",()=>{nr.off("update",om)});function am(e,t){return e%t}function cm(e,t){return Math.floor(e/t)}function MA(e,t){return{x:am(e,t),y:cm(e,t)}}function dr(e,t){return e.x+e.y*t}function io(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function kh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function lm(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function um(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hm="176",UA="",Or="srgb",fm="srgb-linear",dm="linear",wh="srgb";function Nr(e,t,n){return Math.max(t,Math.min(n,e))}function FA(e,t){return(e%t+t)%t}function Eh(e,t,n){return(1-n)*e+n*t}class qo{constructor(t=0,n=0){qo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Nr(this.x,t.x,n.x),this.y=Nr(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=Nr(this.x,t,n),this.y=Nr(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Nr(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Nr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Jo{constructor(t,n,r,i,s,o,a,c,l){Jo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],b=i[3],k=i[6],v=i[1],T=i[4],A=i[7],L=i[2],S=i[5],I=i[8];return s[0]=o*p+a*v+c*L,s[3]=o*b+a*T+c*S,s[6]=o*k+a*A+c*I,s[1]=l*p+u*v+f*L,s[4]=l*b+u*T+f*S,s[7]=l*k+u*A+f*I,s[2]=d*p+h*v+m*L,s[5]=d*b+h*T+m*S,s[8]=d*k+h*A+m*I,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(xh.makeScale(t,n)),this}rotate(t){return this.premultiply(xh.makeRotation(-t)),this}translate(t,n){return this.premultiply(xh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const xh=new Jo,pm=new Jo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),mm=new Jo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function BA(){const e={enabled:!0,workingColorSpace:fm,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===wh&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===wh&&(i.r=oo(i.r),i.g=oo(i.g),i.b=oo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===UA?dm:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[fm]:{primaries:t,whitePoint:r,transfer:dm,toXYZ:pm,fromXYZ:mm,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Or},outputColorSpaceConfig:{drawingBufferColorSpace:Or}},[Or]:{primaries:t,whitePoint:r,transfer:wh,toXYZ:pm,fromXYZ:mm,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Or}}}),e}const Ir=BA();function so(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function oo(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const gm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},vc={h:0,s:0,l:0};function vh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Th{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=Or){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ir.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Ir.workingColorSpace){return this.r=t,this.g=n,this.b=r,Ir.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Ir.workingColorSpace){if(t=FA(t,1),n=Nr(n,0,1),r=Nr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=vh(o,s,t+1/3),this.g=vh(o,s,t),this.b=vh(o,s,t-1/3)}return Ir.toWorkingColorSpace(this,i),this}setStyle(t,n=Or){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=Or){const r=gm[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}copyLinearToSRGB(t){return this.r=oo(t.r),this.g=oo(t.g),this.b=oo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Or){return Ir.fromWorkingColorSpace(wn.copy(this),t),Math.round(Nr(wn.r*255,0,255))*65536+Math.round(Nr(wn.g*255,0,255))*256+Math.round(Nr(wn.b*255,0,255))}getHexString(t=Or){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Ir.workingColorSpace){Ir.fromWorkingColorSpace(wn.copy(this),n);const r=wn.r,i=wn.g,s=wn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Ir.workingColorSpace){return Ir.fromWorkingColorSpace(wn.copy(this),n),t.r=wn.r,t.g=wn.g,t.b=wn.b,t}getStyle(t=Or){Ir.fromWorkingColorSpace(wn.copy(this),t);const n=wn.r,r=wn.g,i=wn.b;return t!==Or?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Di),this.setHSL(Di.h+t,Di.s+n,Di.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Di),t.getHSL(vc);const r=Eh(Di.h,vc.h,n),i=Eh(Di.s,vc.s,n),s=Eh(Di.l,vc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const wn=new Th;Th.NAMES=gm,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hm}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hm),new qo,new qo;function gn(e,t,n){return Math.max(t,Math.min(n,e))}function _m(e){return e/180*Math.PI}function ym(e){return e*180/Math.PI}const PA=Hd("089fad0j9awfem09wavefc09uwaef");function $A(){return PA()}function DA(e){return Hd(e)()}function pr(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor($A()*i)}function bm(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(DA(e)*s)}function km(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function jA(e){return e[pr(0,e.length-1)]}function zA(e,t){return t[bm(e,0,t.length-1)]}function Sn(...e){return jA(e.flat())}function WA(e,...t){return zA(e,t.flat())}function GA(e){return[...new Set(e)].filter(y)}function gs(e){return y(e)&&y(e.x)&&y(e.y)}function ze(e,t){switch(t){case pt.NORTH:--e.y;break;case pt.SOUTH:++e.y;break;case pt.WEST:--e.x;break;case pt.EAST:++e.x;break}return e}function KA(e,t){return e<0?pt.WEST:e>0?pt.EAST:t<0?pt.NORTH:t>0?pt.SOUTH:pt.IDLE}function mr(e,t){return KA(t.x-e.x,t.y-e.y)}const Ah={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function rr(e){return ue(e)&&wm(e[0])}function wm(e){return y(pt[e])&&gt(e)}function Em(e){const t=pt[e];return y(t)?t:pt.IDLE}function Tc(e){if(gt(e))return Ah[It(e)]}function HA(e){if(rr(e))return e;if(wm(e))return[e];const t=Tc(e);if(y(t))return[t]}function xm(e){const t=w.words[e],n=HA(t);return rr(n)?[n,e+1]:[void 0,e]}function vm(e){var i,s;const t=[];let[n,r]=xm(e);for(;rr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=it(w.words,r,[K.NUMBER,K.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=it(w.words,r,[K.KIND]);console.info("kind",c),r=l;break}case"TO":{const[c,l,u]=it(w.words,r,[K.DIR,K.DIR]),f=((i=w.element)==null?void 0:i.x)??0,d=((s=w.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=xm(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function YA(e){return y(e)&&e<Lt.ONBLACK?e:void 0}function Sh(e){return y(e)&&e>Lt.WHITE&&e<Lt.ONCLEAR?e-Lt.ONBLACK:void 0}const Zo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function En(e){return ue(e)&&Am(e[0])}function Tm(e){return En(e)&&e[0].startsWith("ON")}function Am(e){return y(Lt[e])&&gt(e)}function Qo(e){if(gt(e))return Zo[It(e)]}function Rh(e,t){return[y(e)?`${Lt[e]}`:void 0,y(t)?`ON${Lt[t]}`:void 0].filter(y)}function Ac(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t<Lt.ONBLACK)}function Sc(e){return e.map(t=>Lt[t]).find(t=>y(t)&&t>=Lt.ONBLACK)}function VA(e){if(En(e))return e;if(Am(e))return[e];const t=Qo(e);if(y(t))return[t]}function Sm(e){const t=w.words[e],n=VA(t);return En(n)?[n,e+1]:[void 0,e]}function Rc(e){const t=[];let n=e;const[r,i]=Sm(e);if(En(r)&&(t.push(...r),n=i),En(t)&&!Tm(t)){const[s,o]=Sm(i);Tm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function Rm(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Lt[r];y(i)&&(i<Lt.ONBLACK?t.color=i:t.bg=Sh(i))}return t}var Om={exports:{}},Oh={exports:{}},Nm;function XA(){return Nm||(Nm=1,function(e,t){(function(n,r){e.exports=r()})(Fn,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var b=0;b<u.length;b++)p[u[b]]!==void 0&&this["set"+r(u[b])](p[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",b=this.getLineNumber()||"",k=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+b+":"+k+")":"[eval]:"+b+":"+k:v?v+" ("+p+":"+b+":"+k+")":p+":"+b+":"+k}},f.fromString=function(b){var k=b.indexOf("("),v=b.lastIndexOf(")"),T=b.substring(0,k),A=b.substring(k+1,v).split(","),L=b.substring(v+1);if(L.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(L,""),I=S[1],$=S[2],N=S[3];return new f({functionName:T,args:A||void 0,fileName:I,lineNumber:$||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(b){this[p]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(b){if(!n(b))throw new TypeError(p+" must be a Number");this[p]=Number(b)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(b){this[p]=String(b)}}(a[m]);return f})}(Oh)),Oh.exports}(function(e,t){(function(n,r){e.exports=r(XA())})(Fn,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Om);var qA=Om.exports,JA=Fs(qA);const St=60,Vt=25,Nh=St*Vt;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});const Ih=14,Oc=3,ji=8,zi=14,Nc=16,ZA=16,QA=16;var Ic=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Ic||{});function ta(e,t){return new Array(e).fill(t)}function tS(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:ta(o,0),color:ta(o,0),bg:ta(o,s),wall:ta(o,0)}}function eS(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Lt.ONCLEAR}}function nS(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function rS(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:ta(s,i)}}function iS(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function sS(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Im(e,t){return`${e}:${t}`}const oS=1,aS=16,cS=256;var Rn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Rn||{});const Zr=!!JSON.parse("false"),lS=!!JSON.parse("false");JSON.parse("false");const Cm=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ki={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return ji*ki.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return zi*ki.DRAW_CHAR_SCALE}},nt=Ps("SOFTWARE");function wi(e){const t={},n={tick(){},everytick(){},listcommands(){return Zn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Te(e){return`${e??""}`}function ea(e,t){const n=parseFloat(Te(e));return isNaN(n)?t:n}function Dn(e,t,n,r){const[i,s]=it(r,0,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);a0(nt,e,t,n,i,s)}const uS=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Lm(e,t,n){const[r,i]=it(n,0,[K.NUMBER_OR_STRING]);if(Et(r))Eu(nt,e,t,"volume",r);else if(uS.includes(It(r))){const[s,o]=it(n,i,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);a0(nt,e,t,r,s,o)}else{const[s]=it(n,i,[K.MAYBE_NUMBER_OR_STRING]);if(Et(s)){const o=n.length-i,a=new Array(o).fill(K.NUMBER),c=it(n,i,a).slice(0,o),l=c.length===1?c[0]:c;Eu(nt,e,t,r,l)}else{const[o]=it(n,i,[K.MAYBE_NUMBER_OR_STRING]);Eu(nt,e,t,r,o)}}}let Mm="en-US-GuyNeural";function Wi(e,t){var r;const[n]=it(e,0,[K.MAYBE_NAME]);_x(nt,w.elementfocus,((r=w.board)==null?void 0:r.id)??"",n??"",t)}const Ch=wi().command("talk",(e,t)=>{const[n]=it(t,0,[K.ANY]);switch(It(n)){default:JE(nt,w.elementfocus);break;case"stop":ZE(nt,w.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=it(t,0,[K.ANY]);switch(It(n)){default:QE(nt,w.elementfocus);break;case"stop":tx(nt,w.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Te).join("");return mx(nt,w.elementfocus,Mm,n),0}).command("ttsvoice",(e,t)=>(Mm=t.map(Te).join(""),0)).command("bpm",(e,t)=>{const[n]=it(t,0,[K.NUMBER]);return bx(nt,w.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[K.NUMBER]);return kx(nt,w.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[K.NUMBER]);return wx(nt,w.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[K.NUMBER]);return Ex(nt,w.elementfocus,n),0}).command("play",(e,t)=>{var r;const[n]=it(t,0,[K.MAYBE_NAME]);return gx(nt,w.elementfocus,((r=w.board)==null?void 0:r.id)??"",n??""),0}).command("bgplay",(e,t)=>(Wi(t,""),0)).command("bgplayon64n",(e,t)=>(Wi(t,"@64n"),0)).command("bgplayon32n",(e,t)=>(Wi(t,"@32n"),0)).command("bgplayon16n",(e,t)=>(Wi(t,"@16n"),0)).command("bgplayon8n",(e,t)=>(Wi(t,"@8n"),0)).command("bgplayon4n",(e,t)=>(Wi(t,"@4n"),0)).command("bgplayon2n",(e,t)=>(Wi(t,"@2n"),0)).command("bgplayon1n",(e,t)=>(Wi(t,"@1m"),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)Lm(w.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)Dn(w.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Ch.command(`synth${e+1}`,(t,n)=>(Lm(w.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Ch.command(`echo${t}`,(n,r)=>(Dn(w.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Dn(w.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Dn(w.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Dn(w.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Dn(w.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Dn(w.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(Dn(w.elementfocus,e,"autowah",r),0))}var Lh;try{Lh=new TextDecoder}catch{}var kt,gr,H=0,me={},te,Gi,_r=0,Qr=0,an,Ei,jn=[],Jt,Um={useRecords:!1,mapsAsObjects:!0};class Fm{}const Bm=new Fm;Bm.name="MessagePack 0xC1";var Ki=!1,Pm=2,$m;try{new Function("")}catch{Pm=1/0}class na{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(kt)return Zm(()=>(Ph(),this?this.unpack(t,n):na.prototype.unpack.call(Um,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof pn<"u"?pn.from(t):new Uint8Array(t)),typeof n=="object"?(gr=n.end||t.length,H=n.start||0):(H=0,gr=n>-1?n:t.length),Qr=0,Gi=null,an=null,kt=t;try{Jt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw kt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof na){if(me=this,this.structures)return te=this.structures,Cc(n);(!te||te.length>0)&&(te=[])}else me=Um,(!te||te.length>0)&&(te=[]);return Cc(n)}unpackMultiple(t,n){let r,i=0;try{Ki=!0;let s=t.length,o=this?this.unpack(t,s):Lc.unpack(t,s);if(n){if(n(o,i,H)===!1)return;for(;H<s;)if(i=H,n(Cc(),i,H)===!1)return}else{for(r=[o];H<s;)i=H,r.push(Cc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ki=!1,Ph()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Cc(e){try{if(!me.trusted&&!Ki){let n=te.sharedLength||0;n<te.length&&(te.length=n)}let t;if(me.randomAccessStructure&&kt[H]<64&&kt[H]>=32&&$m?(t=$m(kt,H,gr,me),kt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),H=gr):t=We(),an&&(H=an.postBundlePosition,an=null),Ki&&(te.restoreStructures=null),H==gr)te&&te.restoreStructures&&Dm(),te=null,kt=null,Ei&&(Ei=null);else{if(H>gr)throw new Error("Unexpected end of MessagePack data");if(!Ki){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw te&&te.restoreStructures&&Dm(),Ph(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||H>gr)&&(t.incomplete=!0),t}}function Dm(){for(let e in te.restoreStructures)te[e]=te.restoreStructures[e];te.restoreStructures=null}function We(){let e=kt[H++];if(e<160)if(e<128){if(e<64)return e;{let t=te[e&63]||me.getStructures&&zm()[e&63];return t?(t.read||(t.read=Mh(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Vm();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Qr>=H)return Gi.slice(H-_r,(H+=t)-_r);if(Qr==0&&gr<140){let n=t<16?Fh(t):Km(t);if(n!=null)return n}return Uh(t)}else{let t;switch(e){case 192:return null;case 193:return an?(t=We(),t>0?an[1].slice(an.position1,an.position1+=t):an[0].slice(an.position0,an.position0-=t)):Bm;case 194:return!1;case 195:return!0;case 196:if(t=kt[H++],t===void 0)throw new Error("Unexpected end of buffer");return Bh(t);case 197:return t=Jt.getUint16(H),H+=2,Bh(t);case 198:return t=Jt.getUint32(H),H+=4,Bh(t);case 199:return _s(kt[H++]);case 200:return t=Jt.getUint16(H),H+=2,_s(t);case 201:return t=Jt.getUint32(H),H+=4,_s(t);case 202:if(t=Jt.getFloat32(H),me.useFloat32>2){let n=$h[(kt[H]&127)<<1|kt[H+1]>>7];return H+=4,(n*t+(t>0?.5:-.5)>>0)/n}return H+=4,t;case 203:return t=Jt.getFloat64(H),H+=8,t;case 204:return kt[H++];case 205:return t=Jt.getUint16(H),H+=2,t;case 206:return t=Jt.getUint32(H),H+=4,t;case 207:return me.int64AsType==="number"?(t=Jt.getUint32(H)*4294967296,t+=Jt.getUint32(H+4)):me.int64AsType==="string"?t=Jt.getBigUint64(H).toString():me.int64AsType==="auto"?(t=Jt.getBigUint64(H),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigUint64(H),H+=8,t;case 208:return Jt.getInt8(H++);case 209:return t=Jt.getInt16(H),H+=2,t;case 210:return t=Jt.getInt32(H),H+=4,t;case 211:return me.int64AsType==="number"?(t=Jt.getInt32(H)*4294967296,t+=Jt.getUint32(H+4)):me.int64AsType==="string"?t=Jt.getBigInt64(H).toString():me.int64AsType==="auto"?(t=Jt.getBigInt64(H),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigInt64(H),H+=8,t;case 212:if(t=kt[H++],t==114)return qm(kt[H++]&63);{let n=jn[t];if(n)return n.read?(H++,n.read(We())):n.noBuffer?(H++,n()):n(kt.subarray(H,++H));throw new Error("Unknown extension "+t)}case 213:return t=kt[H],t==114?(H++,qm(kt[H++]&63,kt[H++])):_s(2);case 214:return _s(4);case 215:return _s(8);case 216:return _s(16);case 217:return t=kt[H++],Qr>=H?Gi.slice(H-_r,(H+=t)-_r):fS(t);case 218:return t=Jt.getUint16(H),H+=2,Qr>=H?Gi.slice(H-_r,(H+=t)-_r):dS(t);case 219:return t=Jt.getUint32(H),H+=4,Qr>=H?Gi.slice(H-_r,(H+=t)-_r):pS(t);case 220:return t=Jt.getUint16(H),H+=2,Wm(t);case 221:return t=Jt.getUint32(H),H+=4,Wm(t);case 222:return t=Jt.getUint16(H),H+=2,Gm(t);case 223:return t=Jt.getUint32(H),H+=4,Gm(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const hS=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Mh(e,t){function n(){if(n.count++>Pm){let i=e.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":hS.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return e.highByte===0&&(e.read=jm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=We()}return me.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?jm(t,n):n}const jm=(e,t)=>function(){let n=kt[H++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=te[r]||zm()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Mh(i,e)),i.read()};function zm(){let e=Zm(()=>(kt=null,me.getStructures()));return te=me._mergeStructures(e,te)}var Uh=ra,fS=ra,dS=ra,pS=ra;function ra(e){let t;if(e<16&&(t=Fh(e)))return t;if(e>64&&Lh)return Lh.decode(kt.subarray(H,H+=e));const n=H+e,r=[];for(t="";H<n;){const i=kt[H++];if(!(i&128))r.push(i);else if((i&224)===192){const s=kt[H++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[H++]&63,o=kt[H++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[H++]&63,o=kt[H++]&63,a=kt[H++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=cn.apply(String,r),r.length=0)}return r.length>0&&(t+=cn.apply(String,r)),t}function Wm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}function Gm(e){if(me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Vm();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}}var cn=String.fromCharCode;function Km(e){let t=H,n=new Array(e);for(let r=0;r<e;r++){const i=kt[H++];if((i&128)>0){H=t;return}n[r]=i}return cn.apply(String,n)}function Fh(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[H++];if((t&128)>1){H-=1;return}return cn(t)}}else{let t=kt[H++],n=kt[H++];if((t&128)>0||(n&128)>0){H-=2;return}if(e<3)return cn(t,n);let r=kt[H++];if((r&128)>0){H-=3;return}return cn(t,n,r)}else{let t=kt[H++],n=kt[H++],r=kt[H++],i=kt[H++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){H-=4;return}if(e<6){if(e===4)return cn(t,n,r,i);{let s=kt[H++];if((s&128)>0){H-=5;return}return cn(t,n,r,i,s)}}else if(e<8){let s=kt[H++],o=kt[H++];if((s&128)>0||(o&128)>0){H-=6;return}if(e<7)return cn(t,n,r,i,s,o);let a=kt[H++];if((a&128)>0){H-=7;return}return cn(t,n,r,i,s,o,a)}else{let s=kt[H++],o=kt[H++],a=kt[H++],c=kt[H++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){H-=8;return}if(e<10){if(e===8)return cn(t,n,r,i,s,o,a,c);{let l=kt[H++];if((l&128)>0){H-=9;return}return cn(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=kt[H++],u=kt[H++];if((l&128)>0||(u&128)>0){H-=10;return}if(e<11)return cn(t,n,r,i,s,o,a,c,l,u);let f=kt[H++];if((f&128)>0){H-=11;return}return cn(t,n,r,i,s,o,a,c,l,u,f)}else{let l=kt[H++],u=kt[H++],f=kt[H++],d=kt[H++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){H-=12;return}if(e<14){if(e===12)return cn(t,n,r,i,s,o,a,c,l,u,f,d);{let h=kt[H++];if((h&128)>0){H-=13;return}return cn(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=kt[H++],m=kt[H++];if((h&128)>0||(m&128)>0){H-=14;return}if(e<15)return cn(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=kt[H++];if((p&128)>0){H-=15;return}return cn(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Hm(){let e=kt[H++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[H++];break;case 218:t=Jt.getUint16(H),H+=2;break;case 219:t=Jt.getUint32(H),H+=4;break;default:throw new Error("Expected string")}return ra(t)}function Bh(e){return me.copyBuffers?Uint8Array.prototype.slice.call(kt,H,H+=e):kt.subarray(H,H+=e)}function _s(e){let t=kt[H++];if(jn[t]){let n;return jn[t](kt.subarray(H,n=H+=e),r=>{H=r;try{return We()}finally{H=n}})}else throw new Error("Unknown extension type "+t)}var Ym=new Array(4096);function Vm(){let e=kt[H++];if(e>=160&&e<192){if(e=e-160,Qr>=H)return Gi.slice(H-_r,(H+=e)-_r);if(!(Qr==0&&gr<180))return Uh(e)}else return H--,Xm(We());let t=(e<<5^(e>1?Jt.getUint16(H):e>0?kt[H]:0))&4095,n=Ym[t],r=H,i=H+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Jt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=kt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return H=r,n.string;i-=3,r=H}for(n=[],Ym[t]=n,n.bytes=e;r<i;)s=Jt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=kt[r++],n.push(s);let a=e<16?Fh(e):Km(e);return a!=null?n.string=a:n.string=Uh(e)}function Xm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const qm=(e,t)=>{let n=We().map(Xm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=te[e];return i&&(i.isShared||Ki)&&((te.restoreStructures||(te.restoreStructures=[]))[e]=i),te[e]=n,n.read=Mh(n,r),n.read()};jn[0]=()=>{},jn[0].noBuffer=!0,jn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let mS={Error,TypeError,ReferenceError};jn[101]=()=>{let e=We();return(mS[e[0]]||Error)(e[1],{cause:e[2]})},jn[105]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(H-4);Ei||(Ei=new Map);let n=kt[H],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Ei.set(t,i);let s=We();return i.used?Object.assign(r,s):(i.target=s,s)},jn[112]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(H-4),n=Ei.get(t);return n.used=!0,n.target},jn[115]=()=>new Set(We());const Jm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let gS=typeof globalThis=="object"?globalThis:window;jn[116]=e=>{let t=e[0],n=Jm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new gS[n](Uint8Array.prototype.slice.call(e,1).buffer)},jn[120]=()=>{let e=We();return new RegExp(e[0],e[1])};const _S=[];jn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=H;return H+=t-e.length,an=_S,an=[Hm(),Hm()],an.position0=0,an.position1=0,an.postBundlePosition=H,H=n,We()},jn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Zm(e){let t=gr,n=H,r=_r,i=Qr,s=Gi,o=Ei,a=an,c=new Uint8Array(kt.slice(0,gr)),l=te,u=te.slice(0,te.length),f=me,d=Ki,h=e();return gr=t,H=n,_r=r,Qr=i,Gi=s,Ei=o,an=a,kt=c,Ki=d,te=l,te.splice(0,te.length,...u),me=f,Jt=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),h}function Ph(){kt=null,Ei=null,te=null}const $h=new Array(147);for(let e=0;e<256;e++)$h[e]=+("1e"+Math.floor(45.15-e*.30103));var Lc=new na({useRecords:!1});const yS=Lc.unpack;Lc.unpackMultiple,Lc.unpack;let bS=new Float32Array(1);new Uint8Array(bS.buffer,0,4);let Mc;try{Mc=new TextEncoder}catch{}let Dh,Qm;const Uc=typeof pn<"u",Fc=Uc?function(e){return pn.allocUnsafeSlow(e)}:Uint8Array,tg=Uc?pn:Uint8Array,eg=Uc?4294967296:2144337920;let Z,ia,ge,Y=0,On,Le=null,kS;const wS=21760,ES=/[\u0080-\uFFFF]/,ao=Symbol("record-id");class xS extends na{constructor(t){super(t),this.offset=0;let n,r,i,s,o=tg.prototype.utf8Write?function(O,E){return Z.utf8Write(O,E,Z.byteLength-E)}:Mc&&Mc.encodeInto?function(O,E){return Mc.encodeInto(O,Z.subarray(E)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],b=0,k=0;this.pack=this.encode=function(O,E){if(Z||(Z=new Fc(8192),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,8192)),Y=0),On=Z.length-10,On-Y<2048?(Z=new Fc(Z.length),ge=Z.dataView||(Z.dataView=new DataView(Z.buffer,0,Z.length)),On=Z.length-10,Y=0):Y=Y+7&2147483640,n=Y,E&NS&&(Y+=E&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let P=i.sharedLength||0;if(P>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let F=0;F<P;F++){let ot=i[F];if(!ot)continue;let tt,st=i.transitions;for(let W=0,D=ot.length;W<D;W++){let yt=ot[W];tt=st[yt],tt||(tt=st[yt]=Object.create(null)),st=tt}st[ao]=F+64}this.lastNamedStructuresLength=P}c||(i.nextId=P+64)}r&&(r=!1);let C;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?M(O):A(O);let P=Le;if(Le&&ig(n,A,0),s&&s.idsToInsert){let F=s.idsToInsert.sort((W,D)=>W.offset>D.offset?1:-1),ot=F.length,tt=-1;for(;P&&ot>0;){let W=F[--ot].offset+n;W<P.stringsPosition+n&&tt===-1&&(tt=0),W>P.position+n?tt>=0&&(tt+=6):(tt>=0&&(ge.setUint32(P.position+n,ge.getUint32(P.position+n)+tt),tt=-1),P=P.previous,ot++)}tt>=0&&P&&ge.setUint32(P.position+n,ge.getUint32(P.position+n)+tt),Y+=F.length*6,Y>On&&N(Y),a.offset=Y;let st=TS(Z.subarray(n,Y),F);return s=null,st}return a.offset=Y,E&RS?(Z.start=n,Z.end=Y,Z):Z.subarray(n,Y)}catch(P){throw C=P,P}finally{if(i&&(v(),r&&a.saveStructures)){let P=i.sharedLength||0,F=Z.subarray(n,Y),ot=AS(i,a);if(!C)return a.saveStructures(ot,ot.isCompatible)===!1?a.pack(O,E):(a.lastNamedStructuresLength=P,Z.length>1073741824&&(Z=null),F)}Z.length>1073741824&&(Z=null),E&OS&&(Y=n)}};const v=()=>{k<10&&k++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),b>1e4)i.transitions=null,k=0,b=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let E=0,C=p.length;E<C;E++)p[E][ao]=0;p=[]}},T=O=>{var E=O.length;E<16?Z[Y++]=144|E:E<65536?(Z[Y++]=220,Z[Y++]=E>>8,Z[Y++]=E&255):(Z[Y++]=221,ge.setUint32(Y,E),Y+=4);for(let C=0;C<E;C++)A(O[C])},A=O=>{Y>On&&(Z=N(Y));var E=typeof O,C;if(E==="string"){let P=O.length;if(Le&&P>=4&&P<4096){if((Le.size+=P)>wS){let st,W=(Le[0]?Le[0].length*3+Le[1].length:0)+10;Y+W>On&&(Z=N(Y+W));let D;Le.position?(D=Le,Z[Y]=200,Y+=3,Z[Y++]=98,st=Y-n,Y+=4,ig(n,A,0),ge.setUint16(st+n-3,Y-n-st)):(Z[Y++]=214,Z[Y++]=98,st=Y-n,Y+=4),Le=["",""],Le.previous=D,Le.size=0,Le.position=st}let tt=ES.test(O);Le[tt?0:1]+=O,Z[Y++]=193,A(tt?-P:P);return}let F;P<32?F=1:P<256?F=2:P<65536?F=3:F=5;let ot=P*3;if(Y+ot>On&&(Z=N(Y+ot)),P<64||!o){let tt,st,W,D=Y+F;for(tt=0;tt<P;tt++)st=O.charCodeAt(tt),st<128?Z[D++]=st:st<2048?(Z[D++]=st>>6|192,Z[D++]=st&63|128):(st&64512)===55296&&((W=O.charCodeAt(tt+1))&64512)===56320?(st=65536+((st&1023)<<10)+(W&1023),tt++,Z[D++]=st>>18|240,Z[D++]=st>>12&63|128,Z[D++]=st>>6&63|128,Z[D++]=st&63|128):(Z[D++]=st>>12|224,Z[D++]=st>>6&63|128,Z[D++]=st&63|128);C=D-Y-F}else C=o(O,Y+F);C<32?Z[Y++]=160|C:C<256?(F<2&&Z.copyWithin(Y+2,Y+1,Y+1+C),Z[Y++]=217,Z[Y++]=C):C<65536?(F<3&&Z.copyWithin(Y+3,Y+2,Y+2+C),Z[Y++]=218,Z[Y++]=C>>8,Z[Y++]=C&255):(F<5&&Z.copyWithin(Y+5,Y+3,Y+3+C),Z[Y++]=219,ge.setUint32(Y,C),Y+=4),Y+=C}else if(E==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?Z[Y++]=O:O<256?(Z[Y++]=204,Z[Y++]=O):O<65536?(Z[Y++]=205,Z[Y++]=O>>8,Z[Y++]=O&255):(Z[Y++]=206,ge.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?Z[Y++]=256+O:O>=-128?(Z[Y++]=208,Z[Y++]=O+256):O>=-32768?(Z[Y++]=209,ge.setInt16(Y,O),Y+=2):(Z[Y++]=210,ge.setInt32(Y,O),Y+=4);else{let P;if((P=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){Z[Y++]=202,ge.setFloat32(Y,O);let F;if(P<4||(F=O*$h[(Z[Y]&127)<<1|Z[Y+1]>>7])>>0===F){Y+=4;return}else Y--}Z[Y++]=203,ge.setFloat64(Y,O),Y+=8}else if(E==="object"||E==="function")if(!O)Z[Y++]=192;else{if(s){let F=s.get(O);if(F){if(!F.id){let ot=s.idsToInsert||(s.idsToInsert=[]);F.id=ot.push(F)}Z[Y++]=214,Z[Y++]=112,ge.setUint32(Y,F.id),Y+=4;return}else s.set(O,{offset:Y-n})}let P=O.constructor;if(P===Object)$(O);else if(P===Array)T(O);else if(P===Map)if(this.mapAsEmptyObject)Z[Y++]=128;else{C=O.size,C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);for(let[F,ot]of O)A(F),A(ot)}else{for(let F=0,ot=Dh.length;F<ot;F++){let tt=Qm[F];if(O instanceof tt){let st=Dh[F];if(st.write){st.type&&(Z[Y++]=212,Z[Y++]=st.type,Z[Y++]=0);let at=st.write.call(this,O);at===O?Array.isArray(O)?T(O):$(O):A(at);return}let W=Z,D=ge,yt=Y;Z=null;let X;try{X=st.pack.call(this,O,at=>(Z=W,W=null,Y+=at,Y>On&&N(Y),{target:Z,targetView:ge,position:Y-at}),A)}finally{W&&(Z=W,ge=D,Y=yt,On=Z.length-10)}X&&(X.length+Y>On&&N(X.length+Y),Y=vS(X,Z,Y,st.type));return}}if(Array.isArray(O))T(O);else{if(O.toJSON){const F=O.toJSON();if(F!==O)return A(F)}if(E==="function")return A(this.writeFunction&&this.writeFunction(O));$(O)}}}else if(E==="boolean")Z[Y++]=O?195:194;else if(E==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))Z[Y++]=211,ge.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)Z[Y++]=207,ge.setBigUint64(Y,O);else if(this.largeBigIntToFloat)Z[Y++]=203,ge.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return A(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){Z[Y++]=199,Y++,Z[Y++]=66;let P=[],F;do{let ot=O&BigInt(255);F=(ot&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),P.push(ot),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&F));Z[Y-2]=P.length;for(let ot=P.length;ot>0;)Z[Y++]=Number(P[--ot]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(E==="undefined")this.encodeUndefinedAsNil?Z[Y++]=192:(Z[Y++]=212,Z[Y++]=0,Z[Y++]=0);else throw new Error("Unknown type: "+E)},L=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let E;if(this.skipValues){E=[];for(let F in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(F))&&!this.skipValues.includes(O[F])&&E.push(F)}else E=Object.keys(O);let C=E.length;C<16?Z[Y++]=128|C:C<65536?(Z[Y++]=222,Z[Y++]=C>>8,Z[Y++]=C&255):(Z[Y++]=223,ge.setUint32(Y,C),Y+=4);let P;if(this.coercibleKeyAsNumber)for(let F=0;F<C;F++){P=E[F];let ot=Number(P);A(isNaN(ot)?P:ot),A(O[P])}else for(let F=0;F<C;F++)A(P=E[F]),A(O[P])}:O=>{Z[Y++]=222;let E=Y-n;Y+=2;let C=0;for(let P in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(P))&&(A(P),A(O[P]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');Z[E+++n]=C>>8,Z[E+n]=C&255},S=this.useRecords===!1?L:t.progressiveRecords&&!d?O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),P=Y++-n,F;for(let ot in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot)){if(E=C[ot],E)C=E;else{let tt=Object.keys(O),st=C;C=i.transitions;let W=0;for(let D=0,yt=tt.length;D<yt;D++){let X=tt[D];E=C[X],E||(E=C[X]=Object.create(null),W++),C=E}P+n+1==Y?(Y--,z(C,tt,W)):J(C,tt,P,W),F=!0,C=st[ot]}A(O[ot])}if(!F){let ot=C[ao];ot?Z[P+n]=ot:J(C,Object.keys(O),P,0)}}:O=>{let E,C=i.transitions||(i.transitions=Object.create(null)),P=0;for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&(E=C[ot],E||(E=C[ot]=Object.create(null),P++),C=E);let F=C[ao];F?F>=96&&d?(Z[Y++]=((F-=96)&31)+96,Z[Y++]=F>>5):Z[Y++]=F:z(C,C.__keys__||Object.keys(O),P);for(let ot in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(ot))&&A(O[ot])},I=typeof this.useRecords=="function"&&this.useRecords,$=I?O=>{I(O)?S(O):L(O)}:S,N=O=>{let E;if(O>16777216){if(O-n>eg)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(eg,Math.round(Math.max((O-n)*(O>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(O-n<<2,Z.length-1)>>12)+1<<12;let C=new Fc(E);return ge=C.dataView||(C.dataView=new DataView(C.buffer,0,E)),O=Math.min(O,Z.length),Z.copy?Z.copy(C,0,n,O):C.set(Z.slice(n,O)),Y-=n,n=0,On=C.length-10,Z=C},z=(O,E,C)=>{let P=i.nextId;P||(P=64),P<h&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(P=i.nextOwnId,P<m||(P=h),i.nextOwnId=P+1):(P>=m&&(P=h),i.nextId=P+1);let F=E.highByte=P>=96&&d?P-96>>5:-1;O[ao]=P,O.__keys__=E,i[P-64]=E,P<h?(E.isShared=!0,i.sharedLength=P-63,r=!0,F>=0?(Z[Y++]=(P&31)+96,Z[Y++]=F):Z[Y++]=P):(F>=0?(Z[Y++]=213,Z[Y++]=114,Z[Y++]=(P&31)+96,Z[Y++]=F):(Z[Y++]=212,Z[Y++]=114,Z[Y++]=P),C&&(b+=k*C),p.length>=f&&(p.shift()[ao]=0),p.push(O),A(E))},J=(O,E,C,P)=>{let F=Z,ot=Y,tt=On,st=n;Z=ia,Y=0,n=0,Z||(ia=Z=new Fc(8192)),On=Z.length-10,z(O,E,P),ia=Z;let W=Y;if(Z=F,Y=ot,On=tt,n=st,W>1){let D=Y+W-1;D>On&&N(D);let yt=C+n;Z.copyWithin(yt+W,yt+1,Y),Z.set(ia.slice(0,W),yt),Y=D}else Z[C+n]=ia[0]},M=O=>{let E=kS(O,Z,n,Y,i,N,(C,P,F)=>{if(F)return r=!0;Y=P;let ot=Z;return A(C),v(),ot!==Z?{position:Y,targetView:ge,target:Z}:Y},this);if(E===0)return $(O);Y=E}}useBuffer(t){Z=t,Z.dataView||(Z.dataView=new DataView(Z.buffer,Z.byteOffset,Z.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Qm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Fm],Dh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?ng(e,16,t):rg(Uc?pn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==tg&&this.moreTypes?ng(e,Jm.indexOf(n.name),t):rg(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function ng(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function rg(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function vS(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function TS(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function ig(e,t,n){if(Le.length>0){ge.setUint32(Le.position+e,Y+n-Le.position-e),Le.stringsPosition=Y-e;let r=Le;Le=null,t(r[0]),t(r[1])}}function AS(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let sg=new xS({useRecords:!1});const SS=sg.pack;sg.pack;const RS=512,OS=1024,NS=2048;function Ae(){return null}function co(e,t,n={}){if(!y(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];y(c)&&(a=c(a));const l=t[o];y(l)&&(o=l),a!==null&&r.push(o,a)}return r}function sa(e,t,n={}){if(y(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];y(a)&&(s=a);const c=n[s];y(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(nt,"","binary",r.message)}}function IS(e){try{const t=Ar(e);return SS(t)}catch(t){de(nt,"","binary",t.message)}}function CS(e){try{return yS(e)}catch(t){de(nt,"","binary",t.message)}}function og(){return{id:De()}}var Bc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e))(Bc||{});function Pc(e){return y(e==null?void 0:e.id)?co(e,Bc,{category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae}):co(e,Bc,{id:Ae,x:Ae,y:Ae,lx:Ae,ly:Ae,code:Ae,category:Ae,kinddata:Ae,stopped:Ae,removed:Ae,bucket:Ae})}function $c(e){return sa(e,Bc)}function Ge(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function oa(e,t){if(!y(e)||!En(t))return;const{color:n,bg:r}=Rm(t);y(n)&&(e.color=n),y(r)&&(e.bg=r)}function ag(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function cg(e){const t=Math.floor(e.length/Oc);if(t*Oc!==e.length)return;const n=ag(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function LS(e,t){return e&1<<t?255:0}function lg(e){const t=Math.floor(e.length/Ih);if(t*Ih!==e.length)return;const n=Math.ceil(t/Nc),r=ji*Nc,i=ag(r,zi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*zi+a,u=e[c];for(let f=0;f<ji;++f){const d=s*ji+f;i.bits[d+l*r]=LS(u,7-f)}++a,a===zi&&(a=0,++s,s===Nc&&(s=0,++o))}return i}const MS=Za("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),US=Za("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var ug=typeof zs=="object"&&zs&&zs.Object===Object&&zs,FS=typeof self=="object"&&self&&self.Object===Object&&self,ti=ug||FS||Function("return this")(),yr=ti.Symbol,hg=Object.prototype,BS=hg.hasOwnProperty,PS=hg.toString,aa=yr?yr.toStringTag:void 0;function $S(e){var t=BS.call(e,aa),n=e[aa];try{e[aa]=void 0;var r=!0}catch{}var i=PS.call(e);return r&&(t?e[aa]=n:delete e[aa]),i}var DS=Object.prototype,jS=DS.toString;function zS(e){return jS.call(e)}var WS="[object Null]",GS="[object Undefined]",fg=yr?yr.toStringTag:void 0;function Hi(e){return e==null?e===void 0?GS:WS:fg&&fg in Object(e)?$S(e):zS(e)}function Cr(e){return e!=null&&typeof e=="object"}var KS="[object Symbol]";function Dc(e){return typeof e=="symbol"||Cr(e)&&Hi(e)==KS}function jc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var ie=Array.isArray,HS=1/0,dg=yr?yr.prototype:void 0,pg=dg?dg.toString:void 0;function mg(e){if(typeof e=="string")return e;if(ie(e))return jc(e,mg)+"";if(Dc(e))return pg?pg.call(e):"";var t=e+"";return t=="0"&&1/e==-HS?"-0":t}var YS=/\s/;function VS(e){for(var t=e.length;t--&&YS.test(e.charAt(t)););return t}var XS=/^\s+/;function qS(e){return e&&e.slice(0,VS(e)+1).replace(XS,"")}function br(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var gg=NaN,JS=/^[-+]0x[0-9a-f]+$/i,ZS=/^0b[01]+$/i,QS=/^0o[0-7]+$/i,tR=parseInt;function eR(e){if(typeof e=="number")return e;if(Dc(e))return gg;if(br(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=br(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=qS(e);var n=ZS.test(e);return n||QS.test(e)?tR(e.slice(2),n?2:8):JS.test(e)?gg:+e}var _g=1/0,nR=17976931348623157e292;function rR(e){if(!e)return e===0?e:0;if(e=eR(e),e===_g||e===-_g){var t=e<0?-1:1;return t*nR}return e===e?e:0}function zc(e){var t=rR(e),n=t%1;return t===t?n?t-n:t:0}function lo(e){return e}var iR="[object AsyncFunction]",sR="[object Function]",oR="[object GeneratorFunction]",aR="[object Proxy]";function xi(e){if(!br(e))return!1;var t=Hi(e);return t==sR||t==oR||t==iR||t==aR}var jh=ti["__core-js_shared__"],yg=function(){var e=/[^.]+$/.exec(jh&&jh.keys&&jh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function cR(e){return!!yg&&yg in e}var lR=Function.prototype,uR=lR.toString;function ys(e){if(e!=null){try{return uR.call(e)}catch{}try{return e+""}catch{}}return""}var hR=/[\\^$.*+?()[\]{}|]/g,fR=/^\[object .+?Constructor\]$/,dR=Function.prototype,pR=Object.prototype,mR=dR.toString,gR=pR.hasOwnProperty,_R=RegExp("^"+mR.call(gR).replace(hR,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yR(e){if(!br(e)||cR(e))return!1;var t=xi(e)?_R:fR;return t.test(ys(e))}function bR(e,t){return e==null?void 0:e[t]}function bs(e,t){var n=bR(e,t);return yR(n)?n:void 0}var zh=bs(ti,"WeakMap"),bg=Object.create,kR=function(){function e(){}return function(t){if(!br(t))return{};if(bg)return bg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function wR(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Qe(){}function ER(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var xR=800,vR=16,TR=Date.now;function AR(e){var t=0,n=0;return function(){var r=TR(),i=vR-(r-n);if(n=r,i>0){if(++t>=xR)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function SR(e){return function(){return e}}var Wc=function(){try{var e=bs(Object,"defineProperty");return e({},"",{}),e}catch{}}(),RR=Wc?function(e,t){return Wc(e,"toString",{configurable:!0,enumerable:!1,value:SR(t),writable:!0})}:lo,OR=AR(RR);function kg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function wg(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function NR(e){return e!==e}function IR(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Wh(e,t,n){return t===t?IR(e,t,n):wg(e,NR,n)}function Eg(e,t){var n=e==null?0:e.length;return!!n&&Wh(e,t,0)>-1}var CR=9007199254740991,LR=/^(?:0|[1-9]\d*)$/;function Gc(e,t){var n=typeof e;return t=t??CR,!!t&&(n=="number"||n!="symbol"&&LR.test(e))&&e>-1&&e%1==0&&e<t}function Gh(e,t,n){t=="__proto__"&&Wc?Wc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ca(e,t){return e===t||e!==e&&t!==t}var MR=Object.prototype,UR=MR.hasOwnProperty;function Kc(e,t,n){var r=e[t];(!(UR.call(e,t)&&ca(r,n))||n===void 0&&!(t in e))&&Gh(e,t,n)}function Kh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Gh(n,a,c):Kc(n,a,c)}return n}var xg=Math.max;function FR(e,t,n){return t=xg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=xg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),wR(e,this,a)}}function Hh(e,t){return OR(FR(e,t,lo),e+"")}var BR=9007199254740991;function Yh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=BR}function ei(e){return e!=null&&Yh(e.length)&&!xi(e)}function vg(e,t,n){if(!br(n))return!1;var r=typeof t;return(r=="number"?ei(n)&&Gc(t,n.length):r=="string"&&t in n)?ca(n[t],e):!1}function PR(e){return Hh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&vg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var $R=Object.prototype;function la(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||$R;return e===n}function DR(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var jR="[object Arguments]";function Tg(e){return Cr(e)&&Hi(e)==jR}var Ag=Object.prototype,zR=Ag.hasOwnProperty,WR=Ag.propertyIsEnumerable,Hc=Tg(function(){return arguments}())?Tg:function(e){return Cr(e)&&zR.call(e,"callee")&&!WR.call(e,"callee")};function GR(){return!1}var Sg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Rg=Sg&&typeof module=="object"&&module&&!module.nodeType&&module,KR=Rg&&Rg.exports===Sg,Og=KR?ti.Buffer:void 0,HR=Og?Og.isBuffer:void 0,ua=HR||GR,YR="[object Arguments]",VR="[object Array]",XR="[object Boolean]",qR="[object Date]",JR="[object Error]",ZR="[object Function]",QR="[object Map]",tO="[object Number]",eO="[object Object]",nO="[object RegExp]",rO="[object Set]",iO="[object String]",sO="[object WeakMap]",oO="[object ArrayBuffer]",aO="[object DataView]",cO="[object Float32Array]",lO="[object Float64Array]",uO="[object Int8Array]",hO="[object Int16Array]",fO="[object Int32Array]",dO="[object Uint8Array]",pO="[object Uint8ClampedArray]",mO="[object Uint16Array]",gO="[object Uint32Array]",Ee={};Ee[cO]=Ee[lO]=Ee[uO]=Ee[hO]=Ee[fO]=Ee[dO]=Ee[pO]=Ee[mO]=Ee[gO]=!0,Ee[YR]=Ee[VR]=Ee[oO]=Ee[XR]=Ee[aO]=Ee[qR]=Ee[JR]=Ee[ZR]=Ee[QR]=Ee[tO]=Ee[eO]=Ee[nO]=Ee[rO]=Ee[iO]=Ee[sO]=!1;function _O(e){return Cr(e)&&Yh(e.length)&&!!Ee[Hi(e)]}function Yc(e){return function(t){return e(t)}}var Ng=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ha=Ng&&typeof module=="object"&&module&&!module.nodeType&&module,yO=ha&&ha.exports===Ng,Vh=yO&&ug.process,Yi=function(){try{var e=ha&&ha.require&&ha.require("util").types;return e||Vh&&Vh.binding&&Vh.binding("util")}catch{}}(),Ig=Yi&&Yi.isTypedArray,Xh=Ig?Yc(Ig):_O,bO=Object.prototype,kO=bO.hasOwnProperty;function Cg(e,t){var n=ie(e),r=!n&&Hc(e),i=!n&&!r&&ua(e),s=!n&&!r&&!i&&Xh(e),o=n||r||i||s,a=o?DR(e.length,String):[],c=a.length;for(var l in e)(t||kO.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Gc(l,c)))&&a.push(l);return a}function Lg(e,t){return function(n){return e(t(n))}}var wO=Lg(Object.keys,Object),EO=Object.prototype,xO=EO.hasOwnProperty;function Mg(e){if(!la(e))return wO(e);var t=[];for(var n in Object(e))xO.call(e,n)&&n!="constructor"&&t.push(n);return t}function kr(e){return ei(e)?Cg(e):Mg(e)}var vO=Object.prototype,TO=vO.hasOwnProperty,zn=PR(function(e,t){if(la(t)||ei(t)){Kh(t,kr(t),e);return}for(var n in t)TO.call(t,n)&&Kc(e,n,t[n])});function AO(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var SO=Object.prototype,RO=SO.hasOwnProperty;function OO(e){if(!br(e))return AO(e);var t=la(e),n=[];for(var r in e)r=="constructor"&&(t||!RO.call(e,r))||n.push(r);return n}function Ug(e){return ei(e)?Cg(e,!0):OO(e)}var NO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,IO=/^\w*$/;function qh(e,t){if(ie(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Dc(e)?!0:IO.test(e)||!NO.test(e)||t!=null&&e in Object(t)}var fa=bs(Object,"create");function CO(){this.__data__=fa?fa(null):{},this.size=0}function LO(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var MO="__lodash_hash_undefined__",UO=Object.prototype,FO=UO.hasOwnProperty;function BO(e){var t=this.__data__;if(fa){var n=t[e];return n===MO?void 0:n}return FO.call(t,e)?t[e]:void 0}var PO=Object.prototype,$O=PO.hasOwnProperty;function DO(e){var t=this.__data__;return fa?t[e]!==void 0:$O.call(t,e)}var jO="__lodash_hash_undefined__";function zO(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=fa&&t===void 0?jO:t,this}function ks(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ks.prototype.clear=CO,ks.prototype.delete=LO,ks.prototype.get=BO,ks.prototype.has=DO,ks.prototype.set=zO;function WO(){this.__data__=[],this.size=0}function Vc(e,t){for(var n=e.length;n--;)if(ca(e[n][0],t))return n;return-1}var GO=Array.prototype,KO=GO.splice;function HO(e){var t=this.__data__,n=Vc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():KO.call(t,n,1),--this.size,!0}function YO(e){var t=this.__data__,n=Vc(t,e);return n<0?void 0:t[n][1]}function VO(e){return Vc(this.__data__,e)>-1}function XO(e,t){var n=this.__data__,r=Vc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=WO,vi.prototype.delete=HO,vi.prototype.get=YO,vi.prototype.has=VO,vi.prototype.set=XO;var da=bs(ti,"Map");function qO(){this.size=0,this.__data__={hash:new ks,map:new(da||vi),string:new ks}}function JO(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Xc(e,t){var n=e.__data__;return JO(t)?n[typeof t=="string"?"string":"hash"]:n.map}function ZO(e){var t=Xc(this,e).delete(e);return this.size-=t?1:0,t}function QO(e){return Xc(this,e).get(e)}function tN(e){return Xc(this,e).has(e)}function eN(e,t){var n=Xc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ti.prototype.clear=qO,Ti.prototype.delete=ZO,Ti.prototype.get=QO,Ti.prototype.has=tN,Ti.prototype.set=eN;var nN="Expected a function";function Jh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(nN);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Jh.Cache||Ti),n}Jh.Cache=Ti;var rN=500;function iN(e){var t=Jh(e,function(r){return n.size===rN&&n.clear(),r}),n=t.cache;return t}var sN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oN=/\\(\\)?/g,aN=iN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(sN,function(n,r,i,s){t.push(i?s.replace(oN,"$1"):r||n)}),t});function Fg(e){return e==null?"":mg(e)}function qc(e,t){return ie(e)?e:qh(e,t)?[e]:aN(Fg(e))}var cN=1/0;function pa(e){if(typeof e=="string"||Dc(e))return e;var t=e+"";return t=="0"&&1/e==-cN?"-0":t}function Zh(e,t){t=qc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[pa(t[n++])];return n&&n==r?e:void 0}function lN(e,t,n){var r=e==null?void 0:Zh(e,t);return r===void 0?n:r}function Qh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Bg=yr?yr.isConcatSpreadable:void 0;function uN(e){return ie(e)||Hc(e)||!!(Bg&&e&&e[Bg])}function tf(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=uN),i||(i=[]);++s<o;){var a=e[s];n(a)?Qh(i,a):r||(i[i.length]=a)}return i}function ir(e){var t=e==null?0:e.length;return t?tf(e):[]}var Pg=Lg(Object.getPrototypeOf,Object);function ef(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function hN(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:ef(e,t,n)}var fN="\\ud800-\\udfff",dN="\\u0300-\\u036f",pN="\\ufe20-\\ufe2f",mN="\\u20d0-\\u20ff",gN=dN+pN+mN,_N="\\ufe0e\\ufe0f",yN="\\u200d",bN=RegExp("["+yN+fN+gN+_N+"]");function $g(e){return bN.test(e)}function kN(e){return e.split("")}var Dg="\\ud800-\\udfff",wN="\\u0300-\\u036f",EN="\\ufe20-\\ufe2f",xN="\\u20d0-\\u20ff",vN=wN+EN+xN,TN="\\ufe0e\\ufe0f",AN="["+Dg+"]",nf="["+vN+"]",rf="\\ud83c[\\udffb-\\udfff]",SN="(?:"+nf+"|"+rf+")",jg="[^"+Dg+"]",zg="(?:\\ud83c[\\udde6-\\uddff]){2}",Wg="[\\ud800-\\udbff][\\udc00-\\udfff]",RN="\\u200d",Gg=SN+"?",Kg="["+TN+"]?",ON="(?:"+RN+"(?:"+[jg,zg,Wg].join("|")+")"+Kg+Gg+")*",NN=Kg+Gg+ON,IN="(?:"+[jg+nf+"?",nf,zg,Wg,AN].join("|")+")",CN=RegExp(rf+"(?="+rf+")|"+IN+NN,"g");function LN(e){return e.match(CN)||[]}function MN(e){return $g(e)?LN(e):kN(e)}function UN(e){return function(t){t=Fg(t);var n=$g(t)?MN(t):void 0,r=n?n[0]:t.charAt(0),i=n?hN(n,1).join(""):t.slice(1);return r[e]()+i}}var Hg=UN("toUpperCase");function FN(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function BN(){this.__data__=new vi,this.size=0}function PN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function $N(e){return this.__data__.get(e)}function DN(e){return this.__data__.has(e)}var jN=200;function zN(e,t){var n=this.__data__;if(n instanceof vi){var r=n.__data__;if(!da||r.length<jN-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ti(r)}return n.set(e,t),this.size=n.size,this}function ni(e){var t=this.__data__=new vi(e);this.size=t.size}ni.prototype.clear=BN,ni.prototype.delete=PN,ni.prototype.get=$N,ni.prototype.has=DN,ni.prototype.set=zN;function WN(e,t){return e&&Kh(t,kr(t),e)}var Yg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Vg=Yg&&typeof module=="object"&&module&&!module.nodeType&&module,GN=Vg&&Vg.exports===Yg,Xg=GN?ti.Buffer:void 0,qg=Xg?Xg.allocUnsafe:void 0;function KN(e,t){var n=e.length,r=qg?qg(n):new e.constructor(n);return e.copy(r),r}function sf(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Jg(){return[]}var HN=Object.prototype,YN=HN.propertyIsEnumerable,Zg=Object.getOwnPropertySymbols,of=Zg?function(e){return e==null?[]:(e=Object(e),sf(Zg(e),function(t){return YN.call(e,t)}))}:Jg;function VN(e,t){return Kh(e,of(e),t)}var XN=Object.getOwnPropertySymbols,qN=XN?function(e){for(var t=[];e;)Qh(t,of(e)),e=Pg(e);return t}:Jg;function Qg(e,t,n){var r=t(e);return ie(e)?r:Qh(r,n(e))}function af(e){return Qg(e,kr,of)}function JN(e){return Qg(e,Ug,qN)}var cf=bs(ti,"DataView"),lf=bs(ti,"Promise"),uo=bs(ti,"Set"),t_="[object Map]",ZN="[object Object]",e_="[object Promise]",n_="[object Set]",r_="[object WeakMap]",i_="[object DataView]",QN=ys(cf),tI=ys(da),eI=ys(lf),nI=ys(uo),rI=ys(zh),wr=Hi;(cf&&wr(new cf(new ArrayBuffer(1)))!=i_||da&&wr(new da)!=t_||lf&&wr(lf.resolve())!=e_||uo&&wr(new uo)!=n_||zh&&wr(new zh)!=r_)&&(wr=function(e){var t=Hi(e),n=t==ZN?e.constructor:void 0,r=n?ys(n):"";if(r)switch(r){case QN:return i_;case tI:return t_;case eI:return e_;case nI:return n_;case rI:return r_}return t});var iI=Object.prototype,sI=iI.hasOwnProperty;function oI(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&sI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Jc=ti.Uint8Array;function aI(e){var t=new e.constructor(e.byteLength);return new Jc(t).set(new Jc(e)),t}function cI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var lI=/\w*$/;function uI(e){var t=new e.constructor(e.source,lI.exec(e));return t.lastIndex=e.lastIndex,t}var s_=yr?yr.prototype:void 0,o_=s_?s_.valueOf:void 0;function hI(e){return o_?Object(o_.call(e)):{}}function fI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var dI="[object Boolean]",pI="[object Date]",mI="[object Map]",gI="[object Number]",_I="[object RegExp]",yI="[object Set]",bI="[object String]",kI="[object Symbol]",wI="[object ArrayBuffer]",EI="[object DataView]",xI="[object Float32Array]",vI="[object Float64Array]",TI="[object Int8Array]",AI="[object Int16Array]",SI="[object Int32Array]",RI="[object Uint8Array]",OI="[object Uint8ClampedArray]",NI="[object Uint16Array]",II="[object Uint32Array]";function CI(e,t,n){var r=e.constructor;switch(t){case wI:return aI(e);case dI:case pI:return new r(+e);case EI:return cI(e);case xI:case vI:case TI:case AI:case SI:case RI:case OI:case NI:case II:return fI(e);case mI:return new r;case gI:case bI:return new r(e);case _I:return uI(e);case yI:return new r;case kI:return hI(e)}}function LI(e){return typeof e.constructor=="function"&&!la(e)?kR(Pg(e)):{}}var MI="[object Map]";function UI(e){return Cr(e)&&wr(e)==MI}var a_=Yi&&Yi.isMap,FI=a_?Yc(a_):UI,BI="[object Set]";function PI(e){return Cr(e)&&wr(e)==BI}var c_=Yi&&Yi.isSet,$I=c_?Yc(c_):PI,l_="[object Arguments]",DI="[object Array]",jI="[object Boolean]",zI="[object Date]",WI="[object Error]",u_="[object Function]",GI="[object GeneratorFunction]",KI="[object Map]",HI="[object Number]",h_="[object Object]",YI="[object RegExp]",VI="[object Set]",XI="[object String]",qI="[object Symbol]",JI="[object WeakMap]",ZI="[object ArrayBuffer]",QI="[object DataView]",tC="[object Float32Array]",eC="[object Float64Array]",nC="[object Int8Array]",rC="[object Int16Array]",iC="[object Int32Array]",sC="[object Uint8Array]",oC="[object Uint8ClampedArray]",aC="[object Uint16Array]",cC="[object Uint32Array]",_e={};_e[l_]=_e[DI]=_e[ZI]=_e[QI]=_e[jI]=_e[zI]=_e[tC]=_e[eC]=_e[nC]=_e[rC]=_e[iC]=_e[KI]=_e[HI]=_e[h_]=_e[YI]=_e[VI]=_e[XI]=_e[qI]=_e[sC]=_e[oC]=_e[aC]=_e[cC]=!0,_e[WI]=_e[u_]=_e[JI]=!1;function Zc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!br(e))return e;var a=ie(e);if(a)return o=oI(e),ER(e,o);var c=wr(e),l=c==u_||c==GI;if(ua(e))return KN(e);if(c==h_||c==l_||l&&!i)return o=l?{}:LI(e),VN(e,WN(o,e));if(!_e[c])return i?e:{};o=CI(e,c),s||(s=new ni);var u=s.get(e);if(u)return u;s.set(e,o),$I(e)?e.forEach(function(h){o.add(Zc(h,t,n,h,e,s))}):FI(e)&&e.forEach(function(h,m){o.set(m,Zc(h,t,n,m,e,s))});var f=af,d=a?void 0:f(e);return kg(d||e,function(h,m){d&&(m=h,h=e[m]),Kc(o,m,Zc(h,t,n,m,e,s))}),o}var lC=4;function _n(e){return Zc(e,lC)}function ma(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var uC="__lodash_hash_undefined__";function hC(e){return this.__data__.set(e,uC),this}function fC(e){return this.__data__.has(e)}function ho(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ti;++t<n;)this.add(e[t])}ho.prototype.add=ho.prototype.push=hC,ho.prototype.has=fC;function f_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function uf(e,t){return e.has(t)}var dC=1,pC=2;function d_(e,t,n,r,i,s){var o=n&dC,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&pC?new ho:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var b=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!f_(t,function(k,v){if(!uf(h,v)&&(m===k||i(m,k,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function mC(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function hf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var gC=1,_C=2,yC="[object Boolean]",bC="[object Date]",kC="[object Error]",wC="[object Map]",EC="[object Number]",xC="[object RegExp]",vC="[object Set]",TC="[object String]",AC="[object Symbol]",SC="[object ArrayBuffer]",RC="[object DataView]",p_=yr?yr.prototype:void 0,ff=p_?p_.valueOf:void 0;function OC(e,t,n,r,i,s,o){switch(n){case RC:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case SC:return!(e.byteLength!=t.byteLength||!s(new Jc(e),new Jc(t)));case yC:case bC:case EC:return ca(+e,+t);case kC:return e.name==t.name&&e.message==t.message;case xC:case TC:return e==t+"";case wC:var a=mC;case vC:var c=r&gC;if(a||(a=hf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=_C,o.set(e,t);var u=d_(a(e),a(t),r,i,s,o);return o.delete(e),u;case AC:if(ff)return ff.call(e)==ff.call(t)}return!1}var NC=1,IC=Object.prototype,CC=IC.hasOwnProperty;function LC(e,t,n,r,i,s){var o=n&NC,a=af(e),c=a.length,l=af(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:CC.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var b=o;++f<c;){d=a[f];var k=e[d],v=t[d];if(r)var T=o?r(v,k,d,t,e,s):r(k,v,d,e,t,s);if(!(T===void 0?k===v||i(k,v,n,r,s):T)){p=!1;break}b||(b=d=="constructor")}if(p&&!b){var A=e.constructor,L=t.constructor;A!=L&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof L=="function"&&L instanceof L)&&(p=!1)}return s.delete(e),s.delete(t),p}var MC=1,m_="[object Arguments]",g_="[object Array]",Qc="[object Object]",UC=Object.prototype,__=UC.hasOwnProperty;function FC(e,t,n,r,i,s){var o=ie(e),a=ie(t),c=o?g_:wr(e),l=a?g_:wr(t);c=c==m_?Qc:c,l=l==m_?Qc:l;var u=c==Qc,f=l==Qc,d=c==l;if(d&&ua(e)){if(!ua(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ni),o||Xh(e)?d_(e,t,n,r,i,s):OC(e,t,c,n,r,i,s);if(!(n&MC)){var h=u&&__.call(e,"__wrapped__"),m=f&&__.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,b=m?t.value():t;return s||(s=new ni),i(p,b,n,r,s)}}return d?(s||(s=new ni),LC(e,t,n,r,i,s)):!1}function df(e,t,n,r,i){return e===t?!0:e==null||t==null||!Cr(e)&&!Cr(t)?e!==e&&t!==t:FC(e,t,n,r,df,i)}var BC=1,PC=2;function $C(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ni,f;if(!(f===void 0?df(l,c,BC|PC,r,u):f))return!1}}return!0}function y_(e){return e===e&&!br(e)}function DC(e){for(var t=kr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,y_(i)]}return t}function b_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function jC(e){var t=DC(e);return t.length==1&&t[0][2]?b_(t[0][0],t[0][1]):function(n){return n===e||$C(n,e,t)}}function zC(e,t){return e!=null&&t in Object(e)}function k_(e,t,n){t=qc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=pa(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Yh(i)&&Gc(o,i)&&(ie(e)||Hc(e)))}function WC(e,t){return e!=null&&k_(e,t,zC)}var GC=1,KC=2;function HC(e,t){return qh(e)&&y_(t)?b_(pa(e),t):function(n){var r=lN(n,e);return r===void 0&&r===t?WC(n,e):df(t,r,GC|KC)}}function YC(e){return function(t){return t==null?void 0:t[e]}}function VC(e){return function(t){return Zh(t,e)}}function XC(e){return qh(e)?YC(pa(e)):VC(e)}function ri(e){return typeof e=="function"?e:e==null?lo:typeof e=="object"?ie(e)?HC(e[0],e[1]):jC(e):XC(e)}function qC(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function JC(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var ZC=JC();function QC(e,t){return e&&ZC(e,t,kr)}function tL(e,t){return function(n,r){if(n==null)return n;if(!ei(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ws=tL(QC);function eL(e,t,n,r){return ws(e,function(i,s,o){t(r,i,n(i),o)}),r}function nL(e,t){return function(n,r){var i=ie(n)?qC:eL,s=t?t():{};return i(n,e,ri(r),s)}}var w_=Object.prototype,rL=w_.hasOwnProperty,pf=Hh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&vg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Ug(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ca(u,w_[l])&&!rL.call(e,l))&&(e[l]=s[l])}return e});function E_(e){return Cr(e)&&ei(e)}var iL=200;function sL(e,t,n,r){var i=-1,s=Eg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=iL&&(s=uf,o=!1,t=new ho(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var tl=Hh(function(e,t){return E_(e)?sL(e,tf(t,1,E_,!0)):[]});function fo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function yn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:zc(t),ef(e,t<0?0:t,r)):[]}function ga(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:zc(t),t=r-t,ef(e,0,t<0?0:t)):[]}function oL(e){return typeof e=="function"?e:lo}function Ut(e,t){var n=ie(e)?kg:ws;return n(e,oL(t))}function aL(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function cL(e,t){var n=!0;return ws(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Lr(e,t,n){var r=ie(e)?aL:cL;return r(e,ri(t))}function x_(e,t){var n=[];return ws(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Er(e,t){var n=ie(e)?sf:x_;return n(e,ri(t))}function lL(e){return function(t,n,r){var i=Object(t);if(!ei(t)){var s=ri(n);t=kr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var uL=Math.max;function hL(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:zc(n);return i<0&&(i=uL(r+i,0)),wg(e,ri(t),i)}var po=lL(hL);function Mr(e){return e&&e.length?e[0]:void 0}function fL(e,t){var n=-1,r=ei(e)?Array(e.length):[];return ws(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Tt(e,t){var n=ie(e)?jc:fL;return n(e,ri(t))}function xr(e,t){return tf(Tt(e,t))}var dL=Object.prototype,pL=dL.hasOwnProperty,v_=nL(function(e,t,n){pL.call(e,n)?e[n].push(t):Gh(e,n,[t])}),mL=Object.prototype,gL=mL.hasOwnProperty;function _L(e,t){return e!=null&&gL.call(e,t)}function Mt(e,t){return e!=null&&k_(e,t,_L)}var yL="[object String]";function Wn(e){return typeof e=="string"||!ie(e)&&Cr(e)&&Hi(e)==yL}function bL(e,t){return jc(t,function(n){return e[n]})}function Ve(e){return e==null?[]:bL(e,kr(e))}var kL=Math.max;function Nn(e,t,n,r){e=ei(e)?e:Ve(e),n=n&&!r?zc(n):0;var i=e.length;return n<0&&(n=kL(i+n,0)),Wn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Wh(e,t,n)>-1}function T_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Wh(e,t,i)}var wL="[object Map]",EL="[object Set]",xL=Object.prototype,vL=xL.hasOwnProperty;function ye(e){if(e==null)return!0;if(ei(e)&&(ie(e)||typeof e=="string"||typeof e.splice=="function"||ua(e)||Xh(e)||Hc(e)))return!e.length;var t=wr(e);if(t==wL||t==EL)return!e.size;if(la(e))return!Mg(e).length;for(var n in e)if(vL.call(e,n))return!1;return!0}var TL="[object RegExp]";function AL(e){return Cr(e)&&Hi(e)==TL}var A_=Yi&&Yi.isRegExp,Ai=A_?Yc(A_):AL;function Si(e){return e===void 0}var SL="Expected a function";function RL(e){if(typeof e!="function")throw new TypeError(SL);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function OL(e,t,n,r){if(!br(e))return e;t=qc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=pa(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=br(u)?u:Gc(t[i+1])?[]:{})}Kc(a,c,l),a=a[c]}return e}function NL(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Zh(e,o);n(a,o)&&OL(s,qc(o,e),a)}return s}function Ur(e,t){if(e==null)return{};var n=jc(JN(e),function(r){return[r]});return t=ri(t),NL(e,n,function(r,i){return t(r,i[0])})}function IL(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Gn(e,t,n){var r=ie(e)?FN:IL,i=arguments.length<3;return r(e,ri(t),n,i,ws)}function el(e,t){var n=ie(e)?sf:x_;return n(e,RL(ri(t)))}function CL(e,t){var n;return ws(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function mf(e,t,n){var r=ie(e)?f_:CL;return r(e,ri(t))}var LL=1/0,ML=uo&&1/hf(new uo([,-0]))[1]==LL?function(e){return new uo(e)}:Qe,UL=200;function FL(e,t,n){var r=-1,i=Eg,s=e.length,o=!0,a=[],c=a;if(s>=UL){var l=ML(e);if(l)return hf(l);o=!1,i=uf,c=new ho}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function nl(e){return e&&e.length?FL(e):[]}function gf(e){console&&console.error&&console.error(`Error: ${e}`)}function S_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function R_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function O_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function BL(e){return PL(e)?e.LABEL:e.name}function PL(e){return Wn(e.LABEL)&&e.LABEL!==""}class ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Ut(this.definition,n=>{n.accept(t)})}}class Kn extends ii{constructor(t){super([]),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class mo extends ii{constructor(t){super(t.definition),this.orgText="",zn(this,Ur(t,n=>n!==void 0))}}class Hn extends ii{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,zn(this,Ur(t,n=>n!==void 0))}}class Yn extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class si extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class oi extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class tn extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class Fr extends ii{constructor(t){super(t.definition),this.idx=1,zn(this,Ur(t,n=>n!==void 0))}}class Br extends ii{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,zn(this,Ur(t,n=>n!==void 0))}}class Me{constructor(t){this.idx=1,zn(this,Ur(t,n=>n!==void 0))}accept(t){t.visit(this)}}function $L(e){return Tt(e,rl)}function rl(e){function t(n){return Tt(n,rl)}if(e instanceof Kn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Wn(e.label)&&(n.label=e.label),n}else{if(e instanceof Hn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Yn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof si)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof oi)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:rl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Fr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:rl(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof tn)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Br)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Me){const n={type:"Terminal",name:e.terminalType.name,label:BL(e.terminalType),idx:e.idx};Wn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ai(r)?r.source:r),n}else{if(e instanceof mo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class Es{visit(t){const n=t;switch(n.constructor){case Kn:return this.visitNonTerminal(n);case Hn:return this.visitAlternative(n);case Yn:return this.visitOption(n);case si:return this.visitRepetitionMandatory(n);case oi:return this.visitRepetitionMandatoryWithSeparator(n);case Fr:return this.visitRepetitionWithSeparator(n);case tn:return this.visitRepetition(n);case Br:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case mo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function DL(e){return e instanceof Hn||e instanceof Yn||e instanceof tn||e instanceof si||e instanceof oi||e instanceof Fr||e instanceof Me||e instanceof mo}function il(e,t=[]){return e instanceof Yn||e instanceof tn||e instanceof Fr?!0:e instanceof Br?mf(e.definition,r=>il(r,t)):e instanceof Kn&&Nn(t,e)?!1:e instanceof ii?(e instanceof Kn&&t.push(e),Lr(e.definition,r=>il(r,t))):!1}function jL(e){return e instanceof Br}function ai(e){if(e instanceof Kn)return"SUBRULE";if(e instanceof Yn)return"OPTION";if(e instanceof Br)return"OR";if(e instanceof si)return"AT_LEAST_ONE";if(e instanceof oi)return"AT_LEAST_ONE_SEP";if(e instanceof Fr)return"MANY_SEP";if(e instanceof tn)return"MANY";if(e instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class sl{walk(t,n=[]){Ut(t.definition,(r,i)=>{const s=yn(t.definition,i+1);if(r instanceof Kn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Hn)this.walkFlat(r,s,n);else if(r instanceof Yn)this.walkOption(r,s,n);else if(r instanceof si)this.walkAtLeastOne(r,s,n);else if(r instanceof oi)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Fr)this.walkManySep(r,s,n);else if(r instanceof tn)this.walkMany(r,s,n);else if(r instanceof Br)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Yn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=N_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Yn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=N_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Ut(t.definition,s=>{const o=new Hn({definition:[s]});this.walk(o,i)})}}function N_(e,t,n){return[new Yn({definition:[new Me({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function _a(e){if(e instanceof Kn)return _a(e.referencedRule);if(e instanceof Me)return GL(e);if(DL(e))return zL(e);if(jL(e))return WL(e);throw Error("non exhaustive match")}function zL(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=il(s),t=t.concat(_a(s)),r=r+1,i=n.length>r;return nl(t)}function WL(e){const t=Tt(e.definition,n=>_a(n));return nl(ir(t))}function GL(e){return[e.terminalType]}const I_="_~IN~_";class KL extends sl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=YL(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Hn({definition:s}),a=_a(o);this.follows[i]=a}}function HL(e){const t={};return Ut(e,n=>{const r=new KL(n).startWalking();zn(t,r)}),t}function YL(e,t){return e.name+t+I_}function Ft(e){return e.charCodeAt(0)}function _f(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ya(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function go(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function VL(){throw Error("Internal Error - Should never get here!")}function C_(e){return e.type==="Character"}const ol=[];for(let e=Ft("0");e<=Ft("9");e++)ol.push(e);const al=[Ft("_")].concat(ol);for(let e=Ft("a");e<=Ft("z");e++)al.push(e);for(let e=Ft("A");e<=Ft("Z");e++)al.push(e);const L_=[Ft(" "),Ft("\f"),Ft(`
`),Ft("\r"),Ft("	"),Ft("\v"),Ft("	"),Ft("Â "),Ft("á"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("â"),Ft("\u2028"),Ft("\u2029"),Ft("â¯"),Ft("â"),Ft("ã"),Ft("\uFEFF")],XL=/[0-9a-fA-F]/,cl=/[0-9]/,qL=/[1-9]/;class JL{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ya(r,"global");break;case"i":ya(r,"ignoreCase");break;case"m":ya(r,"multiLine");break;case"u":ya(r,"unicode");break;case"y":ya(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}go(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return VL()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;go(n);break}if(!(t===!0&&n===void 0)&&go(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),go(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ft(`
`),Ft("\r"),Ft("\u2028"),Ft("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=ol;break;case"D":t=ol,n=!0;break;case"s":t=L_;break;case"S":t=L_,n=!0;break;case"w":t=al;break;case"W":t=al,n=!0;break}if(go(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Ft("\f");break;case"n":t=Ft(`
`);break;case"r":t=Ft("\r");break;case"t":t=Ft("	");break;case"v":t=Ft("\v");break}if(go(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ft("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Ft(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Ft(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,C_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,C_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else _f(r.value,t),t.push(Ft("-")),_f(i.value,t)}else _f(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ft("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(qL.test(t)===!1)throw Error("Expecting a positive integer");for(;cl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(cl.test(t)===!1)throw Error("Expecting an integer");for(;cl.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ft(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return cl.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(XL.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class yf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ll={};const ZL=new JL;function ul(e){const t=e.toString();if(ll.hasOwnProperty(t))return ll[t];{const n=ZL.pattern(t);return ll[t]=n,n}}function QL(){ll={}}const M_="Complement Sets are not supported for first char optimization",hl=`Unable to use "first char" lexer optimizations:
`;function t6(e,t=!1){try{const n=ul(e);return bf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===M_)t&&S_(`${hl}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),gf(`${hl}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function bf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)bf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":fl(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(M_);Ut(o.value,c=>{if(typeof c=="number")fl(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)fl(u,t,n);else{for(let u=l.from;u<=l.to&&u<ka;u++)fl(u,t,n);if(l.to>=ka){const u=l.from>=ka?l.from:ka,f=l.to,d=Vi(u),h=Vi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":bf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&kf(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ve(t)}function fl(e,t,n){const r=Vi(e);t[r]=r,n===!0&&e6(e,t)}function e6(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Vi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Vi(i.charCodeAt(0));t[s]=s}}}function U_(e,t){return po(e.value,n=>{if(typeof n=="number")return Nn(t,n);{const r=n;return po(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function kf(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?ie(e.value)?Lr(e.value,kf):kf(e.value):!1}class n6 extends yf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Nn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?U_(t,this.targetCharCodes)===void 0&&(this.found=!0):U_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function wf(e,t){if(t instanceof RegExp){const n=ul(t),r=new n6(e);return r.visit(n),r.found}else return po(t,n=>Nn(e,n.charCodeAt(0)))!==void 0}const xs="PATTERN",ba="defaultMode",dl="modes";let F_=typeof new RegExp("(?:)").sticky=="boolean";function r6(e,t){t=pf(t,{useSticky:F_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{A6()});let r;n("Reject Lexer.NA",()=>{r=el(e,v=>v[xs]===ln.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Tt(r,v=>{const T=v[xs];if(Ai(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Nn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?P_(T):B_(T)}else{if(xi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),L=new RegExp(A);return t.useSticky?P_(L):B_(L)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Tt(r,v=>v.tokenTypeIdx),a=Tt(r,v=>{const T=v.GROUP;if(T!==ln.SKIPPED){if(Wn(T))return T;if(Si(T))return!1;throw Error("non exhaustive match")}}),c=Tt(r,v=>{const T=v.LONGER_ALT;if(T)return ie(T)?Tt(T,L=>T_(r,L)):[T_(r,T)]}),l=Tt(r,v=>v.PUSH_MODE),u=Tt(r,v=>Mt(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=j_(t.lineTerminatorCharacters);f=Tt(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=Tt(r,T=>Mt(T,"LINE_BREAKS")?!!T.LINE_BREAKS:D_(T,v)===!1&&wf(v,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=Tt(r,$_),h=Tt(s,x6),m=Gn(r,(v,T)=>{const A=T.GROUP;return Wn(A)&&A!==ln.SKIPPED&&(v[A]=[]),v},{}),p=Tt(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,k=[];return t.safeMode||n("First Char Optimization",()=>{k=Gn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const L=T.PATTERN.charCodeAt(0),S=Vi(L);Ef(v,S,p[A])}else if(ie(T.START_CHARS_HINT)){let L;Ut(T.START_CHARS_HINT,S=>{const I=typeof S=="string"?S.charCodeAt(0):S,$=Vi(I);L!==$&&(L=$,Ef(v,$,p[A]))})}else if(Ai(T.PATTERN))if(T.PATTERN.unicode)b=!1,t.ensureOptimizations&&gf(`${hl}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const L=t6(T.PATTERN,t.ensureOptimizations);ye(L)&&(b=!1),Ut(L,S=>{Ef(v,S,p[A])})}else t.ensureOptimizations&&gf(`${hl}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:k,hasCustom:i,canBeOptimized:b}}function i6(e,t){let n=[];const r=o6(e);n=n.concat(r.errors);const i=a6(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(s6(s)),n=n.concat(m6(s)),n=n.concat(g6(s,t)),n=n.concat(_6(s)),n}function s6(e){let t=[];const n=Er(e,r=>Ai(r[xs]));return t=t.concat(l6(n)),t=t.concat(f6(n)),t=t.concat(d6(n)),t=t.concat(p6(n)),t=t.concat(u6(n)),t}function o6(e){const t=Er(e,i=>!Mt(i,xs)),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),r=tl(e,t);return{errors:n,valid:r}}function a6(e){const t=Er(e,i=>{const s=i[xs];return!Ai(s)&&!xi(s)&&!Mt(s,"exec")&&!Wn(s)}),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),r=tl(e,t);return{errors:n,valid:r}}const c6=/[^\\][$]/;function l6(e){class t extends yf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Er(e,i=>{const s=i.PATTERN;try{const o=ul(s),a=new t;return a.visit(o),a.found}catch{return c6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function u6(e){const t=Er(e,r=>r.PATTERN.test(""));return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const h6=/[^\\[][\^]|^\^/;function f6(e){class t extends yf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Er(e,i=>{const s=i.PATTERN;try{const o=ul(s),a=new t;return a.visit(o),a.found}catch{return h6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function d6(e){const t=Er(e,r=>{const i=r[xs];return i instanceof RegExp&&(i.multiline||i.global)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function p6(e){const t=[];let n=Tt(e,s=>Gn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Nn(t,a)&&a.PATTERN!==ln.NA&&(t.push(a),o.push(a)),o),[]));n=ma(n);const r=Er(n,s=>s.length>1);return Tt(r,s=>{const o=Tt(s,c=>c.name);return{message:`The same RegExp pattern ->${Mr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function m6(e){const t=Er(e,r=>{if(!Mt(r,"GROUP"))return!1;const i=r.GROUP;return i!==ln.SKIPPED&&i!==ln.NA&&!Wn(i)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function g6(e,t){const n=Er(e,i=>i.PUSH_MODE!==void 0&&!Nn(t,i.PUSH_MODE));return Tt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function _6(e){const t=[],n=Gn(e,(r,i,s)=>{const o=i.PATTERN;return o===ln.NA||(Wn(o)?r.push({str:o,idx:s,tokenType:i}):Ai(o)&&b6(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ut(e,(r,i)=>{Ut(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&y6(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function y6(e,t){if(Ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Mt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function b6(e){return po([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function B_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function P_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function k6(e,t,n){const r=[];return Mt(e,ba)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ba+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Mt(e,dl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+dl+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Mt(e,dl)&&Mt(e,ba)&&!Mt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ba}: <${e.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Mt(e,dl)&&Ut(e.modes,(i,s)=>{Ut(i,(o,a)=>{if(Si(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Mt(o,"LONGER_ALT")){const c=ie(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ut(c,l=>{!Si(l)&&!Nn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function w6(e,t,n){const r=[];let i=!1;const s=ma(ir(Ve(e.modes))),o=el(s,c=>c[xs]===ln.NA),a=j_(n);return t&&Ut(o,c=>{const l=D_(c,a);if(l!==!1){const f={message:T6(c,l),type:l.issue,tokenType:c};r.push(f)}else Mt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):wf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),r}function E6(e){const t={},n=kr(e);return Ut(n,r=>{const i=e[r];if(ie(i))t[r]=[];else throw Error("non exhaustive match")}),t}function $_(e){const t=e.PATTERN;if(Ai(t))return!1;if(xi(t))return!0;if(Mt(t,"exec"))return!0;if(Wn(t))return!1;throw Error("non exhaustive match")}function x6(e){return Wn(e)&&e.length===1?e.charCodeAt(0):!1}const v6={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function D_(e,t){if(Mt(e,"LINE_BREAKS"))return!1;if(Ai(e.PATTERN)){try{wf(t,e.PATTERN)}catch(n){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Wn(e.PATTERN))return!1;if($_(e))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function T6(e,t){if(t.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function j_(e){return Tt(e,n=>Wn(n)?n.charCodeAt(0):n)}function Ef(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ka=256;let pl=[];function Vi(e){return e<ka?e:pl[e]}function A6(){if(ye(pl)){pl=new Array(65536);for(let e=0;e<65536;e++)pl[e]=e>255?255+~~(e/255):e}}function wa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function ml(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let z_=1;const W_={};function Ea(e){const t=S6(e);R6(t),N6(t),O6(t),Ut(t,n=>{n.isParent=n.categoryMatches.length>0})}function S6(e){let t=_n(e),n=e,r=!0;for(;r;){n=ma(ir(Tt(n,s=>s.CATEGORIES)));const i=tl(n,t);t=t.concat(i),ye(i)?r=!1:n=i}return t}function R6(e){Ut(e,t=>{K_(t)||(W_[z_]=t,t.tokenTypeIdx=z_++),H_(t)&&!ie(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),H_(t)||(t.CATEGORIES=[]),I6(t)||(t.categoryMatches=[]),C6(t)||(t.categoryMatchesMap={})})}function O6(e){Ut(e,t=>{t.categoryMatches=[],Ut(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(W_[r].tokenTypeIdx)})})}function N6(e){Ut(e,t=>{G_([],t)})}function G_(e,t){Ut(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ut(t.CATEGORIES,n=>{const r=e.concat(t);Nn(r,n)||G_(r,n)})}function K_(e){return Mt(e,"tokenTypeIdx")}function H_(e){return Mt(e,"CATEGORIES")}function I6(e){return Mt(e,"categoryMatches")}function C6(e){return Mt(e,"categoryMatchesMap")}function L6(e){return Mt(e,"tokenTypeIdx")}const M6={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Be;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const xa={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:M6,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(xa);let ln=class{constructor(t,n=xa){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=R_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=zn({},xa,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===xa.lineTerminatorsPattern)this.config.lineTerminatorsPattern=v6;else if(this.config.lineTerminatorCharacters===xa.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),ie(t)?i={modes:{defaultMode:_n(t)},defaultMode:ba}:(s=!1,i=_n(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(k6(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(w6(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ut(i.modes,(a,c)=>{i.modes[c]=el(a,l=>Si(l))});const o=kr(i.modes);if(Ut(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(i6(a,o))}),ye(this.lexerDefinitionErrors)){Ea(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=r6(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=zn({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Tt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ut(this.lexerDefinitionWarning,a=>{S_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(F_?(this.chopInput=lo,this.match=this.matchWithTest):(this.updateLastIndex=Qe,this.match=this.matchWithExec),s&&(this.handleModes=Qe),this.trackStartLines===!1&&(this.computeNewColumn=lo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{QL()}),this.TRACE_INIT("toFastProperties",()=>{O_(this)})})}tokenize(t,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=Tt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,b,k;const v=t,T=v.length;let A=0,L=0;const S=this.hasCustom?0:Math.floor(t.length/10),I=new Array(S),$=[];let N=this.trackStartLines?1:void 0,z=this.trackStartLines?1:void 0;const J=E6(this.emptyGroups),M=this.trackStartLines,O=this.config.lineTerminatorsPattern;let E=0,C=[],P=[];const F=[],ot=[];Object.freeze(ot);let tt;function st(){return C}function W(Bt){const Wt=Vi(Bt),Dt=P[Wt];return Dt===void 0?ot:Dt}const D=Bt=>{if(F.length===1&&Bt.tokenType.PUSH_MODE===void 0){const Wt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Bt);$.push({offset:Bt.startOffset,line:Bt.startLine,column:Bt.startColumn,length:Bt.image.length,message:Wt})}else{F.pop();const Wt=fo(F);C=this.patternIdxToConfig[Wt],P=this.charCodeToPatternIdxToConfig[Wt],E=C.length;const Dt=this.canModeBeOptimized[Wt]&&this.config.safeMode===!1;P&&Dt?tt=W:tt=st}};function yt(Bt){F.push(Bt),P=this.charCodeToPatternIdxToConfig[Bt],C=this.patternIdxToConfig[Bt],E=C.length,E=C.length;const Wt=this.canModeBeOptimized[Bt]&&this.config.safeMode===!1;P&&Wt?tt=W:tt=st}yt.call(this,n);let X;const at=this.config.recoveryEnabled;for(;A<T;){c=null;const Bt=v.charCodeAt(A),Wt=tt(Bt),Dt=Wt.length;for(r=0;r<Dt;r++){X=Wt[r];const Pt=X.pattern;l=null;const le=X.short;if(le!==!1?Bt===le&&(c=Pt):X.isCustom===!0?(k=Pt.exec(v,A,I,J),k!==null?(c=k[0],k.payload!==void 0&&(l=k.payload)):c=null):(this.updateLastIndex(Pt,A),c=this.match(Pt,t,A)),c!==null){if(a=X.longerAlt,a!==void 0){const qt=a.length;for(s=0;s<qt;s++){const Ne=C[a[s]],$e=Ne.pattern;if(u=null,Ne.isCustom===!0?(k=$e.exec(v,A,I,J),k!==null?(o=k[0],k.payload!==void 0&&(u=k.payload)):o=null):(this.updateLastIndex($e,A),o=this.match($e,t,A)),o&&o.length>c.length){c=o,l=u,X=Ne;break}}}break}}if(c!==null){if(f=c.length,d=X.group,d!==void 0&&(h=X.tokenTypeIdx,m=this.createTokenInstance(c,A,h,X.tokenType,N,z,f),this.handlePayload(m,l),d===!1?L=this.addToken(I,L,m):J[d].push(m)),t=this.chopInput(t,f),A=A+f,z=this.computeNewColumn(z,f),M===!0&&X.canLineTerminator===!0){let Pt=0,le,qt;O.lastIndex=0;do le=O.test(c),le===!0&&(qt=O.lastIndex-1,Pt++);while(le===!0);Pt!==0&&(N=N+Pt,z=f-qt,this.updateTokenEndLineColumnLocation(m,d,qt,Pt,N,z,f))}this.handleModes(X,D,yt,m)}else{const Pt=A,le=N,qt=z;let Ne=at===!1;for(;Ne===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<E;i++){const $e=C[i],x=$e.pattern,lt=$e.short;if(lt!==!1?v.charCodeAt(A)===lt&&(Ne=!0):$e.isCustom===!0?Ne=x.exec(v,A,I,J)!==null:(this.updateLastIndex(x,A),Ne=x.exec(t)!==null),Ne===!0)break}if(p=A-Pt,z=this.computeNewColumn(z,p),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Pt,p,le,qt),$.push({offset:Pt,line:le,column:qt,length:p,message:b}),at===!1)break}}return this.hasCustom||(I.length=L),{tokens:I,groups:J,errors:$}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};ln.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ln.NA=/NOT_APPLICABLE/;function va(e){return Y_(e)?e.LABEL:e.name}function Y_(e){return Wn(e.LABEL)&&e.LABEL!==""}const U6="parent",V_="categories",X_="label",q_="group",J_="push_mode",Z_="pop_mode",Q_="longer_alt",ty="line_breaks",ey="start_chars_hint";function sr(e){return F6(e)}function F6(e){const t=e.pattern,n={};if(n.name=e.name,Si(t)||(n.PATTERN=t),Mt(e,U6))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Mt(e,V_)&&(n.CATEGORIES=e[V_]),Ea([n]),Mt(e,X_)&&(n.LABEL=e[X_]),Mt(e,q_)&&(n.GROUP=e[q_]),Mt(e,Z_)&&(n.POP_MODE=e[Z_]),Mt(e,J_)&&(n.PUSH_MODE=e[J_]),Mt(e,Q_)&&(n.LONGER_ALT=e[Q_]),Mt(e,ty)&&(n.LINE_BREAKS=e[ty]),Mt(e,ey)&&(n.START_CHARS_HINT=e[ey]),n}const vs=sr({name:"EOF",pattern:ln.NA});Ea([vs]);function gl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function B6(e,t){return wa(e,t)}const ny={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Y_(e)?`--> ${va(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Mr(t).image+"'";if(r)return s+r+a;{const c=Gn(e,(d,h)=>d.concat(h),[]),l=Tt(c,d=>`[${Tt(d,h=>va(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Tt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Mr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Tt(e,l=>`[${Tt(l,u=>va(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(ny);const P6={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},Ts={buildDuplicateFoundError(e,t){function n(u){return u instanceof Me?u.terminalType.name:u instanceof Kn?u.nonTerminalName:""}const r=e.name,i=Mr(t),s=i.idx,o=ai(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Tt(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Tt(e.prefixPath,i=>va(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=ai(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Tt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof mo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function $6(e,t){const n=new D6(e,t);return n.resolveRefs(),n.errors}class D6 extends Es{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ut(Ve(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:In.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class j6 extends sl{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=_n(this.path.ruleStack).reverse(),this.occurrenceStack=_n(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class z6 extends j6{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Hn({definition:i});this.possibleTokTypes=_a(s),this.found=!0}}}class _l extends sl{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class W6 extends _l{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class ry extends _l{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class G6 extends _l{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class iy extends _l{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Mr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function xf(e,t,n=[]){n=_n(n);let r=[],i=0;function s(a){return a.concat(yn(e,i+1))}function o(a){const c=xf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Hn)return o(a.definition);if(a instanceof Kn)return o(a.definition);if(a instanceof Yn)r=o(a.definition);else if(a instanceof si){const c=a.definition.concat([new tn({definition:a.definition})]);return o(c)}else if(a instanceof oi){const c=[new Hn({definition:a.definition}),new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Fr){const c=a.definition.concat([new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof tn){const c=a.definition.concat([new tn({definition:a.definition})]);r=o(c)}else{if(a instanceof Br)return Ut(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:yn(e,i)}),r}function sy(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&fo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,b=d.occurrenceStack;if(ye(h))continue;const k=h[0];if(k===i){const v={idx:m,def:yn(h),ruleStack:ga(p),occurrenceStack:ga(b)};f.push(v)}else if(k instanceof Me)if(m<c-1){const v=m+1,T=t[v];if(n(T,k.terminalType)){const A={idx:v,def:yn(h),ruleStack:p,occurrenceStack:b};f.push(A)}}else if(m===c-1)u.push({nextTokenType:k.terminalType,nextTokenOccurrence:k.idx,ruleStack:p,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(k instanceof Kn){const v=_n(p);v.push(k.nonTerminalName);const T=_n(b);T.push(k.idx);const A={idx:m,def:k.definition.concat(s,yn(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(k instanceof Yn){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T={idx:m,def:k.definition.concat(yn(h)),ruleStack:p,occurrenceStack:b};f.push(T)}else if(k instanceof si){const v=new tn({definition:k.definition,idx:k.idx}),T=k.definition.concat([v],yn(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:b};f.push(A)}else if(k instanceof oi){const v=new Me({terminalType:k.separator}),T=new tn({definition:[v].concat(k.definition),idx:k.idx}),A=k.definition.concat([T],yn(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(L)}else if(k instanceof Fr){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new Me({terminalType:k.separator}),A=new tn({definition:[T].concat(k.definition),idx:k.idx}),L=k.definition.concat([A],yn(h)),S={idx:m,def:L,ruleStack:p,occurrenceStack:b};f.push(S)}else if(k instanceof tn){const v={idx:m,def:yn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new tn({definition:k.definition,idx:k.idx}),A=k.definition.concat([T],yn(h)),L={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(L)}else if(k instanceof Br)for(let v=k.definition.length-1;v>=0;v--){const T=k.definition[v],A={idx:m,def:T.definition.concat(yn(h)),ruleStack:p,occurrenceStack:b};f.push(A),f.push(o)}else if(k instanceof Hn)f.push({idx:m,def:k.definition.concat(yn(h)),ruleStack:p,occurrenceStack:b});else if(k instanceof mo)f.push(K6(k,m,p,b));else throw Error("non exhaustive match")}return u}function K6(e,t,n,r){const i=_n(n);i.push(e.name);const s=_n(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function oy(e){if(e instanceof Yn||e==="Option")return Pe.OPTION;if(e instanceof tn||e==="Repetition")return Pe.REPETITION;if(e instanceof si||e==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(e instanceof oi||e==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Fr||e==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(e instanceof Br||e==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function H6(e,t,n,r,i,s){const o=Tf(e,t,n),a=uy(o)?ml:wa;return s(o,r,a,i)}function Y6(e,t,n,r,i,s){const o=Af(e,t,i,n),a=uy(o)?ml:wa;return s(o[0],a,r)}function V6(e,t,n,r){const i=e.length,s=Lr(e,o=>Lr(o,a=>a.length===1));if(t)return function(o){const a=Tt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const b=this.LA(p+1);if(n(b,h[p])===!1)continue t}return c}}};if(s&&!r){const o=Tt(e,c=>ir(c)),a=Gn(o,(c,l,u)=>(Ut(l,f=>{Mt(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ut(f.categoryMatches,d=>{Mt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function X6(e,t,n){const r=Lr(e,s=>s.length===1),i=e.length;if(r&&!n){const s=ir(e);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ut(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class q6 extends sl{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Pe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Pe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class ay extends Es{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Pe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Pe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Pe.ALTERNATION)}}function cy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function vf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function J6(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function ly(e,t){const n=Tt(e,o=>xf([o],1)),r=cy(n.length),i=Tt(n,o=>{const a={};return Ut(o,c=>{const l=vf(c.partialPath);Ut(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=cy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=vf(f);if(J6(i,h,c)||ye(d)||f.length===t){const p=r[c];if(Sf(p,f)===!1){p.push(f);for(let b=0;b<h.length;b++){const k=h[b];i[c][k]=!0}}}else{const p=xf(d,o+1,f);s[c]=s[c].concat(p),Ut(p,b=>{const k=vf(b.partialPath);Ut(k,v=>{i[c][v]=!0})})}}}}return r}function Tf(e,t,n,r){const i=new ay(e,Pe.ALTERNATION,r);return t.accept(i),ly(i.result,n)}function Af(e,t,n,r){const i=new ay(e,n);t.accept(i);const s=i.result,a=new q6(t,e,n).startWalking(),c=new Hn({definition:s}),l=new Hn({definition:a});return ly([c,l],r)}function Sf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function Z6(e,t){return e.length<t.length&&Lr(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function uy(e){return Lr(e,t=>Lr(t,n=>Lr(n,r=>ye(r.categoryMatches))))}function Q6(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Tt(t,n=>Object.assign({type:In.CUSTOM_LOOKAHEAD_VALIDATION},n))}function tM(e,t,n,r){const i=xr(e,c=>eM(c,n)),s=dM(e,t,n),o=xr(e,c=>lM(c,n)),a=xr(e,c=>iM(c,e,r,n));return i.concat(s,o,a)}function eM(e,t){const n=new rM;e.accept(n);const r=n.allProductions,i=v_(r,nM),s=Ur(i,a=>a.length>1);return Tt(Ve(s),a=>{const c=Mr(a),l=t.buildDuplicateFoundError(e,a),u=ai(c),f={message:l,type:In.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=hy(c);return d&&(f.parameter=d),f})}function nM(e){return`${ai(e)}_#_${e.idx}_#_${hy(e)}`}function hy(e){return e instanceof Me?e.terminalType.name:e instanceof Kn?e.nonTerminalName:""}class rM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function iM(e,t,n,r){const i=[];if(Gn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:In.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function sM(e,t,n){const r=[];let i;return Nn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:In.INVALID_RULE_OVERRIDE,ruleName:e})),r}function fy(e,t,n,r=[]){const i=[],s=yl(t.definition);if(ye(s))return[];{const o=e.name;Nn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:In.LEFT_RECURSION,ruleName:o});const c=tl(s,r.concat([e])),l=xr(c,u=>{const f=_n(r);return f.push(u),fy(e,u,n,f)});return i.concat(l)}}function yl(e){let t=[];if(ye(e))return t;const n=Mr(e);if(n instanceof Kn)t.push(n.referencedRule);else if(n instanceof Hn||n instanceof Yn||n instanceof si||n instanceof oi||n instanceof Fr||n instanceof tn)t=t.concat(yl(n.definition));else if(n instanceof Br)t=ir(Tt(n.definition,s=>yl(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=il(n),i=e.length>1;if(r&&i){const s=yn(e);return t.concat(yl(s))}else return t}class Rf extends Es{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function oM(e,t){const n=new Rf;e.accept(n);const r=n.alternations;return xr(r,s=>{const o=ga(s.definition);return xr(o,(a,c)=>{const l=sy([a],[],wa,1);return ye(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:In.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function aM(e,t,n){const r=new Rf;e.accept(r);let i=r.alternations;return i=el(i,o=>o.ignoreAmbiguities===!0),xr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=Tf(a,e,c,o),u=hM(l,o,e,n),f=fM(l,o,e,n);return u.concat(f)})}class cM extends Es{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function lM(e,t){const n=new Rf;e.accept(n);const r=n.alternations;return xr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:In.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function uM(e,t,n){const r=[];return Ut(e,i=>{const s=new cM;i.accept(s);const o=s.allProductions;Ut(o,a=>{const c=oy(a),l=a.maxLookahead||t,u=a.idx,d=Af(u,i,c,l)[0];if(ye(ir(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:In.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function hM(e,t,n,r){const i=[],s=Gn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Ut(c,u=>{const f=[l];Ut(e,(d,h)=>{l!==h&&Sf(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!Sf(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Tt(s,a=>{const c=Tt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:In.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function fM(e,t,n,r){const i=Gn(e,(o,a,c)=>{const l=Tt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return ma(xr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Er(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&Z6(d.path,l));return Tt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:In.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function dM(e,t,n){const r=[],i=Tt(t,s=>s.name);return Ut(e,s=>{const o=s.name;if(Nn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:In.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function pM(e){const t=pf(e,{errMsgProvider:P6}),n={};return Ut(e.rules,r=>{n[r.name]=r}),$6(n,t.errMsgProvider)}function mM(e){return e=pf(e,{errMsgProvider:Ts}),tM(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const dy="MismatchedTokenException",py="NoViableAltException",my="EarlyExitException",gy="NotAllInputParsedException",_y=[dy,py,my,gy];Object.freeze(_y);function bl(e){return Nn(_y,e.name)}class kl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class yy extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=dy}}class gM extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=py}}class _M extends kl{constructor(t,n){super(t,n),this.name=gy}}class yM extends kl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=my}}const Of={},by="InRuleRecoveryException";class bM extends Error{constructor(t){super(t),this.name=by}}class kM{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Mt(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=wM)}getTokenToInsert(t){const n=gl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new yy(h,l,this.LA(0));m.resyncedTokens=ga(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new bM("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ye(n))return!1;const r=this.LA(1);return po(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Nn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=po(t,s=>B6(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Of;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Tt(t,(r,i)=>i===0?Of:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Tt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ir(t)}getFollowSetFromFollowKey(t){if(t===Of)return[vs];const n=t.ruleName+t.idxInCallingRule+I_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,vs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ga(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=_n(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Tt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function wM(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=vs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const EM=4,Xi=8,ky=1<<Xi,wy=2<<Xi,Nf=3<<Xi,If=4<<Xi,Cf=5<<Xi,wl=6<<Xi;function Lf(e,t,n){return n|t|e}class xM{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return xr(t,n=>fy(n,n,Ts))}validateEmptyOrAlternatives(t){return xr(t,n=>oM(n,Ts))}validateAmbiguousAlternationAlternatives(t,n){return xr(t,r=>aM(r,n,Ts))}validateSomeNonEmptyLookaheadPath(t,n){return uM(t,n,Ts)}buildLookaheadForAlternation(t){return H6(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,V6)}buildLookaheadForOptional(t){return Y6(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,oy(t.prodType),X6)}}class vM{initLooksAhead(t){this.dynamicTokensEnabled=Mt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Mt(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Mt(t,"lookaheadStrategy")?t.lookaheadStrategy:new xM({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Ut(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=AM(n);Ut(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${ai(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Lf(this.fullRuleNameToShort[n.name],ky,l.idx);this.setLaFuncCache(d,f)})}),Ut(i,l=>{this.computeLookaheadFunc(n,l.idx,Nf,"Repetition",l.maxLookahead,ai(l))}),Ut(s,l=>{this.computeLookaheadFunc(n,l.idx,wy,"Option",l.maxLookahead,ai(l))}),Ut(o,l=>{this.computeLookaheadFunc(n,l.idx,If,"RepetitionMandatory",l.maxLookahead,ai(l))}),Ut(a,l=>{this.computeLookaheadFunc(n,l.idx,wl,"RepetitionMandatoryWithSeparator",l.maxLookahead,ai(l))}),Ut(c,l=>{this.computeLookaheadFunc(n,l.idx,Cf,"RepetitionWithSeparator",l.maxLookahead,ai(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Lf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Lf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class TM extends Es{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const El=new TM;function AM(e){El.reset(),e.accept(El);const t=El.dslMethods;return El.reset(),t}function Ey(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function xy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function SM(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function RM(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const OM="name";function vy(e,t){Object.defineProperty(e,OM,{enumerable:!1,configurable:!0,writable:!1,value:t})}function NM(e,t){const n=kr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function IM(e,t){const n=function(){};vy(n,e+"BaseSemantics");const r={visit:function(i,s){if(ie(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=LM(this,t);if(!ye(i)){const s=Tt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function CM(e,t,n){const r=function(){};vy(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ut(t,s=>{i[s]=NM}),r.prototype=i,r.prototype.constructor=r,r}var Mf;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Mf||(Mf={}));function LM(e,t){return MM(e,t)}function MM(e,t){const n=Er(t,i=>xi(e[i])===!1),r=Tt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Mf.MISSING_METHOD,methodName:i}));return ma(r)}class UM{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Mt(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Qe,this.cstFinallyStateUpdate=Qe,this.cstPostTerminal=Qe,this.cstPostNonTerminal=Qe,this.cstPostRule=Qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=xy,this.setNodeLocationFromNode=xy,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Ey,this.setNodeLocationFromNode=Ey,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=Qe,this.setInitialNodeLocation=Qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];SM(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];RM(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const t=IM(this.className,kr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const t=CM(this.className,kr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class FM{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Tl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Tl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class BM{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Al){if(Nn(this.definedRulesNames,t)){const o={message:Ts.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:In.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Al){const i=sM(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(bl(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return $L(Ve(this.gastProductionsCache))}}class PM{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ml,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Mt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(ie(t)){if(ye(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(ie(t))this.tokensMap=Gn(t,(s,o)=>(s[o.name]=o,s),{});else if(Mt(t,"modes")&&Lr(ir(Ve(t.modes)),L6)){const s=ir(Ve(t.modes)),o=nl(s);this.tokensMap=Gn(o,(a,c)=>(a[c.name]=c,a),{})}else if(br(t))this.tokensMap=_n(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=vs;const r=Mt(t,"modes")?ir(Ve(t.modes)):Ve(t),i=Lr(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?ml:wa,Ea(Ve(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Mt(r,"resyncEnabled")?r.resyncEnabled:Al.resyncEnabled,s=Mt(r,"recoveryValueFunc")?r.recoveryValueFunc:Al.recoveryValueFunc,o=this.ruleShortNameIdx<<EM+Xi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(bl(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(wy,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(If,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,If,t,G6)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(wl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,iy],a,wl,t,iy)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Nf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Nf,t,W6,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Cf,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ry],a,Cf,t,ry)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,wl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(ky,n),i=ie(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new _M(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw bl(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new yy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===by?r:s}}else throw r}saveRecogState(){const t=this.errors,n=_n(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),vs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class $M{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Mt(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(bl(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:_n(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return _n(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Af(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new yM(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Tf(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new gM(c,this.LA(1),a))}}class DM{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Si(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return sy([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Mr(t.ruleStack),i=this.getGAstProductions()[n];return new z6(i,t).startWalking()}}const xl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(xl);const Ty=!0,Ay=Math.pow(2,Xi)-1,Sy=sr({name:"RECORDING_PHASE_TOKEN",pattern:ln.NA});Ea([Sy]);const Ry=gl(Sy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Ry);const jM={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class zM{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Tl}topLevelRuleRecord(t,n){try{const r=new mo({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Ta.call(this,Yn,t,n)}atLeastOneInternalRecord(t,n){Ta.call(this,si,n,t)}atLeastOneSepFirstInternalRecord(t,n){Ta.call(this,oi,n,t,Ty)}manyInternalRecord(t,n){Ta.call(this,tn,n,t)}manySepFirstInternalRecord(t,n){Ta.call(this,Fr,n,t,Ty)}orInternalRecord(t,n){return WM.call(this,t,n)}subruleInternalRecord(t,n,r){if(vl(n),!t||Mt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Oy(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=fo(this.recordingProdStack),s=t.ruleName,o=new Kn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?jM:xl}consumeInternalRecord(t,n,r){if(vl(n),!K_(t)){const o=new Error(`<CONSUME${Oy(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=fo(this.recordingProdStack),s=new Me({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Ry}}function Ta(e,t,n,r=!1){vl(n);const i=fo(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Mt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),xl}function WM(e,t){vl(t);const n=fo(this.recordingProdStack),r=ie(e)===!1,i=r===!1?e:e.DEF,s=new Br({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Mt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=mf(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ut(i,a=>{const c=new Hn({definition:[]});s.definition.push(c),Mt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Mt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),xl}function Oy(e){return e===0?"":`${e}`}function vl(e){if(e<0||e>Ay){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Ay+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class GM{initPerformanceTracer(t){if(Mt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=R_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function KM(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const Tl=gl(vs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Tl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:ny,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Al=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var In;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(In||(In={}));let Uf=class sE{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{O_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ut(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=pM({rules:Ve(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=mM({rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),errMsgProvider:Ts,grammarName:n}),s=Q6({lookaheadStrategy:this.lookaheadStrategy,rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=HL(Ve(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ve(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ve(this.gastProductionsCache))})),!sE.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw t=Tt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Mt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Mt(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Uf.DEFER_DEFINITION_ERRORS_HANDLING=!1,KM(Uf,[kM,vM,UM,FM,PM,BM,$M,DM,zM,GM]);class HM extends Uf{constructor(t,n=Ri){const r=_n(n);r.outputCst=!0,super(t,r)}}function YM(e){const t=new VM,n=Ve(e);return Tt(n,r=>t.visitRule(r))}class VM extends Es{visitRule(t){const n=this.visitEach(t.definition),r=v_(n,s=>s.propertyName),i=Tt(r,(s,o)=>{const a=!mf(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Tt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Sl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Sl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Sl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Sl(t)}]}visitEachAndOverrideWith(t,n){return Tt(this.visitEach(t),r=>zn({},r,n))}visitEach(t){return ir(Tt(t,n=>this.visit(n)))}}function Sl(e){return e instanceof Kn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function XM(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(ir(Tt(e,r=>qM(r)))),t.includeVisitorInterface&&(n=n.concat(tU(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function qM(e){const t=JM(e),n=ZM(e);return[t,n]}function JM(e){const t=Iy(e.name),n=Ff(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function ZM(e){return`export type ${Ff(e.name)} = {
  ${Tt(e.properties,n=>QM(n)).join(`
  `)}
};`}function QM(e){const t=nU(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function tU(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Tt(t,n=>eU(n)).join(`
  `)}
}`}function eU(e){const t=Ff(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function nU(e){if(ie(e)){const t=nl(Tt(e,r=>Ny(r)));return"("+Gn(t,(r,i)=>r+" | "+i)+")"}else return Ny(e)}function Ny(e){return e.kind==="token"?"IToken":Iy(e.name)}function Iy(e){return Hg(e)+"CstNode"}function Ff(e){return Hg(e)+"CstChildren"}const rU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function iU(e,t){const n=Object.assign(Object.assign({},rU),t),r=YM(e);return XM(r,n)}const Aa=km(32,126).map(e=>String.fromCharCode(e));function Kt(e){return sr({...e,name:`token_${e.name}`})}function ut(e){return Kt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Xe})}const Rl=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),sU=Kt({name:"whitespace",pattern:/ +/,group:ln.SKIPPED}),oU=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ln.SKIPPED}),Bf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),_o=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Cy=!1;const Ly="@#/?':!";function aU(e,t){if(!Cy)return null;let n=t;if(Ly.includes(e[n-1]))return null;for(;e[n]===" ";)n++;if(Ly.includes(e[n]))return null;for(;n>0&&`@#':!/?
`.includes(e[n])===!1;)n--;switch(e[n]){case"?":case"/":case`
`:break;case"@":case"#":case"'":case":":case"!":return null}let r=t;for(;r<e.length&&e[r]!==`
`;)r++;const i=e.substring(t,r);return i.trim().length===0?null:[i]}const My=Kt({name:"text",pattern:aU,line_breaks:!1,start_chars_hint:Aa.filter(e=>"@#/?':!".includes(e)===!1)}),Uy=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Pf=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Fy=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),By=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Xe=Kt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Aa}),Ol=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),$f=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Py=ut("isterrain"),$y=ut("isobject"),Dy=ut("issolid"),jy=ut("iswalk"),zy=ut("isswim"),Wy=ut("isbullet"),Gy=ut("iswalking"),Ky=ut("iswalkable"),Hy=ut("isswimming"),Yy=ut("isswimmable"),Vy=ut("black"),Xy=ut("dkblue"),qy=ut("dkgreen"),Jy=ut("dkcyan"),Zy=ut("dkred"),Qy=ut("dkpurple"),tb=ut("dkyellow"),eb=ut("ltgray"),nb=ut("dkgray"),rb=ut("blue"),ib=ut("green"),sb=ut("cyan"),ob=ut("red"),ab=ut("purple"),cb=ut("yellow"),lb=ut("white"),ub=ut("brown"),hb=ut("dkwhite"),fb=ut("ltgrey"),db=ut("gray"),pb=ut("grey"),mb=ut("dkgrey"),gb=ut("ltblack"),_b=ut("onblack"),yb=ut("ondkblue"),bb=ut("ondkgreen"),kb=ut("ondkcyan"),wb=ut("ondkred"),Eb=ut("ondkpurple"),xb=ut("ondkyellow"),vb=ut("onltgray"),Tb=ut("ondkgray"),Ab=ut("onblue"),Sb=ut("ongreen"),Rb=ut("oncyan"),Ob=ut("onred"),Nb=ut("onpurple"),Ib=ut("onyellow"),Cb=ut("onwhite"),Lb=ut("onbrown"),Mb=ut("ondkwhite"),Ub=ut("onltgrey"),Fb=ut("ongray"),Bb=ut("ongrey"),Pb=ut("ondkgrey"),$b=ut("onltblack"),Db=ut("onclear"),jb=ut("idle"),zb=ut("up"),Wb=ut("down"),Gb=ut("left"),Kb=ut("right"),Hb=ut("by"),Yb=ut("at"),Vb=ut("flow"),Xb=ut("seek"),qb=ut("rndns"),Jb=ut("rndne"),Zb=ut("rnd"),Qb=ut("cw"),t1=ut("ccw"),e1=ut("opp"),n1=ut("rndp"),r1=ut("away"),i1=ut("toward"),s1=ut("find"),o1=ut("flee"),a1=ut("to"),c1=ut("i"),l1=ut("u"),u1=ut("north"),h1=ut("n"),f1=ut("d"),d1=ut("south"),p1=ut("s"),m1=ut("l"),g1=ut("west"),_1=ut("w"),y1=ut("r"),b1=ut("east"),k1=ut("e"),w1=ut("over"),E1=ut("under"),x1=Kt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Xe}),v1=ut("contact"),T1=ut("blocked"),A1=ut("any"),S1=ut("count"),R1=ut("abs"),O1=ut("intceil"),N1=ut("intfloor"),I1=ut("intround"),C1=ut("clamp"),L1=ut("min"),M1=ut("max"),U1=ut("pick"),F1=ut("pickwith"),B1=ut("random"),P1=ut("randomwith"),$1=ut("run"),D1=ut("runwith"),j1=Kt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),z1=Kt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Xe}),W1=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Xe}),G1=Kt({name:"islessthan",pattern:/<|below/i,longer_alt:Xe}),K1=Kt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Xe}),H1=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Xe}),Y1=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Xe}),Df=Kt({name:"or",pattern:/or/i,longer_alt:Xe}),jf=Kt({name:"not",pattern:/not/i,longer_alt:Xe}),zf=Kt({name:"and",pattern:/and/i,longer_alt:Xe}),Wf=Kt({name:"plus",pattern:/\+/}),Gf=Kt({name:"minus",pattern:/-/}),V1=Kt({name:"power",pattern:/\*\*/}),X1=Kt({name:"multiply",pattern:/\*/}),Kf=Kt({name:"divide",pattern:/\//}),q1=Kt({name:"moddivide",pattern:/%/}),J1=Kt({name:"floordivide",pattern:/%%/}),Z1=Kt({name:"query",pattern:/\?/}),Q1=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),tk=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),ek=Kt({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Aa,longer_alt:Xe}),nk=Kt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Aa,longer_alt:Xe}),rk=Kt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Aa,longer_alt:Xe}),Hf=Kt({name:"if",pattern:/if|try|take|give/i,longer_alt:Xe}),Nl=ut("do"),Yf=ut("done"),Vf=ut("else"),ik=ut("while"),sk=ut("repeat"),ok=ut("waitfor"),ak=Kt({name:"foreach",pattern:/foreach|for/i,longer_alt:Xe}),ck=ut("break"),lk=ut("continue");function uk(e){return[Wb,...e,$f,Py,$y,Dy,Ky,Gy,jy,Yy,Hy,zy,Wy,Vy,Xy,qy,Jy,Zy,Qy,tb,eb,nb,rb,ib,sb,ob,ab,cb,lb,ub,hb,fb,db,pb,mb,gb,_b,yb,bb,kb,wb,Eb,xb,vb,Tb,Ab,Sb,Rb,Ob,Nb,Ib,Cb,Lb,Mb,Ub,Fb,Bb,Pb,$b,Db,jb,zb,Gb,Kb,Hb,Yb,Vb,Xb,n1,qb,Jb,Zb,Qb,t1,e1,r1,i1,s1,o1,a1,u1,d1,g1,b1,w1,E1,x1,v1,T1,A1,S1,R1,O1,N1,I1,C1,L1,M1,F1,U1,P1,B1,D1,$1,j1,z1,W1,H1,G1,Y1,K1,Df,jf,zf,Wf,Gf,V1,X1,Kf,J1,q1,Z1,Q1,tk,c1,l1,h1,f1,p1,m1,_1,y1,k1,Ol,Xe]}const hk=uk([My,Bf,ek,nk,rk,_o,Uy,Pf,Fy,By,Rl,sU,ck,lk,Yf,Nl,Vf,ak,Hf,sk,ok,ik]),cU=new ln({defaultMode:"use_newlines",modes:{use_newlines:hk,ignore_newlines:uk([oU])}},{skipValidations:!Zr,ensureOptimizations:Zr,positionTracking:"full"});function fk(e){Cy=!0;const t=cU.tokenize(e||` 
`),[n]=(ue(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(gl(Rl,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function lU(e,t,n=!0){if(n){const[r,...i]=t;switch(It(r??"")){default:return{type:At.OBJECT,values:t};case"loader":return{type:At.LOADER,values:i};case"board":return{type:At.BOARD,values:i};case"object":return{type:At.OBJECT,values:i};case"terrain":return{type:At.TERRAIN,values:i};case"charset":return{type:At.CHARSET,values:i};case"palette":return{type:At.PALETTE,values:i}}}else{const[r,i,...s]=t,o=It(i??""),a=[r,e,...s];switch(o){default:return{type:At.CONST,values:t};case"rn":case"range":return{type:At.RANGE,values:a};case"sl":case"select":return{type:At.SELECT,values:a};case"nm":case"number":return{type:At.NUMBER,values:a};case"tx":case"text":return{type:At.TEXT,values:a};case"hk":case"hotkey":return{type:At.HOTKEY,values:a};case"copyit":return{type:At.COPYIT,values:a};case"openit":return{type:At.OPENIT,values:a};case"zssedit":return{type:At.ZSSEDIT,values:a};case"charedit":return{type:At.CHAREDIT,values:a};case"coloredit":return{type:At.COLOREDIT,values:a}}}}function or(e){switch(e){case At.LOADER:return"loader";case At.BOARD:return"board";case At.OBJECT:return"object";case At.TERRAIN:return"terrain";case At.CHARSET:return"charset";case At.PALETTE:return"palette";case At.CONST:return"const";case At.RANGE:return"range";case At.SELECT:return"select";case At.NUMBER:return"number";case At.TEXT:return"text";case At.HOTKEY:return"hotkey";case At.COPYIT:return"copyit";case At.OPENIT:return"openit";case At.ZSSEDIT:return"zssedit";case At.CHAREDIT:return"charedit";case At.COLOREDIT:return"coloredit"}}var Xf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Xf||{});function dk(e){return co(e,Xf,{bits:t=>Array.from(t)})}function pk(e){return sa(e,Xf,{bits:t=>new Uint8Array(t)})}function mk(e,t){return{id:De(),code:e,...t}}var qf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(qf||{});function uU(e){return co(e,qf,{board:JP,object:Pc,terrain:Pc,charset:dk,palette:dk,stats:Ae})}function hU(e){return sa(e,qf,{board:ZP,object:$c,terrain:$c,charset:pk,palette:pk})}function Sa(e){const t={...As(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function fU(e){return y(e)?(e.stats=void 0,As(e)):{}}function Jf(e){const t=fk(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Bf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=lU(gt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case At.LOADER:n.type=bt.LOADER,n.name=f;break;case At.BOARD:n.type=bt.BOARD,n.name=f;break;case At.OBJECT:n.type=bt.OBJECT,n.name=f||"object";break;case At.TERRAIN:n.type=bt.TERRAIN,n.name=f;break;case At.CHARSET:n.type=bt.CHARSET,n.name=f;break;case At.PALETTE:n.type=bt.PALETTE,n.name=f;break;case At.CONST:{const[d,...h]=u.values;if(gt(d)){const m=It(d),p=h.join(" ");if(gt(p)){const b=parseFloat(p);n[m]=Et(b)?b:p}else n[m]=1}break}case At.RANGE:case At.SELECT:case At.NUMBER:case At.TEXT:case At.HOTKEY:case At.ZSSEDIT:case At.CHAREDIT:case At.COLOREDIT:{const[d,...h]=u.values;if(gt(d)){const m=It(d);n[m]=[or(u.type),...h]}break}}}}return n}function As(e){var t;return y(e)?(y((t=e.stats)==null?void 0:t.type)||(e.stats=Jf(e.code),y(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function gk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return or(At.LOADER);case bt.BOARD:return or(At.BOARD);case bt.OBJECT:return or(At.OBJECT);case bt.TERRAIN:return or(At.TERRAIN);case bt.CHARSET:return or(At.CHARSET);case bt.PALETTE:return or(At.PALETTE)}}function ci(e){return As(e).type??bt.ERROR}function Oi(e){return gk(ci(e))}function Ue(e){return As(e).name??""}function Zf(e,t){return As(e)[t]}const Il=new Th;function dU(e){if(!gt(e))return;const t=Qo(e);if(y(t)&&y(Lt[t]))return Lt[t];const n=It(e),r=pt[n];if(y(r))return r}function Cl(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ue(s))switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":case"displaychar":t[i]=e[i];break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":t[i]=dU(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=e[i];break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=zt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=zt.ISSWIM;break;case"issolid":t.collision=zt.ISSOLID;break;case"isbullet":t.collision=zt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Se(e){var t;if(y(e))switch(ci(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{y(e.board)||(e.board=eu()),e.board.id=e.id;const n=Sa(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),Et(n.startx)&&(e.board.startx=n.startx),Et(n.starty)&&(e.board.starty=n.starty),gt(n.over)&&(It(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),gt(n.under)&&(It(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),gt(n.camera)&&(It(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),gt(n.graphics)&&(It(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),Et(n.facing)&&(e.board.facing=n.facing),gt(n.facing)&&It(n.facing)==="empty"&&(e.board.facing=void 0),gt(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),gt(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),gt(n.exitwest)&&(e.board.exitwest=n.exitwest),gt(n.exiteast)&&(e.board.exiteast=n.exiteast),Et(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),Et(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case bt.OBJECT:return y(e.object)||(e.object=og()),e.object.id=e.id,e.object.code=e.code,e.object.name=Ue(e),e.object.category=Pn.ISOBJECT,Cl(Sa(e),e.object),e.object;case bt.TERRAIN:return y(e.terrain)||(e.terrain=og()),e.terrain.id=e.id,e.terrain.name=Ue(e),e.terrain.category=Pn.ISTERRAIN,Cl(Sa(e),e.terrain),e.terrain;case bt.PALETTE:{if(y(e.palette)||(e.palette=cg(US)),y((t=e.palette)==null?void 0:t.bits)){const n=Sa(e),r=Zn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&gt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Il.set(o);const c=a*Oc,l=Il.r*63,u=Il.g*63,f=Il.b*63;e.palette.bits[c+0]=gn(l,0,63),e.palette.bits[c+1]=gn(u,0,63),e.palette.bits[c+2]=gn(f,0,63)}}}}return e.palette}case bt.CHARSET:return y(e.charset)||(e.charset=lg(MS)),e.charset}}function Qf(e){return{id:De(),name:kE(),timestamp:0,activelist:[],pages:e,flags:{}}}var td=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(td||{});function pU(e){return co(e,td,{pages:t=>t.map(uU),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function mU(e){return sa(e,td,{pages:t=>t.map(hU)})}function _k(e){y(e)&&(e.token=`${wE()}${pr(1111,9999)}`)}function Ss(e,t){if(!y(e))return;const n=It(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function en(e,t,n){if(!y(e))return;const r=It(n);return e.pages.find(s=>ci(s)===t&&(s.id===n||r===Ue(s)))}function ed(e,t,n){let r=en(e,t,n);if(!y(r)){const i=gk(t);return r=mk(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),nd(e,r),[r,!0]}return[r,!1]}function Rs(e,t){return y(e)?e.pages.filter(n=>ci(n)===t):[]}function yk(e,t,n){if(!y(e))return[];const r=It(n);return e.pages.filter(s=>ci(s)===t).filter(s=>{const o=As(s),a=It(Ue(s));return s.id===n||r===a||y(o[n])})}function Ra(e){return y(e)?Ar(e.pages).sort((n,r)=>{const i=ci(n),s=ci(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function bk(e,t){if(y(t)){const n=en(e,bt.TERRAIN,t.kind??"");if(y(n))return n;const r=en(e,bt.OBJECT,t.kind??"");if(y(r))return r}}function nd(e,t){if(!y(e)||!y(t))return!1;const n=Ss(e,t.id);return y(n)?!1:(e.pages.push(t),_k(e),!0)}function kk(e,t){const n=Ss(e,t);if(y(e)&&y(n)){const r=It(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),_k(e),n}}function nn(e,t=1,n=Lt.WHITE,r=Lt.BLACK){const i=e==null?void 0:e.kinddata;return{name:It((e==null?void 0:e.name)??(i==null?void 0:i.name)),char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function gU(e,t){return!!(e!=null&&e.flags[t])}function Ni(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function wk(e,t){e&&delete e.flags[t]}function Ek(e,t,n){const r=Ni(e,t);return r==null?void 0:r[n]}function _U(e,t,n,r){const i=Ni(e,t);return i&&(i[n]=r),r}function Re(e){if(!y(e)||y(e.lookup)&&y(e.named))return;const t=new Array(St*Vt).fill(void 0),n={},r=Object.values(e.objects);for(let o=0;o<r.length;++o){const a=r[o];if(y(a.x)&&y(a.y)&&y(a.id)&&!y(a.removed)){a.category=Pn.ISOBJECT,t[a.x+a.y*St]=a.id,gt(a.code)&&!y(a.name)&&Cl(Jf(a.code),a);const c=nn(lr(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];if(y(a)){a.x=i,a.y=s,a.category=Pn.ISTERRAIN;const c=nn(lr(a));n[c.name]||(n[c.name]=new Set),n[c.name].add(o)}++i,i>=St&&(i=0,++s)}e.lookup=t,e.named=n}function Oa(e){y(e)&&(delete e.named,delete e.lookup,Re(e))}function xk(e,t,n){var i;if(!y(e)||!y(e.named)||!y(t))return;const r=It(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function yU(e,t){if(!(!y(e)||!y(e.lookup)||!y(t==null?void 0:t.id))&&!y(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*St]=t.id}}function bU(e,t){var n;if(y(e)&&y(t==null?void 0:t.x)&&y(t.y)){const r=nn(t),i=zr(e,t);y((n=e.named)==null?void 0:n[r.name])&&e.named[r.name].delete(i)}}function rd(e,t){var n;if(y(e)&&y(t==null?void 0:t.id)){if(y(e.lookup)&&y(t.x)&&y(t.y)){const i=t.x+t.y*St;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=nn(t);y((n=e.named)==null?void 0:n[r.name])&&y(t.id)&&e.named[r.name].delete(t.id)}}function id(e,t,n,r=!1){if(!y(e)||!y(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return!0;const i=n.x+n.y*St,s=Un(e,e.lookup[i]??"404");if(y(s))return!(r&&bn(s.id));const o=e.terrain[i];return y(o)?$a(t,Gt(o,"collision")):!1}function kU(e,t,n){const r=Un(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Gt(r,"collision");return id(e,o,n)}function sd(e,t,n){var d;const r=Un(e,(t==null?void 0:t.id)??"");if(!y(e)||!y(r)||!y(r.x)||!y(r.y)||!y(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return{name:"edge",kind:"edge",collision:zt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=zr(e,r),s=zr(e,n),o=Gt(r,"collision"),a=bn(r==null?void 0:r.id),c=Gt(r,"collision")===zt.ISBULLET,l=Un(e,e.lookup[s]??""),u=bn((l==null?void 0:l.id)??"");if(y(l)&&(!a||!u)){const h=Gt(r,"group"),m=Gt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Gt(l,"breakable");if(c&&p)return r.x=n.x,r.y=n.y,{...l};if(o===zt.ISBULLET)return{...l};const b=!!Gt(l,"item");if(Nd(r,l)&&(!a||!b)){const v=mr({x:r.x,y:r.y},n),T=ze({x:l.x??0,y:l.y??0},v),A=sd(e,l,T);if(y(A))return{...l}}else return{...l}}const f=e.terrain[s];if(y(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??zt.ISWALK;if($a(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,y(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function wU(e,t){const n=[];if(!y(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];y(s.id)&&y(s.removed)&&t-s.removed>Ya*5&&(n.push(s.id),Dw(e,s.id))}return n}function EU(e,t){const n=[];if(!y(e))return n;e.lookup=void 0,Re(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!y(o.id))continue;o.lx=o.x,o.ly=o.y;const a=lr(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Gt(o,"cycle");if(l>u)continue}n.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=wU(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return n}function vk(e,t,n){const r=[],i=[];if(!y(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Gt(a,n);return y(l)||nn(a).name===n||Gt(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<Nh;++a){const c=e.terrain[a];y(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function Tk(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=re(t,{x:s,y:i});Ge(o)&&Tn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function xU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Oe(e,{x:i,y:r})}function Ak(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=re(t,{x:s,y:i});Ge(o)&&Tn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function yo(e,t){y(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Ll(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return vU(e,t,n,"",i)}if(!y(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=en(s,bt.BOARD,t),l=Se(c);if(!y(l))return;Re(a),Re(l);let u=!1;if(y(a)&&y(l)){switch(i){case"all":Tk(s,l,n,r);break;case"object":Ak(s,l,n,r);break;case"terrain":xU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let b,k=re(a,p);if(Ge(k)?(b=ns(a,d,f),bn(k==null?void 0:k.id)&&(k=void 0)):(b=k,k=void 0),y(b)&&(m||u&&Gt(b,"group")===i)){u&&Tk(s,l,p,p);const v=jr(l,[b.kind??""],p);yo(v,b)}if(y(k)&&(h||u&&Gt(k,"group")===i)){u&&Ak(s,l,p,p);const v=jr(l,[k.kind??""],p);yo(v,k)}}Oa(l)}}function vU(e,t,n,r,i){if(!y(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=en(s,bt.BOARD,t),l=Se(c);if(y(l)&&(Re(a),Re(l),y(a)&&y(l))){const{terrainelements:u,objectelements:f}=vk(a,r,i);if(u.length===0&&f.length===0)return;const d={x:St,y:Vt};for(let h=0;h<u.length;++h){const m=u[h];Et(m.x)&&(d.x=Math.min(d.x,m.x)),Et(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];Et(m.x)&&(d.x=Math.min(d.x,m.x)),Et(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=re(l,p);y(b)&&(Ge(b)&&Tn(l,b,s.timestamp),Oe(l,p));const k=jr(l,[m.kind??""],p);yo(k,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=jr(l,[m.kind??""],p);yo(b,m)}Oa(l)}}function Na(e,t){const n=Ek(e,t,"board"),r=Dr(bt.BOARD,n);return Se(r)}function TU(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Ml(e,t,n){if(!y(e))return;_U(e,t,"board",n);const r=hn(n);y(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function bo(e,t,n,r,i=!1){if(!y(e))return;const s=fn(t);if(!y(s))return;const o=Un(s,t);if(!Ge(o)||!(o!=null&&o.id))return;const a=hn(n);if(!y(a)||(Re(a),i===!1&&id(a,zt.ISWALK,r,!0)))return;delete s.objects[o.id];const c=zr(s,o);s.lookup&&(s.lookup[c]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const l=zr(a,o);a.lookup&&(a.lookup[l]=o.id),Ml(e,t,a.id)}function AU(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=Ek(e,r,"board");return gt(i)?i:""});return GA(n)}function ko(e){const t=AU(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=hn(t[i]);if(y(s)&&!n.has(s.id)){if(gt(s.over))if(gt(s.overboard)){const o=hn(s.overboard);y(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=hn(s.over);y(o)&&(s.overboard=o.id)}else gt(s.overboard)&&delete s.overboard;if(r.push(s),gt(s.under))if(gt(s.underboard)){const o=hn(s.underboard);y(o)||delete s.underboard}else{const o=hn(s.under);y(o)&&(s.underboard=o.id)}else gt(s.underboard)&&delete s.underboard}}return r}const SU=km(32,126).map(e=>String.fromCharCode(e)),RU=sr({name:"Whitespace",pattern:/ +/}),OU=sr({name:"WhitespaceSkipped",pattern:/ +/,group:ln.SKIPPED}),od=sr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Sk=sr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:SU}),ad=sr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),cd=sr({name:"EscapedDollar",pattern:"$$"}),ld=sr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),ud=sr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Rk=sr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function NU(e,t=""){return sr({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Ok=Object.keys(Zo).map(e=>NU(`\\$(${e})`,e)),IU=[RU,od,...Ok,ad,Sk,ud,cd,Rk,ld],CU=new ln(IU,{skipValidations:!Zr,ensureOptimizations:Zr}),LU=new ln([OU,od,...Ok,ad,Sk,ud,cd,Rk,ld],{skipValidations:!Zr,ensureOptimizations:Zr}),Nk=/\$CENTER/i;function MU(e){if(Nk.test(e))return e.replace(Nk,"")}function hd(e,t=!1){return t?LU.tokenize(e):CU.tokenize(e)}function fd(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Ik(e){e.active={...e.reset}}function Ck(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case cd:s("$");break;case ud:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case ad:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case od:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Zo[l],f=YA(Lt[u]),d=Sh(Lt[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):y(f)?t.active.color=f:y(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(y(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Ik(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;FU(u,u+l.length,t.active.color,t.active.bg,t),UU(u,l,t)}}}function Lk(e,t,n){const r=hd(e);r.tokens&&(Ck(r.tokens,t),n&&Ik(t),t.changed())}function Mk(e,t,n){const r=hd(e);if(!r.tokens)return;const i=fd(t,n,Lt.WHITE,Lt.BLACK);return i.measureonly=!0,Ck(r.tokens,i),i.x>0&&++i.y,i}function UU(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function FU(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Ul(e,t,n){if(!gs(w.element))return 0;const[r,i]=it(t,0,[K.DIR,K.MAYBE_KIND]),s=i??["bullet"],o=LP(w.board,s,{x:w.element.x,y:w.element.y});if(y(o)){y(n)&&(o.arg=n),o.cycle=1,o.party=w.elementid,o.collision=zt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-w.element.x,o.stepy=r.destpt.y-w.element.y,o.bg=Lt.ONCLEAR;const a=lr(o),c=o.code??(a==null?void 0:a.code)??"";Cw(w.book,w.board,o,c)}return e.yield(),0}function Fl(e,t,n,r){var l,u;if(!gs(w.element)||!y(w.book)||!y(w.board)||!y(w.element))return 0;Re(w.board);const[i,s]=it(t,0,[K.DIR,K.KIND]),o=re(w.board,i.destpt);if((o==null?void 0:o.category)===Pn.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=w.element)==null?void 0:l.x)??0,y:((u=w.element)==null?void 0:u.y)??0},d=ze(i.destpt,mr(f,i.destpt));sd(w.board,o,d)}const[a]=s,c=lr({kind:a});if(Ge(c)||jr(w.board,s,i.destpt,n),Ge(c)){const f=Gt(c,"collision");if(!id(w.board,f,i.destpt)){const h=jr(w.board,s,i.destpt,n);y(h)&&y(r)&&(h.arg=r)}}return 0}function BU(e,t,n){if(!y(w.book)||!y(w.board))return 0;Re(w.board);const[r,i]=it(t,0,[K.DIR,K.DIR]),s=re(w.board,r.destpt);return Ge(s),0}const PU={x:0,y:0},$U={x:St-1,y:Vt-1},DU="all",jU=wi().command("goto",(e,t)=>{var a,c;if(!y(w.book)||!y(w.board))return 0;const[n,r]=it(t,0,[K.STRING]),[i,s]=it(t,r,[K.MAYBE_NUMBER,K.MAYBE_NUMBER]),o=hn(n);if(y(o)){Re(o);const l={x:((a=w.element)==null?void 0:a.x)??i??Math.round(St*.5),y:((c=w.element)==null?void 0:c.y)??s??Math.round(Vt*.5)},u=nn(w.element),f=Gt(w.element,"color"),d=Gt(w.element,"bg"),h=Rh(f,d),m=tu(o,[u.name,h]),[p]=m.sort((b,k)=>{const v=b.y??1e4,T=k.y??1e4,A=v-T;if(A!==0)return A;const L=b.x??1e4,S=k.x??1e4;return L-S});y(p)&&Et(p.x)&&Et(p.y)&&(l.x=p.x,l.y=p.y),bo(w.book,w.elementfocus,o.id,l,!0)}return 0}).command("build",(e,t)=>{if(!y(w.book)||!y(w.board)||!y(w.element))return 0;const[n,r]=it(t,0,[K.NAME,K.MAYBE_STRING]),i=eu();if(y(i)){if(gt(r)){const s=hn(r);y(s)&&Ll(s.id,i.id,PU,$U,DU)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;Re(w.board);const[n,r]=it(t,0,[K.DIR,K.DIR]),i=re(w.board,n.destpt);return Ge(i)&&es(w.book,w.board,i,r.destpt),0}).command("duplicate",BU).command("write",(e,t)=>{var d;if(!y(w.book)||!y(w.board))return 0;Re(w.board);const[n,r,i]=it(t,0,[K.DIR,K.COLOR]),s=t.slice(i).map(Te).join(" "),{color:o,bg:a}=Rm(r),c=((d=Mk(s,256,1))==null?void 0:d.measuredwidth)??1,l=fd(256,1,o??Lt.WHITE,a??Lt.BLACK);Lk(s,l,!1);const u=c-1;switch(mr(n.startpt,n.destpt)){case pt.EAST:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.WEST:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.NORTH:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case pt.SOUTH:for(let h=0;h<c;++h)Oe(w.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;Re(w.board);const[n,r]=it(t,0,[K.KIND,K.KIND]);(Pa(n)??"")==="empty"&&VP(w.board).forEach(c=>{jr(w.board,r,c)});const s=Pa(r),o=Ql(r),a=Mw(r);return tu(w.board,n).forEach(c=>{if(y(o)&&(c.color=o),y(a)&&(c.bg=a),nn(c).name!==s){const u=Gt(c,"color"),f=Gt(c,"bg");if(Tn(w.board,c,w.timestamp),s!=="empty"){const d={x:c.x??0,y:c.y??0},h=jr(w.board,r,d);y(h)&&(h.color=u,h.bg=f)}}}),0}).command("put",(e,t)=>Fl(e,t)).command("putwith",(e,t)=>{const[n,r]=it(t,0,[K.ANY]);return Fl(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=it(t,0,[K.ANY]);return y(w.board)&&Un(w.board,n)?0:Fl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[K.ANY,K.ANY]);return y(w.board)&&Un(w.board,r)?0:Fl(e,t.slice(i),r,n)}).command("shoot",Ul).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[K.ANY]);return Ul(e,t.slice(r),n)}).command("throwstar",(e,t)=>Ul(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=it(t,0,[K.ANY]);return Ul(e,[...t.slice(r),"star"],n)}),qi="$dkpurple",zU="$196",WU="$205",Ke="$yellow$205$205$205$196";function be(e,t,n){KE(e,t,n)}function GU(e,t,n){const r=zU.repeat(n);be(e,t,`${qi}${r}`)}function dd(e,t,n){const r=WU.repeat(n);be(e,t,`${qi}${r}`)}function pd(e,t,n){be(e,t,`${qi} ${" ".repeat(n.length)} `),GU(e,t,n.length+2),be(e,t,`${qi} $white${n} `),dd(e,t,n.length+2)}function Os(e,t,n){be(e,t,`${qi} ${" ".repeat(n.length)} `),be(e,t,`${qi} $gray${n} `),dd(e,t,n.length+2)}function Ns(e,t,n,r){be(e,t,`${qi} $white${n} $blue${r}`)}function Vn(e,t,n){be(e,t,`${qi}$blue${n}`)}function KU(e,t,n,r){be(e,t,`!${n};${r}`)}var HU=`desc;$DKGRAYname and type of codepage
`,YU=Object.freeze({__proto__:null,default:HU}),VU="desc;changes object into specified element",XU=Object.freeze({__proto__:null,default:VU}),qU="desc;like #play but for sound effects",JU=Object.freeze({__proto__:null,default:qU}),ZU="",QU=Object.freeze({__proto__:null,default:ZU}),t3="",e3=Object.freeze({__proto__:null,default:t3}),n3="",r3=Object.freeze({__proto__:null,default:n3}),i3="",s3=Object.freeze({__proto__:null,default:i3}),o3="",a3=Object.freeze({__proto__:null,default:o3}),c3="",l3=Object.freeze({__proto__:null,default:c3}),u3="",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3="",b3=Object.freeze({__proto__:null,default:y3}),k3="",w3=Object.freeze({__proto__:null,default:k3}),E3="",x3=Object.freeze({__proto__:null,default:E3}),v3="",T3=Object.freeze({__proto__:null,default:v3}),A3="",S3=Object.freeze({__proto__:null,default:A3}),R3=`desc;$DKGRAYstarts a section of an if-do-done block
`,O3=Object.freeze({__proto__:null,default:R3}),N3=`desc;$DKGRAYcompletes an if-do-done block
`,I3=Object.freeze({__proto__:null,default:N3}),C3="",L3=Object.freeze({__proto__:null,default:C3}),M3="",U3=Object.freeze({__proto__:null,default:M3}),F3="",B3=Object.freeze({__proto__:null,default:F3}),P3=`desc;$DKGRAYelse logic in an if-do-done block
`,$3=Object.freeze({__proto__:null,default:P3}),D3=`desc;$DKGRAYconditional else logic in an if-do-done block
`,j3=Object.freeze({__proto__:null,default:D3}),z3="",W3=Object.freeze({__proto__:null,default:z3}),G3="",K3=Object.freeze({__proto__:null,default:G3}),H3="",Y3=Object.freeze({__proto__:null,default:H3}),V3="",X3=Object.freeze({__proto__:null,default:V3}),q3="",J3=Object.freeze({__proto__:null,default:q3}),Z3="",Q3=Object.freeze({__proto__:null,default:Z3}),t8="",e8=Object.freeze({__proto__:null,default:t8}),n8="",r8=Object.freeze({__proto__:null,default:n8}),i8=`desc;$DKGRAYhalt until the next cycle
`,s8=Object.freeze({__proto__:null,default:i8}),o8=`desc;$DKGRAYevals condition for true or false
`,a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8="",b8=Object.freeze({__proto__:null,default:y8}),k8="",w8=Object.freeze({__proto__:null,default:k8}),E8="",x8=Object.freeze({__proto__:null,default:E8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8="",S8=Object.freeze({__proto__:null,default:A8}),R8="",O8=Object.freeze({__proto__:null,default:R8}),N8="",I8=Object.freeze({__proto__:null,default:N8}),C8="",L8=Object.freeze({__proto__:null,default:C8}),M8="",U8=Object.freeze({__proto__:null,default:M8}),F8="",B8=Object.freeze({__proto__:null,default:F8}),P8="",$8=Object.freeze({__proto__:null,default:P8}),D8="",j8=Object.freeze({__proto__:null,default:D8}),z8="",W8=Object.freeze({__proto__:null,default:z8}),G8="",K8=Object.freeze({__proto__:null,default:G8}),H8="",Y8=Object.freeze({__proto__:null,default:H8}),V8="",X8=Object.freeze({__proto__:null,default:V8}),q8=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,J8=Object.freeze({__proto__:null,default:q8}),Z8="",Q8=Object.freeze({__proto__:null,default:Z8}),t2="",e2=Object.freeze({__proto__:null,default:t2}),n2="",r2=Object.freeze({__proto__:null,default:n2}),i2="",s2=Object.freeze({__proto__:null,default:i2}),o2="",a2=Object.freeze({__proto__:null,default:o2}),c2="",l2=Object.freeze({__proto__:null,default:c2}),u2="",h2=Object.freeze({__proto__:null,default:u2}),f2="",d2=Object.freeze({__proto__:null,default:f2}),p2="",m2=Object.freeze({__proto__:null,default:p2}),g2="",_2=Object.freeze({__proto__:null,default:g2}),y2="",b2=Object.freeze({__proto__:null,default:y2}),k2="",w2=Object.freeze({__proto__:null,default:k2}),E2="",x2=Object.freeze({__proto__:null,default:E2}),v2="",T2=Object.freeze({__proto__:null,default:v2}),A2="",S2=Object.freeze({__proto__:null,default:A2}),R2="",O2=Object.freeze({__proto__:null,default:R2}),N2="",I2=Object.freeze({__proto__:null,default:N2}),C2="",L2=Object.freeze({__proto__:null,default:C2}),M2="",U2=Object.freeze({__proto__:null,default:M2}),F2=`desc;$DKGRAYdesignates an inactive label or comment
`,B2=Object.freeze({__proto__:null,default:F2}),P2=`desc;$DKGRAYadds hyperlink text

`,$2=Object.freeze({__proto__:null,default:P2}),D2=`desc;$DKGRAYsends the given message when hotkey is pressed

`,j2=Object.freeze({__proto__:null,default:D2}),z2=`desc;$DKGRAYread number input into given stat/flag
`,W2=Object.freeze({__proto__:null,default:z2}),G2=`desc;$DKGRAYa slider input from 1 to 9 

`,K2=Object.freeze({__proto__:null,default:G2}),H2=`desc;$DKGRAYlist with label value pairs to pick from
`,Y2=Object.freeze({__proto__:null,default:H2}),V2=`desc;$DKGRAYread text input into given stat/flag
`,X2=Object.freeze({__proto__:null,default:V2}),q2=`desc;$DKGRAYdesignates a starting point for running code
`,J2=Object.freeze({__proto__:null,default:q2}),Z2=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,Q2=Object.freeze({__proto__:null,default:Z2}),tF=`desc;$DKGRAYwill move the object in the given direction
`,eF=Object.freeze({__proto__:null,default:tF}),nF=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,rF=Object.freeze({__proto__:null,default:nF}),iF=`desc;$DKGRAYcustom 8x14 charset
`,sF=Object.freeze({__proto__:null,default:iF}),oF=`desc;$DKGRAYsets stat to given value

`,aF=Object.freeze({__proto__:null,default:oF}),cF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,lF=Object.freeze({__proto__:null,default:cF}),uF=`desc;$DKGRAYread external content and/or handle events
`,hF=Object.freeze({__proto__:null,default:uF}),fF=`desc;$DKGRAYread number input into given stat/flag
`,dF=Object.freeze({__proto__:null,default:fF}),pF=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,mF=Object.freeze({__proto__:null,default:pF}),gF=`desc;$DKGRAYcustom palette colors
`,_F=Object.freeze({__proto__:null,default:gF}),yF=`desc;$DKGRAYa slider input from 1 to 9 

`,bF=Object.freeze({__proto__:null,default:yF}),kF=`desc;$DKGRAYlist with label value pairs to pick from
`,wF=Object.freeze({__proto__:null,default:kF}),EF=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,xF=Object.freeze({__proto__:null,default:EF}),vF=`desc;$DKGRAYread text input into given stat/flag
`,TF=Object.freeze({__proto__:null,default:vF}),AF=`desc;$DKGRAYadds text
`,SF=Object.freeze({__proto__:null,default:AF}),RF=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,OF=Object.freeze({__proto__:null,default:RF}),NF=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,IF=Object.freeze({__proto__:null,default:NF}),CF=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,LF=Object.freeze({__proto__:null,default:CF}),MF=`header;player settings
#set user "name goes here"
`,UF=Object.freeze({__proto__:null,default:MF}),FF=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,BF=Object.freeze({__proto__:null,default:FF});const Uk=Object.assign({"./editor/codepagename.txt":YU,"./editor/command/become.txt":XU,"./editor/command/bgplay.txt":JU,"./editor/command/bgvol.txt":QU,"./editor/command/bind.txt":e3,"./editor/command/board.txt":r3,"./editor/command/bpm.txt":s3,"./editor/command/break.txt":a3,"./editor/command/change.txt":l3,"./editor/command/char.txt":h3,"./editor/command/charset.txt":d3,"./editor/command/clear.txt":m3,"./editor/command/color.txt":_3,"./editor/command/continue.txt":b3,"./editor/command/copy.txt":w3,"./editor/command/cycle.txt":x3,"./editor/command/die.txt":T3,"./editor/command/distort.txt":S3,"./editor/command/do.txt":O3,"./editor/command/done.txt":I3,"./editor/command/duplicate.txt":L3,"./editor/command/echo.txt":U3,"./editor/command/edge.txt":B3,"./editor/command/else.txt":$3,"./editor/command/elseif.txt":j3,"./editor/command/end.txt":W3,"./editor/command/endgame.txt":K3,"./editor/command/endwith.txt":Y3,"./editor/command/fcrush.txt":X3,"./editor/command/fetch.txt":J3,"./editor/command/fetchwith.txt":Q3,"./editor/command/foreach.txt":e8,"./editor/command/go.txt":r8,"./editor/command/idle.txt":s8,"./editor/command/if.txt":a8,"./editor/command/lock.txt":l8,"./editor/command/oneof.txt":h8,"./editor/command/oneofwith.txt":d8,"./editor/command/palette.txt":m8,"./editor/command/phaser.txt":_8,"./editor/command/pivot.txt":b8,"./editor/command/play.txt":w8,"./editor/command/put.txt":x8,"./editor/command/putwith.txt":T8,"./editor/command/readbin.txt":S8,"./editor/command/readjson.txt":O8,"./editor/command/readline.txt":I8,"./editor/command/readrexpaint.txt":L8,"./editor/command/remix.txt":U8,"./editor/command/repeat.txt":B8,"./editor/command/restore.txt":$8,"./editor/command/reverb.txt":j8,"./editor/command/revert.txt":W8,"./editor/command/run.txt":K8,"./editor/command/runwith.txt":Y8,"./editor/command/set.txt":X8,"./editor/command/shoot.txt":J8,"./editor/command/shootwith.txt":Q8,"./editor/command/shove.txt":e2,"./editor/command/snapshot.txt":r2,"./editor/command/synth.txt":s2,"./editor/command/toast.txt":a2,"./editor/command/tts.txt":l2,"./editor/command/ttsvol.txt":h2,"./editor/command/twitchbroadcast.txt":d2,"./editor/command/twitchchat.txt":m2,"./editor/command/unlock.txt":_2,"./editor/command/vibrato.txt":b2,"./editor/command/vol.txt":w2,"./editor/command/waitfor.txt":x2,"./editor/command/walk.txt":T2,"./editor/command/weave.txt":S2,"./editor/command/while.txt":O2,"./editor/command/with.txt":I2,"./editor/command/write.txt":L2,"./editor/command/zap.txt":U2,"./editor/comment.txt":B2,"./editor/hyperlink.txt":$2,"./editor/hyperlink/hotkey.txt":j2,"./editor/hyperlink/number.txt":W2,"./editor/hyperlink/range.txt":K2,"./editor/hyperlink/select.txt":Y2,"./editor/hyperlink/text.txt":X2,"./editor/label.txt":J2,"./editor/shortgo.txt":Q2,"./editor/shorttry.txt":eF,"./editor/stat/board.txt":rF,"./editor/stat/charset.txt":sF,"./editor/stat/const.txt":aF,"./editor/stat/hotkey.txt":lF,"./editor/stat/loader.txt":hF,"./editor/stat/number.txt":dF,"./editor/stat/object.txt":mF,"./editor/stat/palette.txt":_F,"./editor/stat/range.txt":bF,"./editor/stat/select.txt":wF,"./editor/stat/terrain.txt":xF,"./editor/stat/text.txt":TF,"./editor/text.txt":SF,"./help/controls.txt":OF,"./help/developer.txt":IF,"./help/menu.txt":LF,"./help/player.txt":UF,"./help/text.txt":BF}),Fk={};Zn(Uk).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Fk[t]=Uk[e].default});function PF(e){const t=It(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Fk[t];if(y(n))return n;const{target:r,path:i}=$n(t);switch(r){case"editor":{const s=$n(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function $F(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function DF(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":pd(nt,e,i);break;case"section":Os(nt,e,i);break;case"option":Ns(nt,e,i,s);break;default:n.trimStart().startsWith("!")?KU(nt,e,n.trimStart().slice(1),i):be(nt,e,n);break}}function Ii(e){const[t,n]=it(e,0,[K.NAME,K.ANY]);if(It(t)==="send"&&rr(n)){const[,r,i,s]=it(e,0,[K.NAME,K.DIR,K.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(gt(t)){const[r,i,s]=it(e,0,[K.NAME,K.MAYBE_NAME]);return gt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Is(){h0(nt,cr())}function Ia(e){$F(PF(`help:${e}`),t=>DF(w.elementfocus,t))}function Bk(e){switch(e.label){case"helpmenu":Ia("menu");break;case"helpcontrols":Ia("controls");break;case"helptext":Ia("text");break;case"helpdeveloper":Ia("developer");break;case"helpplayer":Ia("player");break;default:{const t=ce($t.MAIN),n=ko(t);y(e.targetname)?Oo(e.targetname,e.label,void 0,n):y(e.targetdir)&&Oo(e.targetdir.destpt,e.label,void 0,n);break}}}const jF=wi().command("shortsend",(e,t)=>{const n=Ii(t);return Bk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Bk(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Te),i=r.join(" ");function s(o,a){if(y(o)&&(e.command("pageopen",o.id),a)){const c=Ue(o),l=Oi(o);be(nt,w.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(n)){case or(At.LOADER):{const[o,a]=ts($t.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=ts($t.MAIN,[n,...r].join(" "),bt.OBJECT);s(o,a);break}case or(At.BOARD):{const[o,a]=ts($t.MAIN,i,bt.BOARD);s(o,a);break}case or(At.OBJECT):{const[o,a]=ts($t.MAIN,i,bt.OBJECT);s(o,a);break}case or(At.TERRAIN):{const[o,a]=ts($t.MAIN,i,bt.TERRAIN);s(o,a);break}case or(At.CHARSET):{const[o,a]=ts($t.MAIN,i,bt.CHARSET);s(o,a);break}case or(At.PALETTE):{const[o,a]=ts($t.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");if(y(w.element)&&w.elementisplayer){const{user:r}=vr(w.elementid),i=gt(r)?r:"player";w.element.tickertext=`${i}: ${n}`,w.element.tickertime=w.timestamp;const s=nn(w.element);xe(nt,w.elementid,`$${Lt[s.color]}$ON${Lt[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),xu(nt,w.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);if(y(s.targetname)){const{user:o}=vr(w.elementid),a=gt(o)?o:"player",c=nn(w.element),l=`$${Lt[c.color]}$ON${Lt[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(nt,w.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=it(t,0,[K.MAYBE_NAME,K.MAYBE_STRING]);return gt(n)&&gt(r)?c0(nt,w.elementfocus,n,r):xx(nt,w.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[K.MAYBE_NAME]),r=Sw(n);return y(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=$r(n);return y(r)?(c0(nt,w.elementfocus,"selected",r.id),Is()):de(nt,w.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=ce($t.MAIN),i=$r(n);return y(i)&&(r===i&&Aw($t.MAIN,""),FP(n),xe(nt,w.elementfocus,`trashed [book] ${i.name}`),Is(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=hn(n);return y(r)&&bo(w.book,w.elementfocus,r.id,{x:pr(0,St-1),y:pr(0,Vt-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=it(t,0,[K.NAME,K.MAYBE_NAME]);let i,s;const o=Pr();for(let a=0;a<o.length&&(s=o[a],i=Ss(s,n),!y(i));++a);if(y(i)&&y(s)){const a=Ue(i),c=Oi(i);xe(nt,w.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];bh(Ha(s.id,l),i.code);const u=Oi(i);l0(nt,w.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(nt,"pageopen",`page ${n} not found`,w.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=un($t.MAIN),i=kk(r,n);if(y(n)){const s=Ue(i),o=Oi(i);xe(nt,w.elementfocus,`trashed [${o}] ${s}`),Is(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Os(nt,w.elementfocus,"books");const e=ce($t.MAIN);Ns(nt,w.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ce($t.MAIN);Ns(nt,w.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),dd(nt,w.elementfocus,7);const n=Pr();return n.length?n.forEach(r=>{be(nt,w.elementfocus,`!bookopen ${r.id};${r.name}`)}):Vn(nt,w.elementfocus,"no books found"),be(nt,w.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=un($t.MAIN);if(!y(e))return 0;Os(nt,w.elementfocus,"pages"),Ns(nt,w.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Ra(e).forEach(r=>{const i=Ue(r),s=Oi(r);be(nt,w.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(be(nt,w.elementfocus,""),Vn(nt,w.elementfocus,"$white no pages found"),Vn(nt,w.elementfocus,"$white use @ to create a page"),Vn(nt,w.elementfocus,"$white @board name of board"),Vn(nt,w.elementfocus,"$white @object name of object"),Vn(nt,w.elementfocus,"$white @terrain name of terrain"),Vn(nt,w.elementfocus,"$white You can omit the type and it will default to object"),Vn(nt,w.elementfocus,"$white @object name of object"),Vn(nt,w.elementfocus,"$white @name of object"));const t=Pr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(nt,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ra(r).forEach(s=>{const o=Ue(s),a=Oi(s);be(nt,w.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Os(nt,w.elementfocus,"boards");const e=un($t.MAIN);if(y(e)){Ns(nt,w.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Ra(e);n.filter(r=>ci(r)===bt.BOARD).forEach(r=>{const i=Ue(r);be(nt,w.elementfocus,`!boardopen ${r.id};$blue#goto $white $34 ${i} $34`)}),n.length===0&&(be(nt,w.elementfocus,""),Vn(nt,w.elementfocus,"$white no boards found"),Vn(nt,w.elementfocus,"$white use @ to create a board"),Vn(nt,w.elementfocus,"$white @board name of board"))}const t=Pr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(nt,w.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ra(r).filter(s=>ci(s)===bt.BOARD).forEach(s=>{const o=Ue(s);be(nt,w.elementfocus,`!boardopen ${s.id};$blue#goto $white$34 ${o} $34`)}))}return 0}).command("trash",()=>{Os(nt,w.elementfocus,"$REDTRASH"),Vn(nt,w.elementfocus,"books");const e=Pr();e.length&&(e.forEach(n=>{be(nt,w.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),be(nt,w.elementfocus,""));const t=ce($t.MAIN);return y(t)&&(Vn(nt,w.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);be(nt,w.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),be(nt,w.elementfocus,"")),0}).command("dev",()=>(Is(),hx(nt,w.elementfocus),0)).command("share",()=>(Is(),fx(nt,w.elementfocus),0)).command("save",()=>(Is(),0)).command("fork",()=>(Rx(nt,w.elementfocus),0)).command("itchiopublish",()=>(Ox(nt,w.elementfocus),0)).command("nuke",()=>(dx(nt,w.elementfocus),0)).command("restart",()=>(Sx(nt,w.elementfocus),Is(),0)).command("export",()=>{pd(nt,w.elementfocus,"E X P O R T"),Os(nt,w.elementfocus,"books");const e=Pr();return e.length&&e.forEach(t=>be(nt,w.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=$r(n);return y(r)&&(pd(nt,w.elementfocus,"E X P O R T"),Os(nt,w.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Ra(r);be(nt,w.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=Oi(s);be(nt,w.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=$r(n);return y(r)&&o0(nt,w.elementfocus,Ar(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[K.NAME]),{target:r,path:i}=$n(n),s=$r(r),o=Ss(s,i);return y(o)&&o0(nt,w.elementfocus,Ar(o),`${Ue(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(vx(nt,w.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[K.MAYBE_NAME]);return ex(nt,w.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=it(t,0,[K.MAYBE_NAME]);return nx(nt,w.elementfocus,!!n),0}).command("startlookingglass",()=>(px(nt,w.elementfocus),0)),zF=wi().command("toast",(e,t)=>{const n=t.map(Te).join("");return i0(nt,w.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Te).join("");return y(w.element)&&(w.element.tickertext=n,w.element.tickertime=w.timestamp),0}).command("palette",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=Ow(),i=en(w.book,bt.PALETTE,n);return y(i)?(r.palette=i.id,xe(nt,w.elementfocus,`loaded palette ${n}`)):de(nt,w.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[K.NAME]),r=Ow(),i=en(w.book,bt.CHARSET,n);return y(i)?(r.charset=i.id,xe(nt,w.elementfocus,`loaded charset ${n}`)):de(nt,w.elementfocus,"not-found",`unabled to find charset ${n}`),0}),md={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};zt.ISSOLID,zt.ISWALK,zt.ISSWIM,zt.ISBULLET,zt.ISWALK,zt.ISSWIM;function Bl(e){return ue(e)&&gd(e[0])}function gd(e){return y(zt[e])&&gt(e)}function WF(e){if(gt(e))return md[It(e)]}function GF(e){const t=w.words[e];if(Bl(t))return[t,e+1];if(gd(t))return[[t],e+1];const[n,r]=Cn(e);return Bl(n)?[n,r]:gd(n)?[[n],r]:[void 0,e]}function wo(e,t=0){const n=[];let r=e;for(;r<w.words.length;){const[i,s]=Cn(r);if(ue(i)&&!rr(i)&&!Ca(i)&&!Bl(i)&&!En(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Cn(e){var r,i,s,o,a,c,l,u,f;const t=w.words[e],n=e+1;if($k(t)){const[d,h]=KF(e);if(y(d))return[d,h]}if(WF(t)){const[d,h]=GF(e);if(y(d))return[d,h]}if(Qo(t)){const[d,h]=Rc(e);if(y(d))return[d,h]}if(gt(t)&&It(t)==="rnd"){const[d,h]=Cn(n),[m,p]=Cn(h);return Et(d)&&Et(m)?[pr(d,m),p]:Et(d)?[pr(0,d),h]:[pr(0,1),n]}if(Tc(t)){const[d,h]=vm(e);if(y(d))return[d,h]}if(!y(t))return[void 0,e];if(Et(t)||ue(t))return[t,n];if(gt(t)){const d=It(t),h=(r=w.get)==null?void 0:r.call(w,t);if(y(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=No(w.board,{x:((i=w.element)==null?void 0:i.x)??-1,y:((s=w.element)==null?void 0:s.y)??-1},w.elementfocus);return!y(w.element)||!y(m)?[0,n]:[w.element.x===m.x||w.element.y===m.y?1:0,n]}case"contact":{const m=No(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus);if(!y(w.element)||!y(m))return[0,n];const p=(m.x??0)-(((c=w.element)==null?void 0:c.x)??0),b=(m.y??0)-(((l=w.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(b)<2||b===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=it(w.words,n,[K.DIR]);return[kU(w.board,w.element,m.destpt)?1:0,p]}case"any":{const[m]=it(w.words,n,[K.ANY]);if(rr(m)){const[v,T,A]=it(w.words,n,[K.DIR,K.COLOR_OR_KIND]),L=v.layer===pt.MID?re(w.board,v.destpt):ns(w.board,v.destpt.x,v.destpt.y);if(y(L)){const S=nn(L);if(En(T))return[Ac(T)===S.color||Sc(T)===S.bg?[L]:[],A];const I=It(Pa(T)),$=Ql(T);if((I.length&&I!==S.name||y($)&&$!==S.color)===!1)return[[L],A]}return[[],A]}const[p,b]=it(w.words,n,[K.COLOR_OR_KIND]);return En(p)?[Uw(w.board,p),b]:[tu(w.board,p),b]}case"count":{const[m]=it(w.words,n,[K.ANY]);if(rr(m)){const[v,T,A]=it(w.words,n,[K.DIR,K.COLOR_OR_KIND]),L=v.layer===pt.MID?re(w.board,v.destpt):ns(w.board,v.destpt.x,v.destpt.y);if(y(L)){const S=nn(L);if(En(T))return[Ac(T)===S.color||Sc(T)===S.bg?1:0,A];const I=It(Pa(T)),$=Ql(T),N=I.length?I===S.name:!0,z=y($)?$===S.color:!0;if(N&&z)return[1,A]}return[0,A]}const[p,b]=it(w.words,n,[K.COLOR_OR_KIND]);return En(p)?[Uw(w.board,p).length,b]:[tu(w.board,p).length,b]}case"rnd":return[pr(0,1),n];case"abs":{const[m,p]=it(w.words,n,[K.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=it(w.words,n,[K.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=it(w.words,n,[K.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=it(w.words,n,[K.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,b,k]=it(w.words,n,[K.NUMBER,K.NUMBER,K.NUMBER]);return[gn(m,p,b),k]}case"min":{const[m,p]=wo(n);return[Math.min(...m),p]}case"max":{const[m,p]=wo(n);return[Math.max(...m),p]}case"pick":{const[m,p]=wo(n);return[Sn(m),p]}case"pickwith":{const[m,p]=it(w.words,n,[K.NUMBER_OR_STRING]),[b,k]=wo(p);return[WA(`${m}`,b),k]}case"random":{const[m,p]=wo(n,2),[b,k]=m;return[pr(b,k??0),p]}case"randomwith":{const[m,p]=it(w.words,n,[K.NUMBER_OR_STRING]),[b,k]=wo(p,2),[v,T]=b;return[bm(`${m}`,v,T??0),k]}case"run":{const[m,p]=it(w.words,n,[K.NAME]);return Zl(m),[(u=w.get)==null?void 0:u.call(w,"arg"),p]}case"runwith":{const[m,p,b]=it(w.words,n,[K.ANY,K.NAME]);return y(w.element)&&(w.element.arg=m),Zl(p),[(f=w.get)==null?void 0:f.call(w,"arg"),b]}}}return[t,n]}const _d={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ca(e){return ue(e)&&Pk(e[0])}function Pk(e){return y(Pn[e])&&gt(e)}function $k(e){if(gt(e))return _d[It(e)]}function Dk(e){if(Ca(e))return e;if(Pk(e))return[e];const t=$k(e);if(y(t))return[t]}function KF(e){const t=w.words[e],n=Dk(t);if(Ca(n))return[n,e+1];const[r,i]=Cn(e),s=Dk(r);return Ca(s)?[s,i]:[void 0,e]}const HF=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),jk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),YF=["NORTH","SOUTH","WEST","EAST"];function VF(e){const t=vr(e);if(Et(t.inputcurrent)||(t.inputcurrent=0),ue(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Rn.NONE,i=0]=n??[Rn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&oS?1:0,t.inputctrl=i&aS?1:0,t.inputshift=i&cS?1:0,r){case Rn.MOVE_UP:case Rn.MOVE_DOWN:case Rn.MOVE_LEFT:case Rn.MOVE_RIGHT:t.inputmove=[YF[r-Rn.MOVE_UP]];break;case Rn.OK_BUTTON:t.inputok=1;break;case Rn.CANCEL_BUTTON:t.inputcancel=1;break;case Rn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Rn.NONE&&o!==r}),t}function XF(e){const t=_d[e];if(y(t))return t;const n=md[e];if(y(n))return n;const r=Zo[e];if(y(r))return r;const i=Ah[e];if(y(i))return i}const qF=wi({get(e,t){var o,a,c,l,u,f,d,h,m,p,b,k,v,T,A,L,S,I,$,N,z;const n=XF(t);if(y(n))return[!0,n];if(w.elementisplayer&&HF.has(t)){const J=VF(w.elementid)[t];return[y(J),J]}const r=No(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus??cr();switch(t){case"camera":case"graphics":case"facing":if(y((c=w.board)==null?void 0:c[t]))return[!0,(l=w.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=w.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=w.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=w.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=w.board)==null?void 0:h.over)??""];case"under":return[!0,((m=w.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=w.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((b=w.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((k=w.board)==null?void 0:k.exitwest)??""];case"exiteast":return[!0,((v=w.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=w.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=w.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((L=w.board)==null?void 0:L.maxplayershots)??0];case"currenttick":return[!0,w.timestamp];case"boardid":return[!0,((S=w.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((I=w.element)==null?void 0:I.id)??""];case"thisx":return[!0,(($=w.element)==null?void 0:$.x)??-1];case"thisy":return[!0,((N=w.element)==null?void 0:N.y)??-1];default:{if(jk.has(t)){const J=(z=w.element)==null?void 0:z[t];return t==="color"&&console.info("reading color",J),[!0,J]}break}}const s=vr(i)[t];return[y(s),s]},set(e,t,n){var o,a;const r=No(w.board,{x:((o=w.element)==null?void 0:o.x)??-1,y:((a=w.element)==null?void 0:a.y)??-1},w.elementfocus),i=(r==null?void 0:r.id)??w.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(y(w.board))return w.board.isdark=n?1:0,[!0,w.board.isdark];break;case"startx":if(y(w.board))return w.board.startx=ea(n,0),[!0,w.board.startx];break;case"starty":if(y(w.board))return w.board.starty=ea(n,0),[!0,w.board.starty];break;case"over":if(y(w.board))return w.board.over=Te(n),[!0,w.board.over];break;case"under":if(y(w.board))return[!0,w.board.under=Te(n)];break;case"exitnorth":if(y(w.board))return[!0,w.board.exitnorth=Te(n)];break;case"exitsouth":if(y(w.board))return[!0,w.board.exitsouth=Te(n)];break;case"exitwest":if(y(w.board))return[!0,w.board.exitwest=Te(n)];break;case"exiteast":if(y(w.board))return[!0,w.board.exiteast=Te(n)];break;case"timelimit":if(y(w.board))return[!0,w.board.timelimit=ea(n,0)];break;case"restartonzap":if(y(w.board))return[!0,w.board.restartonzap=n?1:0];break;case"maxplayershots":if(y(w.board))return[!0,w.board.maxplayershots=ea(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(jk.has(t))return y(w.element)&&(w.element[t]=n),[!0,n];break}}const s=vr(i);return y(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=w.element)!=null&&e.removed)&&(y((t=w.element)==null?void 0:t.stepx)||y((n=w.element)==null?void 0:n.stepy))){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};es(w.book,w.board,w.element,{x:s.x+(w.element.stepx??0),y:s.y+(w.element.stepy??0)})===!1&&Gt(w.element,"breakable")&&Tn(w.board,w.element,w.timestamp)}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Te(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=it(t,0,[K.NAME,K.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[K.KIND]);if(Re(w.board),rd(w.board,w.element),Tn(w.board,w.element,w.timestamp)){const s={x:((r=w.element)==null?void 0:r.x)??0,y:((i=w.element)==null?void 0:i.y)??0};jr(w.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[K.ANY]);if(rr(n)){const[r,i]=it(t,0,[K.DIR,K.NUMBER]),s=re(w.board,r.destpt);y(s)&&(s.char=i)}else y(w.element)&&Et(n)&&(w.element.char=n);return 0}).command("color",(e,t)=>{const[n]=it(t,0,[K.ANY]);if(rr(n)){const[r,i]=it(t,0,[K.DIR,K.COLOR]),s=re(w.board,r.destpt);y(s)&&oa(w.element,i)}else{const[r]=it(t,0,[K.COLOR]);y(w.element)&&y(r)&&oa(w.element,r)}return 0}).command("go",(e,t)=>{if(y(w.element)){const[n]=it(t,0,[K.DIR]);if(es(w.book,w.board,w.element,n.destpt),e.yield(),w.element.x===n.destpt.x&&w.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!y(w.element))return 0;const[n]=it(t,0,[K.DIR]),r=w.element.x??0,i=w.element.y??0;return w.element.stepx=n.destpt.x-r,w.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[K.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)).command("cycle",(e,t)=>{if(y(w.element)){const[n]=it(t,0,[K.NUMBER]);w.element.cycle=gn(Math.round(n),1,255)}return 0}).command("die",e=>{var n,r;if(Tn(w.board,w.element,w.timestamp),!!Gt(w.element,"item")){const i={x:((n=w.element)==null?void 0:n.x)??-1,y:((r=w.element)==null?void 0:r.y)??-1},s=No(w.board,i,w.elementfocus);y(s)&&(s.x=i.x,s.y=i.y)}return e.endofprogram(),0}).command("endgame",()=>(u0(nt,w.elementfocus),0)).command("run",(e,t)=>{const[n]=it(t,0,[K.NAME]);return Zl(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[K.ANY,K.NAME]);return e.set("arg",n),Zl(r),0}),Pl={};function JF(e){var t;return(t=Pl[e])==null?void 0:t.arg}function ZF(e){var t;return(t=Pl[e])==null?void 0:t.format}function Eo(e){var t;return(t=Pl[e])==null?void 0:t.content}function zk(e,t,n,r,i){const s=ce($t.MAIN);if(!y(s))return;const o=Rs(s,bt.LOADER).filter(a=>{const c=As(a),l=c.format,u=gt(l)?new RegExp(l).test(t):!1,f=c.event,d=gt(f)?new RegExp(f).test(n):!1;return gt(l)&&gt(f)?u&&d:gt(l)?u:gt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${De()}_loader`;Pl[c]={arg:e,format:t,content:r,player:i},jP(c,o[a].code)}}function Wk(e,t){if(!y(e))return;const n=It(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const QF=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=it(t,0,[K.NAME]),s=It(r);switch(s){case"seek":{const[o]=it(t,i,[K.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[K.NAME]);e.set(o,Wk(n,s));break}case"text":{const[o,a]=it(t,i,[K.NAME,K.NAME]),c=Wk(n,o);if(Et(c)&&gt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[K.NAME]),[a]=ed(w.book,bt.PALETTE,o),c=Se(a);if(y(c)){const l=QA*Oc,u=cg(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=it(t,i,[K.NAME]),[a]=ed(w.book,bt.CHARSET,o),c=Se(a);if(y(c)){const l=Nc*ZA*Ih,u=lg(new Uint8Array(n.bytes.buffer,n.cursor,l));y(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},xo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",$l=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!$l(e[n],t[n]))return!1;return!0}if(xo(e)&&xo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!$l(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Dl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(xo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},tB=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Gk=e=>e>="0"&&e<="9"||e==="-",eB=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var q;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(q||(q={}));const Kk={"(":q.TOK_LPAREN,")":q.TOK_RPAREN,"*":q.TOK_STAR,",":q.TOK_COMMA,".":q.TOK_DOT,":":q.TOK_COLON,"@":q.TOK_CURRENT,$:q.TOK_ROOT,"]":q.TOK_RBRACKET,"{":q.TOK_LBRACE,"}":q.TOK_RBRACE},nB={"!":!0,"<":!0,"=":!0,">":!0},rB={"	":!0,"\n":!0,"\r":!0," ":!0};class iB{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(tB(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:q.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Kk[t[this._current]]!==void 0)n.push({start:this._current,type:Kk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Gk(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:q.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:q.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:q.TOK_LITERAL,value:o})}else if(nB[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(rB[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:q.TOK_AND,value:"&&"})):n.push({start:r,type:q.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:q.TOK_OR,value:"||"})):n.push({start:r,type:q.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&eB(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Gk(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:q.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:q.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:q.TOK_FLATTEN,value:"[]"}):{start:n,type:q.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_NE,value:"!="}):{start:n,type:q.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_LTE,value:"<="}):{start:n,type:q.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:q.TOK_GTE,value:">="}):{start:n,type:q.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:q.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const sB=new iB,xn={[q.TOK_EOF]:0,[q.TOK_UNQUOTEDIDENTIFIER]:0,[q.TOK_QUOTEDIDENTIFIER]:0,[q.TOK_RBRACKET]:0,[q.TOK_RPAREN]:0,[q.TOK_COMMA]:0,[q.TOK_RBRACE]:0,[q.TOK_NUMBER]:0,[q.TOK_CURRENT]:0,[q.TOK_EXPREF]:0,[q.TOK_ROOT]:0,[q.TOK_PIPE]:1,[q.TOK_OR]:2,[q.TOK_AND]:3,[q.TOK_EQ]:5,[q.TOK_GT]:5,[q.TOK_LT]:5,[q.TOK_GTE]:5,[q.TOK_LTE]:5,[q.TOK_NE]:5,[q.TOK_FLATTEN]:9,[q.TOK_STAR]:20,[q.TOK_FILTER]:21,[q.TOK_DOT]:40,[q.TOK_NOT]:45,[q.TOK_LBRACE]:50,[q.TOK_LBRACKET]:55,[q.TOK_LPAREN]:60};class oB{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==q.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...sB.tokenize(t),{type:q.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<xn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case q.TOK_LITERAL:return{type:"Literal",value:t.value};case q.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case q.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===q.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case q.TOK_NOT:return r=this.expression(xn.Not),{type:"NotExpression",children:[r]};case q.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===q.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(xn.Star),{type:"ValueProjection",children:[n,r]};case q.TOK_FILTER:return this.led(t.type,{type:"Identity"});case q.TOK_LBRACE:return this.parseMultiselectHash();case q.TOK_FLATTEN:return n={type:q.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(xn.Flatten),{type:"Projection",children:[n,r]};case q.TOK_LBRACKET:return this.lookahead(0)===q.TOK_NUMBER||this.lookahead(0)===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===q.TOK_STAR&&this.lookahead(1)===q.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(xn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case q.TOK_CURRENT:return{type:q.TOK_CURRENT};case q.TOK_ROOT:return{type:q.TOK_ROOT};case q.TOK_EXPREF:return i=this.expression(xn.Expref),{type:"ExpressionReference",children:[i]};case q.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(i={type:q.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(q.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case q.TOK_DOT:const i=xn.Dot;return this.lookahead(0)!==q.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case q.TOK_PIPE:return r=this.expression(xn.Pipe),{type:q.TOK_PIPE,children:[n,r]};case q.TOK_OR:return r=this.expression(xn.Or),{type:"OrExpression",children:[n,r]};case q.TOK_AND:return r=this.expression(xn.And),{type:"AndExpression",children:[n,r]};case q.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==q.TOK_RPAREN;)this.lookahead(0)===q.TOK_CURRENT?(a={type:q.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===q.TOK_COMMA&&this.match(q.TOK_COMMA),o.push(a);return this.match(q.TOK_RPAREN),{name:s,type:"Function",children:o};case q.TOK_FILTER:const l=this.expression(0);return this.match(q.TOK_RBRACKET),r=this.lookahead(0)===q.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(xn.Filter),{type:"FilterProjection",children:[n,r,l]};case q.TOK_FLATTEN:const u={type:q.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(xn.Flatten);return{type:"Projection",children:[u,f]};case q.TOK_EQ:case q.TOK_NE:case q.TOK_GT:case q.TOK_GTE:case q.TOK_LT:case q.TOK_LTE:return this.parseComparator(n,t);case q.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===q.TOK_NUMBER||d.type===q.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(q.TOK_STAR),this.match(q.TOK_RBRACKET),r=this.parseProjectionRHS(xn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===q.TOK_COLON||this.lookahead(1)===q.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(q.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(xn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==q.TOK_RBRACKET&&n<3;){if(r===q.TOK_COLON)n+=1,this.advance();else if(r===q.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(q.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(xn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER,q.TOK_STAR].includes(n))return this.expression(t);if(n===q.TOK_LBRACKET)return this.match(q.TOK_LBRACKET),this.parseMultiselectList();if(n===q.TOK_LBRACE)return this.match(q.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(xn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===q.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===q.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===q.TOK_DOT)return this.match(q.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==q.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===q.TOK_COMMA&&(this.match(q.TOK_COMMA),this.lookahead(0)===q.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(q.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[q.TOK_UNQUOTEDIDENTIFIER,q.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(q.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===q.TOK_COMMA)this.match(q.TOK_COMMA);else if(this.lookahead(0)===q.TOK_RBRACE){this.match(q.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const aB=new oB;var ft;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ft||(ft={}));class cB{constructor(t){this.TYPE_NAME_TABLE={[ft.TYPE_NUMBER]:"number",[ft.TYPE_ANY]:"any",[ft.TYPE_STRING]:"string",[ft.TYPE_ARRAY]:"array",[ft.TYPE_OBJECT]:"object",[ft.TYPE_BOOLEAN]:"boolean",[ft.TYPE_EXPREF]:"expression",[ft.TYPE_NULL]:"null",[ft.TYPE_ARRAY_NUMBER]:"Array<number>",[ft.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>xo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ft.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ft.TYPE_NUMBER,ft.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ft.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ft.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ft.TYPE_NUMBER,ft.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ft.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ft.TYPE_NUMBER?n:r===ft.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ft.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ft.TYPE_NUMBER:return"number";case ft.TYPE_STRING:return"string";case ft.TYPE_ARRAY:return"array";case ft.TYPE_OBJECT:return"object";case ft.TYPE_BOOLEAN:return"boolean";case ft.TYPE_EXPREF:return"expref";case ft.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ft.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ft.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]},{types:[ft.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ft.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ft.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY,ft.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ft.TYPE_EXPREF]},{types:[ft.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ft.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ft.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ft.TYPE_STRING,ft.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ft.TYPE_ARRAY_STRING,ft.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ft.TYPE_ARRAY]},{types:[ft.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ft.TYPE_STRING]},{types:[ft.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ft.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ft.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ft.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ft.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ft.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ft.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var b;return(b=!p.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[p])){m=!0;break}if(!m&&h!==void 0){const k=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${k}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===ft.TYPE_ANY)return!0;if(n===ft.TYPE_ARRAY_STRING||n===ft.TYPE_ARRAY_NUMBER||n===ft.TYPE_ARRAY){if(n===ft.TYPE_ARRAY)return t===ft.TYPE_ARRAY;if(t===ft.TYPE_ARRAY){let i;n===ft.TYPE_ARRAY_NUMBER?i=ft.TYPE_NUMBER:n===ft.TYPE_ARRAY_STRING&&(i=ft.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ft.TYPE_STRING;case"[object Number]":return ft.TYPE_NUMBER;case"[object Array]":return ft.TYPE_ARRAY;case"[object Boolean]":return ft.TYPE_BOOLEAN;case"[object Null]":return ft.TYPE_NULL;case"[object Object]":return t.jmespathType===q.TOK_EXPREF?ft.TYPE_EXPREF:ft.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class lB{constructor(){this._rootValue=null,this.runtime=new cB(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:xo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],b=this.computeSliceParams(n.length,p),[k,v,T]=b;if(s=[],T>0)for(d=k;d<v;d+=T)s.push(n[d]);else for(d=k;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!xo(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const L=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Dl(r)||L.push(h[d]);for(let M=0;M<L.length;M+=1)i=this.visit(t.children[1],L[M]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case q.TOK_EQ:s=$l(o,a);break;case q.TOK_NE:s=!$l(o,a);break;case q.TOK_GT:s=o>a;break;case q.TOK_GTE:s=o>=a;break;case q.TOK_LT:s=o<a;break;case q.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case q.TOK_FLATTEN:const I=this.visit(t.children[0],n);if(!Array.isArray(I))return null;let $=[];for(d=0;d<I.length;d+=1)i=I[d],Array.isArray(i)?$=[...$,...i]:$.push(i);return $;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Dl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Dl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Dl(o);case"Literal":return t.value;case q.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case q.TOK_CURRENT:return n;case q.TOK_ROOT:return this._rootValue;case"Function":const z=[];for(let M=0;M<t.children.length;M+=1)z.push(this.visit(t.children[M],n));return this.runtime.callFunction(t.name,z);case"ExpressionReference":const J=t.children[0];return J.jmespathType=q.TOK_EXPREF,J;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const uB=new lB;ft.TYPE_ANY,ft.TYPE_ARRAY,ft.TYPE_ARRAY_NUMBER,ft.TYPE_ARRAY_STRING,ft.TYPE_BOOLEAN,ft.TYPE_EXPREF,ft.TYPE_NULL,ft.TYPE_NUMBER,ft.TYPE_OBJECT,ft.TYPE_STRING;function hB(e,t){const n=aB.parse(t);return uB.search(n,e)}const fB=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=it(t,0,[K.NAME,K.NAME]),s=hB(n.json,r);return e.set(i,s),0},dB=(e,t)=>{const n=Eo(e.id());if(!y(n))return 0;const[r,i]=it(t,0,[K.NAME]);switch(It(r)){case"seek":{const[o]=it(t,i,[K.NUMBER]);n.cursor=gn(o,0,n.lines.length-1);break}case"line":n.cursor=gn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=it(t,u,[K.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function Hk(e){const t=ce($t.MAIN),n=ko(t);y(e.targetdir)?Oo(e.targetdir.destpt,e.label,void 0,n):y(e.targetname)&&Oo(e.targetname,e.label,void 0,n)}const pB=wi({get(e,t){const n=ZF(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Ii(t);return Hk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Hk(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return xe(nt,w.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return y(s.targetname)&&xe(nt,w.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",dB).command("readjson",fB).command("readbin",QF).command("withboard",(e,t)=>{const[n]=it(t,0,[K.STRING]),r=hn(n);return y(r)&&(w.board=r,w.element={x:-1,y:-1}),0});function Yk(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=it(i,a,[K.ANY]);ue(c)&&!rr(c)&&!Ca(c)&&!Bl(c)&&!En(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":qE(nt,w.elementfocus,e,t,n,r,o);break}return 0}const mB=wi().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[K.NAME,K.NAME,K.MAYBE_STRING]);return Yk(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[K.ANY,K.NAME,K.NAME,K.MAYBE_STRING]);return Yk(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=it(t,0,[K.MAYBE_NAME]);return n?VE(nt,w.elementfocus,n):XE(nt,w.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=it(t,0,[K.MAYBE_NAME]);return n?HE(nt,w.elementfocus,n):YE(nt,w.elementfocus),0});function Vk(e,t){var n,r;if(y(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=w.board)==null?void 0:n.objects)??{}))e.send(w.elementfocus,i,t.label);break;case"self":e.message({session:nt.session(),player:w.elementfocus,id:De(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=w.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(w.elementfocus,i,t.label);break;default:{const i=Fw(w.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];y(o.id)&&e.send(w.elementfocus,o.id,t.label)}break}}else if(y(t.targetdir)){const i=re(w.board,t.targetdir.destpt);y(i==null?void 0:i.id)&&e.send(w.elementfocus,i.id,t.label)}}const gB=wi({set(e,t,n){return c$(e,t,n),[!1,void 0]},everytick(){const e=An(w.elementid),[t]=e;if(e.length===1&&gt(t)){if(y(w.element))if(t.trim().length===0){const n=Ye(w.elementid);n.sidebar=[]}else w.element.tickertext=t,w.element.tickertime=w.timestamp}else if(e.length>1)if(w.elementisplayer){const n=Ye(w.elementid);n.sidebar=Gw(e)}else{const n=Ye(w.elementfocus);n.scrollname=nn(w.element).name,n.scroll=Gw(e)}}}).command("shortsend",(e,t)=>{const n=Ii(t);return Vk(e,n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Vk(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join("");return Rt(w.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=Ii(r);return y(s.targetname)&&Ct(w.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function _B(e,t,n,r,i){if(!y(w.book))return;const s=w.book,o=en(s,bt.BOARD,e),a=Se(o);if(!y(a))return;const c=eu(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Re(a),Re(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Vt).fill(0);um(h,0,-h,Vt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const k=new Array(St).fill(0);um(0,m,St-1,-m).forEach(A=>{A.y<0?k[A.x]=Math.min(k[A.x],A.y):k[A.x]=Math.max(k[A.x],A.y)});const T=[p,k,p];for(let A=0;A<T.length;++A){const L=T[A];if(A!==1){for(let S=0;S<Vt;++S){const I=L[S],$=S*St;for(let N=0;N<St;N++){const z=(N+I+St)%St;u&&(c.terrain[z+$]=a.terrain[N+$])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=L[z];a.objects[$].x=(N+J+St)%St,a.objects[$].lx=a.objects[$].x}}}}if(A===1){for(let S=0;S<St;++S){const I=L[S];for(let $=0;$<Vt;++$){const N=($+I+Vt)%Vt;u&&(c.terrain[S+N*St]=a.terrain[S+$*St])}}if(l){const S=Object.keys(a.objects);for(let I=0;I<S.length;++I){const $=S[I],{x:N,y:z}=a.objects[$];if(y(N)&&y(z)){const J=L[N];a.objects[$].y=(z+J+Vt)%Vt,a.objects[$].ly=a.objects[$].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Re(c),Re(a)}}function yB(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var bB=yB;const kB=bB,ee=function(){};ee.prototype.FMX=0,ee.prototype.FMY=0,ee.prototype.FMXxFMY=0,ee.prototype.T=0,ee.prototype.N=0,ee.prototype.initiliazedField=!1,ee.prototype.generationComplete=!1,ee.prototype.wave=null,ee.prototype.compatible=null,ee.prototype.weightLogWeights=null,ee.prototype.sumOfWeights=0,ee.prototype.sumOfWeightLogWeights=0,ee.prototype.startingEntropy=0,ee.prototype.sumsOfOnes=null,ee.prototype.sumsOfWeights=null,ee.prototype.sumsOfWeightLogWeights=null,ee.prototype.entropies=null,ee.prototype.propagator=null,ee.prototype.observed=null,ee.prototype.distribution=null,ee.prototype.stack=null,ee.prototype.stackSize=0,ee.prototype.DX=[-1,0,1,0],ee.prototype.DY=[0,1,0,-1],ee.prototype.opposite=[2,3,0,1],ee.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ee.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=kB(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},ee.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ee.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ee.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},ee.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ee.prototype.isGenerationComplete=function(){return this.generationComplete},ee.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},ee.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Xk=ee;const qk=Xk,Ci=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let z=0;z<n;z++){const J=(N*n+z)*4,M=[t[J],t[J+1],t[J+2],t[J+3]],O=M.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(M)),d[z][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),b=function(z){let J=new Array(i*i);for(let M=0;M<i;M++)for(let O=0;O<i;O++)J[O+M*i]=z(O,M);return J},k=function(z,J){return b(function(M,O){return d[(z+M)%n][(J+O)%r]})},v=function(z){return b(function(J,M){return z[i-1-M+J*i]})},T=function(z){return b(function(J,M){return z[i-1-J+M*i]})},A=function(z){let J=0,M=1;for(let O=0;O<z.length;O++)J+=z[z.length-1-O]*M,M*=m;return J},L=function(z){let J=z,M=p;const O=new Array(i*i);for(let E=0;E<O.length;E++){M/=m;let C=0;for(;J>=M;)J-=M,C++;O[E]=C}return O},S={},I=[];for(let N=0;N<(a?r:r-i+1);N++)for(let z=0;z<(a?n:n-i+1);z++){const J=new Array(8);J[0]=k(z,N),J[1]=T(J[0]),J[2]=v(J[0]),J[3]=T(J[2]),J[4]=v(J[2]),J[5]=T(J[4]),J[6]=v(J[4]),J[7]=T(J[6]);for(let M=0;M<l;M++){const O=A(J[M]);S[O]?S[O]++:(I.push(O),S[O]=1)}}this.T=I.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const z=parseInt(I[N],10);this.patterns[N]=L(z),this.weights[N]=S[z]}const $=function(z,J,M,O){const E=M<0?0:M,C=M<0?M+i:i,P=O<0?0:O,F=O<0?O+i:i;for(let ot=P;ot<F;ot++)for(let tt=E;tt<C;tt++)if(z[tt+i*ot]!=J[tt-M+i*(ot-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let z=0;z<this.T;z++){const J=[];for(let M=0;M<this.T;M++)$(this.patterns[z],this.patterns[M],this.DX[N],this.DY[N])&&J.push(M);this.propagator[N][z]=J}}};Ci.prototype=Object.create(qk.prototype),Ci.prototype.constructor=Ci,Ci.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ci.prototype.clear=function(){if(qk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ci.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ci.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ci.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const b=this.colors[this.patterns[p][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var wB=Ci;const EB=Xk,Ji=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const L=new Array(o*o);for(let S=0;S<o;S++)for(let I=0;I<o;I++)L[I+S*o]=A(I,S);return L},u=function(A){return l(function(L,S){return A[o-1-S+L*o]})},f=function(A){return l(function(L,S){return A[o-1-L+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,b,k;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":k=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S+1:S-1};break;case"T":k=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S:4-S};break;case"I":k=2,p=function(S){return 1-S},b=function(S){return S};break;case"\\":k=2,p=function(S){return 1-S},b=function(S){return 1-S};break;case"F":k=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},b=function(S){return S<4?S+4:S-4};break;default:k=1,p=function(S){return S},b=function(S){return S};break}this.T=h.length,m[A.name]=this.T;for(let S=0;S<k;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+b(S),this.T+b(p(S)),this.T+b(p(p(S))),this.T+b(p(p(p(S))))]);let L;if(a)for(let S=0;S<k;S++)L=A.bitmap[S],this.tiles.push(l(function(I,$){return[L[(o*$+I)*4],L[(o*$+I)*4+1],L[(o*$+I)*4+2],L[(o*$+I)*4+3]]}));else{L=A.bitmap,this.tiles.push(l(function(S,I){return[L[(o*I+S)*4],L[(o*I+S)*4+1],L[(o*I+S)*4+2],L[(o*I+S)*4+3]]}));for(let S=1;S<k;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<k;S++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let L=0;L<this.T;L++)v[T][A][L]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],L=A.left.split(" ").filter(function(J){return J.length}),S=A.right.split(" ").filter(function(J){return J.length});if(c!==null&&(c.indexOf(L[0])===-1||c.indexOf(S[0])===-1))continue;const I=h[m[L[0]]][L.length==1?0:parseInt(L[1],10)],$=h[I][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],z=h[N][1];v[0][N][I]=!0,v[0][h[N][6]][h[I][6]]=!0,v[0][h[I][4]][h[N][4]]=!0,v[0][h[I][2]][h[N][2]]=!0,v[1][z][$]=!0,v[1][h[$][6]][h[z][6]]=!0,v[1][h[z][4]][h[$][4]]=!0,v[1][h[$][2]][h[z][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const L=[],S=v[T][A];for(let I=0;I<this.T;I++)S[I]&&L.push(I);this.propagator[T][A]=L}};Ji.prototype=Object.create(EB.prototype),Ji.prototype.constructor=Ji,Ji.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},Ji.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},Ji.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},Ji.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const b=this.tiles[p][l+c*this.tilesize],k=this.weights[p]*a;f+=b[0]*k,d+=b[1]*k,h+=b[2]*k,m+=b[3]*k}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var xB=Ji,vB={OverlappingModel:wB,SimpleTiledModel:xB},TB=Fs(vB);const Jk=5;function Zk(e,t,n,r,i,s,o){if(!y(w.book))return!1;const a=w.book,c=en(a,bt.BOARD,e),l=en(a,bt.BOARD,t),u=Se(c),f=Se(l);if(!y(u)||!y(f))return!1;Re(u),Re(f);let d=0;const h=new Map,m=new Map;let p=0;const b=32,k=new Uint8Array(Nh*4);for(let I=0;I<Vt;++I)for(let $=0;$<St;++$){const N=re(f,{x:$,y:I}),z=(N==null?void 0:N.char)??0,J=(N==null?void 0:N.color)??b,M=(N==null?void 0:N.bg)??b;k[p++]=z,k[p++]=J,k[p++]=M;const O=lr(N),E=It((O==null?void 0:O.name)??"empty"),C=h.get(E);Et(C)?k[p++]=C:(h.set(E,d),m.set(d,E),k[p++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new TB.OverlappingModel(k,St,Vt,n,v,T,!1,!1,r,0);let L=0;for(;L<Jk&&!A.generate();++L);if(L===Jk)return!1;p=0;const S=A.graphics();for(let I=i.y;I<=s.y;++I)for(let $=i.x;$<=s.x;++$){const N={x:$,y:I},z=S[p++],J=S[p++],M=S[p++];switch(d=S[p++],o){case"all":{const P=re(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp),Oe(u,{x:$,y:I});break}case"object":{const P=re(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp);break}case"terrain":Oe(u,{x:$,y:I});break}let O=m.get(d)??"";const E=lr({kind:O});switch(o){case"all":break;case"object":Ge(E)||(O="");break;case"terrain":Ge(E)&&(O="");break;default:if(Gt(E,"group")!==o&&(O=""),O){const P=re(u,{x:$,y:I});Ge(P)&&Tn(u,P,a.timestamp),Oe(u,{x:$,y:I})}break}const C=O?jr(u,[O],N):void 0;if(!(!y(C)||!y(E))&&(yo(C,E),z>0&&(C.char=z),J<b&&(C.color=J),M<b&&(C.bg=M),Ge(C))){const P=Sn(Da(f,O));y(P)&&(Oe(u,{...ns(f,P.x??0,P.y??0),x:$,y:I}),yo(C,P))}}return!0}function Qk(e){return`zss_snapshot_${e}`}const tw={x:0,y:0},ew={x:St-1,y:Vt-1},nw="all";function AB(e){const t=en(w.book,bt.BOARD,e),n=Se(t);if(!y(n))return;const r=Qk(n.id);kk(w.book,r);const[i]=ts($t.MAIN,r,bt.BOARD),s=Se(i);if(y(s))return Ll(e,s.id,tw,ew,nw),s}function SB(e){const t=en(w.book,bt.BOARD,e),n=Se(t);if(!y(n))return;const r=Qk(n.id),i=en(w.book,bt.BOARD,r),s=Se(i);if(y(s))return Ll(s.id,e,tw,ew,nw),s}function RB(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return OB(e,t,i,s)}if(!y(w.book))return;const o=w.book,a=en(o,bt.BOARD,e),c=Se(a);if(!y(c))return;const l=eu();Re(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+St)%St,p=(u+t.y+Vt)%Vt;if(d){const b=re(c,{x:f,y:u});Ge(b)&&y(b==null?void 0:b.x)&&y(b==null?void 0:b.y)&&(b.x=m,b.lx=m,b.y=p,b.ly=p)}h&&(l.terrain[m+p*St]=c.terrain[f+u*St])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Oa(c)}function OB(e,t,n,r){if(!y(w.book))return;const i=w.book,s=en(i,bt.BOARD,e),o=Se(s);if(!y(o))return;Re(o);const{terrainelements:a,objectelements:c}=vk(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>dr({x:p.x??0,y:p.y??0},St)),f=[],d=[];for(let p=0;p<a.length;++p){const b=a[p],k={x:b.x??-1,y:b.y??-1},v=re(o,k);y(v)&&Ge(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(dr({x:v.x??0,y:v.y??0},St)))}let h=!1;for(let p=0;p<a.length;++p){const b=a[p],k=Gt(b,"collision"),v={x:b.x??-1,y:b.y??-1},T=dr(v,St),A={x:v.x+t.x,y:v.y+t.y};if(nu(A)){const L=re(o,A),S=(L==null?void 0:L.id)??"",I=dr({x:(L==null?void 0:L.x)??0,y:(L==null?void 0:L.y)??0},St),$=Gt(L,"collision");if(y(L)&&Ge(L)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const z=d.includes(T),J=z?re(o,v):void 0,M=z?Gt(J,"pushable"):!1,O=z&&M;if(Nd(b,L)&&(k!==zt.ISWALK||z)){let E=z;y(J)&&M&&(h=es(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0,h||(E=!1)),(E||k!==zt.ISWALK)&&(h=es(i,o,L,{x:(L.x??0)+t.x,y:(L.y??0)+t.y})!==!0,h&&(N=O))}else(k!==zt.ISWALK||O)&&(h=!0,N=O);N&&y(J)&&(h=es(i,o,J,{x:(J.x??0)-t.x,y:(J.y??0)-t.y})!==!0)}else $===zt.ISSOLID&&u.includes(I)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const b=c[p],k=Gt(b,"collision"),v={x:b.x??0,y:b.y??0},T={x:v.x+t.x,y:v.y+t.y};if(nu(T)){const A=re(o,T),L=(A==null?void 0:A.id)??"",S=Gt(A,"collision"),I=Gt(A,"group");y(A)&&Ge(A)&&f.includes(L)&&l.includes(L)!==!0?Nd(b,A)?h=es(i,o,A,T)!==!0:h=!0:$a(k,S)&&r!==I&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const b=a[p],k={x:b.x??-1,y:b.y??-1},v={x:k.x+t.x,y:k.y+t.y},T=ns(o,v.x,v.y);if(y(b)&&y(T)){Oe(o,{...b,x:v.x,y:v.y}),Oe(o,{...T,x:k.x,y:k.y});const A=re(o,k);Ge(A)&&y(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}Oa(o);for(let p=0;p<c.length;++p){const b=c[p],k={x:b.x??-1,y:b.y??-1},v={x:k.x+t.x,y:k.y+t.y};if(!es(i,o,b,v))break}Oa(o)}function jl(e,t){let n="all";const r={x:0,y:0},i={x:St-1,y:Vt-1};for(let s=t;s<e.length;){const[o,a]=it(e,s,[K.MAYBE_NUMBER_OR_STRING]);if(gt(o))n=It(o),s=a;else if(Et(o)){const[c,l,u,f]=it(e,a,[K.NUMBER,K.MAYBE_NUMBER,K.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const NB=wi().command("snapshot",()=>(!y(w.book)||!y(w.board)||AB(w.board.id),0)).command("revert",()=>(!y(w.book)||!y(w.board)||SB(w.board.id),0)).command("copy",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r]=it(t,0,[K.STRING]),i=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),s=Sn(...i);if(y(s)){const o=jl(t,r);Ll(s.id,w.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r,i,s]=it(t,0,[K.STRING,K.NUMBER,K.NUMBER]),o=bookreadcodepagesbytypeandstat(w.book,bt.BOARD,n),a=Sn(...o);if(y(a)){const c=jl(t,s);Zk(w.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!y(w.book)||!y(w.board))return 0;const[n,r]=it(t,0,[K.DIR]),i={x:n.destpt.x-(((o=w.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=w.element)==null?void 0:a.y)??0)},s=jl(t,r);return RB(w.board.id,i,s.pt1,s.pt2,w.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!y(w.book)||!y(w.board))return 0;const[n,r]=it(t,0,[K.NUMBER]),i=jl(t,r);return _B(w.board.id,_m(n),i.pt1,i.pt2,i.targetset),0});var Zi=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Zi||{});const IB={audio:Ch,board:jU,cli:jF,display:zF,element:qF,runtime:gB,loader:pB,network:mB,transform:NB},yd=["audio","board","display","network","transform","element"],CB={0:[],1:["cli",...yd],2:["loader",...yd],3:["runtime",...yd]},LB={0:new Map,1:new Map,2:new Map,3:new Map};function vo(e){return(CB[e]??[]).map(n=>IB[n]).filter(y)}function bd(e){const t=[],n=vo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function MB(e,t){const n=LB[e];if(!n.has(t)){let r;const i=vo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!y(r));++s);n.set(t,r)}return n.get(t)}function UB(e,t,n){const r=vo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function FB(e,t,n,r){const i=vo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function BB(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function rw(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var iw={},sw={},ow={};const aw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");ow.encode=function(e){if(0<=e&&e<aw.length)return aw[e];throw new TypeError("Must be between 0 and 63: "+e)};const PB=ow,cw=5,lw=1<<cw,$B=lw-1,DB=lw;function jB(e){return e<0?(-e<<1)+1:(e<<1)+0}sw.encode=function(t){let n="",r,i=jB(t);do r=i&$B,i>>>=cw,i>0&&(r|=DB),n+=PB.encode(r);while(i>0);return n};var La={};(function(e){function t(S,I,$){if(I in S)return S[I];if(arguments.length===3)return $;throw new Error('"'+I+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const I=S.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}e.urlParse=i;function s(S){let I="";return S.scheme&&(I+=S.scheme+":"),I+="//",S.auth&&(I+=S.auth+"@"),S.host&&(I+=S.host),S.port&&(I+=":"+S.port),S.path&&(I+=S.path),I}e.urlGenerate=s;const o=32;function a(S){const I=[];return function($){for(let z=0;z<I.length;z++)if(I[z].input===$){const J=I[0];return I[0]=I[z],I[z]=J,I[0].result}const N=S($);return I.unshift({input:$,result:N}),I.length>o&&I.pop(),N}}const c=a(function(I){let $=I;const N=i(I);if(N){if(!N.path)return I;$=N.path}const z=e.isAbsolute($),J=[];let M=0,O=0;for(;;)if(M=O,O=$.indexOf("/",M),O===-1){J.push($.slice(M));break}else for(J.push($.slice(M,O));O<$.length&&$[O]==="/";)O++;let E=0;for(O=J.length-1;O>=0;O--){const C=J[O];C==="."?J.splice(O,1):C===".."?E++:E>0&&(C===""?(J.splice(O+1,E),E=0):(J.splice(O,2),E--))}return $=J.join("/"),$===""&&($=z?"/":"."),N?(N.path=$,s(N)):$});e.normalize=c;function l(S,I){S===""&&(S="."),I===""&&(I=".");const $=i(I),N=i(S);if(N&&(S=N.path||"/"),$&&!$.scheme)return N&&($.scheme=N.scheme),s($);if($||I.match(r))return I;if(N&&!N.host&&!N.path)return N.host=I,s(N);const z=I.charAt(0)==="/"?I:c(S.replace(/\/+$/,"")+"/"+I);return N?(N.path=z,s(N)):z}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,I){S===""&&(S="."),S=S.replace(/\/$/,"");let $=0;for(;I.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return I;++$}return Array($+1).join("../")+I.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const I=S.length;if(I<9||S.charCodeAt(I-1)!==95||S.charCodeAt(I-2)!==95||S.charCodeAt(I-3)!==111||S.charCodeAt(I-4)!==116||S.charCodeAt(I-5)!==111||S.charCodeAt(I-6)!==114||S.charCodeAt(I-7)!==112||S.charCodeAt(I-8)!==95||S.charCodeAt(I-9)!==95)return!1;for(let $=I-10;$>=0;$--)if(S.charCodeAt($)!==36)return!1;return!0}function b(S,I,$){let N=v(S.source,I.source);return N!==0||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0||$)||(N=S.generatedColumn-I.generatedColumn,N!==0)||(N=S.generatedLine-I.generatedLine,N!==0)?N:v(S.name,I.name)}e.compareByOriginalPositions=b;function k(S,I,$){let N=S.generatedLine-I.generatedLine;return N!==0||(N=S.generatedColumn-I.generatedColumn,N!==0||$)||(N=v(S.source,I.source),N!==0)||(N=S.originalLine-I.originalLine,N!==0)||(N=S.originalColumn-I.originalColumn,N!==0)?N:v(S.name,I.name)}e.compareByGeneratedPositionsDeflated=k;function v(S,I){return S===I?0:S===null?1:I===null?-1:S>I?1:-1}function T(S,I){let $=S.generatedLine-I.generatedLine;return $!==0||($=S.generatedColumn-I.generatedColumn,$!==0)||($=v(S.source,I.source),$!==0)||($=S.originalLine-I.originalLine,$!==0)||($=S.originalColumn-I.originalColumn,$!==0)?$:v(S.name,I.name)}e.compareByGeneratedPositionsInflated=T;function A(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function L(S,I,$){if(I=I||"",S&&(S[S.length-1]!=="/"&&I[0]!=="/"&&(S+="/"),I=S+I),$){const N=i($);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const z=N.path.lastIndexOf("/");z>=0&&(N.path=N.path.substring(0,z+1))}I=l(s(N),I)}return c(I)}e.computeSourceURL=L})(La);var kd={};let zB=class oE{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new oE;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};kd.ArraySet=zB;var uw={};const hw=La;function WB(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||hw.compareByGeneratedPositionsInflated(e,t)<=0}let GB=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){WB(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(hw.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};uw.MappingList=GB;const Ma=sw,qe=La,zl=kd.ArraySet,KB=uw.MappingList;let fw=class aE{constructor(t){t||(t={}),this._file=qe.getArg(t,"file",null),this._sourceRoot=qe.getArg(t,"sourceRoot",null),this._skipValidation=qe.getArg(t,"skipValidation",!1),this._sources=new zl,this._names=new zl,this._mappings=new KB,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new aE({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=qe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=qe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=qe.getArg(t,"generated"),r=qe.getArg(t,"original",null);let i=qe.getArg(t,"source",null),s=qe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=qe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[qe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[qe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=qe.relative(s,i));const o=this._mappings.toArray().length>0?new zl:this._sources,a=new zl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=qe.join(r,c.source)),s!=null&&(c.source=qe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=qe.join(r,c)),s!=null&&(c=qe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!qe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Ma.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Ma.encode(f-o),o=f,c+=Ma.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Ma.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ma.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=qe.relative(n,r));const i=qe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};fw.prototype._version=3,iw.SourceMapGenerator=fw;var dw={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(dw);var Ua={exports:{}},HB={},YB=Object.freeze({__proto__:null,default:HB}),pw=cE(YB);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ua.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ua.exports.initialize=t=>e=t}else{const e=pw,t=pw;Ua.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ua.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var mw=Ua.exports;const VB=mw;function XB(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Fa=null;var qB=function(){if(Fa)return Fa;const t=[];return Fa=VB().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new XB;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Fa=null,n}),Fa};const Ot=La,wd=dw,Wl=kd.ArraySet,JB=mw,ZB=qB,Ed=Symbol("smcInternal");class He{constructor(t,n){return t==Ed?Promise.resolve(this):tP(t,n)}static initialize(t){JB.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return eP(t,n)}static async with(t,n,r){const i=await new He(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}He.prototype._version=3,He.GENERATED_ORDER=1,He.ORIGINAL_ORDER=2,He.GREATEST_LOWER_BOUND=1,He.LEAST_UPPER_BOUND=2;class Ba extends He{constructor(t,n){return super(Ed).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version");let o=Ot.getArg(i,"sources");const a=Ot.getArg(i,"names",[]);let c=Ot.getArg(i,"sourceRoot",null);const l=Ot.getArg(i,"sourcesContent",null),u=Ot.getArg(i,"mappings"),f=Ot.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Ot.normalize(c)),o=o.map(String).map(Ot.normalize).map(function(d){return c&&Ot.isAbsolute(c)&&Ot.isAbsolute(d)?Ot.relative(c,d):d}),r._names=Wl.fromArray(a.map(String),!0),r._sources=Wl.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Ot.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,ZB().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Ot.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ba(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Ot.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case He.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case He.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Ot.getArg(t,"source");const r=Ot.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);r==null&&(r=He.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Ot.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Ot.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Ot.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Ot.getArg(i,"originalLine",null),column:Ot.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Ot.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Ot.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Ot.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Ot.getArg(t,"line"),originalColumn:Ot.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Ot.getArg(t,"bias",He.GREATEST_LOWER_BOUND);i==null&&(i=He.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Ot.getArg(s,"generatedLine",null),column:Ot.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ba.prototype.consumer=He;class QB extends He{constructor(t,n){return super(Ed).then(r=>{let i=t;typeof t=="string"&&(i=Ot.parseSourceMapInput(t));const s=Ot.getArg(i,"version"),o=Ot.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new Wl,r._names=new Wl,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Ot.getArg(c,"offset"),u=Ot.getArg(l,"line"),f=Ot.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new He(Ot.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Ot.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Ot.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Ot.getArg(t,"line"),generatedColumn:Ot.getArg(t,"column")},r=wd.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Ot.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Ot.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER;let o;switch(s){case He.GENERATED_ORDER:o=this._generatedMappings;break;case He.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Ot.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return wd.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Ot.getArg(t,"line"),r={source:Ot.getArg(t,"source"),originalLine:n,originalColumn:Ot.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Ot.compareByOriginalPositions,wd.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Ot.getArg(o,"generatedLine",null),column:Ot.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function tP(e,t){let n=e;typeof e=="string"&&(n=Ot.parseSourceMapInput(e));const r=n.sections!=null?new QB(n,t):new Ba(n,t);return Promise.resolve(r)}function eP(e,t){return Ba.fromSourceMap(e,t)}var gw={};const nP=iw.SourceMapGenerator,Gl=La,rP=/(\r?\n)/,iP=10,To="$$$isSourceNode$$$";let sP=class Gd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[To]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Gd,s=t.split(rP);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=Gl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?Gl.join(r,h.source):h.source;i.add(new Gd(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[To]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[To]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[To]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[To]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Gl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][To]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Gl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new nP(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===iP?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};gw.SourceNode=sP;var oP=gw.SourceNode;let _w=0;const yw=Zr,aP=["Command","lines"];class cP extends HM{constructor(){super(hk,{traceInitPerf:Zr,skipValidations:!Zr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});xt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));xt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Rl)}])}));xt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));xt(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Pf)}));xt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Bf)}));xt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(My)}])}));xt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Uy)}));xt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Fy),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME(By)}));xt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(_o),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));xt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));xt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(Kf),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(Z1),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])}));xt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Hf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));xt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Nl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Rl)),this.CONSUME4(_o),this.CONSUME4(Yf)}}])}));xt(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Nl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(_o),this.CONSUME(Yf)}}])}));xt(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Nl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));xt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(_o),this.CONSUME(Vf),this.CONSUME(Hf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(_o),this.CONSUME(Vf),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));xt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(ik),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(sk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(ok),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(ak),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));xt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(ck)}));xt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(lk)}));xt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(ek)}));xt(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(nk)}));xt(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(rk)}));xt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Df),this.SUBRULE2(this.and_test)})}));xt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(zf),this.SUBRULE2(this.not_test)})}));xt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(jf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));xt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));xt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(Y1)}])}));xt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Df),this.SUBRULE2(this.and_test_value)})}));xt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(zf),this.SUBRULE2(this.not_test_value)})}));xt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(jf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));xt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));xt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Wf)},{ALT:()=>this.CONSUME(Gf)}]),this.SUBRULE(this.term)}));xt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));xt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(Kf)},{ALT:()=>this.CONSUME(q1)},{ALT:()=>this.CONSUME(J1)}]),this.SUBRULE(this.factor)}));xt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Wf)},{ALT:()=>this.CONSUME(Gf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));xt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(V1),this.SUBRULE(this.factor)})}));xt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));xt(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));xt(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME($y)}])}));xt(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)},{ALT:()=>this.CONSUME(Wy)},{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(Ky)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)}])}));xt(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Vy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(qy)},{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(tb)},{ALT:()=>this.CONSUME(eb)},{ALT:()=>this.CONSUME(nb)},{ALT:()=>this.CONSUME(rb)},{ALT:()=>this.CONSUME(ib)},{ALT:()=>this.CONSUME(sb)},{ALT:()=>this.CONSUME(ob)},{ALT:()=>this.CONSUME(ab)},{ALT:()=>this.CONSUME(cb)},{ALT:()=>this.CONSUME(lb)},{ALT:()=>this.CONSUME(ub)},{ALT:()=>this.CONSUME(hb)},{ALT:()=>this.CONSUME(fb)},{ALT:()=>this.CONSUME(db)},{ALT:()=>this.CONSUME(pb)},{ALT:()=>this.CONSUME(mb)},{ALT:()=>this.CONSUME(gb)},{ALT:()=>this.CONSUME(_b)},{ALT:()=>this.CONSUME(yb)},{ALT:()=>this.CONSUME(bb)},{ALT:()=>this.CONSUME(kb)},{ALT:()=>this.CONSUME(wb)},{ALT:()=>this.CONSUME(Eb)},{ALT:()=>this.CONSUME(xb)},{ALT:()=>this.CONSUME(vb)},{ALT:()=>this.CONSUME(Tb)},{ALT:()=>this.CONSUME(Ab)},{ALT:()=>this.CONSUME(Sb)},{ALT:()=>this.CONSUME(Rb)},{ALT:()=>this.CONSUME(Ob)},{ALT:()=>this.CONSUME(Nb)},{ALT:()=>this.CONSUME(Ib)},{ALT:()=>this.CONSUME(Cb)},{ALT:()=>this.CONSUME(Lb)},{ALT:()=>this.CONSUME(Mb)},{ALT:()=>this.CONSUME(Ub)},{ALT:()=>this.CONSUME(Fb)},{ALT:()=>this.CONSUME(Bb)},{ALT:()=>this.CONSUME(Pb)},{ALT:()=>this.CONSUME($b)},{ALT:()=>this.CONSUME(Db)}])}));xt(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Qb)},{ALT:()=>this.CONSUME(t1)},{ALT:()=>this.CONSUME(e1)},{ALT:()=>this.CONSUME(n1)},{ALT:()=>this.CONSUME(w1)},{ALT:()=>this.CONSUME(E1)}])}));xt(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(jb)},{ALT:()=>this.CONSUME(zb)},{ALT:()=>this.CONSUME(Wb)},{ALT:()=>this.CONSUME(Gb)},{ALT:()=>this.CONSUME(Kb)},{ALT:()=>{this.CONSUME(Hb),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(Yb),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(r1),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(i1),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(Vb)},{ALT:()=>this.CONSUME(Xb)},{ALT:()=>this.CONSUME(qb)},{ALT:()=>this.CONSUME(Jb)},{ALT:()=>this.CONSUME(Zb)},{ALT:()=>{this.CONSUME(s1),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(o1),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(a1),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(c1)},{ALT:()=>this.CONSUME(l1)},{ALT:()=>this.CONSUME(u1)},{ALT:()=>this.CONSUME(h1)},{ALT:()=>this.CONSUME(f1)},{ALT:()=>this.CONSUME(d1)},{ALT:()=>this.CONSUME(p1)},{ALT:()=>this.CONSUME(m1)},{ALT:()=>this.CONSUME(g1)},{ALT:()=>this.CONSUME(_1)},{ALT:()=>this.CONSUME(y1)},{ALT:()=>this.CONSUME(b1)},{ALT:()=>this.CONSUME(k1)}])}));xt(this,"expr_any",this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])}));xt(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(A1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(S1),this.SUBRULE(this.expr_any)}));xt(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(R1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(O1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(N1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(I1),this.SUBRULE(this.simple_token)}));xt(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(C1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));xt(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(L1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(M1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(U1),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(F1),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));xt(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(B1),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));xt(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(P1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));xt(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME($1),this.SUBRULE(this.string_token)}));xt(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(D1),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));xt(this,"token_expr",this.RULED("token_expr",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(x1)},{ALT:()=>this.CONSUME(v1)},{ALT:()=>this.CONSUME(T1)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])})}));xt(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Ol)}])}));xt(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME($f)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Ol)}])}));xt(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));xt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.token_expr)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Pf)},{ALT:()=>this.CONSUME(Ol)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME($f)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>{this.CONSUME(Q1),this.SUBRULE(this.expr),this.CONSUME(tk)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=aP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(_w++).toString().padStart(3),c=s?"font-weight: bold;":"";if(yw&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),yw&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),_w--},i)}}const Ao=new cP;if(lS){const e=Ao.getGAstProductions(),t=iU(e);console.info(t)}const lP=Ao.getBaseCstVisitorConstructor();var wt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(wt||{}),Cs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Cs||{}),li=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(li||{}),Kl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Kl||{});function oe(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class uP extends lP{constructor(){super();xt(this,"unique",0);Zr&&this.validateVisitor()}visit(n){if(ue(n)&&(n=n[0]),!!y(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():y(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.stmt_command?this.go(n.stmt_command):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.structured_cmd?this.go(n.structured_cmd):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:oe(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:oe(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=oe(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:oe(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:oe(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n,r){return n.structured_cmd?this.go(n.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(n.string_token),this.go(n.dir)].flat()})):[]}command_if(n,r){const[i]=this.createlogicnode(r,oe(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=De(),s=De();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=De(),s=De();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,oe(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){const i=[];return n.words&&i.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))),n.command_fork&&i.push(...this.go(n.command_fork)),this.createcodenode(r,{type:17,lines:i})}command_while(n,r){const i=De(),s=De();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=De();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=oe(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}command_toast(n,r){const s=oe(n.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}command_ticker(n,r){const s=oe(n.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}kind(n){return[this.go(n.color),this.go(n.string_token)].flat()}category(n,r){if(n.token_isterrain){const i=oe(n.token_isterrain,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isobject){const i=oe(n.token_isobject,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}collision(n,r){if(n.token_iswalkable){const i=oe(n.token_iswalkable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalking){const i=oe(n.token_iswalking,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalk){const i=oe(n.token_iswalk,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimmable){const i=oe(n.token_isswimmable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimming){const i=oe(n.token_isswimming,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswim){const i=oe(n.token_isswim,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_issolid){const i=oe(n.token_issolid,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isbullet){const i=oe(n.token_isbullet,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}color(n,r){let i="ERROR";return n.token_black&&(i="black"),n.token_dkblue&&(i="dkblue"),n.token_dkgreen&&(i="dkgreen"),n.token_dkcyan&&(i="dkcyan"),n.token_dkred&&(i="dkred"),n.token_dkpurple&&(i="dkpurple"),n.token_dkyellow&&(i="dkyellow"),n.token_ltgray&&(i="ltgray"),n.token_dkgray&&(i="dkgray"),n.token_blue&&(i="blue"),n.token_green&&(i="green"),n.token_cyan&&(i="cyan"),n.token_red&&(i="red"),n.token_purple&&(i="purple"),n.token_yellow&&(i="yellow"),n.token_white&&(i="white"),n.token_brown&&(i="brown"),n.token_dkwhite&&(i="dkwhite"),n.token_ltgrey&&(i="ltgrey"),n.token_gray&&(i="gray"),n.token_grey&&(i="grey"),n.token_dkgrey&&(i="dkgrey"),n.token_ltblack&&(i="ltblack"),n.token_onblack&&(i="onblack"),n.token_ondkblue&&(i="ondkblue"),n.token_ondkgreen&&(i="ondkgreen"),n.token_ondkcyan&&(i="ondkcyan"),n.token_ondkred&&(i="ondkred"),n.token_ondkpurple&&(i="ondkpurple"),n.token_ondkyellow&&(i="ondkyellow"),n.token_onltgray&&(i="onltgray"),n.token_ondkgray&&(i="ondkgray"),n.token_onblue&&(i="onblue"),n.token_ongreen&&(i="ongreen"),n.token_oncyan&&(i="oncyan"),n.token_onred&&(i="onred"),n.token_onpurple&&(i="onpurple"),n.token_onyellow&&(i="onyellow"),n.token_onwhite&&(i="onwhite"),n.token_onbrown&&(i="onbrown"),n.token_ondkwhite&&(i="ondkwhite"),n.token_onltgrey&&(i="onltgrey"),n.token_ongray&&(i="ongray"),n.token_ongrey&&(i="ongrey"),n.token_ondkgrey&&(i="ondkgrey"),n.token_onltblack&&(i="onltblack"),n.token_onclear&&(i="onclear"),this.createcodenode(r,{type:12,literal:1,value:i})}dir_mod(n,r){let i="ERROR";return n.token_cw&&(i="cw"),n.token_ccw&&(i="ccw"),n.token_opp&&(i="opp"),n.token_rndp&&(i="rndp"),n.token_over&&(i="over"),n.token_under&&(i="under"),this.createcodenode(r,{type:12,literal:1,value:i})}dir(n,r){const i=this.go(n.dir_mod)??[];return n.token_i&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"i"})),n.token_idle&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"idle"})),n.token_n&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"n"})),n.token_u&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"u"})),n.token_north&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"north"})),n.token_up&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"up"})),n.token_s&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"s"})),n.token_d&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"d"})),n.token_south&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"south"})),n.token_down&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"down"})),n.token_w&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"w"})),n.token_l&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"l"})),n.token_west&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"west"})),n.token_left&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"left"})),n.token_e&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"e"})),n.token_r&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"r"})),n.token_east&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"east"})),n.token_right&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"right"})),n.token_rnd&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),n.token_rndne&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),n.token_rndns&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"rndns"})),n.token_flow&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"flow"})),n.token_by&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"by"}),...this.go(n.simple_token)),n.token_at&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"at"}),...this.go(n.simple_token)),n.token_away&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"away"}),...this.go(n.simple_token)),n.token_toward&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"toward"}),...this.go(n.simple_token)),n.token_find&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"find"}),...this.go(n.kind)),n.token_flee&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"flee"}),...this.go(n.kind)),n.token_to&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"to"}),...this.go(n.dir)),i.flat()}expr_any(n){return[this.go(n.dir),this.go(n.kind),this.go(n.color)].flat()}token_expr_any(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(n.expr_any)].flat()}token_expr_count(n,r){return[this.createcodenode(r,{type:12,literal:1,value:"count"}),this.go(n.expr_any)].flat()}token_expr_abs(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(n.simple_token)]}token_expr_intceil(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(n.simple_token)]}token_expr_intfloor(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(n.simple_token)]}token_expr_intround(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(n.simple_token)]}token_expr_clamp(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(n.simple_token)]}token_expr_min(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(n.simple_tokens)]}token_expr_max(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(n.simple_tokens)]}token_expr_pick(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(n.simple_tokens)]}token_expr_pickwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(n.simple_tokens)]}token_expr_random(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(n.simple_token)]}token_expr_randomwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(n.simple_token)]}token_expr_run(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(n.string_token)]}token_expr_runwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(n.simple_token),...this.go(n.string_token)]}token_expr(n,r){const i=[];return n.token_expr_aligned&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"aligned"})),n.token_contact&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"contact"})),n.token_blocked&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"blocked"})),n.token_expr_any?this.go(n.token_expr_any):n.token_expr_count?this.go(n.token_expr_count):n.token_expr_abs?this.go(n.token_expr_abs):n.token_expr_intceil?this.go(n.token_expr_intceil):n.token_expr_intfloor?this.go(n.token_expr_intfloor):n.token_expr_intround?this.go(n.token_expr_intround):n.token_expr_clamp?this.go(n.token_expr_clamp):n.token_expr_min?this.go(n.token_expr_min):n.token_expr_max?this.go(n.token_expr_max):n.token_expr_pick?this.go(n.token_expr_pick):n.token_expr_pickwith?this.go(n.token_expr_pickwith):n.token_expr_random?this.go(n.token_expr_random):n.token_expr_randomwith?this.go(n.token_expr_randomwith):n.token_expr_run?this.go(n.token_expr_run):n.token_expr_runwith?this.go(n.token_expr_runwith):i}string_token(n,r){if(n.token_stringliteraldouble){const i=oe(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=oe(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}simple_token(n,r){if(n.token_stringliteraldouble){const i=oe(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=oe(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(oe(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}simple_tokens(n,r){if(n.token_stringliteraldouble){const i=oe(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=oe(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(oe(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}return[]}token(n,r){if(n.category)return this.go(n.category);if(n.collision)return this.go(n.collision);if(n.color)return this.go(n.color);if(n.dir)return this.go(n.dir);if(n.token_expr)return this.go(n.token_expr);if(n.command_play)return this.go(n.command_play);if(n.command_toast)return this.go(n.command_toast);if(n.command_ticker)return this.go(n.command_ticker);if(n.token_label){const i=oe(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=oe(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=oe(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(oe(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}if(n.token_lparen)return this.createcodenode(r,{type:31,words:this.go(n.expr)});if(n.token_stop){const i=oe(n.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}}const hP=new uP,Xn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Hl="zss.js";function ne(e,t){return new oP(e.startLine??1,e.startColumn??1,Hl,t)}function xd(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function vd(e){return`'${xd(e)}'`}function Td(e){const t=hd(e);return t.errors.length?e:`['${t.tokens.map(r=>{if(r.tokenType===ld){const i=xd(r.image.substring(1));return It(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return xd(r.image)}).join("")}'].join('')`}function So(e){return e.filter(t=>t!==void 0).map(ae)}function bw(e){return ne(e,"")}function fP(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function rn(e,t,n){return ne(e,[`api.${t}(`,...fP(n,", "),")"])}function dP(e){if(e.type===wt.COMPARE&&e.compare.type===wt.COMPARE_ITEM)switch(e.compare.method){case Cs.IS_EQ:return rn(e,"isEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_NOT_EQ:return rn(e,"isNotEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN:return rn(e,"isLessThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN:return rn(e,"isGreaterThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN_OR_EQ:return rn(e,"isLessThanOrEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN_OR_EQ:return rn(e,"isGreaterThanOrEq",[ae(e.lhs),ae(e.rhs)])}return ne(e,"")}function Ls(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ae(n),")"])}function kw(e,t,n){return e.prepend(`api.${t}(`),e.add([ae(n),")"])}function pP(e,t){if(e.type===wt.OPERATOR_ITEM)switch(e.operator){case li.PLUS:return Ls(t,"opPlus",e.rhs);case li.MINUS:return Ls(t,"opMinus",e.rhs);case li.POWER:return Ls(t,"opPower",e.rhs);case li.MULTIPLY:return Ls(t,"opMultiply",e.rhs);case li.DIVIDE:return Ls(t,"opDivide",e.rhs);case li.MOD_DIVIDE:return Ls(t,"opModDivide",e.rhs);case li.FLOOR_DIVIDE:return Ls(t,"opFloorDivide",e.rhs);case li.UNI_PLUS:return kw(t,"opUniPlus",e.rhs);case li.UNI_MINUS:return kw(t,"opUniMinus",e.rhs)}return ne(e,"")}function mP(e){if(e.type===wt.OPERATOR){const t=e.lhs?ae(e.lhs):ne(e,"");return e.items.forEach(n=>pP(n,t)),t}return ne(e,"")}function Yl(e,t){return ne(e,[rn(e,"jump",[`${t}`]),"; continue;"])}function Li(e){return Xn.linelookup[e??""]??-1}function Ad(e,t){Xn.linelookup[e]=t}function Ro(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&(i.done=n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&(i.skip=n);break;case wt.LINE:Ro(i.stmts,t,n);break}}}function ww(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&Ad(i.done,n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&Ad(i.skip,n);break;case wt.LINE:ww(i.stmts,t,n);break}}}function ae(e){var t;switch(e.type){case wt.PROGRAM:return ne(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ae).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Hl}`]);case wt.API:return ne(e,["  ",rn(e,e.method,So(e.words)),`;
`]);case wt.LINE:return ne(e,[`case ${e.lineindex}:
`,...e.stmts.map(ae).flat(),`  break;
`]);case wt.MARK:return ne(e,`  // ${e.comment}
`);case wt.GOTO:{const n=Li(e.id);return ne(e,["  ",Yl(e,n),`
`])}case wt.COUNT:return ne(e,`${e.index}`);case wt.LITERAL:switch(e.literal){case Kl.NUMBER:return ne(e,`${e.value}`);case Kl.STRING:return ne(e,vd(e.value));case Kl.TEMPLATE:return ne(e,Td(e.value))}return bw(e);case wt.TEXT:return ne(e,["  ",rn(e,"text",[Td(e.value)]),`;
`]);case wt.STAT:if(Xn.isfirststat){Xn.isfirststat=!1;const n=e.value.trim().split(" ").map(vd);return ne(e,["  ",rn(e,"stat",n),`;
`])}return ne(e,`  // skipped ${e.value}
`);case wt.LABEL:{const n=It(e.name),r=e.active?"label":"comment";Xn.labels[n]||(Xn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Xn.labels[n].push(i),ne(e,`  // ${i} '${n}' ${r}
`)}case wt.HYPERLINK:return ne(e,["  ",rn(e,"hyperlink",[Td(e.text),...So(e.link)]),`;
`]);case wt.MOVE:{const n=rn(e,"command",[vd("go"),So(e.words)].flat());return e.wait?ne(e,["  if (",n,`) { continue; };
`]):ne(e,["  ",n,`;
`])}case wt.COMMAND:return ne(e,["  if (",rn(e,"command",So(e.words)),`) { continue; };
`]);case wt.IF:{const n=((t=e.block)==null?void 0:t.type)===wt.IF_BLOCK?e.block:void 0;if(y(n)){Ro([e.check],wt.IF_CHECK,n.skip);const r=ne(e,ae(e.check));return n.lines.forEach(i=>r.add(ae(i))),ww(n.altlines,wt.ELSE_IF,Li(n.done)),n.altlines.forEach(i=>r.add(ae(i))),r}return ne(e,ae(e.check))}case wt.IF_CHECK:{const n=Li(e.skip);return n===-1?ne(e,["  ",rn(e,e.method,So(e.words)),`;
`]):ne(e,["  if (!",rn(e,e.method,So(e.words)),") { ",Yl(e,n),` }
`])}case wt.ELSE_IF:case wt.ELSE:{const n=ne(e,"");return e.lines.forEach(r=>n.add(ae(r))),n}case wt.WHILE:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.REPEAT:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.WAITFOR:{const n=ne(e,"");return Ro(e.lines,wt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ae(r))}),n}case wt.FOREACH:{const n=Li(e.loop),r=Li(e.done),i=ne(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.BREAK:return ne(e,["  ",Yl(e,e.goto),`
`]);case wt.CONTINUE:return ne(e,["  ",Yl(e,e.goto),`
`]);case wt.OR:return rn(e,"or",e.items.map(ae));case wt.AND:return rn(e,"and",e.items.map(ae));case wt.NOT:return rn(e,"not",e.items.map(ae));case wt.COMPARE:return dP(e);case wt.OPERATOR:return mP(e);case wt.EXPR:return rn(e,"expr",e.words.map(ae));default:return console.error("<unsupported node>",e.type,e),bw(e)}}function ui(e){if(y(e))switch(e.type===wt.LINE&&++Xn.lineindex,e.lineindex=Xn.lineindex,e.type){case wt.PROGRAM:e.lines.forEach(ui);break;case wt.LINE:e.stmts.forEach(ui);break;case wt.MARK:Ad(e.id,e.lineindex);break;case wt.IF:ui(e.check),ui(e.block);break;case wt.IF_BLOCK:e.lines.forEach(ui),e.altlines.forEach(ui);break;case wt.ELSE_IF:e.lines.forEach(ui);break;case wt.ELSE:case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.WAITFOR:e.lines.forEach(ui);break;case wt.MOVE:case wt.COMMAND:case wt.IF_CHECK:e.words.forEach(ui);break}}function gP(e){Xn.labels={},Xn.internal=1,Xn.lineindex=0,Xn.isfirststat=!0,ui(e)}function _P(e){return gP(e),{...ae(e).toStringWithSourceMap({file:`${Hl}.map`}),...Xn}}function Ew(e){return ue(e)?e.length>0?1:0:e??0}function yP(e){return`${e}_chip`}function xw(e=""){return`vm:${e??""}`}function bP(e,t,n){var l,u;const r=yP(e),i=vr(r);let s;const o=Ar(Object.entries(n.labels??{}));(!ue(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){w.words=d;const h=MB(t,f);return y(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){MP(r)},id(){return e},set(f,d){const[h,m]=FB(t,c,f,d);if(h)return m},get(f){const[d,h]=UB(t,c,f);if(d)return h},tick(f){const d=Et(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return rw(t,c),!1;i.lc=0,i.ys=0,w.get=c.get,BB(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(nt,w.elementfocus,"crash",m.message),i.es=1}return rw(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Et(i.lc)?++i.lc>ki.HALT_AT_COUNT:!0},hm(){if(ue(i.mg)&&ue(i.lb)){const[f]=i.mg;if(y(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>Et(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){nt.emit(f,`${xw(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&y(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=Et(i.ec)?i.ec:1;const f=c.hm();if(f&&ue(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),y(d)&&c.set("arg",d),m&&(c.set("player",m),w.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=Et(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=JA.parse(f),[h]=d.filter(m=>m.fileName===Hl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Te(d)),h)},if(...f){const[d,h]=it(f,0,[K.ANY]),m=Ew(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=it(f,0,[K.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=it(f,0,[K.NAME,K.ANY]),p=Et(h),b=p?m:1,k=c.get(d),v=p?h:1;if(!Et(k))return b<f.length&&c.command(...f.slice(b)),1;const T=k-v;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=it(f,0,[K.NAME,K.ANY]),p=Et(h),b=p?m:1,k=c.get(d),v=p?h:1,T=k===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,ea(k,0)+v),T},repeatstart(f,...d){const[h,m]=it(d,0,[K.NUMBER]),p=`repeatcount${f}`,b=`repeatwords${f}`;i[p]=h,i[b]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!Et(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,b=i[h];return p&&ue(b)&&c.command(...b),p?1:0},foreachstart(f,...d){const[h,m,p,b]=it(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let k=Math.min(m,p),v=Math.max(m,p);const T=(b??0)||1;if(T<0){const A=k;k=v,v=A}return c.set(h,k-T),0},foreach(f,...d){const[h,m,p,b,k]=it(d,0,[K.NAME,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let v=Math.min(m,p),T=Math.max(m,p);const A=(b??0)||1;if(A<0){const I=v;v=T,T=I}let L=c.get(h);!Et(L)||L<v||L>T?L=v:L+=A;const S=L<=T?1:0;return S&&(c.set(h,L),k<d.length&&c.command(...d.slice(k))),S},waitfor(...f){const[d]=it(f,0,[K.ANY]),h=Ew(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=it(f,h,[K.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=it(f,h,[K.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=it(f,0,[K.ANY]);return d?0:1},expr(...f){const[d]=it(f,0,[K.ANY]);return d},isEq(f,d){const[h]=it([f],0,[K.ANY]),[m]=it([d],0,[K.ANY]);return typeof h=="object"||typeof m=="object"?jE(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=it([f],0,[K.ANY]),[m]=it([d],0,[K.ANY]);return h+m},opMinus(f,d){const[h]=it([f],0,[K.ANY]),[m]=it([d],0,[K.ANY]);return h-m},opPower(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h*m},opDivide(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h/m},opModDivide(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=it([f],0,[K.NUMBER]),[m]=it([d],0,[K.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=it([f],0,[K.NUMBER]);return+d},opUniMinus(f){const[d]=it([f],0,[K.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function Sd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ue(r)?r.forEach(i=>{t.push(Sd(i))}):t.push(Sd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function kP(e){const t=fk(`${e}
`);if(t.errors.length>0)return t;Ao.input=t.tokens;const n=Ao.program();if(Ao.errors.length>0)return{tokens:t.tokens,errors:Ao.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=hP.go(n);return r?(Sd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Rd=Object.getPrototypeOf(function*(){}).constructor;function wP(e,t){const n=`compile-${e}`;console.time(n);const r=kP(t);if(console.timeEnd(n),Cm&&console.info(t,r.errors),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=_P(r.ast);if(i.code){Cm&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Rd("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Rd("api"," ")}}}return{...r,...i,source:"",code:new Rd("api"," ")}}function EP(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=wP(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return y(s)?s.isended():!0},halt(i){const s=t[i];return y(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];y(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!y(t[i])){const f=n(a,c);if(l=t[i]=bP(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((k,v)=>[k,v]);m.slice(h-5,h).forEach(([k,v])=>{de(nt,cr(),"build",`$grey${v+1} $grey${k}`)});const[p,b]=m[h]??[];if(gt(p)&&y(b)){const k=(d.column??1)-1,v=k+d.length,T=k<p.length?p:`${p}*`,A=T.substring(0,k),L=T.substring(k,v),S=T.substring(v);de(nt,cr(),"build",`$red${b+1} $grey${A}$red${L}$grey${S}`)}return d.message.split(`
`).forEach(k=>{de(nt,cr(),"build",k)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=$n(i.target),a=t[s];if(y(a)){const c={...i,target:o};a.message(c)}}};return r}const vn=new qo,Ln={},Vl={};function vw(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return y(Ln[o])||(Ln[o]=tS(e,t,n,r,i,s)),Ln[o]}function xP(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return y(Vl[s])||(Vl[s]=eS(e,t,n)),Vl[s].id=i,Vl[s]}function vP(e,t){const n=`sprites:${e}:${t}`;return y(Ln[n])||(Ln[n]=nS(e,t)),Ln[n]}function TP(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return y(Ln[s])||(Ln[s]=rS(e,t,n,r,i)),Ln[s]}function Xl(e,t,n,r){const i=`media:${e}:${t}`;y(Ln[i])||(Ln[i]=iS(e,t,n,r));const s=Ln[i];return s.mime=n,s.media=r,s}function AP(e,t){const n=`control:${e}:${t}`;return y(Ln[n])||(Ln[n]=sS(e,t)),Ln[n]}const Qi=3;function Tw(e,t){const n=[],r=(e.x+.5)*ji,i=(e.y+.5)*zi,s=t.x*ji,o=t.y*zi,a=s-r,c=o-i;vn.x=a-Qi,vn.y=c-Qi,n.push(vn.angle()),vn.x=a+ji+Qi,vn.y=c-Qi,n.push(vn.angle()),vn.x=a-Qi,vn.y=c+zi+Qi,n.push(vn.angle()),vn.x=a+ji+Qi,vn.y=c+zi+Qi,n.push(vn.angle());const l=n.map(h=>Math.round(ym(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(k=>k<180),m=l.filter(k=>k>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function ql(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=zr(e,l);if(u===-1)return;vn.x=a-i.x,vn.y=Math.round((c-i.y)*1.333);const f=vn.length();if(f>s)return;const d=Math.round(ym(vn.angle()));let h=0;for(let A=0;A<n.length;++A){const[L,S,I]=n[A];L>S?(d>=L||d<=S)&&(h=Math.max(h,I)):d>=L&&d<=S&&(h=Math.max(h,I))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=gn(t[u],0,1);const p=Un(e,((T=e.lookup)==null?void 0:T[u])??"");if(y(p)){const A=[...Tw(i,l),.25];r.push(A)}const b=e.terrain[u],k=lr(b),v=(b==null?void 0:b.collision)??(k==null?void 0:k.collision);if($a(zt.ISBULLET,v)){const A=[...Tw(i,l),1];r.push(A)}}function Od(e,t,n,r,i,s){if(!y(n)||!y(n.terrain)||!y(n.objects))return[];const o=[];let a=t;const c=St,l=Vt,u=s?Lt.BLACK:Lt.ONCLEAR,f=vw(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=vP(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=TP(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const b=vw(e,a++,"tickers",c,l,Lt.ONCLEAR);o.push(b),b.char.fill(0);const k={...fd(St,Vt,r,Lt.ONCLEAR),...b},v=AP(e,a++);if(i){o.push(v);const{graphics:$,camera:N,facing:z}=vr(e),J=n.graphics??$??"",M=n.camera??N??"",O=n.facing??z??"";if(gt(J)){const E=It(J);switch(E){case"fpv":case"iso":case"mode7":v.graphics=E;break;default:case"flat":v.graphics="flat";break}}if(gt(M))switch(It(M)){default:case"mid":v.viewscale=Ic.MID;break;case"near":v.viewscale=Ic.NEAR;break;case"far":v.viewscale=Ic.FAR;break}Et(O)&&(v.facing=_m(O%360))}for(let $=0;$<n.terrain.length;++$){const N=n.terrain[$],z=nn(N,0,Lt.WHITE,s?Lt.BLACK:Lt.ONCLEAR),J=Gt(N,"collision");f.char[$]=z.char,f.color[$]=z.color,f.bg[$]=z.bg,f.wall[$]=J===zt.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let $=0;$<T.length;++$){const N=T[$];bn(N.id)&&Et(N.x)&&Et(N.y)&&A.add(dr(N,St))}for(let $=0;$<T.length;++$){const N=T[$];if(gt(N.tickertext)&&Et(N.tickertime)&&N.tickertext.length){const O=St,E=Mk(N.tickertext,O,Vt-1),C=(E==null?void 0:E.measuredwidth)??1,P=N.x??0,F=N.y??0,ot=F<Vt*.5;k.x=P-Math.floor(C*.5),k.y=F+(ot?1:-1),k.x+C>St&&(k.x=St-C),k.x<0&&(k.x=0),Lk(N.tickertext,k,!0)}if(y(N.removed))continue;const z=N.id??"";if(bn(z)===!1&&Et(N.x)&&Et(N.y)&&A.has(dr(N,St))===!0)continue;const J=nn(N),M=xP(e,d,z,$);if(M.x=N.x??0,M.y=N.y??0,M.char=J.char,M.color=J.color,M.bg=J.bg,h.sprites.push(M),m){if(J.light>0){const O=zr(n,M),E=gn(Math.round(J.light),1,Vt),C=1/(E*.5);if(p.alphas[O]=0,E>1){const P=[];for(let F=1;F<=E;++F){if(F===2){const st=Gt(N,"lightdir");if(rr(st)){const W=ru(n,N,"",st,M);switch(mr(M,W.destpt)){case pt.EAST:P.push([45,315,1]);break;case pt.WEST:P.push([225,135,1]);break;case pt.NORTH:P.push([315,225,1]);break;case pt.SOUTH:P.push([135,45,1]);break}}}const ot=[];for(let st=M.y-F;st<=M.y+F;++st)ql(n,p.alphas,P,ot,M,E,C,M.x-F,st),ql(n,p.alphas,P,ot,M,E,C,M.x+F,st);const tt=F-1;for(let st=M.x-tt;st<=M.x+tt;++st)ql(n,p.alphas,P,ot,M,E,C,st,M.y-F),ql(n,p.alphas,P,ot,M,E,C,st,M.y+F);for(let st=0;st<ot.length;++st){const W=ot[st];let D=0;for(D=0;D<P.length;++D){const yt=P[D];if(yt[1]>yt[0]&&W[1]>=yt[0]&&W[0]<=yt[1]&&W[2]>=1&&yt[2]>=1){P[D]=[Math.min(W[0],yt[0]),Math.max(W[1],yt[1]),1];break}}D===P.length&&P.push(W)}}}}else if(bn(z)){const O=zr(n,M);p.alphas[O]=0}}z===e&&(v.focusx=M.x,v.focusy=M.y,v.focusid=z)}o.push(Xl(e,a++,"text/mood",m?"dark":"bright"));const L=ce($t.MAIN),S=Ni(L,$t.MAIN);if(gt(S.palette)){const $=en(L,bt.PALETTE,S.palette),N=Se($);y(N==null?void 0:N.bits)&&o.push(Xl(e,a++,"image/palette",Array.from(N.bits)))}if(gt(S.charset)){const $=en(L,bt.CHARSET,S.charset),N=Se($);y(N==null?void 0:N.bits)&&o.push(Xl(e,a++,"image/charset",Array.from(N.bits)))}const I=Object.keys(n.objects).filter(bn);return o.push(Xl(e,a++,"text/players",I.join(","))),o}const ar=EP();var $t=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))($t||{});const ke={halt:!1,session:De(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function SP(){return ke.session}function cr(){return ke.operator}function RP(e){ke.operator=e}function OP(e){ke.halt=e}function NP(){return ke.halt}function Pr(){return[...ke.books.values()]}function IP(){const[e]=ke.books.values();return e}function $r(e){const t=It(e);return ke.books.get(e)??Pr().find(n=>n.name===t)}function Aw(e,t){y($r(t))&&(ke.software[e]=t)}function ce(e){return $r(ke.software[e])}function Sw(e){const t=Qf([]);return gt(e)&&(t.name=e),Jl(t),xe(nt,ke.operator,`created [book] ${t.name}`),t}function CP(e){let t=$r(e);return y(t)||(t=Qf([]),t.name=e),Jl(t),xe(nt,ke.operator,`created [book] ${t.name}`),t}function un(e,t){let n=y(t)?CP(t):ce(e);return y(n)||(y(n)||(n=IP()),y(n)||(n=Sw(t)),y(n)&&xe(nt,ke.operator,`opened [book] ${n.name} for ${e}`)),Aw(e,n.id),n}function ts(e,t,n){return ed(un(e),n,t)}function Dr(e,t){const n=ce("main"),r=Sn(yk(n,e,t));if(y(r))return r;const i=Pr();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=Sn(yk(o,e,t));if(y(a))return a}}}function lr(e){if(y(e==null?void 0:e.kinddata))return e.kinddata;if(!gt(e==null?void 0:e.kind)||!e.kind)return;const t=Dr(bt.OBJECT,e.kind);if(y(t))return e.kinddata=Se(t),e.kinddata;const n=Dr(bt.TERRAIN,e.kind);if(y(n))return e.kinddata=Se(n),e.kinddata}function Gt(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(y(i))return i;const s=n==null?void 0:n[t];if(y(s))return s;const o=Dr(bt.OBJECT,r)??Dr(bt.TERRAIN,r),a=Zf(o,t);if(y(a))return a;switch(t){case"group":return"";case"cycle":return f0;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return zt.ISWALK;default:return}}function Nd(e,t){const n={x:(e==null?void 0:e.x)??-1,y:(e==null?void 0:e.y)??-1},r={x:(t==null?void 0:t.x)??-1,y:(t==null?void 0:t.y)??-1},i=mr(n,r),s=Gt(t,"pushable");return Et(s)?s!==0:gt(s)?s.trim().split(" ").map(o=>Em(Tc(o))).some(o=>o===i):!1}function jr(e,t,n,r){if(!y(e)||!y(t))return;const[i,s]=t,o=Dr(bt.OBJECT,i);if(y(o)){const c=Ud(e,n,i,r);if(y(c))return oa(c,s),yU(e,c),lr(c),xk(e,c),c}const a=Dr(bt.TERRAIN,i);if(y(a)){const c=t$(e,n,i);if(y(c)){oa(c,s);const l=dr(n,St);return lr(c),xk(e,c,l),c}}}function LP(e,t,n){if(!y(e)||!y(t))return;const[r,i]=t,s=Dr(bt.OBJECT,r);if(y(s)){const o=Ud(e,n,r);return oa(o,i),o}}function hn(e){const t=Dr(bt.BOARD,e);return Se(t)}function vr(e){const t=un("main");return Ni(t,e)}function Rw(e){const t=un("main");return gU(t,e)}function Ow(){const e=un("main");return Ni(e,"main")}function MP(e){const t=un("main");return wk(t,e)}function UP(e,t){ke.books.clear(),e.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=$r(t);if(y(n)&&(ke.software.main=n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function Jl(e){return ke.books.set(e.id,e),e.id}function FP(e){const t=$r(e);t&&ke.books.delete(t.id)}function Nw(e){if(!gt(e)||!e)return de(nt,e,"login",`failed for playerid ==>${e}<==`);const t=ce("main");if(!y(t))return de(nt,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=fn(e),r=Dr(bt.BOARD,"title");if(!y(n)&&!y(r))return de(nt,e,"login:title","login failed to find board with 'title' stat");const i=Dr(bt.OBJECT,"player");if(!y(i))return de(nt,e,"login:player","login failed to find object type 'player'");const s=Se(r);if(y(s)){const o=Zf(r,"startx"),a=Zf(r,"starty"),c=Et(o)?o:Math.round(St*.5),l=Et(a)?a:Math.round(Vt*.5),u=Ud(s,{x:c,y:l},"player",e);if(y(u==null?void 0:u.id))return u.player=e,Ml(t,e,s.id),!0}return!1}function BP(e){const t=ce("main"),n=Na(t,e);if(!y(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Ml(t,s,""),rd(n,Un(n,s)),Dw(n,s),ar.halt(s),wk(t,s)}}function fn(e){const t=ce("main");return Na(t,e)}function PP(e){const t=ce("main"),n=TU(t,e),r=Na(t,e),i=Un(r,e);return n&&y(i)}function $P(e){const t=ce("main"),n=ko(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;bn(c)&&y(e[c])===!1&&(e[c]=0,Ml(t,c,i.id))}}}function Iw(e){ar.message(e)}function Mn(e,t,n,r){const i=nn(t);gt(n.id)&&nt.emit(e,"vm:touched",[n.id,i.name,r])}function DP(e,t,n,r){const i=n.id??"";if(r.x<0){const s=hn((t==null?void 0:t.exitwest)??"");y(s)&&bo(e,i,s.id,{x:St-1,y:r.y})}else if(r.x>=St){const s=hn((t==null?void 0:t.exiteast)??"");y(s)&&bo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=hn((t==null?void 0:t.exitnorth)??"");y(s)&&bo(e,i,s.id,{x:r.x,y:Vt-1})}else if(r.y>=Vt){const s=hn((t==null?void 0:t.exitsouth)??"");y(s)&&bo(e,i,s.id,{x:r.x,y:0})}}function es(e,t,n,r){if(!y(n==null?void 0:n.id))return!1;const i=sd(t,n,r);if(y(i)){const s=bn(n.id),o=bn(n.party??n.id),a=Gt(n,"collision")===zt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=bn(i.id),u=bn(i.party??i.id),f=Gt(i,"collision")===zt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?DP(e,t,n,r):s?l?(Mn("",i,n,"bump"),Mn("",n,i,"bump")):f?(Mn("",i,n,d?"partyshot":"shot"),Mn(c,n,i,"touch")):(Mn("",i,n,"thud"),Mn(c,n,i,"touch")):a?f?(Mn("",i,n,"thud"),Mn("",n,i,"thud")):(Mn("",i,n,l?"touch":"thud"),Mn(d?"":c,n,i,d?"partyshot":"shot")):l?Mn(h,i,n,"touch"):f?(Mn(d?"":h,i,n,d?"partyshot":"shot"),Mn("",n,i,d?"thud":"touch")):(Mn("",i,n,"thud"),Mn("",n,i,"bump")),a&&Gt(i,"breakable")){if(y(i==null?void 0:i.id)){const m=re(t,{x:i.x??-1,y:i.y??-1});y(m)&&Tn(w.board,m,w.timestamp)}else Oe(t,{x:r.x,y:r.y});return!0}return!1}return!0}function Cw(e,t,n,r){var l;if(!y(e)||!y(t)||!y(n))return;const i={...w};w.book=e,w.board=t,w.element=n,w.elementid=n.id??"",w.elementisplayer=bn(w.elementid);const s=w.element.player??ke.operator;w.elementfocus=w.elementisplayer?w.elementid:s;const o=Gt(n,"cycle"),a=n.id??"",c=It(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(ar.tick(a,Zi.RUNTIME,o,c,r),Et(n==null?void 0:n.tickertime)&&w.timestamp-n.tickertime>Ya*5&&(n.tickertime=0,n.tickertext=""),w.elementisplayer){const u=vr(w.elementid);Et(u.inputcurrent)&&(u.inputcurrent=0)}Zn(i).forEach(u=>{w[u]=i[u]})}function jP(e,t){ke.loaders.set(e,t)}function zP(e){ar.halt(e)}function WP(){const e=ar.ids();for(let n=0;n<e.length;++n)ar.halt(e[n]);const t=ce("main");y(t)&&(t.flags={})}function GP(e=!1){const t=ce("main");if(!y(t))return;const n=t.timestamp+1,r=ki.HALT_AT_COUNT;ki.HALT_AT_COUNT=r*2,ke.loaders.forEach((s,o)=>{const a={...w};w.timestamp=t.timestamp,w.book=t,w.board=void 0,w.element=void 0,w.elementid=o,w.elementisplayer=!1,w.elementfocus=cr();const c=JF(o);y(c)&&ar.arg(o,c),ar.tick(o,Zi.LOADER,1,"loader",s),ar.isended(o)&&(ar.halt(o),ke.loaders.delete(o)),Zn(a).forEach(l=>{w[l]=a[l]})}),ki.HALT_AT_COUNT=r,t.timestamp=n,w.timestamp=n;const i=ko(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)lr(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];lr(o.objects[u])}const c=EU(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?ar.halt(u):(!e||bn((h==null?void 0:h.id)??""))&&Cw(t,o,h,d)}}}function Oo(e,t,n,r){const i=ce("main");if(!y(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(y(c.id)){const l=`${xw(c.id)}:${t}`;nt.emit("",l,n)}}}if(gs(e)){for(let o=0;o<r.length;++o){const a=r[o],c=re(a,e);y(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(It(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(Fw(a,[e]));break}}}}function KP(e){const t=vr(e),n=t.playbuffer=gt(t.playbuffer)?t.playbuffer:"";n&&Lw(e,n,!1)}function Lw(e,t,n=!0){var o;const r=un("main");if(!y(r))return;const i=`${e}_cli`;w.timestamp=r.timestamp,w.book=r,w.board=Na(r,e),w.element=Un(w.board,e),w.elementid=((o=w.element)==null?void 0:o.id)??"",w.elementisplayer=!0,w.elementfocus=w.elementid||e;const s=ki.HALT_AT_COUNT;if(ki.HALT_AT_COUNT=s*8,ar.once(i,Zi.CLI,"cli",t),n){const a=vr(e);a.playbuffer=t}ki.HALT_AT_COUNT=s}function Zl(e){var a;const t=un("main"),n=Ss(t,e);if(!y(t)||!y(n)||!y(w.element))return;const r={...w},i=`${e}_run`,s=It(w.element.name??((a=w.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ar.once(i,Zi.RUNTIME,s,o),Zn(r).forEach(c=>{w[c]=r[c]})}function HP(e,t){const n=ce("main"),r=Na(n,e),i=[],s=[],o=[];if(!y(n)||!y(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=hn(r.overboard??""),l=hn(r.underboard??"");return s.push(...Od(e,0,l,t,!1,!0)),o.push(...Od(e,s.length,r,t,!0,a!=="flat")),i.push(...Od(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function Ms(e){return ue(e)&&typeof e[0]=="string"}function YP(e){const t=w.words[e];return gt(t)?[t,e+1]:[void 0,e]}function Id(e){const t=w.words[e];if(Ms(t))return[t,e+1];const[n,r]=Rc(e),[i,s]=YP(r);return gt(i)&&(i==="empty"||lr({kind:i}))?[[i,n],s]:[void 0,e]}function Pa(e){if(!Ms(e))return;const[t]=e;return t}function Ql(e){if(!Ms(e))return;const[,t]=e,n=y(t)?Ac(t):void 0;return y(n)?n:void 0}function Mw(e){if(!Ms(e))return;const[,t]=e,n=y(t)?Sc(t):void 0;return y(n)?Sh(n):void 0}function $a(e,t){const n=e??zt.ISWALK,r=t??zt.ISWALK;switch(n){case zt.ISWALK:return r!==zt.ISWALK;case zt.ISSWIM:return r!==zt.ISSWIM;case zt.ISSOLID:return!0;case zt.ISBULLET:return r!==zt.ISWALK&&r!==zt.ISSWIM}}function No(e,t,n){const r=e==null?void 0:e.objects[n];if(y(r))return r;const i=Da(e,"player");return y(t)?(t.x<0&&(t.x=pr(0,St-1)),t.y<0&&(t.y=pr(0,Vt-1)),Bw(t,i)):Sn(...i)}function Da(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(y)}function VP(e){const t=[];for(let n=0;n<Vt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=re(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Cd(e,t,n,r){if(!y(e))return!1;const i=nn(e);return!(y(t)&&t!==i.name||y(n)&&n!==i.color||y(r)&&r!==i.bg)}function tu(e,t){const n=Pa(t),r=Ql(t),i=Mw(t);return Da(e,n??"").filter(s=>Cd(s,n,r,i))}function Uw(e,t){const n=y(t)?Ac(t):void 0,r=y(t)?Sc(t):void 0,i=[];if(y(e)){for(let o=0;o<e.terrain.length;++o){const a=e.terrain[o];y(a)&&Cd(a,void 0,n,r)&&i.push(a)}const s=Object.values(e.objects);for(let o=0;o<s.length;++o){const a=s[o];Cd(a,void 0,n,r)&&i.push(a)}}return i}function Fw(e,t){return y(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(y(i))return i;const s=Da(e,It(n));if(s.length)return s}else if(gs(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Vt){const i=n.x+n.y*St,s=(r=e.lookup)==null?void 0:r[i];return y(s)?e.objects[s]:e.terrain[i]}}).flat().filter(y):[]}function Bw(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}function XP(e,t,n,r){if(!y(e))return;y(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!y(s)){s=new Array(Nh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(y(c)&&nu(c)){const l=dr(c,St);if(s[l]===-2){const u=ns(e,c.x,c.y);$a(t,Gt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function Pw(e,t){return nu(e)?t[dr(e,St)]:-1}function $w(e,t,n,r,i){if(!y(e))return;const s=XP(e,t,n,r);if(!y(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Pw(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Pw(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function qP(){return new Array(St*Vt).map(()=>{})}function eu(e=bu){const t={terrain:qP(),objects:{},id:""};return e(t)}var Ld=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(Ld||{});function JP(e){return co(e,Ld,{terrain:t=>t.map(Pc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Pc),id:Ae,named:Ae,lookup:Ae,codepage:Ae,distmaps:Ae,overboard:Ae,underboard:Ae})}function ZP(e){return sa(e,Ld,{terrain:t=>t.map($c),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=$c(t[r]);y(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function nu(e){return kh(e.x,e.y,0,St-1,Vt-1,0)}function zr(e,t){return!y(e)||!y(t==null?void 0:t.x)||!y(t==null?void 0:t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt?-1:t.x+t.y*St}function re(e,t){const n=zr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Un(e,e.lookup[n]??"");return y(r)?r:e.terrain[n]}function QP(e,t){const n=Un(e,t);if(y(n))return n;const r=parseFloat(t),i=MA(isNaN(r)?-1:r,St);return ns(e,i.x,i.y)}function ns(e,t,n){return(t>=0&&t<St)??(n>=0&&n<Vt)?e==null?void 0:e.terrain[t+n*St]:void 0}function Oe(e,t){if(!y(e)||!y(t)||!y(t.x)||!y(t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt)return;const n=Ar(t),r=t.x+t.y*St;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Md(e,t){if(!y(e)||!y(t))return;const n=Ar(t);return n.id=n.id??De(),e.objects[n.id]=n,e.objects[n.id]}function t$(e,t,n){return Oe(e,{...t,kind:n})}function Ud(e,t,n,r){return Md(e,{...t,kind:n,id:r})}function Un(e,t){if(e)return e.objects[t]}function e$(e,t){const n=zr(e,t);if(n<0||!y(e==null?void 0:e.lookup))return;const r=Un(e,e.lookup[n]??"");if(y(r))return r}function Tn(e,t,n){return!y(t)||nn(t).name==="player"?!1:(t.id?(t.removed=n,rd(e,t)):(Oe(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),bU(e,t)),!0)}function Dw(e,t){return y(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function n$(e,t,n){if(!y(e)||!y(t))return;const r=e.objects[n];if(y(r))return r;if(gs(t))return Bw(t,Da(e,"player"))}function ru(e,t,n,r,i){const s=pt.MID;if(!y(e)||!y(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:o.x+(t.stepx??0),y:o.y+(t.stepy??0)},c=mr(o,a),l=St-1,u=Vt-1;for(let f=0;f<r.length;++f){const d=Em(r[f]);switch(d){case pt.IDLE:break;case pt.NORTH:case pt.SOUTH:case pt.WEST:case pt.EAST:ze(o,d);break;case pt.BY:{const[h,m]=r.slice(f+1);Et(h)&&Et(m)&&(o.x=gn(o.x+h,0,l),o.y=gn(o.y+m,0,u)),f+=2;break}case pt.TO:case pt.AT:{const[h,m]=r.slice(f+1);Et(h)&&Et(m)&&(o.x=gn(h,0,l),o.y=gn(m,0,u)),f+=2;break}case pt.FLOW:ze(o,c);break;case pt.SEEK:{const h=n$(e,t,n);gs(h)&&ze(o,mr(i,h));break}case pt.RNDNS:ze(o,Sn(pt.NORTH,pt.SOUTH));break;case pt.RNDNE:ze(o,Sn(pt.NORTH,pt.EAST));break;case pt.RND:ze(o,Sn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));break;case pt.CW:case pt.CCW:case pt.OPP:case pt.RNDP:{const h=ru(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case pt.CW:switch(mr(i,h.destpt)){case pt.NORTH:ze(o,pt.EAST);break;case pt.SOUTH:ze(o,pt.WEST);break;case pt.EAST:ze(o,pt.SOUTH);break;case pt.WEST:ze(o,pt.NORTH);break}break;case pt.CCW:switch(mr(i,h.destpt)){case pt.NORTH:ze(o,pt.WEST);break;case pt.SOUTH:ze(o,pt.EAST);break;case pt.EAST:ze(o,pt.NORTH);break;case pt.WEST:ze(o,pt.SOUTH);break}break;case pt.OPP:debugger;switch(mr(i,h.destpt)){case pt.NORTH:ze(o,pt.SOUTH);break;case pt.SOUTH:ze(o,pt.NORTH);break;case pt.EAST:ze(o,pt.WEST);break;case pt.WEST:ze(o,pt.EAST);break}break;case pt.RNDP:switch(mr(i,h.destpt)){case pt.NORTH:case pt.SOUTH:o.x+=Sn(-1,1);break;case pt.WEST:case pt.EAST:o.y+=Sn(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s}}case pt.FLEE:case pt.AWAY:{const[h,m]=r.slice(f+1);if(Et(h)&&Et(m)){const p={x:gn(h,0,l),y:gn(m,0,u)},b=Gt(t,"collision"),k=$w(e,b,o,p,!0);y(k)&&(o.x=k.x,o.y=k.y)}f+=2;break}case pt.FIND:case pt.TOWARD:{const[h,m]=r.slice(f+1);if(Et(h)&&Et(m)){const p={x:gn(h,0,l),y:gn(m,0,u)};if(pr(1,100)<5)ze(o,Sn(pt.NORTH,pt.SOUTH,pt.WEST,pt.EAST));else{const b=Gt(t,"collision"),k=$w(e,b,o,p,!1);if(y(k))if(k.x!==h&&k.y!==m&&e$(e,k))switch(mr(i,k)){case pt.EAST:case pt.WEST:o.y+=Sn(-1,1);break;case pt.NORTH:case pt.SOUTH:o.x+=Sn(-1,1);break}else o.x=k.x,o.y=k.y}}f+=2;break}case pt.PLAYER:{const h=No(e,i,n);gs(h)&&(o.x=h.x,o.y=h.y);break}case pt.OVER:case pt.UNDER:{const h=ru(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const w={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var K=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.COLOR_OR_KIND=7]="COLOR_OR_KIND",e[e.MAYBE_KIND=8]="MAYBE_KIND",e[e.MAYBE_NAME=9]="MAYBE_NAME",e[e.MAYBE_NUMBER=10]="MAYBE_NUMBER",e[e.MAYBE_STRING=11]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",e[e.ANY=13]="ANY",e))(K||{});function dn(e,t,n){throw console.info(n,w.element,w.elementid,w.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function jw(e){var n,r;const t={x:((n=w.element)==null?void 0:n.x)??0,y:((r=w.element)==null?void 0:r.y)??0};return ru(w.board,w.element,w.elementfocus,e,t)}function it(e,t,n){const r=w.words;w.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=Id(s);Ms(a)?(s=c,i.push(a)):dn("kind",a,e);break}case 0:{if(Qo(e[s])===void 0){const[a,c]=Cn(s);En(a)?(s=c,i.push(a)):dn("color",a,e)}else{const[a,c]=Rc(s);En(a)?(s=c,i.push(a)):dn("color",a,e)}break}case 2:{if(Tc(e[s])===void 0){const[a,c]=Cn(s);rr(a)?(s=c,i.push(jw(a))):dn("direction",a,e)}else{const[a,c]=vm(s);rr(a)?(s=c,i.push(jw(a))):dn("direction",a,e)}break}case 3:{const a=w.words[s];gt(a)||dn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Cn(s);if(gt(a)){const l=parseFloat(a);Et(l)?i.push(l):dn("number",a,e)}else Et(a)?i.push(a):dn("number",a,e);s=c;break}case 5:{const[a,c]=Cn(s);gt(a)||dn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Cn(s);let l=a;if(gt(l)){const u=parseFloat(l);Et(u)&&(l=u)}else Et(l)||dn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=Id(s);if(Ms(a))s=c,i.push(a);else if(Qo(e[s])===void 0){const[l,u]=Cn(s);En(l)?(s=u,i.push(l)):dn("color",l,e)}else{const[l,u]=Rc(s);En(l)?(s=u,i.push(l)):dn("color or kind",l,e)}break}case 8:{const[a,c]=Id(s);a!==void 0&&!Ms(a)&&dn("optional kind",a,e),s=c,i.push(a);break}case 9:{const a=w.words[s];a!==void 0&&!gt(a)&&dn("optional string",a,e),++s,i.push(a);break}case 10:{const[a,c]=Cn(s);if(gt(a)){const l=parseFloat(a);Et(l)?i.push(l):dn("optional number",a,e)}else Et(a)||a===void 0?i.push(a):dn("optional number",a,e);s=c;break}case 11:{const[a,c]=Cn(s);a!==void 0&&!gt(a)&&dn("optional string",a,e),s=c,i.push(a);break}case 12:{const[a,c]=Cn(s);let l=a;if(gt(l)){const u=parseFloat(l);Et(u)&&(l=u)}else l!==void 0&&!Et(l)&&dn("number or string",l,e);s=c,i.push(l);break}case 13:{const[a,c]=Cn(s);s=c,i.push(a);break}}return w.words=r,[...i,s]}const iu={},Io={};function Fd(){return{id:De(),layers:[],scroll:[],sidebar:[]}}const r$=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),i$=new Set(["tx","text"]),s$={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},zw={};let Ww=e=>{let t=zw[e];return y(t)||(zw[e]=t=Fd()),t};function o$(e){Ww=e}function Ye(e){return Ww(e)}function Bd(e){return y(iu[e])||(iu[e]=[]),iu[e]}function a$(e){const t=Ye(e);t.scrollname="",t.scroll=[]}function c$(e,t,n){Object.values(Io).forEach(r=>{if(r[t]!==void 0){const i=Im(e.id(),t);Et(n)&&IA(i,n),gt(n)&&CA(i,n)}})}function An(e){const t=Bd(e);return iu[e]=[],t}function Gw(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n];gt(r)&&y(MU(r))?t.push(" ",r," "):t.push(r)}return t}function Rt(e,t){Bd(e).push(t)}function Ct(e,t,n,r,i=()=>0,s=bu){const o=[t,n,...r],a=It(`${o[3]}`),c={...w};function l(u,f){y(f)&&f!==i(u)&&(w.board=c.board,w.element=c.element,w.elementfocus=c.elementfocus,s(u,f))}if(r$.has(a)){const u=`${o[2]}`;Io[t]=Io[t]??{};const f=i(u)??s$[a];if(Io[t][u]===void 0){const d=Im(t,u);Et(f)&&NA(d,f),gt(f)&&bh(d,f),i$.has(a)?Io[t][u]=sm(d,h=>{l(u,h)}):Io[t][u]=LA(d,h=>{l(u,h)})}}Bd(e).push(o)}o$(e=>{if(bn(e)){const t=ce($t.MAIN),n=Ni(t,$t.GADGETSTORE);let r=n[e];return y(r)||(n[e]=r=Fd()),r}return Fd()});let Kw=0;function l$(){switch(Kw++){case 0:return Lt.BLUE;case 1:return Lt.BLACK;case 2:return Lt.GREEN;case 3:return Lt.BLACK;case 4:return Lt.CYAN;case 5:return Lt.BLACK;case 6:return Lt.RED;case 7:return Lt.BLACK;case 8:return Lt.PURPLE;case 9:return Lt.BLACK;case 10:return Lt.YELLOW;case 11:return Lt.BLACK;case 12:return Lt.WHITE;default:return Kw=0,Lt.BLACK}}const su=Ps("gadgetserver",["tock","second"],e=>{if(!su.session(e))return;const t=ce($t.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ni(t,$t.GADGETSYNC);switch(e.target){case"tock":{const i=l$();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=HP(o,i),u=Ye(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=r0(f,u);d.length&&(r[o]=Ar(u),ix(su,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=fn(s);y(o)&&yx(su,s,o.id)}break;case"desync":rx(su,e.player,Ye(e.player));break;case"clearscroll":a$(e.player);break;case"clearplayer":{const i=Ni(t,$t.GADGETSTORE);delete i[e.player];const s=Ni(t,$t.GADGETSYNC);delete s[e.player];break}}});function ou(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hw={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof ou=="function"&&ou;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof ou=="function"&&ou,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,b=[],k=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";k<c.length;)T=v-k,f=A?(l=c[k++],u=k<v?c[k++]:0,k<v?c[k++]:0):(l=c.charCodeAt(k++),u=k<v?c.charCodeAt(k++):0,k<v?c.charCodeAt(k++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return b.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,b=0,k="data:";if(c.substr(0,k.length)===k)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[b++]=l,h!==64&&(v[b++]=u),m!==64&&(v[b++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,m,p,b,k,v){var T,A,L=h.file,S=h.compression,I=v!==l.utf8encode,$=a.transformTo("string",v(L.name)),N=a.transformTo("string",l.utf8encode(L.name)),z=L.comment,J=a.transformTo("string",v(z)),M=a.transformTo("string",l.utf8encode(z)),O=N.length!==L.name.length,E=M.length!==z.length,C="",P="",F="",ot=L.dir,tt=L.date,st={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(st.crc32=h.crc32,st.compressedSize=h.compressedSize,st.uncompressedSize=h.uncompressedSize);var W=0;m&&(W|=8),I||!O&&!E||(W|=2048);var D=0,yt=0;ot&&(D|=16),k==="UNIX"?(yt=798,D|=function(at,Bt){var Wt=at;return at||(Wt=Bt?16893:33204),(65535&Wt)<<16}(L.unixPermissions,ot)):(yt=20,D|=function(at){return 63&(at||0)}(L.dosPermissions)),T=tt.getUTCHours(),T<<=6,T|=tt.getUTCMinutes(),T<<=5,T|=tt.getUTCSeconds()/2,A=tt.getUTCFullYear()-1980,A<<=4,A|=tt.getUTCMonth()+1,A<<=5,A|=tt.getUTCDate(),O&&(P=s(1,1)+s(u($),4)+N,C+="up"+s(P.length,2)+P),E&&(F=s(1,1)+s(u(J),4)+M,C+="uc"+s(F.length,2)+F);var X="";return X+=`
\0`,X+=s(W,2),X+=S.magic,X+=s(T,2),X+=s(A,2),X+=s(st.crc32,4),X+=s(st.compressedSize,4),X+=s(st.uncompressedSize,4),X+=s($.length,2),X+=s(C.length,2),{fileRecord:f.LOCAL_FILE_HEADER+X+$+C,dirRecord:f.CENTRAL_FILE_HEADER+s(yt,2)+X+s(J.length,2)+"\0\0\0\0"+s(D,4)+s(b,4)+$+C+J}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,b=function(k,v,T,A,L){var S=a.transformTo("string",L(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(k,2)+s(k,2)+s(v,4)+s(T,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,T){var A=v||T,L=s[A];if(!L)throw new Error(A+" is not a valid compression method !");return L}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,k=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:b,date:k,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var b=new c(h);return b.load(p),b}).then(function(p){var b=[o.Promise.resolve(p)],k=p.files;if(h.checkCRC32)for(var v=0;v<k.length;v++)b.push(f(k[v]));return o.Promise.all(b)}).then(function(p){for(var b=p.shift(),k=b.files,v=0;v<k.length;v++){var T=k[v],A=T.fileNameStr,L=s.resolve(T.fileNameStr);m.file(L,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(L).unsafeOriginalName=A)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof pn<"u",newBufferFrom:function(s,o){if(pn.from&&pn.from!==Uint8Array.from)return pn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new pn(s,o)},allocBuffer:function(s){if(pn.alloc)return pn.alloc(s);var o=new pn(s);return o.fill(0),o},isBuffer:function(s){return pn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(L,S,I){var $,N=a.getTypeOf(S),z=a.extend(I||{},u);z.date=z.date||new Date,z.compression!==null&&(z.compression=z.compression.toUpperCase()),typeof z.unixPermissions=="string"&&(z.unixPermissions=parseInt(z.unixPermissions,8)),z.unixPermissions&&16384&z.unixPermissions&&(z.dir=!0),z.dosPermissions&&16&z.dosPermissions&&(z.dir=!0),z.dir&&(L=k(L)),z.createFolders&&($=b(L))&&v.call(this,$,!0);var J=N==="string"&&z.binary===!1&&z.base64===!1;I&&I.binary!==void 0||(z.binary=!J),(S instanceof f&&S.uncompressedSize===0||z.dir||!S||S.length===0)&&(z.base64=!1,z.binary=!0,S="",z.compression="STORE",N="string");var M=null;M=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(L,S):a.prepareContent(L,S,z.binary,z.optimizedBinaryString,z.base64);var O=new d(L,M,z);this.files[L]=O}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),b=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var S=L.lastIndexOf("/");return 0<S?L.substring(0,S):""},k=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},v=function(L,S){return S=S!==void 0?S:u.createFolders,L=k(L),this.files[L]||s.call(this,L,null,{dir:!0,createFolders:S}),this.files[L]};function T(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var S,I,$;for(S in this.files)$=this.files[S],(I=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&L(I,$)},filter:function(L){var S=[];return this.forEach(function(I,$){L(I,$)&&S.push($)}),S},file:function(L,S,I){if(arguments.length!==1)return L=this.root+L,s.call(this,L,S,I),this;if(T(L)){var $=L;return this.filter(function(z,J){return!J.dir&&$.test(z)})}var N=this.files[this.root+L];return N&&!N.dir?N:null},folder:function(L){if(!L)return this;if(T(L))return this.filter(function(N,z){return z.dir&&L.test(N)});var S=this.root+L,I=v.call(this,S),$=this.clone();return $.root=I.name,$},remove:function(L){L=this.root+L;var S=this.files[L];if(S||(L.slice(-1)!=="/"&&(L+="/"),S=this.files[L]),S&&!S.dir)delete this.files[L];else for(var I=this.filter(function(N,z){return z.name.slice(0,L.length)===L}),$=0;$<I.length;$++)delete this.files[I[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var S,I={};try{if((I=a.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var $=I.comment||this.comment||"";S=h.generateWorker(this,I,$)}catch(N){(S=new c("error")).error(N)}return new l(S,I.type||"string",I.mimeType)},generateAsync:function(L,S){return this.generateInternalStream(L).accumulate(S)},generateNodeStream:function(L,S){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(S)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(b,k){var v=[],T=m._internalType,A=m._outputType,L=m._mimeType;m.on("data",function(S,I){v.push(S),p&&p(I)}).on("error",function(S){v=[],k(S)}).on("end",function(){try{var S=function(I,$,N){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),N);case"base64":return c.encode($);default:return s.transformTo(I,$)}}(A,function(I,$){var N,z=0,J=null,M=0;for(N=0;N<$.length;N++)M+=$[N].length;switch(I){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(J=new Uint8Array(M),N=0;N<$.length;N++)J.set($[N],z),z+=$[N].length;return J;case"nodebuffer":return pn.concat($);default:throw new Error("concat : unsupported type '"+I+"'")}}(T,v),L);b(S)}catch(I){k(I)}v=[]}).resume()})}function h(m,p,b){var k=p;switch(p){case"blob":case"arraybuffer":k="uint8array";break;case"base64":k="string"}try{this._internalType=k,this._outputType=p,this._mimeType=b,s.checkSupport(k),this._worker=m.pipe(new o(k)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(k){p.call(b,k.data,k.meta)}):this._worker.on(m,function(){s.delay(p,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof pn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,b,k,v,T,A=m.length,L=0;for(v=0;v<A;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(k=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(k-56320),v++),L+=b<128?1:b<2048?2:b<65536?3:4;for(p=o.uint8array?new Uint8Array(L):new Array(L),v=T=0;T<L;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(k=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(k-56320),v++),b<128?p[T++]=b:(b<2048?p[T++]=192|b>>>6:(b<65536?p[T++]=224|b>>>12:(p[T++]=240|b>>>18,p[T++]=128|b>>>12&63),p[T++]=128|b>>>6&63),p[T++]=128|63&b);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,b,k,v,T=m.length,A=new Array(2*T);for(p=b=0;p<T;)if((k=m[p++])<128)A[b++]=k;else if(4<(v=l[k]))A[b++]=65533,p+=v-1;else{for(k&=v===2?31:v===3?15:7;1<v&&p<T;)k=k<<6|63&m[p++],v--;1<v?A[b++]=65533:k<65536?A[b++]=k:(k-=65536,A[b++]=55296|k>>10&1023,A[b++]=56320|1023&k)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(m),k=m;b!==m.length&&(o.uint8array?(k=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(k=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:i.utf8decode(k),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,b){for(var k=0;k<p.length;++k)b[k]=255&p.charCodeAt(k);return b}n("setimmediate"),i.newBlob=function(p,b){i.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var k=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return k.append(p),k.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,b,k){var v=[],T=0,A=p.length;if(A<=k)return String.fromCharCode.apply(null,p);for(;T<A;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+k,A)))):v.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+k,A)))),T+=k;return v.join("")},stringifyByChar:function(p){for(var b="",k=0;k<p.length;k++)b+=String.fromCharCode(p[k]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var b=65536,k=i.getTypeOf(p),v=!0;if(k==="uint8array"?v=f.applyCanBeUsed.uint8array:k==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return f.stringifyByChunk(p,k,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(p)}function h(p,b){for(var k=0;k<p.length;k++)b[k]=p[k];return b}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,b){if(b=b||"",!p)return b;i.checkSupport(p);var k=i.getTypeOf(b);return m[k][p](b)},i.resolve=function(p){for(var b=p.split("/"),k=[],v=0;v<b.length;v++){var T=b[v];T==="."||T===""&&v!==0&&v!==b.length-1||(T===".."?k.pop():k.push(T))}return k.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var b,k,v="";for(k=0;k<(p||"").length;k++)v+="\\x"+((b=p.charCodeAt(k))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(p,b,k){setImmediate(function(){p.apply(k||null,b||[])})},i.inherits=function(p,b){function k(){}k.prototype=b.prototype,p.prototype=new k},i.extend=function(){var p,b,k={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&k[b]===void 0&&(k[b]=arguments[p][b]);return k},i.prepareContent=function(p,b,k,v,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(L,S){var I=new FileReader;I.onload=function($){L($.target.result)},I.onerror=function($){S($.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var L=i.getTypeOf(A);return L?(L==="arraybuffer"?A=i.transformTo("uint8array",A):L==="string"&&(T?A=o.decode(A):k&&v!==!0&&(A=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var k in u)if(Object.prototype.hasOwnProperty.call(u,k)&&u[k].magic===b)return u[k];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,b,k=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<k;)m=h.readInt(2),p=h.readInt(2),b=h.readData(p),this.extraFields[m]={id:m,length:p,value:b};h.setIndex(k)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var k=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(k)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var k=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!k&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&k&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,b;a=!0;for(var k=h.length;k;){for(b=h,h=[],p=-1;++p<k;)b[p]();k=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,k!==o&&p(this,k)}function d(k,v,T){this.promise=k,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(k,v,T){s(function(){var A;try{A=v(T)}catch(L){return a.reject(k,L)}A===k?a.reject(k,new TypeError("Cannot resolve promise with itself")):a.resolve(k,A)})}function m(k){var v=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof v=="function")return function(){v.apply(k,arguments)}}function p(k,v){var T=!1;function A(I){T||(T=!0,a.reject(k,I))}function L(I){T||(T=!0,a.resolve(k,I))}var S=b(function(){v(L,A)});S.status==="error"&&A(S.value)}function b(k,v){var T={};try{T.value=k(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(k){if(typeof k!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(k()).then(function(){return T})},function(T){return v.resolve(k()).then(function(){throw T})})},f.prototype.catch=function(k){return this.then(null,k)},f.prototype.then=function(k,v){if(typeof k!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?k:v,this.outcome):this.queue.push(new d(T,k,v)),T},d.prototype.callFulfilled=function(k){a.resolve(this.promise,k)},d.prototype.otherCallFulfilled=function(k){h(this.promise,this.onFulfilled,k)},d.prototype.callRejected=function(k){a.reject(this.promise,k)},d.prototype.otherCallRejected=function(k){h(this.promise,this.onRejected,k)},a.resolve=function(k,v){var T=b(m,v);if(T.status==="error")return a.reject(k,T.value);var A=T.value;if(A)p(k,A);else{k.state=l,k.outcome=v;for(var L=-1,S=k.queue.length;++L<S;)k.queue[L].callFulfilled(v)}return k},a.reject=function(k,v){k.state=c,k.outcome=v;for(var T=-1,A=k.queue.length;++T<A;)k.queue[T].callRejected(v);return k},f.resolve=function(k){return k instanceof this?k:a.resolve(new this(o),k)},f.reject=function(k){var v=new this(o);return a.reject(v,k)},f.all=function(k){var v=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=k.length,A=!1;if(!T)return this.resolve([]);for(var L=new Array(T),S=0,I=-1,$=new this(o);++I<T;)N(k[I],I);return $;function N(z,J){v.resolve(z).then(function(M){L[J]=M,++S!==T||A||(A=!0,a.resolve($,L))},function(M){A||(A=!0,a.reject($,M))})}},f.race=function(k){var v=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=k.length,A=!1;if(!T)return this.resolve([]);for(var L=-1,S=new this(o);++L<T;)I=k[L],v.resolve(I).then(function($){A||(A=!0,a.resolve(S,$))},function($){A||(A=!0,a.reject(S,$))});var I;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(k){if(!(this instanceof p))return new p(k);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},k||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(k,v){var T=new p(v);if(T.push(k,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(k,v){var T,A,L=this.strm,S=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof k=="string"?L.input=a.string2buf(k):u.call(k)==="[object ArrayBuffer]"?L.input=new Uint8Array(k):L.input=k,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new o.Buf8(S),L.next_out=0,L.avail_out=S),(T=s.deflate(L,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(L.output,L.next_out))):this.onData(o.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(L.avail_out=0))},p.prototype.onData=function(k){this.chunks.push(k)},p.prototype.onEnd=function(k){k===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg},i.Deflate=p,i.deflate=b,i.deflateRaw=function(k,v){return(v=v||{}).raw=!0,b(k,v)},i.gzip=function(k,v){return(v=v||{}).gzip=!0,b(k,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var k=s.inflateInit2(this.strm,b.windowBits);if(k!==c.Z_OK)throw new Error(l[k]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,b){var k=new h(b);if(k.push(p,!0),k.err)throw k.msg||l[k.err];return k.result}h.prototype.push=function(p,b){var k,v,T,A,L,S,I=this.strm,$=this.options.chunkSize,N=this.options.dictionary,z=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?I.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?I.input=new Uint8Array(p):I.input=p,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8($),I.next_out=0,I.avail_out=$),(k=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,k=s.inflateSetDictionary(this.strm,S)),k===c.Z_BUF_ERROR&&z===!0&&(k=c.Z_OK,z=!1),k!==c.Z_STREAM_END&&k!==c.Z_OK)return this.onEnd(k),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&k!==c.Z_STREAM_END&&(I.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(I.output,I.next_out),A=I.next_out-T,L=a.buf2string(I.output,T),I.next_out=A,I.avail_out=$-A,A&&o.arraySet(I.output,I.output,T,A,0),this.onData(L)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(z=!0)}while((0<I.avail_in||I.avail_out===0)&&k!==c.Z_STREAM_END);return k===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(k=s.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,b,k=f.length,v=0;for(p=0;p<k;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<k&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=b=0;b<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<k&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,b,k=d||f.length,v=new Array(2*k);for(h=m=0;h<k;)if((p=f[h++])<128)v[m++]=p;else if(4<(b=c[p]))v[m++]=65533,h+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&h<k;)p=p<<6|63&f[h++],b--;1<b?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,b=4,k=2,v=8,T=9,A=286,L=30,S=19,I=2*A+1,$=15,N=3,z=258,J=z+N+1,M=42,O=113,E=1,C=2,P=3,F=4;function ot(x,lt){return x.msg=u[lt],lt}function tt(x){return(x<<1)-(4<x?9:0)}function st(x){for(var lt=x.length;0<=--lt;)x[lt]=0}function W(x){var lt=x.state,rt=lt.pending;rt>x.avail_out&&(rt=x.avail_out),rt!==0&&(o.arraySet(x.output,lt.pending_buf,lt.pending_out,rt,x.next_out),x.next_out+=rt,lt.pending_out+=rt,x.total_out+=rt,x.avail_out-=rt,lt.pending-=rt,lt.pending===0&&(lt.pending_out=0))}function D(x,lt){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,lt),x.block_start=x.strstart,W(x.strm)}function yt(x,lt){x.pending_buf[x.pending++]=lt}function X(x,lt){x.pending_buf[x.pending++]=lt>>>8&255,x.pending_buf[x.pending++]=255&lt}function at(x,lt){var rt,j,B=x.max_chain_length,V=x.strstart,ht=x.prev_length,dt=x.nice_match,Q=x.strstart>x.w_size-J?x.strstart-(x.w_size-J):0,_t=x.window,vt=x.w_mask,mt=x.prev,Nt=x.strstart+z,fe=_t[V+ht-1],jt=_t[V+ht];x.prev_length>=x.good_match&&(B>>=2),dt>x.lookahead&&(dt=x.lookahead);do if(_t[(rt=lt)+ht]===jt&&_t[rt+ht-1]===fe&&_t[rt]===_t[V]&&_t[++rt]===_t[V+1]){V+=2,rt++;do;while(_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&_t[++V]===_t[++rt]&&V<Nt);if(j=z-(Nt-V),V=Nt-z,ht<j){if(x.match_start=lt,dt<=(ht=j))break;fe=_t[V+ht-1],jt=_t[V+ht]}}while((lt=mt[lt&vt])>Q&&--B!=0);return ht<=x.lookahead?ht:x.lookahead}function Bt(x){var lt,rt,j,B,V,ht,dt,Q,_t,vt,mt=x.w_size;do{if(B=x.window_size-x.lookahead-x.strstart,x.strstart>=mt+(mt-J)){for(o.arraySet(x.window,x.window,mt,mt,0),x.match_start-=mt,x.strstart-=mt,x.block_start-=mt,lt=rt=x.hash_size;j=x.head[--lt],x.head[lt]=mt<=j?j-mt:0,--rt;);for(lt=rt=mt;j=x.prev[--lt],x.prev[lt]=mt<=j?j-mt:0,--rt;);B+=mt}if(x.strm.avail_in===0)break;if(ht=x.strm,dt=x.window,Q=x.strstart+x.lookahead,_t=B,vt=void 0,vt=ht.avail_in,_t<vt&&(vt=_t),rt=vt===0?0:(ht.avail_in-=vt,o.arraySet(dt,ht.input,ht.next_in,vt,Q),ht.state.wrap===1?ht.adler=c(ht.adler,dt,vt,Q):ht.state.wrap===2&&(ht.adler=l(ht.adler,dt,vt,Q)),ht.next_in+=vt,ht.total_in+=vt,vt),x.lookahead+=rt,x.lookahead+x.insert>=N)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+N-1])&x.hash_mask,x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<J&&x.strm.avail_in!==0)}function Wt(x,lt){for(var rt,j;;){if(x.lookahead<J){if(Bt(x),x.lookahead<J&&lt===f)return E;if(x.lookahead===0)break}if(rt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),rt!==0&&x.strstart-rt<=x.w_size-J&&(x.match_length=at(x,rt)),x.match_length>=N)if(j=a._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else j=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(j&&(D(x,!1),x.strm.avail_out===0))return E}return x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?E:C}function Dt(x,lt){for(var rt,j,B;;){if(x.lookahead<J){if(Bt(x),x.lookahead<J&&lt===f)return E;if(x.lookahead===0)break}if(rt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,rt!==0&&x.prev_length<x.max_lazy_match&&x.strstart-rt<=x.w_size-J&&(x.match_length=at(x,rt),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(B=x.strstart+x.lookahead-N,j=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=B&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,rt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,j&&(D(x,!1),x.strm.avail_out===0))return E}else if(x.match_available){if((j=a._tr_tally(x,0,x.window[x.strstart-1]))&&D(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return E}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(j=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):x.last_lit&&(D(x,!1),x.strm.avail_out===0)?E:C}function Pt(x,lt,rt,j,B){this.good_length=x,this.max_lazy=lt,this.nice_length=rt,this.max_chain=j,this.func=B}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*L+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function qt(x){var lt;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=k,(lt=x.state).pending=0,lt.pending_out=0,lt.wrap<0&&(lt.wrap=-lt.wrap),lt.status=lt.wrap?M:O,x.adler=lt.wrap===2?0:1,lt.last_flush=f,a._tr_init(lt),h):ot(x,m)}function Ne(x){var lt=qt(x);return lt===h&&function(rt){rt.window_size=2*rt.w_size,st(rt.head),rt.max_lazy_match=s[rt.level].max_lazy,rt.good_match=s[rt.level].good_length,rt.nice_match=s[rt.level].nice_length,rt.max_chain_length=s[rt.level].max_chain,rt.strstart=0,rt.block_start=0,rt.lookahead=0,rt.insert=0,rt.match_length=rt.prev_length=N-1,rt.match_available=0,rt.ins_h=0}(x.state),lt}function $e(x,lt,rt,j,B,V){if(!x)return m;var ht=1;if(lt===p&&(lt=6),j<0?(ht=0,j=-j):15<j&&(ht=2,j-=16),B<1||T<B||rt!==v||j<8||15<j||lt<0||9<lt||V<0||b<V)return ot(x,m);j===8&&(j=9);var dt=new le;return(x.state=dt).strm=x,dt.wrap=ht,dt.gzhead=null,dt.w_bits=j,dt.w_size=1<<dt.w_bits,dt.w_mask=dt.w_size-1,dt.hash_bits=B+7,dt.hash_size=1<<dt.hash_bits,dt.hash_mask=dt.hash_size-1,dt.hash_shift=~~((dt.hash_bits+N-1)/N),dt.window=new o.Buf8(2*dt.w_size),dt.head=new o.Buf16(dt.hash_size),dt.prev=new o.Buf16(dt.w_size),dt.lit_bufsize=1<<B+6,dt.pending_buf_size=4*dt.lit_bufsize,dt.pending_buf=new o.Buf8(dt.pending_buf_size),dt.d_buf=1*dt.lit_bufsize,dt.l_buf=3*dt.lit_bufsize,dt.level=lt,dt.strategy=V,dt.method=rt,Ne(x)}s=[new Pt(0,0,0,0,function(x,lt){var rt=65535;for(rt>x.pending_buf_size-5&&(rt=x.pending_buf_size-5);;){if(x.lookahead<=1){if(Bt(x),x.lookahead===0&&lt===f)return E;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var j=x.block_start+rt;if((x.strstart===0||x.strstart>=j)&&(x.lookahead=x.strstart-j,x.strstart=j,D(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-J&&(D(x,!1),x.strm.avail_out===0))return E}return x.insert=0,lt===d?(D(x,!0),x.strm.avail_out===0?P:F):(x.strstart>x.block_start&&(D(x,!1),x.strm.avail_out),E)}),new Pt(4,4,8,4,Wt),new Pt(4,5,16,8,Wt),new Pt(4,6,32,32,Wt),new Pt(4,4,16,16,Dt),new Pt(8,16,32,32,Dt),new Pt(8,16,128,128,Dt),new Pt(8,32,128,256,Dt),new Pt(32,128,258,1024,Dt),new Pt(32,258,258,4096,Dt)],i.deflateInit=function(x,lt){return $e(x,lt,v,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ne,i.deflateResetKeep=qt,i.deflateSetHeader=function(x,lt){return x&&x.state?x.state.wrap!==2?m:(x.state.gzhead=lt,h):m},i.deflate=function(x,lt){var rt,j,B,V;if(!x||!x.state||5<lt||lt<0)return x?ot(x,m):m;if(j=x.state,!x.output||!x.input&&x.avail_in!==0||j.status===666&&lt!==d)return ot(x,x.avail_out===0?-5:m);if(j.strm=x,rt=j.last_flush,j.last_flush=lt,j.status===M)if(j.wrap===2)x.adler=0,yt(j,31),yt(j,139),yt(j,8),j.gzhead?(yt(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),yt(j,255&j.gzhead.time),yt(j,j.gzhead.time>>8&255),yt(j,j.gzhead.time>>16&255),yt(j,j.gzhead.time>>24&255),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(yt(j,255&j.gzhead.extra.length),yt(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(x.adler=l(x.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,0),yt(j,j.level===9?2:2<=j.strategy||j.level<2?4:0),yt(j,3),j.status=O);else{var ht=v+(j.w_bits-8<<4)<<8;ht|=(2<=j.strategy||j.level<2?0:j.level<6?1:j.level===6?2:3)<<6,j.strstart!==0&&(ht|=32),ht+=31-ht%31,j.status=O,X(j,ht),j.strstart!==0&&(X(j,x.adler>>>16),X(j,65535&x.adler)),x.adler=1}if(j.status===69)if(j.gzhead.extra){for(B=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending!==j.pending_buf_size));)yt(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(j.status===73)if(j.gzhead.name){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.gzindex=0,j.status=91)}else j.status=91;if(j.status===91)if(j.gzhead.comment){B=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),W(x),B=j.pending,j.pending===j.pending_buf_size)){V=1;break}V=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,yt(j,V)}while(V!==0);j.gzhead.hcrc&&j.pending>B&&(x.adler=l(x.adler,j.pending_buf,j.pending-B,B)),V===0&&(j.status=103)}else j.status=103;if(j.status===103&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&W(x),j.pending+2<=j.pending_buf_size&&(yt(j,255&x.adler),yt(j,x.adler>>8&255),x.adler=0,j.status=O)):j.status=O),j.pending!==0){if(W(x),x.avail_out===0)return j.last_flush=-1,h}else if(x.avail_in===0&&tt(lt)<=tt(rt)&&lt!==d)return ot(x,-5);if(j.status===666&&x.avail_in!==0)return ot(x,-5);if(x.avail_in!==0||j.lookahead!==0||lt!==f&&j.status!==666){var dt=j.strategy===2?function(Q,_t){for(var vt;;){if(Q.lookahead===0&&(Bt(Q),Q.lookahead===0)){if(_t===f)return E;break}if(Q.match_length=0,vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++,vt&&(D(Q,!1),Q.strm.avail_out===0))return E}return Q.insert=0,_t===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?E:C}(j,lt):j.strategy===3?function(Q,_t){for(var vt,mt,Nt,fe,jt=Q.window;;){if(Q.lookahead<=z){if(Bt(Q),Q.lookahead<=z&&_t===f)return E;if(Q.lookahead===0)break}if(Q.match_length=0,Q.lookahead>=N&&0<Q.strstart&&(mt=jt[Nt=Q.strstart-1])===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]){fe=Q.strstart+z;do;while(mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&mt===jt[++Nt]&&Nt<fe);Q.match_length=z-(fe-Nt),Q.match_length>Q.lookahead&&(Q.match_length=Q.lookahead)}if(Q.match_length>=N?(vt=a._tr_tally(Q,1,Q.match_length-N),Q.lookahead-=Q.match_length,Q.strstart+=Q.match_length,Q.match_length=0):(vt=a._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++),vt&&(D(Q,!1),Q.strm.avail_out===0))return E}return Q.insert=0,_t===d?(D(Q,!0),Q.strm.avail_out===0?P:F):Q.last_lit&&(D(Q,!1),Q.strm.avail_out===0)?E:C}(j,lt):s[j.level].func(j,lt);if(dt!==P&&dt!==F||(j.status=666),dt===E||dt===P)return x.avail_out===0&&(j.last_flush=-1),h;if(dt===C&&(lt===1?a._tr_align(j):lt!==5&&(a._tr_stored_block(j,0,0,!1),lt===3&&(st(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),W(x),x.avail_out===0))return j.last_flush=-1,h}return lt!==d?h:j.wrap<=0?1:(j.wrap===2?(yt(j,255&x.adler),yt(j,x.adler>>8&255),yt(j,x.adler>>16&255),yt(j,x.adler>>24&255),yt(j,255&x.total_in),yt(j,x.total_in>>8&255),yt(j,x.total_in>>16&255),yt(j,x.total_in>>24&255)):(X(j,x.adler>>>16),X(j,65535&x.adler)),W(x),0<j.wrap&&(j.wrap=-j.wrap),j.pending!==0?h:1)},i.deflateEnd=function(x){var lt;return x&&x.state?(lt=x.state.status)!==M&&lt!==69&&lt!==73&&lt!==91&&lt!==103&&lt!==O&&lt!==666?ot(x,m):(x.state=null,lt===O?ot(x,-3):h):m},i.deflateSetDictionary=function(x,lt){var rt,j,B,V,ht,dt,Q,_t,vt=lt.length;if(!x||!x.state||(V=(rt=x.state).wrap)===2||V===1&&rt.status!==M||rt.lookahead)return m;for(V===1&&(x.adler=c(x.adler,lt,vt,0)),rt.wrap=0,vt>=rt.w_size&&(V===0&&(st(rt.head),rt.strstart=0,rt.block_start=0,rt.insert=0),_t=new o.Buf8(rt.w_size),o.arraySet(_t,lt,vt-rt.w_size,rt.w_size,0),lt=_t,vt=rt.w_size),ht=x.avail_in,dt=x.next_in,Q=x.input,x.avail_in=vt,x.next_in=0,x.input=lt,Bt(rt);rt.lookahead>=N;){for(j=rt.strstart,B=rt.lookahead-(N-1);rt.ins_h=(rt.ins_h<<rt.hash_shift^rt.window[j+N-1])&rt.hash_mask,rt.prev[j&rt.w_mask]=rt.head[rt.ins_h],rt.head[rt.ins_h]=j,j++,--B;);rt.strstart=j,rt.lookahead=N-1,Bt(rt)}return rt.strstart+=rt.lookahead,rt.block_start=rt.strstart,rt.insert=rt.lookahead,rt.lookahead=0,rt.match_length=rt.prev_length=N-1,rt.match_available=0,x.next_in=dt,x.input=Q,x.avail_in=ht,rt.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,b,k,v,T,A,L,S,I,$,N,z,J,M,O,E,C;a=s.state,c=s.next_in,E=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,b=a.wnext,k=a.window,v=a.hold,T=a.bits,A=a.lencode,L=a.distcode,S=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;t:do{T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),$=A[v&S];e:for(;;){if(v>>>=N=$>>>24,T-=N,(N=$>>>16&255)===0)C[u++]=65535&$;else{if(!(16&N)){if(!(64&N)){$=A[(65535&$)+(v&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}z=65535&$,(N&=15)&&(T<N&&(v+=E[c++]<<T,T+=8),z+=v&(1<<N)-1,v>>>=N,T-=N),T<15&&(v+=E[c++]<<T,T+=8,v+=E[c++]<<T,T+=8),$=L[v&I];n:for(;;){if(v>>>=N=$>>>24,T-=N,!(16&(N=$>>>16&255))){if(!(64&N)){$=L[(65535&$)+(v&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(J=65535&$,T<(N&=15)&&(v+=E[c++]<<T,(T+=8)<N&&(v+=E[c++]<<T,T+=8)),h<(J+=v&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=N,T-=N,(N=u-f)<J){if(p<(N=J-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=k,(M=0)===b){if(M+=m-N,N<z){for(z-=N;C[u++]=k[M++],--N;);M=u-J,O=C}}else if(b<N){if(M+=m+b-N,(N-=b)<z){for(z-=N;C[u++]=k[M++],--N;);if(M=0,b<z){for(z-=N=b;C[u++]=k[M++],--N;);M=u-J,O=C}}}else if(M+=b-N,N<z){for(z-=N;C[u++]=k[M++],--N;);M=u-J,O=C}for(;2<z;)C[u++]=O[M++],C[u++]=O[M++],C[u++]=O[M++],z-=3;z&&(C[u++]=O[M++],1<z&&(C[u++]=O[M++]))}else{for(M=u-J;C[u++]=C[M++],C[u++]=C[M++],C[u++]=C[M++],2<(z-=3););z&&(C[u++]=C[M++],1<z&&(C[u++]=C[M++]))}break}}break}}while(c<l&&u<d);c-=z=T>>3,v&=(1<<(T-=z<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,b=592;function k(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(M){var O;return M&&M.state?(O=M.state,M.total_in=M.total_out=O.total=0,M.msg="",O.wrap&&(M.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(b),O.sane=1,O.back=-1,d):h}function A(M){var O;return M&&M.state?((O=M.state).wsize=0,O.whave=0,O.wnext=0,T(M)):h}function L(M,O){var E,C;return M&&M.state?(C=M.state,O<0?(E=0,O=-O):(E=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(C.window!==null&&C.wbits!==O&&(C.window=null),C.wrap=E,C.wbits=O,A(M))):h}function S(M,O){var E,C;return M?(C=new v,(M.state=C).window=null,(E=L(M,O))!==d&&(M.state=null),E):h}var I,$,N=!0;function z(M){if(N){var O;for(I=new s.Buf32(512),$=new s.Buf32(32),O=0;O<144;)M.lens[O++]=8;for(;O<256;)M.lens[O++]=9;for(;O<280;)M.lens[O++]=7;for(;O<288;)M.lens[O++]=8;for(l(u,M.lens,0,288,I,0,M.work,{bits:9}),O=0;O<32;)M.lens[O++]=5;l(f,M.lens,0,32,$,0,M.work,{bits:5}),N=!1}M.lencode=I,M.lenbits=9,M.distcode=$,M.distbits=5}function J(M,O,E,C){var P,F=M.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new s.Buf8(F.wsize)),C>=F.wsize?(s.arraySet(F.window,O,E-F.wsize,F.wsize,0),F.wnext=0,F.whave=F.wsize):(C<(P=F.wsize-F.wnext)&&(P=C),s.arraySet(F.window,O,E-C,P,F.wnext),(C-=P)?(s.arraySet(F.window,O,E-C,C,0),F.wnext=C,F.whave=F.wsize):(F.wnext+=P,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=P))),0}i.inflateReset=A,i.inflateReset2=L,i.inflateResetKeep=T,i.inflateInit=function(M){return S(M,15)},i.inflateInit2=S,i.inflate=function(M,O){var E,C,P,F,ot,tt,st,W,D,yt,X,at,Bt,Wt,Dt,Pt,le,qt,Ne,$e,x,lt,rt,j,B=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return h;(E=M.state).mode===12&&(E.mode=13),ot=M.next_out,P=M.output,st=M.avail_out,F=M.next_in,C=M.input,tt=M.avail_in,W=E.hold,D=E.bits,yt=tt,X=st,lt=d;t:for(;;)switch(E.mode){case m:if(E.wrap===0){E.mode=13;break}for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(2&E.wrap&&W===35615){V[E.check=0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0),D=W=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&W)<<8)+(W>>8))%31){M.msg="incorrect header check",E.mode=30;break}if((15&W)!=8){M.msg="unknown compression method",E.mode=30;break}if(D-=4,x=8+(15&(W>>>=4)),E.wbits===0)E.wbits=x;else if(x>E.wbits){M.msg="invalid window size",E.mode=30;break}E.dmax=1<<x,M.adler=E.check=1,E.mode=512&W?10:12,D=W=0;break;case 2:for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(E.flags=W,(255&E.flags)!=8){M.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){M.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=W>>8&1),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0,E.mode=3;case 3:for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.head&&(E.head.time=W),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,V[2]=W>>>16&255,V[3]=W>>>24&255,E.check=a(E.check,V,4,0)),D=W=0,E.mode=4;case 4:for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.head&&(E.head.xflags=255&W,E.head.os=W>>8),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0,E.mode=5;case 5:if(1024&E.flags){for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.length=W,E.head&&(E.head.extra_len=W),512&E.flags&&(V[0]=255&W,V[1]=W>>>8&255,E.check=a(E.check,V,2,0)),D=W=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(tt<(at=E.length)&&(at=tt),at&&(E.head&&(x=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),s.arraySet(E.head.extra,C,F,at,x)),512&E.flags&&(E.check=a(E.check,C,at,F)),tt-=at,F+=at,E.length-=at),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(tt===0)break t;for(at=0;x=C[F+at++],E.head&&x&&E.length<65536&&(E.head.name+=String.fromCharCode(x)),x&&at<tt;);if(512&E.flags&&(E.check=a(E.check,C,at,F)),tt-=at,F+=at,x)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(tt===0)break t;for(at=0;x=C[F+at++],E.head&&x&&E.length<65536&&(E.head.comment+=String.fromCharCode(x)),x&&at<tt;);if(512&E.flags&&(E.check=a(E.check,C,at,F)),tt-=at,F+=at,x)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;D<16;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W!==(65535&E.check)){M.msg="header crc mismatch",E.mode=30;break}D=W=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),M.adler=E.check=0,E.mode=12;break;case 10:for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}M.adler=E.check=k(W),D=W=0,E.mode=11;case 11:if(E.havedict===0)return M.next_out=ot,M.avail_out=st,M.next_in=F,M.avail_in=tt,E.hold=W,E.bits=D,2;M.adler=E.check=1,E.mode=12;case 12:if(O===5||O===6)break t;case 13:if(E.last){W>>>=7&D,D-=7&D,E.mode=27;break}for(;D<3;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}switch(E.last=1&W,D-=1,3&(W>>>=1)){case 0:E.mode=14;break;case 1:if(z(E),E.mode=20,O!==6)break;W>>>=2,D-=2;break t;case 2:E.mode=17;break;case 3:M.msg="invalid block type",E.mode=30}W>>>=2,D-=2;break;case 14:for(W>>>=7&D,D-=7&D;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if((65535&W)!=(W>>>16^65535)){M.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&W,D=W=0,E.mode=15,O===6)break t;case 15:E.mode=16;case 16:if(at=E.length){if(tt<at&&(at=tt),st<at&&(at=st),at===0)break t;s.arraySet(P,C,F,at,ot),tt-=at,F+=at,st-=at,ot+=at,E.length-=at;break}E.mode=12;break;case 17:for(;D<14;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(E.nlen=257+(31&W),W>>>=5,D-=5,E.ndist=1+(31&W),W>>>=5,D-=5,E.ncode=4+(15&W),W>>>=4,D-=4,286<E.nlen||30<E.ndist){M.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;D<3;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.lens[ht[E.have++]]=7&W,W>>>=3,D-=3}for(;E.have<19;)E.lens[ht[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,rt={bits:E.lenbits},lt=l(0,E.lens,0,19,E.lencode,0,E.work,rt),E.lenbits=rt.bits,lt){M.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Pt=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,le=65535&B,!((Dt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(le<16)W>>>=Dt,D-=Dt,E.lens[E.have++]=le;else{if(le===16){for(j=Dt+2;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W>>>=Dt,D-=Dt,E.have===0){M.msg="invalid bit length repeat",E.mode=30;break}x=E.lens[E.have-1],at=3+(3&W),W>>>=2,D-=2}else if(le===17){for(j=Dt+3;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}D-=Dt,x=0,at=3+(7&(W>>>=Dt)),W>>>=3,D-=3}else{for(j=Dt+7;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}D-=Dt,x=0,at=11+(127&(W>>>=Dt)),W>>>=7,D-=7}if(E.have+at>E.nlen+E.ndist){M.msg="invalid bit length repeat",E.mode=30;break}for(;at--;)E.lens[E.have++]=x}}if(E.mode===30)break;if(E.lens[256]===0){M.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,rt={bits:E.lenbits},lt=l(u,E.lens,0,E.nlen,E.lencode,0,E.work,rt),E.lenbits=rt.bits,lt){M.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,rt={bits:E.distbits},lt=l(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,rt),E.distbits=rt.bits,lt){M.msg="invalid distances set",E.mode=30;break}if(E.mode=20,O===6)break t;case 20:E.mode=21;case 21:if(6<=tt&&258<=st){M.next_out=ot,M.avail_out=st,M.next_in=F,M.avail_in=tt,E.hold=W,E.bits=D,c(M,X),ot=M.next_out,P=M.output,st=M.avail_out,F=M.next_in,C=M.input,tt=M.avail_in,W=E.hold,D=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Pt=(B=E.lencode[W&(1<<E.lenbits)-1])>>>16&255,le=65535&B,!((Dt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(Pt&&!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(B=E.lencode[$e+((W&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&B,!(qt+(Dt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}W>>>=qt,D-=qt,E.back+=qt}if(W>>>=Dt,D-=Dt,E.back+=Dt,E.length=le,Pt===0){E.mode=26;break}if(32&Pt){E.back=-1,E.mode=12;break}if(64&Pt){M.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Pt,E.mode=22;case 22:if(E.extra){for(j=E.extra;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.length+=W&(1<<E.extra)-1,W>>>=E.extra,D-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Pt=(B=E.distcode[W&(1<<E.distbits)-1])>>>16&255,le=65535&B,!((Dt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(B=E.distcode[$e+((W&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&B,!(qt+(Dt=B>>>24)<=D);){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}W>>>=qt,D-=qt,E.back+=qt}if(W>>>=Dt,D-=Dt,E.back+=Dt,64&Pt){M.msg="invalid distance code",E.mode=30;break}E.offset=le,E.extra=15&Pt,E.mode=24;case 24:if(E.extra){for(j=E.extra;D<j;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}E.offset+=W&(1<<E.extra)-1,W>>>=E.extra,D-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){M.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(st===0)break t;if(at=X-st,E.offset>at){if((at=E.offset-at)>E.whave&&E.sane){M.msg="invalid distance too far back",E.mode=30;break}Bt=at>E.wnext?(at-=E.wnext,E.wsize-at):E.wnext-at,at>E.length&&(at=E.length),Wt=E.window}else Wt=P,Bt=ot-E.offset,at=E.length;for(st<at&&(at=st),st-=at,E.length-=at;P[ot++]=Wt[Bt++],--at;);E.length===0&&(E.mode=21);break;case 26:if(st===0)break t;P[ot++]=E.length,st--,E.mode=21;break;case 27:if(E.wrap){for(;D<32;){if(tt===0)break t;tt--,W|=C[F++]<<D,D+=8}if(X-=st,M.total_out+=X,E.total+=X,X&&(M.adler=E.check=E.flags?a(E.check,P,X,ot-X):o(E.check,P,X,ot-X)),X=st,(E.flags?W:k(W))!==E.check){M.msg="incorrect data check",E.mode=30;break}D=W=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;D<32;){if(tt===0)break t;tt--,W+=C[F++]<<D,D+=8}if(W!==(4294967295&E.total)){M.msg="incorrect length check",E.mode=30;break}D=W=0}E.mode=29;case 29:lt=1;break t;case 30:lt=-3;break t;case 31:return-4;case 32:default:return h}return M.next_out=ot,M.avail_out=st,M.next_in=F,M.avail_in=tt,E.hold=W,E.bits=D,(E.wsize||X!==M.avail_out&&E.mode<30&&(E.mode<27||O!==4))&&J(M,M.output,M.next_out,X-M.avail_out)?(E.mode=31,-4):(yt-=M.avail_in,X-=M.avail_out,M.total_in+=yt,M.total_out+=X,E.total+=X,E.wrap&&X&&(M.adler=E.check=E.flags?a(E.check,P,X,M.next_out-X):o(E.check,P,X,M.next_out-X)),M.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(yt==0&&X===0||O===4)&&lt===d&&(lt=-5),lt)},i.inflateEnd=function(M){if(!M||!M.state)return h;var O=M.state;return O.window&&(O.window=null),M.state=null,d},i.inflateGetHeader=function(M,O){var E;return M&&M.state&&2&(E=M.state).wrap?((E.head=O).done=!1,d):h},i.inflateSetDictionary=function(M,O){var E,C=O.length;return M&&M.state?(E=M.state).wrap!==0&&E.mode!==11?h:E.mode===11&&o(1,O,C,0)!==E.check?-3:J(M,O,C,C)?(E.mode=31,-4):(E.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,b,k){var v,T,A,L,S,I,$,N,z,J=k.bits,M=0,O=0,E=0,C=0,P=0,F=0,ot=0,tt=0,st=0,W=0,D=null,yt=0,X=new s.Buf16(16),at=new s.Buf16(16),Bt=null,Wt=0;for(M=0;M<=15;M++)X[M]=0;for(O=0;O<h;O++)X[f[d+O]]++;for(P=J,C=15;1<=C&&X[C]===0;C--);if(C<P&&(P=C),C===0)return m[p++]=20971520,m[p++]=20971520,k.bits=1,0;for(E=1;E<C&&X[E]===0;E++);for(P<E&&(P=E),M=tt=1;M<=15;M++)if(tt<<=1,(tt-=X[M])<0)return-1;if(0<tt&&(u===0||C!==1))return-1;for(at[1]=0,M=1;M<15;M++)at[M+1]=at[M]+X[M];for(O=0;O<h;O++)f[d+O]!==0&&(b[at[f[d+O]]++]=O);if(I=u===0?(D=Bt=b,19):u===1?(D=o,yt-=257,Bt=a,Wt-=257,256):(D=c,Bt=l,-1),M=E,S=p,ot=O=W=0,A=-1,L=(st=1<<(F=P))-1,u===1&&852<st||u===2&&592<st)return 1;for(;;){for($=M-ot,z=b[O]<I?(N=0,b[O]):b[O]>I?(N=Bt[Wt+b[O]],D[yt+b[O]]):(N=96,0),v=1<<M-ot,E=T=1<<F;m[S+(W>>ot)+(T-=v)]=$<<24|N<<16|z|0,T!==0;);for(v=1<<M-1;W&v;)v>>=1;if(v!==0?(W&=v-1,W+=v):W=0,O++,--X[M]==0){if(M===C)break;M=f[d+b[O]]}if(P<M&&(W&L)!==A){for(ot===0&&(ot=P),S+=E,tt=1<<(F=M-ot);F+ot<C&&!((tt-=X[F+ot])<=0);)F++,tt<<=1;if(st+=1<<F,u===1&&852<st||u===2&&592<st)return 1;m[A=W&L]=P<<24|F<<16|S-p|0}}return W!==0&&(m[S+W]=M-ot<<24|64<<16|0),k.bits=P,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(B){for(var V=B.length;0<=--V;)B[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,b=15,k=16,v=7,T=256,A=16,L=17,S=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(d+2));c(J);var M=new Array(2*h);c(M);var O=new Array(512);c(O);var E=new Array(256);c(E);var C=new Array(u);c(C);var P,F,ot,tt=new Array(h);function st(B,V,ht,dt,Q){this.static_tree=B,this.extra_bits=V,this.extra_base=ht,this.elems=dt,this.max_length=Q,this.has_stree=B&&B.length}function W(B,V){this.dyn_tree=B,this.max_code=0,this.stat_desc=V}function D(B){return B<256?O[B]:O[256+(B>>>7)]}function yt(B,V){B.pending_buf[B.pending++]=255&V,B.pending_buf[B.pending++]=V>>>8&255}function X(B,V,ht){B.bi_valid>k-ht?(B.bi_buf|=V<<B.bi_valid&65535,yt(B,B.bi_buf),B.bi_buf=V>>k-B.bi_valid,B.bi_valid+=ht-k):(B.bi_buf|=V<<B.bi_valid&65535,B.bi_valid+=ht)}function at(B,V,ht){X(B,ht[2*V],ht[2*V+1])}function Bt(B,V){for(var ht=0;ht|=1&B,B>>>=1,ht<<=1,0<--V;);return ht>>>1}function Wt(B,V,ht){var dt,Q,_t=new Array(b+1),vt=0;for(dt=1;dt<=b;dt++)_t[dt]=vt=vt+ht[dt-1]<<1;for(Q=0;Q<=V;Q++){var mt=B[2*Q+1];mt!==0&&(B[2*Q]=Bt(_t[mt]++,mt))}}function Dt(B){var V;for(V=0;V<d;V++)B.dyn_ltree[2*V]=0;for(V=0;V<h;V++)B.dyn_dtree[2*V]=0;for(V=0;V<m;V++)B.bl_tree[2*V]=0;B.dyn_ltree[2*T]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0}function Pt(B){8<B.bi_valid?yt(B,B.bi_buf):0<B.bi_valid&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0}function le(B,V,ht,dt){var Q=2*V,_t=2*ht;return B[Q]<B[_t]||B[Q]===B[_t]&&dt[V]<=dt[ht]}function qt(B,V,ht){for(var dt=B.heap[ht],Q=ht<<1;Q<=B.heap_len&&(Q<B.heap_len&&le(V,B.heap[Q+1],B.heap[Q],B.depth)&&Q++,!le(V,dt,B.heap[Q],B.depth));)B.heap[ht]=B.heap[Q],ht=Q,Q<<=1;B.heap[ht]=dt}function Ne(B,V,ht){var dt,Q,_t,vt,mt=0;if(B.last_lit!==0)for(;dt=B.pending_buf[B.d_buf+2*mt]<<8|B.pending_buf[B.d_buf+2*mt+1],Q=B.pending_buf[B.l_buf+mt],mt++,dt===0?at(B,Q,V):(at(B,(_t=E[Q])+f+1,V),(vt=I[_t])!==0&&X(B,Q-=C[_t],vt),at(B,_t=D(--dt),ht),(vt=$[_t])!==0&&X(B,dt-=tt[_t],vt)),mt<B.last_lit;);at(B,T,V)}function $e(B,V){var ht,dt,Q,_t=V.dyn_tree,vt=V.stat_desc.static_tree,mt=V.stat_desc.has_stree,Nt=V.stat_desc.elems,fe=-1;for(B.heap_len=0,B.heap_max=p,ht=0;ht<Nt;ht++)_t[2*ht]!==0?(B.heap[++B.heap_len]=fe=ht,B.depth[ht]=0):_t[2*ht+1]=0;for(;B.heap_len<2;)_t[2*(Q=B.heap[++B.heap_len]=fe<2?++fe:0)]=1,B.depth[Q]=0,B.opt_len--,mt&&(B.static_len-=vt[2*Q+1]);for(V.max_code=fe,ht=B.heap_len>>1;1<=ht;ht--)qt(B,_t,ht);for(Q=Nt;ht=B.heap[1],B.heap[1]=B.heap[B.heap_len--],qt(B,_t,1),dt=B.heap[1],B.heap[--B.heap_max]=ht,B.heap[--B.heap_max]=dt,_t[2*Q]=_t[2*ht]+_t[2*dt],B.depth[Q]=(B.depth[ht]>=B.depth[dt]?B.depth[ht]:B.depth[dt])+1,_t[2*ht+1]=_t[2*dt+1]=Q,B.heap[1]=Q++,qt(B,_t,1),2<=B.heap_len;);B.heap[--B.heap_max]=B.heap[1],function(jt,qn){var R,g,_,U,G,et,ct=qn.dyn_tree,Ht=qn.max_code,Ie=qn.stat_desc.static_tree,we=qn.stat_desc.has_stree,Ce=qn.stat_desc.extra_bits,he=qn.stat_desc.extra_base,za=qn.stat_desc.max_length,lu=0;for(U=0;U<=b;U++)jt.bl_count[U]=0;for(ct[2*jt.heap[jt.heap_max]+1]=0,R=jt.heap_max+1;R<p;R++)za<(U=ct[2*ct[2*(g=jt.heap[R])+1]+1]+1)&&(U=za,lu++),ct[2*g+1]=U,Ht<g||(jt.bl_count[U]++,G=0,he<=g&&(G=Ce[g-he]),et=ct[2*g],jt.opt_len+=et*(U+G),we&&(jt.static_len+=et*(Ie[2*g+1]+G)));if(lu!==0){do{for(U=za-1;jt.bl_count[U]===0;)U--;jt.bl_count[U]--,jt.bl_count[U+1]+=2,jt.bl_count[za]--,lu-=2}while(0<lu);for(U=za;U!==0;U--)for(g=jt.bl_count[U];g!==0;)Ht<(_=jt.heap[--R])||(ct[2*_+1]!==U&&(jt.opt_len+=(U-ct[2*_+1])*ct[2*_],ct[2*_+1]=U),g--)}}(B,V),Wt(_t,fe,B.bl_count)}function x(B,V,ht){var dt,Q,_t=-1,vt=V[1],mt=0,Nt=7,fe=4;for(vt===0&&(Nt=138,fe=3),V[2*(ht+1)+1]=65535,dt=0;dt<=ht;dt++)Q=vt,vt=V[2*(dt+1)+1],++mt<Nt&&Q===vt||(mt<fe?B.bl_tree[2*Q]+=mt:Q!==0?(Q!==_t&&B.bl_tree[2*Q]++,B.bl_tree[2*A]++):mt<=10?B.bl_tree[2*L]++:B.bl_tree[2*S]++,_t=Q,fe=(mt=0)===vt?(Nt=138,3):Q===vt?(Nt=6,3):(Nt=7,4))}function lt(B,V,ht){var dt,Q,_t=-1,vt=V[1],mt=0,Nt=7,fe=4;for(vt===0&&(Nt=138,fe=3),dt=0;dt<=ht;dt++)if(Q=vt,vt=V[2*(dt+1)+1],!(++mt<Nt&&Q===vt)){if(mt<fe)for(;at(B,Q,B.bl_tree),--mt!=0;);else Q!==0?(Q!==_t&&(at(B,Q,B.bl_tree),mt--),at(B,A,B.bl_tree),X(B,mt-3,2)):mt<=10?(at(B,L,B.bl_tree),X(B,mt-3,3)):(at(B,S,B.bl_tree),X(B,mt-11,7));_t=Q,fe=(mt=0)===vt?(Nt=138,3):Q===vt?(Nt=6,3):(Nt=7,4)}}c(tt);var rt=!1;function j(B,V,ht,dt){X(B,(l<<1)+(dt?1:0),3),function(Q,_t,vt,mt){Pt(Q),yt(Q,vt),yt(Q,~vt),s.arraySet(Q.pending_buf,Q.window,_t,vt,Q.pending),Q.pending+=vt}(B,V,ht)}i._tr_init=function(B){rt||(function(){var V,ht,dt,Q,_t,vt=new Array(b+1);for(Q=dt=0;Q<u-1;Q++)for(C[Q]=dt,V=0;V<1<<I[Q];V++)E[dt++]=Q;for(E[dt-1]=Q,Q=_t=0;Q<16;Q++)for(tt[Q]=_t,V=0;V<1<<$[Q];V++)O[_t++]=Q;for(_t>>=7;Q<h;Q++)for(tt[Q]=_t<<7,V=0;V<1<<$[Q]-7;V++)O[256+_t++]=Q;for(ht=0;ht<=b;ht++)vt[ht]=0;for(V=0;V<=143;)J[2*V+1]=8,V++,vt[8]++;for(;V<=255;)J[2*V+1]=9,V++,vt[9]++;for(;V<=279;)J[2*V+1]=7,V++,vt[7]++;for(;V<=287;)J[2*V+1]=8,V++,vt[8]++;for(Wt(J,d+1,vt),V=0;V<h;V++)M[2*V+1]=5,M[2*V]=Bt(V,5);P=new st(J,I,f+1,d,b),F=new st(M,$,0,h,b),ot=new st(new Array(0),N,0,m,v)}(),rt=!0),B.l_desc=new W(B.dyn_ltree,P),B.d_desc=new W(B.dyn_dtree,F),B.bl_desc=new W(B.bl_tree,ot),B.bi_buf=0,B.bi_valid=0,Dt(B)},i._tr_stored_block=j,i._tr_flush_block=function(B,V,ht,dt){var Q,_t,vt=0;0<B.level?(B.strm.data_type===2&&(B.strm.data_type=function(mt){var Nt,fe=4093624447;for(Nt=0;Nt<=31;Nt++,fe>>>=1)if(1&fe&&mt.dyn_ltree[2*Nt]!==0)return o;if(mt.dyn_ltree[18]!==0||mt.dyn_ltree[20]!==0||mt.dyn_ltree[26]!==0)return a;for(Nt=32;Nt<f;Nt++)if(mt.dyn_ltree[2*Nt]!==0)return a;return o}(B)),$e(B,B.l_desc),$e(B,B.d_desc),vt=function(mt){var Nt;for(x(mt,mt.dyn_ltree,mt.l_desc.max_code),x(mt,mt.dyn_dtree,mt.d_desc.max_code),$e(mt,mt.bl_desc),Nt=m-1;3<=Nt&&mt.bl_tree[2*z[Nt]+1]===0;Nt--);return mt.opt_len+=3*(Nt+1)+5+5+4,Nt}(B),Q=B.opt_len+3+7>>>3,(_t=B.static_len+3+7>>>3)<=Q&&(Q=_t)):Q=_t=ht+5,ht+4<=Q&&V!==-1?j(B,V,ht,dt):B.strategy===4||_t===Q?(X(B,2+(dt?1:0),3),Ne(B,J,M)):(X(B,4+(dt?1:0),3),function(mt,Nt,fe,jt){var qn;for(X(mt,Nt-257,5),X(mt,fe-1,5),X(mt,jt-4,4),qn=0;qn<jt;qn++)X(mt,mt.bl_tree[2*z[qn]+1],3);lt(mt,mt.dyn_ltree,Nt-1),lt(mt,mt.dyn_dtree,fe-1)}(B,B.l_desc.max_code+1,B.d_desc.max_code+1,vt+1),Ne(B,B.dyn_ltree,B.dyn_dtree)),Dt(B),dt&&Pt(B)},i._tr_tally=function(B,V,ht){return B.pending_buf[B.d_buf+2*B.last_lit]=V>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&V,B.pending_buf[B.l_buf+B.last_lit]=255&ht,B.last_lit++,V===0?B.dyn_ltree[2*ht]++:(B.matches++,V--,B.dyn_ltree[2*(E[ht]+f+1)]++,B.dyn_dtree[2*D(V)]++),B.last_lit===B.lit_bufsize-1},i._tr_align=function(B){X(B,2,3),at(B,T,J),function(V){V.bi_valid===16?(yt(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(B)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Sr.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,L=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=L,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var L=p.createElement("script");L.onreadystatechange=function(){v(A),L.onreadystatechange=null,l.removeChild(L),L=null},l.appendChild(L)}):function(A){setTimeout(v,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var L=new Array(arguments.length-1),S=0;S<L.length;S++)L[S]=arguments[S+1];var I={callback:A,args:L};return h[d]=I,c(d),d++},b.clearImmediate=k}function k(A){delete h[A]}function v(A){if(m)setTimeout(v,0,A);else{var L=h[A];if(L){m=!0;try{(function(S){var I=S.callback,$=S.args;switch($.length){case 0:I();break;case 1:I($[0]);break;case 2:I($[0],$[1]);break;case 3:I($[0],$[1],$[2]);break;default:I.apply(a,$)}})(L)}finally{k(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hw);var u$=Hw.exports,Pd=Fs(u$);const Yw={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Yw);var Tr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Co,ja,Us;class h${constructor(...t){Co.set(this,new Map),ja.set(this,new Map),Us.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Tr(this,Us,"f").has(r)||Tr(this,Us,"f").set(r,new Set);const s=Tr(this,Us,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&Tr(this,ja,"f").set(r,a),o=!1,c)continue;const l=Tr(this,Co,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Tr(this,Co,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:Tr(this,Co,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&Tr(this,ja,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:Tr(this,Us,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of Tr(this,Us,"f").values())Object.freeze(t);return this}_getTestState(){return{types:Tr(this,Co,"f"),extensions:Tr(this,ja,"f")}}}Co=new WeakMap,ja=new WeakMap,Us=new WeakMap;var f$=new h$(Yw)._freeze();function d$(e,t){console.info(t)}function p$(e,t){console.info(t)}const au=60,m$=au*25;function g$(e,t){let n=0;const r=new DataView(t.buffer);function i(){const C=r.getUint8(n);return n++,C}function s(){const C=r.getInt16(n,!0);return n+=2,C}function o(){const C=r.getInt32(n,!0);return n+=4,C}function a(C){let P="";const F=t.subarray(n,n+C);for(let ot=0;ot<F.length;++ot)P+=String.fromCharCode(F[ot]);return n+=C,P.replace("\r",`
`)}function c(C,P,F,ot){const tt=jr(C,P,F);if(y(tt)&&y(ot)){const st=Zn(ot);for(let W=0;W<st.length;++W){const D=st[W];tt[D]=ot[D]}}}function l(C){let P="";for(let F=0;F<C.length;++F){const ot=C.charCodeAt(F);ot<32||ot>127?P+=`$${ot}`:P+=C[F]}return P}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(P=>{if(P.includes("$")){const[F,...ot]=P.split("$");return`${F??""}"$CENTER ${l(ot.join("$"))}"`}return l(P)}).join(`
`)}function f(C,P,F,ot,tt){const st=ot.color%16,W=Math.floor(ot.color/16)%8,D=Rh(st,W),yt=Rh((W+8)%16,st),X={},at=tt.find(Bt=>Bt.x===P&&Bt.y===F);switch(y(at)&&(Et(at.cycle)&&at.cycle>0&&(X.cycle=at.cycle),y(at.p1)&&(X.p1=at.p1),y(at.p2)&&(X.p2=at.p2),y(at.p3)&&(X.p3=at.p3),y(at.code)&&at.code&&(X.code=u(at.code)),y(at.stepx)&&(X.stepx=at.stepx),y(at.stepy)&&(X.stepy=at.stepy)),ot.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",D],{x:P,y:F},X);break;case 6:c(C,["torch",D],{x:P,y:F},X);break;case 7:c(C,["gem",D],{x:P,y:F},X);break;case 8:c(C,["key",D],{x:P,y:F},X);break;case 9:c(C,["door",yt],{x:P,y:F},X);break;case 10:c(C,["scroll",D],{x:P,y:F},X);break;case 11:{X.p3=d(at==null?void 0:at.p3)??"",c(C,["passage",D],{x:P,y:F},X);break}case 12:c(C,["duplicator",D],{x:P,y:F},X);break;case 13:c(C,["bomb",D],{x:P,y:F},X);break;case 14:c(C,["energize",D],{x:P,y:F},X);break;case 15:c(C,["star",D],{x:P,y:F},X);break;case 16:c(C,["clockwise",D],{x:P,y:F},X);break;case 17:c(C,["counter",D],{x:P,y:F},X);break;case 18:c(C,["bullet",D],{x:P,y:F},X);break;case 19:c(C,["water",D],{x:P,y:F},X);break;case 20:c(C,["forest",D],{x:P,y:F},X);break;case 21:c(C,["solid",D],{x:P,y:F},X);break;case 22:c(C,["normal",D],{x:P,y:F},X);break;case 23:c(C,["breakable",D],{x:P,y:F},X);break;case 24:c(C,["boulder",D],{x:P,y:F},X);break;case 25:c(C,["sliderns",D],{x:P,y:F},X);break;case 26:c(C,["sliderew",D],{x:P,y:F},X);break;case 27:c(C,["fake",D],{x:P,y:F},X);break;case 28:c(C,["invisible",D],{x:P,y:F},X);break;case 29:c(C,["blinkwall",D],{x:P,y:F},X);break;case 30:c(C,["transporter",D],{x:P,y:F},X);break;case 31:c(C,["line",D],{x:P,y:F},X);break;case 32:c(C,["ricochet",D],{x:P,y:F},X);break;case 33:c(C,["blinkns",D],{x:P,y:F},X);break;case 34:c(C,["bear",D],{x:P,y:F},X);break;case 35:c(C,["ruffian",D],{x:P,y:F},X);break;case 36:c(C,["object",D],{x:P,y:F},{...X,char:(at==null?void 0:at.p1)??1});break;case 37:c(C,["slime",D],{x:P,y:F},X);break;case 38:c(C,["shark",D],{x:P,y:F},X);break;case 39:c(C,["spinninggun",D],{x:P,y:F},X);break;case 40:c(C,["pusher",D],{x:P,y:F},X);break;case 41:c(C,["lion",D],{x:P,y:F},X);break;case 42:c(C,["tiger",D],{x:P,y:F},X);break;case 43:c(C,["blinkns",D],{x:P,y:F},X);break;case 44:c(C,["head",D],{x:P,y:F},X);break;case 45:c(C,["segment",D],{x:P,y:F},X);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:P,y:F},{...X,char:ot.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:P,y:F},{...X,char:ot.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:P,y:F},{...X,char:ot.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:P,y:F},{...X,char:ot.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:P,y:F},{...X,char:ot.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:P,y:F},{...X,char:ot.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:P,y:F},{...X,char:ot.color});break}}function d(C){if(Et(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),b=s(),k=a(7),v=s(),T=s(),A=s(),L=s(),S=s();s();const I=s(),$=i(),N=a(20).slice(0,$);for(let C=0;C<9;C++){const P=i();a(20).slice(0,P)}const z=s(),J=s(),M=i();console.info(p,b,k,v,T,A,L,S,I,z,J,M),n=512;const O=[];for(let C=0;C<m;++C){const P=s(),F=n,ot=i(),st={boardname:a(50).slice(0,ot),elements:[],stats:[]};for(;st.elements.length<m$;){let D=i();D===0&&(D=255);const yt=i(),X=i();for(let at=0;at<D;++at)st.elements.push({element:yt,color:X})}st.maxplayershots=i(),st.isdark=i(),st.exitnorth=i(),st.exitsouth=i(),st.exitwest=i(),st.exiteast=i(),st.restartonzap=i(),st.messagelength=i(),st.message=a(58).slice(0,st.messagelength),st.playerenterx=i(),st.playerentery=i(),st.timelimit=s(),n+=16;const W=s()+1;for(;st.stats.length<W;){const D={};D.x=i()-1,D.y=i()-1,D.stepx=s(),D.stepy=s(),D.cycle=s(),D.p1=i(),D.p2=i(),D.p3=i(),D.follower=s(),D.leader=s(),D.underelement=i(),D.undercolor=i(),D.pointer=o(),D.currentinstruction=s();const yt=s();n+=8,yt<0?D.bind=Math.abs(yt):D.code=a(yt),st.stats.push(D)}O.push(st),n=F+P}const E=Qf([]);E.name=N;for(let C=0;C<O.length;++C){const P=O[C],F=[`@zztboard${C}`,""];C===T&&F.push("@title");for(let Wt=0;Wt<P.elements.length;++Wt)P.elements[Wt].element===4&&(F.push(`@startx ${am(Wt,au)}`),F.push(`@starty ${cm(Wt,au)}`));Et(P.maxplayershots)&&F.push(`@maxplayershots ${P.maxplayershots}`),Et(P.isdark)&&F.push(`@isdark ${P.isdark}`),Et(P.restartonzap)&&F.push(`@restartonzap ${P.restartonzap}`),Et(P.timelimit)&&F.push(`@timelimit ${P.timelimit}`);const ot=d(P.exitnorth);gt(ot)&&F.push(`@exitnorth ${ot}`);const tt=d(P.exitsouth);gt(tt)&&F.push(`@exitsouth ${tt}`);const st=d(P.exitwest);gt(st)&&F.push(`@exitwest ${st}`);const W=d(P.exiteast);gt(W)&&F.push(`@exiteast ${W}`);const D=`@board ${String(C).padStart(3,"0")}. ${P.boardname}
${F.join(`
`)}`,yt=mk(D,{});nd(E,yt);const X=Se(yt);if(!y(X))continue;let at=0,Bt=0;for(let Wt=0;Wt<P.elements.length;++Wt){const Dt=P.elements[Wt];f(X,at,Bt,Dt,P.stats),++at,at===au&&(at=0,++Bt)}Re(X)}Jl(E),i0(nt,e,`imported zzt file into ${E.name} book`)}function Vw(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return f$.getType(e)??"application/octet-stream"}async function _$(e,t,n){try{xe(nt,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Pd().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Vw(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(nt,e,"crash",c.message)})})}catch(r){de(nt,e,"crash",r.message)}}function Xw(e,t,n){if(y(n))switch(t){case"text/plain":n.text().then(r=>xu(nt,e,void 0,"text",`file:${n.name}`,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/json":n.text().then(r=>xu(nt,e,void 0,"json",`file:${n.name}`,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/zip":_$(e,n,r=>qw(e,r)).catch(r=>de(nt,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{g$(e,new Uint8Array(r))}).catch(r=>de(nt,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{d$(e,r)}).catch(r=>de(nt,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{p$(e,r)}).catch(r=>de(nt,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=Vw(n.name,new Uint8Array(r));if(i)Xw(e,i,n);else return de(nt,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>de(nt,e,"crash",r.message));return}}function qw(e,t){Xw(e,(t==null?void 0:t.type)??"",t)}function hi(e,t,n){n().catch(r=>{console.error(r),de(e,t,"crash",r==null?void 0:r.message)})}function y$(e){const[t,n]=e.split(":"),r=y(n);return[r?t:"self",r?n:e]}function b$(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function k$(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const w$=new Date("1980/09/02");async function $d(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Pd;for(let i=0;i<e.length;++i){const s=e[i],o=pU(s);if(o){const a=IS(o);y(a)&&r.file(s.id,a,{date:w$})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(k$(i))}).catch(n)})}async function E$(e){return new Promise((t,n)=>{const r=new Pd;r.loadAsync(b$(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=mU(CS(c));y(l)&&i.push(l)}t(i)}).catch(n)})}function x$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){Et(u)&&(s=u,lm(t.x,t.y,n.x,n.y).forEach(f=>{const d=re(i,f);y(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,`batch:${io(t,n)}`,"char",[r,"charedit"],o,a);const c=Ye(e);c.scrollname="bulk set char",c.scroll=An(e)}function v$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){if(Et(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=re(i,{x:d,y:f});y(h)&&(h[l]=u)}}}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,`batch:${io(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scrollname="bulk set color",c.scroll=An(e)}function T$(e,t,n,r){const i=fn(e);if(!y(i))return;let s=0;function o(){return s}function a(l,u){Et(u)&&(s=u,lm(t.x,t.y,n.x,n.y).forEach(f=>{const d=re(i,f);y(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,`batch:${io(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scrollname="bulk set bg",c.scroll=An(e)}function A$(e,t,n,r){const i=un($t.MAIN);if(!y(i))return;const s=fn(e);if(!y(s))return;const o=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Ct(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Ct(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Ct(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Ct(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Rt(e,Ke),Ct(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Ct(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Ct(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Rt(e,Ke),Ct(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Rt(e,Ke),Rt(e,"codepages:"),Ct(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let d=c;d<=u;++d)for(let h=a;h<=l;++h){const m=re(s,{x:h,y:d}),p=bk(i,m);y(p)&&!f.has(p.id)&&(f.add(p.id),Ct(e,"batch",`edit @${Ue(p)}`,[`pageopen:${p.id}`]))}Ct(e,"batch",`board id ${s.id}`,["","copyit",s.id])}function Dd(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function S$(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Dd(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let jd;function Jw(){return jd||(jd=S$("keyval-store","keyval")),jd}function Zw(e,t=Jw()){return t("readonly",n=>Dd(n.get(e)))}function Qw(e,t,n=Jw()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Dd(r.transaction))}catch(o){s(o)}}}))}function zd(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function tE(){return Zw("secretheap")}async function eE(e){return Qw("secretheap",e)}async function R$(){return!!await tE()}function nE(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=re(e,{x:d,y:f});(m==null?void 0:m.category)===Pn.ISOBJECT?(l.push(Ar(ns(e,d,f))),nn(m).name!=="player"&&u.push({...Ar(m),...h,id:"blank"})):l.push({...Ar(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function O$(e,t,n,r){const i=fn(e);if(!y(i))return;const s=nE(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await eE(()=>s)}function N$(e,t,n){const r=zd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Ct(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Ct(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ye(e);i.scrollname="copy",i.scroll=An(e)}async function I$(e,t,n,r){const i=un($t.MAIN);if(!y(i))return;const s=fn(e);if(!y(s))return;const o=nE(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=re(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&Tn(s,l,i.timestamp),Oe(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=re(s,{x:c,y:a});(l==null?void 0:l.category)===Pn.ISOBJECT&&Tn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Oe(s,{x:c,y:a});break}}await eE(()=>o)}function C$(e,t,n){const r=zd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Ct(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Ct(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ye(e);i.scrollname="cut",i.scroll=An(e)}async function L$(e,t,n,r){const i=fn(e),s=await tE();if(!y(i)||!y(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=dr({x:p,y:m},s.width);Oe(i,{...s.terrain[b],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&kh(p.x,p.y,0,u-1,f-1,0)&&Md(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];y(p.x)&&y(p.y)&&kh(p.x,p.y,0,u-1,f-1,0)&&Md(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=dr({x:p,y:m},s.width);Oe(i,{...s.terrain[b],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const b=(p-o)%s.width,k=(m-a)%s.height,v=dr({x:b,y:k},s.width);Oe(i,{...s.terrain[v],x:p,y:m})}break}}function M$(e,t,n){const r=zd(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Ct(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Ct(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Ct(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ye(e);i.scrollname="paste",i.scroll=An(e)}function Wd(e,t){return`inspect:${t!=null&&t.id?t.id:zr(e,t)}`}function U$(e,t,n){const r=un($t.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Wd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Ct(e,u,"color",[n,"coloredit"],s,o);const f=Ye(e);f.scrollname="color",f.scroll=An(e)}function F$(e,t,n){const r=un($t.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){y(t)&&(t[d]=h)}const a=t.category===Pn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Wd(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Ct(e,u,"char",[n,"charedit"],s,o);const f=Ye(e);f.scrollname="char",f.scroll=An(e)}function B$(e,t,n,r,i,s){var h,m,p;const o=un($t.MAIN);if(!y(o))return;function a(b){var v;const k=(r==null?void 0:r[b])??((v=r==null?void 0:r.kinddata)==null?void 0:v[b]);if(!y(k))switch(b){case"color":return 15;case"bg":return 0;case"cycle":return f0;case"collision":return zt.ISWALK;case"pushable":return 0;case"breakable":return 0}return k}function c(b,k){y(r)&&(r[b]=k)}s?Rt(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Rt(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Wd(t,r);switch(s&&Rt(e,`cycle: ${Gt(r,"cycle")}`),Gt(r,"collision")){case zt.ISWALK:Rt(e,"collision: iswalk");break;case zt.ISSWIM:Rt(e,"collision: isswim");break;case zt.ISSOLID:Rt(e,"collision: issolid");break;case zt.ISBULLET:Rt(e,"collision: isbullet");break}if(s){const b=Gt(r,"pushable");Rt(e,`ispushable: ${b||"no"}`)}Rt(e,`isbreakable: ${Gt(r,"breakable")?"yes":"no"}`),Rt(e,Ke);const f=Sa(n),d=Zn(f);for(let b=0;b<d.length;++b){const k=d[b];switch(k){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ue(f[k])){const[v,T,...A]=f[k];gt(T)&&Ct(e,l,T||k,[k,v,...A],a,c)}break}}Ct(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Rt(e,Ke),Ct(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Ct(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Ct(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Rt(e,Ke),Ct(e,l,"make empty",["empty","hk","0"],a,c),Rt(e,Ke),Ct(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Ct(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`]),Ct(e,"batch",`board id ${t.id}`,["","copyit",t.id])}function P$(e,t,n,r){const i=un($t.MAIN);if(!y(i))return;const s=fn(e);if(y(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=re(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Tn(s,c,i.timestamp),Oe(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=re(s,{x:a,y:o});(c==null?void 0:c.category)===Pn.ISOBJECT&&Tn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Oe(s,{x:a,y:o});break}}}function $$(e,t,n){const r=un($t.MAIN);if(!y(r))return;const i=fn(e);if(!y(i))return;const s=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Ct(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Ct(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Ct(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ye(e);o.scrollname="empty",o.scroll=An(e)}async function D$(e,t,n){const r=un($t.MAIN),i=await R$();if(!y(r))return;const s=fn(e);if(!y(s))return;if(Re(s),t.x===n.x&&t.y===n.y){const a=re(s,t),c=bk(r,a);y(a)&&y(c)&&B$(e,s,c,a,t,Ge(a)),a!=null&&a.kind||(Rt(e,`empty: ${t.x}, ${t.y}`),Rt(e,Ke),Ct(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Ct(e,"batch","edit @board codepage",[`pageopen:${s.id}`]),Ct(e,"batch",`board id ${s.id}`,["","copyit",s.id]))}else A$(e,t,n,i);const o=Ye(e);o.scrollname="inspect",o.scroll=An(e)}function j$(e,t){const n=ce($t.MAIN);if(!y(n))return;const r=fn(t);if(!y(r))return;const i=$n(e),s=QP(r,i.target);if(y(s))switch(i.path){case"copycoords":wu(nt,cr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":U$(t,s,i.path);break;case"char":F$(t,s,i.path);break;case"empty":Tn(r,s,n.timestamp);break;case"code":hi(nt,t,async()=>{const o=nn(s),a="object";xe(nt,t,`opened [${a}] ${o.name}`);const c=[r.id,s.id];bh(Ha(n.id,c),s.code??""),sx(nt,t),await d0(800),l0(nt,t,n.id,c,a,`${name} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function z$(e,t){const n=fn(t);if(!y(n))return;const r=$n(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":N$(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await O$(t,c,l,r.target);break;case"cut":C$(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await I$(t,c,l,r.target);break;case"paste":M$(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await L$(t,c,l,r.target);break;case"empty":$$(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":P$(t,c,l,r.target);break;case"chars":x$(t,c,l,"char");break;case"colors":v$(t,c,l,"color");break;case"bgs":T$(t,c,l,"bg");break;case"copycoords":wu(nt,t,[i,s,o,a].join(" "));break;case"pageopen":hi(nt,t,async()=>{await d0(800),Ax(nt,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function W$(){return Zw("remixconfig")}async function G$(e){return Qw("remixconfig",e)}let rs={stat:"",patternsize:2,mirror:1};async function K$(e,t){const n=fn(t);if(!y(n))return;const r=$n(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await H$(t,c,l);break}case"remixrun":{const u=hn(rs.stat);y(u)&&Zk(n.id,u.id,rs.patternsize,rs.mirror,c,l,"all"),await G$(()=>rs);break}default:console.info("unknown remix",r);break}}async function H$(e,t,n){const r=await W$();rs={...rs,...r};const i=io(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke);function s(c){const{target:l}=$n(c);return rs[l]}function o(c,l){if(Et(l)||gt(l)){const{target:u}=$n(c);rs[u]=l}}Ct(e,"remix","source board",[`stat:${i}`,"text"],s,o),Ct(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Ct(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Rt(e,Ke),Ct(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ye(e);a.scrollname="remix",a.scroll=An(e)}const Y$=16,is={},cu={},V$=60;let rE=0;const Lo={},Mo={};async function iE(e){const t=Pr(),n=ce($t.MAIN);if(t.length&&y(n)){const r=await $d(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;ax(Zt,cr(),i,r)}}async function X$(){const e=Pr(),t=ce($t.MAIN);if(e.length&&y(t)){const n=await $d(e);cx(Zt,cr(),n)}}async function q$(){const e=Pr(),t=ce($t.MAIN);return e.length&&y(t)?$d(e):""}const Zt=Ps("vm",["tick","second"],e=>{var n;if(!Zt.session(e))return;const t=cr();switch(e.target){case"operator":RP(e.player),xe(Zt,e.player,`operator set to ${e.player}`),Zt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ce($t.MAIN);Zt.replynext(e,"ackzsswords",{cli:bd(Zi.CLI),loader:bd(Zi.LOADER),runtime:bd(Zi.RUNTIME),flags:[...Zn(vr(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Rs(r,bt.OBJECT).map(i=>Ue(i)),...Zn(_d)],altkinds:[...Rs(r,bt.TERRAIN),...Rs(r,bt.BOARD),...Rs(r,bt.PALETTE),...Rs(r,bt.CHARSET),...Rs(r,bt.LOADER)].map(i=>Ue(i)),colors:[...Zn(Zo)],dirs:[...Zn(Ah).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...Zn(md)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data,s=await E$(r),o=s.map(a=>a.name);UP(s,i),xe(Zt,e.player,`loading ${o.join(", ")}`),ku(Zt,e.player)}});break;case"search":PP(e.player)||ku(Zt,e.player);break;case"logout":BP(e.player),delete is[e.player],xe(Zt,t,`player ${e.player} logout`),ku(Zt,e.player);break;case"login":Nw(e.player)?(is[e.player]=0,xe(Zt,cr(),`login from ${e.player}`),Zt.replynext(e,"acklogin",!0)):s0(Zt,e.player);break;case"local":Nw(e.player)?(is[e.player]=0,xe(Zt,cr(),`login from ${e.player}`)):s0(Zt,e.player);break;case"doot":is[e.player]=0,cu[e.player]=cu[e.player]??0,cu[e.player]%32===0&&xe(Zt,e.player,`$whiteactive $blue${e.player}`),++cu[e.player];break;case"input":{if(e.player.includes("local")&&!Rw(e.player)&&Tx(Zt,e.player),!e.player.includes("local")||Rw(e.player)){const r=vr(e.player),[i=Rn.NONE,s=0]=e.data??[Rn.NONE,0];ue(r.inputqueue)||(r.inputqueue=[]),i!==Rn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ue(e.data)){const[r,i]=e.data,s=Ha(r,i);y(Mo[s])||(Mo[s]=sm(s,o=>{const[a,c]=i,l=$r(r),u=Ss(l,a);if(y(u))if(ci(u)===bt.BOARD&&y(c)){const f=Se(u),d=Un(f,c);y(d)&&(d.code=o,Cl(Jf(o),d))}else u.code=o,fU(u)})),Lo[s]=Lo[s]??new Set,Lo[s].add(e.player)}break;case"coderelease":if(ue(e.data)){const[r,i]=e.data,[,s]=i,o=Ha(r,i);y(Lo[o])&&(Lo[o].delete(e.player),Lo[o].size===0&&((n=Mo[o])==null||n.call(Mo),Mo[o]=void 0,gt(s)&&zP(s)))}break;case"halt":e.player===t&&zE(e.data)&&OP(e.data);break;case"tick":GP(NP());break;case"synthsend":if(gt(e.data)){const[r,i]=y$(e.data),s=ce($t.MAIN);Oo(r,i,void 0,ko(s))}break;case"second":{$P(is);const r=Object.keys(is);for(let i=0;i<r.length;++i)++is[r[i]];for(let i=0;i<r.length;++i){const s=r[i];is[s]>=Y$&&u0(Zt,s)}++rE>=V$&&(rE=0,hi(Zt,e.player,async()=>{await iE(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ce($t.MAIN);if(y(r)&&ue(e.data)){const[i]=e.data,s=Ss(r,i);y(s)&&ux(Zt,t,s,`${Ue(s)}.${Oi(s)}.json`)}}break;case"refscroll":{Rt(e.player,"stat refs"),Rt(e.player,Ke),Ct(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Ct(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Ct(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ye(e.player);r.scrollname="refscroll",r.scroll=An(e.player);break}case"fork":e.player===t&&hi(Zt,e.player,async()=>{await X$()});break;case"itchiopublish":hi(Zt,e.player,async()=>{if(e.player===t){const r=ce($t.MAIN);if(y(r)){const i=await q$();lx(Zt,e.player,r.name,i)}}});break;case"flush":e.player===t&&hi(Zt,e.player,async()=>{await iE()});break;case"cli":Lw(e.player,e.data);break;case"clirepeatlast":KP(e.player);break;case"restart":e.player===t&&(WP(),h0(Zt,e.player));break;case"inspect":hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data;await D$(e.player,r,i)}});break;case"loader":if(ue(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":qw(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json);y(a.data)&&gt(a.exported)&&(Jl(a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ce($t.MAIN);y(c)&&y(a.data)&&gt(a.exported)&&(nd(c,a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else zk(r,i,s,o,e.player);break;default:zk(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=$n(e.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Ct(e.player,"refscroll","char",["char","charedit"]);const s=Ye(e.player);s.scrollname="chars",s.scroll=An(e.player);break}case"colorscroll":{Ct(e.player,"refscroll","color",["color","coloredit"]);const s=Ye(e.player);s.scrollname="colors",s.scroll=An(e.player);break}case"notesscroll":{Rt(e.player,"duration             cdefgab - notes "),Rt(e.player,"y - 64th note        x - rest"),Rt(e.player,"t - 32nd note        "),Rt(e.player,"s - 16th note.       drums"),Rt(e.player,"i - eight note.      0 - tick"),Rt(e.player,"q - quarter note     1 - tweet"),Rt(e.player,"h - half note        2 - cowbell"),Rt(e.player,"w - whole note       p - clap"),Rt(e.player,"                     4 - high snare"),Rt(e.player,"mods                 5 - high woodblock"),Rt(e.player,"3 - triplet          6 - low snare"),Rt(e.player,". - time and a half  7 - low tom"),Rt(e.player,"# - sharp            8 - low woodblock"),Rt(e.player,"! - flat             9 - bass drum");const s=Ye(e.player);s.scrollname="music notation",s.scroll=An(e.player);break}}break;case"batch":hi(Zt,e.player,async()=>{await z$(i,e.player)});break;case"remix":hi(Zt,e.player,async()=>{await K$(i,e.player)});break;case"empty":{const s=$n(i);switch(s.target){case"copycoords":wu(Zt,cr(),s.path.split(",").join(" "));break}break}case"inspect":j$(i,e.player);break;case"touched":if(ue(e.data)){const[s,o,a]=e.data;Iw({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=$n(i);if(It(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Iw(e);else{const o=ce($t.MAIN);Oo(s.target,s.path,void 0,ko(o))}break}}break}}},SP());function J$(){ox(Zt)}const{forward:Z$}=Lx(e=>{Mx(e)&&postMessage(e)});onmessage=function(t){Z$(t.data)},setTimeout(J$,100)})();

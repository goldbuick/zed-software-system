var $M=Object.defineProperty;var zM=(sr,_e,Mt)=>_e in sr?$M(sr,_e,{enumerable:!0,configurable:!0,writable:!0,value:Mt}):sr[_e]=Mt;var ye=(sr,_e,Mt)=>zM(sr,typeof _e!="symbol"?_e+"":_e,Mt);(function(){"use strict";const sr=new Set,_e={emit(t,e,n,r){_e.invoke(nb(t,e,n,r))},invoke(t){sr.forEach(e=>e.handle(t))},connect(t){sr.add(t)},disconnect(t){sr.delete(t)}};var Mt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function $_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Kh={};(function(t){var e=Mt&&Mt.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var d=0,f=u.length,p;d<f;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,d=l.capitalize,f=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,_=b===void 0?!1:b,w=e(e(e([],e([],Array(m),!0).map(function(v){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return f&&(w=w.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),w.join(h)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(t.adjectives).length*h+h*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(f?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,d=l.addAdverb,f=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(t.adjectives).length*h+h*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(f?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(Kh);var z_=Oi(Kh);const j_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let W_=t=>crypto.getRandomValues(new Uint8Array(t)),G_=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},qh=(t,e=21)=>G_(t,e,W_),H_=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=j_[n[t]&63];return e};var Xh="abcdefghijklmnopqrstuvwxyz",Zh="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Jh="0123456789",V_="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",K_="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const q_=Jh,X_=Xh,Z_=Zh;var J_=q_+X_+Z_,Cc={lowercase:Xh,uppercase:Zh,numbers:Jh,nolookalikes:V_,nolookalikesSafe:K_,alphanumeric:J_};function at(){return`sid_${H_(12).replaceAll("-",".")}`}const Y_=qh(Cc.numbers,4),Q_=qh(`${Cc.numbers}${Cc.lowercase}`,16);function eb(){return`pid_${Y_()}_${Q_()}`}function Yh(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function tb(){return z_({capitalize:!1,adjectiveCount:1})}var Le=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Le||{}),He=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(He||{}),Eo=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Eo||{}),ce=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(ce||{}),he=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.SCROLL=13]="SCROLL",t[t.COPYIT=14]="COPYIT",t))(he||{});function Pe(t){return t.toLowerCase().trim()}function nb(t,e,n,r){return{id:at(),target:t,sender:e,data:n,player:r}}function Qh(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function cs(t,e,n){const r=at(),i=Pe(t),s=e.map(Pe),o={id(){return r},name(){return t},topics(){return e},emit(a,c,l){_e.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Qh(a.target),u=Pe(c);s.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||i===u)&&n({...a,target:l})}};return _e.connect(o),o}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var rb=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ib=Object.prototype.hasOwnProperty;function Nc(t,e){return ib.call(t,e)}function Lc(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)Nc(t,i)&&r.push(i);return r}function Ht(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Mc(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Yr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function ef(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Uc(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Uc(t[e]))return!0}else if(typeof t=="object"){for(var r=Lc(t),i=r.length,s=0;s<i;s++)if(Uc(t[r[s]]))return!0}}return!1}function tf(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var nf=function(t){rb(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,tf(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=tf(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),rt=nf,sb=Ht,Ci={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=ko(n,this.path);r&&(r=Ht(r));var i=Qr(n,{op:"remove",path:this.from}).removed;return Qr(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=ko(n,this.from);return Qr(n,{op:"add",path:this.path,value:Ht(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:ls(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},ob={add:function(t,e,n){return Mc(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Ci.move,copy:Ci.copy,test:Ci.test,_get:Ci._get};function ko(t,e){if(e=="")return t;var n={op:"_get",path:e};return Qr(t,n),n.value}function Qr(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):So(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=ko(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=ls(t,e.value),o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ht(t));var a=e.path||"",c=a.split("/"),l=t,u=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=So;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=ef(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Mc(f))throw new rt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Mc(f)&&(f=~~f)}if(u>=h){if(n&&e.op==="add"&&f>l.length)throw new rt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=ob[e.op].call(e,l,f,t);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=h){var o=Ci[e.op].call(e,l,f,t);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new rt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Pc(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ht(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Qr(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function ab(t,e,n){var r=Qr(t,e);if(r.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function So(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new rt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Ci[t.op]){if(typeof t.path!="string")throw new rt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new rt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new rt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Uc(t.value))throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new rt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new rt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=rf([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new rt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function rf(t,e,n){try{if(!Array.isArray(t))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Pc(Ht(e),Ht(t),n||!0);else{n=n||So;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof rt)return i;throw i}}function ls(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!ls(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!ls(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var cb=Object.freeze({__proto__:null,JsonPatchError:rt,_areEquals:ls,applyOperation:Qr,applyPatch:Pc,applyReducer:ab,deepClone:sb,getValueByPointer:ko,validate:rf,validator:So});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Dc=new WeakMap,lb=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),ub=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function hb(t){return Dc.get(t)}function fb(t,e){return t.observers.get(e)}function db(t,e){t.observers.delete(e.callback)}function pb(t,e){e.unobserve()}function mb(t,e){var n=[],r,i=hb(t);if(!i)i=new lb(t),Dc.set(t,i);else{var s=fb(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ht(t),e){r.callback=e,r.next=null;var o=function(){Bc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Bc(r),clearTimeout(r.next),db(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new ub(e,r)),r}function Bc(t,e){e===void 0&&(e=!1);var n=Dc.get(t.object);Fc(n.value,t.object,t.patches,"",e),t.patches.length&&Pc(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function Fc(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Lc(e),o=Lc(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(Nc(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?Fc(u,h,n,r+"/"+Yr(l),i):u!==h&&(i&&n.push({op:"test",path:r+"/"+Yr(l),value:Ht(u)}),n.push({op:"replace",path:r+"/"+Yr(l),value:Ht(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Yr(l),value:Ht(u)}),n.push({op:"remove",path:r+"/"+Yr(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Nc(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+Yr(l),value:Ht(e[l])})}}}function sf(t,e,n){n===void 0&&(n=!1);var r=[];return Fc(t,e,r,"",n),r}var gb=Object.freeze({__proto__:null,compare:sf,generate:Bc,observe:mb,unobserve:pb});Object.assign({},cb,gb,{JsonPatchError:nf,deepClone:Ht,escapePathComponent:Yr,unescapePathComponent:ef});var yb=typeof Element<"u",_b=typeof Map=="function",bb=typeof Set=="function",wb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ao(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Ao(t[r],e[r]))return!1;return!0}var s;if(_b&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Ao(r.value[1],e.get(r.value[0])))return!1;return!0}if(bb&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(wb&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(yb&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Ao(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var vb=function(e,n){try{return Ao(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Eb=Oi(vb);function k(t){return t!=null}const kb=Object.keys;function ei(t){return Ht(t)}function Ee(t){return typeof t=="number"&&isNaN(t)===!1}function ke(t){return typeof t=="string"}function Ge(t){return Array.isArray(t)}function Sb(t){return t}function Ab(t){return k(t)&&typeof t=="object"&&ke(t.id)&&ke(t.target)&&ke(t.sender)}function Tb(t){const e=new Set;function n(s){Ab(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),_e.invoke(s))}const r=cs("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){_e.disconnect(r)}return{forward:n,disconnect:i}}const $c=66.666,To=Math.round(1e3/$c),Rb=3;function Ib(t){return new Promise(e=>setTimeout(e,t))}function xb(){return location.href.includes("/join/")}function Ob(){return location.href.includes("/locked/")}const zc=cs("clock",[],()=>{});let jc=0,Ro=0,Wc=0,of=performance.now();function af(){const t=performance.now(),e=t-of,n=Ob()?"locked":"";Wc+=e,Wc>=$c&&(Wc%=$c,zc.emit("tick",Ro,n),zc.emit("tock",Ro,n),++jc,++Ro,jc>=To&&(jc%=To,zc.emit("second",Ro,n))),of=t,setTimeout(af,1)}af();var cf={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),i="A-Z"+e("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,m,b){return f=f||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+m+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,m){return p!=null&&(f=f.replace(a.fill,function(b,_){return _?p+_:""})),m&&(f=c.deapostrophe(f)),f},prep:function(f,p,m,b){if(f=f==null?"":f+"",!b&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var _=c.fill(f," ");a.hole.test(_)&&(f=_)}return!m&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,m,b){return p+" "+(m?m+" ":"")+b}},l={_:c,of:function(f){for(var p=0,m=c.types.length;p<m;p++)if(l[c.types[p]].apply(l,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){l[f]=p,c.types.push(f)}},u={lower:function(f,p,m){return c.fill(c.low.call(c.prep(f,p)),p,m)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,p,m){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,m)},capital:function(f,p,m){return c.fill(c.prep(f).replace(a.capitalize,function(b,_,w){return _+c.up.call(w)}),p,m)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(p,m,b,_){return b>0&&b<_.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,m){return f=l.lower(f).replace(a.sentence,function(b,_,w){return _+c.up.call(w)}),p&&p.forEach(function(b){f=f.replace(new RegExp("\\b"+l.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){f=f.replace(new RegExp("(\\b"+l.lower(b)+"\\. +)(\\w)"),function(_,w,v){return w+c.low.call(v)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=l:this.Case=l)}).call(Mt)})(cf);var Cb=cf.exports,Nb=Oi(Cb);function us(){return us=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},us.apply(this,arguments)}function Lb(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Gc(t,e)}function Gc(t,e){return Gc=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Gc(t,e)}function Mb(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var lf=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[gt].connections.iterate.delete(r),i.byKey.forEach(function(o){s[gt].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),ti=[],Io=function(t){Lb(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){ti.push(Mb(o));try{o.func()}finally{ti.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(ti.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(lf);function uf(){return!!ti.length}function hf(){return ti.length?ti[ti.length-1]:void 0}function Ub(t,e,n){var r=us({name:"unnamed",fireImmediately:!0},n),i=new Io(t,r,e);return i}var xo=0;function ff(){return xo>0}function Hc(t){xo++;try{return t()}finally{xo--,xo===0&&Db()}}var Vc=!1;function df(){return Vc}function pf(t){Vc=!0;try{t()}finally{Vc=!1}}function Pb(t){return function(){return pf(t)}}var Kc=[];function Db(){var t=[].concat(Kc);Kc=[],mf(t)}function mf(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[gt].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[gt].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function Oo(t){if(ff()){Kc.push(t);return}mf([t])}function gf(t,e){if(t.type==="iterate")t.observable[gt].connections.iterate.add(e);else{var n=t.observable[gt].connections.byKey.get(t.key);n||(n=new Set,t.observable[gt].connections.byKey.set(t.key,n)),n.add(e)}}function Co(t,e){if(!df()){var n=hf();n&&(gf(t,n),n.registerConnection(t)),e&&(gf(t,e),e.registerConnection(t))}}var qc=Symbol("$skipreactive"),gt=Symbol("$reactive"),an=Symbol("$reactiveproxy");function hs(t,e){return!!(t&&t[an]&&t[an].implicitObserver===e)}function Xc(t){return t[qc]=!0,t}function yf(t){return!!(t&&!hs(t)&&t[gt])}function Zc(t,e,n){if(n===void 0&&(n=!1),t[qc]||hs(t,e))return t;var r=Bb(t,n);if(!e)return r;var i=r[gt].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,_f),i=new Proxy(r[gt].raw,s),r[gt].proxiesWithImplicitObserver.set(e,i)}return i}var fs=Zc;function Bb(t,e){if(e===void 0&&(e=!1),hs(t))return t;if(yf(t))return t[gt].proxy;if(t[gt]||t[an])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,gt,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,_f);return n.proxy=r,r}var _f={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||Co({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===an)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?Co({observable:e,type:"iterate"},this.implicitObserver):Co({observable:e,key:n,type:"get"},this.implicitObserver),yf(i))return Zc(i,this.implicitObserver);if(e[gt].shallow)return i;if(typeof i=="object"&&i!==null&&!hs(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(uf()||this.implicitObserver))return Zc(i,this.implicitObserver)}return i},ownKeys:function(e){return Co({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return Hc(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)Oo({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)Oo({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else Oo({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return Hc(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&Oo({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function Fb(t,e){var n=us({name:"unnamed",fireImmediately:!0},e),r=new Io(t,n);return r}function $b(t,e,n){var r=us({name:"unnamed",fireImmediately:!0},n),i=new Io(function(){t(e)},r);return e=fs(e,i),r.fireImmediately&&i.trigger(),i}var bf=function(){function t(){this._observable=fs({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return fs(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function zb(t,e,n){return new bf}var jb=Object.freeze({__proto__:null,$reactive:gt,$reactiveproxy:an,$skipreactive:qc,Atom:bf,Observer:lf,Reaction:Io,autorun:Fb,autorunAsync:$b,createAtom:zb,hasRunningReaction:uf,isActionRunning:ff,isReactive:hs,isTrackingDisabled:df,markRaw:Xc,reaction:Ub,reactive:fs,runInAction:Hc,runningReaction:hf,untracked:pf,untrackedCB:Pb});const Sn=()=>new Map,Jc=t=>{const e=Sn();return t.forEach((n,r)=>{e.set(r,n)}),e},Nr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Wb=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Gb=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Ni=()=>new Set,Yc=t=>t[t.length-1],Hb=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Lr=Array.from,Vb=Array.isArray;class Kb{constructor(){this._observers=Sn()}on(e,n){return Nr(this._observers,e,Ni).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Lr((this._observers.get(e)||Sn()).values()).forEach(r=>r(...n))}destroy(){this._observers=Sn()}}const Mr=Math.floor,No=Math.abs,wf=(t,e)=>t<e?t:e,ni=(t,e)=>t>e?t:e,vf=t=>t!==0?t<0:1/t<0,Ef=1,kf=2,Qc=4,el=8,ds=32,or=64,en=128,Lo=31,tl=63,ri=127,qb=2147483647,Sf=Number.MAX_SAFE_INTEGER,Xb=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Mr(t)===t),Zb=t=>t.toLowerCase(),Jb=/^\s*/g,Yb=t=>t.replace(Jb,""),Qb=/([A-Z])/g,Af=(t,e)=>Yb(t.replace(Qb,n=>`${e}${Zb(n)}`)),ew=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ps=typeof TextEncoder<"u"?new TextEncoder:null,tw=ps?t=>ps.encode(t):ew;let ms=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ms&&ms.decode(new Uint8Array).length===1&&(ms=null);class gs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ur=()=>new gs,nw=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},An=t=>{const e=new Uint8Array(nw(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},rw=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ni(n,e)*2),t.cpos=0)},kt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},nl=kt,Se=(t,e)=>{for(;e>ri;)kt(t,en|ri&e),e=Mr(e/128);kt(t,ri&e)},rl=(t,e)=>{const n=vf(e);for(n&&(e=-e),kt(t,(e>tl?en:0)|(n?or:0)|tl&e),e=Mr(e/64);e>0;)kt(t,(e>ri?en:0)|ri&e),e=Mr(e/128)},il=new Uint8Array(3e4),iw=il.length/3,sw=(t,e)=>{if(e.length<iw){const n=ps.encodeInto(e,il).written||0;Se(t,n);for(let r=0;r<n;r++)kt(t,il[r])}else Nt(t,tw(e))},ow=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Se(t,r);for(let i=0;i<r;i++)kt(t,n.codePointAt(i))},Li=ps&&ps.encodeInto?sw:ow,Mo=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=wf(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ni(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Nt=(t,e)=>{Se(t,e.byteLength),Mo(t,e)},sl=(t,e)=>{rw(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},aw=(t,e)=>sl(t,4).setFloat32(0,e,!1),cw=(t,e)=>sl(t,8).setFloat64(0,e,!1),lw=(t,e)=>sl(t,8).setBigInt64(0,e,!1),Tf=new DataView(new ArrayBuffer(4)),uw=t=>(Tf.setFloat32(0,t),Tf.getFloat32(0)===t),ys=(t,e)=>{switch(typeof e){case"string":kt(t,119),Li(t,e);break;case"number":Xb(e)&&No(e)<=qb?(kt(t,125),rl(t,e)):uw(e)?(kt(t,124),aw(t,e)):(kt(t,123),cw(t,e));break;case"bigint":kt(t,122),lw(t,e);break;case"object":if(e===null)kt(t,126);else if(Vb(e)){kt(t,117),Se(t,e.length);for(let n=0;n<e.length;n++)ys(t,e[n])}else if(e instanceof Uint8Array)kt(t,116),Nt(t,e);else{kt(t,118);const n=Object.keys(e);Se(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Li(t,i),ys(t,e[i])}}break;case"boolean":kt(t,e?120:121);break;default:kt(t,127)}};class Rf extends gs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Se(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const If=t=>{t.count>0&&(rl(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Se(t.encoder,t.count-2))};class Uo{constructor(){this.encoder=new gs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(If(this),this.count=1,this.s=e)}toUint8Array(){return If(this),An(this.encoder)}}const xf=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);rl(t.encoder,e),t.count>1&&Se(t.encoder,t.count-2)}};class ol{constructor(){this.encoder=new gs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(xf(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return xf(this),An(this.encoder)}}class hw{constructor(){this.sarr=[],this.s="",this.lensE=new Uo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new gs;return this.sarr.push(this.s),this.s="",Li(e,this.sarr.join("")),Mo(e,this.lensE.toUint8Array()),An(e)}}const Pr=t=>new Error(t),Un=()=>{throw Pr("Method unimplemented")},Pn=()=>{throw Pr("Unexpected case")},Of=Pr("Unexpected end of array"),Cf=Pr("Integer out of Range");class Po{constructor(e){this.arr=e,this.pos=0}}const ii=t=>new Po(t),fw=t=>t.pos!==t.arr.length,dw=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Ut=t=>dw(t,Ae(t)),Mi=t=>t.arr[t.pos++],Ae=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ri)*n,n*=128,i<en)return e;if(e>Sf)throw Cf}throw Of},al=t=>{let e=t.arr[t.pos++],n=e&tl,r=64;const i=(e&or)>0?-1:1;if(!(e&en))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ri)*r,r*=128,e<en)return i*n;if(n>Sf)throw Cf}throw Of},Ui=ms?t=>ms.decode(Ut(t)):t=>{let e=Ae(t);if(e===0)return"";{let n=String.fromCodePoint(Mi(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Mi(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},cl=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},pw=[t=>{},t=>null,al,t=>cl(t,4).getFloat32(0,!1),t=>cl(t,8).getFloat64(0,!1),t=>cl(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Ui,t=>{const e=Ae(t),n={};for(let r=0;r<e;r++){const i=Ui(t);n[i]=_s(t)}return n},t=>{const e=Ae(t),n=[];for(let r=0;r<e;r++)n.push(_s(t));return n},Ut],_s=t=>pw[127-Mi(t)](t);class Nf extends Po{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),fw(this)?this.count=Ae(this)+1:this.count=-1),this.count--,this.s}}class Do extends Po{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=al(this);const e=vf(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ae(this)+2)}return this.count--,this.s}}class ll extends Po{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=al(this),n=e&1;this.diff=Mr(e/2),this.count=1,n&&(this.count=Ae(this)+2)}return this.s+=this.diff,this.count--,this.s}}class mw{constructor(e){this.decoder=new Do(e),this.str=Ui(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const gw=crypto.getRandomValues.bind(crypto),Lf=()=>gw(new Uint32Array(1))[0],yw="10000000-1000-4000-8000"+-1e11,_w=()=>yw.replace(/[018]/g,t=>(t^Lf()&15>>t/4).toString(16)),Mf=t=>new Promise(t);Promise.all.bind(Promise);const Uf=t=>t===void 0?null:t;class bw{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Pf=new bw,ww=!0;try{typeof localStorage<"u"&&localStorage&&(Pf=localStorage,ww=!1)}catch{}const vw=Pf,Ew=Object.assign,kw=Object.keys,Sw=(t,e)=>{for(const n in t)e(t[n],n)},Df=t=>kw(t).length,Aw=t=>{for(const e in t)return!1;return!0},Tw=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Rw=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Iw=(t,e)=>t===e||Df(t)===Df(e)&&Tw(t,(n,r)=>(n!==void 0||Rw(e,r))&&e[r]===n),xw=Object.freeze,Bf=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Bf(t[e])}return xw(t)},ul=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&ul(t,e,n+1)}},Ow=t=>t,Cw=(t,e)=>e.includes(t);var Ff={};const bs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Dn;const Nw=()=>{if(Dn===void 0)if(bs){Dn=Sn();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Dn.set(e,""),e=r):e!==null&&(Dn.set(e,r),e=null)}e!==null&&Dn.set(e,"")}else typeof location=="object"?(Dn=Sn(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Dn.set(`--${Af(e,"-")}`,n),Dn.set(`-${Af(e,"-")}`,n)}})):Dn=Sn();return Dn},hl=t=>Nw().has(t),Bo=t=>Uf(bs?Ff[t.toUpperCase().replaceAll("-","_")]:vw.getItem(t)),$f=t=>hl("--"+t)||Bo(t)!==null;$f("production");const Lw=bs&&Cw(Ff.FORCE_COLOR,["true","1","2"])||!hl("--no-colors")&&!$f("no-color")&&(!bs||process.stdout.isTTY)&&(!bs||hl("--color")||Bo("COLORTERM")!==null||(Bo("TERM")||"").includes("color")),Mw=t=>new Uint8Array(t),Uw=t=>{const e=Mw(t.byteLength);return e.set(t),e};class Pw{constructor(e,n){this.left=e,this.right=n}}const ar=(t,e)=>new Pw(t,e);typeof DOMParser<"u"&&new DOMParser;const Dw=t=>Wb(t,(e,n)=>`${n}:${e};`).join(""),cr=Symbol,zf=cr(),jf=cr(),Bw=cr(),Fw=cr(),$w=cr(),Wf=cr(),zw=cr(),fl=cr(),jw=cr(),Ww=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Gw={[zf]:ar("font-weight","bold"),[jf]:ar("font-weight","normal"),[Bw]:ar("color","blue"),[$w]:ar("color","green"),[Fw]:ar("color","grey"),[Wf]:ar("color","red"),[zw]:ar("color","purple"),[fl]:ar("color","orange"),[jw]:ar("color","black")},Gf=Lw?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Sn();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=Gw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Dw(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:Ww,Hw=(...t)=>{console.log(...Gf(t)),Hf.forEach(e=>e.print(t))},Vw=(...t)=>{console.warn(...Gf(t)),t.unshift(fl),Hf.forEach(e=>e.print(t))},Hf=Ni(),Vf=t=>({[Symbol.iterator](){return this},next:t}),Kw=(t,e)=>Vf(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),dl=(t,e)=>Vf(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class pl{constructor(e,n){this.clock=e,this.len=n}}class ws{constructor(){this.clients=new Map}}const Kf=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];hd(t,s,a.clock,a.len,n)}}),qw=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Mr((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},qf=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&qw(n,e.clock)!==null},ml=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=ni(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},Xw=t=>{const e=new ws;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)Hb(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return ml(e),e},Fo=(t,e,n,r)=>{Nr(t.clients,e,()=>[]).push(new pl(n,r))},Zw=()=>new ws,Jw=t=>{const e=Zw();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new pl(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Pi=(t,e)=>{Se(t.restEncoder,e.clients.size),Lr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Se(t.restEncoder,n);const i=r.length;Se(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},gl=t=>{const e=new ws,n=Ae(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ae(t.restDecoder),s=Ae(t.restDecoder);if(s>0){const o=Nr(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new pl(t.readDsClock(),t.readDsLen()))}}return e},Xf=(t,e,n)=>{const r=new ws,i=Ae(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Ae(t.restDecoder),a=Ae(t.restDecoder),c=n.clients.get(o)||[],l=St(n,o);for(let u=0;u<a;u++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<l){l<d&&Fo(r,o,l,d-l);let f=Tn(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Yo(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Yo(e,p,d-p.id.clock)),p.delete(e))}else Fo(r,o,h,d-h)}}if(r.clients.size>0){const s=new si;return Se(s.restEncoder,0),Pi(s,r),s.toUint8Array()}return null},Zf=Lf;class lr extends Kb{constructor({guid:e=_w(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Zf(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new cd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Mf(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Mf(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ve(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Lr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ve(this,e,n)}get(e,n=it){const r=Nr(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==it&&i!==n)if(i===it){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Bn)}getText(e=""){return this.get(e,Rn)}getMap(e=""){return this.get(e,Fn)}getXmlElement(e=""){return this.get(e,ur)}getXmlFragment(e=""){return this.get(e,$n)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Lr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new lr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ve(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Jf{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ae(this.restDecoder)}readDsLen(){return Ae(this.restDecoder)}}class Yf extends Jf{readLeftID(){return Oe(Ae(this.restDecoder),Ae(this.restDecoder))}readRightID(){return Oe(Ae(this.restDecoder),Ae(this.restDecoder))}readClient(){return Ae(this.restDecoder)}readInfo(){return Mi(this.restDecoder)}readString(){return Ui(this.restDecoder)}readParentInfo(){return Ae(this.restDecoder)===1}readTypeRef(){return Ae(this.restDecoder)}readLen(){return Ae(this.restDecoder)}readAny(){return _s(this.restDecoder)}readBuf(){return Uw(Ut(this.restDecoder))}readJSON(){return JSON.parse(Ui(this.restDecoder))}readKey(){return Ui(this.restDecoder)}}class Yw{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ae(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ae(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Di extends Yw{constructor(e){super(e),this.keys=[],Ae(e),this.keyClockDecoder=new ll(Ut(e)),this.clientDecoder=new Do(Ut(e)),this.leftClockDecoder=new ll(Ut(e)),this.rightClockDecoder=new ll(Ut(e)),this.infoDecoder=new Nf(Ut(e),Mi),this.stringDecoder=new mw(Ut(e)),this.parentInfoDecoder=new Nf(Ut(e),Mi),this.typeRefDecoder=new Do(Ut(e)),this.lenDecoder=new Do(Ut(e))}readLeftID(){return new Bi(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Bi(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return _s(this.restDecoder)}readBuf(){return Ut(this.restDecoder)}readJSON(){return _s(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Qf{constructor(){this.restEncoder=Ur()}toUint8Array(){return An(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Se(this.restEncoder,e)}writeDsLen(e){Se(this.restEncoder,e)}}class vs extends Qf{writeLeftID(e){Se(this.restEncoder,e.client),Se(this.restEncoder,e.clock)}writeRightID(e){Se(this.restEncoder,e.client),Se(this.restEncoder,e.clock)}writeClient(e){Se(this.restEncoder,e)}writeInfo(e){nl(this.restEncoder,e)}writeString(e){Li(this.restEncoder,e)}writeParentInfo(e){Se(this.restEncoder,e?1:0)}writeTypeRef(e){Se(this.restEncoder,e)}writeLen(e){Se(this.restEncoder,e)}writeAny(e){ys(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){Li(this.restEncoder,JSON.stringify(e))}writeKey(e){Li(this.restEncoder,e)}}class ed{constructor(){this.restEncoder=Ur(),this.dsCurrVal=0}toUint8Array(){return An(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Se(this.restEncoder,n)}writeDsLen(e){e===0&&Pn(),Se(this.restEncoder,e-1),this.dsCurrVal+=e}}class si extends ed{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ol,this.clientEncoder=new Uo,this.leftClockEncoder=new ol,this.rightClockEncoder=new ol,this.infoEncoder=new Rf(nl),this.stringEncoder=new hw,this.parentInfoEncoder=new Rf(nl),this.typeRefEncoder=new Uo,this.lenEncoder=new Uo}toUint8Array(){const e=Ur();return Se(e,0),Nt(e,this.keyClockEncoder.toUint8Array()),Nt(e,this.clientEncoder.toUint8Array()),Nt(e,this.leftClockEncoder.toUint8Array()),Nt(e,this.rightClockEncoder.toUint8Array()),Nt(e,An(this.infoEncoder)),Nt(e,this.stringEncoder.toUint8Array()),Nt(e,An(this.parentInfoEncoder)),Nt(e,this.typeRefEncoder.toUint8Array()),Nt(e,this.lenEncoder.toUint8Array()),Mo(e,An(this.restEncoder)),An(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ys(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){ys(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Qw=(t,e,n,r)=>{r=ni(r,e[0].id.clock);const i=Tn(e,r);Se(t.restEncoder,e.length-i),t.writeClient(n),Se(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},yl=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{St(e,s)>i&&r.set(s,i)}),zo(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Se(t.restEncoder,r.size),Lr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Qw(t,e.clients.get(i),i,s)})},ev=(t,e)=>{const n=Sn(),r=Ae(t.restDecoder);for(let i=0;i<r;i++){const s=Ae(t.restDecoder),o=new Array(s),a=t.readClient();let c=Ae(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(Lo&u){case 0:{const h=t.readLen();o[l]=new tn(Oe(a,c),h),c+=h;break}case 10:{const h=Ae(t.restDecoder);o[l]=new cn(Oe(a,c),h),c+=h;break}default:{const h=(u&(or|en))===0,d=new _t(Oe(a,c),null,(u&en)===en?t.readLeftID():null,null,(u&or)===or?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(u&ds)===ds?t.readString():null,Pd(t,u));o[l]=d,c+=d.length}}}}return n},tv=(t,e,n)=>{const r=[];let i=Lr(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new cd,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==cn){const p=Nr(h,u.id.client,()=>St(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,St(e,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new si;return yl(f,a,new Map),Se(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},nv=(t,e)=>yl(t,e.doc.store,e.beforeState),rv=(t,e,n,r=new Di(t))=>Ve(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=ev(r,o),l=tv(i,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<St(a,d)){s=!0;break}if(l){for(const[d,f]of l.missing){const p=u.missing.get(d);(p==null||p>f)&&u.missing.set(d,f)}u.update=Wo([u.update,l.update])}}else a.pendingStructs=l;const h=Xf(r,i,a);if(a.pendingDs){const d=new Di(ii(a.pendingDs));Ae(d.restDecoder);const f=Xf(d,i,a);h&&f?a.pendingDs=Wo([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,td(i.doc,d)}},n,!1),td=(t,e,n,r=Di)=>{const i=ii(e);rv(i,t,n,new r(i))},iv=(t,e,n)=>td(t,e,n,Yf),sv=(t,e,n=new Map)=>{yl(t,e.store,n),Pi(t,Jw(e.store))},ov=(t,e=new Uint8Array([0]),n=new si)=>{const r=nd(e);sv(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(vv(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===vs)return bv(i.map((s,o)=>o===0?s:kv(s)));if(n.constructor===si)return Wo(i)}return i[0]},av=(t,e)=>ov(t,e,new vs),cv=t=>{const e=new Map,n=Ae(t.restDecoder);for(let r=0;r<n;r++){const i=Ae(t.restDecoder),s=Ae(t.restDecoder);e.set(i,s)}return e},nd=t=>cv(new Jf(ii(t))),rd=(t,e)=>(Se(t.restEncoder,e.size),Lr(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Se(t.restEncoder,n),Se(t.restEncoder,r)}),t),lv=(t,e)=>rd(t,zo(e.store)),uv=(t,e=new ed)=>(t instanceof Map?rd(e,t):lv(e,t),e.toUint8Array()),hv=t=>uv(t,new Qf);class fv{constructor(){this.l=[]}}const id=()=>new fv,sd=(t,e)=>t.l.push(e),od=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ad=(t,e,n)=>ul(t.l,[e,n]);class Bi{constructor(e,n){this.client=e,this.clock=n}}const $o=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Oe=(t,e)=>new Bi(t,e),dv=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Pn()},Fi=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!qf(e.ds,t.id),_l=(t,e)=>{const n=Nr(t.meta,_l,Ni),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<St(r,s)&&Dr(t,Oe(s,i))}),Kf(t,e.ds,i=>{}),n.add(e))};class cd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const zo=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},St=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ld=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Pn()}n.push(e)},Tn=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Mr(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Mr((n+r)/2)}throw Pn()},bl=(t,e)=>{const n=t.clients.get(e.client);return n[Tn(n,e.clock)]},wl=(t,e,n)=>{const r=Tn(e,n),i=e[r];return i.id.clock<n&&i instanceof _t?(e.splice(r+1,0,Yo(t,i,n-i.id.clock)),r+1):r},Dr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[wl(t,n,e.clock)]},ud=(t,e,n)=>{const r=e.clients.get(n.client),i=Tn(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==tn&&r.splice(i+1,0,Yo(t,s,n.clock-s.id.clock+1)),s},pv=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Tn(r,e.id.clock)]=n},hd=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=wl(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&wl(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class mv{constructor(e,n,r){this.doc=e,this.deleteSet=new ws,this.beforeState=zo(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const fd=(t,e)=>e.deleteSet.clients.size===0&&!Gb(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ml(e.deleteSet),nv(t,e),Pi(t,e.deleteSet),!0),dd=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Nr(t.changed,e,Ni).add(n)},jo=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof _t&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},gv=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Tn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof _t&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},yv=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=wf(i.length-1,1+Tn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+jo(i,c)}})},pd=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{ml(s),n.afterState=zo(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),ad(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),ul(a,[]),n._needFormattingCleanup&&Dv(n)}finally{r.gc&&gv(s,i,r.gcFilter),yv(s,i),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=i.clients.get(h),p=ni(Tn(f,d),1);for(let m=f.length-1;m>=p;)m-=1+jo(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=i.clients.get(h),p=Tn(f,d);p+1<f.length&&jo(f,p+1)>1||p>0&&jo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Hw(fl,zf,"[yjs] ",jf,Wf,"Changed the client-id because another client seems to be using it."),r.clientID=Zf()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new vs;fd(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new si;fd(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):pd(t,e+1)}}},Ve=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new mv(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&pd(i,0)}}return o};function*_v(t){const e=Ae(t.restDecoder);for(let n=0;n<e;n++){const r=Ae(t.restDecoder),i=t.readClient();let s=Ae(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Ae(t.restDecoder);yield new cn(Oe(i,s),c),s+=c}else if(Lo&a){const c=(a&(or|en))===0,l=new _t(Oe(i,s),null,(a&en)===en?t.readLeftID():null,null,(a&or)===or?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&ds)===ds?t.readString():null,Pd(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new tn(Oe(i,s),c),s+=c}}}}class vl{constructor(e,n){this.gen=_v(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===cn);return this.curr}}class El{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const bv=t=>Wo(t,Yf,vs),wv=(t,e)=>{if(t.constructor===tn){const{client:n,clock:r}=t.id;return new tn(Oe(n,r+e),t.length-e)}else if(t.constructor===cn){const{client:n,clock:r}=t.id;return new cn(Oe(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new _t(Oe(r,i+e),null,Oe(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Wo=(t,e=Di,n=si)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(ii(u)));let i=r.map(u=>new vl(u,!0)),s=null;const o=new n,a=new El(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===cn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Br(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===cn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Br(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new cn(Oe(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===cn?s.struct.length-=p:d=wv(d,p)),s.struct.mergeWith(d)||(Br(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==cn;d=u.next())Br(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Br(a,s.struct,s.offset),s=null),kl(a);const c=r.map(u=>gl(u)),l=Xw(c);return Pi(o,l),o.toUint8Array()},vv=(t,e,n=Di,r=si)=>{const i=nd(e),s=new r,o=new El(s),a=new n(ii(t)),c=new vl(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=i.get(h)||0;if(c.curr.constructor===cn){c.next();continue}if(u.id.clock+u.length>d)for(Br(o,u,ni(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Br(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}kl(o);const l=gl(a);return Pi(s,l),s.toUint8Array()},md=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:An(t.encoder.restEncoder)}),t.encoder.restEncoder=Ur(),t.written=0)},Br=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&md(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Se(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},kl=t=>{md(t);const e=t.encoder.restEncoder;Se(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Se(e,r.written),Mo(e,r.restEncoder)}},Ev=(t,e,n,r)=>{const i=new n(ii(t)),s=new vl(i,!1),o=new r,a=new El(o);for(let l=s.curr;l!==null;l=s.next())Br(a,e(l),0);kl(a);const c=gl(i);return Pi(o,c),o.toUint8Array()},kv=t=>Ev(t,Ow,Di,vs),gd="You must not compute changes after the event-handler fired.";class Go{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Sv(this.currentTarget,this.target))}deletes(e){return qf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(gd);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Yc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Yc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Yc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(gd);const n=this.target,r=Ni(),i=Ni(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const Sv=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Lt=()=>{Vw("Invalid access: Add Yjs type to a document before reading data.")},yd=80;let Sl=0;class Av{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Sl++}}const Tv=t=>{t.timestamp=Sl++},_d=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Sl++},Rv=(t,e,n)=>{if(t.length>=yd){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return _d(r,e,n),r}else{const r=new Av(e,n);return t.push(r),r}},Ho=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>No(e-s.index)<No(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Tv(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&No(n.index-i)<r.parent.length/yd?(_d(n,r,i),n):Rv(t._searchMarker,r,i)},Es=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=ni(e,i.index+n))}},Vo=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Nr(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;ad(r._eH,n,e)};class it{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=id(),this._dEH=id(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Un()}clone(){throw Un()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){sd(this._eH,e)}observeDeep(e){sd(this._dEH,e)}unobserve(e){od(this._eH,e)}unobserveDeep(e){od(this._dEH,e)}toJSON(){}}const bd=(t,e,n)=>{t.doc??Lt(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},wd=t=>{t.doc??Lt();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},ks=(t,e)=>{let n=0,r=t._start;for(t.doc??Lt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},vd=(t,e)=>{const n=[];return ks(t,(r,i)=>{n.push(e(r,i,t))}),n},Iv=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Ed=(t,e)=>{t.doc??Lt();const n=Ho(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ko=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new _t(Oe(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ci(l)),i.integrate(t,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new _t(Oe(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ss(new Uint8Array(h))),i.integrate(t,0);break;case lr:i=new _t(Oe(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ts(h)),i.integrate(t,0);break;default:if(h instanceof it)i=new _t(Oe(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new hr(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},kd=()=>Pr("Length exceeded!"),Sd=(t,e,n,r)=>{if(n>e._length)throw kd();if(n===0)return e._searchMarker&&Es(e._searchMarker,n,r.length),Ko(t,e,null,r);const i=n,s=Ho(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Dr(t,Oe(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Es(e._searchMarker,i,r.length),Ko(t,e,o,r)},xv=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Ko(t,e,i,n)},Ad=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Ho(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Dr(t,Oe(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Dr(t,Oe(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw kd();e._searchMarker&&Es(e._searchMarker,i,-s+r)},qo=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Al=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new ci([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ci([r]);break;case Uint8Array:a=new Ss(r);break;case lr:a=new Ts(r);break;default:if(r instanceof it)a=new hr(r);else throw new Error("Unexpected content type")}new _t(Oe(o,St(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Tl=(t,e)=>{t.doc??Lt();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Td=t=>{const e={};return t.doc??Lt(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Rd=(t,e)=>{t.doc??Lt();const n=t._map.get(e);return n!==void 0&&!n.deleted},Ov=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Fi(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Xo=t=>(t.doc??Lt(),Kw(t._map.entries(),e=>!e[1].deleted));class Cv extends Go{}class Bn extends it{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Bn;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bn}clone(){const e=new Bn;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??Lt(),this._length}_callObserver(e,n){super._callObserver(e,n),Vo(this,e,new Cv(this,e))}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Sd(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ve(this.doc,n=>{xv(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Ad(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Ed(this,e)}toArray(){return wd(this)}slice(e=0,n=this.length){return bd(this,e,n)}toJSON(){return this.map(e=>e instanceof it?e.toJSON():e)}map(e){return vd(this,e)}forEach(e){ks(this,e)}[Symbol.iterator](){return Iv(this)}_write(e){e.writeTypeRef(nE)}}const Nv=t=>new Bn;class Lv extends Go{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Fn extends it{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Fn}clone(){const e=new Fn;return this.forEach((n,r)=>{e.set(r,n instanceof it?n.clone():n)}),e}_callObserver(e,n){Vo(this,e,new Lv(this,e,n))}toJSON(){this.doc??Lt();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof it?i.toJSON():i}}),e}get size(){return[...Xo(this)].length}keys(){return dl(Xo(this),e=>e[0])}values(){return dl(Xo(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return dl(Xo(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Lt(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Tl(this,e)}has(e){return Rd(this,e)}clear(){this.doc!==null?Ve(this.doc,e=>{this.forEach(function(n,r,i){qo(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(rE)}}const Mv=t=>new Fn,Fr=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Iw(t,e);class Rl{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Pn(),this.right.content.constructor){case yt:this.right.deleted||$i(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Id=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case yt:e.right.deleted||$i(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Dr(t,Oe(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Zo=(t,e,n,r)=>{const i=new Map,s=r?Ho(e,n):null;if(s){const o=new Rl(s.p.left,s.p,s.index,i);return Id(t,o,n-s.index)}else{const o=new Rl(null,e._start,0,i);return Id(t,o,n)}},xd=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===yt&&Fr(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new _t(Oe(s,St(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new yt(a,o));u.integrate(t,0),n.right=u,n.forward()})},$i=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Od=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===yt&&Fr(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Cd=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Fr(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new _t(Oe(s,St(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new yt(a,c)),n.right.integrate(t,0),n.forward()}}return o},Il=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;Od(n,i);const a=Cd(t,e,n,i),c=r.constructor===String?new zn(r):r instanceof it?new hr(r):new ai(r);let{left:l,right:u,index:h}=n;e._searchMarker&&Es(e._searchMarker,n.index,c.getLength()),u=new _t(Oe(o,St(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),xd(t,e,n,a)},Nd=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Od(n,i);const a=Cd(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===yt));){if(!n.right.deleted)switch(n.right.content.constructor){case yt:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Fr(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Dr(t,Oe(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new _t(Oe(o,St(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new zn(c)),n.right.integrate(t,0),n.forward()}xd(t,e,n,a)},Ld=(t,e,n,r,i)=>{let s=e;const o=Sn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===yt){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case yt:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(t),a++,!c&&(i.get(u)??null)===h&&d!==h&&(d===null?i.delete(u):i.set(u,d))),!c&&!e.deleted&&$i(i,l);break}}}e=e.right}return a},Uv=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===yt){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Pv=t=>{let e=0;return Ve(t.doc,n=>{let r=t._start,i=t._start,s=Sn();const o=Jc(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case yt:$i(o,i.content);break;default:e+=Ld(n,r,i,s,o),s=Jc(o),r=i;break}i=i.right}}),e},Dv=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&hd(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===yt&&o.constructor!==tn&&e.add(o.parent)})}Ve(n,r=>{Kf(t,t.deleteSet,i=>{if(i instanceof tn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===yt?e.add(s):Uv(r,i)});for(const i of e)Pv(i)})},Md=(t,e,n)=>{const r=n,i=Jc(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case hr:case ai:case zn:n<e.right.length&&Dr(t,Oe(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Ld(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Es(o._searchMarker,e.index,-r+n),e};class Bv extends Go{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ve(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Aw(c)||(f.attributes=Ew({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case hr:case ai:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case zn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case yt:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Fr(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Fr(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Fr(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Fr(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),$i(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Rn extends it{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Lt(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Rn}clone(){const e=new Rn;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Bv(this,e,n);Vo(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Lt();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===zn&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ve(this.doc,r=>{const i=new Rl(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Il(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Nd(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Md(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Lt();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(Fi(c,e)||n!==void 0&&Fi(c,n))switch(c.content.constructor){case zn:{const h=s.get("ychange");e!==void 0&&!Fi(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Fi(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case hr:case ai:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case yt:Fi(c,e)&&(l(),$i(s,c.content));break}c=c.right}l()};return e||n?Ve(o,h=>{e&&_l(h,e),n&&_l(h,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Il(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!r);Il(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ve(r,i=>{Md(i,Zo(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!1);o.right!==null&&Nd(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Tl(this,e)}getAttributes(){return Td(this)}_write(e){e.writeTypeRef(iE)}}const Fv=t=>new Rn;class xl{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Lt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ur||n.constructor===$n)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $n extends it{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??Lt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new xl(this,e)}querySelector(e){e=e.toUpperCase();const r=new xl(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Lr(new xl(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Vo(this,e,new jv(this,n,e))}toString(){return vd(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),ks(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Sd(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ve(this.doc,r=>{const i=e&&e instanceof it?e._item:e;Ko(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Pr("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Ad(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return wd(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Ed(this,e)}slice(e=0,n=this.length){return bd(this,e,n)}forEach(e){ks(this,e)}_write(e){e.writeTypeRef(oE)}}const $v=t=>new $n;class ur extends $n{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ur(this.nodeName)}clone(){const e=new ur(this.nodeName),n=this.getAttributes();return Sw(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof it?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Al(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Tl(this,e)}hasAttribute(e){return Rd(this,e)}getAttributes(e){return e?Ov(this,e):Td(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ks(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(sE),e.writeKey(this.nodeName)}}const zv=t=>new ur(t.readKey());class jv extends Go{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class zi extends Fn{constructor(e){super(),this.hookName=e}_copy(){return new zi(this.hookName)}clone(){const e=new zi(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(aE),e.writeKey(this.hookName)}}const Wv=t=>new zi(t.readKey());class oi extends Rn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new oi}clone(){const e=new oi;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(cE)}}const Gv=t=>new oi;class Ol{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Un()}mergeWith(e){return!1}write(e,n,r){throw Un()}integrate(e,n){throw Un()}}const Hv=0;class tn extends Ol{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ld(e.doc.store,this)}write(e,n){e.writeInfo(Hv),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ss{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ss(this.content)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Vv=t=>new Ss(t.readBuf());class As{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new As(this.len)}splice(e){const n=new As(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Fo(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Kv=t=>new As(t.readLen()),Ud=(t,e)=>new lr({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Ts{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ts(Ud(this.doc.guid,this.opts))}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const qv=t=>new Ts(Ud(t.readString(),t.readAny()));class ai{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ai(this.embed)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Xv=t=>new ai(t.readJSON());class yt{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new yt(this.key,this.value)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Zv=t=>new yt(t.readKey(),t.readJSON());class Jo{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Jo(this.arr)}splice(e){const n=new Jo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Jv=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Jo(n)},Yv=Bo("node_env")==="development";class ci{constructor(e){this.arr=e,Yv&&Bf(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ci(this.arr)}splice(e){const n=new ci(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const Qv=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new ci(n)};class zn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new zn(this.str)}splice(e){const n=new zn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const eE=t=>new zn(t.readString()),tE=[Nv,Mv,Fv,zv,$v,Wv,Gv],nE=0,rE=1,iE=2,sE=3,oE=4,aE=5,cE=6;class hr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new hr(this.type._copy())}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const lE=t=>new hr(tE[t.readTypeRef()](t)),Yo=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new _t(Oe(r,i+n),e,Oe(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Oe(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class _t extends Ol{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?kf:0}set marker(e){(this.info&el)>0!==e&&(this.info^=el)}get marker(){return(this.info&el)>0}get keep(){return(this.info&Ef)>0}set keep(e){this.keep!==e&&(this.info^=Ef)}get countable(){return(this.info&kf)>0}get deleted(){return(this.info&Qc)>0}set deleted(e){this.deleted!==e&&(this.info^=Qc)}markDeleted(){this.info|=Qc}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Bi&&this.id.client!==this.parent.client&&this.parent.clock>=St(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ud(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Dr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===tn||this.right&&this.right.constructor===tn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===_t&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===_t&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Bi){const r=bl(n,this.parent);r.constructor===tn?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=ud(e,e.doc.store,Oe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),$o(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if($o(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(bl(e.doc.store,i.origin)))s.has(bl(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ld(e.doc.store,this),this.content.integrate(e,this),dd(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new tn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Oe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&$o(e.origin,this.lastId)&&this.right===e&&$o(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Fo(e.deleteSet,this.id.client,this.id.clock,this.length),dd(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Pn();this.content.gc(e),n?pv(e,this,new tn(this.id,this.length)):this.content=new As(this.length)}write(e,n){const r=n>0?Oe(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Lo|(r===null?0:en)|(i===null?0:or)|(s===null?0:ds);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=dv(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Bi?(e.writeParentInfo(!1),e.writeLeftID(a)):Pn();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Pd=(t,e)=>uE[e&Lo](t),uE=[()=>{Pn()},Kv,Jv,Vv,eE,Xv,Zv,lE,Qv,qv,()=>{Pn()}],hE=10;class cn extends Ol{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Pn()}write(e,n){e.writeInfo(hE),Se(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Dd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Bd="__ $YJS$ __";Dd[Bd]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Dd[Bd]=!0;let Cl,Nl,fE=t=>t();function dE(t,e){if(Nl)return Nl(t,e);fE(t)}function li(t,e,n){if(Cl)return Cl.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function pE(t){Cl=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},Nl=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const Fd=new WeakSet;function mE(t){if(Fd.has(t))return t;Fd.add(t);let e;const n=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=li("map",()=>{t.observe(h)},()=>{t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function i(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=li(h+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const d=t[h];t[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=t,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,h,f)}function c(h,d){let f=t,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(h){this._disableTracking=!0;const d=l.call(this,h);return this._disableTracking=!1,d};const u=t.slice;return t.slice=function(h,d){this._disableTracking=!0;const f=u.call(this,h,d);return this._disableTracking=!1,f},t}const $d=new WeakSet;function gE(t){if($d.has(t))return t;$d.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=li("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Qo(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=dE(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const zd=new WeakSet;function yE(t){if(zd.has(t))return t;zd.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=li("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=li(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const jd=new WeakSet;function Wd(t){if(jd.has(t))return t;jd.add(t);let e;const n=i=>{e.reportChanged()};e=li("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const Gd=new WeakSet;function Hd(t){if(Gd.has(t))return t;Gd.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=li("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function Qo(t){return t instanceof oi||t instanceof Rn?Wd(t):t instanceof Bn?mE(t):t instanceof Fn?yE(t):t instanceof lr||Object.prototype.hasOwnProperty.call(t,"autoLoad")?gE(t):t instanceof $n||t instanceof ur?Hd(t):t}function Vd(t){t.share.forEach(e=>{e.constructor!==it&&Qo(e)})}function Kd(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof tn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof it&&Qo(s)})}}}const qd=new WeakSet;function _E(t){qd.has(t)||(qd.add(t),Qo(t),t.store.clients.forEach(e=>{e&&Kd(e,0)}),Vd(t),t.on("beforeObserverCalls",e=>{Vd(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=Tn(s,i);Kd(s,o)}})}))}class Rs{constructor(e){this.value=void 0,this.value=e}}function bE(t){return ArrayBuffer.isView(t)?new Rs(t):new Rs(Object.freeze(t))}function wE(t){const e=function(){var a;let c=(a=this[an])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const h=ea(u,c);return c&&typeof h=="object"?fs(h,c):h})},n=function(a){return a.map(c=>{const l=Ll(c);let u=ui(l)||l;if(u instanceof Rs&&(u=u.value),u instanceof it&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>AE(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function Is(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function Xd(t,e=new Bn){if(e[gt])throw new Error("unexpected");const n=wE(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Is(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Is(s);if(a===ta)return e;if(typeof a=="number"){let u;if(o&&o[an]){var c;u=(c=o[an])==null?void 0:c.implicitObserver,e._implicitObserver=u}let h=e.get(a);return h=ea(h,u),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Is(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=Is(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Is(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function Zd(t,e=new Fn){if(e[gt])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Ll(s);let a=ui(o)||o;if(a instanceof Rs&&(a=a.value),a instanceof it&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===ta)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[an]){var a;o=(a=s[an])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=ea(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});xs.set(e,n);for(let r in t)n[r]=t[r];return n}function vE(t){return t instanceof it}const xs=new WeakMap;function ea(t,e){if(vE(t)){if(t._implicitObserver=e,t instanceof Bn||t instanceof Fn){if(!xs.has(t)){const n=Ll(t);xs.set(t,n)}t=xs.get(t)}else if(t instanceof ur||t instanceof $n||t instanceof oi||t instanceof zi||t instanceof Rn)Xc(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return bE(t)}return t}function Ll(t){if(t==null)return t;if(t=ui(t)||t,t instanceof Bn)return Xd([],t);if(t instanceof Fn)return Zd({},t);if(typeof t=="string")return t;if(Array.isArray(t))return Xd(t);if(t instanceof ur||t instanceof $n||t instanceof oi||t instanceof zi)return t;if(t instanceof Rn)return t;if(typeof t=="object")return t instanceof Rs?t:Zd(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function EE(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function Jd(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function kE(t,e){if(t[gt])throw new Error("unexpected");EE(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===ta)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[an]){var a;o=(a=s[an])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))Jd(t,e,u);return Reflect.get(t,i)}let c=Jd(t,e,i);return c=ea(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return xs.set(t,n),n}pE(jb);const ta=Symbol("INTERNAL_SYMBOL");function Yd(t,e){const n=ui(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof lr?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function SE(t){const e=ui(t);if(!(e instanceof lr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function ui(t){if(typeof t!="object"||t===null)return;const e=t[ta];return e&&(Xc(e),e.__v_skip=!0),e}function AE(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=ui(t),r=ui(e);return!n||!r?!1:n===r}return!1}function TE(t,e=new lr){return _E(e),kE(e,t)}var Te={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Os=Symbol.for("react.element"),RE=Symbol.for("react.portal"),IE=Symbol.for("react.fragment"),xE=Symbol.for("react.strict_mode"),OE=Symbol.for("react.profiler"),CE=Symbol.for("react.provider"),NE=Symbol.for("react.context"),LE=Symbol.for("react.forward_ref"),ME=Symbol.for("react.suspense"),UE=Symbol.for("react.memo"),PE=Symbol.for("react.lazy"),Qd=Symbol.iterator;function DE(t){return t===null||typeof t!="object"?null:(t=Qd&&t[Qd]||t["@@iterator"],typeof t=="function"?t:null)}var ep={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tp=Object.assign,np={};function ji(t,e,n){this.props=t,this.context=e,this.refs=np,this.updater=n||ep}ji.prototype.isReactComponent={},ji.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},ji.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function rp(){}rp.prototype=ji.prototype;function Ml(t,e,n){this.props=t,this.context=e,this.refs=np,this.updater=n||ep}var Ul=Ml.prototype=new rp;Ul.constructor=Ml,tp(Ul,ji.prototype),Ul.isPureReactComponent=!0;var ip=Array.isArray,sp=Object.prototype.hasOwnProperty,Pl={current:null},op={key:!0,ref:!0,__self:!0,__source:!0};function ap(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)sp.call(e,r)&&!op.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Os,type:t,key:s,ref:o,props:i,_owner:Pl.current}}function BE(t,e){return{$$typeof:Os,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dl(t){return typeof t=="object"&&t!==null&&t.$$typeof===Os}function FE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var cp=/\/+/g;function Bl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?FE(""+t.key):e.toString(36)}function na(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Os:case RE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Bl(o,0):r,ip(i)?(n="",t!=null&&(n=t.replace(cp,"$&/")+"/"),na(i,e,n,"",function(l){return l})):i!=null&&(Dl(i)&&(i=BE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(cp,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",ip(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Bl(s,a);o+=na(s,e,n,c,i)}else if(c=DE(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Bl(s,a++),o+=na(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ra(t,e,n){if(t==null)return t;var r=[],i=0;return na(t,r,"","",function(s){return e.call(n,s,i++)}),r}function $E(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Pt={current:null},ia={transition:null},zE={ReactCurrentDispatcher:Pt,ReactCurrentBatchConfig:ia,ReactCurrentOwner:Pl};function lp(){throw Error("act(...) is not supported in production builds of React.")}Te.Children={map:ra,forEach:function(t,e,n){ra(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ra(t,function(){e++}),e},toArray:function(t){return ra(t,function(e){return e})||[]},only:function(t){if(!Dl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Te.Component=ji,Te.Fragment=IE,Te.Profiler=OE,Te.PureComponent=Ml,Te.StrictMode=xE,Te.Suspense=ME,Te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zE,Te.act=lp,Te.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=tp({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Pl.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)sp.call(e,c)&&!op.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Os,type:t.type,key:i,ref:s,props:r,_owner:o}},Te.createContext=function(t){return t={$$typeof:NE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:CE,_context:t},t.Consumer=t},Te.createElement=ap,Te.createFactory=function(t){var e=ap.bind(null,t);return e.type=t,e},Te.createRef=function(){return{current:null}},Te.forwardRef=function(t){return{$$typeof:LE,render:t}},Te.isValidElement=Dl,Te.lazy=function(t){return{$$typeof:PE,_payload:{_status:-1,_result:t},_init:$E}},Te.memo=function(t,e){return{$$typeof:UE,type:t,compare:e===void 0?null:e}},Te.startTransition=function(t){var e=ia.transition;ia.transition={};try{t()}finally{ia.transition=e}},Te.unstable_act=lp,Te.useCallback=function(t,e){return Pt.current.useCallback(t,e)},Te.useContext=function(t){return Pt.current.useContext(t)},Te.useDebugValue=function(){},Te.useDeferredValue=function(t){return Pt.current.useDeferredValue(t)},Te.useEffect=function(t,e){return Pt.current.useEffect(t,e)},Te.useId=function(){return Pt.current.useId()},Te.useImperativeHandle=function(t,e,n){return Pt.current.useImperativeHandle(t,e,n)},Te.useInsertionEffect=function(t,e){return Pt.current.useInsertionEffect(t,e)},Te.useLayoutEffect=function(t,e){return Pt.current.useLayoutEffect(t,e)},Te.useMemo=function(t,e){return Pt.current.useMemo(t,e)},Te.useReducer=function(t,e,n){return Pt.current.useReducer(t,e,n)},Te.useRef=function(t){return Pt.current.useRef(t)},Te.useState=function(t){return Pt.current.useState(t)},Te.useSyncExternalStore=function(t,e,n){return Pt.current.useSyncExternalStore(t,e,n)},Te.useTransition=function(){return Pt.current.useTransition()},Te.version="18.3.1";const Fl=0,up=1,hp=2,jE=(t,e)=>{Se(t,Fl);const n=hv(e);Nt(t,n)},fp=(t,e,n)=>{Se(t,up),Nt(t,av(e,n))},WE=(t,e,n)=>fp(e,n,Ut(t)),dp=(t,e,n)=>{try{iv(e,Ut(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},GE=(t,e)=>{Se(t,hp),Nt(t,e)},HE=dp,VE=(t,e,n,r)=>{const i=Ae(t);switch(i){case Fl:WE(t,e,n);break;case up:dp(t,n,r);break;case hp:HE(t,n,r);break;default:throw new Error("Unknown message type")}return i};function Dt(t,e,n,r){const i=r??"";return _e.emit(`error:${e}`,t,n,i),pk(t,n,i)}function KE(t,e){_e.emit("broadcast:createsession",t,void 0,e)}function qE(t,e){_e.emit("broadcast:closesession",t,void 0,e)}function XE(t,e,n){_e.emit("broadcast:startstream",t,e,n)}function ZE(t,e){_e.emit("broadcast:stopstream",t,void 0,e)}function JE(t,e,n){_e.emit("chat:connect",t,e,n)}function YE(t,e){_e.emit("chat:disconnect",t,void 0,e)}function QE(t,e,n){_e.emit("gadgetclient:reset",t,e,n)}function ek(t,e,n){_e.emit("gadgetclient:patch",t,e,n)}function tk(t,e){_e.emit("gadgetserver:clearplayer",t,void 0,e)}function nk(t,e){_e.emit("peer:joincode",t,void 0,e)}function rk(t,e){_e.emit("started",t,void 0,e)}function ik(t,e,n,r){_e.emit("register:flush",t,[e,n],r)}function sk(t,e){_e.emit("register:dev",t,void 0,e)}function ok(t,e){_e.emit("register:share",t,void 0,e)}function ak(t,e){_e.emit("register:nuke",t,void 0,e)}function ck(t,e,n){_e.emit("synth:tts",t,[e,n])}function lk(t,e,n){_e.emit("synth:play",t,[e,n])}function uk(t,e,n){_e.emit("synth:mainvolume",t,e,n)}function hk(t,e,n){_e.emit("synth:drumvolume",t,e,n)}function fk(t,e,n){_e.emit("synth:ttsvolume",t,e,n)}function $l(t,e,n,r){_e.emit("synth:voice",t,[e,n,r])}function dk(t,e,n,r,i){_e.emit("synth:voicefx",t,[e,n,r,i])}function In(t,...e){return _e.emit("tape:info",t,e),!0}function pp(t,...e){return _e.emit("tape:debug",t,e),!0}function pk(t,...e){return _e.emit("tape:error",t,e),!1}function mk(t,e,n,r,i,s){_e.emit("tape:editor:open",t,[e,n,r,i],s)}function gk(t,e){_e.emit("vm:login",t,void 0,e)}function yk(t,e){_e.emit("vm:endgame",t,void 0,e)}function mp(t,e){return`${t}${e}`}function zl(t,e,n){_e.emit("vm:flush",t,e,n)}const fr=TE({shared:[]});function sa(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function JM(t){}function gp(t,e,n){const r=sa(fr.shared,t,e);k(r)||fr.shared.push({key:t,type:e,value:n})}function _k(t,e){gp(t,0,e)}function yp(t,e){const n=new Rn(e);gp(t,1,n)}function bk(t,e){const n=sa(fr.shared,t,0);if(k(n)){n.value=e;return}fr.shared.push({key:t,type:0,value:e})}function wk(t,e){const n=new Rn(e),r=sa(fr.shared,t,1);if(k(r)){r.value=n;return}fr.shared.push({key:t,type:1,value:n})}function _p(t,e,n){let r;function i(){const o=sa(fr.shared,t,e);k(o)&&(s(),r=Yd(o,()=>n(o.value)))}const s=Yd(fr.shared,i);return i(),()=>r==null?void 0:r()}function vk(t,e){return _p(t,0,e)}function bp(t,e){return _p(t,1,n=>e(n.toJSON()))}function oa(t){return An(t)}const $r=SE(fr),jn=cs("modem",["second"],t=>{switch(t.target){case"second":break;case"join":if(t.sender!==jn.id()){jn.reply(t,"joinack");const e=Ur();jE(e,$r),jn.reply(t,"sync",oa(e));const n=Ur();fp(n,$r),jn.reply(t,"sync",oa(n))}break;case"joinack":t.sender,jn.id();break;case"sync":{if(t.sender!==jn.id()&&k(t.data))try{const e=ii(t.data),n=Ur();VE(e,n,$r,jn)===Fl&&jn.emit("modem:sync",oa(n))}catch(e){Dt(jn.name(),"sync",e.message)}break}}});function wp(t){const e=Ur();GE(e,t),jn.emit("modem:sync",oa(e))}$r.on("update",wp),$r.on("destroy",()=>{$r==null||$r.off("update",wp)});const Ek=8,kk=14;function aa(t,e){return new Array(t).fill(e)}function vp(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:aa(s,0),color:aa(s,0),bg:aa(s,i)}}function Sk(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Le.ONCLEAR}}function Ak(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function Tk(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:aa(s,i)}}function Rk(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var ln=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(ln||{});const Ik={start:0,left:1,right:2,top:3,bottom:4,scroll:5},xk={0:1,1:20,2:20,3:1,4:1,5:40};function Ep(t,e){return`${t}:${e}`}const Ok=1,Ck=16,Nk=256;var Bt=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Bt||{});const zr={};function jl(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function kp(t){t.text=[],Object.values(zr[t.id]??{}).forEach(e=>e==null?void 0:e()),zr[t.id]={}}function Sp(t){const e=t.panels.find(n=>n.name===t.focus);if(!e){const n={id:at(),name:t.focus,edge:ln.RIGHT,size:20,text:[]};return t.panels.push(n),t.reset=!1,n}return e}const Lk=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),Mk=new Set(["rn","range","sl","select","nm","number","tx","text"]),Uk=new Set(["tx","text"]),Pk={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},Wl={};let Ap=t=>{let e=Wl[t];return k(e)||(Wl[t]=e=jl()),e};function Dk(t){Ap=t}function hi(t){return Ap(t)}function Bk(t){const e=hi(t);e.panels=e.panels.filter(n=>n.edge!==ln.SCROLL)}function Fk(t,e,n){Object.values(zr).forEach(r=>{if(r[e]!==void 0){const i=Ep(t.id(),e);Ee(n)&&bk(i,n),ke(n)&&wk(i,n)}})}function $k(t){let e="";const n=hi(t);return n.panels=n.panels.filter(r=>{if(r.edge===ln.SCROLL){const[i]=r.text;return ke(i)&&r.text.length===1&&(e=i),r.text.length>1}return!0}),e}function Gl(t,e,n,r,i){const s=hi(t),o=r,a=i??Nb.capital(e),c=s.panels.find(l=>l.name===a);if(c)s.reset=!0,s.focus=a,Ee(o)&&(c.size=o);else switch(n){case ln.START:{Wl[t]=jl();break}case ln.LEFT:case ln.RIGHT:case ln.TOP:case ln.BOTTOM:case ln.SCROLL:{const l={id:at(),name:a,edge:n,size:o??xk[n],text:[]};s.panels.push(l),s.focus=a;break}}}function zk(t,e){const n=hi(t),r=Sp(n);n.reset&&(n.reset=!1,kp(r)),r.text.push(e)}function jk(t,e,n,r,i){const s=hi(t),o=Sp(s);s.reset&&(s.reset=!1,kp(o));const a=Pe(r),c=[e.id(),n,...Lk.has(a)?[a]:["hyperlink",r],...i],l=c[2];if(Mk.has(l)){const u=`${c[3]??""}`;zr[o.id]=zr[o.id]??{};const h=e.get(u)??Pk[l];if(zr[o.id][u]===void 0){const d=Ep(e.id(),u);Ee(h)&&_k(d,h),ke(h)&&yp(d,h),Uk.has(l)?zr[o.id][u]=bp(d,f=>{k(f)&&f!==e.get(u)&&e.set(u,f)}):zr[o.id][u]=vk(d,f=>{k(f)&&f!==e.get(u)&&e.set(u,f)})}}o.text.push(c)}var Tp={exports:{}},Hl={exports:{}},Rp;function Wk(){return Rp||(Rp=1,function(t,e){(function(n,r){t.exports=r()})(Mt,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:w?w+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},h.fromString=function(b){var _=b.indexOf("("),w=b.lastIndexOf(")"),v=b.substring(0,_),A=b.substring(_+1,w).split(","),C=b.substring(w+1);if(C.indexOf("@")===0)var T=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),I=T[1],$=T[2],L=T[3];return new h({functionName:v,args:A||void 0,fileName:I,lineNumber:$||void 0,columnNumber:L||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return h})}(Hl)),Hl.exports}(function(t,e){(function(n,r){t.exports=r(Wk())})(Mt,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var p=l.exec(u[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Tp);var Gk=Tp.exports,Hk=Oi(Gk);const Wn=!!JSON.parse("false"),Vk=!!JSON.parse("false");JSON.parse("false");const Kk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const dr={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Ek*dr.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return kk*dr.DRAW_CHAR_SCALE}};function pr(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}var Ip={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Mt,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Ip);var qk=Ip.exports,Xk=Oi(qk);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const xp="170",Zk="",ca="srgb",Op="srgb-linear",Cp="linear",Vl="srgb";function Jk(t,e,n){return Math.max(e,Math.min(n,t))}class Cs{constructor(e=0,n=0){Cs.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Jk(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ns{constructor(e,n,r,i,s,o,a,c,l){Ns.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],b=i[3],_=i[6],w=i[1],v=i[4],A=i[7],C=i[2],T=i[5],I=i[8];return s[0]=o*m+a*w+c*C,s[3]=o*b+a*v+c*T,s[6]=o*_+a*A+c*I,s[1]=l*m+u*w+h*C,s[4]=l*b+u*v+h*T,s[7]=l*_+u*A+h*I,s[2]=d*m+f*w+p*C,s[5]=d*b+f*v+p*T,s[8]=d*_+f*A+p*I,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*s,f=l*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(u*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=f*m,e[7]=(r*c-l*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(Kl.makeScale(e,n)),this}rotate(e){return this.premultiply(Kl.makeRotation(-e)),this}translate(e,n){return this.premultiply(Kl.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Kl=new Ns,Yk={enabled:!0,workingColorSpace:Op,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===Vl&&(t.r=ql(t.r),t.g=ql(t.g),t.b=ql(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Vl&&(t.r=Xl(t.r),t.g=Xl(t.g),t.b=Xl(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Zk?Cp:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function ql(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Xl(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const Np=[.64,.33,.3,.6,.15,.06],Lp=[.2126,.7152,.0722],Mp=[.3127,.329],Up=new Ns().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Pp=new Ns().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Yk.define({[Op]:{primaries:Np,whitePoint:Mp,transfer:Cp,toXYZ:Up,fromXYZ:Pp,luminanceCoefficients:Lp,workingColorSpaceConfig:{unpackColorSpace:ca},outputColorSpaceConfig:{drawingBufferColorSpace:ca}},[ca]:{primaries:Np,whitePoint:Mp,transfer:Vl,toXYZ:Up,fromXYZ:Pp,luminanceCoefficients:Lp,outputColorSpaceConfig:{drawingBufferColorSpace:ca}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xp),new Cs,new Cs;function Gn(t,e,n){return Math.max(e,Math.min(n,t))}const Qk=Xk("089fad0j9awfem09wavefc09uwaef");function e1(){return Qk()}function Ls(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(e1()*i)}function Zl(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function t1(t){return t[Ls(0,t.length-1)]}function mr(...t){return t1(t.flat())}function n1(t){return[...new Set(t)].filter(k)}function gr(t){return k(t)&&k(t.x)&&k(t.y)}function At(t,e){switch(e){case ce.NORTH:--t.y;break;case ce.SOUTH:++t.y;break;case ce.WEST:--t.x;break;case ce.EAST:++t.x;break}return t}function Wi(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return ce.WEST;if(n>0)return ce.EAST;if(r<0)return ce.NORTH;if(r>0)return ce.SOUTH}const Dp={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function yr(t){return Ge(t)&&Bp(t[0])}function Bp(t){return k(ce[t])&&ke(t)}function r1(t){const e=ce[t];return k(e)?e:ce.IDLE}function Fp(t){if(ke(t))return Dp[Pe(t)]}function $p(t){if(yr(t))return t;if(Bp(t))return[t];const e=Fp(t);if(k(e))return[e]}function zp(t){const e=O.words[t],n=$p(e);if(yr(n))return[n,t+1];const[r,i]=Wt(t),s=$p(r);return yr(s)?[s,i]:[void 0,t]}function Jl(t){const e=[];let[n,r]=zp(t);for(;yr(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=J(O.words,r,[K.NUMBER,K.NUMBER]);e.push(o,a),r=c}const[i,s]=zp(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function Gi(t){return Ge(t)&&typeof t[0]=="string"}function jp(t){const e=O.words[t];if(Gi(e))return[e,t+1];const[n,r]=pc(t),[i,s]=Wt(r,!1);return ke(i)?[[i,n],s]:[void 0,t]}function la(t){if(!Gi(t))return;const[e]=t;return e}function Wp(t){if(!Gi(t))return;const[,e]=t,n=k(e)?EN(e):void 0;return k(n)?n:void 0}function Gp(t){if(!Gi(t))return;const[,e]=t,n=k(e)?kN(e):void 0;return k(n)?n:void 0}const et=60,un=25;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});function Yl(t,e){const n=t??He.ISWALK,r=e??He.ISWALK;switch(n){case He.ISWALK:return r!==He.ISWALK;case He.ISSWIM:return r!==He.ISSWIM;case He.ISSOLID:return!0;case He.ISBULLET:return r!==He.ISWALK&&r!==He.ISSWIM}}function Hp(t,e,n){const r=t==null?void 0:t.objects[n];if(k(r))return r;if(k(e)){const i=Ms(t,"player"),s={x:e.x??0,y:e.y??0};Kp(s,i)}}function Ms(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(k)}function Vp(t,e){const n=la(e),r=Wp(e),i=Gp(e);return t.filter(s=>!(k(n)&&Sh(s)!==n||k(r)&&ON(s)!==r||k(i)&&CN(s)!==i)).filter(k)}function Ql(t,e){return k(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(k(i))return i;const s=Ms(t,Pe(n));if(s.length)return s}else if(gr(n)&&n.x>=0&&n.x<et&&n.y>=0&&n.y<un){const i=n.x+n.y*et,s=(r=t.lookup)==null?void 0:r[i];return k(s)?t.objects[s]:t.terrain[i]}}).flat().filter(k):[]}function Kp(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var qp=typeof global=="object"&&global&&global.Object===Object&&global,i1=typeof self=="object"&&self&&self.Object===Object&&self,Hn=qp||i1||Function("return this")(),hn=Hn.Symbol,Xp=Object.prototype,s1=Xp.hasOwnProperty,o1=Xp.toString,Us=hn?hn.toStringTag:void 0;function a1(t){var e=s1.call(t,Us),n=t[Us];try{t[Us]=void 0;var r=!0}catch{}var i=o1.call(t);return r&&(e?t[Us]=n:delete t[Us]),i}var c1=Object.prototype,l1=c1.toString;function u1(t){return l1.call(t)}var h1="[object Null]",f1="[object Undefined]",Zp=hn?hn.toStringTag:void 0;function jr(t){return t==null?t===void 0?f1:h1:Zp&&Zp in Object(t)?a1(t):u1(t)}function xn(t){return t!=null&&typeof t=="object"}var d1="[object Symbol]";function ua(t){return typeof t=="symbol"||xn(t)&&jr(t)==d1}function ha(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Me=Array.isArray,p1=1/0,Jp=hn?hn.prototype:void 0,Yp=Jp?Jp.toString:void 0;function Qp(t){if(typeof t=="string")return t;if(Me(t))return ha(t,Qp)+"";if(ua(t))return Yp?Yp.call(t):"";var e=t+"";return e=="0"&&1/t==-p1?"-0":e}var m1=/\s/;function g1(t){for(var e=t.length;e--&&m1.test(t.charAt(e)););return e}var y1=/^\s+/;function _1(t){return t&&t.slice(0,g1(t)+1).replace(y1,"")}function fn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var em=NaN,b1=/^[-+]0x[0-9a-f]+$/i,w1=/^0b[01]+$/i,v1=/^0o[0-7]+$/i,E1=parseInt;function k1(t){if(typeof t=="number")return t;if(ua(t))return em;if(fn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=fn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=_1(t);var n=w1.test(t);return n||v1.test(t)?E1(t.slice(2),n?2:8):b1.test(t)?em:+t}var tm=1/0,S1=17976931348623157e292;function A1(t){if(!t)return t===0?t:0;if(t=k1(t),t===tm||t===-tm){var e=t<0?-1:1;return e*S1}return t===t?t:0}function fa(t){var e=A1(t),n=e%1;return e===e?n?e-n:e:0}function Hi(t){return t}var T1="[object AsyncFunction]",R1="[object Function]",I1="[object GeneratorFunction]",x1="[object Proxy]";function _r(t){if(!fn(t))return!1;var e=jr(t);return e==R1||e==I1||e==T1||e==x1}var eu=Hn["__core-js_shared__"],nm=function(){var t=/[^.]+$/.exec(eu&&eu.keys&&eu.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function O1(t){return!!nm&&nm in t}var C1=Function.prototype,N1=C1.toString;function fi(t){if(t!=null){try{return N1.call(t)}catch{}try{return t+""}catch{}}return""}var L1=/[\\^$.*+?()[\]{}|]/g,M1=/^\[object .+?Constructor\]$/,U1=Function.prototype,P1=Object.prototype,D1=U1.toString,B1=P1.hasOwnProperty,F1=RegExp("^"+D1.call(B1).replace(L1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $1(t){if(!fn(t)||O1(t))return!1;var e=_r(t)?F1:M1;return e.test(fi(t))}function z1(t,e){return t==null?void 0:t[e]}function di(t,e){var n=z1(t,e);return $1(n)?n:void 0}var tu=di(Hn,"WeakMap"),rm=Object.create,j1=function(){function t(){}return function(e){if(!fn(e))return{};if(rm)return rm(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function W1(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function bt(){}function G1(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var H1=800,V1=16,K1=Date.now;function q1(t){var e=0,n=0;return function(){var r=K1(),i=V1-(r-n);if(n=r,i>0){if(++e>=H1)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function X1(t){return function(){return t}}var da=function(){try{var t=di(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Z1=da?function(t,e){return da(t,"toString",{configurable:!0,enumerable:!1,value:X1(e),writable:!0})}:Hi,J1=q1(Z1);function im(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function sm(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function Y1(t){return t!==t}function Q1(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function nu(t,e,n){return e===e?Q1(t,e,n):sm(t,Y1,n)}function om(t,e){var n=t==null?0:t.length;return!!n&&nu(t,e,0)>-1}var eS=9007199254740991,tS=/^(?:0|[1-9]\d*)$/;function pa(t,e){var n=typeof t;return e=e??eS,!!e&&(n=="number"||n!="symbol"&&tS.test(t))&&t>-1&&t%1==0&&t<e}function ru(t,e,n){e=="__proto__"&&da?da(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ps(t,e){return t===e||t!==t&&e!==e}var nS=Object.prototype,rS=nS.hasOwnProperty;function ma(t,e,n){var r=t[e];(!(rS.call(t,e)&&Ps(r,n))||n===void 0&&!(e in t))&&ru(t,e,n)}function iu(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?ru(n,a,c):ma(n,a,c)}return n}var am=Math.max;function iS(t,e,n){return e=am(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=am(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),W1(t,this,a)}}function su(t,e){return J1(iS(t,e,Hi),t+"")}var sS=9007199254740991;function ou(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=sS}function Vn(t){return t!=null&&ou(t.length)&&!_r(t)}function cm(t,e,n){if(!fn(n))return!1;var r=typeof e;return(r=="number"?Vn(n)&&pa(e,n.length):r=="string"&&e in n)?Ps(n[e],t):!1}function oS(t){return su(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&cm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var aS=Object.prototype;function Ds(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||aS;return t===n}function cS(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var lS="[object Arguments]";function lm(t){return xn(t)&&jr(t)==lS}var um=Object.prototype,uS=um.hasOwnProperty,hS=um.propertyIsEnumerable,ga=lm(function(){return arguments}())?lm:function(t){return xn(t)&&uS.call(t,"callee")&&!hS.call(t,"callee")};function fS(){return!1}var hm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,fm=hm&&typeof module=="object"&&module&&!module.nodeType&&module,dS=fm&&fm.exports===hm,dm=dS?Hn.Buffer:void 0,pS=dm?dm.isBuffer:void 0,Bs=pS||fS,mS="[object Arguments]",gS="[object Array]",yS="[object Boolean]",_S="[object Date]",bS="[object Error]",wS="[object Function]",vS="[object Map]",ES="[object Number]",kS="[object Object]",SS="[object RegExp]",AS="[object Set]",TS="[object String]",RS="[object WeakMap]",IS="[object ArrayBuffer]",xS="[object DataView]",OS="[object Float32Array]",CS="[object Float64Array]",NS="[object Int8Array]",LS="[object Int16Array]",MS="[object Int32Array]",US="[object Uint8Array]",PS="[object Uint8ClampedArray]",DS="[object Uint16Array]",BS="[object Uint32Array]",Ye={};Ye[OS]=Ye[CS]=Ye[NS]=Ye[LS]=Ye[MS]=Ye[US]=Ye[PS]=Ye[DS]=Ye[BS]=!0,Ye[mS]=Ye[gS]=Ye[IS]=Ye[yS]=Ye[xS]=Ye[_S]=Ye[bS]=Ye[wS]=Ye[vS]=Ye[ES]=Ye[kS]=Ye[SS]=Ye[AS]=Ye[TS]=Ye[RS]=!1;function FS(t){return xn(t)&&ou(t.length)&&!!Ye[jr(t)]}function ya(t){return function(e){return t(e)}}var pm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Fs=pm&&typeof module=="object"&&module&&!module.nodeType&&module,$S=Fs&&Fs.exports===pm,au=$S&&qp.process,Wr=function(){try{var t=Fs&&Fs.require&&Fs.require("util").types;return t||au&&au.binding&&au.binding("util")}catch{}}(),mm=Wr&&Wr.isTypedArray,cu=mm?ya(mm):FS,zS=Object.prototype,jS=zS.hasOwnProperty;function gm(t,e){var n=Me(t),r=!n&&ga(t),i=!n&&!r&&Bs(t),s=!n&&!r&&!i&&cu(t),o=n||r||i||s,a=o?cS(t.length,String):[],c=a.length;for(var l in t)(e||jS.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||pa(l,c)))&&a.push(l);return a}function ym(t,e){return function(n){return t(e(n))}}var WS=ym(Object.keys,Object),GS=Object.prototype,HS=GS.hasOwnProperty;function _m(t){if(!Ds(t))return WS(t);var e=[];for(var n in Object(t))HS.call(t,n)&&n!="constructor"&&e.push(n);return e}function dn(t){return Vn(t)?gm(t):_m(t)}var VS=Object.prototype,KS=VS.hasOwnProperty,Vt=oS(function(t,e){if(Ds(e)||Vn(e)){iu(e,dn(e),t);return}for(var n in e)KS.call(e,n)&&ma(t,n,e[n])});function qS(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var XS=Object.prototype,ZS=XS.hasOwnProperty;function JS(t){if(!fn(t))return qS(t);var e=Ds(t),n=[];for(var r in t)r=="constructor"&&(e||!ZS.call(t,r))||n.push(r);return n}function bm(t){return Vn(t)?gm(t,!0):JS(t)}var YS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,QS=/^\w*$/;function lu(t,e){if(Me(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ua(t)?!0:QS.test(t)||!YS.test(t)||e!=null&&t in Object(e)}var $s=di(Object,"create");function eA(){this.__data__=$s?$s(null):{},this.size=0}function tA(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var nA="__lodash_hash_undefined__",rA=Object.prototype,iA=rA.hasOwnProperty;function sA(t){var e=this.__data__;if($s){var n=e[t];return n===nA?void 0:n}return iA.call(e,t)?e[t]:void 0}var oA=Object.prototype,aA=oA.hasOwnProperty;function cA(t){var e=this.__data__;return $s?e[t]!==void 0:aA.call(e,t)}var lA="__lodash_hash_undefined__";function uA(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=$s&&e===void 0?lA:e,this}function pi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pi.prototype.clear=eA,pi.prototype.delete=tA,pi.prototype.get=sA,pi.prototype.has=cA,pi.prototype.set=uA;function hA(){this.__data__=[],this.size=0}function _a(t,e){for(var n=t.length;n--;)if(Ps(t[n][0],e))return n;return-1}var fA=Array.prototype,dA=fA.splice;function pA(t){var e=this.__data__,n=_a(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():dA.call(e,n,1),--this.size,!0}function mA(t){var e=this.__data__,n=_a(e,t);return n<0?void 0:e[n][1]}function gA(t){return _a(this.__data__,t)>-1}function yA(t,e){var n=this.__data__,r=_a(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function br(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}br.prototype.clear=hA,br.prototype.delete=pA,br.prototype.get=mA,br.prototype.has=gA,br.prototype.set=yA;var zs=di(Hn,"Map");function _A(){this.size=0,this.__data__={hash:new pi,map:new(zs||br),string:new pi}}function bA(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ba(t,e){var n=t.__data__;return bA(e)?n[typeof e=="string"?"string":"hash"]:n.map}function wA(t){var e=ba(this,t).delete(t);return this.size-=e?1:0,e}function vA(t){return ba(this,t).get(t)}function EA(t){return ba(this,t).has(t)}function kA(t,e){var n=ba(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function wr(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}wr.prototype.clear=_A,wr.prototype.delete=wA,wr.prototype.get=vA,wr.prototype.has=EA,wr.prototype.set=kA;var SA="Expected a function";function uu(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(SA);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(uu.Cache||wr),n}uu.Cache=wr;var AA=500;function TA(t){var e=uu(t,function(r){return n.size===AA&&n.clear(),r}),n=e.cache;return e}var RA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,IA=/\\(\\)?/g,xA=TA(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(RA,function(n,r,i,s){e.push(i?s.replace(IA,"$1"):r||n)}),e});function wm(t){return t==null?"":Qp(t)}function wa(t,e){return Me(t)?t:lu(t,e)?[t]:xA(wm(t))}var OA=1/0;function js(t){if(typeof t=="string"||ua(t))return t;var e=t+"";return e=="0"&&1/t==-OA?"-0":e}function hu(t,e){e=wa(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[js(e[n++])];return n&&n==r?t:void 0}function CA(t,e,n){var r=t==null?void 0:hu(t,e);return r===void 0?n:r}function fu(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var vm=hn?hn.isConcatSpreadable:void 0;function NA(t){return Me(t)||ga(t)||!!(vm&&t&&t[vm])}function du(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=NA),i||(i=[]);++s<o;){var a=t[s];n(a)?fu(i,a):r||(i[i.length]=a)}return i}function nn(t){var e=t==null?0:t.length;return e?du(t):[]}var Em=ym(Object.getPrototypeOf,Object);function pu(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function LA(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:pu(t,e,n)}var MA="\\ud800-\\udfff",UA="\\u0300-\\u036f",PA="\\ufe20-\\ufe2f",DA="\\u20d0-\\u20ff",BA=UA+PA+DA,FA="\\ufe0e\\ufe0f",$A="\\u200d",zA=RegExp("["+$A+MA+BA+FA+"]");function km(t){return zA.test(t)}function jA(t){return t.split("")}var Sm="\\ud800-\\udfff",WA="\\u0300-\\u036f",GA="\\ufe20-\\ufe2f",HA="\\u20d0-\\u20ff",VA=WA+GA+HA,KA="\\ufe0e\\ufe0f",qA="["+Sm+"]",mu="["+VA+"]",gu="\\ud83c[\\udffb-\\udfff]",XA="(?:"+mu+"|"+gu+")",Am="[^"+Sm+"]",Tm="(?:\\ud83c[\\udde6-\\uddff]){2}",Rm="[\\ud800-\\udbff][\\udc00-\\udfff]",ZA="\\u200d",Im=XA+"?",xm="["+KA+"]?",JA="(?:"+ZA+"(?:"+[Am,Tm,Rm].join("|")+")"+xm+Im+")*",YA=xm+Im+JA,QA="(?:"+[Am+mu+"?",mu,Tm,Rm,qA].join("|")+")",eT=RegExp(gu+"(?="+gu+")|"+QA+YA,"g");function tT(t){return t.match(eT)||[]}function nT(t){return km(t)?tT(t):jA(t)}function rT(t){return function(e){e=wm(e);var n=km(e)?nT(e):void 0,r=n?n[0]:e.charAt(0),i=n?LA(n,1).join(""):e.slice(1);return r[t]()+i}}var Om=rT("toUpperCase");function iT(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function sT(){this.__data__=new br,this.size=0}function oT(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function aT(t){return this.__data__.get(t)}function cT(t){return this.__data__.has(t)}var lT=200;function uT(t,e){var n=this.__data__;if(n instanceof br){var r=n.__data__;if(!zs||r.length<lT-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new wr(r)}return n.set(t,e),this.size=n.size,this}function Kn(t){var e=this.__data__=new br(t);this.size=e.size}Kn.prototype.clear=sT,Kn.prototype.delete=oT,Kn.prototype.get=aT,Kn.prototype.has=cT,Kn.prototype.set=uT;function hT(t,e){return t&&iu(e,dn(e),t)}var Cm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nm=Cm&&typeof module=="object"&&module&&!module.nodeType&&module,fT=Nm&&Nm.exports===Cm,Lm=fT?Hn.Buffer:void 0,Mm=Lm?Lm.allocUnsafe:void 0;function dT(t,e){var n=t.length,r=Mm?Mm(n):new t.constructor(n);return t.copy(r),r}function yu(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Um(){return[]}var pT=Object.prototype,mT=pT.propertyIsEnumerable,Pm=Object.getOwnPropertySymbols,_u=Pm?function(t){return t==null?[]:(t=Object(t),yu(Pm(t),function(e){return mT.call(t,e)}))}:Um;function gT(t,e){return iu(t,_u(t),e)}var yT=Object.getOwnPropertySymbols,_T=yT?function(t){for(var e=[];t;)fu(e,_u(t)),t=Em(t);return e}:Um;function Dm(t,e,n){var r=e(t);return Me(t)?r:fu(r,n(t))}function bu(t){return Dm(t,dn,_u)}function bT(t){return Dm(t,bm,_T)}var wu=di(Hn,"DataView"),vu=di(Hn,"Promise"),Vi=di(Hn,"Set"),Bm="[object Map]",wT="[object Object]",Fm="[object Promise]",$m="[object Set]",zm="[object WeakMap]",jm="[object DataView]",vT=fi(wu),ET=fi(zs),kT=fi(vu),ST=fi(Vi),AT=fi(tu),pn=jr;(wu&&pn(new wu(new ArrayBuffer(1)))!=jm||zs&&pn(new zs)!=Bm||vu&&pn(vu.resolve())!=Fm||Vi&&pn(new Vi)!=$m||tu&&pn(new tu)!=zm)&&(pn=function(t){var e=jr(t),n=e==wT?t.constructor:void 0,r=n?fi(n):"";if(r)switch(r){case vT:return jm;case ET:return Bm;case kT:return Fm;case ST:return $m;case AT:return zm}return e});var TT=Object.prototype,RT=TT.hasOwnProperty;function IT(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&RT.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var va=Hn.Uint8Array;function xT(t){var e=new t.constructor(t.byteLength);return new va(e).set(new va(t)),e}function OT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var CT=/\w*$/;function NT(t){var e=new t.constructor(t.source,CT.exec(t));return e.lastIndex=t.lastIndex,e}var Wm=hn?hn.prototype:void 0,Gm=Wm?Wm.valueOf:void 0;function LT(t){return Gm?Object(Gm.call(t)):{}}function MT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var UT="[object Boolean]",PT="[object Date]",DT="[object Map]",BT="[object Number]",FT="[object RegExp]",$T="[object Set]",zT="[object String]",jT="[object Symbol]",WT="[object ArrayBuffer]",GT="[object DataView]",HT="[object Float32Array]",VT="[object Float64Array]",KT="[object Int8Array]",qT="[object Int16Array]",XT="[object Int32Array]",ZT="[object Uint8Array]",JT="[object Uint8ClampedArray]",YT="[object Uint16Array]",QT="[object Uint32Array]";function eR(t,e,n){var r=t.constructor;switch(e){case WT:return xT(t);case UT:case PT:return new r(+t);case GT:return OT(t);case HT:case VT:case KT:case qT:case XT:case ZT:case JT:case YT:case QT:return MT(t);case DT:return new r;case BT:case zT:return new r(t);case FT:return NT(t);case $T:return new r;case jT:return LT(t)}}function tR(t){return typeof t.constructor=="function"&&!Ds(t)?j1(Em(t)):{}}var nR="[object Map]";function rR(t){return xn(t)&&pn(t)==nR}var Hm=Wr&&Wr.isMap,iR=Hm?ya(Hm):rR,sR="[object Set]";function oR(t){return xn(t)&&pn(t)==sR}var Vm=Wr&&Wr.isSet,aR=Vm?ya(Vm):oR,Km="[object Arguments]",cR="[object Array]",lR="[object Boolean]",uR="[object Date]",hR="[object Error]",qm="[object Function]",fR="[object GeneratorFunction]",dR="[object Map]",pR="[object Number]",Xm="[object Object]",mR="[object RegExp]",gR="[object Set]",yR="[object String]",_R="[object Symbol]",bR="[object WeakMap]",wR="[object ArrayBuffer]",vR="[object DataView]",ER="[object Float32Array]",kR="[object Float64Array]",SR="[object Int8Array]",AR="[object Int16Array]",TR="[object Int32Array]",RR="[object Uint8Array]",IR="[object Uint8ClampedArray]",xR="[object Uint16Array]",OR="[object Uint32Array]",Ke={};Ke[Km]=Ke[cR]=Ke[wR]=Ke[vR]=Ke[lR]=Ke[uR]=Ke[ER]=Ke[kR]=Ke[SR]=Ke[AR]=Ke[TR]=Ke[dR]=Ke[pR]=Ke[Xm]=Ke[mR]=Ke[gR]=Ke[yR]=Ke[_R]=Ke[RR]=Ke[IR]=Ke[xR]=Ke[OR]=!0,Ke[hR]=Ke[qm]=Ke[bR]=!1;function Ea(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!fn(t))return t;var a=Me(t);if(a)return o=IT(t),G1(t,o);var c=pn(t),l=c==qm||c==fR;if(Bs(t))return dT(t);if(c==Xm||c==Km||l&&!i)return o=l?{}:tR(t),gT(t,hT(o,t));if(!Ke[c])return i?t:{};o=eR(t,c),s||(s=new Kn);var u=s.get(t);if(u)return u;s.set(t,o),aR(t)?t.forEach(function(f){o.add(Ea(f,e,n,f,t,s))}):iR(t)&&t.forEach(function(f,p){o.set(p,Ea(f,e,n,p,t,s))});var h=bu,d=a?void 0:h(t);return im(d||t,function(f,p){d&&(p=f,f=t[p]),ma(o,p,Ea(f,e,n,p,t,s))}),o}var CR=4;function Ot(t){return Ea(t,CR)}function Ws(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var NR="__lodash_hash_undefined__";function LR(t){return this.__data__.set(t,NR),this}function MR(t){return this.__data__.has(t)}function Ki(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new wr;++e<n;)this.add(t[e])}Ki.prototype.add=Ki.prototype.push=LR,Ki.prototype.has=MR;function Zm(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Eu(t,e){return t.has(e)}var UR=1,PR=2;function Jm(t,e,n,r,i,s){var o=n&UR,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var h=-1,d=!0,f=n&PR?new Ki:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],m=e[h];if(r)var b=o?r(m,p,h,e,t,s):r(p,m,h,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(f){if(!Zm(e,function(_,w){if(!Eu(f,w)&&(p===_||i(p,_,n,r,s)))return f.push(w)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function DR(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function ku(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var BR=1,FR=2,$R="[object Boolean]",zR="[object Date]",jR="[object Error]",WR="[object Map]",GR="[object Number]",HR="[object RegExp]",VR="[object Set]",KR="[object String]",qR="[object Symbol]",XR="[object ArrayBuffer]",ZR="[object DataView]",Ym=hn?hn.prototype:void 0,Su=Ym?Ym.valueOf:void 0;function JR(t,e,n,r,i,s,o){switch(n){case ZR:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case XR:return!(t.byteLength!=e.byteLength||!s(new va(t),new va(e)));case $R:case zR:case GR:return Ps(+t,+e);case jR:return t.name==e.name&&t.message==e.message;case HR:case KR:return t==e+"";case WR:var a=DR;case VR:var c=r&BR;if(a||(a=ku),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=FR,o.set(t,e);var u=Jm(a(t),a(e),r,i,s,o);return o.delete(t),u;case qR:if(Su)return Su.call(t)==Su.call(e)}return!1}var YR=1,QR=Object.prototype,eI=QR.hasOwnProperty;function tI(t,e,n,r,i,s){var o=n&YR,a=bu(t),c=a.length,l=bu(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:eI.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++h<c;){d=a[h];var _=t[d],w=e[d];if(r)var v=o?r(w,_,d,e,t,s):r(_,w,d,t,e,s);if(!(v===void 0?_===w||i(_,w,n,r,s):v)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var A=t.constructor,C=e.constructor;A!=C&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var nI=1,Qm="[object Arguments]",eg="[object Array]",ka="[object Object]",rI=Object.prototype,tg=rI.hasOwnProperty;function iI(t,e,n,r,i,s){var o=Me(t),a=Me(e),c=o?eg:pn(t),l=a?eg:pn(e);c=c==Qm?ka:c,l=l==Qm?ka:l;var u=c==ka,h=l==ka,d=c==l;if(d&&Bs(t)){if(!Bs(e))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new Kn),o||cu(t)?Jm(t,e,n,r,i,s):JR(t,e,c,n,r,i,s);if(!(n&nI)){var f=u&&tg.call(t,"__wrapped__"),p=h&&tg.call(e,"__wrapped__");if(f||p){var m=f?t.value():t,b=p?e.value():e;return s||(s=new Kn),i(m,b,n,r,s)}}return d?(s||(s=new Kn),tI(t,e,n,r,i,s)):!1}function Au(t,e,n,r,i){return t===e?!0:t==null||e==null||!xn(t)&&!xn(e)?t!==t&&e!==e:iI(t,e,n,r,Au,i)}var sI=1,oI=2;function aI(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new Kn,h;if(!(h===void 0?Au(l,c,sI|oI,r,u):h))return!1}}return!0}function ng(t){return t===t&&!fn(t)}function cI(t){for(var e=dn(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,ng(i)]}return e}function rg(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function lI(t){var e=cI(t);return e.length==1&&e[0][2]?rg(e[0][0],e[0][1]):function(n){return n===t||aI(n,t,e)}}function uI(t,e){return t!=null&&e in Object(t)}function ig(t,e,n){e=wa(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=js(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&ou(i)&&pa(o,i)&&(Me(t)||ga(t)))}function hI(t,e){return t!=null&&ig(t,e,uI)}var fI=1,dI=2;function pI(t,e){return lu(t)&&ng(e)?rg(js(t),e):function(n){var r=CA(n,t);return r===void 0&&r===e?hI(n,t):Au(e,r,fI|dI)}}function mI(t){return function(e){return e==null?void 0:e[t]}}function gI(t){return function(e){return hu(e,t)}}function yI(t){return lu(t)?mI(js(t)):gI(t)}function qn(t){return typeof t=="function"?t:t==null?Hi:typeof t=="object"?Me(t)?pI(t[0],t[1]):lI(t):yI(t)}function _I(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function bI(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var wI=bI();function vI(t,e){return t&&wI(t,e,dn)}function EI(t,e){return function(n,r){if(n==null)return n;if(!Vn(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var mi=EI(vI);function kI(t,e,n,r){return mi(t,function(i,s,o){e(r,i,n(i),o)}),r}function SI(t,e){return function(n,r){var i=Me(n)?_I:kI,s=e?e():{};return i(n,t,qn(r),s)}}var sg=Object.prototype,AI=sg.hasOwnProperty,Tu=su(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&cm(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=bm(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Ps(u,sg[l])&&!AI.call(t,l))&&(t[l]=s[l])}return t});function og(t){return xn(t)&&Vn(t)}var TI=200;function RI(t,e,n,r){var i=-1,s=om,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=TI&&(s=Eu,o=!1,e=new Ki(e));e:for(;++i<a;){var u=t[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(e[d]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var Sa=su(function(t,e){return og(t)?RI(t,du(e,1,og,!0)):[]});function qi(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ct(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:fa(e),pu(t,e<0?0:e,r)):[]}function Gs(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:fa(e),e=r-e,pu(t,0,e<0?0:e)):[]}function II(t){return typeof t=="function"?t:Hi}function me(t,e){var n=Me(t)?im:mi;return n(t,II(e))}function xI(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function OI(t,e){var n=!0;return mi(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function On(t,e,n){var r=Me(t)?xI:OI;return r(t,qn(e))}function ag(t,e){var n=[];return mi(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function mn(t,e){var n=Me(t)?yu:ag;return n(t,qn(e))}function CI(t){return function(e,n,r){var i=Object(e);if(!Vn(e)){var s=qn(n);e=dn(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var NI=Math.max;function LI(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:fa(n);return i<0&&(i=NI(r+i,0)),sm(t,qn(e),i)}var Xi=CI(LI);function Cn(t){return t&&t.length?t[0]:void 0}function MI(t,e){var n=-1,r=Vn(t)?Array(t.length):[];return mi(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function le(t,e){var n=Me(t)?ha:MI;return n(t,qn(e))}function gn(t,e){return du(le(t,e))}var UI=Object.prototype,PI=UI.hasOwnProperty,cg=SI(function(t,e,n){PI.call(t,n)?t[n].push(e):ru(t,n,[e])}),DI=Object.prototype,BI=DI.hasOwnProperty;function FI(t,e){return t!=null&&BI.call(t,e)}function pe(t,e){return t!=null&&ig(t,e,FI)}var $I="[object String]";function Kt(t){return typeof t=="string"||!Me(t)&&xn(t)&&jr(t)==$I}function zI(t,e){return ha(e,function(n){return t[n]})}function ht(t){return t==null?[]:zI(t,dn(t))}var jI=Math.max;function Ft(t,e,n,r){t=Vn(t)?t:ht(t),n=n&&!r?fa(n):0;var i=t.length;return n<0&&(n=jI(i+n,0)),Kt(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&nu(t,e,n)>-1}function lg(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return nu(t,e,i)}var WI="[object Map]",GI="[object Set]",HI=Object.prototype,VI=HI.hasOwnProperty;function qe(t){if(t==null)return!0;if(Vn(t)&&(Me(t)||typeof t=="string"||typeof t.splice=="function"||Bs(t)||cu(t)||ga(t)))return!t.length;var e=pn(t);if(e==WI||e==GI)return!t.size;if(Ds(t))return!_m(t).length;for(var n in t)if(VI.call(t,n))return!1;return!0}var KI="[object RegExp]";function qI(t){return xn(t)&&jr(t)==KI}var ug=Wr&&Wr.isRegExp,vr=ug?ya(ug):qI;function Er(t){return t===void 0}var XI="Expected a function";function ZI(t){if(typeof t!="function")throw new TypeError(XI);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function JI(t,e,n,r){if(!fn(t))return t;e=wa(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=js(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=fn(u)?u:pa(e[i+1])?[]:{})}ma(a,c,l),a=a[c]}return t}function YI(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=hu(t,o);n(a,o)&&JI(s,wa(o,t),a)}return s}function Nn(t,e){if(t==null)return{};var n=ha(bT(t),function(r){return[r]});return e=qn(e),YI(t,n,function(r,i){return e(r,i[0])})}function QI(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function qt(t,e,n){var r=Me(t)?iT:QI,i=arguments.length<3;return r(t,qn(e),n,i,mi)}function Aa(t,e){var n=Me(t)?yu:ag;return n(t,ZI(qn(e)))}function ex(t,e){var n;return mi(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Ru(t,e,n){var r=Me(t)?Zm:ex;return r(t,qn(e))}var tx=1/0,nx=Vi&&1/ku(new Vi([,-0]))[1]==tx?function(t){return new Vi(t)}:bt,rx=200;function ix(t,e,n){var r=-1,i=om,s=t.length,o=!0,a=[],c=a;if(s>=rx){var l=nx(t);if(l)return ku(l);o=!1,i=Eu,c=new Ki}else c=a;e:for(;++r<s;){var u=t[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(u)}else i(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function Ta(t){return t&&t.length?ix(t):[]}function Iu(t){console&&console.error&&console.error(`Error: ${t}`)}function hg(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function fg(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function dg(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function sx(t){return ox(t)?t.LABEL:t.name}function ox(t){return Kt(t.LABEL)&&t.LABEL!==""}class Xn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),me(this.definition,n=>{n.accept(e)})}}class Xt extends Xn{constructor(e){super([]),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Zi extends Xn{constructor(e){super(e.definition),this.orgText="",Vt(this,Nn(e,n=>n!==void 0))}}class Zt extends Xn{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Vt(this,Nn(e,n=>n!==void 0))}}class Jt extends Xn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Zn extends Xn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Jn extends Xn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class wt extends Xn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Ln extends Xn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Mn extends Xn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Vt(this,Nn(e,n=>n!==void 0))}}class tt{constructor(e){this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}accept(e){e.visit(this)}}function ax(t){return le(t,Ra)}function Ra(t){function e(n){return le(n,Ra)}if(t instanceof Xt){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Kt(t.label)&&(n.label=t.label),n}else{if(t instanceof Zt)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Jt)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Zn)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Jn)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Ra(new tt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ln)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Ra(new tt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof wt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Mn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof tt){const n={type:"Terminal",name:t.terminalType.name,label:sx(t.terminalType),idx:t.idx};Kt(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=vr(r)?r.source:r),n}else{if(t instanceof Zi)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class gi{visit(e){const n=e;switch(n.constructor){case Xt:return this.visitNonTerminal(n);case Zt:return this.visitAlternative(n);case Jt:return this.visitOption(n);case Zn:return this.visitRepetitionMandatory(n);case Jn:return this.visitRepetitionMandatoryWithSeparator(n);case Ln:return this.visitRepetitionWithSeparator(n);case wt:return this.visitRepetition(n);case Mn:return this.visitAlternation(n);case tt:return this.visitTerminal(n);case Zi:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function cx(t){return t instanceof Zt||t instanceof Jt||t instanceof wt||t instanceof Zn||t instanceof Jn||t instanceof Ln||t instanceof tt||t instanceof Zi}function Ia(t,e=[]){return t instanceof Jt||t instanceof wt||t instanceof Ln?!0:t instanceof Mn?Ru(t.definition,r=>Ia(r,e)):t instanceof Xt&&Ft(e,t)?!1:t instanceof Xn?(t instanceof Xt&&e.push(t),On(t.definition,r=>Ia(r,e))):!1}function lx(t){return t instanceof Mn}function Yn(t){if(t instanceof Xt)return"SUBRULE";if(t instanceof Jt)return"OPTION";if(t instanceof Mn)return"OR";if(t instanceof Zn)return"AT_LEAST_ONE";if(t instanceof Jn)return"AT_LEAST_ONE_SEP";if(t instanceof Ln)return"MANY_SEP";if(t instanceof wt)return"MANY";if(t instanceof tt)return"CONSUME";throw Error("non exhaustive match")}class xa{walk(e,n=[]){me(e.definition,(r,i)=>{const s=Ct(e.definition,i+1);if(r instanceof Xt)this.walkProdRef(r,s,n);else if(r instanceof tt)this.walkTerminal(r,s,n);else if(r instanceof Zt)this.walkFlat(r,s,n);else if(r instanceof Jt)this.walkOption(r,s,n);else if(r instanceof Zn)this.walkAtLeastOne(r,s,n);else if(r instanceof Jn)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ln)this.walkManySep(r,s,n);else if(r instanceof wt)this.walkMany(r,s,n);else if(r instanceof Mn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Jt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=pg(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Jt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=pg(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);me(e.definition,s=>{const o=new Zt({definition:[s]});this.walk(o,i)})}}function pg(t,e,n){return[new Jt({definition:[new tt({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Hs(t){if(t instanceof Xt)return Hs(t.referencedRule);if(t instanceof tt)return fx(t);if(cx(t))return ux(t);if(lx(t))return hx(t);throw Error("non exhaustive match")}function ux(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Ia(s),e=e.concat(Hs(s)),r=r+1,i=n.length>r;return Ta(e)}function hx(t){const e=le(t.definition,n=>Hs(n));return Ta(nn(e))}function fx(t){return[t.terminalType]}const mg="_~IN~_";class dx extends xa{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=mx(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Zt({definition:s}),a=Hs(o);this.follows[i]=a}}function px(t){const e={};return me(t,n=>{const r=new dx(n).startWalking();Vt(e,r)}),e}function mx(t,e){return t.name+e+mg}function ge(t){return t.charCodeAt(0)}function xu(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Vs(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Ji(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function gx(){throw Error("Internal Error - Should never get here!")}function gg(t){return t.type==="Character"}const Oa=[];for(let t=ge("0");t<=ge("9");t++)Oa.push(t);const Ca=[ge("_")].concat(Oa);for(let t=ge("a");t<=ge("z");t++)Ca.push(t);for(let t=ge("A");t<=ge("Z");t++)Ca.push(t);const yg=[ge(" "),ge("\f"),ge(`
`),ge("\r"),ge("	"),ge("\v"),ge("	"),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge("\u2028"),ge("\u2029"),ge(" "),ge(" "),ge("　"),ge("\uFEFF")],yx=/[0-9a-fA-F]/,Na=/[0-9]/,_x=/[1-9]/;class bx{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Vs(r,"global");break;case"i":Vs(r,"ignoreCase");break;case"m":Vs(r,"multiLine");break;case"u":Vs(r,"unicode");break;case"y":Vs(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Ji(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return gx()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Ji(n);break}if(!(e===!0&&n===void 0)&&Ji(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Ji(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ge(`
`),ge("\r"),ge("\u2028"),ge("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Oa;break;case"D":e=Oa,n=!0;break;case"s":e=yg;break;case"S":e=yg,n=!0;break;case"w":e=Ca;break;case"W":e=Ca,n=!0;break}if(Ji(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=ge("\f");break;case"n":e=ge(`
`);break;case"r":e=ge("\r");break;case"t":e=ge("	");break;case"v":e=ge("\v");break}if(Ji(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:ge("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:ge(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:ge(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,gg(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,gg(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else xu(r.value,e),e.push(ge("-")),xu(i.value,e)}else xu(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ge("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(_x.test(e)===!1)throw Error("Expecting a positive integer");for(;Na.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Na.test(e)===!1)throw Error("Expecting an integer");for(;Na.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ge(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Na.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(yx.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Ou{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let La={};const wx=new bx;function Ma(t){const e=t.toString();if(La.hasOwnProperty(e))return La[e];{const n=wx.pattern(e);return La[e]=n,n}}function vx(){La={}}const _g="Complement Sets are not supported for first char optimization",Ua=`Unable to use "first char" lexer optimizations:
`;function Ex(t,e=!1){try{const n=Ma(t);return Cu(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===_g)e&&hg(`${Ua}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Iu(`${Ua}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Cu(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Cu(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Pa(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(_g);me(o.value,c=>{if(typeof c=="number")Pa(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Pa(u,e,n);else{for(let u=l.from;u<=l.to&&u<qs;u++)Pa(u,e,n);if(l.to>=qs){const u=l.from>=qs?l.from:qs,h=l.to,d=Gr(u),f=Gr(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":Cu(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Nu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return ht(e)}function Pa(t,e,n){const r=Gr(t);e[r]=r,n===!0&&kx(t,e)}function kx(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Gr(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Gr(i.charCodeAt(0));e[s]=s}}}function bg(t,e){return Xi(t.value,n=>{if(typeof n=="number")return Ft(e,n);{const r=n;return Xi(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function Nu(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Me(t.value)?On(t.value,Nu):Nu(t.value):!1}class Sx extends Ou{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Ft(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?bg(e,this.targetCharCodes)===void 0&&(this.found=!0):bg(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Lu(t,e){if(e instanceof RegExp){const n=Ma(e),r=new Sx(t);return r.visit(n),r.found}else return Xi(e,n=>Ft(t,n.charCodeAt(0)))!==void 0}const yi="PATTERN",Ks="defaultMode",Da="modes";let wg=typeof new RegExp("(?:)").sticky=="boolean";function Ax(t,e){e=Tu(e,{useSticky:wg,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,v)=>v()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{qx()});let r;n("Reject Lexer.NA",()=>{r=Aa(t,w=>w[yi]===vt.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=le(r,w=>{const v=w[yi];if(vr(v)){const A=v.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!v.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Ft(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?Eg(v):vg(v)}else{if(_r(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const A=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(A);return e.useSticky?Eg(C):vg(C)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=le(r,w=>w.tokenTypeIdx),a=le(r,w=>{const v=w.GROUP;if(v!==vt.SKIPPED){if(Kt(v))return v;if(Er(v))return!1;throw Error("non exhaustive match")}}),c=le(r,w=>{const v=w.LONGER_ALT;if(v)return Me(v)?le(v,C=>lg(r,C)):[lg(r,v)]}),l=le(r,w=>w.PUSH_MODE),u=le(r,w=>pe(w,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const w=Ag(e.lineTerminatorCharacters);h=le(r,v=>!1),e.positionTracking!=="onlyOffset"&&(h=le(r,v=>pe(v,"LINE_BREAKS")?!!v.LINE_BREAKS:Sg(v,w)===!1&&Lu(w,v.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=le(r,kg),f=le(s,Hx),p=qt(r,(w,v)=>{const A=v.GROUP;return Kt(A)&&A!==vt.SKIPPED&&(w[A]=[]),w},{}),m=le(s,(w,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:d[v],short:f[v],group:a[v],push:l[v],pop:u[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=qt(r,(w,v,A)=>{if(typeof v.PATTERN=="string"){const C=v.PATTERN.charCodeAt(0),T=Gr(C);Mu(w,T,m[A])}else if(Me(v.START_CHARS_HINT)){let C;me(v.START_CHARS_HINT,T=>{const I=typeof T=="string"?T.charCodeAt(0):T,$=Gr(I);C!==$&&(C=$,Mu(w,$,m[A]))})}else if(vr(v.PATTERN))if(v.PATTERN.unicode)b=!1,e.ensureOptimizations&&Iu(`${Ua}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=Ex(v.PATTERN,e.ensureOptimizations);qe(C)&&(b=!1),me(C,T=>{Mu(w,T,m[A])})}else e.ensureOptimizations&&Iu(`${Ua}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return w},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function Tx(t,e){let n=[];const r=Ix(t);n=n.concat(r.errors);const i=xx(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(Rx(s)),n=n.concat(Dx(s)),n=n.concat(Bx(s,e)),n=n.concat(Fx(s)),n}function Rx(t){let e=[];const n=mn(t,r=>vr(r[yi]));return e=e.concat(Cx(n)),e=e.concat(Mx(n)),e=e.concat(Ux(n)),e=e.concat(Px(n)),e=e.concat(Nx(n)),e}function Ix(t){const e=mn(t,i=>!pe(i,yi)),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:st.MISSING_PATTERN,tokenTypes:[i]})),r=Sa(t,e);return{errors:n,valid:r}}function xx(t){const e=mn(t,i=>{const s=i[yi];return!vr(s)&&!_r(s)&&!pe(s,"exec")&&!Kt(s)}),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:st.INVALID_PATTERN,tokenTypes:[i]})),r=Sa(t,e);return{errors:n,valid:r}}const Ox=/[^\\][$]/;function Cx(t){class e extends Ou{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Ma(s),a=new e;return a.visit(o),a.found}catch{return Ox.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:st.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Nx(t){const e=mn(t,r=>r.PATTERN.test(""));return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:st.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const Lx=/[^\\[][\^]|^\^/;function Mx(t){class e extends Ou{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Ma(s),a=new e;return a.visit(o),a.found}catch{return Lx.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:st.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Ux(t){const e=mn(t,r=>{const i=r[yi];return i instanceof RegExp&&(i.multiline||i.global)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:st.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Px(t){const e=[];let n=le(t,s=>qt(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Ft(e,a)&&a.PATTERN!==vt.NA&&(e.push(a),o.push(a)),o),[]));n=Ws(n);const r=mn(n,s=>s.length>1);return le(r,s=>{const o=le(s,c=>c.name);return{message:`The same RegExp pattern ->${Cn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:st.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function Dx(t){const e=mn(t,r=>{if(!pe(r,"GROUP"))return!1;const i=r.GROUP;return i!==vt.SKIPPED&&i!==vt.NA&&!Kt(i)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:st.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Bx(t,e){const n=mn(t,i=>i.PUSH_MODE!==void 0&&!Ft(e,i.PUSH_MODE));return le(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:st.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Fx(t){const e=[],n=qt(t,(r,i,s)=>{const o=i.PATTERN;return o===vt.NA||(Kt(o)?r.push({str:o,idx:s,tokenType:i}):vr(o)&&zx(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return me(t,(r,i)=>{me(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&$x(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:st.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function $x(t,e){if(vr(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(_r(e))return e(t,0,[],{});if(pe(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function zx(t){return Xi([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function vg(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Eg(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function jx(t,e,n){const r=[];return pe(t,Ks)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ks+`> property in its definition
`,type:st.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),pe(t,Da)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Da+`> property in its definition
`,type:st.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),pe(t,Da)&&pe(t,Ks)&&!pe(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Ks}: <${t.defaultMode}>which does not exist
`,type:st.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),pe(t,Da)&&me(t.modes,(i,s)=>{me(i,(o,a)=>{if(Er(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:st.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(pe(o,"LONGER_ALT")){const c=Me(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];me(c,l=>{!Er(l)&&!Ft(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:st.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Wx(t,e,n){const r=[];let i=!1;const s=Ws(nn(ht(t.modes))),o=Aa(s,c=>c[yi]===vt.NA),a=Ag(n);return e&&me(o,c=>{const l=Sg(c,a);if(l!==!1){const h={message:Kx(c,l),type:l.issue,tokenType:c};r.push(h)}else pe(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Lu(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:st.NO_LINE_BREAKS_FLAGS}),r}function Gx(t){const e={},n=dn(t);return me(n,r=>{const i=t[r];if(Me(i))e[r]=[];else throw Error("non exhaustive match")}),e}function kg(t){const e=t.PATTERN;if(vr(e))return!1;if(_r(e))return!0;if(pe(e,"exec"))return!0;if(Kt(e))return!1;throw Error("non exhaustive match")}function Hx(t){return Kt(t)&&t.length===1?t.charCodeAt(0):!1}const Vx={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Sg(t,e){if(pe(t,"LINE_BREAKS"))return!1;if(vr(t.PATTERN)){try{Lu(e,t.PATTERN)}catch(n){return{issue:st.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Kt(t.PATTERN))return!1;if(kg(t))return{issue:st.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Kx(t,e){if(e.issue===st.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===st.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Ag(t){return le(t,n=>Kt(n)?n.charCodeAt(0):n)}function Mu(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const qs=256;let Ba=[];function Gr(t){return t<qs?t:Ba[t]}function qx(){if(qe(Ba)){Ba=new Array(65536);for(let t=0;t<65536;t++)Ba[t]=t>255?255+~~(t/255):t}}function Xs(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Fa(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let Tg=1;const Rg={};function Zs(t){const e=Xx(t);Zx(e),Yx(e),Jx(e),me(e,n=>{n.isParent=n.categoryMatches.length>0})}function Xx(t){let e=Ot(t),n=t,r=!0;for(;r;){n=Ws(nn(le(n,s=>s.CATEGORIES)));const i=Sa(n,e);e=e.concat(i),qe(i)?r=!1:n=i}return e}function Zx(t){me(t,e=>{xg(e)||(Rg[Tg]=e,e.tokenTypeIdx=Tg++),Og(e)&&!Me(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Og(e)||(e.CATEGORIES=[]),Qx(e)||(e.categoryMatches=[]),eO(e)||(e.categoryMatchesMap={})})}function Jx(t){me(t,e=>{e.categoryMatches=[],me(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Rg[r].tokenTypeIdx)})})}function Yx(t){me(t,e=>{Ig([],e)})}function Ig(t,e){me(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),me(e.CATEGORIES,n=>{const r=t.concat(e);Ft(r,n)||Ig(r,n)})}function xg(t){return pe(t,"tokenTypeIdx")}function Og(t){return pe(t,"CATEGORIES")}function Qx(t){return pe(t,"categoryMatches")}function eO(t){return pe(t,"categoryMatchesMap")}function tO(t){return pe(t,"tokenTypeIdx")}const nO={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var st;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(st||(st={}));const Js={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:nO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Js);class vt{constructor(e,n=Js){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=fg(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Vt({},Js,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Js.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Vx;else if(this.config.lineTerminatorCharacters===Js.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Me(e)?i={modes:{defaultMode:Ot(e)},defaultMode:Ks}:(s=!1,i=Ot(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(jx(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Wx(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},me(i.modes,(a,c)=>{i.modes[c]=Aa(a,l=>Er(l))});const o=dn(i.modes);if(me(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Tx(a,o))}),qe(this.lexerDefinitionErrors)){Zs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Ax(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Vt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!qe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=le(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}me(this.lexerDefinitionWarning,a=>{hg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(wg?(this.chopInput=Hi,this.match=this.matchWithTest):(this.updateLastIndex=bt,this.match=this.matchWithExec),s&&(this.handleModes=bt),this.trackStartLines===!1&&(this.computeNewColumn=Hi),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=bt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=qt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!qe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{vx()}),this.TRACE_INIT("toFastProperties",()=>{dg(this)})})}tokenize(e,n=this.defaultMode){if(!qe(this.lexerDefinitionErrors)){const i=le(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,h,d,f,p,m,b,_;const w=e,v=w.length;let A=0,C=0;const T=this.hasCustom?0:Math.floor(e.length/10),I=new Array(T),$=[];let L=this.trackStartLines?1:void 0,V=this.trackStartLines?1:void 0;const Q=Gx(this.emptyGroups),x=this.trackStartLines,E=this.config.lineTerminatorsPattern;let g=0,N=[],z=[];const U=[],ee=[];Object.freeze(ee);let H;function Y(){return N}function F(ve){const ze=Gr(ve),we=z[ze];return we===void 0?ee:we}const D=ve=>{if(U.length===1&&ve.tokenType.PUSH_MODE===void 0){const ze=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(ve);$.push({offset:ve.startOffset,line:ve.startLine,column:ve.startColumn,length:ve.image.length,message:ze})}else{U.pop();const ze=qi(U);N=this.patternIdxToConfig[ze],z=this.charCodeToPatternIdxToConfig[ze],g=N.length;const we=this.canModeBeOptimized[ze]&&this.config.safeMode===!1;z&&we?H=F:H=Y}};function ae(ve){U.push(ve),z=this.charCodeToPatternIdxToConfig[ve],N=this.patternIdxToConfig[ve],g=N.length,g=N.length;const ze=this.canModeBeOptimized[ve]&&this.config.safeMode===!1;z&&ze?H=F:H=Y}ae.call(this,n);let te;const ne=this.config.recoveryEnabled;for(;A<v;){c=null;const ve=w.charCodeAt(A),ze=H(ve),we=ze.length;for(r=0;r<we;r++){te=ze[r];const be=te.pattern;l=null;const We=te.short;if(We!==!1?ve===We&&(c=be):te.isCustom===!0?(_=be.exec(w,A,I,Q),_!==null?(c=_[0],_.payload!==void 0&&(l=_.payload)):c=null):(this.updateLastIndex(be,A),c=this.match(be,e,A)),c!==null){if(a=te.longerAlt,a!==void 0){const $e=a.length;for(s=0;s<$e;s++){const mt=N[a[s]],Et=mt.pattern;if(u=null,mt.isCustom===!0?(_=Et.exec(w,A,I,Q),_!==null?(o=_[0],_.payload!==void 0&&(u=_.payload)):o=null):(this.updateLastIndex(Et,A),o=this.match(Et,e,A)),o&&o.length>c.length){c=o,l=u,te=mt;break}}}break}}if(c!==null){if(h=c.length,d=te.group,d!==void 0&&(f=te.tokenTypeIdx,p=this.createTokenInstance(c,A,f,te.tokenType,L,V,h),this.handlePayload(p,l),d===!1?C=this.addToken(I,C,p):Q[d].push(p)),e=this.chopInput(e,h),A=A+h,V=this.computeNewColumn(V,h),x===!0&&te.canLineTerminator===!0){let be=0,We,$e;E.lastIndex=0;do We=E.test(c),We===!0&&($e=E.lastIndex-1,be++);while(We===!0);be!==0&&(L=L+be,V=h-$e,this.updateTokenEndLineColumnLocation(p,d,$e,be,L,V,h))}this.handleModes(te,D,ae,p)}else{const be=A,We=L,$e=V;let mt=ne===!1;for(;mt===!1&&A<v;)for(e=this.chopInput(e,1),A++,i=0;i<g;i++){const Et=N[i],y=Et.pattern,q=Et.short;if(q!==!1?w.charCodeAt(A)===q&&(mt=!0):Et.isCustom===!0?mt=y.exec(w,A,I,Q)!==null:(this.updateLastIndex(y,A),mt=y.exec(e)!==null),mt===!0)break}if(m=A-be,V=this.computeNewColumn(V,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,be,m,We,$e),$.push({offset:be,line:We,column:$e,length:m,message:b}),ne===!1)break}}return this.hasCustom||(I.length=C),{tokens:I,groups:Q,errors:$}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}vt.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",vt.NA=/NOT_APPLICABLE/;function Ys(t){return Cg(t)?t.LABEL:t.name}function Cg(t){return Kt(t.LABEL)&&t.LABEL!==""}const rO="parent",Ng="categories",Lg="label",Mg="group",Ug="push_mode",Pg="pop_mode",Dg="longer_alt",Bg="line_breaks",Fg="start_chars_hint";function rn(t){return iO(t)}function iO(t){const e=t.pattern,n={};if(n.name=t.name,Er(e)||(n.PATTERN=e),pe(t,rO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return pe(t,Ng)&&(n.CATEGORIES=t[Ng]),Zs([n]),pe(t,Lg)&&(n.LABEL=t[Lg]),pe(t,Mg)&&(n.GROUP=t[Mg]),pe(t,Pg)&&(n.POP_MODE=t[Pg]),pe(t,Ug)&&(n.PUSH_MODE=t[Ug]),pe(t,Dg)&&(n.LONGER_ALT=t[Dg]),pe(t,Bg)&&(n.LINE_BREAKS=t[Bg]),pe(t,Fg)&&(n.START_CHARS_HINT=t[Fg]),n}const _i=rn({name:"EOF",pattern:vt.NA});Zs([_i]);function $a(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function sO(t,e){return Xs(t,e)}const $g={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Cg(t)?`--> ${Ys(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cn(e).image+"'";if(r)return s+r+a;{const c=qt(t,(d,f)=>d.concat(f),[]),l=le(c,d=>`[${le(d,f=>Ys(f)).join(", ")}]`),h=`one of these possible Token sequences:
${le(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cn(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${le(t,l=>`[${le(l,u=>Ys(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze($g);const oO={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},bi={buildDuplicateFoundError(t,e){function n(u){return u instanceof tt?u.terminalType.name:u instanceof Xt?u.nonTerminalName:""}const r=t.name,i=Cn(e),s=i.idx,o=Yn(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=le(t.prefixPath,i=>Ys(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=le(t.prefixPath,i=>Ys(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Yn(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=le(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Zi?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function aO(t,e){const n=new cO(t,e);return n.resolveRefs(),n.errors}class cO extends gi{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){me(ht(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:$t.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class lO extends xa{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ot(this.path.ruleStack).reverse(),this.occurrenceStack=Ot(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){qe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class uO extends lO{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Zt({definition:i});this.possibleTokTypes=Hs(s),this.found=!0}}}class za extends xa{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class hO extends za{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class zg extends za{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class fO extends za{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class jg extends za{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function Uu(t,e,n=[]){n=Ot(n);let r=[],i=0;function s(a){return a.concat(Ct(t,i+1))}function o(a){const c=Uu(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Zt)return o(a.definition);if(a instanceof Xt)return o(a.definition);if(a instanceof Jt)r=o(a.definition);else if(a instanceof Zn){const c=a.definition.concat([new wt({definition:a.definition})]);return o(c)}else if(a instanceof Jn){const c=[new Zt({definition:a.definition}),new wt({definition:[new tt({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ln){const c=a.definition.concat([new wt({definition:[new tt({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof wt){const c=a.definition.concat([new wt({definition:a.definition})]);r=o(c)}else{if(a instanceof Mn)return me(a.definition,c=>{qe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof tt)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ct(t,i)}),r}function Wg(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!qe(h);){const d=h.pop();if(d===o){a&&qi(h).idx<=l&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(qe(f))continue;const _=f[0];if(_===i){const w={idx:p,def:Ct(f),ruleStack:Gs(m),occurrenceStack:Gs(b)};h.push(w)}else if(_ instanceof tt)if(p<c-1){const w=p+1,v=e[w];if(n(v,_.terminalType)){const A={idx:w,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(A)}}else if(p===c-1)u.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Xt){const w=Ot(m);w.push(_.nonTerminalName);const v=Ot(b);v.push(_.idx);const A={idx:p,def:_.definition.concat(s,Ct(f)),ruleStack:w,occurrenceStack:v};h.push(A)}else if(_ instanceof Jt){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v={idx:p,def:_.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b};h.push(v)}else if(_ instanceof Zn){const w=new wt({definition:_.definition,idx:_.idx}),v=_.definition.concat([w],Ct(f)),A={idx:p,def:v,ruleStack:m,occurrenceStack:b};h.push(A)}else if(_ instanceof Jn){const w=new tt({terminalType:_.separator}),v=new wt({definition:[w].concat(_.definition),idx:_.idx}),A=_.definition.concat([v],Ct(f)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(C)}else if(_ instanceof Ln){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v=new tt({terminalType:_.separator}),A=new wt({definition:[v].concat(_.definition),idx:_.idx}),C=_.definition.concat([A],Ct(f)),T={idx:p,def:C,ruleStack:m,occurrenceStack:b};h.push(T)}else if(_ instanceof wt){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const v=new wt({definition:_.definition,idx:_.idx}),A=_.definition.concat([v],Ct(f)),C={idx:p,def:A,ruleStack:m,occurrenceStack:b};h.push(C)}else if(_ instanceof Mn)for(let w=_.definition.length-1;w>=0;w--){const v=_.definition[w],A={idx:p,def:v.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b};h.push(A),h.push(o)}else if(_ instanceof Zt)h.push({idx:p,def:_.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b});else if(_ instanceof Zi)h.push(dO(_,p,m,b));else throw Error("non exhaustive match")}return u}function dO(t,e,n,r){const i=Ot(n);i.push(t.name);const s=Ot(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ot;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ot||(ot={}));function Gg(t){if(t instanceof Jt||t==="Option")return ot.OPTION;if(t instanceof wt||t==="Repetition")return ot.REPETITION;if(t instanceof Zn||t==="RepetitionMandatory")return ot.REPETITION_MANDATORY;if(t instanceof Jn||t==="RepetitionMandatoryWithSeparator")return ot.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ln||t==="RepetitionWithSeparator")return ot.REPETITION_WITH_SEPARATOR;if(t instanceof Mn||t==="Alternation")return ot.ALTERNATION;throw Error("non exhaustive match")}function pO(t,e,n,r,i,s){const o=Du(t,e,n),a=qg(o)?Fa:Xs;return s(o,r,a,i)}function mO(t,e,n,r,i,s){const o=Bu(t,e,i,n),a=qg(o)?Fa:Xs;return s(o[0],a,r)}function gO(t,e,n,r){const i=t.length,s=On(t,o=>On(o,a=>a.length===1));if(e)return function(o){const a=le(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<u;d++){const f=l[d],p=f.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,f[m])===!1)continue e}return c}}};if(s&&!r){const o=le(t,c=>nn(c)),a=qt(o,(c,l,u)=>(me(l,h=>{pe(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),me(h.categoryMatches,d=>{pe(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue e}return o}}}}function yO(t,e,n){const r=On(t,s=>s.length===1),i=t.length;if(r&&!n){const s=nn(t);if(s.length===1&&qe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=qt(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,me(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class _O extends xa{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ot.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ot.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ot.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ot.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Hg extends gi{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ot.OPTION)}visitRepetition(e){this.checkIsTarget(e,ot.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ot.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ot.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ot.ALTERNATION)}}function Vg(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Pu(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function bO(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Kg(t,e){const n=le(t,o=>Uu([o],1)),r=Vg(n.length),i=le(n,o=>{const a={};return me(o,c=>{const l=Pu(c.partialPath);me(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=Vg(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=Pu(h);if(bO(i,f,c)||qe(d)||h.length===e){const m=r[c];if(Fu(m,h)===!1){m.push(h);for(let b=0;b<f.length;b++){const _=f[b];i[c][_]=!0}}}else{const m=Uu(d,o+1,h);s[c]=s[c].concat(m),me(m,b=>{const _=Pu(b.partialPath);me(_,w=>{i[c][w]=!0})})}}}}return r}function Du(t,e,n,r){const i=new Hg(t,ot.ALTERNATION,r);return e.accept(i),Kg(i.result,n)}function Bu(t,e,n,r){const i=new Hg(t,n);e.accept(i);const s=i.result,a=new _O(e,t,n).startWalking(),c=new Zt({definition:s}),l=new Zt({definition:a});return Kg([c,l],r)}function Fu(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function wO(t,e){return t.length<e.length&&On(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function qg(t){return On(t,e=>On(e,n=>On(n,r=>qe(r.categoryMatches))))}function vO(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return le(e,n=>Object.assign({type:$t.CUSTOM_LOOKAHEAD_VALIDATION},n))}function EO(t,e,n,r){const i=gn(t,c=>kO(c,n)),s=UO(t,e,n),o=gn(t,c=>CO(c,n)),a=gn(t,c=>TO(c,t,r,n));return i.concat(s,o,a)}function kO(t,e){const n=new AO;t.accept(n);const r=n.allProductions,i=cg(r,SO),s=Nn(i,a=>a.length>1);return le(ht(s),a=>{const c=Cn(a),l=e.buildDuplicateFoundError(t,a),u=Yn(c),h={message:l,type:$t.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},d=Xg(c);return d&&(h.parameter=d),h})}function SO(t){return`${Yn(t)}_#_${t.idx}_#_${Xg(t)}`}function Xg(t){return t instanceof tt?t.terminalType.name:t instanceof Xt?t.nonTerminalName:""}class AO extends gi{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function TO(t,e,n,r){const i=[];if(qt(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:$t.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function RO(t,e,n){const r=[];let i;return Ft(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:$t.INVALID_RULE_OVERRIDE,ruleName:t})),r}function Zg(t,e,n,r=[]){const i=[],s=ja(e.definition);if(qe(s))return[];{const o=t.name;Ft(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:$t.LEFT_RECURSION,ruleName:o});const c=Sa(s,r.concat([t])),l=gn(c,u=>{const h=Ot(r);return h.push(u),Zg(t,u,n,h)});return i.concat(l)}}function ja(t){let e=[];if(qe(t))return e;const n=Cn(t);if(n instanceof Xt)e.push(n.referencedRule);else if(n instanceof Zt||n instanceof Jt||n instanceof Zn||n instanceof Jn||n instanceof Ln||n instanceof wt)e=e.concat(ja(n.definition));else if(n instanceof Mn)e=nn(le(n.definition,s=>ja(s.definition)));else if(!(n instanceof tt))throw Error("non exhaustive match");const r=Ia(n),i=t.length>1;if(r&&i){const s=Ct(t);return e.concat(ja(s))}else return e}class $u extends gi{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function IO(t,e){const n=new $u;t.accept(n);const r=n.alternations;return gn(r,s=>{const o=Gs(s.definition);return gn(o,(a,c)=>{const l=Wg([a],[],Xs,1);return qe(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:$t.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function xO(t,e,n){const r=new $u;t.accept(r);let i=r.alternations;return i=Aa(i,o=>o.ignoreAmbiguities===!0),gn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=Du(a,t,c,o),u=LO(l,o,t,n),h=MO(l,o,t,n);return u.concat(h)})}class OO extends gi{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function CO(t,e){const n=new $u;t.accept(n);const r=n.alternations;return gn(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:$t.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function NO(t,e,n){const r=[];return me(t,i=>{const s=new OO;i.accept(s);const o=s.allProductions;me(o,a=>{const c=Gg(a),l=a.maxLookahead||e,u=a.idx,d=Bu(u,i,c,l)[0];if(qe(nn(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:$t.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function LO(t,e,n,r){const i=[],s=qt(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||me(c,u=>{const h=[l];me(t,(d,f)=>{l!==f&&Fu(d,u)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!Fu(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return le(s,a=>{const c=le(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:$t.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function MO(t,e,n,r){const i=qt(t,(o,a,c)=>{const l=le(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Ws(gn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=mn(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&wO(d.path,l));return le(u,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:$t.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function UO(t,e,n){const r=[],i=le(e,s=>s.name);return me(t,s=>{const o=s.name;if(Ft(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:$t.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function PO(t){const e=Tu(t,{errMsgProvider:oO}),n={};return me(t.rules,r=>{n[r.name]=r}),aO(n,e.errMsgProvider)}function DO(t){return t=Tu(t,{errMsgProvider:bi}),EO(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const Jg="MismatchedTokenException",Yg="NoViableAltException",Qg="EarlyExitException",e0="NotAllInputParsedException",t0=[Jg,Yg,Qg,e0];Object.freeze(t0);function Wa(t){return Ft(t0,t.name)}class Ga extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class n0 extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Jg}}class BO extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Yg}}class FO extends Ga{constructor(e,n){super(e,n),this.name=e0}}class $O extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Qg}}const zu={},r0="InRuleRecoveryException";class zO extends Error{constructor(e){super(e),this.name=r0}}class jO{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=pe(e,"recoveryEnabled")?e.recoveryEnabled:kr.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=WO)}getTokenToInsert(e){const n=$a(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new n0(f,l,this.LA(0));p.resyncedTokens=Gs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new zO("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||qe(n))return!1;const r=this.LA(1);return Xi(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Ft(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Xi(e,s=>sO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return zu;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return le(e,(r,i)=>i===0?zu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=le(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return nn(e)}getFollowSetFromFollowKey(e){if(e===zu)return[_i];const n=e.ruleName+e.idxInCallingRule+mg+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,_i)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Gs(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Ot(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return le(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function WO(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=_i,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const GO=4,Hr=8,i0=1<<Hr,s0=2<<Hr,ju=3<<Hr,Wu=4<<Hr,Gu=5<<Hr,Ha=6<<Hr;function Hu(t,e,n){return n|e|t}class HO{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:kr.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(qe(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return gn(e,n=>Zg(n,n,bi))}validateEmptyOrAlternatives(e){return gn(e,n=>IO(n,bi))}validateAmbiguousAlternationAlternatives(e,n){return gn(e,r=>xO(r,n,bi))}validateSomeNonEmptyLookaheadPath(e,n){return NO(e,n,bi)}buildLookaheadForAlternation(e){return pO(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,gO)}buildLookaheadForOptional(e){return mO(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Gg(e.prodType),yO)}}class VO{initLooksAhead(e){this.dynamicTokensEnabled=pe(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:kr.dynamicTokensEnabled,this.maxLookahead=pe(e,"maxLookahead")?e.maxLookahead:kr.maxLookahead,this.lookaheadStrategy=pe(e,"lookaheadStrategy")?e.lookaheadStrategy:new HO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){me(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=qO(n);me(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Yn(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Hu(this.fullRuleNameToShort[n.name],i0,l.idx);this.setLaFuncCache(d,h)})}),me(i,l=>{this.computeLookaheadFunc(n,l.idx,ju,"Repetition",l.maxLookahead,Yn(l))}),me(s,l=>{this.computeLookaheadFunc(n,l.idx,s0,"Option",l.maxLookahead,Yn(l))}),me(o,l=>{this.computeLookaheadFunc(n,l.idx,Wu,"RepetitionMandatory",l.maxLookahead,Yn(l))}),me(a,l=>{this.computeLookaheadFunc(n,l.idx,Ha,"RepetitionMandatoryWithSeparator",l.maxLookahead,Yn(l))}),me(c,l=>{this.computeLookaheadFunc(n,l.idx,Gu,"RepetitionWithSeparator",l.maxLookahead,Yn(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Hu(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Hu(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class KO extends gi{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Va=new KO;function qO(t){Va.reset(),t.accept(Va);const e=Va.dslMethods;return Va.reset(),e}function o0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function a0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function XO(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function ZO(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const JO="name";function c0(t,e){Object.defineProperty(t,JO,{enumerable:!1,configurable:!0,writable:!1,value:e})}function YO(t,e){const n=dn(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function QO(t,e){const n=function(){};c0(n,t+"BaseSemantics");const r={visit:function(i,s){if(Me(i)&&(i=i[0]),!Er(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=tC(this,e);if(!qe(i)){const s=le(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function eC(t,e,n){const r=function(){};c0(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return me(e,s=>{i[s]=YO}),r.prototype=i,r.prototype.constructor=r,r}var Vu;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Vu||(Vu={}));function tC(t,e){return nC(t,e)}function nC(t,e){const n=mn(e,i=>_r(t[i])===!1),r=le(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Vu.MISSING_METHOD,methodName:i}));return Ws(r)}class rC{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=pe(e,"nodeLocationTracking")?e.nodeLocationTracking:kr.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=bt,this.cstFinallyStateUpdate=bt,this.cstPostTerminal=bt,this.cstPostNonTerminal=bt,this.cstPostRule=bt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=a0,this.setNodeLocationFromNode=a0,this.cstPostRule=bt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=o0,this.setNodeLocationFromNode=o0,this.cstPostRule=bt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=bt,this.setInitialNodeLocation=bt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];XO(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];ZO(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Er(this.baseCstVisitorConstructor)){const e=QO(this.className,dn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Er(this.baseCstVisitorWithDefaultsConstructor)){const e=eC(this.className,dn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class iC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Xa}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Xa:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class sC{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Za){if(Ft(this.definedRulesNames,e)){const o={message:bi.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:$t.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Za){const i=RO(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Wa(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return ax(ht(this.gastProductionsCache))}}class oC{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Fa,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},pe(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Me(e)){if(qe(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Me(e))this.tokensMap=qt(e,(s,o)=>(s[o.name]=o,s),{});else if(pe(e,"modes")&&On(nn(ht(e.modes)),tO)){const s=nn(ht(e.modes)),o=Ta(s);this.tokensMap=qt(o,(a,c)=>(a[c.name]=c,a),{})}else if(fn(e))this.tokensMap=Ot(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=_i;const r=pe(e,"modes")?nn(ht(e.modes)):ht(e),i=On(r,s=>qe(s.categoryMatches));this.tokenMatcher=i?Fa:Xs,Zs(ht(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=pe(r,"resyncEnabled")?r.resyncEnabled:Za.resyncEnabled,s=pe(r,"recoveryValueFunc")?r.recoveryValueFunc:Za.recoveryValueFunc,o=this.ruleShortNameIdx<<GO+Hr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Wa(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(s0,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(Wu,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ot.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,Wu,e,fO)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ha,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,jg],a,Ha,e,jg)}else throw this.raiseEarlyExitException(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(ju,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,ju,e,hO,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Gu,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,zg],a,Gu,e,zg)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Ha,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(i0,n),i=Me(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new FO(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Wa(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new n0(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===r0?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Ot(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),_i)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class aC{initErrorHandler(e){this._errors=[],this.errorMessageProvider=pe(e,"errorMessageProvider")?e.errorMessageProvider:kr.errorMessageProvider}SAVE_ERROR(e){if(Wa(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ot(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ot(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Bu(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new $O(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Du(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new BO(c,this.LA(1),a))}}class cC{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Er(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Wg([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Cn(e.ruleStack),i=this.getGAstProductions()[n];return new uO(i,e).startWalking()}}const Ka={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Ka);const l0=!0,u0=Math.pow(2,Hr)-1,h0=rn({name:"RECORDING_PHASE_TOKEN",pattern:vt.NA});Zs([h0]);const f0=$a(h0,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(f0);const lC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class uC{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Xa}topLevelRuleRecord(e,n){try{const r=new Zi({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Qs.call(this,Jt,e,n)}atLeastOneInternalRecord(e,n){Qs.call(this,Zn,n,e)}atLeastOneSepFirstInternalRecord(e,n){Qs.call(this,Jn,n,e,l0)}manyInternalRecord(e,n){Qs.call(this,wt,n,e)}manySepFirstInternalRecord(e,n){Qs.call(this,Ln,n,e,l0)}orInternalRecord(e,n){return hC.call(this,e,n)}subruleInternalRecord(e,n,r){if(qa(n),!e||pe(e,"ruleName")===!1){const a=new Error(`<SUBRULE${d0(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=qi(this.recordingProdStack),s=e.ruleName,o=new Xt({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?lC:Ka}consumeInternalRecord(e,n,r){if(qa(n),!xg(e)){const o=new Error(`<CONSUME${d0(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=qi(this.recordingProdStack),s=new tt({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),f0}}function Qs(t,e,n,r=!1){qa(n);const i=qi(this.recordingProdStack),s=_r(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),pe(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Ka}function hC(t,e){qa(e);const n=qi(this.recordingProdStack),r=Me(t)===!1,i=r===!1?t:t.DEF,s=new Mn({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});pe(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Ru(i,a=>_r(a.GATE));return s.hasPredicates=o,n.definition.push(s),me(i,a=>{const c=new Zt({definition:[]});s.definition.push(c),pe(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:pe(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Ka}function d0(t){return t===0?"":`${t}`}function qa(t){if(t<0||t>u0){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${u0+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class fC{initPerformanceTracer(e){if(pe(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=kr.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=fg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function dC(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Xa=$a(_i,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Xa);const kr=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:$g,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Za=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var $t;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})($t||($t={}));class eo{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{dg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),me(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=PO({rules:ht(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(qe(r)&&this.skipValidations===!1){const i=DO({rules:ht(this.gastProductionsCache),tokenTypes:ht(this.tokensMap),errMsgProvider:bi,grammarName:n}),s=vO({lookaheadStrategy:this.lookaheadStrategy,rules:ht(this.gastProductionsCache),tokenTypes:ht(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),qe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=px(ht(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:ht(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ht(this.gastProductionsCache))})),!eo.DEFER_DEFINITION_ERRORS_HANDLING&&!qe(this.definitionErrors))throw e=le(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),pe(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=pe(n,"skipValidations")?n.skipValidations:kr.skipValidations}}eo.DEFER_DEFINITION_ERRORS_HANDLING=!1,dC(eo,[jO,VO,rC,iC,oC,sC,aC,cC,uC,fC]);class pC extends eo{constructor(e,n=kr){const r=Ot(n);r.outputCst=!0,super(e,r)}}function mC(t){const e=new gC,n=ht(t);return le(n,r=>e.visitRule(r))}class gC extends gi{visitRule(e){const n=this.visitEach(e.definition),r=cg(n,s=>s.propertyName),i=le(r,(s,o)=>{const a=!Ru(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=le(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Ja(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Ja(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Ja(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Ja(e)}]}visitEachAndOverrideWith(e,n){return le(this.visitEach(e),r=>Vt({},r,n))}visitEach(e){return nn(le(e,n=>this.visit(n)))}}function Ja(t){return t instanceof Xt?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function yC(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(nn(le(t,r=>_C(r)))),e.includeVisitorInterface&&(n=n.concat(EC(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function _C(t){const e=bC(t),n=wC(t);return[e,n]}function bC(t){const e=m0(t.name),n=Ku(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function wC(t){return`export type ${Ku(t.name)} = {
  ${le(t.properties,n=>vC(n)).join(`
  `)}
};`}function vC(t){const e=SC(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function EC(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${le(e,n=>kC(n)).join(`
  `)}
}`}function kC(t){const e=Ku(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function SC(t){if(Me(t)){const e=Ta(le(t,r=>p0(r)));return"("+qt(e,(r,i)=>r+" | "+i)+")"}else return p0(t)}function p0(t){return t.kind==="token"?"IToken":m0(t.name)}function m0(t){return Om(t)+"CstNode"}function Ku(t){return Om(t)+"CstChildren"}const AC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function TC(t,e){const n=Object.assign(Object.assign({},AC),e),r=mC(t);return yC(r,n)}const qu=Zl(32,126).map(t=>String.fromCharCode(t));function Ie(t){return rn({...t,name:`token_${t.name}`})}function yn(t,e=!1){return Ie(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt,group:vt.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const to=Ie({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),RC=Ie({name:"whitespace",pattern:/ +/,group:vt.SKIPPED}),IC=Ie({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:vt.SKIPPED}),Xu=Ie({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Yi=Ie({name:"command",pattern:/#/,start_chars_hint:["#"]});let g0=!1;function xC(t,e,n){if(!g0)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==to)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const y0=Ie({name:"text",pattern:xC,line_breaks:!1,start_chars_hint:qu.filter(t=>"@#/?':!".includes(t)===!1)}),_0=Ie({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),b0=Ie({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),w0=Ie({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),v0=Ie({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=Ie({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:qu}),E0=Ie({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),k0=Ie({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),S0=Ie({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:zt}),A0=Ie({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:zt}),T0=Ie({name:"islessthan",pattern:/<|below/,longer_alt:zt}),R0=Ie({name:"isgreaterthan",pattern:/>|above/,longer_alt:zt}),I0=Ie({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:zt}),x0=Ie({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:zt}),Zu=Ie({name:"or",pattern:/or/i,longer_alt:zt}),Ju=Ie({name:"not",pattern:/not/i,longer_alt:zt}),Yu=Ie({name:"and",pattern:/and/i,longer_alt:zt}),Qu=Ie({name:"plus",pattern:/\+/}),eh=Ie({name:"minus",pattern:/-/}),O0=Ie({name:"power",pattern:/\*\*/}),C0=Ie({name:"multiply",pattern:/\*/}),th=Ie({name:"divide",pattern:/\//}),N0=Ie({name:"moddivide",pattern:/%/}),L0=Ie({name:"floordivide",pattern:/%%/}),M0=Ie({name:"query",pattern:/\?/}),U0=Ie({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),P0=Ie({name:"rparen",pattern:/\)/,pop_mode:!0}),D0=Ie({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:qu,longer_alt:zt}),B0=yn("debugger"),nh=yn("if"),Ya=yn("do"),OC=yn("to",!0),rh=yn("done"),CC=yn("then",!0),ih=yn("else"),F0=yn("while"),$0=yn("repeat"),z0=yn("waitfor"),j0=Ie({name:"foreach",pattern:/foreach|for/,longer_alt:zt}),W0=yn("break"),G0=yn("continue");function H0(t){return[...t,k0,S0,A0,I0,T0,x0,R0,Zu,Ju,Yu,Qu,eh,O0,C0,th,L0,N0,M0,U0,P0,E0,zt]}const V0=H0([y0,Xu,D0,Yi,_0,b0,w0,v0,to,RC,W0,G0,B0,rh,Ya,ih,j0,nh,$0,CC,OC,z0,F0]),NC=new vt({defaultMode:"use_newlines",modes:{use_newlines:V0,ignore_newlines:H0([IC])}},{skipValidations:!Wn,ensureOptimizations:Wn});function K0(t){g0=!0;const e=NC.tokenize(t||` 
`),[n]=(Ge(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push($a(to,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function q0(t,e=!0){const[n,...r]=t;switch(Pe(n)){default:return e?{type:he.OBJECT,values:t}:{type:he.CONST,values:t};case"loader":return{type:he.LOADER,values:r};case"board":return{type:he.BOARD,values:r};case"object":return{type:he.OBJECT,values:r};case"terrain":return{type:he.TERRAIN,values:r};case"charset":return{type:he.CHARSET,values:r};case"palette":return{type:he.PALETTE,values:r};case"rn":case"range":return{type:he.RANGE,values:r};case"sl":case"select":return{type:he.SELECT,values:r};case"nm":case"number":return{type:he.NUMBER,values:r};case"tx":case"text":return{type:he.TEXT,values:r};case"ln":case"link":return{type:he.LINK,values:r};case"hk":case"hotkey":return{type:he.HOTKEY,values:r};case"scroll":return{type:he.SCROLL,values:r};case"copyit":return{type:he.COPYIT,values:r}}}function _n(t){switch(t){case he.LOADER:return"loader";case he.BOARD:return"board";case he.OBJECT:return"object";case he.TERRAIN:return"terrain";case he.CHARSET:return"charset";case he.PALETTE:return"palette";case he.CONST:return"const";case he.RANGE:return"range";case he.SELECT:return"select";case he.NUMBER:return"number";case he.TEXT:return"text";case he.LINK:return"link";case he.HOTKEY:return"hotkey";case he.SCROLL:return"scroll";case he.COPYIT:return"copyit"}}var sh;try{sh=new TextDecoder}catch{}var se,bn,M=0,Xe={},Ce,Vr,wn=0,Qn=0,Tt,Sr,Yt=[],xe,X0={useRecords:!1,mapsAsObjects:!0};class Z0{}const J0=new Z0;J0.name="MessagePack 0xC1";var Kr=!1,Y0=2,Q0;try{new Function("")}catch{Y0=1/0}class no{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(se)return fy(()=>(uh(),this?this.unpack(e,n):no.prototype.unpack.call(X0,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof n=="object"?(bn=n.end||e.length,M=n.start||0):(M=0,bn=n>-1?n:e.length),Qn=0,Vr=null,Tt=null,se=e;try{xe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw se=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof no){if(Xe=this,this.structures)return Ce=this.structures,Qa(n);(!Ce||Ce.length>0)&&(Ce=[])}else Xe=X0,(!Ce||Ce.length>0)&&(Ce=[]);return Qa(n)}unpackMultiple(e,n){let r,i=0;try{Kr=!0;let s=e.length,o=this?this.unpack(e,s):ec.unpack(e,s);if(n){if(n(o,i,M)===!1)return;for(;M<s;)if(i=M,n(Qa(),i,M)===!1)return}else{for(r=[o];M<s;)i=M,r.push(Qa());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Kr=!1,uh()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Qa(t){try{if(!Xe.trusted&&!Kr){let n=Ce.sharedLength||0;n<Ce.length&&(Ce.length=n)}let e;if(Xe.randomAccessStructure&&se[M]<64&&se[M]>=32&&Q0?(e=Q0(se,M,bn,Xe),se=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),M=bn):e=ct(),Tt&&(M=Tt.postBundlePosition,Tt=null),Kr&&(Ce.restoreStructures=null),M==bn)Ce&&Ce.restoreStructures&&ey(),Ce=null,se=null,Sr&&(Sr=null);else{if(M>bn)throw new Error("Unexpected end of MessagePack data");if(!Kr){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ce&&Ce.restoreStructures&&ey(),uh(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||M>bn)&&(e.incomplete=!0),e}}function ey(){for(let t in Ce.restoreStructures)Ce[t]=Ce.restoreStructures[t];Ce.restoreStructures=null}function ct(){let t=se[M++];if(t<160)if(t<128){if(t<64)return t;{let e=Ce[t&63]||Xe.getStructures&&ny()[t&63];return e?(e.read||(e.read=oh(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=cy();r==="__proto__"&&(r="__proto_"),e[r]=ct()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ct(),ct());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=ct();return Xe.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Qn>=M)return Vr.slice(M-wn,(M+=e)-wn);if(Qn==0&&bn<140){let n=e<16?ch(e):sy(e);if(n!=null)return n}return ah(e)}else{let e;switch(t){case 192:return null;case 193:return Tt?(e=ct(),e>0?Tt[1].slice(Tt.position1,Tt.position1+=e):Tt[0].slice(Tt.position0,Tt.position0-=e)):J0;case 194:return!1;case 195:return!0;case 196:if(e=se[M++],e===void 0)throw new Error("Unexpected end of buffer");return lh(e);case 197:return e=xe.getUint16(M),M+=2,lh(e);case 198:return e=xe.getUint32(M),M+=4,lh(e);case 199:return wi(se[M++]);case 200:return e=xe.getUint16(M),M+=2,wi(e);case 201:return e=xe.getUint32(M),M+=4,wi(e);case 202:if(e=xe.getFloat32(M),Xe.useFloat32>2){let n=hh[(se[M]&127)<<1|se[M+1]>>7];return M+=4,(n*e+(e>0?.5:-.5)>>0)/n}return M+=4,e;case 203:return e=xe.getFloat64(M),M+=8,e;case 204:return se[M++];case 205:return e=xe.getUint16(M),M+=2,e;case 206:return e=xe.getUint32(M),M+=4,e;case 207:return Xe.int64AsType==="number"?(e=xe.getUint32(M)*4294967296,e+=xe.getUint32(M+4)):Xe.int64AsType==="string"?e=xe.getBigUint64(M).toString():Xe.int64AsType==="auto"?(e=xe.getBigUint64(M),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=xe.getBigUint64(M),M+=8,e;case 208:return xe.getInt8(M++);case 209:return e=xe.getInt16(M),M+=2,e;case 210:return e=xe.getInt32(M),M+=4,e;case 211:return Xe.int64AsType==="number"?(e=xe.getInt32(M)*4294967296,e+=xe.getUint32(M+4)):Xe.int64AsType==="string"?e=xe.getBigInt64(M).toString():Xe.int64AsType==="auto"?(e=xe.getBigInt64(M),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=xe.getBigInt64(M),M+=8,e;case 212:if(e=se[M++],e==114)return uy(se[M++]&63);{let n=Yt[e];if(n)return n.read?(M++,n.read(ct())):n.noBuffer?(M++,n()):n(se.subarray(M,++M));throw new Error("Unknown extension "+e)}case 213:return e=se[M],e==114?(M++,uy(se[M++]&63,se[M++])):wi(2);case 214:return wi(4);case 215:return wi(8);case 216:return wi(16);case 217:return e=se[M++],Qn>=M?Vr.slice(M-wn,(M+=e)-wn):MC(e);case 218:return e=xe.getUint16(M),M+=2,Qn>=M?Vr.slice(M-wn,(M+=e)-wn):UC(e);case 219:return e=xe.getUint32(M),M+=4,Qn>=M?Vr.slice(M-wn,(M+=e)-wn):PC(e);case 220:return e=xe.getUint16(M),M+=2,ry(e);case 221:return e=xe.getUint32(M),M+=4,ry(e);case 222:return e=xe.getUint16(M),M+=2,iy(e);case 223:return e=xe.getUint32(M),M+=4,iy(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const LC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function oh(t,e){function n(){if(n.count++>Y0){let i=t.read=new Function("r","return function(){return "+(Xe.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":LC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ct);return t.highByte===0&&(t.read=ty(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=ct()}return Xe.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?ty(e,n):n}const ty=(t,e)=>function(){let n=se[M++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ce[r]||ny()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=oh(i,t)),i.read()};function ny(){let t=fy(()=>(se=null,Xe.getStructures()));return Ce=Xe._mergeStructures(t,Ce)}var ah=ro,MC=ro,UC=ro,PC=ro;function ro(t){let e;if(t<16&&(e=ch(t)))return e;if(t>64&&sh)return sh.decode(se.subarray(M,M+=t));const n=M+t,r=[];for(e="";M<n;){const i=se[M++];if(!(i&128))r.push(i);else if((i&224)===192){const s=se[M++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=se[M++]&63,o=se[M++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=se[M++]&63,o=se[M++]&63,a=se[M++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Rt.apply(String,r),r.length=0)}return r.length>0&&(e+=Rt.apply(String,r)),e}function ry(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=ct();return Xe.freezeData?Object.freeze(e):e}function iy(t){if(Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=cy();r==="__proto__"&&(r="__proto_"),e[r]=ct()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ct(),ct());return e}}var Rt=String.fromCharCode;function sy(t){let e=M,n=new Array(t);for(let r=0;r<t;r++){const i=se[M++];if((i&128)>0){M=e;return}n[r]=i}return Rt.apply(String,n)}function ch(t){if(t<4)if(t<2){if(t===0)return"";{let e=se[M++];if((e&128)>1){M-=1;return}return Rt(e)}}else{let e=se[M++],n=se[M++];if((e&128)>0||(n&128)>0){M-=2;return}if(t<3)return Rt(e,n);let r=se[M++];if((r&128)>0){M-=3;return}return Rt(e,n,r)}else{let e=se[M++],n=se[M++],r=se[M++],i=se[M++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){M-=4;return}if(t<6){if(t===4)return Rt(e,n,r,i);{let s=se[M++];if((s&128)>0){M-=5;return}return Rt(e,n,r,i,s)}}else if(t<8){let s=se[M++],o=se[M++];if((s&128)>0||(o&128)>0){M-=6;return}if(t<7)return Rt(e,n,r,i,s,o);let a=se[M++];if((a&128)>0){M-=7;return}return Rt(e,n,r,i,s,o,a)}else{let s=se[M++],o=se[M++],a=se[M++],c=se[M++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){M-=8;return}if(t<10){if(t===8)return Rt(e,n,r,i,s,o,a,c);{let l=se[M++];if((l&128)>0){M-=9;return}return Rt(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=se[M++],u=se[M++];if((l&128)>0||(u&128)>0){M-=10;return}if(t<11)return Rt(e,n,r,i,s,o,a,c,l,u);let h=se[M++];if((h&128)>0){M-=11;return}return Rt(e,n,r,i,s,o,a,c,l,u,h)}else{let l=se[M++],u=se[M++],h=se[M++],d=se[M++];if((l&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){M-=12;return}if(t<14){if(t===12)return Rt(e,n,r,i,s,o,a,c,l,u,h,d);{let f=se[M++];if((f&128)>0){M-=13;return}return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f)}}else{let f=se[M++],p=se[M++];if((f&128)>0||(p&128)>0){M-=14;return}if(t<15)return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f,p);let m=se[M++];if((m&128)>0){M-=15;return}return Rt(e,n,r,i,s,o,a,c,l,u,h,d,f,p,m)}}}}}function oy(){let t=se[M++],e;if(t<192)e=t-160;else switch(t){case 217:e=se[M++];break;case 218:e=xe.getUint16(M),M+=2;break;case 219:e=xe.getUint32(M),M+=4;break;default:throw new Error("Expected string")}return ro(e)}function lh(t){return Xe.copyBuffers?Uint8Array.prototype.slice.call(se,M,M+=t):se.subarray(M,M+=t)}function wi(t){let e=se[M++];if(Yt[e]){let n;return Yt[e](se.subarray(M,n=M+=t),r=>{M=r;try{return ct()}finally{M=n}})}else throw new Error("Unknown extension type "+e)}var ay=new Array(4096);function cy(){let t=se[M++];if(t>=160&&t<192){if(t=t-160,Qn>=M)return Vr.slice(M-wn,(M+=t)-wn);if(!(Qn==0&&bn<180))return ah(t)}else return M--,ly(ct());let e=(t<<5^(t>1?xe.getUint16(M):t>0?se[M]:0))&4095,n=ay[e],r=M,i=M+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=xe.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=se[r++],s!=n[o++]){r=1879048192;break}if(r===i)return M=r,n.string;i-=3,r=M}for(n=[],ay[e]=n,n.bytes=t;r<i;)s=xe.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=se[r++],n.push(s);let a=t<16?ch(t):sy(t);return a!=null?n.string=a:n.string=ah(t)}function ly(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const uy=(t,e)=>{let n=ct().map(ly),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ce[t];return i&&(i.isShared||Kr)&&((Ce.restoreStructures||(Ce.restoreStructures=[]))[t]=i),Ce[t]=n,n.read=oh(n,r),n.read()};Yt[0]=()=>{},Yt[0].noBuffer=!0,Yt[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let DC={Error,TypeError,ReferenceError};Yt[101]=()=>{let t=ct();return(DC[t[0]]||Error)(t[1],{cause:t[2]})},Yt[105]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=xe.getUint32(M-4);Sr||(Sr=new Map);let n=se[M],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Sr.set(e,i);let s=ct();return i.used?Object.assign(r,s):(i.target=s,s)},Yt[112]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=xe.getUint32(M-4),n=Sr.get(e);return n.used=!0,n.target},Yt[115]=()=>new Set(ct());const hy=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let BC=typeof globalThis=="object"?globalThis:window;Yt[116]=t=>{let e=t[0],n=hy[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new BC[n](Uint8Array.prototype.slice.call(t,1).buffer)},Yt[120]=()=>{let t=ct();return new RegExp(t[0],t[1])};const FC=[];Yt[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=M;return M+=e-t.length,Tt=FC,Tt=[oy(),oy()],Tt.position0=0,Tt.position1=0,Tt.postBundlePosition=M,M=n,ct()},Yt[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function fy(t){let e=bn,n=M,r=wn,i=Qn,s=Vr,o=Sr,a=Tt,c=new Uint8Array(se.slice(0,bn)),l=Ce,u=Ce.slice(0,Ce.length),h=Xe,d=Kr,f=t();return bn=e,M=n,wn=r,Qn=i,Vr=s,Sr=o,Tt=a,se=c,Kr=d,Ce=l,Ce.splice(0,Ce.length,...u),Xe=h,xe=new DataView(se.buffer,se.byteOffset,se.byteLength),f}function uh(){se=null,Sr=null,Ce=null}const hh=new Array(147);for(let t=0;t<256;t++)hh[t]=+("1e"+Math.floor(45.15-t*.30103));var ec=new no({useRecords:!1});const $C=ec.unpack;ec.unpackMultiple,ec.unpack;let zC=new Float32Array(1);new Uint8Array(zC.buffer,0,4);let tc;try{tc=new TextEncoder}catch{}let fh,dy;const nc=typeof Buffer<"u",rc=nc?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,py=nc?Buffer:Uint8Array,my=nc?4294967296:2144337920;let j,io,Ze,P=0,jt,nt=null,jC;const WC=21760,GC=/[\u0080-\uFFFF]/,Qi=Symbol("record-id");class HC extends no{constructor(e){super(e),this.offset=0;let n,r,i,s,o=py.prototype.utf8Write?function(E,g){return j.utf8Write(E,g,j.byteLength-g)}:tc&&tc.encodeInto?function(E,g){return tc.encodeInto(E,j.subarray(g)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=u>32||h+u>64,f=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(E,g){if(j||(j=new rc(8192),Ze=j.dataView||(j.dataView=new DataView(j.buffer,0,8192)),P=0),jt=j.length-10,jt-P<2048?(j=new rc(j.length),Ze=j.dataView||(j.dataView=new DataView(j.buffer,0,j.length)),jt=j.length-10,P=0):P=P+7&2147483640,n=P,g&YC&&(P+=g&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof E!="string"?(nt=[],nt.size=1/0):nt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let z=i.sharedLength||0;if(z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<z;U++){let ee=i[U];if(!ee)continue;let H,Y=i.transitions;for(let F=0,D=ee.length;F<D;F++){let ae=ee[F];H=Y[ae],H||(H=Y[ae]=Object.create(null)),Y=H}Y[Qi]=U+64}this.lastNamedStructuresLength=z}c||(i.nextId=z+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&E&&E.constructor&&E.constructor===Object?x(E):A(E);let z=nt;if(nt&&_y(n,A,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((F,D)=>F.offset>D.offset?1:-1),ee=U.length,H=-1;for(;z&&ee>0;){let F=U[--ee].offset+n;F<z.stringsPosition+n&&H===-1&&(H=0),F>z.position+n?H>=0&&(H+=6):(H>=0&&(Ze.setUint32(z.position+n,Ze.getUint32(z.position+n)+H),H=-1),z=z.previous,ee++)}H>=0&&z&&Ze.setUint32(z.position+n,Ze.getUint32(z.position+n)+H),P+=U.length*6,P>jt&&L(P),a.offset=P;let Y=KC(j.subarray(n,P),U);return s=null,Y}return a.offset=P,g&ZC?(j.start=n,j.end=P,j):j.subarray(n,P)}catch(z){throw N=z,z}finally{if(i&&(w(),r&&a.saveStructures)){let z=i.sharedLength||0,U=j.subarray(n,P),ee=qC(i,a);if(!N)return a.saveStructures(ee,ee.isCompatible)===!1?a.pack(E,g):(a.lastNamedStructuresLength=z,j.length>1073741824&&(j=null),U)}j.length>1073741824&&(j=null),g&JC&&(P=n)}};const w=()=>{_<10&&_++;let E=i.sharedLength||0;if(i.length>E&&!c&&(i.length=E),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let g=0,N=m.length;g<N;g++)m[g][Qi]=0;m=[]}},v=E=>{var g=E.length;g<16?j[P++]=144|g:g<65536?(j[P++]=220,j[P++]=g>>8,j[P++]=g&255):(j[P++]=221,Ze.setUint32(P,g),P+=4);for(let N=0;N<g;N++)A(E[N])},A=E=>{P>jt&&(j=L(P));var g=typeof E,N;if(g==="string"){let z=E.length;if(nt&&z>=4&&z<4096){if((nt.size+=z)>WC){let Y,F=(nt[0]?nt[0].length*3+nt[1].length:0)+10;P+F>jt&&(j=L(P+F));let D;nt.position?(D=nt,j[P]=200,P+=3,j[P++]=98,Y=P-n,P+=4,_y(n,A,0),Ze.setUint16(Y+n-3,P-n-Y)):(j[P++]=214,j[P++]=98,Y=P-n,P+=4),nt=["",""],nt.previous=D,nt.size=0,nt.position=Y}let H=GC.test(E);nt[H?0:1]+=E,j[P++]=193,A(H?-z:z);return}let U;z<32?U=1:z<256?U=2:z<65536?U=3:U=5;let ee=z*3;if(P+ee>jt&&(j=L(P+ee)),z<64||!o){let H,Y,F,D=P+U;for(H=0;H<z;H++)Y=E.charCodeAt(H),Y<128?j[D++]=Y:Y<2048?(j[D++]=Y>>6|192,j[D++]=Y&63|128):(Y&64512)===55296&&((F=E.charCodeAt(H+1))&64512)===56320?(Y=65536+((Y&1023)<<10)+(F&1023),H++,j[D++]=Y>>18|240,j[D++]=Y>>12&63|128,j[D++]=Y>>6&63|128,j[D++]=Y&63|128):(j[D++]=Y>>12|224,j[D++]=Y>>6&63|128,j[D++]=Y&63|128);N=D-P-U}else N=o(E,P+U);N<32?j[P++]=160|N:N<256?(U<2&&j.copyWithin(P+2,P+1,P+1+N),j[P++]=217,j[P++]=N):N<65536?(U<3&&j.copyWithin(P+3,P+2,P+2+N),j[P++]=218,j[P++]=N>>8,j[P++]=N&255):(U<5&&j.copyWithin(P+5,P+3,P+3+N),j[P++]=219,Ze.setUint32(P,N),P+=4),P+=N}else if(g==="number")if(E>>>0===E)E<32||E<128&&this.useRecords===!1||E<64&&!this.randomAccessStructure?j[P++]=E:E<256?(j[P++]=204,j[P++]=E):E<65536?(j[P++]=205,j[P++]=E>>8,j[P++]=E&255):(j[P++]=206,Ze.setUint32(P,E),P+=4);else if(E>>0===E)E>=-32?j[P++]=256+E:E>=-128?(j[P++]=208,j[P++]=E+256):E>=-32768?(j[P++]=209,Ze.setInt16(P,E),P+=2):(j[P++]=210,Ze.setInt32(P,E),P+=4);else{let z;if((z=this.useFloat32)>0&&E<4294967296&&E>=-2147483648){j[P++]=202,Ze.setFloat32(P,E);let U;if(z<4||(U=E*hh[(j[P]&127)<<1|j[P+1]>>7])>>0===U){P+=4;return}else P--}j[P++]=203,Ze.setFloat64(P,E),P+=8}else if(g==="object"||g==="function")if(!E)j[P++]=192;else{if(s){let U=s.get(E);if(U){if(!U.id){let ee=s.idsToInsert||(s.idsToInsert=[]);U.id=ee.push(U)}j[P++]=214,j[P++]=112,Ze.setUint32(P,U.id),P+=4;return}else s.set(E,{offset:P-n})}let z=E.constructor;if(z===Object)$(E);else if(z===Array)v(E);else if(z===Map)if(this.mapAsEmptyObject)j[P++]=128;else{N=E.size,N<16?j[P++]=128|N:N<65536?(j[P++]=222,j[P++]=N>>8,j[P++]=N&255):(j[P++]=223,Ze.setUint32(P,N),P+=4);for(let[U,ee]of E)A(U),A(ee)}else{for(let U=0,ee=fh.length;U<ee;U++){let H=dy[U];if(E instanceof H){let Y=fh[U];if(Y.write){Y.type&&(j[P++]=212,j[P++]=Y.type,j[P++]=0);let ne=Y.write.call(this,E);ne===E?Array.isArray(E)?v(E):$(E):A(ne);return}let F=j,D=Ze,ae=P;j=null;let te;try{te=Y.pack.call(this,E,ne=>(j=F,F=null,P+=ne,P>jt&&L(P),{target:j,targetView:Ze,position:P-ne}),A)}finally{F&&(j=F,Ze=D,P=ae,jt=j.length-10)}te&&(te.length+P>jt&&L(te.length+P),P=VC(te,j,P,Y.type));return}}if(Array.isArray(E))v(E);else{if(E.toJSON){const U=E.toJSON();if(U!==E)return A(U)}if(g==="function")return A(this.writeFunction&&this.writeFunction(E));$(E)}}}else if(g==="boolean")j[P++]=E?195:194;else if(g==="bigint"){if(E<BigInt(1)<<BigInt(63)&&E>=-(BigInt(1)<<BigInt(63)))j[P++]=211,Ze.setBigInt64(P,E);else if(E<BigInt(1)<<BigInt(64)&&E>0)j[P++]=207,Ze.setBigUint64(P,E);else if(this.largeBigIntToFloat)j[P++]=203,Ze.setFloat64(P,Number(E));else{if(this.largeBigIntToString)return A(E.toString());if(this.useBigIntExtension&&E<BigInt(2)**BigInt(1023)&&E>-(BigInt(2)**BigInt(1023))){j[P++]=199,P++,j[P++]=66;let z=[],U;do{let ee=E&BigInt(255);U=(ee&BigInt(128))===(E<BigInt(0)?BigInt(128):BigInt(0)),z.push(ee),E>>=BigInt(8)}while(!((E===BigInt(0)||E===BigInt(-1))&&U));j[P-2]=z.length;for(let ee=z.length;ee>0;)j[P++]=Number(z[--ee]);return}else throw new RangeError(E+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}P+=8}else if(g==="undefined")this.encodeUndefinedAsNil?j[P++]=192:(j[P++]=212,j[P++]=0,j[P++]=0);else throw new Error("Unknown type: "+g)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?E=>{let g;if(this.skipValues){g=[];for(let U in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(U))&&!this.skipValues.includes(E[U])&&g.push(U)}else g=Object.keys(E);let N=g.length;N<16?j[P++]=128|N:N<65536?(j[P++]=222,j[P++]=N>>8,j[P++]=N&255):(j[P++]=223,Ze.setUint32(P,N),P+=4);let z;if(this.coercibleKeyAsNumber)for(let U=0;U<N;U++){z=g[U];let ee=Number(z);A(isNaN(ee)?z:ee),A(E[z])}else for(let U=0;U<N;U++)A(z=g[U]),A(E[z])}:E=>{j[P++]=222;let g=P-n;P+=2;let N=0;for(let z in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(z))&&(A(z),A(E[z]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');j[g+++n]=N>>8,j[g+n]=N&255},T=this.useRecords===!1?C:e.progressiveRecords&&!d?E=>{let g,N=i.transitions||(i.transitions=Object.create(null)),z=P++-n,U;for(let ee in E)if(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(ee)){if(g=N[ee],g)N=g;else{let H=Object.keys(E),Y=N;N=i.transitions;let F=0;for(let D=0,ae=H.length;D<ae;D++){let te=H[D];g=N[te],g||(g=N[te]=Object.create(null),F++),N=g}z+n+1==P?(P--,V(N,H,F)):Q(N,H,z,F),U=!0,N=Y[ee]}A(E[ee])}if(!U){let ee=N[Qi];ee?j[z+n]=ee:Q(N,Object.keys(E),z,0)}}:E=>{let g,N=i.transitions||(i.transitions=Object.create(null)),z=0;for(let ee in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(ee))&&(g=N[ee],g||(g=N[ee]=Object.create(null),z++),N=g);let U=N[Qi];U?U>=96&&d?(j[P++]=((U-=96)&31)+96,j[P++]=U>>5):j[P++]=U:V(N,N.__keys__||Object.keys(E),z);for(let ee in E)(typeof E.hasOwnProperty!="function"||E.hasOwnProperty(ee))&&A(E[ee])},I=typeof this.useRecords=="function"&&this.useRecords,$=I?E=>{I(E)?T(E):C(E)}:T,L=E=>{let g;if(E>16777216){if(E-n>my)throw new Error("Packed buffer would be larger than maximum buffer size");g=Math.min(my,Math.round(Math.max((E-n)*(E>67108864?1.25:2),4194304)/4096)*4096)}else g=(Math.max(E-n<<2,j.length-1)>>12)+1<<12;let N=new rc(g);return Ze=N.dataView||(N.dataView=new DataView(N.buffer,0,g)),E=Math.min(E,j.length),j.copy?j.copy(N,0,n,E):N.set(j.slice(n,E)),P-=n,n=0,jt=N.length-10,j=N},V=(E,g,N)=>{let z=i.nextId;z||(z=64),z<f&&this.shouldShareStructure&&!this.shouldShareStructure(g)?(z=i.nextOwnId,z<p||(z=f),i.nextOwnId=z+1):(z>=p&&(z=f),i.nextId=z+1);let U=g.highByte=z>=96&&d?z-96>>5:-1;E[Qi]=z,E.__keys__=g,i[z-64]=g,z<f?(g.isShared=!0,i.sharedLength=z-63,r=!0,U>=0?(j[P++]=(z&31)+96,j[P++]=U):j[P++]=z):(U>=0?(j[P++]=213,j[P++]=114,j[P++]=(z&31)+96,j[P++]=U):(j[P++]=212,j[P++]=114,j[P++]=z),N&&(b+=_*N),m.length>=h&&(m.shift()[Qi]=0),m.push(E),A(g))},Q=(E,g,N,z)=>{let U=j,ee=P,H=jt,Y=n;j=io,P=0,n=0,j||(io=j=new rc(8192)),jt=j.length-10,V(E,g,z),io=j;let F=P;if(j=U,P=ee,jt=H,n=Y,F>1){let D=P+F-1;D>jt&&L(D);let ae=N+n;j.copyWithin(ae+F,ae+1,P),j.set(io.slice(0,F),ae),P=D}else j[N+n]=io[0]},x=E=>{let g=jC(E,j,n,P,i,L,(N,z,U)=>{if(U)return r=!0;P=z;let ee=j;return A(N),w(),ee!==j?{position:P,targetView:Ze,target:j}:P},this);if(g===0)return $(E);P=g}}useBuffer(e){j=e,j.dataView||(j.dataView=new DataView(j.buffer,j.byteOffset,j.byteLength)),P=0}set position(e){P=e}get position(){return P}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}dy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Z0],fh=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?gy(t,16,e):yy(nc?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==py&&this.moreTypes?gy(t,hy.indexOf(n.name),e):yy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function gy(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function yy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function VC(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function KC(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function _y(t,e,n){if(nt.length>0){Ze.setUint32(nt.position+t,P+n-nt.position-t),nt.stringsPosition=P-t;let r=nt;nt=null,e(r[0]),e(r[1])}}function qC(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let by=new HC({useRecords:!1});const XC=by.pack;by.pack;const ZC=512,JC=1024,YC=2048;function vi(){return null}function so(t,e,n={}){if(!k(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];k(c)&&(a=c(a));const l=e[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function oo(t,e,n={}){if(k(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){Dt("format","binary",r.message)}}function QC(t){try{const e=ei(t);return XC(e)}catch(e){Dt("format","binary",e.message)}}function eN(t){try{return $C(t)}catch(e){Dt("format","binary",e.message)}}function wy(){return{id:at()}}var dh=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.headless=27]="headless",t[t.removed=28]="removed",t))(dh||{});function ic(t){return so(t,dh,{category:vi,kinddata:vi})}function sc(t){return oo(t,dh)}var ph=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(ph||{});function vy(t){return so(t,ph)}function Ey(t){return oo(t,ph)}function tN(t,e){return{id:at(),code:t,...e}}var mh=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(mh||{});function nN(t){return so(t,mh,{board:RN,object:ic,terrain:ic,charset:vy,palette:vy,stats:vi})}function rN(t){return oo(t,mh,{board:IN,object:sc,terrain:sc,charset:Ey,palette:Ey})}function ky(t){const e={...ao(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function iN(t){return k(t)?(t.stats=void 0,ao(t)):{}}function ao(t){var r;if(!k(t))return{};if(k((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=K0(t.code);let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Xu){const a=s.image.slice(1).split(" "),c=q0(a,n),l=Pe(c.values.join(" "));switch(n=!1,c.type){case he.LOADER:t.stats.type=Re.LOADER,t.stats.name=l;break;case he.BOARD:t.stats.type=Re.BOARD,t.stats.name=l;break;case he.OBJECT:t.stats.type=Re.OBJECT,t.stats.name=l;break;case he.TERRAIN:t.stats.type=Re.TERRAIN,t.stats.name=l;break;case he.CHARSET:t.stats.type=Re.CHARSET,t.stats.name=l;break;case he.PALETTE:t.stats.type=Re.PALETTE,t.stats.name=l;break;case he.CONST:{const[u,h]=c.values;if(ke(u)){const d=Pe(u);if(ke(h)){const f=parseFloat(h);t.stats[d]=Ee(f)?f:h}else Ee(h)?t.stats[d]=h:t.stats[d]=1}break}case he.RANGE:case he.SELECT:case he.NUMBER:case he.TEXT:case he.LINK:case he.HOTKEY:case he.SCROLL:{const[u,...h]=c.values;if(ke(u)){const d=Pe(u);t.stats[d]=h}break}}}}return k(t.stats.type)||(t.stats.type=Re.OBJECT),t.stats}function Sy(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return _n(he.LOADER);case Re.BOARD:return _n(he.BOARD);case Re.OBJECT:return _n(he.OBJECT);case Re.TERRAIN:return _n(he.TERRAIN);case Re.CHARSET:return _n(he.CHARSET);case Re.PALETTE:return _n(he.PALETTE)}}function oc(t){return ao(t).type??Re.ERROR}function ac(t){return Sy(oc(t))}function Ar(t){return ao(t).name??""}function Ay(t,e){const n=ky(t),r=Object.keys(n);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[s]=n[s];break;case"canpush":case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=He.ISWALK;break;case"isswim":case"isswimable":e.collision=He.ISSWIM;break;case"issolid":e.collision=He.ISSOLID;break;case"isbullet":e.collision=He.ISBULLET;break;case"canshoot":case"isdestructible":e.destructible=1;break}}}function gh(t){if(k(t))switch(oc(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:{k(t.board)||(t.board=TN()),t.board.id=t.id;const e=ky(t);return t.board.isdark=k(e.isdark)&&e.isdark?1:0,t.board.over=e.over??t.board.over,t.board.under=e.under??t.board.under,t.board.exitnorth=e.exitnorth??t.board.exitnorth,t.board.exitsouth=e.exitsouth??t.board.exitsouth,t.board.exitwest=e.exitwest??t.board.exitwest,t.board.exiteast=e.exiteast??t.board.exiteast,t.board.timelimit=e.timelimit??t.board.timelimit,t.board.restartonzap=e.restartonzap??t.board.restartonzap,t.board.maxplayershots=e.maxplayershots??t.board.maxplayershots,t.board}case Re.OBJECT:return k(t.object)||(t.object=wy()),t.object.name=Ar(t),Ay(t,t.object),t.object;case Re.TERRAIN:return k(t.terrain)||(t.terrain=wy()),t.terrain.name=Ar(t),Ay(t,t.terrain),t.terrain;case Re.CHARSET:return k(t.charset),t.charset;case Re.PALETTE:return k(t.palette),t.palette}}function Ty(t){return{id:at(),name:tb(),timestamp:0,activelist:[],pages:t,flags:{}}}var yh=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t))(yh||{});function sN(t){return so(t,yh,{pages:e=>e.map(nN)})}function oN(t){return oo(t,yh,{pages:e=>e.map(rN)})}function Ei(t,e){if(!k(t))return;const n=Pe(e);return t.pages.find(i=>i.id===e||n===Ar(i))}function Ry(t,e,n){if(!k(t))return;const r=Pe(n);return t.pages.find(s=>oc(s)===e&&(s.id===n||r===Ar(s)))}function aN(t,e){return k(t)?t.pages.filter(n=>oc(n)===e):[]}function cN(t,e){if(!k(t)||!k(e))return!1;const n=Ei(t,e.id);return k(n)?!1:(t.pages.push(e),!0)}function lN(t,e){const n=Ei(t,e);if(k(t)&&k(n)){const r=Pe(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==Ar(i)),n}}function sn(t,e){if(k(e)&&k(e.kind))return k(e.kinddata)||(e.kinddata=k(e.id)?cc(t,e.kind):xy(t,e.kind)),e.kinddata}function uN(t,e,n){const r=sn(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function Iy(t,e){const n=sn(t,e);return{char:(e==null?void 0:e.char)??(n==null?void 0:n.char)??1,color:(e==null?void 0:e.color)??(n==null?void 0:n.color)??Le.WHITE,bg:(e==null?void 0:e.bg)??(n==null?void 0:n.bg)??Le.ONCLEAR,light:(e==null?void 0:e.light)??(n==null?void 0:n.light)}}function cc(t,e){const n=e??"",r=Ry(t,Re.OBJECT,n);if(k(r)){const i=gh(r);return{...ei(i),name:n,code:r.code}}}function xy(t,e){const n=e??"",r=Ry(t,Re.TERRAIN,n);if(k(r)){const i=gh(r);return{...ei(i),name:n,code:r.code}}}function es(t,e){const n=Ei(t,e);return gh(n)}function ts(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function _h(t,e){t&&delete t.flags[e]}function Oy(t,e,n){const r=ts(t,e);return r==null?void 0:r[n]}function hN(t,e,n,r){const i=ts(t,e);return i&&(i[n]=r),r}function lc(t,e){const n=Oy(t,e,"board");return es(t,ke(n)?n:"")}function bh(t,e,n){if(!k(t))return;hN(t,e,"board",n);const r=es(t,n);k(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function fN(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=Oy(t,r,"board");return ke(i)?i:""});return n1(n)}function Cy(t){return fN(t).map(n=>es(t,n)).filter(k)}function dN(t,e,n,r){const i=Si(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=et||r.y<0||r.y>=un||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*et,o=sn(t,i),a=i.collision??(o==null?void 0:o.collision),c=Si(e,e.lookup[s]??"");if(k(c))return!0;const l=e.terrain[s];if(k(l)){const u=sn(t,l),h=l.collision??(u==null?void 0:u.collision);if(Yl(a,h))return!0}return!1}function pN(t,e,n,r){const i=Si(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=et||r.y<0||r.y>=un)return{kind:"edge",collision:He.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*et,o=r.x+r.y*et,a=sn(t,i),c=i.collision??(a==null?void 0:a.collision),l=Si(e,e.lookup[o]??"");if(k(l))return{...l};const u=e.terrain[o];if(k(u)){const h=sn(t,u),d=u.collision??(h==null?void 0:h.collision);if(Yl(c,d))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function ns(t,e){const n=sn(t,e);return k(e==null?void 0:e.id)&&k(e.x)&&k(e.y)?Pe(e.name??(n==null?void 0:n.name)??"object"):Pe((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain")}function wh(t,e,n,r){if(!k(t)||!k(e)||!k(e.named)||!k(n))return;const i=ns(t,n);e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function mN(t,e,n){if(!(!k(t)||!k(e)||!k(e.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*et]=n.id}}function uc(t,e){if(!k(t)||!k(e)||k(e.lookup)&&k(e.named))return;const n=new Array(et*un).fill(void 0),r={},i=Object.values(e.objects);for(let a=0;a<i.length;++a){const c=i[a];if(k(c.x)&&k(c.y)&&k(c.id)&&!k(c.removed)){c.category=Eo.ISOBJECT,n[c.x+c.y*et]=c.id;const l=ns(t,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let s=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(k(c)){c.x=s,c.y=o,c.category=Eo.ISTERRAIN;const l=ns(t,c);r[l]||(r[l]=new Set),r[l].add(a)}++s,s>=et&&(s=0,++o)}e.lookup=n,e.named=r}function hc(t,e,n){return ns(t,e)!=="player"&&k(e)?(e.removed=n,!0):!1}function co(t,e,n){var r;if(k(t)&&k(e)&&k(n==null?void 0:n.id)){if(k(e.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*et;e.lookup[s]===n.id&&e.lookup.splice(s,1)}const i=ns(t,n);k((r=e.named)==null?void 0:r[i])&&k(n.id)&&e.named[i].delete(n.id)}}function gN(t,e,n){const r=[];if(!k(t)||!k(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>To*5&&(r.push(o.id),Gy(e,o.id))}return r}function yN(t,e,n){const r=[];if(!k(t)||!k(e))return r;e.lookup=void 0,uc(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=sn(t,a),l=a.code??(c==null?void 0:c.code)??"";l&&r.push({id:a.id,type:Re.OBJECT,code:l,object:a,terrain:void 0})}const s=gN(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function _N(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=cc(t,i);if(k(o)&&k(o.name)){const a=Ah(e,r,i);return mc(a,s),wh(t,e,a),a}}}function vh(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=xy(t,i);if(k(o)){const c=Wy(e,r,i);mc(c,s);const l=r.x+r.y*et;return wh(t,e,c,l),c}const a=cc(t,i);if(k(a)&&k(a.name)){const c=Ah(e,r,i);return mc(c,s),mN(t,e,c),wh(t,e,c),c}}}const Ny={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function qr(t){return Ge(t)&&Ly(t[0])}function Ly(t){return k(Eo[t])&&ke(t)}function My(t){if(ke(t))return Ny[Pe(t)]}function Uy(t){if(qr(t))return t;if(Ly(t))return[t];const e=My(t);if(k(e))return[e]}function fc(t){const e=O.words[t],n=Uy(e);if(qr(n))return[n,t+1];const[r,i]=Wt(t),s=Uy(r);return qr(s)?[s,i]:[void 0,t]}const Py={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};He.ISSOLID,He.ISWALK,He.ISSWIM,He.ISBULLET,He.ISWALK,He.ISSWIM;function ki(t){return Ge(t)&&Eh(t[0])}function Eh(t){return k(He[t])&&ke(t)}function bN(t){if(ke(t))return Py[Pe(t)]}function Dy(t){const e=O.words[t];if(ki(e))return[e,t+1];if(Eh(e))return[[e],t+1];const[n,r]=Wt(t);return ki(n)?[n,r]:Eh(n)?[[n],r]:[void 0,t]}function Wt(t,e=!0){var r,i,s,o,a;const n=O.words[t];if(My(n)){const[c,l]=fc(t);if(k(c))return[c,l]}if(bN(n)){const[c,l]=Dy(t);if(k(c))return[c,l]}if($y(n)){const[c,l]=pc(t);if(k(c))return[c,l]}if(ke(n)&&Pe(n)==="rnd"){const[c,l]=Wt(t+1),[u,h]=Wt(l);return Ee(c)&&Ee(u)?[Ls(c,u),h]:Ee(c)?[Ls(0,c),l]:[Ls(0,1),t+1]}if(Fp(n)){const[c,l]=Jl(t);if(k(c))return[c,l]}if(!k(n))return[void 0,t];if(gr(n)||Ee(n)||Ge(n))return[n,t+1];if(ke(n)){const c=Pe(n);if(e){const l=(r=O.get)==null?void 0:r.call(O,n);if(k(l))return[l,t+1]}switch(c){case"aligned":case"alligned":{const l=Hp(O.board,O.element,O.player);return!k(O.element)||!k(l)?[0,t+1]:[O.element.x===l.x||O.element.y===l.y?1:0,t+1]}case"contact":{const l=Hp(O.board,O.element,O.player);if(!k(O.element)||!k(l))return[0,t+1];const u=(l.x??0)-(((i=O.element)==null?void 0:i.x)??0),h=(l.y??0)-(((s=O.element)==null?void 0:s.y)??0);return[u===0&&Math.abs(h)<2||h===0&&Math.abs(u)<2?1:0,t+1]}case"blocked":{const[l,u]=J(O.words,t+1,[K.DIR]);return[dN(O.book,O.board,O.element,l)?1:0,u]}case"any":{const[l,u]=J(O.words,t+1,[K.KIND]),h=la(l)??"",d=Ms(O.board,h);return[Vp(d,l).length?1:0,u]}case"rnd":return[Ls(0,1),t+1];case"abs":{const[l,u]=J(O.words,t+1,[K.NUMBER]);return[Math.abs(l),u]}case"ceil":{const[l,u]=J(O.words,t+1,[K.NUMBER]);return[Math.ceil(l),u]}case"floor":{const[l,u]=J(O.words,t+1,[K.NUMBER]);return[Math.floor(l),u]}case"round":{const[l,u]=J(O.words,t+1,[K.NUMBER]);return[Math.round(l),u]}case"min":{const l=[];for(let u=t+1;u<O.words.length;){const[h,d]=Wt(u);if(Ge(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!vn(h))return[mr(h),d];u=d,l.push(h)}return[Math.min(...l),O.words.length]}case"max":{const l=[];for(let u=t+1;u<O.words.length;){const[h,d]=Wt(u);if(Ge(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!vn(h))return[mr(h),d];u=d,l.push(h)}return[Math.max(...l),O.words.length]}case"clamp":{const[l,u,h,d]=J(O.words,t+1,[K.NUMBER,K.NUMBER,K.NUMBER]);return[Gn(l,u,h),d]}case"pick":{const l=[];for(let u=t+1;u<O.words.length;){const[h,d]=Wt(u);if(Ge(h)&&!gr(h)&&!yr(h)&&!qr(h)&&!ki(h)&&!vn(h))return[mr(h),d];u=d,l.push(h)}return[mr(l),O.words.length]}case"range":{const[l,u,h,d]=J(O.words,t+1,[K.NUMBER,K.MAYBE_NUMBER,K.MAYBE_NUMBER]);return[Zl(l,u,h),d]}case"run":{const[l,u]=J(O.words,t+1,[K.STRING]);return Rc(l),[(o=O.get)==null?void 0:o.call(O,"arg"),u]}case"runwith":{const[l,u,h]=J(O.words,t+1,[K.ANY,K.STRING]);return k(O.element)&&(O.element.arg=l),Rc(u),[(a=O.get)==null?void 0:a.call(O,"arg"),h]}}}return[n,t+1]}function wN(t){return k(t)&&t<Le.ONBLACK?t:void 0}function vN(t){return k(t)&&t>Le.WHITE&&t<Le.ONCLEAR?t-Le.ONBLACK:void 0}const dc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function vn(t){return Ge(t)&&Fy(t[0])}function By(t){return vn(t)&&t[0].startsWith("ON")}function Fy(t){return k(Le[t])&&ke(t)}function $y(t){if(ke(t))return dc[Pe(t)]}function EN(t){return t.map(e=>Le[e]).find(e=>k(e)&&e<Le.ONBLACK)}function kN(t){return t.map(e=>Le[e]).find(e=>k(e)&&e>=Le.ONBLACK)}function zy(t){if(vn(t))return t;if(Fy(t))return[t];const e=$y(t);if(k(e))return[e]}function jy(t){const e=O.words[t],n=zy(e);if(vn(n))return[n,t+1];const[r,i]=Wt(t),s=zy(r);return vn(s)?[s,i]:[void 0,t]}function pc(t){const e=[];let n=t;const[r,i]=jy(t);if(vn(r)&&(e.push(...r),n=i),vn(e)&&!By(e)){const[s,o]=jy(i);By(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function SN(t){const e={};return t.every(n=>{const r=Le[n];k(r)&&(r<Le.ONBLACK?e.color=r:e.bg=r-Le.ONBLACK)}),e}function AN(){return new Array(et*un).map(()=>{})}function TN(t=Sb){const e={terrain:AN(),objects:{},id:""};return t(e)}var kh=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t))(kh||{});function RN(t){return so(t,kh,{terrain:e=>e.map(ic),objects:e=>Object.values(e).map(ic),id:vi,named:vi,lookup:vi,codepage:vi})}function IN(t){return oo(t,kh,{terrain:e=>e.map(sc),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=sc(e[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function xN(t,e){return!k(t)||e.x<0||e.x>=et||e.y<0||e.y>=un?-1:e.x+e.y*et}function Sh(t){var e;return Pe((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object")}function ON(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??Le.BLACK}function CN(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??Le.BLACK}function mc(t,e){if(!k(t)||!vn(e))return;const{color:n,bg:r}=SN(e);k(n)&&(t.color=n),k(r)&&(t.bg=r)}function NN(t,e){if(!k(t)||!k(e)||!k(e.x)||!k(e.y)||e.x<0||e.x>=et||e.y<0||e.y>=un)return;const n={...e},r=e.x+e.y*et;return t.terrain[r]=n,e}function LN(t,e){if(!k(t)||!k(e))return;const n={...e,id:e.id??at()};return t.objects[n.id]=n,n}function Wy(t,e,n){return NN(t,{...e,kind:n})}function Ah(t,e,n,r){return LN(t,{...e,id:r??void 0,kind:n})}function Si(t,e){if(t)return t.objects[e]}function Th(t,e,n,r,i){if(!k(t)||!k(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=Wi(o,s),c=et-1,l=un-1;for(let u=0;u<r.length;++u){const h=r1(r[u]);switch(h){case ce.IDLE:break;case ce.NORTH:case ce.SOUTH:case ce.WEST:case ce.EAST:At(s,h);break;case ce.BY:{const[d,f]=r.slice(u+1);Ee(d)&&Ee(f)&&(s.x=Gn(s.x+d,0,c),s.y=Gn(s.y+f,0,l)),u+=2;break}case ce.AT:{const[d,f]=r.slice(u+1);Ee(d)&&Ee(f)&&(s.x=Gn(d,0,c),s.y=Gn(f,0,l)),u+=2;break}case ce.FLOW:At(s,a);break;case ce.SEEK:{const d=MN(t,e,n);gr(d)&&At(s,Wi(i,d));break}case ce.RNDNS:At(s,mr(ce.NORTH,ce.SOUTH));break;case ce.RNDNE:At(s,mr(ce.NORTH,ce.EAST));break;case ce.RND:At(s,mr(ce.NORTH,ce.SOUTH,ce.WEST,ce.EAST));break;case ce.CW:case ce.CCW:case ce.OPP:case ce.RNDP:{const d=Th(t,e,n,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,h){case ce.CW:switch(Wi(i,d)){case ce.NORTH:At(s,ce.EAST);break;case ce.SOUTH:At(s,ce.WEST);break;case ce.EAST:At(s,ce.SOUTH);break;case ce.WEST:At(s,ce.NORTH);break}break;case ce.CCW:switch(Wi(i,d)){case ce.NORTH:At(s,ce.WEST);break;case ce.SOUTH:At(s,ce.EAST);break;case ce.EAST:At(s,ce.NORTH);break;case ce.WEST:At(s,ce.SOUTH);break}break;case ce.OPP:switch(Wi(i,d)){case ce.NORTH:At(s,ce.SOUTH);break;case ce.SOUTH:At(s,ce.NORTH);break;case ce.EAST:At(s,ce.WEST);break;case ce.WEST:At(s,ce.EAST);break}break;case ce.RNDP:switch(Wi(i,d)){case ce.NORTH:case ce.SOUTH:s.x+=mr(-1,1);break;case ce.WEST:case ce.EAST:s.y+=mr(-1,1);break}break}break}}}return s}function Gy(t,e){return k(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function MN(t,e,n){if(!k(t)||!k(e))return;const r=t.objects[n];if(k(r))return r;if(gr(e))return Kp(e,Ms(t,"player"))}const O={timestamp:0,book:void 0,board:void 0,element:void 0,player:"",isplayer:!1,words:[],get:void 0};var K=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(K||{});function It(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function J(t,e,n){var o,a,c,l;const r=O.words;O.words=t;const i=[];let s=e;for(let u=0;u<n.length;++u)switch(n[u]){case 0:{const[h,d]=fc(s);qr(h)||It("terrain or object",h),s=d,i.push(h);break}case 1:{const[h,d]=Dy(s);ki(h)||It("solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 2:{const[h,d]=pc(s);vn(h)||It("color",h),s=d,i.push(h);break}case 3:{const[h,d]=jp(s);Gi(h)?(s=d,i.push(h)):It("kind",h);break}case 4:{const[h,d]=Jl(s);if(yr(h)){const f=((o=O.element)==null?void 0:o.x)??0,p=((a=O.element)==null?void 0:a.y)??0,m={x:f,y:p},b=k(O.board)&&k(O.element)?Th(O.board,O.element,O.player,h,m):m;s=d,i.push(b)}else It("direction",h);break}case 5:{const[h,d]=Wt(s);if(ke(h)){const f=parseFloat(h);Ee(f)?i.push(f):It("number",h)}else Ee(h)?i.push(h):It("number",h);s=d;break}case 6:{const h=O.words[s];ke(h)||It("string",h),++s,i.push(h);break}case 7:{const[h,d]=Wt(s,!1);let f=h;if(ke(f)){const p=parseFloat(f);Ee(p)&&(f=p)}else Ee(f)||It("number or string",f);s=d,i.push(f);break}case 8:{const[h,d]=fc(s);h!==void 0&&!qr(h)&&It("optional terrain or object",h),s=d,i.push(h);break}case 9:{const[h,d]=fc(s);h!==void 0&&!ki(h)&&It("optional solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 10:{const[h,d]=pc(s);h!==void 0&&!vn(h)&&It("optional color",h),s=d,i.push(h);break}case 11:{const[h,d]=jp(s);h!==void 0&&!Gi(h)&&It("optional kind",h),s=d,i.push(h);break}case 12:{const[h,d]=Jl(s);if(yr(h)){const f=((c=O.element)==null?void 0:c.x)??0,p=((l=O.element)==null?void 0:l.y)??0,m={x:f,y:p},b=O.board?Th(O.board,O.element,O.player,h,m):m;s=d,i.push(b)}else h===void 0?(s=d,i.push(void 0)):It("optional direction",h);break}case 13:{const[h,d]=Wt(s);if(ke(h)){const f=parseFloat(h);Ee(f)?i.push(f):It("optional number",h)}else Ee(h)||h===void 0?i.push(h):It("optional number",h);s=d;break}case 14:{const h=O.words[s];h!==void 0&&!ke(h)&&It("optional string",h),++s,i.push(h);break}case 15:{const[h,d]=Wt(s,!1);let f=h;if(ke(f)){const p=parseFloat(f);Ee(p)&&(f=p)}else f!==void 0&&!Ee(f)&&It("number or string",f);s=d,i.push(f);break}case 16:{const[h,d]=Wt(s);s=d,i.push(h);break}}return O.words=r,[...i,s]}const UN=["echo","reverb","chorus","phaser","distortion","vibrato"];function Hy(t,e,n){const[r]=J(n,0,[K.MAYBE_STRING]),i=r??"",s=e.get(i);lk("audio",t,ke(s)?s:i)}function er(t,e){const[n]=J(e,0,[K.NUMBER_OR_STRING]);if(Ee(n))$l("audio",t,"volume",n);else if(UN.includes(Pe(n))){const[r,i]=J(e,1,[K.NUMBER_OR_STRING,K.MAYBE_NUMBER_OR_STRING]);dk("audio",t,n,r,i)}else{const[r]=J(e,1,[K.MAYBE_NUMBER_OR_STRING]);if(Ee(r)){const i=e.length-1,s=new Array(i).fill(K.NUMBER),o=J(e,1,s).slice(0,i),a=o.length===1?o[0]:o;$l("audio",t,n,a)}else{const[i]=J(e,1,[K.MAYBE_NUMBER_OR_STRING]);$l("audio",t,n,i)}}}const PN=pr().command("mainvolume",(t,e)=>{const[n]=J(e,0,[K.NUMBER]);return uk("audio",n,O.player),0}).command("drumvolume",(t,e)=>{const[n]=J(e,0,[K.NUMBER]);return hk("audio",n,O.player),0}).command("ttsvolume",(t,e)=>{const[n]=J(e,0,[K.NUMBER]);return fk("audio",n,O.player),0}).command("play",(t,e)=>(Hy(1,t,e),0)).command("synth",(t,e)=>{for(let n=1;n<=8;++n)er(n,e);return 0}).command("synth1",(t,e)=>(er(1,e),0)).command("synth2",(t,e)=>(er(2,e),0)).command("synth3",(t,e)=>(er(3,e),0)).command("synth4",(t,e)=>(er(4,e),0)).command("synth5",(t,e)=>(er(5,e),0)).command("synth6",(t,e)=>(er(6,e),0)).command("synth7",(t,e)=>(er(7,e),0)).command("synth8",(t,e)=>(er(8,e),0)).command("bgplay",(t,e)=>(Hy(0,t,e),0)).command("bgsynth",(t,e)=>(er(0,e),0)).command("tts",(t,e)=>{const[n,r]=J(e,0,[K.STRING,K.MAYBE_STRING]);return ck("audio",r??"",n),0});function gc(t,e,n,r){const i=ke(e)?e:e.id,s=ke(e)?void 0:{x:e.x??0,y:e.y??0},o=ke(n)?n:n.id,a=i??s;k(o)&&k(a)&&t.send(o,r,a)}function DN(t,e,n,r){k(n==null?void 0:n.id)?(n.headless=!0,co(t,e,n)):Wy(e,r,"empty")}function Vy(t,e,n,r,i){const s=pN(e,n,r,i);if(k(s)){gc(t,s,t.id(),"thud"),r.kind===je.PLAYER?gc(t,t.id(),s,"touch"):r.collision===He.ISBULLET?gc(t,t.id(),s,"shot"):gc(t,t.id(),s,"bump");const o=sn(e,s);return(s.destructible??(o==null?void 0:o.destructible))&&DN(e,n,s,i),!1}return!0}function Ky(t,e,n){if(!gr(O.element))return 0;const[r,i]=J(e,0,[K.DIR,K.MAYBE_KIND]),s=i??["bullet"],o=_N(O.book,O.board,s,{x:O.element.x,y:O.element.y});if(k(o)){o.arg=n,o.collision=He.ISBULLET,o.destructible=1,o.stepx=r.x-O.element.x,o.stepy=r.y-O.element.y;const a=sn(O.book,o),c=o.code??(a==null?void 0:a.code)??"";O_(O.book,O.board,o,c,1),o.x===O.element.x&&o.y===O.element.y?o.headless=!0:t.bucket(o.id)}return t.yield(),0}const BN=pr().command("change",(t,e)=>{if(!k(O.book)||!k(O.board))return 0;const[n,r]=J(e,0,[K.KIND,K.KIND]);uc(O.book,O.board);const i=la(n)??"",s=Ms(O.board,i),o=Vp(s,n),a=la(r),c=Wp(r),l=Gp(r);return o.forEach(u=>{if(ns(O.book,u)===a)k(c)&&(u.color=c),k(l)&&(u.bg=l);else{if(k(u.id)&&(co(O.book,O.board,u),!hc(O.book,u,O.timestamp)))return;gr(u)&&vh(O.book,O.board,r,u)}}),0}).command("put",(t,e)=>{if(!k(O.book)||!k(O.board))return 0;const[n,r]=J(e,0,[K.DIR,K.KIND]);return uc(O.book,O.board),vh(O.book,O.board,r,n),0}).command("shootwith",(t,e)=>{const[n,r]=J(e,0,[K.ANY]);return Ky(t,e.slice(r),n)}).command("shoot",Ky).command("throwstar",()=>0),FN=navigator.userAgent.includes("Mac")?"cmd":"ctrl",Xr="$dkpurple",$N="$196",zN="$205";function on(t,e){return`$${t}${e}$blue`}function qy(t,e){return`$${t}${e}$ondkblue`}function Qe(t,e){In(t,e)}function jN(t,e){const n=$N.repeat(e);Qe(t,`${Xr}${n}`)}function Rh(t,e){const n=zN.repeat(e);Qe(t,`${Xr}${n}`)}function lo(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),jN(t,e.length+2),Qe(t,`${Xr} $white${e} `),Rh(t,e.length+2)}function Tr(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),Qe(t,`${Xr} $gray${e} `),Rh(t,e.length+2)}function De(t,e,n){Qe(t,`${Xr} $white${e} $blue${n}`)}function Fe(t,e){Qe(t,`${Xr}$blue${e}`)}function rs(t=""){zl("cli",t,O.player)}const WN=pr().command("send",(t,e)=>{const[n,r]=J(e,0,[K.STRING,K.ANY]);switch(n){case"helpmenu":lo("cli","H E L P"),De("cli","#help controls","zss controls and inputs"),Qe("cli","!helpcontrols;read help controls"),Qe("cli",""),De("cli","#help text","text formatting"),Qe("cli","!helptext;read help text"),Qe("cli",""),De("cli","#help developer","developer commands"),Qe("cli","!helpdeveloper;read help developer"),Qe("cli",""),De("cli","#help player","player settings"),Qe("cli","!helpplayer;read help player"),Tr("cli","keyboard input"),De("cli","?","open console"),De("cli","esc","close console"),De("cli","tab","move console"),De("cli","up / down arrow keys","navigate console items"),De("cli","left / right arrow keys","change console items"),De("cli","enter","interact with console items"),De("cli","alt + arrow keys","skip words and console lines"),De("cli",`${FN} + up / down arrow keys`,"input history");break;case"helpcontrols":lo("cli","zss controls and inputs"),Tr("cli","keyboard input"),De("cli","arrow keys","move"),De("cli","shift + arrow keys","shoot"),De("cli","enter","ok / accept"),De("cli","escape","cancel / close"),De("cli","tab","menu / action"),Tr("cli","mouse input"),Fe("cli","todo ???"),Tr("cli","controller input"),De("cli","left stick","move"),De("cli","right stick","aim"),De("cli","a","ok / accept"),De("cli","b","cancel / close"),De("cli","y","menu / action"),De("cli","x","shoot"),De("cli","triggers","shoot");break;case"helptext":lo("cli","text formatting"),Tr("cli","typography"),Fe("cli","plain text"),Fe("cli","$centering text"),Fe("cli",'"\\"@quoted strings for special chars\\""'),Fe("cli","$$0-255 for ascii chars $159$176$240"),Fe("cli",`use color names like ${on("red","$$red")} to change foreground color`),Fe("cli",`use color names like ${qy("ongreen","$$ongreen")} to change background color`),Fe("cli",`use clear ${qy("onclear","to change background to")} transparent`),Tr("cli","hyperlinks"),Fe("cli",`${on("white",'"!hotkey"')} message shortcut;${on("gray","Label")}`),Fe("cli",`${on("white",'"!range"')} flag [labelmin] [labelmax];${on("gray","Input Label")}`),Fe("cli",`${on("white",'"!select"')} flag ...list of values;${on("gray","Input Label")}`),Fe("cli",`${on("white",'"!number"')} flag [minvalue] [maxvalue];${on("gray","Input Label")}`),Fe("cli",`${on("white",'"!text"')} flag;${on("gray","Input Label")}`),Fe("cli",`${on("white",'"!copyit"')} flag;${on("gray","Input Label")}`);break;case"helpdeveloper":lo("cli","developer commands"),De("cli","#books","list books in memory"),De("cli","#pages","list pages in opened book"),De("cli","@[pagetype:]page name","create & edit a new codepage in the currently opened book"),De("cli","#trash","list books and pages from open book you can delete"),De("cli","#save","flush state to register");break;case"helpplayer":lo("cli","player settings"),Fe("cli","todo");break;default:In("$2",`${n} ${r??""}`);break}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(xt),s=i.join(" ");switch(Pe(r)){case _n(he.LOADER):n=Ii(je.CONTENT,s,Re.LOADER);break;default:n=Ii(je.CONTENT,[r,...i].join(" "),Re.OBJECT);break;case _n(he.BOARD):n=Ii(je.CONTENT,s,Re.BOARD);break;case _n(he.OBJECT):n=Ii(je.CONTENT,s,Re.OBJECT);break;case _n(he.TERRAIN):n=Ii(je.CONTENT,s,Re.TERRAIN);break;case _n(he.CHARSET):n=Ii(je.CONTENT,s,Re.CHARSET);break;case _n(he.PALETTE):n=Ii(je.CONTENT,s,Re.PALETTE);break}return k(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(xt).join(" ");return In("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=xt(n),s=r.map(xt).join(" ");return In("$2",`!${s};${i}`),0}).command("dev",()=>(rs(),sk("cli",O.player),0)).command("share",()=>(rs(),ok("cli",O.player),0)).command("bookcreate",(t,e)=>{const[n]=J(e,0,[K.MAYBE_STRING]),r=R_(n);return k(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=J(e,0,[K.STRING]),r=Jr(n);return k(r)?(Fe("cli",`opened [book] ${r.name}`),Tc(je.MAIN,r.id),t.command("pages")):Dt("cli","bookopen",`book ${n} not found`,O.player),0}).command("booktrash",(t,e)=>{const[n]=J(e,0,[K.STRING]),r=Gt(je.MAIN),i=Jr(n);return k(i)&&(r===i&&Tc(je.MAIN,""),yM(n),Fe("cli",`trashed [book] ${i.name}`),rs(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=J(e,0,[K.STRING]),r=rr(je.MAIN);if(!k(r))return 0;const i=Ei(r,n);if(k(i)){const s=Ar(i),o=ac(i);Fe("cli",`opened [${o}] ${s}`),yp(mp(r.id,i.id),i.code);const a=ac(i);mk("cli",r.id,i.id,a,`${s} - ${r.name}`,O.player)}else Dt("cli","pageopen",`page ${n} not found`,O.player);return 0}).command("pagetrash",(t,e)=>{const[n]=J(e,0,[K.STRING]),r=rr(je.MAIN),i=lN(r,n);if(k(n)){const s=Ar(i),o=ac(i);Fe("cli",`trashed [${o}] ${s}`),rs(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(xt).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Tr("cli","books");const t=Gt(je.MAIN);De("cli","main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=Gt(je.CONTENT);De("cli","content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),Rh("cli",7);const n=Ac();return n.length?n.forEach(r=>{Qe("cli",`!bookopen ${r.id};${r.name}`)}):Fe("cli","no books found"),Qe("cli","!bookcreate;create a new book"),0}).command("pages",()=>{Tr("cli","pages");const t=rr(je.MAIN);return k(t)&&(De("cli","main",`${t.name} $GREEN${t.id}`),t.pages.length?t.pages.forEach(e=>{const n=Ar(e),r=ac(e);Qe("cli",`!pageopen ${e.id};[${r}] ${n}`)}):(Qe("cli",""),Fe("cli","no pages found"),Fe("cli","use @ to create a page"),Fe("cli","@board name of board"),Fe("cli","@object name of object"),Fe("cli","@terrain name of terrain"),Fe("cli","You can omit the type and it will default to object"),Fe("cli","@object name of object"),Fe("cli","@name of object"))),0}).command("trash",()=>{Tr("cli","$REDTRASH"),Fe("cli","books");const t=Ac();t.length&&(t.forEach(n=>{Qe("cli",`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Qe("cli",""));const e=Gt(je.MAIN);return k(e)&&(Fe("cli",`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Ar(n);Qe("cli",`!pagetrash ${n.id};$REDTRASH ${r}`)}),Qe("cli","")),0}).command("save",()=>(rs(),0)).command("savewith",(t,e)=>{const[n]=J(e,0,[K.STRING]);return rs(n),0}).command("nuke",()=>(ak("cli",O.player),0)).command("joincode",()=>(nk("cli",O.player),0)).command("chat",(t,e)=>{const[n,r]=J(e,0,[K.MAYBE_STRING]);switch(Pe(n??"")){case"connect":{const[i]=J(e,r,[K.STRING]);JE("cli",i,O.player);break}case"close":YE("cli",O.player);break}return 0}).command("broadcast",(t,e)=>{const[n,r]=J(e,0,[K.MAYBE_STRING]);switch(Pe(n??"")){default:case"create":KE("cli",O.player);break;case"close":qE("cli",O.player);break;case"start":{const[i]=J(e,r,[K.STRING]);XE("cli",i,O.player);break}case"stop":ZE("cli",O.player);break}return 0});function GN(t){const e=Ny[t];if(k(e))return e;const n=Py[t];if(k(n))return n;const r=dc[t];if(k(r))return r;const i=Dp[t];if(k(i))return i}const HN=pr({get(t,e){const n=GN(e);return k(n)?[!0,n]:[!1,void 0]}}),VN=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Xy=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),KN=["NORTH","SOUTH","WEST","EAST"];function qN(t){const e=os(t);if(Ee(e.inputcurrent)||(e.inputcurrent=0),Ge(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Bt.NONE,i=0]=n??[Bt.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&Ok?1:0,e.inputctrl=i&Ck?1:0,e.inputshift=i&Nk?1:0,r){case Bt.MOVE_UP:case Bt.MOVE_DOWN:case Bt.MOVE_LEFT:case Bt.MOVE_RIGHT:e.inputmove=[KN[r-Bt.MOVE_UP]];break;case Bt.OK_BUTTON:e.inputok=1;break;case Bt.CANCEL_BUTTON:e.inputcancel=1;break;case Bt.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Bt.NONE&&o!==r}),e}const XN=pr({get(t,e){var s,o;if(O.isplayer&&VN.has(e)){const a=qN(((s=O.element)==null?void 0:s.id)??"")[e];return[k(a),a]}const n=(o=O.element)==null?void 0:o[e];if(k(n)||Xy.has(e))return[!0,n];const i=os(O.player)[e];return[k(i),i]},set(t,e,n){var s;const r=(s=O.element)==null?void 0:s[e];if(k(r)||Xy.has(e))return k(O.element)&&(O.element[e]=n),[!0,n];const i=os(O.player);return i[e]=n,[!0,n]},everytick(t){var e,n;(e=O.element)!=null&&e.headless&&t.command("die"),k((n=O.element)==null?void 0:n.x)&&k(O.element.y)&&k(O.element.stepx)&&k(O.element.stepy)&&Vy(t,O.book,O.board,O.element,{x:O.element.x+O.element.stepx,y:O.element.y+O.element.stepy})===!1&&(O.element.stepx=0,O.element.stepy=0,uN(O.book,O.element,"destructible")&&(O.element.headless=!0,hc(O.book,O.element,O.timestamp)))}}).command("become",(t,e)=>{var i,s;const n={x:((i=O.element)==null?void 0:i.x)??0,y:((s=O.element)==null?void 0:s.y)??0},[r]=J(e,0,[K.KIND]);return uc(O.book,O.board),co(O.book,O.board,O.element),hc(O.book,O.element,O.timestamp)&&vh(O.book,O.board,r,n),t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=J(e,0,[K.NUMBER]);return k(O.element)&&(O.element.char=n),0}).command("color",(t,e)=>{const[n]=J(e,0,[K.COLOR]);return k(O.element)&&k(n)&&mc(O.element,n),0}).command("go",(t,e)=>{if(k(O.element)){const[n]=J(e,0,[K.DIR]);if(Vy(t,O.book,O.board,O.element,n),t.yield(),O.element.x===n.x&&O.element.y===n.y)return 0}return 1}).command("try",(t,e)=>{const[,n]=J(e,0,[K.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),0}).command("walk",(t,e)=>{if(!k(O.element))return 0;const[n]=J(e,0,[K.DIR]),r=O.element.x??0,i=O.element.y??0;return O.element.stepx=n.x-r,O.element.stepy=n.y-i,0}),ZN=pr().command("clear",(t,e)=>(e.forEach(n=>t.set(xt(n),0)),0)).command("set",(t,e)=>{const[n,r]=J(e,0,[K.STRING,K.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,i]=J(e,0,[K.STRING,K.MAYBE_NUMBER]),s=t.get(n),o=r??1;if(!Ee(s))return 1;const a=s-o;return a<0?(i<e.length&&t.command(...e.slice(i)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,i]=J(e,0,[K.STRING,K.MAYBE_NUMBER]),s=t.get(n),o=Ee(s)?s:0,a=r??1;if(!Ee(a))return 0;const c=s===void 0?1:0;return c&&i<e.length&&t.command(...e.slice(i)),t.set(n,o+a),c}),JN=pr({get(){return[!1,void 0]},set(t,e,n){return Fk(t,e,n),[!1,void 0]},tick(){var e;const t=((e=O.element)==null?void 0:e.name)??"scroll";Gl(O.player,"scroll",ln.SCROLL,void 0,t)},everytick(){const t=$k(O.player);if(t&&k(O.element)){O.element.tickertext=t,O.element.tickertime=O.timestamp;const e=Iy(O.book,O.element);In(`$${Le[e.color]}$${e.char}`,t)}}}).command("send",(t,e)=>{var u,h;const[n,r]=J(e,0,[K.STRING,K.ANY]),[i,s]=n.split(":"),o=k(s)?i:"self",a=s??i;function c(d){d.forEach(f=>{k(f.id)&&t.send(f.id,a,r)})}const l=Pe(o);switch(l){case"all":for(const d of Object.keys(((u=O.board)==null?void 0:u.objects)??{}))t.send(d,a,r);break;case"self":t.message({id:at(),sender:t.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((h=O.board)==null?void 0:h.objects)??{}))d!==t.id()&&t.send(d,a,r);break;default:{c(Ql(O.board,[o]));const d=t.get(l);Ge(d)?c(Ql(O.board,d)):c(Ql(O.board,[d]));break}}return 0}).command("stat",(t,e)=>{const n=q0(e.map(xt));switch(n.type){case he.OBJECT:k(O.element)&&(O.element.name=n.values.join(" "));break}return 0}).command("text",(t,e)=>{const n=e.map(xt).join("");return zk(O.player,n),0}).command("hyperlink",(t,e)=>{const[n,r,...i]=e,s=xt(n),o=xt(r);return jk(O.player,t,s,o,i),0}).command("gadget",(t,e)=>{const[n]=J(e,0,[K.STRING]),r=Ik[Pe(n)];if(r===ln.SCROLL){const[i,s]=J(e,1,[K.MAYBE_STRING,K.MAYBE_NUMBER]);Gl(O.player,n,r,s,i)}else if(k(r)){const[i,s]=J(e,1,[K.MAYBE_NUMBER,K.MAYBE_STRING]);Gl(O.player,n,r,i,s)}return 0}),YN=pr().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=J(e,0,[K.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(xt(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(xt(e[0])),0)).command("cycle",(t,e)=>{if(k(O.element)){const[n]=J(e,0,[K.NUMBER]);O.element.cycle=Gn(Math.round(n),1,255)}return 0}).command("die",t=>{var e;return(e=O.element)!=null&&e.headless&&co(O.book,O.board,O.element),hc(O.book,O.element,O.timestamp),t.endofprogram(),0}).command("endgame",()=>(yk("element",O.player),0)).command("run",(t,e)=>{const[n]=J(e,0,[K.STRING]);return Rc(n),0}).command("runwith",(t,e)=>{const[n,r]=J(e,0,[K.ANY,K.STRING]);return t.set("arg",n),Rc(r),0}),Zy={},Jy={};function QN(t){return Zy[t]}function yc(t){return Jy[t]}function eL(t,e){const n=Gt(je.MAIN);if(!k(n))return;const r=aN(n,Re.LOADER).filter(i=>!!ao(i)[t]);for(let i=0;i<r.length;++i){const s=at();Zy[s]=t,Jy[s]=e,vM(s,r[i].code)}}function Yy(t,e){if(!k(t))return;const n=Pe(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const tL=(t,e)=>{const n=yc(t.id());if(!k(n))return 0;const[r,i]=J(e,0,[K.STRING]),s=Pe(r);switch(s){case"seek":{const[o]=J(e,i,[K.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=J(e,i,[K.STRING]);t.set(o,Yy(n,s));break}case"text":{const[o,a]=J(e,i,[K.STRING,K.STRING]),c=Yy(n,o);if(Ee(c)&&ke(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(l);t.set(a,h),n.cursor+=c}break}}return 0},nL=(t,e)=>{const n=yc(t.id());if(!k(n))return 0;const[r,i]=J(e,0,[K.STRING]);switch(Pe(r)){case"seek":{const[o]=J(e,i,[K.NUMBER]);n.cursor=Gn(o,0,n.lines.length-1);break}case"line":n.cursor=Gn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o);if(k(c)){let l=1;for(let u=i;u<e.length;){const[h,d]=J(e,u,[K.STRING]);k(c[l])&&t.set(h,c[l]),++l,u=d}}break}}return 0},rL=pr({get(t,e){switch(QN(t.id())){case"chat":{const r=yc(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"binary":{const r=yc(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=J(e,0,[K.STRING,K.ANY]);return t.message({id:at(),sender:t.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(xt).join(" ");return In("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=xt(n),s=r.map(xt).join(" ");return In("$2",`!${s};${i}`),0}).command("load",(t,e)=>{const n=e.map(xt).join(" "),r=t.get(n)??n;return rr(je.CONTENT,r),0}).command("reload",(t,e)=>{const n=e.map(xt).join(" "),r=t.get(n)??n,i=rr(je.CONTENT,r);return i.pages=[],0}).command("bin",tL).command("txt",nL);var uo=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.CODE_PAGE=3]="CODE_PAGE",t))(uo||{});const iL={audio:PN,board:BN,cli:WN,const:HN,element:XN,flags:ZN,gadget:JN,lifecycle:YN,loader:rL},Ih=["const","flags","audio","board","lifecycle","element"],sL={0:[],1:["cli",...Ih],2:["loader",...Ih],3:["gadget",...Ih]},oL={0:new Map,1:new Map,2:new Map,3:new Map};function ho(t){return(sL[t]??[]).map(n=>iL[n]).filter(k)}function aL(t,e){const n=oL[t];if(!n.has(e)){let r;const i=ho(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!k(r));++s);n.set(e,r)}return n.get(e)}function cL(t,e,n){const r=ho(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function lL(t,e,n,r){const i=ho(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function uL(t,e){const n=ho(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function Qy(t,e){const n=ho(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var e_={},t_={},n_={};const r_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");n_.encode=function(t){if(0<=t&&t<r_.length)return r_[t];throw new TypeError("Must be between 0 and 63: "+t)};const hL=n_,i_=5,s_=1<<i_,fL=s_-1,dL=s_;function pL(t){return t<0?(-t<<1)+1:(t<<1)+0}t_.encode=function(e){let n="",r,i=pL(e);do r=i&fL,i>>>=i_,i>0&&(r|=dL),n+=hL.encode(r);while(i>0);return n};var fo={};(function(t){function e(T,I,$){if(I in T)return T[I];if(arguments.length===3)return $;throw new Error('"'+I+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(T){const I=T.match(n);return I?{scheme:I[1],auth:I[2],host:I[3],port:I[4],path:I[5]}:null}t.urlParse=i;function s(T){let I="";return T.scheme&&(I+=T.scheme+":"),I+="//",T.auth&&(I+=T.auth+"@"),T.host&&(I+=T.host),T.port&&(I+=":"+T.port),T.path&&(I+=T.path),I}t.urlGenerate=s;const o=32;function a(T){const I=[];return function($){for(let V=0;V<I.length;V++)if(I[V].input===$){const Q=I[0];return I[0]=I[V],I[V]=Q,I[0].result}const L=T($);return I.unshift({input:$,result:L}),I.length>o&&I.pop(),L}}const c=a(function(I){let $=I;const L=i(I);if(L){if(!L.path)return I;$=L.path}const V=t.isAbsolute($),Q=[];let x=0,E=0;for(;;)if(x=E,E=$.indexOf("/",x),E===-1){Q.push($.slice(x));break}else for(Q.push($.slice(x,E));E<$.length&&$[E]==="/";)E++;let g=0;for(E=Q.length-1;E>=0;E--){const N=Q[E];N==="."?Q.splice(E,1):N===".."?g++:g>0&&(N===""?(Q.splice(E+1,g),g=0):(Q.splice(E,2),g--))}return $=Q.join("/"),$===""&&($=V?"/":"."),L?(L.path=$,s(L)):$});t.normalize=c;function l(T,I){T===""&&(T="."),I===""&&(I=".");const $=i(I),L=i(T);if(L&&(T=L.path||"/"),$&&!$.scheme)return L&&($.scheme=L.scheme),s($);if($||I.match(r))return I;if(L&&!L.host&&!L.path)return L.host=I,s(L);const V=I.charAt(0)==="/"?I:c(T.replace(/\/+$/,"")+"/"+I);return L?(L.path=V,s(L)):V}t.join=l,t.isAbsolute=function(T){return T.charAt(0)==="/"||n.test(T)};function u(T,I){T===""&&(T="."),T=T.replace(/\/$/,"");let $=0;for(;I.indexOf(T+"/")!==0;){const L=T.lastIndexOf("/");if(L<0||(T=T.slice(0,L),T.match(/^([^\/]+:\/)?\/*$/)))return I;++$}return Array($+1).join("../")+I.substr(T.length+1)}t.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(T){return T}function f(T){return m(T)?"$"+T:T}t.toSetString=h?d:f;function p(T){return m(T)?T.slice(1):T}t.fromSetString=h?d:p;function m(T){if(!T)return!1;const I=T.length;if(I<9||T.charCodeAt(I-1)!==95||T.charCodeAt(I-2)!==95||T.charCodeAt(I-3)!==111||T.charCodeAt(I-4)!==116||T.charCodeAt(I-5)!==111||T.charCodeAt(I-6)!==114||T.charCodeAt(I-7)!==112||T.charCodeAt(I-8)!==95||T.charCodeAt(I-9)!==95)return!1;for(let $=I-10;$>=0;$--)if(T.charCodeAt($)!==36)return!1;return!0}function b(T,I,$){let L=w(T.source,I.source);return L!==0||(L=T.originalLine-I.originalLine,L!==0)||(L=T.originalColumn-I.originalColumn,L!==0||$)||(L=T.generatedColumn-I.generatedColumn,L!==0)||(L=T.generatedLine-I.generatedLine,L!==0)?L:w(T.name,I.name)}t.compareByOriginalPositions=b;function _(T,I,$){let L=T.generatedLine-I.generatedLine;return L!==0||(L=T.generatedColumn-I.generatedColumn,L!==0||$)||(L=w(T.source,I.source),L!==0)||(L=T.originalLine-I.originalLine,L!==0)||(L=T.originalColumn-I.originalColumn,L!==0)?L:w(T.name,I.name)}t.compareByGeneratedPositionsDeflated=_;function w(T,I){return T===I?0:T===null?1:I===null?-1:T>I?1:-1}function v(T,I){let $=T.generatedLine-I.generatedLine;return $!==0||($=T.generatedColumn-I.generatedColumn,$!==0)||($=w(T.source,I.source),$!==0)||($=T.originalLine-I.originalLine,$!==0)||($=T.originalColumn-I.originalColumn,$!==0)?$:w(T.name,I.name)}t.compareByGeneratedPositionsInflated=v;function A(T){return JSON.parse(T.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function C(T,I,$){if(I=I||"",T&&(T[T.length-1]!=="/"&&I[0]!=="/"&&(T+="/"),I=T+I),$){const L=i($);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const V=L.path.lastIndexOf("/");V>=0&&(L.path=L.path.substring(0,V+1))}I=l(s(L),I)}return c(I)}t.computeSourceURL=C})(fo);var xh={};let mL=class B_{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new B_;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};xh.ArraySet=mL;var o_={};const a_=fo;function gL(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||a_.compareByGeneratedPositionsInflated(t,e)<=0}let yL=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){gL(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(a_.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};o_.MappingList=yL;const po=t_,ft=fo,_c=xh.ArraySet,_L=o_.MappingList;let c_=class F_{constructor(e){e||(e={}),this._file=ft.getArg(e,"file",null),this._sourceRoot=ft.getArg(e,"sourceRoot",null),this._skipValidation=ft.getArg(e,"skipValidation",!1),this._sources=new _c,this._names=new _c,this._mappings=new _L,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new F_({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=ft.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=ft.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=ft.getArg(e,"generated"),r=ft.getArg(e,"original",null);let i=ft.getArg(e,"source",null),s=ft.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=ft.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ft.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ft.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=ft.relative(s,i));const o=this._mappings.toArray().length>0?new _c:this._sources,a=new _c;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ft.join(r,c.source)),s!=null&&(c.source=ft.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=ft.join(r,c)),s!=null&&(c=ft.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(l=d[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ft.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=po.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=po.encode(h-o),o=h,c+=po.encode(l.originalLine-1-i),i=l.originalLine-1,c+=po.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=po.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ft.relative(n,r));const i=ft.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};c_.prototype._version=3,e_.SourceMapGenerator=c_;var l_={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(l_);var mo={exports:{}},bL={},wL=Object.freeze({__proto__:null,default:bL}),u_=$_(wL);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;mo.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},mo.exports.initialize=e=>t=e}else{const t=u_,e=u_;mo.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},mo.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var h_=mo.exports;const vL=h_;function EL(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let go=null;var kL=function(){if(go)return go;const e=[];return go=vL().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,h,d){const f=new EL;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw go=null,n}),go};const fe=fo,Oh=l_,bc=xh.ArraySet,SL=h_,AL=kL,Ch=Symbol("smcInternal");class lt{constructor(e,n){return e==Ch?Promise.resolve(this):RL(e,n)}static initialize(e){SL.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return IL(e,n)}static async with(e,n,r){const i=await new lt(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}lt.prototype._version=3,lt.GENERATED_ORDER=1,lt.ORIGINAL_ORDER=2,lt.GREATEST_LOWER_BOUND=1,lt.LEAST_UPPER_BOUND=2;class yo extends lt{constructor(e,n){return super(Ch).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version");let o=fe.getArg(i,"sources");const a=fe.getArg(i,"names",[]);let c=fe.getArg(i,"sourceRoot",null);const l=fe.getArg(i,"sourcesContent",null),u=fe.getArg(i,"mappings"),h=fe.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=fe.normalize(c)),o=o.map(String).map(fe.normalize).map(function(d){return c&&fe.isAbsolute(c)&&fe.isAbsolute(d)?fe.relative(c,d):d}),r._names=bc.fromArray(a.map(String),!0),r._sources=bc.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return fe.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,AL().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=fe.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new yo(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||lt.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=fe.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case lt.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case lt.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=fe.getArg(e,"source");const r=fe.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=fe.getArg(e,"bias",lt.GREATEST_LOWER_BOUND);r==null&&(r=lt.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=fe.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=fe.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=fe.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:fe.getArg(i,"originalLine",null),column:fe.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=fe.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=fe.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=fe.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:fe.getArg(e,"line"),originalColumn:fe.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=fe.getArg(e,"bias",lt.GREATEST_LOWER_BOUND);i==null&&(i=lt.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:fe.getArg(s,"generatedLine",null),column:fe.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}yo.prototype.consumer=lt;class TL extends lt{constructor(e,n){return super(Ch).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version"),o=fe.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new bc,r._names=new bc,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=fe.getArg(c,"offset"),u=fe.getArg(l,"line"),h=fe.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new lt(fe.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(fe.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(fe.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")},r=Oh.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(fe.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=fe.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||lt.GENERATED_ORDER;let o;switch(s){case lt.GENERATED_ORDER:o=this._generatedMappings;break;case lt.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=fe.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return Oh.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=fe.getArg(e,"line"),r={source:fe.getArg(e,"source"),originalLine:n,originalColumn:fe.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",fe.compareByOriginalPositions,Oh.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function RL(t,e){let n=t;typeof t=="string"&&(n=fe.parseSourceMapInput(t));const r=n.sections!=null?new TL(n,e):new yo(n,e);return Promise.resolve(r)}function IL(t,e){return yo.fromSourceMap(t,e)}var f_={};const xL=e_.SourceMapGenerator,wc=fo,OL=/(\r?\n)/,CL=10,is="$$$isSourceNode$$$";let NL=class Vh{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[is]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new Vh,s=e.split(OL);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-l);s[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=wc.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?wc.join(r,f.source):f.source;i.add(new Vh(f.originalLine,f.originalColumn,m,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[is]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[is]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[is]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[is]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[wc.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][is]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(wc.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new xL(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===CL?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};f_.SourceNode=NL;var LL=f_.SourceNode;const ML=Zl(32,126).map(t=>String.fromCharCode(t)),UL=rn({name:"Whitespace",pattern:/ +/}),PL=rn({name:"WhitespaceSkipped",pattern:/ +/,group:vt.SKIPPED}),Nh=rn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),d_=rn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:ML}),Lh=rn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Mh=rn({name:"EscapedDollar",pattern:"$$"}),Uh=rn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Ph=rn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),p_=rn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function DL(t,e=""){return rn({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const m_=Object.keys(dc).map(t=>DL(`\\$(${t})`,t)),BL=[UL,Nh,...m_,Lh,d_,Ph,Mh,p_,Uh],FL=new vt(BL,{skipValidations:!Wn,ensureOptimizations:Wn}),$L=new vt([PL,Nh,...m_,Lh,d_,Ph,Mh,p_,Uh],{skipValidations:!Wn,ensureOptimizations:Wn});function Dh(t,e=!1){return e?$L.tokenize(t):FL.tokenize(t)}function g_(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function y_(t){t.active={...t.reset}}function __(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Mh:s("$");break;case Ph:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case Lh:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Nh:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=dc[l],h=wN(Le[u]),d=vN(Le[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):k(h)?e.active.color=h:k(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(k(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){y_(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;GL(u,u+l.length,e.active.color,e.active.bg,e),WL(u,l,e)}}}function zL(t,e,n){const r=Dh(t);r.tokens&&(__(r.tokens,e),y_(e))}function jL(t,e,n){const r=Dh(t);if(!r.tokens)return;const i=g_(e,n,Le.WHITE,Le.BLACK);return i.measureonly=!0,__(r.tokens,i),i.x>0&&++i.y,i}function WL(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++)}function GL(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}let b_=0;const w_=Wn,HL=["Command","lines"];class VL extends pC{constructor(){super(V0,{traceInitPerf:Wn,skipValidations:!Wn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});ye(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));ye(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(to)}])}));ye(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));ye(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));ye(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));ye(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(b0)}));ye(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Xu)}));ye(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(y0)}])}));ye(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(_0)}));ye(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(w0),this.SUBRULE(this.words),this.CONSUME(v0)}));ye(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Yi),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));ye(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));ye(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));ye(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_debugger)},{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));ye(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(th),this.SUBRULE(this.words)}));ye(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(M0),this.SUBRULE(this.words)}));ye(this,"command_debugger",this.RULED("command_debugger",()=>{this.CONSUME(B0)}));ye(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(nh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));ye(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(to)),this.CONSUME4(Yi),this.CONSUME4(rh)}}])}));ye(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Yi),this.CONSUME(rh)}}])}));ye(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));ye(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Yi),this.CONSUME(ih),this.CONSUME(nh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Yi),this.CONSUME(ih),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(F0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME($0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(z0),this.SUBRULE(this.words)}));ye(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(j0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(W0)}));ye(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(G0)}));ye(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(D0)}));ye(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Zu),this.SUBRULE2(this.and_test)})}));ye(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Yu),this.SUBRULE2(this.not_test)})}));ye(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Ju),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));ye(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));ye(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(S0)},{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(T0)},{ALT:()=>this.CONSUME(R0)},{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(x0)}])}));ye(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Zu),this.SUBRULE2(this.and_test_value)})}));ye(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Yu),this.SUBRULE2(this.not_test_value)})}));ye(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Ju),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));ye(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));ye(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Qu)},{ALT:()=>this.CONSUME(eh)}]),this.SUBRULE(this.term)}));ye(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));ye(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(C0)},{ALT:()=>this.CONSUME(th)},{ALT:()=>this.CONSUME(N0)},{ALT:()=>this.CONSUME(L0)}]),this.SUBRULE(this.factor)}));ye(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Qu)},{ALT:()=>this.CONSUME(eh)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));ye(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(O0),this.SUBRULE(this.factor)})}));ye(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));ye(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(E0)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(k0)},{ALT:()=>{this.CONSUME(U0),this.SUBRULE(this.expr),this.CONSUME(P0)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=HL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(b_++).toString().padStart(3),c=s?"font-weight: bold;":"";if(w_&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),w_&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),b_--},i)}}const ss=new VL;if(Vk){const t=ss.getGAstProductions(),e=TC(t);console.info(e)}const KL=ss.getBaseCstVisitorConstructor();var oe=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(oe||{}),Ai=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Ai||{}),tr=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(tr||{}),vc=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(vc||{});function qL(t){return!!(t!=null&&t.tokenType)}function Rr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class XL extends KL{constructor(){super();ye(this,"unique",0);Wn&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&qL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Rr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Rr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:Rr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Rr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:Rr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=at(),i=at();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=at(),i=at();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=at(),i=at();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=at(),i=at(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=at(),i=at(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){return this.createcodenode(n,{type:22,words:this.go(n.words)})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=Rr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=Rr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=Rr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(Rr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const ZL=new XL,Qt={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Ec="zss.js";function Ne(t,e){return new LL(t.startLine??1,t.startColumn??1,Ec,e)}function Bh(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Fh(t){return`'${Bh(t)}'`}function kc(t){if(t.startsWith('"'))return kc(t.replaceAll(/(^"|"$)/g,""));const e=Dh(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Uh?`', api.get('${Bh(r.image.substring(1))}'), '`:Bh(r.image)).join("")}'].join('')`}function Ti(t){return t.filter(e=>e!==void 0).map(Be)}function v_(t){return Ne(t,"")}function JL(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function dt(t,e,n){return Ne(t,[`api.${e}(`,...JL(n,", "),")"])}function YL(t){if(t.type===oe.COMPARE&&t.compare.type===oe.COMPARE_ITEM)switch(t.compare.method){case Ai.IS_EQ:return dt(t,"isEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_NOT_EQ:return dt(t,"isNotEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_LESS_THAN:return dt(t,"isLessThan",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_GREATER_THAN:return dt(t,"isGreaterThan",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_LESS_THAN_OR_EQ:return dt(t,"isLessThanOrEq",[Be(t.lhs),Be(t.rhs)]);case Ai.IS_GREATER_THAN_OR_EQ:return dt(t,"isGreaterThanOrEq",[Be(t.lhs),Be(t.rhs)])}return Ne(t,"")}function Ri(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Be(n),")"])}function E_(t,e,n){return t.prepend(`api.${e}(`),t.add([Be(n),")"])}function QL(t,e){if(t.type===oe.OPERATOR_ITEM)switch(t.operator){case tr.PLUS:return Ri(e,"opPlus",t.rhs);case tr.MINUS:return Ri(e,"opMinus",t.rhs);case tr.POWER:return Ri(e,"opPower",t.rhs);case tr.MULTIPLY:return Ri(e,"opMultiply",t.rhs);case tr.DIVIDE:return Ri(e,"opDivide",t.rhs);case tr.MOD_DIVIDE:return Ri(e,"opModDivide",t.rhs);case tr.FLOOR_DIVIDE:return Ri(e,"opFloorDivide",t.rhs);case tr.UNI_PLUS:return E_(e,"opUniPlus",t.rhs);case tr.UNI_MINUS:return E_(e,"opUniMinus",t.rhs)}return Ne(t,"")}function eM(t){if(t.type===oe.OPERATOR){const e=t.lhs?Be(t.lhs):Ne(t,"");return t.items.forEach(n=>QL(n,e)),e}return Ne(t,"")}function Sc(t,e){return Ne(t,[dt(t,"jump",[`${e}`]),"; continue;"])}function Ir(t){return Qt.linelookup[t??""]??-1}function $h(t,e){Qt.linelookup[t]=e}function _o(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&(i.done=n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&(i.skip=n);break;case oe.LINE:_o(i.stmts,e,n);break}}}function k_(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&$h(i.done,n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&$h(i.skip,n);break;case oe.LINE:k_(i.stmts,e,n);break}}}function Be(t){var e;switch(t.type){case oe.PROGRAM:return Ne(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Be).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Ec}`]);case oe.API:return Ne(t,["  ",dt(t,t.method,Ti(t.words)),`;
`]);case oe.LINE:return Ne(t,[`case ${t.lineindex}:
`,...t.stmts.map(Be).flat(),`  break;
`]);case oe.MARK:return Ne(t,`  // ${t.comment}
`);case oe.GOTO:{const n=Ir(t.id);return Ne(t,["  ",Sc(t,n),`
`])}case oe.COUNT:return Ne(t,`${t.index}`);case oe.LITERAL:switch(t.literal){case vc.NUMBER:return Ne(t,`${t.value}`);case vc.STRING:return Ne(t,Fh(t.value));case vc.TEMPLATE:return Ne(t,kc(t.value))}return v_(t);case oe.TEXT:return Ne(t,["  ",dt(t,"text",[kc(t.value)]),`;
`]);case oe.STAT:if(Qt.isfirststat){Qt.isfirststat=!1;const n=t.value.trim().split(" ").map(Fh);return Ne(t,["  ",dt(t,"stat",n),`;
`])}return Ne(t,`  // skipped ${t.value}
`);case oe.LABEL:{const n=Pe(t.name),r=t.active?"label":"comment";Qt.labels[n]||(Qt.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Qt.labels[n].push(i),Ne(t,`  // ${i} '${n}' ${r}
`)}case oe.HYPERLINK:return Ne(t,["  ",dt(t,"hyperlink",[kc(t.text),...Ti(t.link)]),`;
`]);case oe.MOVE:{const n=dt(t,"command",[Fh("go"),Ti(t.words)].flat());return t.wait?Ne(t,["  if (",n,`) { continue; };
`]):Ne(t,["  ",n,`;
`])}case oe.COMMAND:return Ne(t,["  ",dt(t,"command",Ti(t.words)),`;
`]);case oe.IF:{const n=((e=t.block)==null?void 0:e.type)===oe.IF_BLOCK?t.block:void 0;if(k(n)){_o([t.check],oe.IF_CHECK,n.skip);const r=Ne(t,Be(t.check));return n.lines.forEach(i=>r.add(Be(i))),k_(n.altlines,oe.ELSE_IF,Ir(n.done)),n.altlines.forEach(i=>r.add(Be(i))),r}return Ne(t,Be(t.check))}case oe.IF_CHECK:{const n=Ir(t.skip);return n===-1?Ne(t,["  ",dt(t,t.method,Ti(t.words)),`;
`]):Ne(t,["  if (!",dt(t,t.method,Ti(t.words)),") { ",Sc(t,n),` }
`])}case oe.ELSE_IF:case oe.ELSE:{const n=Ne(t,"");return t.lines.forEach(r=>n.add(Be(r))),n}case oe.WHILE:{const n=Ir(t.loop),r=Ir(t.done),i=Ne(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.REPEAT:{const n=Ir(t.loop),r=Ir(t.done),i=Ne(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.WAITFOR:{const n=Ne(t,"");return n.add(["  if (!",dt(t,"if",Ti(t.words)),`) { api.i(${t.lineindex-1}); }
`]),n}case oe.FOREACH:{const n=Ir(t.loop),r=Ir(t.done),i=Ne(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.BREAK:return Ne(t,["  ",Sc(t,t.goto),`
`]);case oe.CONTINUE:return Ne(t,["  ",Sc(t,t.goto),`
`]);case oe.OR:return dt(t,"or",t.items.map(Be));case oe.AND:return dt(t,"and",t.items.map(Be));case oe.NOT:return dt(t,"not",t.items.map(Be));case oe.COMPARE:return YL(t);case oe.OPERATOR:return eM(t);case oe.EXPR:return dt(t,"expr",t.words.map(Be));default:return console.error("<unsupported node>",t.type,t),v_(t)}}function nr(t){if(k(t))switch(t.type===oe.LINE&&++Qt.lineindex,t.lineindex=Qt.lineindex,t.type){case oe.PROGRAM:t.lines.forEach(nr);break;case oe.LINE:t.stmts.forEach(nr);break;case oe.MARK:$h(t.id,t.lineindex);break;case oe.IF:nr(t.check),nr(t.block);break;case oe.IF_BLOCK:t.lines.forEach(nr),t.altlines.forEach(nr);break;case oe.ELSE_IF:t.lines.forEach(nr);break;case oe.ELSE:case oe.WHILE:case oe.REPEAT:case oe.FOREACH:t.lines.forEach(nr);break;case oe.MOVE:case oe.COMMAND:case oe.WAITFOR:case oe.IF_CHECK:t.words.forEach(nr);break}}function tM(t){return Qt.labels={},Qt.internal=1,Qt.lineindex=0,Qt.isfirststat=!0,nr(t),{...Be(t).toStringWithSourceMap({file:`${Ec}.map`}),...Qt}}function nM(t){return Ge(t)?t.length>0?1:0:t??0}function xt(t){return`${t??""}`}function S_(t){return`${t}_chip`}function rM(t,e,n){var c,l;const r=S_(t),i=os(r);let s;Ge(i.lb)||(i.lb=ei(Object.entries(n.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=n.errors)==null?void 0:c.length)??0)!==0?1:0);function o(u,h){O.words=h;const d=aL(e,u);return k(d)?d(a,h):u!=="send"?o("send",[u,...h]):0}const a={halt(){mM(r)},id(){return t},senderid(u=t){return`vm:${u??t}`},set(u,h){const[d,f]=lL(e,a,u,h);if(d)return f},get(u){const[h,d]=cL(e,a,u);if(h)return d},bucket(u){const h=a.get("bucket");Ge(h)?h.push(u):a.set("bucket",[u])},tick(u){const h=Ee(i.ps)?i.ps:0,d=h%u===0;if(i.ps=h+1,d===!1)return!1;if(a.shouldtick()===!1)return Qy(e,a),!1;i.lc=0,i.ys=0,O.get=a.get,uL(e,a);try{const f=s==null?void 0:s.next();f!=null&&f.done&&(i.es=1)}catch(f){Dt("chip","crash",f.message),i.es=1}return Qy(e,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return Ee(i.lc)?++i.lc>dr.HALT_AT_COUNT:!0},hm(){if(Ge(i.mg)&&Ge(i.lb)){const[,u]=i.mg;if(k(u))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u)return f.find(p=>Ee(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(u){i.ec=u},sy(){return!!i.ys||a.shouldhalt()},emit(u,h,d){_e.emit(u,a.senderid(),h,d)},send(u,h,d,f){_e.emit(`${a.senderid(u)}:${h}`,t,d,f)},lock(u){i.lk=u},unlock(){i.lk=""},message(u){i.lk&&u.sender!==i.lk||(i.mg=[u.id,u.target,u.data,u.sender,u.player])},zap(u){if(Ge(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u){const p=f.findIndex(m=>m>0);p>=0&&(f[p]*=-1)}}},restore(u){if(Ge(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===u)for(let p=0;p<f.length;p++)f[h]=Math.abs(f[h])}},getcase(){i.ec=Ee(i.ec)?i.ec:1;const u=a.hm();if(u&&Ge(i.mg)){const[,,h,d,f]=i.mg;a.set("sender",d),k(h)&&a.set("arg",h),f&&a.set("player",f),i.mg=void 0,i.ys=0,i.es=0,i.ec=u}return i.ec},nextcase(){const u=Ee(i.ec)?i.ec:1;return i.ec=u+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(u){const h=Hk.parse(u),[d]=h.filter(f=>f.fileName===Ec);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(u){return o("text",[u])},stat(...u){return o("stat",u)},hyperlink(...u){return o("hyperlink",u)},command(...u){if(u.length===0)return 0;const[h,...d]=u;return o(xt(h),d)},if(...u){const[h,d]=J(u,0,[K.ANY]),f=nM(h);return f&&d<u.length&&a.command(...u.slice(d)),f?1:0},repeatstart(u,...h){const[d,f]=J(h,0,[K.NUMBER]),p=`repeatcount${u}`,m=`repeatwords${u}`;i[p]=d,i[m]=f<h.length?h.slice(f):void 0},repeat(u){const h=`repeatcount${u}`,d=`repeatwords${u}`;if(!Ee(i[h]))return 0;const f=i[h];i[h]=f-1;const p=f>0,m=i[d];return p&&Ge(m)&&a.command(...m),p?1:0},foreachstart(u,...h){const[d,f,p,m]=J(h,0,[K.STRING,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let b=Math.min(f,p),_=Math.max(f,p);const w=(m??0)||1;if(w<0){const v=b;b=_,_=v}return a.set(d,b-w),0},foreach(u,...h){const[d,f,p,m,b]=J(h,0,[K.STRING,K.NUMBER,K.NUMBER,K.MAYBE_NUMBER]);let _=Math.min(f,p),w=Math.max(f,p);const v=(m??0)||1;if(v<0){const T=_;_=w,w=T}let A=a.get(d);!Ee(A)||A<_||A>w?A=_:A+=v;const C=A<=w?1:0;return C&&(a.set(d,A),b<h.length&&a.command(...h.slice(b))),C},or(...u){let h=0;for(let d=0;d<u.length;){const[f,p]=J(u,d,[K.ANY]);if(h=f,h)break;d=p}return h},and(...u){let h=0;for(let d=0;d<u.length;){const[f,p]=J(u,d,[K.ANY]);if(h=f,!h)break;d=p}return h},not(...u){const[h]=J(u,0,[K.ANY]);return h?0:1},expr(...u){const[h]=J(u,0,[K.ANY]);return h},isEq(u,h){const[d]=J([u],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return typeof d=="object"||typeof f=="object"?Eb(d,f)?1:0:d===f?1:0},isNotEq(u,h){return this.isEq(u,h)?0:1},isLessThan(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d<f?1:0},isGreaterThan(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d>f?1:0},isLessThanOrEq(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d>=f?1:0},opPlus(u,h){const[d]=J([u],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return d+f},opMinus(u,h){const[d]=J([u],0,[K.ANY]),[f]=J([h],0,[K.ANY]);return d-f},opPower(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return Math.pow(d,f)},opMultiply(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d*f},opDivide(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d/f},opModDivide(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return d%f},opFloorDivide(u,h){const[d]=J([u],0,[K.NUMBER]),[f]=J([h],0,[K.NUMBER]);return Math.floor(d/f)},opUniPlus(u){const[h]=J([u],0,[K.NUMBER]);return+h},opUniMinus(u){const[h]=J([u],0,[K.NUMBER]);return-h}};return s=(l=n.code)==null?void 0:l.call(n,a),a}function zh(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Ge(r)?r.forEach(i=>{e.push(zh(i))}):e.push(zh(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function iM(t){const e=K0(`${t}
`);if(e.errors.length>0)return e;ss.input=e.tokens;const n=ss.program();if(ss.errors.length>0)return{tokens:e.tokens,errors:ss.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=ZL.go(n);return r?(zh(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const jh=Object.getPrototypeOf(function*(){}).constructor;function sM(t,e){const n=`compile-${t}`;console.time(n);const r=iM(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=tM(r.ast);if(i.code){Kk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new jh("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new jh("api"," ")}}}return{...r,...i,source:"",code:new jh("api"," ")}}function oM(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=sM(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},has(i){return k(e[i])},isended(i){const s=e[i];return k(s)?s.isended():!0},halt(i){const s=e[i];return k(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var u;let l=e[i];if(!k(e[i])){const h=n(a,c);if(l=e[i]=rM(i,s,h),(u=h.errors)!=null&&u.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,w)=>[_,w]);p.slice(f-5,f).forEach(([_,w])=>{Dt("os","build",`$grey${w+1} $grey${_}`)});const[m,b]=p[f]??[];if(ke(m)&&k(b)){const _=(d.column??1)-1,w=_+d.length,v=_<m.length?m:`${m}*`,A=v.substring(0,_),C=v.substring(_,w),T=v.substring(w);Dt("os","build",`$red${b+1} $grey${A}$red${C}$grey${T}`)}return d.message.split(`
`).forEach(_=>{Dt("os","build",_)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Qh(i.target),a=e[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}function aM(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}function A_(t,e,n,r,i){t.push({x:e+r,y:n+i}),t.push({x:e-r,y:n+i}),t.push({x:e+r,y:n-i}),t.push({x:e-r,y:n-i})}function cM(t,e,n){const r=[];let i=5-4*n,s=0,o=n,a=(-2*n+5)*4,c=3*4;for(;s<=o;)A_(r,t,e,s,o),A_(r,t,e,o,s),i>0?(i+=a,o-=1,s+=1,a+=4*4,c+=2*2):(i+=c,s+=1,a+=2*4,c+=2*4);return r}let T_=0;function lM(){switch(T_++){case 0:return Le.BLUE;case 1:return Le.GREEN;case 2:return Le.CYAN;case 3:return Le.RED;case 4:return Le.PURPLE;case 5:return Le.YELLOW;default:return T_=0,Le.WHITE}}const uM=new Cs;function hM(t,e,n,r,i){const s=[];let o=e;const a=o===0,c=et,l=un,u=a?Le.BLACK:Le.ONCLEAR,h=vp(t,o++,c,l,u);s.push(h);const d=o++,f=Ak(t,d);s.push(f);const p=Tk(t,o++,c,l,r.isdark?1:0);s.push(p);const m=vp(t,o++,c,l,Le.ONCLEAR);s.push(m);const b={...g_(et,un,lM(),Le.ONCLEAR),...m},_=Rk(t,o++);i&&s.push(_),r.terrain.forEach((v,A)=>{if(v){const C=sn(n,v);h.char[A]=v.char??(C==null?void 0:C.char)??0,h.color[A]=v.color??(C==null?void 0:C.color)??u,h.bg[A]=v.bg??(C==null?void 0:C.bg)??u}});const w=r.objects??{};return Object.values(w).forEach(v=>{if(k(v.removed)||k(v.headless))return;const A=v.id??"",C=Iy(n,v),T=Sk(t,d,A);if(T.x=v.x??0,T.y=v.y??0,T.char=C.char,T.color=C.color,T.bg=C.bg,f.sprites.push(T),r.isdark&&Ee(C.light)){const V=cM(T.x,T.y,C.light);for(let Q=0;Q<V.length;++Q){let x=0;const E=V[Q],g=aM(T.x,T.y,E.x,E.y);for(let N=0;N<g.length;N++){const z=g[N];if(z.x<0||z.x>=c||z.y<0||z.y>=l)break;const ee=uM.subVectors(z,T).length()/(C.light+1),Y=1-Gn(ee+x,0,1),F=z.x+z.y*c;p.alphas[F]=Gn(p.alphas[F]-Y,0,1);const D=xN(r,z);if(D<0||!k(r==null?void 0:r.lookup))break;if(z.x!==T.x||z.y!==T.y){const ve=Si(r,r.lookup[D]??"");k(ve)&&(x+=.5)}const ae=r.terrain[D],te=sn(n,ae),ne=(ae==null?void 0:ae.collision)??(te==null?void 0:te.collision);if(Yl(He.ISWALK,ne))break}}}function I(V,Q){if(!(V<0||V>=c||Q<0||Q>=l))return p.alphas[V+Q*c]}const $=[[.01,.01,.01],[.01,1,.01],[.01,.01,.01]].flat(),L=ei(p.alphas);for(let V=0;V<p.alphas.length;++V){const Q=V%c,x=Math.floor(V/c),E=[[I(Q-1,x-1),I(Q,x-1),I(Q+1,x-1)],[I(Q-1,x),I(Q,x),I(Q+1,x)],[I(Q-1,x+1),I(Q,x+1),I(Q+1,x+1)]].flat().map((z,U)=>k(z)?[z*$[U],$[U]]:void 0).filter(k),g=E.map(([,z])=>z).reduce((z,U)=>z+U,0),N=E.map(([z])=>z).reduce((z,U)=>z+U,0);L[V]=N/g}if(p.alphas=ei(L),ke(v.tickertext)&&Ee(v.tickertime)&&v.tickertext.length){const V=et,Q=jL(v.tickertext,V,un-1),x=(Q==null?void 0:Q.measuredwidth)??1,E=v.x??0,g=v.y??0,N=g<un*.5;b.x=E-Math.floor(x*.5),b.y=g+(N?1:-1),b.x+x>et&&(b.x=et-x),b.x<0&&(b.x=0),zL(v.tickertext,b)}A===t&&(_.focusx=T.x,_.focusy=T.y,_.focusid=A)}),s}const xr=oM();var je=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(je||{});const pt={defaultplayer:eb(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function fM(t){pt.defaultplayer=t}function Zr(){return pt.defaultplayer}function Ac(){return[...pt.books.values()]}function dM(){const[t]=pt.books.values();return t}function Jr(t){const e=Pe(t);return pt.books.get(t)??Ac().find(n=>n.name===e)}function Tc(t,e){k(Jr(e))&&(pt.software[t]=e)}function Gt(t){return Jr(pt.software[t])}function R_(t){const e=Ty([]);return ke(t)&&(e.name=t),I_(e),In("memory",`created [book] ${e.name}`),e}function pM(t){let e=Jr(t);return k(e)||(e=Ty([]),e.name=t),I_(e),In("memory",`created [book] ${e.name}`),e}function rr(t,e){let n=k(e)?pM(e):Gt(t);return k(n)||(k(n)||(n=dM()),k(n)||(n=R_(e)),k(n)&&In("memory",`opened [book] ${n.name} for ${t}`)),Tc(t,n.id),n}function Ii(t,e,n){const r=rr(t);let i=Ei(r,e);if(k(i))return i;const s=Sy(n);return i=tN(s==="object"?`@${e}
`:`@${s} ${e}
`,{}),cN(r,i),zl("memory","",pt.defaultplayer),i}function os(t){const e=rr("main");return ts(e,t)}function mM(t){const e=rr("main");return _h(e,t)}function gM(t,e){pt.books.clear(),t.forEach(r=>{pt.books.set(r.id,r),r.name==="main"&&(pt.software.main=r.id)});const n=Jr(e);if(k(n)&&Tc("main",n.id),!pt.software.main){const r=pt.books.values().next();r.value&&(pt.software.main=r.value.id)}}function I_(t){return pt.books.set(t.id,t),t.id}function yM(t){const e=Jr(t);e&&pt.books.delete(e.id)}function _M(t){if(!ke(t)||!t)return Dt("memory","login",`failed for playerid ==>${t}<==`,t);const e=Gt("main");if(!k(e))return Dt("memory","login:main","login failed to find book 'main'",t);const n=lc(e,t);if(k(n))return!0;const r=es(e,"title");if(!k(r))return Dt("memory","login:title","login failed to find board 'title'",t);const i=cc(e,"player");if(!k(i))return Dt("memory","login:player","login failed to find object type 'player'",t);const s=i.name??"player",o=Ah(r,{x:0,y:0},s,t);return k(o==null?void 0:o.id)?(o.player=t,bh(e,t,r.id),!0):!1}function x_(t){const e=Gt("main"),n=lc(e,t);bh(e,t,""),co(e,n,Si(n,t)),Gy(n,t),_h(e,t),_h(e,S_(t))}function bM(t){const e=Gt("main"),n=Cy(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Yh(c)&&k(t[c])===!1&&(t[c]=0,bh(e,c,i.id))}}}function wM(t){xr.message(t)}function O_(t,e,n,r,i=Rb){if(!k(t)||!k(e)||!k(n))return;const s={...O},o=n.id??"";O.book=t,O.board=e,O.element=n,O.isplayer=Yh(o),O.player=n.player??pt.defaultplayer;const a=sn(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=Sh(n);if(xr.tick(l,uo.CODE_PAGE,Ee(c)?c:i,u,r),Ee(n==null?void 0:n.tickertime)&&O.timestamp-n.tickertime>To*5&&(n.tickertime=0,n.tickertext=""),O.isplayer){const h=os(O.element.id??"");h.inputcurrent=0}kb(s).forEach(h=>{O[h]=s[h]})}function vM(t,e){pt.loaders.set(t,e)}function EM(){const t=Gt("main");if(!k(t))return;const e=t.timestamp+1,n=dr.HALT_AT_COUNT;dr.HALT_AT_COUNT=n*2,pt.loaders.forEach((i,s)=>{xr.tick(s,uo.LOADER,1,"loader",i),xr.isended(s)&&(xr.halt(s),pt.loaders.delete(s))}),dr.HALT_AT_COUNT=n,t.timestamp=e,O.timestamp=e,Cy(t).forEach(i=>{const s=yN(t,i,e);for(let o=0;o<s.length;++o){const{id:a,type:c,code:l,object:u}=s[o];c===Re.ERROR?xr.halt(a):O_(t,i,u,l)}})}function kM(){xr.gc()}function SM(t,e=""){const n=rr("main");if(!k(n))return;const r=`${t}_cli`;O.timestamp=n.timestamp,O.book=n,O.board=lc(n,t),O.element=Si(O.board,t),O.player=t,O.isplayer=!0;const i=dr.HALT_AT_COUNT;dr.HALT_AT_COUNT=i*8,pp("memory","running",n.timestamp,r,e),xr.once(r,uo.CLI,"cli",e),dr.HALT_AT_COUNT=i}function Rc(t){const e=rr("main"),n=Ei(e,t);if(!k(e)||!k(n)||!k(O.element))return;const r=`${t}_run`,i=Sh(O.element),s=(n==null?void 0:n.code)??"";xr.once(r,uo.CODE_PAGE,i,s)}function AM(t){const e=Gt("main"),n=lc(e,t),r=[];if(!k(e)||!k(n))return r;const i=es(e,n.over??""),s=es(e,n.under??""),o=[i,n,s].filter(k);let a=0;for(let c=0;c<o.length;++c){const l=o[c],u=hM(t,a,e,l,l===n);a+=u.length,r.push(...u)}return r}function TM(t){const e=Gt(je.MAIN),n=ts(e,je.GADGETSTORE);delete n[t]}Dk(t=>{const e=Gt(je.MAIN),n=ts(e,je.GADGETSTORE);let r=n[t];return k(r)||(n[t]=r=jl()),r});const C_=cs("gadgetserver",["tock"],t=>{const e=Gt(je.MAIN),n=(e==null?void 0:e.activelist)??[],r=ts(e,je.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=hi(s);o.layers=AM(s);const a=r[s]??{},c=sf(a,o);c.length&&(r[s]=ei(o),ek(C_.name(),c,s))}break;case"desync":t.player&&QE(C_.name(),hi(t.player),t.player);break;case"clearscroll":t.player&&Bk(t.player);break;case"clearplayer":t.player&&TM(t.player);break}});function Wh(t,e){function n(r){console.error(r),Dt(t,"crash",r.message)}e().catch(n)}function Ic(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var N_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof Ic=="function"&&Ic;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};r[l][0].call(f.exports,function(p){var m=r[l][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Ic=="function"&&Ic,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,d,f,p,m,b=[],_=0,w=c.length,v=w,A=s.getTypeOf(c)!=="string";_<c.length;)v=w-_,h=A?(l=c[_++],u=_<w?c[_++]:0,_<w?c[_++]:0):(l=c.charCodeAt(_++),u=_<w?c.charCodeAt(_++):0,_<w?c.charCodeAt(_++):0),d=l>>2,f=(3&l)<<4|u>>4,p=1<v?(15&u)<<2|h>>6:64,m=2<v?63&h:64,b.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,h,d,f,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),w[b++]=l,f!==64&&(w[b++]=u),p!==64&&(w[b++]=h);return w}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,h,d,f,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,h,d){var f=o,p=d+h;l^=-1;for(var m=d;m<p;m++)l=l>>>8^f[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&f),f>>>=8;return b}function o(f,p,m,b,_,w){var v,A,C=f.file,T=f.compression,I=w!==l.utf8encode,$=a.transformTo("string",w(C.name)),L=a.transformTo("string",l.utf8encode(C.name)),V=C.comment,Q=a.transformTo("string",w(V)),x=a.transformTo("string",l.utf8encode(V)),E=L.length!==C.name.length,g=x.length!==V.length,N="",z="",U="",ee=C.dir,H=C.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(Y.crc32=f.crc32,Y.compressedSize=f.compressedSize,Y.uncompressedSize=f.uncompressedSize);var F=0;p&&(F|=8),I||!E&&!g||(F|=2048);var D=0,ae=0;ee&&(D|=16),_==="UNIX"?(ae=798,D|=function(ne,ve){var ze=ne;return ne||(ze=ve?16893:33204),(65535&ze)<<16}(C.unixPermissions,ee)):(ae=20,D|=function(ne){return 63&(ne||0)}(C.dosPermissions)),v=H.getUTCHours(),v<<=6,v|=H.getUTCMinutes(),v<<=5,v|=H.getUTCSeconds()/2,A=H.getUTCFullYear()-1980,A<<=4,A|=H.getUTCMonth()+1,A<<=5,A|=H.getUTCDate(),E&&(z=s(1,1)+s(u($),4)+L,N+="up"+s(z.length,2)+z),g&&(U=s(1,1)+s(u(Q),4)+x,N+="uc"+s(U.length,2)+U);var te="";return te+=`
\0`,te+=s(F,2),te+=T.magic,te+=s(v,2),te+=s(A,2),te+=s(Y.crc32,4),te+=s(Y.compressedSize,4),te+=s(Y.uncompressedSize,4),te+=s($.length,2),te+=s(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+te+$+N,dirRecord:h.CENTRAL_FILE_HEADER+s(ae,2)+te+s(Q.length,2)+"\0\0\0\0"+s(D,4)+s(b,4)+$+N+Q}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),h=n("../signature");function d(f,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return h.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,b=function(_,w,v,A,C){var T=a.transformTo("string",C(A));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(w,4)+s(v,4)+s(T.length,2)+T}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(w,v){var A=w||v,C=s[A];if(!C)throw new Error(A+" is not a valid compression method !");return C}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},b=f.dir,_=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var b=new c(f);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(f.checkCRC32)for(var w=0;w<_.length;w++)b.push(h(_[w]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,w=0;w<_.length;w++){var v=_[w],A=v.fileNameStr,C=s.resolve(v.fileNameStr);p.file(C,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:f.createFolders}),v.dir||(p.file(C).unsafeOriginalName=A)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,d){u.push(h)||u._helper.pause(),l&&l(d)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,T,I){var $,L=a.getTypeOf(T),V=a.extend(I||{},u);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(C=_(C)),V.createFolders&&($=b(C))&&w.call(this,$,!0);var Q=L==="string"&&V.binary===!1&&V.base64===!1;I&&I.binary!==void 0||(V.binary=!Q),(T instanceof h&&T.uncompressedSize===0||V.dir||!T||T.length===0)&&(V.base64=!1,V.binary=!0,T="",V.compression="STORE",L="string");var x=null;x=T instanceof h||T instanceof c?T:p.isNode&&p.isStream(T)?new m(C,T):a.prepareContent(C,T,V.binary,V.optimizedBinaryString,V.base64);var E=new d(C,x,V);this.files[C]=E}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var T=C.lastIndexOf("/");return 0<T?C.substring(0,T):""},_=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},w=function(C,T){return T=T!==void 0?T:u.createFolders,C=_(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:T}),this.files[C]};function v(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var T,I,$;for(T in this.files)$=this.files[T],(I=T.slice(this.root.length,T.length))&&T.slice(0,this.root.length)===this.root&&C(I,$)},filter:function(C){var T=[];return this.forEach(function(I,$){C(I,$)&&T.push($)}),T},file:function(C,T,I){if(arguments.length!==1)return C=this.root+C,s.call(this,C,T,I),this;if(v(C)){var $=C;return this.filter(function(V,Q){return!Q.dir&&$.test(V)})}var L=this.files[this.root+C];return L&&!L.dir?L:null},folder:function(C){if(!C)return this;if(v(C))return this.filter(function(L,V){return V.dir&&C.test(L)});var T=this.root+C,I=w.call(this,T),$=this.clone();return $.root=I.name,$},remove:function(C){C=this.root+C;var T=this.files[C];if(T||(C.slice(-1)!=="/"&&(C+="/"),T=this.files[C]),T&&!T.dir)delete this.files[C];else for(var I=this.filter(function(L,V){return V.name.slice(0,C.length)===C}),$=0;$<I.length;$++)delete this.files[I[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var T,I={};try{if((I=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");a.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var $=I.comment||this.comment||"";T=f.generateWorker(this,I,$)}catch(L){(T=new c("error")).error(L)}return new l(T,I.type||"string",I.mimeType)},generateAsync:function(C,T){return this.generateInternalStream(C).accumulate(T)},generateNodeStream:function(C,T){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(T)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),h=null;if(l.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,_){var w=[],v=p._internalType,A=p._outputType,C=p._mimeType;p.on("data",function(T,I){w.push(T),m&&m(I)}).on("error",function(T){w=[],_(T)}).on("end",function(){try{var T=function(I,$,L){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),L);case"base64":return c.encode($);default:return s.transformTo(I,$)}}(A,function(I,$){var L,V=0,Q=null,x=0;for(L=0;L<$.length;L++)x+=$[L].length;switch(I){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(Q=new Uint8Array(x),L=0;L<$.length;L++)Q.set($[L],V),V+=$[L].length;return Q;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+I+"'")}}(v,w),C);b(T)}catch(I){_(I)}w=[]}).resume()})}function f(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,b,_,w,v,A=p.length,C=0;for(w=0;w<A;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),w=v=0;v<C;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<A&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),b<128?m[v++]=b:(b<2048?m[v++]=192|b>>>6:(b<65536?m[v++]=224|b>>>12:(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63),m[v++]=128|b>>>6&63),m[v++]=128|63&b);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,b,_,w,v=p.length,A=new Array(2*v);for(m=b=0;m<v;)if((_=p[m++])<128)A[b++]=_;else if(4<(w=l[_]))A[b++]=65533,m+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&m<v;)_=_<<6|63&p[m++],w--;1<w?A[b++]=65533:_<65536?A[b++]=_:(_-=65536,A[b++]=55296|_>>10&1023,A[b++]=56320|1023&_)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(w,v){var A;for((v=v||w.length)>w.length&&(v=w.length),A=v-1;0<=A&&(192&w[A])==128;)A--;return A<0||A===0?v:A+l[w[A]]>v?A:v}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,b,_){var w=[],v=0,A=m.length;if(A<=_)return String.fromCharCode.apply(null,m);for(;v<A;)b==="array"||b==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+_,A)))):w.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+_,A)))),v+=_;return w.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),w=!0;if(_==="uint8array"?w=h.applyCanBeUsed.uint8array:_==="nodebuffer"&&(w=h.applyCanBeUsed.nodebuffer),w)for(;1<b;)try{return h.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(m)}function f(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],w=0;w<b.length;w++){var v=b[w];v==="."||v===""&&w!==0&&w!==b.length-1||(v===".."?_.pop():_.push(v))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,w="";for(_=0;_<(m||"").length;_++)w+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return w},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,w,v){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,T){var I=new FileReader;I.onload=function($){C($.target.result)},I.onerror=function($){T($.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var C=i.getTypeOf(A);return C?(C==="arraybuffer"?A=i.transformTo("uint8array",A):C==="string"&&(v?A=o.decode(A):_&&w!==!0&&(A=function(T){return u(T,s.uint8array?new Uint8Array(T.length):new Array(T.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in u)if(Object.prototype.hasOwnProperty.call(u,_)&&u[_].magic===b)return u[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,b,_=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<_;)p=f.readInt(2),m=f.readInt(2),b=f.readData(m),this.extraFields[p]={id:p,length:m,value:b};f.setIndex(_)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!w&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(v){(m=new u("error")).error(v)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,b;a=!0;for(var _=f.length;_;){for(b=f,f=[],m=-1;++m<_;)b[m]();_=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof Mt<"u"?Mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,w,v){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function f(_,w,v){s(function(){var A;try{A=w(v)}catch(C){return a.reject(_,C)}A===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,A)})}function p(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function m(_,w){var v=!1;function A(I){v||(v=!0,a.reject(_,I))}function C(I){v||(v=!0,a.resolve(_,I))}var T=b(function(){w(C,A)});T.status==="error"&&A(T.value)}function b(_,w){var v={};try{v.value=_(w),v.status="success"}catch(A){v.status="error",v.value=A}return v}(r.exports=h).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(v){return w.resolve(_()).then(function(){return v})},function(v){return w.resolve(_()).then(function(){throw v})})},h.prototype.catch=function(_){return this.then(null,_)},h.prototype.then=function(_,w){if(typeof _!="function"&&this.state===l||typeof w!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==u?f(v,this.state===l?_:w,this.outcome):this.queue.push(new d(v,_,w)),v},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){f(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){f(this.promise,this.onRejected,_)},a.resolve=function(_,w){var v=b(p,w);if(v.status==="error")return a.reject(_,v.value);var A=v.value;if(A)m(_,A);else{_.state=l,_.outcome=w;for(var C=-1,T=_.queue.length;++C<T;)_.queue[C].callFulfilled(w)}return _},a.reject=function(_,w){_.state=c,_.outcome=w;for(var v=-1,A=_.queue.length;++v<A;)_.queue[v].callRejected(w);return _},h.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},h.reject=function(_){var w=new this(o);return a.reject(w,_)},h.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,A=!1;if(!v)return this.resolve([]);for(var C=new Array(v),T=0,I=-1,$=new this(o);++I<v;)L(_[I],I);return $;function L(V,Q){w.resolve(V).then(function(x){C[Q]=x,++T!==v||A||(A=!0,a.resolve($,C))},function(x){A||(A=!0,a.reject($,x))})}},h.race=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=_.length,A=!1;if(!v)return this.resolve([]);for(var C=-1,T=new this(o);++C<v;)I=_[C],w.resolve(I).then(function($){A||(A=!0,a.resolve(T,$))},function($){A||(A=!0,a.reject(T,$))});var I;return T}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},_||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(v!==h)throw new Error(c[v]);if(w.header&&s.deflateSetHeader(this.strm,w.header),w.dictionary){var A;if(A=typeof w.dictionary=="string"?a.string2buf(w.dictionary):u.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(v=s.deflateSetDictionary(this.strm,A))!==h)throw new Error(c[v]);this._dict_set=!0}}function b(_,w){var v=new m(w);if(v.push(_,!0),v.err)throw v.msg||c[v.err];return v.result}m.prototype.push=function(_,w){var v,A,C=this.strm,T=this.options.chunkSize;if(this.ended)return!1;A=w===~~w?w:w===!0?4:0,typeof _=="string"?C.input=a.string2buf(_):u.call(_)==="[object ArrayBuffer]"?C.input=new Uint8Array(_):C.input=_,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(T),C.next_out=0,C.avail_out=T),(v=s.deflate(C,A))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&v!==1);return A===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):A!==2||(this.onEnd(h),!(C.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,w){return(w=w||{}).raw=!0,b(_,w)},i.gzip=function(_,w){return(w=w||{}).gzip=!0,b(_,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(l[_]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new f(b);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}f.prototype.push=function(m,b){var _,w,v,A,C,T,I=this.strm,$=this.options.chunkSize,L=this.options.dictionary,V=!1;if(this.ended)return!1;w=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?I.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?I.input=new Uint8Array(m):I.input=m,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new o.Buf8($),I.next_out=0,I.avail_out=$),(_=s.inflate(I,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(T=typeof L=="string"?a.string2buf(L):d.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,_=s.inflateSetDictionary(this.strm,T)),_===c.Z_BUF_ERROR&&V===!0&&(_=c.Z_OK,V=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&_!==c.Z_STREAM_END&&(I.avail_in!==0||w!==c.Z_FINISH&&w!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(I.output,I.next_out),A=I.next_out-v,C=a.buf2string(I.output,v),I.next_out=A,I.avail_out=$-A,A&&o.arraySet(I.output,I.output,v,A,0),this.onData(C)):this.onData(o.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(V=!0)}while((0<I.avail_in||I.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(w=c.Z_FINISH),w===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):w!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(I.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),d);else for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){var l,u,h,d,f,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=d=0,u=c.length;l<u;l++)f=c[l],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,l,u,h,d){for(var f=0;f<h;f++)c[d+f]=l[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,b,_=h.length,w=0;for(m=0;m<_;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),w+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(w),m=b=0;b<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[b++]=f:(f<2048?d[b++]=192|f>>>6:(f<65536?d[b++]=224|f>>>12:(d[b++]=240|f>>>18,d[b++]=128|f>>>12&63),d[b++]=128|f>>>6&63),d[b++]=128|63&f);return d},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,b,_=d||h.length,w=new Array(2*_);for(f=p=0;f<_;)if((m=h[f++])<128)w[p++]=m;else if(4<(b=c[m]))w[p++]=65533,f+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&f<_;)m=m<<6|63&h[f++],b--;1<b?w[p++]=65533:m<65536?w[p++]=m:(m-=65536,w[p++]=55296|m>>10&1023,w[p++]=56320|1023&m)}return u(w,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var d=l;d<h;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,b=4,_=2,w=8,v=9,A=286,C=30,T=19,I=2*A+1,$=15,L=3,V=258,Q=V+L+1,x=42,E=113,g=1,N=2,z=3,U=4;function ee(y,q){return y.msg=u[q],q}function H(y){return(y<<1)-(4<y?9:0)}function Y(y){for(var q=y.length;0<=--q;)y[q]=0}function F(y){var q=y.state,G=q.pending;G>y.avail_out&&(G=y.avail_out),G!==0&&(o.arraySet(y.output,q.pending_buf,q.pending_out,G,y.next_out),y.next_out+=G,q.pending_out+=G,y.total_out+=G,y.avail_out-=G,q.pending-=G,q.pending===0&&(q.pending_out=0))}function D(y,q){a._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,q),y.block_start=y.strstart,F(y.strm)}function ae(y,q){y.pending_buf[y.pending++]=q}function te(y,q){y.pending_buf[y.pending++]=q>>>8&255,y.pending_buf[y.pending++]=255&q}function ne(y,q){var G,R,S=y.max_chain_length,B=y.strstart,X=y.prev_length,Z=y.nice_match,W=y.strstart>y.w_size-Q?y.strstart-(y.w_size-Q):0,re=y.window,ue=y.w_mask,ie=y.prev,de=y.strstart+V,Je=re[B+X-1],Ue=re[B+X];y.prev_length>=y.good_match&&(S>>=2),Z>y.lookahead&&(Z=y.lookahead);do if(re[(G=q)+X]===Ue&&re[G+X-1]===Je&&re[G]===re[B]&&re[++G]===re[B+1]){B+=2,G++;do;while(re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&re[++B]===re[++G]&&B<de);if(R=V-(de-B),B=de-V,X<R){if(y.match_start=q,Z<=(X=R))break;Je=re[B+X-1],Ue=re[B+X]}}while((q=ie[q&ue])>W&&--S!=0);return X<=y.lookahead?X:y.lookahead}function ve(y){var q,G,R,S,B,X,Z,W,re,ue,ie=y.w_size;do{if(S=y.window_size-y.lookahead-y.strstart,y.strstart>=ie+(ie-Q)){for(o.arraySet(y.window,y.window,ie,ie,0),y.match_start-=ie,y.strstart-=ie,y.block_start-=ie,q=G=y.hash_size;R=y.head[--q],y.head[q]=ie<=R?R-ie:0,--G;);for(q=G=ie;R=y.prev[--q],y.prev[q]=ie<=R?R-ie:0,--G;);S+=ie}if(y.strm.avail_in===0)break;if(X=y.strm,Z=y.window,W=y.strstart+y.lookahead,re=S,ue=void 0,ue=X.avail_in,re<ue&&(ue=re),G=ue===0?0:(X.avail_in-=ue,o.arraySet(Z,X.input,X.next_in,ue,W),X.state.wrap===1?X.adler=c(X.adler,Z,ue,W):X.state.wrap===2&&(X.adler=l(X.adler,Z,ue,W)),X.next_in+=ue,X.total_in+=ue,ue),y.lookahead+=G,y.lookahead+y.insert>=L)for(B=y.strstart-y.insert,y.ins_h=y.window[B],y.ins_h=(y.ins_h<<y.hash_shift^y.window[B+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[B+L-1])&y.hash_mask,y.prev[B&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=B,B++,y.insert--,!(y.lookahead+y.insert<L)););}while(y.lookahead<Q&&y.strm.avail_in!==0)}function ze(y,q){for(var G,R;;){if(y.lookahead<Q){if(ve(y),y.lookahead<Q&&q===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),G!==0&&y.strstart-G<=y.w_size-Q&&(y.match_length=ne(y,G)),y.match_length>=L)if(R=a._tr_tally(y,y.strstart-y.match_start,y.match_length-L),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=L){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else R=a._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(R&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=y.strstart<L-1?y.strstart:L-1,q===d?(D(y,!0),y.strm.avail_out===0?z:U):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function we(y,q){for(var G,R,S;;){if(y.lookahead<Q){if(ve(y),y.lookahead<Q&&q===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=L-1,G!==0&&y.prev_length<y.max_lazy_match&&y.strstart-G<=y.w_size-Q&&(y.match_length=ne(y,G),y.match_length<=5&&(y.strategy===1||y.match_length===L&&4096<y.strstart-y.match_start)&&(y.match_length=L-1)),y.prev_length>=L&&y.match_length<=y.prev_length){for(S=y.strstart+y.lookahead-L,R=a._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-L),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=S&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=L-1,y.strstart++,R&&(D(y,!1),y.strm.avail_out===0))return g}else if(y.match_available){if((R=a._tr_tally(y,0,y.window[y.strstart-1]))&&D(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return g}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(R=a._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<L-1?y.strstart:L-1,q===d?(D(y,!0),y.strm.avail_out===0?z:U):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function be(y,q,G,R,S){this.good_length=y,this.max_lazy=q,this.nice_length=G,this.max_chain=R,this.func=S}function We(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*I),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*T+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16($+1),this.heap=new o.Buf16(2*A+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $e(y){var q;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=_,(q=y.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?x:E,y.adler=q.wrap===2?0:1,q.last_flush=h,a._tr_init(q),f):ee(y,p)}function mt(y){var q=$e(y);return q===f&&function(G){G.window_size=2*G.w_size,Y(G.head),G.max_lazy_match=s[G.level].max_lazy,G.good_match=s[G.level].good_length,G.nice_match=s[G.level].nice_length,G.max_chain_length=s[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=L-1,G.match_available=0,G.ins_h=0}(y.state),q}function Et(y,q,G,R,S,B){if(!y)return p;var X=1;if(q===m&&(q=6),R<0?(X=0,R=-R):15<R&&(X=2,R-=16),S<1||v<S||G!==w||R<8||15<R||q<0||9<q||B<0||b<B)return ee(y,p);R===8&&(R=9);var Z=new We;return(y.state=Z).strm=y,Z.wrap=X,Z.gzhead=null,Z.w_bits=R,Z.w_size=1<<Z.w_bits,Z.w_mask=Z.w_size-1,Z.hash_bits=S+7,Z.hash_size=1<<Z.hash_bits,Z.hash_mask=Z.hash_size-1,Z.hash_shift=~~((Z.hash_bits+L-1)/L),Z.window=new o.Buf8(2*Z.w_size),Z.head=new o.Buf16(Z.hash_size),Z.prev=new o.Buf16(Z.w_size),Z.lit_bufsize=1<<S+6,Z.pending_buf_size=4*Z.lit_bufsize,Z.pending_buf=new o.Buf8(Z.pending_buf_size),Z.d_buf=1*Z.lit_bufsize,Z.l_buf=3*Z.lit_bufsize,Z.level=q,Z.strategy=B,Z.method=G,mt(y)}s=[new be(0,0,0,0,function(y,q){var G=65535;for(G>y.pending_buf_size-5&&(G=y.pending_buf_size-5);;){if(y.lookahead<=1){if(ve(y),y.lookahead===0&&q===h)return g;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var R=y.block_start+G;if((y.strstart===0||y.strstart>=R)&&(y.lookahead=y.strstart-R,y.strstart=R,D(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-Q&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=0,q===d?(D(y,!0),y.strm.avail_out===0?z:U):(y.strstart>y.block_start&&(D(y,!1),y.strm.avail_out),g)}),new be(4,4,8,4,ze),new be(4,5,16,8,ze),new be(4,6,32,32,ze),new be(4,4,16,16,we),new be(8,16,32,32,we),new be(8,16,128,128,we),new be(8,32,128,256,we),new be(32,128,258,1024,we),new be(32,258,258,4096,we)],i.deflateInit=function(y,q){return Et(y,q,w,15,8,0)},i.deflateInit2=Et,i.deflateReset=mt,i.deflateResetKeep=$e,i.deflateSetHeader=function(y,q){return y&&y.state?y.state.wrap!==2?p:(y.state.gzhead=q,f):p},i.deflate=function(y,q){var G,R,S,B;if(!y||!y.state||5<q||q<0)return y?ee(y,p):p;if(R=y.state,!y.output||!y.input&&y.avail_in!==0||R.status===666&&q!==d)return ee(y,y.avail_out===0?-5:p);if(R.strm=y,G=R.last_flush,R.last_flush=q,R.status===x)if(R.wrap===2)y.adler=0,ae(R,31),ae(R,139),ae(R,8),R.gzhead?(ae(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),ae(R,255&R.gzhead.time),ae(R,R.gzhead.time>>8&255),ae(R,R.gzhead.time>>16&255),ae(R,R.gzhead.time>>24&255),ae(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),ae(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(ae(R,255&R.gzhead.extra.length),ae(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(y.adler=l(y.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(ae(R,0),ae(R,0),ae(R,0),ae(R,0),ae(R,0),ae(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),ae(R,3),R.status=E);else{var X=w+(R.w_bits-8<<4)<<8;X|=(2<=R.strategy||R.level<2?0:R.level<6?1:R.level===6?2:3)<<6,R.strstart!==0&&(X|=32),X+=31-X%31,R.status=E,te(R,X),R.strstart!==0&&(te(R,y.adler>>>16),te(R,65535&y.adler)),y.adler=1}if(R.status===69)if(R.gzhead.extra){for(S=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),F(y),S=R.pending,R.pending!==R.pending_buf_size));)ae(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){S=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),F(y),S=R.pending,R.pending===R.pending_buf_size)){B=1;break}B=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,ae(R,B)}while(B!==0);R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),B===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){S=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),F(y),S=R.pending,R.pending===R.pending_buf_size)){B=1;break}B=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,ae(R,B)}while(B!==0);R.gzhead.hcrc&&R.pending>S&&(y.adler=l(y.adler,R.pending_buf,R.pending-S,S)),B===0&&(R.status=103)}else R.status=103;if(R.status===103&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&F(y),R.pending+2<=R.pending_buf_size&&(ae(R,255&y.adler),ae(R,y.adler>>8&255),y.adler=0,R.status=E)):R.status=E),R.pending!==0){if(F(y),y.avail_out===0)return R.last_flush=-1,f}else if(y.avail_in===0&&H(q)<=H(G)&&q!==d)return ee(y,-5);if(R.status===666&&y.avail_in!==0)return ee(y,-5);if(y.avail_in!==0||R.lookahead!==0||q!==h&&R.status!==666){var Z=R.strategy===2?function(W,re){for(var ue;;){if(W.lookahead===0&&(ve(W),W.lookahead===0)){if(re===h)return g;break}if(W.match_length=0,ue=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,ue&&(D(W,!1),W.strm.avail_out===0))return g}return W.insert=0,re===d?(D(W,!0),W.strm.avail_out===0?z:U):W.last_lit&&(D(W,!1),W.strm.avail_out===0)?g:N}(R,q):R.strategy===3?function(W,re){for(var ue,ie,de,Je,Ue=W.window;;){if(W.lookahead<=V){if(ve(W),W.lookahead<=V&&re===h)return g;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=L&&0<W.strstart&&(ie=Ue[de=W.strstart-1])===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]){Je=W.strstart+V;do;while(ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&ie===Ue[++de]&&de<Je);W.match_length=V-(Je-de),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=L?(ue=a._tr_tally(W,1,W.match_length-L),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(ue=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),ue&&(D(W,!1),W.strm.avail_out===0))return g}return W.insert=0,re===d?(D(W,!0),W.strm.avail_out===0?z:U):W.last_lit&&(D(W,!1),W.strm.avail_out===0)?g:N}(R,q):s[R.level].func(R,q);if(Z!==z&&Z!==U||(R.status=666),Z===g||Z===z)return y.avail_out===0&&(R.last_flush=-1),f;if(Z===N&&(q===1?a._tr_align(R):q!==5&&(a._tr_stored_block(R,0,0,!1),q===3&&(Y(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),F(y),y.avail_out===0))return R.last_flush=-1,f}return q!==d?f:R.wrap<=0?1:(R.wrap===2?(ae(R,255&y.adler),ae(R,y.adler>>8&255),ae(R,y.adler>>16&255),ae(R,y.adler>>24&255),ae(R,255&y.total_in),ae(R,y.total_in>>8&255),ae(R,y.total_in>>16&255),ae(R,y.total_in>>24&255)):(te(R,y.adler>>>16),te(R,65535&y.adler)),F(y),0<R.wrap&&(R.wrap=-R.wrap),R.pending!==0?f:1)},i.deflateEnd=function(y){var q;return y&&y.state?(q=y.state.status)!==x&&q!==69&&q!==73&&q!==91&&q!==103&&q!==E&&q!==666?ee(y,p):(y.state=null,q===E?ee(y,-3):f):p},i.deflateSetDictionary=function(y,q){var G,R,S,B,X,Z,W,re,ue=q.length;if(!y||!y.state||(B=(G=y.state).wrap)===2||B===1&&G.status!==x||G.lookahead)return p;for(B===1&&(y.adler=c(y.adler,q,ue,0)),G.wrap=0,ue>=G.w_size&&(B===0&&(Y(G.head),G.strstart=0,G.block_start=0,G.insert=0),re=new o.Buf8(G.w_size),o.arraySet(re,q,ue-G.w_size,G.w_size,0),q=re,ue=G.w_size),X=y.avail_in,Z=y.next_in,W=y.input,y.avail_in=ue,y.next_in=0,y.input=q,ve(G);G.lookahead>=L;){for(R=G.strstart,S=G.lookahead-(L-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[R+L-1])&G.hash_mask,G.prev[R&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=R,R++,--S;);G.strstart=R,G.lookahead=L-1,ve(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=L-1,G.match_available=0,y.next_in=Z,y.input=W,y.avail_in=X,G.wrap=B,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,h,d,f,p,m,b,_,w,v,A,C,T,I,$,L,V,Q,x,E,g,N;a=s.state,c=s.next_in,g=s.input,l=c+(s.avail_in-5),u=s.next_out,N=s.output,h=u-(o-s.avail_out),d=u+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,w=a.hold,v=a.bits,A=a.lencode,C=a.distcode,T=(1<<a.lenbits)-1,I=(1<<a.distbits)-1;e:do{v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),$=A[w&T];t:for(;;){if(w>>>=L=$>>>24,v-=L,(L=$>>>16&255)===0)N[u++]=65535&$;else{if(!(16&L)){if(!(64&L)){$=A[(65535&$)+(w&(1<<L)-1)];continue t}if(32&L){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}V=65535&$,(L&=15)&&(v<L&&(w+=g[c++]<<v,v+=8),V+=w&(1<<L)-1,w>>>=L,v-=L),v<15&&(w+=g[c++]<<v,v+=8,w+=g[c++]<<v,v+=8),$=C[w&I];n:for(;;){if(w>>>=L=$>>>24,v-=L,!(16&(L=$>>>16&255))){if(!(64&L)){$=C[(65535&$)+(w&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(Q=65535&$,v<(L&=15)&&(w+=g[c++]<<v,(v+=8)<L&&(w+=g[c++]<<v,v+=8)),f<(Q+=w&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=L,v-=L,(L=u-h)<Q){if(m<(L=Q-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(E=_,(x=0)===b){if(x+=p-L,L<V){for(V-=L;N[u++]=_[x++],--L;);x=u-Q,E=N}}else if(b<L){if(x+=p+b-L,(L-=b)<V){for(V-=L;N[u++]=_[x++],--L;);if(x=0,b<V){for(V-=L=b;N[u++]=_[x++],--L;);x=u-Q,E=N}}}else if(x+=b-L,L<V){for(V-=L;N[u++]=_[x++],--L;);x=u-Q,E=N}for(;2<V;)N[u++]=E[x++],N[u++]=E[x++],N[u++]=E[x++],V-=3;V&&(N[u++]=E[x++],1<V&&(N[u++]=E[x++]))}else{for(x=u-Q;N[u++]=N[x++],N[u++]=N[x++],N[u++]=N[x++],2<(V-=3););V&&(N[u++]=N[x++],1<V&&(N[u++]=N[x++]))}break}}break}}while(c<l&&u<d);c-=V=v>>3,w&=(1<<(v-=V<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=w,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,h=2,d=0,f=-2,p=1,m=852,b=592;function _(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(x){var E;return x&&x.state?(E=x.state,x.total_in=x.total_out=E.total=0,x.msg="",E.wrap&&(x.adler=1&E.wrap),E.mode=p,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new s.Buf32(m),E.distcode=E.distdyn=new s.Buf32(b),E.sane=1,E.back=-1,d):f}function A(x){var E;return x&&x.state?((E=x.state).wsize=0,E.whave=0,E.wnext=0,v(x)):f}function C(x,E){var g,N;return x&&x.state?(N=x.state,E<0?(g=0,E=-E):(g=1+(E>>4),E<48&&(E&=15)),E&&(E<8||15<E)?f:(N.window!==null&&N.wbits!==E&&(N.window=null),N.wrap=g,N.wbits=E,A(x))):f}function T(x,E){var g,N;return x?(N=new w,(x.state=N).window=null,(g=C(x,E))!==d&&(x.state=null),g):f}var I,$,L=!0;function V(x){if(L){var E;for(I=new s.Buf32(512),$=new s.Buf32(32),E=0;E<144;)x.lens[E++]=8;for(;E<256;)x.lens[E++]=9;for(;E<280;)x.lens[E++]=7;for(;E<288;)x.lens[E++]=8;for(l(u,x.lens,0,288,I,0,x.work,{bits:9}),E=0;E<32;)x.lens[E++]=5;l(h,x.lens,0,32,$,0,x.work,{bits:5}),L=!1}x.lencode=I,x.lenbits=9,x.distcode=$,x.distbits=5}function Q(x,E,g,N){var z,U=x.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),N>=U.wsize?(s.arraySet(U.window,E,g-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(N<(z=U.wsize-U.wnext)&&(z=N),s.arraySet(U.window,E,g-N,z,U.wnext),(N-=z)?(s.arraySet(U.window,E,g-N,N,0),U.wnext=N,U.whave=U.wsize):(U.wnext+=z,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=z))),0}i.inflateReset=A,i.inflateReset2=C,i.inflateResetKeep=v,i.inflateInit=function(x){return T(x,15)},i.inflateInit2=T,i.inflate=function(x,E){var g,N,z,U,ee,H,Y,F,D,ae,te,ne,ve,ze,we,be,We,$e,mt,Et,y,q,G,R,S=0,B=new s.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return f;(g=x.state).mode===12&&(g.mode=13),ee=x.next_out,z=x.output,Y=x.avail_out,U=x.next_in,N=x.input,H=x.avail_in,F=g.hold,D=g.bits,ae=H,te=Y,q=d;e:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(2&g.wrap&&F===35615){B[g.check=0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0),D=F=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&F)<<8)+(F>>8))%31){x.msg="incorrect header check",g.mode=30;break}if((15&F)!=8){x.msg="unknown compression method",g.mode=30;break}if(D-=4,y=8+(15&(F>>>=4)),g.wbits===0)g.wbits=y;else if(y>g.wbits){x.msg="invalid window size",g.mode=30;break}g.dmax=1<<y,x.adler=g.check=1,g.mode=512&F?10:12,D=F=0;break;case 2:for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(g.flags=F,(255&g.flags)!=8){x.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){x.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=F>>8&1),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0,g.mode=3;case 3:for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.head&&(g.head.time=F),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,B[2]=F>>>16&255,B[3]=F>>>24&255,g.check=a(g.check,B,4,0)),D=F=0,g.mode=4;case 4:for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.head&&(g.head.xflags=255&F,g.head.os=F>>8),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0,g.mode=5;case 5:if(1024&g.flags){for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.length=F,g.head&&(g.head.extra_len=F),512&g.flags&&(B[0]=255&F,B[1]=F>>>8&255,g.check=a(g.check,B,2,0)),D=F=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(H<(ne=g.length)&&(ne=H),ne&&(g.head&&(y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),s.arraySet(g.head.extra,N,U,ne,y)),512&g.flags&&(g.check=a(g.check,N,ne,U)),H-=ne,U+=ne,g.length-=ne),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(H===0)break e;for(ne=0;y=N[U+ne++],g.head&&y&&g.length<65536&&(g.head.name+=String.fromCharCode(y)),y&&ne<H;);if(512&g.flags&&(g.check=a(g.check,N,ne,U)),H-=ne,U+=ne,y)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(H===0)break e;for(ne=0;y=N[U+ne++],g.head&&y&&g.length<65536&&(g.head.comment+=String.fromCharCode(y)),y&&ne<H;);if(512&g.flags&&(g.check=a(g.check,N,ne,U)),H-=ne,U+=ne,y)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;D<16;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F!==(65535&g.check)){x.msg="header crc mismatch",g.mode=30;break}D=F=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),x.adler=g.check=0,g.mode=12;break;case 10:for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}x.adler=g.check=_(F),D=F=0,g.mode=11;case 11:if(g.havedict===0)return x.next_out=ee,x.avail_out=Y,x.next_in=U,x.avail_in=H,g.hold=F,g.bits=D,2;x.adler=g.check=1,g.mode=12;case 12:if(E===5||E===6)break e;case 13:if(g.last){F>>>=7&D,D-=7&D,g.mode=27;break}for(;D<3;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}switch(g.last=1&F,D-=1,3&(F>>>=1)){case 0:g.mode=14;break;case 1:if(V(g),g.mode=20,E!==6)break;F>>>=2,D-=2;break e;case 2:g.mode=17;break;case 3:x.msg="invalid block type",g.mode=30}F>>>=2,D-=2;break;case 14:for(F>>>=7&D,D-=7&D;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if((65535&F)!=(F>>>16^65535)){x.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&F,D=F=0,g.mode=15,E===6)break e;case 15:g.mode=16;case 16:if(ne=g.length){if(H<ne&&(ne=H),Y<ne&&(ne=Y),ne===0)break e;s.arraySet(z,N,U,ne,ee),H-=ne,U+=ne,Y-=ne,ee+=ne,g.length-=ne;break}g.mode=12;break;case 17:for(;D<14;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(g.nlen=257+(31&F),F>>>=5,D-=5,g.ndist=1+(31&F),F>>>=5,D-=5,g.ncode=4+(15&F),F>>>=4,D-=4,286<g.nlen||30<g.ndist){x.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;D<3;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.lens[X[g.have++]]=7&F,F>>>=3,D-=3}for(;g.have<19;)g.lens[X[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,G={bits:g.lenbits},q=l(0,g.lens,0,19,g.lencode,0,g.work,G),g.lenbits=G.bits,q){x.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;be=(S=g.lencode[F&(1<<g.lenbits)-1])>>>16&255,We=65535&S,!((we=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(We<16)F>>>=we,D-=we,g.lens[g.have++]=We;else{if(We===16){for(R=we+2;D<R;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F>>>=we,D-=we,g.have===0){x.msg="invalid bit length repeat",g.mode=30;break}y=g.lens[g.have-1],ne=3+(3&F),F>>>=2,D-=2}else if(We===17){for(R=we+3;D<R;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}D-=we,y=0,ne=3+(7&(F>>>=we)),F>>>=3,D-=3}else{for(R=we+7;D<R;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}D-=we,y=0,ne=11+(127&(F>>>=we)),F>>>=7,D-=7}if(g.have+ne>g.nlen+g.ndist){x.msg="invalid bit length repeat",g.mode=30;break}for(;ne--;)g.lens[g.have++]=y}}if(g.mode===30)break;if(g.lens[256]===0){x.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,G={bits:g.lenbits},q=l(u,g.lens,0,g.nlen,g.lencode,0,g.work,G),g.lenbits=G.bits,q){x.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,G={bits:g.distbits},q=l(h,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,G),g.distbits=G.bits,q){x.msg="invalid distances set",g.mode=30;break}if(g.mode=20,E===6)break e;case 20:g.mode=21;case 21:if(6<=H&&258<=Y){x.next_out=ee,x.avail_out=Y,x.next_in=U,x.avail_in=H,g.hold=F,g.bits=D,c(x,te),ee=x.next_out,z=x.output,Y=x.avail_out,U=x.next_in,N=x.input,H=x.avail_in,F=g.hold,D=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;be=(S=g.lencode[F&(1<<g.lenbits)-1])>>>16&255,We=65535&S,!((we=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(be&&!(240&be)){for($e=we,mt=be,Et=We;be=(S=g.lencode[Et+((F&(1<<$e+mt)-1)>>$e)])>>>16&255,We=65535&S,!($e+(we=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}F>>>=$e,D-=$e,g.back+=$e}if(F>>>=we,D-=we,g.back+=we,g.length=We,be===0){g.mode=26;break}if(32&be){g.back=-1,g.mode=12;break}if(64&be){x.msg="invalid literal/length code",g.mode=30;break}g.extra=15&be,g.mode=22;case 22:if(g.extra){for(R=g.extra;D<R;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.length+=F&(1<<g.extra)-1,F>>>=g.extra,D-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;be=(S=g.distcode[F&(1<<g.distbits)-1])>>>16&255,We=65535&S,!((we=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(!(240&be)){for($e=we,mt=be,Et=We;be=(S=g.distcode[Et+((F&(1<<$e+mt)-1)>>$e)])>>>16&255,We=65535&S,!($e+(we=S>>>24)<=D);){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}F>>>=$e,D-=$e,g.back+=$e}if(F>>>=we,D-=we,g.back+=we,64&be){x.msg="invalid distance code",g.mode=30;break}g.offset=We,g.extra=15&be,g.mode=24;case 24:if(g.extra){for(R=g.extra;D<R;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}g.offset+=F&(1<<g.extra)-1,F>>>=g.extra,D-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){x.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(Y===0)break e;if(ne=te-Y,g.offset>ne){if((ne=g.offset-ne)>g.whave&&g.sane){x.msg="invalid distance too far back",g.mode=30;break}ve=ne>g.wnext?(ne-=g.wnext,g.wsize-ne):g.wnext-ne,ne>g.length&&(ne=g.length),ze=g.window}else ze=z,ve=ee-g.offset,ne=g.length;for(Y<ne&&(ne=Y),Y-=ne,g.length-=ne;z[ee++]=ze[ve++],--ne;);g.length===0&&(g.mode=21);break;case 26:if(Y===0)break e;z[ee++]=g.length,Y--,g.mode=21;break;case 27:if(g.wrap){for(;D<32;){if(H===0)break e;H--,F|=N[U++]<<D,D+=8}if(te-=Y,x.total_out+=te,g.total+=te,te&&(x.adler=g.check=g.flags?a(g.check,z,te,ee-te):o(g.check,z,te,ee-te)),te=Y,(g.flags?F:_(F))!==g.check){x.msg="incorrect data check",g.mode=30;break}D=F=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;D<32;){if(H===0)break e;H--,F+=N[U++]<<D,D+=8}if(F!==(4294967295&g.total)){x.msg="incorrect length check",g.mode=30;break}D=F=0}g.mode=29;case 29:q=1;break e;case 30:q=-3;break e;case 31:return-4;case 32:default:return f}return x.next_out=ee,x.avail_out=Y,x.next_in=U,x.avail_in=H,g.hold=F,g.bits=D,(g.wsize||te!==x.avail_out&&g.mode<30&&(g.mode<27||E!==4))&&Q(x,x.output,x.next_out,te-x.avail_out)?(g.mode=31,-4):(ae-=x.avail_in,te-=x.avail_out,x.total_in+=ae,x.total_out+=te,g.total+=te,g.wrap&&te&&(x.adler=g.check=g.flags?a(g.check,z,te,x.next_out-te):o(g.check,z,te,x.next_out-te)),x.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ae==0&&te===0||E===4)&&q===d&&(q=-5),q)},i.inflateEnd=function(x){if(!x||!x.state)return f;var E=x.state;return E.window&&(E.window=null),x.state=null,d},i.inflateGetHeader=function(x,E){var g;return x&&x.state&&2&(g=x.state).wrap?((g.head=E).done=!1,d):f},i.inflateSetDictionary=function(x,E){var g,N=E.length;return x&&x.state?(g=x.state).wrap!==0&&g.mode!==11?f:g.mode===11&&o(1,E,N,0)!==g.check?-3:Q(x,E,N,N)?(g.mode=31,-4):(g.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,d,f,p,m,b,_){var w,v,A,C,T,I,$,L,V,Q=_.bits,x=0,E=0,g=0,N=0,z=0,U=0,ee=0,H=0,Y=0,F=0,D=null,ae=0,te=new s.Buf16(16),ne=new s.Buf16(16),ve=null,ze=0;for(x=0;x<=15;x++)te[x]=0;for(E=0;E<f;E++)te[h[d+E]]++;for(z=Q,N=15;1<=N&&te[N]===0;N--);if(N<z&&(z=N),N===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(g=1;g<N&&te[g]===0;g++);for(z<g&&(z=g),x=H=1;x<=15;x++)if(H<<=1,(H-=te[x])<0)return-1;if(0<H&&(u===0||N!==1))return-1;for(ne[1]=0,x=1;x<15;x++)ne[x+1]=ne[x]+te[x];for(E=0;E<f;E++)h[d+E]!==0&&(b[ne[h[d+E]]++]=E);if(I=u===0?(D=ve=b,19):u===1?(D=o,ae-=257,ve=a,ze-=257,256):(D=c,ve=l,-1),x=g,T=m,ee=E=F=0,A=-1,C=(Y=1<<(U=z))-1,u===1&&852<Y||u===2&&592<Y)return 1;for(;;){for($=x-ee,V=b[E]<I?(L=0,b[E]):b[E]>I?(L=ve[ze+b[E]],D[ae+b[E]]):(L=96,0),w=1<<x-ee,g=v=1<<U;p[T+(F>>ee)+(v-=w)]=$<<24|L<<16|V|0,v!==0;);for(w=1<<x-1;F&w;)w>>=1;if(w!==0?(F&=w-1,F+=w):F=0,E++,--te[x]==0){if(x===N)break;x=h[d+b[E]]}if(z<x&&(F&C)!==A){for(ee===0&&(ee=z),T+=g,H=1<<(U=x-ee);U+ee<N&&!((H-=te[U+ee])<=0);)U++,H<<=1;if(Y+=1<<U,u===1&&852<Y||u===2&&592<Y)return 1;p[A=F&C]=z<<24|U<<16|T-m|0}}return F!==0&&(p[T+F]=x-ee<<24|64<<16|0),_.bits=z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(S){for(var B=S.length;0<=--B;)S[B]=0}var l=0,u=29,h=256,d=h+1+u,f=30,p=19,m=2*d+1,b=15,_=16,w=7,v=256,A=16,C=17,T=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(d+2));c(Q);var x=new Array(2*f);c(x);var E=new Array(512);c(E);var g=new Array(256);c(g);var N=new Array(u);c(N);var z,U,ee,H=new Array(f);function Y(S,B,X,Z,W){this.static_tree=S,this.extra_bits=B,this.extra_base=X,this.elems=Z,this.max_length=W,this.has_stree=S&&S.length}function F(S,B){this.dyn_tree=S,this.max_code=0,this.stat_desc=B}function D(S){return S<256?E[S]:E[256+(S>>>7)]}function ae(S,B){S.pending_buf[S.pending++]=255&B,S.pending_buf[S.pending++]=B>>>8&255}function te(S,B,X){S.bi_valid>_-X?(S.bi_buf|=B<<S.bi_valid&65535,ae(S,S.bi_buf),S.bi_buf=B>>_-S.bi_valid,S.bi_valid+=X-_):(S.bi_buf|=B<<S.bi_valid&65535,S.bi_valid+=X)}function ne(S,B,X){te(S,X[2*B],X[2*B+1])}function ve(S,B){for(var X=0;X|=1&S,S>>>=1,X<<=1,0<--B;);return X>>>1}function ze(S,B,X){var Z,W,re=new Array(b+1),ue=0;for(Z=1;Z<=b;Z++)re[Z]=ue=ue+X[Z-1]<<1;for(W=0;W<=B;W++){var ie=S[2*W+1];ie!==0&&(S[2*W]=ve(re[ie]++,ie))}}function we(S){var B;for(B=0;B<d;B++)S.dyn_ltree[2*B]=0;for(B=0;B<f;B++)S.dyn_dtree[2*B]=0;for(B=0;B<p;B++)S.bl_tree[2*B]=0;S.dyn_ltree[2*v]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function be(S){8<S.bi_valid?ae(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function We(S,B,X,Z){var W=2*B,re=2*X;return S[W]<S[re]||S[W]===S[re]&&Z[B]<=Z[X]}function $e(S,B,X){for(var Z=S.heap[X],W=X<<1;W<=S.heap_len&&(W<S.heap_len&&We(B,S.heap[W+1],S.heap[W],S.depth)&&W++,!We(B,Z,S.heap[W],S.depth));)S.heap[X]=S.heap[W],X=W,W<<=1;S.heap[X]=Z}function mt(S,B,X){var Z,W,re,ue,ie=0;if(S.last_lit!==0)for(;Z=S.pending_buf[S.d_buf+2*ie]<<8|S.pending_buf[S.d_buf+2*ie+1],W=S.pending_buf[S.l_buf+ie],ie++,Z===0?ne(S,W,B):(ne(S,(re=g[W])+h+1,B),(ue=I[re])!==0&&te(S,W-=N[re],ue),ne(S,re=D(--Z),X),(ue=$[re])!==0&&te(S,Z-=H[re],ue)),ie<S.last_lit;);ne(S,v,B)}function Et(S,B){var X,Z,W,re=B.dyn_tree,ue=B.stat_desc.static_tree,ie=B.stat_desc.has_stree,de=B.stat_desc.elems,Je=-1;for(S.heap_len=0,S.heap_max=m,X=0;X<de;X++)re[2*X]!==0?(S.heap[++S.heap_len]=Je=X,S.depth[X]=0):re[2*X+1]=0;for(;S.heap_len<2;)re[2*(W=S.heap[++S.heap_len]=Je<2?++Je:0)]=1,S.depth[W]=0,S.opt_len--,ie&&(S.static_len-=ue[2*W+1]);for(B.max_code=Je,X=S.heap_len>>1;1<=X;X--)$e(S,re,X);for(W=de;X=S.heap[1],S.heap[1]=S.heap[S.heap_len--],$e(S,re,1),Z=S.heap[1],S.heap[--S.heap_max]=X,S.heap[--S.heap_max]=Z,re[2*W]=re[2*X]+re[2*Z],S.depth[W]=(S.depth[X]>=S.depth[Z]?S.depth[X]:S.depth[Z])+1,re[2*X+1]=re[2*Z+1]=W,S.heap[1]=W++,$e(S,re,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(Ue,kn){var bo,ir,wo,ut,xc,Hh,Cr=kn.dyn_tree,P_=kn.max_code,DM=kn.stat_desc.static_tree,BM=kn.stat_desc.has_stree,FM=kn.stat_desc.extra_bits,D_=kn.stat_desc.extra_base,vo=kn.stat_desc.max_length,Oc=0;for(ut=0;ut<=b;ut++)Ue.bl_count[ut]=0;for(Cr[2*Ue.heap[Ue.heap_max]+1]=0,bo=Ue.heap_max+1;bo<m;bo++)vo<(ut=Cr[2*Cr[2*(ir=Ue.heap[bo])+1]+1]+1)&&(ut=vo,Oc++),Cr[2*ir+1]=ut,P_<ir||(Ue.bl_count[ut]++,xc=0,D_<=ir&&(xc=FM[ir-D_]),Hh=Cr[2*ir],Ue.opt_len+=Hh*(ut+xc),BM&&(Ue.static_len+=Hh*(DM[2*ir+1]+xc)));if(Oc!==0){do{for(ut=vo-1;Ue.bl_count[ut]===0;)ut--;Ue.bl_count[ut]--,Ue.bl_count[ut+1]+=2,Ue.bl_count[vo]--,Oc-=2}while(0<Oc);for(ut=vo;ut!==0;ut--)for(ir=Ue.bl_count[ut];ir!==0;)P_<(wo=Ue.heap[--bo])||(Cr[2*wo+1]!==ut&&(Ue.opt_len+=(ut-Cr[2*wo+1])*Cr[2*wo],Cr[2*wo+1]=ut),ir--)}}(S,B),ze(re,Je,S.bl_count)}function y(S,B,X){var Z,W,re=-1,ue=B[1],ie=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),B[2*(X+1)+1]=65535,Z=0;Z<=X;Z++)W=ue,ue=B[2*(Z+1)+1],++ie<de&&W===ue||(ie<Je?S.bl_tree[2*W]+=ie:W!==0?(W!==re&&S.bl_tree[2*W]++,S.bl_tree[2*A]++):ie<=10?S.bl_tree[2*C]++:S.bl_tree[2*T]++,re=W,Je=(ie=0)===ue?(de=138,3):W===ue?(de=6,3):(de=7,4))}function q(S,B,X){var Z,W,re=-1,ue=B[1],ie=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),Z=0;Z<=X;Z++)if(W=ue,ue=B[2*(Z+1)+1],!(++ie<de&&W===ue)){if(ie<Je)for(;ne(S,W,S.bl_tree),--ie!=0;);else W!==0?(W!==re&&(ne(S,W,S.bl_tree),ie--),ne(S,A,S.bl_tree),te(S,ie-3,2)):ie<=10?(ne(S,C,S.bl_tree),te(S,ie-3,3)):(ne(S,T,S.bl_tree),te(S,ie-11,7));re=W,Je=(ie=0)===ue?(de=138,3):W===ue?(de=6,3):(de=7,4)}}c(H);var G=!1;function R(S,B,X,Z){te(S,(l<<1)+(Z?1:0),3),function(W,re,ue,ie){be(W),ae(W,ue),ae(W,~ue),s.arraySet(W.pending_buf,W.window,re,ue,W.pending),W.pending+=ue}(S,B,X)}i._tr_init=function(S){G||(function(){var B,X,Z,W,re,ue=new Array(b+1);for(W=Z=0;W<u-1;W++)for(N[W]=Z,B=0;B<1<<I[W];B++)g[Z++]=W;for(g[Z-1]=W,W=re=0;W<16;W++)for(H[W]=re,B=0;B<1<<$[W];B++)E[re++]=W;for(re>>=7;W<f;W++)for(H[W]=re<<7,B=0;B<1<<$[W]-7;B++)E[256+re++]=W;for(X=0;X<=b;X++)ue[X]=0;for(B=0;B<=143;)Q[2*B+1]=8,B++,ue[8]++;for(;B<=255;)Q[2*B+1]=9,B++,ue[9]++;for(;B<=279;)Q[2*B+1]=7,B++,ue[7]++;for(;B<=287;)Q[2*B+1]=8,B++,ue[8]++;for(ze(Q,d+1,ue),B=0;B<f;B++)x[2*B+1]=5,x[2*B]=ve(B,5);z=new Y(Q,I,h+1,d,b),U=new Y(x,$,0,f,b),ee=new Y(new Array(0),L,0,p,w)}(),G=!0),S.l_desc=new F(S.dyn_ltree,z),S.d_desc=new F(S.dyn_dtree,U),S.bl_desc=new F(S.bl_tree,ee),S.bi_buf=0,S.bi_valid=0,we(S)},i._tr_stored_block=R,i._tr_flush_block=function(S,B,X,Z){var W,re,ue=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(ie){var de,Je=4093624447;for(de=0;de<=31;de++,Je>>>=1)if(1&Je&&ie.dyn_ltree[2*de]!==0)return o;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return a;for(de=32;de<h;de++)if(ie.dyn_ltree[2*de]!==0)return a;return o}(S)),Et(S,S.l_desc),Et(S,S.d_desc),ue=function(ie){var de;for(y(ie,ie.dyn_ltree,ie.l_desc.max_code),y(ie,ie.dyn_dtree,ie.d_desc.max_code),Et(ie,ie.bl_desc),de=p-1;3<=de&&ie.bl_tree[2*V[de]+1]===0;de--);return ie.opt_len+=3*(de+1)+5+5+4,de}(S),W=S.opt_len+3+7>>>3,(re=S.static_len+3+7>>>3)<=W&&(W=re)):W=re=X+5,X+4<=W&&B!==-1?R(S,B,X,Z):S.strategy===4||re===W?(te(S,2+(Z?1:0),3),mt(S,Q,x)):(te(S,4+(Z?1:0),3),function(ie,de,Je,Ue){var kn;for(te(ie,de-257,5),te(ie,Je-1,5),te(ie,Ue-4,4),kn=0;kn<Ue;kn++)te(ie,ie.bl_tree[2*V[kn]+1],3);q(ie,ie.dyn_ltree,de-1),q(ie,ie.dyn_dtree,Je-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,ue+1),mt(S,S.dyn_ltree,S.dyn_dtree)),we(S),Z&&be(S)},i._tr_tally=function(S,B,X){return S.pending_buf[S.d_buf+2*S.last_lit]=B>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&B,S.pending_buf[S.l_buf+S.last_lit]=255&X,S.last_lit++,B===0?S.dyn_ltree[2*X]++:(S.matches++,B--,S.dyn_ltree[2*(g[X]+h+1)]++,S.dyn_dtree[2*D(B)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){te(S,2,3),ne(S,v,Q),function(B){B.bi_valid===16?(ae(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,d=1,f={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){process.nextTick(function(){w(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,C=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=C,A}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(A){o.postMessage(h+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){w(A.data)},function(A){u.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(A){var C=m.createElement("script");C.onreadystatechange=function(){w(A),C.onreadystatechange=null,l.removeChild(C),C=null},l.appendChild(C)}):function(A){setTimeout(w,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),T=0;T<C.length;T++)C[T]=arguments[T+1];var I={callback:A,args:C};return f[d]=I,c(d),d++},b.clearImmediate=_}function _(A){delete f[A]}function w(A){if(p)setTimeout(w,0,A);else{var C=f[A];if(C){p=!0;try{(function(T){var I=T.callback,$=T.args;switch($.length){case 0:I();break;case 1:I($[0]);break;case 2:I($[0],$[1]);break;case 3:I($[0],$[1],$[2]);break;default:I.apply(a,$)}})(C)}finally{_(A),p=!1}}}}function v(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(h)===0&&w(+A.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Mt<"u"?Mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(N_);var RM=N_.exports,L_=Oi(RM);function IM(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function xM(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const OM=new Date("1980/09/02");async function CM(t){return new Promise((e,n)=>{const r=new L_;for(let i=0;i<t.length;++i){const s=t[i],o=sN(s);if(o){const a=QC(o);k(a)&&r.file(s.id,a,{date:OM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(xM(i))}).catch(n)})}async function NM(t){return new Promise((e,n)=>{const r=new L_;r.loadAsync(IM(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=oN(eN(c));k(l)&&i.push(l)}e(i)}).catch(n)})}const LM=16,xi={},MM=64;let M_=0;const Or={},as={};async function Gh(t=""){kM();const e=Ac(),n=Gt(je.MAIN);if(e.length&&k(n)){const r=await CM(e),i=`${t}${new Date().toISOString()} ${n.name} ${r.length} chars`;ik(En.name(),i,r,Zr())}}let U_=!1;const En=cs("vm",["init","tick","second"],t=>{var e;switch(t.target){case"init":k(t.player)&&!U_&&(U_=!0,t.player,fM(t.player),En.reply(t,"ackinit",!0,t.player));break;case"books":t.player===Zr()&&Wh("vm:books",async()=>{if(Ge(t.data)){const[n,r]=t.data,i=await NM(n),s=i.map(o=>o.name);gM(i,r),Qe(En.name(),`loading ${s.join(", ")}`),En.reply(t,"ackbooks",!0,t.player)}});break;case"login":t.player&&_M(t.player)&&(xi[t.player]=0,Qe(En.name(),`login from ${t.player}`),En.reply(t,"acklogin",!0,t.player));break;case"endgame":t.player===Zr()&&Wh("vm:endgame",async()=>{t.player&&(x_(t.player),tk("vm",t.player),await Gh(),await Ib(1e3),gk(En.name(),t.player))});break;case"doot":t.player&&(xi[t.player]=0,pp(En.name(),"active",t.player));break;case"input":if(t.player){const n=os(t.player),[r=Bt.NONE,i=0]=t.data??[Bt.NONE,0];Ge(n.inputqueue)||(n.inputqueue=[]),r!==Bt.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(t.player&&Ge(t.data)){const[n,r]=t.data;if(!k(as[r])){const i=mp(n,r);as[r]=bp(i,s=>{const o=Jr(n),a=Ei(o,r);k(a)&&(a.code=s,iN(a))})}Or[n]=Or[n]??{},Or[n][r]=Or[n][r]??new Set,Or[n][r].add(t.player)}break;case"coderelease":if(t.player&&Ge(t.data)){const[n,r]=t.data;k(Or[n])&&k(Or[n][r])&&(Or[n][r].delete(t.player),Or[n][r].size===0&&((e=as[r])==null||e.call(as),as[r]=void 0))}break;case"tick":t.player!=="locked"&&EM();break;case"second":{bM(xi);const n=Object.keys(xi);for(let r=0;r<n.length;++r)++xi[n[r]];for(let r=0;r<n.length;++r){const i=n[r];xi[i]>=LM&&(delete xi[i],x_(i),In(En.name(),"player logout",i),En.emit("logout",void 0,i))}xb()===!1&&++M_>=MM&&(M_=0,zl(En.name(),"",Zr()));break}case"flush":t.player===Zr()&&Wh("vm:flush",async()=>{ke(t.data)?await Gh(`${t.data} `):await Gh()});break;case"cli":t.player===Zr()&&SM(t.player,t.data);break;case"loader":if(t.player===Zr()&&Ge(t.data)){const[n,r]=t.data;ke(n)&&eL(n,r)}break;default:wM(t);break}});function UM(){rk(En.name(),Zr())}const{forward:PM}=Tb(t=>postMessage(t));onmessage=function(e){PM(e.data)},setTimeout(UM,100)})();
